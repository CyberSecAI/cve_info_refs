=== Content from github.com_786eb383_20250115_084513.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2F)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2F)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=herry-zhang%2FPython3-RESTfulAPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[herry-zhang](/herry-zhang)
/
**[Python3-RESTfulAPI](/herry-zhang/Python3-RESTfulAPI)**
Public

* [Notifications](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI) You must be signed in to change notification settings
* [Fork
  72](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)
* [Star
   161](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)

Python3 开发以及部署 RESTful API项目（Python3 + Django2.0 + Django REST FrameWork + Centos7 + uWsgi + Nginx）

[161
stars](/herry-zhang/Python3-RESTfulAPI/stargazers) [72
forks](/herry-zhang/Python3-RESTfulAPI/forks) [Branches](/herry-zhang/Python3-RESTfulAPI/branches) [Tags](/herry-zhang/Python3-RESTfulAPI/tags) [Activity](/herry-zhang/Python3-RESTfulAPI/activity)
 [Star](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)

 [Notifications](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI) You must be signed in to change notification settings

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests
  0](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects
  0](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

Additional navigation options

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

# herry-zhang/Python3-RESTfulAPI

    master[Branches](/herry-zhang/Python3-RESTfulAPI/branches)[Tags](/herry-zhang/Python3-RESTfulAPI/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[6 Commits](/herry-zhang/Python3-RESTfulAPI/commits/master/) | | |
| [apis](/herry-zhang/Python3-RESTfulAPI/tree/master/apis "apis") | | [apis](/herry-zhang/Python3-RESTfulAPI/tree/master/apis "apis") |  |  |
| [apps](/herry-zhang/Python3-RESTfulAPI/tree/master/apps "apps") | | [apps](/herry-zhang/Python3-RESTfulAPI/tree/master/apps "apps") |  |  |
| [attendances](/herry-zhang/Python3-RESTfulAPI/tree/master/attendances "attendances") | | [attendances](/herry-zhang/Python3-RESTfulAPI/tree/master/attendances "attendances") |  |  |
| [README.md](/herry-zhang/Python3-RESTfulAPI/blob/master/README.md "README.md") | | [README.md](/herry-zhang/Python3-RESTfulAPI/blob/master/README.md "README.md") |  |  |
| [attendances.xml](/herry-zhang/Python3-RESTfulAPI/blob/master/attendances.xml "attendances.xml") | | [attendances.xml](/herry-zhang/Python3-RESTfulAPI/blob/master/attendances.xml "attendances.xml") |  |  |
| [manage.py](/herry-zhang/Python3-RESTfulAPI/blob/master/manage.py "manage.py") | | [manage.py](/herry-zhang/Python3-RESTfulAPI/blob/master/manage.py "manage.py") |  |  |
| [requirements.txt](/herry-zhang/Python3-RESTfulAPI/blob/master/requirements.txt "requirements.txt") | | [requirements.txt](/herry-zhang/Python3-RESTfulAPI/blob/master/requirements.txt "requirements.txt") |  |  |
| [test.py](/herry-zhang/Python3-RESTfulAPI/blob/master/test.py "test.py") | | [test.py](/herry-zhang/Python3-RESTfulAPI/blob/master/test.py "test.py") |  |  |
| View all files | | |

## Repository files navigation

* README
# Python3 开发以及部署 RESTful API项目（Python3 + Django2.0 + Django REST FrameWork + Centos7 + uWsgi + Nginx）

文档分为两个部分，分别从开发和部署两个方面先介绍项目流程，然后会说明项目中最常遇到的问题以及解决方案。如果项目中有什么处理不正确的地方，也希望大家给予指正、交流。

1. 开发环境采用Python3.6.3版本，项目采用Django2.0，Django REST FrameWork3.7.7去搭建。
2. 部署的时候，系统版本为Centos7，uWsgi版本使用本文发布时最新的2.0.15，Nginx版本1.13.7

## 第一部分 开发流程以及问题说明

由于项目本身基于 Token 的身份验证，另外有些接口不只是处理一个表里的数据，直接通过ORM不太好映射，所以并没有完全按照Django REST FrameWork进行开发，并且只采用GET和POST方法。

### 一、开发步骤

首先搭建开发环境并且创建一个新的项目。

#### 1. 安装Python3：如果使用的是 Mac OS X ，系统可能已经预装了 Python 。我们可以通过homebrew安装Python3。

```
$ brew install python3
```

安装了Python3之后，会有pip3，使用pip install XXX 新安装的库会放在这个目录下面python2.7/site-packages使用pip3 install XXX 新安装的库会放在这个目录下面python3.6/site-packages如果使用python3执行程序，那么就不能import python2.7/site-packages中的库

#### 2. 安装Django和Django REST FrameWork：可以下载django最新版本,若想指定版本,请在命令后面加上版本号。

```
$ pip3 install django
$ pip3 install djangorestframework
```

```
$ pip3 install django==版本号
$ pip3 install djangorestframework==版本号
```

#### 3. 创建一个新的项目。

```
$ cd ~
$ django-admin.py startproject attendances
$ cd attendances
$ python manage.py startapp user apps/user
```

#### 4. 将新user应用和rest\_framework应用添加到配置文件attendances/settings.py文件的INSTALLED\_APPS。

```
INSTALLED_APPS = (
    ...
    'rest_framework',
    'apps.user',
)
```

#### 5. 写接口代码前的一点准备。

做完以上步骤，我们就把项目开发需要的环境搭建完成了，接下来就可以在我们的项目中添加接口了。

另外还有一点要说明的是，为了给我们的api增加版本控制，我们的文件目录和路由是这样处理的，这样我们就可以通过添加新的版本文件并且修改配置，同时运行多个版本的接口：

**文件目录结构**

* > apis
* + > api\_v1
  + - > user
    - > base
    - > enum
    - > setting
    - > urls
* > apps
* > attendances
* + > setting
  + > urls
  + > wsgi
* > static
* > attendances.xml
* > manage.py
* > requirements.txt
* > test.py

**路由**

```
# 项目路由
urlpatterns = [
    url('admin/', admin.site.urls),
    url(r'^api/v1/', include('apis.api_v1.urls', namespace='api-v1')),
]
```

```
# apis下面的路由
from apis.api_v1.user import views as api_user

urlpatterns = [
    # user
    url(r'^user/$', api_user.user, name='user'),
]

app_name = 'api-v1'
```

**调用地址：** https://{Domain}/api/v1/user

**请求方法：** GET-获取用户信息 POST-修改用户信息

> 文件说明：apis存放的是api接口文件，app存放的是应用或者可以说是模块，attendances是项目文件存放一些项目配置，static静态文件，attendances.xml是uWsgi的配置文件，requirements.txt是一些项目相关的依赖，test.py是为了测试uWsgi是否配置成功的文件。

#### 6. 创建一个可以使用的模型以及Serializer类、Django视图。

**在apps/user/models.py创建User模型**

```
"""
用户模块
"""
from django.db import models, transaction

class User(models.Model):
    """
    用户信息表
    """
    user_id = models.AutoField(primary_key=True, verbose_name='用户id')
    user_guid = models.CharField(max_length=150, verbose_name='用户guid')
    user_name = models.CharField(
        max_length=100, blank=True, null=True, verbose_name='用户名')
    real_name = models.CharField(
        max_length=50, blank=True, null=True, verbose_name='真实姓名')
    avatar = models.CharField(
        max_length=250, blank=True, null=True, verbose_name='头像')
    mobile = models.CharField(
        max_length=50, blank=True, null=True, verbose_name='手机')
    balance = models.DecimalField(
        max_digits=8, decimal_places=2, blank=True, null=True, verbose_name='账户余额')
    available_balance = models.DecimalField(
        max_digits=8, decimal_places=2, blank=True, null=True, verbose_name='可用金额')
    frozen_balance = models.DecimalField(
        max_digits=8, decimal_places=2, blank=True, null=True, verbose_name='冻结金额')
    all_balance = models.DecimalField(
        max_digits=8, decimal_places=2, blank=True, null=True, verbose_name='累计金额')
    wx_open_id = models.CharField(max_length=150, verbose_name='微信OpenID')
    wx_union_id = models.CharField(
        max_length=150, blank=True, null=True, verbose_name='微信UnionID')
    create_date = models.FloatField(blank=True, null=True, verbose_name='创建时间')
    last_login_date = models.FloatField(
        blank=True, null=True, verbose_name='最后登录时间')
    ip_address = models.CharField(
        max_length=50, blank=True, null=True, verbose_name='IP地址')
    gender = models.IntegerField(blank=True, null=True, verbose_name='性别')
    province = models.CharField(
        max_length=50, blank=True, null=True, verbose_name='省份')
    city = models.CharField(
        max_length=50, blank=True, null=True, verbose_name='城市')
    session_key = models.CharField(
        max_length=150, blank=True, null=True, verbose_name='会话秘钥')
    is_notify = models.IntegerField(blank=True, null=True, verbose_name='是否开启打卡通知')

    @classmethod
    def update_user_balance(cls, user_id, amount):
        # 手动让select for update和update语句发生在一个完整的事务里面
        with transaction.atomic():
            user = (
                cls.objects
                .select_for_update()
                .get(user_id=user_id)
            )
            user.available_balance += amount
            user.balance = user.available_balance + user.frozen_balance
            if amount > 0:
                user.all_balance += amount
            user.save()
        return user

    class Meta:
        managed = False
        db_table = 'user'
        ordering = ['-create_date']
        verbose_name = '用户'
        verbose_name_plural = '用户'
```

**在apis/api\_v1/user/serializers.py创建Serializer类**

```
"""
用户模块
"""
from rest_framework import serializers
from apps.user.models import User
from apis.api_v1.enum import ErrorCode
from apis.api_v1.base import BaseApi

class GetUserSerializer(serializers.Serializer):
    """
    获取用户信息
    """
    token = serializers.CharField(max_length=150)
    user_id = serializers.IntegerField()

    def get_user(self, validated_data):
        result = dict()
        base_api = BaseApi()
        # 获取用户
        try:
            user = User.objects.get(user_id=validated_data["user_id"])
        except User.DoesNotExist:
            result["error_code"] = ErrorCode.用户不存在.value
            result["error"] = "用户不存在"
            return result
        # 认证
        if not base_api.authenticate_user(validated_data["token"], user.user_guid):
            result["error_code"] = ErrorCode.认证错误.value
            result["error"] = "认证错误"
            return result
        result["nick_name"] = user.user_name
        result["avatar"] = user.avatar
        result["error_code"] = ErrorCode.正确.value
        result["error"] = ""
        return result
```

**在apis/api\_v1/user/view.py创建视图**

```
"""
用户模块
"""
import json
from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework import status
from apis.api_v1.user.serializers import *
from apis.api_v1.enum import ErrorCode

@api_view(['GET', 'POST'])
def user(request):
    """
    GET:获取用户信息
    POST:更新用户信息
    """
    if request.method == 'GET':
        param = dict()
        param["token"] = request.GET.get("token", None)
        param["user_id"] = request.GET.get("user_id", 0)
        serializer = GetUserSerializer(data=param)
        if serializer.is_valid():
            result = serializer.get_user(serializer.validated_data)
            return Response(result, status=status.HTTP_201_CREATED)
        return Response(dict(error_code=ErrorCode.参数错误.value, error=json.dumps(serializer.errors, ensure_ascii=False)), status=status.HTTP_400_BAD_REQUEST)
    # elif request.method == 'POST':
    #     serializer = PostUserSerializer(data=request.data)
    #     if serializer.is_valid():
    #         result = serializer.update_user(serializer.validated_data)
    #         return Response(result, status=status.HTTP_201_CREATED)
    #     return Response(dict(error_code=ErrorCode.参数错误.value, error=json.dumps(serializer.errors, ensure_ascii=False)), status=status.HTTP_400_BAD_REQUEST)
```

到目前为止，我们已经完成了一个简单接口的创建，接下来可以对项目进行测试

#### 4. 测试我们的Web API。首先启动一个开发服务器，之后在浏览器里输入地址访问我们的接口。

启动开发服务器

```
python manage.py runserver

Validating models...

0 errors found
Django version 2.0, using settings 'attendances.settings'
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
```

在浏览器里输入接口地址，获取到接口数据：<http://127.0.0.1:8000/api/v1/user/?token=21cd4161-2a78-451e-8979-5fbd8538935e&user_id=4>

```
GET /api/v1/user/?token=21cd4161-2a78-451e-8979-5fbd8538935e&user_id=4
```

```
HTTP 201 Created
Allow: POST, GET, OPTIONS
Content-Type: application/json
Vary: Accept

{
    "nick_name": "Band",
    "avatar": "http://wx.qlogo.cn/mmopen/vi_32/aSKcBBPpibyKNicHNTMM0qJVh8Kjgiak2AHWr8MHM4WgMEm7GFhsf8OYrySdbvAMvTsw3mo8ibKicsnfN5pRjl1p8HQ/0",
    "error_code": 0,
    "error": ""
}
```

### 二、相关问题说明

#### 1. 在配置文件里记得修改成本地时区以及将语言设置成中文。

```
LANGUAGE_CODE = 'zh-Hans'
TIME_ZONE = 'Asia/Shanghai'
```

#### 2. 在安装python3之后，使用pip安装依赖的时候记得使用pip3,或者改掉python和pip的。

```
$ alias python='/usr/bin/python3'
```

�为了不混淆项目，并且大家在项目中遇到的问题可能各不一样，暂时不列出更多的问题，如果有疑问可以�留言。

## 第二部分 部署流程以及问题说明

部署的时候建议大家安装docker容器，如果你没有太多的时间了解docker，可以先不用安装，直接按下面的流程去部署，部署的方式都是一样的，只是运行的地方不一样而已。这里就不列出docker的安装以及使用了。

### 一、部署步骤

#### 1. 安装python3

首先安装依赖包。libxml模块是为了让uwsig支持使用“-x"选项，能通过xml文件启动项目

```
$ yum gcc-c++
$ yum install wget openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel
$ yum install libxml*
```

下载python3的压缩包之后，解压并安装到/usr/local/python3/路径下，ln命令是为了方便在终端中直接使用python3和pip3命令。

```
$ wget https://www.python.org/ftp/python/3.6.3/Python-3.6.3.tgz
$ tar -zxvf Python-3.6.3.tar.gz
$ ./configure --prefix=/usr/local/python3
$ make -j2
$ make install -j2
$ ln -s /usr/local/python3/bin/python3.5 /usr/bin/python3
$ ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
```

#### 2. 安装uWsgi

```
$ pip3 install uwsgi
```

为了在终端中使用uwsgi命令，执行以下命令

```
$ ln -s /usr/local/python3/bin/uwsgi /usr/bin/uwsgi3
```

编写一个简单的wsgi应用测试uwsgi是否能正常使用,创建一个test.py文件。

```
# test.py
def application(env, start_response):
    start_response('200 OK', [('Content-Type','text/html')])
    return [b"Hello World"] # python3
```

运行uwsgi,http :8000表示使用http协议，端口号为8000，wigi-file则表示要运行的wsgi应用程序文件。

```
# test.py
$ uwsgi --http :8000 --wsgi-file test.py
```

uwsgi运行后打开浏览器，访问<http://127.0.0.1:8000/> ，或者是相应服务器地址的8000端口，就可以看到hello world 页面了。

#### 3. 安装Django以及项目依赖，通过uWsgi测试项目是否能正常运行

安装依赖

```
$ pip3 install django
$ pip3 install djangorestframework
$ pip3 install pycrypto
```

�Django通过uWsgi测试，如果能正常浏览则运行成功，静态文件无法访问的话，我们这里先忽略，后面会通过Nginx配置静态资源访问

#### 4. 安装MySQL,也可以直接使用SQLite或PostgreSQL、Oracle数据库，Django支持多种数据库，根据配置安装不同的驱动，本项目采用MySQL，数据表结构以及链接配置请参考文档

```
$ pip3 install mysql
$ pip3 install mysql-server
$ pip3 install mysql-devel
```

MySQL的安装可以参考文档：[MySQL 安装 | 菜鸟教程](http://www.runoob.com/mysql/mysql-install.html)

#### 5. 连接uwsgi与Django

该步骤只是检测Django项目能否在uwsgi下运行，下面我们将配置xml的启动配置文件

```
$ uwsgi3 --http :8000 --module attendances.wsgi
```

xml的启动配置文件

```
<uwsgi>
    <socket>127.0.0.1:8000</socket><!-- 内部端口，自定义 -->
        <chdir>/root/web/attendances/attendances</chdir><!-- 项目路径 -->
            <module>attendances.wsgi</module>
                <processes>4</processes> <!-- 进程数 -->
    <daemonize>uwsgi.log</daemonize><!-- 日志文件 -->
</uwsgi>
```

进入项目执行以下命令

```
$ uwsgi3 -x attendances.xml
```

#### 6. 安装nginx

```
$ wget http://nginx.org/download/nginx-1.13.7.tar.gz
$ tar -zxvf nginx-1.13.7.tar.gz
$ ./configure
$ make
$ make install
$ nginx
```

通过链接查看nginx是否启动成功:<http://192.168.2.110>

#### 6. 通过配置nginx.conf文件连接Django、uWsgi与Nginx

在/etc/nginx/nginx.conf修改nginx.conf

```
    server {
        listen       80 default_server;#暴露给外部访问的端口
        listen       [::]:80 default_server;
        server_name  127.0.0.1;
	    index  index.py index.html;
        root         /root/web/attendances/attendances;

        location / {
            include uwsgi_params;
            uwsgi_pass 127.0.0.1:8000;#外部访问80就转发到内部8000
        }

    	location /static/ {
            alias /root/web/attendances/attendances/static/;#项目静态路径设置
    	}
    }
```

保存nginx.conf执行nginx -t命令先检查配置文件是否有错，没有错就执行以下命令：nginx启动nginx，可以通过链接查看nginx是否启动成功,之前启动过的话重启nginx.
重启nginx

```
$ nginx -t
$ nginx -s reload
```

以上步骤都没有出错的话，打开你的浏览器，输入以下链接，记得关闭系统防火墙或者开放8000端口
<http://192.168.2.110/api/v1/user/?token=21cd4161-2a78-451e-8979-5fbd8538935e&user_id=4> （请将该ip替换成你的服务器ip）
网站访问成功！

### 二、相关问题说明

#### 1. Nginx和Django静态文件处理

Django项目可以正常打开，但是静态文件引用路径还有问题，在Django开发时Django自己可以正确处理静态文件的路径，但是部署后Nginx去无法找到静态文件路径。

检查Nginx配置文件夹sites-enabled里的nginx-pro文件，确保里面默认的try\_files要删掉或者注释掉，否则Nginx会因此检查静态文件是否存在。

将Django的静态文件集中起来，Django为此有专门的工具

现在Django的Settings文件中加上StATIC\_ROOT，把静态文件都集中到这个路径下

```
STATIC_ROOT = os.path.join(BASE_DIR, "static/")
```

执行命令

```
$ python3 ./manage.py collectstatic
```

这样所有Django前后台的静态文件都会集中到项目文件夹pro下static中，另外nginx-pro其中一个配置location /static即可让Nginx来处理静态内容。

#### 2. Nginx权限问题(Nginx 403 forbidden)

如果nginx用户没有web目录的权限，则会导致该错误。解决办法：修改web目录的读写权限。或者是把nginx的启动用户改成目录的所属用户，重起一下就能解决，在nginx.conf头部加入一行：user root;因为项目是在root用户下建立的，通过这个用户去访问资源就可以访问。

```
chmod -R 766 /web
```

#### 3. Nginx转发出现错误(502 BAD GATEWAY)

```
$ setsebool -P httpd_can_network_connect 1
```
> 如果访问不了可以查看Nginx下的error.log文件，查看具体的问题，再找解决方法。

## 分享一些中文文档资料

> 有关Python、Django以及Django REST FrameWork的学习可以参考官方文档，以及以下中文文档，在网上找了很久，感觉以下这几个中文文档还是写的很不错的。

[**Python：** 廖雪峰老师Python教程，基于最新的Python 3版本](https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000)

[**Django：** The Django Book 2.0--中文版](http://docs.30c.org/djangobook2/index.html)

[**Django REST FrameWork：** Django REST FrameWork中文文档目录](http://www.chenxm.cc/post/299.html)

## About

Python3 开发以及部署 RESTful API项目（Python3 + Django2.0 + Django REST FrameWork + Centos7 + uWsgi + Nginx）

### Resources

[Readme](#readme-ov-file)

[Activity](/herry-zhang/Python3-RESTfulAPI/activity)
### Stars

[**161**
stars](/herry-zhang/Python3-RESTfulAPI/stargazers)
### Watchers

[**16**
watching](/herry-zhang/Python3-RESTfulAPI/watchers)
### Forks

[**72**
forks](/herry-zhang/Python3-RESTfulAPI/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI&report=herry-zhang+%28user%29)

## [Releases](/herry-zhang/Python3-RESTfulAPI/releases)

No releases published

## [Packages 0](/users/herry-zhang/packages?repo_name=Python3-RESTfulAPI)

No packages published

## Languages

* [Python
  100.0%](/herry-zhang/Python3-RESTfulAPI/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_62ad7df3_20250115_084517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2Fcommit%2F1c2081dca357685b3180b9baeb7e761e9a10ca99)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2Fcommit%2F1c2081dca357685b3180b9baeb7e761e9a10ca99)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=herry-zhang%2FPython3-RESTfulAPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[herry-zhang](/herry-zhang)
/
**[Python3-RESTfulAPI](/herry-zhang/Python3-RESTfulAPI)**
Public

* [Notifications](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI) You must be signed in to change notification settings
* [Fork
  72](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)
* [Star
   161](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests
  0](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects
  0](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

Additional navigation options

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

## Commit

[Permalink](/herry-zhang/Python3-RESTfulAPI/commit/1c2081dca357685b3180b9baeb7e761e9a10ca99)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Create SECURITY.md

[Browse files](/herry-zhang/Python3-RESTfulAPI/tree/1c2081dca357685b3180b9baeb7e761e9a10ca99)
Browse the repository at this point in the history

* Loading branch information

[![@di1l0o](https://avatars.githubusercontent.com/u/58363074?s=40&v=4)](/di1l0o)

[di1l0o](/herry-zhang/Python3-RESTfulAPI/commits?author=di1l0o "View all commits by di1l0o")
authored
Nov 26, 2022

1 parent
[e772e0b](/herry-zhang/Python3-RESTfulAPI/commit/e772e0beee284c50946e94c54a1d43071ca78b74)

commit 1c2081d

Showing
**1 changed file**
with
**23 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

23 changes: 23 additions & 0 deletions

23
[SECURITY.md](#diff-f6ed156e4bf5c791680662464b94ea5d753f219ee816b385f67870e2c0d7d4c7 "SECURITY.md")

Show comments

[View file](/herry-zhang/Python3-RESTfulAPI/blob/1c2081dca357685b3180b9baeb7e761e9a10ca99/SECURITY.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,23 @@ |
|  |  | We discovered a malicious backdoor in the project's dependencies, affected versions are d9907f14e9e25dcdb54f5b22252b0e9452e3970e~e772e0beee284c50946e94c54a1d43071ca78b74. Its malicious backdoor is the request package, the requirements.txt file has a dependency request. |
|  |  |  |
|  |  | ![image](https://user-images.githubusercontent.com/58363074/204091407-7ced9bc8-760c-404a-aa18-bef499a6fa46.png) |
|  |  |  |
|  |  | Even if the request has been deleted by PyPI, many mirror sites have not completely deleted this package, so it can still be installed. For example: https://mirrors.neusoft.edu.cn/pypi/web/simple/request/ |
|  |  |  |
|  |  | Using such a mirror site to download and install this item will be vulnerable. |
|  |  |  |
|  |  | ![image](https://user-images.githubusercontent.com/58363074/204091429-9b955400-08dd-419e-9bf3-5e6c16edceab.png) |
|  |  |  |
|  |  | Analysis of malicious function of request package: |
|  |  | 1.Remote download of malicious code |
|  |  | When the request package is installed, the setup.py file in the package will be actively executed. The setup.py file contains the logic for the attacker to remotely download and execute malicious code. At the same time, the C2 domain name is encoded and obfuscated. The decrypted C2 address is: https://dexy.top/request/check.so. |
|  |  | 2.Release the remote control Trojan and persist it |
|  |  | The malicious code loaded remotely during the installation of the request package includes two functions: |
|  |  | Release the remote control Trojan to the .uds folder of the current user's HOME directory. The Trojan name is \_err.log (for example, /root/.uds/\_err.log). The content of the \_err.log remote control Trojan script is encoded and compressed by base64, which reduces the size and enhances the confrontation. |
|  |  | Implant malicious backdoor commands in .bashrc to achieve persistence |
|  |  | 3.Issue stealing instructions |
|  |  | The attacker issues python secret stealing instructions through the remote control Trojan to steal sensitive information (coinbase account secret) |
|  |  | After decrypting the stealing instruction, the function is to request the C2 service: http://dexy.top/x.pyx, and remotely load the stealing Trojan. |
|  |  | Some of the functions of the remotely loaded secret stealing Trojan are shown below, which are used to steal browser cookies, coinbase accounts and passwords, etc. |
|  |  |  |
|  |  | Repair suggestion: replace request in requirements.txt with requests |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1c2081d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2Fcommit%2F1c2081dca357685b3180b9baeb7e761e9a10ca99) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b761532e_20250115_084514.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2Fblob%2F1c2081dca357685b3180b9baeb7e761e9a10ca99%2FSECURITY.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fherry-zhang%2FPython3-RESTfulAPI%2Fblob%2F1c2081dca357685b3180b9baeb7e761e9a10ca99%2FSECURITY.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=herry-zhang%2FPython3-RESTfulAPI)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[herry-zhang](/herry-zhang)
/
**[Python3-RESTfulAPI](/herry-zhang/Python3-RESTfulAPI)**
Public

* [Notifications](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI) You must be signed in to change notification settings
* [Fork
  72](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)
* [Star
   161](/login?return_to=%2Fherry-zhang%2FPython3-RESTfulAPI)

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests
  0](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects
  0](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

Additional navigation options

* [Code](/herry-zhang/Python3-RESTfulAPI)
* [Pull requests](/herry-zhang/Python3-RESTfulAPI/pulls)
* [Actions](/herry-zhang/Python3-RESTfulAPI/actions)
* [Projects](/herry-zhang/Python3-RESTfulAPI/projects)
* [Security](/herry-zhang/Python3-RESTfulAPI/security)
* [Insights](/herry-zhang/Python3-RESTfulAPI/pulse)

## Files

 1c2081d
## Breadcrumbs

1. [Python3-RESTfulAPI](/herry-zhang/Python3-RESTfulAPI/tree/1c2081dca357685b3180b9baeb7e761e9a10ca99)
/
# SECURITY.md

Copy path Blame  Blame
## Latest commit

## History

[History](/herry-zhang/Python3-RESTfulAPI/commits/1c2081dca357685b3180b9baeb7e761e9a10ca99/SECURITY.md)23 lines (17 loc) · 2.24 KB 1c2081d
## Breadcrumbs

1. [Python3-RESTfulAPI](/herry-zhang/Python3-RESTfulAPI/tree/1c2081dca357685b3180b9baeb7e761e9a10ca99)
/
# SECURITY.md

Top
## File metadata and controls

* Preview
* Code
* Blame

23 lines (17 loc) · 2.24 KB[Raw](https://github.com/herry-zhang/Python3-RESTfulAPI/raw/1c2081dca357685b3180b9baeb7e761e9a10ca99/SECURITY.md)

We discovered a malicious backdoor in the project's dependencies, affected versions are d9907f14e9e25dcdb54f5b22252b0e9452e3970e~e772e0beee284c50946e94c54a1d43071ca78b74. Its malicious backdoor is the request package, the requirements.txt file has a dependency request.

[![image](https://user-images.githubusercontent.com/58363074/204091407-7ced9bc8-760c-404a-aa18-bef499a6fa46.png)](https://user-images.githubusercontent.com/58363074/204091407-7ced9bc8-760c-404a-aa18-bef499a6fa46.png)

Even if the request has been deleted by PyPI, many mirror sites have not completely deleted this package, so it can still be installed. For example: <https://mirrors.neusoft.edu.cn/pypi/web/simple/request/>

Using such a mirror site to download and install this item will be vulnerable.

[![image](https://user-images.githubusercontent.com/58363074/204091429-9b955400-08dd-419e-9bf3-5e6c16edceab.png)](https://user-images.githubusercontent.com/58363074/204091429-9b955400-08dd-419e-9bf3-5e6c16edceab.png)

Analysis of malicious function of request package:
1.Remote download of malicious code
When the request package is installed, the setup.py file in the package will be actively executed. The setup.py file contains the logic for the attacker to remotely download and execute malicious code. At the same time, the C2 domain name is encoded and obfuscated. The decrypted C2 address is: <https://dexy.top/request/check.so>.
2.Release the remote control Trojan and persist it
The malicious code loaded remotely during the installation of the request package includes two functions:
Release the remote control Trojan to the .uds folder of the current user's HOME directory. The Trojan name is \_err.log (for example, /root/.uds/\_err.log). The content of the \_err.log remote control Trojan script is encoded and compressed by base64, which reduces the size and enhances the confrontation.
Implant malicious backdoor commands in .bashrc to achieve persistence
3.Issue stealing instructions
The attacker issues python secret stealing instructions through the remote control Trojan to steal sensitive information (coinbase account secret)
After decrypting the stealing instruction, the function is to request the C2 service: <http://dexy.top/x.pyx>, and remotely load the stealing Trojan.
Some of the functions of the remotely loaded secret stealing Trojan are shown below, which are used to steal browser cookies, coinbase accounts and passwords, etc.

Repair suggestion: replace request in requirements.txt with requests

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mirrors.neusoft.edu.cn_b0adbcf2_20250115_084519.html ===

# Links for request

[request-1.0.115.tar.gz](../../packages/5c/47/2b77fbe7ff788b187216674a26f82620d91be83704a63c3a3313d3240965/request-1.0.115.tar.gz#sha256=5936c8b22ebec6543335decd2d4a62f8110644aa43da41acf0a3c96a8cd52829)

[request-1.0.116.tar.gz](../../packages/35/ed/761410efea5650806d5e1e2197de90c9e908fd7a0a9ac9735fc6452b62ac/request-1.0.116.tar.gz#sha256=e08e144cdba2ac23fc4e1f6281343cb80897f741a37ff1ba9ce2f2ed482c7df2)

[request-1.0.117.tar.gz](../../packages/67/fc/30193d66338a12cc1389e799a4fa27d29763cb075ced80fa2be9b2571224/request-1.0.117.tar.gz#sha256=d3d6ee424126c20998ef48d9cb9c240f1ff860019d3af63e63754a16acc90d9f)


