=== Content from github.com_0862d448_20250115_084109.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Freleases%2Ftag%2Fv2.9.6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Freleases%2Ftag%2Fv2.9.6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=traefik%2Ftraefik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[traefik](/traefik)
/
**[traefik](/traefik/traefik)**
Public

* [Notifications](/login?return_to=%2Ftraefik%2Ftraefik) You must be signed in to change notification settings
* [Fork
  5.2k](/login?return_to=%2Ftraefik%2Ftraefik)
* [Star
   52.7k](/login?return_to=%2Ftraefik%2Ftraefik)

* [Code](/traefik/traefik/tree/v2.9.6)
* [Issues
  615](/traefik/traefik/issues)
* [Pull requests
  32](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects
  0](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

Additional navigation options

* [Code](/traefik/traefik/tree/v2.9.6)
* [Issues](/traefik/traefik/issues)
* [Pull requests](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

1. [Releases](/traefik/traefik/releases)
2. [v2.9.6](/traefik/traefik/releases/tag/v2.9.6)

# v2.9.6

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/traefik/traefik/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.9.6)

 Loading

[View all tags](/traefik/traefik/tags)

![@traefiker](https://avatars.githubusercontent.com/u/30906710?s=40&v=4)
[traefiker](/traefiker)
released this
07 Dec 14:45

¬∑
[840 commits](/traefik/traefik/compare/v2.9.6...master)
to master
since this release

[v2.9.6](/traefik/traefik/tree/v2.9.6)

[`d97d3a6`](/traefik/traefik/commit/d97d3a6726ad6e50110dd2ff2b552a8b17eeed55)

This commit was created on GitHub.com and signed with GitHub‚Äôs **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

**CVEs:**

* <https://www.cve.org/CVERecord?id=CVE-2022-23469>
* <https://www.cve.org/CVERecord?id=CVE-2022-46153>
* <https://www.cve.org/CVERecord?id=CVE-2022-41717>

**Bug fixes:**

* **[acme]** Update go-acme/lego to v4.9.1 ([#9550](https://github.com/traefik/traefik/pull/9550) by [@ldez](https://github.com/ldez))
* **[k8s/crd]** Support of allowEmptyServices in TraefikService ([#9424](https://github.com/traefik/traefik/pull/9424) by [@jeromeguiard](https://github.com/jeromeguiard))
* **[logs]** Remove logs of the request ([#9574](https://github.com/traefik/traefik/pull/9574) by [@ldez](https://github.com/ldez))
* **[plugins]** Increase the timeout on plugin download ([#9529](https://github.com/traefik/traefik/pull/9529) by [@ldez](https://github.com/ldez))
* **[server]** Update golang.org/x/net ([#9582](https://github.com/traefik/traefik/pull/9582) by [@ldez](https://github.com/ldez))
* **[tls]** Handle broken TLS conf better ([#9572](https://github.com/traefik/traefik/pull/9572) by [@mpl](https://github.com/mpl))
* **[tracing]** Update DataDog tracing dependency to v1.43.1 ([#9526](https://github.com/traefik/traefik/pull/9526) by [@rtribotte](https://github.com/rtribotte))
* **[webui]** Add missing serialNumber passTLSClientCert option to middleware panel ([#9539](https://github.com/traefik/traefik/pull/9539) by [@rtribotte](https://github.com/rtribotte))

**Documentation:**

* **[docker]** Add networking example ([#9542](https://github.com/traefik/traefik/pull/9542) by [@janik](https://github.com/janik))
* **[hub]** Add information about the Hub Agent ([#9560](https://github.com/traefik/traefik/pull/9560) by [@nmengin](https://github.com/nmengin))
* **[k8s/helm]** Update Helm installation section ([#9564](https://github.com/traefik/traefik/pull/9564) by [@mloiseleur](https://github.com/mloiseleur))
* **[middleware]** Clarify PathPrefix matcher greediness ([#9519](https://github.com/traefik/traefik/pull/9519) by [@mpl](https://github.com/mpl))

### Contributors

* [![@janik](https://avatars.githubusercontent.com/u/345564?s=64&v=4)](https://github.com/janik)
* [![@jeromeguiard](https://avatars.githubusercontent.com/u/555535?s=64&v=4)](https://github.com/jeromeguiard)
* [![@mpl](https://avatars.githubusercontent.com/u/626071?s=64&v=4)](https://github.com/mpl)
* [![@ldez](https://avatars.githubusercontent.com/u/5674651?s=64&v=4)](https://github.com/ldez)
* [![@nmengin](https://avatars.githubusercontent.com/u/6430748?s=64&v=4)](https://github.com/nmengin)
* [![@rtribotte](https://avatars.githubusercontent.com/u/13045437?s=64&v=4)](https://github.com/rtribotte)
* [![@mloiseleur](https://avatars.githubusercontent.com/u/97035654?s=64&v=4)](https://github.com/mloiseleur)

janik, jeromeguiard, and 5 other contributors

 Assets
20

 Loading

 üëç
1
 edwinakatosh reacted with thumbs up emoji
 ‚ù§Ô∏è
1
 huynhit24 reacted with heart emoji
 üöÄ
7
 benscobie, jakubhajek, Gruak, mariopaolo, mritzmann, xaabi6, and DimitriDR reacted with rocket emoji

All reactions

* üëç
  1 reaction
* ‚ù§Ô∏è
  1 reaction
* üöÄ
  7 reactions

 9 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_5f858cd8_20250115_084112.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Fsecurity%2Fadvisories%2FGHSA-468w-8x39-gj5v)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Fsecurity%2Fadvisories%2FGHSA-468w-8x39-gj5v)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=traefik%2Ftraefik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[traefik](/traefik)
/
**[traefik](/traefik/traefik)**
Public

* [Notifications](/login?return_to=%2Ftraefik%2Ftraefik) You must be signed in to change notification settings
* [Fork
  5.2k](/login?return_to=%2Ftraefik%2Ftraefik)
* [Star
   52.7k](/login?return_to=%2Ftraefik%2Ftraefik)

* [Code](/traefik/traefik)
* [Issues
  615](/traefik/traefik/issues)
* [Pull requests
  32](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects
  0](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

Additional navigation options

* [Code](/traefik/traefik)
* [Issues](/traefik/traefik/issues)
* [Pull requests](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

# Routes exposed with an empty TLSOption

High

[ldez](/ldez)
published
GHSA-468w-8x39-gj5v
Dec 8, 2022

## Package

No package listed

## Affected versions

< 2.9.6

## Patched versions

2.9.6

## Description

## Impact

There is a potential vulnerability in Traefik managing the TLS connections.

A router configured with a not well-formatted [TLSOption](https://doc.traefik.io/traefik/v2.9/https/tls/#tls-options) is exposed with an empty TLSOption.

For instance, a route secured using an mTLS connection set with a wrong CA file is exposed without verifying the client certificates.

## Patches

<https://github.com/traefik/traefik/releases/tag/v2.9.6>

## Workarounds

Check the logs to detect the following error messages and fix your TLS options:

* Empty CA:

```
{"level":"error","msg":"invalid clientAuthType: RequireAndVerifyClientCert, CAFiles is required","routerName":"Router0@file"}

```

* Bad CA content (or bad path):

```
{"level":"error","msg":"invalid certificate(s) content","routerName":"Router0@file"}

```

* Unknown Client Auth Type:

```
{"level":"error","msg":"unknown client auth type \"FooClientAuthType\"","routerName":"Router0@file"}

```

* Invalid cipherSuites

```
{"level":"error","msg":"invalid CipherSuite: foobar","routerName":"Router0@file"}

```

* Invalid curvePreferences

```
{"level":"error","msg":"invalid CurveID in curvePreferences: foobar","routerName":"Router0@file"}

```
## For more information

If you have any questions or comments about this advisory, please [open an issue](https://github.com/traefik/traefik/issues).

### Severity

High

### CVE ID

CVE-2022-46153

### Weaknesses

No CWEs

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_74c8d416_20250115_084106.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Fcommit%2F7e3fe48b80083b41e9ff82a474a36484cabc701a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Fcommit%2F7e3fe48b80083b41e9ff82a474a36484cabc701a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=traefik%2Ftraefik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[traefik](/traefik)
/
**[traefik](/traefik/traefik)**
Public

* [Notifications](/login?return_to=%2Ftraefik%2Ftraefik) You must be signed in to change notification settings
* [Fork
  5.2k](/login?return_to=%2Ftraefik%2Ftraefik)
* [Star
   52.7k](/login?return_to=%2Ftraefik%2Ftraefik)

* [Code](/traefik/traefik)
* [Issues
  615](/traefik/traefik/issues)
* [Pull requests
  32](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects
  0](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

Additional navigation options

* [Code](/traefik/traefik)
* [Issues](/traefik/traefik/issues)
* [Pull requests](/traefik/traefik/pulls)
* [Actions](/traefik/traefik/actions)
* [Projects](/traefik/traefik/projects)
* [Security](/traefik/traefik/security)
* [Insights](/traefik/traefik/pulse)

## Commit

[Permalink](/traefik/traefik/commit/7e3fe48b80083b41e9ff82a474a36484cabc701a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Handle broken TLS conf better

[Browse files](/traefik/traefik/tree/7e3fe48b80083b41e9ff82a474a36484cabc701a)
Browse the repository at this point in the history

```
Co-authored-by: Jean-Baptiste Doumenjou <925513+jbdoumenjou@users.noreply.github.com>
Co-authored-by: Romain <rtribotte@users.noreply.github.com>
```

* Loading branch information

[![@mpl](https://avatars.githubusercontent.com/u/626071?s=40&v=4)](/mpl) [![@jbdoumenjou](https://avatars.githubusercontent.com/u/925513?s=40&v=4)](/jbdoumenjou) [![@rtribotte](https://avatars.githubusercontent.com/u/13045437?s=40&v=4)](/rtribotte)

3 people

authored
Dec 6, 2022

1 parent
[778188e](/traefik/traefik/commit/778188ed34e886b55d1d5c3c669fce4cc49795ef)

commit 7e3fe48

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**402 additions**
and
**157 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* integration

  + fixtures

    - https

      * integration/fixtures/https/https\_invalid\_tls\_options.toml
        [https\_invalid\_tls\_options.toml](#diff-458babd47cd29710c89ea600f084a6ef22901d93b806c89a3cfba470fc6c661e)
    - tcp

      * integration/fixtures/tcp/multi-tls-options.toml
        [multi-tls-options.toml](#diff-ac1bf39969f1db3280aaf7f1a4e1959d401048285065ff563c75f4a5e2727625)
  + integration/https\_test.go
    [https\_test.go](#diff-0111541e844162228022e28ee518ce76ad49579d6a41d31df43370914c74e6a1)
  + integration/tcp\_test.go
    [tcp\_test.go](#diff-04d7461f77883dc67bbaeb7a0df150d5ce34146c0536ff7adb1f0c36d258a183)
* pkg

  + server

    - router

      * pkg/server/router/router.go
        [router.go](#diff-2e5095f4fe175468cd01c289c19b0a428422da49e8c91faab99aa80204f3858f)
      * pkg/server/router/router\_test.go
        [router\_test.go](#diff-7ebfb147619c8be1109e05ab9a04d99817ccb3fb1a9b289b2b1800c4d8974aea)
      * tcp

        + pkg/server/router/tcp/manager.go
          [manager.go](#diff-741364046c0c72420a03aa386d8ef60ce68d5b5e71ca6bb92c0e3b3969d66bad)
        + pkg/server/router/tcp/router.go
          [router.go](#diff-54b0e0f683f31c6684938b2a6e218d9f32939b02dc6ee727b52c890a1ac3b6b3)
    - pkg/server/routerfactory.go
      [routerfactory.go](#diff-0512f2f5a757e813f37b6df3a5a96e2ea337b3d17ffe65dcc2bd542804a681f9)
  + tls

    - pkg/tls/tlsmanager.go
      [tlsmanager.go](#diff-3f7f33621af8b7e588a5375221f22cf500b5d598ceb3f5fbb8be623c94defd41)
    - pkg/tls/tlsmanager\_test.go
      [tlsmanager\_test.go](#diff-06d8282dc3654b23b110f977d93a4fa6d9ce5f616d92e4bba6890c5f5d9589c0)

## There are no files selected for viewing

60 changes: 60 additions & 0 deletions

60
[integration/fixtures/https/https\_invalid\_tls\_options.toml](#diff-458babd47cd29710c89ea600f084a6ef22901d93b806c89a3cfba470fc6c661e "integration/fixtures/https/https_invalid_tls_options.toml")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/integration/fixtures/https/https_invalid_tls_options.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,60 @@ |
|  |  | [global] |
|  |  | checkNewVersion = false |
|  |  | sendAnonymousUsage = false |
|  |  |  |
|  |  | [log] |
|  |  | level = "DEBUG" |
|  |  |  |
|  |  | [entryPoints.websecure] |
|  |  | address = ":4443" |
|  |  |  |
|  |  | [api] |
|  |  | insecure = true |
|  |  |  |
|  |  | [providers.file] |
|  |  | filename = "{{ .SelfFilename }}" |
|  |  |  |
|  |  | ## dynamic configuration ## |
|  |  |  |
|  |  | [http.routers] |
|  |  |  |
|  |  | [http.routers.router1] |
|  |  | entryPoints = ["websecure"] |
|  |  | service = "service1" |
|  |  | rule = "Host(`snitest.com`)" |
|  |  | [http.routers.router1.tls] |
|  |  | options = "invalidTLSOptions" |
|  |  |  |
|  |  | [http.routers.router2] |
|  |  | entryPoints = ["websecure"] |
|  |  | service = "service1" |
|  |  | rule = "Host(`snitest.org`)" |
|  |  | [http.routers.router2.tls] |
|  |  |  |
|  |  | # fallback router |
|  |  | [http.routers.router3] |
|  |  | entryPoints = ["websecure"] |
|  |  | service = "service1" |
|  |  | rule = "Path(`/`)" |
|  |  | [http.routers.router3.tls] |
|  |  |  |
|  |  | [[http.services.service1.loadBalancer.servers]] |
|  |  | url = "http://127.0.0.1:9010" |
|  |  |  |
|  |  | [[tls.certificates]] |
|  |  | certFile = "fixtures/https/snitest.com.cert" |
|  |  | keyFile = "fixtures/https/snitest.com.key" |
|  |  |  |
|  |  | [[tls.certificates]] |
|  |  | certFile = "fixtures/https/snitest.org.cert" |
|  |  | keyFile = "fixtures/https/snitest.org.key" |
|  |  |  |
|  |  | [tls.options] |
|  |  |  |
|  |  | [tls.options.default.clientAuth] |
|  |  | # Missing caFile to have an invalid mTLS configuration. |
|  |  | clientAuthType = "RequireAndVerifyClientCert" |
|  |  |  |
|  |  | [tls.options.invalidTLSOptions.clientAuth] |
|  |  | # Missing caFile to have an invalid mTLS configuration. |
|  |  | clientAuthType = "RequireAndVerifyClientCert" |

11 changes: 11 additions & 0 deletions

11
[integration/fixtures/tcp/multi-tls-options.toml](#diff-ac1bf39969f1db3280aaf7f1a4e1959d401048285065ff563c75f4a5e2727625 "integration/fixtures/tcp/multi-tls-options.toml")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/integration/fixtures/tcp/multi-tls-options.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,13 @@ |
|  |  | [tcp.routers.to-whoami-sni-strict.tls] |
|  |  | options = "bar" |
|  |  |  |
|  |  | [tcp.routers.to-whoami-invalid-tls] |
|  |  | rule = "HostSNI(`whoami-i.test`)" |
|  |  | service = "whoami-no-cert" |
|  |  | entryPoints = [ "tcp" ] |
|  |  | [tcp.routers.to-whoami-invalid-tls.tls] |
|  |  | options = "invalid" |
|  |  |  |
|  |  | [tcp.services.whoami-no-cert] |
|  |  | [tcp.services.whoami-no-cert.loadBalancer] |
|  |  | [[tcp.services.whoami-no-cert.loadBalancer.servers]] |
| Expand All | | @@ -45,3 +52,7 @@ |
|  |  |  |
|  |  | [tls.options.bar] |
|  |  | minVersion = "VersionTLS13" |
|  |  |  |
|  |  | [tls.options.invalid.clientAuth] |
|  |  | # Missing CA files to have an invalid mTLS configuration. |
|  |  | clientAuthType = "RequireAndVerifyClientCert" |

50 changes: 50 additions & 0 deletions

50
[integration/https\_test.go](#diff-0111541e844162228022e28ee518ce76ad49579d6a41d31df43370914c74e6a1 "integration/https_test.go")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/integration/https_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1226,3 +1226,53 @@ func (s \*HTTPSSuite) TestWithDomainFronting(c \*check.C) { |
|  |  | c.Assert(err, checker.IsNil) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // TestWithInvalidTLSOption verifies the behavior when using an invalid tlsOption configuration. |
|  |  | func (s \*HTTPSSuite) TestWithInvalidTLSOption(c \*check.C) { |
|  |  | backend := startTestServer("9010", http.StatusOK, "server1") |
|  |  | defer backend.Close() |
|  |  |  |
|  |  | file := s.adaptFile(c, "fixtures/https/https\_invalid\_tls\_options.toml", struct{}{}) |
|  |  | defer os.Remove(file) |
|  |  | cmd, display := s.traefikCmd(withConfigFile(file)) |
|  |  | defer display(c) |
|  |  | err := cmd.Start() |
|  |  | c.Assert(err, checker.IsNil) |
|  |  | defer s.killCmd(cmd) |
|  |  |  |
|  |  | // wait for Traefik |
|  |  | err = try.GetRequest("http://127.0.0.1:8080/api/rawdata", 500\*time.Millisecond, try.BodyContains("Host(`snitest.com`)")) |
|  |  | c.Assert(err, checker.IsNil) |
|  |  |  |
|  |  | testCases := []struct { |
|  |  | desc string |
|  |  | serverName string |
|  |  | }{ |
|  |  | { |
|  |  | desc: "With invalid TLS Options specified", |
|  |  | serverName: "snitest.com", |
|  |  | }, |
|  |  | { |
|  |  | desc: "With invalid Default TLS Options", |
|  |  | serverName: "snitest.org", |
|  |  | }, |
|  |  | { |
|  |  | desc: "With TLS Options without servername (fallback to default)", |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | for \_, test := range testCases { |
|  |  | test := test |
|  |  |  |
|  |  | tlsConfig := &tls.Config{ |
|  |  | InsecureSkipVerify: true, |
|  |  | } |
|  |  | if test.serverName != "" { |
|  |  | tlsConfig.ServerName = test.serverName |
|  |  | } |
|  |  |  |
|  |  | conn, err := tls.Dial("tcp", "127.0.0.1:4443", tlsConfig) |
|  |  | c.Assert(err, checker.NotNil, check.Commentf("connected to server successfully")) |
|  |  | c.Assert(conn, checker.IsNil) |
|  |  | } |
|  |  | } |

8 changes: 8 additions & 0 deletions

8
[integration/tcp\_test.go](#diff-04d7461f77883dc67bbaeb7a0df150d5ce34146c0536ff7adb1f0c36d258a183 "integration/tcp_test.go")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/integration/tcp_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -116,6 +116,14 @@ func (s \*TCPSuite) TestTLSOptions(c \*check.C) { |
|  |  | \_, err = guessWhoTLSMaxVersion("127.0.0.1:8093", "whoami-d.test", true, tls.VersionTLS12) |
|  |  | c.Assert(err, checker.NotNil) |
|  |  | c.Assert(err.Error(), checker.Contains, "protocol version not supported") |
|  |  |  |
|  |  | // Check that we can't reach a route with an invalid mTLS configuration. |
|  |  | conn, err := tls.Dial("tcp", "127.0.0.1:8093", &tls.Config{ |
|  |  | ServerName: "whoami-i.test", |
|  |  | InsecureSkipVerify: true, |
|  |  | }) |
|  |  | c.Assert(conn, checker.IsNil) |
|  |  | c.Assert(err, checker.NotNil) |
|  |  | } |
|  |  |  |
|  |  | func (s \*TCPSuite) TestNonTLSFallback(c \*check.C) { |
| Expand Down | |  |

19 changes: 17 additions & 2 deletions

19
[pkg/server/router/router.go](#diff-2e5095f4fe175468cd01c289c19b0a428422da49e8c91faab99aa80204f3858f "pkg/server/router/router.go")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/pkg/server/router/router.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,6 +3,7 @@ package router |
|  |  | import ( |
|  |  | "context" |
|  |  | "errors" |
|  |  | "fmt" |
|  |  | "net/http" |
|  |  |  |
|  |  | "github.com/containous/alice" |
| Expand All | | @@ -16,6 +17,7 @@ import ( |
|  |  | httpmuxer "github.com/traefik/traefik/v2/pkg/muxer/http" |
|  |  | "github.com/traefik/traefik/v2/pkg/server/middleware" |
|  |  | "github.com/traefik/traefik/v2/pkg/server/provider" |
|  |  | "github.com/traefik/traefik/v2/pkg/tls" |
|  |  | ) |
|  |  |  |
|  |  | type middlewareBuilder interface { |
| Expand All | | @@ -35,17 +37,19 @@ type Manager struct { |
|  |  | middlewaresBuilder middlewareBuilder |
|  |  | chainBuilder \*middleware.ChainBuilder |
|  |  | conf \*runtime.Configuration |
|  |  | tlsManager \*tls.Manager |
|  |  | } |
|  |  |  |
|  |  | // NewManager Creates a new Manager. |
|  |  | func NewManager(conf \*runtime.Configuration, serviceManager serviceManager, middlewaresBuilder middlewareBuilder, chainBuilder \*middleware.ChainBuilder, metricsRegistry metrics.Registry) \*Manager { |
|  |  | // NewManager creates a new Manager. |
|  |  | func NewManager(conf \*runtime.Configuration, serviceManager serviceManager, middlewaresBuilder middlewareBuilder, chainBuilder \*middleware.ChainBuilder, metricsRegistry metrics.Registry, tlsManager \*tls.Manager) \*Manager { |
|  |  | return &Manager{ |
|  |  | routerHandlers: make(map[string]http.Handler), |
|  |  | serviceManager: serviceManager, |
|  |  | metricsRegistry: metricsRegistry, |
|  |  | middlewaresBuilder: middlewaresBuilder, |
|  |  | chainBuilder: chainBuilder, |
|  |  | conf: conf, |
|  |  | tlsManager: tlsManager, |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -141,6 +145,17 @@ func (m \*Manager) buildRouterHandler(ctx context.Context, routerName string, rou |
|  |  | return handler, nil |
|  |  | } |
|  |  |  |
|  |  | if routerConfig.TLS != nil { |
|  |  | // Don't build the router if the TLSOptions configuration is invalid. |
|  |  | tlsOptionsName := tls.DefaultTLSConfigName |
|  |  | if len(routerConfig.TLS.Options) > 0 && routerConfig.TLS.Options != tls.DefaultTLSConfigName { |
|  |  | tlsOptionsName = provider.GetQualifiedName(ctx, routerConfig.TLS.Options) |
|  |  | } |
|  |  | if \_, err := m.tlsManager.Get(tls.DefaultTLSStoreName, tlsOptionsName); err != nil { |
|  |  | return nil, fmt.Errorf("building router handler: %w", err) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | handler, err := m.buildHTTPHandler(ctx, routerConfig, routerName) |
|  |  | if err != nil { |
|  |  | return nil, err |
| Expand Down | |  |

88 changes: 81 additions & 7 deletions

88
[pkg/server/router/router\_test.go](#diff-7ebfb147619c8be1109e05ab9a04d99817ccb3fb1a9b289b2b1800c4d8974aea "pkg/server/router/router_test.go")

Show comments

[View file](/traefik/traefik/blob/7e3fe48b80083b41e9ff82a474a36484cabc701a/pkg/server/router/router_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,7 @@ import ( |
|  |  | "github.com/traefik/traefik/v2/pkg/server/middleware" |
|  |  | "github.com/traefik/traefik/v2/pkg/server/service" |
|  |  | "github.com/traefik/traefik/v2/pkg/testhelpers" |
|  |  | "github.com/traefik/traefik/v2/pkg/tls" |
|  |  | "github.com/traefik/traefik/v2/pkg/types" |
|  |  | ) |
|  |  |  |
| Expand Down  Expand Up | | @@ -317,8 +318,9 @@ func TestRouterManager\_Get(t \*testing.T) { |
|  |  | serviceManager := service.NewManager(rtConf.Services, nil, nil, roundTripperManager) |
|  |  | middlewaresBuilder := middleware.NewBuilder(rtConf.Middlewares, serviceManager, nil) |
|  |  | chainBuilder := middleware.NewChainBuilder(nil, nil, nil) |
|  |  | tlsManager := tls.NewManager() |
|  |  |  |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry()) |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry(), tlsManager) |
|  |  |  |
|  |  | handlers := routerManager.BuildHandlers(context.Background(), test.entryPoints, false) |
|  |  |  |
| Expand Down  Expand Up | | @@ -423,8 +425,9 @@ func TestAccessLog(t \*testing.T) { |
|  |  | serviceManager := service.NewManager(rtConf.Services, nil, nil, roundTripperManager) |
|  |  | middlewaresBuilder := middleware.NewBuilder(rtConf.Middlewares, serviceManager, nil) |
|  |  | chainBuilder := middleware.NewChainBuilder(nil, nil, nil) |
|  |  | tlsManager := tls.NewManager() |
|  |  |  |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry()) |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry(), tlsManager) |
|  |  |  |
|  |  | handlers := routerManager.BuildHandlers(context.Background(), test.entryPoints, false) |
|  |  |  |
| Expand Down  Expand Up | | @@ -462,6 +465,7 @@ func TestRuntimeConfiguration(t \*testing.T) { |
|  |  | serviceConfig map[string]\*dynamic.Service |
|  |  | routerConfig map[string]\*dynamic.Router |
|  |  | middlewareConfig map[string]\*dynamic.Middleware |
|  |  | tlsOptions map[string]tls.Options |
|  |  | expectedError int |
|  |  | }{ |
|  |  | { |
| Expand Down  Expand Up | | @@ -665,7 +669,6 @@ func TestRuntimeConfiguration(t \*testing.T) { |
|  |  | }, |
|  |  | expectedError: 1, |
|  |  | }, |
|  |  |  |
|  |  | { |
|  |  | desc: "Router with broken middleware", |
|  |  | serviceConfig: map[string]\*dynamic.Service{ |
| Expand Down  Expand Up | | @@ -696,8 +699,71 @@ func TestRuntimeConfiguration(t \*testing.T) { |
|  |  | }, |
|  |  | expectedError: 2, |
|  |  | }, |
|  |  | { |
|  |  | desc: "Router with broken tlsOption", |
|  |  | serviceConfig: map[string]\*dynamic.Service{ |
|  |  | "foo-service": { |
|  |  | LoadBalancer: &dynamic.ServersLoadBalancer{ |
|  |  | Servers: []dynamic.Server{ |
|  |  | { |
|  |  | URL: "http://127.0.0.1", |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | middlewareConfig: map[string]\*dynamic.Middleware{}, |
|  |  | routerConfig: map[string]\*dynamic.Router{ |
|  |  | "bar": { |
|  |  | EntryPoints: []string{"web"}, |
|  |  | Service: "foo-service", |
|  |  | Rule: "Host(`foo.bar`)", |
|  |  | TLS: &dynamic.RouterTLSConfig{ |
|  |  | Options: "broken-tlsOption", |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | tlsOptions: map[string]tls.Options{ |
|  |  | "broken-tlsOption": { |
|  |  | ClientAuth: tls.ClientAuth{ |
|  |  | ClientAuthType: "foobar", |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | expectedError: 1, |
|  |  | }, |
|  |  | { |
|  |  | desc: "Router with broken default tlsOption", |
|  |  | serviceConfig: map[string]\*dynamic.Service{ |
|  |  | "foo-service": { |
|  |  | LoadBalancer: &dynamic.ServersLoadBalancer{ |
|  |  | Servers: []dynamic.Server{ |
|  |  | { |
|  |  | URL: "http://127.0.0.1", |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | middlewareConfig: map[string]\*dynamic.Middleware{}, |
|  |  | routerConfig: map[string]\*dynamic.Router{ |
|  |  | "bar": { |
|  |  | EntryPoints: []string{"web"}, |
|  |  | Service: "foo-service", |
|  |  | Rule: "Host(`foo.bar`)", |
|  |  | TLS: &dynamic.RouterTLSConfig{}, |
|  |  | }, |
|  |  | }, |
|  |  | tlsOptions: map[string]tls.Options{ |
|  |  | "default": { |
|  |  | ClientAuth: tls.ClientAuth{ |
|  |  | ClientAuthType: "foobar", |
|  |  | }, |
|  |  | }, |
|  |  | }, |
|  |  | expectedError: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | for \_, test := range testCases { |
|  |  | test := test |
|  |  | t.Run(test.desc, func(t \*testing.T) { |
| Expand All | | @@ -711,17 +777,23 @@ func TestRuntimeConfiguration(t \*testing.T) { |
|  |  | Routers: test.routerConfig, |
|  |  | Middlewares: test.middlewareConfig, |
|  |  | }, |
|  |  | TLS: &dynamic.TLSConfiguration{ |
|  |  | Options: test.tlsOptions, |
|  |  | }, |
|  |  | }) |
|  |  |  |
|  |  | roundTripperManager := service.NewRoundTripperManager() |
|  |  | roundTripperManager.Update(map[string]\*dynamic.ServersTransport{"default@internal": {}}) |
|  |  | serviceManager := service.NewManager(rtConf.Services, nil, nil, roundTripperManager) |
|  |  | middlewaresBuilder := middleware.NewBuilder(rtConf.Middlewares, serviceManager, nil) |
|  |  | chainBuilder := middleware.NewChainBuilder(nil, nil, nil) |
|  |  | tlsManager := tls.NewManager() |
|  |  | tlsManager.UpdateConfigs(context.Background(), nil, test.tlsOptions, nil) |
|  |  |  |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry()) |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry(), tlsManager) |
|  |  |  |
|  |  | \_ = routerManager.BuildHandlers(context.Background(), entryPoints, false) |
|  |  | \_ = routerManager.BuildHandlers(context.Background(), entryPoints, true) |
|  |  |  |
|  |  | // even though rtConf was passed by argument to the manager builders above, |
|  |  | // it's ok to use it as the result we check, because everything worth checking |
| Expand Down  Expand Up | | @@ -793,8 +865,9 @@ func TestProviderOnMiddlewares(t \*testing.T) { |
|  |  | serviceManager := service.NewManager(rtConf.Services, nil, nil, roundTripperManager) |
|  |  | middlewaresBuilder := middleware.NewBuilder(rtConf.Middlewares, serviceManager, nil) |
|  |  | chainBuilder := middleware.NewChainBuilder(nil, nil, nil) |
|  |  | tlsManager := tls.NewManager() |
|  |  |  |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry()) |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry(), tlsManager) |
|  |  |  |
|  |  | \_ = routerManager.BuildHandlers(context.Background(), entryPoints, false) |
|  |  |  |
| Expand Down  Expand Up | | @@ -861,8 +934,9 @@ func BenchmarkRouterServe(b \*testing.B) { |
|  |  | serviceManager := service.NewManager(rtConf.Services, nil, nil, staticRoundTripperGetter{res}) |
|  |  | middlewaresBuilder := middleware.NewBuilder(rtConf.Middlewares, serviceManager, nil) |
|  |  | chainBuilder := middleware.NewChainBuilder(nil, nil, nil) |
|  |  | tlsManager := tls.NewManager() |
|  |  |  |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry()) |
|  |  | routerManager := NewManager(rtConf, serviceManager, middlewaresBuilder, chainBuilder, metrics.NewVoidRegistry(), tlsManager) |
|  |  |  |
|  |  | handlers := routerManager.BuildHandlers(context.Background(), entryPoints, false) |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7e3fe48`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftraefik%2Ftraefik%2Fcommit%2F7e3fe48b80083b41e9ff82a474a36484cabc701a) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from doc.traefik.io_b062121b_20250115_084101.html ===


[Skip to content](#tls)

Initializing search

![Traefik Proxy](../../assets/images/logo-traefik-proxy-logo.svg)
Product Documentation
![Traefik Hub](../../assets/images/traefik-hub-logo-white.svg)

[Traefik Hub
Kubernetes-Native API Management](https://doc.traefik.io/traefik-hub/)

![Traefik Enterprise](../../assets/images/traefik-enterprise-logo.svg)

[Traefik Enterprise
The API Gateway Cloud Natives Trust](https://doc.traefik.io/traefik-enterprise/)

Initializing search

[![logo](../../assets/img/traefikproxy-vertical-logo-color.svg)](../.. "Traefik")
Traefik

[GitHub](https://github.com/traefik/traefik/ "Go to repository")

* [Welcome](../..)
* Getting Started

  Getting Started
  + [Concepts](../../getting-started/concepts/)
  + Quick Start

    Quick Start
    - [Docker](../../getting-started/quick-start/)
    - [Kubernetes](../../getting-started/quick-start-with-kubernetes/)
  + [Configuration Introduction](../../getting-started/configuration-overview/)
  + [Install Traefik](../../getting-started/install-traefik/)
  + [Frequently Asked Questions](../../getting-started/faq/)
* Configuration Discovery

  Configuration Discovery
  + [Overview](../../providers/overview/)
  + [Docker](../../providers/docker/)
  + [Kubernetes IngressRoute](../../providers/kubernetes-crd/)
  + [Kubernetes Ingress](../../providers/kubernetes-ingress/)
  + [Kubernetes Gateway API](../../providers/kubernetes-gateway/)
  + [Consul Catalog](../../providers/consul-catalog/)
  + [Nomad](../../providers/nomad/)
  + [ECS](../../providers/ecs/)
  + [Marathon](../../providers/marathon/)
  + [Rancher](../../providers/rancher/)
  + [File](../../providers/file/)
  + [Consul](../../providers/consul/)
  + [Etcd](../../providers/etcd/)
  + [ZooKeeper](../../providers/zookeeper/)
  + [Redis](../../providers/redis/)
  + [HTTP](../../providers/http/)
* Routing & Load Balancing

  Routing & Load Balancing
  + [Overview](../../routing/overview/)
  + [EntryPoints](../../routing/entrypoints/)
  + [Routers](../../routing/routers/)
  + [Services](../../routing/services/)
  + Providers

    Providers
    - [Docker](../../routing/providers/docker/)
    - [Kubernetes IngressRoute](../../routing/providers/kubernetes-crd/)
    - [Kubernetes Ingress](../../routing/providers/kubernetes-ingress/)
    - [Kubernetes Gateway API](../../routing/providers/kubernetes-gateway/)
    - [Consul Catalog](../../routing/providers/consul-catalog/)
    - [Nomad](../../routing/providers/nomad/)
    - [ECS](../../routing/providers/ecs/)
    - [Marathon](../../routing/providers/marathon/)
    - [Rancher](../../routing/providers/rancher/)
    - [KV](../../routing/providers/kv/)
* HTTPS & TLS

  HTTPS & TLS
  + [Overview](../overview/)
  + TLS

    [TLS](./)

    Table of contents
    - [Certificates Definition](#certificates-definition)
      * [Automated](#automated)
      * [User defined](#user-defined)
    - [Certificates Stores](#certificates-stores)
      * [Default Certificate](#default-certificate)
      * [ACME Default Certificate](#acme-default-certificate)
    - [TLS Options](#tls-options)
      * [Minimum TLS Version](#minimum-tls-version)
      * [Maximum TLS Version](#maximum-tls-version)
      * [Cipher Suites](#cipher-suites)
      * [Curve Preferences](#curve-preferences)
      * [Strict SNI Checking](#strict-sni-checking)
      * [ALPN Protocols](#alpn-protocols)
      * [Client Authentication (mTLS)](#client-authentication-mtls)
  + [Let's Encrypt](../acme/)
* Middlewares

  Middlewares
  + [Overview](../../middlewares/overview/)
  + HTTP

    HTTP
    - [Overview](../../middlewares/http/overview/)
    - [AddPrefix](../../middlewares/http/addprefix/)
    - [BasicAuth](../../middlewares/http/basicauth/)
    - [Buffering](../../middlewares/http/buffering/)
    - [Chain](../../middlewares/http/chain/)
    - [CircuitBreaker](../../middlewares/http/circuitbreaker/)
    - [Compress](../../middlewares/http/compress/)
    - [ContentType](../../middlewares/http/contenttype/)
    - [DigestAuth](../../middlewares/http/digestauth/)
    - [Errors](../../middlewares/http/errorpages/)
    - [ForwardAuth](../../middlewares/http/forwardauth/)
    - [Headers](../../middlewares/http/headers/)
    - [IpWhitelist](../../middlewares/http/ipwhitelist/)
    - [InFlightReq](../../middlewares/http/inflightreq/)
    - [PassTLSClientCert](../../middlewares/http/passtlsclientcert/)
    - [RateLimit](../../middlewares/http/ratelimit/)
    - [RedirectRegex](../../middlewares/http/redirectregex/)
    - [RedirectScheme](../../middlewares/http/redirectscheme/)
    - [ReplacePath](../../middlewares/http/replacepath/)
    - [ReplacePathRegex](../../middlewares/http/replacepathregex/)
    - [Retry](../../middlewares/http/retry/)
    - [StripPrefix](../../middlewares/http/stripprefix/)
    - [StripPrefixRegex](../../middlewares/http/stripprefixregex/)
  + TCP

    TCP
    - [Overview](../../middlewares/tcp/overview/)
    - [InFlightConn](../../middlewares/tcp/inflightconn/)
    - [IpWhitelist](../../middlewares/tcp/ipwhitelist/)
* [Traefik Hub](../../traefik-hub/)
* [Plugins & Plugin Catalog](../../plugins/)
* Operations

  Operations
  + [CLI](../../operations/cli/)
  + [Dashboard](../../operations/dashboard/)
  + [API](../../operations/api/)
  + [Ping](../../operations/ping/)
* Observability

  Observability
  + [Logs](../../observability/logs/)
  + [Access Logs](../../observability/access-logs/)
  + Metrics

    Metrics
    - [Overview](../../observability/metrics/overview/)
    - [Datadog](../../observability/metrics/datadog/)
    - [InfluxDB](../../observability/metrics/influxdb/)
    - [InfluxDB2](../../observability/metrics/influxdb2/)
    - [Prometheus](../../observability/metrics/prometheus/)
    - [StatsD](../../observability/metrics/statsd/)
  + Tracing

    Tracing
    - [Overview](../../observability/tracing/overview/)
    - [Jaeger](../../observability/tracing/jaeger/)
    - [Zipkin](../../observability/tracing/zipkin/)
    - [Datadog](../../observability/tracing/datadog/)
    - [Instana](../../observability/tracing/instana/)
    - [Haystack](../../observability/tracing/haystack/)
    - [Elastic](../../observability/tracing/elastic/)
* User Guides

  User Guides
  + [Kubernetes and Let's Encrypt](../../user-guides/crd-acme/)
  + [gRPC Examples](../../user-guides/grpc/)
  + [Marathon](../../user-guides/marathon/)
  + Docker

    Docker
    - [Basic Example](../../user-guides/docker-compose/basic-example/)
    - HTTPS with Let's Encrypt

      HTTPS with Let's Encrypt
      * [TLS Challenge](../../user-guides/docker-compose/acme-tls/)
      * [HTTP Challenge](../../user-guides/docker-compose/acme-http/)
      * [DNS Challenge](../../user-guides/docker-compose/acme-dns/)
* Migration

  Migration
  + [Traefik v2 minor migrations](../../migration/v2/)
  + [Traefik v1 to v2](../../migration/v1-to-v2/)
* Contributing

  Contributing
  + [Thank You!](../../contributing/thank-you/)
  + [Submitting Issues](../../contributing/submitting-issues/)
  + [Submitting PRs](../../contributing/submitting-pull-requests/)
  + [Security](../../contributing/submitting-security-issues/)
  + [Building and Testing](../../contributing/building-testing/)
  + [Documentation](../../contributing/documentation/)
  + [Data Collection](../../contributing/data-collection/)
  + [Advocating](../../contributing/advocating/)
  + [Maintainers](../../contributing/maintainers/)
* References

  References
  + Static Configuration

    Static Configuration
    - [Overview](../../reference/static-configuration/overview/)
    - [File](../../reference/static-configuration/file/)
    - [CLI](../../reference/static-configuration/cli/)
    - [Environment variables](../../reference/static-configuration/env/)
  + Dynamic Configuration

    Dynamic Configuration
    - [File](../../reference/dynamic-configuration/file/)
    - [Docker](../../reference/dynamic-configuration/docker/)
    - [Kubernetes CRD](../../reference/dynamic-configuration/kubernetes-crd/)
    - [Kubernetes Gateway API](../../reference/dynamic-configuration/kubernetes-gateway/)
    - [Consul Catalog](../../reference/dynamic-configuration/consul-catalog/)
    - [Nomad](../../reference/dynamic-configuration/nomad/)
    - [ECS](../../reference/dynamic-configuration/ecs/)
    - [KV](../../reference/dynamic-configuration/kv/)
    - [Marathon](../../reference/dynamic-configuration/marathon/)
    - [Rancher](../../reference/dynamic-configuration/rancher/)
* Deprecation Notices

  Deprecation Notices
  + [Releases](../../deprecation/releases/)
  + [Features](../../deprecation/features/)

[GitHub](https://github.com/traefik/traefik/ "Go to repository")

Table of contents

* [Certificates Definition](#certificates-definition)
  + [Automated](#automated)
  + [User defined](#user-defined)
* [Certificates Stores](#certificates-stores)
  + [Default Certificate](#default-certificate)
  + [ACME Default Certificate](#acme-default-certificate)
* [TLS Options](#tls-options)
  + [Minimum TLS Version](#minimum-tls-version)
  + [Maximum TLS Version](#maximum-tls-version)
  + [Cipher Suites](#cipher-suites)
  + [Curve Preferences](#curve-preferences)
  + [Strict SNI Checking](#strict-sni-checking)
  + [ALPN Protocols](#alpn-protocols)
  + [Client Authentication (mTLS)](#client-authentication-mtls)

# TLS[¬∂](#tls "Permanent link")

Transport Layer Security

## Certificates Definition[¬∂](#certificates-definition "Permanent link")

### Automated[¬∂](#automated "Permanent link")

See the [Let's Encrypt](../acme/) page.

### User defined[¬∂](#user-defined "Permanent link")

To add / remove TLS certificates, even when Traefik is already running, their definition can be added to the [dynamic configuration](../../getting-started/configuration-overview/), in the `[[tls.certificates]]` section:

File (YAML)
```
# Dynamic configuration

tls:
  certificates:
    - certFile: /path/to/domain.cert
      keyFile: /path/to/domain.key
    - certFile: /path/to/other-domain.cert
      keyFile: /path/to/other-domain.key
```

File (TOML)
```
# Dynamic configuration

[[tls.certificates]]
  certFile = "/path/to/domain.cert"
  keyFile = "/path/to/domain.key"

[[tls.certificates]]
  certFile = "/path/to/other-domain.cert"
  keyFile = "/path/to/other-domain.key"
```

Restriction

In the above example, we've used the [file provider](../../providers/file/) to handle these definitions.
It is the only available method to configure the certificates (as well as the options and the stores).
However, in [Kubernetes](../../providers/kubernetes-crd/), the certificates can and must be provided by [secrets](https://kubernetes.io/docs/concepts/configuration/secret/).

## Certificates Stores[¬∂](#certificates-stores "Permanent link")

In Traefik, certificates are grouped together in certificates stores, which are defined as such:

File (YAML)
```
# Dynamic configuration

tls:
  stores:
    default: {}
```

File (TOML)
```
# Dynamic configuration

[tls.stores]
  [tls.stores.default]
```

Restriction

Any store definition other than the default one (named `default`) will be ignored,
and there is therefore only one globally available TLS store.

In the `tls.certificates` section, a list of stores can then be specified to indicate where the certificates should be stored:

File (YAML)
```
# Dynamic configuration

tls:
  certificates:
    - certFile: /path/to/domain.cert
      keyFile: /path/to/domain.key
      stores:
        - default
    # Note that since no store is defined,
    # the certificate below will be stored in the `default` store.
    - certFile: /path/to/other-domain.cert
      keyFile: /path/to/other-domain.key
```

File (TOML)
```
# Dynamic configuration

[[tls.certificates]]
  certFile = "/path/to/domain.cert"
  keyFile = "/path/to/domain.key"
  stores = ["default"]

[[tls.certificates]]
  # Note that since no store is defined,
  # the certificate below will be stored in the `default` store.
  certFile = "/path/to/other-domain.cert"
  keyFile = "/path/to/other-domain.key"
```

Restriction

The `stores` list will actually be ignored and automatically set to `["default"]`.

### Default Certificate[¬∂](#default-certificate "Permanent link")

Traefik can use a default certificate for connections without a SNI, or without a matching domain.
This default certificate should be defined in a TLS store:

File (YAML)
```
# Dynamic configuration

tls:
  stores:
    default:
      defaultCertificate:
        certFile: path/to/cert.crt
        keyFile: path/to/cert.key
```

File (TOML)
```
# Dynamic configuration

[tls.stores]
  [tls.stores.default]
    [tls.stores.default.defaultCertificate]
      certFile = "path/to/cert.crt"
      keyFile  = "path/to/cert.key"
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSStore
metadata:
  name: default
  namespace: default

spec:
  defaultCertificate:
    secretName: default-certificate

---
apiVersion: v1
kind: Secret
metadata:
  name: default-certificate
  namespace: default

type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=
```

If no `defaultCertificate` is provided, Traefik will use the generated one.

### ACME Default Certificate[¬∂](#acme-default-certificate "Permanent link")

You can configure Traefik to use an ACME provider (like Let's Encrypt) to generate the default certificate.
The configuration to resolve the default certificate should be defined in a TLS store:

Precedence with the `defaultGeneratedCert` option

The `defaultGeneratedCert` definition takes precedence over the ACME default certificate configuration.

File (YAML)
```
# Dynamic configuration

tls:
  stores:
    default:
      defaultGeneratedCert:
        resolver: myresolver
        domain:
          main: example.org
          sans:
            - foo.example.org
            - bar.example.org
```

File (TOML)
```
# Dynamic configuration

[tls.stores]
  [tls.stores.default.defaultGeneratedCert]
    resolver = "myresolver"
    [tls.stores.default.defaultGeneratedCert.domain]
      main = "example.org"
      sans = ["foo.example.org", "bar.example.org"]
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSStore
metadata:
  name: default
  namespace: default

spec:
  defaultGeneratedCert:
    resolver: myresolver
    domain:
      main: example.org
      sans:
        - foo.example.org
        - bar.example.org
```

Docker
```
## Dynamic configuration
labels:
  - "traefik.tls.stores.default.defaultgeneratedcert.resolver=myresolver"
  - "traefik.tls.stores.default.defaultgeneratedcert.domain.main=example.org"
  - "traefik.tls.stores.default.defaultgeneratedcert.domain.sans=foo.example.org, bar.example.org"
```

Marathon
```
labels: {
  "traefik.tls.stores.default.defaultgeneratedcert.resolver": "myresolver",
  "traefik.tls.stores.default.defaultgeneratedcert.domain.main": "example.org",
  "traefik.tls.stores.default.defaultgeneratedcert.domain.sans": "foo.example.org, bar.example.org",
}
```

## TLS Options[¬∂](#tls-options "Permanent link")

The TLS options allow one to configure some parameters of the TLS connection.

'default' TLS Option

The `default` option is special.
When no tls options are specified in a tls router, the `default` option is used.

When specifying the `default` option explicitly, make sure not to specify provider namespace as the `default` option does not have one.

Conversely, for cross-provider references, for example, when referencing the file provider from a docker label,
you must specify the provider namespace, for example:

`traefik.http.routers.myrouter.tls.options=myoptions@file`

TLSOption in Kubernetes

When using the [TLSOption resource](../../routing/providers/kubernetes-crd#kind-tlsoption) in Kubernetes, one might setup a default set of options that,
if not explicitly overwritten, should apply to all ingresses.

To achieve that, you'll have to create a TLSOption resource with the name `default`.
There may exist only one TLSOption with the name `default` (across all namespaces) - otherwise they will be dropped.

To explicitly use a different TLSOption (and using the Kubernetes Ingress resources)
you'll have to add an annotation to the Ingress in the following form:
`traefik.ingress.kubernetes.io/router.tls.options: <resource-namespace>-<resource-name>@kubernetescrd`

### Minimum TLS Version[¬∂](#minimum-tls-version "Permanent link")

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      minVersion: VersionTLS12

    mintls13:
      minVersion: VersionTLS13
```

File (TOML)
```
# Dynamic configuration

[tls.options]

  [tls.options.default]
    minVersion = "VersionTLS12"

  [tls.options.mintls13]
    minVersion = "VersionTLS13"
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  minVersion: VersionTLS12

---
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: mintls13
  namespace: default

spec:
  minVersion: VersionTLS13
```

### Maximum TLS Version[¬∂](#maximum-tls-version "Permanent link")

We discourage the use of this setting to disable TLS1.3.

The recommended approach is to update the clients to support TLS1.3.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      maxVersion: VersionTLS13

    maxtls12:
      maxVersion: VersionTLS12
```

File (TOML)
```
# Dynamic configuration

[tls.options]

  [tls.options.default]
    maxVersion = "VersionTLS13"

  [tls.options.maxtls12]
    maxVersion = "VersionTLS12"
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  maxVersion: VersionTLS13

---
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: maxtls12
  namespace: default

spec:
  maxVersion: VersionTLS12
```

### Cipher Suites[¬∂](#cipher-suites "Permanent link")

See [cipherSuites](https://godoc.org/crypto/tls#pkg-constants) for more information.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
```

File (TOML)
```
# Dynamic configuration

[tls.options]
  [tls.options.default]
    cipherSuites = [
      "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
    ]
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  cipherSuites:
    - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
```

TLS 1.3

Cipher suites defined for TLS 1.2 and below cannot be used in TLS 1.3, and vice versa. (<https://tools.ietf.org/html/rfc8446>)

With TLS 1.3, the cipher suites are not configurable (all supported cipher suites are safe in this case).
<https://golang.org/doc/go1.12#tls_1_3>

### Curve Preferences[¬∂](#curve-preferences "Permanent link")

This option allows to set the preferred elliptic curves in a specific order.

The names of the curves defined by [`crypto`](https://godoc.org/crypto/tls#CurveID) (e.g. `CurveP521`) and the [RFC defined names](https://tools.ietf.org/html/rfc8446#section-4.2.7) (e. g. `secp521r1`) can be used.

See [CurveID](https://godoc.org/crypto/tls#CurveID) for more information.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      curvePreferences:
        - CurveP521
        - CurveP384
```

File (TOML)
```
# Dynamic configuration

[tls.options]
  [tls.options.default]
    curvePreferences = ["CurveP521", "CurveP384"]
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  curvePreferences:
    - CurveP521
    - CurveP384
```

### Strict SNI Checking[¬∂](#strict-sni-checking "Permanent link")

With strict SNI checking enabled, Traefik won't allow connections from clients that do not specify a server\_name extension
or don't match any of the configured certificates.
The default certificate is irrelevant on that matter.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      sniStrict: true
```

File (TOML)
```
# Dynamic configuration

[tls.options]
  [tls.options.default]
    sniStrict = true
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  sniStrict: true
```

### ALPN Protocols[¬∂](#alpn-protocols "Permanent link")

*Optional, Default="h2, http/1.1, acme-tls/1"*

This option allows to specify the list of supported application level protocols for the TLS handshake,
in order of preference.
If the client supports ALPN, the selected protocol will be one from this list,
and the connection will fail if there is no mutually supported protocol.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      alpnProtocols:
        - http/1.1
        - h2
```

File (TOML)
```
# Dynamic configuration

[tls.options]
  [tls.options.default]
    alpnProtocols = ["http/1.1", "h2"]
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  alpnProtocols:
    - http/1.1
    - h2
```

### Client Authentication (mTLS)[¬∂](#client-authentication-mtls "Permanent link")

Traefik supports mutual authentication, through the `clientAuth` section.

For authentication policies that require verification of the client certificate, the certificate authority for the certificate should be set in `clientAuth.caFiles`.

The `clientAuth.clientAuthType` option governs the behaviour as follows:

* `NoClientCert`: disregards any client certificate.
* `RequestClientCert`: asks for a certificate but proceeds anyway if none is provided.
* `RequireAnyClientCert`: requires a certificate but does not verify if it is signed by a CA listed in `clientAuth.caFiles`.
* `VerifyClientCertIfGiven`: if a certificate is provided, verifies if it is signed by a CA listed in `clientAuth.caFiles`. Otherwise proceeds without any certificate.
* `RequireAndVerifyClientCert`: requires a certificate, which must be signed by a CA listed in `clientAuth.caFiles`.

File (YAML)
```
# Dynamic configuration

tls:
  options:
    default:
      clientAuth:
        # in PEM format. each file can contain multiple CAs.
        caFiles:
          - tests/clientca1.crt
          - tests/clientca2.crt
        clientAuthType: RequireAndVerifyClientCert
```

File (TOML)
```
# Dynamic configuration

[tls.options]
  [tls.options.default]
    [tls.options.default.clientAuth]
      # in PEM format. each file can contain multiple CAs.
      caFiles = ["tests/clientca1.crt", "tests/clientca2.crt"]
      clientAuthType = "RequireAndVerifyClientCert"
```

Kubernetes
```
apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: default
  namespace: default

spec:
  clientAuth:
    # the CA certificate is extracted from key `tls.ca` or `ca.crt` of the given secrets.
    secretNames:
      - secretCA
    clientAuthType: RequireAndVerifyClientCert
```

---

Using Traefik for Business Applications?

If you are using Traefik for commercial applications,
consider the [Enterprise Edition](https://traefik.io/traefik-enterprise/).
You can use it as your:

* [Kubernetes Ingress Controller](https://traefik.io/solutions/kubernetes-ingress/)
* [Docker Swarm Ingress Controller](https://traefik.io/solutions/docker-swarm-ingress/)
* [API Gateway](https://traefik.io/solutions/api-gateway/)

Traefik Enterprise enables centralized access management,
distributed Let's Encrypt,
and other advanced capabilities.
Learn more in [this 15-minute technical walkthrough](https://info.traefik.io/watch-traefikee-demo).

[Previous

Overview](../overview/)
[Next

Let's Encrypt](../acme/)

Traefik Labs ‚Ä¢ Copyright ¬© 2016-2023

Made with
[Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)


