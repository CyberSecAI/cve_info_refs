=== Content from github.com_88834a9b_20250114_200158.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcompare%2Fnagvis-1.9.33...nagvis-1.9.34)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcompare%2Fnagvis-1.9.33...nagvis-1.9.34)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=NagVis%2Fnagvis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[NagVis](/NagVis)
/
**[nagvis](/NagVis/nagvis)**
Public

* [Notifications](/login?return_to=%2FNagVis%2Fnagvis) You must be signed in to change notification settings
* [Fork
  74](/login?return_to=%2FNagVis%2Fnagvis)
* [Star
   116](/login?return_to=%2FNagVis%2Fnagvis)

* [Code](/NagVis/nagvis)
* [Issues
  62](/NagVis/nagvis/issues)
* [Pull requests
  11](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects
  0](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

Additional navigation options

* [Code](/NagVis/nagvis)
* [Issues](/NagVis/nagvis/issues)
* [Pull requests](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

[Permalink](https://github.com/NagVis/nagvis/compare/NagVis%3A53f44b7...NagVis%3A719f7d8)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
NagVis/nagvis

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
nagvis-1.9.33

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/NagVis/nagvis/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...nagvis-1.9.34)

Could not load tags

Nothing to show

[{{ refName }}
default](/NagVis/nagvis/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...nagvis-1.9.34)

 Loading

...

*head repository:*
NagVis/nagvis

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
nagvis-1.9.34

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/NagVis/nagvis/compare/nagvis-1.9.33...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/NagVis/nagvis/compare/nagvis-1.9.33...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

* 14

  commits
* 12

  files changed
* 4

  contributors

### Commits on May 23, 2022

1. [Set version 1.9.34](/NagVis/nagvis/commit/c92eec2c774fcf1c9c3dae86bf327c9a96c8c464)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   May 23, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/c92eec2c774fcf1c9c3dae86bf327c9a96c8c464)
   * Copy full SHA for c92eec2
   * [Browse repository at this point](/NagVis/nagvis/tree/c92eec2c774fcf1c9c3dae86bf327c9a96c8c464)

   Copy the full SHA

    [c92eec2](/NagVis/nagvis/commit/c92eec2c774fcf1c9c3dae86bf327c9a96c8c464)View commit details

   Browse the repository at this point in the history

### Commits on Jun 3, 2022

1. [Fix worldmap PHP 8.1 incompatibility](/NagVis/nagvis/commit/ee8021fe7242b6b0a5726ff9df681ee5bdadec02)

   [![@loocars](https://avatars.githubusercontent.com/u/46791457?s=40&v=4)](/loocars) [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [loocars](/NagVis/nagvis/commits?author=loocars "View all commits by loocars")
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Jun 3, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/ee8021fe7242b6b0a5726ff9df681ee5bdadec02)
   * Copy full SHA for ee8021f
   * [Browse repository at this point](/NagVis/nagvis/tree/ee8021fe7242b6b0a5726ff9df681ee5bdadec02)

   Copy the full SHA

    [ee8021f](/NagVis/nagvis/commit/ee8021fe7242b6b0a5726ff9df681ee5bdadec02)View commit details

   Browse the repository at this point in the history
2. [Update changelog](/NagVis/nagvis/commit/4c4d7d625a695d54093d699e4b05dec568882e63)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Jun 3, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/4c4d7d625a695d54093d699e4b05dec568882e63)
   * Copy full SHA for 4c4d7d6
   * [Browse repository at this point](/NagVis/nagvis/tree/4c4d7d625a695d54093d699e4b05dec568882e63)

   Copy the full SHA

    [4c4d7d6](/NagVis/nagvis/commit/4c4d7d625a695d54093d699e4b05dec568882e63)View commit details

   Browse the repository at this point in the history
3. [FIX: Fix PHP 8.1 incompatibility in "General configuration" dialog](/NagVis/nagvis/commit/e84f1287ce094c6169534544cccfb3af84e22e36)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Jun 3, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/e84f1287ce094c6169534544cccfb3af84e22e36)
   * Copy full SHA for e84f128
   * [Browse repository at this point](/NagVis/nagvis/tree/e84f1287ce094c6169534544cccfb3af84e22e36)

   Copy the full SHA

    [e84f128](/NagVis/nagvis/commit/e84f1287ce094c6169534544cccfb3af84e22e36)View commit details

   Browse the repository at this point in the history

### Commits on Jun 28, 2022

1. [Fix another PHP 8.1 compatibility issue](/NagVis/nagvis/commit/ab0094e047c39739b93afbf1059daa15806a5f8a)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Jun 28, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/ab0094e047c39739b93afbf1059daa15806a5f8a)
   * Copy full SHA for ab0094e
   * [Browse repository at this point](/NagVis/nagvis/tree/ab0094e047c39739b93afbf1059daa15806a5f8a)

   Copy the full SHA

    [ab0094e](/NagVis/nagvis/commit/ab0094e047c39739b93afbf1059daa15806a5f8a)View commit details

   Browse the repository at this point in the history

### Commits on Aug 4, 2022

1. [FIX: Fix BI-Backend HTTPS incompatibility](/NagVis/nagvis/commit/3ef756e537d6dee31f903622317186a733a3f785)

   [![@loocars](https://avatars.githubusercontent.com/u/46791457?s=40&v=4)](/loocars) [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [loocars](/NagVis/nagvis/commits?author=loocars "View all commits by loocars")
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 4, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/3ef756e537d6dee31f903622317186a733a3f785)
   * Copy full SHA for 3ef756e
   * [Browse repository at this point](/NagVis/nagvis/tree/3ef756e537d6dee31f903622317186a733a3f785)

   Copy the full SHA

    [3ef756e](/NagVis/nagvis/commit/3ef756e537d6dee31f903622317186a733a3f785)View commit details

   Browse the repository at this point in the history
2. [Update changelog and docs](/NagVis/nagvis/commit/b8715484f401ad07f41de7f670afca1d185a5676)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 4, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/b8715484f401ad07f41de7f670afca1d185a5676)
   * Copy full SHA for b871548
   * [Browse repository at this point](/NagVis/nagvis/tree/b8715484f401ad07f41de7f670afca1d185a5676)

   Copy the full SHA

    [b871548](/NagVis/nagvis/commit/b8715484f401ad07f41de7f670afca1d185a5676)View commit details

   Browse the repository at this point in the history

### Commits on Aug 29, 2022

1. [FIX: BI-Backend add configuration options for depth of SSL verification](/NagVis/nagvis/commit/f795de3190e66a1fc5f5a72765bae5e5087aa543)

   [![@loocars](https://avatars.githubusercontent.com/u/46791457?s=40&v=4)](/loocars) [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [loocars](/NagVis/nagvis/commits?author=loocars "View all commits by loocars")
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/f795de3190e66a1fc5f5a72765bae5e5087aa543)
   * Copy full SHA for f795de3
   * [Browse repository at this point](/NagVis/nagvis/tree/f795de3190e66a1fc5f5a72765bae5e5087aa543)

   Copy the full SHA

    [f795de3](/NagVis/nagvis/commit/f795de3190e66a1fc5f5a72765bae5e5087aa543)View commit details

   Browse the repository at this point in the history
2. [Fix](/NagVis/nagvis/commit/0fe654703f3f1ebc3cbed37c6ed07067bd2f69f2) [#319](https://github.com/NagVis/nagvis/issues/319)

   [![@dontqwerty](https://avatars.githubusercontent.com/u/45130241?s=40&v=4)](/dontqwerty) [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [dontqwerty](/NagVis/nagvis/commits?author=dontqwerty "View all commits by dontqwerty")
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/0fe654703f3f1ebc3cbed37c6ed07067bd2f69f2)
   * Copy full SHA for 0fe6547
   * [Browse repository at this point](/NagVis/nagvis/tree/0fe654703f3f1ebc3cbed37c6ed07067bd2f69f2)

   Copy the full SHA

    [0fe6547](/NagVis/nagvis/commit/0fe654703f3f1ebc3cbed37c6ed07067bd2f69f2)View commit details

   Browse the repository at this point in the history
3. [Update changelog](/NagVis/nagvis/commit/7d60f92fe2fd337c8c83b1518dcb4acfb5e224f9)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/7d60f92fe2fd337c8c83b1518dcb4acfb5e224f9)
   * Copy full SHA for 7d60f92
   * [Browse repository at this point](/NagVis/nagvis/tree/7d60f92fe2fd337c8c83b1518dcb4acfb5e224f9)

   Copy the full SHA

    [7d60f92](/NagVis/nagvis/commit/7d60f92fe2fd337c8c83b1518dcb4acfb5e224f9)View commit details

   Browse the repository at this point in the history
4. [Fix type juggling vulnerability](/NagVis/nagvis/commit/7574fd8a2903282c2e0d1feef5c4876763db21d5)
    …

   ```
   PHP evaluates `!=` a bit loose on the type. So "0000" == "0e5678" is
   true in PHP. An attacker could send a zeroed cookie_hash `"0"*32` and
   only need an collision with a calculated hash beginning with `0e`
   followed by only numbers.

   In our tests (with auth.secret set to `stable`) a valid cookie is
   `cmkadmin:58191275:00000000000000000000000000000000`.

   For a remote attacker this would have needed 58,191,275 guesses.
   ```

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   Maximilian Wirtz
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/7574fd8a2903282c2e0d1feef5c4876763db21d5)
   * Copy full SHA for 7574fd8
   * [Browse repository at this point](/NagVis/nagvis/tree/7574fd8a2903282c2e0d1feef5c4876763db21d5)

   Copy the full SHA

    [7574fd8](/NagVis/nagvis/commit/7574fd8a2903282c2e0d1feef5c4876763db21d5)View commit details

   Browse the repository at this point in the history
5. [Mitigate arbitrary file read](/NagVis/nagvis/commit/71aba7f46f79d846e1df037f165d206a2cd1d22a)
    …

   ```
   With this change the URL is restricted to http and https. So no local
   files can be read. This still is a Server-side request forgery (SSRF).
   ```

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   Maximilian Wirtz
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/71aba7f46f79d846e1df037f165d206a2cd1d22a)
   * Copy full SHA for 71aba7f
   * [Browse repository at this point](/NagVis/nagvis/tree/71aba7f46f79d846e1df037f165d206a2cd1d22a)

   Copy the full SHA

    [71aba7f](/NagVis/nagvis/commit/71aba7f46f79d846e1df037f165d206a2cd1d22a)View commit details

   Browse the repository at this point in the history
6. [Add compatibility for HMAC cookies](/NagVis/nagvis/commit/b63db433d925920eeb80faba6a7bd7d85b67a86c)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   Maximilian Wirtz
   authored and
   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/b63db433d925920eeb80faba6a7bd7d85b67a86c)
   * Copy full SHA for b63db43
   * [Browse repository at this point](/NagVis/nagvis/tree/b63db433d925920eeb80faba6a7bd7d85b67a86c)

   Copy the full SHA

    [b63db43](/NagVis/nagvis/commit/b63db433d925920eeb80faba6a7bd7d85b67a86c)View commit details

   Browse the repository at this point in the history
7. [Update changelog and add doc entry](/NagVis/nagvis/commit/719f7d8454d0d7f31bef9938bd8b2eb2e7107063)

   [![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

   [LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
   committed
   Aug 29, 2022

   Configuration menu

   * [View commit details](/NagVis/nagvis/commit/719f7d8454d0d7f31bef9938bd8b2eb2e7107063)
   * Copy full SHA for 719f7d8
   * [Browse repository at this point](/NagVis/nagvis/tree/719f7d8454d0d7f31bef9938bd8b2eb2e7107063)

   Copy the full SHA

    [719f7d8](/NagVis/nagvis/commit/719f7d8454d0d7f31bef9938bd8b2eb2e7107063)View commit details

   Browse the repository at this point in the history

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff nagvis-1.9.33...nagvis-1.9.34`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a3c5501e_20250114_200156.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F71aba7f46f79d846e1df037f165d206a2cd1d22a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F71aba7f46f79d846e1df037f165d206a2cd1d22a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=NagVis%2Fnagvis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[NagVis](/NagVis)
/
**[nagvis](/NagVis/nagvis)**
Public

* [Notifications](/login?return_to=%2FNagVis%2Fnagvis) You must be signed in to change notification settings
* [Fork
  74](/login?return_to=%2FNagVis%2Fnagvis)
* [Star
   116](/login?return_to=%2FNagVis%2Fnagvis)

* [Code](/NagVis/nagvis)
* [Issues
  62](/NagVis/nagvis/issues)
* [Pull requests
  11](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects
  0](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

Additional navigation options

* [Code](/NagVis/nagvis)
* [Issues](/NagVis/nagvis/issues)
* [Pull requests](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

## Commit

[Permalink](/NagVis/nagvis/commit/71aba7f46f79d846e1df037f165d206a2cd1d22a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Mitigate arbitrary file read

[Browse files](/NagVis/nagvis/tree/71aba7f46f79d846e1df037f165d206a2cd1d22a)
Browse the repository at this point in the history

```
With this change the URL is restricted to http and https. So no local
files can be read. This still is a Server-side request forgery (SSRF).
```

* Loading branch information

[![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

Maximilian Wirtz
authored and
[LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
committed
Aug 29, 2022

1 parent
[7574fd8](/NagVis/nagvis/commit/7574fd8a2903282c2e0d1feef5c4876763db21d5)

commit 71aba7f

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[share/server/core/classes/NagVisHoverUrl.php](#diff-9cc313f1c704ce2aa28532200acda4e4d429b6e23f69baa08ef284e417772412 "share/server/core/classes/NagVisHoverUrl.php")

Show comments

[View file](/NagVis/nagvis/blob/71aba7f46f79d846e1df037f165d206a2cd1d22a/share/server/core/classes/NagVisHoverUrl.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -84,7 +84,7 @@ private function readHoverUrl() { |
|  |  | // Only allow urls not paths for security reasons |
|  |  | // Reported here: http://news.gmane.org/find-root.php?message\_id=%3cf60c42280909021938s7f36c0edhd66d3e9156a5d081%40mail.gmail.com%3e |
|  |  | $aUrl = parse\_url($this->url); |
|  |  | if(!isset($aUrl['scheme']) || $aUrl['scheme'] == '') |
|  |  | if(!isset($aUrl['scheme']) || $aUrl['scheme'] == '' || ($aUrl['scheme'] != 'http' && $aUrl['scheme'] != 'https')) |
|  |  | throw new NagVisException(l('problemReadingUrl', Array('URL' => $this->url, |
|  |  | 'MSG' => l('Not allowed url')))); |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `71aba7f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F71aba7f46f79d846e1df037f165d206a2cd1d22a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.sonarsource.com_2b5b8112_20250114_200159.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Checkmk: Remote Code Execution by Chaining Multiple Bugs (3/3)

![](data:image/svg+xml;charset=utf-8...)![Stefan Schiller photo]()![Stefan Schiller photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bfd8cc06-d437-4ab4-9039-66ec3affeeea/stefan.jpg?w=800&h=800&auto=format&fit=crop)

Stefan Schiller

Vulnerability Researcher

November 15, 2022

8 min read

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8d960daa-e1d0-4e94-b772-0b0a09889b66/Checkmk-Remote%20Code%20Execution_Hero%402x.png?w=2401&h=1254&auto=format&fit=crop)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8d960daa-e1d0-4e94-b772-0b0a09889b66/Checkmk-Remote%20Code%20Execution_Hero%402x.png?w=2401&h=1254&auto=format&fit=crop)

This is the third and last article in the *Checkmk - Remote Code Execution by Chaining Multiple Bugs* series ([first article](https://blog.sonarsource.com/checkmk-rce-chain-1/ "first article"), [second article](https://blog.sonarsource.com/checkmk-rce-chain-2/ "second article")). Within the series of articles, we take a detailed look at multiple vulnerabilities we identified in Checkmk and its NagVis integration, which can be chained together by an unauthenticated, remote attacker to fully take over the server running a vulnerable version of Checkmk.

In the last article, we evaluated the ability of an attacker to forge arbitrary LQL queries. This allows the attacker to exfiltrate monitoring data and issue external Nagios commands, which can be leveraged to delete arbitrary files. We could demonstrate that this ability could be combined with a file race condition to bypass the authentication of the NagVis component.

In this third and last article, we complete our deep dive into the technical details of the vulnerability chain. At this point, the attacker has gained access to the NagVis component. Based on this, we will outline how the attacker can escalate this access to the Checkmk GUI itself by exploiting an authenticated file read vulnerability in NagVis.

At last, we take a detailed look at an authenticated code injection vulnerability in Checkmk, which forms the final step to remote code execution.

## Technical Details

We start this section by briefly recapping the vulnerabilities and exploitation chain. After this, we look at the arbitrary file read vulnerability in NagVis and the code injection vulnerability in Checkmk.

### Exploitation Chain

As a reminder, the following picture summarizes the exploitation chain enabling an unauthenticated attacker to gain remote code execution:

![](data:image/svg+xml;charset=utf-8...)![Checkmk-Remote Code Execution]()![Checkmk-Remote Code Execution](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/58c9af12-5aba-4ba4-8b00-5d6c57d23180/Checkmk-Remote%20Code%20Execution_1.png?w=695&h=537&auto=format&fit=crop)

In the last two articles, we covered the first two vulnerabilities (1, 2) and an arbitrary file deletion, which can be exploited by an unauthenticated attacker to gain access to the NagVis component. Within this article, we determine how an attacker can escalate to the Checkmk automation user by exploiting an authenticated arbitrary file read in NagVis (3). With access to the Checkmk automation user, an attacker can ultimately gain code execution by exploiting a code injection vulnerability in Checkmk’s watolib (4):

![](data:image/svg+xml;charset=utf-8...)![Checkmk-Remote Code Execution diagram]()![Checkmk-Remote Code Execution diagram](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/3c94a175-19b0-4b4b-b7a2-0079e07542ba/Checkmk-Remote%20Code%20Execution_2.png?w=540&h=294&auto=format&fit=crop)
### Arbitrary File Read in NagVis (CVE-2022-46945)

After an attacker has gained access to NagVis, the exposed attack surface is greatly increased because authenticated endpoints can now be accessed. For one of these endpoints, our automatic scan with [SonarQube Cloud](https://sonarcloud.io/ "SonarQube Cloud") discovered an interesting path injection vulnerability:

[Try it by yourself in SonarQube Cloud!](https://sonarcloud.io/project/issues?issues=AYRRCmHFmKnN7I1rUBls&open=AYRRCmHFmKnN7I1rUBls&id=SonarSourceResearch_checkmk-blogpost "Try it by yourself in SonarQube Cloud!")

The endpoint is implemented in the `CoreModGeneral` class. This class offers different actions which an authenticated user can trigger. One of these actions is called `getHoverUrl`:

**share/nagvis/htdocs/server/core/classes/CoreModGeneral.php**

```
class CoreModGeneral extends CoreModule {
   ...
   public function handleAction() {
       $sReturn = '';

       if($this->offersAction($this->sAction)) {
           switch($this->sAction) {
               ...
               case 'getHoverUrl':
                   $sReturn = $this->getHoverUrl();
               break;
           ...
```

Within the `getHoverUrl` method, `getCustomOptions` is called to retrieve user-provided GET and POST parameters. In this case, the parameter `url` is retrieved, which is supposed to be an array containing URLs. For each provided URL, a new `NagVisHoverUrl` object is created. The response, which is stored in `$arrReturn`, contains the requested URL (`url`) as well as the string representation of the `NagVisHoverUrl` object (`code`):

**share/nagvis/htdocs/server/core/classes/CoreModGeneral.php**

```
   private function getHoverUrl() {
       $arrReturn = Array();

       // Parse view specific uri params
       $aOpts = $this->getCustomOptions(Array('url' => MATCH_STRING_URL));

       foreach($aOpts['url'] AS $sUrl) {
           $OBJ = new NagVisHoverUrl($this->CORE, $sUrl);
           $arrReturn[] = Array('url' => $sUrl, 'code' => $OBJ->__toString());
       }

       $result = json_encode($arrReturn);
       ...
       return $result;
   }
```

Within the constructor of the `NagVisHoverUrl` class, the method `readHoverUrl` is called.

This method uses `file_get_contents` to retrieve the requested URL:

**share/nagvis/htdocs/server/core/classes/NagVisHoverUrl.php**

```
   private function readHoverUrl() {
       ...
       if(!$content = file_get_contents($this->url)) {
           throw new NagVisException(l('couldNotGetHoverUrl', Array('URL' => $this->url)));
       }
       ...
       $this->code = $content;
   }
```

Since an authenticated user can fully control the URLs provided, the `getHoverUrl` action can be used to read arbitrary files by using the `file:///` scheme.

This vulnerability further increases the attacker’s ability to read arbitrary files accessible by the webserver user. The impact depends on the presence of accessible files with sensitive content. Unfortunately, for automation users, these files exist.

### Checkmk Automation Users

Checkmk provides two types of user accounts: normal users and automation users. A normal user has a regular password and can log in to the GUI. An automation user can be used as a convenient way to automate certain activities that would normally be done via the GUI. Instead of a regular password, an automation user is authenticated by an *automation secret*. This secret can usually not be used to log in to the GUI but is provided as an additional GET parameter to the accessed endpoint.

The default automation user is called `automation` and is preconfigured with a random secret. The hash of this secret and the hash of regular passwords are by default stored in an `htpasswd` file:

Though, the secret is additionally stored in a plaintext file, which is called `automation.secret`:

Since the file contains the plaintext secret, the aforementioned arbitrary file read vulnerability can be leveraged by an attacker to retrieve it without requiring to crack the hash stored in the `htpasswd` file.

Although this secret can be used to access authenticated endpoints, it cannot be used to log in to the GUI with it. Let’s have a look at the corresponding code. When a user logs in, the function `check_credentials` is called:

**checkmk/cmk/gui/userdb/htpasswd.py**

```
   def check_credentials(self, user_id: UserId, password: str) -> CheckCredentialsResult:
       ...
       if self._is_automation_user(user_id):
           raise MKUserError(None, _("Automation user rejected"))
       ...
```

As we can see, the function `_is_automation_user` checks if the provided `user_id` corresponds to an automation user. If that is the case, an error is raised, and the GUI login fails. This is what the `_is_automation_user` function looks like:

**checkmk/cmk/gui/userdb/htpasswd.py**

```
   def _is_automation_user(self, user_id: UserId) -> bool:
       return Path(cmk.utils.paths.var_dir, "web", str(user_id), "automation.secret").is_file()
```

Accordingly, the presence of the `automation.secret` file is used in order to determine if the user is an automation user.

By leveraging the Linefeed Injection vulnerability and the Nagios `PROCESS_FILE` command outlined in the [second article](/blog/checkmk-rce-chain-2/ "second article"), an attacker has not only the ability to read arbitrary files but also to delete them. This means that the attacker can delete the `automation.secret` file after reading it. Since the login process verifies the provided credentials via the `htpasswd` file and the `automation.secret` file is not present, the automation user is assumed to be a normal user, and access to the GUI is granted:

![](data:image/svg+xml;charset=utf-8...)![Checkmk-Remote Code Execution sheet]()![Checkmk-Remote Code Execution sheet](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/642df998-1cc9-4be2-8d77-0ff229927ab7/Checkmk-Remote%20Code%20Execution_3.png?w=685&h=529&auto=format&fit=crop)

After the successful login, an attacker can exploit an authenticated code injection vulnerability.

### Code Injection watolib auth.php (CVE-2022-46836)

In order to seamlessly integrate NagVis into Checkmk, a file called `auth.php` is generated, which contains information about users, roles, and groups present in the Checkmk GUI. This file is updated when the corresponding data changes (e.g., user settings) by a function called `_create_auth_file`. This function loads the required data and calls `_create_php_file`:

**checkmk/cmk/gui/watolib/auth\_php.py**

```
def _create_auth_file(callee, users=None):
   if users is None:
       users = userdb.load_users()
   ...
   _create_php_file(callee, users, get_role_permissions(), groups)
```

Within `_create_php_file` the content of the `auth.php` file is created and written to disk. In order to format the user data, the function `_format_php` is called:

**checkmk/cmk/gui/watolib/auth\_php.py**

```
def _create_php_file(callee, users, role_permissions, groups):
   # Do not change WATO internal objects
   nagvis_users = copy.deepcopy(users)
   ...
   content = """<?php
// Created by Multisite UserDB Hook (%s)
global $mk_users, $mk_roles, $mk_groups;
$mk_users   = %s;
...
?>
""" % (
       callee,
       _format_php(nagvis_users),
       ...
   )

   store.makedirs(_auth_php().parent)
   store.save_text_to_file(_auth_php(), content)
```

The function `_format_php` converts the given data into the corresponding PHP representation. Data of type str is inserted into a single-quoted `string`. Single quotes within the data itself are escaped by prepending a backslash (`\`) to prevent the string context can be escaped:

**checkmk/cmk/gui/watolib/auth\_php.py**

```
def _format_php(data, lvl=1):
   s = ""
   ...
   elif isinstance(data, str):
       s += "'%s'" % data.replace("'", "\\'")
   ...
```

The replacement does not take into account that the data can contain a backslash itself, followed by a single quote (`\'`). When encountering this sequence, the single quote is prepended by a backslash, which is escaped by the already present backslash (`\\'`). This way the string context can be escaped and arbitrary PHP code can be injected into the file.

An attacker can exploit the vulnerability after authenticating with the default automation user and then changing the profile settings. After the `auth.php` file is automatically updated, it contains the attacker-injected PHP code. The attacker now only needs to access the NagVis component, which includes the `auth.php` file and executes the injection code.

### Patch

The arbitrary file read vulnerability was [patched](https://github.com/NagVis/nagvis/commit/71aba7f46f79d846e1df037f165d206a2cd1d22a "patched") in NagVis 1.9.34, which was [integrated](https://github.com/tribe29/checkmk/commit/84712e97760f6ecd9383b12b1f2b009377aad139 "integrated") into Checkmk version 2.1.0p11 by limiting the requested scheme to `http` and `https`:

**nagvis/share/nagvis/htdocs/server/core/classes/NagVisHoverUrl.php**

```
  private function readHoverUrl() {
      ...
      $aUrl = parse_url($this->url);
      if(!isset($aUrl['scheme']) || $aUrl['scheme'] == '' || ($aUrl['scheme'] != 'http' && $aUrl['scheme'] != 'https'))
          throw new NagVisException(l('problemReadingUrl', Array('URL' => $this->url, 'MSG' => l('Not allowed url'))));
      ...
```

The [code injection vulnerability](https://checkmk.com/werk/14383 "code injection vulnerability") was patched with Checkmk version 2.1.0p11 by escaping both single-quote characters and backslash characters ([commit](https://github.com/tribe29/checkmk/commit/a8a47e0269d21a26608a2051232c8914348101aa "commit")):

**checkmk/cmk/gui/watolib/utils.py**

```
def format_php(data: object, lvl: int = 1) -> str:
   """Format a python object for php"""
   s = ""
   ...
   elif isinstance(data, str):
       s += "'%s'" % re.sub(r"('|\\)", r"\\\1", data)
   ...
```
## Timeline

| **Date** | **Action** |
| --- | --- |
| 2022-08-22 | We report all issues to Checkmk. |
| 2022-08-23 | Vendor confirms all issues. |
| 2022-08-29 | NagVis patched version 1.9.34 is released. |
| 2022-08-30 | Checkmk version 2.1.0p11 is released containing NagVis 1.9.34. |

## Summary

In this last article in the series, we detailed an authenticated, arbitrary file read vulnerability in NagVis, which enables an attacker to gain access to the Checkmk automation user. We further took a look at how Checkmk identifies automation users. This revealed that an attacker could leverage the arbitrary file deletion once more to gain access to the Checkmk GUI. This access can further be leveraged to exploit a code injection vulnerability in Checkmk’s watolib.

The arbitrary file read vulnerability is caused by a missing validation of the URL scheme. The impact of this vulnerability is greatly increased because the automation secret is stored in plaintext. Whether it be a file or a database, sensitive values, which can directly be used by an attacker to gain more privileges, should not be stored in plaintext. These sensitive values can for example be passwords, authentication tokens, or password reset tokens.

Dynamic code generation, like creating PHP files, can be very dangerous and should be avoided if possible. There is no built-in method that escapes values in the context of code generation for another language. Thus a custom implementation is required, and some cases can easily be missed. The outlined code injection vulnerability showed that a single mistake in the escaping implementation directly leads to code execution.

## Series Wrap-Up

This article completes the *Checkmk - Remote Code Execution by Chaining Multiple Bugs* series. The series showcased how an attacker successively gained more abilities and access by chaining one vulnerability after another.

In general, web applications have become more secure in the past few years. Vulnerabilities instantly leading to remote code execution are far less common. This requires attackers to leverage less impactful vulnerabilities and chain them together. These chains are often only possible because the security precautions tend to be lower the higher the level of authentication.

The assumption that an attacker lacks a particular ability is dangerous and can quickly lead to a domino effect when an initial security boundary is breached. It is essential to apply security on all layers. Even one seemingly unimportant, additional security check can mitigate one link in an exploit chain and thus break the whole chain.

This is why Sonar believes in the [Clean Code approach](https://www.sonarsource.com/solutions/clean-code/ "Clean Code approach"), which embeds security as an integral part of the development. Handling security issues should not be a painful aftermath. Directly addressing and preventing these when the code is being developed saves time, work, and frustration. Our unique Clean as You Code approach addresses issues upfront, and no new issues end up in the released code. If you haven’t discovered the power of the Sonar solution yet, [you can learn more here](https://www.sonarsource.com/solutions/power-of-clean-code/ "you can learn more here").

Finally, we would like to highlight the professional reaction of the Checkmk team. There are security issues in each and every software. The difference is how these issues are dealt with. All of our reported issues were quickly verified, handled with absolute transparency, and fixed by providing comprehensive patches. Thank you!

## Related Blog Posts

* [Checkmk: Remote Code Execution by Chaining Multiple Bugs (1/3)](https://www.sonarsource.com/blog/checkmk-rce-chain-1/ "Checkmk: Remote Code Execution by Chaining Multiple Bugs (1/3)")
* [Checkmk: Remote Code Execution by Chaining Multiple Bugs (2/3)](https://www.sonarsource.com/blog/checkmk-rce-chain-2/ "Checkmk: Remote Code Execution by Chaining Multiple Bugs (2/3)")
* [Zabbix - A Case Study of Unsafe Session Storage](https://www.sonarsource.com/blog/zabbix-case-study-of-unsafe-session-storage/ "Zabbix - A Case Study of Unsafe Session Storage")
* [Path Traversal Vulnerabilities in Icinga Web](https://www.sonarsource.com/blog/path-traversal-vulnerabilities-in-icinga-web/ "Path Traversal Vulnerabilities in Icinga Web")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.


