=== Content from github.com_c74f1202_20250115_212130.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

Multi-tenancy and policy-based framework for Kubernetes.

[projectcapsule.dev/](https://projectcapsule.dev/ "https://projectcapsule.dev/")

### License

[Apache-2.0 license](/projectcapsule/capsule/blob/main/LICENSE)

[1.7k
stars](/projectcapsule/capsule/stargazers) [163
forks](/projectcapsule/capsule/forks) [Branches](/projectcapsule/capsule/branches) [Tags](/projectcapsule/capsule/tags) [Activity](/projectcapsule/capsule/activity)
 [Star](/login?return_to=%2Fprojectcapsule%2Fcapsule)

 [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings

* [Code](/projectcapsule/capsule)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  16](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

# projectcapsule/capsule

   ¬†main[Branches](/projectcapsule/capsule/branches)[Tags](/projectcapsule/capsule/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit¬†History[1,111 Commits](/projectcapsule/capsule/commits/main/) | | |
| [.github](/projectcapsule/capsule/tree/main/.github ".github") | | [.github](/projectcapsule/capsule/tree/main/.github ".github") |  |  |
| [api](/projectcapsule/capsule/tree/main/api "api") | | [api](/projectcapsule/capsule/tree/main/api "api") |  |  |
| [assets](/projectcapsule/capsule/tree/main/assets "assets") | | [assets](/projectcapsule/capsule/tree/main/assets "assets") |  |  |
| [charts/capsule](/projectcapsule/capsule/tree/main/charts/capsule "This path skips through empty directories") | | [charts/capsule](/projectcapsule/capsule/tree/main/charts/capsule "This path skips through empty directories") |  |  |
| [config](/projectcapsule/capsule/tree/main/config "config") | | [config](/projectcapsule/capsule/tree/main/config "config") |  |  |
| [controllers](/projectcapsule/capsule/tree/main/controllers "controllers") | | [controllers](/projectcapsule/capsule/tree/main/controllers "controllers") |  |  |
| [docs](/projectcapsule/capsule/tree/main/docs "docs") | | [docs](/projectcapsule/capsule/tree/main/docs "docs") |  |  |
| [e2e](/projectcapsule/capsule/tree/main/e2e "e2e") | | [e2e](/projectcapsule/capsule/tree/main/e2e "e2e") |  |  |
| [hack](/projectcapsule/capsule/tree/main/hack "hack") | | [hack](/projectcapsule/capsule/tree/main/hack "hack") |  |  |
| [pkg](/projectcapsule/capsule/tree/main/pkg "pkg") | | [pkg](/projectcapsule/capsule/tree/main/pkg "pkg") |  |  |
| [.gitignore](/projectcapsule/capsule/blob/main/.gitignore ".gitignore") | | [.gitignore](/projectcapsule/capsule/blob/main/.gitignore ".gitignore") |  |  |
| [.golangci.yml](/projectcapsule/capsule/blob/main/.golangci.yml ".golangci.yml") | | [.golangci.yml](/projectcapsule/capsule/blob/main/.golangci.yml ".golangci.yml") |  |  |
| [.goreleaser.yml](/projectcapsule/capsule/blob/main/.goreleaser.yml ".goreleaser.yml") | | [.goreleaser.yml](/projectcapsule/capsule/blob/main/.goreleaser.yml ".goreleaser.yml") |  |  |
| [.ko.yaml](/projectcapsule/capsule/blob/main/.ko.yaml ".ko.yaml") | | [.ko.yaml](/projectcapsule/capsule/blob/main/.ko.yaml ".ko.yaml") |  |  |
| [ADOPTERS.md](/projectcapsule/capsule/blob/main/ADOPTERS.md "ADOPTERS.md") | | [ADOPTERS.md](/projectcapsule/capsule/blob/main/ADOPTERS.md "ADOPTERS.md") |  |  |
| [CHANGELOG.md](/projectcapsule/capsule/blob/main/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/projectcapsule/capsule/blob/main/CHANGELOG.md "CHANGELOG.md") |  |  |
| [CODE\_OF\_CONDUCT.md](/projectcapsule/capsule/blob/main/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") | | [CODE\_OF\_CONDUCT.md](/projectcapsule/capsule/blob/main/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") |  |  |
| [CONTRIBUTING.md](/projectcapsule/capsule/blob/main/CONTRIBUTING.md "CONTRIBUTING.md") | | [CONTRIBUTING.md](/projectcapsule/capsule/blob/main/CONTRIBUTING.md "CONTRIBUTING.md") |  |  |
| [DEPENDENCY.md](/projectcapsule/capsule/blob/main/DEPENDENCY.md "DEPENDENCY.md") | | [DEPENDENCY.md](/projectcapsule/capsule/blob/main/DEPENDENCY.md "DEPENDENCY.md") |  |  |
| [DEVELOPMENT.md](/projectcapsule/capsule/blob/main/DEVELOPMENT.md "DEVELOPMENT.md") | | [DEVELOPMENT.md](/projectcapsule/capsule/blob/main/DEVELOPMENT.md "DEVELOPMENT.md") |  |  |
| [Dockerfile](/projectcapsule/capsule/blob/main/Dockerfile "Dockerfile") | | [Dockerfile](/projectcapsule/capsule/blob/main/Dockerfile "Dockerfile") |  |  |
| [GOVERNANCE.md](/projectcapsule/capsule/blob/main/GOVERNANCE.md "GOVERNANCE.md") | | [GOVERNANCE.md](/projectcapsule/capsule/blob/main/GOVERNANCE.md "GOVERNANCE.md") |  |  |
| [LICENSE](/projectcapsule/capsule/blob/main/LICENSE "LICENSE") | | [LICENSE](/projectcapsule/capsule/blob/main/LICENSE "LICENSE") |  |  |
| [MAINTAINERS.md](/projectcapsule/capsule/blob/main/MAINTAINERS.md "MAINTAINERS.md") | | [MAINTAINERS.md](/projectcapsule/capsule/blob/main/MAINTAINERS.md "MAINTAINERS.md") |  |  |
| [Makefile](/projectcapsule/capsule/blob/main/Makefile "Makefile") | | [Makefile](/projectcapsule/capsule/blob/main/Makefile "Makefile") |  |  |
| [PROJECT](/projectcapsule/capsule/blob/main/PROJECT "PROJECT") | | [PROJECT](/projectcapsule/capsule/blob/main/PROJECT "PROJECT") |  |  |
| [README.md](/projectcapsule/capsule/blob/main/README.md "README.md") | | [README.md](/projectcapsule/capsule/blob/main/README.md "README.md") |  |  |
| [ROADMAP.md](/projectcapsule/capsule/blob/main/ROADMAP.md "ROADMAP.md") | | [ROADMAP.md](/projectcapsule/capsule/blob/main/ROADMAP.md "ROADMAP.md") |  |  |
| [SECURITY-INSIGHTS.yml](/projectcapsule/capsule/blob/main/SECURITY-INSIGHTS.yml "SECURITY-INSIGHTS.yml") | | [SECURITY-INSIGHTS.yml](/projectcapsule/capsule/blob/main/SECURITY-INSIGHTS.yml "SECURITY-INSIGHTS.yml") |  |  |
| [SECURITY.md](/projectcapsule/capsule/blob/main/SECURITY.md "SECURITY.md") | | [SECURITY.md](/projectcapsule/capsule/blob/main/SECURITY.md "SECURITY.md") |  |  |
| [SELF\_ASSESSMENT.md](/projectcapsule/capsule/blob/main/SELF_ASSESSMENT.md "SELF_ASSESSMENT.md") | | [SELF\_ASSESSMENT.md](/projectcapsule/capsule/blob/main/SELF_ASSESSMENT.md "SELF_ASSESSMENT.md") |  |  |
| [commitlint.config.cjs](/projectcapsule/capsule/blob/main/commitlint.config.cjs "commitlint.config.cjs") | | [commitlint.config.cjs](/projectcapsule/capsule/blob/main/commitlint.config.cjs "commitlint.config.cjs") |  |  |
| [go.mod](/projectcapsule/capsule/blob/main/go.mod "go.mod") | | [go.mod](/projectcapsule/capsule/blob/main/go.mod "go.mod") |  |  |
| [go.sum](/projectcapsule/capsule/blob/main/go.sum "go.sum") | | [go.sum](/projectcapsule/capsule/blob/main/go.sum "go.sum") |  |  |
| [main.go](/projectcapsule/capsule/blob/main/main.go "main.go") | | [main.go](/projectcapsule/capsule/blob/main/main.go "main.go") |  |  |
| [renovate.json](/projectcapsule/capsule/blob/main/renovate.json "renovate.json") | | [renovate.json](/projectcapsule/capsule/blob/main/renovate.json "renovate.json") |  |  |
| [version.go](/projectcapsule/capsule/blob/main/version.go "version.go") | | [version.go](/projectcapsule/capsule/blob/main/version.go "version.go") |  |  |
| View all files | | |

## Repository files navigation

* README
* Code of conduct
* Apache-2.0 license
* Security

[![](https://camo.githubusercontent.com/3bc97e3c0218e9c5001928f5a661daf3329fd3014e864e114752344504c24a03/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f636c61737469782f63617073756c65)](https://camo.githubusercontent.com/3bc97e3c0218e9c5001928f5a661daf3329fd3014e864e114752344504c24a03/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f636c61737469782f63617073756c65)
[![](https://camo.githubusercontent.com/ebdc64c2d5df06b773534b6c836d13834e11a7fa72c64e00190477b27cffd619/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f676f2d6d6f642f676f2d76657273696f6e2f636c61737469782f63617073756c65)](https://camo.githubusercontent.com/ebdc64c2d5df06b773534b6c836d13834e11a7fa72c64e00190477b27cffd619/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f676f2d6d6f642f676f2d76657273696f6e2f636c61737469782f63617073756c65)
[![](https://camo.githubusercontent.com/5c0118132d35058c532db52a63cd4b3968d01054c5014ad55792f73957fa0ef8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f636c61737469782f63617073756c65)](https://github.com/projectcapsule/capsule/releases)
[![](https://camo.githubusercontent.com/c83406b6bffc21b622b6c5eb6761ed726ba539acb27622e39ebf489cbf79f359/68747470733a2f2f636861726d6875622e696f2f63617073756c652d6b38732f62616467652e737667)](https://charmhub.io/capsule-k8s)
[![](https://camo.githubusercontent.com/a26afc80974bc4c28fa56729c001f14fa5b32b1b8bdc48d062c6464e095f9f61/68747470733a2f2f7777772e626573747072616374696365732e6465762f70726f6a656374732f353630312f6261646765)](https://www.bestpractices.dev/projects/5601)
[![](https://camo.githubusercontent.com/7054fc1f32984975d5eb45bc115ddf12ff0290fdc54fbc51880b3aaa0ee5ea62/68747470733a2f2f6170692e736563757269747973636f726563617264732e6465762f70726f6a656374732f6769746875622e636f6d2f70726f6a65637463617073756c652f63617073756c652f6261646765)](https://api.securityscorecards.dev/projects/github.com/projectcapsule/capsule/badge)
[![](https://camo.githubusercontent.com/ecfc070f3abbb19ecddd0b867fc84aa3d8a09e15d03ea868b83cfb8f54b5cca7/68747470733a2f2f696d672e736869656c64732e696f2f656e64706f696e743f75726c3d68747470733a2f2f61727469666163746875622e696f2f62616467652f7265706f7369746f72792f70726f6a65637463617073756c65)](https://artifacthub.io/packages/search?repo=projectcapsule)
[![](https://camo.githubusercontent.com/b5c71820987664bf59bfa6369a4f58c56d7bce763c2736cf62299e3fd5ebfb99/68747470733a2f2f6170702e666f7373612e636f6d2f6170692f70726f6a656374732f6769742532426769746875622e636f6d25324670726f6a65637463617073756c6525324663617073756c652e7376673f747970653d736869656c64266973737565547970653d6c6963656e7365)](https://app.fossa.com/projects/git%2Bgithub.com/projectcapsule/capsule?ref=badge_shield&issueType=license)

[![](/projectcapsule/capsule/raw/main/assets/logo/capsule_medium.png)](/projectcapsule/capsule/blob/main/assets/logo/capsule_medium.png)

---

**Join the community** on the [#capsule](https://kubernetes.slack.com/archives/C03GETTJQRL) channel in the [Kubernetes Slack](https://slack.k8s.io/).

# Kubernetes multi-tenancy made easy

**Capsule** implements a multi-tenant and policy-based environment in your Kubernetes cluster. It is designed as a micro-services-based ecosystem with the minimalist approach, leveraging only on upstream Kubernetes.

# What's the problem with the current status?

Kubernetes introduces the *Namespace* object type to create logical partitions of the cluster as isolated *slices*. However, implementing advanced multi-tenancy scenarios, it soon becomes complicated because of the flat structure of Kubernetes namespaces and the impossibility to share resources among namespaces belonging to the same tenant. To overcome this, cluster admins tend to provision a dedicated cluster for each groups of users, teams, or departments. As an organization grows, the number of clusters to manage and keep aligned becomes an operational nightmare, described as the well known phenomena of the *clusters sprawl*.

# Entering Capsule

Capsule takes a different approach. In a single cluster, the Capsule Controller aggregates multiple namespaces in a lightweight abstraction called *Tenant*, basically a grouping of Kubernetes Namespaces. Within each tenant, users are free to create their namespaces and share all the assigned resources.

On the other side, the Capsule Policy Engine keeps the different tenants isolated from each other. *Network and Security Policies*, *Resource Quota*, *Limit Ranges*, *RBAC*, and other policies defined at the tenant level are automatically inherited by all the namespaces in the tenant. Then users are free to operate their tenants in autonomy, without the intervention of the cluster administrator.

# Features

## Self-Service

Leave developers the freedom to self-provision their cluster resources according to the assigned boundaries.

## Preventing Clusters Sprawl

Share a single cluster with multiple teams, groups of users, or departments by saving operational and management efforts.

## Governance

Leverage Kubernetes Admission Controllers to enforce the industry security best practices and meet policy requirements.

## Resources Control

Take control of the resources consumed by users while preventing them to overtake.

## Native Experience

Provide multi-tenancy with a native Kubernetes experience without introducing additional management layers, plugins, or customized binaries.

## GitOps ready

Capsule is completely declarative and GitOps ready.

## Bring your own device (BYOD)

Assign to tenants a dedicated set of compute, storage, and network resources and avoid the noisy neighbors' effect.

# Documentation

Please, check the project [documentation](https://projectcapsule.dev) for the cool things you can do with Capsule.

# Contributions

Capsule is Open Source with Apache 2 license and any contribution is welcome.

## Chart Development

### Chart Linting

The chart is linted with [ct](https://github.com/helm/chart-testing). You can run the linter locally with this command:

```
make helm-lint

```

### Chart Documentation

The documentation for each chart is done with [helm-docs](https://github.com/norwoodj/helm-docs). This way we can ensure that values are consistent with the chart documentation. Run this anytime you make changes to a `values.yaml` file:

```
make helm-docs

```

## Community meeting

Join the community, share and learn from it. You can find all the resources to how to contribute code and docs, connect with people in the [community repository](https://github.com/projectcapsule/capsule-community).

Please read the [code of conduct](/projectcapsule/capsule/blob/main/CODE_OF_CONDUCT.md).

## Adopters

See the [ADOPTERS.md](/projectcapsule/capsule/blob/main/ADOPTERS.md) file for a list of companies that are using Capsule.

# Project Governance

You can find how the Capsule project is governed [here](https://projectcapsule.dev/project/governance/).

## Maintainers

Please, refer to the maintainers file available [here](/projectcapsule/capsule/blob/main/.github/maintainers.yaml).

### Changelog

Read how we log changes [here](/projectcapsule/capsule/blob/main/CHANGELOG.md)

### Software Bill of Materials

All OCI release artifacts include a Software Bill of Materials (SBOM) in CycloneDX JSON format. More information on this is available [here](/projectcapsule/capsule/blob/main/SECURITY.md#software-bill-of-materials-sbom)

# FAQ

* Q. How to pronounce Capsule?

  A. It should be pronounced as `/Ààk√¶psjuÀêl/`.
* Q. Is it production grade?

  A. Although under frequent development and improvements, Capsule is ready to be used in production environments as currently, people are using it in public and private deployments. Check out the [release](https://github.com/projectcapsule/capsule/releases) page for a detailed list of available versions.
* Q. Does it work with my Kubernetes XYZ distribution?

  A. We tested Capsule with vanilla Kubernetes 1.16+ on private environments and public clouds. We expect it to work smoothly on any other Kubernetes distribution. Please, let us know if you find it doesn't.
* Q. Do you provide commercial support?

  A. Yes, we're available to help and provide commercial support. [Clastix](https://clastix.io) is the company behind Capsule. Please, contact us for a quote.

## About

Multi-tenancy and policy-based framework for Kubernetes.

[projectcapsule.dev/](https://projectcapsule.dev/ "https://projectcapsule.dev/")

### Topics

[kubernetes](/topics/kubernetes "Topic: kubernetes")
[operator](/topics/operator "Topic: operator")
[kubernetes-operator](/topics/kubernetes-operator "Topic: kubernetes-operator")
[multi-tenancy](/topics/multi-tenancy "Topic: multi-tenancy")
[namespaces](/topics/namespaces "Topic: namespaces")
[tenant](/topics/tenant "Topic: tenant")
[kubernetes-namespaces](/topics/kubernetes-namespaces "Topic: kubernetes-namespaces")
[multi-tenant-operator](/topics/multi-tenant-operator "Topic: multi-tenant-operator")

### Resources

[Readme](#readme-ov-file)
### License

[Apache-2.0 license](#Apache-2.0-1-ov-file)
### Code of conduct

[Code of conduct](#coc-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/projectcapsule/capsule/activity)
[Custom properties](/projectcapsule/capsule/custom-properties)
### Stars

[**1.7k**
stars](/projectcapsule/capsule/stargazers)
### Watchers

[**22**
watching](/projectcapsule/capsule/watchers)
### Forks

[**163**
forks](/projectcapsule/capsule/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule&report=projectcapsule+%28user%29)

## [Releases 43](/projectcapsule/capsule/releases)

[v0.7.2
Latest

Oct 23, 2024](/projectcapsule/capsule/releases/tag/v0.7.2)
[+ 42 releases](/projectcapsule/capsule/releases)

## [Packages 0](/orgs/projectcapsule/packages?repo_name=capsule)

## [Contributors 59](/projectcapsule/capsule/graphs/contributors)

* [![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=64&v=4)](https://github.com/prometherion)
* [![@dependabot[bot]](https://avatars.githubusercontent.com/in/29110?s=64&v=4)](https://github.com/apps/dependabot)
* [![@oliverbaehler](https://avatars.githubusercontent.com/u/26610571?s=64&v=4)](https://github.com/oliverbaehler)
* [![@bsctl](https://avatars.githubusercontent.com/u/2222461?s=64&v=4)](https://github.com/bsctl)
* [![@MaxFedotov](https://avatars.githubusercontent.com/u/12863390?s=64&v=4)](https://github.com/MaxFedotov)
* [![@ptx96](https://avatars.githubusercontent.com/u/33090752?s=64&v=4)](https://github.com/ptx96)
* [![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=64&v=4)](https://github.com/alegrey91)
* [![@maxgio92](https://avatars.githubusercontent.com/u/7593929?s=64&v=4)](https://github.com/maxgio92)
* [![@renovate[bot]](https://avatars.githubusercontent.com/in/2740?s=64&v=4)](https://github.com/apps/renovate)
* [![@ludusrusso](https://avatars.githubusercontent.com/u/8146506?s=64&v=4)](https://github.com/ludusrusso)
* [![@brightzheng100](https://avatars.githubusercontent.com/u/1422425?s=64&v=4)](https://github.com/brightzheng100)
* [![@gchiesa](https://avatars.githubusercontent.com/u/4255029?s=64&v=4)](https://github.com/gchiesa)
* [![@mendrugory](https://avatars.githubusercontent.com/u/4078950?s=64&v=4)](https://github.com/mendrugory)
* [![@93lucasp](https://avatars.githubusercontent.com/u/12210564?s=64&v=4)](https://github.com/93lucasp)

[+ 45 contributors](/projectcapsule/capsule/graphs/contributors)

## Languages

* [Go
  94.9%](/projectcapsule/capsule/search?l=go)
* [Shell
  2.1%](/projectcapsule/capsule/search?l=shell)
* [Makefile
  1.5%](/projectcapsule/capsule/search?l=makefile)
* [Smarty
  1.2%](/projectcapsule/capsule/search?l=smarty)
* Other
  0.3%

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from kubernetes.slack.com_38bf3dcf_20250115_212130.html ===




=== Content from github.com_17ec59f6_20250115_081601.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Freleases%2Ftag%2Fv0.1.3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Freleases%2Ftag%2Fv0.1.3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

* [Code](/projectcapsule/capsule/tree/v0.1.3)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  12](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule/tree/v0.1.3)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

1. [Releases](/projectcapsule/capsule/releases)
2. [v0.1.3](/projectcapsule/capsule/releases/tag/v0.1.3)

# v0.1.3

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/projectcapsule/capsule/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.1.3)

 Loading

[View all tags](/projectcapsule/capsule/tags)

![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)
[prometherion](/prometherion)
released this
02 Dec 14:50

[v0.1.3](/projectcapsule/capsule/tree/v0.1.3)

[`eba072c`](/projectcapsule/capsule/commit/eba072c88dfcff9348d870d03b74ad3737a528b1)

üö® This is a critical release as a patch for the [CVE-2022-46167](https://github.com/clastix/capsule/security/advisories/GHSA-x45c-cvp8-q4fm).

# Enhancements

* Include gosec in CI pipeline [#621](https://github.com/projectcapsule/capsule/issues/621) ([@alegrey91](https://github.com/alegrey91))
* Added makefile command to autogen CRDs documentation [#629](https://github.com/projectcapsule/capsule/pull/629) ([@mastrogiovanni](https://github.com/mastrogiovanni))
* Chart Linting (Dry Install) / Github Config [#635](https://github.com/projectcapsule/capsule/pull/635) ([@oliverbaehler](https://github.com/oliverbaehler))
* Update documentation on integration with Flux v2 [#636](https://github.com/projectcapsule/capsule/pull/636) ([@maxgio92](https://github.com/maxgio92))
* Clarify ServiceAccount as Tenant Owner documentation [#645](https://github.com/projectcapsule/capsule/pull/645) ([@lalyos](https://github.com/lalyos))
* Improve local development experience [#650](https://github.com/projectcapsule/capsule/pull/650) ([@oliverbaehler](https://github.com/oliverbaehler))
* Typo in the Velero guide [#661](https://github.com/projectcapsule/capsule/pull/661) ([@prometherion](https://github.com/prometherion))

# Fix

* [Privilege escalation by ServiceAccount deployed in a Tenant Namespace](https://github.com/clastix/capsule/security/advisories/GHSA-x45c-cvp8-q4fm) - [75525ac](https://github.com/projectcapsule/capsule/commit/75525ac19254b0c5111e34d7985e2be7bc8b1ac1)
* Service controller doesn't skip sentinel error [#653](https://github.com/projectcapsule/capsule/issues/653) ([@prometherion](https://github.com/prometherion))

### Contributors

* [![@lalyos](https://avatars.githubusercontent.com/u/464122?s=64&v=4)](https://github.com/lalyos)
* [![@mastrogiovanni](https://avatars.githubusercontent.com/u/1582611?s=64&v=4)](https://github.com/mastrogiovanni)
* [![@maxgio92](https://avatars.githubusercontent.com/u/7593929?s=64&v=4)](https://github.com/maxgio92)
* [![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=64&v=4)](https://github.com/prometherion)
* [![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=64&v=4)](https://github.com/alegrey91)
* [![@oliverbaehler](https://avatars.githubusercontent.com/u/26610571?s=64&v=4)](https://github.com/oliverbaehler)

lalyos, mastrogiovanni, and 4 other contributors

 Assets
2

 Loading

All reactions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_d3003c77_20250115_081600.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F75525ac19254b0c5111e34d7985e2be7bc8b1ac1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F75525ac19254b0c5111e34d7985e2be7bc8b1ac1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

* [Code](/projectcapsule/capsule)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  12](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

## Commit

[Permalink](/projectcapsule/capsule/commit/75525ac19254b0c5111e34d7985e2be7bc8b1ac1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: preventing serviceaccount privilege escalation

[Browse files](/projectcapsule/capsule/tree/75525ac19254b0c5111e34d7985e2be7bc8b1ac1)
Browse the repository at this point in the history

* Loading branch information

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)](/prometherion)

[prometherion](/projectcapsule/capsule/commits?author=prometherion "View all commits by prometherion")
committed
Dec 2, 2022

1 parent
[132ffd5](/projectcapsule/capsule/commit/132ffd57eab1fc3f0b539b84cb5a5eee473826cb)

commit 75525ac

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**154 additions**
and
**14 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* controllers/tenant

  + controllers/tenant/namespaces.go
    [namespaces.go](#diff-9cbb222f316a2e5d95b4eae7536b5f829bd47d3ab11d5c4c5891cfd22a368ec2)
* main.go
  [main.go](#diff-2873f79a86c0d8b3335cd7731b0ecf7dd4301eb19a82ef7a1cba7589b5252261)
* pkg

  + utils

    - pkg/utils/node\_selector.go
      [node\_selector.go](#diff-03164b2bf01b1102562f8c25e0ad224ac409b634f3d44d886453b655ee7b8395)
  + webhook

    - namespace

      * pkg/webhook/namespace/freezed.go
        [freezed.go](#diff-469c2feaa59a8950dfa403e2b80e4c2a3c044e136e78f6f86797c8203966e889)
      * pkg/webhook/namespace/owner\_reference.go
        [owner\_reference.go](#diff-62aee7a2ad47d2c563b0ce1999fc6dcf60cb36aa883c8448152020411db07281)
      * pkg/webhook/namespace/patch.go
        [patch.go](#diff-3fcfb1b6de60f7b8cd3355ad63107bdc911f899fc47e01c14e4cdc4f6cd4256b)
      * pkg/webhook/namespace/user\_metadata.go
        [user\_metadata.go](#diff-5737f569935ee7ad521603d5efa10cf010ae512dc8615524d4506264f1a6db31)
    - ownerreference

      * pkg/webhook/ownerreference/patching.go
        [patching.go](#diff-8d11df8331828755c89fb6ffedc4b088c43f5412189f700a658ee9c0cdf0f9fc)
    - tenant

      * pkg/webhook/tenant/cordoning.go
        [cordoning.go](#diff-ef32153e105ab9451ec60f906b3de2e7e6a3a5aedcf3dafc085adaf0b67886ea)
    - utils

      * pkg/webhook/utils/in\_capsule\_groups.go
        [in\_capsule\_groups.go](#diff-d09c8bff386409e0f6181cdd28b3ca7b68ae91bb307d274cbf665be20699e0f1)
      * pkg/webhook/utils/is\_capsule\_user.go
        [is\_capsule\_user.go](#diff-6f9ff521a3c29d5c4157317807f2211bbf376e74e0bcb7578bc62816710c805f)

## There are no files selected for viewing

7 changes: 2 additions & 5 deletions

7
[controllers/tenant/namespaces.go](#diff-9cbb222f316a2e5d95b4eae7536b5f829bd47d3ab11d5c4c5891cfd22a368ec2 "controllers/tenant/namespaces.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/controllers/tenant/namespaces.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ import ( |
|  |  | "sigs.k8s.io/controller-runtime/pkg/controller/controllerutil" |
|  |  |  |
|  |  | capsulev1beta1 "github.com/clastix/capsule/api/v1beta1" |
|  |  | "github.com/clastix/capsule/pkg/utils" |
|  |  | ) |
|  |  |  |
|  |  | // Ensuring all annotations are applied to each Namespace handled by the Tenant. |
| Expand Down  Expand Up | | @@ -72,11 +73,7 @@ func (r \*Manager) syncNamespaceMetadata(ctx context.Context, namespace string, t |
|  |  | } |
|  |  |  |
|  |  | if tnt.Spec.NodeSelector != nil { |
|  |  | var selector []string |
|  |  | for k, v := range tnt.Spec.NodeSelector { |
|  |  | selector = append(selector, fmt.Sprintf("%s=%s", k, v)) |
|  |  | } |
|  |  | annotations["scheduler.alpha.kubernetes.io/node-selector"] = strings.Join(selector, ",") |
|  |  | annotations = utils.BuildNodeSelector(tnt, annotations) |
|  |  | } |
|  |  |  |
|  |  | if tnt.Spec.IngressOptions.AllowedClasses != nil { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[main.go](#diff-2873f79a86c0d8b3335cd7731b0ecf7dd4301eb19a82ef7a1cba7589b5252261 "main.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/main.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -205,7 +205,7 @@ func main() { |
|  |  | route.Service(service.Handler()), |
|  |  | route.NetworkPolicy(utils.InCapsuleGroups(cfg, networkpolicy.Handler())), |
|  |  | route.Tenant(tenant.NameHandler(), tenant.RoleBindingRegexHandler(), tenant.IngressClassRegexHandler(), tenant.StorageClassRegexHandler(), tenant.ContainerRegistryRegexHandler(), tenant.HostnameRegexHandler(), tenant.FreezedEmitter(), tenant.ServiceAccountNameHandler(), tenant.ForbiddenAnnotationsRegexHandler(), tenant.ProtectedHandler()), |
|  |  | route.OwnerReference(utils.InCapsuleGroups(cfg, ownerreference.Handler(cfg))), |
|  |  | route.OwnerReference(utils.InCapsuleGroups(cfg, namespacewebhook.OwnerReferenceHandler(), ownerreference.Handler(cfg))), |
|  |  | route.Cordoning(tenant.CordoningHandler(cfg), tenant.ResourceCounterHandler()), |
|  |  | route.Node(utils.InCapsuleGroups(cfg, node.UserMetadataHandler(cfg, kubeVersion))), |
|  |  | ) |
| Expand Down | |  |

35 changes: 35 additions & 0 deletions

35
[pkg/utils/node\_selector.go](#diff-03164b2bf01b1102562f8c25e0ad224ac409b634f3d44d886453b655ee7b8395 "pkg/utils/node_selector.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/utils/node_selector.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,35 @@ |
|  |  | // Copyright 2020-2021 Clastix Labs |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | package utils |
|  |  |  |
|  |  | import ( |
|  |  | "fmt" |
|  |  | "sort" |
|  |  | "strings" |
|  |  |  |
|  |  | capsulev1beta1 "github.com/clastix/capsule/api/v1beta1" |
|  |  | ) |
|  |  |  |
|  |  | const ( |
|  |  | NodeSelectorAnnotation = "scheduler.alpha.kubernetes.io/node-selector" |
|  |  | ) |
|  |  |  |
|  |  | func BuildNodeSelector(tnt \*capsulev1beta1.Tenant, nsAnnotations map[string]string) map[string]string { |
|  |  | if nsAnnotations == nil { |
|  |  | nsAnnotations = make(map[string]string) |
|  |  | } |
|  |  |  |
|  |  | selector := make([]string, 0, len(tnt.Spec.NodeSelector)) |
|  |  |  |
|  |  | for k, v := range tnt.Spec.NodeSelector { |
|  |  | selector = append(selector, fmt.Sprintf("%s=%s", k, v)) |
|  |  | } |
|  |  | // Sorting the resulting slice: iterating over maps is randomized, and we could end-up |
|  |  | // in multiple reconciliations upon multiple node selectors. |
|  |  | sort.Strings(selector) |
|  |  |  |
|  |  | nsAnnotations[NodeSelectorAnnotation] = strings.Join(selector, ",") |
|  |  |  |
|  |  | return nsAnnotations |
|  |  | } |

4 changes: 2 additions & 2 deletions

4
[pkg/webhook/namespace/freezed.go](#diff-469c2feaa59a8950dfa403e2b80e4c2a3c044e136e78f6f86797c8203966e889 "pkg/webhook/namespace/freezed.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/namespace/freezed.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,7 +69,7 @@ func (r \*freezedHandler) OnDelete(c client.Client, \_ \*admission.Decoder, recorde |
|  |  |  |
|  |  | tnt := tntList.Items[0] |
|  |  |  |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(req, r.configuration.UserGroups()) { |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(ctx, req, c, r.configuration.UserGroups()) { |
|  |  | recorder.Eventf(&tnt, corev1.EventTypeWarning, "TenantFreezed", "Namespace %s cannot be deleted, the current Tenant is freezed", req.Name) |
|  |  |  |
|  |  | response := admission.Denied("the selected Tenant is freezed") |
| Expand Down  Expand Up | | @@ -101,7 +101,7 @@ func (r \*freezedHandler) OnUpdate(c client.Client, decoder \*admission.Decoder, r |
|  |  |  |
|  |  | tnt := tntList.Items[0] |
|  |  |  |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(req, r.configuration.UserGroups()) { |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(ctx, req, c, r.configuration.UserGroups()) { |
|  |  | recorder.Eventf(&tnt, corev1.EventTypeWarning, "TenantFreezed", "Namespace %s cannot be updated, the current Tenant is freezed", ns.GetName()) |
|  |  |  |
|  |  | response := admission.Denied("the selected Tenant is freezed") |
| Expand Down | |  |

64 changes: 64 additions & 0 deletions

64
[pkg/webhook/namespace/owner\_reference.go](#diff-62aee7a2ad47d2c563b0ce1999fc6dcf60cb36aa883c8448152020411db07281 "pkg/webhook/namespace/owner_reference.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/namespace/owner_reference.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,64 @@ |
|  |  | // Copyright 2020-2021 Clastix Labs |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | package namespace |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "fmt" |
|  |  | "net/http" |
|  |  |  |
|  |  | corev1 "k8s.io/api/core/v1" |
|  |  | "k8s.io/client-go/tools/record" |
|  |  | "sigs.k8s.io/controller-runtime/pkg/client" |
|  |  | "sigs.k8s.io/controller-runtime/pkg/webhook/admission" |
|  |  |  |
|  |  | capsulewebhook "github.com/clastix/capsule/pkg/webhook" |
|  |  | "github.com/clastix/capsule/pkg/webhook/utils" |
|  |  | ) |
|  |  |  |
|  |  | type ownerReferenceHandler struct{} |
|  |  |  |
|  |  | func OwnerReferenceHandler() capsulewebhook.Handler { |
|  |  | return &ownerReferenceHandler{} |
|  |  | } |
|  |  |  |
|  |  | func (r \*ownerReferenceHandler) OnCreate(client.Client, \*admission.Decoder, record.EventRecorder) capsulewebhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | return nil |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func (r \*ownerReferenceHandler) OnDelete(client.Client, \*admission.Decoder, record.EventRecorder) capsulewebhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | return nil |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func (r \*ownerReferenceHandler) OnUpdate(\_ client.Client, decoder \*admission.Decoder, \_ record.EventRecorder) capsulewebhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | oldNs := &corev1.Namespace{} |
|  |  | if err := decoder.DecodeRaw(req.OldObject, oldNs); err != nil { |
|  |  | return utils.ErroredResponse(err) |
|  |  | } |
|  |  |  |
|  |  | newNs := &corev1.Namespace{} |
|  |  | if err := decoder.Decode(req, newNs); err != nil { |
|  |  | return utils.ErroredResponse(err) |
|  |  | } |
|  |  |  |
|  |  | if len(newNs.OwnerReferences) == 0 { |
|  |  | response := admission.Errored(http.StatusBadRequest, fmt.Errorf("the OwnerReference cannot be removed")) |
|  |  |  |
|  |  | return &response |
|  |  | } |
|  |  |  |
|  |  | if oldNs.GetOwnerReferences()[0].UID != newNs.GetOwnerReferences()[0].UID { |
|  |  | response := admission.Errored(http.StatusBadRequest, fmt.Errorf("the OwnerReference cannot be changed")) |
|  |  |  |
|  |  | return &response |
|  |  | } |
|  |  |  |
|  |  | return nil |
|  |  | } |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[pkg/webhook/namespace/patch.go](#diff-3fcfb1b6de60f7b8cd3355ad63107bdc911f899fc47e01c14e4cdc4f6cd4256b "pkg/webhook/namespace/patch.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/namespace/patch.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,6 @@ |
|  |  | // Copyright 2020-2021 Clastix Labs |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | package namespace |
|  |  |  |
|  |  | import ( |
| Expand Down | |  |

19 changes: 19 additions & 0 deletions

19
[pkg/webhook/namespace/user\_metadata.go](#diff-5737f569935ee7ad521603d5efa10cf010ae512dc8615524d4506264f1a6db31 "pkg/webhook/namespace/user_metadata.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/namespace/user_metadata.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,6 +112,25 @@ func (r \*userMetadataHandler) OnUpdate(client client.Client, decoder \*admission. |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if len(tnt.Spec.NodeSelector) > 0 { |
|  |  | v, ok := newNs.GetAnnotations()["scheduler.alpha.kubernetes.io/node-selector"] |
|  |  | if !ok { |
|  |  | response := admission.Denied("the node-selector annotation is enforced, cannot be removed") |
|  |  |  |
|  |  | recorder.Eventf(tnt, corev1.EventTypeWarning, "ForbiddenNodeSelectorDeletion", string(response.Result.Reason)) |
|  |  |  |
|  |  | return &response |
|  |  | } |
|  |  |  |
|  |  | if v != oldNs.GetAnnotations()["scheduler.alpha.kubernetes.io/node-selector"] { |
|  |  | response := admission.Denied("the the node-selector annotation is enforced, cannot be updated") |
|  |  |  |
|  |  | recorder.Eventf(tnt, corev1.EventTypeWarning, "ForbiddenNodeSelectorUpdate", string(response.Result.Reason)) |
|  |  |  |
|  |  | return &response |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | var labels, annotations map[string]string |
|  |  |  |
|  |  | for key, value := range newNs.GetLabels() { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[pkg/webhook/ownerreference/patching.go](#diff-8d11df8331828755c89fb6ffedc4b088c43f5412189f700a658ee9c0cdf0f9fc "pkg/webhook/ownerreference/patching.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/ownerreference/patching.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -49,7 +49,7 @@ func (h \*handler) OnDelete(client client.Client, decoder \*admission.Decoder, rec |
|  |  |  |
|  |  | func (h \*handler) OnUpdate(client client.Client, decoder \*admission.Decoder, recorder record.EventRecorder) capsulewebhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | return h.setOwnerRef(ctx, req, client, decoder, recorder) |
|  |  | return nil |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[pkg/webhook/tenant/cordoning.go](#diff-ef32153e105ab9451ec60f906b3de2e7e6a3a5aedcf3dafc085adaf0b67886ea "pkg/webhook/tenant/cordoning.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/tenant/cordoning.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,7 @@ func (h \*cordoningHandler) cordonHandler(ctx context.Context, clt client.Client, |
|  |  | } |
|  |  |  |
|  |  | tnt := tntList.Items[0] |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(req, h.configuration.UserGroups()) { |
|  |  | if tnt.IsCordoned() && utils.IsCapsuleUser(ctx, req, clt, h.configuration.UserGroups()) { |
|  |  | recorder.Eventf(&tnt, corev1.EventTypeWarning, "TenantFreezed", "%s %s/%s cannot be %sd, current Tenant is freezed", req.Kind.String(), req.Namespace, req.Name, strings.ToLower(string(req.Operation))) |
|  |  |  |
|  |  | response := admission.Denied(fmt.Sprintf("tenant %s is freezed: please, reach out to the system administrator", tnt.GetName())) |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[pkg/webhook/utils/in\_capsule\_groups.go](#diff-d09c8bff386409e0f6181cdd28b3ca7b68ae91bb307d274cbf665be20699e0f1 "pkg/webhook/utils/in_capsule_groups.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/utils/in_capsule_groups.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,7 +28,7 @@ type handler struct { |
|  |  |  |
|  |  | func (h \*handler) OnCreate(client client.Client, decoder \*admission.Decoder, recorder record.EventRecorder) webhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | if !IsCapsuleUser(req, h.configuration.UserGroups()) { |
|  |  | if !IsCapsuleUser(ctx, req, client, h.configuration.UserGroups()) { |
|  |  | return nil |
|  |  | } |
|  |  |  |
| Expand All | | @@ -44,7 +44,7 @@ func (h \*handler) OnCreate(client client.Client, decoder \*admission.Decoder, rec |
|  |  |  |
|  |  | func (h \*handler) OnDelete(client client.Client, decoder \*admission.Decoder, recorder record.EventRecorder) webhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | if !IsCapsuleUser(req, h.configuration.UserGroups()) { |
|  |  | if !IsCapsuleUser(ctx, req, client, h.configuration.UserGroups()) { |
|  |  | return nil |
|  |  | } |
|  |  |  |
| Expand All | | @@ -60,7 +60,7 @@ func (h \*handler) OnDelete(client client.Client, decoder \*admission.Decoder, rec |
|  |  |  |
|  |  | func (h \*handler) OnUpdate(client client.Client, decoder \*admission.Decoder, recorder record.EventRecorder) webhook.Func { |
|  |  | return func(ctx context.Context, req admission.Request) \*admission.Response { |
|  |  | if !IsCapsuleUser(req, h.configuration.UserGroups()) { |
|  |  | if !IsCapsuleUser(ctx, req, client, h.configuration.UserGroups()) { |
|  |  | return nil |
|  |  | } |
|  |  |  |
| Expand Down | |  |

26 changes: 25 additions & 1 deletion

26
[pkg/webhook/utils/is\_capsule\_user.go](#diff-6f9ff521a3c29d5c4157317807f2211bbf376e74e0bcb7578bc62816710c805f "pkg/webhook/utils/is_capsule_user.go")

Show comments

[View file](/projectcapsule/capsule/blob/75525ac19254b0c5111e34d7985e2be7bc8b1ac1/pkg/webhook/utils/is_capsule_user.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,19 +1,43 @@ |
|  |  | package utils |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "strings" |
|  |  |  |
|  |  | "k8s.io/apimachinery/pkg/fields" |
|  |  | "k8s.io/apimachinery/pkg/util/sets" |
|  |  | "sigs.k8s.io/controller-runtime/pkg/client" |
|  |  | "sigs.k8s.io/controller-runtime/pkg/webhook/admission" |
|  |  |  |
|  |  | capsulev1beta1 "github.com/clastix/capsule/api/v1beta1" |
|  |  | "github.com/clastix/capsule/pkg/utils" |
|  |  | ) |
|  |  |  |
|  |  | func IsCapsuleUser(req admission.Request, userGroups []string) bool { |
|  |  | func IsCapsuleUser(ctx context.Context, req admission.Request, clt client.Client, userGroups []string) bool { |
|  |  | groupList := utils.NewUserGroupList(req.UserInfo.Groups) |
|  |  | // if the user is a ServiceAccount belonging to the kube-system namespace, definitely, it's not a Capsule user |
|  |  | // and we can skip the check in case of Capsule user group assigned to system:authenticated |
|  |  | // (ref: https://github.com/clastix/capsule/issues/234) |
|  |  | if groupList.Find("system:serviceaccounts:kube-system") { |
|  |  | return false |
|  |  | } |
|  |  | // nolint:nestif |
|  |  | if sets.NewString(req.UserInfo.Groups...).Has("system:serviceaccounts") { |
|  |  | parts := strings.Split(req.UserInfo.Username, ":") |
|  |  |  |
|  |  | targetNamespace := parts[2] |
|  |  |  |
|  |  | if len(targetNamespace) > 0 { |
|  |  | tl := &capsulev1beta1.TenantList{} |
|  |  | if err := clt.List(ctx, tl, client.MatchingFieldsSelector{Selector: fields.OneTermEqualSelector(".status.namespaces", targetNamespace)}); err != nil { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | if len(tl.Items) == 1 { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | for \_, group := range userGroups { |
|  |  | if groupList.Find(group) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `75525ac`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F75525ac19254b0c5111e34d7985e2be7bc8b1ac1) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_9bb5ce28_20250115_212129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fsecurity%2Fadvisories%2FGHSA-x45c-cvp8-q4fm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fsecurity%2Fadvisories%2FGHSA-x45c-cvp8-q4fm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

* [Code](/projectcapsule/capsule)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  16](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

# Privilege escalation by ServiceAccount deployed in a Tenant Namespace

High

[prometherion](/prometherion)
published
GHSA-x45c-cvp8-q4fm
Dec 2, 2022

## Package

gomod

github.com/clastix/capsule
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<= 0.1.2

## Patched versions

0.1.3

## Description

A ServiceAccount deployed in a Tenant Namespace, when granted with `PATCH` capabilities on its own Namespace, is able to edit it and remove the Owner Reference, breaking the reconciliation of the Capsule Operator and removing all the enforcement like Pod Security annotations, Network Policies, Limit Range and Resource Quota items.

With that said, an attacker could detach the Namespace from a Tenant that is forbidding starting privileged Pods using the Pod Security labels by removing the OwnerReference, removing the enforcement labels, and being able to start privileged containers that would be able to start a generic Kubernetes privilege escalation.

### Patches

Patches have been released for version 0.1.3 and all users must upgrade to this release.

### Workarounds

N.A.

### References

N.A.

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [github.com/clastix/capsule](https://github.com/clastix/capsule)
* Reach out on [#capsule](https://kubernetes.slack.com/archives/C03GETTJQRL) channel available on Kubernetes Slack workspace

### Severity

High

### CVE ID

CVE-2022-46167

### Weaknesses

No CWEs

### Credits

* [![@MaxFedotov](https://avatars.githubusercontent.com/u/12863390?s=40&v=4)](/MaxFedotov)
  [MaxFedotov](/MaxFedotov)
  Analyst
* [![@whatev3n](https://avatars.githubusercontent.com/u/120133323?s=40&v=4)](/whatev3n)
  [whatev3n](/whatev3n)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_9f1ac020_20250115_081558.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F1df430e71be8c4778c82eca3459978ad7d0b4b7b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F1df430e71be8c4778c82eca3459978ad7d0b4b7b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

* [Code](/projectcapsule/capsule)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  12](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

## Commit

[Permalink](/projectcapsule/capsule/commit/1df430e71be8c4778c82eca3459978ad7d0b4b7b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

test: preventing serviceaccount privilege escalation

[Browse files](/projectcapsule/capsule/tree/1df430e71be8c4778c82eca3459978ad7d0b4b7b)
Browse the repository at this point in the history

* Loading branch information

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)](/prometherion)

[prometherion](/projectcapsule/capsule/commits?author=prometherion "View all commits by prometherion")
committed
Dec 2, 2022

1 parent
[75525ac](/projectcapsule/capsule/commit/75525ac19254b0c5111e34d7985e2be7bc8b1ac1)

commit 1df430e

Showing
**1 changed file**
with
**146 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

146 changes: 146 additions & 0 deletions

146
[e2e/sa\_prevent\_privilege\_escalation\_test.go](#diff-944dc4a8752a2c52ed75cb34e50e0ed9a25f9928761f605bd1a5bc29964d0233 "e2e/sa_prevent_privilege_escalation_test.go")

Show comments

[View file](/projectcapsule/capsule/blob/1df430e71be8c4778c82eca3459978ad7d0b4b7b/e2e/sa_prevent_privilege_escalation_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,146 @@ |
|  |  | //go:build e2e |
|  |  |  |
|  |  | // Copyright 2020-2021 Clastix Labs |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | package e2e |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "fmt" |
|  |  | "time" |
|  |  |  |
|  |  | . "github.com/onsi/ginkgo" |
|  |  | . "github.com/onsi/gomega" |
|  |  | rbacv1 "k8s.io/api/rbac/v1" |
|  |  | metav1 "k8s.io/apimachinery/pkg/apis/meta/v1" |
|  |  | "k8s.io/apimachinery/pkg/types" |
|  |  | "k8s.io/apimachinery/pkg/util/uuid" |
|  |  | "k8s.io/client-go/kubernetes" |
|  |  | "sigs.k8s.io/controller-runtime/pkg/client/config" |
|  |  |  |
|  |  | capsulev1beta1 "github.com/clastix/capsule/api/v1beta1" |
|  |  | ) |
|  |  |  |
|  |  | var \_ = Describe("trying to escalate from a Tenant Namespace ServiceAccount", func() { |
|  |  | tnt := &capsulev1beta1.Tenant{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "sa-privilege-escalation", |
|  |  | }, |
|  |  | Spec: capsulev1beta1.TenantSpec{ |
|  |  | Owners: capsulev1beta1.OwnerListSpec{ |
|  |  | { |
|  |  | Name: "mario", |
|  |  | Kind: "User", |
|  |  | }, |
|  |  | }, |
|  |  | NodeSelector: map[string]string{ |
|  |  | "kubernetes.io/os": "linux", |
|  |  | }, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | ns := NewNamespace("attack") |
|  |  |  |
|  |  | JustBeforeEach(func() { |
|  |  | EventuallyCreation(func() error { |
|  |  | return k8sClient.Create(context.TODO(), tnt) |
|  |  | }).Should(Succeed()) |
|  |  |  |
|  |  | NamespaceCreation(ns, tnt.Spec.Owners[0], defaultTimeoutInterval).Should(Succeed()) |
|  |  | TenantNamespaceList(tnt, defaultTimeoutInterval).Should(ContainElement(ns.GetName())) |
|  |  | }) |
|  |  |  |
|  |  | JustAfterEach(func() { |
|  |  | Expect(k8sClient.Delete(context.TODO(), tnt)).Should(Succeed()) |
|  |  | }) |
|  |  |  |
|  |  | It("should block Namespace changes", func() { |
|  |  | role := rbacv1.Role{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "ns-update-role", |
|  |  | Namespace: ns.GetName(), |
|  |  | }, |
|  |  | Rules: []rbacv1.PolicyRule{ |
|  |  | { |
|  |  | Verbs: []string{"update"}, |
|  |  | APIGroups: []string{""}, |
|  |  | Resources: []string{"namespaces"}, |
|  |  | ResourceNames: []string{ns.GetName()}, |
|  |  | }, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | EventuallyCreation(func() error { |
|  |  | return k8sClient.Create(context.Background(), &role) |
|  |  | }).Should(Succeed()) |
|  |  |  |
|  |  | rolebinding := rbacv1.RoleBinding{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "attacker-rolebinding", |
|  |  | Namespace: ns.GetName(), |
|  |  | }, |
|  |  | Subjects: []rbacv1.Subject{ |
|  |  | { |
|  |  | Kind: "ServiceAccount", |
|  |  | Name: "attacker", |
|  |  | Namespace: ns.GetName(), |
|  |  | }, |
|  |  | }, |
|  |  | RoleRef: rbacv1.RoleRef{ |
|  |  | APIGroup: "rbac.authorization.k8s.io", |
|  |  | Kind: "Role", |
|  |  | Name: role.GetName(), |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | EventuallyCreation(func() error { |
|  |  | return k8sClient.Create(context.Background(), &rolebinding) |
|  |  | }).Should(Succeed()) |
|  |  |  |
|  |  | c, err := config.GetConfig() |
|  |  | Expect(err).ToNot(HaveOccurred()) |
|  |  | c.Impersonate.Groups = []string{"system:serviceaccounts"} |
|  |  | c.Impersonate.UserName = fmt.Sprintf("system:serviceaccount:%s:%s", rolebinding.Subjects[0].Namespace, rolebinding.Subjects[0].Name) |
|  |  | saClient, err := kubernetes.NewForConfig(c) |
|  |  | Expect(err).ToNot(HaveOccurred()) |
|  |  | // Changing Owner Reference is forbidden |
|  |  | Consistently(func() error { |
|  |  | if err := k8sClient.Get(context.Background(), types.NamespacedName{Name: ns.GetName()}, ns); err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | ns.OwnerReferences[0].UID = uuid.NewUUID() |
|  |  |  |
|  |  | \_, err = saClient.CoreV1().Namespaces().Update(context.Background(), ns, metav1.UpdateOptions{}) |
|  |  |  |
|  |  | return err |
|  |  | }, 10\*time.Second, time.Second).ShouldNot(Succeed()) |
|  |  | // Removing Owner Reference is forbidden |
|  |  | Consistently(func() error { |
|  |  | if err := k8sClient.Get(context.Background(), types.NamespacedName{Name: ns.GetName()}, ns); err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | ns.SetOwnerReferences(nil) |
|  |  |  |
|  |  | \_, err = saClient.CoreV1().Namespaces().Update(context.Background(), ns, metav1.UpdateOptions{}) |
|  |  |  |
|  |  | return err |
|  |  | }, 10\*time.Second, time.Second).ShouldNot(Succeed()) |
|  |  | // Breaking nodeSelector is forbidden |
|  |  | Consistently(func() error { |
|  |  | if err := k8sClient.Get(context.Background(), types.NamespacedName{Name: ns.GetName()}, ns); err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | ns.SetAnnotations(map[string]string{ |
|  |  | "scheduler.alpha.kubernetes.io/node-selector": "kubernetes.io/os=forbidden", |
|  |  | }) |
|  |  |  |
|  |  | \_, err = saClient.CoreV1().Namespaces().Update(context.Background(), ns, metav1.UpdateOptions{}) |
|  |  |  |
|  |  | return err |
|  |  | }, 10\*time.Second, time.Second).ShouldNot(Succeed()) |
|  |  | }) |
|  |  | }) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1df430e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fcommit%2F1df430e71be8c4778c82eca3459978ad7d0b4b7b) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_77f429c8_20250115_212129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fissues%2F621)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fissues%2F621)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=projectcapsule%2Fcapsule)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule](/projectcapsule/capsule)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2Fprojectcapsule%2Fcapsule)
* [Star
   1.7k](/login?return_to=%2Fprojectcapsule%2Fcapsule)

* [Code](/projectcapsule/capsule)
* [Issues
  36](/projectcapsule/capsule/issues)
* [Pull requests
  16](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects
  0](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule)
* [Issues](/projectcapsule/capsule/issues)
* [Pull requests](/projectcapsule/capsule/pulls)
* [Discussions](/projectcapsule/capsule/discussions)
* [Actions](/projectcapsule/capsule/actions)
* [Projects](/projectcapsule/capsule/projects)
* [Security](/projectcapsule/capsule/security)
* [Insights](/projectcapsule/capsule/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fprojectcapsule%2Fcapsule%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fprojectcapsule%2Fcapsule%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Include gosec in CI pipeline #621

Closed

[alegrey91](/alegrey91) opened this issue
Jul 27, 2022
¬∑ 0 comments
 ¬∑ Fixed by [#622](https://github.com/projectcapsule/capsule/pull/622)

Closed

# [Include gosec in CI pipeline](#top) #621

[alegrey91](/alegrey91) opened this issue
Jul 27, 2022
¬∑ 0 comments
 ¬∑ Fixed by [#622](https://github.com/projectcapsule/capsule/pull/622)

Assignees
[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=40&v=4)](/alegrey91)

Labels
[enhancement](/projectcapsule/capsule/labels/enhancement)
New feature or request

Milestone
[v0.1.3](/projectcapsule/capsule/milestone/5 "v0.1.3")

## Comments

[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=80&u=fcd1d86ec3175a0f0a0626d39ff46e668359c16b&v=4)](/alegrey91)

Copy link

Contributor

### **[alegrey91](/alegrey91)** commented [Jul 27, 2022](#issue-1319137895)

| Describe the feature [gosec](https://github.com/securego/gosec) is a Golang Security Checker. It inspects source code for security problems by scanning the Go AST. I would include this in our pipeline. What would the new user story look like? A new user comes and wants to contribute to capsule. He writes some Go code and pushes it to its branch. At this time, the CI checks for the new code and detects if there are security issues.  Hopefully, the result should be like this:  ``` ... [gosec] 2022/07/27 09:18:16 Checking package: service                                                                                                                                                                                          [gosec] 2022/07/27 09:18:16 Checking file: capsule/pkg/webhook/service/errors.go                                                                                                                        [gosec] 2022/07/27 09:18:16 Checking file: capsule/pkg/webhook/service/validating.go                                                                                                                    [gosec] 2022/07/27 09:18:17 Checking package: utils                                                                                                                                                                                            [gosec] 2022/07/27 09:18:17 Checking file: capsule/pkg/webhook/utils/error.go                                                                                                                           [gosec] 2022/07/27 09:18:17 Checking file: capsule/pkg/webhook/utils/in_capsule_groups.go                                                                                                               [gosec] 2022/07/27 09:18:17 Checking file: capsule/pkg/webhook/utils/is_capsule_user.go                                                                                                                 [gosec] 2022/07/27 09:18:17 Checking file: capsule/pkg/webhook/utils/is_tenant_owner.go                                                                                                                 [gosec] 2022/07/27 09:18:17 Checking file: capsule/pkg/webhook/utils/kubernetes_version.go                                                                                                              Results:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Summary:                                                                                                                                                                                                                                         Gosec  : 2.12.0                                                                                                                                                                                                                                Files  : 135                                                                                                                                                                                                                                   Lines  : 9714                                                                                                                                                                                                                                  Nosec  : 0                                                                                                                                                                                                                                     Issues : 0  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=40&u=fcd1d86ec3175a0f0a0626d39ff46e668359c16b&v=4)](/alegrey91)
[alegrey91](/alegrey91)
added
the
[blocked-needs-validation](/projectcapsule/capsule/labels/blocked-needs-validation)
Issue need triage and validation
label
[Jul 27, 2022](#event-7070424538)

[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=40&u=fcd1d86ec3175a0f0a0626d39ff46e668359c16b&v=4)](/alegrey91)
[alegrey91](/alegrey91)
self-assigned this
[Jul 27, 2022](#event-7070427669)

[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=40&u=fcd1d86ec3175a0f0a0626d39ff46e668359c16b&v=4)](/alegrey91)
[alegrey91](/alegrey91)
mentioned this issue
[Jul 27, 2022](#ref-pullrequest-1319143188)

[ci: add gosec pipeline
#622](/projectcapsule/capsule/pull/622)
 Merged

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
added this to the [v0.2.0](/projectcapsule/capsule/milestone/4) milestone
[Aug 1, 2022](#event-7098889410)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
added
[enhancement](/projectcapsule/capsule/labels/enhancement)
New feature or request
and removed
[blocked-needs-validation](/projectcapsule/capsule/labels/blocked-needs-validation)
Issue need triage and validation
labels
[Aug 1, 2022](#event-7098889951)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
closed this as [completed](/projectcapsule/capsule/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#622](/projectcapsule/capsule/pull/622)
[Aug 1, 2022](#event-7098891502)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
modified the milestones:
[v0.2.0](/projectcapsule/capsule/milestone/4),
[v0.1.3](/projectcapsule/capsule/milestone/5)
[Dec 2, 2022](#event-7940790587)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule%2Fissues%2F621)

Assignees

[![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=40&v=4)](/alegrey91) [alegrey91](/alegrey91)

Labels

[enhancement](/projectcapsule/capsule/labels/enhancement)
New feature or request

Projects

None yet

Milestone

 [**v0.1.3**](/projectcapsule/capsule/milestone/5 "v0.1.3")

Development

Successfully merging a pull request may close this issue.

 [ci: add gosec pipeline](/projectcapsule/capsule/pull/622)
 [projectcapsule/capsule](/projectcapsule/capsule)

2 participants

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=52&v=4)](/prometherion) [![@alegrey91](https://avatars.githubusercontent.com/u/16689706?s=52&v=4)](/alegrey91)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from avatars.githubusercontent.com_23f179a4_20250115_212129.html ===
ÔøΩPNG

   
IHDR  ÔøΩ  ÔøΩ   ÔøΩ.ÔøΩb  ÔøΩIDATxÔøΩÔøΩÔøΩ—âÔøΩP@ÔøΩlÔøΩÀ∞ÔøΩÔøΩKÔøΩÔøΩB \_ÔøΩÔøΩYÔøΩ9
ÔøΩÔøΩÔøΩÔøΩsÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ|zÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$,cÔøΩÔøΩÔøΩÔøΩÔøΩ?€∑ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ[ÔøΩyÔøΩÔøΩÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩÔøΩIÔøΩÔøΩÔøΩÕöqÔøΩÔøΩÔøΩ+PÔøΩÔøΩWiÔøΩÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$|ÔøΩÔøΩ=3ÔøΩ8ÔøΩÔøΩAÔøΩÔøΩÔøΩoÔøΩÔøΩÔøΩe`∆ãÔøΩ“òW~ÔøΩÔøΩÔøΩÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩÔøΩÔøΩÔøΩq^OÔøΩÔøΩ\_8#>ÔøΩÿ∑ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩX AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; AÔøΩÔøΩÔøΩH; aÔøΩÔøΩoÔøΩÿ¨ÔøΩy=ÔøΩEÔøΩ{ÔøΩfÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ ÔøΩ}?ÔøΩÔøΩÔøΩf$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩÔøΩ v@ÔøΩÔøΩ b$ÔøΩ
  ÔøΩÔøΩÔøΩÔøΩ)ÔøΩ;ps    IENDÔøΩB`ÔøΩ
