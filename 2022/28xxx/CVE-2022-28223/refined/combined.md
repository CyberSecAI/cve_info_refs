=== Content from medium.com_bf5a2aa3_20250114_234433.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F57044425ac38&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40bertinjoseb%2Fpost-auth-rce-based-in-malicious-lua-plugin-script-upload-scada-controllers-located-in-russia-57044425ac38&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40bertinjoseb%2Fpost-auth-rce-based-in-malicious-lua-plugin-script-upload-scada-controllers-located-in-russia-57044425ac38&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Post auth RCE based in malicious LUA plugin script upload SCADA controllers located in Russia

[![@bertinjoseb](https://miro.medium.com/v2/resize:fill:88:88/0*XIOmKZzYAxh6AEsa.jpg)](/%40bertinjoseb?source=post_page---byline--57044425ac38--------------------------------)

[@bertinjoseb](/%40bertinjoseb?source=post_page---byline--57044425ac38--------------------------------)

¬∑

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4e5f5dee1e9e&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40bertinjoseb%2Fpost-auth-rce-based-in-malicious-lua-plugin-script-upload-scada-controllers-located-in-russia-57044425ac38&user=%40bertinjoseb&userId=4e5f5dee1e9e&source=post_page-4e5f5dee1e9e--byline--57044425ac38---------------------post_header-----------)

5 min read¬∑Mar 17, 2022

--

1

Listen

Share

Hello World

The following is a writeup about a research i did today at morning march 17 2022 , took me 3 hours and no breakfast, after lunch and succesful pwned i‚Äôm writing this.

The affected devices are controllers from a russian brand called tekon.ru

![]()

Tekon is responsable to manufacture SCADA devices for russian market specifically, controllers, hubs , modbus devices all focused for building equipment and SCADA enviroments.

I found more than 100+ devices connected to the internet all them located in Russia exclusively , those devices are running with default credentials almost all of them and anyone can connect to them and perform changes and actions as ‚Äúadmin‚Äù only .

<https://www.shodan.io/search?query=country%3Aru+title%3A%22%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80%22&page=2>

![]()![]()

when you get the default index you will see something like this:

![]()

Everything is in russian but don‚Äôt worry gogle translate tab is your friend

![]()

After some research i found that tekon.ru did a great job put it in manuals firmwares and software related to easy access for anyone interested to take a look , in our case we need the manuals in order to dig for some default credentials , you know‚Ä¶ in our case we need to acces somehow someway ..

![]()

After translation and reading i found the default credentials which are ***admin:secret*** , trying the first result i was completely in, profit for me!!

![]()

Well now i‚Äôm in with defaults what can i do here ? and more importantly what kind of priviledges i have at this moment , you can enable the SSH access from the panel or even change the default password , so the engineers are not going to be able to acces again if you do that ‚Ä¶

![]()

So, with the SSH access my idea was to confirm what type of priviledges the user admin is running right now, for my surprise the admin user is not root, which is boomer at that point of the research .

![]()

Well, this means we can not do any interesting action with the admin user like command execution, we need to escalate privilegdes someway somehow .

After reading all manuals and learn about the device features i noticed there are some documented cgi scripts and some of them are not documented

![]()

in the path /srv/www/cgi-bin you can find those scripts , some of them are interesting like the serkill.cgi, you can call it and a process is going to be stoped

![]()

Well i was thinking‚Ä¶.. if i could upload my custom cgi script i could execute bash, but the user admin doesn‚Äôt have the permisions, permission is denied.

![]()

Mmm.. seriously i need to figure out how to upload my stuff here and execute commands, i knew i was closer.

After reading again the manuls for second time and playing around with the web app i found an interesting module for LUA script plugin upload and execution, just look for the plugin section .

![]()

According the manuals you can upload your custom LUA scripts ‚Äúplugins‚Äù and they are going to be executed after you click the save/load button

***Priviledge Escalation***

I though the following, LUA plugin should be running as root yes or yes , if i could upload a malicious LUA plugin with custom commands those are going to be executed as root and then i could place a custom cgi in /srv/www/cgi-bin path easily bypassing the admin user priviledges.

Ok here we go, open up your notepad++ and write some LUA code , in order to execute OS commands you just need os.excute

![]()

Save the LUA malicious plugin/code and create a .TAR file with 7 zip in windows

Upload the malicios LUA plugin

![]()

Then press save/load

![]()

At this point you‚Äôre blind and you don‚Äôt know if your code is being executed, but do you remember the cgi files i show you before ? well there is one for debug purposes and is called ***log.cgi***

![]()

invoke log.cgi

After upload the malicious LUA plugin just invoke log.cgi script , go to the bottom and you will see the output for the obscure LUA plugin

BOOM !! WE GOT RCE AND PRIVILEDGE ESCALATION üòé

NOW WE ARE ROOT !!!

![]()

1337

Let‚Äôs try with cat /etc/passwd

![]()

Yeah !! there you go üòé gimme the shit

![]()

cat /etc/passwd

Well i got RCE and privilege escalation from an admin user to root , now we can do whatever, more critically those devices can be shut down at once the 100 creating an impact in russian scada systems , remotely.

From this point now we can create custom cgi files and call them from cgi/bin path and do whatever .

You can follow on twitter for more ‚Äúon the fly‚Äù research and pwn delivery [@bertinjoseb](https://medium.com/u/4e5f5dee1e9e?source=post_page---user_mention--57044425ac38--------------------------------)

Thanks

--

--

1

[![@bertinjoseb](https://miro.medium.com/v2/resize:fill:96:96/0*XIOmKZzYAxh6AEsa.jpg)](/%40bertinjoseb?source=post_page---post_author_info--57044425ac38--------------------------------)[![@bertinjoseb](https://miro.medium.com/v2/resize:fill:128:128/0*XIOmKZzYAxh6AEsa.jpg)](/%40bertinjoseb?source=post_page---post_author_info--57044425ac38--------------------------------)Follow[## Written by @bertinjoseb](/%40bertinjoseb?source=post_page---post_author_info--57044425ac38--------------------------------)[102 Followers](/%40bertinjoseb/followers?source=post_page---post_author_info--57044425ac38--------------------------------)¬∑[321 Following](/%40bertinjoseb/following?source=post_page---post_author_info--57044425ac38--------------------------------)

Computer/Network security researcher X : bertinjoseb

Follow
## Responses (1)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----57044425ac38--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----57044425ac38--------------------------------)[About](/about?autoplay=1&source=post_page-----57044425ac38--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----57044425ac38--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----57044425ac38--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----57044425ac38--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----57044425ac38--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----57044425ac38--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----57044425ac38--------------------------------)[Teams](/business?source=post_page-----57044425ac38--------------------------------)


