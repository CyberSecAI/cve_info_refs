=== Content from weechat.org_bf7e76c6_20250114_221918.html ===

[![WeeChat](/media/images/weechat_logo_small.png)](/)

[Home](/)
[About](/about/)
[Documentation](/doc/)
[Download](/download/)
[Scripts](/scripts/)
[Development](/dev/)

[Donate](/donate/ "Donate")

English
Français
Deutsch
Italiano
Polski
Portugues (Brasil)
日本語

* [WeeChat](/doc/weechat/stable/)
* [WeeChat Relay](/doc/weechat-relay/stable/)
* [QWeeChat](/doc/qweechat/stable/)

* [Stable](/doc/weechat/stable/)
* [Development](/doc/weechat/devel/)
* [Security](/doc/weechat/security/)

* [All vulnerabilities](/doc/weechat/security/)
* [Vulnerabilities by version](/doc/weechat/security/version/)

#### Overview: 1 vulnerability

| WSA | CVE | Score | Severity | Issue | Vulnerability type | Scope | Versions | Fix Release date | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [WSA-2022-1](#WSA-2022-1) | CVE-2022-28352 | 4.3 |  | Possible man-in-the-middle attack in TLS connection to servers. | Improper certificate validation | IRC, Plugins | 3.2 → 3.4 | 3.4.1 | Mar 13, 2022 |

#### [WSA-2022-1](/doc/weechat/security/WSA-2022-1/): [IRC, Plugins] Possible man-in-the-middle attack in TLS connection to servers.

##### Vulnerability

CVE

CVE-2022-28352
[
[MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-28352) /
[NVD](https://nvd.nist.gov/vuln/detail/CVE-2022-28352)
]

CVSS vector

AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N
([detail](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N&version=3.1))

CVSS score

4.3
 / 10

Severity

medium

Vulnerability type

Improper certificate validation
([detail](https://cwe.mitre.org/data/definitions/295.html))

Scope

IRC, Plugins

Affected versions

3.2 → 3.4

Fixed version

3.4.1

(Mar 13, 2022)
-
[ChangeLog](/files/doc/weechat/ChangeLog-3.4.1.html)

Tracker

[issue #1763](https://github.com/weechat/weechat/issues/1763)

Commits

[Commit](https://github.com/weechat/weechat/commit/710247891cdfd4e66ee6d1715e93626def6871f1)

##### Description

After changing the options `weechat.network.gnutls_ca_system` or `weechat.network.gnutls_ca_user`, the TLS verification function is lost.

Consequently, any connection to a server with TLS is made without verifying the certificate, which could lead to a man-in-the-middle attack.

Connection to IRC servers with TLS is affected, as well as any connection a server made by a plugin or a script using the function hook\_connect.
##### Mitigation

After changing options `weechat.network.gnutls_ca_system` or `weechat.network.gnutls_ca_user`, you must restart WeeChat.

* [Home](/)
* [Latest news](/news/)
* [Upcoming events](/events/)
* [Make a donation](/donate/)

* [About](/about/)
* [Features](/about/features/)
* [Interfaces](/about/interfaces/)
* [Screenshots](/about/screenshots/)
* [History](/about/history/)
* [Support](/about/support/)
* [WeeChat.org](/about/weechat.org/)

* [Documentation](/doc/)
* [WeeChat](/doc/weechat/stable/)
* [WeeChat Relay](/doc/weechat-relay/stable/)
* [QWeeChat](/doc/qweechat/stable/)

* [Download](/download/)
* [WeeChat](/download/weechat/stable/)
* [WeeChat Relay](/download/weechat-relay/stable/)
* [QWeeChat](/download/qweechat/stable/)
* [Debian/Ubuntu repositories](/download/debian/)

* [Scripts](/scripts/)
* [Browse scripts](/scripts/)
* [Unofficial scripts](/files/scripts/unofficial/)
* [Python 3](/scripts/python3/)

* [Development](/dev/)
* [Roadmap](/dev/roadmap/)
* [Statistics](/dev/stats/)
* [Info](/dev/info/)
* [Development blog](https://blog.weechat.org/)

[GitHub](https://github.com/weechat "GitHub")
[Mastodon](https://hostux.social/%40weechat "Mastodon")
[Diaspora](https://diasp.eu/u/weechat "Diaspora")
[X](https://x.com/WeeChatClient "X")

Copyright © 2003-2025 Sébastien Helleu
—
[About WeeChat.org](/about/weechat.org/)
— Theme: **dark**
([light](?theme=light))



=== Content from github.com_67ab93d9_20250114_221918.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweechat%2Fweechat%2Fissues%2F1763)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweechat%2Fweechat%2Fissues%2F1763)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=weechat%2Fweechat)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[weechat](/weechat)
/
**[weechat](/weechat/weechat)**
Public

* [Notifications](/login?return_to=%2Fweechat%2Fweechat) You must be signed in to change notification settings
* [Fork
  333](/login?return_to=%2Fweechat%2Fweechat)
* [Star
   3k](/login?return_to=%2Fweechat%2Fweechat)

* [Code](/weechat/weechat)
* [Issues
  383](/weechat/weechat/issues)
* [Pull requests
  45](/weechat/weechat/pulls)
* [Actions](/weechat/weechat/actions)
* [Projects
  0](/weechat/weechat/projects)
* [Wiki](/weechat/weechat/wiki)
* [Security](/weechat/weechat/security)
* [Insights](/weechat/weechat/pulse)

Additional navigation options

* [Code](/weechat/weechat)
* [Issues](/weechat/weechat/issues)
* [Pull requests](/weechat/weechat/pulls)
* [Actions](/weechat/weechat/actions)
* [Projects](/weechat/weechat/projects)
* [Wiki](/weechat/weechat/wiki)
* [Security](/weechat/weechat/security)
* [Insights](/weechat/weechat/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fweechat%2Fweechat%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fweechat%2Fweechat%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Having to re-set the weechat.network.gnutls\_ca\_user env variable every single session. #1763

Closed

[nguyenhuy-hoanganh](/nguyenhuy-hoanganh) opened this issue
Mar 12, 2022
· 6 comments

Closed

# [Having to re-set the weechat.network.gnutls\_ca\_user env variable every single session.](#top) #1763

[nguyenhuy-hoanganh](/nguyenhuy-hoanganh) opened this issue
Mar 12, 2022
· 6 comments

Assignees
[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)

Labels
[question](/weechat/weechat/labels/question)
General question

Milestone
[3.5](/weechat/weechat/milestone/29 "3.5")

## Comments

[![@nguyenhuy-hoanganh](https://avatars.githubusercontent.com/u/99663623?s=80&v=4)](/nguyenhuy-hoanganh)

Copy link

### **[nguyenhuy-hoanganh](/nguyenhuy-hoanganh)** commented [Mar 12, 2022](#issue-1167283362) • edited Loading

| Question Everytime I start a session of Weechat and attempt to connect to a server, if the `weechat.network.gnutls_ca_user` config option has already been set to anything, or even nothing at all, and even when it ihas been correctly set to `"/etc/ssl/certs/ca-certificates.crt"` from previous sessions, I always encounter certificate issues with gnutils and thus TLS handshake will fail, disallowing me from making a secure connection to any server (non-SSL connections still work, of course)  ```   gnutls: peer's certificate is NOT trusted   gnutls: peer's certificate issuer is unknown   irc: TLS handshake failed   irc: error: Error in the certificate.  ```  *However*, if I then proceed to `/set weechat.network.gnutls_ca_user` to something **else**, and then *after* that, set it to the correct value with `/set weechat.network.gnutls_ca_user "/etc/ssl/certs/ca-certificates.crt"`, Weechat will handle SSL certificates and connect just fine like it is supposed to. But when I quit and the next time I start Weechat, the same issue shows up again, and then I have to manually set that configuration to something else wrong on purpose, then set it back right again, even when it is already correctly set from the get go!  I have already tried to find a way to circumvent this issue by starting weechat with a new config `weechat --dir /tmp/weechat`, and even there, the same issue happens after I quit and restart.  Right now, my only option to get around this issue is to probably use a script that can `/set weechat.network.gnutls_ca_user` to something different each time I quit the client, and then set the weechat client to run the correct `/set` command option on startup. Still though, I'd rather seek help to see why exactly my WeeChat is behaving this way.   ---  * WeeChat version: 3.4 * OS, distribution and version: EndeavourOS Linux x86\_64 |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@nguyenhuy-hoanganh](https://avatars.githubusercontent.com/u/99663623?s=40&v=4)](/nguyenhuy-hoanganh)
[nguyenhuy-hoanganh](/nguyenhuy-hoanganh)
added
the
[question](/weechat/weechat/labels/question)
General question
label
[Mar 12, 2022](#event-6229702374)

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=80&v=4)](/flashcode)

Copy link

Member

### **[flashcode](/flashcode)** commented [Mar 12, 2022](#issuecomment-1065882896)

| Hi,  The option `weechat.network.gnutls_ca_user` must be used only to set extra certificates, for example some custom certs, not the system ones. The system certificates are automatically loaded when `weechat.network.gnutls_ca_system` is `on` (default value), the path is automatically found, you don't have to set a path any more (since WeeChat 3.2).  Can you just connect fine when you run WeeChat with default config? If yes, why changing the option `weechat.network.gnutls_ca_user`?  Anyway there's maybe a bug, could you please give the steps to reproduce the problem, starting with the default config and providing commands to cause the issue?  Thanks. |
| --- |

All reactions

Sorry, something went wrong.

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)
[flashcode](/flashcode)
added
the
[waiting info](/weechat/weechat/labels/waiting%20info)
Waiting for info from author of issue
label
[Mar 12, 2022](#event-6229724024)

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)
[flashcode](/flashcode)
self-assigned this
[Mar 12, 2022](#event-6229724042)

[![@nguyenhuy-hoanganh](https://avatars.githubusercontent.com/u/99663623?s=80&v=4)](/nguyenhuy-hoanganh)

Copy link

Author

### **[nguyenhuy-hoanganh](/nguyenhuy-hoanganh)** commented [Mar 12, 2022](#issuecomment-1065893394)

| I did not realize that the option `weechat.network.gnutls_ca_user` was only used to set additional certs, I thought it was renamed from a deprecated `weechat.network.gnutls_ca_file` option and that it served the same function.  **Starting from the default config:**   1. Add example server: `server add blackaster gimel.blackaster.xyz/6697 -ssl` 2. Connect to that server: `connect blackaster`   Encounter cert issues:  ``` gnutls: peer's certificate is NOT trusted gnutls: peer's certificate issuer is unknown irc: TLS handshake failed irc: error: Error in the certificate.  ```  3. Disconnect from server, then `/set weechat.network.gnutls_ca_user` to random gibberish, putting anything inside the quotes, then set it back to the way it was before. 4. Now it is possible to connect to servers without any certificate issues.   It's starting to look like a bug to me. |
| --- |

All reactions

Sorry, something went wrong.

[![@trygveaa](https://avatars.githubusercontent.com/u/601966?s=80&v=4)](/trygveaa)

Copy link

Member

### **[trygveaa](/trygveaa)** commented [Mar 13, 2022](#issuecomment-1066102862)

| I can reproduce it with those steps. `gimel.blackaster.xyz` doesn't have a valid certificate though (it's self signed), so it seems like the bug here is that if you set `weechat.network.gnutls_ca_user` and then reconnect to a server you previously got a certificate error on, WeeChat will not verify if the certificate is valid and just connect to it. |
| --- |

All reactions

Sorry, something went wrong.

[![@nguyenhuy-hoanganh](https://avatars.githubusercontent.com/u/99663623?s=80&v=4)](/nguyenhuy-hoanganh)

Copy link

Author

### **[nguyenhuy-hoanganh](/nguyenhuy-hoanganh)** commented [Mar 13, 2022](#issuecomment-1066116567) • edited Loading

| I can reproduce it with those steps. `gimel.blackaster.xyz` doesn't have a valid certificate though (it's self signed), so it seems like the bug here is that if you set `weechat.network.gnutls_ca_user` and then reconnect to a server you previously got a certificate error on, WeeChat will not verify if the certificate is valid and just connect to it.  It's quite interesting that when WeeChat successfully reconnects to `gimel.blackaster.xyz` and I check myself with `/whois`, it does say that I have a secure connection, which makes sense since I use port 6697 for it, but somehow still strange, since obviously it was not verified.  I wonder if there is a way to make it so that for servers without a valid certificate only, WeeChat will just go ahead and connect to it instead of attempting to verify again? I'd still prefer to keep my `weechat.network.gnutls_ca_system` on, if possible. |
| --- |

All reactions

Sorry, something went wrong.

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=80&v=4)](/flashcode)

Copy link

Member

### **[flashcode](/flashcode)** commented [Mar 13, 2022](#issuecomment-1066132669)

| If the certificate is not valid, WeeChat is supposed to **NEVER** connect to it, unless you explicitly force the connection to bypass the certificate checking (with IRC options).  If playing with option `weechat.network.gnutls_ca_user` lets you connect, this is indeed a bug. I'll try to reproduce and then fix the problem. |
| --- |

All reactions

Sorry, something went wrong.

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)
[flashcode](/flashcode)
removed
the
[waiting info](/weechat/weechat/labels/waiting%20info)
Waiting for info from author of issue
label
[Mar 13, 2022](#event-6231306866)

[![@trygveaa](https://avatars.githubusercontent.com/u/601966?s=80&v=4)](/trygveaa)

Copy link

Member

### **[trygveaa](/trygveaa)** commented [Mar 13, 2022](#issuecomment-1066141394)

| It's quite interesting that when WeeChat successfully reconnects to `gimel.blackaster.xyz` and I check myself with `/whois`, it does say that I have a secure connection, which makes sense since I use port 6697 for it, but somehow still strange, since obviously it was not verified.  You're still using and encrypted TLS connection even though the certificate is not verified. The server has no way of knowing if you verified the certificate or not, so whois shows it as secure.  I wonder if there is a way to make it so that for servers without a valid certificate only, WeeChat will just go ahead and connect to it instead of attempting to verify again?  I assume you mean disable verification for specific servers, since just connecting to all servers without a valid certificate would be the same as just not doing any verification.  There's a couple of options here:   1. Set `irc.server.blackaster.ssl_fingerprint` to the fingerprint of the certificate. This means that instead of verifying that it's valid, WeeChat will verify that it's this specific certificate. If you know it's not compromised that's just as secure, but it means you have to update this option if the certificate changes. 2. Set the blackaster CA in `weechat.network.gnutls_ca_user`. This means any certificate they create will be accepted by WeeChat. This affects all servers though, not just your blackaster server. 3. Set `irc.server.blackaster.ssl_verify` to off. This disables verification so if they are compromised you won't notice it. So that's not recommended. |
| --- |

 👍
1
 nguyenhuy-hoanganh reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)
[flashcode](/flashcode)
closed this as [completed](/weechat/weechat/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[6004139](/weechat/weechat/commit/600413909804edfd32c53ea3d47db5b6d2871a89)`
[Mar 13, 2022](#event-6231374861)

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)
[flashcode](/flashcode)
added this to the [3.5](/weechat/weechat/milestone/29) milestone
[Mar 13, 2022](#event-6231375000)

[flashcode](/flashcode)
added a commit
that referenced
this issue
[Mar 13, 2022](#ref-commit-7102478)
[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode)

`[core: set again TLS verification functions after GnuTLS options are c…](/weechat/weechat/commit/710247891cdfd4e66ee6d1715e93626def6871f1 "core: set again TLS verification functions after GnuTLS options are changed (issue #1763)

When changing the options weechat.network.gnutls_ca_system or
weechat.network.gnutls_ca_user, the GnuTLS credentials are freed then allocated
again, but the verification function used to check the certificate on
connection is not set again.

As a consequence, any TLS connection is made without checking the certificate.

This regression was introduced in version 3.2, when the options were changed to
automatically load system certificates without having to give the path, and to
let user give an extra custom path with certificates.")`
…

`[7102478](/weechat/weechat/commit/710247891cdfd4e66ee6d1715e93626def6871f1)`

```
…hanged (issue [#1763](https://github.com/weechat/weechat/issues/1763))

When changing the options weechat.network.gnutls_ca_system or
weechat.network.gnutls_ca_user, the GnuTLS credentials are freed then allocated
again, but the verification function used to check the certificate on
connection is not set again.

As a consequence, any TLS connection is made without checking the certificate.

This regression was introduced in version 3.2, when the options were changed to
automatically load system certificates without having to give the path, and to
let user give an extra custom path with certificates.
```

[![@MingcongBai](https://avatars.githubusercontent.com/u/5006263?s=40&v=4)](/MingcongBai)
[MingcongBai](/MingcongBai)
mentioned this issue
[May 25, 2022](#ref-issue-1247304617)

[weechat: security update to ^3.4.1
AOSC-Dev/aosc-os-abbs#3996](/AOSC-Dev/aosc-os-abbs/issues/3996)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fweechat%2Fweechat%2Fissues%2F1763)

Assignees

[![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=40&v=4)](/flashcode) [flashcode](/flashcode)

Labels

[question](/weechat/weechat/labels/question)
General question

Projects

None yet

Milestone

 [**3.5**](/weechat/weechat/milestone/29 "3.5")

Development

No branches or pull requests

3 participants

[![@trygveaa](https://avatars.githubusercontent.com/u/601966?s=52&v=4)](/trygveaa) [![@flashcode](https://avatars.githubusercontent.com/u/1776783?s=52&v=4)](/flashcode) [![@nguyenhuy-hoanganh](https://avatars.githubusercontent.com/u/99663623?s=52&v=4)](/nguyenhuy-hoanganh)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


