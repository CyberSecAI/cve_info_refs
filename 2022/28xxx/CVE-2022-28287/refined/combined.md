=== Content from www.mozilla.org_e6c176ce_20250115_100501.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-13

## Security Vulnerabilities fixed in Firefox 99

Announced
April 5, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 99

#### [#CVE-2022-1097: Use-after-free in NSSToken objects](#CVE-2022-1097)

Reporter
Randell Jesup
Impact
high
##### Description

`NSSToken` objects were referenced via direct points, and could have been accessed in an unsafe way on different threads, leading to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1745667](https://bugzilla.mozilla.org/show_bug.cgi?id=1745667)

#### [#CVE-2022-28281: Out of bounds write due to unexpected WebAuthN Extensions](#CVE-2022-28281)

Reporter
Axel '0vercl0k' Souchet
Impact
high
##### Description

If a compromised content process sent an unexpected number of WebAuthN Extensions in a Register command to the parent process, an out of bounds write would have occurred leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1755621](https://bugzilla.mozilla.org/show_bug.cgi?id=1755621)

#### [#CVE-2022-28282: Use-after-free in DocumentL10n::TranslateDocument](#CVE-2022-28282)

Reporter
Kirin
Impact
moderate
##### Description

By using a link with `rel="localization"` a use-after-free could have been triggered by destroying an object during JavaScript execution and then referencing the object through a freed pointer, leading to a potentially exploitable crash.

##### References

* [Bug 1751609](https://bugzilla.mozilla.org/show_bug.cgi?id=1751609)

#### [#CVE-2022-28283: Missing security checks for fetching sourceMapURL](#CVE-2022-28283)

Reporter
Gijs
Impact
moderate
##### Description

The sourceMapURL feature in devtools was missing security checks that would have allowed a webpage to attempt to include local files or other files that should have been inaccessible.

##### References

* [Bug 1754066](https://bugzilla.mozilla.org/show_bug.cgi?id=1754066)

#### [#CVE-2022-28284: Script could be executed via svg's use element](#CVE-2022-28284)

Reporter
Leo Balter
Impact
moderate
##### Description

SVG's `<use>` element could have been used to load unexpected content that could have executed script in certain circumstances. While the specification seems to allow this, other browsers do not, and web developers relied on this property for script security so gecko's implementation was aligned with theirs.

##### References

* [Bug 1754522](https://bugzilla.mozilla.org/show_bug.cgi?id=1754522)

#### [#CVE-2022-28285: Incorrect AliasSet used in JIT Codegen](#CVE-2022-28285)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

When generating the assembly code for `MLoadTypedArrayElementHole`, an incorrect AliasSet was used. In conjunction with another vulnerability this could have been used for an out of bounds memory read.

##### References

* [Bug 1756957](https://bugzilla.mozilla.org/show_bug.cgi?id=1756957)

#### [#CVE-2022-28286: iframe contents could be rendered outside the border](#CVE-2022-28286)

Reporter
prada960808
Impact
low
##### Description

Due to a layout change, iframe contents could have been rendered outside of its border. This could have led to user confusion or spoofing attacks.

##### References

* [Bug 1735265](https://bugzilla.mozilla.org/show_bug.cgi?id=1735265)

#### [#CVE-2022-28287: Text Selection could crash Firefox](#CVE-2022-28287)

Reporter
Aryan Sinha
Impact
low
##### Description

In unusual circumstances, selecting text could cause text selection caching to behave incorrectly, leading to a crash.

##### References

* [Bug 1741515](https://bugzilla.mozilla.org/show_bug.cgi?id=1741515)

#### [#CVE-2022-24713: Denial of Service via complex regular expressions](#CVE-2022-24713)

Reporter
Addison Crump and Jan-Erik Rediger
Impact
low
##### Description

The rust regex crate did not properly prevent crafted regular expressions from taking an arbitrary amount of time during parsing. If an attacker was able to supply input to this crate, they could have caused a denial of service in the browser.

##### References

* [Bug 1758509](https://bugzilla.mozilla.org/show_bug.cgi?id=1758509)

#### [#CVE-2022-28289: Memory safety bugs fixed in Firefox 99 and Firefox ESR 91.8](#CVE-2022-28289)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Nika Layzell, Andrew McCreight, Gabriele Svelto, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 98 and Firefox ESR 91.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 99 and Firefox ESR 91.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1663508%2C1744525%2C1753508%2C1757476%2C1757805%2C1758549%2C1758776)

#### [#CVE-2022-28288: Memory safety bugs fixed in Firefox 99](#CVE-2022-28288)

Reporter
Mozilla developers
Impact
moderate
##### Description

Mozilla developers and community members Randell Jesup, Sebastian Hengst, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 98. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 99](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1746415%2C1746495%2C1746500%2C1747282%2C1748759%2C1749056%2C1749786%2C1751679%2C1752120%2C1756010%2C1756017%2C1757213%2C1757258%2C1757427)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_485ed5a0_20250115_100500.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1741515)
* [XML](/show_bug.cgi?ctype=xml&id=1741515)

Closed
[Bug 1741515](/show_bug.cgi?id=1741515)
(CVE-2022-28287)

Opened 3 years ago
Closed 3 years ago

# Maliciously crafted data triggers firefox to crash immediately

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Maliciously crafted data triggers firefox to crash immediately

## Categories

### (Core :: DOM: UI Events & Focus Handling, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling#DOM%3A%20UI%20Events%20%26%20Focus%20Handling)

DOM: UI Events & Focus Handling
▾

Core :: DOM: UI Events & Focus Handling
This component includes bugs for user input events, for example <https://w3c.github.io/uievents>, focus handling from <https://html.spec.whatwg.org>, and access key handling on a page.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

Windows 10

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox97 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=wontfix) |
| firefox98 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix) |
| firefox99 | --- | [verified](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox97 |  | wontfix |
| firefox98 |  | wontfix |
| firefox99 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sinha.aryan11, Assigned: masayuki)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/900caab146bc7a489b3854cf10acf93f?d=mm&size=40)  [masayuki](/user_profile?user_id=34283)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1a037b1fa165524e69672d8f88cabb02?d=mm&size=40)  [sinha.aryan11](/user_profile?user_id=612949)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1752956](/show_bug.cgi?id=1752956 "RESOLVED FIXED - `IMEContentObserver` should update selection cache before sending a text change notification")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1729003](/show_bug.cgi?id=1729003 "RESOLVED INCOMPLETE - Crash in [@ RaiseFailFastException]")

Dependency [tree](/showdependencytree.cgi?id=1741515&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1741515)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1758277](/show_bug.cgi?id=1758277 "RESOLVED DUPLICATE - Memory Corruption")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1758277](/show_bug.cgi?id=1758277 "RESOLVED DUPLICATE - Memory Corruption")

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main99+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-28287

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main99+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c20 "3 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | - |
| --- | --- | --- |
| [tjr](/user_profile?user_id=578488) | [sec-bounty-hof](#a13797706_578488 "3 years ago") | + |
| --- | --- | --- |
| [tjr](/user_profile?user_id=578488) | sec-bounty-hof | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ RaiseFailFastException ]](https://crash-stats.mozilla.org/signature/?signature=RaiseFailFastException)

[[@ RaiseFailFastException | FailFastWithHR ]](https://crash-stats.mozilla.org/signature/?signature=RaiseFailFastException%20%7C%20FailFastWithHR)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [bandicam 2021-11-17 03-52-43-478.mp4](/attachment.cgi?id=9251027)  [3 years ago](#c0)  [Aryan Sinha](/user_profile?user_id=612949)   5.44 MB, video/mp4 |  | [Details](/attachment.cgi?id=9251027&action=edit) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9269929)  [3 years ago](#c24)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   169 bytes, text/plain |  | [Details](/attachment.cgi?id=9269929&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Aryan Sinha](/user_profile?user_id=612949)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1741515#c0)• 3 years ago |
|  | |

Attached video
[bandicam 2021-11-17 03-52-43-478.mp4](attachment.cgi?id=9251027)
— [Details](attachment.cgi?id=9251027&action=edit)

## Summary:

I was testing another website during which I came across this vulnerability in Firefox, I confirmed that whether it is happening in any other browser, strangely I found that only Firefox, Developer, and Nightly are crashing. Hence I believe this is a bug at the Mozilla's Firefox end.

## Description:

I was testing Atlassian (JIRA) and found that tickets with a really small specific certain data lead firefox to crash immediately, when ctrl+A is pressed over them.

Sharing my Atlassian test a/c creds to quickly validate the issue. Attaching a video POC as well.

Login URL: <https://id.atlassian.com/login>

Email: aryan\_sinha21@bugcrowdninja.com

Password: z4HGd9XEssTy54T

## Reproduction Steps:

I have already created a ticket with data causing the firefox to crash, you can access it by:

1. Once you log in with the creds that I mentioned. Go to- <https://aryansinha.atlassian.net/browse/TES-3>
2. Scroll down the page, find the table in which I have listed the data along with multiple other tables. Click over that table with listed data and press ctrl+A. Firefox will immediately crash.

I have tested this in the following FIrefox's browser clients- Firefox, Developer, and Nightly.

Well honestly I would say I am not sure what led the firefox to crash, it was just the observation. Hence I would request the team to investigate the same at your end.

Thanks!

Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1741515#c1)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1741515&comment_id=15660680 "1 revision") |
|  | |

Please tick the checkbox to enable sending us crash reports, send us a crash report, and then link it in a comment here (ideally from Nightly).

Flags: needinfo?(sinha.aryan11)

|  | [Aryan Sinha](/user_profile?user_id=612949)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1741515#c2)• 3 years ago |
|  | |

Hi Gijs,

Please find the crash report here- <https://crash-stats.mozilla.org/report/index/4f5822b4-a95b-41aa-a84a-39a140211117>

Let me know if I can help with any other information, Thanks..!!

Flags: needinfo?(sinha.aryan11)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1741515#c3)• 3 years ago |
|  | |

The crash stack looks IME related.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a75017_406194)• 3 years ago |

Group: firefox-core-security → dom-core-securityComponent: Security → DOM: UI Events & Focus HandlingProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a75033_406194)• 3 years ago |

URL: [Firefox, Developer, and Nightly](Firefox%2C%20Developer%2C%20and%20Nightly)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1741515#c4)• 3 years ago |
|  | |

[Bug 1729003](/show_bug.cgi?id=1729003 "RESOLVED INCOMPLETE - Crash in [@ RaiseFailFastException]") is a preexisting bug on this crash signature.

[Looking at crash stats](https://crash-stats.mozilla.org/search/?signature=%3DRaiseFailFastException&proto_signature=~NotifyIME&product=Firefox&date=%3E%3D2021-08-17T19%3A48%3A00.000Z&date=%3C2021-11-17T19%3A48%3A00.000Z&_facets=signature&_sort=-date&_columns=date&_columns=signature&_columns=product&_columns=version&_columns=build_id&_columns=platform#facet-signature), there are around 1300 crash with this signature and NotifyIME in the proto signature, for what that is worth.

Blocks: [1729003](/show_bug.cgi?id=1729003 "RESOLVED INCOMPLETE - Crash in [@ RaiseFailFastException]")Crash Signature: [@ RaiseFailFastException ]

|  | [Aryan Sinha](/user_profile?user_id=612949)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1741515#c5)• 3 years ago |
|  | |

Thanks for the information Andrew. Are we in a process to fix this bug? As this could be a security problem as there are multiple ways to trigger this on victims' browser, one of such is javascript code snippets to trick victim process ctrl+A.

Flags: needinfo?(continuation)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1741515#c6)• 3 years ago |
|  | |

Yes, hopefully somebody can look at it. Generally speaking, crashing the browser is usually not a severe security issue, because users can restart the browser and just not visit the web page again, but we do try to avoid crashes.

Flags: needinfo?(continuation)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1741515#c7)• 3 years ago |
|  | |

This doesn't look like a security issue to me either, but it's a \_\_fastfail() crash which we wouldn't have caught just a few months ago. It's bad enough that Windows thinks the process is compromised beyond redemption.

We are deep in Microsoft code at the point where the crash occurs, but given that most of the functions on the stack look like wrappers it might be that we're feeding Windows IME some malformed data. My Windows knowledge in this area is limited; Msayuki, Makoto can you please help us debug this issue? I'm sure you're more familiar with this code than I am.

Flags: needinfo?(masayuki)Flags: needinfo?(m\_kato)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1741515#c8)• 3 years ago |
|  | |

My understand is that FastFailExcetion means that exception handler cannot catch an exception. General reason is that stack is corrupt, then Windows cannot look for exception handler.

So I guess that this is Microsoft's TSF bug on Windows 10 20H2+?

Flags: needinfo?(m\_kato)

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1741515#c9)• 3 years ago |
|  | |

> 6 textinputframework.dll long CQueryTextAsync::Then(class std::function<long (long, struct MsgString\*)) cfi
>
> 7 textinputframework.dll long TextInputClient::NotifyTextChangedInternal(class ClientOwnerRegistration\*, int, int, int, int, int, struct EditOperationInfo&, unsigned char, unsigned char) cfi

It seems that TSF queried text, selection, text extent etc in `TextInputClient::NotifyTextChangedInternal`. So it could be the direct cause of the crash what we return. However, TSF shouldn't crash even if apps return odd result. Before asking MS, we shold get a log of `TSFTextStore` and investigate what happens.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1741515#c10)• 3 years ago |
|  | |

I might be able to extract some information from the minidump by opening in VS if that could be useful. What would we be looking for? The parameters we passed into the textinputframework.dll calls?

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1741515#c11)• 3 years ago |
|  | |

Here is a log after selection change notification:

```
I/ContentCacheWidgets 0x1aa68d95b10 AssignContent(aNotification=NOTIFY_IME_OF_SELECTION_CHANGE), Succeeded, mText.Length()=1816, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=452, y=3524, w=1, h=24), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mFirstCharRect=(x=451, y=-95, w=1, h=24), mCaret={ mOffset=0, mRect=(x=451, y=-95, w=1, h=24) }, mTextRectArray=<Nothing>, mWidgetHasComposition=false, mPendingCompositionCount=0, mCompositionStart=<Nothing>, mPendingCommitLength=0, mEditorRect=(x=452, y=-95, w=1173, h=3646), mLastCommitStringTextRectArray=<Nothing>
D/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnSelectionChangeInternal(aIMENotification={ mSelectionChangeData={ mOffset=0, mString.Length()=1816, GetWritingMode()=h-ltr, mReversed=false, mCausedByComposition=false, mCausedBySelectionEvent=false, mOccurredDuringComposition=false } }), mDestroyed=false, mSink=0x1aa4f720ff8, mSinkMask=TS_AS_TEXT_CHANGE | TS_AS_SEL_CHANGE | TS_AS_LAYOUT_CHANGE | TS_AS_ATTR_CHANGE | TS_AS_STATUS_CHANGE, mIsRecordingActionsWithoutLock=false, mComposition=<Nothing>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::MaybeFlushPendingNotifications(), calling TSFTextStore::NotifyTSFOfSelectionChange()...
D/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfSelectionChange(), selection isn't actually changed.
I/ContentCacheWidgets 0x1aa68d95b10 AssignContent(aNotification=NOTIFY_IME_OF_POSITION_CHANGE), Succeeded, mText.Length()=1816, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=452, y=3524, w=1, h=24), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mFirstCharRect=(x=451, y=-95, w=1, h=24), mCaret={ mOffset=0, mRect=(x=451, y=-95, w=1, h=24) }, mTextRectArray=<Nothing>, mWidgetHasComposition=false, mPendingCompositionCount=0, mCompositionStart=<Nothing>, mPendingCommitLength=0, mEditorRect=(x=452, y=-95, w=1173, h=3646), mLastCommitStringTextRectArray=<Nothing>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnLayoutChangeInternal(), calling NotifyTSFOfLayoutChange()...
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), calling ITextStoreACPSink::OnLayoutChange()...
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::RequestLock(dwLockFlags=TS_LF_READ, phrSession=0x8f691fcb20), mLock=not-specified, mDestroyed=false
I/nsTextStoreWidgets 0x1aa5c00d310   Locking (TS_LF_READ) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::GetTextExt(vcView=1, acpStart=0, acpEnd=1816, prc=0x8f691fc2a0, pfClipped=0x8f691fc268), IsHandlingCompositionInParent()=false, IsHandlingCompositionInContent()=false, mContentForTSF=<Nothing>, mSelectionForTSF={ mACP={ acpStart=0, acpEnd=1816, style={ ase=TS_AE_END, fInterimChar=FALSE } }, mWritingMode=h-ltr,  Collapsed()=false, Length=1816 }, mComposition=<Nothing>, mDeferNotifyingTSF=false, mWaitingQueryLayout=false, IMEHandler::IsA11yHandlingNativeCaret()=true
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(aEvent={ mMessage=eQueryTextRect, mInput={ mOffset=0, mLength=1816 } }, aWidget=0x1aa544d1e00), mText.Length()=1816
I/ContentCacheWidgets 0x1aa68d95b10 GetUnionTextRects(aOffset=0, aLength=1816, aRoundToExistingOffset=false), mTextRectArray=<Nothing>, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=452, y=3524, w=1, h=24), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mLastCommitStringTextRectArray=<Nothing>
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(), Succeeded, aEvent={ mMessage=eQueryTextRect mReply={ mOffsetAndData={ mOffset=0, mData="CARRIAGE RETURN (0x000D) LINE FEED (0x000A) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) SPACE (0x0020) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) SPACE (0x0020) ... LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) NO-BREAK SPACE (0x00A0) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A)", Length()=1816, EndOffset()=1816 }, mHasSelection=false, mWritingMode=h-ltr, mContentsRoot=0x0000000000000000, mFocusedWidget=0x000001AA544D1E00, mRect=(x=452, y=-91, w=895, h=3578) } }
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::GetTextExt() succeeded: *prc={ left=915, top=88, right=1810, bottom=1940 }, *pfClipped=true
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310   Unlocked (TS_LF_READ) <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::RequestLock() succeeded: *phrSession=S_OK
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), called ITextStoreACPSink::OnLayoutChange()
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), succeeded notifying TIP of our layout change
D/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnLayoutChangeInternal(), calling MaybeFlushPendingNotifications()...
I/ContentCacheWidgets 0x1aa68d95b10 AssignContent(aNotification=NOTIFY_IME_OF_POSITION_CHANGE), Succeeded, mText.Length()=1816, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=452, y=3524, w=1, h=24), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mFirstCharRect=(x=451, y=-95, w=1, h=24), mCaret={ mOffset=0, mRect=(x=451, y=-95, w=1, h=24) }, mTextRectArray=<Nothing>, mWidgetHasComposition=false, mPendingCompositionCount=0, mCompositionStart=<Nothing>, mPendingCommitLength=0, mEditorRect=(x=452, y=-95, w=1173, h=3646), mLastCommitStringTextRectArray=<Nothing>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnLayoutChangeInternal(), calling NotifyTSFOfLayoutChange()...
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), calling ITextStoreACPSink::OnLayoutChange()...
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::RequestLock(dwLockFlags=TS_LF_READ, phrSession=0x8f691fcb20), mLock=not-specified, mDestroyed=false
I/nsTextStoreWidgets 0x1aa5c00d310   Locking (TS_LF_READ) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::GetTextExt(vcView=1, acpStart=0, acpEnd=1816, prc=0x8f691fc2a0, pfClipped=0x8f691fc268), IsHandlingCompositionInParent()=false, IsHandlingCompositionInContent()=false, mContentForTSF=<Nothing>, mSelectionForTSF={ mACP={ acpStart=0, acpEnd=1816, style={ ase=TS_AE_END, fInterimChar=FALSE } }, mWritingMode=h-ltr,  Collapsed()=false, Length=1816 }, mComposition=<Nothing>, mDeferNotifyingTSF=false, mWaitingQueryLayout=false, IMEHandler::IsA11yHandlingNativeCaret()=true
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(aEvent={ mMessage=eQueryTextRect, mInput={ mOffset=0, mLength=1816 } }, aWidget=0x1aa544d1e00), mText.Length()=1816
I/ContentCacheWidgets 0x1aa68d95b10 GetUnionTextRects(aOffset=0, aLength=1816, aRoundToExistingOffset=false), mTextRectArray=<Nothing>, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=452, y=3524, w=1, h=24), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mLastCommitStringTextRectArray=<Nothing>
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(), Succeeded, aEvent={ mMessage=eQueryTextRect mReply={ mOffsetAndData={ mOffset=0, mData="CARRIAGE RETURN (0x000D) LINE FEED (0x000A) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) SPACE (0x0020) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) NO-BREAK SPACE (0x00A0) SPACE (0x0020) ... LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) NO-BREAK SPACE (0x00A0) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A) CARRIAGE RETURN (0x000D) LINE FEED (0x000A)", Length()=1816, EndOffset()=1816 }, mHasSelection=false, mWritingMode=h-ltr, mContentsRoot=0x0000000000000000, mFocusedWidget=0x000001AA544D1E00, mRect=(x=452, y=-91, w=895, h=3578) } }
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::GetTextExt() succeeded: *prc={ left=915, top=88, right=1810, bottom=1940 }, *pfClipped=true
<snip>
I/nsTextStoreWidgets 0x1aa5c00d310   Unlocked (TS_LF_READ) <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::RequestLock() succeeded: *phrSession=S_OK
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), called ITextStoreACPSink::OnLayoutChange()
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfLayoutChange(), succeeded notifying TIP of our layout change
D/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnLayoutChangeInternal(), calling MaybeFlushPendingNotifications()...
I/ContentCacheWidgets 0x1aa68d95b10 AssignContent(aNotification=NOTIFY_IME_OF_TEXT_CHANGE), Succeeded, mText.Length()=1806, mSelection={ mAnchor=0, mFocus=1816, mWritingMode=h-ltr, mAnchorCharRects[eNextCharRect]=(x=451, y=-95, w=1, h=24), mFocusCharRects[ePrevCharRect]=(x=0, y=0, w=0, h=0), mFocusCharRects[eNextCharRect]=(x=452, y=3524, w=1, h=24), mRect=(x=452, y=-91, w=895, h=3578), Reversed()=false, StartOffset()=0, EndOffset()=1816, Collapsed()=false, Length()=1816 }, mFirstCharRect=(x=451, y=-95, w=1, h=24), mCaret={ mOffset=0, mRect=(x=451, y=-95, w=1, h=24) }, mTextRectArray=<Nothing>, mWidgetHasComposition=false, mPendingCompositionCount=0, mCompositionStart=<Nothing>, mPendingCommitLength=0, mEditorRect=(x=452, y=-95, w=1173, h=3646), mLastCommitStringTextRectArray=<Nothing>
D/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::OnTextChangeInternal(aIMENotification={ mMessage=0x00000004, mTextChangeData={ mStartOffset=1061, mRemoveEndOffset=1071, mAddedEndOffset=1061, mCausedOnlyByComposition=false, mIncludingChangesDuringComposition=false, mIncludingChangesWithoutComposition=true } }), mDestroyed=false, mSink=0x1aa4f720ff8, mSinkMask=TS_AS_TEXT_CHANGE | TS_AS_SEL_CHANGE | TS_AS_LAYOUT_CHANGE | TS_AS_ATTR_CHANGE | TS_AS_STATUS_CHANGE, mComposition=<Nothing>
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::MaybeFlushPendingNotifications(), calling TSFTextStore::NotifyTSFOfTextChange()...
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::NotifyTSFOfTextChange(), calling ITextStoreACPSink::OnTextChange(0, { acpStart=1061, acpOldEnd=1071, acpNewEnd=1061 })...
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::RequestLock(dwLockFlags=TS_LF_READ, phrSession=0x8f691fc9f4), mLock=not-specified, mDestroyed=false
I/nsTextStoreWidgets 0x1aa5c00d310   Locking (TS_LF_READ) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::GetSelection(ulIndex=4294967295, ulCount=1, pSelection=0x8f691fc560, pcFetched=0x8f691fc6b0)
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(aEvent={ mMessage=eQuerySelectedText }, aWidget=0x1aa544d1e00)
E/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(), FAILED because mSelection is not valid
I/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::GetSelection() returns fake selection range for avoiding a crash in TSF, *pSelection={ acpStart=0, acpEnd=0, style={ ase=TS_AE_START, fInterimChar=FALSE } }
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::GetText(acpStart=437, acpEnd=-1, pchPlain=0x7ffd1c4ca7e0, cchPlainReq=128, pcchPlainOut=0x8f691fbb10, prgRunInfo=0x7ffd1c4ca8f0, ulRunInfoReq=33, pulRunInfoOut=0x7ffd1c4ca8e4, pacpNext=0x7ffd1c4ca8e0), mComposition=<Nothing>
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(aEvent={ mMessage=eQuerySelectedText }, aWidget=0x1aa544d1e00)
E/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(), FAILED because mSelection is not valid
E/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::ContentForTSF(), FAILED, due to SelectionForTSF() failure
E/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::GetText() FAILED due to ContentForTSF() failure
I/nsTextStoreWidgets 0x1aa5c00d310 TSFTextStore::GetText(acpStart=469, acpEnd=495, pchPlain=0x1aa4f712290, cchPlainReq=26, pcchPlainOut=0x8f691fbe28, prgRunInfo=0x8f691fbbf0, ulRunInfoReq=16, pulRunInfoOut=0x8f691fbbc0, pacpNext=0x8f691fbbc4), mComposition=<Nothing>
I/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(aEvent={ mMessage=eQuerySelectedText }, aWidget=0x1aa544d1e00)
E/ContentCacheWidgets 0x1aa68d95b10 HandleQueryContentEvent(), FAILED because mSelection is not valid
E/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::ContentForTSF(), FAILED, due to SelectionForTSF() failure
E/nsTextStoreWidgets 0x1aa5c00d310   TSFTextStore::GetText() FAILED due to ContentForTSF() failure

```
Flags: needinfo?(masayuki)

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1741515#c12)• 3 years ago |
|  | |

First, the flattened plaintext of the editor has 1816 characters.

And first TSF requests selection text (union) rect and editor rect in screen. The latter is omitted from the log, but the complicated thing, computing union rect is succeeded and returns `{ left=915, top=88, right=1810, bottom=1940 }`. Then, we send layout change information twice. Although I don't know for what (caused by scrolling?). Then, we notified text change between 1061 ~ 1071 is removed.

Then, TSF retrieves selection range. At this time, we failed because `mSelection is not valid`. For avoiding to make TSF confused, we return collapsed selection at start of the document (`{ acpStart=0, acpEnd=0, style={ ase=TS_AE_START, fInterimChar=FALSE } }`). Then, TSF tries to retrieve text at 437 ~ end and 469 - 495. Both we fail to return correct value and [we return `E_FAIL`](https://searchfox.org/mozilla-central/rev/3881c4ca80d1b4b2f43be695438ecaf90ee4f86c/widget/windows/TSFTextStore.cpp#3716).

It seems that TSF or Microsoft's IME common code does not handle the error correctly. I don't reproduce this bug with ATOK which is a third party's Japanese IME. I tested this on Win11.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1741515#c13)• 3 years ago |
|  | |

Asking Microsoft's developer about the stack with telling that we return `E_FAIL` from `GetText()`...

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1741515#c14)• 3 years ago |
|  | |

(I'll keep investigating why `mSelection` becomes invalid with the flow.)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a1401022_8636)• 3 years ago |

Crash Signature: [@ RaiseFailFastException ] → [@ RaiseFailFastException ]
[@ RaiseFailFastException | FailFastWithHR ]

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1741515#c15)• 3 years ago |
|  | |

Filed our side failure as normal bug ([bug 1746104](/show_bug.cgi?id=1746104 "RESOLVED FIXED - ContentCacheInChild shouldn't stop caching text content etc when there is no selection")).

Crash Signature: [@ RaiseFailFastException ]
[@ RaiseFailFastException | FailFastWithHR ] → [@ RaiseFailFastException ]

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a2426091_34283)• 3 years ago |

Crash Signature: [@ RaiseFailFastException ] → [@ RaiseFailFastException ] [@ RaiseFailFastException | FailFastWithHR ]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a3109922_406194)• 3 years ago |

Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a3111613_575867)• 3 years ago |

Type: task → defect

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1741515#c16)• 3 years ago |
|  | |

(Set to S2 due to the crash, feel free to modify if you don't agree)

Severity: -- → S2

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1741515#c17)• 3 years ago |
|  | |

Unfortunately, fixing only [bug 1746104](/show_bug.cgi?id=1746104 "RESOLVED FIXED - ContentCacheInChild shouldn't stop caching text content etc when there is no selection") is not enough because I confirmed that there is another bug which makes `ContentCacheInParent` has different length text for selection and text. I'm still not sure what causes it, but I think that it should be relaxed for avoiding crash for now.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1741515#c18)• 3 years ago |
|  | |

Okay, I got the another bug which caused `TSFTextStore` fails to get selection. I filed [bug 1752956](/show_bug.cgi?id=1752956 "RESOLVED FIXED - `IMEContentObserver` should update selection cache before sending a text change notification") for fixing it.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1741515#c19)• 3 years ago |
|  | |

Now, the patches have landed. So this must be fixed in Nightly channel.

Assignee: nobody → masayukiStatus: NEW → RESOLVEDClosed: 3 years ago
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=wontfix)
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix)
[status-firefox99](/buglist.cgi?f1=cf_status_firefox99&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)
[status-thunderbird\_esr91](/buglist.cgi?f1=cf_status_thunderbird_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_thunderbird_esr91&o1=equals&v1=wontfix)OS: Unspecified → Windows 10Hardware: Unspecified → DesktopResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a7920891_75935)• 3 years ago |

Group: dom-core-security → core-security-release
[status-thunderbird\_esr91](/buglist.cgi?f1=cf_status_thunderbird_esr91&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_thunderbird_esr91&o1=equals&v1=wontfix) → ---Depends on: [1752956](/show_bug.cgi?id=1752956 "RESOLVED FIXED - `IMEContentObserver` should update selection cache before sending a text change notification")

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a8422810_553429)• 3 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1741515#c20)• 3 years ago |
|  | |

Unfortunately this does not appear to be exploitable beyond a Denial of Service attack and is therefore not eligible for our Bug Bounty program

Flags: sec-bounty? → sec-bounty-

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1741515#c21)• 3 years ago |
|  | |

Hi Aryan! Could you please help us verifying if the issue is fixed on your end, with latest Nightly 99?

I'm unable to reproduce the crash on Win 10 (Nightly 96.0a1, 2021-11-06), although I tested with the same Jira ticket posted in [comment 0](/show_bug.cgi?id=1741515#c0 "VERIFIED FIXED - Maliciously crafted data triggers firefox to crash immediately").

Flags: needinfo?(sinha.aryan11)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a9763273_1689)• 3 years ago |

See Also: → [1758277](/show_bug.cgi?id=1758277 "RESOLVED DUPLICATE - Memory Corruption")

|  | [Aryan Sinha](/user_profile?user_id=612949)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1741515#c22)• 3 years ago |
|  | |

Hey Ciprian,

I'm so sorry for the delayed response here. I was extensively busy and away from my personal mechine. I retested and tried reproducing the behaviour at my end and can confirm that the issue is no longer being reproduced.

Thanks and regards!

Flags: needinfo?(sinha.aryan11)

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1741515#c23)• 3 years ago |
|  | |

No worries, thanks for taking the time to test this! Marking the bug as verified fixed per [comment 22](/show_bug.cgi?id=1741515#c22 "VERIFIED FIXED - Maliciously crafted data triggers firefox to crash immediately").

Status: RESOLVED → VERIFIED
[status-firefox99](/buglist.cgi?f1=cf_status_firefox99&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=verified)Flags: qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a11389532_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main99+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1741515#c24)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9269929)
— [Details](attachment.cgi?id=9269929&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a11637439_578488)• 3 years ago |

Alias: CVE-2022-28287

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a13797706_578488)• 3 years ago |

Flags: sec-bounty-hof+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a24560778_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1741515#a79988068_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1741515&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Aryan Sinha](/user_profile?user_id=612949)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


