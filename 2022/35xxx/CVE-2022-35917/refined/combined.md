=== Content from github.com_89e589bf_20250115_102430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fblob%2Fmaster%2Fcore%2Fsrc%2FvalidateTransfer.ts)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fblob%2Fmaster%2Fcore%2Fsrc%2FvalidateTransfer.ts)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=anza-xyz%2Fsolana-pay)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[anza-xyz](/anza-xyz)
/
**[solana-pay](/anza-xyz/solana-pay)**
Public

* [Notifications](/login?return_to=%2Fanza-xyz%2Fsolana-pay) You must be signed in to change notification settings
* [Fork
  475](/login?return_to=%2Fanza-xyz%2Fsolana-pay)
* [Star
   1.3k](/login?return_to=%2Fanza-xyz%2Fsolana-pay)

* [Code](/anza-xyz/solana-pay)
* [Issues
  31](/anza-xyz/solana-pay/issues)
* [Pull requests
  10](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects
  0](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

Additional navigation options

* [Code](/anza-xyz/solana-pay)
* [Issues](/anza-xyz/solana-pay/issues)
* [Pull requests](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

## Files

 master
## Breadcrumbs

1. [solana-pay](/anza-xyz/solana-pay/tree/master)
2. /[core](/anza-xyz/solana-pay/tree/master/core)
3. /[src](/anza-xyz/solana-pay/tree/master/core/src)
/
# validateTransfer.ts

Copy path Blame  Blame
## Latest commit

## History

[History](/anza-xyz/solana-pay/commits/master/core/src/validateTransfer.ts)166 lines (145 loc) · 6.96 KB master
## Breadcrumbs

1. [solana-pay](/anza-xyz/solana-pay/tree/master)
2. /[core](/anza-xyz/solana-pay/tree/master/core)
3. /[src](/anza-xyz/solana-pay/tree/master/core/src)
/
# validateTransfer.ts

Top
## File metadata and controls

* Code
* Blame

166 lines (145 loc) · 6.96 KB[Raw](https://github.com/anza-xyz/solana-pay/raw/refs/heads/master/core/src/validateTransfer.ts)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166import { decodeInstruction, getAssociatedTokenAddress, isTransferCheckedInstruction, isTransferInstruction,} from '@solana/spl-token';import type { ConfirmedTransactionMeta, Connection, Finality, Message, TransactionInstruction, TransactionResponse, TransactionSignature,} from '@solana/web3.js';import { LAMPORTS\_PER\_SOL, SystemInstruction, Transaction } from '@solana/web3.js';import BigNumber from 'bignumber.js';import { MEMO\_PROGRAM\_ID } from './constants.js';import type { Amount, Memo, Recipient, Reference, References, SPLToken } from './types.js';
/\*\* \* Thrown when a transaction doesn't contain a valid Solana Pay transfer. \*/export class ValidateTransferError extends Error { name = 'ValidateTransferError';}
/\*\* \* Fields of a Solana Pay transfer request to validate. \*/export interface ValidateTransferFields { /\*\* `recipient` in the [Solana Pay spec](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#recipient). \*/ recipient: Recipient; /\*\* `amount` in the [Solana Pay spec](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#amount). \*/ amount: Amount; /\*\* `spl-token` in the [Solana Pay spec](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#spl-token). \*/ splToken?: SPLToken; /\*\* `reference` in the [Solana Pay spec](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#reference). \*/ reference?: References; /\*\* `memo` in the [Solana Pay spec](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#memo). \*/ memo?: Memo;}
/\*\* \* Check that a given transaction contains a valid Solana Pay transfer. \* \* @param connection - A connection to the cluster. \* @param signature - The signature of the transaction to validate. \* @param fields - Fields of a Solana Pay transfer request to validate. \* @param options - Options for `getTransaction`. \* \* @throws {ValidateTransferError} \*/export async function validateTransfer( connection: Connection, signature: TransactionSignature, { recipient, amount, splToken, reference, memo }: ValidateTransferFields, options?: { commitment?: Finality }): Promise<TransactionResponse> { const response = await connection.getTransaction(signature, options); if (!response) throw new ValidateTransferError('not found');
 const { message, signatures } = response.transaction; const meta = response.meta; if (!meta) throw new ValidateTransferError('missing meta'); if (meta.err) throw meta.err;
 if (reference && !Array.isArray(reference)) { reference = [reference]; }
 // Deserialize the transaction and make a copy of the instructions we're going to validate. const transaction = Transaction.populate(message, signatures); const instructions = transaction.instructions.slice();
 // Transfer instruction must be the last instruction const instruction = instructions.pop(); if (!instruction) throw new ValidateTransferError('missing transfer instruction'); const [preAmount, postAmount] = splToken ? await validateSPLTokenTransfer(instruction, message, meta, recipient, splToken, reference) : await validateSystemTransfer(instruction, message, meta, recipient, reference); if (postAmount.minus(preAmount).lt(amount)) throw new ValidateTransferError('amount not transferred');
 if (memo !== undefined) { // Memo instruction must be the second to last instruction const instruction = instructions.pop(); if (!instruction) throw new ValidateTransferError('missing memo instruction'); validateMemo(instruction, memo); }
 return response;}
function validateMemo(instruction: TransactionInstruction, memo: string): void { // Check that the instruction is a memo instruction with no keys and the expected memo data. if (!instruction.programId.equals(MEMO\_PROGRAM\_ID)) throw new ValidateTransferError('invalid memo program'); if (instruction.keys.length) throw new ValidateTransferError('invalid memo keys'); if (!instruction.data.equals(Buffer.from(memo, 'utf8'))) throw new ValidateTransferError('invalid memo');}
async function validateSystemTransfer( instruction: TransactionInstruction, message: Message, meta: ConfirmedTransactionMeta, recipient: Recipient, references?: Reference[]): Promise<[BigNumber, BigNumber]> { const accountIndex = message.accountKeys.findIndex((pubkey) => pubkey.equals(recipient)); if (accountIndex === -1) throw new ValidateTransferError('recipient not found');
 if (references) { // Check that the instruction is a system transfer instruction. SystemInstruction.decodeTransfer(instruction);
 // Check that the expected reference keys exactly match the extra keys provided to the instruction. const [\_from, \_to, ...extraKeys] = instruction.keys; const length = extraKeys.length; if (length !== references.length) throw new ValidateTransferError('invalid references');
 for (let i = 0; i < length; i++) { if (!extraKeys[i].pubkey.equals(references[i])) throw new ValidateTransferError(`invalid reference ${i}`); } }
 return [ new BigNumber(meta.preBalances[accountIndex] || 0).div(LAMPORTS\_PER\_SOL), new BigNumber(meta.postBalances[accountIndex] || 0).div(LAMPORTS\_PER\_SOL), ];}
async function validateSPLTokenTransfer( instruction: TransactionInstruction, message: Message, meta: ConfirmedTransactionMeta, recipient: Recipient, splToken: SPLToken, references?: Reference[]): Promise<[BigNumber, BigNumber]> { const recipientATA = await getAssociatedTokenAddress(splToken, recipient); const accountIndex = message.accountKeys.findIndex((pubkey) => pubkey.equals(recipientATA)); if (accountIndex === -1) throw new ValidateTransferError('recipient not found');
 if (references) { // Check that the first instruction is an SPL token transfer instruction. const decodedInstruction = decodeInstruction(instruction); if (!isTransferCheckedInstruction(decodedInstruction) && !isTransferInstruction(decodedInstruction)) throw new ValidateTransferError('invalid transfer');
 // Check that the expected reference keys exactly match the extra keys provided to the instruction. const extraKeys = decodedInstruction.keys.multiSigners; const length = extraKeys.length; if (length !== references.length) throw new ValidateTransferError('invalid references');
 for (let i = 0; i < length; i++) { if (!extraKeys[i].pubkey.equals(references[i])) throw new ValidateTransferError(`invalid reference ${i}`); } }
 const preBalance = meta.preTokenBalances?.find((x) => x.accountIndex === accountIndex); const postBalance = meta.postTokenBalances?.find((x) => x.accountIndex === accountIndex);
 return [ new BigNumber(preBalance?.uiTokenAmount.uiAmountString || 0), new BigNumber(postBalance?.uiTokenAmount.uiAmountString || 0), ];}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_507d394f_20250115_102433.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fcommit%2Fac6ce0d0a81137700874a8bf5a7caac3be999fad)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fcommit%2Fac6ce0d0a81137700874a8bf5a7caac3be999fad)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=anza-xyz%2Fsolana-pay)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[anza-xyz](/anza-xyz)
/
**[solana-pay](/anza-xyz/solana-pay)**
Public

* [Notifications](/login?return_to=%2Fanza-xyz%2Fsolana-pay) You must be signed in to change notification settings
* [Fork
  475](/login?return_to=%2Fanza-xyz%2Fsolana-pay)
* [Star
   1.3k](/login?return_to=%2Fanza-xyz%2Fsolana-pay)

* [Code](/anza-xyz/solana-pay)
* [Issues
  31](/anza-xyz/solana-pay/issues)
* [Pull requests
  10](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects
  0](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

Additional navigation options

* [Code](/anza-xyz/solana-pay)
* [Issues](/anza-xyz/solana-pay/issues)
* [Pull requests](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

## Commit

[Permalink](/anza-xyz/solana-pay/commit/ac6ce0d0a81137700874a8bf5a7caac3be999fad)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

finish transfer validation implementation

[Browse files](/anza-xyz/solana-pay/tree/ac6ce0d0a81137700874a8bf5a7caac3be999fad)
Browse the repository at this point in the history

* Loading branch information

[![@jordaaash](https://avatars.githubusercontent.com/u/1173161?s=40&v=4)](/jordaaash)

[jordaaash](/anza-xyz/solana-pay/commits?author=jordaaash "View all commits by jordaaash")
committed
Jul 28, 2022

1 parent
[f41701d](/anza-xyz/solana-pay/commit/f41701dc7931f7882c6eb0582c9ddd796eb9d3aa)

commit ac6ce0d

Showing
**1 changed file**
with
**60 additions**
and
**18 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

78 changes: 60 additions & 18 deletions

78
[core/src/validateTransfer.ts](#diff-c188b51c3b4a63c0d81bdb64891b7010f33dacfba2f29e900756ca3be8d35a2e "core/src/validateTransfer.ts")

Show comments

[View file](/anza-xyz/solana-pay/blob/ac6ce0d0a81137700874a8bf5a7caac3be999fad/core/src/validateTransfer.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,15 +1,23 @@ |
|  |  | import { getAssociatedTokenAddress } from '@solana/spl-token'; |
|  |  | import { |
|  |  | decodeInstruction, |
|  |  | getAssociatedTokenAddress, |
|  |  | isTransferCheckedInstruction, |
|  |  | isTransferInstruction, |
|  |  | } from '@solana/spl-token'; |
|  |  | import { |
|  |  | ConfirmedTransactionMeta, |
|  |  | Connection, |
|  |  | Finality, |
|  |  | LAMPORTS\_PER\_SOL, |
|  |  | Message, |
|  |  | SystemInstruction, |
|  |  | Transaction, |
|  |  | TransactionResponse, |
|  |  | TransactionSignature, |
|  |  | } from '@solana/web3.js'; |
|  |  | import BigNumber from 'bignumber.js'; |
|  |  | import { Amount, Memo, Recipient, References, SPLToken } from './types'; |
|  |  | import { MEMO\_PROGRAM\_ID } from './constants'; |
|  |  | import { Amount, Memo, Recipient, Reference, References, SPLToken } from './types'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Thrown when a transaction doesn't contain a valid Solana Pay transfer. |
| Expand Down  Expand Up | | @@ -58,33 +66,49 @@ export async function validateTransfer( |
|  |  | if (!meta) throw new ValidateTransferError('missing meta'); |
|  |  | if (meta.err) throw meta.err; |
|  |  |  |
|  |  | const [preAmount, postAmount] = splToken |
|  |  | ? await validateSPLTokenTransfer(message, meta, recipient, splToken) |
|  |  | : await validateSystemTransfer(message, meta, recipient); |
|  |  | if (reference && !Array.isArray(reference)) { |
|  |  | reference = [reference]; |
|  |  | } |
|  |  |  |
|  |  | const [preAmount, postAmount] = splToken |
|  |  | ? await validateSPLTokenTransfer(message, meta, recipient, splToken, reference) |
|  |  | : await validateSystemTransfer(message, meta, recipient, reference); |
|  |  | if (postAmount.minus(preAmount).lt(amount)) throw new ValidateTransferError('amount not transferred'); |
|  |  |  |
|  |  | if (reference) { |
|  |  | if (!Array.isArray(reference)) { |
|  |  | reference = [reference]; |
|  |  | } |
|  |  |  |
|  |  | for (const pubkey of reference) { |
|  |  | if (!message.accountKeys.some((accountKey) => accountKey.equals(pubkey))) |
|  |  | throw new ValidateTransferError('reference not found'); |
|  |  | } |
|  |  | if (memo) { |
|  |  | // Check that the second instruction is a memo instruction with the expected memo. |
|  |  | const transaction = Transaction.populate(message); |
|  |  | const instruction = transaction.instructions[1]; |
|  |  | if (!instruction) throw new ValidateTransferError('missing memo instruction'); |
|  |  | if (!instruction.programId.equals(MEMO\_PROGRAM\_ID)) throw new ValidateTransferError('invalid memo program'); |
|  |  | if (!instruction.data.equals(Buffer.from(memo, 'utf8'))) throw new ValidateTransferError('invalid memo'); |
|  |  | } |
|  |  |  |
|  |  | // FIXME: add memo check |
|  |  |  |
|  |  | return response; |
|  |  | } |
|  |  |  |
|  |  | async function validateSystemTransfer( |
|  |  | message: Message, |
|  |  | meta: ConfirmedTransactionMeta, |
|  |  | recipient: Recipient |
|  |  | recipient: Recipient, |
|  |  | references?: Reference[] |
|  |  | ): Promise<[BigNumber, BigNumber]> { |
|  |  | if (references) { |
|  |  | // Check that the first instruction is a system transfer instruction. |
|  |  | const transaction = Transaction.populate(message); |
|  |  | const instruction = transaction.instructions[0]; |
|  |  | SystemInstruction.decodeTransfer(instruction); |
|  |  |  |
|  |  | // Check that the expected reference keys exactly match the extra keys provided to the instruction. |
|  |  | const [\_from, \_to, ...extraKeys] = instruction.keys; |
|  |  | const length = extraKeys.length; |
|  |  | if (length !== references.length) throw new ValidateTransferError('invalid references'); |
|  |  |  |
|  |  | for (let i = 0; i < length; i++) { |
|  |  | if (!extraKeys[i].pubkey.equals(references[i])) throw new ValidateTransferError(`invalid reference ${i}`); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | const accountIndex = message.accountKeys.findIndex((pubkey) => pubkey.equals(recipient)); |
|  |  | if (accountIndex === -1) throw new ValidateTransferError('recipient not found'); |
|  |  |  |
| Expand All | | @@ -98,8 +122,26 @@ async function validateSPLTokenTransfer( |
|  |  | message: Message, |
|  |  | meta: ConfirmedTransactionMeta, |
|  |  | recipient: Recipient, |
|  |  | splToken: SPLToken |
|  |  | splToken: SPLToken, |
|  |  | references?: Reference[] |
|  |  | ): Promise<[BigNumber, BigNumber]> { |
|  |  | if (references) { |
|  |  | // Check that the first instruction is an SPL token transfer instruction. |
|  |  | const transaction = Transaction.populate(message); |
|  |  | const instruction = decodeInstruction(transaction.instructions[0]); |
|  |  | if (!isTransferCheckedInstruction(instruction) && !isTransferInstruction(instruction)) |
|  |  | throw new ValidateTransferError('invalid transfer'); |
|  |  |  |
|  |  | // Check that the expected reference keys exactly match the extra keys provided to the instruction. |
|  |  | const extraKeys = instruction.keys.multiSigners; |
|  |  | const length = extraKeys.length; |
|  |  | if (length !== references.length) throw new ValidateTransferError('invalid references'); |
|  |  |  |
|  |  | for (let i = 0; i < length; i++) { |
|  |  | if (!extraKeys[i].pubkey.equals(references[i])) throw new ValidateTransferError(`invalid reference ${i}`); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | const recipientATA = await getAssociatedTokenAddress(splToken, recipient); |
|  |  | const accountIndex = message.accountKeys.findIndex((pubkey) => pubkey.equals(recipientATA)); |
|  |  | if (accountIndex === -1) throw new ValidateTransferError('recipient not found'); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ac6ce0d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fcommit%2Fac6ce0d0a81137700874a8bf5a7caac3be999fad) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2b85aaeb_20250115_102435.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fsecurity%2Fadvisories%2FGHSA-j47c-j42c-mwqq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fsecurity%2Fadvisories%2FGHSA-j47c-j42c-mwqq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=anza-xyz%2Fsolana-pay)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[anza-xyz](/anza-xyz)
/
**[solana-pay](/anza-xyz/solana-pay)**
Public

* [Notifications](/login?return_to=%2Fanza-xyz%2Fsolana-pay) You must be signed in to change notification settings
* [Fork
  475](/login?return_to=%2Fanza-xyz%2Fsolana-pay)
* [Star
   1.3k](/login?return_to=%2Fanza-xyz%2Fsolana-pay)

* [Code](/anza-xyz/solana-pay)
* [Issues
  31](/anza-xyz/solana-pay/issues)
* [Pull requests
  10](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects
  0](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

Additional navigation options

* [Code](/anza-xyz/solana-pay)
* [Issues](/anza-xyz/solana-pay/issues)
* [Pull requests](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

# Weakness in Transfer Validation Logic

Moderate

[jordaaash](/jordaaash)
published
GHSA-j47c-j42c-mwqq
Jul 28, 2022

## Package

npm

@solana/pay
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 0.2.0

## Patched versions

0.2.1

## Description

### Description

When a Solana Pay transaction is located using a [reference key](https://github.com/solana-labs/solana-pay/blob/master/SPEC.md#reference), it may be checked to represent a transfer of the desired amount to the recipient, using the supplied [`validateTransfer` function](https://github.com/solana-labs/solana-pay/blob/master/core/src/validateTransfer.ts). An edge case regarding this mechanism could cause the validation logic to validate multiple transfers.

### Impact

Most known Solana Pay point of sale applications are currently run on physical point of sale devices, which makes this issue unlikely to occur. However, there may be web-based point of sale applications using the protocol where it may be more likely to occur.

### Patches

This issue has been patched as of version [`0.2.1`](https://www.npmjs.com/package/%40solana/pay/v/0.2.1). Users of the Solana Pay SDK should upgrade to it.

### Severity

Moderate

### CVE ID

CVE-2022-35917

### Weaknesses

No CWEs

### Credits

* [![@cmowenby](https://avatars.githubusercontent.com/u/5741384?s=40&v=4)](/cmowenby)
  [cmowenby](/cmowenby)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5e8489f6_20250115_102428.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fblob%2Fmaster%2FSPEC.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanza-xyz%2Fsolana-pay%2Fblob%2Fmaster%2FSPEC.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=anza-xyz%2Fsolana-pay)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[anza-xyz](/anza-xyz)
/
**[solana-pay](/anza-xyz/solana-pay)**
Public

* [Notifications](/login?return_to=%2Fanza-xyz%2Fsolana-pay) You must be signed in to change notification settings
* [Fork
  475](/login?return_to=%2Fanza-xyz%2Fsolana-pay)
* [Star
   1.3k](/login?return_to=%2Fanza-xyz%2Fsolana-pay)

* [Code](/anza-xyz/solana-pay)
* [Issues
  31](/anza-xyz/solana-pay/issues)
* [Pull requests
  10](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects
  0](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

Additional navigation options

* [Code](/anza-xyz/solana-pay)
* [Issues](/anza-xyz/solana-pay/issues)
* [Pull requests](/anza-xyz/solana-pay/pulls)
* [Actions](/anza-xyz/solana-pay/actions)
* [Projects](/anza-xyz/solana-pay/projects)
* [Security](/anza-xyz/solana-pay/security)
* [Insights](/anza-xyz/solana-pay/pulse)

## Files

 master
## Breadcrumbs

1. [solana-pay](/anza-xyz/solana-pay/tree/master)
/
# SPEC.md

Copy path Blame  Blame
## Latest commit

## History

[History](/anza-xyz/solana-pay/commits/master/SPEC.md)253 lines (171 loc) · 16.2 KB master
## Breadcrumbs

1. [solana-pay](/anza-xyz/solana-pay/tree/master)
/
# SPEC.md

Top
## File metadata and controls

* Preview
* Code
* Blame

253 lines (171 loc) · 16.2 KB[Raw](https://github.com/anza-xyz/solana-pay/raw/refs/heads/master/SPEC.md)
# Solana Pay Specification

## Summary

A standard protocol to encode Solana transaction requests within URLs to enable payments and other use cases.

Rough consensus on this spec has been reached, and implementations exist in Phantom, FTX, and Slope.

This standard draws inspiration from [BIP 21](https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki) and [EIP 681](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-681.md).

## Motivation

A standard URL protocol for requesting native SOL transfers, SPL Token transfers, and Solana transactions allows for a better user experience across apps and wallets in the Solana ecosystem.

These URLs may be encoded in QR codes or NFC tags, or sent between users and applications to request payment and compose transactions.

Applications should ensure that a transaction has been confirmed and is valid before they release goods or services being sold, or grant access to objects or events.

Mobile wallets should register to handle the URL scheme to provide a seamless yet secure experience when Solana Pay URLs are encountered in the environment.

By standardizing a simple approach to solving these problems, we ensure basic compatibility of applications and wallets so developers can focus on higher level abstractions.

## Specification: Transfer Request

A Solana Pay transfer request URL describes a non-interactive request for a SOL or SPL Token transfer.

```
solana:<recipient>
      ?amount=<amount>
      &spl-token=<spl-token>
      &reference=<reference>
      &label=<label>
      &message=<message>
      &memo=<memo>
```

The request is non-interactive because the parameters in the URL are used by a wallet to directly compose a transaction.

### Recipient

A single `recipient` field is required as the pathname. The value must be the base58-encoded public key of a native SOL account. Associated token accounts must not be used.

Instead, to request an SPL Token transfer, the `spl-token` field must be used to specify an SPL Token mint, from which the associated token address of the recipient must be derived.

### Amount

A single `amount` field is allowed as an optional query parameter. The value must be a non-negative integer or decimal number of "user" units. For SOL, that's SOL and not lamports. For tokens, use [`uiAmountString` and not `amount`](https://docs.solana.com/developing/clients/jsonrpc-api#token-balances-structure).

`0` is a valid value. If the value is a decimal number less than `1`, it must have a leading `0` before the `.`. Scientific notation is prohibited.

If a value is not provided, the wallet must prompt the user for the amount. If the number of decimal places exceed what's supported for SOL (9) or the SPL Token (mint specific), the wallet must reject the URL as **malformed**.

### SPL Token

A single `spl-token` field is allowed as an optional query parameter. The value must be the base58-encoded public key of an SPL Token mint account.

If the field is provided, the [Associated Token Account](https://spl.solana.com/associated-token-account) convention must be used, and the wallet must include a `TokenProgram.Transfer` or `TokenProgram.TransferChecked` instruction as the last instruction of the transaction.

If the field is not provided, the URL describes a native SOL transfer, and the wallet must include a `SystemProgram.Transfer` instruction as the last instruction of the transaction instead.

The wallet must derive the ATA address from the `recipient` and `spl-token` fields. Transfers to auxiliary token accounts are not supported.

### Reference

Multiple `reference` fields are allowed as optional query parameters. The values must be base58-encoded 32 byte arrays. These may or may not be public keys, on or off the curve, and may or may not correspond with accounts on Solana.

If the values are provided, the wallet must include them in the order provided as read-only, non-signer keys to the `SystemProgram.Transfer` or `TokenProgram.Transfer`/`TokenProgram.TransferChecked` instruction in the payment transaction. The values may or may not be unique to the payment request, and may or may not correspond to an account on Solana.

Because Solana validators index transactions by these account keys, `reference` values can be used as client IDs (IDs usable before knowing the eventual payment transaction). The [`getSignaturesForAddress`](https://docs.solana.com/developing/clients/jsonrpc-api#getsignaturesforaddress) RPC method can be used locate transactions this way.

### Label

A single `label` field is allowed as an optional query parameter. The value must be a [URL-encoded](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent) UTF-8 string that describes the source of the transfer request.

For example, this might be the name of a brand, store, application, or person making the request. The wallet should [URL-decode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) the value and display the decoded value to the user.

### Message

A single `message` field is allowed as an optional query parameter. The value must be a [URL-encoded](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent) UTF-8 string that describes the nature of the transfer request.

For example, this might be the name of an item being purchased, an order ID, or a thank you note. The wallet should [URL-decode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) the value and display the decoded value to the user.

### Memo

A single `memo` field is allowed as an optional query parameter. The value must be a [URL-encoded](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent) UTF-8 string that must be included in an [SPL Memo](https://spl.solana.com/memo) instruction in the payment transaction.

The wallet must [URL-decode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) the value and should display the decoded value to the user. The memo will be recorded by validators and should not include private or sensitive information.

If the field is provided, the wallet must include a `MemoProgram` instruction as the second to last instruction of the transaction, immediately before the SOL or SPL Token transfer instruction, to avoid ambiguity with other instructions in the transaction.

### Examples

##### URL describing a transfer request for 1 SOL.

```
solana:mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN?amount=1&label=Michael&message=Thanks%20for%20all%20the%20fish&memo=OrderId12345

```

##### URL describing a transfer request for 0.01 USDC.

```
solana:mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN?amount=0.01&spl-token=EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v

```

##### URL describing a transfer request for SOL. The user must be prompted for the amount.

```
solana:mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN?label=Michael

```

## Specification: Transaction Request

A Solana Pay transaction request URL describes an interactive request for any Solana transaction.

```
solana:<link>
```

The request is interactive because the parameters in the URL are used by a wallet to make an HTTP request to compose a transaction.

### Link

A single `link` field is required as the pathname. The value must be a conditionally [URL-encoded](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent) absolute HTTPS URL.

If the URL contains query parameters, it must be URL-encoded. Protocol query parameters may be added to this specification. URL-encoding the value prevents conflicting with protocol parameters.

If the URL does not contain query parameters, it should not be URL-encoded. This produces a shorter URL and a less dense QR code.

In either case, the wallet must [URL-decode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) the value. This has no effect if the value isn't URL-encoded. If the decoded value is not an absolute HTTPS URL, the wallet must reject it as **malformed**.

#### GET Request

The wallet should make an HTTP `GET` JSON request to the URL. The request should not identify the wallet or the user.

The wallet should make the request with an [Accept-Encoding header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Encoding), and the application should respond with a [Content-Encoding header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding) for HTTP compression.

The wallet should display the domain of the URL as the request is being made.

#### GET Response

The wallet must handle HTTP [client error](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses), [server error](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#server_error_responses), and [redirect responses](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages). The application must respond with these, or with an HTTP `OK` JSON response with a body of

```
{"label":"<label>","icon":"<icon>"}
```

The `<label>` value must be a UTF-8 string that describes the source of the transaction request. For example, this might be the name of a brand, store, application, or person making the request.

The `<icon>` value must be an absolute HTTP or HTTPS URL of an icon image. The file must be an SVG, PNG, or WebP image, or the wallet must reject it as **malformed**.

The wallet should not cache the response except as instructed by [HTTP caching](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching#controlling_caching) response headers.

The wallet should display the label and render the icon image to user.

#### POST Request

The wallet must make an HTTP `POST` JSON request to the URL with a body of

```
{"account":"<account>"}
```

The `<account>` value must be the base58-encoded public key of an account that may sign the transaction.

The wallet should make the request with an [Accept-Encoding header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Encoding), and the application should respond with a [Content-Encoding header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding) for HTTP compression.

The wallet should display the domain of the URL as the request is being made. If a `GET` request was made, the wallet should also display the label and render the icon image from the response.

#### POST Response

The wallet must handle HTTP [client error](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses), [server error](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#server_error_responses), and [redirect responses](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages). The application must respond with these, or with an HTTP `OK` JSON response with a body of

```
{"transaction":"<transaction>"}
```

The `<transaction>` value must be a base64-encoded [serialized transaction](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#serialize). The wallet must base64-decode the transaction and [deserialize it](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#from).

The application may respond with a partially or fully signed transaction. The wallet must validate the transaction as **untrusted**.

If the transaction [`signatures`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#signatures) are empty:

* The application should set the [`feePayer`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#feePayer) to the `account` in the request, or the zero value (`new PublicKey(0)` or `new PublicKey("11111111111111111111111111111111")`).
* The application should set the [`recentBlockhash`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#recentBlockhash) to the [latest blockhash](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Connection.html#getLatestBlockhash), or the zero value (`new PublicKey(0).toBase58()` or `"11111111111111111111111111111111"`).
* The wallet must ignore the [`feePayer`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#feePayer) in the transaction and set the `feePayer` to the `account` in the request.
* The wallet must ignore the [`recentBlockhash`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#recentBlockhash) in the transaction and set the `recentBlockhash` to the [latest blockhash](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Connection.html#getLatestBlockhash).

If the transaction [`signatures`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#signatures) are nonempty:

* The application must set the [`feePayer`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#feePayer) to the [public key of the first signature](https://solana-labs.github.io/solana-web3.js/v1.x/modules.html#SignaturePubkeyPair).
* The application must set the [`recentBlockhash`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#recentBlockhash) to the [latest blockhash](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Connection.html#getLatestBlockhash).
* The application must serialize and deserialize the transaction before signing it. This ensures consistent ordering of the account keys, as a workaround for [this issue](https://github.com/solana-labs/solana/issues/21722).
* The wallet must not set the [`feePayer`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#feePayer) and [`recentBlockhash`](https://solana-labs.github.io/solana-web3.js/v1.x/classes/Transaction.html#recentBlockhash).
* The wallet must verify the signatures, and if any are invalid, the wallet must reject the transaction as **malformed**.

The wallet must only sign the transaction with the `account` in the request, and must do so only if a signature for the `account` in the request is expected.

If any signature except a signature for the `account` in the request is expected, the wallet must reject the transaction as **malicious**.

The application may also include an optional `message` field in the response body:

```
{"message":"<message>","transaction":"<transaction>"}
```

The `<message>` value must be a UTF-8 string that describes the nature of the transaction response.

For example, this might be the name of an item being purchased, a discount applied to the purchase, or a thank you note. The wallet should display the value to the user.

The wallet and application should allow additional fields in the request body and response body, which may be added by future specification.

### Example

##### URL describing a transaction request.

```
solana:https://example.com/solana-pay

```

##### URL describing a transaction request with query parameters.

```
solana:https%3A%2F%2Fexample.com%2Fsolana-pay%3Forder%3D12345

```

##### GET Request

```
GET /solana-pay?order=12345 HTTP/1.1
Host: example.com
Connection: close
Accept: application/json
Accept-Encoding: br, gzip, deflate

```

##### GET Response

```
HTTP/1.1 200 OK
Connection: close
Content-Type: application/json
Content-Length: 62
Content-Encoding: gzip

{"label":"Michael Vines","icon":"https://example.com/icon.svg"}

```

##### POST Request

```
POST /solana-pay?order=12345 HTTP/1.1
Host: example.com
Connection: close
Accept: application/json
Accept-Encoding: br, gzip, deflate
Content-Type: application/json
Content-Length: 57

{"account":"mvines9iiHiQTysrwkJjGf2gb9Ex9jXJX8ns3qwf2kN"}

```

##### POST Response

```
HTTP/1.1 200 OK
Connection: close
Content-Type: application/json
Content-Length: 298
Content-Encoding: gzip

{"message":"Thanks for all the fish","transaction":"AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAECC4JMKqNplIXybGb/GhK1ofdVWeuEjXnQor7gi0Y2hMcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQECAAAMAgAAAAAAAAAAAAAA"}

```

## Extensions

Additional formats and fields may be incorporated into this specification to enable new use cases while ensuring compatibility with apps and wallets.

Please open a Github issue to propose changes to the specification in order to solicit feedback from application and wallet developers.

[An actual example of such a proposal.](https://github.com/solana-labs/solana-pay/issues/26)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


