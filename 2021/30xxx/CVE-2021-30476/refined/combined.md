=== Content from discuss.hashicorp.com_8a0fd2fc_20250115_092324.html ===


[HashiCorp Discuss](/)

# [HCSEC-2021-11 - Terraform’s Vault Provider Did Not Correctly Configure Bound Labels for GCP Auth](/t/hcsec-2021-11-terraform-s-vault-provider-did-not-correctly-configure-bound-labels-for-gcp-auth/23464)

[Security](/c/security/52)

[security-vault](https://discuss.hashicorp.com/tag/security-vault),
[security-terraform](https://discuss.hashicorp.com/tag/security-terraform)

[jfinnigan](https://discuss.hashicorp.com/u/jfinnigan)

April 21, 2021, 8:35pm

1

**Bulletin ID:** HCSEC-2021-11

**Affected Products / Versions:** Terraform’s Vault Provider (terraform-provider-vault); fixed in 2.19.1.

**Publication Date:** April 21, 2021

**Summary**

Terraform’s Vault Provider (terraform-provider-vault) did not correctly configure GCE-type bound labels for Vault’s GCP auth method. This vulnerability, CVE-2021-30476, was fixed in terraform-provider-vault 2.19.1.

**Background**

Terraform’s Vault Provider (<https://registry.terraform.io/providers/hashicorp/vault>, [GitHub - hashicorp/terraform-provider-vault: Terraform Vault provider](https://github.com/hashicorp/terraform-provider-vault)) allows Terraform to read from, write to, and configure Vault.

The provider defines a [vault\_gcp\_auth\_backend\_role resource](https://registry.terraform.io/providers/hashicorp/vault/latest/docs/resources/gcp_auth_backend_role) that may be used to configure Vault’s [gcp auth method](https://www.vaultproject.io/docs/auth/gcp). For roles of type “gce”, the provider supports a [bound\_labels](https://registry.terraform.io/providers/hashicorp/vault/latest/docs/resources/gcp_auth_backend_role#bound_labels) argument which correlates to Vault’s [bound\_labels](https://www.vaultproject.io/api/auth/gcp#bound_labels) parameter accepted at role creation time.

**Details**

Within the provider, the bound\_labels argument was being incorrectly mapped from Terraform configuration to the Vault API endpoint for role creation. As a result, bound labels that were defined in Terraform configuration were silently ignored and were not applied to the Vault GCP auth configuration.

**Remediation**

Customers should review their usage of Terraform’s Vault Provider (specifically any usage of the vault\_gcp\_auth\_backend\_role resource and bound\_labels argument), evaluate the risk associated with this issue, and consider upgrading to terraform-provider-vault 2.19.1 or newer.

**Acknowledgement**

This issue was identified by an external party who reported it to HashiCorp.

*We deeply appreciate any effort to discover and disclose security vulnerabilities responsibly. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <https://hashicorp.com/security>.*

[show post in topic](/t/hcsec-2021-11-terraform-s-vault-provider-did-not-correctly-configure-bound-labels-for-gcp-auth/23464#post_1)

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Vault provider Bug](https://discuss.hashicorp.com/t/vault-provider-bug/57160)  [Plugin Development](/c/terraform-providers/tf-plugin-sdk/43) [hcp-terraform](https://discuss.hashicorp.com/tag/hcp-terraform) ,  [vault](https://discuss.hashicorp.com/tag/vault) | 0 | 309 | August 11, 2023 |
| [Issues with Setting Up Vault on HCP and Integrating with Terraform](https://discuss.hashicorp.com/t/issues-with-setting-up-vault-on-hcp-and-integrating-with-terraform/71404)  [Terraform](/c/terraform-core/27) [vault](https://discuss.hashicorp.com/tag/vault) | 0 | 14 | November 16, 2024 |
| [How to configure Google Cloud Auth Method](https://discuss.hashicorp.com/t/how-to-configure-google-cloud-auth-method/21455)  [Terraform Providers](/c/terraform-providers/31) [vault](https://discuss.hashicorp.com/tag/vault) | 1 | 392 | April 20, 2021 |
| [Terraform provider ansibleVault](https://discuss.hashicorp.com/t/terraform-provider-ansiblevault/24813)  [HCP Terraform](/c/terraform-core/hcp-terraform/44) [hcp-terraform](https://discuss.hashicorp.com/tag/hcp-terraform) ,  [vault](https://discuss.hashicorp.com/tag/vault) | 0 | 422 | May 26, 2021 |
| [HCSEC-2020-17 - Vault’s GCP Auth Method Allows Authentication Bypass](https://discuss.hashicorp.com/t/hcsec-2020-17-vault-s-gcp-auth-method-allows-authentication-bypass/18102)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 4196 | November 25, 2020 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from github.com_29ed9ef5_20250115_092325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhashicorp%2Fterraform-provider-vault%2Fissues%2F996)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhashicorp%2Fterraform-provider-vault%2Fissues%2F996)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=hashicorp%2Fterraform-provider-vault)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hashicorp](/hashicorp)
/
**[terraform-provider-vault](/hashicorp/terraform-provider-vault)**
Public

* [Notifications](/login?return_to=%2Fhashicorp%2Fterraform-provider-vault) You must be signed in to change notification settings
* [Fork
  549](/login?return_to=%2Fhashicorp%2Fterraform-provider-vault)
* [Star
   467](/login?return_to=%2Fhashicorp%2Fterraform-provider-vault)

* [Code](/hashicorp/terraform-provider-vault)
* [Issues
  363](/hashicorp/terraform-provider-vault/issues)
* [Pull requests
  69](/hashicorp/terraform-provider-vault/pulls)
* [Actions](/hashicorp/terraform-provider-vault/actions)
* [Security](/hashicorp/terraform-provider-vault/security)
* [Insights](/hashicorp/terraform-provider-vault/pulse)

Additional navigation options

* [Code](/hashicorp/terraform-provider-vault)
* [Issues](/hashicorp/terraform-provider-vault/issues)
* [Pull requests](/hashicorp/terraform-provider-vault/pulls)
* [Actions](/hashicorp/terraform-provider-vault/actions)
* [Security](/hashicorp/terraform-provider-vault/security)
* [Insights](/hashicorp/terraform-provider-vault/pulse)

# vault\_gcp\_auth\_backend\_role does not apply bound\_labels #996

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#1028](https://github.com/hashicorp/terraform-provider-vault/pull/1028)Closed[vault\_gcp\_auth\_backend\_role does not apply bound\_labels](#top)#996[#1028](https://github.com/hashicorp/terraform-provider-vault/pull/1028)Copy link![@BrandonIngalls](https://avatars.githubusercontent.com/u/3675033?u=f8aafab825653df51a73aff6d88fbd6c6f75fbda&v=4&size=80)
## Description

![@BrandonIngalls](https://avatars.githubusercontent.com/u/3675033?u=f8aafab825653df51a73aff6d88fbd6c6f75fbda&v=4&size=48)[BrandonIngalls](https://github.com/BrandonIngalls)opened [on Mar 12, 2021](https://github.com/hashicorp/terraform-provider-vault/issues/996#issue-830340464)

The `vault_gcp_auth_backend_role` resource does not apply [bound\_labels](https://registry.terraform.io/providers/hashicorp/vault/latest/docs/resources/gcp_auth_backend_role#bound_labels) to the vault auth method.

Earlier this week while debugging an issue I tried to authenticate to my vault from a VM that did not have the the `bound_label` that I had defined in my terraform configuration... To my surprise my authentication was successful, this led me down the route of finding out why terraform was lying to me.

### Terraform Version

```
[~]$ terraform -v
Terraform v0.14.7
+ provider registry.terraform.io/hashicorp/vault v2.18.0

```
### Affected Resource(s)

* vault\_gcp\_auth\_backend\_role

### Terraform Configuration Files

```
terraform {
  required_providers {
    vault = {
      source  = "hashicorp/vault"
      version = "2.18.0"
    }
  }
}

provider "vault" {
  address = "http://127.0.0.1:8200"
  token   = "root"
}

resource "vault_gcp_auth_backend" "gcp" {
  path = "gcp"

  description = "debug gcp auth endpoint; automation=terraform"
}

resource "vault_gcp_auth_backend_role" "gcp" {
  backend = vault_gcp_auth_backend.gcp.path

  role = "test-role"
  type = "gce"

  bound_labels = ["role:test"]
}
```
### Expected Behavior

Terraform **should** apply the security controls that it says it does for the vault provider.

### Actual Behavior

Terraform does not install the `bound_labels` configuration to the `vault_gcp_auth_backend_role` resource.

### Steps to Reproduce

```
# Start a dev vault instance
[~]$ vault server -dev -dev-root-token-id=root

# Apply my example terraform state
[~]$ terraform init
[~]$ terraform apply

# Run a plan to show that terraform thinks that it has set the bound_labels
# correctly and that "no changes are required"
[~]$ terraform plan

# Setup vault vars
[~]$ export VAULT_ADDR='http://127.0.0.1:8200'
[~]$ export VAULT_TOKEN='root'

# Check the terraform created gcp auth role's config...
# Note that `bound_labels` is missing
[~]$ vault read auth/gcp/role/test-role
Key                        Value
---                        -----
add_group_aliases          false
role_id                    57b6301e-6368-1e1b-51e7-2b31361e8589
token_bound_cidrs          []
token_explicit_max_ttl     0s
token_max_ttl              0s
token_no_default_policy    false
token_num_uses             0
token_period               0s
token_policies             []
token_ttl                  0s
token_type                 default
type                       gce

# Use the vault CLI / API to actually install a `bound_labels`
[~]$ vault write auth/gcp/role/test-role/labels add=role:dog

# Verify the manual change we just made...
[~]$ vault read auth/gcp/role/test-role
Key                        Value
---                        -----
add_group_aliases          false
bound_labels               map[role:dog]
role_id                    57b6301e-6368-1e1b-51e7-2b31361e8589
token_bound_cidrs          []
token_explicit_max_ttl     0s
token_max_ttl              0s
token_no_default_policy    false
token_num_uses             0
token_period               0s
token_policies             []
token_ttl                  0s
token_type                 default
type                       gce

# Try to run a terraform plan and terraform will panic
[~]$ terraform plan
# https://gist.github.com/BrandonIngalls/5c8d1089aa443580dd71d3f755600a29
```
👍1
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


