=== Content from rustsec.org_9e8efdca_20250115_094851.html ===


RUSTSEC-2021-0052: id-map: Multiple functions can cause double-frees › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/id-map/RUSTSEC-2021-0052.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/id-map/RUSTSEC-2021-0052.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0052)

# RUSTSEC-2021-0052

Multiple functions can cause double-frees

Reported
February 26, 2021

Issued
April 2, 2021

(last modified: June 13, 2023)

Package
[id-map](/packages/id-map.html)
([crates.io](https://crates.io/crates/id-map))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#memory-safety](/keywords/memory-safety.html)
[#double-free](/keywords/double-free.html)

Aliases

* [CVE-2021-30455](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30455)
* [CVE-2021-30456](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30456)
* [CVE-2021-30457](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30457)
* [GHSA-8gmx-cpcg-f8h5](https://github.com/advisories/GHSA-8gmx-cpcg-f8h5)
* [GHSA-rccq-j2m7-8fwr](https://github.com/advisories/GHSA-rccq-j2m7-8fwr)
* [GHSA-vfqx-hv88-f9cv](https://github.com/advisories/GHSA-vfqx-hv88-f9cv)

References

* <https://github.com/andrewhickman/id-map/issues/3>

Patched
no patched versions

### Description

The following functions in the crate are affected:

## `IdMap::clone_from`

The `clone_from` implementation for `IdMap` drops the values present in the
map and then begins cloning values from the other map. If a `.clone()` call
pancics, then the afformentioned dropped elements can be freed again.

## `get_or_insert`

`get_or_insert` reserves space for a value, before calling the user provided
insertion function `f`. If the function `f` panics then uninitialized or
previously freed memory can be dropped.

## `remove_set`

When removing a set of elements, `ptr::drop_in_place` is called on each of the
element to be removed. If the `Drop` impl of one of these elements panics then
the previously dropped elements can be dropped again.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


