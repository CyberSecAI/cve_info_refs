=== Content from security.gentoo.org_67cac60a_20250114_230150.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# FFmpeg: Multiple vulnerabilities — GLSA **202105-24**

Multiple vulnerabilities have been found in FFmpeg, the worst of
which could result in the arbitrary execution of code.

### Affected packages

| Package | **media-video/ffmpeg** on all architectures |
| --- | --- |
| Affected versions | < **4.4** |
| Unaffected versions | >= **4.4** |

### Background

FFmpeg is a complete, cross-platform solution to record, convert and
stream audio and video.

### Description

Multiple vulnerabilities have been discovered in FFmpeg. Please review
the CVE identifiers referenced below for details.

### Impact

A remote attacker could entice a user to open a specially crafted media
file using FFmpeg, possibly resulting in execution of arbitrary code with
the privileges of the process or a Denial of Service condition.

### Workaround

There is no known workaround at this time.

### Resolution

All FFmpeg users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=media-video/ffmpeg-4.4"

```
### References

* [CVE-2020-35964](https://nvd.nist.gov/vuln/detail/CVE-2020-35964)
* [CVE-2020-35965](https://nvd.nist.gov/vuln/detail/CVE-2020-35965)
* [CVE-2021-30123](https://nvd.nist.gov/vuln/detail/CVE-2021-30123)

**Release date**

May 26, 2021

**Latest revision**

May 26, 2021: 1

**Severity**

normal

**Exploitable**

local, remote

**Bugzilla entries**

* [763315](https://bugs.gentoo.org/show_bug.cgi?id=763315)
* [781146](https://bugs.gentoo.org/show_bug.cgi?id=781146)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from trac.ffmpeg.org_a5994786_20250114_230153.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8862 "Ticket #8862")
* [Next Ticket](/ticket/8864 "Ticket #8864") →

---

Opened [4 years ago](/timeline?from=2020-08-24T09%3A39%3A08Z&precision=second "See timeline at Aug 24, 2020, 9:39:08 AM")

Closed [4 years ago](/timeline?from=2020-08-24T21%3A32%3A57Z&precision=second "See timeline at Aug 24, 2020, 9:32:57 PM")

## [#8863](/ticket/8863) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# null pointer reference

| Reported by: | [lys404](/query?reporter=lys404&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [avcodec](/query?component=avcodec&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [aac](/query?keywords=~aac&status=!closed) [crash](/query?keywords=~crash&status=!closed) [SIGSEGV](/query?keywords=~SIGSEGV&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [yes](/query?reproduced=1&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

There're null pointer in libavutil/mem.c

How to reproduce:

```
% ffmpeg -i $PoC output
ffmpeg version
built on ffmpeg version N-98759-g1c7e55d Copyright (c) 2000-2020 the FFmpeg developers
  built with gcc 5.4.0 (Ubuntu 5.4.0-6ubuntu1~16.04.12) 20160609
  configuration: --prefix=./out --disable-stripping --enable-debug --cc=afl-gcc --cxx=afl-g++

```

Error information

```
Program received signal SIGSEGV, Segmentation fault.

```

Here's debugging information

```
gdb-peda$ bt
#0  0x00000000038aaf2b in av_freep (arg=arg@entry=0x433f08b2c82f1376) at libavutil/mem.c:229
#1  0x00000000004cde0d in ff_mdct_end (s=s@entry=0x433f08b2c82f1356) at libavcodec/mdct_template.c:211
#2  0x000000000055def8 in ff_aac_sbr_ctx_close (sbr=0x433f08b2c8291c26) at libavcodec/aacsbr_template.c:117
#3  0x0000000002cf2f90 in che_configure (channels=<synthetic pointer>, id=0x0, type=0xff, che_pos=<optimized out>, ac=<optimized out>)
    at libavcodec/aacdec_template.c:152
#4  output_configure (ac=0x49bb200, layout_map=<optimized out>, tags=0x10, oc_type=OC_TRIAL_PCE, get_new_frame=<optimized out>)
    at libavcodec/aacdec_template.c:543
#5  0x0000000002cfef22 in aac_decode_frame_int (avctx=avctx@entry=0x49b8a00, data=data@entry=0x49baac0,
    got_frame_ptr=got_frame_ptr@entry=0x7fffffffd860, gb=gb@entry=0x7fffffffd7d0, avpkt=<optimized out>) at libavcodec/aacdec_template.c:3312
#6  0x0000000002d046b5 in aac_decode_frame (avctx=0x49b8a00, data=0x49baac0, got_frame_ptr=0x7fffffffd860, avpkt=<optimized out>)
    at libavcodec/aacdec_template.c:3457
#7  0x0000000001818f01 in decode_simple_internal (frame=<optimized out>, avctx=<optimized out>) at libavcodec/decode.c:342
#8  decode_simple_receive_frame (frame=<optimized out>, avctx=<optimized out>) at libavcodec/decode.c:538
#9  decode_receive_frame_internal (avctx=avctx@entry=0x49b8a00, frame=0x49baac0) at libavcodec/decode.c:556
#10 0x000000000181bde8 in avcodec_send_packet (avctx=avctx@entry=0x49b8a00, avpkt=avpkt@entry=0x7fffffffd930) at libavcodec/decode.c:614
#11 0x00000000014ff73d in try_decode_frame (s=s@entry=0x49b7480, st=st@entry=0x49b8140, avpkt=avpkt@entry=0x4a4cd40, options=<optimized out>)
    at libavformat/utils.c:3111
#12 0x0000000001526a5f in avformat_find_stream_info (ic=0x49b7480, options=0x49b8080) at libavformat/utils.c:3954
#13 0x00000000005f9e4d in open_input_file (o=o@entry=0x7fffffffdf00, filename=<optimized out>) at fftools/ffmpeg_opt.c:1186
#14 0x000000000060420f in open_files (l=0x49b7058, l=0x49b7058, open_file=0x5f2730 <open_input_file>, inout=0x3a55879 "input")
    at fftools/ffmpeg_opt.c:3303
#15 ffmpeg_parse_options (argc=argc@entry=0x4, argv=argv@entry=0x7fffffffe4a8) at fftools/ffmpeg_opt.c:3343
#16 0x00000000005dbbb7 in main (argc=argc@entry=0x4, argv=argv@entry=0x7fffffffe4a8) at fftools/ffmpeg.c:4850
#17 0x00007ffff72ed840 in __libc_start_main (main=0x5dba40 <main>, argc=0x4, argv=0x7fffffffe4a8, init=<optimized out>,
    fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffe498) at ../csu/libc-start.c:291
#18 0x00000000005dd119 in _start ()

```
```
gdb-peda$ disass $pc-32,$pc+32
Dump of assembler code from 0x38aaf0b to 0x38aaf4b:
   0x00000000038aaf0b <av_freep+27>:	add    BYTE PTR [rax],al
   0x00000000038aaf0d <av_freep+29>:	call   0x38af730 <__afl_maybe_log>
   0x00000000038aaf12 <av_freep+34>:	mov    rax,QWORD PTR [rsp+0x10]
   0x00000000038aaf17 <av_freep+39>:	mov    rcx,QWORD PTR [rsp+0x8]
   0x00000000038aaf1c <av_freep+44>:	mov    rdx,QWORD PTR [rsp]
   0x00000000038aaf20 <av_freep+48>:	lea    rsp,[rsp+0x98]
   0x00000000038aaf28 <av_freep+56>:	mov    rax,rdi
=> 0x00000000038aaf2b <av_freep+59>:	mov    rdi,QWORD PTR [rdi]
   0x00000000038aaf2e <av_freep+62>:	mov    QWORD PTR [rax],0x0
   0x00000000038aaf35 <av_freep+69>:	jmp    0x404140 <free@plt>
   0x00000000038aaf3a:	nop    WORD PTR [rax+rax*1+0x0]
   0x00000000038aaf40 <av_mallocz+0>:	lea    rsp,[rsp-0x98]
   0x00000000038aaf48 <av_mallocz+8>:	mov    QWORD PTR [rsp],rdx
End of assembler dump.

```
```
gdb-peda$ info all-registers
rax            0x433f08b2c82f1376	0x433f08b2c82f1376
rbx            0x433f08b2c82f1356	0x433f08b2c82f1356
rcx            0x7ffff7247040	0x7ffff7247040
rdx            0x3	0x3
rsi            0x0	0x0
rdi            0x433f08b2c82f1376	0x433f08b2c82f1376
rbp            0x10	0x10
rsp            0x7fffffffd318	0x7fffffffd318
r8             0x102e	0x102e
r9             0x0	0x0
r10            0x0	0x0
r11            0x433f08b2c826b8c6	0x433f08b2c826b8c6
r12            0xff	0xff
r13            0x0	0x0
r14            0xd	0xd
r15            0x49bb200	0x49bb200
rip            0x38aaf2b	0x38aaf2b <av_freep+59>
eflags         0x10206	[ PF IF RF ]
cs             0x33	0x33
ss             0x2b	0x2b
ds             0x0	0x0
es             0x0	0x0
fs             0x0	0x0
gs             0x0	0x0
st0            0	(raw 0x00000000000000000000)
st1            0	(raw 0x00000000000000000000)
st2            0	(raw 0x00000000000000000000)
st3            0	(raw 0x00000000000000000000)
st4            0	(raw 0x00000000000000000000)
st5            0	(raw 0x00000000000000000000)
st6            0	(raw 0x00000000000000000000)
st7            0	(raw 0x00000000000000000000)
fctrl          0x37f	0x37f
fstat          0x0	0x0
ftag           0xffff	0xffff
fiseg          0x0	0x0
fioff          0x0	0x0
foseg          0x0	0x0
fooff          0x0	0x0
fop            0x0	0x0
mxcsr          0x1fa0	[ PE IM DM ZM OM UM PM ]

```

Please confirm.

Thanks

### Attachments (1)

[poc](/attachment/ticket/8863/poc "View attachment")[​](/raw-attachment/ticket/8863/poc "Download")
(155.5 KB
) - added by lys404 [4 years ago](/timeline?from=2020-08-24T09%3A47%3A49Z&precision=second "See timeline at Aug 24, 2020, 9:47:49 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/8863/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by lys404, [4 years ago](/timeline?from=2020-08-24T09%3A47%3A49Z&precision=second "See timeline at Aug 24, 2020, 9:47:49 AM")

| Attachment: | [*poc*](/attachment/ticket/8863/poc)[​](/raw-attachment/ticket/8863/poc "Download") added |
| --- | --- |

### [comment:1](#comment:1) by Carl Eugen Hoyos, [4 years ago](/timeline?from=2020-08-24T19%3A10%3A44Z&precision=second "See timeline at Aug 24, 2020, 7:10:44 PM")

| Component: | undetermined → avcodec |
| --- | --- |
| Keywords: | aac crash SIGSEGV added |
| Priority: | normal → important |
| Reproduced by developer: | set |
| Status: | new → open |
| Version: | unspecified → git-master |

Likely related to [#8845](/ticket/8845 "#8845: defect: A stack-buffer-overflow in FFmpeg JIT code (closed: fixed)")

### [comment:2](#comment:2) by Carl Eugen Hoyos, [4 years ago](/timeline?from=2020-08-24T21%3A32%3A57Z&precision=second "See timeline at Aug 24, 2020, 9:32:57 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | open → closed |

Fixed by Jan Ekström in [d6f293353c94c7ce200f6e0975ae3de49787f91f](/changeset/d6f293353c94c7ce200f6e0975ae3de49787f91f/ffmpeg "avcodec/aacdec_template: add more checks to make sure only 22.2 gets ...")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8863?format=rss)
* [Comma-delimited Text](/ticket/8863?format=csv)
* [Tab-delimited Text](/ticket/8863?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from trac.ffmpeg.org_c90320a5_20250114_230152.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/8844 "Ticket #8844")
* [Next Ticket](/ticket/8846 "Ticket #8846") →

---

Opened [4 years ago](/timeline?from=2020-08-11T02%3A52%3A01Z&precision=second "See timeline at Aug 11, 2020, 2:52:01 AM")

Closed [4 years ago](/timeline?from=2020-08-24T21%3A33%3A17Z&precision=second "See timeline at Aug 24, 2020, 9:33:17 PM")

Last modified [4 years ago](/timeline?from=2021-07-13T20%3A56%3A49Z&precision=second "See timeline at Jul 13, 2021, 8:56:49 PM")

## [#8845](/ticket/8845) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# A stack-buffer-overflow in FFmpeg JIT code

| Reported by: | [Zhou Anshunkang](/query?reporter=seviezhou&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [avcodec](/query?component=avcodec&status=!closed) |
| Version: | [git-master](/query?status=!closed&version=git-master) | Keywords: | [aac](/query?keywords=~aac&status=!closed) |
| Cc: |  | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

## System info

Ubuntu x86\_64, clang 6.0, ffmpeg (git-master [​https://github.com/FFmpeg/FFmpeg/commit/1ead176d874acb489827ace3935fc71e1eea7e0e](https://github.com/FFmpeg/FFmpeg/commit/1ead176d874acb489827ace3935fc71e1eea7e0e))

## Configure

```
./configure --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan

```
## Command line

```
./ffmpeg -i @@ -y -f mov /dev/null

```
## Address Sanitizer

```
  built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
  configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan
  libavutil      56. 58.100 / 56. 58.100
  libavcodec     58.100.100 / 58.100.100
  libavformat    58. 50.100 / 58. 50.100
  libavdevice    58. 11.101 / 58. 11.101
  libavfilter     7. 87.100 /  7. 87.100
  libswscale      5.  8.100 /  5.  8.100
  libswresample   3.  8.100 /  3.  8.100
[aac @ 0x61b000000080] Format aac detected only with low score of 1, misdetection possible!
[aac @ 0x619000000580] More than one AAC RDB per ADTS frame is not implemented. Update your FFmpeg version to the newest one from Git. If the problem still occurs, it means that your file has a feature which has not been implemented.
[aac @ 0x61b000000080] Packet corrupt (stream = 0, dts = NOPTS).
[aac @ 0x619000000580] Sample rate index in program config element does not match the sample rate index configured by the container.
[aac @ 0x619000000580] Inconsistent channel configuration.
[aac @ 0x619000000580] get_buffer() failed
[aac @ 0x61b000000080] decoding for stream 0 failed
[aac @ 0x61b000000080] Estimating duration from bitrate, this may be inaccurate
[aac @ 0x61b000000080] Could not find codec parameters for stream 0 (Audio: aac (Main), 13 channels (FL+FR+FLC+FRC+TC+TFL+TFC+TFR+TBL+TBC+TBR+TSL+TSR+BFC+BFL+BFR), fltp, 5 kb/s): unspecified sample rate
Consider increasing the value for the 'analyzeduration' (0) and 'probesize' (5000000) options
Input #0, aac, from '/home/seviezhou//experiment-3/AlphaFuzz-ffmpeg/alpha_out/crashes/id:000001,src:003723,op:havoc':
  Duration: 00:00:00.18, bitrate: 5 kb/s
    Stream #0:0: Audio: aac (Main), 13 channels (FL+FR+FLC+FRC+TC+TFL+TFC+TFR+TBL+TBC+TBR+TSL+TSR+BFC+BFL+BFR), fltp, 5 kb/s
[aac @ 0x619000002380] Channel layout '16 channels (FL+FR+FLC+FRC+TC+TFL+TFC+TFR+TBL+TBC+TBR+TSL+TSR+BFC+BFL+BFR)' with 16 channels does not match specified number of channels 13: ignoring specified channel layout
Stream mapping:
  Stream #0:0 -> #0:0 (aac (native) -> aac (native))
Press [q] to stop, [?] for help
[aac @ 0x619000002380] More than one AAC RDB per ADTS frame is not implemented. Update your FFmpeg version to the newest one from Git. If the problem still occurs, it means that your file has a feature which has not been implemented.
[aac @ 0x619000002380] channel element 3.7 is not allocated
Error while decoding stream #0:0: Invalid data found when processing input
[aac @ 0x619000002380] Sample rate index in program config element does not match the sample rate index configured by the container.
=================================================================
==48056==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffff1e2fba5 at pc 0x0000029497f1 bp 0x7ffff1e2eb50 sp 0x7ffff1e2eb48
READ of size 1 at 0x7ffff1e2fba5 thread T0
    #0 0x29497f0  (/home/seviezhou/ffmpeg/ffmpeg+0x29497f0)
    #1 0x2959670  (/home/seviezhou/ffmpeg/ffmpeg+0x2959670)
    #2 0x2941d83  (/home/seviezhou/ffmpeg/ffmpeg+0x2941d83)
    #3 0x126e91c  (/home/seviezhou/ffmpeg/ffmpeg+0x126e91c)
    #4 0x126e22d  (/home/seviezhou/ffmpeg/ffmpeg+0x126e22d)
    #5 0x567dae  (/home/seviezhou/ffmpeg/ffmpeg+0x567dae)
    #6 0x560488  (/home/seviezhou/ffmpeg/ffmpeg+0x560488)
    #7 0x555ea5  (/home/seviezhou/ffmpeg/ffmpeg+0x555ea5)
    #8 0x7f1571274b96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310
    #9 0x41dea9 in _init (/home/seviezhou/ffmpeg/ffmpeg+0x41dea9)

Address 0x7ffff1e2fba5 is located in stack of thread T0 at offset 165 in frame
    #0 0x294179f  (/home/seviezhou/ffmpeg/ffmpeg+0x294179f)

  This frame has 4 object(s):
    [32, 64) 'gb.i' (line 1113)
    [96, 128) 'gb' (line 3413)
    [160, 164) 'new_extradata_size' (line 3417) <== Memory access at offset 165 overflows this variable
    [176, 180) 'jp_dualmono_size' (line 3421)
HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow (/home/seviezhou/ffmpeg/ffmpeg+0x29497f0)
Shadow bytes around the buggy address:
  0x10007e3bdf20: f2 f2 f2 f2 f2 f2 f2 f2 00 00 00 00 00 00 00 00
  0x10007e3bdf30: f2 f2 f2 f2 00 00 00 00 00 00 00 00 00 00 00 00
  0x10007e3bdf40: 00 00 00 00 00 00 00 00 00 00 00 00 f3 f3 f3 f3
  0x10007e3bdf50: f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00
  0x10007e3bdf60: f1 f1 f1 f1 f8 f8 f8 f8 f2 f2 f2 f2 00 00 00 00
=>0x10007e3bdf70: f2 f2 f2 f2[04]f2 04 f3 00 00 00 00 00 00 00 00
  0x10007e3bdf80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10007e3bdf90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10007e3bdfa0: 00 00 00 00 f1 f1 f1 f1 04 f2 f8 f3 00 00 00 00
  0x10007e3bdfb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x10007e3bdfc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==48056==ABORTING

```

It seems that if I ran this command multiple times, it can crash different objects, here is another ASAN output, using the same input:

```
  built with clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)
  configuration: --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan
  libavutil      56. 58.100 / 56. 58.100
  libavcodec     58.100.100 / 58.100.100
  libavformat    58. 50.100 / 58. 50.100
  libavdevice    58. 11.101 / 58. 11.101
  libavfilter     7. 87.100 /  7. 87.100
  libswscale      5.  8.100 /  5.  8.100
  libswresample   3.  8.100 /  3.  8.100
[aac @ 0x61b000000080] Format aac detected only with low score of 1, misdetection possible!
[aac @ 0x619000000580] More than one AAC RDB per ADTS frame is not implemented. Update your FFmpeg version to the newest one from Git. If the problem still occurs, it means that your file has a feature which has not been implemented.
[aac @ 0x61b000000080] Packet corrupt (stream = 0, dts = NOPTS).
[aac @ 0x619000000580] Sample rate index in program config element does not match the sample rate index configured by the container.
=================================================================
==73492==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe338744d7 at pc 0x0000029497f1 bp 0x7ffe33873cd0 sp 0x7ffe33873cc8
READ of size 1 at 0x7ffe338744d7 thread T0
    #0 0x29497f0  (/home/seviezhou/ffmpeg/ffmpeg+0x29497f0)
    #1 0x2959670  (/home/seviezhou/ffmpeg/ffmpeg+0x2959670)
    #2 0x2941d83  (/home/seviezhou/ffmpeg/ffmpeg+0x2941d83)
    #3 0x126e91c  (/home/seviezhou/ffmpeg/ffmpeg+0x126e91c)
    #4 0x126e22d  (/home/seviezhou/ffmpeg/ffmpeg+0x126e22d)
    #5 0xfbf83f  (/home/seviezhou/ffmpeg/ffmpeg+0xfbf83f)
    #6 0xfb6db4  (/home/seviezhou/ffmpeg/ffmpeg+0xfb6db4)
    #7 0x51815a  (/home/seviezhou/ffmpeg/ffmpeg+0x51815a)
    #8 0x516cca  (/home/seviezhou/ffmpeg/ffmpeg+0x516cca)
    #9 0x5166f5  (/home/seviezhou/ffmpeg/ffmpeg+0x5166f5)
    #10 0x555cef  (/home/seviezhou/ffmpeg/ffmpeg+0x555cef)
    #11 0x7f0651f26b96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310
    #12 0x41dea9 in _init (/home/seviezhou/ffmpeg/ffmpeg+0x41dea9)

Address 0x7ffe338744d7 is located in stack of thread T0 at offset 2039 in frame
    #0 0x294596f  (/home/seviezhou/ffmpeg/ffmpeg+0x294596f)

  This frame has 26 object(s):
    [32, 37) '.compoundliteral.sroa.5.i.i' (line 199)
    [64, 69) '.compoundliteral11.sroa.5.i.i' (line 199)
    [96, 101) '.compoundliteral22.sroa.5.i.i' (line 199)
    [128, 1152) 'e2c_vec.i' (line 263)
    [1280, 1285) '.compoundliteral.sroa.5.i' (line 260)
    [1312, 1317) '.compoundliteral60.sroa.5.i' (line 260)
    [1344, 1349) '.compoundliteral80.sroa.5.i' (line 260)
    [1376, 1381) '.compoundliteral99.sroa.5.i' (line 260)
    [1408, 1413) '.compoundliteral118.sroa.5.i' (line 260)
    [1440, 1445) '.compoundliteral133.sroa.5.i' (line 260)
    [1472, 1477) '.compoundliteral156.sroa.5.i' (line 260)
    [1504, 1509) '.compoundliteral176.sroa.5.i' (line 260)
    [1536, 1541) '.compoundliteral193.sroa.5.i' (line 260)
    [1568, 1584) 'SWAP_tmp.i' (line 438)
    [1600, 1616) 'SWAP_tmp219.i' (line 439)
    [1632, 1648) 'SWAP_tmp224.i' (line 440)
    [1664, 1680) 'SWAP_tmp229.i' (line 441)
    [1696, 1712) 'SWAP_tmp234.i' (line 442)
    [1728, 1744) 'SWAP_tmp239.i' (line 443)
    [1760, 1776) 'SWAP_tmp244.i' (line 444)
    [1792, 1808) 'SWAP_tmp249.i' (line 445)
    [1824, 1840) 'SWAP_tmp254.i' (line 446)
    [1856, 1872) 'SWAP_tmp270.i' (line 454)
    [1888, 1892) 'channels' (line 514)
    [1904, 2016) 'id_map' (line 516)
    [2048, 2055) 'type_counts' (line 517) <== Memory access at offset 2039 underflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow (/home/seviezhou/ffmpeg/ffmpeg+0x29497f0)
Shadow bytes around the buggy address:
  0x100046706840: f8 f2 f2 f2 f8 f2 f2 f2 f8 f2 f2 f2 f8 f2 f2 f2
  0x100046706850: f8 f2 f2 f2 f8 f2 f2 f2 f8 f2 f2 f2 f8 f2 f2 f2
  0x100046706860: f8 f8 f2 f2 f8 f8 f2 f2 f8 f8 f2 f2 f8 f8 f2 f2
  0x100046706870: f8 f8 f2 f2 f8 f8 f2 f2 f8 f8 f2 f2 f8 f8 f2 f2
  0x100046706880: f8 f8 f2 f2 f8 f8 f2 f2 04 f2 00 00 00 00 00 00
=>0x100046706890: 00 00 00 00 00 00 00 00 f2 f2[f2]f2 07 f3 f3 f3
  0x1000467068a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x1000467068b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x1000467068c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x1000467068d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x1000467068e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==73492==ABORTING

```

After it crashes, it also seems to mess up the terminal.

### Attachments (1)

[stack-overflow-ffmpeg-JIT](/attachment/ticket/8845/stack-overflow-ffmpeg-JIT "View attachment")[​](/raw-attachment/ticket/8845/stack-overflow-ffmpeg-JIT "Download")
(116 bytes
) - added by Carl Eugen Hoyos [4 years ago](/timeline?from=2020-08-17T21%3A26%3A47Z&precision=second "See timeline at Aug 17, 2020, 9:26:47 PM").

Download all attachments as:
[.zip](/zip-attachment/ticket/8845/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (6)

### by Carl Eugen Hoyos, [4 years ago](/timeline?from=2020-08-17T21%3A26%3A47Z&precision=second "See timeline at Aug 17, 2020, 9:26:47 PM")

| Attachment: | [*stack-overflow-ffmpeg-JIT*](/attachment/ticket/8845/stack-overflow-ffmpeg-JIT)[​](/raw-attachment/ticket/8845/stack-overflow-ffmpeg-JIT "Download") added |
| --- | --- |

### [comment:1](#comment:1) by Carl Eugen Hoyos, [4 years ago](/timeline?from=2020-08-17T21%3A31%3A34Z&precision=second "See timeline at Aug 17, 2020, 9:31:34 PM")

| Component: | ffmpeg → avcodec |
| --- | --- |
| Keywords: | aac added; asan removed |
| Priority: | normal → important |

valgrind shows a possible issue:

```
==17778== Invalid read of size 8
==17778==    at 0x4767E9: che_configure (aacdec_template.c:133)
==17778==    by 0x4767E9: output_configure.cold (aacdec_template.c:543)
==17778==    by 0xE889EC: aac_decode_frame_int.isra.0 (aacdec_template.c:3312)
==17778==    by 0xE8935C: aac_decode_frame (aacdec_template.c:3457)
==17778==    by 0x8B119F: decode_simple_internal (decode.c:342)
==17778==    by 0x8B119F: decode_simple_receive_frame (decode.c:538)
==17778==    by 0x8B119F: decode_receive_frame_internal (decode.c:556)
==17778==    by 0x8B1E4F: avcodec_send_packet (decode.c:614)
==17778==    by 0x4B85AC: decode (ffmpeg.c:2217)
==17778==    by 0x4B85AC: decode_audio (ffmpeg.c:2274)
==17778==    by 0x4B85AC: process_input_packet (ffmpeg.c:2596)
==17778==    by 0x4BB31A: process_input (ffmpeg.c:4493)
==17778==    by 0x4BB31A: transcode_step (ffmpeg.c:4613)
==17778==    by 0x4BB31A: transcode (ffmpeg.c:4667)
==17778==    by 0x49838D: main (ffmpeg.c:4872)

```

### [comment:2](#comment:2) by Zhou Anshunkang, [4 years ago](/timeline?from=2020-08-18T01%3A26%3A20Z&precision=second "See timeline at Aug 18, 2020, 1:26:20 AM")

I am not surely if these three bug reports point to the same location. I think it is a little bit strange.

### [comment:3](#comment:3) by jeeb, [4 years ago](/timeline?from=2020-08-20T20%3A41%3A13Z&precision=second "See timeline at Aug 20, 2020, 8:41:13 PM")

For the record I posted a patch set that would improve the sanity checks for 22.2 so that it is not as easy to get handled as such on the 18th, but so far have received no reviews:

[​https://patchwork.ffmpeg.org/project/ffmpeg/list/?series=2055](https://patchwork.ffmpeg.org/project/ffmpeg/list/?series=2055)

This causes both of the fuzzing samples I have received to no longer be an issue (with both valgrind and clang 10 ASAN), while it still enables valid 22.2 content to decode properly.

### [comment:4](#comment:4) by Carl Eugen Hoyos, [4 years ago](/timeline?from=2020-08-24T21%3A33%3A17Z&precision=second "See timeline at Aug 24, 2020, 9:33:17 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

Fixed by Jan Ekström in [d6f293353c94c7ce200f6e0975ae3de49787f91f](/changeset/d6f293353c94c7ce200f6e0975ae3de49787f91f/ffmpeg "avcodec/aacdec_template: add more checks to make sure only 22.2 gets ...")

### [comment:5](#comment:5) by Carl Eugen Hoyos, [4 years ago](/timeline?from=2021-07-13T20%3A56%3A49Z&precision=second "See timeline at Jul 13, 2021, 8:56:49 PM")

Since the information in the CVE report is wrong:

This issue is neither reproducible with FFmpeg 4.3 nor earlier versions.

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/8845?format=rss)
* [Comma-delimited Text](/ticket/8845?format=csv)
* [Tab-delimited Text](/ticket/8845?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


