Based on the provided content, here's a breakdown of the vulnerability described by CVE-2021-30152:

**Root Cause of Vulnerability:**

- The MediaWiki API's `action=protect` did not properly validate if a user had the necessary permissions to set a specific protection level. Specifically, it checked against the global `$wgRestrictionLevels` instead of the user's actual permissions, which are determined by `getNamespaceRestrictionLevels`.
- The user-facing form correctly uses `getNamespaceRestrictionLevels`, but the API did not.

**Weaknesses/Vulnerabilities Present:**

-   **Missing Authorization Check:** The API endpoint lacked proper authorization checks, allowing users to elevate page protection levels beyond their permitted scope.

**Impact of Exploitation:**

-   Users with the `protect` permission could use the API to set a higher protection level than they were authorized to, potentially locking out other users, including themselves, from editing or taking other actions on the affected pages. They could even lock out administrators if they set the highest level protection.
-   Users with protect permission, if the `action=edit` and `action=protect` actions aren't restricted, can also unprotect pages.

**Attack Vectors:**

-   The vulnerability was exploitable through the MediaWiki API, specifically the `action=protect` endpoint.

**Required Attacker Capabilities/Position:**

-   The attacker needed to be a logged-in MediaWiki user with the `protect` permission.
-   They would need to craft a specific API request with the `action=protect` parameter and desired protection level to exploit the vulnerability.

**Additional Details:**
- The fix was to have the API use  `getNamespaceRestrictionLevels` to determine the correct protection levels for the user.
- Patches were created for the `REL1_31`, `REL1_35`, `REL1_36`, and `master` branches of MediaWiki.