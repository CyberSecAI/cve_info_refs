=== Content from github.com_dff73d5c_20250114_201640.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fpull%2F1663)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fpull%2F1663)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=simonmichael%2Fhledger)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[simonmichael](/simonmichael)
/
**[hledger](/simonmichael/hledger)**
Public

* [Notifications](/login?return_to=%2Fsimonmichael%2Fhledger) You must be signed in to change notification settings
* [Fork
  321](/login?return_to=%2Fsimonmichael%2Fhledger)
* [Star
   3.1k](/login?return_to=%2Fsimonmichael%2Fhledger)

* [Code](/simonmichael/hledger)
* [Issues
  342](/simonmichael/hledger/issues)
* [Pull requests
  19](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects
  0](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

Additional navigation options

* [Code](/simonmichael/hledger)
* [Issues](/simonmichael/hledger/issues)
* [Pull requests](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsimonmichael%2Fhledger%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsimonmichael%2Fhledger%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# web: base64 encode user controlled strings (#1525) #1663

 Merged

[simonmichael](/simonmichael)
merged 2 commits into
[simonmichael:master](/simonmichael/hledger/tree/master "simonmichael/hledger:master")
from
[ArsenArsen:master](/ArsenArsen/hledger/tree/master "ArsenArsen/hledger:master")

Aug 24, 2021

 Merged

# [web: base64 encode user controlled strings (#1525)](#top) #1663

[simonmichael](/simonmichael)
merged 2 commits into
[simonmichael:master](/simonmichael/hledger/tree/master "simonmichael/hledger:master")
from
[ArsenArsen:master](/ArsenArsen/hledger/tree/master "ArsenArsen/hledger:master")

Aug 24, 2021

[Conversation
9](/simonmichael/hledger/pull/1663)
[Commits
2](/simonmichael/hledger/pull/1663/commits)
[Checks
0](/simonmichael/hledger/pull/1663/checks)
[Files changed](/simonmichael/hledger/pull/1663/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=60&v=4)](/ArsenArsen)

Copy link

Contributor

### @ArsenArsen **[ArsenArsen](/ArsenArsen)** commented [Aug 22, 2021](#issue-976362868) ‚Ä¢ edited Loading

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by

encoding the user-controlled values in this payload into base64 and

parsing them with atob.

In my exploration of the vulnerability with various payloads I and

others crafted, it would appear that this is the only available XSS in

hledger-web in relation to stored accounts and transaction details. If

there is other parts of the UI which may contain user-controlled data,

they should be examined for similar things. In this instance,

protections provided by yesod and other libraries worked fine, but in a

bit of code that hledger-web was generating, the user could insert a

</Script> tag (which is valid HTML and equivalent to </script> but not

caught by the T.Replace that existed in toBloodhoundJson) in order to

switch out of a script context, allowing the parser to be reset, and for

arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:

Content-Security-Policy headers should be introduced, and using

sha256- or a different algorithm, they should be marked

as trusted in the header. This way, if the (in-browser) parser and

hledger-web generator disagree on the source code of the script, the

script won't run. Note that this would still be susceptible to attacks

that involve changing the script by escaping from the string inside it

or something similar to that, which can be avoided additionally by using

either the method used in this commit, or a proper JSON encoder.

Test payload: `</Script><svg onload=alert(1)//>`

Closes [#1525](https://github.com/simonmichael/hledger/issues/1525)

Sorry, something went wrong.

All reactions

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
added
the
[web](/simonmichael/hledger/labels/web)
The hledger-web tool.
label
[Aug 22, 2021](#event-5191072613)

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [Aug 22, 2021](#issuecomment-903305821) ‚Ä¢ edited Loading

| Thanks [@ArsenArsen](https://github.com/ArsenArsen) .  The CI failure can be fixed by adding `- base64-0.4.2.3` to `extra-deps:` in `stack8.6.yaml`.  Also that package seems to have quite a few deps, including ghc-byteorder which requires cabal-version (cabal file format) 2.2, which I believe means hledger would be no longer buildable with cabal-install <2.2 (adding a new potential roadblock for installers). Debian oldstable has cabal 2.2 though, so I guess that would be ok.  There's also the base64-string package. Although older and probably unmaintained, it has no dependencies. |
| --- |

All reactions

Sorry, something went wrong.

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [Aug 22, 2021](#issuecomment-903307275) ‚Ä¢ edited Loading

| Could you briefly summarise the limitations of this fix versus the "real fix" you mention ?  Your commit message passed bin/commitlint, but not quite all of our [guidelines](https://hledger.org/CONTRIBUTING.html#commit-messages) - would you mind making it `fix: web: ...` to help me at changelog time.  Also for the changelog, could you remind me briefly of how the vulnerability looked to users ? Eg, here's a draft:   * An XSS (cross-site scripting) vulnerability has been fixed in hledger-web's add form.   Previously, obfuscated javascript could be added via (the account name field ?),   and could be executed automatically by subsequent visitors viewing (hledger-web ?) |
| --- |

All reactions

Sorry, something went wrong.

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [Aug 22, 2021](#issuecomment-903307756)

| PS if you can say without too much work which hledger version introduced the vulnerability, I'll mention that too. |
| --- |

All reactions

Sorry, something went wrong.

 [![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)
[ArsenArsen](/ArsenArsen)
[force-pushed](/simonmichael/hledger/compare/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea..73d65cd7394b88a520b60b2232b0feab8c6d9161)
the
master

branch
from
[`0f70f46`](/simonmichael/hledger/commit/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea) to
[`73d65cd`](/simonmichael/hledger/commit/73d65cd7394b88a520b60b2232b0feab8c6d9161)  [Compare](/simonmichael/hledger/compare/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea..73d65cd7394b88a520b60b2232b0feab8c6d9161)
[August 23, 2021 06:57](#event-5192426150)

[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=80&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

Copy link

Contributor

Author

### **[ArsenArsen](/ArsenArsen)** commented [Aug 23, 2021](#issuecomment-903496581)

| Would other GHC versions not also require the extra dep specified?  To quote the base64 readme: "There are no dependencies aside from those bundled with GHC, text-short, and the ghc-byteorder re-export". I thought these would be rather minor. If you want, I can refactor the patch to use base64-strings, but I intended to refactor the rest of this function and its callers to use Text instead.  The second approach has the advantage of preventing further XSS, to the extent specified above, in practice, a combination of both should be used, b64 for embedded data and the CSP sha256-hash script-src over everything else, which will eliminate all injected or malformed script blocks (via CSP), in combination with eliminating any HTML closing tags which might occur in stored data (via b64).  This vulnerability appears to have been first introduced when autocompletion was added in hledger-web, git tag hledger-0.24, commit hash: [ec51d28](https://github.com/simonmichael/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)  An appropriate changelog entry for this vulnerability would be:   * An XSS vulnerability has been fixed in hledger-web. Previously, JavaScript could be added to any autocomplete-able field and could be executed automatically by subsequent visitors viewing the journal.   It's not fair to call this obfuscated JavaScript, it just uses some HTML laxness to go around an insufficient prevention previously added to the add form. And this works in any field that can be autocompleted via Bloodhound. |
| --- |

All reactions

Sorry, something went wrong.

 [![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)
[ArsenArsen](/ArsenArsen)
[force-pushed](/simonmichael/hledger/compare/3f942693099e108751e23aa03f2de95f3a833d63..00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0)
the
master

branch
2 times, most recently
from
[`3f94269`](/simonmichael/hledger/commit/3f942693099e108751e23aa03f2de95f3a833d63) to
[`00c3ef4`](/simonmichael/hledger/commit/00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0)  [Compare](/simonmichael/hledger/compare/3f942693099e108751e23aa03f2de95f3a833d63..00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0)
[August 24, 2021 14:42](#event-5201120089)

[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&v=4)](/ArsenArsen)

`[fix: web: b64 encode user controlled input (](/simonmichael/hledger/pull/1663/commits/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/simonmichael/hledger/pull/1663/commits/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
 ‚Ä¶

`[7ac9217](/simonmichael/hledger/pull/1663/commits/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/ArsenArsen/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

 [![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)
[ArsenArsen](/ArsenArsen)
[force-pushed](/simonmichael/hledger/compare/00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0..022eb979da8e3c2c8f96e8994415b68c800331af)
the
master

branch
from
[`00c3ef4`](/simonmichael/hledger/commit/00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0) to
[`022eb97`](/simonmichael/hledger/commit/022eb979da8e3c2c8f96e8994415b68c800331af)  [Compare](/simonmichael/hledger/compare/00c3ef415f066abfc172e3ca0cfcdd43e3ab19f0..022eb979da8e3c2c8f96e8994415b68c800331af)
[August 24, 2021 14:44](#event-5201132620)

[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&v=4)](/ArsenArsen)

`[ref: web: refactor toBloodhoundJson for Data.Text](/simonmichael/hledger/pull/1663/commits/a20fc1bd960cde99a0799ce01362d78d5fe5fccd "ref: web: refactor toBloodhoundJson for Data.Text

This has the advantage of there being no extra unpacking/packing of
Data.Text to/from strings where it isn't necessary.")`
 ‚Ä¶

`[a20fc1b](/simonmichael/hledger/pull/1663/commits/a20fc1bd960cde99a0799ce01362d78d5fe5fccd)`

```
This has the advantage of there being no extra unpacking/packing of
Data.Text to/from strings where it isn't necessary.
```

 [![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)
[ArsenArsen](/ArsenArsen)
[force-pushed](/simonmichael/hledger/compare/022eb979da8e3c2c8f96e8994415b68c800331af..a20fc1bd960cde99a0799ce01362d78d5fe5fccd)
the
master

branch
from
[`022eb97`](/simonmichael/hledger/commit/022eb979da8e3c2c8f96e8994415b68c800331af) to
[`a20fc1b`](/simonmichael/hledger/commit/a20fc1bd960cde99a0799ce01362d78d5fe5fccd)  [Compare](/simonmichael/hledger/compare/022eb979da8e3c2c8f96e8994415b68c800331af..a20fc1bd960cde99a0799ce01362d78d5fe5fccd)
[August 24, 2021 15:03](#event-5201259696)

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
merged commit [`3504a91`](/simonmichael/hledger/commit/3504a91b42ae3b2dbeed1cda1cb142d2a7478cc1)
into
simonmichael:master

[Aug 24, 2021](https://github.com/simonmichael/hledger/pull/1663#event-5201268179)

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [Aug 24, 2021](#issuecomment-904724156)

| Great work, thanks for the vulnerability fix! |
| --- |

All reactions

Sorry, something went wrong.

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
mentioned this pull request
[Aug 24, 2021](#ref-issue-855210963)

[XSS vulnerability: malicious javascript can be stored via hledger-web add/edit
#1525](/simonmichael/hledger/issues/1525)

Closed

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
mentioned this pull request
[Dec 16, 2022](#ref-issue-1499873885)

[Hledger-web autocomplete hint for non-ascii account name
#1961](/simonmichael/hledger/issues/1961)

Closed

[![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=80&u=d2f9bbea032b21e8fb0fb8f50c1802b98f397c93&v=4)](/bayegaspard)

Copy link

### **[bayegaspard](/bayegaspard)** commented [May 5, 2023](#issuecomment-1536227741)

| Thank you [@ArsenArsen](https://github.com/ArsenArsen) and [@simonmichael](https://github.com/simonmichael) for the acknowledgement. I am wondering just for the record, can we file a CVE for the reported bug? |
| --- |

 üëç
1
 simonmichael reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [May 5, 2023](#issuecomment-1536442241) via email

| Sure, is it needed ? The bug was fixed by 1.23. The install page may show which distros ship an older version. Is it something you can do ? |
| --- |

All reactions

Sorry, something went wrong.

[![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=80&u=d2f9bbea032b21e8fb0fb8f50c1802b98f397c93&v=4)](/bayegaspard)

Copy link

### **[bayegaspard](/bayegaspard)** commented [May 5, 2023](#issuecomment-1536859446)

| Yes, just to record version <1.23 was vulnerable to stored XSS. I will test the recent versions soon, when I get some free time. |
| --- |

 üëç
1
 simonmichael reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=80&u=d2f9bbea032b21e8fb0fb8f50c1802b98f397c93&v=4)](/bayegaspard)

Copy link

### **[bayegaspard](/bayegaspard)** commented [May 5, 2023](#issuecomment-1536860250) ‚Ä¢ edited Loading

| We disclose vulnerabilities only when it is fixed. So now that it is fixed, we can file for CVE. |
| --- |

 üöÄ
1
 simonmichael reacted with rocket emoji

All reactions

* üöÄ
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fpull%2F1663)

Reviewers

No reviews

Assignees

No one assigned

Labels

[web](/simonmichael/hledger/labels/web)
The hledger-web tool.

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [XSS vulnerability: malicious javascript can be stored via hledger-web add/edit](https://github.com/simonmichael/hledger/issues/1525)

3 participants

[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=52&v=4)](/ArsenArsen) [![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=52&v=4)](/simonmichael) [![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=52&v=4)](/bayegaspard)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_c705645a_20250114_201637.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fissues%2F1525)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fissues%2F1525)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=simonmichael%2Fhledger)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[simonmichael](/simonmichael)
/
**[hledger](/simonmichael/hledger)**
Public

* [Notifications](/login?return_to=%2Fsimonmichael%2Fhledger) You must be signed in to change notification settings
* [Fork
  321](/login?return_to=%2Fsimonmichael%2Fhledger)
* [Star
   3.1k](/login?return_to=%2Fsimonmichael%2Fhledger)

* [Code](/simonmichael/hledger)
* [Issues
  342](/simonmichael/hledger/issues)
* [Pull requests
  19](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects
  0](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

Additional navigation options

* [Code](/simonmichael/hledger)
* [Issues](/simonmichael/hledger/issues)
* [Pull requests](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsimonmichael%2Fhledger%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsimonmichael%2Fhledger%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# XSS vulnerability: malicious javascript can be stored via hledger-web add/edit #1525

Closed

[simonmichael](/simonmichael) opened this issue
Apr 11, 2021
¬∑ 4 comments
 ¬∑ Fixed by [#1663](https://github.com/simonmichael/hledger/pull/1663)

Closed

# [XSS vulnerability: malicious javascript can be stored via hledger-web add/edit](#top) #1525

[simonmichael](/simonmichael) opened this issue
Apr 11, 2021
¬∑ 4 comments
 ¬∑ Fixed by [#1663](https://github.com/simonmichael/hledger/pull/1663)

Labels
[A-BUG](/simonmichael/hledger/labels/A-BUG)
Something wrong, confusing or sub-standard in the software, docs, or user experience.
[web](/simonmichael/hledger/labels/web)
The hledger-web tool.

## Comments

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

### **[simonmichael](/simonmichael)** commented [Apr 11, 2021](#issue-855210963) ‚Ä¢ edited Loading

| hledger-web's forms sanitise obvious javascript, but not obfuscated javascript (cf <https://owasp.org/www-community/xss-filter-evasion-cheatsheet>). This means hledger-web instances, especially anonymously-writable ones like demo.hledger.org, could be loaded with malicious javascript to be executed by subsequent visitors. Reported by Gaspard Baye and Hamidullah Muslih, who also provided a video and example of such js which I can share.  hledger-web processes forms with runFormPost, part of [yesod-form](https://hackage.haskell.org/package/yesod-form). I am guessing that makes use of [xss-sanitize](https://hackage.haskell.org/package/xss-sanitize) ? But note sanitising and escaping are different (<https://github.com/yesodweb/haskell-xss-sanitize#readme>). I get the impression it may be impossible to escape/sanitise with 100% reliability; if so, what should we do ? Tighten up sanitization as much as we can and document that anonymous-writable hledger-web's are unsafe and not recommended, and make demo.hledger.org read only ?  I would appreciate any help diagnosing and resolving this. Questions to be answered:   * which libraries are involved here - yesod-form, xss-sanitize, ... ? * are we getting the most protection available from them ? * should we open bugs against any of them ? * is it ok for me to share an example of obfuscated js here ? * are there any public hledger-web instances other than demo.hledger.org ? * is reliable escaping/sanitisation possible ? * if not, what should be done for hledger-web ? |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
added
[A-BUG](/simonmichael/hledger/labels/A-BUG)
Something wrong, confusing or sub-standard in the software, docs, or user experience.
[web](/simonmichael/hledger/labels/web)
The hledger-web tool.
labels
[Apr 11, 2021](#event-4578109497)

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
changed the title
~~malicious javascript can be stored via hledger-web add/edit~~
XSS vulnerability: malicious javascript can be stored via hledger-web add/edit
[Apr 11, 2021](#event-4578115563)

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 22, 2021](#ref-commit-ef70e45)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[web: base64 encode user controlled strings (](/ArsenArsen/hledger/commit/ef70e457f591f424923dc8a122fd1d28e675ed61 "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/ef70e457f591f424923dc8a122fd1d28e675ed61 "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.")`
‚Ä¶

`[ef70e45](/ArsenArsen/hledger/commit/ef70e457f591f424923dc8a122fd1d28e675ed61)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.
```

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 22, 2021](#ref-commit-1da6f75)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[web: base64 encode user controlled strings (](/ArsenArsen/hledger/commit/1da6f75636fbb30041447dbb0da17976b763af76 "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/1da6f75636fbb30041447dbb0da17976b763af76 "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>")`
‚Ä¶

`[1da6f75](/ArsenArsen/hledger/commit/1da6f75636fbb30041447dbb0da17976b763af76)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>
```

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 22, 2021](#ref-commit-0f70f46)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[web: base64 encode user controlled strings (](/ArsenArsen/hledger/commit/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea "web: base64 encode user controlled strings (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[0f70f46](/ArsenArsen/hledger/commit/0f70f4665e78e32e824cd6f6eed9f0b7c1c2e5ea)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)
[ArsenArsen](/ArsenArsen)
mentioned this issue
[Aug 22, 2021](#ref-pullrequest-976362868)

[web: base64 encode user controlled strings (#1525)
#1663](/simonmichael/hledger/pull/1663)
 Merged

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 23, 2021](#ref-commit-73d65cd)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[fix: web: b64 encode user controlled input (](/ArsenArsen/hledger/commit/73d65cd7394b88a520b60b2232b0feab8c6d9161 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/73d65cd7394b88a520b60b2232b0feab8c6d9161 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[73d65cd](/ArsenArsen/hledger/commit/73d65cd7394b88a520b60b2232b0feab8c6d9161)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/ArsenArsen/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 24, 2021](#ref-commit-4e1160b)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[fix: web: b64 encode user controlled input (](/ArsenArsen/hledger/commit/4e1160bc22db7681ea94fb938efe0c700ad85e3d "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/4e1160bc22db7681ea94fb938efe0c700ad85e3d "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[4e1160b](/ArsenArsen/hledger/commit/4e1160bc22db7681ea94fb938efe0c700ad85e3d)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/ArsenArsen/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 24, 2021](#ref-commit-9139bc6)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[fix: web: b64 encode user controlled input (](/ArsenArsen/hledger/commit/9139bc68207d361ad045a894adad5988262c9a06 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/9139bc68207d361ad045a894adad5988262c9a06 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[9139bc6](/ArsenArsen/hledger/commit/9139bc68207d361ad045a894adad5988262c9a06)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/ArsenArsen/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[ArsenArsen](/ArsenArsen)
added a commit
to ArsenArsen/hledger
that referenced
this issue
[Aug 24, 2021](#ref-commit-7ac9217)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen)

`[fix: web: b64 encode user controlled input (](/ArsenArsen/hledger/commit/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/ArsenArsen/hledger/commit/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6 "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[7ac9217](/ArsenArsen/hledger/commit/7ac921730ee0f62c8b4ec9de6526c43e72bfd3c6)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/ArsenArsen/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [simonmichael#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[simonmichael](/simonmichael)
pushed a commit
that referenced
this issue
[Aug 24, 2021](#ref-commit-cc30911)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen) [![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)

`[fix: web: b64 encode user controlled input (](/simonmichael/hledger/commit/cc30911c2947673be863064ac67fbf4302a7bf1f "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/simonmichael/hledger/commit/cc30911c2947673be863064ac67fbf4302a7bf1f "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[cc30911](/simonmichael/hledger/commit/cc30911c2947673be863064ac67fbf4302a7bf1f)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/simonmichael/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)
[simonmichael](/simonmichael)
closed this as [completed](/simonmichael/hledger/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#1663](/simonmichael/hledger/pull/1663)
[Aug 24, 2021](#event-5201268195)

[simonmichael](/simonmichael)
pushed a commit
that referenced
this issue
[Aug 24, 2021](#ref-commit-9ce5514)
[![@ArsenArsen](https://avatars.githubusercontent.com/u/7805050?s=40&u=75172002aeb885cc255e911b7f11bc7dfba2ab4a&v=4)](/ArsenArsen) [![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)](/simonmichael)

`[fix: web: b64 encode user controlled input (](/simonmichael/hledger/commit/9ce55146c8f830cb6bc13db2dea67bd9ee73127b "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")[#1525](https://github.com/simonmichael/hledger/issues/1525)[)](/simonmichael/hledger/commit/9ce55146c8f830cb6bc13db2dea67bd9ee73127b "fix: web: b64 encode user controlled input (#1525)

This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: ec51d28839b2910eea360b1b8c72904b51cf7821

Test payload: </Script><svg onload=alert(1)//>

Closes #1525")`
‚Ä¶

`[9ce5514](/simonmichael/hledger/commit/9ce55146c8f830cb6bc13db2dea67bd9ee73127b)`

```
This fixes a reported Stored XSS vulnerability in toBloodhoundJson by
encoding the user-controlled values in this payload into base64 and
parsing them with atob.

In my exploration of the vulnerability with various payloads I and
others crafted, it would appear that this is the only available XSS in
hledger-web in relation to stored accounts and transaction details. If
there is other parts of the UI which may contain user-controlled data,
they should be examined for similar things. In this instance,
protections provided by yesod and other libraries worked fine, but in a
bit of code that hledger-web was generating, the user could insert a
</Script> tag (which is valid HTML and equivalent to </script> but not
caught by the T.Replace that existed in toBloodhoundJson) in order to
switch out of a script context, allowing the parser to be reset, and for
arbitrary JavaScript to run.

The real fix is a bit more involved, but produces much better results:
Content-Security-Policy headers should be introduced, and using
sha256-<hash of script> or a different algorithm, they should be marked
as trusted in the header. This way, if the (in-browser) parser and
hledger-web generator disagree on the source code of the script, the
script won't run. Note that this would still be susceptible to attacks
that involve changing the script by escaping from the string inside it
or something similar to that, which can be avoided additionally by using
either the method used in this commit, or a proper JSON encoder.

The second approach has the advantage of preventing further XSS, to the
extent specified above, in practice, a combination of both should be
used, b64 for embedded data and the CSP sha256-hash script-src over
everything else, which will eliminate all injected or malformed script
blocks (via CSP), in combination with eliminating any HTML closing tags
which might occur in stored data (via b64).

This vulnerability appears to have been first introduced when
autocompletion was added in hledger-web, git tag hledger-0.24, commit
hash: [ec51d28](https://github.com/simonmichael/hledger/commit/ec51d28839b2910eea360b1b8c72904b51cf7821)

Test payload: </Script><svg onload=alert(1)//>

Closes [#1525](https://github.com/simonmichael/hledger/issues/1525)
```

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=80&v=4)](/simonmichael)

Copy link

Owner

Author

### **[simonmichael](/simonmichael)** commented [Aug 24, 2021](#issuecomment-904740681)

| (For answers to the questions above, see discussion on [#1663](https://github.com/simonmichael/hledger/pull/1663).) |
| --- |

All reactions

Sorry, something went wrong.

[![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=80&u=d2f9bbea032b21e8fb0fb8f50c1802b98f397c93&v=4)](/bayegaspard)

Copy link

### **[bayegaspard](/bayegaspard)** commented [May 5, 2023](#issuecomment-1536228857)

| Thank you [@simonmichael](https://github.com/simonmichael) for the acknowledgement. I am wondering just for the record, can we file a CVE for the reported bug? |
| --- |

All reactions

Sorry, something went wrong.

[![@frasertweedale](https://avatars.githubusercontent.com/u/2331938?s=80&u=426bf3e2bb775a05beeaac3c855b22cbb9ad0458&v=4)](/frasertweedale)

Copy link

### **[frasertweedale](/frasertweedale)** commented [Jul 22, 2023](#issuecomment-1646502638)

| [@simonmichael](https://github.com/simonmichael) Sorry to bump an historical issue, but wondering if you could advise in which version of `hledger-web` this issue was introduced, and also whether it existed in `hledger` before the web bits were split out (and if so, which version introduced it). |
| --- |

All reactions

Sorry, something went wrong.

[![@frasertweedale](https://avatars.githubusercontent.com/u/2331938?s=80&u=426bf3e2bb775a05beeaac3c855b22cbb9ad0458&v=4)](/frasertweedale)

Copy link

### **[frasertweedale](/frasertweedale)** commented [Jul 22, 2023](#issuecomment-1646502896)

| [@simonmichael](https://github.com/simonmichael) sorry for the noise, just noticed this info the corresponding PR discussion. Thanks! |
| --- |

 üëç
1
 simonmichael reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Fissues%2F1525)

Assignees

No one assigned

Labels

[A-BUG](/simonmichael/hledger/labels/A-BUG)
Something wrong, confusing or sub-standard in the software, docs, or user experience.
[web](/simonmichael/hledger/labels/web)
The hledger-web tool.

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [web: base64 encode user controlled strings (#1525)](/simonmichael/hledger/pull/1663)
 [ArsenArsen/hledger](/ArsenArsen/hledger)

3 participants

[![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=52&v=4)](/simonmichael) [![@frasertweedale](https://avatars.githubusercontent.com/u/2331938?s=52&v=4)](/frasertweedale) [![@bayegaspard](https://avatars.githubusercontent.com/u/11983328?s=52&v=4)](/bayegaspard)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_de5cc5e9_20250114_201641.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Freleases%2Ftag%2F1.23)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsimonmichael%2Fhledger%2Freleases%2Ftag%2F1.23)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=simonmichael%2Fhledger)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[simonmichael](/simonmichael)
/
**[hledger](/simonmichael/hledger)**
Public

* [Notifications](/login?return_to=%2Fsimonmichael%2Fhledger) You must be signed in to change notification settings
* [Fork
  321](/login?return_to=%2Fsimonmichael%2Fhledger)
* [Star
   3.1k](/login?return_to=%2Fsimonmichael%2Fhledger)

* [Code](/simonmichael/hledger/tree/1.23)
* [Issues
  342](/simonmichael/hledger/issues)
* [Pull requests
  19](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects
  0](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

Additional navigation options

* [Code](/simonmichael/hledger/tree/1.23)
* [Issues](/simonmichael/hledger/issues)
* [Pull requests](/simonmichael/hledger/pulls)
* [Actions](/simonmichael/hledger/actions)
* [Projects](/simonmichael/hledger/projects)
* [Security](/simonmichael/hledger/security)
* [Insights](/simonmichael/hledger/pulse)

1. [Releases](/simonmichael/hledger/releases)
2. [1.23](/simonmichael/hledger/releases/tag/1.23)

# 1.23

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/simonmichael/hledger/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.23)

 Loading

[View all tags](/simonmichael/hledger/tags)

![@simonmichael](https://avatars.githubusercontent.com/u/10144?s=40&v=4)
[simonmichael](/simonmichael)
released this
22 Sep 03:45

¬∑
[3215 commits](/simonmichael/hledger/compare/1.23...master)
to master
since this release

[1.23](/simonmichael/hledger/tree/1.23)

This tag was signed with the committer‚Äôs **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/10144?s=64&v=4)](/simonmichael)
[simonmichael](/simonmichael)
Simon Michael

GPG key ID: 8D19C40733D9E082
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`47b5b6b`](/simonmichael/hledger/commit/47b5b6be0d3f3fd42cf58508e28521d46b5bbb64)

**Capital gains report,

separate symbol/number display,

command line commodity styling,

budget selection,

weekday/weekend recurrence,

10% speedup,

fixes.**

Release notes: <https://hledger.org/release-notes.html#hledger-1-23>

This release may be packaged for your system: check <https://hledger.org/download.html#binary-packages>. Or, you can try the binaries built by our github CI setup, below. Notes:

* Download and unzip the appropriate "hledger-PLATFORM.zip" file below. This will unpack 2 or 3 hledger binaries into the current directory. On mac and unix machines, you will need to `chmod +x` these files to make them executable.
* Windows binaries are built on Windows Server 2019. There is no hledger-ui binary for Windows.
* Mac binaries are built on macos 10.15 catalina. You will need to mark them as trusted before you can run them: run `open .` to view the current folder in Finder; control-click `hledger`; option-click "Open"; allow running it.
* Linux binaries are static and should run on most GNU/Linux machines with x64 or (when provided) arm32v7 architecture.

 Assets
5

 Loading

 üéâ
5
 juev, zakkor, danihodovic, pandabrun, and alan-andrade reacted with hooray emoji
 ‚ù§Ô∏è
1
 danihodovic reacted with heart emoji

All reactions

* üéâ
  5 reactions
* ‚ù§Ô∏è
  1 reaction

 5 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


