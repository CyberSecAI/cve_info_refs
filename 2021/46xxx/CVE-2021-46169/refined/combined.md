=== Content from github.com_b727d89d_20250115_090349.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnimble-code%2FModex%2Fissues%2F10)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnimble-code%2FModex%2Fissues%2F10)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nimble-code%2FModex)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nimble-code](/nimble-code)
/
**[Modex](/nimble-code/Modex)**
Public

* [Notifications](/login?return_to=%2Fnimble-code%2FModex) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fnimble-code%2FModex)
* [Star
   20](/login?return_to=%2Fnimble-code%2FModex)

* [Code](/nimble-code/Modex)
* [Issues
  0](/nimble-code/Modex/issues)
* [Pull requests
  0](/nimble-code/Modex/pulls)
* [Actions](/nimble-code/Modex/actions)
* [Projects
  0](/nimble-code/Modex/projects)
* [Security](/nimble-code/Modex/security)
* [Insights](/nimble-code/Modex/pulse)

Additional navigation options

* [Code](/nimble-code/Modex)
* [Issues](/nimble-code/Modex/issues)
* [Pull requests](/nimble-code/Modex/pulls)
* [Actions](/nimble-code/Modex/actions)
* [Projects](/nimble-code/Modex/projects)
* [Security](/nimble-code/Modex/security)
* [Insights](/nimble-code/Modex/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnimble-code%2FModex%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnimble-code%2FModex%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Use After Free #10

Closed

[AiDaiP](/AiDaiP) opened this issue
Jan 2, 2022
· 1 comment

Closed

# [Use After Free](#top) #10

[AiDaiP](/AiDaiP) opened this issue
Jan 2, 2022
· 1 comment

## Comments

[![@AiDaiP](https://avatars.githubusercontent.com/u/43956964?s=80&u=ff92a9138fda3e540ab80ed35e8916bfd5088cd8&v=4)](/AiDaiP)

Copy link

### **[AiDaiP](/AiDaiP)** commented [Jan 2, 2022](#issue-1092063314)

| Use After FreeDescription I am learning model checking. But I run a fuzzer for fun today.  My fuzzer has found a Use After Free in modex.  The chunk 0x5555555b96b0 was freed.Then the tcache key was covered and the chunk was freed again.  **version**  [acfa291](https://github.com/nimble-code/Modex/commit/acfa29117dc1c7428b330144841002b3a39fdfe8)  ``` modex -V MODEX Version 2.11 - 3 November 2017  ```  **System information** Ubuntu 20.04 focal, AMD EPYC 7742 64-Core @ 16x 2.25GHz  **poc**  ``` base64 poc dHlwZWRlZiBzdHJ1Y3QgRW50cnkgRW50cnk7CgpzdHJ1Y3QgRW50cnkgewp9CglFbnRyeSBoZWFk OwoJZm9yICh2YWwgPSAwOyB2YWwgPCAycmV0dXJuOyB2YWwrKyl9Cgp2b2lkICoKcnRsX2dldCh2 b2lkICphcmcpCnsJNG50cnkgKnE7CgkJbmV4dCA9IHEtPm5leHQ7CmlmIDsxPT0wKQoJCWUgPSBu ZXh0LT5uZXh0O3ggPSBjewoJCW5leHQgPSBxLT5uZXh0OwoJCWlmICgoeCA9PSAwKTsKCglpZiAo cS0+bmV4dGVtcCBuaWwgJiYgZSA9PSAwKQoJewl4ID0gY2FzKCZxLT50YWlsLCBuZXh0LCBxKTsK CQlpZih4ID09IDApCgkJewljYXMoJm5leHQtPm5leHQsIG5pbCwgbmV4dC0+dMptcCk7CgkJCS0+ bmV4YXNzZXJ0KG5leHQ8PnZhbHVlID2AAAAAIHZhbDEgKyAxIHx8IG5leHQtPnZhbHVlID09IHZh bDIgKyAxcnkgaGVhZDsKRW50cnkgKm5pbCA9O3ByZXYtPnRlbXAgPSBuZXc7CgkJZGVjdmFsMSAr IDEpCgkJdmFsMSsrOwp9CgppbnQKbWFpbih2b2lkKQp9CglyZXR1cm4gMDsKfQo= ```  **command**  ``` ./modex ./poc.c  ```  **Result**  ``` modex poc.c MODEX Version 2.11 - 3 November 2017 poc.c:4: Error (syntax error, unexpected RBRACE) before '}' } ^ poc.c:6: Error (syntax error, unexpected FOR) before 'for'  for (val = 0; val < 2return; val++)}  ^ poc.c:10: Error (syntax error, unexpected IDENT, expecting SEMICOLON) before 'Identifier' { 4ntry *q;    ^ poc.c:12: Error (syntax error, unexpected SEMICOLON, expecting LPAREN) before ';' if ;1==0)    ^ poc.c:12: Error (syntax error, unexpected RPAREN, expecting SEMICOLON) before ')' if ;1==0)         ^ poc.c:13: Error (syntax error, unexpected LBRACE, expecting SEMICOLON) before '{'   e = next->next;x = c{                       ^ poc.c:15: Error (syntax error, unexpected SEMICOLON, expecting RPAREN) before ';'   if ((x == 0);               ^ poc.c:17: Error (syntax error, unexpected IDENT, expecting RPAREN) before 'Identifier'  if (q->nextemp nil && e == 0)                 ^ poc.c:20: Error (syntax error, unexpected RPAREN, expecting SEMICOLON) before ')'   decval1 + 1)              ^ poc.c:26: Error (syntax error, unexpected RBRACE, expecting LBRACE) before '}' } ^ too many errors (10 detected) 10 errors free(): double free detected in tcache 2 [1]    3645907 abort      modex poc.c  ```  **gdb**  `watch *0x5555555b96b0`  `c 34`  `n`  ``` pwndbg> 0x00007ffff7cf603e      863     in libioP.h LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA ──────────────────────────────────────[ REGISTERS ]──────────────────────────────────────  RAX  0xffffff00  RBX  0x7ffff7e5e4a0 (_IO_file_jumps) ◂— 0x0  RCX  0xffffffffffffffb0  RDX  0x1c500 *RDI  0x5555555b96b0 —▸ 0x5555555ba020 ◂— 0x0  RSI  0x0  R8   0x8000  R9   0xa  R10  0x5555555988f6 ◂— ' errors\n'  R11  0x246  R12  0xffffffff  R13  0x7fffffffe180 ◂— 0x2  R14  0x0  R15  0x0  RBP  0x5555555b96b0 —▸ 0x5555555ba020 ◂— 0x0  RSP  0x7fffffffdc90 —▸ 0x55555558c130 (__libc_csu_init) ◂— endbr64 *RIP  0x7ffff7cf603e (fclose+238) ◂— call   0x7ffff7c96330 ───────────────────────────────────────[ DISASM ]────────────────────────────────────────    0x7ffff7cf602e <fclose+222>    or     dl, al    0x7ffff7cf6030 <fclose+224>    jne    fclose+243                <fclose+243>     0x7ffff7cf6032 <fclose+226>    cmp    rbp, qword ptr [rip + 0x165e57]    0x7ffff7cf6039 <fclose+233>    je     fclose+243                <fclose+243>     0x7ffff7cf603b <fclose+235>    mov    rdi, rbp  ► 0x7ffff7cf603e <fclose+238>    call   free@plt                <free@plt>         ptr: 0x5555555b96b0 —▸ 0x5555555ba020 ◂— 0x0     0x7ffff7cf6043 <fclose+243>    mov    eax, r12d    0x7ffff7cf6046 <fclose+246>    pop    rbx    0x7ffff7cf6047 <fclose+247>    pop    rbp    0x7ffff7cf6048 <fclose+248>    pop    r12    0x7ffff7cf604a <fclose+250>    ret ────────────────────────────────────────[ STACK ]──────────────────────────────────────── 00:0000│ rsp 0x7fffffffdc90 —▸ 0x55555558c130 (__libc_csu_init) ◂— endbr64 01:0008│     0x7fffffffdc98 —▸ 0x7fffffffdcc0 —▸ 0x7fffffffdf40 —▸ 0x7fffffffe090 ◂— 0x0 02:0010│     0x7fffffffdca0 —▸ 0x5555555585c0 (_start) ◂— endbr64 03:0018│     0x7fffffffdca8 —▸ 0x55555555b17e (Fclose+69) ◂— nop 04:0020│     0x7fffffffdcb0 —▸ 0x555555573208 (top_of_stack+28) ◂— test   eax, eax 05:0028│     0x7fffffffdcb8 —▸ 0x5555555b96b0 —▸ 0x5555555ba020 ◂— 0x0 06:0030│     0x7fffffffdcc0 —▸ 0x7fffffffdf40 —▸ 0x7fffffffe090 ◂— 0x0 07:0038│     0x7fffffffdcc8 —▸ 0x55555555f440 (process_input+883) ◂— mov    qword ptr [rbp - 0x260], 0 ──────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────  ► f 0   0x7ffff7cf603e fclose+238    f 1   0x7ffff7cf603e fclose+238    f 2   0x55555555b17e Fclose+69    f 3   0x55555555f440 process_input+883    f 4   0x55555555f780 main+624    f 5   0x7ffff7c980b3 __libc_start_main+243 ───────────────────────────────────────────────────────────────────────────────────────── pwndbg> bin tcachebins 0x1e0 [  2]: 0x5555555b96b0 —▸ 0x5555555ba020 ◂— 0x0 fastbins 0x20: 0x0 0x30: 0x0 0x40: 0x0 0x50: 0x0 0x60: 0x0 0x70: 0x0 0x80: 0x0 unsortedbin all: 0x0 smallbins empty largebins 0xe00: 0x5555555b98f0 —▸ 0x7ffff7e5d1f0 (main_arena+1648) ◂— 0x5555555b98f0 pwndbg> x/10gx 0x5555555b96b0 0x5555555b96b0: 0x00005555555ba020      0x00005555555bba90 0x5555555b96c0: 0x00005555555bba90      0x00005555555bba90 0x5555555b96d0: 0x00005555555bba90      0x00005555555bba90 0x5555555b96e0: 0x00005555555bba90      0x0000000000000000 0x5555555b96f0: 0x0000000000000000      0x0000000000000000 pwndbg> bt #0  0x00007ffff7cf603e in _IO_deallocate_file (fp=0x5555555b96b0) at libioP.h:863 #1  _IO_new_fclose (fp=0x5555555b96b0) at iofclose.c:74 #2  0x000055555555b17e in Fclose (fd=0x5555555b96b0) at modex.c:105 #3  0x000055555555f440 in process_input (f=0x7ffff7b6d0a0 "./poc.c", phase2=0) at modex.c:1243 #4  0x000055555555f780 in main (argc=2, argv=0x7fffffffe188) at modex.c:1306 #5  0x00007ffff7c980b3 in __libc_start_main (main=0x55555555f510 <main>, argc=2, argv=0x7fffffffe188, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffe178) at ../csu/libc-start.c:308 #6  0x00005555555585ee in _start () ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@nimble-code](https://avatars.githubusercontent.com/u/45924129?s=80&u=f1aefada96df5de929f73e746b326e5a152da488&v=4)](/nimble-code)

Copy link

Owner

### **[nimble-code](/nimble-code)** commented [Jan 2, 2022](#issuecomment-1003765178)

| Very cool find! This one is hard to diagnose though. In looking at the code I do see that line 1225, and hence line 1243 with Fclose(fp), can be reached even when fp is not set on line 1207, e.g. when "must\_preprocess" is non-zero. And, since fp is not initialized in the declaration, the pointer could have an arbitrary value from a previous call, that could then lead to the double fclose. It's a bizarre scenario, but possible. I fixed it by initializing fp to NULL in the declaration (which would have been required in any case). I wonder if the fuzzer can still find a path? Excellent report -- thank you for all your efforts! |
| --- |

All reactions

Sorry, something went wrong.

[![@nimble-code](https://avatars.githubusercontent.com/u/45924129?s=40&u=f1aefada96df5de929f73e746b326e5a152da488&v=4)](/nimble-code)
[nimble-code](/nimble-code)
closed this as [completed](/nimble-code/Modex/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jan 2, 2022](#event-5832986861)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnimble-code%2FModex%2Fissues%2F10)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@AiDaiP](https://avatars.githubusercontent.com/u/43956964?s=52&v=4)](/AiDaiP) [![@nimble-code](https://avatars.githubusercontent.com/u/45924129?s=52&v=4)](/nimble-code)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


