=== Content from github.com_f78a58be_20250114_223945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F882925b295a80ec992063deffc2a3b0d803c3195)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F882925b295a80ec992063deffc2a3b0d803c3195)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ruven%2Fiipsrv)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ruven](/ruven)
/
**[iipsrv](/ruven/iipsrv)**
Public

* [Notifications](/login?return_to=%2Fruven%2Fiipsrv) You must be signed in to change notification settings
* [Fork
  115](/login?return_to=%2Fruven%2Fiipsrv)
* [Star
   297](/login?return_to=%2Fruven%2Fiipsrv)

* [Code](/ruven/iipsrv)
* [Issues
  51](/ruven/iipsrv/issues)
* [Pull requests
  1](/ruven/iipsrv/pulls)
* [Actions](/ruven/iipsrv/actions)
* [Projects
  0](/ruven/iipsrv/projects)
* [Security](/ruven/iipsrv/security)
* [Insights](/ruven/iipsrv/pulse)

Additional navigation options

* [Code](/ruven/iipsrv)
* [Issues](/ruven/iipsrv/issues)
* [Pull requests](/ruven/iipsrv/pulls)
* [Actions](/ruven/iipsrv/actions)
* [Projects](/ruven/iipsrv/projects)
* [Security](/ruven/iipsrv/security)
* [Insights](/ruven/iipsrv/pulse)

## Commit

[Permalink](/ruven/iipsrv/commit/882925b295a80ec992063deffc2a3b0d803c3195)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

- Modified TileManager.cc to verify that malloc() has correctly alloc…

[Browse files](/ruven/iipsrv/tree/882925b295a80ec992063deffc2a3b0d803c3195)
Browse the repository at this point in the history

```
…ated memory.

- Updated numerical types to std::size_t in RawTile.h, TileManager.cc, KakaduImage.cc, OpenJPEG.cc and Transforms.cc when allocating memory via new to avoid integer overflow - fixes remaining problems identified in [#223](https://github.com/ruven/iipsrv/issues/223).
```

* Loading branch information

[![@ruven](https://avatars.githubusercontent.com/u/776628?s=40&v=4)](/ruven)

[ruven](/ruven/iipsrv/commits?author=ruven "View all commits by ruven")
committed
Jan 16, 2022

1 parent
[4ed5926](/ruven/iipsrv/commit/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9)

commit 882925b

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**33 additions**
and
**17 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ChangeLog
  [ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb)
* src

  + src/KakaduImage.cc
    [KakaduImage.cc](#diff-fa4e8888c1da0985420eac62feb83e5c9d161c8b190e748b5ede02c53695c422)
  + src/OpenJPEGImage.cc
    [OpenJPEGImage.cc](#diff-a80c21915bb38932a0a6c9ec179401297ee4b2afb65428fa72061f057c2bf3a4)
  + src/RawTile.h
    [RawTile.h](#diff-ea606448d6ea89600653805a87315fe08b9b777b3e567598e1a205f66cafbd6e)
  + src/TileManager.cc
    [TileManager.cc](#diff-8c97506cc7efe6f8108cb728a47ea22d0342bb3eec9cab6a617722ef6a86c109)
  + src/Transforms.cc
    [Transforms.cc](#diff-de72e619c42ca3adec2def643d30fb05617a02d047cb95d9637b8b521628c732)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb "ChangeLog")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/ChangeLog)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,10 @@ |
|  |  | 16/01/2022: |
|  |  | - Modified TileManager.cc to verify that malloc() has correctly allocated memory. |
|  |  | - Updated numerical types to std::size\_t in RawTile.h, TileManager.cc, KakaduImage.cc, OpenJPEG.cc and Transforms.cc |
|  |  | when allocating memory via new to avoid integer overflow - fixes remaining problems identified in |
|  |  | https://github.com/ruven/iipsrv/issues/223. |
|  |  |  |
|  |  |  |
|  |  | 15/01/2022: |
|  |  | - Added verification that image has been set in SPECTRA.cc and check on the validity of the requested tile |
|  |  | resolution in JTL.cc. Fixes a couple of the crash conditions reported in https://github.com/ruven/iipsrv/issues/223 |
| Expand Down | |  |

7 changes: 4 additions & 3 deletions

7
[src/KakaduImage.cc](#diff-fa4e8888c1da0985420eac62feb83e5c9d161c8b190e748b5ede02c53695c422 "src/KakaduImage.cc")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/src/KakaduImage.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -447,11 +447,12 @@ RawTile KakaduImage::getRegion( int seq, int ang, unsigned int res, int layers, |
|  |  |  |
|  |  | RawTile rawtile( 0, res, seq, ang, w, h, channels, obpc ); |
|  |  |  |
|  |  | if( obpc == 16 ) rawtile.data = new unsigned short[w\*h\*channels]; |
|  |  | else if( obpc == 8 ) rawtile.data = new unsigned char[w\*h\*channels]; |
|  |  | size\_t np = (size\_t) w \* (size\_t) h \* (size\_t) channels; |
|  |  | if( obpc == 16 ) rawtile.data = new unsigned short[np]; |
|  |  | else if( obpc == 8 ) rawtile.data = new unsigned char[np]; |
|  |  | else throw file\_error( "Kakadu :: Unsupported number of bits" ); |
|  |  |  |
|  |  | rawtile.dataLength = w\*h\*channels\*(obpc/8); |
|  |  | rawtile.dataLength = np\*(obpc/8); |
|  |  | rawtile.filename = getImagePath(); |
|  |  | rawtile.timestamp = timestamp; |
|  |  |  |
| Expand Down | |  |

7 changes: 4 additions & 3 deletions

7
[src/OpenJPEGImage.cc](#diff-a80c21915bb38932a0a6c9ec179401297ee4b2afb65428fa72061f057c2bf3a4 "src/OpenJPEGImage.cc")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/src/OpenJPEGImage.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -376,11 +376,12 @@ RawTile OpenJPEGImage::getRegion( int ha, int va, unsigned int res, int layers, |
|  |  |  |
|  |  | RawTile rawtile( 0, res, ha, va, w, h, channels, obpc ); |
|  |  |  |
|  |  | if( obpc == 16 ) rawtile.data = new unsigned short[w \* h \* channels]; |
|  |  | else if( obpc == 8 ) rawtile.data = new unsigned char[w \* h \* channels]; |
|  |  | size\_t np = (size\_t) w \* (size\_t) h \* (size\_t) channels; |
|  |  | if( obpc == 16 ) rawtile.data = new unsigned short[np]; |
|  |  | else if( obpc == 8 ) rawtile.data = new unsigned char[np]; |
|  |  | else throw file\_error( "OpenJPEG :: Unsupported number of bits" ); |
|  |  |  |
|  |  | rawtile.dataLength = w\*h\*channels\*(obpc/8); |
|  |  | rawtile.dataLength = np\*(obpc/8); |
|  |  | rawtile.filename = getImagePath(); |
|  |  | rawtile.timestamp = timestamp; |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/RawTile.h](#diff-ea606448d6ea89600653805a87315fe08b9b777b3e567598e1a205f66cafbd6e "src/RawTile.h")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/src/RawTile.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -79,7 +79,7 @@ class RawTile{ |
|  |  | int memoryManaged; |
|  |  |  |
|  |  | /// The size of the data pointed to by data |
|  |  | unsigned int dataLength; |
|  |  | size\_t dataLength; |
|  |  |  |
|  |  | /// The width in pixels of this tile |
|  |  | unsigned int width; |
| Expand Down | |  |

23 changes: 15 additions & 8 deletions

23
[src/TileManager.cc](#diff-8c97506cc7efe6f8108cb728a47ea22d0342bb3eec9cab6a617722ef6a86c109 "src/TileManager.cc")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/src/TileManager.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  |  |
|  |  | /\* IIP Server: Tile Cache Handler |
|  |  |  |
|  |  | Copyright (C) 2005-2021 Ruven Pillay. |
|  |  | Copyright (C) 2005-2022 Ruven Pillay. |
|  |  |  |
|  |  | This program is free software; you can redistribute it and/or modify |
|  |  | it under the terms of the GNU General Public License as published by |
| Expand Down  Expand Up | | @@ -130,8 +130,14 @@ void TileManager::crop( RawTile \*ttt ){ |
|  |  |  |
|  |  | // Create a new buffer, fill it with the old data, then copy |
|  |  | // back the cropped part into the RawTile buffer |
|  |  | int len = tw \* th \* ttt->channels \* (ttt->bpc/8); |
|  |  | unsigned int len = tw \* th \* ttt->channels \* (ttt->bpc/8); |
|  |  | unsigned char\* buffer = (unsigned char\*) malloc( len ); |
|  |  |  |
|  |  | // Check whether we have successfully allocated memory via malloc |
|  |  | if( buffer == NULL ){ |
|  |  | std::bad\_alloc e; |
|  |  | throw e; |
|  |  | } |
|  |  | unsigned char\* src\_ptr = (unsigned char\*) memcpy( buffer, ttt->data, len ); |
|  |  | unsigned char\* dst\_ptr = (unsigned char\*) ttt->data; |
|  |  |  |
| Expand Down  Expand Up | | @@ -365,21 +371,22 @@ RawTile TileManager::getRegion( unsigned int res, int seq, int ang, int layers, |
|  |  |  |
|  |  | // Create an empty tile with the correct dimensions |
|  |  | RawTile region( 0, res, seq, ang, width, height, channels, bpc ); |
|  |  | region.dataLength = width \* height \* channels \* (bpc/8); |
|  |  | size\_t np = (size\_t) width \* (size\_t) height \* (size\_t) channels; |
|  |  | region.dataLength = np \* (bpc/8); |
|  |  | region.sampleType = sampleType; |
|  |  |  |
|  |  | // Allocate memory for the region |
|  |  | if( bpc == 8 ) region.data = new unsigned char[width\*height\*channels]; |
|  |  | else if( bpc == 16 ) region.data = new unsigned short[width\*height\*channels]; |
|  |  | else if( bpc == 32 && sampleType == FIXEDPOINT ) region.data = new int[width\*height\*channels]; |
|  |  | else if( bpc == 32 && sampleType == FLOATINGPOINT ) region.data = new float[width\*height\*channels]; |
|  |  | if( bpc == 8 ) region.data = new unsigned char[np]; |
|  |  | else if( bpc == 16 ) region.data = new unsigned short[np]; |
|  |  | else if( bpc == 32 && sampleType == FIXEDPOINT ) region.data = new int[np]; |
|  |  | else if( bpc == 32 && sampleType == FLOATINGPOINT ) region.data = new float[np]; |
|  |  |  |
|  |  | unsigned int current\_height = 0; |
|  |  |  |
|  |  | // Decode the image strip by strip |
|  |  | for( unsigned int i=starty; i<endy; i++ ){ |
|  |  |  |
|  |  | unsigned int buffer\_index = 0; |
|  |  | unsigned long buffer\_index = 0; |
|  |  |  |
|  |  | // Keep track of the current pixel boundary horizontally. ie. only up |
|  |  | // to the beginning of the current tile boundary. |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/Transforms.cc](#diff-de72e619c42ca3adec2def643d30fb05617a02d047cb95d9637b8b521628c732 "src/Transforms.cc")

Show comments

[View file](/ruven/iipsrv/blob/882925b295a80ec992063deffc2a3b0d803c3195/src/Transforms.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -532,7 +532,7 @@ void Transform::interpolate\_nearestneighbour( RawTile& in, unsigned int resample |
|  |  | // Correctly set our Rawtile info |
|  |  | in.width = resampled\_width; |
|  |  | in.height = resampled\_height; |
|  |  | in.dataLength = resampled\_width \* resampled\_height \* channels \* (in.bpc/8); |
|  |  | in.dataLength = (size\_t)resampled\_width \* (size\_t)resampled\_height \* (size\_t)channels \* (size\_t)(in.bpc/8); |
|  |  | in.data = output; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -618,7 +618,7 @@ void Transform::interpolate\_bilinear( RawTile& in, unsigned int resampled\_width, |
|  |  | // Correctly set our Rawtile info |
|  |  | in.width = resampled\_width; |
|  |  | in.height = resampled\_height; |
|  |  | in.dataLength = resampled\_width \* resampled\_height \* channels \* (in.bpc/8); |
|  |  | in.dataLength = (size\_t)resampled\_width \* (size\_t)resampled\_height \* (size\_t)channels \* (size\_t)(in.bpc/8); |
|  |  | in.data = output; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `882925b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F882925b295a80ec992063deffc2a3b0d803c3195) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_87846604_20250114_223943.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ruven%2Fiipsrv)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ruven](/ruven)
/
**[iipsrv](/ruven/iipsrv)**
Public

* [Notifications](/login?return_to=%2Fruven%2Fiipsrv) You must be signed in to change notification settings
* [Fork
  115](/login?return_to=%2Fruven%2Fiipsrv)
* [Star
   297](/login?return_to=%2Fruven%2Fiipsrv)

* [Code](/ruven/iipsrv)
* [Issues
  51](/ruven/iipsrv/issues)
* [Pull requests
  1](/ruven/iipsrv/pulls)
* [Actions](/ruven/iipsrv/actions)
* [Projects
  0](/ruven/iipsrv/projects)
* [Security](/ruven/iipsrv/security)
* [Insights](/ruven/iipsrv/pulse)

Additional navigation options

* [Code](/ruven/iipsrv)
* [Issues](/ruven/iipsrv/issues)
* [Pull requests](/ruven/iipsrv/pulls)
* [Actions](/ruven/iipsrv/actions)
* [Projects](/ruven/iipsrv/projects)
* [Security](/ruven/iipsrv/security)
* [Insights](/ruven/iipsrv/pulse)

## Commit

[Permalink](/ruven/iipsrv/commit/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Added verification that image has been set in SPECTRA.cc and check on…

[Browse files](/ruven/iipsrv/tree/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9)
Browse the repository at this point in the history

```
… the validity of the requested tile resolution in JTL.cc. Fixes a couple of the crash conditions reported in [#223](https://github.com/ruven/iipsrv/issues/223)
```

* Loading branch information

[![@ruven](https://avatars.githubusercontent.com/u/776628?s=40&v=4)](/ruven)

[ruven](/ruven/iipsrv/commits?author=ruven "View all commits by ruven")
committed
Jan 14, 2022

1 parent
[4db9fff](/ruven/iipsrv/commit/4db9fff42dc2c07d871bca508b2f33a4cf376185)

commit 4ed5926

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**32 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ChangeLog
  [ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb)
* src

  + src/JTL.cc
    [JTL.cc](#diff-223e6d0762c9d6be6d2618c387cf80fde6c1419fc35cbc359e00090420bb3e97)
  + src/SPECTRA.cc
    [SPECTRA.cc](#diff-0068c48b538b6e70d724bba9870b070f9adb6fac235a7a5f5bd6495580dd5302)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb "ChangeLog")

Show comments

[View file](/ruven/iipsrv/blob/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9/ChangeLog)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,8 @@ |
|  |  | 15/01/2022: |
|  |  | - Added verification that image has been set in SPECTRA.cc and check on the validity of the requested tile |
|  |  | resolution in JTL.cc. Fixes a couple of the crash conditions reported in https://github.com/ruven/iipsrv/issues/223 |
|  |  |  |
|  |  |  |
|  |  | 14/01/2022: |
|  |  | - Detection of HTJ2K also added for KakaduImage.cc for logging purposes (DEBUG needs to be enabled at compile time) |
|  |  |  |
| Expand Down | |  |

31 changes: 18 additions & 13 deletions

31
[src/JTL.cc](#diff-223e6d0762c9d6be6d2618c387cf80fde6c1419fc35cbc359e00090420bb3e97 "src/JTL.cc")

Show comments

[View file](/ruven/iipsrv/blob/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9/src/JTL.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,7 @@ |
|  |  | /\* |
|  |  | IIP JTL Command Handler Class Member Function: Export a single tile |
|  |  |  |
|  |  | Copyright (C) 2006-2021 Ruven Pillay. |
|  |  | Copyright (C) 2006-2022 Ruven Pillay. |
|  |  |  |
|  |  | This program is free software; you can redistribute it and/or modify |
|  |  | it under the terms of the GNU General Public License as published by |
| Expand Down  Expand Up | | @@ -43,6 +43,10 @@ void JTL::send( Session\* session, int resolution, int tile ){ |
|  |  | if( session->loglevel >= 2 ) command\_timer.start(); |
|  |  |  |
|  |  |  |
|  |  | // Need to know the number of resolutions |
|  |  | int num\_res = (\*session->image)->getNumResolutions(); |
|  |  |  |
|  |  |  |
|  |  | // If we have requested a rotation, remap the tile index to rotated coordinates |
|  |  | if( (int)((session->view)->getRotation()) % 360 == 90 ){ |
|  |  |  |
| Expand All | | @@ -51,7 +55,6 @@ void JTL::send( Session\* session, int resolution, int tile ){ |
|  |  |  |
|  |  | } |
|  |  | else if( (int)((session->view)->getRotation()) % 360 == 180 ){ |
|  |  | int num\_res = (\*session->image)->getNumResolutions(); |
|  |  | unsigned int im\_width = (\*session->image)->image\_widths[num\_res-resolution-1]; |
|  |  | unsigned int im\_height = (\*session->image)->image\_heights[num\_res-resolution-1]; |
|  |  | unsigned int tw = (\*session->image)->getTileWidth(); |
| Expand All | | @@ -62,7 +65,7 @@ void JTL::send( Session\* session, int resolution, int tile ){ |
|  |  |  |
|  |  |  |
|  |  | // Sanity check |
|  |  | if( (resolution<0) || (tile<0) ){ |
|  |  | if( (resolution<0) || (tile<0) || (resolution>=num\_res) ){ |
|  |  | ostringstream error; |
|  |  | error << "JTL :: Invalid resolution/tile number: " << resolution << "," << tile; |
|  |  | throw error.str(); |
| Expand Down  Expand Up | | @@ -120,18 +123,20 @@ void JTL::send( Session\* session, int resolution, int tile ){ |
|  |  |  |
|  |  |  |
|  |  | // Set the physical output resolution for this particular view and zoom level |
|  |  | int num\_res = (\*session->image)->getNumResolutions(); |
|  |  | unsigned int im\_width = (\*session->image)->image\_widths[num\_res-resolution-1]; |
|  |  | unsigned int im\_height = (\*session->image)->image\_heights[num\_res-resolution-1]; |
|  |  | float dpi\_x = (\*session->image)->dpi\_x \* (float) im\_width / (float) (\*session->image)->getImageWidth(); |
|  |  | float dpi\_y = (\*session->image)->dpi\_y \* (float) im\_height / (float) (\*session->image)->getImageHeight(); |
|  |  | compressor->setResolution( dpi\_x, dpi\_y, (\*session->image)->dpi\_units ); |
|  |  |  |
|  |  | if( session->loglevel >= 5 ){ |
|  |  | \*(session->logfile) << "JTL :: Setting physical resolution of tile to " << dpi\_x << " x " << dpi\_y |
|  |  | << ( ((\*session->image)->dpi\_units==1) ? " pixels/inch" : " pixels/cm" ) << endl; |
|  |  | if( (\*session->image)->dpi\_x > 0 && (\*session->image)->dpi\_y > 0 ){ |
|  |  | unsigned int im\_width = (\*session->image)->image\_widths[num\_res-resolution-1]; |
|  |  | unsigned int im\_height = (\*session->image)->image\_heights[num\_res-resolution-1]; |
|  |  | float dpi\_x = (\*session->image)->dpi\_x \* ( (float)im\_width / (float)(\*session->image)->getImageWidth() ); |
|  |  | float dpi\_y = (\*session->image)->dpi\_y \* ( (float)im\_height / (float)(\*session->image)->getImageHeight() ); |
|  |  | compressor->setResolution( dpi\_x, dpi\_y, (\*session->image)->dpi\_units ); |
|  |  |  |
|  |  | if( session->loglevel >= 5 ){ |
|  |  | \*(session->logfile) << "JTL :: Setting physical resolution of tile to " << dpi\_x << " x " << dpi\_y |
|  |  | << ( ((\*session->image)->dpi\_units==1) ? " pixels/inch" : " pixels/cm" ) << endl; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | // Embed ICC profile |
|  |  | if( session->view->embedICC() && ((\*session->image)->getMetadata("icc").size()>0) ){ |
|  |  | if( session->loglevel >= 3 ){ |
| Expand Down | |  |

15 changes: 9 additions & 6 deletions

15
[src/SPECTRA.cc](#diff-0068c48b538b6e70d724bba9870b070f9adb6fac235a7a5f5bd6495580dd5302 "src/SPECTRA.cc")

Show comments

[View file](/ruven/iipsrv/blob/4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9/src/SPECTRA.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,7 @@ |
|  |  | /\* |
|  |  | IIP SPECTRA Command Handler Class Member Function |
|  |  |  |
|  |  | Copyright (C) 2009-2021 Ruven Pillay. |
|  |  | Copyright (C) 2009-2022 Ruven Pillay. |
|  |  |  |
|  |  | This program is free software; you can redistribute it and/or modify |
|  |  | it under the terms of the GNU General Public License as published by |
| Expand Down  Expand Up | | @@ -36,7 +36,10 @@ void SPECTRA::run( Session\* session, const std::string& argument ){ |
|  |  |  |
|  |  | if( session->loglevel >= 3 ) (\*session->logfile) << "SPECTRA handler reached" << endl; |
|  |  |  |
|  |  | int resolution, tile, x, y; |
|  |  |  |
|  |  | // Make sure we have set our image |
|  |  | this->session = session; |
|  |  | checkImage(); |
|  |  |  |
|  |  |  |
|  |  | // Time this command |
| Expand All | | @@ -46,19 +49,19 @@ void SPECTRA::run( Session\* session, const std::string& argument ){ |
|  |  | // Parse the argument list |
|  |  | string arg = argument; |
|  |  | int delimitter = arg.find( "," ); |
|  |  | resolution = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  | int resolution = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  |  |
|  |  | arg = arg.substr( delimitter + 1, arg.length() ); |
|  |  | delimitter = arg.find( "," ); |
|  |  | tile = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  | int tile = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  |  |
|  |  | arg = arg.substr( delimitter + 1, arg.length() ); |
|  |  | delimitter = arg.find( "," ); |
|  |  | x = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  | int x = atoi( arg.substr(0,delimitter).c\_str() ); |
|  |  |  |
|  |  | arg = arg.substr( delimitter + 1, arg.length() ); |
|  |  | delimitter = arg.find( "," ); |
|  |  | y = atoi( arg.substr(0,arg.length()).c\_str() ); |
|  |  | int y = atoi( arg.substr(0,arg.length()).c\_str() ); |
|  |  |  |
|  |  | if( session->loglevel >= 5 ){ |
|  |  | (\*session->logfile) << "SPECTRA :: resolution: " << resolution |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4ed5926`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fruven%2Fiipsrv%2Fcommit%2F4ed59265fbbd636dc2fbbf325f8ea37ed300a6d9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


