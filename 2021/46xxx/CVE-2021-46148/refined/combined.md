=== Content from phabricator.wikimedia.org_d7158e66_20250114_221922.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT290856)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T290856
# SecurePoll's management groups were removed from testwiki [public]Closed, Resolved[Public](/policy/explain/PHID-TASK-a56l2cemyq4iov35c2ls/view/)Actions

* [Edit Task](/maniphest/task/edit/290856/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/290856/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-a56l2cemyq4iov35c2ls/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-a56l2cemyq4iov35c2ls/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Protect as security issue](/wmf/escalate-task/290856/)
* [Award Token](/token/give/PHID-TASK-a56l2cemyq4iov35c2ls/)
* [Flag For Later](/flag/edit/PHID-TASK-a56l2cemyq4iov35c2ls/)

Assigned To

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |

Authored By

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |
| Sep 13 2021, 11:00 AM2021-09-13 11:00:56 (UTC+0) |

Tags

* [Wikimedia-Site-requests](/tag/wikimedia-site-requests/) [(Backlog)](/project/board/178/)
* [Security](/tag/security/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [MediaWiki-extensions-SecurePoll](/tag/mediawiki-extensions-securepoll/) [(Backlog)](/project/board/238/)
* [User-Urbanecm](/tag/user-urbanecm/) [(Backlog)](/project/board/2098/)
Referenced FilesNoneSubscribers

|  | [• 4nn1l2](/p/4nn1l2/) |
| --- | --- |

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Huji](/p/Huji/) |
| --- | --- |

|  | [JJMC89](/p/JJMC89/) |
| --- | --- |

|  | [jrbs](/p/jrbs/) |
| --- | --- |

|  | [Peachey88](/p/Peachey88/) |
| --- | --- |

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |

[View All 9 Subscribers](/subscriptions/list/PHID-TASK-a56l2cemyq4iov35c2ls/)
# Description

This is a public counterpart to [T290808](/T290808).

SecurePoll's management groups (electionadmin and related) were removed from testwiki due to an incident.

# Related Objects

* Mentions

Mentioned In [T295214: Ruwiki users needs to test secret ballot through SecurePoll](/T295214)
[T277353: electionadmin group needs to be added to testwiki to restore securepolls testing functionality](/T277353)
[T290808: Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148)](/T290808) Mentioned Here [T290808: Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148)](/T290808)
### Event Timeline

[Urbanecm](/p/Urbanecm/) created this task.[Sep 13 2021, 11:00 AM2021-09-13 11:00:56 (UTC+0)](#7347853)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/4417093/)[Sep 13 2021, 11:00 AM2021-09-13 11:00:57 (UTC+0)](#7347863)[Urbanecm](/p/Urbanecm/) mentioned this in [T290808: Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148)](/T290808).[Sep 13 2021, 11:03 AM2021-09-13 11:03:28 (UTC+0)](#7347868)[Urbanecm](/p/Urbanecm/) mentioned this in [T277353: electionadmin group needs to be added to testwiki to restore securepolls testing functionality](/T277353).[Sep 13 2021, 11:06 AM2021-09-13 11:06:05 (UTC+0)](#7347882)[Urbanecm](/p/Urbanecm/) added projects: [Wikimedia-Site-requests](/tag/wikimedia-site-requests/), [Security](/tag/security/), [Anti-Harassment](/tag/anti-harassment/).[Sep 13 2021, 11:08 AM2021-09-13 11:08:07 (UTC+0)](#7347889)[Urbanecm](/p/Urbanecm/) added a project: [Security-Team](/tag/security-team/).[Peachey88](/p/Peachey88/) subscribed.[Sep 13 2021, 11:36 AM2021-09-13 11:36:27 (UTC+0)](#7347961)[Zabe](/p/Zabe/) subscribed.[Sep 13 2021, 1:06 PM2021-09-13 13:06:15 (UTC+0)](#7348242)[JJMC89](/p/JJMC89/) subscribed.[Sep 13 2021, 3:27 PM2021-09-13 15:27:50 (UTC+0)](#7348704)[Reedy](/p/Reedy/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Sep 13 2021, 3:44 PM2021-09-13 15:44:35 (UTC+0)](#7348816)[Xaosflux](/p/Xaosflux/) subscribed.[Sep 13 2021, 4:19 PM2021-09-13 16:19:42 (UTC+0)](#7349043)[Niharika](/p/Niharika/) added a project: [MediaWiki-extensions-SecurePoll](/tag/mediawiki-extensions-securepoll/).[Sep 21 2021, 8:43 PM2021-09-21 20:43:44 (UTC+0)](#7370432)[Niharika](/p/Niharika/) removed a project: [Anti-Harassment](/tag/anti-harassment/).[• 4nn1l2](/p/4nn1l2/) subscribed.[Oct 26 2021, 4:18 PM2021-10-26 16:18:24 (UTC+0)](#7458971)[Zabe](/p/Zabe/) mentioned this in [T295214: Ruwiki users needs to test secret ballot through SecurePoll](/T295214).[Nov 6 2021, 7:20 AM2021-11-06 07:20:32 (UTC+0)](#7487156)[Huji](/p/Huji/) subscribed.[Nov 6 2021, 1:02 PM2021-11-06 13:02:57 (UTC+0)](#7487294)Comment Actions

Not sure what the incident was and have not seen the private task, but I wonder: should we separate "electionadmin" right form a (yet to be created) "scrutineer" right, such that election admin only has access to the ballot create/edit pages and the tally page, and scrutineer has access to individual vote data? Of course some may have both roles assigned to them.

[Urbanecm](/p/Urbanecm/) added a comment.[Nov 7 2021, 8:08 PM2021-11-07 20:08:02 (UTC+0)](#7488105)Comment Actions
> In [T290856#7487294](/T290856#7487294), [@Huji](/p/Huji/) wrote:
>
> Not sure what the incident was and have not seen the private task, but I wonder: should we separate "electionadmin" right form a (yet to be created) "scrutineer" right, such that election admin only has access to the ballot create/edit pages and the tally page, and scrutineer has access to individual vote data? Of course some may have both roles assigned to them.

The incident is almost resolved now: a patch fixing the underlying issue was deployed. I asked in the private task if it can be made public now. There's some followup, but that followup doesn't have security impact.

[jrbs](/p/jrbs/) subscribed.[Dec 6 2021, 12:41 PM2021-12-06 12:41:44 (UTC+0)](#7549428)Comment Actions

Now that [T290808](/T290808) is public I guess this counterpart task can be closed?

[• 4nn1l2](/p/4nn1l2/) closed this task as Resolved.[Feb 3 2022, 5:19 PM2022-02-03 17:19:59 (UTC+0)](#7675983)[• 4nn1l2](/p/4nn1l2/) assigned this task to [Urbanecm](/p/Urbanecm/).Comment Actions

I'm going to boldly close this ticket. If it needs to be re-opened, just open it again. Thanks.

Restricted Application added a project: [User-Urbanecm](/tag/user-urbanecm/).  · [View Herald Transcript](/herald/transcript/4615285/)[Feb 3 2022, 5:19 PM2022-02-03 17:19:59 (UTC+0)](#7675986)[Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from phabricator.wikimedia.org_9d02f0f3_20250114_221921.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT290808)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T290808
# Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148)Closed, Resolved[Public](/policy/explain/PHID-TASK-fvkrqy5h5tbfxbaizuc7/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/290808/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/290808/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Protect as security issue](/wmf/escalate-task/290808/)
* [Award Token](/token/give/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
* [Flag For Later](/flag/edit/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)

Assigned To

|  | [phuedx](/p/phuedx/) |
| --- | --- |

Authored By

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |
| Sep 11 2021, 6:18 PM2021-09-11 18:18:29 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security](/tag/security/)
* [Anti-Harassment](/tag/anti-harassment/) [(Tracking work by others)](/project/board/2660/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [MediaWiki-extensions-SecurePoll](/tag/mediawiki-extensions-securepoll/) [(Backlog)](/project/board/238/)
* [Patch-For-Review](/tag/patch-for-review/)
* [MW-1.38-notes (1.38.0-wmf.13; 2021-12-13)](/project/view/5647/)
Referenced Files

|  | [F34648603: T290808.patch](/F34648603) |
| --- | --- |
| Sep 20 2021, 12:52 PM2021-09-20 12:52:45 (UTC+0) |

Subscribers

|  | [• 4nn1l2](/p/4nn1l2/) |
| --- | --- |

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [akosiaris](/p/akosiaris/) |
| --- | --- |

|  | [ARamirez\_WMF](/p/ARamirez_WMF/) |
| --- | --- |

|  | [• Dsharpe](/p/Dsharpe/) |
| --- | --- |

|  | [Huji](/p/Huji/) |
| --- | --- |

|  | [Johannnes89](/p/Johannnes89/) |
| --- | --- |

[View All 22 Subscribers](/subscriptions/list/PHID-TASK-fvkrqy5h5tbfxbaizuc7/)
# Description

NOTE: Public tracking task for this incident exists as [T290856](/T290856).

I just realized that with introducing securepoll-related user groups to testwiki \_and\_ allowing bureaucrats to grant them, we effectively allowed testwiki's bureaucrats to grant users access to confidential information. That's because SecurePoll election admins can see IP addresses and user agents of voters in "their" elections".

SecurePoll requires admins to be *both* in electionadmin group as well as be added as an admin to the particular election in order to be able to view private details. So this doesn't mean that bureaucrats can arbitrarily view PII of voters in *all* elections. [PII is also hidden from all users 60 days after the election has ended on all wikis](https://gerrit.wikimedia.org/g/operations/mediawiki-config/%2B/02aab8ec135e2594963ad2772deba5037d4d5cc4/wmf-config/CommonSettings.php#1408).

# Details

Risk Rating Low Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [listPager: Restore original field order](https://gerrit.wikimedia.org/r/c/747513) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/master) | +24 -19 |
|  | [Fully add new securepoll-view-voter-pii right](https://gerrit.wikimedia.org/r/c/750806) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_35) | +6 -1 |
|  | [Fully add new securepoll-view-voter-pii right](https://gerrit.wikimedia.org/r/c/749885) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_36) | +6 -1 |
|  | [Fully add new securepoll-view-voter-pii right](https://gerrit.wikimedia.org/r/c/747076) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_37) | +6 -1 |
|  | [SECURITY: Require securepoll-view-voter-pii right to view voter's PII](https://gerrit.wikimedia.org/r/c/749229) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_36) | +30 -6 |
|  | [SECURITY: Require securepoll-view-voter-pii right to view voter's PII](https://gerrit.wikimedia.org/r/c/749228) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_35) | +30 -6 |
|  | [SECURITY: Require securepoll-view-voter-pii right to view voter's PII](https://gerrit.wikimedia.org/r/c/743940) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/REL1_37) | +30 -6 |
|  | [Fully add new securepoll-view-voter-pii right](https://gerrit.wikimedia.org/r/c/744761) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/master) | +6 -1 |
|  | [SECURITY: Require securepoll-view-voter-pii right to view voter's PII](https://gerrit.wikimedia.org/r/c/744669) | [mediawiki/extensions/SecurePoll](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/master) | +30 -6 |
|  | [votewiki: Grant election admins securepoll-view-voter-pii](https://gerrit.wikimedia.org/r/c/736067) | [operations/mediawiki-config](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config/%2B/master) | +4 -1 |
|  | [testwiki: Fully remove securepoll-related groups](https://gerrit.wikimedia.org/r/c/720454) | [operations/mediawiki-config](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config/%2B/master) | +2 -4 |
|  | [Revert "test: Add electcomm and electionadmin groups"](https://gerrit.wikimedia.org/r/c/720265) | [operations/mediawiki-config](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/mediawiki-config/%2B/master) | +0 -5 |

Show related patches [Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T290808)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T292226 [Release MediaWiki 1.35.5/1.36.3/1.37.1](/T292226) |
|  |  | Resolved |  | [Mstyles](/p/Mstyles/) | T292236 [Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236) |
|  |  | Resolved | Security | [phuedx](/p/phuedx/) | T290808 [Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148)](/T290808) |

Mentioned In [T335201: Investigation: What needs to change to allow local wikis to run their own elections?](/T335201)
[T152972: Accessing private information through SecurePoll should be logged](/T152972)
[T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236)
[T290856: SecurePoll's management groups were removed from testwiki [public]](/T290856)
[T277353: electionadmin group needs to be added to testwiki to restore securepolls testing functionality](/T277353) Mentioned Here [T152972: Accessing private information through SecurePoll should be logged](/T152972)
[T288185: Rank "eliminated/not elected" candidates too in Single Transferable Vote](/T288185)
[T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236)
[T290856: SecurePoll's management groups were removed from testwiki [public]](/T290856)
[T277353: electionadmin group needs to be added to testwiki to restore securepolls testing functionality](/T277353)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-fvkrqy5h5tbfxbaizuc7/?after=7346537&quoteTargetID=UQ0_5&quoteRef=T290808)

[Urbanecm](/p/Urbanecm/) added a subscriber: [taavi](/p/taavi/).[Sep 11 2021, 6:59 PM2021-09-11 18:59:54 (UTC+0)](#7346537)Comment Actions

Adding @majavah, who correctly described the cause for removing in a private message.

[Urbanecm](/p/Urbanecm/) added a comment.[Sep 11 2021, 7:02 PM2021-09-11 19:02:37 (UTC+0)](#7346540)Comment Actions
```
21:02 <+logmsgbot> !log urbanecm@deploy1002 Synchronized wmf-config/InitialiseSettings.php: 27814b8eaacb5ba2fee1b6167a36ea14356a1ecf: testwiki: Fully remove securepoll-related groups (T290808) (duration: 00m 57s)
21:02 <+stashbot> Logged the message at https://wikitech.wikimedia.org/wiki/Server_Admin_Log
```

Fixed the removal of the groups.

[Ladsgroup](/p/Ladsgroup/) added a comment.[Sep 11 2021, 7:12 PM2021-09-11 19:12:49 (UTC+0)](#7346542)Comment Actions

It might be going on way before the main ticket.

E.g. the non-NDA'ed user has created an election before [T277353#7223260](/T277353#7223260) (with id of 701, it doesn't have a vote in it). I think this needs to be looked at in more depth with someone more knowledgeable about SecurePoll.

[Urbanecm](/p/Urbanecm/) added a project: [Anti-Harassment](/tag/anti-harassment/).[Sep 11 2021, 7:19 PM2021-09-11 19:19:11 (UTC+0)](#7346545)Comment Actions

Tagging AHT as the maintainers of the extension.

[Ladsgroup](/p/Ladsgroup/) added a comment.[Sep 11 2021, 7:23 PM2021-09-11 19:23:15 (UTC+0)](#7346549)Comment Actions

Sorry I keep coming up with notes. One thing is that signing an NDA doesn't mean the user can be trusted with private data. For example we have had [a user who signed an NDA but globally locked](https://meta.wikimedia.org/w/index.php?title=Access_to_nonpublic_personal_data_policy/Noticeboard&diff=21536164&oldid=21528012). Handing out this right should have been done way more carefully.

[Urbanecm](/p/Urbanecm/) added a comment.[Sep 11 2021, 7:31 PM2021-09-11 19:31:03 (UTC+0)](#7346550)Comment Actions
> In [T290808#7346549](/T290808#7346549), [@Ladsgroup](/p/Ladsgroup/) wrote:
>
> Sorry I keep coming up with notes. One thing is that signing an NDA doesn't mean the user can be trusted with private data. For example we have had [a user who signed an NDA but globally locked](https://meta.wikimedia.org/w/index.php?title=Access_to_nonpublic_personal_data_policy/Noticeboard&diff=21536164&oldid=21528012). Handing out this right should have been done way more carefully.

I strongly agree with this. Usually, rights that require NDA-level access are handed out by the stewards or T&S, and I think this would be an appropriate setup in testwiki's case as well. We'd need to figure out some criteria to be eligible for access (as voting makes no sense for testwiki).

[RLazarus](/p/RLazarus/) subscribed.[Sep 11 2021, 7:56 PM2021-09-11 19:56:54 (UTC+0)](#7346571)[Urbanecm](/p/Urbanecm/) mentioned this in [T290856: SecurePoll's management groups were removed from testwiki [public]](/T290856).[Sep 13 2021, 11:00 AM2021-09-13 11:00:56 (UTC+0)](#7347862)[Urbanecm](/p/Urbanecm/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-d2vh4xfqzdtqxda/)[Sep 13 2021, 11:03 AM2021-09-13 11:03:28 (UTC+0)](#7347866)[phuedx](/p/phuedx/) added a comment.Edited · [Sep 13 2021, 11:57 AM2021-09-13 11:57:34 (UTC+0)](#7348029)Comment Actions
> In [T290808#7346549](/T290808#7346549), [@Ladsgroup](/p/Ladsgroup/) wrote:
>
> Handing out this right should have been done way more carefully.

Yes.

> In [T290808#7346535](/T290808#7346535), [@Ladsgroup](/p/Ladsgroup/) wrote:
>
> So assuming securepoll logging is correct. The non-NDA'ed user has created one election (with id of 805) and accessed its logs four times. I can only see one vote in that particular election which is the user himself
>
> ```
> select vote_voter_name from securepoll_votes where vote_election = 805;
> +-----------------+
> | vote_voter_name |
> +-----------------+
> | 4nn1l2          |
> +-----------------+
> 1 row in set (0.00 sec)
> ```
>
> so it means there is no leaked data unless:
>
> * An election admin can look at other elections or

You are considered an admin of a particular election if you are a member of the electionadmin group and in the list of admins for that particular election (see [https://gerrit.wikimedia.org/g/mediawiki/extensions/SecurePoll/+/5b31db7e97d399b00370620e0fe296f43cf94501/includes/Entities/Election.php#357](https://gerrit.wikimedia.org/g/mediawiki/extensions/SecurePoll/%2B/5b31db7e97d399b00370620e0fe296f43cf94501/includes/Entities/Election.php#357)).

You may only list the confidential information of voters in an election if you are an admin of that particular election (see [https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/+/refs/heads/master/includes/Pages/ListPager.php#48](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SecurePoll/%2B/refs/heads/master/includes/Pages/ListPager.php#48)).

That user is only an admin for two elections, the IDs of which you've already noted:

```
select el_entity from securepoll_elections join securepoll_properties on el_entity = pr_entity where pr_key = 'admins' and pr_value like '%4nn1l2%';
+-----------+
| el_entity |
+-----------+
|       805 |
|       701 |
+-----------+
2 rows in set (0.00 sec)
```

**<edit>**

and only 1 vote was cast across both of those elections:

```
select count(*) from securepoll_votes where vote_election in (805, 701);
+----------+
| count(*) |
+----------+
|        1 |
+----------+
1 row in set (0.001 sec)
```

**</edit>**

> * Some votes have been removed this election or

[AFAICT](https://codesearch.wmcloud.org/search/?q=securepoll_votes) only the cli/generateTestElection.php maintenance script deletes rows from the securepoll\_votes table (i.e. votes that are struck remain in the table).

> * There are more than one user without NDA in that list

[phuedx](/p/phuedx/) added a comment.Edited · [Sep 13 2021, 11:59 AM2021-09-13 11:59:25 (UTC+0)](#7348051)Comment Actions

I should also say thank you, [@Ladsgroup](/p/Ladsgroup/), [@Urbanecm](/p/Urbanecm/), and @Majavah, for catching this and acting on a Saturday.

[akosiaris](/p/akosiaris/) subscribed.[Sep 13 2021, 1:35 PM2021-09-13 13:35:03 (UTC+0)](#7348336)[sbassett](/p/sbassett/) triaged this task as Low priority.[Sep 13 2021, 3:43 PM2021-09-13 15:43:52 (UTC+0)](#7348812)[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[sbassett](/p/sbassett/) subscribed.Comment Actions
> In [T290808#7348051](/T290808#7348051), [@phuedx](/p/phuedx/) wrote:
>
> I should also say thank you, [@Ladsgroup](/p/Ladsgroup/), [@Urbanecm](/p/Urbanecm/), and @Majavah, for catching this and acting on a Saturday.

Yes, thanks for the quick response and revert/deploy of the config patch. It seems like there do not appear to be any concerns over user 4nn1l2's limited (and now removed) access at this time. The [Security-Team](/tag/security-team/) will throw this into our watching column for now, but I don't see any immediately actionable items on this task for us, unless anyone would like to consult about potential options going forward, though [Anti-Harassment](/tag/anti-harassment/) likely have far more SecurePoll domain knowledge at this point.

[sbassett](/p/sbassett/) added a project: [SecTeam-Processed](/tag/secteam-processed/).[Sep 13 2021, 3:45 PM2021-09-13 15:45:31 (UTC+0)](#7348825)

[Ladsgroup](/p/Ladsgroup/) added a comment.[Sep 13 2021, 6:16 PM2021-09-13 18:16:02 (UTC+0)](#7349406)Comment Actions

I understand this didn't have a breach of private information but it was pretty close to it. It would be great to have several layers of checks to make sure such close calls won't happen again. Our luck will run out one day.

[Urbanecm](/p/Urbanecm/) added a subscriber: [Niharika](/p/Niharika/).[Sep 13 2021, 6:50 PM2021-09-13 18:50:18 (UTC+0)](#7349572)Comment Actions

[@sbassett](/p/sbassett/) I think "someone" should help with those things:

* Do we need someone to formally declare "no infoleak happened" (if Ladsgroup's understanding is correct)?
* Draft next steps for re-enabling the group at testwiki
  + This should probably include a substep "Create process for becoming an electionadmin at testwiki"
* Make it more obvious that securepoll's electionadmin group grants access to PII (maybe create a proper right, like securepoll-view-votes and securepoll-view-ip-for-votes, to make it more obvious in the patch that PII is involved?) I think [Anti-Harassment](/tag/anti-harassment/) can help with this part (CC [@Niharika](/p/Niharika/))
* Figure out what to do to notice similar issues sooner. Maybe we should have a list of PII-enabled groups and alerting if someone without a NDA is added?

I'm not sure if [Security-Team](/tag/security-team/) would be the right team to help with those items, or some other team at the WMF.

[phuedx](/p/phuedx/) added a comment.[Sep 14 2021, 12:14 PM2021-09-14 12:14:17 (UTC+0)](#7351689)Comment Actions
> In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
>
> * Draft next steps for re-enabling the group at testwiki
>   + This should probably include a substep "Create process for becoming an electionadmin at testwiki"

An alternative to testing SecurePoll on testwiki might be to create and maintain an installation using Cloud VPS. This would short-circuit that particular conversation at the cost of increased maintenance burden.

> * Make it more obvious that securepoll's electionadmin group grants access to PII (maybe create a proper right, like securepoll-view-votes and securepoll-view-ip-for-votes, to make it more obvious in the patch that PII is involved?) I think [Anti-Harassment](/tag/anti-harassment/) can help with this part (CC [@Niharika](/p/Niharika/))

This is a great suggestion. securepoll-view-ip-for-votes or securepoll-view-voter-ips would be preferable here as they are clearer about the nature of the information that the right gives the user access to. I can create a task to capture this once this task is made public.

Perhaps adding a note (or notes) to [https://test.wikipedia.org/wiki/Wikipedia:Requests](https://test.wikipedia.org/wiki/Wikipedia%3ARequests) might be worthwhile as well.

[phuedx](/p/phuedx/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-rcr2yg4zvy4xeka/)[Sep 14 2021, 12:27 PM2021-09-14 12:27:25 (UTC+0)](#7351717)[phuedx](/p/phuedx/) added a subscriber: [STran](/p/STran/).[Sep 14 2021, 6:07 PM2021-09-14 18:07:53 (UTC+0)](#7352790)

[Ladsgroup](/p/Ladsgroup/) added a comment.[Sep 14 2021, 7:06 PM2021-09-14 19:06:32 (UTC+0)](#7352961)Comment Actions
> In [T290808#7351689](/T290808#7351689), [@phuedx](/p/phuedx/) wrote:
> > In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
> >
> > * Draft next steps for re-enabling the group at testwiki
> >   + This should probably include a substep "Create process for becoming an electionadmin at testwiki"
>
> An alternative to testing SecurePoll on testwiki might be to create and maintain an installation using Cloud VPS. This would short-circuit that particular conversation at the cost of increased maintenance burden.

Beta cluster seems like a good candidate for it.

[sbassett](/p/sbassett/) added a subscriber: [• Dsharpe](/p/Dsharpe/).[Sep 15 2021, 8:12 PM2021-09-15 20:12:50 (UTC+0)](#7357037)Comment Actions
> In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
>
> * Do we need someone to formally declare "no infoleak happened" (if Ladsgroup's understanding is correct)?

IMO, we can likely safely say this is the case, per [@Ladsgroup](/p/Ladsgroup/)'s findings in [T290808#7346535](/T290808#7346535). I'm not sure there's much else the [Security-Team](/tag/security-team/) (or anyone else) could audit here? We don't really have secret security logs with more wide-ranging data for cases like this. Ping [@Dsharpe](/p/Dsharpe/) to confirm.

> * Draft next steps for re-enabling the group at testwiki
>   + This should probably include a substep "Create process for becoming an electionadmin at testwiki"
> * Make it more obvious that securepoll's electionadmin group grants access to PII (maybe create a proper right, like securepoll-view-votes and securepoll-view-ip-for-votes, to make it more obvious in the patch that PII is involved?) I think [Anti-Harassment](/tag/anti-harassment/) can help with this part (CC [@Niharika](/p/Niharika/))

These sound like good ideas that the SecurePoll maintainers should further discuss and implement.

> * Figure out what to do to notice similar issues sooner. Maybe we should have a list of PII-enabled groups and alerting if someone without a NDA is added?

That could work as a risk-reducing mitigation. Maybe somewhere in UserrightsPage::doSaveUserGroups?

[Urbanecm](/p/Urbanecm/) added a comment.[Sep 15 2021, 8:57 PM2021-09-15 20:57:55 (UTC+0)](#7357118)Comment Actions
> In [T290808#7357037](/T290808#7357037), [@sbassett](/p/sbassett/) wrote:
> > In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
> >
> > * Do we need someone to formally declare "no infoleak happened" (if Ladsgroup's understanding is correct)?
>
> IMO, we can likely safely say this is the case, per [@Ladsgroup](/p/Ladsgroup/)'s findings in [T290808#7346535](/T290808#7346535). I'm not sure there's much else the [Security-Team](/tag/security-team/) (or anyone else) could audit here? We don't really have secret security logs with more wide-ranging data for cases like this. Ping [@Dsharpe](/p/Dsharpe/) to confirm.

I meant "give an authoritative interpretation of the data" rather than "add more data", sorry if that wasn't clear. I don't think that this call should be made by me :-).

[• Dsharpe](/p/Dsharpe/) added a comment.[Sep 15 2021, 9:52 PM2021-09-15 21:52:38 (UTC+0)](#7357354)Comment Actions

Here is how I see matters like this: if we looked at everything we could reasonably think of and found no evidence of a leak, then a leak did not happen. That sounds exactly like the situation here. No leak happened.

Does anyone need anything else from me for this matter?

[Ladsgroup](/p/Ladsgroup/) added a comment.[Sep 16 2021, 9:41 AM2021-09-16 09:41:50 (UTC+0)](#7358206)Comment Actions
> In [T290808#7357118](/T290808#7357118), [@Urbanecm](/p/Urbanecm/) wrote:
> > In [T290808#7357037](/T290808#7357037), [@sbassett](/p/sbassett/) wrote:
> > > In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
> > >
> > > * Do we need someone to formally declare "no infoleak happened" (if Ladsgroup's understanding is correct)?
> >
> > IMO, we can likely safely say this is the case, per [@Ladsgroup](/p/Ladsgroup/)'s findings in [T290808#7346535](/T290808#7346535). I'm not sure there's much else the [Security-Team](/tag/security-team/) (or anyone else) could audit here? We don't really have secret security logs with more wide-ranging data for cases like this. Ping [@Dsharpe](/p/Dsharpe/) to confirm.
>
> I meant "give an authoritative interpretation of the data" rather than "add more data", sorry if that wasn't clear. I don't think that this call should be made by me :-).

One would be a script that gets run daily and checks members of any group that has access to confidentional information against the meta page.

It clearly is not enough, having volunteer-NDA doesn't mean the person is trusted as exampled above.

[phuedx](/p/phuedx/) added a comment.[Sep 20 2021, 12:52 PM2021-09-20 12:52:45 (UTC+0)](#7365261)Comment Actions
> In [T290808#7351689](/T290808#7351689), [@phuedx](/p/phuedx/) wrote:
> > In [T290808#7349572](/T290808#7349572), [@Urbanecm](/p/Urbanecm/) wrote:
> >
> > * Make it more obvious that securepoll's electionadmin group grants access to PII (maybe create a proper right, like securepoll-view-votes and securepoll-view-ip-for-votes, to make it more obvious in the patch that PII is involved?) I think [Anti-Harassment](/tag/anti-harassment/) can help with this part (CC [@Niharika](/p/Niharika/))

T290808.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/ypgtmkoxtrnftdkdbzf4/PHID-FILE-67qjhratn5nz5bm2ubrn/T290808.patch)

The above patch introduces a check for the securepoll-view-voter-pii right before showing the fields containing PII.

[Niharika](/p/Niharika/) added a project: [MediaWiki-extensions-SecurePoll](/tag/mediawiki-extensions-securepoll/).[Sep 21 2021, 8:43 PM2021-09-21 20:43:56 (UTC+0)](#7370433)[Niharika](/p/Niharika/) moved this task from [Untriaged](/project/board/2660/) to [Tracking work by others](/project/board/2660/) on the [Anti-Harassment](/tag/anti-harassment/) board.[sbassett](/p/sbassett/) moved this task from [Watching](/project/board/1179/) to [Security Patch To Deploy](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Sep 29 2021, 7:15 PM2021-09-29 19:15:03 (UTC+0)](#7389210)[Niharika](/p/Niharika/) added a subscriber: [ARamirez\_WMF](/p/ARamirez_WMF/).[Oct 27 2021, 6:01 PM2021-10-27 18:01:18 (UTC+0)](#7462401)

[Aklapper](/p/Aklapper/) added a comment.[Oct 31 2021, 7:09 AM2021-10-31 07:09:58 (UTC+0)](#7470026)Comment Actions

Could this ticket see some progress, please? Thanks a lot! :)

[Mstyles](/p/Mstyles/) subscribed.[Nov 1 2021, 9:12 PM2021-11-01 21:12:52 (UTC+0)](#7473259)Comment Actions

[@phuedx](/p/phuedx/) could you please have someone else review your patch so that the security team can move forward and deploy it?

[Urbanecm](/p/Urbanecm/) added a comment.[Nov 1 2021, 9:28 PM2021-11-01 21:28:55 (UTC+0)](#7473295)Comment Actions

Based on a quick look, it looks good to me. I confirmed with a scrutineer of an ongoing election that they were not able to see PII until I made the config change to assign the right to votewiki election admins.

Sec patch deployed.

[Urbanecm](/p/Urbanecm/) added a subscriber: [Tks4Fish](/p/Tks4Fish/).[Nov 1 2021, 9:31 PM2021-11-01 21:31:24 (UTC+0)](#7473300)Comment Actions
```
22:28 <+logmsgbot> !log urbanecm@deploy1002 Synchronized wmf-config/InitialiseSettings.php: 8f5008d9a043c96cd1dba18bdb38e168b01d63d0: votewiki: Grant election admins securepoll-view-voter-pii (T290808) (duration: 00m 55s)
22:28 <+stashbot> Logged the message at https://wikitech.wikimedia.org/wiki/Server_Admin_Log
22:30 <urbanecm> !log Deploy a security patch for T290808
22:30 <+stashbot> Logged the message at https://wikitech.wikimedia.org/wiki/Server_Admin_Log
```

[@Tks4Fish](/p/Tks4Fish/) mentioned PII moved to the end of the table. They said it's not a big deal, but [@phuedx](/p/phuedx/), maybe changing it to follow the previous layout is not a big issue?

[sbassett](/p/sbassett/) added a comment.[Nov 2 2021, 2:48 PM2021-11-02 14:48:46 (UTC+0)](#7474875)Comment Actions

[@Urbanecm](/p/Urbanecm/) - thanks for the deploy, tracking at [T292236](/T292236) and T276237 now.

[sbassett](/p/sbassett/) moved this task from [Security Patch To Deploy](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Nov 2 2021, 2:49 PM2021-11-02 14:49:00 (UTC+0)](#7474878)[sbassett](/p/sbassett/) mentioned this in [T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236).[phuedx](/p/phuedx/) added a comment.[Nov 3 2021, 4:53 PM2021-11-03 16:53:18 (UTC+0)](#7478797)Comment Actions
> In [T290808#7473300](/T290808#7473300), [@Urbanecm](/p/Urbanecm/) wrote:
>
> [@Tks4Fish](/p/Tks4Fish/) mentioned PII moved to the end of the table. They said it's not a big deal, but [@phuedx](/p/phuedx/), maybe changing it to follow the previous layout is not a big issue?

Thanks for deployment, [@Urbanecm](/p/Urbanecm/). You're right that it's not a big issue to fix. I'll take a look.

[Reedy](/p/Reedy/) added a parent task: [T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236).[Nov 3 2021, 6:41 PM2021-11-03 18:41:38 (UTC+0)](#7479216)[Reedy](/p/Reedy/) changed the task status from Open to In Progress.[Nov 3 2021, 6:45 PM2021-11-03 18:45:32 (UTC+0)](#7479231)

[Urbanecm](/p/Urbanecm/) added a subscriber: [Reedy](/p/Reedy/).[Nov 7 2021, 8:06 PM2021-11-07 20:06:43 (UTC+0)](#7488103)Comment Actions

[@sbassett](/p/sbassett/) [@Reedy](/p/Reedy/) [@phuedx](/p/phuedx/) Hello, any objections to making this public? AFAICS, only a cosmetic change is pending now.

[phuedx](/p/phuedx/) added a comment.[Nov 8 2021, 2:35 PM2021-11-08 14:35:36 (UTC+0)](#7489420)Comment Actions
> In [T290808#7488103](/T290808#7488103), [@Urbanecm](/p/Urbanecm/) wrote:
>
> [@sbassett](/p/sbassett/) [@Reedy](/p/Reedy/) [@phuedx](/p/phuedx/) Hello, any objections to making this public? AFAICS, only a cosmetic change is pending now.

None from my side.

[sbassett](/p/sbassett/) added a comment.[Nov 8 2021, 9:30 PM2021-11-08 21:30:55 (UTC+0)](#7490954)Comment Actions
> In [T290808#7488103](/T290808#7488103), [@Urbanecm](/p/Urbanecm/) wrote:
>
> [@sbassett](/p/sbassett/) [@Reedy](/p/Reedy/) [@phuedx](/p/phuedx/) Hello, any objections to making this public? AFAICS, only a cosmetic change is pending now.

Given the findings from [T290808#7346535](/T290808#7346535), I think we're likely fine to make this public, but I'd defer to [@Dsharpe](/p/Dsharpe/) one more time just in case he sees something that I do not.

[Urbanecm](/p/Urbanecm/) added a comment.[Nov 29 2021, 4:17 PM2021-11-29 16:17:41 (UTC+0)](#7534343)Comment Actions
> In [T290808#7490954](/T290808#7490954), [@sbassett](/p/sbassett/) wrote:
> > In [T290808#7488103](/T290808#7488103), [@Urbanecm](/p/Urbanecm/) wrote:
> >
> > [@sbassett](/p/sbassett/) [@Reedy](/p/Reedy/) [@phuedx](/p/phuedx/) Hello, any objections to making this public? AFAICS, only a cosmetic change is pending now.
>
> Given the findings from [T290808#7346535](/T290808#7346535), I think we're likely fine to make this public, but I'd defer to [@Dsharpe](/p/Dsharpe/) one more time just in case he sees something that I do not.

Any update?

[sbassett](/p/sbassett/) added a comment.Edited · [Nov 29 2021, 4:56 PM2021-11-29 16:56:50 (UTC+0)](#7534545)Comment Actions
> In [T290808#7534343](/T290808#7534343), [@Urbanecm](/p/Urbanecm/) wrote:
>
> Any update?

Yep, the [Security-Team](/tag/security-team/) just chatted about this. It's fine to open this up. This is already tracked for the supplemental, could use backports though.

[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-5d7tvdwuqpib3pf/)" to "Public (No Login Required)".[Nov 29 2021, 4:57 PM2021-11-29 16:57:16 (UTC+0)](#7534548)[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-4bfkf7cjrd7ofqf/)" to "All Users".[sbassett](/p/sbassett/) changed Risk Rating from N/A to Low.[Xaosflux](/p/Xaosflux/) subscribed.[Dec 5 2021, 1:41 AM2021-12-05 01:41:28 (UTC+0)](#7548228)[Zabe](/p/Zabe/) subscribed.[Dec 6 2021, 1:40 PM2021-12-06 13:40:46 (UTC+0)](#7549620)[• 4nn1l2](/p/4nn1l2/) subscribed.Edited · [Dec 6 2021, 4:45 PM2021-12-06 16:45:46 (UTC+0)](#7550272)Comment Actions

It was funny reading this :)

While I, as a non-paid volunteer, have been working hard helping the [Anti-Harassment](/tag/anti-harassment/) team and [@Niharika](/p/Niharika/) implement Meek STV for WMF elections

[https://www.mediawiki.org/wiki/Topic:Wdnlzj4xzf0ardcd](https://www.mediawiki.org/wiki/Topic%3AWdnlzj4xzf0ardcd)

[https://commons.wikimedia.org/wiki/File:Scottish\_STV,\_MediaWiki\_SecurePoll\_example.svg](https://commons.wikimedia.org/wiki/File%3AScottish_STV%2C_MediaWiki_SecurePoll_example.svg)

<https://www.mediawiki.org/w/index.php?title=Anti-Harassment_Tools/SecurePoll_Improvements/Understanding_the_STV_result&action=history>

[T288185](/T288185)

<https://meta.wikimedia.org/w/index.php?title=Wikimedia_Foundation_elections/2021/Results&diff=prev&oldid=21993043>

[https://meta.wikimedia.org/wiki/Talk:Movement\_Charter/Drafting\_Committee/Elections#Heads\_up\_for\_alternates](https://meta.wikimedia.org/wiki/Talk%3AMovement_Charter/Drafting_Committee/Elections#Heads_up_for_alternates)

<https://meta.wikimedia.org/w/index.php?title=Movement_Charter/Drafting_Committee/Elections/Results&diff=prev&oldid=22358958>

some other people have been concerned about leaking or breaching private data by bad actors!

I don't need anyone's private data and have signed NDA as a former VRT agent. (I know, I know there are multiple NDAs, no need to mention that, but you should use correct terminology yourselves).

Hope you let innocent users play with SecurePoll on testwiki again. That really helps developing things. Users still cannot test SecurePoll on testwiki and that *is* frustrating: [T277353#7234897](/T277353#7234897)

[Huji](/p/Huji/) subscribed.[Dec 6 2021, 5:02 PM2021-12-06 17:02:08 (UTC+0)](#7550375)Comment Actions

While this discussion is gathering people's attention, may I remind this important security gap: [T152972: Accessing private information through SecurePoll should be logged](/T152972)

[Huji](/p/Huji/) added a comment.[Dec 6 2021, 10:27 PM2021-12-06 22:27:02 (UTC+0)](#7551591)Comment Actions
> In [T290808#7550272](/T290808#7550272), [@4nn1l2](/p/4nn1l2/) wrote:
>
> It was funny reading this :)
>
> While I, as a non-paid volunteer, have been working hard helping the [Anti-Harassment](/tag/anti-harassment/) team and [@Niharika](/p/Niharika/) implement Meek STV for WMF elections
>
> [https://www.mediawiki.org/wiki/Topic:Wdnlzj4xzf0ardcd](https://www.mediawiki.org/wiki/Topic%3AWdnlzj4xzf0ardcd)
>
> [https://commons.wikimedia.org/wiki/File:Scottish\_STV,\_MediaWiki\_SecurePoll\_example.svg](https://commons.wikimedia.org/wiki/File%3AScottish_STV%2C_MediaWiki_SecurePoll_example.svg)
>
> <https://www.mediawiki.org/w/index.php?title=Anti-Harassment_Tools/SecurePoll_Improvements/Understanding_the_STV_result&action=history>
>
> [T288185](/T288185)
>
> <https://meta.wikimedia.org/w/index.php?title=Wikimedia_Foundation_elections/2021/Results&diff=prev&oldid=21993043>
>
> [https://meta.wikimedia.org/wiki/Talk:Movement\_Charter/Drafting\_Committee/Elections#Heads\_up\_for\_alternates](https://meta.wikimedia.org/wiki/Talk%3AMovement_Charter/Drafting_Committee/Elections#Heads_up_for_alternates)
>
> <https://meta.wikimedia.org/w/index.php?title=Movement_Charter/Drafting_Committee/Elections/Results&diff=prev&oldid=22358958>
>
> some other people have been concerned about leaking or breaching private data by bad actors!
>
> I don't need anyone's private data and have signed NDA as a former VRT agent. (I know, I know there are multiple NDAs, no need to mention that, but you should use correct terminology yourselves).
>
> Hope you let innocent users play with SecurePoll on testwiki again. That really helps developing things. Users still cannot test SecurePoll on testwiki and that *is* frustrating: [T277353#7234897](/T277353#7234897)

You shouldn't take it personally, [@4nn1l2](/p/4nn1l2/). It is not about you. This could have happened with another person who is not as well intended. A safety flaw is a safety flaw, no matter the outcome. In fact, focusing on the outcome is a known mistake (called [outcome bias](https://en.wikipedia.org/wiki/Outcome_bias)) and what I gather from above is that ultimately the team is aware of it. It shows where [@Ladsgroup](/p/Ladsgroup/) says "our luck will run out one day".

[Huji](/p/Huji/) added a comment.[Dec 6 2021, 10:31 PM2021-12-06 22:31:28 (UTC+0)](#7551597)Comment Actions

[@Urbanecm](/p/Urbanecm/) in the task description you said "... we effectively allowed testwiki's bureaucrats to grant users access to confidential information".

Isn't that part of the problem? Shouldn't $wgGrantPermissions be overwritten in InitialiseSettings.php to ensure that only stewards can assign electionadmin right on WMF production wikis?

[gerritbot](/p/gerritbot/) added a comment.[Dec 7 2021, 6:01 AM2021-12-07 06:01:28 (UTC+0)](#7552057)Comment Actions

Change 744669 had a related patch set uploaded (by Urbanecm; author: Phuedx):

[mediawiki/extensions/SecurePoll@master] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/744669>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Dec 7 2021, 6:01 AM2021-12-07 06:01:29 (UTC+0)](#7552058)[gerritbot](/p/gerritbot/) added a comment.[Dec 7 2021, 6:04 AM2021-12-07 06:04:12 (UTC+0)](#7552059)Comment Actions

Change 743940 had a related patch set uploaded (by Urbanecm; author: Phuedx):

[mediawiki/extensions/SecurePoll@REL1\_37] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/743940>

[Urbanecm](/p/Urbanecm/) added a comment.[Dec 7 2021, 6:13 AM2021-12-07 06:13:13 (UTC+0)](#7552064)Comment Actions
> In [T290808#7551597](/T290808#7551597), [@Huji](/p/Huji/) wrote:
>
> [@Urbanecm](/p/Urbanecm/) in the task description you said "... we effectively allowed testwiki's bureaucrats to grant users access to confidential information".
>
> Isn't that part of the problem? Shouldn't $wgGrantPermissions be overwritten in InitialiseSettings.php to ensure that only stewards can assign electionadmin right on WMF production wikis?

Not necessarily. For votewiki, this risk pretty much doesn't exist -- we trust votewiki bureaucrats for this kind of a task. It was only an issue for wikis where bureaucrats have no connection with handling PII. Honestly, I don't think we need stewards to act as a rubber stamp for WMF staff managing securepoll elections and while the new rule you mention could have a votewiki-specific exemption, I'm pretty sure people trying to enable creating pools on new wikis will...try to copy votewiki config :)).

I think a better solution is implemented in the security patch deployed as part of this task (see the one I just merged to master), which requires users having securepoll-view-voter-pii in addition to being election admins before they're allowed to view PII. That right should make it pretty obvious that you're adding PII access, and I believe a change like [https://gerrit.wikimedia.org/r/c/operations/mediawiki-config/+/736067](https://gerrit.wikimedia.org/r/c/operations/mediawiki-config/%2B/736067) will not pass review for testwiki (at least not without someone asking questions "are we sure letting users to access PII is a good idea").

Of course, we should have more layers of defense for this. One of the ideas could be to construct a list of PII accessing groups, and audit users for NDA membership regularly. If an issue is found, it can notify...someone (stewards+T&S sound like a reasonable first choice for me).

[gerritbot](/p/gerritbot/) added a comment.[Dec 7 2021, 6:14 AM2021-12-07 06:14:05 (UTC+0)](#7552066)Comment Actions

Change 744669 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@master] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/744669>

[Urbanecm](/p/Urbanecm/) mentioned this in [T152972: Accessing private information through SecurePoll should be logged](/T152972).[Dec 7 2021, 6:32 AM2021-12-07 06:32:59 (UTC+0)](#7552081)[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.38-notes (1.38.0-wmf.13; 2021-12-13)](/project/view/5647/).[Dec 7 2021, 8:00 AM2021-12-07 08:00:56 (UTC+0)](#7552150)[gerritbot](/p/gerritbot/) added a comment.[Dec 7 2021, 9:25 AM2021-12-07 09:25:09 (UTC+0)](#7552319)Comment Actions

Change 744761 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/SecurePoll@master] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/744761>

[gerritbot](/p/gerritbot/) added a comment.[Dec 8 2021, 10:56 AM2021-12-08 10:56:15 (UTC+0)](#7555841)Comment Actions

Change 744761 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@master] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/744761>

[gerritbot](/p/gerritbot/) added a comment.[Dec 14 2021, 6:56 PM2021-12-14 18:56:09 (UTC+0)](#7570737)Comment Actions

Change 743940 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_37] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/743940>

[gerritbot](/p/gerritbot/) added a comment.[Dec 14 2021, 6:59 PM2021-12-14 18:59:32 (UTC+0)](#7570771)Comment Actions

Change 747076 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/SecurePoll@REL1\_37] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/747076>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 2:08 PM2021-12-15 14:08:23 (UTC+0)](#7572409)Comment Actions

Change 747513 had a related patch set uploaded (by Phuedx; author: Phuedx):

[mediawiki/extensions/SecurePoll@master] listPager: Restore original field order

<https://gerrit.wikimedia.org/r/747513>

[gerritbot](/p/gerritbot/) added a comment.[Dec 21 2021, 5:44 PM2021-12-21 17:44:52 (UTC+0)](#7583649)Comment Actions

Change 749228 had a related patch set uploaded (by SBassett; author: Phuedx):

[mediawiki/extensions/SecurePoll@REL1\_35] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/749228>

[gerritbot](/p/gerritbot/) added a comment.[Dec 21 2021, 5:45 PM2021-12-21 17:45:12 (UTC+0)](#7583652)Comment Actions

Change 749229 had a related patch set uploaded (by SBassett; author: Phuedx):

[mediawiki/extensions/SecurePoll@REL1\_36] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/749229>

[gerritbot](/p/gerritbot/) added a comment.[Dec 21 2021, 9:52 PM2021-12-21 21:52:25 (UTC+0)](#7584765)Comment Actions

Change 749228 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_35] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/749228>

[gerritbot](/p/gerritbot/) added a comment.[Dec 21 2021, 9:52 PM2021-12-21 21:52:30 (UTC+0)](#7584766)Comment Actions

Change 749229 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_36] SECURITY: Require securepoll-view-voter-pii right to view voter's PII

<https://gerrit.wikimedia.org/r/749229>

[sbassett](/p/sbassett/) removed a parent task: [T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236).[Dec 23 2021, 5:16 PM2021-12-23 17:16:48 (UTC+0)](#7587799)[sbassett](/p/sbassett/) added a parent task: [T292236: Write and send supplementary release announcement for extensions and skins with security patches (1.35.5/1.36.3/1.37.1)](/T292236).[Dec 23 2021, 5:25 PM2021-12-23 17:25:01 (UTC+0)](#7587809)[gerritbot](/p/gerritbot/) added a comment.[Jan 2 2022, 4:11 PM2022-01-02 16:11:24 (UTC+0)](#7592932)Comment Actions

Change 749885 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/SecurePoll@REL1\_36] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/749885>

[gerritbot](/p/gerritbot/) added a comment.[Jan 2 2022, 4:13 PM2022-01-02 16:13:29 (UTC+0)](#7592933)Comment Actions

Change 750806 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/SecurePoll@REL1\_35] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/750806>

[mmartorana](/p/mmartorana/) renamed this task from Users with no NDA can access confidential information at testwiki's SecurePoll instance to Users with no NDA can access confidential information at testwiki's SecurePoll instance (CVE-2021-46148).[Jan 10 2022, 5:03 PM2022-01-10 17:03:38 (UTC+0)](#7609784)[mmartorana](/p/mmartorana/) closed this task as Resolved.[Jan 10 2022, 6:40 PM2022-01-10 18:40:00 (UTC+0)](#7610212)[mmartorana](/p/mmartorana/) assigned this task to [phuedx](/p/phuedx/).[gerritbot](/p/gerritbot/) added a comment.[Jan 17 2022, 12:02 AM2022-01-17 00:02:05 (UTC+0)](#7624934)Comment Actions

Change 747076 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_37] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/747076>

[gerritbot](/p/gerritbot/) added a comment.[Jan 17 2022, 12:06 AM2022-01-17 00:06:30 (UTC+0)](#7624935)Comment Actions

Change 749885 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_36] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/749885>

[gerritbot](/p/gerritbot/) added a comment.[Jan 17 2022, 12:07 AM2022-01-17 00:07:44 (UTC+0)](#7624936)Comment Actions

Change 750806 **merged** by jenkins-bot:

[mediawiki/extensions/SecurePoll@REL1\_35] Fully add new securepoll-view-voter-pii right

<https://gerrit.wikimedia.org/r/750806>

[WormTT](/p/WormTT/) subscribed.[Oct 3 2022, 2:18 PM2022-10-03 14:18:18 (UTC+0)](#8279779)[jrbs](/p/jrbs/) mentioned this in [T335201: Investigation: What needs to change to allow local wikis to run their own elections?](/T335201).[Apr 26 2023, 9:05 PM2023-04-26 21:05:20 (UTC+0)](#8809057)[Johannnes89](/p/Johannnes89/) subscribed.[Apr 5 2024, 6:41 AM2024-04-05 06:41:39 (UTC+0)](#9691671)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from gerrit.wikimedia.org_7f8bbe5e_20250114_221918.html ===



