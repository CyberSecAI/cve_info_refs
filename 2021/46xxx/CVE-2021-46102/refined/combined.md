=== Content from github.com_79159698_20250114_201305.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F200)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F200)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=solana-labs%2Frbpf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 10, 2025. It is now read-only.

[solana-labs](/solana-labs)
/
**[rbpf](/solana-labs/rbpf)**
Public archive

forked from [qmonnet/rbpf](/qmonnet/rbpf)

* [Notifications](/login?return_to=%2Fsolana-labs%2Frbpf) You must be signed in to change notification settings
* [Fork
  177](/login?return_to=%2Fsolana-labs%2Frbpf)
* [Star
   302](/login?return_to=%2Fsolana-labs%2Frbpf)

* [Code](/solana-labs/rbpf)
* [Issues
  0](/solana-labs/rbpf/issues)
* [Pull requests
  0](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects
  0](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

Additional navigation options

* [Code](/solana-labs/rbpf)
* [Issues](/solana-labs/rbpf/issues)
* [Pull requests](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

# Implement handling of R\_BPF\_64\_64 relocations used in ld\_imm64 #200

 Merged

[dmakarov](/dmakarov)
merged 1 commit into
[solana-labs:main](/solana-labs/rbpf/tree/main "solana-labs/rbpf:main")
from
[dmakarov:main](/dmakarov/rbpf/tree/main "dmakarov/rbpf:main")

Jul 19, 2021

 Merged

# [Implement handling of R\_BPF\_64\_64 relocations used in ld\_imm64](#top) #200

[dmakarov](/dmakarov)
merged 1 commit into
[solana-labs:main](/solana-labs/rbpf/tree/main "solana-labs/rbpf:main")
from
[dmakarov:main](/dmakarov/rbpf/tree/main "dmakarov/rbpf:main")

Jul 19, 2021

[Conversation
8](/solana-labs/rbpf/pull/200)
[Commits
1](/solana-labs/rbpf/pull/200/commits)
[Checks
0](/solana-labs/rbpf/pull/200/checks)
[Files changed](/solana-labs/rbpf/pull/200/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![dmakarov](https://avatars.githubusercontent.com/u/103494?s=60&v=4)](/dmakarov)

Copy link

### @dmakarov **[dmakarov](/dmakarov)** commented [Jul 17, 2021](#issue-946920228)

to resolve [solana-labs/solana#17989](https://github.com/solana-labs/solana/issues/17989)

Sorry, something went wrong.

All reactions

 [![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&u=5bda27f6a8f89b52ada67e5b13ca34c5f9d54199&v=4)](/dmakarov)
[dmakarov](/dmakarov)
requested review from
[Lichtso](/Lichtso) and
[jackcmay](/jackcmay)
[July 17, 2021 23:51](#event-5034525607)

 [![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&u=5bda27f6a8f89b52ada67e5b13ca34c5f9d54199&v=4)](/dmakarov)
[dmakarov](/dmakarov)
[force-pushed](/solana-labs/rbpf/compare/12529e6fd21599adcec592b885a8170d4b1d299f..b000d6b7677888c1603ca7bdd7012bdb59f16111)
the
main

branch
from
[`12529e6`](/solana-labs/rbpf/commit/12529e6fd21599adcec592b885a8170d4b1d299f) to
[`b000d6b`](/solana-labs/rbpf/commit/b000d6b7677888c1603ca7bdd7012bdb59f16111)  [Compare](/solana-labs/rbpf/compare/12529e6fd21599adcec592b885a8170d4b1d299f..b000d6b7677888c1603ca7bdd7012bdb59f16111)
[July 18, 2021 00:04](#event-5034532961)

[![Lichtso](https://avatars.githubusercontent.com/u/309583?s=60&v=4)](/Lichtso)

**[Lichtso](/Lichtso)**
reviewed
[Jul 19, 2021](#pullrequestreview-709461512)

 [View reviewed changes](/solana-labs/rbpf/pull/200/files)

[src/elf.rs](/solana-labs/rbpf/pull/200/files#diff-31c97589d031bca1dbc5cba43a1fa29c33085a23678d6cc1367b0f0e752982d7)
Outdated

Show resolved

Hide resolved

[src/elf.rs](/solana-labs/rbpf/pull/200/files#diff-31c97589d031bca1dbc5cba43a1fa29c33085a23678d6cc1367b0f0e752982d7)

Show resolved

Hide resolved

[src/elf.rs](/solana-labs/rbpf/pull/200/files#diff-31c97589d031bca1dbc5cba43a1fa29c33085a23678d6cc1367b0f0e752982d7)
Outdated

Show resolved

Hide resolved

[tests/elfs/reloc.c](/solana-labs/rbpf/pull/200/files#diff-ae06a6052feed4fb6c53f92f555cab040bf3dd3d595a5715742b3b9eb382183b)

Show resolved

Hide resolved

[![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&v=4)](/dmakarov)

`[Implement handling of R_BPF_64_64 relocations used in ld_imm64](/solana-labs/rbpf/pull/200/commits/7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729 "Implement handling of R_BPF_64_64 relocations used in ld_imm64")`

`[7ccef6f](/solana-labs/rbpf/pull/200/commits/7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729)`

 [![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&u=5bda27f6a8f89b52ada67e5b13ca34c5f9d54199&v=4)](/dmakarov)
[dmakarov](/dmakarov)
[force-pushed](/solana-labs/rbpf/compare/b000d6b7677888c1603ca7bdd7012bdb59f16111..7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729)
the
main

branch
from
[`b000d6b`](/solana-labs/rbpf/commit/b000d6b7677888c1603ca7bdd7012bdb59f16111) to
[`7ccef6f`](/solana-labs/rbpf/commit/7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729)  [Compare](/solana-labs/rbpf/compare/b000d6b7677888c1603ca7bdd7012bdb59f16111..7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729)
[July 19, 2021 13:03](#event-5038315551)

[![jackcmay](https://avatars.githubusercontent.com/u/40156282?s=60&v=4)](/jackcmay)

**[jackcmay](/jackcmay)**
approved these changes
[Jul 19, 2021](#pullrequestreview-709848825)

 [View reviewed changes](/solana-labs/rbpf/pull/200/files/7ccef6f555bcc6bdb74d5cdeb3e5d0923a652729)

[![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&u=5bda27f6a8f89b52ada67e5b13ca34c5f9d54199&v=4)](/dmakarov)
[dmakarov](/dmakarov)
merged commit [`2e9f65e`](/solana-labs/rbpf/commit/2e9f65efa462ec761bb7e3c007f83dd8346589db)
into
solana-labs:main

[Jul 19, 2021](https://github.com/solana-labs/rbpf/pull/200#event-5040081932)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F200).

Reviewers

[![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&v=4)](/Lichtso) [Lichtso](/Lichtso)

Lichtso left review comments

[![@jackcmay](https://avatars.githubusercontent.com/u/40156282?s=40&v=4)](/jackcmay) [jackcmay](/jackcmay)

jackcmay approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [`const` data in C result in unsupported BPF relocation R\_BPF\_INSN\_64](https://github.com/solana-labs/solana/issues/17989)

3 participants

[![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=52&v=4)](/dmakarov) [![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=52&v=4)](/Lichtso) [![@jackcmay](https://avatars.githubusercontent.com/u/40156282?s=52&v=4)](/jackcmay)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blocksecteam.medium.com_49e49574_20250114_201301.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7729717159ee&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblocksecteam.medium.com%2Fnew-integer-overflow-bug-discovered-in-solana-rbpf-7729717159ee&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblocksecteam.medium.com%2Fnew-integer-overflow-bug-discovered-in-solana-rbpf-7729717159ee&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# New Integer Overflow Bug Discovered in Solana rBPF

[![BlockSec](https://miro.medium.com/v2/resize:fill:88:88/1*Wklrlg9am_KqzNIpAgHLgg.png)](/?source=post_page---byline--7729717159ee--------------------------------)

[BlockSec](/?source=post_page---byline--7729717159ee--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47b316008922&operation=register&redirect=https%3A%2F%2Fblocksecteam.medium.com%2Fnew-integer-overflow-bug-discovered-in-solana-rbpf-7729717159ee&user=BlockSec&userId=47b316008922&source=post_page-47b316008922--byline--7729717159ee---------------------post_header-----------)

3 min read·Dec 30, 2021

--

1

Listen

Share

Recently, our vulnerability detection system discovered a critical issue in the rBPF of Solana (i.e., the virtual machine where all the Solana dApps are running on: <https://github.com/solana-labs/rbpf>). After a careful investigation, we found that it is an integer overflow bug which can be exploited to crash down the whole Solana network. We have reported the bug to the Solana security team, and the team immediately sprang into action to confirm and fix the bug. As of this writing, almost all the validator nodes received the patch and upgraded to the latest version, which means it is safe to make a public disclosure.

# eBPF and rBPF

Extended Berkeley Packet Filter (eBPF[1]) is initially developed for filtering packets in the kernel. Due to the security, efficiency, and scalability of eBPF, it is now used in various areas like networking, tracing, profiling, etc[2]. Considering the rich capability of eBPF, Solana choose it as the execution engine for the smart contract as well. To build the dApps on Solana, developers need to develop their smart contracts in Rust that will be compiled into eBPF bytecode.

To host the dApps of Solana, a precise virtual machine for eBPF is required. In this case, Solana uses the rBPF, which is a virtual machine for eBPF written in Rust. However, whether the proposed virtual machine (i.e., rBPF) is robust, secure, and precise is unknown. Once there exist security issues inside the rBPF, all the validators containing the rBPF can be influenced, resulting in huge loss (e.g., DDoS attack) for the whole Solana network.

# The root cause of the bug

We have developed a tool to locate the bugs for the rBPF. This tool is still under the active development. During this process, one serious problem was identified in rBPF (version 0.2.16), which can take down the whole network.

Specifically, function “*load”* in file “elf.rs” is used to parse and verify the ELF file (the smart contract). First, function “*load”* would read the ELF structure and invoke function “*relocate*” to set up the callee offset. However, in function *“relocate”*, the attribute *“sym.st\_value”* is retrieved from the ELF file directly (<https://github.com/solana-labs/rbpf/blob/c14764850f0b83b58aa013248eaf6d65836c1218/src/elf.rs#L609-L630>). If the *“st\_value”* is large enough, integer overflow could be triggered when calculating the *“addr”*, which is the sum-up of *“sym.st\_value”* and *“refd\_pa”*.

![]()

In this case, an attacker can create a malicious ELF file as a smart contract, which can trigger the integer overflow. After that, every validator would run the target ELF file and the rBPF would get panic with “add with overflow”.

![]()

At this moment, rBPF will get stuck and the coming transactions will not be executed, resulting in a DoS attack. We can observe that the node get stuck at “Finalizing transaction”, which is shown in the following, due to the integer overflow while loading the ELF file.

![]()

This issue was introduced in <https://github.com/solana-labs/rbpf/pull/200>, meaning the rBPF is vulnerable from version 0.2.14. We identified the issue and reported it to the Solana security team on 2021 December 6th. Solana fixes the issue in a few hours by using the safemath mechanism after our report. The fix is in <https://github.com/solana-labs/rbpf/pull/236>. At the time of writing (2021/12/30), more than 86% of the validators have upgraded to the newest version.

[1] <https://en.wikipedia.org/wiki/Berkeley_Packet_Filter>

[2] <https://ebpf.io/>

# Timeline

* 2021/12/06: the problem was reported to the Solana security team
* 2021/12/06: the vulnerability was fixed.
* 2021/12/30: the information of this vulnerability was released
* 2022/01/28: the CVE-2021–46102 was assigned
[Solana Blockchain](https://medium.com/tag/solana-blockchain?source=post_page-----7729717159ee--------------------------------)[Blocksec](https://medium.com/tag/blocksec?source=post_page-----7729717159ee--------------------------------)[Bpf](https://medium.com/tag/bpf?source=post_page-----7729717159ee--------------------------------)[Blockchain Security](https://medium.com/tag/blockchain-security?source=post_page-----7729717159ee--------------------------------)

--

--

1

[![BlockSec](https://miro.medium.com/v2/resize:fill:96:96/1*Wklrlg9am_KqzNIpAgHLgg.png)](/?source=post_page---post_author_info--7729717159ee--------------------------------)[![BlockSec](https://miro.medium.com/v2/resize:fill:128:128/1*Wklrlg9am_KqzNIpAgHLgg.png)](/?source=post_page---post_author_info--7729717159ee--------------------------------)Follow[## Written by BlockSec](/?source=post_page---post_author_info--7729717159ee--------------------------------)[1.98K Followers](/followers?source=post_page---post_author_info--7729717159ee--------------------------------)·[8 Following](/following?source=post_page---post_author_info--7729717159ee--------------------------------)

The BlockSec focuses on the security of the blockchain ecosystem and the research of DeFi attack monitoring and blocking. <https://blocksec.com>

Follow
## Responses (1)

See all responses[Help](https://help.medium.com/hc/en-us?source=post_page-----7729717159ee--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----7729717159ee--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----7729717159ee--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----7729717159ee--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----7729717159ee--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----7729717159ee--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7729717159ee--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7729717159ee--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----7729717159ee--------------------------------)[Teams](https://medium.com/business?source=post_page-----7729717159ee--------------------------------)



=== Content from github.com_dcb06a08_20250114_201304.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fblob%2Fc14764850f0b83b58aa013248eaf6d65836c1218%2Fsrc%2Felf.rs)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fblob%2Fc14764850f0b83b58aa013248eaf6d65836c1218%2Fsrc%2Felf.rs)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=solana-labs%2Frbpf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 10, 2025. It is now read-only.

[solana-labs](/solana-labs)
/
**[rbpf](/solana-labs/rbpf)**
Public archive

forked from [qmonnet/rbpf](/qmonnet/rbpf)

* [Notifications](/login?return_to=%2Fsolana-labs%2Frbpf) You must be signed in to change notification settings
* [Fork
  177](/login?return_to=%2Fsolana-labs%2Frbpf)
* [Star
   302](/login?return_to=%2Fsolana-labs%2Frbpf)

* [Code](/solana-labs/rbpf)
* [Issues
  0](/solana-labs/rbpf/issues)
* [Pull requests
  0](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects
  0](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

Additional navigation options

* [Code](/solana-labs/rbpf)
* [Issues](/solana-labs/rbpf/issues)
* [Pull requests](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

## Files

 c147648
## Breadcrumbs

1. [rbpf](/solana-labs/rbpf/tree/c14764850f0b83b58aa013248eaf6d65836c1218)
2. /[src](/solana-labs/rbpf/tree/c14764850f0b83b58aa013248eaf6d65836c1218/src)
/
# elf.rs

Copy path Blame  Blame
## Latest commit

## History

[History](/solana-labs/rbpf/commits/c14764850f0b83b58aa013248eaf6d65836c1218/src/elf.rs)1141 lines (1055 loc) · 44.6 KB c147648
## Breadcrumbs

1. [rbpf](/solana-labs/rbpf/tree/c14764850f0b83b58aa013248eaf6d65836c1218)
2. /[src](/solana-labs/rbpf/tree/c14764850f0b83b58aa013248eaf6d65836c1218/src)
/
# elf.rs

Top
## File metadata and controls

* Code
* Blame

1141 lines (1055 loc) · 44.6 KB[Raw](https://github.com/solana-labs/rbpf/raw/c14764850f0b83b58aa013248eaf6d65836c1218/src/elf.rs)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000//! This module relocates a BPF ELF
// Note: Typically ELF shared objects are loaded using the program headers and// not the section headers. Since we are leveraging the elfkit crate its much// easier to use the section headers. There are cases (reduced size, obfuscation)// where the section headers may be removed from the ELF. If that happens then// this loader will need to be re-written to use the program headers instead.
extern crate goblin;extern crate scroll;
use crate::{ aligned\_memory::AlignedMemory, ebpf, error::{EbpfError, UserDefinedError}, jit::JitProgram, vm::{Config, InstructionMeter, SyscallRegistry},};use byteorder::{ByteOrder, LittleEndian};use goblin::{ elf::{header::\*, reloc::\*, section\_header::\*, Elf}, error::Error as GoblinError,};use std::{collections::BTreeMap, fmt::Debug, mem, ops::Range, str};
/// Error definitions#[derive(Debug, thiserror::Error, PartialEq, Eq)]pub enum ElfError { /// Failed to parse ELF file #[error("Failed to parse ELF file: {0}")] FailedToParse(String), /// Entrypoint out of bounds #[error("Entrypoint out of bounds")] EntrypointOutOfBounds, /// Invaid entrypoint #[error("Invaid entrypoint")] InvalidEntrypoint, /// Failed to get section #[error("Failed to get section {0}")] FailedToGetSection(String), /// Unresolved symbol #[error("Unresolved symbol ({0}) at instruction #{1:?} (ELF file offset {2:#x})")] UnresolvedSymbol(String, usize, usize), /// Section no found #[error("Section not found: {0}")] SectionNotFound(String), /// Relative jump out of bounds #[error("Relative jump out of bounds at instruction #{0}")] RelativeJumpOutOfBounds(usize), /// Symbol hash collision #[error("Symbol hash collision {0:#x}")] SymbolHashCollision(u32), /// Incompatible ELF: wrong endianess #[error("Incompatible ELF: wrong endianess")] WrongEndianess, /// Incompatible ELF: wrong ABI #[error("Incompatible ELF: wrong ABI")] WrongAbi, /// Incompatible ELF: wrong mchine #[error("Incompatible ELF: wrong machine")] WrongMachine, /// Incompatible ELF: wrong class #[error("Incompatible ELF: wrong class")] WrongClass, /// Not one text section #[error("Multiple or no text sections, consider removing llc option: -function-sections")] NotOneTextSection, /// Read-write data not supported #[error("Found .bss section in ELF, read-write data not supported")] BssNotSupported, /// Relocation failed, no loadable section contains virtual address #[error("Relocation failed, no loadable section contains virtual address {0:#x}")] AddressOutsideLoadableSection(u64), /// Relocation failed, invalid referenced virtual address #[error("Relocation failed, invalid referenced virtual address {0:#x}")] InvalidVirtualAddress(u64), /// Relocation failed, unknown type #[error("Relocation failed, unknown type {0:?}")] UnknownRelocation(u32), /// Failed to read relocation info #[error("Failed to read relocation info")] FailedToReadRelocationInfo, /// Incompatible ELF: wrong type #[error("Incompatible ELF: wrong type")] WrongType, /// Unknown symbol #[error("Unknown symbol with index {0}")] UnknownSymbol(usize), /// Offset or value is out of bounds #[error("Offset or value is out of bounds")] ValueOutOfBounds,}impl From<GoblinError> for ElfError { fn from(error: GoblinError) -> Self { match error { GoblinError::Malformed(string) => Self::FailedToParse(format!("malformed: {}", string)), GoblinError::BadMagic(magic) => Self::FailedToParse(format!("bad magic: {:#x}", magic)), GoblinError::Scroll(error) => Self::FailedToParse(format!("read-write: {}", error)), GoblinError::IO(error) => Self::FailedToParse(format!("io: {}", error)), } }}impl<E: UserDefinedError> From<GoblinError> for EbpfError<E> { fn from(error: GoblinError) -> Self { ElfError::from(error).into() }}
/// Generates the hash by which a symbol can be calledpub fn hash\_bpf\_function(pc: usize, name: &str) -> u32 { if name == "entrypoint" { ebpf::hash\_symbol\_name(b"entrypoint") } else { let mut key = [0u8; mem::size\_of::<u64>()]; LittleEndian::write\_u64(&mut key, pc as u64); ebpf::hash\_symbol\_name(&key) }}
/// Register a symbol or throw ElfError::SymbolHashCollisionpub fn register\_bpf\_function( bpf\_functions: &mut BTreeMap<u32, (usize, String)>, pc: usize, name: &str, enable\_symbol\_and\_section\_labels: bool,) -> Result<u32, ElfError> { let hash = hash\_bpf\_function(pc, name); let name = if enable\_symbol\_and\_section\_labels { name.to\_string() } else { String::default() }; if let Some(entry) = bpf\_functions.insert(hash, (pc, name)) { if entry.0 != pc { return Err(ElfError::SymbolHashCollision(hash)); } } Ok(hash)}
// For more information on the BPF instruction set:// https://github.com/iovisor/bpf-docs/blob/master/eBPF.md
// msb lsb// +------------------------+----------------+----+----+--------+// |immediate |offset |src |dst |opcode |// +------------------------+----------------+----+----+--------+
// From least significant to most significant bit:// 8 bit opcode// 4 bit destination register (dst)// 4 bit source register (src)// 16 bit offset// 32 bit immediate (imm)
/// Byte offset of the immediate field in the instructionconst BYTE\_OFFSET\_IMMEDIATE: usize = 4;/// Byte length of the immediate fieldconst BYTE\_LENGTH\_IMMEIDATE: usize = 4;
/// BPF relocation types.#[allow(non\_camel\_case\_types)]#[derive(Debug, PartialEq, Copy, Clone)]enum BpfRelocationType { /// No relocation, placeholder R\_Bpf\_None = 0, /// R\_BPF\_64\_64 relocation type is used for ld\_imm64 instruction. /// The actual to-be-relocated data (0 or section offset) is /// stored at r\_offset + 4 and the read/write data bitsize is 32 /// (4 bytes). The relocation can be resolved with the symbol /// value plus implicit addend. R\_Bpf\_64\_64 = 1, /// 64 bit relocation of a ldxdw instruction. The ldxdw /// instruction occupies two instruction slots. The 64-bit address /// to load from is split into the 32-bit imm field of each /// slot. The first slot's pre-relocation imm field contains the /// virtual address (typically same as the file offset) of the /// location to load. Relocation involves calculating the /// post-load 64-bit physical address referenced by the imm field /// and writing that physical address back into the imm fields of /// the ldxdw instruction. R\_Bpf\_64\_Relative = 8, /// Relocation of a call instruction. The existing imm field /// contains either an offset of the instruction to jump to (think /// local function call) or a special value of "-1". If -1 the /// symbol must be looked up in the symbol table. The relocation /// entry contains the symbol number to call. In order to support /// both local jumps and calling external symbols a 32-bit hash is /// computed and stored in the the call instruction's 32-bit imm /// field. The hash is used later to look up the 64-bit address /// to jump to. In the case of a local jump the hash is /// calculated using the current program counter and in the case /// of a symbol the hash is calculated using the name of the /// symbol. R\_Bpf\_64\_32 = 10,}impl BpfRelocationType { fn from\_x86\_relocation\_type(from: u32) -> Option<BpfRelocationType> { match from { R\_X86\_64\_NONE => Some(BpfRelocationType::R\_Bpf\_None), R\_X86\_64\_64 => Some(BpfRelocationType::R\_Bpf\_64\_64), R\_X86\_64\_RELATIVE => Some(BpfRelocationType::R\_Bpf\_64\_Relative), R\_X86\_64\_32 => Some(BpfRelocationType::R\_Bpf\_64\_32), \_ => None, } }}
#[derive(Debug, PartialEq)]struct SectionInfo { name: String, vaddr: u64, offset\_range: Range<usize>,}
/// Elf loader/relocator#[derive(Debug, PartialEq)]pub struct Executable<E: UserDefinedError, I: InstructionMeter> { /// Configuration settings config: Config, /// Loaded and executable elf elf\_bytes: AlignedMemory, /// Read-only section ro\_section: Vec<u8>, /// Text section info text\_section\_info: SectionInfo, /// Call resolution map (hash, pc, name) bpf\_functions: BTreeMap<u32, (usize, String)>, /// Syscall symbol map (hash, name) syscall\_symbols: BTreeMap<u32, String>, /// Syscall resolution map syscall\_registry: SyscallRegistry, /// Compiled program and argument compiled\_program: Option<JitProgram<E, I>>,}
impl<E: UserDefinedError, I: InstructionMeter> Executable<E, I> { /// Get the configuration settings pub fn get\_config(&self) -> &Config { &self.config }
 /// Get the .text section virtual address and bytes pub fn get\_text\_bytes(&self) -> (u64, &[u8]) { let offset = (self.text\_section\_info.vaddr - ebpf::MM\_PROGRAM\_START) as usize; ( self.text\_section\_info.vaddr, &self.ro\_section[offset..offset + self.text\_section\_info.offset\_range.len()], ) }
 /// Get the concatenated read-only sections (including the text section) pub fn get\_ro\_section(&self) -> &[u8] { self.ro\_section.as\_slice() }
 /// Get the entry point offset into the text section pub fn get\_entrypoint\_instruction\_offset(&self) -> Result<usize, EbpfError<E>> { self.bpf\_functions .get(&ebpf::hash\_symbol\_name(b"entrypoint")) .map(|(pc, \_name)| \*pc) .ok\_or(EbpfError::ElfError(ElfError::InvalidEntrypoint)) }
 /// Get a symbol's instruction offset pub fn lookup\_bpf\_function(&self, hash: u32) -> Option<usize> { self.bpf\_functions.get(&hash).map(|(pc, \_name)| \*pc) }
 /// Get the syscall registry pub fn get\_syscall\_registry(&self) -> &SyscallRegistry { &self.syscall\_registry }
 /// Get the JIT compiled program pub fn get\_compiled\_program(&self) -> Option<&JitProgram<E, I>> { self.compiled\_program.as\_ref() }
 /// JIT compile the executable pub fn jit\_compile(&mut self) -> Result<(), EbpfError<E>> { self.compiled\_program = Some(JitProgram::<E, I>::new(self)?); Ok(()) }
 /// Report information on a symbol that failed to be resolved pub fn report\_unresolved\_symbol(&self, insn\_offset: usize) -> Result<u64, EbpfError<E>> { let file\_offset = insn\_offset .saturating\_mul(ebpf::INSN\_SIZE) .saturating\_add(self.text\_section\_info.offset\_range.start as usize);
 let mut name = "Unknown"; if let Ok(elf) = Elf::parse(self.elf\_bytes.as\_slice()) { for relocation in &elf.dynrels { match BpfRelocationType::from\_x86\_relocation\_type(relocation.r\_type) { Some(BpfRelocationType::R\_Bpf\_64\_32) | Some(BpfRelocationType::R\_Bpf\_64\_64) => { if relocation.r\_offset as usize == file\_offset { let sym = elf .dynsyms .get(relocation.r\_sym) .ok\_or(ElfError::UnknownSymbol(relocation.r\_sym))?; name = elf .dynstrtab .get\_at(sym.st\_name) .ok\_or(ElfError::UnknownSymbol(sym.st\_name))?; } } \_ => (), } } } Err(ElfError::UnresolvedSymbol( name.to\_string(), file\_offset / ebpf::INSN\_SIZE + ebpf::ELF\_INSN\_DUMP\_OFFSET, file\_offset, ) .into()) }
 /// Get syscalls and BPF functions (if debug symbols are not stripped) pub fn get\_function\_symbols(&self) -> BTreeMap<usize, (u32, String)> { let mut bpf\_functions = BTreeMap::new(); for (hash, (pc, name)) in self.bpf\_functions.iter() { bpf\_functions.insert(\*pc, (\*hash, name.clone())); } bpf\_functions }
 /// Get syscalls symbols pub fn get\_syscall\_symbols(&self) -> &BTreeMap<u32, String> { &self.syscall\_symbols }
 /// Create from raw text section bytes (list of instructions) pub fn new\_from\_text\_bytes( config: Config, text\_bytes: &[u8], syscall\_registry: SyscallRegistry, bpf\_functions: BTreeMap<u32, (usize, String)>, ) -> Self { let elf\_bytes = AlignedMemory::new\_with\_data(text\_bytes, ebpf::HOST\_ALIGN); Self { config, elf\_bytes, ro\_section: text\_bytes.to\_vec(), text\_section\_info: SectionInfo { name: if config.enable\_symbol\_and\_section\_labels { ".text".to\_string() } else { String::default() }, vaddr: ebpf::MM\_PROGRAM\_START, offset\_range: Range { start: 0, end: text\_bytes.len(), }, }, bpf\_functions, syscall\_symbols: BTreeMap::default(), syscall\_registry, compiled\_program: None, } }
 /// Fully loads an ELF, including validation and relocation pub fn load( config: Config, bytes: &[u8], mut syscall\_registry: SyscallRegistry, ) -> Result<Self, ElfError> { let elf = Elf::parse(bytes)?; let mut elf\_bytes = AlignedMemory::new\_with\_data(bytes, ebpf::HOST\_ALIGN);
 Self::validate(&elf, elf\_bytes.as\_slice())?;
 // calculate the text section info let text\_section = Self::get\_section(&elf, ".text")?; let text\_section\_info = SectionInfo { name: if config.enable\_symbol\_and\_section\_labels { elf.shdr\_strtab .get\_at(text\_section.sh\_name) .unwrap() .to\_string() } else { String::default() }, vaddr: text\_section.sh\_addr.saturating\_add(ebpf::MM\_PROGRAM\_START), offset\_range: text\_section.file\_range().unwrap\_or\_default(), }; if (config.reject\_section\_virtual\_address\_file\_offset\_mismatch && text\_section.sh\_addr != text\_section.sh\_offset) || text\_section\_info.vaddr > ebpf::MM\_STACK\_START { return Err(ElfError::ValueOutOfBounds); }
 // relocate symbols let mut bpf\_functions = BTreeMap::default(); let mut syscall\_symbols = BTreeMap::default(); Self::relocate( &config, &mut bpf\_functions, &mut syscall\_symbols, &mut syscall\_registry, &elf, elf\_bytes.as\_slice\_mut(), )?;
 // calculate entrypoint offset into the text section let offset = elf.header.e\_entry - text\_section.sh\_addr; if offset % ebpf::INSN\_SIZE as u64 != 0 { return Err(ElfError::InvalidEntrypoint); } let entrypoint = offset as usize / ebpf::INSN\_SIZE; bpf\_functions.remove(&ebpf::hash\_symbol\_name(b"entrypoint")); register\_bpf\_function( &mut bpf\_functions, entrypoint, "entrypoint", config.enable\_symbol\_and\_section\_labels, )?;
 // concatenate the read-only sections into one let mut ro\_length = text\_section.sh\_addr as usize + text\_section\_info.offset\_range.len(); let ro\_slices = elf .section\_headers .iter() .filter(|section\_header| { if let Some(name) = elf.shdr\_strtab.get\_at(section\_header.sh\_name) { return name == ".rodata" || name == ".data.rel.ro" || name == ".eh\_frame"; } false }) .map(|section\_header| { let vaddr = section\_header .sh\_addr .saturating\_add(ebpf::MM\_PROGRAM\_START); if (config.reject\_section\_virtual\_address\_file\_offset\_mismatch && section\_header.sh\_addr != section\_header.sh\_offset) || vaddr > ebpf::MM\_STACK\_START { return Err(ElfError::ValueOutOfBounds); } let slice = elf\_bytes .as\_slice() .get(section\_header.file\_range().unwrap\_or\_default()) .ok\_or(ElfError::ValueOutOfBounds)?; ro\_length = ro\_length.max(section\_header.sh\_addr as usize + slice.len()); Ok((section\_header.sh\_addr as usize, slice)) }) .collect::<Result<Vec<\_>, ElfError>>()?; let mut ro\_section = vec![0; ro\_length]; ro\_section[text\_section.sh\_addr as usize ..text\_section.sh\_addr as usize + text\_section\_info.offset\_range.len()] .copy\_from\_slice( elf\_bytes .as\_slice() .get(text\_section\_info.offset\_range.clone()) .ok\_or(ElfError::ValueOutOfBounds)?, ); for (offset, slice) in ro\_slices.iter() { ro\_section[\*offset..\*offset + slice.len()].copy\_from\_slice(slice); }
 Ok(Self { config, elf\_bytes, ro\_section, text\_section\_info, bpf\_functions, syscall\_symbols, syscall\_registry, compiled\_program: None, }) }
 // Functions exposed for tests
 /// Fix-ups relative calls pub fn fixup\_relative\_calls( enable\_symbol\_and\_section\_labels: bool, bpf\_functions: &mut BTreeMap<u32, (usize, String)>, elf\_bytes: &mut [u8], ) -> Result<(), ElfError> { for i in 0..elf\_bytes.len() / ebpf::INSN\_SIZE { let mut insn = ebpf::get\_insn(elf\_bytes, i); if insn.opc == ebpf::CALL\_IMM && insn.imm != -1 { let target\_pc = i as isize + 1 + insn.imm as isize; if target\_pc < 0 || target\_pc >= (elf\_bytes.len() / ebpf::INSN\_SIZE) as isize { return Err(ElfError::RelativeJumpOutOfBounds( i + ebpf::ELF\_INSN\_DUMP\_OFFSET, )); } let name = format!("function\_{}", target\_pc); let hash = register\_bpf\_function( bpf\_functions, target\_pc as usize, &name, enable\_symbol\_and\_section\_labels, )?; insn.imm = hash as i64; let checked\_slice = elf\_bytes .get\_mut(i \* ebpf::INSN\_SIZE..(i \* ebpf::INSN\_SIZE) + ebpf::INSN\_SIZE) .ok\_or(ElfError::ValueOutOfBounds)?; checked\_slice.copy\_from\_slice(&insn.to\_vec()); } } Ok(()) }
 /// Validates the ELF pub fn validate(elf: &Elf, elf\_bytes: &[u8]) -> Result<(), ElfError> { if elf.header.e\_ident[EI\_CLASS] != ELFCLASS64 { return Err(ElfError::WrongClass); } if elf.header.e\_ident[EI\_DATA] != ELFDATA2LSB { return Err(ElfError::WrongEndianess); } if elf.header.e\_ident[EI\_OSABI] != ELFOSABI\_NONE { return Err(ElfError::WrongAbi); } if elf.header.e\_machine != EM\_BPF { return Err(ElfError::WrongMachine); } if elf.header.e\_type != ET\_DYN { return Err(ElfError::WrongType); }
 let num\_text\_sections = elf.section\_headers.iter().fold(0, |count, section\_header| { if let Some(this\_name) = elf.shdr\_strtab.get\_at(section\_header.sh\_name) { if this\_name == ".text" { return count + 1; } } count }); if 1 != num\_text\_sections { return Err(ElfError::NotOneTextSection); }
 for section\_header in elf.section\_headers.iter() { if let Some(this\_name) = elf.shdr\_strtab.get\_at(section\_header.sh\_name) { if this\_name.starts\_with(".bss") { return Err(ElfError::BssNotSupported); } } }
 for section\_header in &elf.section\_headers { let start = section\_header.sh\_offset as usize; let end = section\_header .sh\_offset .checked\_add(section\_header.sh\_size) .ok\_or(ElfError::ValueOutOfBounds)? as usize; let \_ = elf\_bytes .get(start..end) .ok\_or(ElfError::ValueOutOfBounds)?; } let text\_section = Self::get\_section(elf, ".text")?; if !text\_section .vm\_range() .contains(&(elf.header.e\_entry as usize)) { return Err(ElfError::EntrypointOutOfBounds); }
 Ok(()) }
 // Private functions
 /// Get a section by name fn get\_section(elf: &Elf, name: &str) -> Result<SectionHeader, ElfError> { match elf.section\_headers.iter().find(|section\_header| { if let Some(this\_name) = elf.shdr\_strtab.get\_at(section\_header.sh\_name) { return this\_name == name; } false }) { Some(section) => Ok(section.clone()), None => Err(ElfError::SectionNotFound(name.to\_string())), } }
 /// Relocates the ELF in-place fn relocate( config: &Config, bpf\_functions: &mut BTreeMap<u32, (usize, String)>, syscall\_symbols: &mut BTreeMap<u32, String>, syscall\_registry: &mut SyscallRegistry, elf: &Elf, elf\_bytes: &mut [u8], ) -> Result<(), ElfError> { let text\_section = Self::get\_section(elf, ".text")?;
 // Fixup all program counter relative call instructions Self::fixup\_relative\_calls( config.enable\_symbol\_and\_section\_labels, bpf\_functions, elf\_bytes .get\_mut(text\_section.file\_range().unwrap\_or\_default()) .ok\_or(ElfError::ValueOutOfBounds)?, )?;
 let mut syscall\_cache = BTreeMap::new(); let text\_section = Self::get\_section(elf, ".text")?;
 // Fixup all the relocations in the relocation section if exists for relocation in &elf.dynrels { let r\_offset = relocation.r\_offset as usize;
 // Offset of the immediate field let imm\_offset = r\_offset.saturating\_add(BYTE\_OFFSET\_IMMEDIATE); match BpfRelocationType::from\_x86\_relocation\_type(relocation.r\_type) { Some(BpfRelocationType::R\_Bpf\_64\_64) => { // Read the instruction's immediate field which contains virtual // address to convert to physical let checked\_slice = elf\_bytes .get(imm\_offset..imm\_offset.saturating\_add(BYTE\_LENGTH\_IMMEIDATE)) .ok\_or(ElfError::ValueOutOfBounds)?; let refd\_va = LittleEndian::read\_u32(checked\_slice) as u64; // final "physical address" from the VM's perspetive is rooted at `MM\_PROGRAM\_START` let refd\_pa = ebpf::MM\_PROGRAM\_START.saturating\_add(refd\_va);
 // The .text section has an unresolved load symbol instruction. let sym = elf .dynsyms .get(relocation.r\_sym) .ok\_or(ElfError::UnknownSymbol(relocation.r\_sym))?; let addr = (sym.st\_value + refd\_pa) as u64; let checked\_slice = elf\_bytes .get\_mut(imm\_offset..imm\_offset.saturating\_add(BYTE\_LENGTH\_IMMEIDATE)) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u32(checked\_slice, (addr & 0xFFFFFFFF) as u32); let checked\_slice = elf\_bytes .get\_mut( imm\_offset.saturating\_add(ebpf::INSN\_SIZE) ..imm\_offset .saturating\_add(ebpf::INSN\_SIZE + BYTE\_LENGTH\_IMMEIDATE), ) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u32(checked\_slice, (addr >> 32) as u32); } Some(BpfRelocationType::R\_Bpf\_64\_Relative) => { // Raw relocation between sections. The instruction being relocated contains // the virtual address that it needs turned into a physical address. Read it, // locate it in the ELF, convert to physical address
 // Read the instruction's immediate field which contains virtual // address to convert to physical let checked\_slice = elf\_bytes .get(imm\_offset..imm\_offset.saturating\_add(BYTE\_LENGTH\_IMMEIDATE)) .ok\_or(ElfError::ValueOutOfBounds)?; let refd\_va = LittleEndian::read\_u32(checked\_slice) as u64;
 if refd\_va == 0 { return Err(ElfError::InvalidVirtualAddress(refd\_va)); }
 // final "physical address" from the VM's perspetive is rooted at `MM\_PROGRAM\_START` let refd\_pa = ebpf::MM\_PROGRAM\_START.saturating\_add(refd\_va);
 // Write the physical address back into the target location if text\_section .file\_range() .unwrap\_or\_default() .contains(&r\_offset) { // Instruction lddw spans two instruction slots, split the // physical address into a high and low and write into both slot's imm field
 let checked\_slice = elf\_bytes .get\_mut(imm\_offset..imm\_offset.saturating\_add(BYTE\_LENGTH\_IMMEIDATE)) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u32(checked\_slice, (refd\_pa & 0xFFFFFFFF) as u32); let checked\_slice = elf\_bytes .get\_mut( imm\_offset.saturating\_add(ebpf::INSN\_SIZE) ..imm\_offset .saturating\_add(ebpf::INSN\_SIZE + BYTE\_LENGTH\_IMMEIDATE), ) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u32(checked\_slice, (refd\_pa >> 32) as u32); } else { // 64 bit memory location, write entire 64 bit physical address directly let checked\_slice = elf\_bytes .get\_mut(r\_offset..r\_offset.saturating\_add(mem::size\_of::<u64>())) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u64(checked\_slice, refd\_pa); } } Some(BpfRelocationType::R\_Bpf\_64\_32) => { // The .text section has an unresolved call to symbol instruction // Hash the symbol name and stick it into the call instruction's imm // field. Later that hash will be used to look up the function location.
 let sym = elf .dynsyms .get(relocation.r\_sym) .ok\_or(ElfError::UnknownSymbol(relocation.r\_sym))?; let name = elf .dynstrtab .get\_at(sym.st\_name) .ok\_or(ElfError::UnknownSymbol(sym.st\_name))?; let hash = if sym.is\_function() && sym.st\_value != 0 { // bpf call if !text\_section.vm\_range().contains(&(sym.st\_value as usize)) { return Err(ElfError::ValueOutOfBounds); } let target\_pc = (sym.st\_value - text\_section.sh\_addr) as usize / ebpf::INSN\_SIZE; register\_bpf\_function( bpf\_functions, target\_pc, name, config.enable\_symbol\_and\_section\_labels, )? } else { // syscall let hash = syscall\_cache .entry(sym.st\_name) .or\_insert\_with(|| (ebpf::hash\_symbol\_name(name.as\_bytes()), name)) .0; if config.reject\_unresolved\_syscalls && syscall\_registry.lookup\_syscall(hash).is\_none() { return Err(ElfError::UnresolvedSymbol( name.to\_string(), r\_offset / ebpf::INSN\_SIZE + ebpf::ELF\_INSN\_DUMP\_OFFSET, r\_offset, )); } hash }; let checked\_slice = elf\_bytes .get\_mut(imm\_offset..imm\_offset.saturating\_add(BYTE\_LENGTH\_IMMEIDATE)) .ok\_or(ElfError::ValueOutOfBounds)?; LittleEndian::write\_u32(checked\_slice, hash); } \_ => return Err(ElfError::UnknownRelocation(relocation.r\_type)), } }
 if config.enable\_symbol\_and\_section\_labels { // Save syscall names \*syscall\_symbols = syscall\_cache .values() .map(|(hash, name)| (\*hash, name.to\_string())) .collect();
 // Register all known function names from the symbol table for symbol in &elf.syms { if symbol.st\_info & 0xEF != 0x02 { continue; } if !text\_section .vm\_range() .contains(&(symbol.st\_value as usize)) { return Err(ElfError::ValueOutOfBounds); } let target\_pc = (symbol.st\_value - text\_section.sh\_addr) as usize / ebpf::INSN\_SIZE; let name = elf .strtab .get\_at(symbol.st\_name) .ok\_or(ElfError::UnknownSymbol(symbol.st\_name))?; register\_bpf\_function(bpf\_functions, target\_pc, name, true)?; } }
 Ok(()) }
 #[allow(dead\_code)] fn dump\_data(name: &str, prog: &[u8]) { let mut eight\_bytes: Vec<u8> = Vec::new(); println!("{}", name); for i in prog.iter() { if eight\_bytes.len() >= 7 { println!("{:02X?}", eight\_bytes); eight\_bytes.clear(); } else { eight\_bytes.push(\*i); } } }}
#[cfg(test)]mod test { use super::\*; use crate::{ ebpf, elf::scroll::Pwrite, fuzz::fuzz, syscalls::{BpfSyscallString, BpfSyscallU64}, user\_error::UserError, vm::{SyscallObject, TestInstructionMeter}, }; use rand::{distributions::Uniform, Rng}; use std::{fs::File, io::Read}; type ElfExecutable = Executable<UserError, TestInstructionMeter>;
 fn syscall\_registry() -> SyscallRegistry { let mut syscall\_registry = SyscallRegistry::default(); syscall\_registry .register\_syscall\_by\_name(b"log", BpfSyscallString::call) .unwrap(); syscall\_registry .register\_syscall\_by\_name(b"log\_64", BpfSyscallU64::call) .unwrap(); syscall\_registry }
 #[test] fn test\_validate() { let mut file = File::open("tests/elfs/noop.so").expect("file open failed"); let mut bytes = Vec::new(); file.read\_to\_end(&mut bytes) .expect("failed to read elf file"); let mut parsed\_elf = Elf::parse(&bytes).unwrap(); let elf\_bytes = bytes.to\_vec();
 ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); parsed\_elf.header.e\_ident[EI\_CLASS] = ELFCLASS32; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect\_err("allowed bad class"); parsed\_elf.header.e\_ident[EI\_CLASS] = ELFCLASS64; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); parsed\_elf.header.e\_ident[EI\_DATA] = ELFDATA2MSB; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect\_err("allowed big endian"); parsed\_elf.header.e\_ident[EI\_DATA] = ELFDATA2LSB; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); parsed\_elf.header.e\_ident[EI\_OSABI] = 1; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect\_err("allowed wrong abi"); parsed\_elf.header.e\_ident[EI\_OSABI] = ELFOSABI\_NONE; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); parsed\_elf.header.e\_machine = EM\_QDSP6; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect\_err("allowed wrong machine"); parsed\_elf.header.e\_machine = EM\_BPF; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); parsed\_elf.header.e\_type = ET\_REL; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect\_err("allowed wrong type"); parsed\_elf.header.e\_type = ET\_DYN; ElfExecutable::validate(&parsed\_elf, &elf\_bytes).expect("validation failed"); }
 #[test] fn test\_load() { let mut file = File::open("tests/elfs/noop.so").expect("file open failed"); let mut elf\_bytes = Vec::new(); file.read\_to\_end(&mut elf\_bytes) .expect("failed to read elf file"); ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) .expect("validation failed"); }
 #[test] fn test\_entrypoint() { let mut file = File::open("tests/elfs/noop.so").expect("file open failed"); let mut elf\_bytes = Vec::new(); file.read\_to\_end(&mut elf\_bytes) .expect("failed to read elf file"); let elf = ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) .expect("validation failed"); let mut parsed\_elf = Elf::parse(&elf\_bytes).unwrap(); let initial\_e\_entry = parsed\_elf.header.e\_entry; let executable: &Executable<UserError, TestInstructionMeter> = &elf; assert\_eq!( 0, executable .get\_entrypoint\_instruction\_offset() .expect("failed to get entrypoint") );
 parsed\_elf.header.e\_entry += 8; let mut elf\_bytes = elf\_bytes.clone(); elf\_bytes.pwrite(parsed\_elf.header, 0).unwrap(); let elf = ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) .expect("validation failed"); let executable: &Executable<UserError, TestInstructionMeter> = &elf; assert\_eq!( 1, executable .get\_entrypoint\_instruction\_offset() .expect("failed to get entrypoint") );
 parsed\_elf.header.e\_entry = 1; let mut elf\_bytes = elf\_bytes; elf\_bytes.pwrite(parsed\_elf.header, 0).unwrap(); assert\_eq!( Err(ElfError::EntrypointOutOfBounds), ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) );
 parsed\_elf.header.e\_entry = std::u64::MAX; let mut elf\_bytes = elf\_bytes; elf\_bytes.pwrite(parsed\_elf.header, 0).unwrap(); assert\_eq!( Err(ElfError::EntrypointOutOfBounds), ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) );
 parsed\_elf.header.e\_entry = initial\_e\_entry + ebpf::INSN\_SIZE as u64 + 1; let mut elf\_bytes = elf\_bytes; elf\_bytes.pwrite(parsed\_elf.header, 0).unwrap(); assert\_eq!( Err(ElfError::InvalidEntrypoint), ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) );
 parsed\_elf.header.e\_entry = initial\_e\_entry; let mut elf\_bytes = elf\_bytes; elf\_bytes.pwrite(parsed\_elf.header, 0).unwrap(); let elf = ElfExecutable::load(Config::default(), &elf\_bytes, syscall\_registry()) .expect("validation failed"); let executable: &Executable<UserError, TestInstructionMeter> = &elf; assert\_eq!( 0, executable .get\_entrypoint\_instruction\_offset() .expect("failed to get entrypoint") ); }
 #[test] fn test\_fixup\_relative\_calls\_back() { // call -2 let mut bpf\_functions: BTreeMap<u32, (usize, String)> = BTreeMap::new(); #[rustfmt::skip] let mut prog = vec![ 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x85, 0x10, 0x00, 0x00, 0xfe, 0xff, 0xff, 0xff];
 ElfExecutable::fixup\_relative\_calls(true, &mut bpf\_functions, &mut prog).unwrap(); let name = "function\_4".to\_string(); let hash = hash\_bpf\_function(4, &name); let insn = ebpf::Insn { opc: 0x85, dst: 0, src: 1, imm: hash as i64, ..ebpf::Insn::default() }; assert\_eq!(insn.to\_array(), prog[40..]); assert\_eq!(\*bpf\_functions.get(&hash).unwrap(), (4, name));
 // call +6 let mut bpf\_functions: BTreeMap<u32, (usize, String)> = BTreeMap::new(); prog.splice(44.., vec![0xfa, 0xff, 0xff, 0xff]); ElfExecutable::fixup\_relative\_calls(true, &mut bpf\_functions, &mut prog).unwrap(); let name = "function\_0".to\_string(); let hash = hash\_bpf\_function(0, &name); let insn = ebpf::Insn { opc: 0x85, dst: 0, src: 1, imm: hash as i64, ..ebpf::Insn::default() }; assert\_eq!(insn.to\_array(), prog[40..]); assert\_eq!(\*bpf\_functions.get(&hash).unwrap(), (0, name)); }
 #[test] fn test\_fixup\_relative\_calls\_forward() { // call +0 let mut bpf\_functions: BTreeMap<u32, (usize, String)> = BTreeMap::new(); #[rustfmt::skip] let mut prog = vec![ 0x85, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb7, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
 ElfExecutable::fixup\_relative\_calls(true, &mut bpf\_functions, &mut prog).unwrap(); let name = "function\_1".to\_string(); let hash = hash\_bpf\_function(1, &name); let insn = ebpf::Insn { opc: 0x85, dst: 0, src: 1, imm: hash as i64, ..ebpf::Insn::default() }; assert\_eq!(insn.to\_array(), prog[..8]); assert\_eq!(\*bpf\_functions.get(&hash).unwrap(), (1, name));
 // call +4 let mut bpf\_functions: BTreeMap<u32, (usize, String)> = BTreeMap::new(); prog.splice(4..8, vec![0x04, 0x00, 0x00, 0x00]); ElfExecutable::fixup\_relative\_calls(true, &mut bpf\_functions, &mut prog).unwrap(); let name = "function\_5".to\_string(); let hash = hash\_bpf\_function(5, &name);[View remainder of file in raw view](https://github.com/solana-labs/rbpf/raw/c14764850f0b83b58aa013248eaf6d65836c1218/src/elf.rs)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2f051c66_20250114_201306.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F236)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F236)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=solana-labs%2Frbpf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 10, 2025. It is now read-only.

[solana-labs](/solana-labs)
/
**[rbpf](/solana-labs/rbpf)**
Public archive

forked from [qmonnet/rbpf](/qmonnet/rbpf)

* [Notifications](/login?return_to=%2Fsolana-labs%2Frbpf) You must be signed in to change notification settings
* [Fork
  177](/login?return_to=%2Fsolana-labs%2Frbpf)
* [Star
   302](/login?return_to=%2Fsolana-labs%2Frbpf)

* [Code](/solana-labs/rbpf)
* [Issues
  0](/solana-labs/rbpf/issues)
* [Pull requests
  0](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects
  0](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

Additional navigation options

* [Code](/solana-labs/rbpf)
* [Issues](/solana-labs/rbpf/issues)
* [Pull requests](/solana-labs/rbpf/pulls)
* [Actions](/solana-labs/rbpf/actions)
* [Projects](/solana-labs/rbpf/projects)
* [Security](/solana-labs/rbpf/security)
* [Insights](/solana-labs/rbpf/pulse)

# Fix: Unchecked integer arithmetic in elf.rs #236

 Merged

[Lichtso](/Lichtso)
merged 2 commits into
[main](/solana-labs/rbpf/tree/main "solana-labs/rbpf:main")
from
[fix/integer\_arithmetic\_in\_elf\_rs](/solana-labs/rbpf/tree/fix/integer_arithmetic_in_elf_rs "solana-labs/rbpf:fix/integer_arithmetic_in_elf_rs")

Dec 7, 2021

 Merged

# [Fix: Unchecked integer arithmetic in elf.rs](#top) #236

[Lichtso](/Lichtso)
merged 2 commits into
[main](/solana-labs/rbpf/tree/main "solana-labs/rbpf:main")
from
[fix/integer\_arithmetic\_in\_elf\_rs](/solana-labs/rbpf/tree/fix/integer_arithmetic_in_elf_rs "solana-labs/rbpf:fix/integer_arithmetic_in_elf_rs")

Dec 7, 2021

[Conversation
0](/solana-labs/rbpf/pull/236)
[Commits
2](/solana-labs/rbpf/pull/236/commits)
[Checks
0](/solana-labs/rbpf/pull/236/checks)
[Files changed](/solana-labs/rbpf/pull/236/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![Lichtso](https://avatars.githubusercontent.com/u/309583?s=60&v=4)](/Lichtso)

Copy link

### @Lichtso **[Lichtso](/Lichtso)** commented [Dec 6, 2021](#issue-1072161925)

 *No description provided.*

Sorry, something went wrong.

All reactions

 [Lichtso](/Lichtso)
added 2 commits
[December 6, 2021 14:22](#commits-pushed-c13df26)

[![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&v=4)](/Lichtso)

`[Guards all integer_arithmetic in elf.rs](/solana-labs/rbpf/pull/236/commits/c13df26bf356b8c33c390b310f22227a7fd654d7 "Guards all integer_arithmetic in elf.rs")`

`[c13df26](/solana-labs/rbpf/pull/236/commits/c13df26bf356b8c33c390b310f22227a7fd654d7)`

[![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&v=4)](/Lichtso)

`[Spelling](/solana-labs/rbpf/pull/236/commits/36fcb387f10c571f7e5b88befa87f1bd61b6291c "Spelling")`

`[36fcb38](/solana-labs/rbpf/pull/236/commits/36fcb387f10c571f7e5b88befa87f1bd61b6291c)`

 [![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&u=a4faa4e23f6e2d13868f3e0dc91e22f9c81c9248&v=4)](/Lichtso)
[Lichtso](/Lichtso)
requested review from
[dmakarov](/dmakarov) and
[jackcmay](/jackcmay)
[December 6, 2021 13:36](#event-5720635213)

[![jackcmay](https://avatars.githubusercontent.com/u/40156282?s=60&v=4)](/jackcmay)

**[jackcmay](/jackcmay)**
approved these changes
[Dec 7, 2021](#pullrequestreview-824643681)

 [View reviewed changes](/solana-labs/rbpf/pull/236/files/36fcb387f10c571f7e5b88befa87f1bd61b6291c)

[![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&u=a4faa4e23f6e2d13868f3e0dc91e22f9c81c9248&v=4)](/Lichtso)
[Lichtso](/Lichtso)
merged commit [`849c7c2`](/solana-labs/rbpf/commit/849c7c21d20628d1c76204fe33363bd6ca58c80b)
into
main

[Dec 7, 2021](https://github.com/solana-labs/rbpf/pull/236#event-5725735462)

 [![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=40&u=a4faa4e23f6e2d13868f3e0dc91e22f9c81c9248&v=4)](/Lichtso)
[Lichtso](/Lichtso)
deleted the
fix/integer\_arithmetic\_in\_elf\_rs

branch
[December 7, 2021 08:28](#event-5725735737)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsolana-labs%2Frbpf%2Fpull%2F236).

Reviewers

[![@jackcmay](https://avatars.githubusercontent.com/u/40156282?s=40&v=4)](/jackcmay) [jackcmay](/jackcmay)

jackcmay approved these changes

[![@dmakarov](https://avatars.githubusercontent.com/u/103494?s=40&v=4)](/dmakarov) [dmakarov](/dmakarov)

 Awaiting requested review from dmakarov

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@Lichtso](https://avatars.githubusercontent.com/u/309583?s=52&v=4)](/Lichtso) [![@jackcmay](https://avatars.githubusercontent.com/u/40156282?s=52&v=4)](/jackcmay)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


