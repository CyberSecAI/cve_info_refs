=== Content from github.com_f7c14044_20250114_192944.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsixel%2Flibsixel%2Fissues%2F25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsixel%2Flibsixel%2Fissues%2F25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libsixel%2Flibsixel)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libsixel](/libsixel)
/
**[libsixel](/libsixel/libsixel)**
Public

forked from [saitoha/libsixel](/saitoha/libsixel)

* [Notifications](/login?return_to=%2Flibsixel%2Flibsixel) You must be signed in to change notification settings
* [Fork
  14](/login?return_to=%2Flibsixel%2Flibsixel)
* [Star
   122](/login?return_to=%2Flibsixel%2Flibsixel)

* [Code](/libsixel/libsixel)
* [Issues
  23](/libsixel/libsixel/issues)
* [Pull requests
  4](/libsixel/libsixel/pulls)
* [Discussions](/libsixel/libsixel/discussions)
* [Actions](/libsixel/libsixel/actions)
* [Projects
  0](/libsixel/libsixel/projects)
* [Security](/libsixel/libsixel/security)
* [Insights](/libsixel/libsixel/pulse)

Additional navigation options

* [Code](/libsixel/libsixel)
* [Issues](/libsixel/libsixel/issues)
* [Pull requests](/libsixel/libsixel/pulls)
* [Discussions](/libsixel/libsixel/discussions)
* [Actions](/libsixel/libsixel/actions)
* [Projects](/libsixel/libsixel/projects)
* [Security](/libsixel/libsixel/security)
* [Insights](/libsixel/libsixel/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibsixel%2Flibsixel%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibsixel%2Flibsixel%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# heap-buffer-overflow in libsixel/src/quant.c:867 #25

Closed

[a4865g](/a4865g) opened this issue
Sep 3, 2021
¬∑ 6 comments
 ¬∑ Fixed by [#26](https://github.com/libsixel/libsixel/pull/26)

Closed

# [heap-buffer-overflow in libsixel/src/quant.c:867](#top) #25

[a4865g](/a4865g) opened this issue
Sep 3, 2021
¬∑ 6 comments
 ¬∑ Fixed by [#26](https://github.com/libsixel/libsixel/pull/26)

Assignees
[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen)

Labels
[bug](/libsixel/libsixel/labels/bug)
Something isn't working

## Comments

[![@a4865g](https://avatars.githubusercontent.com/u/43570004?s=80&u=2d06a9cbbf6d51d530635c4ae70f7ea771cbc405&v=4)](/a4865g)

Copy link

### **[a4865g](/a4865g)** commented [Sep 3, 2021](#issue-987363395)

| Hi,I found a heap-buffer-overflow in the current master [705d991](https://github.com/libsixel/libsixel/commit/705d9919889a3eb30d1b99ffdedb679b6979b375) It sames with the [saitoha/libsixel/issue#156](https://github.com/saitoha/libsixel/issues/156#issue-985027447) (I found this problem 2 days ago)  OS: Ubuntu 20.04.3 LTS x86\_64 Kernel: 5.11.0-27-generic  POC: [poc.zip](https://github.com/libsixel/libsixel/files/7103098/poc.zip)  It's the command line's report:  ``` $ ./img2sixel -o ./a.sixel -7 -p 1 -C 5 -d stucki -E size poc double free or corruption (out) Aborted   ```  and here is the ASAN report for [saitoha/libsixel](https://github.com/saitoha/libsixel) (the current master [[6a5be8b](https://github.com/libsixel/libsixel/commit/6a5be8b72d84037b83a5ea838e17bcf372ab1d5f)]):  ``` $ ./img2sixel -o ./a.sixel -7 -p 1 -C 5 -d stucki -E size ~/Downloads/poc ================================================================= ==2216856==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62e00000c3fd at pc 0x7ffff74e5a7e bp 0x7fffffffc340 sp 0x7fffffffc330 READ of size 1 at 0x62e00000c3fd thread T0     #0 0x7ffff74e5a7d in error_diffuse /home/wulearn/Desktop/testtt/libsixel/src/quant.c:876     #1 0x7ffff74e6027 in diffuse_stucki /home/wulearn/Desktop/testtt/libsixel/src/quant.c:1002     #2 0x7ffff74e8154 in sixel_quant_apply_palette /home/wulearn/Desktop/testtt/libsixel/src/quant.c:1417     #3 0x7ffff74eab2b in sixel_dither_apply_palette /home/wulearn/Desktop/testtt/libsixel/src/dither.c:801     #4 0x7ffff74d9d9c in sixel_encode_dither /home/wulearn/Desktop/testtt/libsixel/src/tosixel.c:830     #5 0x7ffff74e1c75 in sixel_encode /home/wulearn/Desktop/testtt/libsixel/src/tosixel.c:1551     #6 0x7ffff7535f3b in sixel_encoder_output_without_macro /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:825     #7 0x7ffff75371e2 in sixel_encoder_encode_frame /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1056     #8 0x7ffff753b0af in load_image_callback /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1679     #9 0x7ffff752b085 in load_with_builtin /home/wulearn/Desktop/testtt/libsixel/src/loader.c:963     #10 0x7ffff752b5cb in sixel_helper_load_image_file /home/wulearn/Desktop/testtt/libsixel/src/loader.c:1418     #11 0x7ffff753b513 in sixel_encoder_encode /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1743     #12 0x555555558a3b in main /home/wulearn/Desktop/testtt/libsixel/converters/img2sixel.c:457     #13 0x7ffff72c60b2 in __libc_start_main (/usr/lib/x86_64-linux-gnu/libc.so.6+0x270b2)     #14 0x55555555638d in _start (/home/wulearn/Desktop/testtt/libsixel/converters/.libs/img2sixel+0x238d)  0x62e00000c3fd is located 3 bytes to the left of 47208-byte region [0x62e00000c400,0x62e000017c68) allocated by thread T0 here:     #0 0x7ffff76a2bc8 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.5+0x10dbc8)     #1 0x555555558c4e in rpl_malloc /home/wulearn/Desktop/testtt/libsixel/converters/malloc_stub.c:45     #2 0x7ffff7549243 in sixel_allocator_malloc /home/wulearn/Desktop/testtt/libsixel/src/allocator.c:162     #3 0x7ffff7535cab in sixel_encoder_output_without_macro /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:789     #4 0x7ffff75371e2 in sixel_encoder_encode_frame /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1056     #5 0x7ffff753b0af in load_image_callback /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1679     #6 0x7ffff752b085 in load_with_builtin /home/wulearn/Desktop/testtt/libsixel/src/loader.c:963     #7 0x7ffff752b5cb in sixel_helper_load_image_file /home/wulearn/Desktop/testtt/libsixel/src/loader.c:1418     #8 0x7ffff753b513 in sixel_encoder_encode /home/wulearn/Desktop/testtt/libsixel/src/encoder.c:1743     #9 0x555555558a3b in main /home/wulearn/Desktop/testtt/libsixel/converters/img2sixel.c:457     #10 0x7ffff72c60b2 in __libc_start_main (/usr/lib/x86_64-linux-gnu/libc.so.6+0x270b2)  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/wulearn/Desktop/testtt/libsixel/src/quant.c:876 in error_diffuse Shadow bytes around the buggy address:   0x0c5c7fff9820: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9830: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9840: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9850: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9860: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x0c5c7fff9870: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa]   0x0c5c7fff9880: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff9890: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff98a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff98b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff98c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2216856==ABORTING   ```  It happens on: <https://github.com/saitoha/libsixel/blob/6a5be8b72d84037b83a5ea838e17bcf372ab1d5f/src/quant.c#L1002>  same with:   [libsixel/src/quant.c](https://github.com/libsixel/libsixel/blob/705d9919889a3eb30d1b99ffdedb679b6979b375/src/quant.c#L993)  Line 993 in [705d991](/libsixel/libsixel/commit/705d9919889a3eb30d1b99ffdedb679b6979b375)   |  | error\_diffuse(data, pos + width \* 1 - 2, depth, error, 1, 24); | | --- | --- |      when x=0, y=0, width=1,then  gdb info: [image](https://user-images.githubusercontent.com/43570004/131661031-3f3ff180-cf8f-409b-a54b-df4b885f4d2c.png)  In this position,[r13+rcx\*1+0x0] will be `0x100000000000f7e6d` =>`0xf7e6d` So,writing to data will cause `overflow` and then it writes to a location (chunk) in the heap that should not be written to.  heap info: Before:  ``` 0xf5fda0            0x0                 0x60                 Freed                0x0              None 0xf5fe00            0x0                 0x8060               Used                None              None 0xf67e60            0x0                 0x70                 Used                None              None 0xf67ed0            0x0                 0x30                 Used                None              None 0xf67f00            0x0                 0x10010              Used                None              None 0xf77f10            0x0                 0x7eb0               Freed     0x7ffff7c9cbe0    0x7ffff7c9cbe0 0xf7fdc0            0x7eb0              0xd0                 Freed                0x0              None   ```  After:  ``` 0xf5fda0            0x0                 0x60                 Freed                0x0              None 0xf5fe00            0x0                 0x8060               Used                None              None Corrupt ?!  ``` |
| --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=80&v=4)](/dankamongmen)

Copy link

Collaborator

### **[dankamongmen](/dankamongmen)** commented [Sep 3, 2021](#issuecomment-912235020)

| great work! certainly looks valid to me. i'll try to have a fix up by tomorrow morning, but if anyone else wants to offer one in the meantime, i'll evaluate it. well done! =] |
| --- |

 ‚ù§Ô∏è
1
 a4865g reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen)
[dankamongmen](/dankamongmen)
self-assigned this
[Sep 3, 2021](#event-5251146780)

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen)
[dankamongmen](/dankamongmen)
added
the
[bug](/libsixel/libsixel/labels/bug)
Something isn't working
label
[Sep 3, 2021](#event-5251147020)

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=80&v=4)](/dankamongmen)

Copy link

Collaborator

### **[dankamongmen](/dankamongmen)** commented [Sep 3, 2021](#issuecomment-912318850)

| alright, so the fix seems pretty simple -- don't diffuse into the void. |
| --- |

All reactions

Sorry, something went wrong.

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen)
[dankamongmen](/dankamongmen)
mentioned this issue
[Sep 3, 2021](#ref-pullrequest-987496891)

[[error\_diffuse] don't diffuse into the void
#26](/libsixel/libsixel/pull/26)
 Merged

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=80&v=4)](/dankamongmen)

Copy link

Collaborator

### **[dankamongmen](/dankamongmen)** commented [Sep 3, 2021](#issuecomment-912325709)

| I've put up a PR which I'm pretty sure closes this problem. I still see plenty of uses of uninitialized data in a valgrind run, but no longer any invalid accesses. |
| --- |

All reactions

Sorry, something went wrong.

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen)
[dankamongmen](/dankamongmen)
closed this as [completed](/libsixel/libsixel/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#26](/libsixel/libsixel/pull/26)
[Sep 3, 2021](#event-5251835579)

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=80&v=4)](/dankamongmen)

Copy link

Collaborator

### **[dankamongmen](/dankamongmen)** commented [Sep 3, 2021](#issuecomment-912330386)

| Fix pushed in 1.10.0. |
| --- |

 ‚ù§Ô∏è
1
 a4865g reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@a4865g](https://avatars.githubusercontent.com/u/43570004?s=80&u=2d06a9cbbf6d51d530635c4ae70f7ea771cbc405&v=4)](/a4865g)

Copy link

Author

### **[a4865g](/a4865g)** commented [Sep 3, 2021](#issuecomment-912410948)

| Could I try to submit this problem to get CVE ID? |
| --- |

All reactions

Sorry, something went wrong.

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=80&v=4)](/dankamongmen)

Copy link

Collaborator

### **[dankamongmen](/dankamongmen)** commented [Sep 3, 2021](#issuecomment-912442231)

| Could I try to submit this problem to get CVE ID?  you can do whatever you like, though i doubt it's very easy to turn this into an exploit. |
| --- |

 üëç
1
 a4865g reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsixel%2Flibsixel%2Fissues%2F25)

Assignees

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=40&v=4)](/dankamongmen) [dankamongmen](/dankamongmen)

Labels

[bug](/libsixel/libsixel/labels/bug)
Something isn't working

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [[error\_diffuse] don't diffuse into the void](/libsixel/libsixel/pull/26)

2 participants

[![@dankamongmen](https://avatars.githubusercontent.com/u/143473?s=52&v=4)](/dankamongmen) [![@a4865g](https://avatars.githubusercontent.com/u/43570004?s=52&v=4)](/a4865g)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


