```
{
  "CVE-2021-40346": {
    "Description": "An integer overflow exists in HAProxy 2.0 through 2.5 in the htx_add_header() can be exploited to perform an HTTP request smuggling attack, allowing an attacker to bypass all configured http-request HAProxy ACLs and possibly other ACLs.",
    "Root cause of vulnerability": "The vulnerability is caused by a missing length check on the header name in the `htx_add_header()` and `htx_add_trailer()` functions. The header name length is stored in 8 bits, and when a header name exceeds 255 characters, an integer overflow occurs. This overflow allows bits of the header name length to slip into the header value length.",
    "Weaknesses/vulnerabilities present": [
      "Integer Overflow: The lack of input validation on the header name length allows for an integer overflow in the `htx_add_header` function when calculating memory offsets.",
      "HTTP Request Smuggling: By exploiting the integer overflow, an attacker can inject a crafted `Content-Length` header, which leads to a mismatch in how HAProxy and backend servers interpret request boundaries.",
      "ACL Bypass: Due to the ability to inject a `Content-Length` header, the attacker can bypass HTTP request ACLs defined in HAProxy."
    ],
    "Impact of exploitation": "Successful exploitation of this vulnerability leads to HTTP request smuggling. This allows an attacker to:",
    "Attack vectors": [
      "Sending a crafted HTTP request with a long header name (exceeding 255 bytes) and a duplicate content-length header to the HAProxy instance"
    ],
    "Required attacker capabilities/position": [
        "The attacker must be able to send HTTP requests to the HAProxy instance."
    ],
   "Additional Details": [
        "The vulnerability exists because the header name length is not checked in `htx_add_header()` and `htx_add_trailer()`",
        "The injected headers are visible to the HTTP internals and to the config rules, so HAProxy will generally stay synchronized with the server, with the exception of Content-Length header which is deduplicated before indexing.",
        "The integer overflow occurs because the header name length is stored in 8 bits, so the max length is 255. When the length is larger, it will wrap.",
       "A crafted header like `Content-Length0aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa:` with a long name, followed by a legitimate `Content-Length` header allows for smuggling an HTTP request."
      ]
  }
}
```