=== Content from burninatorsec.blogspot.com_c479cd01_20250114_205024.html ===


# [Burninator Sec](https://burninatorsec.blogspot.com/)

This blog is about the educational (and sometimes entertainment) value of simple hacks. For active vulnerabilities, real names are concealed.

## Wednesday, July 28, 2021

### OnyakTech Comments Pro - Broken Encryption and XSS CVE-2021-33484 and CVE-2021-33483

Broken Encryption / User Spoofing (CVE-2021-33484)

<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-33484>

This exploit involves downloading an DotNetNuke module installer for OnyakTech Comments Pro 3.8 and de-compiling it with a tool like JustDecompile. NOTE: it is no longer available for download to my knowledge.

Comments Pro is used for adding comment section functionality to a site.

After decompiling the installer, I find that one of the code files has an intriguing name like "encryption". This has an IV vector hardcoded in it, woo!

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeSUlPlDqMGpkS21XEZ4FVNiNv65DI7V_cIWJ99BMBPqvtdclKtuZfjIEEEsUdSuCF8qD8aJfqyRUMmSssVlFekEIlsDfL1f_kbAmdLE1qENeqJcW9ZA2FdL9otQVdr4ODFrJXZIoYvlw/w466-h198/image004.jpg)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeSUlPlDqMGpkS21XEZ4FVNiNv65DI7V_cIWJ99BMBPqvtdclKtuZfjIEEEsUdSuCF8qD8aJfqyRUMmSssVlFekEIlsDfL1f_kbAmdLE1qENeqJcW9ZA2FdL9otQVdr4ODFrJXZIoYvlw/s666/image004.jpg)

But where is the encryption key? We need both in order to do a nefarious enough POC. Well, luckily the requests made to the "CommentsService.ashx" endpoint involve two values, one of which is a JSON field called "key" and one called "displayname". Both appear to be encrypted:

{

**‘key’:‘jxc+ ... ||’,**

‘atchid’:’2080’,

'userid':'sH8uVoo..|'

‘id’:’212’,

‘commentid’:’212’,

**'displayname':'BhX7vunA8 ... BCNaG8sHo|',**

'comment':'definitely fine don't worry about it',

‘func’:’addcomment’

}

I notice that when I throw junk values into the "displayname" value, it will throw an error like "Encryption: The input is not a valid Base-64 string", which is displayed where my display name should be:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFLQEGBA_kS7WpFbLwuH4HIoplUk0mLqcxCl07UXSjH6PmHav4xP6f3W0H3CPOj3dZ6OtQCwJC7-_TDiQuYeUYSfwiCE0mZAfEStTdeijAaDG0gM1OJv89kv-D4XpEnuiXQBdM-HB6OQw/w575-h167/image001.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFLQEGBA_kS7WpFbLwuH4HIoplUk0mLqcxCl07UXSjH6PmHav4xP6f3W0H3CPOj3dZ6OtQCwJC7-_TDiQuYeUYSfwiCE0mZAfEStTdeijAaDG0gM1OJv89kv-D4XpEnuiXQBdM-HB6OQw/s740/image001.png)

This tells me I may be able to control decryption from the client side. So, if I wanted to decrypt it to see what the value of the key is - and I sure do - then I can make that the new value for "displayname" and, voila, there's the key displayed on the page!

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhr9M99efKwj9lix26uGghu_PLYGiOZhIyn5REAfBUUNfwhIKfXWfjMArng5FKp5pHUEDxMWCAdq2YdWQ4wARnSPGF0BozFxy1LbGCGvLJStIisr4vb1pSN62l0Kg2GLIdm5ytbp7mJgHU/w459-h171/image005.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhr9M99efKwj9lix26uGghu_PLYGiOZhIyn5REAfBUUNfwhIKfXWfjMArng5FKp5pHUEDxMWCAdq2YdWQ4wARnSPGF0BozFxy1LbGCGvLJStIisr4vb1pSN62l0Kg2GLIdm5ytbp7mJgHU/s747/image005.png)

Now that I have the IV, the key, and even the functions in the source code that show how the encryption and decryption is done, let's use it to do something we're not supposed to do. The goal : to spoof users. Even though the application required a login for most areas, this module seemed to ignore it, so I was able to add (spoofed) comments or add/delete my own or others' comments without authentication. By combining these issues with an unrelated user enumeration issue in DotNetNuke, I can encrypt any user's name and their user ID in the request to spoof a given user. It will even pull in their actual profile image (based on their user ID), so it will look legit.

I recently went to get beer with my local DEFCON group *(in person - vax for hax!)* When I described this out loud, I realized I was having a hard time thinking of a remediation for this type of attack in general. After all, "where to hide the encryption iv/ keys?" is an old problem. But the reverse engineer I was talking to mentioned that the Windows API has it's own encryption that an app could use. I really liked the idea, because it moves control to a deeper layer, to the OS instead of the app. In this particular case, I didn't compromise the server, so the trick of de-compiling would, theoretically, have been foiled by a move like that.

Stored XSS (CVE-2021-33483)

<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-33483>

In the request to the "add comment" endpoint described above, drop in a double {{ to escape the JSON for your XSS payload. When another user visits the page containing the comment with the payload, it will execute.

i.e.

{

‘key’:‘jxc+ ... ||’,

‘atchid’:’2080’,

'userid':'sH8uVoo..|'

‘id’:’212’,

‘commentid’:’212’,

'displayname':'BhX7vunA8 ... BCNaG8sHo|',

'comment': **'{{ <sCript>prompt(800)</sCript>',**

‘func’:’addcomment’

}

Posted by
burninator

at

[8:43 PM](https://burninatorsec.blogspot.com/2021/07/onyaktech-comments-pro-broken.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=5709475200071837744&postID=7289482993078666989&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7289482993078666989&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7289482993078666989&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7289482993078666989&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7289482993078666989&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7289482993078666989&target=pinterest "Share to Pinterest")

Labels:
[application logic](https://burninatorsec.blogspot.com/search/label/application%20logic),
[attack chaining](https://burninatorsec.blogspot.com/search/label/attack%20chaining),
[broken access control](https://burninatorsec.blogspot.com/search/label/broken%20access%20control),
[CVE](https://burninatorsec.blogspot.com/search/label/CVE),
[decompiler](https://burninatorsec.blogspot.com/search/label/decompiler),
[encryption](https://burninatorsec.blogspot.com/search/label/encryption),
[trial](https://burninatorsec.blogspot.com/search/label/trial),
[XSS](https://burninatorsec.blogspot.com/search/label/XSS)

#### No comments:

#### Post a Comment

[Newer Post](https://burninatorsec.blogspot.com/2022/01/post-exploitation-pii-search-across-all.html "Newer Post")

[Older Post](https://burninatorsec.blogspot.com/2021/06/sql-injection-manual-data-exfiltration.html "Older Post")

[Home](https://burninatorsec.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://burninatorsec.blogspot.com/feeds/7289482993078666989/comments/default)

## Twitter

@burninatorsec

## Disclaimer

Information in this blog is for educational purposes only. I am not liable for damages or illegal activity caused directly or indirectly based on the information shared here.

## Archive

* ►
  [2024](https://burninatorsec.blogspot.com/2024/)
  (1)
  + ►
    [November](https://burninatorsec.blogspot.com/2024/11/)
    (1)

* ►
  [2022](https://burninatorsec.blogspot.com/2022/)
  (6)
  + ►
    [December](https://burninatorsec.blogspot.com/2022/12/)
    (1)
  + ►
    [November](https://burninatorsec.blogspot.com/2022/11/)
    (2)
  + ►
    [July](https://burninatorsec.blogspot.com/2022/07/)
    (1)
  + ►
    [April](https://burninatorsec.blogspot.com/2022/04/)
    (1)
  + ►
    [January](https://burninatorsec.blogspot.com/2022/01/)
    (1)

* ▼
  [2021](https://burninatorsec.blogspot.com/2021/)
  (8)
  + ▼
    [July](https://burninatorsec.blogspot.com/2021/07/)
    (1)
    - [OnyakTech Comments Pro - Broken Encryption and XSS...](https://burninatorsec.blogspot.com/2021/07/onyaktech-comments-pro-broken.html)
  + ►
    [June](https://burninatorsec.blogspot.com/2021/06/)
    (1)
  + ►
    [April](https://burninatorsec.blogspot.com/2021/04/)
    (6)

* ►
  [2020](https://burninatorsec.blogspot.com/2020/)
  (7)
  + ►
    [November](https://burninatorsec.blogspot.com/2020/11/)
    (1)
  + ►
    [October](https://burninatorsec.blogspot.com/2020/10/)
    (2)
  + ►
    [September](https://burninatorsec.blogspot.com/2020/09/)
    (1)
  + ►
    [August](https://burninatorsec.blogspot.com/2020/08/)
    (1)
  + ►
    [April](https://burninatorsec.blogspot.com/2020/04/)
    (2)

* ►
  [2019](https://burninatorsec.blogspot.com/2019/)
  (5)
  + ►
    [July](https://burninatorsec.blogspot.com/2019/07/)
    (2)
  + ►
    [June](https://burninatorsec.blogspot.com/2019/06/)
    (1)
  + ►
    [May](https://burninatorsec.blogspot.com/2019/05/)
    (2)

* ►
  [2018](https://burninatorsec.blogspot.com/2018/)
  (8)
  + ►
    [November](https://burninatorsec.blogspot.com/2018/11/)
    (1)
  + ►
    [August](https://burninatorsec.blogspot.com/2018/08/)
    (1)
  + ►
    [July](https://burninatorsec.blogspot.com/2018/07/)
    (3)
  + ►
    [May](https://burninatorsec.blogspot.com/2018/05/)
    (1)
  + ►
    [April](https://burninatorsec.blogspot.com/2018/04/)
    (1)
  + ►
    [March](https://burninatorsec.blogspot.com/2018/03/)
    (1)

* ►
  [2014](https://burninatorsec.blogspot.com/2014/)
  (1)
  + ►
    [November](https://burninatorsec.blogspot.com/2014/11/)
    (1)

* ►
  [2013](https://burninatorsec.blogspot.com/2013/)
  (8)
  + ►
    [October](https://burninatorsec.blogspot.com/2013/10/)
    (1)
  + ►
    [August](https://burninatorsec.blogspot.com/2013/08/)
    (1)
  + ►
    [July](https://burninatorsec.blogspot.com/2013/07/)
    (1)
  + ►
    [June](https://burninatorsec.blogspot.com/2013/06/)
    (5)

|  |  |
| --- | --- |

Awesome Inc. theme. Powered by [Blogger](https://www.blogger.com).



=== Content from twitter.com_5a351f84_20250114_205025.html ===


