=== Content from bugzilla.suse.com_65ca30e3_20250114_183354.html ===


| Bugzilla – Bug 1208473 | VUL-0: CVE-2021-33226: salt: arbitrary code execution via buffer overflow vulnerability in the func variable in salt/salt/modules/status.py file. | Last modified: 2023-03-02 17:31:32 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1208473)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1208473**](show_bug.cgi?id=1208473)
(CVE-2021-33226)
- VUL-0: CVE-2021-33226: salt: arbitrary code execution via buffer overflow vulnerability in the func variable in salt/salt/modules/status.py file.

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2021-33226: salt: arbitrary code execution via buffer overflow vul...

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED INVALID | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-33226 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Security Team bot | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/357614/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2023-02-20 08:01 UTC by Gabriele Sonnu | | --- | --- | | Modified: | 2023-03-02 17:31 UTC ([History](show_activity.cgi?id=1208473)) | | CC List: | 5 users (show)  alexander.graul meissner paolo.perego salt-maintainers security-team | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | Security Response Team | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1208473) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1208473&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1208473&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1208473#c0)  Gabriele Sonnu   2023-02-20 08:01:40 UTC  ``` CVE-2021-33226  Buffer Overflow vulnerability in Saltstack v.3003 and before allows attacker to execute arbitrary code via the func variable in salt/salt/modules/status.py file.  References: <http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2021-33226> <https://www.cve.org/CVERecord?id=CVE-2021-33226> <https://github.com/saltstack/salt/blob/master/salt/modules/status.py> ``` [Comment 3](show_bug.cgi?id=1208473#c3)  Paolo Perego   2023-02-20 10:01:28 UTC  ``` I guess the suspected vulnerable code is here (line 179).  >     for key, val in conf.items(): >        func = "{}()".format(key.split(".")[1]) >        vals = eval(func)  # pylint: disable=W0123  conf variable contains configuration items retrieved by __salt__ object.  From the man page, (man 7 salt):  > The variable __salt__ is packed into the modules after they are  loaded  > into the Salt minion.  > The __salt__ variable is a Python dictionary containing all of the Salt > functions. Dictionary keys are strings representing the  names  of  the > modules and the values are the functions themselves.  There is no way to change its content so, I think we can consider the eval() function as safe.  Please note also that, by design, salt is intended to execute commands as root on authorized minions. I guess this is a false positive call, but let's wait for salt-maintainers opinion. ``` [Comment 4](show_bug.cgi?id=1208473#c4)  Alexander Graul   2023-02-28 10:46:22 UTC  ``` I agree with your suspicion that the CVE is about the use of `eval(func)` where `func` is taken from the output of `__salt__["config.dot_vals"](status)`.  `__salt__["config.dot_vals"]("status")` is a call to <https://github.com/saltstack/salt/blob/master/salt/modules/config.py#L512>. That function filters the minion configuration and pillar data for config keys that start with "status".  `eval()` then calls the function within status.py that is specified after the first dot as the config key, e.g. `status.uptime: ['seconds']` calls the `uptime()` function in status.py and returns the "seconds" key of `uptime()`'s result.  I must lack the required creativity, I don't see a way this can be exploited.  > Please note also that, by design, salt is intended to execute commands as root on authorized minions.  100% spot on. There are mechanism within Salt to control which user can do what (see <https://docs.saltproject.io/en/latest/topics/eauth/access_control.html>), so __arbitrary__ code execution by unauthorized users would be a big security flaw, but as I said, I don't see how a user can execute arbitrary code with `func` variable as stated in the CVE description.   If it turns out that I'm wrong, and there indeed is arbitrary code execution hidden in this code, I'd be eager to learn how it work. ``` [Comment 5](show_bug.cgi?id=1208473#c5)  Gabriele Sonnu   2023-02-28 11:12:19 UTC  ``` (In reply to Alexander Graul from [comment #4](show_bug.cgi?id=1208473#c4)) > I agree with your suspicion that the CVE is about the use of `eval(func)` > where `func` is taken from the output of > `__salt__["config.dot_vals"](status)`. >  > `__salt__["config.dot_vals"]("status")` is a call to > <https://github.com/saltstack/salt/blob/master/salt/modules/config.py#L512>. > That function filters the minion configuration and pillar data for config > keys that start with "status". >  > `eval()` then calls the function within status.py that is specified after > the first dot as the config key, e.g. `status.uptime: ['seconds']` calls the > `uptime()` function in status.py and returns the "seconds" key of > `uptime()`'s result. >  > I must lack the required creativity, I don't see a way this can be exploited.  I agree, the only way to exploit this is if `eval` was passed totally untrusted input, but this is not the case. I'll close the bug as invalid. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1208473)
* - [XML](show_bug.cgi?ctype=xml&id=1208473)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1208473)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1208473)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from github.com_5d3eb7e4_20250115_112811.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Fmaster%2Fsalt%2Fmodules%2Fconfig.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Fmaster%2Fsalt%2Fmodules%2Fconfig.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=saltstack%2Fsalt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saltstack](/saltstack)
/
**[salt](/saltstack/salt)**
Public

* [Notifications](/login?return_to=%2Fsaltstack%2Fsalt) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaltstack%2Fsalt)
* [Star
   14.3k](/login?return_to=%2Fsaltstack%2Fsalt)

* [Code](/saltstack/salt)
* [Issues
  2.6k](/saltstack/salt/issues)
* [Pull requests
  250](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects
  4](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

Additional navigation options

* [Code](/saltstack/salt)
* [Issues](/saltstack/salt/issues)
* [Pull requests](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

## Files

 master
## Breadcrumbs

1. [salt](/saltstack/salt/tree/master)
2. /[salt](/saltstack/salt/tree/master/salt)
3. /[modules](/saltstack/salt/tree/master/salt/modules)
/
# config.py

Copy path Blame  Blame
## Latest commit

## History

[History](/saltstack/salt/commits/master/salt/modules/config.py)564 lines (454 loc) · 17 KB master
## Breadcrumbs

1. [salt](/saltstack/salt/tree/master)
2. /[salt](/saltstack/salt/tree/master/salt)
3. /[modules](/saltstack/salt/tree/master/salt/modules)
/
# config.py

Top
## File metadata and controls

* Code
* Blame

564 lines (454 loc) · 17 KB[Raw](https://github.com/saltstack/salt/raw/refs/heads/master/salt/modules/config.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564"""Return config information"""
import copyimport fnmatchimport loggingimport osimport urllib.parse
import salt.configimport salt.syspaths as syspathsimport salt.utils.dataimport salt.utils.dictupdateimport salt.utils.filesimport salt.utils.platformimport salt.utils.sdb as sdbfrom salt.loader.context import LoaderContext
try: # Gated for salt-ssh (salt.utils.cloud imports msgpack) import salt.utils.cloud
 HAS\_CLOUD = Trueexcept ImportError: HAS\_CLOUD = False
if salt.utils.platform.is\_windows(): \_HOSTS\_FILE = os.path.join( os.environ["SystemRoot"], "System32", "drivers", "etc", "hosts" )else: \_HOSTS\_FILE = os.path.join(os.sep, "etc", "hosts")
log = logging.getLogger(\_\_name\_\_)
\_\_proxyenabled\_\_ = ["\*"]\_\_salt\_loader\_\_ = LoaderContext()\_\_opts\_\_ = \_\_salt\_loader\_\_.named\_context("\_\_opts\_\_")
# Set up the default values for all systemsDEFAULTS = { "mongo.db": "salt", "mongo.password": "", "mongo.port": 27017, "mongo.user": "", "redis.db": "0", "redis.host": "salt", "redis.port": 6379, "test.foo": "unconfigured", "ca.cert\_base\_path": "/etc/pki", "solr.cores": [], "solr.host": "localhost", "solr.port": "8983", "solr.baseurl": "/solr", "solr.type": "master", "solr.request\_timeout": None, "solr.init\_script": "/etc/rc.d/solr", "solr.dih.import\_options": { "clean": False, "optimize": True, "commit": True, "verbose": False, }, "solr.backup\_path": None, "solr.num\_backups": 1, "poudriere.config": "/usr/local/etc/poudriere.conf", "poudriere.config\_dir": "/usr/local/etc/poudriere.d", "ldap.uri": "", "ldap.server": "localhost", "ldap.port": "389", "ldap.tls": False, "ldap.no\_verify": False, "ldap.anonymous": True, "ldap.scope": 2, "ldap.attrs": None, "ldap.binddn": "", "ldap.bindpw": "", "hosts.file": \_HOSTS\_FILE, "aliases.file": "/etc/aliases", "virt": { "tunnel": False, "images": os.path.join(syspaths.SRV\_ROOT\_DIR, "salt-images"), }, "docker.exec\_driver": "docker-exec", "docker.compare\_container\_networks": { "static": ["Aliases", "Links", "IPAMConfig"], "automatic": ["IPAddress", "Gateway", "GlobalIPv6Address", "IPv6Gateway"], },}
def backup\_mode(backup=""): """ Return the backup mode
 CLI Example:
 .. code-block:: bash
 salt '\*' config.backup\_mode """ if backup: return backup return option("backup\_mode")
def manage\_mode(mode): """ Return a mode value, normalized to a string
 CLI Example:
 .. code-block:: bash
 salt '\*' config.manage\_mode """ # config.manage\_mode should no longer be invoked from the \_\_salt\_\_ dunder # in Salt code, this function is only being left here for backwards # compatibility. return salt.utils.files.normalize\_mode(mode)
def valid\_fileproto(uri): """ Returns a boolean value based on whether or not the URI passed has a valid remote file protocol designation
 CLI Example:
 .. code-block:: bash
 salt '\*' config.valid\_fileproto salt://path/to/file """ return urllib.parse.urlparse(uri).scheme in salt.utils.files.VALID\_PROTOS
def option( value, default=None, omit\_opts=False, omit\_grains=False, omit\_pillar=False, omit\_master=False, omit\_all=False, wildcard=False,): """ Returns the setting for the specified config value. The priority for matches is the same as in :py:func:`config.get <salt.modules.config.get>`, only this function does not recurse into nested data structures. Another difference between this function and :py:func:`config.get <salt.modules.config.get>` is that it comes with a set of "sane defaults". To view these, you can run the following command:
 .. code-block:: bash
 salt '\*' config.option '\*' omit\_all=True wildcard=True
 default The default value if no match is found. If not specified, then the fallback default will be an empty string, unless ``wildcard=True``, in which case the return will be an empty dictionary.
 omit\_opts : False Pass as ``True`` to exclude matches from the minion configuration file
 omit\_grains : False Pass as ``True`` to exclude matches from the grains
 omit\_pillar : False Pass as ``True`` to exclude matches from the pillar data
 omit\_master : False Pass as ``True`` to exclude matches from the master configuration file
 omit\_all : True Shorthand to omit all of the above and return matches only from the "sane defaults".
 .. versionadded:: 3000
 wildcard : False If used, this will perform pattern matching on keys. Note that this will also significantly change the return data. Instead of only a value being returned, a dictionary mapping the matched keys to their values is returned. For example, using ``wildcard=True`` with a ``key`` of ``'foo.ba\*`` could return a dictionary like so:
 .. code-block:: python
 {'foo.bar': True, 'foo.baz': False}
 .. versionadded:: 3000
 CLI Example:
 .. code-block:: bash
 salt '\*' config.option redis.host """ if omit\_all: omit\_opts = omit\_grains = omit\_pillar = omit\_master = True
 if default is None: default = "" if not wildcard else {}
 if not wildcard: if not omit\_opts: if value in \_\_opts\_\_: return \_\_opts\_\_[value] if not omit\_grains: if value in \_\_grains\_\_: return \_\_grains\_\_[value] if not omit\_pillar: if value in \_\_pillar\_\_: return \_\_pillar\_\_[value] if not omit\_master: if value in \_\_pillar\_\_.get("master", {}): return \_\_pillar\_\_["master"][value] if value in DEFAULTS: return DEFAULTS[value]
 # No match return default else: # We need to do the checks in the reverse order so that minion opts # takes precedence ret = {} for omit, data in ( (omit\_master, \_\_pillar\_\_.get("master", {})), (omit\_pillar, \_\_pillar\_\_), (omit\_grains, \_\_grains\_\_), (omit\_opts, \_\_opts\_\_), ): if not omit: ret.update({x: data[x] for x in fnmatch.filter(data, value)}) # Check the DEFAULTS as well to see if the pattern matches it for item in (x for x in fnmatch.filter(DEFAULTS, value) if x not in ret): ret[item] = DEFAULTS[item]
 # If no matches, return the default return ret or default
def merge(value, default="", omit\_opts=False, omit\_master=False, omit\_pillar=False): """ Retrieves an option based on key, merging all matches.
 Same as ``option()`` except that it merges all matches, rather than taking the first match.
 CLI Example:
 .. code-block:: bash
 salt '\*' config.merge schedule """ ret = None if not omit\_opts: if value in \_\_opts\_\_: ret = \_\_opts\_\_[value] if isinstance(ret, str): return ret if not omit\_master: if value in \_\_pillar\_\_.get("master", {}): tmp = \_\_pillar\_\_["master"][value] if ret is None: ret = tmp if isinstance(ret, str): return ret elif isinstance(ret, dict) and isinstance(tmp, dict): tmp.update(ret) ret = tmp elif isinstance(ret, (list, tuple)) and isinstance(tmp, (list, tuple)): ret = list(ret) + list(tmp) if not omit\_pillar: if value in \_\_pillar\_\_: tmp = \_\_pillar\_\_[value] if ret is None: ret = tmp if isinstance(ret, str): return ret elif isinstance(ret, dict) and isinstance(tmp, dict): tmp.update(ret) ret = tmp elif isinstance(ret, (list, tuple)) and isinstance(tmp, (list, tuple)): ret = list(ret) + list(tmp) if ret is None and value in DEFAULTS: return DEFAULTS[value] if ret is None: return default return ret
def get( key, default="", delimiter=":", merge=None, omit\_opts=False, omit\_pillar=False, omit\_master=False, omit\_grains=False,): """ .. versionadded:: 0.14.0
 Attempt to retrieve the named value from the minion config file, pillar, grains or the master config. If the named value is not available, return the value specified by the ``default`` argument. If this argument is not specified, ``default`` falls back to an empty string.
 Values can also be retrieved from nested dictionaries. Assume the below data structure:
 .. code-block:: python
 {'pkg': {'apache': 'httpd'}}
 To retrieve the value associated with the ``apache`` key, in the sub-dictionary corresponding to the ``pkg`` key, the following command can be used:
 .. code-block:: bash
 salt myminion config.get pkg:apache
 The ``:`` (colon) is used to represent a nested dictionary level.
 .. versionchanged:: 2015.5.0 The ``delimiter`` argument was added, to allow delimiters other than ``:`` to be used.
 This function traverses these data stores in this order, returning the first match found:
 - Minion configuration - Minion's grains - Minion's pillar data - Master configuration (requires :conf\_minion:`pillar\_opts` to be set to ``True`` in Minion config file in order to work)
 This means that if there is a value that is going to be the same for the majority of minions, it can be configured in the Master config file, and then overridden using the grains, pillar, or Minion config file.
 Adding config options to the Master or Minion configuration file is easy:
 .. code-block:: yaml
 my-config-option: value cafe-menu: - egg and bacon - egg sausage and bacon - egg and spam - egg bacon and spam - egg bacon sausage and spam - spam bacon sausage and spam - spam egg spam spam bacon and spam - spam sausage spam spam bacon spam tomato and spam
 .. note:: Minion configuration options built into Salt (like those defined :ref:`here <configuration-salt-minion>`) will \*always\* be defined in the Minion configuration and thus \*cannot be overridden by grains or pillar data\*. However, additional (user-defined) configuration options (as in the above example) will not be in the Minion configuration by default and thus can be overridden using grains/pillar data by leaving the option out of the minion config file.
 \*\*Arguments\*\*
 delimiter .. versionadded:: 2015.5.0
 Override the delimiter used to separate nested levels of a data structure.
 merge .. versionadded:: 2015.5.0
 If passed, this parameter will change the behavior of the function so that, instead of traversing each data store above in order and returning the first match, the data stores are first merged together and then searched. The pillar data is merged into the master config data, then the grains are merged, followed by the Minion config data. The resulting data structure is then searched for a match. This allows for configurations to be more flexible.
 .. note::
 The merging described above does not mean that grain data will end up in the Minion's pillar data, or pillar data will end up in the master config data, etc. The data is just combined for the purposes of searching an amalgam of the different data stores.
 The supported merge strategies are as follows:
 - \*\*recurse\*\* - If a key exists in both dictionaries, and the new value is not a dictionary, it is replaced. Otherwise, the sub-dictionaries are merged together into a single dictionary, recursively on down, following the same criteria. For example:
 .. code-block:: python
 >>> dict1 = {'foo': {'bar': 1, 'qux': True}, 'hosts': ['a', 'b', 'c'], 'only\_x': None} >>> dict2 = {'foo': {'baz': 2, 'qux': False}, 'hosts': ['d', 'e', 'f'], 'only\_y': None} >>> merged {'foo': {'bar': 1, 'baz': 2, 'qux': False}, 'hosts': ['d', 'e', 'f'], 'only\_dict1': None, 'only\_dict2': None}
 - \*\*overwrite\*\* - If a key exists in the top level of both dictionaries, the new value completely overwrites the old. For example:
 .. code-block:: python
 >>> dict1 = {'foo': {'bar': 1, 'qux': True}, 'hosts': ['a', 'b', 'c'], 'only\_x': None} >>> dict2 = {'foo': {'baz': 2, 'qux': False}, 'hosts': ['d', 'e', 'f'], 'only\_y': None} >>> merged {'foo': {'baz': 2, 'qux': False}, 'hosts': ['d', 'e', 'f'], 'only\_dict1': None, 'only\_dict2': None}
 CLI Example:
 .. code-block:: bash
 salt '\*' config.get pkg:apache salt '\*' config.get lxc.container\_profile:centos merge=recurse """ if merge is None: if not omit\_opts: ret = salt.utils.data.traverse\_dict\_and\_list( \_\_opts\_\_, key, "\_|-", delimiter=delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_)
 if not omit\_grains: ret = salt.utils.data.traverse\_dict\_and\_list( \_\_grains\_\_, key, "\_|-", delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_)
 if not omit\_pillar: ret = salt.utils.data.traverse\_dict\_and\_list( \_\_pillar\_\_, key, "\_|-", delimiter=delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_)
 if not omit\_master: ret = salt.utils.data.traverse\_dict\_and\_list( \_\_pillar\_\_.get("master", {}), key, "\_|-", delimiter=delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_)
 ret = salt.utils.data.traverse\_dict\_and\_list( DEFAULTS, key, "\_|-", delimiter=delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_) else: if merge not in ("recurse", "overwrite"): log.warning( "Unsupported merge strategy '%s'. Falling back to 'recurse'.", merge ) merge = "recurse"
 merge\_lists = salt.config.master\_config("/etc/salt/master").get( "pillar\_merge\_lists" )
 data = copy.copy(DEFAULTS) data = salt.utils.dictupdate.merge( data, \_\_pillar\_\_.get("master", {}), strategy=merge, merge\_lists=merge\_lists ) data = salt.utils.dictupdate.merge( data, \_\_pillar\_\_, strategy=merge, merge\_lists=merge\_lists ) data = salt.utils.dictupdate.merge( data, \_\_grains\_\_, strategy=merge, merge\_lists=merge\_lists ) data = salt.utils.dictupdate.merge( data, \_\_opts\_\_, strategy=merge, merge\_lists=merge\_lists ) ret = salt.utils.data.traverse\_dict\_and\_list( data, key, "\_|-", delimiter=delimiter ) if ret != "\_|-": return sdb.sdb\_get(ret, \_\_opts\_\_)
 return default
def dot\_vals(value): """ Pass in a configuration value that should be preceded by the module name and a dot, this will return a list of all read key/value pairs
 CLI Example:
 .. code-block:: bash
 salt '\*' config.dot\_vals host """ ret = {} for key, val in \_\_pillar\_\_.get("master", {}).items(): if key.startswith(f"{value}."): ret[key] = val for key, val in \_\_opts\_\_.items(): if key.startswith(f"{value}."): ret[key] = val return ret
def gather\_bootstrap\_script(bootstrap=None): """ Download the salt-bootstrap script, and return its location
 bootstrap URL of alternate bootstrap script
 CLI Example:
 .. code-block:: bash
 salt '\*' config.gather\_bootstrap\_script """ if not HAS\_CLOUD: return False, "config.gather\_bootstrap\_script is unavailable" ret = salt.utils.cloud.update\_bootstrap(\_\_opts\_\_, url=bootstrap) if "Success" in ret and ret["Success"]["Files updated"]: return ret["Success"]["Files updated"][0]
def items(): """ Return the complete config from the currently running minion process. This includes defaults for values not set in the config file.
 CLI Example:
 .. code-block:: bash
 salt '\*' config.items """ return \_\_opts\_\_

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ebe697c4_20250115_112814.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Fmaster%2Fsalt%2Fmodules%2Fstatus.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Fmaster%2Fsalt%2Fmodules%2Fstatus.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=saltstack%2Fsalt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saltstack](/saltstack)
/
**[salt](/saltstack/salt)**
Public

* [Notifications](/login?return_to=%2Fsaltstack%2Fsalt) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaltstack%2Fsalt)
* [Star
   14.3k](/login?return_to=%2Fsaltstack%2Fsalt)

* [Code](/saltstack/salt)
* [Issues
  2.6k](/saltstack/salt/issues)
* [Pull requests
  250](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects
  4](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

Additional navigation options

* [Code](/saltstack/salt)
* [Issues](/saltstack/salt/issues)
* [Pull requests](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

## Files

 master
## Breadcrumbs

1. [salt](/saltstack/salt/tree/master)
2. /[salt](/saltstack/salt/tree/master/salt)
3. /[modules](/saltstack/salt/tree/master/salt/modules)
/
# status.py

Copy path Blame  Blame
## Latest commit

## History

[History](/saltstack/salt/commits/master/salt/modules/status.py)1849 lines (1563 loc) · 57.6 KB master
## Breadcrumbs

1. [salt](/saltstack/salt/tree/master)
2. /[salt](/saltstack/salt/tree/master/salt)
3. /[modules](/saltstack/salt/tree/master/salt/modules)
/
# status.py

Top
## File metadata and controls

* Code
* Blame

1849 lines (1563 loc) · 57.6 KB[Raw](https://github.com/saltstack/salt/raw/refs/heads/master/salt/modules/status.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000"""Module for returning various status data about a minion.These data can be useful for compiling into stats later."""
import collectionsimport copyimport datetimeimport fnmatchimport itertoolsimport loggingimport osimport reimport time
import salt.channelimport salt.configimport salt.minionimport salt.utils.eventimport salt.utils.filesimport salt.utils.networkimport salt.utils.pathimport salt.utils.platformimport salt.utils.stringutilsfrom salt.exceptions import CommandExecutionError
log = logging.getLogger(\_\_file\_\_)
\_\_virtualname\_\_ = "status"
# Don't shadow built-in's.\_\_func\_alias\_\_ = {"time\_": "time"}
log = logging.getLogger(\_\_name\_\_)
def \_\_virtual\_\_(): """ Not all functions supported by Windows """ if salt.utils.platform.is\_windows(): return False, "Windows platform is not supported by this module"
 return \_\_virtualname\_\_
def \_number(text): """ Convert a string to a number. Returns an integer if the string represents an integer, a floating point number if the string is a real number, or the string unchanged otherwise. """ if text.isdigit(): return int(text) try: return float(text) except ValueError: return text
def \_get\_boot\_time\_aix(): """ Return the number of seconds since boot time on AIX
 t=$(LC\_ALL=POSIX ps -o etime= -p 1) d=0 h=0 case $t in \*-\*) d=${t%%-\*}; t=${t#\*-};; esac case $t in \*:\*:\*) h=${t%%:\*}; t=${t#\*:};; esac s=$((d\*86400 + h\*3600 + ${t%%:\*}\*60 + ${t#\*:})) """ res = \_\_salt\_\_["cmd.run\_all"]("ps -o etime= -p 1") if res["retcode"] > 0: raise CommandExecutionError("Unable to find boot\_time for pid 1.") bt\_time = res["stdout"] match = re.match(r"\s\*(?:(\d+)-)?(?:(\d\d):)?(\d\d):(\d\d)\s\*", bt\_time) if not match: raise CommandExecutionError("Unexpected time format.")
 groups = match.groups(default="00") boot\_secs = ( \_number(groups[0]) \* 86400 + \_number(groups[1]) \* 3600 + \_number(groups[2]) \* 60 + \_number(groups[3]) ) return boot\_secs
def \_aix\_loadavg(): """ Return the load average on AIX """ # 03:42PM up 9 days, 20:41, 2 users, load average: 0.28, 0.47, 0.69 uptime = \_\_salt\_\_["cmd.run"]("uptime") ldavg = uptime.split("load average") load\_avg = ldavg[1].split() return { "1-min": load\_avg[1].strip(","), "5-min": load\_avg[2].strip(","), "15-min": load\_avg[3], }
def \_aix\_nproc(): """ Return the maximun number of PROCESSES allowed per user on AIX """ nprocs = \_\_salt\_\_["cmd.run"]( "lsattr -E -l sys0 | grep maxuproc", python\_shell=True ).split() return \_number(nprocs[1])
def procs(): """ Return the process data
 .. versionchanged:: 2016.11.4 Added support for AIX
 CLI Example:
 .. code-block:: bash
 salt '\*' status.procs """ # Get the user, pid and cmd ret = {} uind = 0 pind = 0 cind = 0 plines = \_\_salt\_\_["cmd.run"](\_\_grains\_\_["ps"], python\_shell=True).splitlines() guide = plines.pop(0).split() if "USER" in guide: uind = guide.index("USER") elif "UID" in guide: uind = guide.index("UID") if "PID" in guide: pind = guide.index("PID") if "COMMAND" in guide: cind = guide.index("COMMAND") elif "CMD" in guide: cind = guide.index("CMD") for line in plines: if not line: continue comps = line.split() ret[comps[pind]] = {"user": comps[uind], "cmd": " ".join(comps[cind:])} return ret
def custom(): """ Return a custom composite of status data and info for this minion, based on the minion config file. An example config like might be::
 status.cpustats.custom: [ 'cpu', 'ctxt', 'btime', 'processes' ]
 Where status refers to status.py, cpustats is the function where we get our data, and custom is this function It is followed by a list of keys that we want returned.
 This function is meant to replace all\_status(), which returns anything and everything, which we probably don't want.
 By default, nothing is returned. Warning: Depending on what you include, there can be a LOT here!
 CLI Example:
 .. code-block:: bash
 salt '\*' status.custom """ ret = {} conf = \_\_salt\_\_["config.dot\_vals"]("status") for key, val in conf.items(): func = ".".join(key.split(".")[:-1]) vals = {} if func != "status.custom": try: vals = \_\_salt\_\_[func]() for item in val: try: ret[item] = vals[item] except KeyError: log.warning("val %s not in return of %s", item, func) ret[item] = "UNKNOWN" except KeyError: log.warning("custom status %s isn't loaded", func)
 return ret
def uptime(): """ Return the uptime for this system.
 .. versionchanged:: 2015.8.9 The uptime function was changed to return a dictionary of easy-to-read key/value pairs containing uptime information, instead of the output from a ``cmd.run`` call.
 .. versionchanged:: 2016.11.0 Support for OpenBSD, FreeBSD, NetBSD, MacOS, and Solaris
 .. versionchanged:: 2016.11.4 Added support for AIX
 CLI Example:
 .. code-block:: bash
 salt '\*' status.uptime """ curr\_seconds = time.time()
 # Get uptime in seconds if salt.utils.platform.is\_linux(): ut\_path = "/proc/uptime" if not os.path.exists(ut\_path): raise CommandExecutionError(f"File {ut\_path} was not found.") with salt.utils.files.fopen(ut\_path) as rfh: seconds = int(float(rfh.read().split()[0])) elif salt.utils.platform.is\_sunos(): # note: some flavors/versions report the host uptime inside a zone # https://support.oracle.com/epmos/faces/BugDisplay?id=15611584 res = \_\_salt\_\_["cmd.run\_all"]("kstat -p unix:0:system\_misc:boot\_time") if res["retcode"] > 0: raise CommandExecutionError("The boot\_time kstat was not found.") seconds = int(curr\_seconds - int(res["stdout"].split()[-1])) elif salt.utils.platform.is\_openbsd() or salt.utils.platform.is\_netbsd(): bt\_data = \_\_salt\_\_["sysctl.get"]("kern.boottime") if not bt\_data: raise CommandExecutionError("Cannot find kern.boottime system parameter") seconds = int(curr\_seconds - int(bt\_data)) elif salt.utils.platform.is\_freebsd() or salt.utils.platform.is\_darwin(): # format: { sec = 1477761334, usec = 664698 } Sat Oct 29 17:15:34 2016 bt\_data = \_\_salt\_\_["sysctl.get"]("kern.boottime") if not bt\_data: raise CommandExecutionError("Cannot find kern.boottime system parameter") data = bt\_data.split("{")[-1].split("}")[0].strip().replace(" ", "") uptime = { k: int( v, ) for k, v in [p.strip().split("=") for p in data.split(",")] } seconds = int(curr\_seconds - uptime["sec"]) elif salt.utils.platform.is\_aix(): seconds = \_get\_boot\_time\_aix() else: return \_\_salt\_\_["cmd.run"]("uptime")
 # Setup datetime and timedelta objects boot\_time = datetime.datetime.utcfromtimestamp(curr\_seconds - seconds) curr\_time = datetime.datetime.utcfromtimestamp(curr\_seconds) up\_time = curr\_time - boot\_time
 # Construct return information ut\_ret = { "seconds": seconds, "since\_iso": boot\_time.isoformat(), "since\_t": int(curr\_seconds - seconds), "days": up\_time.days, "time": f"{up\_time.seconds // 3600}:{up\_time.seconds % 3600 // 60}", }
 if salt.utils.path.which("who"): who\_cmd = ( "who" if salt.utils.platform.is\_openbsd() else "who -s" ) # OpenBSD does not support -s ut\_ret["users"] = len(\_\_salt\_\_["cmd.run"](who\_cmd).split(os.linesep))
 return ut\_ret
def loadavg(): """ Return the load averages for this minion
 .. versionchanged:: 2016.11.4 Added support for AIX
 CLI Example:
 .. code-block:: bash
 salt '\*' status.loadavg
 :raises CommandExecutionError: If the system cannot report loadaverages to Python """ if \_\_grains\_\_["kernel"] == "AIX": return \_aix\_loadavg()
 try: load\_avg = os.getloadavg() except AttributeError: # Some UNIX-based operating systems do not have os.getloadavg() raise salt.exceptions.CommandExecutionError( "status.loadavag is not available on your platform" ) return {"1-min": load\_avg[0], "5-min": load\_avg[1], "15-min": load\_avg[2]}
def cpustats(): """ Return the CPU stats for this minion
 .. versionchanged:: 2016.11.4 Added support for AIX
 .. versionchanged:: 2018.3.0 Added support for OpenBSD
 CLI Example:
 .. code-block:: bash
 salt '\*' status.cpustats """
 def linux\_cpustats(): """ linux specific implementation of cpustats """ ret = {} try: with salt.utils.files.fopen("/proc/stat", "r") as fp\_: stats = salt.utils.stringutils.to\_unicode(fp\_.read()) except OSError: pass else: for line in stats.splitlines(): if not line: continue comps = line.split() if comps[0] == "cpu": ret[comps[0]] = { "idle": \_number(comps[4]), "iowait": \_number(comps[5]), "irq": \_number(comps[6]), "nice": \_number(comps[2]), "softirq": \_number(comps[7]), "steal": \_number(comps[8]), "system": \_number(comps[3]), "user": \_number(comps[1]), } elif comps[0] == "intr": ret[comps[0]] = { "total": \_number(comps[1]), "irqs": [\_number(x) for x in comps[2:]], } elif comps[0] == "softirq": ret[comps[0]] = { "total": \_number(comps[1]), "softirqs": [\_number(x) for x in comps[2:]], } else: ret[comps[0]] = \_number(comps[1]) return ret
 def freebsd\_cpustats(): """ freebsd specific implementation of cpustats """ vmstat = \_\_salt\_\_["cmd.run"]("vmstat -P").splitlines() vm0 = vmstat[0].split() cpu0loc = vm0.index("cpu0") vm1 = vmstat[1].split() usloc = vm1.index("us") vm2 = vmstat[2].split() cpuctr = 0 ret = {} for cpu in vm0[cpu0loc:]: ret[cpu] = { "us": \_number(vm2[usloc + 3 \* cpuctr]), "sy": \_number(vm2[usloc + 1 + 3 \* cpuctr]), "id": \_number(vm2[usloc + 2 + 3 \* cpuctr]), } cpuctr += 1 return ret
 def sunos\_cpustats(): """ sunos specific implementation of cpustats """ mpstat = \_\_salt\_\_["cmd.run"]("mpstat 1 2").splitlines() fields = mpstat[0].split() ret = {} for cpu in mpstat: if cpu.startswith("CPU"): continue cpu = cpu.split() ret[\_number(cpu[0])] = {} for i in range(1, len(fields) - 1): ret[\_number(cpu[0])][fields[i]] = \_number(cpu[i]) return ret
 def aix\_cpustats(): """ AIX specific implementation of cpustats """ ret = {} ret["mpstat"] = [] procn = None fields = [] for line in \_\_salt\_\_["cmd.run"]("mpstat -a").splitlines(): if not line: continue procn = len(ret["mpstat"]) if line.startswith("System"): comps = line.split(":") ret["mpstat"].append({}) ret["mpstat"][procn]["system"] = {} cpu\_comps = comps[1].split() for comp in cpu\_comps: cpu\_vals = comp.split("=") ret["mpstat"][procn]["system"][cpu\_vals[0]] = cpu\_vals[1]
 if line.startswith("cpu"): fields = line.split() continue
 if fields: cpustat = line.split() ret[\_number(cpustat[0])] = {} for i in range(1, len(fields) - 1): ret[\_number(cpustat[0])][fields[i]] = \_number(cpustat[i])
 return ret
 def openbsd\_cpustats(): """ openbsd specific implementation of cpustats """ systat = \_\_salt\_\_["cmd.run"]("systat -s 2 -B cpu").splitlines() fields = systat[3].split() ret = {} for cpu in systat[4:]: cpu\_line = cpu.split() cpu\_idx = cpu\_line[0] ret[cpu\_idx] = {}
 for idx, field in enumerate(fields[1:]): ret[cpu\_idx][field] = cpu\_line[idx + 1]
 return ret
 # dict that return a function that does the right thing per platform get\_version = { "Linux": linux\_cpustats, "FreeBSD": freebsd\_cpustats, "Junos": freebsd\_cpustats, "OpenBSD": openbsd\_cpustats, "SunOS": sunos\_cpustats, "AIX": aix\_cpustats, }
 errmsg = "This method is unsupported on the current operating system!" return get\_version.get(\_\_grains\_\_["kernel"], lambda: errmsg)()
def meminfo(): """ Return the memory info for this minion
 .. versionchanged:: 2016.11.4 Added support for AIX
 .. versionchanged:: 2018.3.0 Added support for OpenBSD
 CLI Example:
 .. code-block:: bash
 salt '\*' status.meminfo """
 def linux\_meminfo(): """ linux specific implementation of meminfo """ ret = {} try: with salt.utils.files.fopen("/proc/meminfo", "r") as fp\_: stats = salt.utils.stringutils.to\_unicode(fp\_.read()) except OSError: pass else: for line in stats.splitlines(): if not line: continue comps = line.split() comps[0] = comps[0].replace(":", "") ret[comps[0]] = { "value": comps[1], } if len(comps) > 2: ret[comps[0]]["unit"] = comps[2] return ret
 def freebsd\_meminfo(): """ freebsd specific implementation of meminfo """ sysctlvm = \_\_salt\_\_["cmd.run"]("sysctl vm").splitlines() sysctlvm = [x for x in sysctlvm if x.startswith("vm")] sysctlvm = [x.split(":") for x in sysctlvm] sysctlvm = [[y.strip() for y in x] for x in sysctlvm] sysctlvm = [x for x in sysctlvm if x[1]] # If x[1] not empty
 ret = {} for line in sysctlvm: ret[line[0]] = line[1] # Special handling for vm.total as it's especially important sysctlvmtot = \_\_salt\_\_["cmd.run"]("sysctl -n vm.vmtotal").splitlines() sysctlvmtot = [x for x in sysctlvmtot if x] ret["vm.vmtotal"] = sysctlvmtot return ret
 def aix\_meminfo(): """ AIX specific implementation of meminfo """ ret = {} ret["svmon"] = [] ret["vmstat"] = [] procn = None fields = [] pagesize\_flag = False for line in \_\_salt\_\_["cmd.run"]("svmon -G").splitlines(): # Note: svmon is per-system # size inuse free pin virtual mmode # memory 1048576 1039740 8836 285078 474993 Ded # pg space 917504 2574 # # work pers clnt other # pin 248379 0 2107 34592 # in use 474993 0 564747 # # PageSize PoolSize inuse pgsp pin virtual # s 4 KB - 666956 2574 60726 102209 # m 64 KB - 23299 0 14022 23299 if not line: continue
 if re.match(r"\s", line): # assume fields line fields = line.split() continue
 if line.startswith("memory") or line.startswith("pin"): procn = len(ret["svmon"]) ret["svmon"].append({}) comps = line.split() ret["svmon"][procn][comps[0]] = {} for idx, field in enumerate(fields): if len(comps) > idx + 1: ret["svmon"][procn][comps[0]][field] = comps[idx + 1] continue
 if line.startswith("pg space") or line.startswith("in use"): procn = len(ret["svmon"]) ret["svmon"].append({}) comps = line.split() pg\_space = f"{comps[0]} {comps[1]}" ret["svmon"][procn][pg\_space] = {} for idx, field in enumerate(fields): if len(comps) > idx + 2: ret["svmon"][procn][pg\_space][field] = comps[idx + 2] continue
 if line.startswith("PageSize"): fields = line.split() pagesize\_flag = False continue
 if pagesize\_flag: procn = len(ret["svmon"]) ret["svmon"].append({}) comps = line.split() ret["svmon"][procn][comps[0]] = {} for idx, field in enumerate(fields): if len(comps) > idx: ret["svmon"][procn][comps[0]][field] = comps[idx] continue
 for line in \_\_salt\_\_["cmd.run"]("vmstat -v").splitlines(): # Note: vmstat is per-system if not line: continue
 procn = len(ret["vmstat"]) ret["vmstat"].append({}) comps = line.lstrip().split(" ", 1) ret["vmstat"][procn][comps[1]] = comps[0]
 return ret
 def openbsd\_meminfo(): """ openbsd specific implementation of meminfo """ vmstat = \_\_salt\_\_["cmd.run"]("vmstat").splitlines() # We're only interested in memory and page values which are printed # as subsequent fields. fields = [ "active virtual pages", "free list size", "page faults", "pages reclaimed", "pages paged in", "pages paged out", "pages freed", "pages scanned", ] data = vmstat[2].split()[2:10] ret = dict(zip(fields, data)) return ret
 # dict that return a function that does the right thing per platform get\_version = { "Linux": linux\_meminfo, "FreeBSD": freebsd\_meminfo, "Junos": freebsd\_meminfo, "OpenBSD": openbsd\_meminfo, "AIX": aix\_meminfo, }
 errmsg = "This method is unsupported on the current operating system!" return get\_version.get(\_\_grains\_\_["kernel"], lambda: errmsg)()
def cpuinfo(): """ .. versionchanged:: 2016.3.2 Return the CPU info for this minion
 .. versionchanged:: 2016.11.4 Added support for AIX
 .. versionchanged:: 2018.3.0 Added support for NetBSD and OpenBSD
 CLI Example:
 .. code-block:: bash
 salt '\*' status.cpuinfo """
 def linux\_cpuinfo(): """ linux specific cpuinfo implementation """ ret = {} try: with salt.utils.files.fopen("/proc/cpuinfo", "r") as fp\_: stats = salt.utils.stringutils.to\_unicode(fp\_.read()) except OSError: pass else: for line in stats.splitlines(): if not line: continue comps = line.split(":") comps[0] = comps[0].strip() if comps[0] == "flags": ret[comps[0]] = comps[1].split() else: ret[comps[0]] = comps[1].strip() return ret
 def bsd\_cpuinfo(): """ bsd specific cpuinfo implementation """ bsd\_cmd = "sysctl hw.model hw.ncpu" ret = {} if \_\_grains\_\_["kernel"].lower() in ["netbsd", "openbsd"]: sep = "=" else: sep = ":"
 for line in \_\_salt\_\_["cmd.run"](bsd\_cmd).splitlines(): if not line: continue comps = line.split(sep) comps[0] = comps[0].strip() ret[comps[0]] = comps[1].strip() return ret
 def sunos\_cpuinfo(): """ sunos specific cpuinfo implementation """ ret = {} ret["isainfo"] = {} for line in \_\_salt\_\_["cmd.run"]("isainfo -x").splitlines(): # Note: isainfo is per-system and not per-cpu # Output Example: # amd64: rdrand f16c vmx avx xsave pclmulqdq aes sse4.2 sse4.1 ssse3 popcnt tscp cx16 sse3 sse2 sse fxsr mmx cmov amd\_sysc cx8 tsc fpu # i386: rdrand f16c vmx avx xsave pclmulqdq aes sse4.2 sse4.1 ssse3 popcnt tscp ahf cx16 sse3 sse2 sse fxsr mmx cmov sep cx8 tsc fpu if not line: continue comps = line.split(":") comps[0] = comps[0].strip() ret["isainfo"][comps[0]] = sorted(comps[1].strip().split()) ret["psrinfo"] = [] procn = None for line in \_\_salt\_\_["cmd.run"]("psrinfo -v -p").splitlines(): # Output Example: # The physical processor has 6 cores and 12 virtual processors (0-5 12-17) # The core has 2 virtual processors (0 12) # The core has 2 virtual processors (1 13) # The core has 2 virtual processors (2 14) # The core has 2 virtual processors (3 15) # The core has 2 virtual processors (4 16) # The core has 2 virtual processors (5 17) # x86 (GenuineIntel 306E4 family 6 model 62 step 4 clock 2100 MHz) # Intel(r) Xeon(r) CPU E5-2620 v2 @ 2.10GHz # The physical processor has 6 cores and 12 virtual processors (6-11 18-23) # The core has 2 virtual processors (6 18) # The core has 2 virtual processors (7 19) # The core has 2 virtual processors (8 20) # The core has 2 virtual processors (9 21) # The core has 2 virtual processors (10 22) # The core has 2 virtual processors (11 23) # x86 (GenuineIntel 306E4 family 6 model 62 step 4 clock 2100 MHz) # Intel(r) Xeon(r) CPU E5-2620 v2 @ 2.10GHz # # Output Example 2: # The physical processor has 4 virtual processors (0-3) # x86 (GenuineIntel 406D8 family 6 model 77 step 8 clock 2400 MHz) # Intel(r) Atom(tm) CPU C2558 @ 2.40GHz if not line: continue if line.startswith("The physical processor"): procn = len(ret["psrinfo"]) line = line.split() ret["psrinfo"].append({}) if "cores" in line: ret["psrinfo"][procn]["topology"] = {} ret["psrinfo"][procn]["topology"]["cores"] = \_number(line[4]) ret["psrinfo"][procn]["topology"]["threads"] = \_number(line[7]) elif "virtual" in line: ret["psrinfo"][procn]["topology"] = {} ret["psrinfo"][procn]["topology"]["threads"] = \_number(line[4]) elif line.startswith(" " \* 6): # 3x2 space indent ret["psrinfo"][procn]["name"] = line.strip() elif line.startswith(" " \* 4): # 2x2 space indent line = line.strip().split() ret["psrinfo"][procn]["vendor"] = line[1][1:] ret["psrinfo"][procn]["family"] = \_number(line[4]) ret["psrinfo"][procn]["model"] = \_number(line[6]) ret["psrinfo"][procn]["step"] = \_number(line[8]) ret["psrinfo"][procn]["clock"] = f"{line[10]} {line[11][:-1]}" return ret
 def aix\_cpuinfo(): """ AIX specific cpuinfo implementation """ ret = {} ret["prtconf"] = [] ret["lparstat"] = [] procn = None for line in \_\_salt\_\_["cmd.run"]( 'prtconf | grep -i "Processor"', python\_shell=True ).splitlines(): # Note: prtconf is per-system and not per-cpu # Output Example: # prtconf | grep -i "Processor" # Processor Type: PowerPC\_POWER7 # Processor Implementation Mode: POWER 7 # Processor Version: PV\_7\_Compat # Number Of Processors: 2 # Processor Clock Speed: 3000 MHz # Model Implementation: Multiple Processor, PCI bus # + proc0 Processor # + proc4 Processor if not line: continue procn = len(ret["prtconf"]) if line.startswith("Processor") or line.startswith("Number"): ret["prtconf"].append({}) comps = line.split(":") comps[0] = comps[0].rstrip() ret["prtconf"][procn][comps[0]] = comps[1] else: continue
 for line in \_\_salt\_\_["cmd.run"]( 'prtconf | grep "CPU"', python\_shell=True ).splitlines(): # Note: prtconf is per-system and not per-cpu # Output Example: # CPU Type: 64-bit if not line: continue procn = len(ret["prtconf"]) if line.startswith("CPU"): ret["prtconf"].append({}) comps = line.split(":") comps[0] = comps[0].rstrip() ret["prtconf"][procn][comps[0]] = comps[1] else: continue
 for line in \_\_salt\_\_["cmd.run"]( "lparstat -i | grep CPU", python\_shell=True ).splitlines(): # Note: lparstat is per-system and not per-cpu # Output Example: # Online Virtual CPUs : 2 # Maximum Virtual CPUs : 2 # Minimum Virtual CPUs : 1 # Maximum Physical CPUs in system : 32 # Active Physical CPUs in system : 32 # Active CPUs in Pool : 32 # Shared Physical CPUs in system : 32 # Physical CPU Percentage : 25.00% # Desired Virtual CPUs : 2 if not line: continue
 procn = len(ret["lparstat"]) ret["lparstat"].append({}) comps = line.split(":") comps[0] = comps[0].rstrip() ret["lparstat"][procn][comps[0]] = comps[1]
 return ret
 # dict that returns a function that does the right thing per platform get\_version = { "Linux": linux\_cpuinfo, "FreeBSD": bsd\_cpuinfo, "Junos": bsd\_cpuinfo, "NetBSD": bsd\_cpuinfo, "OpenBSD": bsd\_cpuinfo, "SunOS": sunos\_cpuinfo, "AIX": aix\_cpuinfo, }
 errmsg = "This method is unsupported on the current operating system!" return get\_version.get(\_\_grains\_\_["kernel"], lambda: errmsg)()
def diskstats(): """ .. versionchanged:: 2016.3.2 Return the disk stats for this minion
 .. versionchanged:: 2016.11.4 Added support for AIX
 CLI Example:
 .. code-block:: bash
 salt '\*' status.diskstats """
 def linux\_diskstats(): """ linux specific implementation of diskstats """ ret = {} try: with salt.utils.files.fopen("/proc/diskstats", "r") as fp\_: stats = salt.utils.stringutils.to\_unicode(fp\_.read()) except OSError: pass else: for line in stats.splitlines(): if not line: continue comps = line.split() ret[comps[2]] = { "major": \_number(comps[0]), "minor": \_number(comps[1]), "device": \_number(comps[2]), "reads\_issued": \_number(comps[3]), "reads\_merged": \_number(comps[4]), "sectors\_read": \_number(comps[5]), "ms\_spent\_reading": \_number(comps[6]), "writes\_completed": \_number(comps[7]), "writes\_merged": \_number(comps[8]), "sectors\_written": \_number(comps[9]), "ms\_spent\_writing": \_number(comps[10]), "io\_in\_progress": \_number(comps[11]), "ms\_spent\_in\_io": \_number(comps[12]), "weighted\_ms\_spent\_in\_io": \_number(comps[13]), } return ret
 def generic\_diskstats(): """ generic implementation of diskstats note: freebsd and sunos """ ret = {} iostat = \_\_salt\_\_["cmd.run"]("iostat -xzd").splitlines() header = iostat[1] for line in iostat[2:]: comps = line.split() ret[comps[0]] = {} for metric, value in zip(header.split()[1:], comps[1:]): ret[comps[0]][metric] = \_number(value) return ret
 def aix\_diskstats(): """ AIX specific implementation of diskstats """ ret = {} procn = None fields = [] disk\_name = "" disk\_mode = "" for line in \_\_salt\_\_["cmd.run"]("iostat -dDV").splitlines(): # Note: iostat -dDV is per-system # # System configuration: lcpu=8 drives=1 paths=2 vdisks=2 # # hdisk0 xfer: %tm\_act bps tps bread bwrtn # 0.0 0.8 0.0 0.0 0.8 # read: rps avgserv minserv maxserv timeouts fails # 0.0 2.5 0.3 12.4 0 0 # write: wps avgserv minserv maxserv timeouts fails # 0.0 0.3 0.2 0.7 0 0 # queue: avgtime mintime maxtime avgwqsz avgsqsz sqfull # 0.3 0.0 5.3 0.0 0.0 0.0 # -------------------------------------------------------------------------------- if not line or line.startswith("System") or line.startswith("-----------"): continue
 if not re.match(r"\s", line): # have new disk dsk\_comps = line.split(":") dsk\_firsts = dsk\_comps[0].split() disk\_name = dsk\_firsts[0] disk\_mode = dsk\_firsts[1] fields = dsk\_comps[1].split() ret[disk\_name] = []
 procn = len(ret[disk\_name]) ret[disk\_name].append({}) ret[disk\_name][procn][disk\_mode] = {} continue
 if ":" in line: comps = line.split(":") fields = comps[1].split() disk\_mode = comps[0].lstrip() procn = len(ret[disk\_name]) ret[disk\_name].append({}) ret[disk\_name][procn][disk\_mode] = {} else: comps = line.split() for idx, field in enumerate(fields): if len(comps) > idx: ret[disk\_name][procn][disk\_mode][field] = comps[idx]
 return ret
 # dict that return a function that does the right thing per platform get\_version = { "Linux": linux\_diskstats, "FreeBSD": generic\_diskstats, "Junos": generic\_diskstats, "SunOS": generic\_diskstats, "AIX": aix\_diskstats, }
 errmsg = "This method is unsupported on the current operating system!" return get\_version.get(\_\_grains\_\_["kernel"], lambda: errmsg)()
def diskusage(\*args): """ Return the disk usage for this minion
 Usage::
 salt '\*' status.diskusage [paths and/or filesystem types]
 CLI Example:
 .. code-block:: bash
 salt '\*' status.diskusage # usage for all filesystems salt '\*' status.diskusage / /tmp # usage for / and /tmp salt '\*' status.diskusage ext? # usage for ext[234] filesystems salt '\*' status.diskusage / ext? # usage for / and all ext filesystems[View remainder of file in raw view](https://github.com/saltstack/salt/raw/refs/heads/master/salt/modules/status.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.saltproject.io_a7d91522_20250115_112814.html ===


Toggle navigation

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/logos/SaltProject_altlogo_teal.png)](https://saltproject.io/)

* [Overview](/en/latest/)
* [Salt User Guide](https://docs.saltproject.io/salt/user-guide/en/latest/)
* [Documentation](/en/latest/contents.html)
* [Downloads](https://repo.saltproject.io)
* [Develop](/en/latest/topics/development/)

[Edit on GitHub](https://github.com/saltstack/salt/edit/master/doc/topics/eauth/access_control.rst)

* [Table of Contents](../../contents.html "Table of Contents")
* [Glossary](../../glossary.html "Glossary")
* [previous](../blackout/index.html "Minion Blackout Configuration")
* [next](../../ref/publisheracl.html "Publisher ACL system")
* [all salt modules](../../py-modindex.html "Salt Module Index")
* [routing table](../../http-routingtable.html "HTTP Routing Table")
* [index](../../genindex.html "General Index")
* [![](../../_static/images/pdf_icon.svg)](/en/pdf/Salt-3007.1.pdf)
* [![](../../_static/images/epub_icon.svg)](/en/epub/Salt-3007.1.epub)

# Access Control System[¶](#access-control-system "Permalink to this heading")

New in version 0.10.4.

Salt maintains a standard system used to open granular control to non
administrative users to execute Salt commands. The access control system
has been applied to all systems used to configure access to non administrative
control interfaces in Salt.

These interfaces include, the `peer` system, the
`external auth` system and the `publisher acl` system.

The access control system mandated a standard configuration syntax used in
all of the three aforementioned systems. While this adds functionality to the
configuration in 0.10.4, it does not negate the old configuration.

Now specific functions can be opened up to specific minions from specific users
in the case of external auth and publisher ACLs, and for specific minions in the
case of the peer system.

* [Publisher ACL system](../../ref/publisheracl.html)
  + [Permission Issues](../../ref/publisheracl.html#permission-issues)
  + [Whitelist and Blacklist](../../ref/publisheracl.html#whitelist-and-blacklist)
* [External Authentication System](index.html)
  + [External Authentication System Configuration](index.html#external-authentication-system-configuration)
    - [Matching syntax](index.html#matching-syntax)
    - [Groups](index.html#groups)
    - [Limiting by function arguments](index.html#limiting-by-function-arguments)
  + [Usage](index.html#usage)
    - [Tokens](index.html#tokens)
  + [LDAP and Active Directory](index.html#ldap-and-active-directory)
    - [OpenLDAP and similar systems](index.html#openldap-and-similar-systems)
      * [Authenticating to the LDAP Server](index.html#authenticating-to-the-ldap-server)
      * [Determining Group Memberships (OpenLDAP / non-Active Directory)](index.html#determining-group-memberships-openldap-non-active-directory)
      * [Determining Group Memberships (Active Directory)](index.html#determining-group-memberships-active-directory)
* [Peer Communication](../../ref/peer.html)
  + [Peer Configuration](../../ref/peer.html#peer-configuration)
  + [Peer Runner Communication](../../ref/peer.html#peer-runner-communication)
  + [Using Peer Communication](../../ref/peer.html#using-peer-communication)

## When to Use Each Authentication System[¶](#when-to-use-each-authentication-system "Permalink to this heading")

`publisher_acl` is useful for allowing local system users to run Salt
commands without giving them root access. If you can log into the Salt
master directly, then `publisher_acl` allows you to use Salt without
root privileges. If the local system is configured to authenticate against
a remote system, like LDAP or Active Directory, then `publisher_acl` will
interact with the remote system transparently.

`external_auth` is useful for `salt-api` or for making your own scripts
that use Salt's Python API. It can be used at the CLI (with the `-a`
flag) but it is more cumbersome as there are more steps involved. The only
time it is useful at the CLI is when the local system is *not* configured
to authenticate against an external service *but* you still want Salt to
authenticate against an external service.

## Examples[¶](#examples "Permalink to this heading")

The access controls are manifested using matchers in these configurations:

```
publisher_acl:
  fred:
    - web\*:
      - pkg.list_pkgs
      - test.*
      - apache.*

```

In the above example, fred is able to send commands only to minions which match
the specified glob target. This can be expanded to include other functions for
other minions based on standard targets (all matchers are supported except the compound one).

```
external_auth:
  pam:
    dave:
      - test.version
      - mongo\*:
        - network.*
      - log\*:
        - network.*
        - pkg.*
      - 'G@os:RedHat':
        - kmod.*
    steve:
      - .*

```

The above allows for all minions to be hit by test.version by dave, and adds a
few functions that dave can execute on other minions. It also allows steve
unrestricted access to salt commands.

Note

Functions are matched using regular expressions.

 [Previous](../blackout/index.html)
[Next](../../ref/publisheracl.html)

---

*Generated on January 08, 2025 at 20:47:56 UTC.*

You are viewing docs for the latest stable release, 3007.1. Switch to docs for the previous stable release, [3006.9](/en/3006/ "Docs for the previous stable release"), or to a recent doc build from the [master](/en/master/ "Latest docs from the master branch") branch.

[saltproject.io](https://saltproject.io/)

© 2025 VMware, Inc. | [Privacy Policy](https://www.vmware.com/help/privacy.html)

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/misc/banners/try_salt_now.png)](https://docs.saltproject.io/salt/user-guide/en/latest/index.html)

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/logos/SaltProject_altlogo_teal.png)](https://saltproject.io)
[3006.9](/en/3006/ "Switch to docs for the previous stable release")
[3007.1](/en/latest/ "View release notes")
[Master](/en/master/ "Switch to docs built recently from the master branch")

* [Salt Project](../about_salt_project.html)
* [Introduction to Salt](../index.html)
* [Salt system architecture](../salt_system_architecture.html)
* [Contributing](../contributing-guide.html)
* [Salt Project maintenance policies](../maintenance-policy.html)
* [Installation](../installation/index.html)
* [Configuring Salt](../configuration/index.html)
  + [Configuring Salt](../../ref/configuration/index.html)
  + [Configuring the Salt Master](../../ref/configuration/master.html)
  + [Configuring the Salt Minion](../../ref/configuration/minion.html)
  + [Configuring the Salt Proxy Minion](../../ref/configuration/proxy.html)
  + [Delta proxy minions](../../ref/configuration/delta_proxy.html)
  + [Configuration file examples](../../ref/configuration/examples.html)
  + [Minion Blackout Configuration](../blackout/index.html)
  + Access Control System
    - [Publisher ACL system](../../ref/publisheracl.html)
    - [External Authentication System](index.html)
    - [Peer Communication](../../ref/peer.html)
    - [When to Use Each Authentication System](#when-to-use-each-authentication-system)
    - [Examples](#examples)
  + [Job Management](../jobs/index.html)
  + [Managing the Job Cache](../jobs/job_cache.html)
  + [Storing Job Results in an External System](../jobs/external_cache.html)
  + [Logging](../../ref/configuration/logging/index.html)
  + [External Logging Handlers](../../ref/configuration/logging/handlers/index.html)
  + [salt.log\_handlers.fluent\_mod](../../ref/configuration/logging/handlers/salt.log_handlers.fluent_mod.html)
  + [salt.log\_handlers.log4mongo\_mod](../../ref/configuration/logging/handlers/salt.log_handlers.log4mongo_mod.html)
  + [salt.log\_handlers.logstash\_mod](../../ref/configuration/logging/handlers/salt.log_handlers.logstash_mod.html)
  + [salt.log\_handlers.sentry\_mod](../../ref/configuration/logging/handlers/salt.log_handlers.sentry_mod.html)
  + [Salt File Server](../../ref/file_server/index.html)
  + [Git Fileserver Backend Walkthrough](../tutorials/gitfs.html)
  + [MinionFS Backend Walkthrough](../tutorials/minionfs.html)
  + [Salt Package Manager](../spm/index.html)
  + [Storing Data in Other Databases](../sdb/index.html)
  + [Running the Salt Master/Minion as an Unprivileged User](../../ref/configuration/nonroot.html)
  + [Using cron with Salt](../tutorials/cron.html)
  + [Use cron to initiate a highstate](../tutorials/cron.html#use-cron-to-initiate-a-highstate)
  + [Hardening Salt](../hardening.html)
  + [Security disclosure policy](../../security/index.html)
  + [Salt Channels](../channels/index.html)
  + [Salt Transport](../transports/index.html)
  + [Master Tops System](../master_tops/index.html)
  + [Renderers](../../ref/renderers/index.html)
* [Using Salt](../using_salt.html)
* [Remote Execution](../execution/index.html)
* [Configuration Management](../states/index.html)
* [Return Codes](../return_codes/index.html)
* [Utility Modules - Code Reuse in Custom Modules](../utils/index.html)
* [Events & Reactor](../event/index.html)
* [Orchestration](../orchestrate/index.html)
* [Solaris](../solaris/index.html)
* [Salt SSH](../ssh/index.html)
* [Thorium Complex Reactor](../thorium/index.html)
* [Salt Cloud](../cloud/index.html)
* [Salt Proxy Minion](../proxyminion/index.html)
* [Network Automation](../network_automation/index.html)
* [Salt Virt](../virt/index.html)
* [Onedir Packaging](../packaging/index.html)
* [Command Line Reference](../../ref/cli/index.html)
* [Pillars](../../ref/pillar/index.html)
* [Master Tops](../../ref/tops/index.html)
* [Salt Module Reference](../../ref/index.html)
* [APIs](../api.html)
* [Architecture](../topology/index.html)
* [Minion Data Cache](../cache/index.html)
* [Slots](../slots/index.html)
* [Windows](../windows/index.html)
* [Developing Salt](../development/index.html)
* [Release notes](../releases/index.html)
* [Venafi Tools for Salt](../venafi/index.html)
* [Glossary](../../glossary.html)


