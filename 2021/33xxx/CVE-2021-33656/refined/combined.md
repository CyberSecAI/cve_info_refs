=== Content from www.openwall.com_7ab4d2b7_20250115_093042.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux ¬† *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper ¬† *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists ¬† *for password cracking*](/wordlists/)+ [passwdqc ¬† *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt ¬† *KDF & password hashing*](/yescrypt/)+ [yespower ¬† *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish ¬† *password hashing*](/crypt/)+ [phpass ¬† *ditto in PHP*](/phpass/)+ [tcb ¬† *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd ¬† *port scan detector*](/scanlogd/)+ [popa3d ¬† *tiny POP3 daemon*](/popa3d/)+ [blists ¬† *web interface to mailing lists*](/blists/)+ [msulogin ¬† *single user mode login*](/msulogin/)+ [php\_mt\_seed ¬† *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <22bea0b4f2b4411682adf3fdd8883afb@huawei.com>
Date: Tue, 19 Jul 2022 02:14:27 +0000
From: "Weigang (Jimmy)" <weigang12@...wei.com>
To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>
CC: "openeuler-security@...neuler.org" <openeuler-security@...neuler.org>
Subject: CVE-2021-33656: Linux kernel: When setting font with malicous data by ioctl cmd
 PIO_FONT,kernel will write memory out of bounds.(<5.10.127)

Fix has been released in Linux kernel stable tree: <https://git.kernel.org/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/releases/5.10.127/vt-drop-old-font-ioctls.patch>.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_99802e21_20250115_093043.html ===


---

[Date Prev][[Date Next](msg00001.html)]
[Thread Prev][[Thread Next](msg00001.html)]
[[Date Index](maillist.html#00000)]
[[Thread Index](threads.html#00000)]

# [SECURITY] [DLA 3131-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3131-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Sun, 2 Oct 2022 18:44:48 +0200
* *Message-id*: <[[üîé]](/msgid-search/YznAAAT4mGt5wZQb%40decadent.org.uk)¬†[YznAAAT4mGt5wZQb@decadent.org.uk](msg00000.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3131-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
October 01, 2022                              <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux
Version        : 4.19.260-1
CVE ID         : CVE-2021-4159 CVE-2021-33655 CVE-2021-33656 CVE-2022-1462
                 CVE-2022-1679 CVE-2022-2153 CVE-2022-2318 CVE-2022-2586
                 CVE-2022-2588 CVE-2022-2663 CVE-2022-3028 CVE-2022-26365
                 CVE-2022-26373 CVE-2022-33740 CVE-2022-33741 CVE-2022-33742
                 CVE-2022-33744 CVE-2022-36879 CVE-2022-36946 CVE-2022-39188
                 CVE-2022-39842 CVE-2022-40307
Debian Bug     : 1018752

Several vulnerabilities have been discovered in the Linux kernel that
may lead to privilege escalation, denial of service or information
leaks.

CVE-2021-4159

    A flaw was found in the eBPF verifier which could lead to an
    out-of-bounds read.  If unprivileged use of eBPF is enabled, this
    could leak sensitive information.  This was already disabled by
    default, which would fully mitigate the vulnerability.

CVE-2021-33655

    A user with access to a framebuffer console device could cause a
    memory out-of-bounds write via the FBIOPUT_VSCREENINFO ioctl.

CVE-2021-33656

    A user with access to a framebuffer console device could cause a
    memory out-of-bounds write via some font setting ioctls.  These
    obsolete ioctls have been removed.

CVE-2022-1462

    ‰∏ÄÂè™Áãó reported a race condition in the pty (pseudo-terminal)
    subsystem that can lead to a slab out-of-bounds write.  A local
    user could exploit this to cause a denial of service (crash or
    memory corruption) or possibly for privilege escalation.

CVE-2022-1679

    The syzbot tool found a race condition in the ath9k_htc driver
    which can lead to a use-after-free.  This might be exploitable to
    cause a denial service (crash or memory corruption) or possibly
    for privilege escalation.

CVE-2022-2153

    "kangel" reported a flaw in the KVM implementation for x86
    processors which could lead to a null pointer dereference. A local
    user permitted to access /dev/kvm could exploit this to cause a
    denial of service (crash).

CVE-2022-2318

    A use-after-free in the Amateur Radio X.25 PLP (Rose) support may
    result in denial of service.

CVE-2022-2586

    A use-after-free in the Netfilter subsystem may result in local
    privilege escalation for a user with the CAP_NET_ADMIN capability
    in any user or network namespace.

CVE-2022-2588

    Zhenpeng Lin discovered a use-after-free flaw in the cls_route
    filter implementation which may result in local privilege
    escalation for a user with the CAP_NET_ADMIN capability in any
    user or network namespace.

CVE-2022-2663

    David Leadbeater reported flaws in the nf_conntrack_irc
    connection-tracking protocol module.  When this module is enabled
    on a firewall, an external user on the same IRC network as an
    internal user could exploit its lax parsing to open arbitrary TCP
    ports in the firewall, to reveal their public IP address, or to
    block their IRC connection at the firewall.

CVE-2022-3028

    Abhishek Shah reported a race condition in the AF_KEY subsystem,
    which could lead to an out-of-bounds write or read.  A local user
    could exploit this to cause a denial of service (crash or memory
    corruption), to obtain sensitive information, or possibly for
    privilege escalation.

CVE-2022-26365, CVE-2022-33740, CVE-2022-33741, CVE-2022-33742

    Roger Pau Monne discovered that Xen block and network PV device
    frontends don't zero out memory regions before sharing them with
    the backend, which may result in information disclosure.
    Additionally it was discovered that the granularity of the grant
    table doesn't permit sharing less than a 4k page, which may also
    result in information disclosure.

CVE-2022-26373

    It was discovered that on certain processors with Intel's Enhanced
    Indirect Branch Restricted Speculation (eIBRS) capabilities there
    are exceptions to the documented properties in some situations,
    which may result in information disclosure.

    Intel's explanation of the issue can be found at
    <https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/advisory-guidance/post-barrier-return-stack-buffer-predictions.html>

CVE-2022-33744

    Oleksandr Tyshchenko discovered that ARM Xen guests can cause a
    denial of service to the Dom0 via paravirtual devices.

CVE-2022-36879

    A flaw was discovered in xfrm_expand_policies in the xfrm
    subsystem which can cause a reference count to be dropped twice.

CVE-2022-36946

    Domingo Dirutigliano and Nicola Guerrera reported a memory
    corruption flaw in the Netfilter subsystem which may result in
    denial of service.

CVE-2022-39188

    Jann Horn reported a race condition in the kernel's handling of
    unmapping of certain memory ranges.  When a driver created a
    memory mapping with the VM_PFNMAP flag, which many GPU drivers do,
    the memory mapping could be removed and freed before it was
    flushed from the CPU TLBs.  This could result in a page use-after-
    free.  A local user with access to such a device could exploit
    this to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-39842

    An integer overflow was discovered in the pxa3xx-gcu video driver
    which could lead to a heap out-of-bounds write.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2022-40307

    A race condition was discovered in the EFI capsule-loader driver,
    which could lead to use-after-free.  A local user permitted to
    access this device (/dev/efi_capsule_loader) could exploit this to
    cause a denial of service (crash or memory corruption) or possibly
    for privilege escalation.  However, this device is normally only
    accessible by the root user.

For Debian 10 buster, these problems have been fixed in version
4.19.260-1.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgp1gqvJkPWGE.pgp)**

*Description:* PGP signature

---



=== Content from git.kernel.org_4ae22c6a_20250115_093043.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/stable-queue.git](/pub/scm/linux/kernel/git/stable/stable-queue.git/) | master |
| --- | --- | --- |
| Linux kernel stable patch queue | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/stable-queue.git/about/)[summary](/pub/scm/linux/kernel/git/stable/stable-queue.git/)[refs](/pub/scm/linux/kernel/git/stable/stable-queue.git/refs/)[log](/pub/scm/linux/kernel/git/stable/stable-queue.git/log/releases/5.10.127/vt-drop-old-font-ioctls.patch)[tree](/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/releases/5.10.127/vt-drop-old-font-ioctls.patch)[commit](/pub/scm/linux/kernel/git/stable/stable-queue.git/commit/releases/5.10.127/vt-drop-old-font-ioctls.patch)[diff](/pub/scm/linux/kernel/git/stable/stable-queue.git/diff/releases/5.10.127/vt-drop-old-font-ioctls.patch)[stats](/pub/scm/linux/kernel/git/stable/stable-queue.git/stats/releases/5.10.127/vt-drop-old-font-ioctls.patch) | log msg author committer range |
| --- | --- |

path: [root](/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/)/[releases](/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/releases)/[5.10.127](/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/releases/5.10.127)/[vt-drop-old-font-ioctls.patch](/pub/scm/linux/kernel/git/stable/stable-queue.git/tree/releases/5.10.127/vt-drop-old-font-ioctls.patch)blob: bdebbbadf9f682f1d7ff374e364f30abb268e7b1 ([plain](/pub/scm/linux/kernel/git/stable/stable-queue.git/plain/releases/5.10.127/vt-drop-old-font-ioctls.patch))

| ``` [1](#n1) [2](#n2) [3](#n3) [4](#n4) [5](#n5) [6](#n6) [7](#n7) [8](#n8) [9](#n9) [10](#n10) [11](#n11) [12](#n12) [13](#n13) [14](#n14) [15](#n15) [16](#n16) [17](#n17) [18](#n18) [19](#n19) [20](#n20) [21](#n21) [22](#n22) [23](#n23) [24](#n24) [25](#n25) [26](#n26) [27](#n27) [28](#n28) [29](#n29) [30](#n30) [31](#n31) [32](#n32) [33](#n33) [34](#n34) [35](#n35) [36](#n36) [37](#n37) [38](#n38) [39](#n39) [40](#n40) [41](#n41) [42](#n42) [43](#n43) [44](#n44) [45](#n45) [46](#n46) [47](#n47) [48](#n48) [49](#n49) [50](#n50) [51](#n51) [52](#n52) [53](#n53) [54](#n54) [55](#n55) [56](#n56) [57](#n57) [58](#n58) [59](#n59) [60](#n60) [61](#n61) [62](#n62) [63](#n63) [64](#n64) [65](#n65) [66](#n66) [67](#n67) [68](#n68) [69](#n69) [70](#n70) [71](#n71) [72](#n72) [73](#n73) [74](#n74) [75](#n75) [76](#n76) [77](#n77) [78](#n78) [79](#n79) [80](#n80) [81](#n81) [82](#n82) [83](#n83) [84](#n84) [85](#n85) [86](#n86) [87](#n87) [88](#n88) [89](#n89) [90](#n90) [91](#n91) [92](#n92) [93](#n93) [94](#n94) [95](#n95) [96](#n96) [97](#n97) [98](#n98) [99](#n99) [100](#n100) [101](#n101) [102](#n102) [103](#n103) [104](#n104) [105](#n105) [106](#n106) [107](#n107) [108](#n108) [109](#n109) [110](#n110) [111](#n111) [112](#n112) [113](#n113) [114](#n114) [115](#n115) [116](#n116) [117](#n117) [118](#n118) [119](#n119) [120](#n120) [121](#n121) [122](#n122) [123](#n123) [124](#n124) [125](#n125) [126](#n126) [127](#n127) [128](#n128) [129](#n129) [130](#n130) [131](#n131) [132](#n132) [133](#n133) [134](#n134) [135](#n135) [136](#n136) [137](#n137) [138](#n138) [139](#n139) [140](#n140) [141](#n141) [142](#n142) [143](#n143) [144](#n144) [145](#n145) [146](#n146) [147](#n147) [148](#n148) [149](#n149) [150](#n150) [151](#n151) [152](#n152) [153](#n153) [154](#n154) [155](#n155) [156](#n156) [157](#n157) [158](#n158) [159](#n159) [160](#n160) [161](#n161) [162](#n162) [163](#n163) [164](#n164) [165](#n165) [166](#n166) [167](#n167) [168](#n168) [169](#n169) [170](#n170) [171](#n171) [172](#n172) [173](#n173) [174](#n174) [175](#n175) [176](#n176) [177](#n177) [178](#n178) [179](#n179) [180](#n180) [181](#n181) [182](#n182) [183](#n183) [184](#n184) [185](#n185) [186](#n186) [187](#n187) [188](#n188) [189](#n189) [190](#n190) [191](#n191) [192](#n192) [193](#n193) [194](#n194) [195](#n195) [196](#n196) [197](#n197) [198](#n198) [199](#n199) [200](#n200) [201](#n201) [202](#n202) [203](#n203) [204](#n204) [205](#n205) [206](#n206) [207](#n207) [208](#n208) [209](#n209) [210](#n210) [211](#n211) [212](#n212) [213](#n213) [214](#n214) [215](#n215) [216](#n216) [217](#n217) [218](#n218) [219](#n219) [220](#n220) [221](#n221) [222](#n222) [223](#n223) [224](#n224) [225](#n225) [226](#n226) [227](#n227) [228](#n228) [229](#n229) [230](#n230) [231](#n231) [232](#n232) [233](#n233) [234](#n234) [235](#n235) [236](#n236) [237](#n237) [238](#n238) [239](#n239) [240](#n240) [241](#n241) [242](#n242) [243](#n243) [244](#n244) [245](#n245) [246](#n246) [247](#n247) [248](#n248) [249](#n249) [250](#n250) [251](#n251) [252](#n252) [253](#n253) [254](#n254) [255](#n255) [256](#n256) [257](#n257) [258](#n258) [259](#n259) [260](#n260) [261](#n261) [262](#n262) [263](#n263) [264](#n264) [265](#n265) [266](#n266) [267](#n267) [268](#n268) [269](#n269) [270](#n270) [271](#n271) [272](#n272) [273](#n273) [274](#n274) [275](#n275) [276](#n276) [277](#n277) [278](#n278) [279](#n279) [280](#n280) [281](#n281) [282](#n282) [283](#n283) [284](#n284) [285](#n285) [286](#n286) [287](#n287) [288](#n288) [289](#n289) [290](#n290) [291](#n291) [292](#n292) [293](#n293) [294](#n294) [295](#n295) [296](#n296) [297](#n297) [298](#n298) [299](#n299) [300](#n300) [301](#n301) [302](#n302) [303](#n303) [304](#n304) [305](#n305) [306](#n306) [307](#n307)  ``` | ```  ``` From ff2047fb755d4415ec3c70ac799889371151796d Mon Sep 17 00:00:00 2001 From: Jiri Slaby <jslaby@suse.cz> Date: Tue, 5 Jan 2021 13:02:35 +0100 Subject: vt: drop old FONT ioctls  From: Jiri Slaby <jslaby@suse.cz>  commit ff2047fb755d4415ec3c70ac799889371151796d upstream.  Drop support for these ioctls: * PIO_FONT, PIO_FONTX * GIO_FONT, GIO_FONTX * PIO_FONTRESET  As was demonstrated by commit 90bfdeef83f1 (tty: make FONTX ioctl use the tty pointer they were actually passed), these ioctls are not used from userspace, as: 1) they used to be broken (set up font on current console, not the open    one) and racy (before the commit above) 2) KDFONTOP ioctl is used for years instead  Note that PIO_FONTRESET is defunct on most systems as VGA_CONSOLE is set on them for ages. That turns on BROKEN_GRAPHICS_PROGRAMS which makes PIO_FONTRESET just return an error.  We are removing KD_FONT_FLAG_OLD here as it was used only by these removed ioctls. kd.h header exists both in kernel and uapi headers, so we can remove the kernel one completely. Everyone includeing kd.h will now automatically get the uapi one.  There are now unused definitions of the ioctl numbers and "struct consolefontdesc" in kd.h, but as it is a uapi header, I am not touching these.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Link: https://lore.kernel.org/r/20210105120239.28031-8-jslaby@suse.cz Cc: guodaxing <guodaxing@huawei.com> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org> ---  drivers/tty/vt/vt.c       |   39 -----------  drivers/tty/vt/vt_ioctl.c |  151 ----------------------------------------------  include/linux/kd.h        |    8 --  3 files changed, 3 insertions(+), 195 deletions(-)  delete mode 100644 include/linux/kd.h  --- a/drivers/tty/vt/vt.c +++ b/drivers/tty/vt/vt.c @@ -4625,16 +4625,8 @@ static int con_font_get(struct vc_data *    	if (op->data && font.charcount > op->charcount)  		rc = -ENOSPC; -	if (!(op->flags & KD_FONT_FLAG_OLD)) { -		if (font.width > op->width || font.height > op->height)  -			rc = -ENOSPC; -	} else { -		if (font.width != 8) -			rc = -EIO; -		else if ((op->height && font.height > op->height) || -			 font.height > 32) -			rc = -ENOSPC; -	} +	if (font.width > op->width || font.height > op->height) +		rc = -ENOSPC;  	if (rc)  		goto out;   @@ -4662,7 +4654,7 @@ static int con_font_set(struct vc_data *  		return -EINVAL;  	if (op->charcount > 512)  		return -EINVAL; -	if (op->width <= 0 || op->width > 32 || op->height > 32) +	if (op->width <= 0 || op->width > 32 || !op->height || op->height > 32)  		return -EINVAL;  	size = (op->width+7)/8 * 32 * op->charcount;  	if (size > max_font_size) @@ -4672,31 +4664,6 @@ static int con_font_set(struct vc_data *  	if (IS_ERR(font.data))  		return PTR_ERR(font.data);   -	if (!op->height) {		/* Need to guess font height [compat] */ -		int h, i; -		u8 *charmap = font.data; - -		/* -		 * If from KDFONTOP ioctl, don't allow things which can be done -		 * in userland,so that we can get rid of this soon -		 */ -		if (!(op->flags & KD_FONT_FLAG_OLD)) { -			kfree(font.data); -			return -EINVAL; -		} - -		for (h = 32; h > 0; h--) -			for (i = 0; i < op->charcount; i++) -				if (charmap[32*i+h-1]) -					goto nonzero; - -		kfree(font.data); -		return -EINVAL; - -	nonzero: -		op->height = h; -	} -  	font.charcount = op->charcount;  	font.width = op->width;  	font.height = op->height; --- a/drivers/tty/vt/vt_ioctl.c +++ b/drivers/tty/vt/vt_ioctl.c @@ -486,70 +486,6 @@ static int vt_k_ioctl(struct tty_struct  	return 0;  }   -static inline int do_fontx_ioctl(struct vc_data *vc, int cmd, -		struct consolefontdesc __user *user_cfd, -		struct console_font_op *op) -{ -	struct consolefontdesc cfdarg; -	int i; - -	if (copy_from_user(&cfdarg, user_cfd, sizeof(struct consolefontdesc))) -		return -EFAULT; - -	switch (cmd) { -	case PIO_FONTX: -		op->op = KD_FONT_OP_SET; -		op->flags = KD_FONT_FLAG_OLD; -		op->width = 8; -		op->height = cfdarg.charheight; -		op->charcount = cfdarg.charcount; -		op->data = cfdarg.chardata; -		return con_font_op(vc, op); - -	case GIO_FONTX: -		op->op = KD_FONT_OP_GET; -		op->flags = KD_FONT_FLAG_OLD; -		op->width = 8; -		op->height = cfdarg.charheight; -		op->charcount = cfdarg.charcount; -		op->data = cfdarg.chardata; -		i = con_font_op(vc, op); -		if (i) -			return i; -		cfdarg.charheight = op->height; -		cfdarg.charcount = op->charcount; -		if (copy_to_user(user_cfd, &cfdarg, sizeof(struct consolefontdesc))) -			return -EFAULT; -		return 0; -	} -	return -EINVAL; -} - -static int vt_io_fontreset(struct vc_data *vc, struct console_font_op *op) -{ -	int ret; - -	if (__is_defined(BROKEN_GRAPHICS_PROGRAMS)) { -		/* -		 * With BROKEN_GRAPHICS_PROGRAMS defined, the default font is -		 * not saved. -		 */ -		return -ENOSYS; -	} - -	op->op = KD_FONT_OP_SET_DEFAULT; -	op->data = NULL; -	ret = con_font_op(vc, op); -	if (ret) -		return ret; - -	console_lock(); -	con_set_default_unimap(vc); -	console_unlock(); - -	return 0; -} -  static inline int do_unimap_ioctl(int cmd, struct unimapdesc __user *user_ud,  		bool perm, struct vc_data *vc)  { @@ -574,29 +510,7 @@ static inline int do_unimap_ioctl(int cm  static int vt_io_ioctl(struct vc_data *vc, unsigned int cmd, void __user *up,  		bool perm)  { -	struct console_font_op op;	/* used in multiple places here */ -  	switch (cmd) { -	case PIO_FONT: -		if (!perm) -			return -EPERM; -		op.op = KD_FONT_OP_SET; -		op.flags = KD_FONT_FLAG_OLD | KD_FONT_FLAG_DONT_RECALC;	/* Compatibility */ -		op.width = 8; -		op.height = 0; -		op.charcount = 256; -		op.data = up; -		return con_font_op(vc, &op); - -	case GIO_FONT: -		op.op = KD_FONT_OP_GET; -		op.flags = KD_FONT_FLAG_OLD; -		op.width = 8; -		op.height = 32; -		op.charcount = 256; -		op.data = up; -		return con_font_op(vc, &op); -  	case PIO_CMAP:                  if (!perm)  			return -EPERM; @@ -605,20 +519,6 @@ static int vt_io_ioctl(struct vc_data *v  	case GIO_CMAP:                  return con_get_cmap(up);   -	case PIO_FONTX: -		if (!perm) -			return -EPERM; - -		fallthrough; -	case GIO_FONTX: -		return do_fontx_ioctl(vc, cmd, up, &op); - -	case PIO_FONTRESET: -		if (!perm) -			return -EPERM; - -		return vt_io_fontreset(vc, &op); -  	case PIO_SCRNMAP:  		if (!perm)  			return -EPERM; @@ -1099,54 +999,6 @@ void vc_SAK(struct work_struct *work)    #ifdef CONFIG_COMPAT   -struct compat_consolefontdesc { -	unsigned short charcount;       /* characters in font (256 or 512) */ -	unsigned short charheight;      /* scan lines per character (1-32) */ -	compat_caddr_t chardata;	/* font data in expanded form */ -}; - -static inline int -compat_fontx_ioctl(struct vc_data *vc, int cmd, -		   struct compat_consolefontdesc __user *user_cfd, -		   int perm, struct console_font_op *op) -{ -	struct compat_consolefontdesc cfdarg; -	int i; - -	if (copy_from_user(&cfdarg, user_cfd, sizeof(struct compat_consolefontdesc))) -		return -EFAULT; - -	switch (cmd) { -	case PIO_FONTX: -		if (!perm) -			return -EPERM; -		op->op = KD_FONT_OP_SET; -		op->flags = KD_FONT_FLAG_OLD; -		op->width = 8; -		op->height = cfdarg.charheight; -		op->charcount = cfdarg.charcount; -		op->data = compat_ptr(cfdarg.chardata); -		return con_font_op(vc, op); - -	case GIO_FONTX: -		op->op = KD_FONT_OP_GET; -		op->flags = KD_FONT_FLAG_OLD; -		op->width = 8; -		op->height = cfdarg.charheight; -		op->charcount = cfdarg.charcount; -		op->data = compat_ptr(cfdarg.chardata); -		i = con_font_op(vc, op); -		if (i) -			return i; -		cfdarg.charheight = op->height; -		cfdarg.charcount = op->charcount; -		if (copy_to_user(user_cfd, &cfdarg, sizeof(struct compat_consolefontdesc))) -			return -EFAULT; -		return 0; -	} -	return -EINVAL; -} -  struct compat_console_font_op {  	compat_uint_t op;        /* operation code KD_FONT_OP_* */  	compat_uint_t flags;     /* KD_FONT_FLAG_* */ @@ -1223,9 +1075,6 @@ long vt_compat_ioctl(struct tty_struct *  	/*  	 * these need special handlers for incompatible data structures  	 */ -	case PIO_FONTX: -	case GIO_FONTX: -		return compat_fontx_ioctl(vc, cmd, up, perm, &op);    	case KDFONTOP:  		return compat_kdfontop_ioctl(up, perm, &op, vc); --- a/include/linux/kd.h +++ /dev/null @@ -1,8 +0,0 @@ -/* SPDX-License-Identifier: GPL-2.0 */ -#ifndef _LINUX_KD_H -#define _LINUX_KD_H - -#include <uapi/linux/kd.h> - -#define KD_FONT_FLAG_OLD		0x80000000	/* Invoked via old interface [compat] */ -#endif /* _LINUX_KD_H */  ```   ``` |
| --- | --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:29:20 +0000


