=== Content from open.ribose.com_bd0b4e16_20250115_081914.html ===

#

[Projects](/projects/)
[Software](/software/)
[Specifications](/specs/)
[Blog](/blog/)

#

# RA-2021-05-30: Security vulnerabilities fixed in RNP 0.15.1

30 May 2021

(was: RI-2021-001)

## Metadata

ID

RA-2021-05-30

This advisory notice covers the following:

* [CVE-2021-33589](#CVE-2021-33589)

## CVE-2021-33589

[download as CVE JSON 5.0](/cves/CVE-2021-33589.json)

Name

Key protection settings not copied after unprotect action

Link

[CVE-2021-33589](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-33589)

Problem

* [CWE-522](https://cwe.mitre.org/data/definitions/522.html) Insufficiently
  Protected Credentials
* [CWE-922](https://cwe.mitre.org/data/definitions/922.html) Insecure Storage
  of Sensitive Information

Impact

[CAPEC-37](https://capec.mitre.org/data/definitions/37.html) Retrieve Embedded Sensitive Data

Affected vendors

Ribose

Affected products

[RNP](https://www.rnpgp.org), versions prior to 0.15.1

### Abstract

A key decrypted through `rnp_key_unprotect` will remain unprotected
after after a subsequent call of `rnp_key_protect`.

### Vulnerability details

This issue was discovered in Thunderbird versions 78.8.1 to 78.10.1,
where it was found that a key decrypted through `rnp_key_unprotect`
will remain unprotected after after a subsequent call of
`rnp_key_protect`.

This issue was the cause of [CVE-2021-29956](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29956)
which is described in [Bugzilla Bug 1710290](https://bugzilla.mozilla.org/show_bug.cgi?id=1710290#c0).

In RNP versions prior to 0.15.1, calling `rnp_key_protect` on a
key that was “unprotected” by `rnp_key_unprotect` will not result
in a re-protected key, as:

* `rnp_key_unlock` is designed to temporarily decrypt secret key data to
  make the secret key usable. This call does not overwrite key protection
  settings.
* `rnp_key_unprotect` decrypts key data and overwrites key protection
  settings, and stores key data in unprotected form.

In the aforementioned scenario, due to the call sequence of calling
`rnp_key_unprotect` and then `rnp_key_protect`, the key protection
settings were not properly copied within RNP, leaving key material in the clear.
This would not happen if the key underwent `rnp_key_unlock`, then
`rnp_key_protect` instead.

### Additional details

From [RNP](https://www.rnpgp.org) 0.15.1 and onwards `rnp_key_protect` implements re-protection
for keys that have been “unprotected” by `rnp_key_unprotect`.

Upgrading to [RNP](https://www.rnpgp.org) 0.15.1 fixes this issue. If unprotected keys have
been saved outside of [RNP](https://www.rnpgp.org), a re-protection step needs to apply.

For [Thunderbird](https://www.thunderbird.net) users, auto-re-protection has been implemented in the
latest release. Please refer to [Bugzilla Bug 1710290](https://bugzilla.mozilla.org/show_bug.cgi?id=1710290#c0)
for more details.

### Credits

* Kai Engert ([Mozilla](https://www.mozilla.org)) and Thunderbird users.

[All Ribose Open software](/software/)
[All specifications](/specs/)

Copyright © 2024 Ribose Group Inc. —
All rights reserved.

[Terms of Service](/tos/)
[Privacy Policy](/privacy/)
[Advisories](/advisories/)
[Disclosure policy](/cve-policy/)
[Security feedback](/feedback/)


