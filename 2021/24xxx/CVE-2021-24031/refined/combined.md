=== Content from www.facebook.com_f6dffe88_20250114_191917.html ===

# [*Facebook*](https://www.facebook.com/ "Go to Facebook home")

[Join or Log Into Facebook](/) Email or phonePassword[Forgot account?](https://www.facebook.com/recover/initiate?lwv=110&ars=royal_blue_bar)Log InDo you want to join Facebook?[Sign Up](/reg/?privacy_mutation_token=eyJ0eXBlIjowLCJjcmVhdGlvbl90aW1lIjoxNzM2ODgyMzU3LCJjYWxsc2l0ZV9pZCI6MzYzOTY5MDQ0ODc4OTI4fQ%3D%3D)[Sign Up](/r.php?locale=en_US)
# CVE-2021-24031

**Description:**  In the Zstandard command-line utility, output files were created with default permissions. Correct file permissions (matching the input) would only be set at completion time. Output files could therefore be readable or writable to unintended parties. **Affected Versions:** This issue affects Zstandard prior to v1.4.1. **Last Updated:** 2021-03-01

* English (US)
* [Gaeilge](https://www.facebook.com/security/advisories/cve-2021-24031 "Irish")
* [Polski](https://ga-ie.facebook.com/security/advisories/cve-2021-24031 "Polish")
* [Lietuvių](https://pl-pl.facebook.com/security/advisories/cve-2021-24031 "Lithuanian")
* [Português (Brasil)](https://lt-lt.facebook.com/security/advisories/cve-2021-24031 "Portuguese (Brazil)")
* [Русский](https://pt-br.facebook.com/security/advisories/cve-2021-24031 "Russian")
* [Română](https://ru-ru.facebook.com/security/advisories/cve-2021-24031 "Romanian")
* [Español](https://ro-ro.facebook.com/security/advisories/cve-2021-24031 "Spanish")
* [Français (France)](https://es-la.facebook.com/security/advisories/cve-2021-24031 "French (France)")
* [Deutsch](https://fr-fr.facebook.com/security/advisories/cve-2021-24031 "German")
* [Italiano](https://de-de.facebook.com/security/advisories/cve-2021-24031 "Italian")

* [Sign Up](/reg/ "Sign Up for Facebook")
* [Log In](/login/ "Log into Facebook")
* [Messenger](https://messenger.com/ "Check out Messenger.")
* [Facebook Lite](/lite/ "Facebook Lite for Android.")
* [Video](https://www.facebook.com/watch/ "Browse in Video")
* [Places](/places/ "Check out popular places on Facebook.")
* [Games](/games/ "Check out Facebook games.")
* [Marketplace](/marketplace/ "Buy and sell on Facebook Marketplace.")
* [Meta Pay](https://about.meta.com/technologies/meta-pay "Learn more about Meta Pay")
* [Meta Store](https://www.meta.com/ "Check out Meta")
* [Meta Quest](https://www.meta.com/quest/ "Learn more about Meta Quest")
* [Ray-Ban Meta](https://www.meta.com/smart-glasses/ "Learn more about Ray-Ban Meta")
* [Meta AI](https://www.meta.ai/ "Meta AI")
* [Instagram](https://l.facebook.com/l.php?u=https%3A%2F%2Fwww.instagram.com%2F&h=AT0NmjKXPfoyh__CSiSIqCUfS6yE7m54wiiBaWKUXm0ucOlekUoKTv9coUV9dEvT25szvRXQ_bafcuMPDmlFdxjmib_LCCOAEl8eLyfEQiFLyVI03KVVYCBCsDLOTnVh1WIHtZMsGeV0fkOjwlyaIQ "Check out Instagram")
* [Threads](https://www.threads.net/ "Check out Threads")
* [Fundraisers](/fundraisers/ "Donate to worthy causes.")
* [Services](/biz/directory/ "Browse our Facebook Services directory.")
* [Voting Information Center](/votinginformationcenter/?entry_point=c2l0ZQ%3D%3D "See the Voting Information Center.")
* [Privacy Policy](/privacy/policy/?entry_point=facebook_page_footer "Learn how we collect, use and share information to support Facebook.")
* [Privacy Center](/privacy/center/?entry_point=facebook_page_footer "Learn how to manage and control your privacy on Facebook.")
* [Groups](/groups/discover/ "Explore our Groups.")
* [About](https://about.meta.com/ "Read our blog, discover the resource center, and find job opportunities.")
* [Create ad](/ad_campaign/landing.php?placement=pflo&campaign_id=402047449186&nav_source=unknown&extra_1=auto "Advertise on Facebook.")
* [Create Page](/pages/create/?ref_type=site_footer "Create a page")
* [Developers](https://developers.facebook.com/?ref=pf "Develop on our platform.")
* [Careers](/careers/?ref=pf "Make your next career move to our awesome company.")
* [Cookies](/policies/cookies/ "Learn about cookies and Facebook.")
* [Ad choices](https://www.facebook.com/help/568137493302217 "Learn about Ad Choices.")
* [Terms](/policies?ref=pf "Review our terms and policies.")
* [Help](/help/?ref=pf "Visit our Help Center.")
* [Contact Uploading & Non-Users](https://www.facebook.com/help/637205020878504 "Visit our Contact Uploading & Non-Users Notice.")
* [Settings](/settings "View and edit your Facebook settings.")
* [Activity log](/allactivity?privacy_source=activity_log_top_menu "View your activity log")
 Meta © 2025![](https://facebook.com/security/hsts-pixel.gif)



=== Content from bugs.debian.org_6b91f211_20250114_191914.html ===

# Debian Bug report logs - #981404 compressed file is world readable, while zstd is running

[![version graph](version.cgi?package=zstd;found=libzstd%2F1.3.8%2Bdfsg-3;found=libzstd%2F1.1.2-1;width=2;fixed=libzstd%2F1.4.8%2Bdfsg-1;fixed=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u1;height=2;absolute=0;collapse=1)](version.cgi?fixed=libzstd%2F1.4.8%2Bdfsg-1;fixed=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u1;collapse=1;absolute=0;found=libzstd%2F1.3.8%2Bdfsg-3;found=libzstd%2F1.1.2-1;package=zstd;info=1)

Package:
[zstd](pkgreport.cgi?package=zstd);
Maintainer for [zstd](pkgreport.cgi?package=zstd) is [RPM packaging team <team+pkg-rpm@tracker.debian.org>](pkgreport.cgi?maint=team%2Bpkg-rpm%40tracker.debian.org); Source for [zstd](pkgreport.cgi?package=zstd) is [src:libzstd](pkgreport.cgi?src=libzstd) ([PTS](https://tracker.debian.org/pkg/libzstd), [buildd](https://buildd.debian.org/libzstd), [popcon](https://qa.debian.org/popcon.php?package=libzstd)).

Reported by: [Harald Dunkel <harri@afaics.de>](pkgreport.cgi?submitter=harri%40afaics.de)

Date: Sat, 30 Jan 2021 16:45:02 UTC

Severity: *critical*

Tags: fixed-upstream, patch, upstream

Found in versions libzstd/1.3.8+dfsg-3, libzstd/1.1.2-1

Fixed in versions libzstd/1.4.8+dfsg-1, libzstd/1.3.8+dfsg-3+deb10u1

**Done:** Étienne Mollier <etienne.mollier@mailoo.org>

Bug is archived. No further changes may be made.

Forwarded to <https://github.com/facebook/zstd/issues/1630>

Display info messages

View this report as an [mbox folder](bugreport.cgi?bug=981404;mbox=yes), [status mbox](bugreport.cgi?bug=981404;mbox=yes;mboxstatus=yes), [maintainer mbox](bugreport.cgi?bug=981404;mbox=yes;mboxmaint=yes)

---

**Report forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`:

`Bug#981404`; Package `zstd`.
(Sat, 30 Jan 2021 16:45:04 GMT) ([full text](bugreport.cgi?bug=981404;msg=2), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=2), [link](#1)).

---

**Acknowledgement sent**
to `Harald Dunkel <harri@afaics.de>`:

New Bug report received and forwarded. Copy sent to `Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`.
(Sat, 30 Jan 2021 16:45:04 GMT) ([full text](bugreport.cgi?bug=981404;msg=4), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=4), [link](#3)).

---

[Message #5](#5) received at submit@bugs.debian.org ([full text](bugreport.cgi?bug=981404;msg=5), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=5), reply):

![](/cgi-bin/libravatar.cgi?email=harri%40afaics.de)
From: Harald Dunkel <harri@afaics.de>
To: Debian Bug Tracking System <submit@bugs.debian.org>
Subject: compressed file is world readable, while zstd is running
Date: Sat, 30 Jan 2021 17:34:45 +0100
```
Package: zstd
Version: 1.3.8+dfsg-3
Severity: critical

Compressing a large file with restricted access permissions a new,
world readable file is created, revealing the contents of the
uncompressed file. Sample:

# whoami
root
# zstd -q -13 -T8 sample.dmp &> zstd.log &
:
:
# ls -al
total 385983012
drwxr-xr-x  2 root    root          4096 Jan 30 16:01 .
drwxr-xr-x 35 root    root          4096 Jan 30 15:39 ..
-rw-------  1 oracle  users 279265214464 Jan 29 22:02 sample.dmp
-rw-r--r--  1 root    root  115981336576 Jan 30 16:25 sample.dmp.zst
-rw-r--r--  1 root    root             0 Jan 30 16:01 zstd.log
:
:
[1]+  Done                    zstd -q -13 -T8 sample.dmp &> zstd.log
# md5sum sample.dmp.zst
5a3d3401e8e46483659e820f96ad0ef0  sample.dmp.zst

An attacker might be able to open(2) the file while zstd is still
running, wait for zstd to complete its job, and then read(2) the
whole file:

% whoami
attacker
% ls -al
total 465071584
drwxr-xr-x  2 root    root          4096 Jan 30 16:01 .
drwxr-xr-x 35 root    root          4096 Jan 30 15:39 ..
-rw-------  1 oracle  users 279265214464 Jan 29 22:02 sample.dmp
-rw-r--r--  1 root    root  196968022016 Jan 30 16:41 sample.dmp.zst
-rw-r--r--  1 root    root             0 Jan 30 16:01 zstd.log
% md5sum sample.dmp.zst
^Z
[1]+  Stopped                 md5sum sample.dmp.zst
:
:
% ls -al
total 475580484
drwxr-xr-x  2 root    root          4096 Jan 30 16:01 .
drwxr-xr-x 35 root    root          4096 Jan 30 15:39 ..
-rw-------  1 oracle  users 279265214464 Jan 29 22:02 sample.dmp
-rw-------  1 oracle  users 207729131801 Jan 29 22:02 sample.dmp.zst
-rw-r--r--  1 root    root             0 Jan 30 16:01 zstd.log

% fg
md5sum sample.dmp.zst
5a3d3401e8e46483659e820f96ad0ef0  sample.dmp.zst
%

In this sample session the attacker got the correct md5sum, just for
demonstation purposes. Hi could have created his own private copy in
the same way.

This makes zstd unusable for me.

Regards
Harri

```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`:

`Bug#981404`; Package `zstd`.
(Mon, 01 Feb 2021 21:58:12 GMT) ([full text](bugreport.cgi?bug=981404;msg=7), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=7), [link](#6)).

---

**Acknowledgement sent**
to `Étienne Mollier <etienne.mollier@mailoo.org>`:

Extra info received and forwarded to list. Copy sent to `Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`.
(Mon, 01 Feb 2021 21:58:12 GMT) ([full text](bugreport.cgi?bug=981404;msg=9), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=9), [link](#8)).

---

[Message #10](#10) received at 981404@bugs.debian.org ([full text](bugreport.cgi?bug=981404;msg=10), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=10), reply):

![](/cgi-bin/libravatar.cgi?email=etienne.mollier%40mailoo.org)
From: Étienne Mollier <etienne.mollier@mailoo.org>
To: 981404@bugs.debian.org
Subject: Re: [Debian-med-packaging] Bug#981404: compressed file is world
readable, while zstd is running
Date: Mon, 1 Feb 2021 22:57:15 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=981404;msg=10) (text/plain, inline)]
```
```
Control: fixed -1 1.4.8+dfsg-1
Control: tag -1 patch

Greetings,

This critical issue is affecting Stable.  Permissions at
compression time are inherited from umask, this may be too
relaxed when handling sensitive files.

Fortunately, this seems to have been fixed upstream around
version 1.4.1.  Debian Sid is not affected anymore as far as I
can see.  I identified the few commits[1,2,3,4] from Mike
Swanson and Yann Collet which solved the issue.

[1] <https://github.com/facebook/zstd/commit/3968160a916a759c3d3418da533e1b4f8b795343>
[2] <https://github.com/facebook/zstd/commit/af80f6dfacafcc2c916ecd57731107221e1f9986>
[3] <https://github.com/facebook/zstd/commit/8b6d96827c24dd09109830272f413254833317d9>
[4] <https://github.com/facebook/zstd/commit/7aaac3f69c1e0102099c192639017e660e88b4bf>

After some folding, I obtained the following patch, with which I
could derive a fixed version of zstd 1.3.8 for Buster:

-------8<--------------8<--------------8<--------------8<-------
--- libzstd.orig/programs/fileio.c
+++ libzstd/programs/fileio.c
@@ -482,8 +482,14 @@
     }   }

     {   FILE* const f = fopen( dstFileName, "wb" );
-        if (f == NULL)
+        if (f == NULL) {
             DISPLAYLEVEL(1, "zstd: %s: %s\n", dstFileName, strerror(errno));
+        } else if (srcFileName != NULL
+                   && strcmp (srcFileName, stdinmark)
+                   && strcmp(dstFileName, nulmark) ) {
+                /* reduce rights on newly created dst file while compression is ongoing */
+            chmod(dstFileName, 00600);
+        }
         return f;
     }
 }
-------8<--------------8<--------------8<--------------8<-------

Side note to Debian Med, I know the package is transitionning to
pkg-rpm team, and I am not super comfortable yet preparing an
upload to Stable[5], so I'm just providing a proposal of patch
as a starter.

[5] <https://www.debian.org/doc/manuals/developers-reference/pkgs.en.html#special-case-uploads-to-the-stable-and-oldstable-distributions>

Kind Regards,
--
Étienne Mollier <etienne.mollier@mailoo.org>
Fingerprint:  8f91 b227 c7d6 f2b1 948c  8236 793c f67e 8f0d 11da
Sent from /dev/pts/2, please excuse my verbosity.

```
```
[[signature.asc](bugreport.cgi?att=1;bug=981404;filename=signature.asc;msg=10) (application/pgp-signature, inline)]
```

---

**Marked as fixed in versions libzstd/1.4.8+dfsg-1.**
Request was from `Étienne Mollier <etienne.mollier@mailoo.org>`
to `981404-submit@bugs.debian.org`.
(Mon, 01 Feb 2021 21:58:12 GMT) ([full text](bugreport.cgi?bug=981404;msg=12), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=12), [link](#11)).

---

**Added tag(s) patch.**
Request was from `Étienne Mollier <etienne.mollier@mailoo.org>`
to `981404-submit@bugs.debian.org`.
(Mon, 01 Feb 2021 21:58:12 GMT) ([full text](bugreport.cgi?bug=981404;msg=14), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=14), [link](#13)).

---

**Set Bug forwarded-to-address to '<https://github.com/facebook/zstd/issues/1630>'.**
Request was from `Salvatore Bonaccorso <carnil@debian.org>`
to `control@bugs.debian.org`.
(Wed, 03 Feb 2021 21:39:02 GMT) ([full text](bugreport.cgi?bug=981404;msg=16), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=16), [link](#15)).

---

**Added tag(s) upstream and fixed-upstream.**
Request was from `Salvatore Bonaccorso <carnil@debian.org>`
to `control@bugs.debian.org`.
(Wed, 03 Feb 2021 21:39:03 GMT) ([full text](bugreport.cgi?bug=981404;msg=18), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=18), [link](#17)).

---

**Reply sent**
to `Étienne Mollier <etienne.mollier@mailoo.org>`:

You have taken responsibility.
(Wed, 10 Feb 2021 22:33:03 GMT) ([full text](bugreport.cgi?bug=981404;msg=20), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=20), [link](#19)).

---

**Notification sent**
to `Harald Dunkel <harri@afaics.de>`:

Bug acknowledged by developer.
(Wed, 10 Feb 2021 22:33:03 GMT) ([full text](bugreport.cgi?bug=981404;msg=22), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=22), [link](#21)).

---

[Message #23](#23) received at 981404-close@bugs.debian.org ([full text](bugreport.cgi?bug=981404;msg=23), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=23), reply):

![](/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org)
From: Debian FTP Masters <ftpmaster@ftp-master.debian.org>
To: 981404-close@bugs.debian.org
Subject: Bug#981404: fixed in libzstd 1.3.8+dfsg-3+deb10u1
Date: Wed, 10 Feb 2021 22:32:10 +0000
```
Source: libzstd
Source-Version: 1.3.8+dfsg-3+deb10u1
Done: Étienne Mollier <etienne.mollier@mailoo.org>

We believe that the bug you reported is fixed in the latest version of
libzstd, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 981404@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Étienne Mollier <etienne.mollier@mailoo.org> (supplier of updated libzstd package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Mon, 01 Feb 2021 20:36:53 +0100
Source: libzstd
Architecture: source
Version: 1.3.8+dfsg-3+deb10u1
Distribution: buster-security
Urgency: high
Maintainer: Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>
Changed-By: Étienne Mollier <etienne.mollier@mailoo.org>
Closes: [981404](bugreport.cgi?bug=981404)
Changes:
 libzstd (1.3.8+dfsg-3+deb10u1) buster-security; urgency=high
 .
   * Team upload.
   * When a file with restricted permissions is compressed, the resulting file
     inherits the umask of the user for the time of the compression.  This will
     usually lead to surprising and too relaxed permissions.  This update adds
     fix-file-permissions-on-compression.patch to make sure the compressed file
     is not group or world readable for the duration of the compression.
     Closes: #[981404](bugreport.cgi?bug=981404)
Checksums-Sha1:
 909d33d6118457384ba8e90fe7b319ed70f58706 2292 libzstd_1.3.8+dfsg-3+deb10u1.dsc
 4283d7fd3abb54208784456b8883c4c90d760940 1299276 libzstd_1.3.8+dfsg.orig.tar.xz
 4ebdb2e9974bd2945008da1a3bc6d8fc1e0ca4bc 10864 libzstd_1.3.8+dfsg-3+deb10u1.debian.tar.xz
 7fefa795f057209c4624f79555b2e960f9b52311 7563 libzstd_1.3.8+dfsg-3+deb10u1_amd64.buildinfo
Checksums-Sha256:
 6ce2a1aafcde927492ac01e89488dc1640fc1dab8be8ded1947b3c06a421d98c 2292 libzstd_1.3.8+dfsg-3+deb10u1.dsc
 03851f2c26ffbf1d43633df3f98966f3c62e698e91ef4dc90523915bc934e5f7 1299276 libzstd_1.3.8+dfsg.orig.tar.xz
 0109ff8e2b23662da58fe018959844c264985345a9b03bdb2213b760de87611b 10864 libzstd_1.3.8+dfsg-3+deb10u1.debian.tar.xz
 32ffe444a0584d9622510c11222e27f9dad7b0c4bc4436eb83917ea1b2e6bea4 7563 libzstd_1.3.8+dfsg-3+deb10u1_amd64.buildinfo
Files:
 83019be1592cf47a45a3b206c96a776a 2292 libs optional libzstd_1.3.8+dfsg-3+deb10u1.dsc
 be6c01a65c48b62e151dd0972a36e995 1299276 libs optional libzstd_1.3.8+dfsg.orig.tar.xz
 aa6dfd0f7bcf8b7bee01613540800fe1 10864 libs optional libzstd_1.3.8+dfsg-3+deb10u1.debian.tar.xz
 bc263ca409b530dcf48154928f71690b 7563 libs optional libzstd_1.3.8+dfsg-3+deb10u1_amd64.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEsaUesned0BdDzBm6HPeSERtSKLAFAmAhotsACgkQHPeSERtS
KLBNnQ//eMzoHIEaIcfFb7KrxETltbOTWnXG5ml6CjV/gIrtGe+aLshUJTa8Uek9
ABaVXd1ij9yh81f6Hx1MsKYk66EbYz33TVV3UwjTgDjysKqH9g2SgZ6Gm3Wb1EQE
NOAu0BNTTtdw6KPI7Rn3URMR6Ab6rnu93OXOo8uL8f0lqVhWqnu8Vvw+pBoVBnT5
SH4Q98GdIjxitKvBIuTKGcqCgV25lUb+Ccg6QmkWDrRRL/ESxGrC4cj487aoVLem
v2WxQpQlyOrI7/SMsG24Tf1Bp+wMCiDptiv/LVkJOQF3YtQWtAv+EUNQDAg3+OAv
H/Z3qq+qIGx6+yS/yAPPd8CchZVMAG6Gi/25PniwJ9/BPjIXBUL3vj8DabyoEJyN
cWkd+SavLPjPtkvPZCdA1NqK0V0UtMp0/ET111pTfdGXxdKxLhrL1IOHyymH4FZ6
+aqNbc90fophz8+DtjxvWPN7MH+llrako1TS3tvuJuGOQdjLtjE1zowo10KTDeJd
D8lI8eRQ6bD+CdlUC6o2RJ5lWh2oiRaOx1wDSHdGij4jYDxtuVV3C7HlT0tFyYiP
p2HZe+fz0ekMTTjJkJjoqsGw80n6yM6UocMfDphnqrPlNAR9GcEUFXy8eeny3i4v
H3CZSV6OfaxSK7N/KCCqPWDKj9VScGC5R4wp4CqIiTmByxapXdY=
=9+fx
-----END PGP SIGNATURE-----

```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`:

`Bug#981404`; Package `zstd`.
(Thu, 11 Feb 2021 10:30:03 GMT) ([full text](bugreport.cgi?bug=981404;msg=25), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=25), [link](#24)).

---

**Acknowledgement sent**
to `wferi@niif.hu`:

Extra info received and forwarded to list. Copy sent to `Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`.
(Thu, 11 Feb 2021 10:30:03 GMT) ([full text](bugreport.cgi?bug=981404;msg=27), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=27), [link](#26)).

---

[Message #28](#28) received at 981404@bugs.debian.org ([full text](bugreport.cgi?bug=981404;msg=28), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=28), reply):

![](/cgi-bin/libravatar.cgi?email=wferi%40niif.hu)
From: wferi@niif.hu
To: 981404@bugs.debian.org
Subject: Fix seems incomplete
Date: Thu, 11 Feb 2021 11:26:47 +0100
```
Hi,

The patch in this bug report very much shrinks the window of the
vulnerability, but doesn't close it completely: the file is still
created with default permissions, then chmodded as a separate step.
It's hard, but not impossible to still win the race and open the file
before the chmod, enabling the same attack.  I recommend something like

fd = open(dstFileName, O_WRONLY|O_CREAT|O_EXCL, 0600);
if (fd != -1)
    f = fdopen( fd, "wb" );
if (fd == -1 || f == NULL)
    DISPLAYLEVEL(1, "zstd: %s: %s\n", dstFileName, strerror(errno));
return f;

for example.
--
Regards,
Feri

```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`:

`Bug#981404`; Package `zstd`.
(Thu, 11 Feb 2021 15:57:04 GMT) ([full text](bugreport.cgi?bug=981404;msg=30), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=30), [link](#29)).

---

**Acknowledgement sent**
to `Salvatore Bonaccorso <carnil@debian.org>`:

Extra info received and forwarded to list. Copy sent to `Debian Med Packaging Team <debian-med-packaging@lists.alioth.debian.org>`.
(Thu, 11 Feb 2021 15:57:04 GMT) ([full text](bugreport.cgi?bug=981404;msg=32), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=32), [link](#31)).

---

[Message #33](#33) received at 981404@bugs.debian.org ([full text](bugreport.cgi?bug=981404;msg=33), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=33), reply):

![](/cgi-bin/libravatar.cgi?email=carnil%40debian.org)
From: Salvatore Bonaccorso <carnil@debian.org>
To: wferi@niif.hu, 981404@bugs.debian.org
Cc: 982519@bugs.debian.org
Subject: Re: Bug#981404: Fix seems incomplete
Date: Thu, 11 Feb 2021 16:54:53 +0100
```
Hi Feri,,

On Thu, Feb 11, 2021 at 11:26:47AM +0100, wferi@niif.hu wrote:
> Hi,
>
> The patch in this bug report very much shrinks the window of the
> vulnerability, but doesn't close it completely: the file is still
> created with default permissions, then chmodded as a separate step.
> It's hard, but not impossible to still win the race and open the file
> before the chmod, enabling the same attack.  I recommend something like
>
> fd = open(dstFileName, O_WRONLY|O_CREAT|O_EXCL, 0600);
> if (fd != -1)
>     f = fdopen( fd, "wb" );
> if (fd == -1 || f == NULL)
>     DISPLAYLEVEL(1, "zstd: %s: %s\n", dstFileName, strerror(errno));
> return f;
>
> for example.

See #982519 respectively <https://github.com/facebook/zstd/issues/2491>
upstream.

Regards,
Salvatore

```

---

**Marked as found in versions libzstd/1.1.2-1.**
Request was from `Étienne Mollier <etienne.mollier@mailoo.org>`
to `control@bugs.debian.org`.
(Sat, 20 Feb 2021 08:54:02 GMT) ([full text](bugreport.cgi?bug=981404;msg=35), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=35), [link](#34)).

---

**Bug archived.**
Request was from `Debbugs Internal Request <owner@bugs.debian.org>`
to `internal_control@bugs.debian.org`.
(Sun, 28 Mar 2021 07:25:05 GMT) ([full text](bugreport.cgi?bug=981404;msg=37), [mbox](bugreport.cgi?bug=981404;mbox=yes;msg=37), [link](#36)).

---

Send a report that [this bug log contains spam](https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=981404).

---

Debian bug tracking system administrator <owner@bugs.debian.org>.
Last modified:
Tue Jan 14 19:19:13 2025;
Machine Name:
bembo

[Debian Bug tracking system](https://www.debian.org/Bugs/)

Debbugs is free software and licensed under the terms of the GNU General
Public License version 2. The current version can be obtained
from <https://bugs.debian.org/debbugs-source/>.

Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.



=== Content from github.com_10f7b610_20250114_191916.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fissues%2F1630)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fissues%2F1630)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=facebook%2Fzstd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[facebook](/facebook)
/
**[zstd](/facebook/zstd)**
Public

* [Notifications](/login?return_to=%2Ffacebook%2Fzstd) You must be signed in to change notification settings
* [Fork
  2.2k](/login?return_to=%2Ffacebook%2Fzstd)
* [Star
   24.1k](/login?return_to=%2Ffacebook%2Fzstd)

* [Code](/facebook/zstd)
* [Issues
  167](/facebook/zstd/issues)
* [Pull requests
  19](/facebook/zstd/pulls)
* [Actions](/facebook/zstd/actions)
* [Projects
  0](/facebook/zstd/projects)
* [Wiki](/facebook/zstd/wiki)
* [Security](/facebook/zstd/security)
* [Insights](/facebook/zstd/pulse)

Additional navigation options

* [Code](/facebook/zstd)
* [Issues](/facebook/zstd/issues)
* [Pull requests](/facebook/zstd/pulls)
* [Actions](/facebook/zstd/actions)
* [Projects](/facebook/zstd/projects)
* [Wiki](/facebook/zstd/wiki)
* [Security](/facebook/zstd/security)
* [Insights](/facebook/zstd/pulse)

# zstd adds read permissions to files while being compressed or uncompressed #1630

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#1644](https://github.com/facebook/zstd/pull/1644)Closed[zstd adds read permissions to files while being compressed or uncompressed](#top)#1630[#1644](https://github.com/facebook/zstd/pull/1644)Copy linkAssignees [![felixhandte](https://avatars.githubusercontent.com/u/1154694?s=64&v=4)](/felixhandte)Labels[good first issue](https://github.com/facebook/zstd/issues?q=state%3Aopen%20label%3A%22good%20first%20issue%22)![@chungy](https://avatars.githubusercontent.com/u/1094821?v=4&size=80)
## Description

![@chungy](https://avatars.githubusercontent.com/u/1094821?v=4&size=48)[chungy](https://github.com/chungy)opened [on Jun 4, 2019](https://github.com/facebook/zstd/issues/1630#issue-452143298)

While the final file mode is reflective of the input file, when compressing or uncompressing, the file can temporarily gain greater permissions than the input and potentially leading to security issues (especially if large files are being handled).

Example: `file` has mode 600 -> `zstd file` -> `file.zst` has mode 644 while compression is happening. (Same happens with `unzstd file.zst` and `file`)

👍1
## Metadata

### Assignees

* [![@felixhandte](https://avatars.githubusercontent.com/u/1154694?s=64&v=4)felixhandte](/felixhandte)
### Labels

[good first issue](https://github.com/facebook/zstd/issues?q=state%3Aopen%20label%3A%22good%20first%20issue%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


