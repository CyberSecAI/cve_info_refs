=== Content from wpscan.com_f0e1bc60_20250114_194049.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Quiz And Survey Master < 7.1.12 - Authenticated SQL injection via shortcode

### Description

The plugin did not sanitise the result\_id GET parameter on pages with the [qsm\_result] shortcode without id attribute, concatenating it in a SQL statement and leading to an SQL injection. The lowest role allowed to use this shortcode in post or pages being author, such user could gain unauthorised access to the DBMS. If the shortcode (without the id attribute) is embed on a public page or post, then unauthenticated users could exploit the injection.

### Proof of Concept

https://drive.google.com/file/d/1axeL8lGH1gFSOEoOFtgGV6xsrNlxJXQB/view?usp=sharing
As an author, create a post/page with the shortcode [qsm\_result], view the created page/post and append ?result\_id=0 or sleep(2)
// https://plugins.svn.wordpress.org/quiz-master-next/tags/7.1.10/php/classes/class-qmn-quiz-manager.php
public function shortcode\_display\_result($atts){
extract(shortcode\_atts(array(
'id' => 0,
), $atts));
ob\_start();
if($id == 0){
$id = isset($\_GET['result\_id']) ? $\_GET['result\_id'] : 0;
}
global $wpdb;
$result\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}mlw\_results WHERE result\_id = {$id}", ARRAY\_A);
...
}

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

quiz-master-next](https://a8cteam5105.wordpress.com/plugin/quiz-master-next/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 7.1.12

### References

CVE
[CVE-2021-24221](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24221)

URL
<https://plugins.trac.wordpress.org/changeset/2479603/>

### Classification

Type
SQLI

OWASP top 10
[A1: Injection](https://www.owasp.org/index.php/Top_10-2017_A1-Injection)

CWE
[CWE-89](https://cwe.mitre.org/data/definitions/89.html)

CVSS
[8.8 (high)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Nguyen Van Khanh - SunCSR (Sun\* Cyber Security Research)

Submitter
khanh

Submitter website
<http://research.sun-asterisk.com/>

Verified
Yes

WPVDB ID
[3b52b25c-82a1-41c7-83ac-92e244f7c5ab](https://a8cteam5105.wordpress.com/vulnerability/3b52b25c-82a1-41c7-83ac-92e244f7c5ab/)

### Timeline

Publicly Published
2021-03-26 (about 3 years ago)

Added
2021-03-26 (about 3 years ago)

Last Updated
2021-03-28 (about 3 years ago)

### Other

Published
Title

Published
2023-04-03
Title
[Steveas WP Live Chat Shoutbox <= 1.4.2 - Unauthenticated SQLi](https://a8cteam5105.wordpress.com/vulnerability/4e5aa9a3-65a0-47d6-bc26-a2fb6cb073ff/)

Published
2016-08-01
Title
[Booking Calendar <= 6.2 - SQL Injection](https://a8cteam5105.wordpress.com/vulnerability/2644b19e-42ef-45d7-8297-37926f31f883/)

Published
2022-12-12
Title
[Web Invoice <= 2.1.3 - Authenticated SQLi](https://a8cteam5105.wordpress.com/vulnerability/45f43359-98c2-4447-b51b-2d466bad8261/)

Published
2024-04-26
Title
[Timetable and Event Schedule by MotoPress < 2.4.12 - Authenticated (Contributor+) SQL Injection](https://a8cteam5105.wordpress.com/vulnerability/7ba26e5c-38be-43c0-af79-1059d3a442eb/)

Published
2024-12-14
Title
[Nabz Image Gallery <= v1.00 - Unauthenticated SQL Injection](https://a8cteam5105.wordpress.com/vulnerability/cc0d87c4-208e-4fec-9864-283fba47e972/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from plugins.trac.wordpress.org_548418e7_20250114_194048.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2479603)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/2479602 "Changeset 2479602")
* [Next Changeset](/changeset/2479604 "Changeset 2479604") →

---

# Changeset 2479603

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/23/2021 05:52:58 AM
([4 years](/timeline?from=2021-02-23T05%3A52%3A58Z&precision=second "See timeline at 02/23/2021 05:52:58 AM") ago)

Author:
expresstech
Message:

7.1.12 to trunk

Location:
[quiz-master-next/trunk](/browser/quiz-master-next/trunk?rev=2479603)
Files:

11 edited

* [css/qsm-admin.css](/browser/quiz-master-next/trunk/css/qsm-admin.css?rev=2479603 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [js/qsm-quiz.js](/browser/quiz-master-next/trunk/js/qsm-quiz.js?rev=2479603 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [mlw\_quizmaster2.php](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2479603 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [php/admin/options-page-questions-tab.php](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2479603 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [php/classes/class-qmn-quiz-creator.php](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2479603 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [php/classes/class-qmn-quiz-manager.php](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php?rev=2479603 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [php/classes/class-qsm-install.php](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603 "Show entry in browser")
  (modified)
  ([9 diffs](#file6 "Show differences"))
* [php/question-types.php](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603 "Show entry in browser")
  (modified)
  ([8 diffs](#file7 "Show differences"))
* [php/rest-api.php](/browser/quiz-master-next/trunk/php/rest-api.php?rev=2479603 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [php/template-variables.php](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603 "Show entry in browser")
  (modified)
  ([29 diffs](#file9 "Show differences"))
* [readme.txt](/browser/quiz-master-next/trunk/readme.txt?rev=2479603 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [quiz-master-next/trunk/css/qsm-admin.css](/changeset/2479603/quiz-master-next/trunk/css/qsm-admin.css "Show the changeset 2479603 restricted to quiz-master-next/trunk/css/qsm-admin.css")

  | [r2375231](/browser/quiz-master-next/trunk/css/qsm-admin.css?rev=2375231#L860 "Show revision 2375231 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/css/qsm-admin.css?rev=2479603#L860 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 860 | 860 |  |
  | 861 | 861 | #mlw\_qmn\_theme\_block\_primary{ |
  | 862 |  | background-color: #~~3498db~~; |
  |  | 862 | background-color: #005e8e; |
  | 863 | 863 | color: #fff; |
  | 864 | 864 | } |
  | […](/browser/quiz-master-next/trunk/css/qsm-admin.css?rev=2375231#L870) | […](/browser/quiz-master-next/trunk/css/qsm-admin.css?rev=2479603#L870) |  |
  | 870 | 870 |  |
  | 871 | 871 | #mlw\_qmn\_theme\_block\_emerald{ |
  | 872 |  | background-color: #~~2ecc71~~; |
  |  | 872 | background-color: #006732; |
  | 873 | 873 | color: #fff; |
  | 874 | 874 | } |
  | 875 | 875 |  |
  | 876 | 876 | #mlw\_qmn\_theme\_block\_turquoise{ |
  | 877 |  | background-color: #~~1abc9c~~; |
  |  | 877 | background-color: #006552; |
  | 878 | 878 | color: #fff; |
  | 879 | 879 | } |
  | 880 | 880 |  |
  | 881 | 881 | #mlw\_qmn\_theme\_block\_gray{ |
  | 882 |  | background-color: #~~ccc~~; |
  |  | 882 | background-color: #595959; |
  | 883 | 883 | color: #fff; |
  | 884 | 884 | } |
* ## [quiz-master-next/trunk/js/qsm-quiz.js](/changeset/2479603/quiz-master-next/trunk/js/qsm-quiz.js "Show the changeset 2479603 restricted to quiz-master-next/trunk/js/qsm-quiz.js")

  | [r2463503](/browser/quiz-master-next/trunk/js/qsm-quiz.js?rev=2463503#L1219 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/js/qsm-quiz.js?rev=2479603#L1219 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 1219 | 1219 | }); |
  | 1220 | 1220 |  |
  |  | 1221 | // Autocomplete off |
  |  | 1222 |  |
  |  | 1223 | var quizID = jQuery('.qsm-quiz-container').find('.qmn\_quiz\_id').val(); |
  |  | 1224 | var $quizForm = QSM.getQuizForm( quizID ); |
  |  | 1225 | if (qmn\_quiz\_data[ quizID ].form\_disable\_autofill == 1) { |
  |  | 1226 | jQuery('#quizForm'+quizID).attr('autocomplete' , 'off'); |
  |  | 1227 | } |
  |  | 1228 |  |
  |  | 1229 |  |
  |  | 1230 |  |
  |  | 1231 | // End Quiz If Wrong |
  |  | 1232 | jQuery(document).on('change ','.qmn\_radio\_answers input , .qmn\_check\_answers input , .qsm\_select',function(e){ |
  |  | 1233 | var quizID = jQuery(this).parents('.qsm-quiz-container').find('.qmn\_quiz\_id').val(); |
  |  | 1234 | var $quizForm = QSM.getQuizForm( quizID ); |
  |  | 1235 | if (qmn\_quiz\_data[ quizID ].end\_quiz\_if\_wrong == 1) { |
  |  | 1236 | var question\_id = jQuery(this).attr('name').split('question')[1], |
  |  | 1237 | value = jQuery(this).val(), |
  |  | 1238 | $this = jQuery(this).parents('.quiz\_section'); |
  |  | 1239 | jQuery.ajax({ |
  |  | 1240 | type: 'POST', |
  |  | 1241 | url: qmn\_ajax\_object.ajaxurl, |
  |  | 1242 | data: { |
  |  | 1243 | action: "qsm\_get\_question\_quick\_result", |
  |  | 1244 | question\_id: question\_id, |
  |  | 1245 | answer: value, |
  |  | 1246 | show\_correct\_info: qmn\_quiz\_data[ quizID ].enable\_quick\_correct\_answer\_info |
  |  | 1247 | }, |
  |  | 1248 | success: function (response) { |
  |  | 1249 | var data = jQuery.parseJSON(response); |
  |  | 1250 | $this.find('.quick-question-res-p').remove(); |
  |  | 1251 | $this.find('.qsm-inline-correct-info').remove(); |
  |  | 1252 | if (data.success == 'correct') { |
  |  | 1253 |  |
  |  | 1254 | } else if (data.success == 'incorrect') { |
  |  | 1255 |  |
  |  | 1256 |  |
  |  | 1257 |  |
  |  | 1258 | $this.append('<div style="color: red" class="quick-question-res-p">' + qmn\_quiz\_data[ quizID ].quick\_result\_wrong\_answer\_text + '</div>') |
  |  | 1259 | $this.append('<div class="qsm-inline-correct-info">' + data.message + '</div>'); |
  |  | 1260 |  |
  |  | 1261 | setTimeout(function() { |
  |  | 1262 | $quizForm.closest( '.qmn\_quiz\_container' ).find('.qsm-submit-btn').trigger('click'); |
  |  | 1263 | }, 1000); |
  |  | 1264 |  |
  |  | 1265 |  |
  |  | 1266 | } |
  |  | 1267 | MathJax.Hub.queue.Push(["Typeset", MathJax.Hub]); |
  |  | 1268 | }, |
  |  | 1269 | error: function (errorThrown) { |
  |  | 1270 | alert(errorThrown); |
  |  | 1271 | } |
  |  | 1272 | }); |
  |  | 1273 | } |
  |  | 1274 | }); |
  |  | 1275 |  |
  | 1221 | 1276 | //Ajax upload file code |
  | 1222 | 1277 | jQuery('.quiz\_section .mlw\_answer\_file\_upload').on('change', function(){ |
* ## [quiz-master-next/trunk/mlw\_quizmaster2.php](/changeset/2479603/quiz-master-next/trunk/mlw_quizmaster2.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/mlw_quizmaster2.php")

  | [r2463503](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2463503#L3 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2479603#L3 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: Quiz And Survey Master |
  | 4 | 4 | \* Description: Easily and quickly add quizzes and surveys to your website. |
  | 5 |  | \* Version: 7.1.1~~1~~ |
  |  | 5 | \* Version: 7.1.12 |
  | 6 | 6 | \* Author: ExpressTech |
  | 7 | 7 | \* Author URI: https://quizandsurveymaster.com/ |
  | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2463503#L10) | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2479603#L10) |  |
  | 10 | 10 | \* |
  | 11 | 11 | \* @author QSM Team |
  | 12 |  | \* @version 7.1.1~~1~~ |
  |  | 12 | \* @version 7.1.12 |
  | 13 | 13 | \* @package QSM |
  | 14 | 14 | \*/ |
  | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2463503#L38) | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2479603#L38) |  |
  | 38 | 38 | \* @since 4.0.0 |
  | 39 | 39 | \*/ |
  | 40 |  | public $version = '7.1.1~~1~~'; |
  |  | 40 | public $version = '7.1.12'; |
  | 41 | 41 |  |
  | 42 | 42 | /\*\* |
  | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2463503#L189) | […](/browser/quiz-master-next/trunk/mlw_quizmaster2.php?rev=2479603#L189) |  |
  | 189 | 189 | add\_action( 'admin\_head', array( $this, 'admin\_head' ), 900 ); |
  | 190 | 190 | add\_action( 'init', array( $this, 'register\_quiz\_post\_types' ) ); |
  | 191 |  | add\_action('plugins\_loaded', array(&$this, 'qsm\_load\_textdomain')); |
  |  | 191 | add\_action('plugins\_loaded', array(&$this, 'qsm\_load\_textdomain')); |
  | 192 | 192 | } |
  | 193 | 193 |  |
* ## [quiz-master-next/trunk/php/admin/options-page-questions-tab.php](/changeset/2479603/quiz-master-next/trunk/php/admin/options-page-questions-tab.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/admin/options-page-questions-tab.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2463503#L510 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2479603#L510 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 510 | 510 | </div> |
  | 511 | 511 | </div> |
  | 512 |  | </div> |
  |  | 512 | </div> |
  | 513 | 513 | </script> |
  | 514 | 514 |  |
  | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2463503#L520) | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2479603#L520) |  |
  | 520 | 520 | <div><a href="#" title="Edit Question" class="edit-question-button"><span class="dashicons dashicons-edit"></span></a></div> |
  | 521 | 521 | <div><a href="#" title="Clone Question" class="duplicate-question-button"><span class="dashicons dashicons-admin-page"></span></a></div> |
  | 522 |  | <div><a href="#" title="Delete Question" class="delete-question-button" data-question-iid="{{data.id }}"><span class="dashicons dashicons-trash"></span></a></div> |
  |  | 522 | <div><a href="#" title="Delete Question" class="delete-question-button" data-question-iid="{{data.id }}"><span class="dashicons dashicons-trash"></span></a></div> |
  | 523 | 523 | <div class="question-content-text">{{{data.question}}}</div> |
  | 524 | 524 | <div class="question-category"><# if ( 0 !== data.category.length ) { #> <?php \_e('Category:', 'quiz-master-next'); ?> {{data.category}} <# } #></div> |
  | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2463503#L530) | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2479603#L530) |  |
  | 530 | 530 | <script type="text/template" id="tmpl-single-question-bank-question"> |
  | 531 | 531 | <div class="question-bank-question" data-question-id="{{data.id}}" data-category-name="{{data.category}}"> |
  | 532 |  | <div class="question-bank-selection"> |
  | 533 |  | <input type="checkbox" name="qsm-question-checkbox[]" class="qsm-question-checkbox" /> |
  | 534 |  | </div> |
  | 535 |  | <div><p>{{{data.question}}}</p><p style="font-size: 12px;color: gray;font-style: italic;"><b>Quiz Name:</b> {{data.quiz\_name}}    <# if ( data.category != '' ) { #> <b>Category:</b> {{data.category}} <# } #></p> |
  | 536 |  | </div> |
  |  | 532 | <div class="question-bank-selection"> |
  |  | 533 | <input type="checkbox" name="qsm-question-checkbox[]" class="qsm-question-checkbox" /> |
  |  | 534 | </div> |
  |  | 535 | <div><p>{{{data.question}}}</p><p style="font-size: 12px;color: gray;font-style: italic;"><b>Quiz Name:</b> {{data.quiz\_name}}    <# if ( data.category != '' ) { #> <b>Category:</b> {{data.category}} <# } #></p></div> |
  | 537 | 536 | <div><a href="#" class="import-button button"><?php \_e('Add Question', 'quiz-master-next'); ?></a></div> |
  | 538 | 537 | </div> |
  | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2463503#L551) | […](/browser/quiz-master-next/trunk/php/admin/options-page-questions-tab.php?rev=2479603#L550) |  |
  | 551 | 550 | <div><a href="#" class="delete-answer-button"><span class="dashicons dashicons-trash"></span></a></div> |
  | 552 | 551 | <div class="answer-text-div"> |
  | 553 |  | <# if ( 'rich' == data.answerType ) { #> |
  | 554 |  | <textarea id="answer-{{data.question\_id}}-{{data.count}}"></textarea> |
  | 555 |  | <# } else { #> |
  | 556 |  | <input type="text" class="answer-text" value="{{data.answer}}" placeholder="Your answer"/> |
  | 557 |  | <# } #> |
  | 558 |  | </div> |
  | 559 |  | <# if ( 0 == data.form\_type ) { #> |
  | 560 |  | <# if ( 1 == data.quiz\_system || 3 == data.quiz\_system ) { #> |
  | 561 |  | <div><input type="text" class="answer-points" value="{{data.points}}" placeholder="Points"/></div> |
  | 562 |  | <# } #> |
  | 563 |  | <# if ( 0 == data.quiz\_system || 3 == data.quiz\_system ) { #> |
  | 564 |  | <div><label class="correct-answer"><input type="checkbox" class="answer-correct" value="1" <# if ( 1 == data.correct ) { #> checked="checked" <# } #>/> <?php \_e('Correct', 'quiz-master-next'); ?></label></div> |
  | 565 |  | <# } #> |
  | 566 |  | <# } #> |
  |  | 552 | <# if ( 'rich' == data.answerType ) { #> |
  |  | 553 | <textarea id="answer-{{data.question\_id}}-{{data.count}}"></textarea> |
  |  | 554 | <# } else { #> |
  |  | 555 | <input type="text" class="answer-text" value="{{data.answer}}" placeholder="Your answer"/> |
  |  | 556 | <# } #> |
  |  | 557 | </div> |
  |  | 558 | <# if ( 0 == data.form\_type ) { #> |
  |  | 559 | <# if ( 1 == data.quiz\_system || 3 == data.quiz\_system ) { #> |
  |  | 560 | <div><input type="text" class="answer-points" value="{{data.points}}" placeholder="Points"/></div> |
  |  | 561 | <# } #> |
  |  | 562 | <# if ( 0 == data.quiz\_system || 3 == data.quiz\_system ) { #> |
  |  | 563 | <div><label class="correct-answer"><input type="checkbox" class="answer-correct" value="1" <# if ( 1 == data.correct ) { #> checked="checked" <# } #>/> <?php \_e('Correct', 'quiz-master-next'); ?></label></div> |
  |  | 564 | <# } #> |
  |  | 565 | <# } #> |
  |  | 566 | <?php do\_action('qsm\_admin\_single\_answer\_option\_fields');?> |
  | 567 | 567 | </div> |
  | 568 | 568 | </script> |
* ## [quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php](/changeset/2479603/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2463503#L76 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2479603#L76 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 76 | 76 | array( |
  | 77 | 77 | 'quiz\_name'                => $quiz\_name, |
  | 78 |  | 'message\_before'           => ~~'Welcome to your %QUIZ\_NAME%'~~, |
  | 79 |  | 'message\_after'            => ~~'Thanks for submitting your response! You can edit this message on the "Results Pages" tab. <br>%CONTACT\_ALL% <br>%QUESTIONS\_ANSWERS%'~~, |
  | 80 |  | 'message\_comment'          => ~~'Please fill in the comment box below.'~~, |
  |  | 78 | 'message\_before'           => \_\_('Welcome to your %QUIZ\_NAME%', 'quiz-master-next'), |
  |  | 79 | 'message\_after'            => \_\_('Thanks for submitting your response! You can edit this message on the "Results Pages" tab. <br>%CONTACT\_ALL% <br>%QUESTIONS\_ANSWERS%', 'quiz-master-next'), |
  |  | 80 | 'message\_comment'          => \_\_('Please fill in the comment box below.', 'quiz-master-next'), |
  | 81 | 81 | 'message\_end\_template'     => '', |
  | 82 | 82 | 'user\_email\_template'      => '%QUESTIONS\_ANSWERS\_EMAIL%', |
  | 83 | 83 | 'admin\_email\_template'     => '%QUESTIONS\_ANSWERS\_EMAIL%', |
  | 84 |  | 'submit\_button\_text'       => ~~'Submit'~~, |
  | 85 |  | 'name\_field\_text'          => ~~'Name'~~, |
  | 86 |  | 'business\_field\_text'      => ~~'Business'~~, |
  | 87 |  | 'email\_field\_text'         => ~~'Email'~~, |
  | 88 |  | 'phone\_field\_text'         => ~~'Phone Number'~~, |
  | 89 |  | 'comment\_field\_text'       => ~~'Comments'~~, |
  |  | 84 | 'submit\_button\_text'       => \_\_('Submit', 'quiz-master-next'), |
  |  | 85 | 'name\_field\_text'          => \_\_('Name', 'quiz-master-next'), |
  |  | 86 | 'business\_field\_text'      => \_\_('Business', 'quiz-master-next'), |
  |  | 87 | 'email\_field\_text'         => \_\_('Email', 'quiz-master-next'), |
  |  | 88 | 'phone\_field\_text'         => \_\_('Phone Number', 'quiz-master-next'), |
  |  | 89 | 'comment\_field\_text'       => \_\_('Comments', 'quiz-master-next'), |
  | 90 | 90 | 'email\_from\_text'          => 'Wordpress', |
  | 91 | 91 | 'question\_answer\_template' => '%QUESTION%<br />%USER\_ANSWERS\_DEFAULT%', |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2463503#L106) | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2479603#L106) |  |
  | 106 | 106 | 'question\_from\_total'      => 0, |
  | 107 | 107 | 'total\_user\_tries'         => 0, |
  | 108 |  | 'total\_user\_tries\_text'    => ~~'You have utilized all of your attempts to pass this quiz.'~~, |
  |  | 108 | 'total\_user\_tries\_text'    => \_\_('You have utilized all of your attempts to pass this quiz.', 'quiz-master-next'), |
  | 109 | 109 | 'certificate\_template'     => '', |
  | 110 | 110 | 'social\_media'             => 0, |
  | 111 |  | 'social\_media\_text'        => ~~'I just scored %CORRECT\_SCORE%% on %QUIZ\_NAME%!'~~, |
  |  | 111 | 'social\_media\_text'        => \_\_('I just scored %CORRECT\_SCORE%% on %QUIZ\_NAME%!', 'quiz-master-next'), |
  | 112 | 112 | 'pagination'               => 0, |
  | 113 |  | 'pagination\_text'          => ~~'Next'~~, |
  |  | 113 | 'pagination\_text'          => \_\_('Next', 'quiz-master-next'), |
  | 114 | 114 | 'timer\_limit'              => 0, |
  | 115 | 115 | 'quiz\_stye'                => '', |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2463503#L119) | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-creator.php?rev=2479603#L119) |  |
  | 119 | 119 | 'last\_activity'            => current\_time( 'mysql' ), |
  | 120 | 120 | 'require\_log\_in'           => 0, |
  | 121 |  | 'require\_log\_in\_text'      => ~~'This quiz is for logged in users only.'~~, |
  |  | 121 | 'require\_log\_in\_text'      => \_\_('This quiz is for logged in users only.', 'quiz-master-next'), |
  | 122 | 122 | 'limit\_total\_entries'      => 0, |
  | 123 |  | 'limit\_total\_entries\_text' => ~~'Unfortunately, this quiz has a limited amount of entries it can recieve and has already reached that limit.'~~, |
  |  | 123 | 'limit\_total\_entries\_text' => \_\_('Unfortunately, this quiz has a limited amount of entries it can recieve and has already reached that limit.', 'quiz-master-next'), |
  | 124 | 124 | 'scheduled\_timeframe'      => '', |
  | 125 | 125 | 'scheduled\_timeframe\_text' => '', |
* ## [quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php](/changeset/2479603/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php?rev=2463503#L329 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php?rev=2479603#L329 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 329 | 329 | 'enable\_result\_after\_timer\_end' => isset($qmn\_quiz\_options->enable\_result\_after\_timer\_end) ? $qmn\_quiz\_options->enable\_result\_after\_timer\_end : '', |
  | 330 | 330 | 'enable\_quick\_result\_mc' => isset($qmn\_quiz\_options->enable\_quick\_result\_mc) ? $qmn\_quiz\_options->enable\_quick\_result\_mc : '', |
  |  | 331 | 'end\_quiz\_if\_wrong' => isset($qmn\_quiz\_options->end\_quiz\_if\_wrong) ? $qmn\_quiz\_options->end\_quiz\_if\_wrong : '', |
  |  | 332 | 'form\_disable\_autofill' => isset($qmn\_quiz\_options->form\_disable\_autofill) ? $qmn\_quiz\_options->form\_disable\_autofill : '', |
  | 331 | 333 | 'enable\_quick\_correct\_answer\_info' => isset($qmn\_quiz\_options->enable\_quick\_correct\_answer\_info) ? $qmn\_quiz\_options->enable\_quick\_correct\_answer\_info : 0, |
  | 332 | 334 | 'quick\_result\_correct\_answer\_text' => $qmn\_quiz\_options->quick\_result\_correct\_answer\_text, |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php?rev=2463503#L361) | […](/browser/quiz-master-next/trunk/php/classes/class-qmn-quiz-manager.php?rev=2479603#L363) |  |
  | 361 | 363 | ob\_start(); |
  | 362 | 364 | if($id == 0){ |
  | 363 |  | $id = isset($\_GET['result\_id']) ? $\_GET['result\_id'] : 0; |
  | 364 |  | } |
  | 365 |  | global $wpdb; |
  | 366 |  | $result\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}mlw\_results WHERE result\_id = {$id}", ARRAY\_A); |
  | 367 |  | $quiz\_result = unserialize($result\_data['quiz\_results']); |
  | 368 |  | $response\_data = array( |
  | 369 |  | 'quiz\_id' => $result\_data['quiz\_id'], |
  | 370 |  | 'quiz\_name' => $result\_data['quiz\_name'], |
  | 371 |  | 'quiz\_system' => $result\_data['quiz\_system'], |
  | 372 |  | 'quiz\_payment\_id' => '', |
  | 373 |  | 'user\_ip' => $result\_data['user\_ip'], |
  | 374 |  | 'user\_name' => $result\_data['name'], |
  | 375 |  | 'user\_business' => $result\_data['business'], |
  | 376 |  | 'user\_email' => $result\_data['email'], |
  | 377 |  | 'user\_phone' => $result\_data['phone'], |
  | 378 |  | 'user\_id' => $result\_data['user'], |
  | 379 |  | 'timer' => 0, |
  | 380 |  | 'time\_taken' => $result\_data['time\_taken'], |
  | 381 |  | 'contact' => $quiz\_result['contact'], |
  | 382 |  | 'total\_points' => $result\_data['point\_score'], |
  | 383 |  | 'total\_score' => $result\_data['correct\_score'], |
  | 384 |  | 'total\_correct' => $result\_data['correct'], |
  | 385 |  | 'total\_questions' => $result\_data['total'], |
  | 386 |  | 'question\_answers\_array' => $quiz\_result[1], |
  | 387 |  | 'comments' => '' |
  | 388 |  | ); |
  | 389 |  | $data = QSM\_Results\_Pages::generate\_pages($response\_data); |
  | 390 |  | echo htmlspecialchars\_decode($data['display']); |
  |  | 365 | $id = (int) isset($\_GET['result\_id']) ? sanitize\_text\_field( $\_GET['result\_id'] ) : 0; |
  |  | 366 | } |
  |  | 367 | if( $id && is\_numeric($id) ){ |
  |  | 368 | global $wpdb; |
  |  | 369 | $result\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}mlw\_results WHERE result\_id = {$id}", ARRAY\_A); |
  |  | 370 | if( $result\_data ){ |
  |  | 371 | $quiz\_result = unserialize($result\_data['quiz\_results']); |
  |  | 372 | $response\_data = array( |
  |  | 373 | 'quiz\_id' => $result\_data['quiz\_id'], |
  |  | 374 | 'quiz\_name' => $result\_data['quiz\_name'], |
  |  | 375 | 'quiz\_system' => $result\_data['quiz\_system'], |
  |  | 376 | 'quiz\_payment\_id' => '', |
  |  | 377 | 'user\_ip' => $result\_data['user\_ip'], |
  |  | 378 | 'user\_name' => $result\_data['name'], |
  |  | 379 | 'user\_business' => $result\_data['business'], |
  |  | 380 | 'user\_email' => $result\_data['email'], |
  |  | 381 | 'user\_phone' => $result\_data['phone'], |
  |  | 382 | 'user\_id' => $result\_data['user'], |
  |  | 383 | 'timer' => 0, |
  |  | 384 | 'time\_taken' => $result\_data['time\_taken'], |
  |  | 385 | 'contact' => $quiz\_result['contact'], |
  |  | 386 | 'total\_points' => $result\_data['point\_score'], |
  |  | 387 | 'total\_score' => $result\_data['correct\_score'], |
  |  | 388 | 'total\_correct' => $result\_data['correct'], |
  |  | 389 | 'total\_questions' => $result\_data['total'], |
  |  | 390 | 'question\_answers\_array' => $quiz\_result[1], |
  |  | 391 | 'comments' => '' |
  |  | 392 | ); |
  |  | 393 | $data = QSM\_Results\_Pages::generate\_pages($response\_data); |
  |  | 394 | echo htmlspecialchars\_decode($data['display']); |
  |  | 395 | } else { |
  |  | 396 | echo \_e('Invalid result id!', 'quiz-master-next'); |
  |  | 397 | } |
  |  | 398 | }else{ |
  |  | 399 | echo \_e('Invalid result id!', 'quiz-master-next'); |
  |  | 400 | } |
  | 391 | 401 | $content = ob\_get\_clean(); |
  | 392 | 402 | return $content; |
* ## [quiz-master-next/trunk/php/classes/class-qsm-install.php](/changeset/2479603/quiz-master-next/trunk/php/classes/class-qsm-install.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/classes/class-qsm-install.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L479 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L479 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 479 | 479 | ); |
  | 480 | 480 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_options' ); |
  |  | 481 |  |
  |  | 482 | $field\_array = array( |
  |  | 483 | 'id' => 'form\_disable\_autofill', |
  |  | 484 | 'label' => \_\_('Disable auto fill for Quiz input', 'quiz-master-next'), |
  |  | 485 | 'type' => 'radio', |
  |  | 486 | 'options' => array( |
  |  | 487 | array( |
  |  | 488 | 'label' => \_\_('Yes', 'quiz-master-next'), |
  |  | 489 | 'value' => 1 |
  |  | 490 | ), |
  |  | 491 | array( |
  |  | 492 | 'label' => \_\_('No', 'quiz-master-next'), |
  |  | 493 | 'value' => 0 |
  |  | 494 | ), |
  |  | 495 | ), |
  |  | 496 | 'default' => 0 |
  |  | 497 | ); |
  |  | 498 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_options' ); |
  | 481 | 499 |  |
  | 482 | 500 | // Registers show category on front setting |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L518) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L536) |  |
  | 518 | 536 | ); |
  | 519 | 537 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_options' ); |
  |  | 538 |  |
  |  | 539 | $field\_array = array( |
  |  | 540 | 'id' => 'end\_quiz\_if\_wrong', |
  |  | 541 | 'label' => \_\_( 'End quiz if there is wrong answer', 'quiz-master-next' ), |
  |  | 542 | 'type' => 'radio', |
  |  | 543 | 'options' => array( |
  |  | 544 | array( |
  |  | 545 | 'label' => \_\_( 'Yes', 'quiz-master-next' ), |
  |  | 546 | 'value' => 1 |
  |  | 547 | ), |
  |  | 548 | array( |
  |  | 549 | 'label' => \_\_( 'No', 'quiz-master-next' ), |
  |  | 550 | 'value' => 0 |
  |  | 551 | ) |
  |  | 552 | ), |
  |  | 553 | 'default' => 0, |
  |  | 554 | 'help' => \_\_('This option works with vertical Multiple Choice , horizontal Multiple Choice , drop down , multiple response and horizontal multiple response question types','quiz-master-next') |
  |  | 555 | ); |
  |  | 556 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_options' ); |
  | 520 | 557 |  |
  | 521 | 558 | // Settings for quick result |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1056) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1093) |  |
  | 1056 | 1093 | 'label' => \_\_('All required fields', 'quiz-master-next'), |
  | 1057 | 1094 | 'type' => 'text', |
  | 1058 |  | 'default' => ~~'Please complete all required fields!'~~ |
  |  | 1095 | 'default' => \_\_('Please complete all required fields!', 'quiz-master-next') |
  | 1059 | 1096 | ); |
  | 1060 | 1097 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_text' ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1065) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1102) |  |
  | 1065 | 1102 | 'label' => \_\_('Invalid email', 'quiz-master-next'), |
  | 1066 | 1103 | 'type' => 'text', |
  | 1067 |  | 'default' => ~~'Not a valid e-mail address!'~~ |
  |  | 1104 | 'default' => \_\_('Not a valid e-mail address!', 'quiz-master-next') |
  | 1068 | 1105 | ); |
  | 1069 | 1106 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_text' ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1074) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1111) |  |
  | 1074 | 1111 | 'label' => \_\_('Invalid number', 'quiz-master-next'), |
  | 1075 | 1112 | 'type' => 'text', |
  | 1076 |  | 'default' => ~~'This field must be a number!'~~ |
  |  | 1113 | 'default' => \_\_('This field must be a number!', 'quiz-master-next') |
  | 1077 | 1114 | ); |
  | 1078 | 1115 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_text' ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1083) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1120) |  |
  | 1083 | 1120 | 'label' => \_\_('Invalid Captcha', 'quiz-master-next'), |
  | 1084 | 1121 | 'type' => 'text', |
  | 1085 |  | 'default' => ~~'The entered text is not correct!'~~ |
  |  | 1122 | 'default' => \_\_('The entered text is not correct!', 'quiz-master-next') |
  | 1086 | 1123 | ); |
  | 1087 | 1124 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_text' ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1110) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1147) |  |
  | 1110 | 1147 | 'label' => \_\_('Hint Text', 'quiz-master-next'), |
  | 1111 | 1148 | 'type' => 'text', |
  | 1112 |  | 'default' => ~~'Hint'~~ |
  |  | 1149 | 'default' => \_\_('Hint', 'quiz-master-next') |
  | 1113 | 1150 | ); |
  | 1114 | 1151 | $mlwQuizMasterNext->pluginHelper->register\_quiz\_setting( $field\_array, 'quiz\_text' ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1119) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1156) |  |
  | 1119 | 1156 | 'label' => \_\_('Correct answer message', 'quiz-master-next'), |
  | 1120 | 1157 | 'type' => 'text', |
  | 1121 |  | 'default' => ~~'Correct! You have selected correct answer.'~~, |
  |  | 1158 | 'default' => \_\_('Correct! You have selected correct answer.', 'quiz-master-next'), |
  | 1122 | 1159 | 'tooltip' => \_\_('Text to show when the selected option is correct answer.', 'quiz-master-next') |
  | 1123 | 1160 | ); |
  | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2463503#L1129) | […](/browser/quiz-master-next/trunk/php/classes/class-qsm-install.php?rev=2479603#L1166) |  |
  | 1129 | 1166 | 'label' => \_\_('Incorrect answer message', 'quiz-master-next'), |
  | 1130 | 1167 | 'type' => 'text', |
  | 1131 |  | 'default' => ~~'Wrong! You have selected wrong answer.'~~, |
  |  | 1168 | 'default' => \_\_('Wrong! You have selected wrong answer.', 'quiz-master-next'), |
  | 1132 | 1169 | 'tooltip' => \_\_('Text to show when the selected option is wrong answer.', 'quiz-master-next') |
  | 1133 | 1170 | ); |
* ## [quiz-master-next/trunk/php/question-types.php](/changeset/2479603/quiz-master-next/trunk/php/question-types.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/question-types.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | if ( ! defined( 'ABSPATH' ) ) ~~exit;~~ |
  | 3 |  | ~~add\_action("plugins\_loaded", 'qmn\_question\_type\_multiple\_choice')~~; |
  | 4 |  |  |
  | 5 |  | /\*\* |
  | 6 |  | \* Registers the multiple choice type |
  | 7 |  | \* |
  | 8 |  | \* @return void |
  | 9 |  | \* @since 4.4.0 |
  | 10 |  | \*/ |
  | 11 |  | function qmn\_question\_type\_multiple\_choice() |
  | 12 |  | { |
  | 13 |  | global $mlwQuizMasterNext; |
  | 14 |  | ~~$mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Vertical Multiple Choice", 'quiz-master-next'), 'qmn\_multiple\_choice\_display', true, 'qmn\_multiple\_choice\_review', null, null, 0)~~; |
  | 15 |  | } |
  | 16 |  |  |
  | 17 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_file\_upload'); |
  | 18 |  | /\*\* |
  | 19 |  | \* Registers the file upload type |
  | 20 |  | \* |
  | 21 |  | \* @return void |
  | 22 |  | \* @since 6.3.7 |
  | 23 |  | \*/ |
  | 24 |  | function qmn\_question\_type\_file\_upload(){ |
  | 25 |  | global $mlwQuizMasterNext; |
  | 26 |  | ~~$mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("File Upload", 'quiz-master-next'), 'qmn\_file\_upload\_display', true, 'qmn\_file\_upload\_review', null, null, 11)~~; |
  | 27 |  | } |
  | 28 |  |  |
  | 29 |  | /\*\* |
  | 30 |  | \* This function shows the content of the file upload |
  | 31 |  | \* |
  | 32 |  | \* @params $id The ID of the multiple choice question |
  | 33 |  | \* @params $question The question that is being edited. |
  | 34 |  | ~~\* @params @answers The array that contains the answers to the question~~. |
  | 35 |  | \* @return $question\_display Contains all the content of the question |
  | 36 |  | \* @since 6.3.7 |
  | 37 |  | \*/ |
  | 38 |  | function qmn\_file\_upload\_display($id, $question, $answers) |
  | 39 |  | { |
  | 40 |  | $question\_display = ''; |
  | 41 |  | global $mlwQuizMasterNext; |
  | 42 |  | ~~$required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'~~); |
  | 43 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredFileUpload";} else {$mlw\_requireClass = "";} |
  | 44 |  | ~~//$question\_title = apply\_filters('the\_content', $question)~~; |
  | 45 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 46 |  | $question\_display .= qsm\_question\_title\_func($question,'',$new\_question\_title); |
  | 47 |  | ~~$question\_display .= "<div style=''></div><input type='file' class='mlw\_answer\_file\_upload $mlw\_requireClass'/>"~~; |
  | 48 |  | ~~$question\_display .= "<div style='display: none;' class='loading-uploaded-file'><img src='".get\_site\_url()."/wp-includes/images/spinner-2x.gif'></div>"~~; |
  | 49 |  | ~~$question\_display .= "<div style='display: none;' class='remove-uploaded-file'><span class='dashicons dashicons-trash'></span></div>"~~; |
  | 50 |  | ~~$question\_display .= "<input class='mlw\_file\_upload\_hidden\_value' type='hidden' name='question".$id."' value=''~~ />"; |
  | 51 |  | ~~$question\_display .= "<span style='display: none;' class='mlw-file-upload-error-msg'></span~~>"; |
  | 52 |  | ~~$question\_display .= "<input class='mlw\_file\_upload\_hidden\_path' type='hidden' value='' /~~>"; |
  | 53 |  | ~~return apply\_filters('qmn\_file\_upload\_display\_front',$question\_display,$id, $question, $answers)~~; |
  | 54 |  | } |
  | 55 |  |  |
  | 56 |  | /\*\* |
  | 57 |  | \* This function determines how the file upload will work. |
  | 58 |  | \* |
  | 59 |  | \* @params $id The ID of the multiple choice question |
  | 60 |  | ~~\* @params $question The question that is being edited~~. |
  | 61 |  | \* @params @answers The array that contains the answers to the question. |
  | 62 |  | \* @return $return\_array Returns the graded question to the results page |
  | 63 |  | \* @since 5.3.7 |
  | 64 |  | \*/ |
  | 65 |  | function qmn\_file\_upload\_review($id, $question, $answers){ |
  | 66 |  | ~~$return\_array = array(~~ |
  | 67 |  | ~~'points' => 0,~~ |
  | 68 |  | 'correct' => 'incorrect', |
  | 69 |  | 'user\_text' => '', |
  | 70 |  | ~~'correct\_text' => ''~~, |
  | 71 |  | 'question\_type' => 'file\_upload' |
  | 72 |  | ); |
  | 73 |  | if ( isset( $\_POST["question".$id] ) ) { |
  | 74 |  | $decode\_user\_answer = sanitize\_text\_field( $\_POST["question".$id] ); |
  | 75 |  | $mlw\_user\_answer = trim( $decode\_user\_answer ); |
  | 76 |  | ~~} else~~ { |
  | 77 |  | ~~$mlw\_user\_answer = " "~~; |
  | 78 |  | } |
  | 79 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 80 |  | foreach($answers as $answer) |
  | 81 |  | { |
  | 82 |  | ~~$decode\_correct\_text = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES))~~; |
  | 83 |  | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_correct\_text ) ) ); |
  | 84 |  | if (mb\_strtoupper($return\_array['user\_text']) == mb\_strtoupper($return\_array['correct\_text'])) |
  | 85 |  | { |
  | 86 |  | $return\_array['correct'] = "correct"; |
  | 87 |  | ~~$return\_array['points'] = $answer[1]~~; |
  | 88 |  | ~~break~~; |
  | 89 |  | } |
  | 90 |  | } |
  | 91 |  | return $return\_array; |
  | 92 |  | } |
  | 93 |  |  |
  | 94 |  | /\*\* |
  | 95 |  | \* This function shows the content of the multiple choice question. |
  | 96 |  | \* |
  | 97 |  | \* @params $id The ID of the multiple choice question |
  | 98 |  | \* @params $question The question that is being edited. |
  | 99 |  | ~~\* @params @answers The array that contains the answers to the question~~. |
  | 100 |  | \* @return $question\_display Contains all the content of the question |
  | 101 |  | \* @since 4.4.0 |
  | 102 |  | \*/ |
  | 103 |  | function qmn\_multiple\_choice\_display($id, $question, $answers) |
  | 104 |  | { |
  | 105 |  | $question\_display = ''; |
  | 106 |  | global $mlwQuizMasterNext; |
  | 107 |  | ~~$answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'answerEditor'~~); |
  | 108 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 109 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 110 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredRadio";} else {$mlw\_requireClass = "";} |
  | 111 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 112 |  | $question\_display .= qsm\_question\_title\_func($question,'multiple\_choice',$new\_question\_title); |
  | 113 |  | $question\_display .= "<div class='qmn\_radio\_answers $mlw\_requireClass'>"; |
  | 114 |  | if (is\_array($answers)) |
  | 115 |  | { |
  | 116 |  | ~~$mlw\_answer\_total = 0~~; |
  | 117 |  | foreach($answers as $answer) |
  | 118 |  | { |
  | 119 |  | $mlw\_answer\_total++; |
  | 120 |  | if ($answer[0] != "") |
  | 121 |  | { |
  | 122 |  | ~~if($answerEditor === 'rich')~~{ |
  | 123 |  | $question\_display .= "<div class='qmn\_mc\_answer\_wrap' id='question$id-$mlw\_answer\_total'>"; |
  | 124 |  | ~~}else~~{ |
  | 125 |  | ~~$question\_display .= "<div class='qmn\_mc\_answer\_wrap' id='question".$id."-".str\_replace(" ","-",esc\_attr($answer[0])).~~"'>"; |
  | 126 |  | } |
  | 127 |  | ~~$question\_display .= "<input type='radio' class='qmn\_quiz\_radio' name='question".$id."' id='question".$id."\_".$mlw\_answer\_total."' value='". $answer[0] .~~"' />"; |
  | 128 |  | ~~$question\_display .= "<label for='question".$id."\_".$mlw\_answer\_total."'>". trim(do\_shortcode(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)) ) ."</label>"~~; |
  | 129 |  | ~~$question\_display .= "</div>"~~; |
  | 130 |  | } |
  | 131 |  | } |
  | 132 |  | ~~$question\_display .= "<input type='radio' style='display: none;' name='question".$id."' id='question".$id.~~"\_none' checked='checked' value='' />"; |
  | 133 |  | } |
  | 134 |  | ~~$question\_display .= "</div>"~~; |
  | 135 |  | ~~return apply\_filters('qmn\_multiple\_choice\_display\_front',$question\_display,$id, $question, $answers~~); |
  | 136 |  | } |
  | 137 |  |  |
  | 138 |  | /\*\* |
  | 139 |  | \* This function determines how the multiple choice question is graded. |
  | 140 |  | \* |
  | 141 |  | \* @params $id The ID of the multiple choice question |
  | 142 |  | \* @params $question The question that is being edited. |
  | 143 |  | \* @params @answers The array that contains the answers to the question. |
  | 144 |  | \* @return $return\_array Returns the graded question to the results page |
  | 145 |  | \* @since 4.4.0 |
  | 146 |  | \*/ |
  | 147 |  | function qmn\_multiple\_choice\_review(~~$id, $question, $answers~~) { |
  |  | 2 | if ( ! defined( 'ABSPATH' ) ) { |
  |  | 3 | exit; |
  |  | 4 | } |
  |  | 5 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_multiple\_choice' ); |
  |  | 6 |  |
  |  | 7 | /\*\* |
  |  | 8 | \* Registers the multiple choice type |
  |  | 9 | \* |
  |  | 10 | \* @return void |
  |  | 11 | \* @since 4.4.0 |
  |  | 12 | \*/ |
  |  | 13 | function qmn\_question\_type\_multiple\_choice() { |
  |  | 14 | global $mlwQuizMasterNext; |
  |  | 15 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Vertical Multiple Choice', 'quiz-master-next' ), 'qmn\_multiple\_choice\_display', true, 'qmn\_multiple\_choice\_review', null, null, 0 ); |
  |  | 16 | } |
  |  | 17 |  |
  |  | 18 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_file\_upload' ); |
  |  | 19 | /\*\* |
  |  | 20 | \* Registers the file upload type |
  |  | 21 | \* |
  |  | 22 | \* @return void |
  |  | 23 | \* @since 6.3.7 |
  |  | 24 | \*/ |
  |  | 25 | function qmn\_question\_type\_file\_upload() { |
  |  | 26 | global $mlwQuizMasterNext; |
  |  | 27 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'File Upload', 'quiz-master-next' ), 'qmn\_file\_upload\_display', true, 'qmn\_file\_upload\_review', null, null, 11 ); |
  |  | 28 | } |
  |  | 29 |  |
  |  | 30 | /\*\* |
  |  | 31 | \* This function shows the content of the file upload |
  |  | 32 | \* |
  |  | 33 | \* @param $id The ID of the multiple choice question |
  |  | 34 | \* @param $question The question that is being edited. |
  |  | 35 | \* @param @answers The array that contains the answers to the question. |
  |  | 36 | \* @return $question\_display Contains all the content of the question |
  |  | 37 | \* @since 6.3.7 |
  |  | 38 | \*/ |
  |  | 39 | function qmn\_file\_upload\_display( $id, $question, $answers ) { |
  |  | 40 | $question\_display = ''; |
  |  | 41 | global $mlwQuizMasterNext; |
  |  | 42 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 43 | if ( $required == 0 ) { |
  |  | 44 | $mlw\_requireClass = 'mlwRequiredFileUpload'; |
  |  | 45 | } else { |
  |  | 46 | $mlw\_requireClass = '';} |
  |  | 47 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 48 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 49 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 50 | $question\_display  .= "<div style=''></div><input type='file' class='mlw\_answer\_file\_upload $mlw\_requireClass'/>"; |
  |  | 51 | $question\_display  .= "<div style='display: none;' class='loading-uploaded-file'><img src='" . get\_site\_url() . "/wp-includes/images/spinner-2x.gif'></div>"; |
  |  | 52 | $question\_display  .= "<div style='display: none;' class='remove-uploaded-file'><span class='dashicons dashicons-trash'></span></div>"; |
  |  | 53 | $question\_display  .= "<input class='mlw\_file\_upload\_hidden\_value' type='hidden' name='question" . $id . "' value='' />"; |
  |  | 54 | $question\_display  .= "<span style='display: none;' class='mlw-file-upload-error-msg'></span>"; |
  |  | 55 | $question\_display  .= "<input class='mlw\_file\_upload\_hidden\_path' type='hidden' value='' />"; |
  |  | 56 | return apply\_filters( 'qmn\_file\_upload\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 57 | } |
  |  | 58 |  |
  |  | 59 | /\*\* |
  |  | 60 | \* This function determines how the file upload will work. |
  |  | 61 | \* |
  |  | 62 | \* @params $id The ID of the multiple choice question |
  |  | 63 | \* @params $question The question that is being edited. |
  |  | 64 | \* @params @answers The array that contains the answers to the question. |
  |  | 65 | \* @return $return\_array Returns the graded question to the results page |
  |  | 66 | \* @since 5.3.7 |
  |  | 67 | \*/ |
  |  | 68 | function qmn\_file\_upload\_review( $id, $question, $answers ) { |
  |  | 69 | $return\_array = array( |
  |  | 70 | 'points'        => 0, |
  |  | 71 | 'correct'       => 'incorrect', |
  |  | 72 | 'user\_text'     => '', |
  |  | 73 | 'correct\_text'  => '', |
  |  | 74 | 'question\_type' => 'file\_upload', |
  |  | 75 | ); |
  |  | 76 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 77 | $decode\_user\_answer = sanitize\_text\_field( $\_POST[ 'question' . $id ] ); |
  |  | 78 | $mlw\_user\_answer    = trim( $decode\_user\_answer ); |
  |  | 79 | } else { |
  |  | 80 | $mlw\_user\_answer = ' '; |
  |  | 81 | } |
  |  | 82 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 83 | foreach ( $answers as $answer ) { |
  |  | 84 | $decode\_correct\_text          = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 85 | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_correct\_text ) ) ); |
  |  | 86 | if ( mb\_strtoupper( $return\_array['user\_text'] ) == mb\_strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 87 | $return\_array['correct'] = 'correct'; |
  |  | 88 | $return\_array['points']  = $answer[1]; |
  |  | 89 | break; |
  |  | 90 | } |
  |  | 91 | } |
  |  | 92 | return $return\_array; |
  |  | 93 | } |
  |  | 94 |  |
  |  | 95 | /\*\* |
  |  | 96 | \* This function shows the content of the multiple choice question. |
  |  | 97 | \* |
  |  | 98 | \* @params $id The ID of the multiple choice question |
  |  | 99 | \* @params $question The question that is being edited. |
  |  | 100 | \* @params @answers The array that contains the answers to the question. |
  |  | 101 | \* @return $question\_display Contains all the content of the question |
  |  | 102 | \* @since 4.4.0 |
  |  | 103 | \*/ |
  |  | 104 | function qmn\_multiple\_choice\_display( $id, $question, $answers ) { |
  |  | 105 | $question\_display = ''; |
  |  | 106 | global $mlwQuizMasterNext; |
  |  | 107 | $answerEditor       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'answerEditor' ); |
  |  | 108 | $required           = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 109 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 110 | if ( $required == 0 ) { |
  |  | 111 | $mlw\_requireClass = 'mlwRequiredRadio'; |
  |  | 112 | } else { |
  |  | 113 | $mlw\_requireClass = '';} |
  |  | 114 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 115 | $question\_display .= qsm\_question\_title\_func( $question, 'multiple\_choice', $new\_question\_title ); |
  |  | 116 | $question\_display .= "<div class='qmn\_radio\_answers $mlw\_requireClass'>"; |
  |  | 117 | if ( is\_array( $answers ) ) { |
  |  | 118 | $mlw\_answer\_total = 0; |
  |  | 119 | foreach ( $answers as $answer ) { |
  |  | 120 | $mlw\_answer\_total++; |
  |  | 121 | if ( $answer[0] != '' ) { |
  |  | 122 | if ( $answerEditor === 'rich' ) { |
  |  | 123 | $question\_display .= "<div class='qmn\_mc\_answer\_wrap' id='question$id-$mlw\_answer\_total'>"; |
  |  | 124 | } else { |
  |  | 125 | $question\_display .= "<div class='qmn\_mc\_answer\_wrap' id='question" . $id . '-' . str\_replace( ' ', '-', esc\_attr( $answer[0] ) ) . "'>"; |
  |  | 126 | } |
  |  | 127 | $question\_display .= "<input type='radio' class='qmn\_quiz\_radio' name='question" . $id . "' id='question" . $id . '\_' . $mlw\_answer\_total . "' value='" . $answer[0] . "' />"; |
  |  | 128 | $question\_display .= "<label for='question" . $id . '\_' . $mlw\_answer\_total . "'>" . trim( do\_shortcode( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '</label>'; |
  |  | 129 | $question\_display .= '</div>'; |
  |  | 130 | } |
  |  | 131 | } |
  |  | 132 | $question\_display .= "<input type='radio' style='display: none;' name='question" . $id . "' id='question" . $id . "\_none' checked='checked' value='' />"; |
  |  | 133 | } |
  |  | 134 | $question\_display .= '</div>'; |
  |  | 135 | return apply\_filters( 'qmn\_multiple\_choice\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 136 | } |
  |  | 137 |  |
  |  | 138 | /\*\* |
  |  | 139 | \* This function determines how the multiple choice question is graded. |
  |  | 140 | \* |
  |  | 141 | \* @params $id The ID of the multiple choice question |
  |  | 142 | \* @params $question The question that is being edited. |
  |  | 143 | \* @params @answers The array that contains the answers to the question. |
  |  | 144 | \* @return $return\_array Returns the graded question to the results page |
  |  | 145 | \* @since 4.4.0 |
  |  | 146 | \*/ |
  |  | 147 | function qmn\_multiple\_choice\_review( $id, $question, $answers ) { |
  | 148 | 148 | global $mlwQuizMasterNext; |
  | 149 | 149 | $return\_array = array( |
  | 150 |  | 'points' => 0, |
  | 151 |  | 'correct' => 'incorrect', |
  | 152 |  | 'user\_text' => '', |
  | 153 |  | 'correct\_text' => '' |
  | 154 |  | ); |
  | 155 |  | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting(~~$id, 'answerEditor'~~); |
  | 156 |  | if (~~isset($\_POST["question" . $id])~~) { |
  | 157 |  | $mlw\_user\_answer = $\_POST[~~"question" . $id~~]; |
  | 158 |  | $mlw\_user\_answer = trim(~~stripslashes(htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES))~~); |
  | 159 |  | } else { |
  | 160 |  | $mlw\_user\_answer = ~~" "~~; |
  | 161 |  | } |
  | 162 |  | $return\_array['user\_text'] = stripslashes(~~htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES)~~); |
  | 163 |  | $rich\_text\_comapre ~~= preg\_replace("/\s+|\n+|\r/", ' ', htmlentities($mlw\_user\_answer)~~); |
  | 164 |  | $correct\_text = array(); |
  | 165 |  | foreach (~~$answers as $answer~~) { |
  | 166 |  | if (~~$answerEditor === 'rich'~~) { |
  | 167 |  | $answer\_option ~~= stripslashes(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  | 168 |  | $sinel\_answer\_cmp = preg\_replace(~~"/\s+|\n+|\r/", ' ', htmlentities($answer\_option)~~); |
  | 169 |  | if (~~$rich\_text\_comapre == $sinel\_answer\_cmp~~) { |
  | 170 |  | $return\_array[~~"points"]~~ = $answer[1]; |
  | 171 |  | $return\_array[~~"user\_text"~~] = $answer[0]; |
  | 172 |  | if (~~$answer[2] == 1~~) { |
  | 173 |  | $return\_array[~~"correct"] = "correct"~~; |
  |  | 150 | 'points'       => 0, |
  |  | 151 | 'correct'      => 'incorrect', |
  |  | 152 | 'user\_text'    => '', |
  |  | 153 | 'correct\_text' => '', |
  |  | 154 | ); |
  |  | 155 | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'answerEditor' ); |
  |  | 156 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 157 | $mlw\_user\_answer = $\_POST[ 'question' . $id ]; |
  |  | 158 | $mlw\_user\_answer = trim( stripslashes( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ) ); |
  |  | 159 | } else { |
  |  | 160 | $mlw\_user\_answer = ' '; |
  |  | 161 | } |
  |  | 162 | $return\_array['user\_text'] = stripslashes( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ); |
  |  | 163 | $rich\_text\_comapre         = preg\_replace( "/\s+|\n+|\r/", ' ', htmlentities( $mlw\_user\_answer ) ); |
  |  | 164 | $correct\_text              = array(); |
  |  | 165 | foreach ( $answers as $answer ) { |
  |  | 166 | if ( $answerEditor === 'rich' ) { |
  |  | 167 | $answer\_option    = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 168 | $sinel\_answer\_cmp = preg\_replace( "/\s+|\n+|\r/", ' ', htmlentities( $answer\_option ) ); |
  |  | 169 | if ( $rich\_text\_comapre == $sinel\_answer\_cmp ) { |
  |  | 170 | $return\_array['points']    = $answer[1]; |
  |  | 171 | $return\_array['user\_text'] = $answer[0]; |
  |  | 172 | if ( $answer[2] == 1 ) { |
  |  | 173 | $return\_array['correct'] = 'correct'; |
  | 174 | 174 | } |
  | 175 | 175 | } |
  | 176 |  | if (~~$answer[2] == 1~~) { |
  | 177 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  |  | 176 | if ( $answer[2] == 1 ) { |
  |  | 177 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  | 178 | 178 | } |
  | 179 | 179 | } else { |
  | 180 | 180 | $mlw\_user\_answer = ''; |
  | 181 |  | if (~~isset($\_POST["question" . $id])~~) { |
  | 182 |  | $mlw\_user\_answer = $\_POST[~~"question" . $id~~]; |
  | 183 |  | $mlw\_user\_answer = trim(~~htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES)~~); |
  | 184 |  | $mlw\_user\_answer = str\_replace(~~'\\', "", $mlw\_user\_answer~~); |
  | 185 |  | } |
  | 186 |  | $single\_answer = trim(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  | 187 |  | $single\_answer = str\_replace(~~'\\', "", $single\_answer~~); |
  | 188 |  | if (~~$mlw\_user\_answer == $single\_answer~~) { |
  | 189 |  | $return\_array[~~"points"]~~ = $answer[1]; |
  | 190 |  | $return\_array[~~"user\_text"~~] = $answer[0]; |
  | 191 |  | if (~~$answer[2] == 1~~) { |
  | 192 |  | $return\_array[~~"correct"] = "correct"~~; |
  |  | 181 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 182 | $mlw\_user\_answer = $\_POST[ 'question' . $id ]; |
  |  | 183 | $mlw\_user\_answer = trim( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ); |
  |  | 184 | $mlw\_user\_answer = str\_replace( '\\', '', $mlw\_user\_answer ); |
  |  | 185 | } |
  |  | 186 | $single\_answer = trim( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 187 | $single\_answer = str\_replace( '\\', '', $single\_answer ); |
  |  | 188 | if ( $mlw\_user\_answer == $single\_answer ) { |
  |  | 189 | $return\_array['points']    = $answer[1]; |
  |  | 190 | $return\_array['user\_text'] = $answer[0]; |
  |  | 191 | if ( $answer[2] == 1 ) { |
  |  | 192 | $return\_array['correct'] = 'correct'; |
  | 193 | 193 | } |
  | 194 | 194 | } |
  | 195 |  | if (~~$answer[2] == 1~~) { |
  | 196 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  | 197 |  | } |
  | 198 |  | } |
  | 199 |  | } |
  | 200 |  | $return\_array[~~"correct\_text"] = implode('.', $correct\_text~~); |
  |  | 195 | if ( $answer[2] == 1 ) { |
  |  | 196 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 197 | } |
  |  | 198 | } |
  |  | 199 | } |
  |  | 200 | $return\_array['correct\_text'] = implode( '.', $correct\_text ); |
  | 201 | 201 | return $return\_array; |
  | 202 | 202 | } |
  | 203 | 203 |  |
  | 204 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_date'); |
  | 205 |  | /\*\* |
  | 206 |  | \* Registers the date type |
  | 207 |  | \* |
  | 208 |  | \* @return void |
  | 209 |  | \* @since 6.3.7 |
  | 210 |  | \*/ |
  | 211 |  | function qmn\_question\_type\_date(){ |
  | 212 |  | global $mlwQuizMasterNext; |
  | 213 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Date", 'quiz-master-next'), 'qmn\_date\_display', true, 'qmn\_date\_review', null, null, 12); |
  | 214 |  | } |
  | 215 |  |  |
  | 216 |  | /\*\* |
  | 217 |  | \* This function shows the content of the date field |
  | 218 |  | \* |
  | 219 |  | \* @params $id The ID of the multiple choice question |
  | 220 |  | \* @params $question The question that is being edited. |
  | 221 |  | \* @params @answers The array that contains the answers to the question. |
  | 222 |  | \* @return $question\_display Contains all the content of the question |
  | 223 |  | \* @since 6.3.7 |
  | 224 |  | \*/ |
  | 225 |  | function qmn\_date\_display($id, $question, $answers) |
  | 226 |  | { |
  | 227 |  | $question\_display = ''; |
  | 228 |  | global $mlwQuizMasterNext; |
  | 229 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 230 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredDate";} else {$mlw\_requireClass = "";} |
  | 231 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 232 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 233 |  | $question\_display .= qsm\_question\_title\_func($question,'',$new\_question\_title); |
  | 234 |  | $question\_display .= "<input type='date' class='mlw\_answer\_date $mlw\_requireClass' name='question".$id."' id='question".$id."' value=''/>"; |
  | 235 |  | //$question\_display .= "<script>jQuery(document).ready(function () { jQuery('#question".$id."').datepicker();  });</script>"; |
  | 236 |  | return apply\_filters('qmn\_date\_display\_front',$question\_display,$id, $question, $answers); |
  | 237 |  | } |
  | 238 |  |  |
  | 239 |  | /\*\* |
  | 240 |  | \* This function reviews the date type. |
  | 241 |  | \* |
  | 242 |  | \* @params $id The ID of the multiple choice question |
  | 243 |  | \* @params $question The question that is being edited. |
  | 244 |  | \* @params @answers The array that contains the answers to the question. |
  | 245 |  | \* @return $return\_array Returns the graded question to the results page |
  | 246 |  | \* @since 6.3.7 |
  | 247 |  | \*/ |
  | 248 |  | function qmn\_date\_review($id, $question, $answers) { |
  | 249 |  | $return\_array = array( |
  | 250 |  | 'points' => 0, |
  | 251 |  | 'correct' => 'incorrect', |
  | 252 |  | 'user\_text' => '', |
  | 253 |  | 'correct\_text' => '' |
  | 254 |  | ); |
  | 255 |  | if (isset($\_POST["question" . $id])) { |
  | 256 |  | $decode\_user\_answer = sanitize\_textarea\_field(strval(stripslashes(htmlspecialchars\_decode($\_POST["question" . $id], ENT\_QUOTES)))); |
  | 257 |  | $mlw\_user\_answer = trim(preg\_replace('/\s\s+/', ' ', str\_replace("\n", " ", $decode\_user\_answer))); |
  | 258 |  | } else { |
  | 259 |  | $mlw\_user\_answer = " "; |
  | 260 |  | } |
  | 261 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 262 |  | foreach ($answers as $answer) { |
  | 263 |  | $decode\_correct\_text = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 264 |  | $return\_array['correct\_text'] = trim(preg\_replace('/\s\s+/', ' ', str\_replace("\n", " ", $decode\_correct\_text))); |
  | 265 |  | if (mb\_strtoupper($return\_array['user\_text']) == mb\_strtoupper($return\_array['correct\_text'])) { |
  | 266 |  | $return\_array['correct'] = "correct"; |
  | 267 |  | $return\_array['points'] = $answer[1]; |
  | 268 |  | break; |
  | 269 |  | } |
  | 270 |  | } |
  | 271 |  | return $return\_array; |
  | 272 |  | } |
  | 273 |  |  |
  | 274 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_horizontal\_multiple\_choice'); |
  | 275 |  |  |
  | 276 |  | /\*\* |
  | 277 |  | \* This function registers the horizontal multiple choice type. |
  | 278 |  | \* |
  | 279 |  | \* @return void |
  | 280 |  | \* @since 4.4.0 |
  | 281 |  | \*/ |
  | 282 |  | function qmn\_question\_type\_horizontal\_multiple\_choice() |
  | 283 |  | { |
  | 284 |  | global $mlwQuizMasterNext; |
  | 285 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Horizontal Multiple Choice", 'quiz-master-next'), 'qmn\_horizontal\_multiple\_choice\_display', true, 'qmn\_horizontal\_multiple\_choice\_review', null, null, 1); |
  | 286 |  | } |
  | 287 |  |  |
  | 288 |  | /\*\* |
  | 289 |  | \* This function shows the content of the horizontal multiple choice question. |
  | 290 |  | \* |
  | 291 |  | \* @params $id The ID of the multiple choice question |
  | 292 |  | \* @params $question The question that is being edited. |
  | 293 |  | \* @params @answers The array that contains the answers to the question. |
  | 294 |  | \* @return $question\_display Contains all the content of the question |
  | 295 |  | \* @since 4.4.0 |
  | 296 |  | \*/ |
  | 297 |  | function qmn\_horizontal\_multiple\_choice\_display($id, $question, $answers) |
  | 298 |  | { |
  | 299 |  | $question\_display = ''; |
  | 300 |  | global $mlwQuizMasterNext; |
  | 301 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 302 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredRadio";} else {$mlw\_requireClass = "";} |
  | 303 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 304 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 305 |  | $question\_display .= qsm\_question\_title\_func($question,'horizontal\_multiple\_choice',$new\_question\_title); |
  | 306 |  | $question\_display .= "<div class='qmn\_radio\_answers $mlw\_requireClass'>"; |
  | 307 |  | if (is\_array($answers)) |
  | 308 |  | { |
  | 309 |  | $mlw\_answer\_total = 0; |
  | 310 |  | foreach($answers as $answer) |
  | 311 |  | { |
  | 312 |  | $mlw\_answer\_total++; |
  | 313 |  | if ($answer[0] != "") |
  | 314 |  | { |
  | 315 |  | $question\_display .= "<span class='mlw\_horizontal\_choice'><input type='radio' class='qmn\_quiz\_radio' name='question".$id."' id='question".$id."\_".$mlw\_answer\_total."' value='". $answer[0] ."' /><label for='question".$id."\_".$mlw\_answer\_total."'>".trim(do\_shortcode(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)) )."</label></span>"; |
  | 316 |  | } |
  | 317 |  | } |
  | 318 |  | $question\_display .= "<input type='radio' style='display: none;' name='question".$id."' id='question".$id."\_none' checked='checked' value='' />"; |
  | 319 |  | } |
  | 320 |  | $question\_display .= "</div>"; |
  | 321 |  |  |
  | 322 |  | return apply\_filters('qmn\_horizontal\_multiple\_choice\_display\_front',$question\_display,$id, $question, $answers); |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | /\*\* |
  | 326 |  | \* This function determines how the question is graded. |
  | 327 |  | \* |
  | 328 |  | \* @params $id The ID of the multiple choice question |
  | 329 |  | \* @params $question The question that is being edited. |
  | 330 |  | \* @params @answers The array that contains the answers to the question. |
  | 331 |  | \* @return $return\_array Returns the graded question to the results page |
  | 332 |  | \* @since 4.4.0 |
  | 333 |  | \*/ |
  | 334 |  | function qmn\_horizontal\_multiple\_choice\_review($id, $question, $answers) { |
  | 335 |  | global $mlwQuizMasterNext; |
  | 336 |  | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'answerEditor'); |
  |  | 204 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_date' ); |
  |  | 205 | /\*\* |
  |  | 206 | \* Registers the date type |
  |  | 207 | \* |
  |  | 208 | \* @return void |
  |  | 209 | \* @since 6.3.7 |
  |  | 210 | \*/ |
  |  | 211 | function qmn\_question\_type\_date() { |
  |  | 212 | global $mlwQuizMasterNext; |
  |  | 213 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Date', 'quiz-master-next' ), 'qmn\_date\_display', true, 'qmn\_date\_review', null, null, 12 ); |
  |  | 214 | } |
  |  | 215 |  |
  |  | 216 | /\*\* |
  |  | 217 | \* This function shows the content of the date field |
  |  | 218 | \* |
  |  | 219 | \* @params $id The ID of the multiple choice question |
  |  | 220 | \* @params $question The question that is being edited. |
  |  | 221 | \* @params @answers The array that contains the answers to the question. |
  |  | 222 | \* @return $question\_display Contains all the content of the question |
  |  | 223 | \* @since 6.3.7 |
  |  | 224 | \*/ |
  |  | 225 | function qmn\_date\_display( $id, $question, $answers ) { |
  |  | 226 | $question\_display = ''; |
  |  | 227 | global $mlwQuizMasterNext; |
  |  | 228 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 229 | if ( $required == 0 ) { |
  |  | 230 | $mlw\_requireClass = 'mlwRequiredDate'; |
  |  | 231 | } else { |
  |  | 232 | $mlw\_requireClass = '';} |
  |  | 233 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 234 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 235 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 236 | $question\_display  .= "<input type='date' class='mlw\_answer\_date $mlw\_requireClass' name='question" . $id . "' id='question" . $id . "' value=''/>"; |
  |  | 237 | // $question\_display .= "<script>jQuery(document).ready(function () { jQuery('#question".$id."').datepicker();  });</script>"; |
  |  | 238 | return apply\_filters( 'qmn\_date\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 239 | } |
  |  | 240 |  |
  |  | 241 | /\*\* |
  |  | 242 | \* This function reviews the date type. |
  |  | 243 | \* |
  |  | 244 | \* @params $id The ID of the multiple choice question |
  |  | 245 | \* @params $question The question that is being edited. |
  |  | 246 | \* @params @answers The array that contains the answers to the question. |
  |  | 247 | \* @return $return\_array Returns the graded question to the results page |
  |  | 248 | \* @since 6.3.7 |
  |  | 249 | \*/ |
  |  | 250 | function qmn\_date\_review( $id, $question, $answers ) { |
  | 337 | 251 | $return\_array = array( |
  | 338 |  | 'points' => 0, |
  | 339 |  | 'correct' => 'incorrect', |
  | 340 |  | 'user\_text' => '', |
  | 341 |  | 'correct\_text' => '' |
  | 342 |  | ); |
  | 343 |  | if (isset($\_POST["question" . $id])) { |
  | 344 |  | $mlw\_user\_answer = $\_POST["question" . $id]; |
  | 345 |  | $mlw\_user\_answer = trim(stripslashes(htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES))); |
  | 346 |  | } else { |
  | 347 |  | $mlw\_user\_answer = " "; |
  | 348 |  | } |
  | 349 |  | $rich\_text\_comapre = preg\_replace("/\s+|\n+|\r/", ' ', htmlentities($mlw\_user\_answer)); |
  | 350 |  | $correct\_text = array(); |
  | 351 |  | foreach ($answers as $answer) { |
  | 352 |  | if ($answerEditor === 'rich') { |
  | 353 |  | $answer\_option = stripslashes(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 354 |  | $sinel\_answer\_cmp = preg\_replace("/\s+|\n+|\r/", ' ', htmlentities($answer\_option)); |
  | 355 |  | if ($rich\_text\_comapre == $sinel\_answer\_cmp) { |
  | 356 |  | $return\_array["points"] = $answer[1]; |
  | 357 |  | $return\_array["user\_text"] = $answer[0]; |
  | 358 |  | if ($answer[2] == 1) { |
  | 359 |  | $return\_array["correct"] = "correct"; |
  |  | 252 | 'points'       => 0, |
  |  | 253 | 'correct'      => 'incorrect', |
  |  | 254 | 'user\_text'    => '', |
  |  | 255 | 'correct\_text' => '', |
  |  | 256 | ); |
  |  | 257 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 258 | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST[ 'question' . $id ], ENT\_QUOTES ) ) ) ); |
  |  | 259 | $mlw\_user\_answer    = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_user\_answer ) ) ); |
  |  | 260 | } else { |
  |  | 261 | $mlw\_user\_answer = ' '; |
  |  | 262 | } |
  |  | 263 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 264 | foreach ( $answers as $answer ) { |
  |  | 265 | $decode\_correct\_text          = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 266 | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_correct\_text ) ) ); |
  |  | 267 | if ( mb\_strtoupper( $return\_array['user\_text'] ) == mb\_strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 268 | $return\_array['correct'] = 'correct'; |
  |  | 269 | $return\_array['points']  = $answer[1]; |
  |  | 270 | break; |
  |  | 271 | } |
  |  | 272 | } |
  |  | 273 | return $return\_array; |
  |  | 274 | } |
  |  | 275 |  |
  |  | 276 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_horizontal\_multiple\_choice' ); |
  |  | 277 |  |
  |  | 278 | /\*\* |
  |  | 279 | \* This function registers the horizontal multiple choice type. |
  |  | 280 | \* |
  |  | 281 | \* @return void |
  |  | 282 | \* @since 4.4.0 |
  |  | 283 | \*/ |
  |  | 284 | function qmn\_question\_type\_horizontal\_multiple\_choice() { |
  |  | 285 | global $mlwQuizMasterNext; |
  |  | 286 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Horizontal Multiple Choice', 'quiz-master-next' ), 'qmn\_horizontal\_multiple\_choice\_display', true, 'qmn\_horizontal\_multiple\_choice\_review', null, null, 1 ); |
  |  | 287 | } |
  |  | 288 |  |
  |  | 289 | /\*\* |
  |  | 290 | \* This function shows the content of the horizontal multiple choice question. |
  |  | 291 | \* |
  |  | 292 | \* @params $id The ID of the multiple choice question |
  |  | 293 | \* @params $question The question that is being edited. |
  |  | 294 | \* @params @answers The array that contains the answers to the question. |
  |  | 295 | \* @return $question\_display Contains all the content of the question |
  |  | 296 | \* @since 4.4.0 |
  |  | 297 | \*/ |
  |  | 298 | function qmn\_horizontal\_multiple\_choice\_display( $id, $question, $answers ) { |
  |  | 299 | $question\_display = ''; |
  |  | 300 | global $mlwQuizMasterNext; |
  |  | 301 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 302 | if ( $required == 0 ) { |
  |  | 303 | $mlw\_requireClass = 'mlwRequiredRadio'; |
  |  | 304 | } else { |
  |  | 305 | $mlw\_requireClass = '';} |
  |  | 306 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 307 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 308 | $question\_display  .= qsm\_question\_title\_func( $question, 'horizontal\_multiple\_choice', $new\_question\_title ); |
  |  | 309 | $question\_display  .= "<div class='qmn\_radio\_answers $mlw\_requireClass'>"; |
  |  | 310 | if ( is\_array( $answers ) ) { |
  |  | 311 | $mlw\_answer\_total = 0; |
  |  | 312 | foreach ( $answers as $answer ) { |
  |  | 313 | $mlw\_answer\_total++; |
  |  | 314 | if ( $answer[0] != '' ) { |
  |  | 315 | $question\_display .= "<span class='mlw\_horizontal\_choice'><input type='radio' class='qmn\_quiz\_radio' name='question" . $id . "' id='question" . $id . '\_' . $mlw\_answer\_total . "' value='" . $answer[0] . "' /><label for='question" . $id . '\_' . $mlw\_answer\_total . "'>" . trim( do\_shortcode( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '</label></span>'; |
  |  | 316 | } |
  |  | 317 | } |
  |  | 318 | $question\_display .= "<input type='radio' style='display: none;' name='question" . $id . "' id='question" . $id . "\_none' checked='checked' value='' />"; |
  |  | 319 | } |
  |  | 320 | $question\_display .= '</div>'; |
  |  | 321 |  |
  |  | 322 | return apply\_filters( 'qmn\_horizontal\_multiple\_choice\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 323 | } |
  |  | 324 |  |
  |  | 325 | /\*\* |
  |  | 326 | \* This function determines how the question is graded. |
  |  | 327 | \* |
  |  | 328 | \* @params $id The ID of the multiple choice question |
  |  | 329 | \* @params $question The question that is being edited. |
  |  | 330 | \* @params @answers The array that contains the answers to the question. |
  |  | 331 | \* @return $return\_array Returns the graded question to the results page |
  |  | 332 | \* @since 4.4.0 |
  |  | 333 | \*/ |
  |  | 334 | function qmn\_horizontal\_multiple\_choice\_review( $id, $question, $answers ) { |
  |  | 335 | global $mlwQuizMasterNext; |
  |  | 336 | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'answerEditor' ); |
  |  | 337 | $return\_array = array( |
  |  | 338 | 'points'       => 0, |
  |  | 339 | 'correct'      => 'incorrect', |
  |  | 340 | 'user\_text'    => '', |
  |  | 341 | 'correct\_text' => '', |
  |  | 342 | ); |
  |  | 343 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 344 | $mlw\_user\_answer = $\_POST[ 'question' . $id ]; |
  |  | 345 | $mlw\_user\_answer = trim( stripslashes( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ) ); |
  |  | 346 | } else { |
  |  | 347 | $mlw\_user\_answer = ' '; |
  |  | 348 | } |
  |  | 349 | $rich\_text\_comapre = preg\_replace( "/\s+|\n+|\r/", ' ', htmlentities( $mlw\_user\_answer ) ); |
  |  | 350 | $correct\_text      = array(); |
  |  | 351 | foreach ( $answers as $answer ) { |
  |  | 352 | if ( $answerEditor === 'rich' ) { |
  |  | 353 | $answer\_option    = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 354 | $sinel\_answer\_cmp = preg\_replace( "/\s+|\n+|\r/", ' ', htmlentities( $answer\_option ) ); |
  |  | 355 | if ( $rich\_text\_comapre == $sinel\_answer\_cmp ) { |
  |  | 356 | $return\_array['points']    = $answer[1]; |
  |  | 357 | $return\_array['user\_text'] = $answer[0]; |
  |  | 358 | if ( $answer[2] == 1 ) { |
  |  | 359 | $return\_array['correct'] = 'correct'; |
  | 360 | 360 | } |
  | 361 | 361 | } |
  | 362 |  | if (~~$answer[2] == 1~~) { |
  | 363 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  |  | 362 | if ( $answer[2] == 1 ) { |
  |  | 363 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  | 364 | 364 | } |
  | 365 | 365 | } else { |
  | 366 | 366 | $mlw\_user\_answer = ''; |
  | 367 |  | if (~~isset($\_POST["question" . $id])~~) { |
  | 368 |  | $mlw\_user\_answer = $\_POST[~~"question" . $id~~]; |
  | 369 |  | $mlw\_user\_answer = trim(~~htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES)~~); |
  | 370 |  | $mlw\_user\_answer = str\_replace(~~'\\', "", $mlw\_user\_answer~~); |
  | 371 |  | } |
  | 372 |  | $single\_answer = trim(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  | 373 |  | $single\_answer = str\_replace(~~'\\', "", $single\_answer~~); |
  | 374 |  | if (~~$mlw\_user\_answer == $single\_answer~~) { |
  | 375 |  | $return\_array[~~"points"]~~ = $answer[1]; |
  | 376 |  | $return\_array[~~"user\_text"~~] = $answer[0]; |
  | 377 |  | if (~~$answer[2] == 1~~) { |
  | 378 |  | $return\_array[~~"correct"] = "correct"~~; |
  |  | 367 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 368 | $mlw\_user\_answer = $\_POST[ 'question' . $id ]; |
  |  | 369 | $mlw\_user\_answer = trim( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ); |
  |  | 370 | $mlw\_user\_answer = str\_replace( '\\', '', $mlw\_user\_answer ); |
  |  | 371 | } |
  |  | 372 | $single\_answer = trim( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 373 | $single\_answer = str\_replace( '\\', '', $single\_answer ); |
  |  | 374 | if ( $mlw\_user\_answer == $single\_answer ) { |
  |  | 375 | $return\_array['points']    = $answer[1]; |
  |  | 376 | $return\_array['user\_text'] = $answer[0]; |
  |  | 377 | if ( $answer[2] == 1 ) { |
  |  | 378 | $return\_array['correct'] = 'correct'; |
  | 379 | 379 | } |
  | 380 | 380 | } |
  | 381 |  | if (~~$answer[2] == 1~~) { |
  | 382 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  | 383 |  | } |
  | 384 |  | } |
  | 385 |  | } |
  | 386 |  | $return\_array[~~"correct\_text"] = implode('.', $correct\_text~~); |
  |  | 381 | if ( $answer[2] == 1 ) { |
  |  | 382 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 383 | } |
  |  | 384 | } |
  |  | 385 | } |
  |  | 386 | $return\_array['correct\_text'] = implode( '.', $correct\_text ); |
  | 387 | 387 | return $return\_array; |
  | 388 | 388 | } |
  | 389 | 389 |  |
  | 390 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_drop\_down'); |
  | 391 |  |  |
  | 392 |  | /\*\* |
  | 393 |  | \* This function registers the drop down question type |
  | 394 |  | \* |
  | 395 |  | \* @return void |
  | 396 |  | \* @since 4.4.0 |
  | 397 |  | \*/ |
  | 398 |  | function qmn\_question\_type\_drop\_down() |
  | 399 |  | { |
  | 400 |  | global $mlwQuizMasterNext; |
  | 401 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Drop Down", 'quiz-master-next'), 'qmn\_drop\_down\_display', true, 'qmn\_drop\_down\_review', null, null, 2); |
  | 402 |  | } |
  | 403 |  |  |
  | 404 |  | /\*\* |
  | 405 |  | \* This function shows the content of the multiple choice question. |
  | 406 |  | \* |
  | 407 |  | \* @params $id The ID of the multiple choice question |
  | 408 |  | \* @params $question The question that is being edited. |
  | 409 |  | \* @params @answers The array that contains the answers to the question. |
  | 410 |  | \* @return $question\_display Contains all the content of the question |
  | 411 |  | \* @since 4.4.0 |
  | 412 |  | \*/ |
  | 413 |  | function qmn\_drop\_down\_display($id, $question, $answers) |
  | 414 |  | { |
  | 415 |  | $question\_display = ''; |
  | 416 |  | global $mlwQuizMasterNext; |
  | 417 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  | 418 |  | if ( 0 == $required ) { |
  | 419 |  | $require\_class = "qsmRequiredSelect"; |
  | 420 |  | } else { |
  | 421 |  | $require\_class = ""; |
  | 422 |  | } |
  | 423 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 424 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 425 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 426 |  | $question\_display .= "<select class='qsm\_select $require\_class' name='question".$id."'>"; |
  | 427 |  | $question\_display .= "<option value=''>" . \_\_('Please select your answer','quiz-master-next') . "</option>"; |
  | 428 |  | if (is\_array($answers)) |
  | 429 |  | { |
  | 430 |  | $mlw\_answer\_total = 0; |
  | 431 |  | foreach($answers as $answer) |
  | 432 |  | { |
  | 433 |  | $mlw\_answer\_total++; |
  | 434 |  | if ($answer[0] != "") |
  | 435 |  | { |
  | 436 |  | $question\_display .= "<option value='".esc\_attr($answer[0])."'>".htmlspecialchars\_decode($answer[0], ENT\_QUOTES)."</option>"; |
  | 437 |  | } |
  | 438 |  | } |
  | 439 |  | } |
  | 440 |  | $question\_display .= "</select>"; |
  | 441 |  | return apply\_filters('qmn\_drop\_down\_display\_front',$question\_display,$id, $question, $answers); |
  | 442 |  | } |
  | 443 |  |  |
  | 444 |  | /\*\* |
  | 445 |  | \* This function determines how the question is graded |
  | 446 |  | \* |
  | 447 |  | \* @params $id The ID of the multiple choice question |
  | 448 |  | \* @params $question The question that is being edited. |
  | 449 |  | \* @params @answers The array that contains the answers to the question. |
  | 450 |  | \* @return $return\_array Returns the graded question to the results page |
  | 451 |  | \* @since 4.4.0 |
  | 452 |  | \*/ |
  | 453 |  | function qmn\_drop\_down\_review($id, $question, $answers) |
  | 454 |  | { |
  | 455 |  | global $mlwQuizMasterNext; |
  | 456 |  | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'answerEditor'); |
  | 457 |  | $return\_array = array( |
  | 458 |  | 'points' => 0, |
  | 459 |  | 'correct' => 'incorrect', |
  | 460 |  | 'user\_text' => '', |
  | 461 |  | 'correct\_text' => '' |
  | 462 |  | ); |
  | 463 |  | if (isset($\_POST["question".$id])) { |
  | 464 |  | $mlw\_user\_answer = $\_POST["question".$id]; |
  | 465 |  | $mlw\_user\_answer = trim( stripslashes( htmlspecialchars\_decode($mlw\_user\_answer, ENT\_QUOTES) ) ); |
  | 466 |  | } else { |
  | 467 |  | $mlw\_user\_answer = " "; |
  | 468 |  | } |
  | 469 |  | foreach($answers as $answer) |
  | 470 |  | { |
  | 471 |  | $answers\_loop = trim( stripslashes( htmlspecialchars\_decode($answer[0], ENT\_QUOTES) ) ); |
  | 472 |  | if ( $mlw\_user\_answer == $answers\_loop ) |
  | 473 |  | { |
  | 474 |  | $return\_array["points"] = $answer[1]; |
  | 475 |  | $return\_array["user\_text"] = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 476 |  | if ($answer[2] == 1) |
  | 477 |  | { |
  | 478 |  | $return\_array["correct"] = "correct"; |
  | 479 |  | } |
  | 480 |  | } |
  | 481 |  | if ($answer[2] == 1) |
  | 482 |  | { |
  | 483 |  | $return\_array["correct\_text"] = htmlspecialchars\_decode($answer[0], ENT\_QUOTES); |
  | 484 |  | } |
  | 485 |  | } |
  | 486 |  | return $return\_array; |
  | 487 |  | } |
  | 488 |  |  |
  | 489 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_small\_open'); |
  | 490 |  |  |
  | 491 |  | /\*\* |
  | 492 |  | \* This function registers the small open question type |
  | 493 |  | \* |
  | 494 |  | \* @return void |
  | 495 |  | \* @since 4.4.0 |
  | 496 |  | \*/ |
  | 497 |  | function qmn\_question\_type\_small\_open() |
  | 498 |  | { |
  | 499 |  | global $mlwQuizMasterNext; |
  | 500 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Short Answer", 'quiz-master-next'), 'qmn\_small\_open\_display', true, 'qmn\_small\_open\_review', null, null, 3); |
  | 501 |  | } |
  | 502 |  |  |
  | 503 |  | /\*\* |
  | 504 |  | \* This function shows the content of the small open answer question. |
  | 505 |  | \* |
  | 506 |  | \* @params $id The ID of the multiple choice question |
  | 507 |  | \* @params $question The question that is being edited. |
  | 508 |  | \* @params @answers The array that contains the answers to the question. |
  | 509 |  | \* @return $question\_display Contains all the content of the question |
  | 510 |  | \* @since 4.4.0 |
  | 511 |  | \*/ |
  | 512 |  | function qmn\_small\_open\_display($id, $question, $answers) |
  | 513 |  | { |
  | 514 |  | $question\_display = ''; |
  | 515 |  | global $mlwQuizMasterNext; |
  | 516 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 517 |  | $autofill = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'autofill'); |
  | 518 |  | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_text'); |
  | 519 |  | $autofill\_att = $autofill ? "autocomplete='off' " : ''; |
  | 520 |  | $limit\_text\_att = $limit\_text ? "maxlength='". $limit\_text ."' " : ''; |
  | 521 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredText";} else {$mlw\_requireClass = "";} |
  | 522 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 523 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 524 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 525 |  | $question\_display .= "<input ". $autofill\_att . $limit\_text\_att . " type='text' class='mlw\_answer\_open\_text $mlw\_requireClass' name='question".$id."' />"; |
  | 526 |  | return apply\_filters('qmn\_small\_open\_display\_front',$question\_display,$id, $question, $answers); |
  | 527 |  | } |
  | 528 |  |  |
  | 529 |  | /\*\* |
  | 530 |  | \* This function reviews the small open answer. |
  | 531 |  | \* |
  | 532 |  | \* @params $id The ID of the multiple choice question |
  | 533 |  | \* @params $question The question that is being edited. |
  | 534 |  | \* @params @answers The array that contains the answers to the question. |
  | 535 |  | \* @return $return\_array Returns the graded question to the results page |
  | 536 |  | \* @since 4.4.0 |
  | 537 |  | \*/ |
  | 538 |  | function qmn\_small\_open\_review($id, $question, $answers) |
  | 539 |  | { |
  | 540 |  | $return\_array = array( |
  | 541 |  | 'points' => 0, |
  | 542 |  | 'correct' => 'incorrect', |
  | 543 |  | 'user\_text' => '', |
  | 544 |  | 'correct\_text' => '' |
  | 545 |  | ); |
  | 546 |  | if ( isset( $\_POST["question".$id] ) ) { |
  | 547 |  | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST["question".$id], ENT\_QUOTES ) ) ) ); |
  | 548 |  | $mlw\_user\_answer = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_user\_answer ) ) ); |
  | 549 |  | } else { |
  | 550 |  | $mlw\_user\_answer = " "; |
  | 551 |  | } |
  | 552 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 553 |  | foreach($answers as $answer) |
  | 554 |  | { |
  | 555 |  | $decode\_correct\_text = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 556 |  | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_correct\_text ) ) ); |
  | 557 |  | if (mb\_strtoupper($return\_array['user\_text']) == mb\_strtoupper($return\_array['correct\_text'])) |
  | 558 |  | { |
  | 559 |  | $return\_array['correct'] = "correct"; |
  | 560 |  | $return\_array['points'] = $answer[1]; |
  | 561 |  | break; |
  | 562 |  | } |
  | 563 |  | } |
  | 564 |  | return $return\_array; |
  | 565 |  | } |
  | 566 |  |  |
  | 567 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_multiple\_response'); |
  | 568 |  |  |
  | 569 |  | /\*\* |
  | 570 |  | \* This function registers the multiple response question type |
  | 571 |  | \* |
  | 572 |  | \* @return void |
  | 573 |  | \* @since 4.4.0 |
  | 574 |  | \*/ |
  | 575 |  | function qmn\_question\_type\_multiple\_response() |
  | 576 |  | { |
  | 577 |  | global $mlwQuizMasterNext; |
  | 578 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Multiple Response", 'quiz-master-next'), 'qmn\_multiple\_response\_display', true, 'qmn\_multiple\_response\_review', null, null, 4); |
  | 579 |  | } |
  | 580 |  |  |
  | 581 |  | /\*\* |
  | 582 |  | \* This function shows the content of the multiple response question |
  | 583 |  | \* |
  | 584 |  | \* @params $id The ID of the multiple choice question |
  | 585 |  | \* @params $question The question that is being edited. |
  | 586 |  | \* @params @answers The array that contains the answers to the question. |
  | 587 |  | \* @return $question\_display Contains all the content of the question |
  | 588 |  | \* @since 4.4.0 |
  | 589 |  | \*/ |
  | 590 |  | function qmn\_multiple\_response\_display($id, $question, $answers) |
  | 591 |  | { |
  | 592 |  | $question\_display = $limit\_mr\_text = ''; |
  | 593 |  | global $mlwQuizMasterNext; |
  | 594 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 595 |  | $limit\_multiple\_response = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_multiple\_response'); |
  | 596 |  | if($limit\_multiple\_response > 0) |
  | 597 |  | $limit\_mr\_text = 'onchange="qsmCheckMR(this,'. $limit\_multiple\_response .')"'; |
  | 598 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredCheck";} else {$mlw\_requireClass = "";} |
  | 599 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 600 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 601 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 602 |  | $question\_display .= "<div class='qmn\_check\_answers $mlw\_requireClass'>"; |
  | 603 |  | if (is\_array($answers)) |
  | 604 |  | { |
  | 605 |  | $mlw\_answer\_total = 0; |
  | 606 |  | foreach($answers as $answer) |
  | 607 |  | { |
  | 608 |  | $mlw\_answer\_total++; |
  | 609 |  | if ($answer[0] != "") |
  | 610 |  | { |
  |  | 390 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_drop\_down' ); |
  |  | 391 |  |
  |  | 392 | /\*\* |
  |  | 393 | \* This function registers the drop down question type |
  |  | 394 | \* |
  |  | 395 | \* @return void |
  |  | 396 | \* @since 4.4.0 |
  |  | 397 | \*/ |
  |  | 398 | function qmn\_question\_type\_drop\_down() { |
  |  | 399 | global $mlwQuizMasterNext; |
  |  | 400 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Drop Down', 'quiz-master-next' ), 'qmn\_drop\_down\_display', true, 'qmn\_drop\_down\_review', null, null, 2 ); |
  |  | 401 | } |
  |  | 402 |  |
  |  | 403 | /\*\* |
  |  | 404 | \* This function shows the content of the multiple choice question. |
  |  | 405 | \* |
  |  | 406 | \* @params $id The ID of the multiple choice question |
  |  | 407 | \* @params $question The question that is being edited. |
  |  | 408 | \* @params @answers The array that contains the answers to the question. |
  |  | 409 | \* @return $question\_display Contains all the content of the question |
  |  | 410 | \* @since 4.4.0 |
  |  | 411 | \*/ |
  |  | 412 | function qmn\_drop\_down\_display( $id, $question, $answers ) { |
  |  | 413 | $question\_display = ''; |
  |  | 414 | global $mlwQuizMasterNext; |
  |  | 415 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 416 | if ( 0 == $required ) { |
  |  | 417 | $require\_class = 'qsmRequiredSelect'; |
  |  | 418 | } else { |
  |  | 419 | $require\_class = ''; |
  |  | 420 | } |
  |  | 421 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 422 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 423 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 424 | $question\_display  .= "<select class='qsm\_select $require\_class' name='question" . $id . "'>"; |
  |  | 425 | $question\_display  .= "<option value=''>" . \_\_( 'Please select your answer', 'quiz-master-next' ) . '</option>'; |
  |  | 426 | if ( is\_array( $answers ) ) { |
  |  | 427 | $mlw\_answer\_total = 0; |
  |  | 428 | foreach ( $answers as $answer ) { |
  |  | 429 | $mlw\_answer\_total++; |
  |  | 430 | if ( $answer[0] != '' ) { |
  |  | 431 | $question\_display .= "<option value='" . esc\_attr( $answer[0] ) . "'>" . htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) . '</option>'; |
  |  | 432 | } |
  |  | 433 | } |
  |  | 434 | } |
  |  | 435 | $question\_display .= '</select>'; |
  |  | 436 | return apply\_filters( 'qmn\_drop\_down\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 437 | } |
  |  | 438 |  |
  |  | 439 | /\*\* |
  |  | 440 | \* This function determines how the question is graded |
  |  | 441 | \* |
  |  | 442 | \* @params $id The ID of the multiple choice question |
  |  | 443 | \* @params $question The question that is being edited. |
  |  | 444 | \* @params @answers The array that contains the answers to the question. |
  |  | 445 | \* @return $return\_array Returns the graded question to the results page |
  |  | 446 | \* @since 4.4.0 |
  |  | 447 | \*/ |
  |  | 448 | function qmn\_drop\_down\_review( $id, $question, $answers ) { |
  |  | 449 | global $mlwQuizMasterNext; |
  |  | 450 | $answerEditor = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'answerEditor' ); |
  |  | 451 | $return\_array = array( |
  |  | 452 | 'points'       => 0, |
  |  | 453 | 'correct'      => 'incorrect', |
  |  | 454 | 'user\_text'    => '', |
  |  | 455 | 'correct\_text' => '', |
  |  | 456 | ); |
  |  | 457 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 458 | $mlw\_user\_answer = $\_POST[ 'question' . $id ]; |
  |  | 459 | $mlw\_user\_answer = trim( stripslashes( htmlspecialchars\_decode( $mlw\_user\_answer, ENT\_QUOTES ) ) ); |
  |  | 460 | } else { |
  |  | 461 | $mlw\_user\_answer = ' '; |
  |  | 462 | } |
  |  | 463 | foreach ( $answers as $answer ) { |
  |  | 464 | $answers\_loop = trim( stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ); |
  |  | 465 | if ( $mlw\_user\_answer == $answers\_loop ) { |
  |  | 466 | $return\_array['points']    = $answer[1]; |
  |  | 467 | $return\_array['user\_text'] = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 468 | if ( $answer[2] == 1 ) { |
  |  | 469 | $return\_array['correct'] = 'correct'; |
  |  | 470 | } |
  |  | 471 | } |
  |  | 472 | if ( $answer[2] == 1 ) { |
  |  | 473 | $return\_array['correct\_text'] = htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ); |
  |  | 474 | } |
  |  | 475 | } |
  |  | 476 | return $return\_array; |
  |  | 477 | } |
  |  | 478 |  |
  |  | 479 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_small\_open' ); |
  |  | 480 |  |
  |  | 481 | /\*\* |
  |  | 482 | \* This function registers the small open question type |
  |  | 483 | \* |
  |  | 484 | \* @return void |
  |  | 485 | \* @since 4.4.0 |
  |  | 486 | \*/ |
  |  | 487 | function qmn\_question\_type\_small\_open() { |
  |  | 488 | global $mlwQuizMasterNext; |
  |  | 489 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Short Answer', 'quiz-master-next' ), 'qmn\_small\_open\_display', true, 'qmn\_small\_open\_review', null, null, 3 ); |
  |  | 490 | } |
  |  | 491 |  |
  |  | 492 | /\*\* |
  |  | 493 | \* This function shows the content of the small open answer question. |
  |  | 494 | \* |
  |  | 495 | \* @params $id The ID of the multiple choice question |
  |  | 496 | \* @params $question The question that is being edited. |
  |  | 497 | \* @params @answers The array that contains the answers to the question. |
  |  | 498 | \* @return $question\_display Contains all the content of the question |
  |  | 499 | \* @since 4.4.0 |
  |  | 500 | \*/ |
  |  | 501 | function qmn\_small\_open\_display( $id, $question, $answers ) { |
  |  | 502 | $question\_display = ''; |
  |  | 503 | global $mlwQuizMasterNext; |
  |  | 504 | $required       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 505 | $autofill       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'autofill' ); |
  |  | 506 | $limit\_text     = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_text' ); |
  |  | 507 | $autofill\_att   = $autofill ? "autocomplete='off' " : ''; |
  |  | 508 | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' " : ''; |
  |  | 509 | if ( $required == 0 ) { |
  |  | 510 | $mlw\_requireClass = 'mlwRequiredText'; |
  |  | 511 | } else { |
  |  | 512 | $mlw\_requireClass = '';} |
  |  | 513 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 514 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 515 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 516 | $question\_display  .= '<input ' . $autofill\_att . $limit\_text\_att . " type='text' class='mlw\_answer\_open\_text $mlw\_requireClass' name='question" . $id . "' />"; |
  |  | 517 | return apply\_filters( 'qmn\_small\_open\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 518 | } |
  |  | 519 |  |
  |  | 520 | /\*\* |
  |  | 521 | \* This function reviews the small open answer. |
  |  | 522 | \* |
  |  | 523 | \* @params $id The ID of the multiple choice question |
  |  | 524 | \* @params $question The question that is being edited. |
  |  | 525 | \* @params @answers The array that contains the answers to the question. |
  |  | 526 | \* @return $return\_array Returns the graded question to the results page |
  |  | 527 | \* @since 4.4.0 |
  |  | 528 | \*/ |
  |  | 529 | function qmn\_small\_open\_review( $id, $question, $answers ) { |
  |  | 530 | $return\_array = array( |
  |  | 531 | 'points'       => 0, |
  |  | 532 | 'correct'      => 'incorrect', |
  |  | 533 | 'user\_text'    => '', |
  |  | 534 | 'correct\_text' => '', |
  |  | 535 | ); |
  |  | 536 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 537 | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST[ 'question' . $id ], ENT\_QUOTES ) ) ) ); |
  |  | 538 | $mlw\_user\_answer    = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_user\_answer ) ) ); |
  |  | 539 | } else { |
  |  | 540 | $mlw\_user\_answer = ' '; |
  |  | 541 | } |
  |  | 542 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 543 | foreach ( $answers as $answer ) { |
  |  | 544 | $decode\_correct\_text          = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 545 | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_correct\_text ) ) ); |
  |  | 546 | if ( mb\_strtoupper( $return\_array['user\_text'] ) == mb\_strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 547 | $return\_array['correct'] = 'correct'; |
  |  | 548 | $return\_array['points']  = $answer[1]; |
  |  | 549 | break; |
  |  | 550 | } |
  |  | 551 | } |
  |  | 552 | return $return\_array; |
  |  | 553 | } |
  |  | 554 |  |
  |  | 555 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_multiple\_response' ); |
  |  | 556 |  |
  |  | 557 | /\*\* |
  |  | 558 | \* This function registers the multiple response question type |
  |  | 559 | \* |
  |  | 560 | \* @return void |
  |  | 561 | \* @since 4.4.0 |
  |  | 562 | \*/ |
  |  | 563 | function qmn\_question\_type\_multiple\_response() { |
  |  | 564 | global $mlwQuizMasterNext; |
  |  | 565 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Multiple Response', 'quiz-master-next' ), 'qmn\_multiple\_response\_display', true, 'qmn\_multiple\_response\_review', null, null, 4 ); |
  |  | 566 | } |
  |  | 567 |  |
  |  | 568 | /\*\* |
  |  | 569 | \* This function shows the content of the multiple response question |
  |  | 570 | \* |
  |  | 571 | \* @params $id The ID of the multiple choice question |
  |  | 572 | \* @params $question The question that is being edited. |
  |  | 573 | \* @params @answers The array that contains the answers to the question. |
  |  | 574 | \* @return $question\_display Contains all the content of the question |
  |  | 575 | \* @since 4.4.0 |
  |  | 576 | \*/ |
  |  | 577 | function qmn\_multiple\_response\_display( $id, $question, $answers ) { |
  |  | 578 | $question\_display = $limit\_mr\_text = ''; |
  |  | 579 | global $mlwQuizMasterNext; |
  |  | 580 | $required                = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 581 | $limit\_multiple\_response = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_multiple\_response' ); |
  |  | 582 | if ( $limit\_multiple\_response > 0 ) { |
  |  | 583 | $limit\_mr\_text = 'onchange="qsmCheckMR(this,' . $limit\_multiple\_response . ')"'; |
  |  | 584 | } |
  |  | 585 | if ( $required == 0 ) { |
  |  | 586 | $mlw\_requireClass = 'mlwRequiredCheck'; |
  |  | 587 | } else { |
  |  | 588 | $mlw\_requireClass = '';} |
  |  | 589 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 590 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 591 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 592 | $question\_display  .= "<div class='qmn\_check\_answers $mlw\_requireClass'>"; |
  |  | 593 | if ( is\_array( $answers ) ) { |
  |  | 594 | $mlw\_answer\_total = 0; |
  |  | 595 | foreach ( $answers as $answer ) { |
  |  | 596 | $mlw\_answer\_total++; |
  |  | 597 | if ( $answer[0] != '' ) { |
  | 611 | 598 | $question\_display .= '<div class="qsm\_check\_answer">'; |
  | 612 |  | ~~$question\_display .= "<input type='hidden' name='question".$id.~~"' value='This value does not matter' />"; |
  | 613 |  | ~~$question\_display .= "<input type='checkbox' " . $limit\_mr\_text ." name='question".$id."\_".$mlw\_answer\_total."' id='question".$id."\_".$mlw\_answer\_total."' value='".esc\_attr($answer[0])."' /> <label for='question".$id."\_".$mlw\_answer\_total."'>".trim(do\_shortcode(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)) )."</label>"~~; |
  |  | 599 | $question\_display .= "<input type='hidden' name='question" . $id . "' value='This value does not matter' />"; |
  |  | 600 | $question\_display .= "<input type='checkbox' " . $limit\_mr\_text . " name='question" . $id . '\_' . $mlw\_answer\_total . "' id='question" . $id . '\_' . $mlw\_answer\_total . "' value='" . esc\_attr( $answer[0] ) . "' /> <label for='question" . $id . '\_' . $mlw\_answer\_total . "'>" . trim( do\_shortcode( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '</label>'; |
  | 614 | 601 | $question\_display .= '</div>'; |
  | 615 |  | } |
  | 616 |  | } |
  | 617 |  | } |
  | 618 |  | ~~$question\_display .= "</div>"~~; |
  | 619 |  | ~~return apply\_filters('qmn\_multiple\_response\_display\_front',$question\_display,$id, $question, $answers~~); |
  | 620 |  | } |
  | 621 |  |  |
  | 622 |  | /\*\* |
  | 623 |  | \* This function determines how the multiple response is graded, |
  | 624 |  | \* |
  | 625 |  | \* @params $id The ID of the multiple choice question |
  | 626 |  | \* @params $question The question that is being edited. |
  | 627 |  | \* @params @answers The array that contains the answers to the question. |
  | 628 |  | \* @return $return\_array Returns the graded question to the results page |
  | 629 |  | \* @since 4.4.0 |
  | 630 |  | \*/ |
  | 631 |  | function qmn\_multiple\_response\_review(~~$id, $question, $answers~~) { |
  | 632 |  | $return\_array = array( |
  | 633 |  | 'points' => 0, |
  | 634 |  | 'correct' => 'incorrect', |
  | 635 |  | 'user\_text' => '', |
  | 636 |  | 'correct\_text' => '', |
  | 637 |  | 'user\_compare\_text' => '' |
  | 638 |  | ); |
  | 639 |  | $user\_correct = 0; |
  |  | 602 | } |
  |  | 603 | } |
  |  | 604 | } |
  |  | 605 | $question\_display .= '</div>'; |
  |  | 606 | return apply\_filters( 'qmn\_multiple\_response\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 607 | } |
  |  | 608 |  |
  |  | 609 | /\*\* |
  |  | 610 | \* This function determines how the multiple response is graded, |
  |  | 611 | \* |
  |  | 612 | \* @params $id The ID of the multiple choice question |
  |  | 613 | \* @params $question The question that is being edited. |
  |  | 614 | \* @params @answers The array that contains the answers to the question. |
  |  | 615 | \* @return $return\_array Returns the graded question to the results page |
  |  | 616 | \* @since 4.4.0 |
  |  | 617 | \*/ |
  |  | 618 | function qmn\_multiple\_response\_review( $id, $question, $answers ) { |
  |  | 619 | $return\_array  = array( |
  |  | 620 | 'points'            => 0, |
  |  | 621 | 'correct'           => 'incorrect', |
  |  | 622 | 'user\_text'         => '', |
  |  | 623 | 'correct\_text'      => '', |
  |  | 624 | 'user\_compare\_text' => '', |
  |  | 625 | ); |
  |  | 626 | $user\_correct  = 0; |
  | 640 | 627 | $total\_correct = 0; |
  | 641 |  | $total\_answers = count(~~$answers~~); |
  | 642 |  | $correct\_text = array(); |
  | 643 |  | foreach (~~$answers as $answer~~) { |
  | 644 |  | for (~~$i = 1; $i <= $total\_answers; $i++~~) { |
  | 645 |  | if (~~isset($\_POST["question" . $id . "\_" . $i]) && sanitize\_textarea\_field(htmlspecialchars(stripslashes($\_POST["question" . $id . "\_" . $i]), ENT\_QUOTES)) == esc\_attr($answer[0])~~) { |
  | 646 |  | $return\_array[~~"points"]~~ += $answer[1]; |
  | 647 |  | $return\_array[~~"user\_text"] .= htmlspecialchars\_decode($answer[0], ENT\_QUOTES) . "."~~; |
  | 648 |  | $return\_array[~~"user\_compare\_text"] .= sanitize\_textarea\_field(strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES))) . "====="~~; |
  | 649 |  | if (~~$answer[2] == 1~~) { |
  |  | 628 | $total\_answers = count( $answers ); |
  |  | 629 | $correct\_text  = array(); |
  |  | 630 | foreach ( $answers as $answer ) { |
  |  | 631 | for ( $i = 1; $i <= $total\_answers; $i++ ) { |
  |  | 632 | if ( isset( $\_POST[ 'question' . $id . '\_' . $i ] ) && sanitize\_textarea\_field( htmlspecialchars( stripslashes( $\_POST[ 'question' . $id . '\_' . $i ] ), ENT\_QUOTES ) ) == esc\_attr( $answer[0] ) ) { |
  |  | 633 | $return\_array['points']            += $answer[1]; |
  |  | 634 | $return\_array['user\_text']         .= htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) . '.'; |
  |  | 635 | $return\_array['user\_compare\_text'] .= sanitize\_textarea\_field( strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '====='; |
  |  | 636 | if ( $answer[2] == 1 ) { |
  | 650 | 637 | $user\_correct += 1; |
  | 651 | 638 | } else { |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L654) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L641) |  |
  | 654 | 641 | } |
  | 655 | 642 | } |
  | 656 |  | if (~~$answer[2] == 1~~) { |
  | 657 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  |  | 643 | if ( $answer[2] == 1 ) { |
  |  | 644 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  | 658 | 645 | $total\_correct++; |
  | 659 | 646 | } |
  | 660 | 647 | } |
  | 661 |  | if (~~$user\_correct == $total\_correct~~) { |
  | 662 |  | $return\_array[~~"correct"] = "correct"~~; |
  | 663 |  | } |
  | 664 |  | $return\_array[~~"correct\_text"] = implode('.', $correct\_text~~); |
  |  | 648 | if ( $user\_correct == $total\_correct ) { |
  |  | 649 | $return\_array['correct'] = 'correct'; |
  |  | 650 | } |
  |  | 651 | $return\_array['correct\_text'] = implode( '.', $correct\_text ); |
  | 665 | 652 | return $return\_array; |
  | 666 | 653 | } |
  | 667 | 654 |  |
  | 668 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_large\_open'); |
  | 669 |  |  |
  | 670 |  | /\*\* |
  | 671 |  | \* This function registers the large open question type. |
  | 672 |  | \* |
  | 673 |  | \* @since 4.4.0 |
  | 674 |  | \*/ |
  | 675 |  | function qmn\_question\_type\_large\_open() |
  | 676 |  | { |
  | 677 |  | global $mlwQuizMasterNext; |
  | 678 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Paragraph", 'quiz-master-next'), 'qmn\_large\_open\_display', true, 'qmn\_large\_open\_review', null, null, 5); |
  | 679 |  | } |
  | 680 |  |  |
  | 681 |  | /\*\* |
  | 682 |  | \* This function displays the content of the large open question. |
  | 683 |  | \* |
  | 684 |  | \* @params $id The ID of the multiple choice question |
  | 685 |  | \* @params $question The question that is being edited. |
  | 686 |  | \* @params @answers The array that contains the answers to the question. |
  | 687 |  | \* @return $question\_display Contains all the content of the question |
  | 688 |  | \* @since 4.4.0 |
  | 689 |  | \*/ |
  | 690 |  | function qmn\_large\_open\_display($id, $question, $answers) |
  | 691 |  | { |
  | 692 |  | $question\_display = ''; |
  | 693 |  | global $mlwQuizMasterNext; |
  | 694 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 695 |  | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_text'); |
  | 696 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredText";} else {$mlw\_requireClass = "";} |
  | 697 |  | $limit\_text\_att = $limit\_text ? "maxlength='". $limit\_text ."' " : ''; |
  | 698 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 699 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 700 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 701 |  | $question\_display .= "<textarea class='mlw\_answer\_open\_text {$mlw\_requireClass}' {$limit\_text\_att} cols='70' rows='5' name='question{$id}' /></textarea>"; |
  | 702 |  | return apply\_filters('qmn\_large\_open\_display\_front',$question\_display,$id, $question, $answers); |
  | 703 |  | } |
  | 704 |  |  |
  | 705 |  | /\*\* |
  | 706 |  | \* This function determines how the large open question is graded |
  | 707 |  | \* |
  | 708 |  | \* @params $id The ID of the multiple choice question |
  | 709 |  | \* @params $question The question that is being edited. |
  | 710 |  | \* @params @answers The array that contains the answers to the question. |
  | 711 |  | \* @return $return\_array Returns the graded question to the results page |
  | 712 |  | \* @since 4.4.0 |
  | 713 |  | \*/ |
  | 714 |  | function qmn\_large\_open\_review($id, $question, $answers) |
  | 715 |  | { |
  | 716 |  | $return\_array = array( |
  | 717 |  | 'points' => 0, |
  | 718 |  | 'correct' => 'incorrect', |
  | 719 |  | 'user\_text' => '', |
  | 720 |  | 'correct\_text' => '' |
  | 721 |  | ); |
  | 722 |  | if ( isset( $\_POST["question".$id] ) ) { |
  | 723 |  | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST["question".$id], ENT\_QUOTES ) ) ) ); |
  | 724 |  | $mlw\_user\_answer = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_user\_answer ) ) ); |
  | 725 |  | } else { |
  | 726 |  | $mlw\_user\_answer = " "; |
  | 727 |  | } |
  | 728 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 729 |  | foreach($answers as $answer) |
  | 730 |  | { |
  | 731 |  | $decode\_correct\_text = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 732 |  | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_correct\_text ) ) ); |
  | 733 |  | if (mb\_strtoupper($return\_array['user\_text']) == mb\_strtoupper($return\_array['correct\_text'])) |
  | 734 |  | { |
  | 735 |  | $return\_array['correct'] = "correct"; |
  | 736 |  | $return\_array['points'] = $answer[1]; |
  | 737 |  | break; |
  | 738 |  | } |
  | 739 |  | } |
  | 740 |  | return $return\_array; |
  | 741 |  | } |
  | 742 |  |  |
  | 743 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_text\_block'); |
  | 744 |  |  |
  | 745 |  | /\*\* |
  | 746 |  | \* This function registers the text block question type |
  | 747 |  | \* |
  | 748 |  | \* @return void |
  | 749 |  | \* @since 4.4.0 |
  | 750 |  | \*/ |
  | 751 |  | function qmn\_question\_type\_text\_block() |
  | 752 |  | { |
  |  | 655 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_large\_open' ); |
  |  | 656 |  |
  |  | 657 | /\*\* |
  |  | 658 | \* This function registers the large open question type. |
  |  | 659 | \* |
  |  | 660 | \* @since 4.4.0 |
  |  | 661 | \*/ |
  |  | 662 | function qmn\_question\_type\_large\_open() { |
  |  | 663 | global $mlwQuizMasterNext; |
  |  | 664 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Paragraph', 'quiz-master-next' ), 'qmn\_large\_open\_display', true, 'qmn\_large\_open\_review', null, null, 5 ); |
  |  | 665 | } |
  |  | 666 |  |
  |  | 667 | /\*\* |
  |  | 668 | \* This function displays the content of the large open question. |
  |  | 669 | \* |
  |  | 670 | \* @params $id The ID of the multiple choice question |
  |  | 671 | \* @params $question The question that is being edited. |
  |  | 672 | \* @params @answers The array that contains the answers to the question. |
  |  | 673 | \* @return $question\_display Contains all the content of the question |
  |  | 674 | \* @since 4.4.0 |
  |  | 675 | \*/ |
  |  | 676 | function qmn\_large\_open\_display( $id, $question, $answers ) { |
  |  | 677 | $question\_display = ''; |
  |  | 678 | global $mlwQuizMasterNext; |
  |  | 679 | $required   = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 680 | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_text' ); |
  |  | 681 | if ( $required == 0 ) { |
  |  | 682 | $mlw\_requireClass = 'mlwRequiredText'; |
  |  | 683 | } else { |
  |  | 684 | $mlw\_requireClass = '';} |
  |  | 685 | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' " : ''; |
  |  | 686 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 687 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 688 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 689 | $question\_display  .= "<textarea class='mlw\_answer\_open\_text {$mlw\_requireClass}' {$limit\_text\_att} cols='70' rows='5' name='question{$id}' /></textarea>"; |
  |  | 690 | return apply\_filters( 'qmn\_large\_open\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 691 | } |
  |  | 692 |  |
  |  | 693 | /\*\* |
  |  | 694 | \* This function determines how the large open question is graded |
  |  | 695 | \* |
  |  | 696 | \* @params $id The ID of the multiple choice question |
  |  | 697 | \* @params $question The question that is being edited. |
  |  | 698 | \* @params @answers The array that contains the answers to the question. |
  |  | 699 | \* @return $return\_array Returns the graded question to the results page |
  |  | 700 | \* @since 4.4.0 |
  |  | 701 | \*/ |
  |  | 702 | function qmn\_large\_open\_review( $id, $question, $answers ) { |
  |  | 703 | $return\_array = array( |
  |  | 704 | 'points'       => 0, |
  |  | 705 | 'correct'      => 'incorrect', |
  |  | 706 | 'user\_text'    => '', |
  |  | 707 | 'correct\_text' => '', |
  |  | 708 | ); |
  |  | 709 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 710 | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST[ 'question' . $id ], ENT\_QUOTES ) ) ) ); |
  |  | 711 | $mlw\_user\_answer    = trim( $decode\_user\_answer ); |
  |  | 712 | } else { |
  |  | 713 | $mlw\_user\_answer = ' '; |
  |  | 714 | } |
  |  | 715 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 716 | foreach ( $answers as $answer ) { |
  |  | 717 | $decode\_correct\_text          = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 718 | $return\_array['correct\_text'] = trim( $decode\_correct\_text ); |
  |  | 719 | if ( mb\_strtoupper( $return\_array['user\_text'] ) == mb\_strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 720 | $return\_array['correct'] = 'correct'; |
  |  | 721 | $return\_array['points']  = $answer[1]; |
  |  | 722 | break; |
  |  | 723 | } |
  |  | 724 | } |
  |  | 725 | return $return\_array; |
  |  | 726 | } |
  |  | 727 |  |
  |  | 728 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_text\_block' ); |
  |  | 729 |  |
  |  | 730 | /\*\* |
  |  | 731 | \* This function registers the text block question type |
  |  | 732 | \* |
  |  | 733 | \* @return void |
  |  | 734 | \* @since 4.4.0 |
  |  | 735 | \*/ |
  |  | 736 | function qmn\_question\_type\_text\_block() { |
  | 753 | 737 | global $mlwQuizMasterNext; |
  | 754 | 738 | $edit\_args = array( |
  | 755 |  | 'inputs' => array( |
  | 756 |  | 'question' |
  |  | 739 | 'inputs'       => array( |
  |  | 740 | 'question', |
  | 757 | 741 | ), |
  | 758 |  | 'information' => '', |
  |  | 742 | 'information'  => '', |
  | 759 | 743 | 'extra\_inputs' => array(), |
  | 760 |  | 'function' => '' |
  | 761 |  | ); |
  | 762 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Text/HTML Section", 'quiz-master-next'), 'qmn\_text\_block\_display', false, null, $edit\_args, null, 6); |
  | 763 |  | } |
  | 764 |  |  |
  | 765 |  |  |
  | 766 |  | /\*\* |
  | 767 |  | \* This function displays the contents of the text block question type. |
  | 768 |  | \* |
  | 769 |  | \* @params $id The ID of the multiple choice question |
  | 770 |  | \* @params $question The question that is being edited. |
  | 771 |  | \* @params @answers The array that contains the answers to the question. |
  | 772 |  | \* @return $question\_display Contains all the content of the question |
  | 773 |  | \* @since 4.4.0 |
  | 774 |  | \*/ |
  | 775 |  | function qmn\_text\_block\_display($id, $question, $answers) |
  | 776 |  | { |
  | 777 |  | $question\_display = ''; |
  | 778 |  | $question\_display .= do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES)); |
  | 779 |  | return $question\_display; |
  | 780 |  | } |
  | 781 |  |  |
  | 782 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_number'); |
  | 783 |  |  |
  | 784 |  | /\*\* |
  | 785 |  | \* This function registers the number question type |
  | 786 |  | \* |
  | 787 |  | \* @params $id The ID of the multiple choice question |
  | 788 |  | \* @params $question The question that is being edited. |
  | 789 |  | \* @params @answers The array that contains the answers to the question. |
  | 790 |  | \* @return void |
  | 791 |  | \* @since 4.4.0 |
  | 792 |  | \*/ |
  | 793 |  | function qmn\_question\_type\_number() |
  | 794 |  | { |
  | 795 |  | global $mlwQuizMasterNext; |
  | 796 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Number", 'quiz-master-next'), 'qmn\_number\_display', true, 'qmn\_number\_review', null, null, 7); |
  | 797 |  | } |
  | 798 |  |  |
  | 799 |  |  |
  | 800 |  | /\*\* |
  | 801 |  | \* This function shows the content of the multiple choice question. |
  | 802 |  | \* |
  | 803 |  | \* @params $id The ID of the multiple choice question |
  | 804 |  | \* @params $question The question that is being edited. |
  | 805 |  | \* @params @answers The array that contains the answers to the question. |
  | 806 |  | \* @return $question\_display Contains all the content of the question |
  | 807 |  | \* @since 4.4.0 |
  | 808 |  | \*/ |
  | 809 |  | function qmn\_number\_display($id, $question, $answers) |
  | 810 |  | { |
  | 811 |  | $question\_display = ''; |
  | 812 |  | global $mlwQuizMasterNext; |
  | 813 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 814 |  | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_text'); |
  | 815 |  | $limit\_text\_att = $limit\_text ? "maxlength='". $limit\_text ."' oninput='javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);'" : ''; |
  | 816 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredNumber";} else {$mlw\_requireClass = "";} |
  | 817 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 818 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 819 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 820 |  | $question\_display .= "<input type='number' $limit\_text\_att class='mlw\_answer\_number $mlw\_requireClass' name='question".$id."' />"; |
  | 821 |  | return apply\_filters('qmn\_number\_display\_front',$question\_display,$id, $question, $answers); |
  | 822 |  | } |
  | 823 |  |  |
  | 824 |  |  |
  | 825 |  | /\*\* |
  | 826 |  | \* This function determines how the number question type is graded. |
  | 827 |  | \* |
  | 828 |  | \* @params $id The ID of the multiple choice question |
  | 829 |  | \* @params $question The question that is being edited. |
  | 830 |  | \* @params @answers The array that contains the answers to the question. |
  | 831 |  | \* @return $return\_array Returns the graded question to the results page |
  | 832 |  | \* @since 4.4.0 |
  | 833 |  | \*/ |
  | 834 |  | function qmn\_number\_review($id, $question, $answers) |
  | 835 |  | { |
  | 836 |  | $return\_array = array( |
  | 837 |  | 'points' => 0, |
  | 838 |  | 'correct' => 'incorrect', |
  | 839 |  | 'user\_text' => '', |
  | 840 |  | 'correct\_text' => '' |
  | 841 |  | ); |
  | 842 |  | if ( isset( $\_POST["question".$id] ) ) { |
  | 843 |  | $mlw\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST["question".$id], ENT\_QUOTES ) ) ) ); |
  | 844 |  | } else { |
  | 845 |  | $mlw\_user\_answer = " "; |
  | 846 |  | } |
  | 847 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 848 |  | foreach($answers as $answer) |
  | 849 |  | { |
  | 850 |  | $return\_array['correct\_text'] = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 851 |  | if (strtoupper($return\_array['user\_text']) == strtoupper($return\_array['correct\_text'])) |
  | 852 |  | { |
  | 853 |  | $return\_array['correct'] = "correct"; |
  | 854 |  | $return\_array['points'] = $answer[1]; |
  | 855 |  | break; |
  | 856 |  | } |
  | 857 |  | } |
  | 858 |  | return $return\_array; |
  | 859 |  | } |
  | 860 |  |  |
  | 861 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_accept'); |
  | 862 |  |  |
  | 863 |  | /\*\* |
  | 864 |  | \* This function registers the accept question type. |
  | 865 |  | \* |
  | 866 |  | \* @return void Description |
  | 867 |  | \* @since 4.4.0 |
  | 868 |  | \*/ |
  | 869 |  | function qmn\_question\_type\_accept() |
  | 870 |  | { |
  |  | 744 | 'function'     => '', |
  |  | 745 | ); |
  |  | 746 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Text/HTML Section', 'quiz-master-next' ), 'qmn\_text\_block\_display', false, null, $edit\_args, null, 6 ); |
  |  | 747 | } |
  |  | 748 |  |
  |  | 749 |  |
  |  | 750 | /\*\* |
  |  | 751 | \* This function displays the contents of the text block question type. |
  |  | 752 | \* |
  |  | 753 | \* @params $id The ID of the multiple choice question |
  |  | 754 | \* @params $question The question that is being edited. |
  |  | 755 | \* @params @answers The array that contains the answers to the question. |
  |  | 756 | \* @return $question\_display Contains all the content of the question |
  |  | 757 | \* @since 4.4.0 |
  |  | 758 | \*/ |
  |  | 759 | function qmn\_text\_block\_display( $id, $question, $answers ) { |
  |  | 760 | $question\_display  = ''; |
  |  | 761 | $question\_display .= do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ); |
  |  | 762 | return $question\_display; |
  |  | 763 | } |
  |  | 764 |  |
  |  | 765 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_number' ); |
  |  | 766 |  |
  |  | 767 | /\*\* |
  |  | 768 | \* This function registers the number question type |
  |  | 769 | \* |
  |  | 770 | \* @params $id The ID of the multiple choice question |
  |  | 771 | \* @params $question The question that is being edited. |
  |  | 772 | \* @params @answers The array that contains the answers to the question. |
  |  | 773 | \* @return void |
  |  | 774 | \* @since 4.4.0 |
  |  | 775 | \*/ |
  |  | 776 | function qmn\_question\_type\_number() { |
  |  | 777 | global $mlwQuizMasterNext; |
  |  | 778 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Number', 'quiz-master-next' ), 'qmn\_number\_display', true, 'qmn\_number\_review', null, null, 7 ); |
  |  | 779 | } |
  |  | 780 |  |
  |  | 781 |  |
  |  | 782 | /\*\* |
  |  | 783 | \* This function shows the content of the multiple choice question. |
  |  | 784 | \* |
  |  | 785 | \* @params $id The ID of the multiple choice question |
  |  | 786 | \* @params $question The question that is being edited. |
  |  | 787 | \* @params @answers The array that contains the answers to the question. |
  |  | 788 | \* @return $question\_display Contains all the content of the question |
  |  | 789 | \* @since 4.4.0 |
  |  | 790 | \*/ |
  |  | 791 | function qmn\_number\_display( $id, $question, $answers ) { |
  |  | 792 | $question\_display = ''; |
  |  | 793 | global $mlwQuizMasterNext; |
  |  | 794 | $required       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 795 | $limit\_text     = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_text' ); |
  |  | 796 | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' oninput='javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);'" : ''; |
  |  | 797 | if ( $required == 0 ) { |
  |  | 798 | $mlw\_requireClass = 'mlwRequiredNumber'; |
  |  | 799 | } else { |
  |  | 800 | $mlw\_requireClass = '';} |
  |  | 801 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 802 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 803 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 804 | $question\_display  .= "<input type='number' $limit\_text\_att class='mlw\_answer\_number $mlw\_requireClass' name='question" . $id . "' />"; |
  |  | 805 | return apply\_filters( 'qmn\_number\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 806 | } |
  |  | 807 |  |
  |  | 808 |  |
  |  | 809 | /\*\* |
  |  | 810 | \* This function determines how the number question type is graded. |
  |  | 811 | \* |
  |  | 812 | \* @params $id The ID of the multiple choice question |
  |  | 813 | \* @params $question The question that is being edited. |
  |  | 814 | \* @params @answers The array that contains the answers to the question. |
  |  | 815 | \* @return $return\_array Returns the graded question to the results page |
  |  | 816 | \* @since 4.4.0 |
  |  | 817 | \*/ |
  |  | 818 | function qmn\_number\_review( $id, $question, $answers ) { |
  |  | 819 | $return\_array = array( |
  |  | 820 | 'points'       => 0, |
  |  | 821 | 'correct'      => 'incorrect', |
  |  | 822 | 'user\_text'    => '', |
  |  | 823 | 'correct\_text' => '', |
  |  | 824 | ); |
  |  | 825 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 826 | $mlw\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST[ 'question' . $id ], ENT\_QUOTES ) ) ) ); |
  |  | 827 | } else { |
  |  | 828 | $mlw\_user\_answer = ' '; |
  |  | 829 | } |
  |  | 830 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 831 | foreach ( $answers as $answer ) { |
  |  | 832 | $return\_array['correct\_text'] = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 833 | if ( strtoupper( $return\_array['user\_text'] ) == strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 834 | $return\_array['correct'] = 'correct'; |
  |  | 835 | $return\_array['points']  = $answer[1]; |
  |  | 836 | break; |
  |  | 837 | } |
  |  | 838 | } |
  |  | 839 | return $return\_array; |
  |  | 840 | } |
  |  | 841 |  |
  |  | 842 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_accept' ); |
  |  | 843 |  |
  |  | 844 | /\*\* |
  |  | 845 | \* This function registers the accept question type. |
  |  | 846 | \* |
  |  | 847 | \* @return void Description |
  |  | 848 | \* @since 4.4.0 |
  |  | 849 | \*/ |
  |  | 850 | function qmn\_question\_type\_accept() { |
  | 871 | 851 | global $mlwQuizMasterNext; |
  | 872 | 852 | $edit\_args = array( |
  | 873 |  | 'inputs' => array( |
  |  | 853 | 'inputs'       => array( |
  | 874 | 854 | 'question', |
  | 875 |  | 'required' |
  |  | 855 | 'required', |
  | 876 | 856 | ), |
  | 877 |  | 'information' => '', |
  |  | 857 | 'information'  => '', |
  | 878 | 858 | 'extra\_inputs' => array(), |
  | 879 |  | 'function' => '' |
  | 880 |  | ); |
  | 881 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Opt-in", 'quiz-master-next'), 'qmn\_accept\_display', false, null, $edit\_args, null, 8); |
  | 882 |  | } |
  | 883 |  |  |
  | 884 |  | /\*\* |
  | 885 |  | \* This function displays the accept question |
  | 886 |  | \* |
  | 887 |  | \* @params $id The ID of the multiple choice question |
  | 888 |  | \* @params $question The question that is being edited. |
  | 889 |  | \* @params @answers The array that contains the answers to the question. |
  | 890 |  | \* @return $question\_display Contains all the content of the question |
  | 891 |  | \* @since 4.4.0 |
  | 892 |  | \*/ |
  | 893 |  | function qmn\_accept\_display($id, $question, $answers) |
  | 894 |  | { |
  | 895 |  | $question\_display = ''; |
  | 896 |  | global $mlwQuizMasterNext; |
  | 897 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 898 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredAccept";} else {$mlw\_requireClass = "";} |
  |  | 859 | 'function'     => '', |
  |  | 860 | ); |
  |  | 861 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Opt-in', 'quiz-master-next' ), 'qmn\_accept\_display', false, null, $edit\_args, null, 8 ); |
  |  | 862 | } |
  |  | 863 |  |
  |  | 864 | /\*\* |
  |  | 865 | \* This function displays the accept question |
  |  | 866 | \* |
  |  | 867 | \* @params $id The ID of the multiple choice question |
  |  | 868 | \* @params $question The question that is being edited. |
  |  | 869 | \* @params @answers The array that contains the answers to the question. |
  |  | 870 | \* @return $question\_display Contains all the content of the question |
  |  | 871 | \* @since 4.4.0 |
  |  | 872 | \*/ |
  |  | 873 | function qmn\_accept\_display( $id, $question, $answers ) { |
  |  | 874 | $question\_display = ''; |
  |  | 875 | global $mlwQuizMasterNext; |
  |  | 876 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 877 | if ( $required == 0 ) { |
  |  | 878 | $mlw\_requireClass = 'mlwRequiredAccept'; |
  |  | 879 | } else { |
  |  | 880 | $mlw\_requireClass = '';} |
  | 899 | 881 | $question\_display .= "<div class='qmn\_accept\_answers'>"; |
  | 900 |  | $question\_display .= "<input type='checkbox' id='mlwAcceptance' class='$mlw\_requireClass ' />"; |
  | 901 |  | $question\_display .= "<label for='mlwAcceptance'><span class='qmn\_accept\_text'>".do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))."</span></label>"; |
  | 902 |  | $question\_display .= "</div>"; |
  | 903 |  | return apply\_filters('qmn\_accept\_display\_front',$question\_display,$id, $question, $answers); |
  | 904 |  | } |
  | 905 |  |  |
  | 906 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_captcha'); |
  | 907 |  |  |
  | 908 |  | /\*\* |
  | 909 |  | \* This function registers the captcha question |
  | 910 |  | \* |
  | 911 |  | \* |
  | 912 |  | \* @since 4.4.0 |
  | 913 |  | \*/ |
  | 914 |  | function qmn\_question\_type\_captcha() |
  | 915 |  | { |
  |  | 882 | $question\_display .= "<input type='checkbox' id='mlwAcceptance' class='$mlw\_requireClass ' />"; |
  |  | 883 | $question\_display .= "<label for='mlwAcceptance'><span class='qmn\_accept\_text'>" . do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) . '</span></label>'; |
  |  | 884 | $question\_display .= '</div>'; |
  |  | 885 | return apply\_filters( 'qmn\_accept\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 886 | } |
  |  | 887 |  |
  |  | 888 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_captcha' ); |
  |  | 889 |  |
  |  | 890 | /\*\* |
  |  | 891 | \* This function registers the captcha question |
  |  | 892 | \* |
  |  | 893 | \* @since 4.4.0 |
  |  | 894 | \*/ |
  |  | 895 | function qmn\_question\_type\_captcha() { |
  | 916 | 896 | global $mlwQuizMasterNext; |
  | 917 | 897 | $edit\_args = array( |
  | 918 |  | 'inputs' => array( |
  |  | 898 | 'inputs'       => array( |
  | 919 | 899 | 'question', |
  | 920 |  | 'required' |
  |  | 900 | 'required', |
  | 921 | 901 | ), |
  | 922 |  | 'information' => '', |
  |  | 902 | 'information'  => '', |
  | 923 | 903 | 'extra\_inputs' => array(), |
  | 924 |  | 'function' => '' |
  | 925 |  | ); |
  | 926 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Captcha", 'quiz-master-next'), 'qmn\_captcha\_display', false, null, $edit\_args, null, 9); |
  | 927 |  | } |
  | 928 |  |  |
  | 929 |  |  |
  | 930 |  | /\*\* |
  | 931 |  | \* This function displays the captcha question |
  | 932 |  | \* |
  | 933 |  | \* @params $id The ID of the multiple choice question |
  | 934 |  | \* @params $question The question that is being edited. |
  | 935 |  | \* @params @answers The array that contains the answers to the question. |
  | 936 |  | \* @return $question\_display Contains all the content of the question |
  | 937 |  | \* @since 4.4.0 |
  | 938 |  | \*/ |
  | 939 |  | function qmn\_captcha\_display($id, $question, $answers) |
  | 940 |  | { |
  | 941 |  | $question\_display = ''; |
  | 942 |  | global $mlwQuizMasterNext; |
  | 943 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 944 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredCaptcha";} else {$mlw\_requireClass = "";} |
  | 945 |  | $question\_display .= "<div class='mlw\_captchaWrap'>"; |
  | 946 |  | $question\_display .= "<canvas alt='' id='mlw\_captcha' class='mlw\_captcha' width='100' height='50'></canvas>"; |
  | 947 |  | $question\_display .= "</div>"; |
  | 948 |  | $question\_display .= "<span class='mlw\_qmn\_question'>"; |
  | 949 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 950 |  | $question\_title = qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 951 |  | $question\_display .= $question\_title ."</span>"; |
  | 952 |  | $question\_display .= "<input type='text' class='mlw\_answer\_open\_text $mlw\_requireClass' id='mlw\_captcha\_text' name='mlw\_user\_captcha'/>"; |
  | 953 |  | $question\_display .= "<input type='hidden' name='mlw\_code\_captcha' id='mlw\_code\_captcha' value='none' />"; |
  | 954 |  | $question\_display .= "<script> |
  |  | 904 | 'function'     => '', |
  |  | 905 | ); |
  |  | 906 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Captcha', 'quiz-master-next' ), 'qmn\_captcha\_display', false, null, $edit\_args, null, 9 ); |
  |  | 907 | } |
  |  | 908 |  |
  |  | 909 |  |
  |  | 910 | /\*\* |
  |  | 911 | \* This function displays the captcha question |
  |  | 912 | \* |
  |  | 913 | \* @params $id The ID of the multiple choice question |
  |  | 914 | \* @params $question The question that is being edited. |
  |  | 915 | \* @params @answers The array that contains the answers to the question. |
  |  | 916 | \* @return $question\_display Contains all the content of the question |
  |  | 917 | \* @since 4.4.0 |
  |  | 918 | \*/ |
  |  | 919 | function qmn\_captcha\_display( $id, $question, $answers ) { |
  |  | 920 | $question\_display = ''; |
  |  | 921 | global $mlwQuizMasterNext; |
  |  | 922 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 923 | if ( $required == 0 ) { |
  |  | 924 | $mlw\_requireClass = 'mlwRequiredCaptcha'; |
  |  | 925 | } else { |
  |  | 926 | $mlw\_requireClass = '';} |
  |  | 927 | $question\_display  .= "<div class='mlw\_captchaWrap'>"; |
  |  | 928 | $question\_display  .= "<canvas alt='' id='mlw\_captcha' class='mlw\_captcha' width='100' height='50'></canvas>"; |
  |  | 929 | $question\_display  .= '</div>'; |
  |  | 930 | $question\_display  .= "<span class='mlw\_qmn\_question'>"; |
  |  | 931 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 932 | $question\_title     = qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 933 | $question\_display  .= $question\_title . '</span>'; |
  |  | 934 | $question\_display  .= "<input type='text' class='mlw\_answer\_open\_text $mlw\_requireClass' id='mlw\_captcha\_text' name='mlw\_user\_captcha'/>"; |
  |  | 935 | $question\_display  .= "<input type='hidden' name='mlw\_code\_captcha' id='mlw\_code\_captcha' value='none' />"; |
  |  | 936 | $question\_display  .= "<script> |
  | 955 | 937 | var mlw\_code = ''; |
  | 956 | 938 | var mlw\_chars = '0123456789ABCDEFGHIJKL!@#$%^&\*()MNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'; |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L968) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L950) |  |
  | 968 | 950 | document.getElementById('mlw\_code\_captcha').value = mlw\_code; |
  | 969 | 951 | </script> |
  | 970 |  | "; |
  | 971 |  | return apply\_filters('qmn\_captcha\_display\_front',$question\_display,$id, $question, $answers); |
  | 972 |  | } |
  | 973 |  |  |
  | 974 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_horizontal\_multiple\_response'); |
  | 975 |  |  |
  | 976 |  | /\*\* |
  | 977 |  | \* This function registers the horizontal multiple response question |
  | 978 |  | \* |
  | 979 |  | \* @return void |
  | 980 |  | \* @since 4.4.0 |
  | 981 |  | \*/ |
  | 982 |  | function qmn\_question\_type\_horizontal\_multiple\_response() |
  | 983 |  | { |
  | 984 |  | global $mlwQuizMasterNext; |
  | 985 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Horizontal Multiple Response", 'quiz-master-next'), 'qmn\_horizontal\_multiple\_response\_display', true, 'qmn\_horizontal\_multiple\_response\_review', null, null, 10); |
  | 986 |  | } |
  | 987 |  |  |
  | 988 |  |  |
  | 989 |  | /\*\* |
  | 990 |  | \* This function displays the content of the multiple response question type |
  | 991 |  | \* |
  | 992 |  | \* @params $id The ID of the multiple choice question |
  | 993 |  | \* @params $question The question that is being edited. |
  | 994 |  | \* @params @answers The array that contains the answers to the question. |
  | 995 |  | \* @return $question\_display Contains all the content of the question |
  | 996 |  | \* @since 4.4.0 |
  | 997 |  | \*/ |
  | 998 |  | function qmn\_horizontal\_multiple\_response\_display($id, $question, $answers) |
  | 999 |  | { |
  | 1000 |  | $question\_display = ''; |
  | 1001 |  | global $mlwQuizMasterNext; |
  | 1002 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 1003 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredCheck";} else {$mlw\_requireClass = "";} |
  | 1004 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 1005 |  | $limit\_multiple\_response = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_multiple\_response'); |
  | 1006 |  | $limit\_mr\_text = ''; |
  | 1007 |  | if($limit\_multiple\_response > 0) |
  | 1008 |  | $limit\_mr\_text = 'onchange="qsmCheckMR(this,'. $limit\_multiple\_response .')"'; |
  | 1009 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 1010 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 1011 |  | $question\_display .= "<div class='qmn\_check\_answers $mlw\_requireClass'>"; |
  | 1012 |  | if (is\_array($answers)) |
  | 1013 |  | { |
  | 1014 |  | $mlw\_answer\_total = 0; |
  | 1015 |  | foreach($answers as $answer) |
  | 1016 |  | { |
  | 1017 |  | $mlw\_answer\_total++; |
  | 1018 |  | if ($answer[0] != "") |
  | 1019 |  | { |
  | 1020 |  | $question\_display .= "<input type='hidden' name='question".$id."' value='This value does not matter' />"; |
  | 1021 |  | $question\_display .= "<span class='mlw\_horizontal\_multiple'><input type='checkbox' " . $limit\_mr\_text ." name='question".$id."\_".$mlw\_answer\_total."' id='question".$id."\_".$mlw\_answer\_total."' value='".esc\_attr($answer[0])."' /> <label for='question".$id."\_".$mlw\_answer\_total."'>".trim(do\_shortcode(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)) )."&nbsp;</label></span>"; |
  | 1022 |  | } |
  | 1023 |  | } |
  | 1024 |  | } |
  | 1025 |  | $question\_display .= "</div>"; |
  | 1026 |  | return apply\_filters('qmn\_horizontal\_multiple\_response\_display\_front',$question\_display,$id, $question, $answers); |
  | 1027 |  | } |
  | 1028 |  |  |
  | 1029 |  |  |
  | 1030 |  | /\*\* |
  | 1031 |  | \* This function determines how the multiple response is graded. |
  | 1032 |  | \* |
  | 1033 |  | \* @params $id The ID of the multiple choice question |
  | 1034 |  | \* @params $question The question that is being edited. |
  | 1035 |  | \* @params @answers The array that contains the answers to the question. |
  | 1036 |  | \* @return $return\_array Returns the graded question to the Results page |
  | 1037 |  | \* @since 4.4.0 |
  | 1038 |  | \*/ |
  | 1039 |  | function qmn\_horizontal\_multiple\_response\_review($id, $question, $answers) { |
  | 1040 |  | $return\_array = array( |
  | 1041 |  | 'points' => 0, |
  | 1042 |  | 'correct' => 'incorrect', |
  | 1043 |  | 'user\_text' => '', |
  | 1044 |  | 'correct\_text' => '', |
  | 1045 |  | 'user\_compare\_text' => '' |
  | 1046 |  | ); |
  | 1047 |  | $user\_correct = 0; |
  |  | 952 | "; |
  |  | 953 | return apply\_filters( 'qmn\_captcha\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 954 | } |
  |  | 955 |  |
  |  | 956 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_horizontal\_multiple\_response' ); |
  |  | 957 |  |
  |  | 958 | /\*\* |
  |  | 959 | \* This function registers the horizontal multiple response question |
  |  | 960 | \* |
  |  | 961 | \* @return void |
  |  | 962 | \* @since 4.4.0 |
  |  | 963 | \*/ |
  |  | 964 | function qmn\_question\_type\_horizontal\_multiple\_response() { |
  |  | 965 | global $mlwQuizMasterNext; |
  |  | 966 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Horizontal Multiple Response', 'quiz-master-next' ), 'qmn\_horizontal\_multiple\_response\_display', true, 'qmn\_horizontal\_multiple\_response\_review', null, null, 10 ); |
  |  | 967 | } |
  |  | 968 |  |
  |  | 969 |  |
  |  | 970 | /\*\* |
  |  | 971 | \* This function displays the content of the multiple response question type |
  |  | 972 | \* |
  |  | 973 | \* @params $id The ID of the multiple choice question |
  |  | 974 | \* @params $question The question that is being edited. |
  |  | 975 | \* @params @answers The array that contains the answers to the question. |
  |  | 976 | \* @return $question\_display Contains all the content of the question |
  |  | 977 | \* @since 4.4.0 |
  |  | 978 | \*/ |
  |  | 979 | function qmn\_horizontal\_multiple\_response\_display( $id, $question, $answers ) { |
  |  | 980 | $question\_display = ''; |
  |  | 981 | global $mlwQuizMasterNext; |
  |  | 982 | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 983 | if ( $required == 0 ) { |
  |  | 984 | $mlw\_requireClass = 'mlwRequiredCheck'; |
  |  | 985 | } else { |
  |  | 986 | $mlw\_requireClass = '';} |
  |  | 987 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 988 | $limit\_multiple\_response = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_multiple\_response' ); |
  |  | 989 | $limit\_mr\_text           = ''; |
  |  | 990 | if ( $limit\_multiple\_response > 0 ) { |
  |  | 991 | $limit\_mr\_text = 'onchange="qsmCheckMR(this,' . $limit\_multiple\_response . ')"'; |
  |  | 992 | } |
  |  | 993 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 994 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 995 | $question\_display  .= "<div class='qmn\_check\_answers $mlw\_requireClass'>"; |
  |  | 996 | if ( is\_array( $answers ) ) { |
  |  | 997 | $mlw\_answer\_total = 0; |
  |  | 998 | foreach ( $answers as $answer ) { |
  |  | 999 | $mlw\_answer\_total++; |
  |  | 1000 | if ( $answer[0] != '' ) { |
  |  | 1001 | $question\_display .= "<input type='hidden' name='question" . $id . "' value='This value does not matter' />"; |
  |  | 1002 | $question\_display .= "<span class='mlw\_horizontal\_multiple'><input type='checkbox' " . $limit\_mr\_text . " name='question" . $id . '\_' . $mlw\_answer\_total . "' id='question" . $id . '\_' . $mlw\_answer\_total . "' value='" . esc\_attr( $answer[0] ) . "' /> <label for='question" . $id . '\_' . $mlw\_answer\_total . "'>" . trim( do\_shortcode( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '&nbsp;</label></span>'; |
  |  | 1003 | } |
  |  | 1004 | } |
  |  | 1005 | } |
  |  | 1006 | $question\_display .= '</div>'; |
  |  | 1007 | return apply\_filters( 'qmn\_horizontal\_multiple\_response\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 1008 | } |
  |  | 1009 |  |
  |  | 1010 |  |
  |  | 1011 | /\*\* |
  |  | 1012 | \* This function determines how the multiple response is graded. |
  |  | 1013 | \* |
  |  | 1014 | \* @params $id The ID of the multiple choice question |
  |  | 1015 | \* @params $question The question that is being edited. |
  |  | 1016 | \* @params @answers The array that contains the answers to the question. |
  |  | 1017 | \* @return $return\_array Returns the graded question to the Results page |
  |  | 1018 | \* @since 4.4.0 |
  |  | 1019 | \*/ |
  |  | 1020 | function qmn\_horizontal\_multiple\_response\_review( $id, $question, $answers ) { |
  |  | 1021 | $return\_array  = array( |
  |  | 1022 | 'points'            => 0, |
  |  | 1023 | 'correct'           => 'incorrect', |
  |  | 1024 | 'user\_text'         => '', |
  |  | 1025 | 'correct\_text'      => '', |
  |  | 1026 | 'user\_compare\_text' => '', |
  |  | 1027 | ); |
  |  | 1028 | $user\_correct  = 0; |
  | 1048 | 1029 | $total\_correct = 0; |
  | 1049 |  | $total\_answers = count(~~$answers~~); |
  | 1050 |  | $correct\_text = array(); |
  | 1051 |  | foreach (~~$answers as $answer~~) { |
  | 1052 |  | for (~~$i = 1; $i <= $total\_answers; $i++~~) { |
  | 1053 |  | if (~~isset($\_POST["question" . $id . "\_" . $i]) && sanitize\_textarea\_field(htmlspecialchars(stripslashes($\_POST["question" . $id . "\_" . $i]), ENT\_QUOTES)) == esc\_attr($answer[0])~~) { |
  | 1054 |  | $return\_array[~~"points"]~~ += $answer[1]; |
  | 1055 |  | $return\_array[~~"user\_text"] .= strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)) . "."~~; |
  | 1056 |  | $return\_array[~~"user\_compare\_text"] .= sanitize\_textarea\_field(strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES))) . "====="~~; |
  | 1057 |  | if (~~$answer[2] == 1~~) { |
  |  | 1030 | $total\_answers = count( $answers ); |
  |  | 1031 | $correct\_text  = array(); |
  |  | 1032 | foreach ( $answers as $answer ) { |
  |  | 1033 | for ( $i = 1; $i <= $total\_answers; $i++ ) { |
  |  | 1034 | if ( isset( $\_POST[ 'question' . $id . '\_' . $i ] ) && sanitize\_textarea\_field( htmlspecialchars( stripslashes( $\_POST[ 'question' . $id . '\_' . $i ] ), ENT\_QUOTES ) ) == esc\_attr( $answer[0] ) ) { |
  |  | 1035 | $return\_array['points']            += $answer[1]; |
  |  | 1036 | $return\_array['user\_text']         .= strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) . '.'; |
  |  | 1037 | $return\_array['user\_compare\_text'] .= sanitize\_textarea\_field( strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ) ) . '====='; |
  |  | 1038 | if ( $answer[2] == 1 ) { |
  | 1058 | 1039 | $user\_correct += 1; |
  | 1059 | 1040 | } else { |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1062) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1043) |  |
  | 1062 | 1043 | } |
  | 1063 | 1044 | } |
  | 1064 |  | if (~~$answer[2] == 1~~) { |
  | 1065 |  | $correct\_text[] = stripslashes(~~htmlspecialchars\_decode($answer[0], ENT\_QUOTES)~~); |
  |  | 1045 | if ( $answer[2] == 1 ) { |
  |  | 1046 | $correct\_text[] = stripslashes( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  | 1066 | 1047 | $total\_correct++; |
  | 1067 | 1048 | } |
  | 1068 | 1049 | } |
  | 1069 |  | if (~~$user\_correct == $total\_correct~~) { |
  | 1070 |  | $return\_array[~~"correct"] = "correct"~~; |
  | 1071 |  | } |
  | 1072 |  | $return\_array[~~"correct\_text"] = implode('.', $correct\_text~~); |
  |  | 1050 | if ( $user\_correct == $total\_correct ) { |
  |  | 1051 | $return\_array['correct'] = 'correct'; |
  |  | 1052 | } |
  |  | 1053 | $return\_array['correct\_text'] = implode( '.', $correct\_text ); |
  | 1073 | 1054 | return $return\_array; |
  | 1074 | 1055 | } |
  | 1075 | 1056 |  |
  | 1076 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_fill\_blank'); |
  | 1077 |  |  |
  | 1078 |  | /\*\* |
  | 1079 |  | \* This function registers the fill in the blank question type |
  | 1080 |  | \* |
  | 1081 |  | \* @return void |
  | 1082 |  | \* @since 4.4.0 |
  | 1083 |  | \*/ |
  | 1084 |  | function qmn\_question\_type\_fill\_blank() |
  | 1085 |  | { |
  |  | 1057 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_fill\_blank' ); |
  |  | 1058 |  |
  |  | 1059 | /\*\* |
  |  | 1060 | \* This function registers the fill in the blank question type |
  |  | 1061 | \* |
  |  | 1062 | \* @return void |
  |  | 1063 | \* @since 4.4.0 |
  |  | 1064 | \*/ |
  |  | 1065 | function qmn\_question\_type\_fill\_blank() { |
  | 1086 | 1066 | global $mlwQuizMasterNext; |
  | 1087 | 1067 | $edit\_args = array( |
  | 1088 |  | 'inputs' => array( |
  |  | 1068 | 'inputs'       => array( |
  | 1089 | 1069 | 'question', |
  | 1090 | 1070 | 'answer', |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1093) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1073) |  |
  | 1093 | 1073 | 'comments', |
  | 1094 | 1074 | 'category', |
  | 1095 |  | 'required' |
  |  | 1075 | 'required', |
  | 1096 | 1076 | ), |
  | 1097 |  | 'information' ~~=> \_\_('For fill in the blank types, use %BLANK% to represent where to put the text box in your text.', 'quiz-master-next'~~), |
  |  | 1077 | 'information'  => \_\_( 'For fill in the blank types, use %BLANK% to represent where to put the text box in your text.', 'quiz-master-next' ), |
  | 1098 | 1078 | 'extra\_inputs' => array(), |
  | 1099 |  | 'function' => '' |
  | 1100 |  | ); |
  | 1101 |  |  |
  | 1102 |  | $mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Fill In The Blank", 'quiz-master-next'), 'qmn\_fill\_blank\_display', true, 'qmn\_fill\_blank\_review', $edit\_args, null, 14 ); |
  | 1103 |  |  |
  | 1104 |  |  |
  | 1105 |  | } |
  | 1106 |  |  |
  | 1107 |  |  |
  | 1108 |  | /\*\* |
  | 1109 |  | \* This function displays the fill in the blank question |
  | 1110 |  | \* |
  | 1111 |  | \* @params $id The ID of the multiple choice question |
  | 1112 |  | \* @params $question The question that is being edited. |
  | 1113 |  | \* @params @answers The array that contains the answers to the question. |
  | 1114 |  | \* @return $question\_display Returns the content of the question |
  | 1115 |  | \* @since 4.4.0 |
  | 1116 |  | \*/ |
  | 1117 |  | function qmn\_fill\_blank\_display($id, $question, $answers) |
  | 1118 |  | { |
  | 1119 |  | $question\_display = ''; |
  | 1120 |  | global $mlwQuizMasterNext; |
  | 1121 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 1122 |  | $autofill = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'autofill'); |
  | 1123 |  | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_text'); |
  | 1124 |  | $autofill\_att = $autofill ? "autocomplete='off' " : ''; |
  | 1125 |  | $limit\_text\_att = $limit\_text ? "maxlength='". $limit\_text ."' " : ''; |
  | 1126 |  | if ($required == 0) {$mlw\_requireClass = "mlwRequiredText";} else {$mlw\_requireClass = "";} |
  | 1127 |  | $input\_text = "<input ". $autofill\_att . $limit\_text\_att . " type='text' class='qmn\_fill\_blank $mlw\_requireClass' name='question".$id."' />"; |
  | 1128 |  | if (strpos($question, '%BLANK%') !== false) |
  | 1129 |  | { |
  | 1130 |  | $question = str\_replace( "%BLANK%", $input\_text, do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))); |
  | 1131 |  | } |
  | 1132 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 1133 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 1134 |  | $question\_display .= qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 1135 |  | return apply\_filters('qmn\_fill\_blank\_display\_front',$question\_display,$id, $question, $answers); |
  | 1136 |  | } |
  | 1137 |  |  |
  | 1138 |  |  |
  | 1139 |  | /\*\* |
  | 1140 |  | \* This function determines how the fill in the blank question is graded. |
  | 1141 |  | \* |
  | 1142 |  | \* @params $id The ID of the multiple choice question |
  | 1143 |  | \* @params $question The question that is being edited. |
  | 1144 |  | \* @params @answers The array that contains the answers to the question. |
  | 1145 |  | \* @return $return\_array Returns the graded question to the results page |
  | 1146 |  | \* @since 4.4.0 |
  | 1147 |  | \*/ |
  | 1148 |  | function qmn\_fill\_blank\_review($id, $question, $answers) |
  | 1149 |  | { |
  | 1150 |  | $return\_array = array( |
  | 1151 |  | 'points' => 0, |
  | 1152 |  | 'correct' => 'incorrect', |
  | 1153 |  | 'user\_text' => '', |
  | 1154 |  | 'correct\_text' => '' |
  | 1155 |  | ); |
  | 1156 |  | if (strpos($question, '%BLANK%') !== false || strpos($question, '%blank%') !== false) |
  | 1157 |  | { |
  | 1158 |  | $return\_array['question\_text'] = str\_replace( array( "%BLANK%", "%blank%" ), array( "\_\_\_\_\_\_\_\_\_\_", "\_\_\_\_\_\_\_\_\_\_" ), do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))); |
  | 1159 |  | } |
  | 1160 |  | if ( isset( $\_POST["question".$id] ) ) { |
  | 1161 |  | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST["question".$id], ENT\_QUOTES ) ) ) ); |
  | 1162 |  | $mlw\_user\_answer = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_user\_answer ) ) ); |
  | 1163 |  | } else { |
  | 1164 |  | $mlw\_user\_answer = " "; |
  | 1165 |  | } |
  | 1166 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 1167 |  | foreach($answers as $answer) |
  | 1168 |  | { |
  | 1169 |  | $decode\_correct\_text = strval(htmlspecialchars\_decode($answer[0], ENT\_QUOTES)); |
  | 1170 |  | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " ", $decode\_correct\_text ) ) ); |
  | 1171 |  | if (mb\_strtoupper($return\_array['user\_text']) == mb\_strtoupper($return\_array['correct\_text'])) |
  | 1172 |  | { |
  | 1173 |  | $return\_array['correct'] = "correct"; |
  | 1174 |  | $return\_array['points'] = $answer[1]; |
  | 1175 |  | break; |
  | 1176 |  | } |
  | 1177 |  | } |
  | 1178 |  | return $return\_array; |
  | 1179 |  | } |
  | 1180 |  |  |
  | 1181 |  |  |
  | 1182 |  | //Start polar question |
  | 1183 |  | add\_action("plugins\_loaded", 'qmn\_question\_type\_polar'); |
  |  | 1079 | 'function'     => '', |
  |  | 1080 | ); |
  |  | 1081 |  |
  |  | 1082 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Fill In The Blank', 'quiz-master-next' ), 'qmn\_fill\_blank\_display', true, 'qmn\_fill\_blank\_review', $edit\_args, null, 14 ); |
  |  | 1083 |  |
  |  | 1084 | } |
  |  | 1085 |  |
  |  | 1086 |  |
  |  | 1087 | /\*\* |
  |  | 1088 | \* This function displays the fill in the blank question |
  |  | 1089 | \* |
  |  | 1090 | \* @params $id The ID of the multiple choice question |
  |  | 1091 | \* @params $question The question that is being edited. |
  |  | 1092 | \* @params @answers The array that contains the answers to the question. |
  |  | 1093 | \* @return $question\_display Returns the content of the question |
  |  | 1094 | \* @since 4.4.0 |
  |  | 1095 | \*/ |
  |  | 1096 | function qmn\_fill\_blank\_display( $id, $question, $answers ) { |
  |  | 1097 | $question\_display = ''; |
  |  | 1098 | global $mlwQuizMasterNext; |
  |  | 1099 | $required       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 1100 | $autofill       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'autofill' ); |
  |  | 1101 | $limit\_text     = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_text' ); |
  |  | 1102 | $autofill\_att   = $autofill ? "autocomplete='off' " : ''; |
  |  | 1103 | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' " : ''; |
  |  | 1104 | if ( $required == 0 ) { |
  |  | 1105 | $mlw\_requireClass = 'mlwRequiredText'; |
  |  | 1106 | } else { |
  |  | 1107 | $mlw\_requireClass = '';} |
  |  | 1108 | $input\_text = '<input ' . $autofill\_att . $limit\_text\_att . " type='text' class='qmn\_fill\_blank $mlw\_requireClass' name='question" . $id . "' />"; |
  |  | 1109 | if ( strpos( $question, '%BLANK%' ) !== false ) { |
  |  | 1110 | $question = str\_replace( '%BLANK%', $input\_text, do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) ); |
  |  | 1111 | } |
  |  | 1112 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 1113 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 1114 | $question\_display  .= qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 1115 | return apply\_filters( 'qmn\_fill\_blank\_display\_front', $question\_display, $id, $question, $answers ); |
  |  | 1116 | } |
  |  | 1117 |  |
  |  | 1118 |  |
  |  | 1119 | /\*\* |
  |  | 1120 | \* This function determines how the fill in the blank question is graded. |
  |  | 1121 | \* |
  |  | 1122 | \* @params $id The ID of the multiple choice question |
  |  | 1123 | \* @params $question The question that is being edited. |
  |  | 1124 | \* @params @answers The array that contains the answers to the question. |
  |  | 1125 | \* @return $return\_array Returns the graded question to the results page |
  |  | 1126 | \* @since 4.4.0 |
  |  | 1127 | \*/ |
  |  | 1128 | function qmn\_fill\_blank\_review( $id, $question, $answers ) { |
  |  | 1129 | $return\_array = array( |
  |  | 1130 | 'points'       => 0, |
  |  | 1131 | 'correct'      => 'incorrect', |
  |  | 1132 | 'user\_text'    => '', |
  |  | 1133 | 'correct\_text' => '', |
  |  | 1134 | ); |
  |  | 1135 | if ( strpos( $question, '%BLANK%' ) !== false || strpos( $question, '%blank%' ) !== false ) { |
  |  | 1136 | $return\_array['question\_text'] = str\_replace( array( '%BLANK%', '%blank%' ), array( '\_\_\_\_\_\_\_\_\_\_', '\_\_\_\_\_\_\_\_\_\_' ), do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) ); |
  |  | 1137 | } |
  |  | 1138 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 1139 | $decode\_user\_answer = sanitize\_textarea\_field( strval( stripslashes( htmlspecialchars\_decode( $\_POST[ 'question' . $id ], ENT\_QUOTES ) ) ) ); |
  |  | 1140 | $mlw\_user\_answer    = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_user\_answer ) ) ); |
  |  | 1141 | } else { |
  |  | 1142 | $mlw\_user\_answer = ' '; |
  |  | 1143 | } |
  |  | 1144 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 1145 | foreach ( $answers as $answer ) { |
  |  | 1146 | $decode\_correct\_text          = strval( htmlspecialchars\_decode( $answer[0], ENT\_QUOTES ) ); |
  |  | 1147 | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_correct\_text ) ) ); |
  |  | 1148 | if ( mb\_strtoupper( $return\_array['user\_text'] ) == mb\_strtoupper( $return\_array['correct\_text'] ) ) { |
  |  | 1149 | $return\_array['correct'] = 'correct'; |
  |  | 1150 | $return\_array['points']  = $answer[1]; |
  |  | 1151 | break; |
  |  | 1152 | } |
  |  | 1153 | } |
  |  | 1154 | return $return\_array; |
  |  | 1155 | } |
  |  | 1156 |  |
  |  | 1157 |  |
  |  | 1158 | // Start polar question |
  |  | 1159 | add\_action( 'plugins\_loaded', 'qmn\_question\_type\_polar' ); |
  | 1184 | 1160 |  |
  | 1185 | 1161 | /\*\* |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1190) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1166) |  |
  | 1190 | 1166 | \*/ |
  | 1191 | 1167 | function qmn\_question\_type\_polar() { |
  | 1192 |  | global $mlwQuizMasterNext; |
  | 1193 |  | ~~$mlwQuizMasterNext->pluginHelper->register\_question\_type(\_\_("Polar", 'quiz-master-next'), 'qmn\_polar\_display', true, 'qmn\_polar\_review', null, null, 13~~); |
  |  | 1168 | global $mlwQuizMasterNext; |
  |  | 1169 | $mlwQuizMasterNext->pluginHelper->register\_question\_type( \_\_( 'Polar', 'quiz-master-next' ), 'qmn\_polar\_display', true, 'qmn\_polar\_review', null, null, 13 ); |
  | 1194 | 1170 | } |
  | 1195 | 1171 |  |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1203) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1179) |  |
  | 1203 | 1179 | \* @since 6.4.1 |
  | 1204 | 1180 | \*/ |
  | 1205 |  | function qmn\_polar\_display($id, $question, $answers) { |
  | 1206 |  | $question\_display = ''; |
  | 1207 |  | global $mlwQuizMasterNext; |
  | 1208 |  | $required = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'required'); |
  | 1209 |  | $autofill = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'autofill'); |
  | 1210 |  | $limit\_text = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'limit\_text'); |
  | 1211 |  | $autofill\_att = $autofill ? "autocomplete='off' " : ''; |
  | 1212 |  | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' " : ''; |
  | 1213 |  | $input\_text = ''; |
  | 1214 |  | $first\_point = isset($answers[0][1]) ? $answers[0][1] : 0; |
  | 1215 |  | $second\_point = isset($answers[1][1]) ? $answers[1][1] : 0; |
  | 1216 |  | $is\_reverse = false; |
  | 1217 |  | $check\_point = $second\_point; |
  | 1218 |  | $font\_weight\_lc = 'right-polar-title'; |
  | 1219 |  | $font\_weight\_rc = 'left-polar-title'; |
  | 1220 |  | if($first\_point > $second\_point){ |
  | 1221 |  | $is\_reverse = true; |
  | 1222 |  | $check\_point = $first\_point; |
  | 1223 |  | $font\_weight\_lc = 'left-polar-title'; |
  | 1224 |  | $font\_weight\_rc = 'right-polar-title'; |
  | 1225 |  | } |
  | 1226 |  | $total\_answer = count($answers); |
  | 1227 |  | ?> |
  | 1228 |  | <script type="text/javascript"> |
  | 1229 |  | (function($) { |
  | 1230 |  | $(document).ready(function() { |
  | 1231 |  | $('#slider-' + '<?php echo $id; ?>').slider({ |
  | 1232 |  | <?php if ($total\_answer == 2 && $is\_reverse) { ?> |
  | 1233 |  | max: <?php echo $answers[0][1]; ?>, |
  | 1234 |  | min: <?php echo $answers[1][1]; ?>, |
  | 1235 |  | isRTL: true, |
  | 1236 |  | <?php }else{ ?> |
  | 1237 |  | min: <?php echo $answers[0][1]; ?>, |
  | 1238 |  | max: <?php echo $answers[1][1]; ?>, |
  | 1239 |  | <?php } ?> |
  | 1240 |  | step: 1, |
  | 1241 |  | value: <?php echo $check\_point/2; ?>, |
  | 1242 |  | change: function( event, ui ) { |
  | 1243 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.qmn\_polar').val(ui.value); |
  | 1244 |  | if(ui.value == <?php echo $answers[0][1]; ?>){ |
  | 1245 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','900'); |
  | 1246 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','100'); |
  | 1247 |  | } else if(ui.value == <?php echo $answers[1][1]; ?>){ |
  | 1248 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','100'); |
  | 1249 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','900'); |
  | 1250 |  | } else if(ui.value == <?php echo $check\_point / 2; ?>){ |
  | 1251 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','400'); |
  | 1252 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','400'); |
  | 1253 |  | } else if(ui.value > <?php echo $check\_point / 2; ?>){ |
  | 1254 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_rc; ?>').css('font-weight','400'); |
  | 1255 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_lc; ?>').css('font-weight','600'); |
  | 1256 |  | } else if(ui.value < <?php echo $check\_point / 2; ?>){ |
  | 1257 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_rc; ?>').css('font-weight','600'); |
  | 1258 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_lc; ?>').css('font-weight','400'); |
  | 1259 |  | } |
  | 1260 |  | }, |
  | 1261 |  | create: function( event, ui ) { |
  | 1262 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','400'); |
  | 1263 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','400'); |
  | 1264 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.qmn\_polar').val(<?php echo $check\_point/2; ?>); |
  | 1265 |  | } |
  | 1266 |  | }); |
  | 1267 |  | var maxHeight = Math.max.apply(null, $(".question-section-id-<?php echo $id; ?> .question-type-polar-s > div").map(function (){ |
  | 1268 |  | return $(this).height(); |
  | 1269 |  | }).get()); |
  | 1270 |  | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').height(maxHeight); |
  | 1271 |  | }); |
  | 1272 |  | })(jQuery); |
  | 1273 |  | </script> |
  | 1274 |  | <?php |
  | 1275 |  | if ($required == 0) { |
  | 1276 |  | $mlw\_requireClass = "mlwRequiredText"; |
  | 1277 |  | } else { |
  | 1278 |  | $mlw\_requireClass = ""; |
  | 1279 |  | } |
  | 1280 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 1281 |  | $question\_title = qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 1282 |  | //$question\_title = "<div class='mlw\_qmn\_question polar-question-title'>". do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES)) ."</div>"; |
  | 1283 |  | $input\_text .= "<div class='left-polar-title'>" . $answers[0][0] ."</div>"; |
  | 1284 |  | $input\_text .= "<div class='slider-main-wrapper'><input type='hidden' class='qmn\_polar $mlw\_requireClass' id='question" . $id . "' name='question" . $id . "' />"; |
  | 1285 |  | $input\_text .= '<div id="slider-'. $id .'"></div></div>'; |
  | 1286 |  | $input\_text .= "<div class='right-polar-title'>" . $answers[1][0] . "</div>"; |
  | 1287 |  | /\*if (strpos($question, '%POLAR\_SLIDER%') !== false) { |
  | 1288 |  | $question = str\_replace("%POLAR\_SLIDER%", $input\_text, do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))); |
  | 1289 |  | }\*/ |
  | 1290 |  | $question = $input\_text; |
  | 1291 |  | //$question\_title = apply\_filters('the\_content', $question); |
  | 1292 |  | $question\_display .= $question\_title . "<span class='mlw\_qmn\_question question-type-polar-s'>" . do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) . "</span>";; |
  | 1293 |  | return apply\_filters('qmn\_polar\_display\_front', $question\_display, $id, $question, $answers); |
  |  | 1181 | function qmn\_polar\_display( $id, $question, $answers ) { |
  |  | 1182 | $question\_display = ''; |
  |  | 1183 | global $mlwQuizMasterNext; |
  |  | 1184 | $required       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'required' ); |
  |  | 1185 | $autofill       = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'autofill' ); |
  |  | 1186 | $limit\_text     = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'limit\_text' ); |
  |  | 1187 | $autofill\_att   = $autofill ? "autocomplete='off' " : ''; |
  |  | 1188 | $limit\_text\_att = $limit\_text ? "maxlength='" . $limit\_text . "' " : ''; |
  |  | 1189 | $input\_text     = ''; |
  |  | 1190 | $first\_point    = isset( $answers[0][1] ) ? $answers[0][1] : 0; |
  |  | 1191 | $second\_point   = isset( $answers[1][1] ) ? $answers[1][1] : 0; |
  |  | 1192 | $is\_reverse     = false; |
  |  | 1193 | $check\_point    = $second\_point; |
  |  | 1194 | $font\_weight\_lc = 'right-polar-title'; |
  |  | 1195 | $font\_weight\_rc = 'left-polar-title'; |
  |  | 1196 | if ( $first\_point > $second\_point ) { |
  |  | 1197 | $is\_reverse     = true; |
  |  | 1198 | $check\_point    = $first\_point; |
  |  | 1199 | $font\_weight\_lc = 'left-polar-title'; |
  |  | 1200 | $font\_weight\_rc = 'right-polar-title'; |
  |  | 1201 | } |
  |  | 1202 | $total\_answer = count( $answers ); |
  |  | 1203 | ?> |
  |  | 1204 | <script type="text/javascript"> |
  |  | 1205 | (function($) { |
  |  | 1206 | $(document).ready(function() { |
  |  | 1207 | $('#slider-' + '<?php echo $id; ?>').slider({ |
  |  | 1208 | <?php if ( $total\_answer == 2 && $is\_reverse ) { ?> |
  |  | 1209 | max: <?php echo $answers[0][1]; ?>, |
  |  | 1210 | min: <?php echo $answers[1][1]; ?>, |
  |  | 1211 | isRTL: true, |
  |  | 1212 | <?php } else { ?> |
  |  | 1213 | min: <?php echo $answers[0][1]; ?>, |
  |  | 1214 | max: <?php echo $answers[1][1]; ?>, |
  |  | 1215 | <?php } ?> |
  |  | 1216 | step: 1, |
  |  | 1217 | value: <?php echo $check\_point / 2; ?>, |
  |  | 1218 | change: function( event, ui ) { |
  |  | 1219 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.qmn\_polar').val(ui.value); |
  |  | 1220 | if(ui.value == <?php echo $answers[0][1]; ?>){ |
  |  | 1221 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','900'); |
  |  | 1222 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','100'); |
  |  | 1223 | } else if(ui.value == <?php echo $answers[1][1]; ?>){ |
  |  | 1224 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','100'); |
  |  | 1225 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','900'); |
  |  | 1226 | } else if(ui.value == <?php echo $check\_point / 2; ?>){ |
  |  | 1227 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','400'); |
  |  | 1228 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','400'); |
  |  | 1229 | } else if(ui.value > <?php echo $check\_point / 2; ?>){ |
  |  | 1230 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_rc; ?>').css('font-weight','400'); |
  |  | 1231 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_lc; ?>').css('font-weight','600'); |
  |  | 1232 | } else if(ui.value < <?php echo $check\_point / 2; ?>){ |
  |  | 1233 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_rc; ?>').css('font-weight','600'); |
  |  | 1234 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.<?php echo $font\_weight\_lc; ?>').css('font-weight','400'); |
  |  | 1235 | } |
  |  | 1236 | }, |
  |  | 1237 | create: function( event, ui ) { |
  |  | 1238 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.left-polar-title').css('font-weight','400'); |
  |  | 1239 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.right-polar-title').css('font-weight','400'); |
  |  | 1240 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').find('.qmn\_polar').val(<?php echo $check\_point / 2; ?>); |
  |  | 1241 | } |
  |  | 1242 | }); |
  |  | 1243 | var maxHeight = Math.max.apply(null, $(".question-section-id-<?php echo $id; ?> .question-type-polar-s > div").map(function (){ |
  |  | 1244 | return $(this).height(); |
  |  | 1245 | }).get()); |
  |  | 1246 | $('.question-section-id-<?php echo $id; ?> .question-type-polar-s').height(maxHeight); |
  |  | 1247 | }); |
  |  | 1248 | })(jQuery); |
  |  | 1249 | </script> |
  |  | 1250 | <?php |
  |  | 1251 | if ( $required == 0 ) { |
  |  | 1252 | $mlw\_requireClass = 'mlwRequiredText'; |
  |  | 1253 | } else { |
  |  | 1254 | $mlw\_requireClass = ''; |
  |  | 1255 | } |
  |  | 1256 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting( $id, 'question\_title' ); |
  |  | 1257 | $question\_title     = qsm\_question\_title\_func( $question, '', $new\_question\_title ); |
  |  | 1258 | // $question\_title = "<div class='mlw\_qmn\_question polar-question-title'>". do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES)) ."</div>"; |
  |  | 1259 | $input\_text .= "<div class='left-polar-title'>" . $answers[0][0] . '</div>'; |
  |  | 1260 | $input\_text .= "<div class='slider-main-wrapper'><input type='hidden' class='qmn\_polar $mlw\_requireClass' id='question" . $id . "' name='question" . $id . "' />"; |
  |  | 1261 | $input\_text .= '<div id="slider-' . $id . '"></div></div>'; |
  |  | 1262 | $input\_text .= "<div class='right-polar-title'>" . $answers[1][0] . '</div>'; |
  |  | 1263 | /\* |
  |  | 1264 | if (strpos($question, '%POLAR\_SLIDER%') !== false) { |
  |  | 1265 | $question = str\_replace("%POLAR\_SLIDER%", $input\_text, do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))); |
  |  | 1266 | }\*/ |
  |  | 1267 | $question = $input\_text; |
  |  | 1268 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 1269 | $question\_display .= $question\_title . "<span class='mlw\_qmn\_question question-type-polar-s'>" . do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) . '</span>'; |
  |  | 1270 |  |
  |  | 1271 | return apply\_filters( 'qmn\_polar\_display\_front', $question\_display, $id, $question, $answers ); |
  | 1294 | 1272 | } |
  | 1295 | 1273 |  |
  | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2463503#L1303) | […](/browser/quiz-master-next/trunk/php/question-types.php?rev=2479603#L1281) |  |
  | 1303 | 1281 | \* @since 6.4.1 |
  | 1304 | 1282 | \*/ |
  | 1305 |  | function qmn\_polar\_review(~~$id, $question, $answers~~) { |
  | 1306 |  | $return\_array = array( |
  | 1307 |  | ~~'points'~~ => 0, |
  | 1308 |  | ~~'correct'~~ => 'incorrect', |
  | 1309 |  | ~~'user\_text'~~ => '', |
  | 1310 |  | 'correct\_text' => '' |
  | 1311 |  | ); |
  | 1312 |  | ~~if (strpos($question, '%POLAR\_SLIDER%') !== false || strpos($question, '%polar\_slider%') !== false~~) { |
  | 1313 |  | ~~$return\_array['question\_text'] = str\_replace( array( "%POLAR\_SLIDER%", "%polar\_slider%" ), array( "\_\_\_\_\_\_\_\_\_\_", "\_\_\_\_\_\_\_\_\_\_" ), do\_shortcode(htmlspecialchars\_decode($question, ENT\_QUOTES))~~); |
  | 1314 |  | } |
  | 1315 |  | ~~if (isset($\_POST["question" . $id])~~) { |
  | 1316 |  | ~~$decode\_user\_answer = sanitize\_textarea\_field( $\_POST["question" . $id~~] ); |
  | 1317 |  | ~~$mlw\_user\_answer = trim(preg\_replace('/\s\s+/', ' ', str\_replace("\n", " ", $decode\_user\_answer))~~); |
  | 1318 |  | } else { |
  | 1319 |  | ~~$mlw\_user\_answer = " "~~; |
  | 1320 |  | } |
  | 1321 |  | $return\_array['user\_text'] = $mlw\_user\_answer; |
  | 1322 |  | ~~$return\_array['points']~~ = $mlw\_user\_answer; |
  | 1323 |  | ~~foreach($answers as $answer)~~  { |
  | 1324 |  | ~~$decode\_correct\_text~~ = $answer[1]; |
  | 1325 |  | ~~$return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", " "~~, $decode\_correct\_text ) ) ); |
  | 1326 |  | ~~if ( $return\_array['user\_text'] ==  trim ($decode\_correct\_text) && isset($answer[2]~~) && $answer[2] == 1 ) { |
  | 1327 |  | $return\_array['correct'] = "correct"; |
  | 1328 |  | break; |
  | 1329 |  | } |
  | 1330 |  | } |
  | 1331 |  | return $return\_array; |
  | 1332 |  | } |
  | 1333 |  |  |
  | 1334 |  | function qsm\_question\_title\_func(~~$question,$question\_type = '',$new\_question\_title='')~~{ |
  | 1335 |  | ~~//~~$question\_title = apply\_filters('the\_content', $question); |
  | 1336 |  | $question\_title = $question; |
  | 1337 |  | global $wp\_embed,$mlwQuizMasterNext; |
  | 1338 |  | ~~$question\_title = $wp\_embed->run\_shortcode($question\_title~~); |
  | 1339 |  | ~~$question\_title = preg\_replace("/\s\*[a-zA-Z\/\/:\.]\*youtube.com\/watch\?v=([a-zA-Z0-9\-\_]+)([a-zA-Z0-9\/\\*\-\\_\?\&\;\%\=\.]\*)/i","<iframe width=\"420\" height=\"315\" src=\"//www.youtube.com/embed/$1\" frameborder=\"0\" allowfullscreen></iframe>",$question\_title~~); |
  | 1340 |  | $polar\_extra\_class = ''; |
  | 1341 |  | ~~$question\_display~~ = ''; |
  | 1342 |  | ~~if($question\_type == 'polar')~~{ |
  | 1343 |  | $polar\_extra\_class = 'question-type-polar-s'; |
  | 1344 |  | } |
  | 1345 |  | $qmn\_quiz\_options = $mlwQuizMasterNext->quiz\_settings->get\_quiz\_options(); |
  | 1346 |  | ~~$deselect\_answer~~ = ''; |
  | 1347 |  | ~~if( isset($qmn\_quiz\_options->enable\_deselect\_option) && $qmn\_quiz\_options->enable\_deselect\_option == 1 && ($question\_type == 'multiple\_choice' || $question\_type == 'horizontal\_multiple\_choice') )~~{ |
  | 1348 |  | $deselect\_answer = '<a href="#" class="qsm-deselect-answer">Deselect Answer</a>'; |
  | 1349 |  | } |
  | 1350 |  |  |
  | 1351 |  | ~~if($new\_question\_title != '')~~{ |
  | 1352 |  | ~~$question\_display .= "<span class='mlw\_qmn\_new\_question'>" . sanitize\_text\_field( htmlspecialchars\_decode( $new\_question\_title, ENT\_QUOTES ) ) . "</span>"~~; |
  | 1353 |  | $polar\_extra\_class .= ' qsm\_remove\_bold'; |
  | 1354 |  | } |
  | 1355 |  | ~~$question\_display .= "<span class='mlw\_qmn\_question {$polar\_extra\_class}' >" . do\_shortcode( htmlspecialchars\_decode( $question\_title, ENT\_QUOTES ) ) . $deselect\_answer . "</span>"~~; |
  | 1356 |  | return $question\_display; |
  |  | 1283 | function qmn\_polar\_review( $id, $question, $answers ) { |
  |  | 1284 | $return\_array = array( |
  |  | 1285 | 'points'       => 0, |
  |  | 1286 | 'correct'      => 'incorrect', |
  |  | 1287 | 'user\_text'    => '', |
  |  | 1288 | 'correct\_text' => '', |
  |  | 1289 | ); |
  |  | 1290 | if ( strpos( $question, '%POLAR\_SLIDER%' ) !== false || strpos( $question, '%polar\_slider%' ) !== false ) { |
  |  | 1291 | $return\_array['question\_text'] = str\_replace( array( '%POLAR\_SLIDER%', '%polar\_slider%' ), array( '\_\_\_\_\_\_\_\_\_\_', '\_\_\_\_\_\_\_\_\_\_' ), do\_shortcode( htmlspecialchars\_decode( $question, ENT\_QUOTES ) ) ); |
  |  | 1292 | } |
  |  | 1293 | if ( isset( $\_POST[ 'question' . $id ] ) ) { |
  |  | 1294 | $decode\_user\_answer = sanitize\_textarea\_field( $\_POST[ 'question' . $id ] ); |
  |  | 1295 | $mlw\_user\_answer    = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_user\_answer ) ) ); |
  |  | 1296 | } else { |
  |  | 1297 | $mlw\_user\_answer = ' '; |
  |  | 1298 | } |
  |  | 1299 | $return\_array['user\_text'] = $mlw\_user\_answer; |
  |  | 1300 | $return\_array['points']    = $mlw\_user\_answer; |
  |  | 1301 | foreach ( $answers as $answer ) { |
  |  | 1302 | $decode\_correct\_text          = $answer[1]; |
  |  | 1303 | $return\_array['correct\_text'] = trim( preg\_replace( '/\s\s+/', ' ', str\_replace( "\n", ' ', $decode\_correct\_text ) ) ); |
  |  | 1304 | if ( $return\_array['user\_text'] == trim( $decode\_correct\_text ) && isset( $answer[2] ) && $answer[2] == 1 ) { |
  |  | 1305 | $return\_array['correct'] = 'correct'; |
  |  | 1306 | break; |
  |  | 1307 | } |
  |  | 1308 | } |
  |  | 1309 | return $return\_array; |
  |  | 1310 | } |
  |  | 1311 |  |
  |  | 1312 | function qsm\_question\_title\_func( $question, $question\_type = '', $new\_question\_title = '' ) { |
  |  | 1313 | // $question\_title = apply\_filters('the\_content', $question); |
  |  | 1314 | $question\_title = $question; |
  |  | 1315 | global $wp\_embed,$mlwQuizMasterNext; |
  |  | 1316 | $question\_title    = $wp\_embed->run\_shortcode( $question\_title ); |
  |  | 1317 | $question\_title    = preg\_replace( '/\s\*[a-zA-Z\/\/:\.]\*youtube.com\/watch\?v=([a-zA-Z0-9\-\_]+)([a-zA-Z0-9\/\\*\-\\_\?\&\;\%\=\.]\*)/i', '<iframe width="420" height="315" src="//www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>', $question\_title ); |
  |  | 1318 | $polar\_extra\_class = ''; |
  |  | 1319 | $question\_display  = ''; |
  |  | 1320 | if ( $question\_type == 'polar' ) { |
  |  | 1321 | $polar\_extra\_class = 'question-type-polar-s'; |
  |  | 1322 | } |
  |  | 1323 | $qmn\_quiz\_options = $mlwQuizMasterNext->quiz\_settings->get\_quiz\_options(); |
  |  | 1324 | $deselect\_answer  = ''; |
  |  | 1325 | if ( isset( $qmn\_quiz\_options->enable\_deselect\_option ) && $qmn\_quiz\_options->enable\_deselect\_option == 1 && ( $question\_type == 'multiple\_choice' || $question\_type == 'horizontal\_multiple\_choice' ) ) { |
  |  | 1326 | $deselect\_answer = '<a href="#" class="qsm-deselect-answer">Deselect Answer</a>'; |
  |  | 1327 | } |
  |  | 1328 |  |
  |  | 1329 | if ( $new\_question\_title != '' ) { |
  |  | 1330 | $question\_display  .= "<span class='mlw\_qmn\_new\_question'>" . sanitize\_text\_field( htmlspecialchars\_decode( $new\_question\_title, ENT\_QUOTES ) ) . '</span>'; |
  |  | 1331 | $polar\_extra\_class .= ' qsm\_remove\_bold'; |
  |  | 1332 | } |
  |  | 1333 | $question\_display .= "<span class='mlw\_qmn\_question {$polar\_extra\_class}' >" . htmlspecialchars\_decode( do\_shortcode( $question\_title ), ENT\_QUOTES ) . $deselect\_answer . '</span>'; |
  |  | 1334 | return $question\_display; |
  | 1357 | 1335 | } |
  | 1358 | 1336 | ?> |
* ## [quiz-master-next/trunk/php/rest-api.php](/changeset/2479603/quiz-master-next/trunk/php/rest-api.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/rest-api.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/rest-api.php?rev=2463503#L89 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/rest-api.php?rev=2479603#L89 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 89 | 89 | if(is\_user\_logged\_in()){ |
  | 90 | 90 | global $wpdb; |
  | 91 |  | $category = isset($\_REQUEST['category']) ? ~~$\_REQUEST['category']~~ : ''; |
  |  | 91 | $category = isset($\_REQUEST['category']) ? sanitize\_text\_field( $\_REQUEST['category'] ) : ''; |
  | 92 | 92 | $category\_query = ''; |
  | 93 | 93 | if($category){ |
* ## [quiz-master-next/trunk/php/template-variables.php](/changeset/2479603/quiz-master-next/trunk/php/template-variables.php "Show the changeset 2479603 restricted to quiz-master-next/trunk/php/template-variables.php")

  | [r2463503](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L101 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L101 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 101 | 101 | }else{ |
  | 102 | 102 | $qmn\_question\_answer\_template = $mlwQuizMasterNext->pluginHelper->get\_section\_setting( 'quiz\_text', 'question\_answer\_email\_template', '%QUESTION%<br/>Answer Provided: %USER\_ANSWER%<br/>Correct Answer: %CORRECT\_ANSWER%<br/>Comments Entered: %USER\_COMMENTS%' ); |
  | 103 |  | } |
  |  | 103 | } |
  | 104 | 104 | } else { |
  | 105 | 105 | if( isset( $mlw\_quiz\_array['quiz\_settings'] ) && !empty($mlw\_quiz\_array['quiz\_settings']) ){ |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L109) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L109) |  |
  | 109 | 109 | $qmn\_question\_answer\_template = $mlwQuizMasterNext->pluginHelper->get\_section\_setting( 'quiz\_text', 'question\_answer\_template', '%QUESTION%<br/>%USER\_ANSWERS\_DEFAULT%' ); |
  | 110 | 110 | } |
  | 111 |  | } |
  |  | 111 | } |
  | 112 | 112 | $mlw\_question\_answer\_display = htmlspecialchars\_decode($qmn\_question\_answer\_template, ENT\_QUOTES); |
  | 113 | 113 | $questions = QSM\_Questions::load\_questions\_by\_pages( $mlw\_quiz\_array['quiz\_id'] ); |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L115) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L115) |  |
  | 115 | 115 | foreach ( $questions as $question ) { |
  | 116 | 116 | $qmn\_questions[ $question['question\_id'] ] = $question['question\_answer\_info']; |
  | 117 |  | } |
  |  | 117 | } |
  | 118 | 118 | $total\_question\_cnt = 2; |
  | 119 | 119 | $qsm\_question\_cnt = 1; |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L127) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L127) |  |
  | 127 | 127 | /\*\* |
  | 128 | 128 | \* Replace total\_possible\_points variable with actual points |
  | 129 |  | \* |
  |  | 129 | \* |
  | 130 | 130 | \* @since 7.0.2 |
  | 131 |  | \* |
  |  | 131 | \* |
  | 132 | 132 | \* @param string $content |
  | 133 | 133 | \* @param array $mlw\_quiz\_array |
  | 134 | 134 | \* @return string $content |
  | 135 | 135 | \*/ |
  | 136 |  | function qsm\_variable\_total\_possible\_points( $content, $mlw\_quiz\_array ){ |
  |  | 136 | function qsm\_variable\_total\_possible\_points( $content, $mlw\_quiz\_array ){ |
  | 137 | 137 | if( isset( $mlw\_quiz\_array["total\_possible\_points"] ) ){ |
  | 138 | 138 | $content = str\_replace( "%MAXIMUM\_POINTS%" , $mlw\_quiz\_array["total\_possible\_points"], $content); |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L143) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L143) |  |
  | 143 | 143 | /\*\* |
  | 144 | 144 | \* Replace total\_possible\_points variable with actual points |
  | 145 |  | \* |
  |  | 145 | \* |
  | 146 | 146 | \* @since 7.0.2 |
  | 147 |  | \* |
  |  | 147 | \* |
  | 148 | 148 | \* @param string $content |
  | 149 | 149 | \* @param array $mlw\_quiz\_array |
  | 150 | 150 | \* @return string $content |
  | 151 | 151 | \*/ |
  | 152 |  | function qsm\_variable\_total\_attempted\_questions( $content, $mlw\_quiz\_array ){ |
  |  | 152 | function qsm\_variable\_total\_attempted\_questions( $content, $mlw\_quiz\_array ){ |
  | 153 | 153 | $total\_attempted\_questions =  isset( $mlw\_quiz\_array["total\_attempted\_questions"] ) ? $mlw\_quiz\_array["total\_attempted\_questions"] : 0; |
  | 154 |  | $content = str\_replace( "%AMOUNT\_ATTEMPTED%" , $total\_attempted\_questions, $content); |
  |  | 154 | $content = str\_replace( "%AMOUNT\_ATTEMPTED%" , $total\_attempted\_questions, $content); |
  | 155 | 155 | return $content; |
  | 156 | 156 | } |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L215) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L215) |  |
  | 215 | 215 |  |
  | 216 | 216 | function qsm\_find\_key\_from\_array($search\_value,$array){ |
  | 217 |  | if($array){ |
  |  | 217 | if($array){ |
  | 218 | 218 | $search\_value = htmlspecialchars\_decode( $search\_value, ENT\_QUOTES ); |
  | 219 |  | foreach ($array as $key => $value) { |
  |  | 219 | foreach ($array as $key => $value) { |
  | 220 | 220 | $value\_val = $value[0]; |
  | 221 | 221 | if( $value\_val == $search\_value ){ |
  | 222 | 222 | return true; |
  | 223 | 223 | } |
  | 224 |  | } |
  |  | 224 | } |
  | 225 | 225 | } |
  | 226 | 226 | return false; |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L279) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L279) |  |
  | 279 | 279 | } |
  | 280 | 280 | function mlw\_qmn\_variable\_average\_point($content, $mlw\_quiz\_array){ |
  | 281 |  | $question\_total = 0; |
  |  | 281 | $question\_total = 0; |
  | 282 | 282 | if( isset( $mlw\_quiz\_array['question\_answers\_array'] )  ){ |
  | 283 | 283 | foreach( $mlw\_quiz\_array['question\_answers\_array'] as $single\_question ){ |
  | 284 |  | if( $single\_question['question\_type'] !== '11' ){ |
  |  | 284 | if( $single\_question['question\_type'] !== '11' ){ |
  | 285 | 285 | $question\_total++; |
  | 286 |  | } |
  |  | 286 | } |
  | 287 | 287 | } |
  | 288 | 288 | } |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L308) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L308) |  |
  | 308 | 308 | /\*\* |
  | 309 | 309 | \* Return total incorrect amount |
  | 310 |  | \* |
  |  | 310 | \* |
  | 311 | 311 | \* @since 7.0.3 |
  | 312 | 312 | \* @param string $content |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L375) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L375) |  |
  | 375 | 375 | \*/ |
  | 376 | 376 | function mlw\_qmn\_variable\_user\_full\_name($content, $mlw\_quiz\_array) { |
  | 377 |  | if (false !== strpos($content, '%FULL\_NAME%')) { |
  | 378 |  | $current\_user = wp\_get\_current\_user(); |
  |  | 377 | if (false !== strpos($content, '%FULL\_NAME%')) { |
  |  | 378 | $current\_user = wp\_get\_current\_user(); |
  | 379 | 379 | $firstname = get\_user\_meta( $current\_user->ID, 'first\_name', true ); |
  | 380 | 380 | $lastname = get\_user\_meta( $current\_user->ID, 'last\_name', true ); |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L597) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L597) |  |
  | 597 | 597 | foreach ( $mlw\_quiz\_array['question\_answers\_array'] as $answer ) { |
  | 598 | 598 | if ( $answer["category"] == $category\_name ) { |
  | 599 |  | if( $answer['question\_type'] !== '11' ){ |
  |  | 599 | if( $answer['question\_type'] !== '11' ){ |
  | 600 | 600 | $total\_questions += 1; |
  | 601 | 601 | } |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L774) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L774) |  |
  | 774 | 774 | add\_filter('qmn\_end\_results', 'qsm\_end\_results\_rank', 9999, 3); |
  | 775 | 775 | function qsm\_end\_results\_rank($result\_display, $qmn\_quiz\_options, $qmn\_array\_for\_variables) |
  | 776 |  | { |
  |  | 776 | { |
  | 777 | 777 | while (strpos($result\_display, '%RANK%') !== false){ |
  | 778 | 778 | global $wpdb; |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L849) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L849) |  |
  | 849 | 849 | /\*\* |
  | 850 | 850 | \* Function will convert all the QUESIONS\_ANSWERS variable into appropriate data |
  | 851 |  | \* |
  |  | 851 | \* |
  | 852 | 852 | \* @since 7.1.3 |
  | 853 |  | \* |
  |  | 853 | \* |
  | 854 | 854 | \* @param arr $mlw\_quiz\_array |
  | 855 | 855 | \* @param str $qmn\_question\_answer\_template |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L859) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L859) |  |
  | 859 | 859 | \* @return string |
  | 860 | 860 | \*/ |
  | 861 |  | function qsm\_questions\_answers\_shortcode\_to\_text($mlw\_quiz\_array, $qmn\_question\_answer\_template, $questions, $qmn\_questions, $answer, $qsm\_question\_cnt, $total\_question\_cnt) { |
  |  | 861 | function qsm\_questions\_answers\_shortcode\_to\_text($mlw\_quiz\_array, $qmn\_question\_answer\_template, $questions, $qmn\_questions, $answer, $qsm\_question\_cnt, $total\_question\_cnt) { |
  | 862 | 862 | global $mlwQuizMasterNext; |
  | 863 | 863 | if (is\_admin() && isset($\_GET['page']) && $\_GET['page'] == 'qsm\_quiz\_result\_details') { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L884) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L884) |  |
  | 884 | 884 | } |
  | 885 | 885 | } |
  | 886 |  |  |
  |  | 886 |  |
  | 887 | 887 | $mlw\_question\_answer\_display = htmlspecialchars\_decode($qmn\_question\_answer\_template, ENT\_QUOTES); |
  | 888 | 888 | $disable\_description\_on\_result = $mlwQuizMasterNext->pluginHelper->get\_section\_setting('quiz\_options', 'disable\_description\_on\_result'); |
  | 889 |  |  |
  | 890 |  | if (isset($answer['question\_title']) && $answer['question\_title'] != '') { |
  |  | 889 | //Get question setting |
  |  | 890 | $question\_settings = isset( $questions[$answer['id']]['settings'] ) ? $questions[$answer['id']]['settings'] : array(); |
  |  | 891 | if (isset($answer['question\_title']) && $answer['question\_title'] != '') { |
  | 891 | 892 | $add\_br = ''; |
  | 892 | 893 | if ($answer[0] != '') { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L897) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L898) |  |
  | 897 | 898 | } else { |
  | 898 | 899 | $mlw\_question\_answer\_display = str\_replace("%QUESTION%", '<b>' . htmlspecialchars\_decode($answer['question\_title'], ENT\_QUOTES) . '</b>' . $add\_br . htmlspecialchars\_decode($answer[0], ENT\_QUOTES), $mlw\_question\_answer\_display); |
  | 899 |  | } |
  | 900 |  | } else { |
  |  | 900 | } |
  |  | 901 | } else { |
  | 901 | 902 | $mlw\_question\_answer\_display = str\_replace("%QUESTION%", '<b>' .  htmlspecialchars\_decode($answer[0], ENT\_QUOTES) . '</b>', $mlw\_question\_answer\_display); |
  | 902 |  | } |
  | 903 |  | $mlw\_question\_answer\_display = qsm\_question\_title\_func($mlw\_question\_answer\_display); |
  |  | 903 | } |
  |  | 904 | $mlw\_question\_answer\_display = qsm\_question\_title\_func($mlw\_question\_answer\_display); |
  | 904 | 905 | $extra\_border\_bottom\_class = ''; |
  | 905 | 906 | $remove\_border = true; |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L912) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L913) |  |
  | 912 | 913 | ); |
  | 913 | 914 | $form\_type = isset($mlw\_quiz\_array['form\_type']) ? $mlw\_quiz\_array['form\_type'] : 0; |
  | 914 |  | $quiz\_system = isset($mlw\_quiz\_array['quiz\_system']) ? $mlw\_quiz\_array['quiz\_system'] : 0; |
  | 915 |  | if (isset($answer['id']) && isset($questions[$answer['id']]) && !empty($questions[$answer['id']])) { |
  | 916 |  | $total\_answers = isset($questions[$answer['id']]['answers']) ? $questions[$answer['id']]['answers'] : array(); |
  |  | 915 | $quiz\_system = isset($mlw\_quiz\_array['quiz\_system']) ? $mlw\_quiz\_array['quiz\_system'] : 0; |
  |  | 916 | if (isset($answer['id']) && isset($questions[$answer['id']]) && !empty($questions[$answer['id']])) { |
  |  | 917 | $total\_answers = isset($questions[$answer['id']]['answers']) ? $questions[$answer['id']]['answers'] : array(); |
  | 917 | 918 | if ($total\_answers) { |
  | 918 |  | if (isset($answer['question\_type']) && in\_array($answer['question\_type'], $show\_two\_option\_questions)) { |
  |  | 919 | if (isset($answer['question\_type']) && in\_array($answer['question\_type'], $show\_two\_option\_questions)) { |
  | 919 | 920 | $do\_show\_wrong = true; |
  | 920 | 921 | foreach ($total\_answers as $single\_answer) { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L956) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L957) |  |
  | 956 | 957 | } else { |
  | 957 | 958 | if ($form\_type == 0 && ( $quiz\_system == 0 || $quiz\_system == 3 )) { |
  | 958 |  | if (isset($answer['question\_type']) && ( $answer['question\_type'] == 4 || $answer['question\_type'] == 10 )) { |
  |  | 959 | if (isset($answer['question\_type']) && ( $answer['question\_type'] == 4 || $answer['question\_type'] == 10 )) { |
  | 959 | 960 | $user\_selected\_answer = htmlspecialchars\_decode($answer[1], ENT\_QUOTES); |
  | 960 | 961 | $new\_array\_user\_answer = isset( $answer['user\_compare\_text'] ) ? explode('=====', $answer['user\_compare\_text']) : array(); |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L968) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L969) |  |
  | 968 | 969 | $is\_answer\_correct = true; |
  | 969 | 970 | break; |
  | 970 |  | } |
  |  | 971 | } |
  | 971 | 972 | } |
  | 972 | 973 | } |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L983) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L984) |  |
  | 983 | 984 | } else { |
  | 984 | 985 | if($answer['question\_type'] == 13) |
  | 985 |  | { |
  |  | 986 | { |
  | 986 | 987 | $questionid = $questions[$answer['id']]['question\_id']; |
  | 987 |  | $question\_with\_answer\_text .= qmn\_polar\_display\_on\_resultspage($questionid, $questions, $total\_answers,$answer); |
  |  | 988 | $question\_with\_answer\_text .= qmn\_polar\_display\_on\_resultspage($questionid, $questions, $total\_answers,$answer); |
  | 988 | 989 | } |
  | 989 |  | else |
  | 990 |  | { |
  | 991 |  | foreach ($total\_answers as $single\_answer) { |
  |  | 990 | else { |
  |  | 991 | foreach ($total\_answers as $single\_answer) { |
  | 992 | 992 | $single\_answer\_option = $single\_answer[0]; |
  | 993 |  | if (isset($single\_answer[2]) && $single\_answer[2] == 1 && htmlspecialchars\_decode($answer[1], ENT\_QUOTES) == $single\_answer\_option ) { |
  |  | 993 | if( isset( $question\_settings['answerEditor'] ) && $question\_settings['answerEditor'] == 'rich' ){ |
  |  | 994 | $single\_answer\_option = htmlspecialchars\_decode( $single\_answer[0], ENT\_QUOTES ); |
  |  | 995 | $single\_answer\_option = htmlentities( $single\_answer\_option ); |
  |  | 996 | if( strpos($single\_answer\_option, '&lt;') !== false || strpos($single\_answer\_option, '&quot;') !== false ){ |
  |  | 997 | $single\_answer\_option = htmlspecialchars( $single\_answer\_option ); |
  |  | 998 | } |
  |  | 999 | if( strpos($answer[1], '&lt;') !== false || strpos($answer[1], '&quot;') !== false ){ |
  |  | 1000 | $answer\_value = htmlentities( $answer[1] ); |
  |  | 1001 | }else { |
  |  | 1002 | $answer\_value = $answer[1]; |
  |  | 1003 | } |
  |  | 1004 | } else { |
  |  | 1005 | $answer\_value = htmlspecialchars\_decode($answer[1], ENT\_QUOTES); |
  |  | 1006 | } |
  |  | 1007 | if (isset($single\_answer[2]) && $single\_answer[2] == 1 && $answer\_value == $single\_answer\_option ) { |
  | 994 | 1008 | $question\_with\_answer\_text .= '<span class="qsm-text-correct-option qsm-text-user-correct-answer">' . htmlspecialchars\_decode($single\_answer[0], ENT\_QUOTES) . '</span>'; |
  | 995 | 1009 | } else if (isset($single\_answer[2]) && $single\_answer[2] == 1) { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1002) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1016) |  |
  | 1002 | 1016 | } |
  | 1003 | 1017 | } |
  | 1004 |  | } |
  |  | 1018 | } |
  | 1005 | 1019 | } else { |
  | 1006 | 1020 | if (isset($answer['question\_type']) && ( $answer['question\_type'] == 4 || $answer['question\_type'] == 10 )) { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1015) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1029) |  |
  | 1015 | 1029 | } else { |
  | 1016 | 1030 | if($answer['question\_type'] == 13) |
  | 1017 |  | { |
  |  | 1031 | { |
  | 1018 | 1032 | $questionid = $questions[$answer['id']]['question\_id']; |
  | 1019 |  |  |
  | 1020 |  | $question\_with\_answer\_text .= qmn\_polar\_display\_on\_resultspage($questionid, $questions, $total\_answers,$answer); |
  |  | 1033 |  |
  |  | 1034 | $question\_with\_answer\_text .= qmn\_polar\_display\_on\_resultspage($questionid, $questions, $total\_answers,$answer); |
  | 1021 | 1035 | } |
  | 1022 | 1036 | else |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1045) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1059) |  |
  | 1045 | 1059 | } |
  | 1046 | 1060 | } |
  | 1047 |  | } |
  | 1048 |  | $mlw\_question\_answer\_display = str\_replace("%USER\_ANSWERS\_DEFAULT%", ~~$question\_with\_answer\_text~~, $mlw\_question\_answer\_display); |
  |  | 1061 | } |
  |  | 1062 | $mlw\_question\_answer\_display = str\_replace("%USER\_ANSWERS\_DEFAULT%", do\_shortcode( $question\_with\_answer\_text ), $mlw\_question\_answer\_display); |
  | 1049 | 1063 | } |
  | 1050 | 1064 | if (isset($answer['question\_type']) && $answer['question\_type'] == 11) { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1071) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1085) |  |
  | 1071 | 1085 | $question\_point = isset( $answer['points'] ) ? $answer['points'] : '0'; |
  | 1072 | 1086 | $mlw\_question\_answer\_display = str\_replace("%QUESTION\_POINT\_SCORE%", htmlspecialchars\_decode($question\_point, ENT\_QUOTES), $mlw\_question\_answer\_display); |
  | 1073 |  |  |
  |  | 1087 |  |
  | 1074 | 1088 | $question\_max\_point = (isset($questions[$answer['id']]) ? qsm\_get\_question\_maximum\_points($questions[$answer['id']]) : 0 ); |
  | 1075 | 1089 | $mlw\_question\_answer\_display = str\_replace("%QUESTION\_MAX\_POINTS%", $question\_max\_point, $mlw\_question\_answer\_display); |
  | 1076 |  |  |
  |  | 1090 |  |
  | 1077 | 1091 | $mlw\_question\_answer\_display = wp\_kses\_post($mlw\_question\_answer\_display); |
  | 1078 | 1092 | if ($total\_question\_cnt == $qsm\_question\_cnt && $remove\_border == false ) { |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1115) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1129) |  |
  | 1115 | 1129 | $form\_type = $mlwQuizMasterNext->pluginHelper->get\_section\_setting('quiz\_options', 'form\_type'); |
  | 1116 | 1130 | $system = $mlwQuizMasterNext->pluginHelper->get\_section\_setting('quiz\_options', 'system'); |
  | 1117 |  |  |
  |  | 1131 |  |
  | 1118 | 1132 | // check if  quiz type Quiz and Geading system Correct/Incorrect Or Both Type |
  | 1119 |  | if($score\_roundoff && $form\_type ==0 && ($system ==0 || $system == 3)) |
  |  | 1133 | if($score\_roundoff && $form\_type ==0 && ($system ==0 || $system == 3)) |
  | 1120 | 1134 | return 1; |
  | 1121 | 1135 | else |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1132) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1146) |  |
  | 1132 | 1146 | \* @since 7.1.10 |
  | 1133 | 1147 | \*/ |
  | 1134 |  | function qmn\_polar\_display\_on\_resultspage($id, $question, $answers,$answer) { |
  |  | 1148 | function qmn\_polar\_display\_on\_resultspage($id, $question, $answers,$answer) { |
  | 1135 | 1149 | $question\_display = ''; |
  | 1136 | 1150 | global $mlwQuizMasterNext; |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1158) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1172) |  |
  | 1158 | 1172 | (function($) { |
  | 1159 | 1173 | $(document).ready(function() { |
  | 1160 |  |  |
  |  | 1174 |  |
  | 1161 | 1175 | $('#slider-' + '<?php echo $id; ?>').slider({ |
  | 1162 | 1176 | <?php if ($total\_answer == 2 && $is\_reverse) { ?> |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1173) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1187) |  |
  | 1173 | 1187 | slide: function slider\_slide(event, ui) { |
  | 1174 | 1188 | return false; // this code not allow to dragging |
  | 1175 |  | } |
  |  | 1189 | } |
  | 1176 | 1190 | }); |
  | 1177 | 1191 | var maxHeight = Math.max.apply(null, $(".mlw-qmn-question-result-<?php echo $id; ?>> div").map(function (){ |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1180) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1194) |  |
  | 1180 | 1194 | $('.mlw-qmn-question-result-<?php echo $id; ?>').height(maxHeight); |
  | 1181 | 1195 | }); |
  | 1182 |  | })(jQuery); |
  |  | 1196 | })(jQuery); |
  | 1183 | 1197 | </script> |
  | 1184 | 1198 | <?php |
  | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2463503#L1218) | […](/browser/quiz-master-next/trunk/php/template-variables.php?rev=2479603#L1232) |  |
  | 1218 | 1232 | $right\_polar\_title\_style = "style='font-weight:400;'"; |
  | 1219 | 1233 | } |
  | 1220 |  | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  |  | 1234 | $new\_question\_title = $mlwQuizMasterNext->pluginHelper->get\_question\_setting($id, 'question\_title'); |
  | 1221 | 1235 | $question\_title = qsm\_question\_title\_func($question, '', $new\_question\_title); |
  | 1222 | 1236 | $input\_text .= "<div class='left-polar-title' $left\_polar\_title\_style>" . $answers[0][0] ."</div>"; |
* ## [quiz-master-next/trunk/readme.txt](/changeset/2479603/quiz-master-next/trunk/readme.txt "Show the changeset 2479603 restricted to quiz-master-next/trunk/readme.txt")

  | [r2463503](/browser/quiz-master-next/trunk/readme.txt?rev=2463503#L5 "Show revision 2463503 of this file in browser") | [r2479603](/browser/quiz-master-next/trunk/readme.txt?rev=2479603#L5 "Show revision 2479603 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 5.6 |
  | 6 | 6 | Requires PHP: 5.4 |
  | 7 |  | Stable tag: 7.1.1~~1~~ |
  |  | 7 | Stable tag: 7.1.12 |
  | 8 | 8 | License: GPLv2 |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/quiz-master-next/trunk/readme.txt?rev=2463503#L126) | […](/browser/quiz-master-next/trunk/readme.txt?rev=2479603#L126) |  |
  | 126 | 126 | == Screenshots == |
  | 127 | 127 |  |
  | 128 |  | 1. Quiz/Survey Admin Page (With Advertisement Be Gone Add-On) |
  | 129 |  | 2. Quiz/Survey Settings Page (With Advertisement Be Gone Add-On) |
  | 130 |  | 3. Quiz/Survey Statistics Page (With Advertisement Be Gone Add-On) |
  | 131 |  | 4. Example Quiz |
  | 132 |  | 5. Example Survey |
  | 133 |  | 6. Quiz/Survey Results Page |
  | 134 |  | 8. Example Quiz With Styling |
  |  | 128 | 1. Dashboard |
  |  | 129 | 2. Create New Quiz or Survey |
  |  | 130 | 3. Question Type |
  |  | 131 | 4. Questions |
  |  | 132 | 5. All Quizzes & Surveys |
  |  | 133 | 6. Contact Field |
  |  | 134 | 7. Frontend View |
  |  | 135 | 8. Frontend View with Answer |
  |  | 136 | 9. Answer |
  |  | 137 | 10. Database |
  |  | 138 | 11. Stats |
  |  | 139 | 12. Reporting and analysis result |
  | 135 | 140 |  |
  | 136 | 141 | == Changelog == |
  |  | 142 |  |
  |  | 143 | = 7.1.12 (February 22, 2020) = |
  |  | 144 | \* Bug: Fixed prevention of SQL injection while using result shortcode and question bank. |
  |  | 145 | \* Bug: Fixed the issue of broken [latex] shortcode in result and user dashboard page. |
  |  | 146 | \* Enhancement: Added option to end the quiz if answer is wrong. |
  |  | 147 | \* Enhancement: Added option to turn off the HTML auto complete. |
  |  | 148 | \* Enhancement: Modified  background color to fix contrast ratios from SEO perspective. |
  | 137 | 149 |  |
  | 138 | 150 | = 7.1.11 (January 27, 2020) = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2479603)
* [Zip Archive](?format=zip&new=2479603)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


