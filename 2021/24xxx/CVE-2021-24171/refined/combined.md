=== Content from wpscan.com_62403193_20250114_223401.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# WooCommerce Upload Files < 59.4 - Unauthenticated Arbitrary File Upload

### Description

The plugin ran a single sanitization pass to remove blocked extensions such as .php. It was possible to bypass this and upload a file with a PHP extension by embedding a "blocked" extension within another "blocked" extension in the "wcuf\_file\_name" parameter. It was also possible to perform a double extension attack and upload files to a different location via path traversal using the "wcuf\_current\_upload\_session\_id" parameter.

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

woocommerce-upload-files](https://a8cteam5105.wordpress.com/plugin/woocommerce-upload-files/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 59.4

### References

CVE
[CVE-2021-24171](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24171)

URL
<https://www.wordfence.com/blog/2021/03/critical-vulnerability-patched-in-woocommerce-upload-files/>

### Classification

Type
RCE

OWASP top 10
[A1: Injection](https://www.owasp.org/index.php/Top_10-2017_A1-Injection)

CWE
[CWE-94](https://cwe.mitre.org/data/definitions/94.html)

CVSS
[9.8 (critical)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Ramuel Gall

Submitter
Ramuel Gall

Submitter twitter
[ramuelgall](//twitter.com/ramuelgall)

Verified
Yes

WPVDB ID
[ed4288a1-f7e4-455f-b765-5ac343f87194](https://a8cteam5105.wordpress.com/vulnerability/ed4288a1-f7e4-455f-b765-5ac343f87194/)

### Timeline

Publicly Published
2021-03-04 (about 3 years ago)

Added
2021-03-04 (about 3 years ago)

Last Updated
2021-04-03 (about 3 years ago)

### Other

Published
Title

Published
2024-09-09
Title
[Frontend Dashboard < 2.2.5 - Authenticated (Subscriber+) Arbitrary Function Call](https://a8cteam5105.wordpress.com/vulnerability/c652b42e-83fc-496f-bf0c-b3ddf95e2e0e/)

Published
2024-04-25
Title
[Customify Site Library <= 0.0.9 - Unauthenticated Remote Code Execution](https://a8cteam5105.wordpress.com/vulnerability/1fdec557-a4ab-4c1f-a639-695cac5b0cea/)

Published
2023-11-24
Title
[Vrm 360 3D Model Viewer <= 1.2.1 - Contributor+ Arbitrary File Upload Leading to RCE](https://a8cteam5105.wordpress.com/vulnerability/21950116-1a69-4848-9da0-e912096c0fce/)

Published
2024-06-20
Title
[WishList Member X <= 3.25.1 - Authenticated (Subscriber+) Remote Code Execution](https://a8cteam5105.wordpress.com/vulnerability/555e2380-952e-499e-a588-0f8ebffaefd8/)

Published
2024-03-24
Title
[WP Crontrol < 1.16.2 - Remote Code Execution](https://a8cteam5105.wordpress.com/vulnerability/09ad62c7-ee1a-403c-b6ba-59fba697bb2c/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from www.wordfence.com_a77cbb0d_20250114_223402.html ===


![Critical Vulnerability Patched in WooCommerce Upload Files Featured Image](https://www.wordfence.com/wp-content/uploads/2021/03/critical-vulnerability-patched-in-woocommerce-upload-files.jpg)

[![](https://secure.gravatar.com/avatar/d46b866dba15e07748d03fe68187c62c?s=80&d=mm&r=g)Wordfence Author](https://www.wordfence.com/blog/author/wfauthor/)

March 4, 2021

# Critical Vulnerability Patched in WooCommerce Upload Files

On December 29, 2020, the Wordfence Threat Intelligence team was alerted to a potential 0-day vulnerability in the [WooCommerce Upload Files](https://codecanyon.net/item/woocommerce-upload-files/11442983) plugin, an add-on for WooCommerce with over 5,000 installations.

Please note that this is a separate plugin from the main WooCommerce plugin and is designed as an add-on to that plugin.

After confirming the vulnerability, we contacted the plugin’s developer, Domenico Lagudi, who responded quickly and released a patch the same day, on December 29, 2020.

Although the Wordfence firewall’s built-in rules provided some degree of protection against this vulnerability, we determined that a bypass was possible. We quickly released a firewall rule to our premium customers on December 29, 2020. Sites still running the free version of Wordfence received the firewall rule 30 days later, on January 28, 2021.

**Description:** Unauthenticated Arbitrary File Upload

**Affected Plugin:** WooCommerce Upload Files

**Plugin Slug:** woocommerce-upload-files

**Affected Versions:** < 59.4

**CVE ID:** CVE-2021-24171

**CVSS Score:** 9.8 (Critical)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**Fully Patched Version:** 59.4

WooCommerce Upload Files is a premium plugin designed to allow customers to upload files when checking out in order to purchase customized products. In order to provide this functionality, it uses a publicly accessible AJAX function, `ajax_manage_file_chunk_upload`.

```
	function ajax_manage_file_chunk_upload()
	{
		global $wcuf_session_model ;

		if(!isset($_POST['wcuf_upload_field_name']))
			wp_die();

		$this->saving_on_session = true;
		$buffer = 5242880; //1048576; //1mb
		$target_path = $this->get_temp_dir_path();
		$tmp_name = $_FILES['wcuf_file_chunk']['tmp_name'];
		$size = $_FILES['wcuf_file_chunk']['size'];
		$current_chunk_num = $_POST['wcuf_current_chunk_num'];
		$file_name = str_replace($this->to_remove_from_file_name, "",$_POST['wcuf_file_name']);
		$tmp_file_name = $_POST['wcuf_current_upload_session_id']."_".$file_name;
		$upload_field_name = str_replace($this->to_remove_from_file_name, "", $_POST['wcuf_upload_field_name']);
		$wcuf_is_last_chunk = $_POST['wcuf_is_last_chunk'] == 'true' ? true : false;

		$com = fopen($target_path.$tmp_file_name, "ab");
		$in = fopen($tmp_name, "rb");
			if ( $in )
				while ( $buff = fread( $in, $buffer ) )
				   fwrite($com, $buff);

			fclose($in);
		fclose($com);

		wp_die();
	}
```

File names were based on a combination of an optional `wcuf_current_upload_session_id` parameter and the `wcuf_file_name` parameter. While the function did attempt to prevent the upload of files with executable extensions, it did so by checking the filename supplied in the `wcuf_file_name` parameter against a list of dangerous extensions and then removing the extension from the filename rather than blocking the request.

```
	var $to_remove_from_file_name = array(".php", "../", ".jsp", ".vbs", ".exe", ".bat", ".php5", ".pht", ".phtml",
										  ".shtml", ".asa", ".cer", ".asax", ".swf", ".xap", ";", ".asp", ".aspx",
										  "*", "<", ">", "::");
```

For instance, uploading a file with a `wcuf_current_upload_session_id` parameter set to `session1` and the `wcuf_file_name` parameter set to `shell.php` would result in the actual file uploaded being named `session1_shell` as the `.php` extension would be removed. The function only ran the sanitization process a single time, so it could be bypassed by sending a filename containing a blocked extension hidden inside another blocked extension. For example, if an attacker uploaded a file with the `wcuf_current_upload_session_id` parameter set to `session1` and the `wcuf_file_name` set to `shell.p.phphp`, the middle `.php` would be removed, leaving the final file name as `session1_shell.php`.

Unfortunately, the `wcuf_current_upload_session_id` parameter was also not sufficiently sanitized and was vulnerable to directory traversal. For instance, if a request was sent with the `wcuf_current_upload_session_id` parameter set to `../../../../file` and the `wcuf_file_name` set to `info.p.phphp`, the resulting file would be named `file_info.php` and would end up in the webroot.

This also meant that a double extension attack was possible. For instance, setting the `wcuf_file_name` parameter to `test` and the `wcuf_current_upload_session_id` parameter to `info.php.` would result in a filename of `info.php._test` which would be executable in Apache environments that use an `AddHandler` directive for PHP files.

Regardless of the method used, an attacker able to upload an executable PHP file to a website using this method would be able to infect and completely take over that website, as well as any other sites on the same hosting account.

## Be Careful With Input Sanitization

As more WordPress developers focus on security, simple vulnerabilities are becoming less common. While most developers are aware of the importance of sanitizing input, it’s also important to use the right functions for the right input, otherwise sanitization can actually be used to bypass security functionality. It’s important to understand the kind of input a function is expecting and the dangers it can pose. For example, a function designed to sanitize input to be used in a database query might not offer sufficient protection against Cross-Site Scripting(XSS), while a function designed to remove scripting tags might not offer protection against SQL Injection(SQLi). As a general rule, it’s better to block malicious input entirely than to try to clean it up with the wrong function.

## Timeline

**December 29, 2020**

08:25 MST – Wordfence Threat Intelligence becomes aware of a potential 0-day in the WooCommerce Upload Files plugin.

09:09 MST – We find the vulnerable code and develop a proof of concept exploit.

09:48 MST – We write a firewall rule to block the exploit and begin testing.

10:36 MST – We initiate contact with the plugin developer.

11:10 MST – The plugin developer responds, and we provide full disclosure.

13:33 MST – The plugin developer releases a patched version.

18:09 MST – Our firewall rule passes final tests and is released to Wordfence Premium customers.

**January 28, 2021**

The firewall rule becomes available to free Wordfence users.

## Conclusion

In today’s article, we detailed a critical 0-day vulnerability in the WooCommerce Upload Files plugin that would have allowed attackers to infect and completely take over a website. This vulnerability has been patched in version 59.4, and we recommend that all users update to the latest version of the plugin as soon as possible, which is 60.1 at the time of this writing.

[Wordfence Premium](https://www.wordfence.com/wordfence-signup/?promo_id=blog20210304&promo_name=get-premium&promo_creative=txt&promo_position=conclusion) users have been protected against this vulnerability since December 29, 2020, while sites still running the free version of Wordfence received the same protection on January 28, 2021.

If you know a friend or colleague who is using this plugin on their site, we highly recommend forwarding this advisory to them to help keep their sites protected as this is a critical severity issue that can result in remote code execution and site takeover.

*Special thanks to plugin developer Domenico Lagudi for an extremely rapid response and to Threat Analyst Greg Bloom for his assistance getting a firewall rule deployed during holiday hours.*

*This article was written by Ramuel Gall, a former Wordfence Senior Security Researcher.*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Fcritical-vulnerability-patched-in-woocommerce-upload-files%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Fcritical-vulnerability-patched-in-woocommerce-upload-files%2F&text=Critical%20Vulnerability%20Patched%20in%20WooCommerce%20Upload%20Files&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Fcritical-vulnerability-patched-in-woocommerce-upload-files%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


