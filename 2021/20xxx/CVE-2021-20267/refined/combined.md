=== Content from security.openstack.org_e985d433_20250114_184950.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2021-001: Anti-spoofing bypass for Open vSwitch networks

# OSSA-2021-001: Anti-spoofing bypass for Open vSwitch networks[Â¶](#ossa-2021-001-anti-spoofing-bypass-for-open-vswitch-networks "Link to this heading")

Date:

July 12, 2021

CVE:

CVE-2021-20267

## Affects[Â¶](#affects "Link to this heading")

* Neutron: <16.3.3, >=17.0.0 <17.1.3, =18.0.0

## Description[Â¶](#description "Link to this heading")

David Sinquin with Gandi.net reported a vulnerability in Neutronâs default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch driver are affected.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.opendev.org/777873> (Queens)
* <https://review.opendev.org/791470> (Queens)
* <https://review.opendev.org/777786> (Rocky)
* <https://review.opendev.org/791469> (Rocky)
* <https://review.opendev.org/777872> (Stein)
* <https://review.opendev.org/791500> (Stein)
* <https://review.opendev.org/777785> (Train)
* <https://review.opendev.org/791468> (Train)
* <https://review.opendev.org/777784> (Ussuri)
* <https://review.opendev.org/791467> (Ussuri)
* <https://review.opendev.org/777783> (Victoria)
* <https://review.opendev.org/791465> (Victoria)
* <https://review.opendev.org/776599> (Wallaby)
* <https://review.opendev.org/791464> (Wallaby)
* <https://review.opendev.org/783743> (Xena)

## Credits[Â¶](#credits "Link to this heading")

* David Sinquin from Gandi.net (CVE-2021-20267)

## References[Â¶](#references "Link to this heading")

* <https://launchpad.net/bugs/1902917>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-20267>

## Notes[Â¶](#notes "Link to this heading")

* The stable/train, stable/stein, stable/rocky, and stable/queens
  branches are under extended maintenance and will receive no new point
  releases, but patches for them are provided as a courtesy.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2021-001: Anti-spoofing bypass for Open vSwitch networks
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from review.opendev.org_bcb9b6d8_20250115_113228.html ===




=== Content from access.redhat.com_f6f01b2d_20250115_113231.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_4319cb43_20250114_184950.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1934330)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1934330)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1934330)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1934330

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1934330**](show_bug.cgi?id=1934330)
(CVE-2021-20267)
- [CVE-2021-20267](https://access.redhat.com/security/cve/CVE-2021-20267) openstack-neutron: Anti-spoofing bypass using Open vSwitch

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-20267 openstack-neutron: Anti-spoofing bypass using Open vSwitch

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | MODIFIED | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-20267 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Nobody | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (3): | [1962090](show_bug.cgi?id=1962090 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)") [1962091](show_bug.cgi?id=1962091 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)") [1962092](show_bug.cgi?id=1962092 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)")  ([view as bug list](buglist.cgi?bug_id=1962090,1962091,1962092)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1934331](show_bug.cgi?id=1934331 "CLOSED CURRENTRELEASE - CVE-2021-20267 openstack-neutron: Anti-spoofing bypass using Open vSwitch [openstack-rdo]") [1934332](show_bug.cgi?id=1934332) [1934333](show_bug.cgi?id=1934333) [2003423](show_bug.cgi?id=2003423) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1895763](show_bug.cgi?id=1895763) | | TreeView+ | [depends on](buglist.cgi?bug_id=1934330&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1934330&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-03-03 01:46 UTC by Summer Long | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-07-07 08:29 UTC ([History](show_activity.cgi?id=1934330)) | | [CC List:](page.cgi?id=fields.html#cclist) | 13 users (show)  chrisw dbecker jjoyce jschluet lhh lpeer mburns rhos-maint sclewis scohen skaplons slinaber srevivo | | Fixed In Version: | neutron 15.3.3, neutron 16.3.1, neutron 17.1.1 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in openstack-neutron's default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch firewall driver are affected. Source: OpenStack project | | | Clone Of: |  | | | Environment: |  | | | Last Closed: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1934330#c0)  Summer Long    2021-03-03 01:46:52 UTC  ``` VMs can send ICMPv6 Neighbor Advertisement packets with no check on their content to mis-direct traffic to them (source address spoofing). Pre-condition: two running VMs in the same L2 flat network with IPv6 connectivity  Upstream bug: [https://bugs.launchpad.net/neutron/+bug/1902917](https://bugs.launchpad.net/neutron/%2Bbug/1902917) Upstream patch: [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599)  See also: [https://bugzilla.redhat.com/show_bug.cgi?id=1345892](show_bug.cgi?id=1345892 "CLOSED ERRATA - CVE-2015-8914 openstack-neutron: ICMPv6 source address spoofing vulnerability") (same issue but for OpenVSwitch driver instead of iptables)   ```  [Comment 2](show_bug.cgi?id=1934330#c2)  Summer Long    2021-03-03 01:48:21 UTC  ``` Created openstack-neutron tracking bugs for this issue:  Affects: openstack-rdo [[bug 1934331](show_bug.cgi?id=1934331 "CLOSED CURRENTRELEASE - CVE-2021-20267 openstack-neutron: Anti-spoofing bypass using Open vSwitch [openstack-rdo]")]   ```  [Comment 7](show_bug.cgi?id=1934330#c7)  Summer Long    2021-03-05 02:37:06 UTC  ``` Mitigation:  Mitigation for this issue is either not available or the currently available options do not meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability.   ```  [Comment 11](show_bug.cgi?id=1934330#c11)  Slawek Kaplonski    2021-05-19 10:06:01 UTC  ``` *** [Bug 1962090](show_bug.cgi?id=1962090 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)") has been marked as a duplicate of this bug. ***   ```  [Comment 12](show_bug.cgi?id=1934330#c12)  Slawek Kaplonski    2021-05-19 10:06:11 UTC  ``` *** [Bug 1962091](show_bug.cgi?id=1962091 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)") has been marked as a duplicate of this bug. ***   ```  [Comment 13](show_bug.cgi?id=1934330#c13)  Slawek Kaplonski    2021-05-19 10:06:13 UTC  ``` *** [Bug 1962092](show_bug.cgi?id=1962092 "CLOSED DUPLICATE - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)") has been marked as a duplicate of this bug. ***   ```  [Comment 17](show_bug.cgi?id=1934330#c17)  Slawek Kaplonski    2021-06-09 10:34:36 UTC  ``` Fix included also in openstack-neutron-12.1.1-44.el7ost for OSP-13.0 already   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1934330&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugs.launchpad.net_5ccd22ac_20250115_113228.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA-2021-001] Anti-spoofing bypass for Open vSwitch networks (CVE-2021-20267)

Bug #1902917 reported by
[David Sinquin](https://launchpad.net/~david-5-1)
on 2020-11-04

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | High | [Jeremy Stanley](https://launchpad.net/~fungi) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | High | [Slawek Kaplonski](https://launchpad.net/~slaweq) |  |

### Bug Description

Using Open vSwitch on an ussuri setup with neutron 16.0.0, VMs can send ICMPv6 Neighbor Advertisement packets with no check on their content to mis-direct traffic to them.

This looks a lot like [https://bugs.launchpad.net/neutron/+bug/1502933](https://bugs.launchpad.net/neutron/%2Bbug/1502933) except it affects Open vSwitch driver rather than iptables.

Pre-condition:

- two running VMs in the same L2 flat network with IPv6 connectivity

How to reproduce:

- manually add a custom IPv6 on one (e.g. `ip -6 address add fe80::42/64 dev eth0`)

- ping it from the other, expecting no answer (e.g. `ping -c1 -w1 "fe80::42%eth0"`)

- confirm it updated its neighbor table (e.g. `ip -6 neigh get fe80::42/64 dev eth0`)

Expected behavior:

- VMs should not be able to advertise IPv6 addresses that are not assigned to them e.g. through neighbor advertisement packets.

Affected versions:

The Openstack version I am using is Ussuri with neutron 16.0.0, with minor changes on commit df5b28c2e5. From a quick review of the diff with master, I think the issue is also present there. Network part is using Open vSwitch on flat network with Xen 4.13 as hypervisor.

Similarly, UDP packets using DHCP query ports (for DHCP v4 or v6) can be sent with arbitrary IP and MAC addresses.

And I think we are fine for other ICMP types (redirect, router renumbering for ICMPv6) as I did not managed to have such packets sent between VMs but I fail to understand how it gets filtered.

I am attaching a couple patches that I think fix the issues but include no tests and include changes that we may want to avoid (in case plugins out of neutron git repo use firewall.ICMPV6\_ALLOWED\_EGRESS\_TYPES).

See [original description](comments/0)

Tags:

[in-stable-queens](/neutron/%2Bbugs?field.tag=in-stable-queens)
[in-stable-rocky](/neutron/%2Bbugs?field.tag=in-stable-rocky)
[in-stable-stein](/neutron/%2Bbugs?field.tag=in-stable-stein)
[in-stable-train](/neutron/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/neutron/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/neutron/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/neutron/%2Bbugs?field.tag=in-stable-wallaby)

## CVE References

* [2015-8914](/bugs/cve/2015-8914 "The IPTables firewall in OpenStack Ne...")
* [2021-20267](/bugs/cve/2021-20267 "A flaw was found in openstack-neutron...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2020-11-04: |  |  | [#1](/neutron/%2Bbug/1902917/comments/1) |
| --- | --- | --- | --- |

* [anti-spoof.patch](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Battachment/5431130/%2Bfiles/anti-spoof.patch)
  [Edit](/neutron/%2Bbug/1902917/%2Battachment/5431130)
  (6.7 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-04: |  |  | [#2](/neutron/%2Bbug/1902917/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

| **description**: | updated |
| --- | --- |
| **description**: | updated |
| Changed in ossa: | |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-04: |  |  | [#3](/neutron/%2Bbug/1902917/comments/3) |
| --- | --- | --- | --- |

I think this is an already known issue, judging from abandoned attempts to correct it years ago:

<https://review.opendev.org/315828>

It got a mention in [bug 1502933](/bugs/1502933) which you referenced, as well as other bug reports linked from the commit message there. As such, I think we should be able to safely switch to discussing this report in public. Do Neutron security reviewers agree?

I think this is an already known issue, judging from abandoned attempts to correct it years ago:
https://review.opendev.org/315828
It got a mention in bug 1502933 which you referenced, as well as other bug reports linked from the commit message there. As such, I think we should be able to safely switch to discussing this report in public. Do Neutron security reviewers agree?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2020-11-05: |  |  | [#4](/neutron/%2Bbug/1902917/comments/4) |
| --- | --- | --- | --- |

@fungi: yes, I think this is similar bug to 1502933 and we can make it public IMO.

@David: is this happening for You for openvswitch fw driver or iptables\_hybrid? Or both?

@fungi: yes, I think this is similar bug to 1502933 and we can make it public IMO.
@David: is this happening for You for openvswitch fw driver or iptables\_hybrid? Or both?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2020-11-05: |  |  | [#5](/neutron/%2Bbug/1902917/comments/5) |
| --- | --- | --- | --- |

@slaweq: I face the issue using openvswitch fw driver but I did not test iptables\_hybrid so I don't know if the issue exists there.

If you all think it should be public, I am OK with that.

@slaweq: I face the issue using openvswitch fw driver but I did not test iptables\_hybrid so I don't know if the issue exists there.
If you all think it should be public, I am OK with that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-05: |  |  | [#6](/neutron/%2Bbug/1902917/comments/6) |
| --- | --- | --- | --- |

This report is now being tracked in public, so it can be discussed in public meetings and on mailing lists, and changes related to it can be pushed to normal code review (ideally referencing this bug number).

Pending further confirmation, this sounds likely to be a class A report per our taxonomy (and so would be covered in a security advisory similar to OSSA-2016-009/CVE-2015-8914): <https://security.openstack.org/vmt-process.html#incident-report-taxonomy>

This report is now being tracked in public, so it can be discussed in public meetings and on mailing lists, and changes related to it can be pushed to normal code review (ideally referencing this bug number).
Pending further confirmation, this sounds likely to be a class A report per our taxonomy (and so would be covered in a security advisory similar to OSSA-2016-009/CVE-2015-8914): https://security.openstack.org/vmt-process.html#incident-report-taxonomy

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Rodolfo Alonso (rodolfo-alonso-hernandez)](https://launchpad.net/~rodolfo-alonso-hernandez) wrote on 2020-11-10: |  |  | [#7](/neutron/%2Bbug/1902917/comments/7) |
| --- | --- | --- | --- |

Marking this patch as "high", same as [https://bugs.launchpad.net/neutron/+bug/1502933](https://bugs.launchpad.net/neutron/%2Bbug/1502933).

Marking this patch as "high", same as https://bugs.launchpad.net/neutron/+bug/1502933.

| Changed in neutron: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-16: |  |  | [#8](/neutron/%2Bbug/1902917/comments/8) |
| --- | --- | --- | --- |

I was able to reproduce that bug on master. For now I did it with ovs firewall driver.

I will need to confirm if that is also the case for iptables\_hybrid fw driver.

I was able to reproduce that bug on master. For now I did it with ovs firewall driver.
I will need to confirm if that is also the case for iptables\_hybrid fw driver.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Slawek Kaplonski (slaweq) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-16: |  |  | [#9](/neutron/%2Bbug/1902917/comments/9) |
| --- | --- | --- | --- |

I just checked and I can't reproduce the same issue with iptables\_hybrid fw driver.

So it seems that only openvswitch firewall driver is impacted by that (at least on master).

I just checked and I can't reproduce the same issue with iptables\_hybrid fw driver.
So it seems that only openvswitch firewall driver is impacted by that (at least on master).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-19: |  |  | [#10](/neutron/%2Bbug/1902917/comments/10) |
| --- | --- | --- | --- |

Patch proposed [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599)

Patch proposed https://review.opendev.org/c/openstack/neutron/+/776599

| Changed in neutron: | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-19: |  |  | [#11](/neutron/%2Bbug/1902917/comments/11) |
| --- | --- | --- | --- |

I also tested OVN backend and it seems that it isn't affected. So fix is needed only for ovs firewall driver.

I also tested OVN backend and it seems that it isn't affected. So fix is needed only for ovs firewall driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-27: |  |  | [#12](/neutron/%2Bbug/1902917/comments/12) |
| --- | --- | --- | --- |

Patch [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599) merged and it should solves that problem.

Patch https://review.opendev.org/c/openstack/neutron/+/776599 merged and it should solves that problem.

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Summer Long (slong-g)](https://launchpad.net/~slong-g) wrote on 2021-03-03: |  |  | [#13](/neutron/%2Bbug/1902917/comments/13) |
| --- | --- | --- | --- |

Fantastic, Slawek, thanks! Jeremy, have you already asked Mitre for a CVE? Otherwise, RH can issue one.

Fantastic, Slawek, thanks! Jeremy, have you already asked Mitre for a CVE? Otherwise, RH can issue one.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-03: |  |  | [#14](/neutron/%2Bbug/1902917/comments/14) |
| --- | --- | --- | --- |

Summer: I was hoping to first see some core reviews on the proposed backports before assuming it's going to be fixed there, and as confirmation that we know for sure the extent of the problem prior to the current state of the master branch. The backport targeting stable/victoria looks like it may also fail the neutron-grenade-dvr-multinode upgrade job, it was rechecked a few minutes ago to hopefully rule that out.

Once there's at least one +2 on some of the backports I'll be more confident in drafting an accurate impact description with which to request a CVE assignment. Since this is already public, we're not under any tight embargo timeline with it, and probably not much point in having a CVE to track it until we have a fix we know we can recommend. That said, if you want to act as a CNA and issue a placeholder CVE now, just make sure to let us know the number and I'll refrain from requesting one from MITRE later.

Summer: I was hoping to first see some core reviews on the proposed backports before assuming it's going to be fixed there, and as confirmation that we know for sure the extent of the problem prior to the current state of the master branch. The backport targeting stable/victoria looks like it may also fail the neutron-grenade-dvr-multinode upgrade job, it was rechecked a few minutes ago to hopefully rule that out.
Once there's at least one +2 on some of the backports I'll be more confident in drafting an accurate impact description with which to request a CVE assignment. Since this is already public, we're not under any tight embargo timeline with it, and probably not much point in having a CVE to track it until we have a fix we know we can recommend. That said, if you want to act as a CNA and issue a placeholder CVE now, just make sure to let us know the number and I'll refrain from requesting one from MITRE later.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Summer Long (slong-g)](https://launchpad.net/~slong-g) wrote on 2021-03-05: |  |  | [#15](/neutron/%2Bbug/1902917/comments/15) |
| --- | --- | --- | --- |

Thanks Jeremy, CVE-2021-20267 has been assigned to this issue.

Thanks Jeremy, CVE-2021-20267 has been assigned to this issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-05: |  |  | [#16](/neutron/%2Bbug/1902917/comments/16) |
| --- | --- | --- | --- |

The stable/victoria backport has merged and the other backports all have positive votes from from core reviewers. Here's an initial draft for an impact description we'll be able to use in an advisory; please review and call out anything which needs correcting (and David, let me know if you have an employer or other affiliated organization you wish mentioned alongside your name)...

Title: Anti-spoofing bypass for Open vSwitch networks

Reporter: David Sinquin

Products: Neutron

Affects: <15.3.3, >=16.0.0 <16.3.1, >=17.0.0 <17.1.1

Description: David Sinquin reported a vulnerability in Neutron's default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch driver are affected.

The stable/victoria backport has merged and the other backports all have positive votes from from core reviewers. Here's an initial draft for an impact description we'll be able to use in an advisory; please review and call out anything which needs correcting (and David, let me know if you have an employer or other affiliated organization you wish mentioned alongside your name)...
Title: Anti-spoofing bypass for Open vSwitch networks
Reporter: David Sinquin
Products: Neutron
Affects: <15.3.3, >=16.0.0 <16.3.1, >=17.0.0 <17.1.1
Description: David Sinquin reported a vulnerability in Neutron's default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch driver are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Jeremy Stanley (fungi) |
| **summary**: | - Anti-spoofing bypass using Open vSwitch+ Anti-spoofing bypass using Open vSwitch (CVE-2021-20267) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-05:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/17) |  |  | [#17](/neutron/%2Bbug/1902917/comments/17) |
| --- | --- | --- | --- |

I want to first thank everyone involved.

Regarding credits, please mention “Gandi.net” as my employee (for which I am reporting this and auditing spoofing possibilities in the first place).

Regarding Slawek Kaplonski's patch [1] that was merged in master, I am sorry I did not took time to review this further before, but I \*\*think\*\* there is still a potential security concern (DoS / redirection) for Neighbor Advertisements. I have not tested this using neutron so I cannot guaranty this be possible in a real deployment.

The scenario I think of would require 2 VMs : one “attacker”, one “victim” whose neighbor cache is to be poisoned (for a spoofed IP). The following is an attempt at providing a way to check for the vulnerability:

First, on attacker, add the IP to spoof. It must be unattributed to avoid races with legit owner and simplify testing.

Second, on the attacker, install scapy and start it (use `scapy` to have useful imports) and adapt then run the below lines, leaving the prompt opened for fourth step:

spoofed\_ipv6 = '' # FIXME non-ll (NOT fe80::), L2-reachable

    victim\_ipv6 = '' # FIXME must be L2-reachable

    announced\_mac = '' # FIXME attacker MAC

ipv6 = IPv6(dst=victim\_ipv6)

    icmpv6na = ICMPv6ND\_NA(tgt=spoofed\_ipv6)

    icmpv6\_target\_ll\_addr = ICMPv6NDOptDstLLAddr(lladdr=announced\_mac)

    spoofed\_packet = Ether() / ip6 / icmp6na / icmpv6\_target\_ll\_addr

    spoofed\_packet.show() # not mandatory :-)

Third, on the victim, run a tcpdump (e.g. `tcpdump -nvve 'icmp6 && ip6[40] == 134'`) and while it runs, run a ping6 to the unattributed IPv6 to spoof (clear cache before if needed) and immediately continue to the next step.

Fourth, using the scapy prompt on the attacker, run (a few times by security, one should be enough but packet loss might occur):

    sendp(spoofed\_packet)

Finally, check the victim tcpdump (it should be empty) and cache with e.g. `ip -6 n` (idem).

(I realize after having finished proofreading this that the same could likely be achieved through some kind of targeted IPv6 NAT for outgoing ICMPv6 packets on the attacker to avoid scapy completely.)

In the patch I had attached to this bug, I was using nd\_target to rule this possible issue out but it can only be applied to Neighbor Advertisement packets (since other types do not have such value), hence the other changes I had done around NA management.

[1] [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599)

I want to first thank everyone involved.
Regarding credits, please mention “Gandi.net” as my employee (for which I am reporting this and auditing spoofing possibilities in the first place).
Regarding Slawek Kaplonski's patch [1] that was merged in master, I am sorry I did not took time to review this further before, but I \*\*think\*\* there is still a potential security concern (DoS / redirection) for Neighbor Advertisements. I have not tested this using neutron so I cannot guaranty this be possible in a real deployment.
The scenario I think of would require 2 VMs : one “attacker”, one “victim” whose neighbor cache is to be poisoned (for a spoofed IP). The following is an attempt at providing a way to check for the vulnerability:
First, on attacker, add the IP to spoof. It must be unattributed to avoid races with legit owner and simplify testing.
Second, on the attacker, install scapy and start it (use `scapy` to have useful imports) and adapt then run the below lines, leaving the prompt opened for fourth step:
spoofed\_ipv6 = '' # FIXME non-ll (NOT fe80::), L2-reachable
victim\_ipv6 = '' # FIXME must be L2-reachable
announced\_mac = '' # FIXME attacker MAC
ipv6 = IPv6(dst=victim\_ipv6)
icmpv6na = ICMPv6ND\_NA(tgt=spoofed\_ipv6)
icmpv6\_target\_ll\_addr = ICMPv6NDOptDstLLAddr(lladdr=announced\_mac)
spoofed\_packet = Ether() / ip6 / icmp6na / icmpv6\_target\_ll\_addr
spoofed\_packet.show() # not mandatory :-)
Third, on the victim, run a tcpdump (e.g. `tcpdump -nvve 'icmp6 && ip6[40] == 134'`) and while it runs, run a ping6 to the unattributed IPv6 to spoof (clear cache before if needed) and immediately continue to the next step.
Fourth, using the scapy prompt on the attacker, run (a few times by security, one should be enough but packet loss might occur):
sendp(spoofed\_packet)
Finally, check the victim tcpdump (it should be empty) and cache with e.g. `ip -6 n` (idem).
(I realize after having finished proofreading this that the same could likely be achieved through some kind of targeted IPv6 NAT for outgoing ICMPv6 packets on the attacker to avoid scapy completely.)
In the patch I had attached to this bug, I was using nd\_target to rule this possible issue out but it can only be applied to Neighbor Advertisement packets (since other types do not have such value), hence the other changes I had done around NA management.
[1] https://review.opendev.org/c/openstack/neutron/+/776599

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gage Hugo (gagehugo)](https://launchpad.net/~gagehugo) wrote on 2021-03-05: |  |  | [#18](/neutron/%2Bbug/1902917/comments/18) |
| --- | --- | --- | --- |

I am good with Jeremy's impact description in comment #16.

I am good with Jeremy's impact description in comment #16.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-05: |  |  | [#19](/neutron/%2Bbug/1902917/comments/19) |
| --- | --- | --- | --- |

Jeremy's impact description in comment #16 also looks good to me FWIW :-)

Jeremy's impact description in comment #16 also looks good to me FWIW :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-08: |  |  | [#20](/neutron/%2Bbug/1902917/comments/20) |
| --- | --- | --- | --- |

Given David's suggestion (in comment #17) that the merged fix may be incomplete, I'd rather hold off finalizing any advisory until someone can either confirm or refute it.

Given David's suggestion (in comment #17) that the merged fix may be incomplete, I'd rather hold off finalizing any advisory until someone can either confirm or refute it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-12: |  |  | [#21](/neutron/%2Bbug/1902917/comments/21) |
| --- | --- | --- | --- |

Hi David,

Here is what I did exactly to try what You described in the c17: <http://paste.openstack.org/show/803502/>

For me it seems that I wasn't able to reproduce what You described but maybe I did something wrong there. If so, please provide me reproducer so I can check that.

Hi David,
Here is what I did exactly to try what You described in the c17: http://paste.openstack.org/show/803502/
For me it seems that I wasn't able to reproduce what You described but maybe I did something wrong there. If so, please provide me reproducer so I can check that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-12: |  |  | [#22](/neutron/%2Bbug/1902917/comments/22) |
| --- | --- | --- | --- |

Hi Slaweq,

from what I understand, one of the issue you had is the fact your VM had no route to 3000::/64 and therefore no ICMPv6 packets were sent at all.

I also realize the tcpdump command I provided was wrong, and can be replaced with e.g.:

    tcpdump -nve 'icmp6 && (ip6[40] == 135 || ip6[40] == 136)'

(135 is Neighbor Solicitation, 136 is Neighbor Advertisement, 134 was unrelated Router Advertisement…)

I have replied to your paste with what I get (with a reworked procedure I tested in a OpenStack environment), you can find it at: <http://paste.openstack.org/show/803529/>

The main changes I did are:

 - switching to using fe80::/64 IPs (due to my local setup, I preferred using them)

 - sending spoofed packets in a loop

 - changing NA options to match legitimate answer my VM was sending (likely useless, but it works as-is :-D)

 - some clean-up of unnecessary steps.

Hi Slaweq,
from what I understand, one of the issue you had is the fact your VM had no route to 3000::/64 and therefore no ICMPv6 packets were sent at all.
I also realize the tcpdump command I provided was wrong, and can be replaced with e.g.:
tcpdump -nve 'icmp6 && (ip6[40] == 135 || ip6[40] == 136)'
(135 is Neighbor Solicitation, 136 is Neighbor Advertisement, 134 was unrelated Router Advertisement…)
I have replied to your paste with what I get (with a reworked procedure I tested in a OpenStack environment), you can find it at: http://paste.openstack.org/show/803529/
The main changes I did are:
- switching to using fe80::/64 IPs (due to my local setup, I preferred using them)
- sending spoofed packets in a loop
- changing NA options to match legitimate answer my VM was sending (likely useless, but it works as-is :-D)
- some clean-up of unnecessary steps.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-12: |  |  | [#23](/neutron/%2Bbug/1902917/comments/23) |
| --- | --- | --- | --- |

FTR, I did my tests using ussuri neutron version with 4b5bcff64c4725b37f094dfd2613ec58f723d304 cherry-picked on top of 4edf21a37561971991ee450b07fcfbca95922bc2 (plus internal patches that do not change openvswitch driver code).

FTR, I did my tests using ussuri neutron version with 4b5bcff64c4725b37f094dfd2613ec58f723d304 cherry-picked on top of 4edf21a37561971991ee450b07fcfbca95922bc2 (plus internal patches that do not change openvswitch driver code).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 15.3.3**](/neutron/%2Bbug/1902917/comments/24) |  |  | [#24](/neutron/%2Bbug/1902917/comments/24) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 15.3.3 release.

This issue was fixed in the openstack/neutron 15.3.3 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 16.3.1**](/neutron/%2Bbug/1902917/comments/25) |  |  | [#25](/neutron/%2Bbug/1902917/comments/25) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 16.3.1 release.

This issue was fixed in the openstack/neutron 16.3.1 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 17.1.1**](/neutron/%2Bbug/1902917/comments/26) |  |  | [#26](/neutron/%2Bbug/1902917/comments/26) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 17.1.1 release.

This issue was fixed in the openstack/neutron 17.1.1 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-18:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/27) |  |  | [#27](/neutron/%2Bbug/1902917/comments/27) |
| --- | --- | --- | --- |

I've asked in #openstack-neutron whether we can switch this back to In Progress state or similar, since it sounds like the fixes were incomplete.

I've asked in #openstack-neutron whether we can switch this back to In Progress state or similar, since it sounds like the fixes were incomplete.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-19: |  |  | [#28](/neutron/%2Bbug/1902917/comments/28) |
| --- | --- | --- | --- |

Thx David. I was able to reproduce that issue with Your script.

Thx David. I was able to reproduce that issue with Your script.

| Changed in neutron: | |
| --- | --- |
| **status**: | Fix Released → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-19: |  |  | [#29](/neutron/%2Bbug/1902917/comments/29) |
| --- | --- | --- | --- |

Thx for confirming that :-)

Thx for confirming that :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-19: |  |  | [#30](/neutron/%2Bbug/1902917/comments/30) |
| --- | --- | --- | --- |

After some more research I'm not sure if we have any way to fix that issue really as it seems for me that OVS don't allows us to match on tgt field of the ICMPv6 packets and that's where this spoofed IP address is send really in Your example.

If You have any idea on how to fix that, feel free to propose patch for it.

After some more research I'm not sure if we have any way to fix that issue really as it seems for me that OVS don't allows us to match on tgt field of the ICMPv6 packets and that's where this spoofed IP address is send really in Your example.
If You have any idea on how to fix that, feel free to propose patch for it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-22: |  |  | [#31](/neutron/%2Bbug/1902917/comments/31) |
| --- | --- | --- | --- |

I think the patch I had attached to this bug report had a working fix for that using nd\_target param in \_add\_flow method.

The code is mostly:

self.\_add\_flow(

    table=ovs\_consts.BASE\_EGRESS\_TABLE,

    priority=95,

    in\_port=port.ofport,

    reg\_port=port.ofport,

    dl\_type=lib\_const.ETHERTYPE\_IPV6,

    nw\_proto=lib\_const.PROTO\_NUM\_IPV6\_ICMP,

    icmp\_type=n\_const.ICMPV6\_TYPE\_NA,

    nd\_target=allowed\_ip\_addr,

    actions='resubmit(,%d)' % (

        ovs\_consts.ACCEPTED\_EGRESS\_TRAFFIC\_NORMAL\_TABLE)

)

and results in the following Open vSwitch rule:

table=71, hard\_age=65534, priority=95,icmp6,reg5=0x4,in\_port=4,icmp\_type=136,nd\_target=fe80::f816:3eff:fed3:1eb4,actions=resubmit(,94)

The above is as-is allowing the VM to use an IPv6 it does not own to announce its own IPs but can likely be restricted further and does not prevent it from announcing a MAC address it does not own but this requires privileges inside the VM and these privileges are anyway enough to make many other DoS for the VM itself.

I think the patch I had attached to this bug report had a working fix for that using nd\_target param in \_add\_flow method.
The code is mostly:
self.\_add\_flow(
table=ovs\_consts.BASE\_EGRESS\_TABLE,
priority=95,
in\_port=port.ofport,
reg\_port=port.ofport,
dl\_type=lib\_const.ETHERTYPE\_IPV6,
nw\_proto=lib\_const.PROTO\_NUM\_IPV6\_ICMP,
icmp\_type=n\_const.ICMPV6\_TYPE\_NA,
nd\_target=allowed\_ip\_addr,
actions='resubmit(,%d)' % (
ovs\_consts.ACCEPTED\_EGRESS\_TRAFFIC\_NORMAL\_TABLE)
)
and results in the following Open vSwitch rule:
table=71, hard\_age=65534, priority=95,icmp6,reg5=0x4,in\_port=4,icmp\_type=136,nd\_target=fe80::f816:3eff:fed3:1eb4,actions=resubmit(,94)
The above is as-is allowing the VM to use an IPv6 it does not own to announce its own IPs but can likely be restricted further and does not prevent it from announcing a MAC address it does not own but this requires privileges inside the VM and these privileges are anyway enough to make many other DoS for the VM itself.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-26:  [**Fix included in openstack/neutron 18.0.0.0rc1**](/neutron/%2Bbug/1902917/comments/32) |  |  | [#32](/neutron/%2Bbug/1902917/comments/32) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 18.0.0.0rc1 release candidate.

This issue was fixed in the openstack/neutron 18.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-29:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/33) |  |  | [#33](/neutron/%2Bbug/1902917/comments/33) |
| --- | --- | --- | --- |

Hi David,

I just proposed Your patch in gerrit [https://review.opendev.org/c/openstack/neutron/+/783743](https://review.opendev.org/c/openstack/neutron/%2B/783743) - please take a look and check if I didn't made any mistake there.

I also added some UT for it.

And I tested Your patch locally - it worked for me and I wasn't able to spoof address anymore with that patch using Your script described in comment #22

Hi David,
I just proposed Your patch in gerrit https://review.opendev.org/c/openstack/neutron/+/783743 - please take a look and check if I didn't made any mistake there.
I also added some UT for it.
And I tested Your patch locally - it worked for me and I wasn't able to spoof address anymore with that patch using Your script described in comment #22

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-30: |  |  | [#34](/neutron/%2Bbug/1902917/comments/34) |
| --- | --- | --- | --- |

Thanks Slaweq, your commit looks good to me and as you tested your version (and I had tested the patch you adapted), I think we are fine.

Thanks Slaweq, your commit looks good to me and as you tested your version (and I had tested the patch you adapted), I think we are fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix merged to neutron (master)**](/neutron/%2Bbug/1902917/comments/35) |  |  | [#35](/neutron/%2Bbug/1902917/comments/35) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/783743](https://review.opendev.org/c/openstack/neutron/%2B/783743)

Committed: <https://opendev.org/openstack/neutron/commit/ca7822e2108c151bda992ef8a6d454ec2c6d890e>

Submitter: "Zuul (22348)"

Branch: master

commit ca7822e2108c151bda992ef8a6d454ec2c6d890e

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

Reviewed: https://review.opendev.org/c/openstack/neutron/+/783743
Committed: https://opendev.org/openstack/neutron/commit/ca7822e2108c151bda992ef8a6d454ec2c6d890e
Submitter: "Zuul (22348)"
Branch: master
commit ca7822e2108c151bda992ef8a6d454ec2c6d890e
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/wallaby)**](/neutron/%2Bbug/1902917/comments/36) |  |  | [#36](/neutron/%2Bbug/1902917/comments/36) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/neutron/+/791464](https://review.opendev.org/c/openstack/neutron/%2B/791464)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/neutron/+/791464

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/victoria)**](/neutron/%2Bbug/1902917/comments/37) |  |  | [#37](/neutron/%2Bbug/1902917/comments/37) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/neutron/+/791465](https://review.opendev.org/c/openstack/neutron/%2B/791465)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/neutron/+/791465

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/ussuri)**](/neutron/%2Bbug/1902917/comments/38) |  |  | [#38](/neutron/%2Bbug/1902917/comments/38) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/neutron/+/791467](https://review.opendev.org/c/openstack/neutron/%2B/791467)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/neutron/+/791467

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/train)**](/neutron/%2Bbug/1902917/comments/39) |  |  | [#39](/neutron/%2Bbug/1902917/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/neutron/+/791468](https://review.opendev.org/c/openstack/neutron/%2B/791468)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/neutron/+/791468

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/stein)**](/neutron/%2Bbug/1902917/comments/40) |  |  | [#40](/neutron/%2Bbug/1902917/comments/40) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/neutron/+/791500](https://review.opendev.org/c/openstack/neutron/%2B/791500)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/neutron/+/791500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/rocky)**](/neutron/%2Bbug/1902917/comments/41) |  |  | [#41](/neutron/%2Bbug/1902917/comments/41) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/neutron/+/791469](https://review.opendev.org/c/openstack/neutron/%2B/791469)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/neutron/+/791469

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/queens)**](/neutron/%2Bbug/1902917/comments/42) |  |  | [#42](/neutron/%2Bbug/1902917/comments/42) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/queens

Review: [https://review.opendev.org/c/openstack/neutron/+/791470](https://review.opendev.org/c/openstack/neutron/%2B/791470)

Fix proposed to branch: stable/queens
Review: https://review.opendev.org/c/openstack/neutron/+/791470

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-31:  [**Fix merged to neutron (stable/train)**](/neutron/%2Bbug/1902917/comments/43) |  |  | [#43](/neutron/%2Bbug/1902917/comments/43) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791468](https://review.opendev.org/c/openstack/neutron/%2B/791468)

Committed: <https://opendev.org/openstack/neutron/commit/2231a9d40f989a1e8a20f9862ff03916091b3215>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 2231a9d40f989a1e8a20f9862ff03916091b3215

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791468
Committed: https://opendev.org/openstack/neutron/commit/2231a9d40f989a1e8a20f9862ff03916091b3215
Submitter: "Zuul (22348)"
Branch: stable/train
commit 2231a9d40f989a1e8a20f9862ff03916091b3215
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-01:  [**Fix merged to neutron (stable/ussuri)**](/neutron/%2Bbug/1902917/comments/44) |  |  | [#44](/neutron/%2Bbug/1902917/comments/44) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791467](https://review.opendev.org/c/openstack/neutron/%2B/791467)

Committed: <https://opendev.org/openstack/neutron/commit/ac474307d3a800c30ecbabf0f47de931ad310339>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit ac474307d3a800c30ecbabf0f47de931ad310339

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791467
Committed: https://opendev.org/openstack/neutron/commit/ac474307d3a800c30ecbabf0f47de931ad310339
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit ac474307d3a800c30ecbabf0f47de931ad310339
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/rocky)**](/neutron/%2Bbug/1902917/comments/45) |  |  | [#45](/neutron/%2Bbug/1902917/comments/45) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791469](https://review.opendev.org/c/openstack/neutron/%2B/791469)

Committed: <https://opendev.org/openstack/neutron/commit/9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11>

Submitter: "Zuul (22348)"

Branch: stable/rocky

commit 9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791469
Committed: https://opendev.org/openstack/neutron/commit/9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11
Submitter: "Zuul (22348)"
Branch: stable/rocky
commit 9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-rocky |
| --- | --- |
| **tags**: | added: in-stable-queens |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/queens)**](/neutron/%2Bbug/1902917/comments/46) |  |  | [#46](/neutron/%2Bbug/1902917/comments/46) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791470](https://review.opendev.org/c/openstack/neutron/%2B/791470)

Committed: <https://opendev.org/openstack/neutron/commit/ccea0021bc49eefde9af6568942159b52588daae>

Submitter: "Zuul (22348)"

Branch: stable/queens

commit ccea0021bc49eefde9af6568942159b52588daae

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791470
Committed: https://opendev.org/openstack/neutron/commit/ccea0021bc49eefde9af6568942159b52588daae
Submitter: "Zuul (22348)"
Branch: stable/queens
commit ccea0021bc49eefde9af6568942159b52588daae
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/stein)**](/neutron/%2Bbug/1902917/comments/47) |  |  | [#47](/neutron/%2Bbug/1902917/comments/47) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791500](https://review.opendev.org/c/openstack/neutron/%2B/791500)

Committed: <https://opendev.org/openstack/neutron/commit/e1fe735e843b5d1bee4fa18e6011121027422203>

Submitter: "Zuul (22348)"

Branch: stable/stein

commit e1fe735e843b5d1bee4fa18e6011121027422203

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791500
Committed: https://opendev.org/openstack/neutron/commit/e1fe735e843b5d1bee4fa18e6011121027422203
Submitter: "Zuul (22348)"
Branch: stable/stein
commit e1fe735e843b5d1bee4fa18e6011121027422203
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-stein |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/victoria)**](/neutron/%2Bbug/1902917/comments/48) |  |  | [#48](/neutron/%2Bbug/1902917/comments/48) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791465](https://review.opendev.org/c/openstack/neutron/%2B/791465)

Committed: <https://opendev.org/openstack/neutron/commit/eb2851561a89338c5843521128cbef3c1c7de10c>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit eb2851561a89338c5843521128cbef3c1c7de10c

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791465
Committed: https://opendev.org/openstack/neutron/commit/eb2851561a89338c5843521128cbef3c1c7de10c
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit eb2851561a89338c5843521128cbef3c1c7de10c
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-06:  [**Fix merged to neutron (stable/wallaby)**](/neutron/%2Bbug/1902917/comments/49) |  |  | [#49](/neutron/%2Bbug/1902917/comments/49) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791464](https://review.opendev.org/c/openstack/neutron/%2B/791464)

Committed: <https://opendev.org/openstack/neutron/commit/cb746e2ca454885ba5cf653493b9bb0e91480759>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit cb746e2ca454885ba5cf653493b9bb0e91480759

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791464
Committed: https://opendev.org/openstack/neutron/commit/cb746e2ca454885ba5cf653493b9bb0e91480759
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit cb746e2ca454885ba5cf653493b9bb0e91480759
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-wallaby |
| --- | --- |

[Bernard Cafarelli (bcafarel)](https://launchpad.net/~bcafarel)
on 2021-06-11

| **tags**: | added: neutron-proactive-backport-potential |
| --- | --- |

[Bernard Cafarelli (bcafarel)](https://launchpad.net/~bcafarel)
on 2021-06-11

| **tags**: | removed: neutron-proactive-backport-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-08:  [**Fix proposed to ossa (master)**](/neutron/%2Bbug/1902917/comments/50) |  |  | [#50](/neutron/%2Bbug/1902917/comments/50) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/800107](https://review.opendev.org/c/openstack/ossa/%2B/800107)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/800107

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-09:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/51) |  |  | [#51](/neutron/%2Bbug/1902917/comments/51) |
| --- | --- | --- | --- |

I'd like to go ahead and publish the advisory for this early next week, if anyone has time to review the proposed content here: <https://review.opendev.org/800107>

I'd like to go ahead and publish the advisory for this early next week, if anyone has time to review the proposed content here: https://review.opendev.org/800107

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 16.4.0**](/neutron/%2Bbug/1902917/comments/52) |  |  | [#52](/neutron/%2Bbug/1902917/comments/52) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 16.4.0 release.

This issue was fixed in the openstack/neutron 16.4.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 17.2.0**](/neutron/%2Bbug/1902917/comments/53) |  |  | [#53](/neutron/%2Bbug/1902917/comments/53) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 17.2.0 release.

This issue was fixed in the openstack/neutron 17.2.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 18.1.0**](/neutron/%2Bbug/1902917/comments/54) |  |  | [#54](/neutron/%2Bbug/1902917/comments/54) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 18.1.0 release.

This issue was fixed in the openstack/neutron 18.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-07-12:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/55) |  |  | [#55](/neutron/%2Bbug/1902917/comments/55) |
| --- | --- | --- | --- |

Thank you fungi, the OSSA looks correct and relevant to me.

And also thanks to everyone involved for the rest of the work :-)

Thank you fungi, the OSSA looks correct and relevant to me.
And also thanks to everyone involved for the rest of the work :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix merged to ossa (master)**](/neutron/%2Bbug/1902917/comments/56) |  |  | [#56](/neutron/%2Bbug/1902917/comments/56) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/800107](https://review.opendev.org/c/openstack/ossa/%2B/800107)

Committed: <https://opendev.org/openstack/ossa/commit/239ec3826a74c4f3ffb1239cc574f95c6097c631>

Submitter: "Zuul (22348)"

Branch: master

commit 239ec3826a74c4f3ffb1239cc574f95c6097c631

Author: Jeremy Stanley <email address hidden>

Date: Thu Jul 8 20:49:35 2021 +0000

Add OSSA-2021-001 (CVE-2021-20267)

Change-Id: I6bcc8392831efbdc7759b0ed5340023bb0440c85

    Closes-Bug: #1902917

Reviewed: https://review.opendev.org/c/openstack/ossa/+/800107
Committed: https://opendev.org/openstack/ossa/commit/239ec3826a74c4f3ffb1239cc574f95c6097c631
Submitter: "Zuul (22348)"
Branch: master
commit 239ec3826a74c4f3ffb1239cc574f95c6097c631
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jul 8 20:49:35 2021 +0000
Add OSSA-2021-001 (CVE-2021-20267)
Change-Id: I6bcc8392831efbdc7759b0ed5340023bb0440c85
Closes-Bug: #1902917

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-12:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/57) |  |  | [#57](/neutron/%2Bbug/1902917/comments/57) |
| --- | --- | --- | --- |

The advisory is published at <https://security.openstack.org/> now and copies have been sent to the usual mailing lists (oss-security, openstack-announce, openstack-discuss).

The advisory is published at https://security.openstack.org/ now and copies have been sent to the usual mailing lists (oss-security, openstack-announce, openstack-discuss).

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-08-02

| **summary**: | - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)+ [OSSA-2021-001] Anti-spoofing bypass for Open vSwitch networks+ (CVE-2021-20267) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-15:  [**Fix included in openstack/neutron 19.0.0.0rc1**](/neutron/%2Bbug/1902917/comments/58) |  |  | [#58](/neutron/%2Bbug/1902917/comments/58) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 19.0.0.0rc1 release candidate.

This issue was fixed in the openstack/neutron 19.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron queens-eol**](/neutron/%2Bbug/1902917/comments/59) |  |  | [#59](/neutron/%2Bbug/1902917/comments/59) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron queens-eol release.

This issue was fixed in the openstack/neutron queens-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron rocky-eol**](/neutron/%2Bbug/1902917/comments/61) |  |  | [#61](/neutron/%2Bbug/1902917/comments/61) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron rocky-eol release.

This issue was fixed in the openstack/neutron rocky-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron stein-eol**](/neutron/%2Bbug/1902917/comments/63) |  |  | [#63](/neutron/%2Bbug/1902917/comments/63) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron stein-eol release.

This issue was fixed in the openstack/neutron stein-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-10-10:  [**Fix included in openstack/neutron train-eol**](/neutron/%2Bbug/1902917/comments/65) |  |  | [#65](/neutron/%2Bbug/1902917/comments/65) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron train-eol release.

This issue was fixed in the openstack/neutron train-eol release.

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1902917/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [anti-spoof.patch](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Battachment/5431130/%2Bfiles/anti-spoof.patch)
  [Edit](/neutron/%2Bbug/1902917/%2Battachment/5431130 "Change patch details")

* [Add patch](/neutron/%2Bbug/1902917/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_84d06998_20250115_113224.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1345892)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1345892)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1345892)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1345892

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1345892**](show_bug.cgi?id=1345892)
(CVE-2015-8914)
- [CVE-2015-8914](https://access.redhat.com/security/cve/CVE-2015-8914) openstack-neutron: ICMPv6 source address spoofing vulnerability

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2015-8914 openstack-neutron: ICMPv6 source address spoofing vulnerability

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2015-8914 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1349669](show_bug.cgi?id=1349669 "CLOSED EOL - CVE-2015-8914 CVE-2016-5362 CVE-2016-5363 openstack-neutron: various flaws [fedora-all]") [1349670](show_bug.cgi?id=1349670 "CLOSED ERRATA - CVE-2015-8914 CVE-2016-5362 CVE-2016-5363 openstack-neutron: various flaws [openstack-rdo]") [1350654](show_bug.cgi?id=1350654) [1350655](show_bug.cgi?id=1350655) [1350656](show_bug.cgi?id=1350656) [1350657](show_bug.cgi?id=1350657) [1350658](show_bug.cgi?id=1350658) [1350659](show_bug.cgi?id=1350659) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1345893](show_bug.cgi?id=1345893) | | TreeView+ | [depends on](buglist.cgi?bug_id=1345892&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1345892&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2016-06-13 11:44 UTC by Andrej Nemec | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2019-09-29 13:51 UTC ([History](show_activity.cgi?id=1345892)) | | [CC List:](page.cgi?id=fields.html#cclist) | 23 users (show)  aathomas abaron amuller aortega apevec apevec ayoung chrisw ihrachys jlibosva jschluet lhh lpeer majopela markmc nyechiel rbryant rk sclewis srevivo tdecacqu tsuter twilson | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | Neutron functionality includes internal firewall management between networks. Due to the relaxed nature of particular rules, it is possible for machines on the same layer 2 networks to forge non-IP traffic, such as ARP and DHCP requests. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2016-07-21 01:19:22 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2016:1473](https://access.redhat.com/errata/RHSA-2016%3A1473) | 0 | normal | SHIPPED\_LIVE | Low: openstack-neutron security and bug fix update | 2016-07-21 03:53:43 UTC | | Red Hat Product Errata | [RHSA-2016:1474](https://access.redhat.com/errata/RHSA-2016%3A1474) | 0 | normal | SHIPPED\_LIVE | Low: openstack-neutron security, bug fix, and enhancement update | 2016-07-21 03:53:34 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1345892#c0)  Andrej Nemec    2016-06-13 11:44:31 UTC  ```  A vulnerability in Neutron anti-spoof protection. By forging DHCP discovery messages or non-IP traffic, such as ARP or ICMPv6, an instance may spoof IP or MAC source addresses on attached networks resulting in denial of services and/or traffic interception. Moreover when L2population isn't used, other tenants attached to a shared network are also vulnerable. Neutron setups using the IPTables firewall driver are affected.  Upstream bug:  <https://bugs.launchpad.net/bugs/1502933>  References:  <http://seclists.org/oss-sec/2016/q2/519>   ```  [Comment 1](show_bug.cgi?id=1345892#c1)  Garth Mollett    2016-06-23 23:48:38 UTC  ```  Created openstack-neutron tracking bugs for this issue:  Affects: fedora-all [[bug 1349669](show_bug.cgi?id=1349669 "CLOSED EOL - CVE-2015-8914 CVE-2016-5362 CVE-2016-5363 openstack-neutron: various flaws [fedora-all]")] Affects: openstack-rdo [[bug 1349670](show_bug.cgi?id=1349670 "CLOSED ERRATA - CVE-2015-8914 CVE-2016-5362 CVE-2016-5363 openstack-neutron: various flaws [openstack-rdo]")]   ```  [Comment 9](show_bug.cgi?id=1345892#c9)  errata-xmlrpc    2016-07-20 23:54:23 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux OpenStack Platform 7.0 (Kilo) for RHEL 7  Via RHSA-2016:1474 [https://access.redhat.com/errata/RHSA-2016:1474](https://access.redhat.com/errata/RHSA-2016%3A1474)   ```  [Comment 10](show_bug.cgi?id=1345892#c10)  errata-xmlrpc    2016-07-20 23:55:50 UTC  ``` This issue has been addressed in the following products:    Red Hat OpenStack Platform 8.0 (Liberty)  Via RHSA-2016:1473 [https://access.redhat.com/errata/RHSA-2016:1473](https://access.redhat.com/errata/RHSA-2016%3A1473)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1345892&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from review.opendev.org_bdb84f81_20250115_113225.html ===




=== Content from bugs.launchpad.net_c597615c_20250115_113231.html ===

[Log in / Register](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Blogin)

[![](https://launchpadlibrarian.net/337040413/OpenStack_Project_Neutron_mascot_64x64.png)](https://launchpad.net/neutron)

## [neutron](https://launchpad.net/neutron)

* [Overview](https://launchpad.net/neutron)
* [Code](https://code.launchpad.net/neutron)
* [Bugs](https://bugs.launchpad.net/neutron)
* [Blueprints](https://blueprints.launchpad.net/neutron)
* [Translations](https://translations.launchpad.net/neutron)
* [Answers](https://answers.launchpad.net/neutron)

# [OSSA-2021-001] Anti-spoofing bypass for Open vSwitch networks (CVE-2021-20267)

Bug #1902917 reported by
[David Sinquin](https://launchpad.net/~david-5-1)
on 2020-11-04

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | High | [Jeremy Stanley](https://launchpad.net/~fungi) |  |
|  | [neutron](https://bugs.launchpad.net/neutron) | Fix Released | High | [Slawek Kaplonski](https://launchpad.net/~slaweq) |  |

### Bug Description

Using Open vSwitch on an ussuri setup with neutron 16.0.0, VMs can send ICMPv6 Neighbor Advertisement packets with no check on their content to mis-direct traffic to them.

This looks a lot like [https://bugs.launchpad.net/neutron/+bug/1502933](https://bugs.launchpad.net/neutron/%2Bbug/1502933) except it affects Open vSwitch driver rather than iptables.

Pre-condition:

- two running VMs in the same L2 flat network with IPv6 connectivity

How to reproduce:

- manually add a custom IPv6 on one (e.g. `ip -6 address add fe80::42/64 dev eth0`)

- ping it from the other, expecting no answer (e.g. `ping -c1 -w1 "fe80::42%eth0"`)

- confirm it updated its neighbor table (e.g. `ip -6 neigh get fe80::42/64 dev eth0`)

Expected behavior:

- VMs should not be able to advertise IPv6 addresses that are not assigned to them e.g. through neighbor advertisement packets.

Affected versions:

The Openstack version I am using is Ussuri with neutron 16.0.0, with minor changes on commit df5b28c2e5. From a quick review of the diff with master, I think the issue is also present there. Network part is using Open vSwitch on flat network with Xen 4.13 as hypervisor.

Similarly, UDP packets using DHCP query ports (for DHCP v4 or v6) can be sent with arbitrary IP and MAC addresses.

And I think we are fine for other ICMP types (redirect, router renumbering for ICMPv6) as I did not managed to have such packets sent between VMs but I fail to understand how it gets filtered.

I am attaching a couple patches that I think fix the issues but include no tests and include changes that we may want to avoid (in case plugins out of neutron git repo use firewall.ICMPV6\_ALLOWED\_EGRESS\_TYPES).

See [original description](comments/0)

Tags:

[in-stable-queens](/neutron/%2Bbugs?field.tag=in-stable-queens)
[in-stable-rocky](/neutron/%2Bbugs?field.tag=in-stable-rocky)
[in-stable-stein](/neutron/%2Bbugs?field.tag=in-stable-stein)
[in-stable-train](/neutron/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/neutron/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/neutron/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/neutron/%2Bbugs?field.tag=in-stable-wallaby)

## CVE References

* [2015-8914](/bugs/cve/2015-8914 "The IPTables firewall in OpenStack Ne...")
* [2021-20267](/bugs/cve/2021-20267 "A flaw was found in openstack-neutron...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2020-11-04: |  |  | [#1](/neutron/%2Bbug/1902917/comments/1) |
| --- | --- | --- | --- |

* [anti-spoof.patch](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Battachment/5431130/%2Bfiles/anti-spoof.patch)
  [Edit](/neutron/%2Bbug/1902917/%2Battachment/5431130)
  (6.7 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-04: |  |  | [#2](/neutron/%2Bbug/1902917/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

| **description**: | updated |
| --- | --- |
| **description**: | updated |
| Changed in ossa: | |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-04: |  |  | [#3](/neutron/%2Bbug/1902917/comments/3) |
| --- | --- | --- | --- |

I think this is an already known issue, judging from abandoned attempts to correct it years ago:

<https://review.opendev.org/315828>

It got a mention in [bug 1502933](/bugs/1502933) which you referenced, as well as other bug reports linked from the commit message there. As such, I think we should be able to safely switch to discussing this report in public. Do Neutron security reviewers agree?

I think this is an already known issue, judging from abandoned attempts to correct it years ago:
https://review.opendev.org/315828
It got a mention in bug 1502933 which you referenced, as well as other bug reports linked from the commit message there. As such, I think we should be able to safely switch to discussing this report in public. Do Neutron security reviewers agree?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2020-11-05: |  |  | [#4](/neutron/%2Bbug/1902917/comments/4) |
| --- | --- | --- | --- |

@fungi: yes, I think this is similar bug to 1502933 and we can make it public IMO.

@David: is this happening for You for openvswitch fw driver or iptables\_hybrid? Or both?

@fungi: yes, I think this is similar bug to 1502933 and we can make it public IMO.
@David: is this happening for You for openvswitch fw driver or iptables\_hybrid? Or both?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2020-11-05: |  |  | [#5](/neutron/%2Bbug/1902917/comments/5) |
| --- | --- | --- | --- |

@slaweq: I face the issue using openvswitch fw driver but I did not test iptables\_hybrid so I don't know if the issue exists there.

If you all think it should be public, I am OK with that.

@slaweq: I face the issue using openvswitch fw driver but I did not test iptables\_hybrid so I don't know if the issue exists there.
If you all think it should be public, I am OK with that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2020-11-05: |  |  | [#6](/neutron/%2Bbug/1902917/comments/6) |
| --- | --- | --- | --- |

This report is now being tracked in public, so it can be discussed in public meetings and on mailing lists, and changes related to it can be pushed to normal code review (ideally referencing this bug number).

Pending further confirmation, this sounds likely to be a class A report per our taxonomy (and so would be covered in a security advisory similar to OSSA-2016-009/CVE-2015-8914): <https://security.openstack.org/vmt-process.html#incident-report-taxonomy>

This report is now being tracked in public, so it can be discussed in public meetings and on mailing lists, and changes related to it can be pushed to normal code review (ideally referencing this bug number).
Pending further confirmation, this sounds likely to be a class A report per our taxonomy (and so would be covered in a security advisory similar to OSSA-2016-009/CVE-2015-8914): https://security.openstack.org/vmt-process.html#incident-report-taxonomy

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Rodolfo Alonso (rodolfo-alonso-hernandez)](https://launchpad.net/~rodolfo-alonso-hernandez) wrote on 2020-11-10: |  |  | [#7](/neutron/%2Bbug/1902917/comments/7) |
| --- | --- | --- | --- |

Marking this patch as "high", same as [https://bugs.launchpad.net/neutron/+bug/1502933](https://bugs.launchpad.net/neutron/%2Bbug/1502933).

Marking this patch as "high", same as https://bugs.launchpad.net/neutron/+bug/1502933.

| Changed in neutron: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-16: |  |  | [#8](/neutron/%2Bbug/1902917/comments/8) |
| --- | --- | --- | --- |

I was able to reproduce that bug on master. For now I did it with ovs firewall driver.

I will need to confirm if that is also the case for iptables\_hybrid fw driver.

I was able to reproduce that bug on master. For now I did it with ovs firewall driver.
I will need to confirm if that is also the case for iptables\_hybrid fw driver.

| Changed in neutron: | |
| --- | --- |
| **assignee**: | nobody → Slawek Kaplonski (slaweq) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-16: |  |  | [#9](/neutron/%2Bbug/1902917/comments/9) |
| --- | --- | --- | --- |

I just checked and I can't reproduce the same issue with iptables\_hybrid fw driver.

So it seems that only openvswitch firewall driver is impacted by that (at least on master).

I just checked and I can't reproduce the same issue with iptables\_hybrid fw driver.
So it seems that only openvswitch firewall driver is impacted by that (at least on master).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-19: |  |  | [#10](/neutron/%2Bbug/1902917/comments/10) |
| --- | --- | --- | --- |

Patch proposed [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599)

Patch proposed https://review.opendev.org/c/openstack/neutron/+/776599

| Changed in neutron: | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-19: |  |  | [#11](/neutron/%2Bbug/1902917/comments/11) |
| --- | --- | --- | --- |

I also tested OVN backend and it seems that it isn't affected. So fix is needed only for ovs firewall driver.

I also tested OVN backend and it seems that it isn't affected. So fix is needed only for ovs firewall driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-02-27: |  |  | [#12](/neutron/%2Bbug/1902917/comments/12) |
| --- | --- | --- | --- |

Patch [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599) merged and it should solves that problem.

Patch https://review.opendev.org/c/openstack/neutron/+/776599 merged and it should solves that problem.

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Summer Long (slong-g)](https://launchpad.net/~slong-g) wrote on 2021-03-03: |  |  | [#13](/neutron/%2Bbug/1902917/comments/13) |
| --- | --- | --- | --- |

Fantastic, Slawek, thanks! Jeremy, have you already asked Mitre for a CVE? Otherwise, RH can issue one.

Fantastic, Slawek, thanks! Jeremy, have you already asked Mitre for a CVE? Otherwise, RH can issue one.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-03: |  |  | [#14](/neutron/%2Bbug/1902917/comments/14) |
| --- | --- | --- | --- |

Summer: I was hoping to first see some core reviews on the proposed backports before assuming it's going to be fixed there, and as confirmation that we know for sure the extent of the problem prior to the current state of the master branch. The backport targeting stable/victoria looks like it may also fail the neutron-grenade-dvr-multinode upgrade job, it was rechecked a few minutes ago to hopefully rule that out.

Once there's at least one +2 on some of the backports I'll be more confident in drafting an accurate impact description with which to request a CVE assignment. Since this is already public, we're not under any tight embargo timeline with it, and probably not much point in having a CVE to track it until we have a fix we know we can recommend. That said, if you want to act as a CNA and issue a placeholder CVE now, just make sure to let us know the number and I'll refrain from requesting one from MITRE later.

Summer: I was hoping to first see some core reviews on the proposed backports before assuming it's going to be fixed there, and as confirmation that we know for sure the extent of the problem prior to the current state of the master branch. The backport targeting stable/victoria looks like it may also fail the neutron-grenade-dvr-multinode upgrade job, it was rechecked a few minutes ago to hopefully rule that out.
Once there's at least one +2 on some of the backports I'll be more confident in drafting an accurate impact description with which to request a CVE assignment. Since this is already public, we're not under any tight embargo timeline with it, and probably not much point in having a CVE to track it until we have a fix we know we can recommend. That said, if you want to act as a CNA and issue a placeholder CVE now, just make sure to let us know the number and I'll refrain from requesting one from MITRE later.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Summer Long (slong-g)](https://launchpad.net/~slong-g) wrote on 2021-03-05: |  |  | [#15](/neutron/%2Bbug/1902917/comments/15) |
| --- | --- | --- | --- |

Thanks Jeremy, CVE-2021-20267 has been assigned to this issue.

Thanks Jeremy, CVE-2021-20267 has been assigned to this issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-05: |  |  | [#16](/neutron/%2Bbug/1902917/comments/16) |
| --- | --- | --- | --- |

The stable/victoria backport has merged and the other backports all have positive votes from from core reviewers. Here's an initial draft for an impact description we'll be able to use in an advisory; please review and call out anything which needs correcting (and David, let me know if you have an employer or other affiliated organization you wish mentioned alongside your name)...

Title: Anti-spoofing bypass for Open vSwitch networks

Reporter: David Sinquin

Products: Neutron

Affects: <15.3.3, >=16.0.0 <16.3.1, >=17.0.0 <17.1.1

Description: David Sinquin reported a vulnerability in Neutron's default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch driver are affected.

The stable/victoria backport has merged and the other backports all have positive votes from from core reviewers. Here's an initial draft for an impact description we'll be able to use in an advisory; please review and call out anything which needs correcting (and David, let me know if you have an employer or other affiliated organization you wish mentioned alongside your name)...
Title: Anti-spoofing bypass for Open vSwitch networks
Reporter: David Sinquin
Products: Neutron
Affects: <15.3.3, >=16.0.0 <16.3.1, >=17.0.0 <17.1.1
Description: David Sinquin reported a vulnerability in Neutron's default Open vSwitch firewall rules. By sending carefully crafted packets, anyone in control of a server instance connected to the virtual switch can impersonate the IPv6 addresses of other systems on the network, resulting in denial of service or in some cases possibly interception of traffic intended for other destinations. Only deployments using the Open vSwitch driver are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Jeremy Stanley (fungi) |
| **summary**: | - Anti-spoofing bypass using Open vSwitch+ Anti-spoofing bypass using Open vSwitch (CVE-2021-20267) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-05:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/17) |  |  | [#17](/neutron/%2Bbug/1902917/comments/17) |
| --- | --- | --- | --- |

I want to first thank everyone involved.

Regarding credits, please mention “Gandi.net” as my employee (for which I am reporting this and auditing spoofing possibilities in the first place).

Regarding Slawek Kaplonski's patch [1] that was merged in master, I am sorry I did not took time to review this further before, but I \*\*think\*\* there is still a potential security concern (DoS / redirection) for Neighbor Advertisements. I have not tested this using neutron so I cannot guaranty this be possible in a real deployment.

The scenario I think of would require 2 VMs : one “attacker”, one “victim” whose neighbor cache is to be poisoned (for a spoofed IP). The following is an attempt at providing a way to check for the vulnerability:

First, on attacker, add the IP to spoof. It must be unattributed to avoid races with legit owner and simplify testing.

Second, on the attacker, install scapy and start it (use `scapy` to have useful imports) and adapt then run the below lines, leaving the prompt opened for fourth step:

spoofed\_ipv6 = '' # FIXME non-ll (NOT fe80::), L2-reachable

    victim\_ipv6 = '' # FIXME must be L2-reachable

    announced\_mac = '' # FIXME attacker MAC

ipv6 = IPv6(dst=victim\_ipv6)

    icmpv6na = ICMPv6ND\_NA(tgt=spoofed\_ipv6)

    icmpv6\_target\_ll\_addr = ICMPv6NDOptDstLLAddr(lladdr=announced\_mac)

    spoofed\_packet = Ether() / ip6 / icmp6na / icmpv6\_target\_ll\_addr

    spoofed\_packet.show() # not mandatory :-)

Third, on the victim, run a tcpdump (e.g. `tcpdump -nvve 'icmp6 && ip6[40] == 134'`) and while it runs, run a ping6 to the unattributed IPv6 to spoof (clear cache before if needed) and immediately continue to the next step.

Fourth, using the scapy prompt on the attacker, run (a few times by security, one should be enough but packet loss might occur):

    sendp(spoofed\_packet)

Finally, check the victim tcpdump (it should be empty) and cache with e.g. `ip -6 n` (idem).

(I realize after having finished proofreading this that the same could likely be achieved through some kind of targeted IPv6 NAT for outgoing ICMPv6 packets on the attacker to avoid scapy completely.)

In the patch I had attached to this bug, I was using nd\_target to rule this possible issue out but it can only be applied to Neighbor Advertisement packets (since other types do not have such value), hence the other changes I had done around NA management.

[1] [https://review.opendev.org/c/openstack/neutron/+/776599](https://review.opendev.org/c/openstack/neutron/%2B/776599)

I want to first thank everyone involved.
Regarding credits, please mention “Gandi.net” as my employee (for which I am reporting this and auditing spoofing possibilities in the first place).
Regarding Slawek Kaplonski's patch [1] that was merged in master, I am sorry I did not took time to review this further before, but I \*\*think\*\* there is still a potential security concern (DoS / redirection) for Neighbor Advertisements. I have not tested this using neutron so I cannot guaranty this be possible in a real deployment.
The scenario I think of would require 2 VMs : one “attacker”, one “victim” whose neighbor cache is to be poisoned (for a spoofed IP). The following is an attempt at providing a way to check for the vulnerability:
First, on attacker, add the IP to spoof. It must be unattributed to avoid races with legit owner and simplify testing.
Second, on the attacker, install scapy and start it (use `scapy` to have useful imports) and adapt then run the below lines, leaving the prompt opened for fourth step:
spoofed\_ipv6 = '' # FIXME non-ll (NOT fe80::), L2-reachable
victim\_ipv6 = '' # FIXME must be L2-reachable
announced\_mac = '' # FIXME attacker MAC
ipv6 = IPv6(dst=victim\_ipv6)
icmpv6na = ICMPv6ND\_NA(tgt=spoofed\_ipv6)
icmpv6\_target\_ll\_addr = ICMPv6NDOptDstLLAddr(lladdr=announced\_mac)
spoofed\_packet = Ether() / ip6 / icmp6na / icmpv6\_target\_ll\_addr
spoofed\_packet.show() # not mandatory :-)
Third, on the victim, run a tcpdump (e.g. `tcpdump -nvve 'icmp6 && ip6[40] == 134'`) and while it runs, run a ping6 to the unattributed IPv6 to spoof (clear cache before if needed) and immediately continue to the next step.
Fourth, using the scapy prompt on the attacker, run (a few times by security, one should be enough but packet loss might occur):
sendp(spoofed\_packet)
Finally, check the victim tcpdump (it should be empty) and cache with e.g. `ip -6 n` (idem).
(I realize after having finished proofreading this that the same could likely be achieved through some kind of targeted IPv6 NAT for outgoing ICMPv6 packets on the attacker to avoid scapy completely.)
In the patch I had attached to this bug, I was using nd\_target to rule this possible issue out but it can only be applied to Neighbor Advertisement packets (since other types do not have such value), hence the other changes I had done around NA management.
[1] https://review.opendev.org/c/openstack/neutron/+/776599

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gage Hugo (gagehugo)](https://launchpad.net/~gagehugo) wrote on 2021-03-05: |  |  | [#18](/neutron/%2Bbug/1902917/comments/18) |
| --- | --- | --- | --- |

I am good with Jeremy's impact description in comment #16.

I am good with Jeremy's impact description in comment #16.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-05: |  |  | [#19](/neutron/%2Bbug/1902917/comments/19) |
| --- | --- | --- | --- |

Jeremy's impact description in comment #16 also looks good to me FWIW :-)

Jeremy's impact description in comment #16 also looks good to me FWIW :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-08: |  |  | [#20](/neutron/%2Bbug/1902917/comments/20) |
| --- | --- | --- | --- |

Given David's suggestion (in comment #17) that the merged fix may be incomplete, I'd rather hold off finalizing any advisory until someone can either confirm or refute it.

Given David's suggestion (in comment #17) that the merged fix may be incomplete, I'd rather hold off finalizing any advisory until someone can either confirm or refute it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-12: |  |  | [#21](/neutron/%2Bbug/1902917/comments/21) |
| --- | --- | --- | --- |

Hi David,

Here is what I did exactly to try what You described in the c17: <http://paste.openstack.org/show/803502/>

For me it seems that I wasn't able to reproduce what You described but maybe I did something wrong there. If so, please provide me reproducer so I can check that.

Hi David,
Here is what I did exactly to try what You described in the c17: http://paste.openstack.org/show/803502/
For me it seems that I wasn't able to reproduce what You described but maybe I did something wrong there. If so, please provide me reproducer so I can check that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-12: |  |  | [#22](/neutron/%2Bbug/1902917/comments/22) |
| --- | --- | --- | --- |

Hi Slaweq,

from what I understand, one of the issue you had is the fact your VM had no route to 3000::/64 and therefore no ICMPv6 packets were sent at all.

I also realize the tcpdump command I provided was wrong, and can be replaced with e.g.:

    tcpdump -nve 'icmp6 && (ip6[40] == 135 || ip6[40] == 136)'

(135 is Neighbor Solicitation, 136 is Neighbor Advertisement, 134 was unrelated Router Advertisement…)

I have replied to your paste with what I get (with a reworked procedure I tested in a OpenStack environment), you can find it at: <http://paste.openstack.org/show/803529/>

The main changes I did are:

 - switching to using fe80::/64 IPs (due to my local setup, I preferred using them)

 - sending spoofed packets in a loop

 - changing NA options to match legitimate answer my VM was sending (likely useless, but it works as-is :-D)

 - some clean-up of unnecessary steps.

Hi Slaweq,
from what I understand, one of the issue you had is the fact your VM had no route to 3000::/64 and therefore no ICMPv6 packets were sent at all.
I also realize the tcpdump command I provided was wrong, and can be replaced with e.g.:
tcpdump -nve 'icmp6 && (ip6[40] == 135 || ip6[40] == 136)'
(135 is Neighbor Solicitation, 136 is Neighbor Advertisement, 134 was unrelated Router Advertisement…)
I have replied to your paste with what I get (with a reworked procedure I tested in a OpenStack environment), you can find it at: http://paste.openstack.org/show/803529/
The main changes I did are:
- switching to using fe80::/64 IPs (due to my local setup, I preferred using them)
- sending spoofed packets in a loop
- changing NA options to match legitimate answer my VM was sending (likely useless, but it works as-is :-D)
- some clean-up of unnecessary steps.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-12: |  |  | [#23](/neutron/%2Bbug/1902917/comments/23) |
| --- | --- | --- | --- |

FTR, I did my tests using ussuri neutron version with 4b5bcff64c4725b37f094dfd2613ec58f723d304 cherry-picked on top of 4edf21a37561971991ee450b07fcfbca95922bc2 (plus internal patches that do not change openvswitch driver code).

FTR, I did my tests using ussuri neutron version with 4b5bcff64c4725b37f094dfd2613ec58f723d304 cherry-picked on top of 4edf21a37561971991ee450b07fcfbca95922bc2 (plus internal patches that do not change openvswitch driver code).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 15.3.3**](/neutron/%2Bbug/1902917/comments/24) |  |  | [#24](/neutron/%2Bbug/1902917/comments/24) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 15.3.3 release.

This issue was fixed in the openstack/neutron 15.3.3 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 16.3.1**](/neutron/%2Bbug/1902917/comments/25) |  |  | [#25](/neutron/%2Bbug/1902917/comments/25) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 16.3.1 release.

This issue was fixed in the openstack/neutron 16.3.1 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-18:  [**Fix included in openstack/neutron 17.1.1**](/neutron/%2Bbug/1902917/comments/26) |  |  | [#26](/neutron/%2Bbug/1902917/comments/26) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 17.1.1 release.

This issue was fixed in the openstack/neutron 17.1.1 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-03-18:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/27) |  |  | [#27](/neutron/%2Bbug/1902917/comments/27) |
| --- | --- | --- | --- |

I've asked in #openstack-neutron whether we can switch this back to In Progress state or similar, since it sounds like the fixes were incomplete.

I've asked in #openstack-neutron whether we can switch this back to In Progress state or similar, since it sounds like the fixes were incomplete.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-19: |  |  | [#28](/neutron/%2Bbug/1902917/comments/28) |
| --- | --- | --- | --- |

Thx David. I was able to reproduce that issue with Your script.

Thx David. I was able to reproduce that issue with Your script.

| Changed in neutron: | |
| --- | --- |
| **status**: | Fix Released → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-19: |  |  | [#29](/neutron/%2Bbug/1902917/comments/29) |
| --- | --- | --- | --- |

Thx for confirming that :-)

Thx for confirming that :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-19: |  |  | [#30](/neutron/%2Bbug/1902917/comments/30) |
| --- | --- | --- | --- |

After some more research I'm not sure if we have any way to fix that issue really as it seems for me that OVS don't allows us to match on tgt field of the ICMPv6 packets and that's where this spoofed IP address is send really in Your example.

If You have any idea on how to fix that, feel free to propose patch for it.

After some more research I'm not sure if we have any way to fix that issue really as it seems for me that OVS don't allows us to match on tgt field of the ICMPv6 packets and that's where this spoofed IP address is send really in Your example.
If You have any idea on how to fix that, feel free to propose patch for it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-22: |  |  | [#31](/neutron/%2Bbug/1902917/comments/31) |
| --- | --- | --- | --- |

I think the patch I had attached to this bug report had a working fix for that using nd\_target param in \_add\_flow method.

The code is mostly:

self.\_add\_flow(

    table=ovs\_consts.BASE\_EGRESS\_TABLE,

    priority=95,

    in\_port=port.ofport,

    reg\_port=port.ofport,

    dl\_type=lib\_const.ETHERTYPE\_IPV6,

    nw\_proto=lib\_const.PROTO\_NUM\_IPV6\_ICMP,

    icmp\_type=n\_const.ICMPV6\_TYPE\_NA,

    nd\_target=allowed\_ip\_addr,

    actions='resubmit(,%d)' % (

        ovs\_consts.ACCEPTED\_EGRESS\_TRAFFIC\_NORMAL\_TABLE)

)

and results in the following Open vSwitch rule:

table=71, hard\_age=65534, priority=95,icmp6,reg5=0x4,in\_port=4,icmp\_type=136,nd\_target=fe80::f816:3eff:fed3:1eb4,actions=resubmit(,94)

The above is as-is allowing the VM to use an IPv6 it does not own to announce its own IPs but can likely be restricted further and does not prevent it from announcing a MAC address it does not own but this requires privileges inside the VM and these privileges are anyway enough to make many other DoS for the VM itself.

I think the patch I had attached to this bug report had a working fix for that using nd\_target param in \_add\_flow method.
The code is mostly:
self.\_add\_flow(
table=ovs\_consts.BASE\_EGRESS\_TABLE,
priority=95,
in\_port=port.ofport,
reg\_port=port.ofport,
dl\_type=lib\_const.ETHERTYPE\_IPV6,
nw\_proto=lib\_const.PROTO\_NUM\_IPV6\_ICMP,
icmp\_type=n\_const.ICMPV6\_TYPE\_NA,
nd\_target=allowed\_ip\_addr,
actions='resubmit(,%d)' % (
ovs\_consts.ACCEPTED\_EGRESS\_TRAFFIC\_NORMAL\_TABLE)
)
and results in the following Open vSwitch rule:
table=71, hard\_age=65534, priority=95,icmp6,reg5=0x4,in\_port=4,icmp\_type=136,nd\_target=fe80::f816:3eff:fed3:1eb4,actions=resubmit(,94)
The above is as-is allowing the VM to use an IPv6 it does not own to announce its own IPs but can likely be restricted further and does not prevent it from announcing a MAC address it does not own but this requires privileges inside the VM and these privileges are anyway enough to make many other DoS for the VM itself.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-03-26:  [**Fix included in openstack/neutron 18.0.0.0rc1**](/neutron/%2Bbug/1902917/comments/32) |  |  | [#32](/neutron/%2Bbug/1902917/comments/32) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 18.0.0.0rc1 release candidate.

This issue was fixed in the openstack/neutron 18.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Slawek Kaplonski (slaweq)](https://launchpad.net/~slaweq) wrote on 2021-03-29:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/33) |  |  | [#33](/neutron/%2Bbug/1902917/comments/33) |
| --- | --- | --- | --- |

Hi David,

I just proposed Your patch in gerrit [https://review.opendev.org/c/openstack/neutron/+/783743](https://review.opendev.org/c/openstack/neutron/%2B/783743) - please take a look and check if I didn't made any mistake there.

I also added some UT for it.

And I tested Your patch locally - it worked for me and I wasn't able to spoof address anymore with that patch using Your script described in comment #22

Hi David,
I just proposed Your patch in gerrit https://review.opendev.org/c/openstack/neutron/+/783743 - please take a look and check if I didn't made any mistake there.
I also added some UT for it.
And I tested Your patch locally - it worked for me and I wasn't able to spoof address anymore with that patch using Your script described in comment #22

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-03-30: |  |  | [#34](/neutron/%2Bbug/1902917/comments/34) |
| --- | --- | --- | --- |

Thanks Slaweq, your commit looks good to me and as you tested your version (and I had tested the patch you adapted), I think we are fine.

Thanks Slaweq, your commit looks good to me and as you tested your version (and I had tested the patch you adapted), I think we are fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix merged to neutron (master)**](/neutron/%2Bbug/1902917/comments/35) |  |  | [#35](/neutron/%2Bbug/1902917/comments/35) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/783743](https://review.opendev.org/c/openstack/neutron/%2B/783743)

Committed: <https://opendev.org/openstack/neutron/commit/ca7822e2108c151bda992ef8a6d454ec2c6d890e>

Submitter: "Zuul (22348)"

Branch: master

commit ca7822e2108c151bda992ef8a6d454ec2c6d890e

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

Reviewed: https://review.opendev.org/c/openstack/neutron/+/783743
Committed: https://opendev.org/openstack/neutron/commit/ca7822e2108c151bda992ef8a6d454ec2c6d890e
Submitter: "Zuul (22348)"
Branch: master
commit ca7822e2108c151bda992ef8a6d454ec2c6d890e
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

| Changed in neutron: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/wallaby)**](/neutron/%2Bbug/1902917/comments/36) |  |  | [#36](/neutron/%2Bbug/1902917/comments/36) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/neutron/+/791464](https://review.opendev.org/c/openstack/neutron/%2B/791464)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/neutron/+/791464

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/victoria)**](/neutron/%2Bbug/1902917/comments/37) |  |  | [#37](/neutron/%2Bbug/1902917/comments/37) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/neutron/+/791465](https://review.opendev.org/c/openstack/neutron/%2B/791465)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/neutron/+/791465

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/ussuri)**](/neutron/%2Bbug/1902917/comments/38) |  |  | [#38](/neutron/%2Bbug/1902917/comments/38) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/neutron/+/791467](https://review.opendev.org/c/openstack/neutron/%2B/791467)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/neutron/+/791467

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/train)**](/neutron/%2Bbug/1902917/comments/39) |  |  | [#39](/neutron/%2Bbug/1902917/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/neutron/+/791468](https://review.opendev.org/c/openstack/neutron/%2B/791468)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/neutron/+/791468

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/stein)**](/neutron/%2Bbug/1902917/comments/40) |  |  | [#40](/neutron/%2Bbug/1902917/comments/40) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/neutron/+/791500](https://review.opendev.org/c/openstack/neutron/%2B/791500)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/neutron/+/791500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/rocky)**](/neutron/%2Bbug/1902917/comments/41) |  |  | [#41](/neutron/%2Bbug/1902917/comments/41) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/neutron/+/791469](https://review.opendev.org/c/openstack/neutron/%2B/791469)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/neutron/+/791469

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-14:  [**Fix proposed to neutron (stable/queens)**](/neutron/%2Bbug/1902917/comments/42) |  |  | [#42](/neutron/%2Bbug/1902917/comments/42) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/queens

Review: [https://review.opendev.org/c/openstack/neutron/+/791470](https://review.opendev.org/c/openstack/neutron/%2B/791470)

Fix proposed to branch: stable/queens
Review: https://review.opendev.org/c/openstack/neutron/+/791470

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-31:  [**Fix merged to neutron (stable/train)**](/neutron/%2Bbug/1902917/comments/43) |  |  | [#43](/neutron/%2Bbug/1902917/comments/43) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791468](https://review.opendev.org/c/openstack/neutron/%2B/791468)

Committed: <https://opendev.org/openstack/neutron/commit/2231a9d40f989a1e8a20f9862ff03916091b3215>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 2231a9d40f989a1e8a20f9862ff03916091b3215

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791468
Committed: https://opendev.org/openstack/neutron/commit/2231a9d40f989a1e8a20f9862ff03916091b3215
Submitter: "Zuul (22348)"
Branch: stable/train
commit 2231a9d40f989a1e8a20f9862ff03916091b3215
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-01:  [**Fix merged to neutron (stable/ussuri)**](/neutron/%2Bbug/1902917/comments/44) |  |  | [#44](/neutron/%2Bbug/1902917/comments/44) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791467](https://review.opendev.org/c/openstack/neutron/%2B/791467)

Committed: <https://opendev.org/openstack/neutron/commit/ac474307d3a800c30ecbabf0f47de931ad310339>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit ac474307d3a800c30ecbabf0f47de931ad310339

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791467
Committed: https://opendev.org/openstack/neutron/commit/ac474307d3a800c30ecbabf0f47de931ad310339
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit ac474307d3a800c30ecbabf0f47de931ad310339
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/rocky)**](/neutron/%2Bbug/1902917/comments/45) |  |  | [#45](/neutron/%2Bbug/1902917/comments/45) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791469](https://review.opendev.org/c/openstack/neutron/%2B/791469)

Committed: <https://opendev.org/openstack/neutron/commit/9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11>

Submitter: "Zuul (22348)"

Branch: stable/rocky

commit 9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791469
Committed: https://opendev.org/openstack/neutron/commit/9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11
Submitter: "Zuul (22348)"
Branch: stable/rocky
commit 9f4a9f8f86720567a8ed5e7c5c4430c115ad3c11
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-rocky |
| --- | --- |
| **tags**: | added: in-stable-queens |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/queens)**](/neutron/%2Bbug/1902917/comments/46) |  |  | [#46](/neutron/%2Bbug/1902917/comments/46) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791470](https://review.opendev.org/c/openstack/neutron/%2B/791470)

Committed: <https://opendev.org/openstack/neutron/commit/ccea0021bc49eefde9af6568942159b52588daae>

Submitter: "Zuul (22348)"

Branch: stable/queens

commit ccea0021bc49eefde9af6568942159b52588daae

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791470
Committed: https://opendev.org/openstack/neutron/commit/ccea0021bc49eefde9af6568942159b52588daae
Submitter: "Zuul (22348)"
Branch: stable/queens
commit ccea0021bc49eefde9af6568942159b52588daae
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/stein)**](/neutron/%2Bbug/1902917/comments/47) |  |  | [#47](/neutron/%2Bbug/1902917/comments/47) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791500](https://review.opendev.org/c/openstack/neutron/%2B/791500)

Committed: <https://opendev.org/openstack/neutron/commit/e1fe735e843b5d1bee4fa18e6011121027422203>

Submitter: "Zuul (22348)"

Branch: stable/stein

commit e1fe735e843b5d1bee4fa18e6011121027422203

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Conflicts:

        neutron/agent/linux/openvswitch\_firewall/firewall.py

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791500
Committed: https://opendev.org/openstack/neutron/commit/e1fe735e843b5d1bee4fa18e6011121027422203
Submitter: "Zuul (22348)"
Branch: stable/stein
commit e1fe735e843b5d1bee4fa18e6011121027422203
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Conflicts:
neutron/agent/linux/openvswitch\_firewall/firewall.py
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-stein |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-04:  [**Fix merged to neutron (stable/victoria)**](/neutron/%2Bbug/1902917/comments/48) |  |  | [#48](/neutron/%2Bbug/1902917/comments/48) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791465](https://review.opendev.org/c/openstack/neutron/%2B/791465)

Committed: <https://opendev.org/openstack/neutron/commit/eb2851561a89338c5843521128cbef3c1c7de10c>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit eb2851561a89338c5843521128cbef3c1c7de10c

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791465
Committed: https://opendev.org/openstack/neutron/commit/eb2851561a89338c5843521128cbef3c1c7de10c
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit eb2851561a89338c5843521128cbef3c1c7de10c
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-06:  [**Fix merged to neutron (stable/wallaby)**](/neutron/%2Bbug/1902917/comments/49) |  |  | [#49](/neutron/%2Bbug/1902917/comments/49) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/neutron/+/791464](https://review.opendev.org/c/openstack/neutron/%2B/791464)

Committed: <https://opendev.org/openstack/neutron/commit/cb746e2ca454885ba5cf653493b9bb0e91480759>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit cb746e2ca454885ba5cf653493b9bb0e91480759

Author: Slawek Kaplonski <email address hidden>

Date: Mon Mar 29 22:21:15 2021 +0200

[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses

Neighbor Advertisments are used to inform other machines of the MAC

    address to use to reach an IPv6. This commits prevents VMs from

    pretending they are assigned IPv6 they should not use.

It also prevents sending UDP packets with spoofed IP or MAC even using

    DHCP(v6) request ports.

Co-authored-by: David Sinquin <email address hidden>

Closes-bug: #1902917

Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c

    (cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

Reviewed: https://review.opendev.org/c/openstack/neutron/+/791464
Committed: https://opendev.org/openstack/neutron/commit/cb746e2ca454885ba5cf653493b9bb0e91480759
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit cb746e2ca454885ba5cf653493b9bb0e91480759
Author: Slawek Kaplonski <skaplons@redhat.com>
Date: Mon Mar 29 22:21:15 2021 +0200
[ovs fw] Restrict IPv6 NA and DHCP(v6) IP and MAC source addresses
Neighbor Advertisments are used to inform other machines of the MAC
address to use to reach an IPv6. This commits prevents VMs from
pretending they are assigned IPv6 they should not use.
It also prevents sending UDP packets with spoofed IP or MAC even using
DHCP(v6) request ports.
Co-authored-by: David Sinquin <david.sinquin@gandi.net>
Closes-bug: #1902917
Change-Id: Iffb6643359562487414460f5a7e19a7fae9f935c
(cherry picked from commit ca7822e2108c151bda992ef8a6d454ec2c6d890e)

| **tags**: | added: in-stable-wallaby |
| --- | --- |

[Bernard Cafarelli (bcafarel)](https://launchpad.net/~bcafarel)
on 2021-06-11

| **tags**: | added: neutron-proactive-backport-potential |
| --- | --- |

[Bernard Cafarelli (bcafarel)](https://launchpad.net/~bcafarel)
on 2021-06-11

| **tags**: | removed: neutron-proactive-backport-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-08:  [**Fix proposed to ossa (master)**](/neutron/%2Bbug/1902917/comments/50) |  |  | [#50](/neutron/%2Bbug/1902917/comments/50) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/800107](https://review.opendev.org/c/openstack/ossa/%2B/800107)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/800107

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-09:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/51) |  |  | [#51](/neutron/%2Bbug/1902917/comments/51) |
| --- | --- | --- | --- |

I'd like to go ahead and publish the advisory for this early next week, if anyone has time to review the proposed content here: <https://review.opendev.org/800107>

I'd like to go ahead and publish the advisory for this early next week, if anyone has time to review the proposed content here: https://review.opendev.org/800107

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 16.4.0**](/neutron/%2Bbug/1902917/comments/52) |  |  | [#52](/neutron/%2Bbug/1902917/comments/52) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 16.4.0 release.

This issue was fixed in the openstack/neutron 16.4.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 17.2.0**](/neutron/%2Bbug/1902917/comments/53) |  |  | [#53](/neutron/%2Bbug/1902917/comments/53) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 17.2.0 release.

This issue was fixed in the openstack/neutron 17.2.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix included in openstack/neutron 18.1.0**](/neutron/%2Bbug/1902917/comments/54) |  |  | [#54](/neutron/%2Bbug/1902917/comments/54) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 18.1.0 release.

This issue was fixed in the openstack/neutron 18.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [David Sinquin (david-5-1)](https://launchpad.net/~david-5-1) wrote on 2021-07-12:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/55) |  |  | [#55](/neutron/%2Bbug/1902917/comments/55) |
| --- | --- | --- | --- |

Thank you fungi, the OSSA looks correct and relevant to me.

And also thanks to everyone involved for the rest of the work :-)

Thank you fungi, the OSSA looks correct and relevant to me.
And also thanks to everyone involved for the rest of the work :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-12:  [**Fix merged to ossa (master)**](/neutron/%2Bbug/1902917/comments/56) |  |  | [#56](/neutron/%2Bbug/1902917/comments/56) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/800107](https://review.opendev.org/c/openstack/ossa/%2B/800107)

Committed: <https://opendev.org/openstack/ossa/commit/239ec3826a74c4f3ffb1239cc574f95c6097c631>

Submitter: "Zuul (22348)"

Branch: master

commit 239ec3826a74c4f3ffb1239cc574f95c6097c631

Author: Jeremy Stanley <email address hidden>

Date: Thu Jul 8 20:49:35 2021 +0000

Add OSSA-2021-001 (CVE-2021-20267)

Change-Id: I6bcc8392831efbdc7759b0ed5340023bb0440c85

    Closes-Bug: #1902917

Reviewed: https://review.opendev.org/c/openstack/ossa/+/800107
Committed: https://opendev.org/openstack/ossa/commit/239ec3826a74c4f3ffb1239cc574f95c6097c631
Submitter: "Zuul (22348)"
Branch: master
commit 239ec3826a74c4f3ffb1239cc574f95c6097c631
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Thu Jul 8 20:49:35 2021 +0000
Add OSSA-2021-001 (CVE-2021-20267)
Change-Id: I6bcc8392831efbdc7759b0ed5340023bb0440c85
Closes-Bug: #1902917

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-12:  [**Re: Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)**](/neutron/%2Bbug/1902917/comments/57) |  |  | [#57](/neutron/%2Bbug/1902917/comments/57) |
| --- | --- | --- | --- |

The advisory is published at <https://security.openstack.org/> now and copies have been sent to the usual mailing lists (oss-security, openstack-announce, openstack-discuss).

The advisory is published at https://security.openstack.org/ now and copies have been sent to the usual mailing lists (oss-security, openstack-announce, openstack-discuss).

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-08-02

| **summary**: | - Anti-spoofing bypass using Open vSwitch (CVE-2021-20267)+ [OSSA-2021-001] Anti-spoofing bypass for Open vSwitch networks+ (CVE-2021-20267) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-15:  [**Fix included in openstack/neutron 19.0.0.0rc1**](/neutron/%2Bbug/1902917/comments/58) |  |  | [#58](/neutron/%2Bbug/1902917/comments/58) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron 19.0.0.0rc1 release candidate.

This issue was fixed in the openstack/neutron 19.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron queens-eol**](/neutron/%2Bbug/1902917/comments/59) |  |  | [#59](/neutron/%2Bbug/1902917/comments/59) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron queens-eol release.

This issue was fixed in the openstack/neutron queens-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron rocky-eol**](/neutron/%2Bbug/1902917/comments/61) |  |  | [#61](/neutron/%2Bbug/1902917/comments/61) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron rocky-eol release.

This issue was fixed in the openstack/neutron rocky-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-18:  [**Fix included in openstack/neutron stein-eol**](/neutron/%2Bbug/1902917/comments/63) |  |  | [#63](/neutron/%2Bbug/1902917/comments/63) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron stein-eol release.

This issue was fixed in the openstack/neutron stein-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-10-10:  [**Fix included in openstack/neutron train-eol**](/neutron/%2Bbug/1902917/comments/65) |  |  | [#65](/neutron/%2Bbug/1902917/comments/65) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/neutron train-eol release.

This issue was fixed in the openstack/neutron train-eol release.

[See full activity log](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/neutron/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/neutron/%2Bbug/1902917/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [anti-spoof.patch](https://bugs.launchpad.net/neutron/%2Bbug/1902917/%2Battachment/5431130/%2Bfiles/anti-spoof.patch)
  [Edit](/neutron/%2Bbug/1902917/%2Battachment/5431130 "Change patch details")

* [Add patch](/neutron/%2Bbug/1902917/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))


