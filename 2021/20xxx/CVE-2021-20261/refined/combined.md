=== Content from access.redhat.com_65afd1d7_20250115_124445.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# How do I prevent a kernel module from loading automatically?

Solution Verified
- Updated 2024-08-07T06:04:10+00:00 -
English

* [English](https://access.redhat.com/solutions/41278)
* [Japanese](https://access.redhat.com/ja/solutions/88163)
* [Chinese](https://access.redhat.com/zh-hans/solutions/88173)

## Environment

* Red Hat Enterprise Linux

## Issue

* How do I prevent a kernel module from loading automatically?
* How to disable a kernel module?
* How to disable a specific device driver?

## Resolution

* In order to prevent kernel modules loading during boot, the module name must be added to a configuration file for the "modprobe" utility. This file must reside in `/etc/modprobe.d` .
* Ensure the module is not configured to get loaded in either `/etc/modprobe.conf`, `/etc/modprobe.d/*`, `/etc/rc.modules`, or `/etc/sysconfig/modules/*` before making the following modifications.
* Due to differences between the various versions of RHEL, be sure to follow the appropriate steps for your system's version below:
  + The shared steps for [RHEL 5, 6, 7, 8 and 9](#sharedrhel5678and9) followed by the specific steps for each version
  + The steps for [RHEL 4](#rhel4)
* [Unloading kernel modules at the early stages of the boot](#EarlyBootStageModuleUnloading)

### Shared Initial Steps for Red Hat Enterprise Linux 5, 6, 7, 8 and 9

Kernel modules can be loaded directly, loaded as a dependency from another module, or during the boot process -- because of this, we need to take several measures to keep the module from being loaded.

* **[ step1 ]** First we unload the module from the running system if it is loaded.

  ```
  # modprobe -r module_name                                                      #step1

  ```
* **[ step2 ]** To prevent a module from being loaded directly you add the `blacklist` line to a configuration file specific to the system configuration -- for example `/etc/modprobe.d/local-dontload.conf`.

  *This alone will not prevent a module being loaded if it is a required or an optional dependency of another module. Some kernel modules will attempt to load optional modules on demand, which we mitigate in the step3.*

  ```
  # echo "blacklist module_name" >> /etc/modprobe.d/local-dontload.conf            #step2

  ```
* **[ step3 ]** The `install` line simply causes `/bin/false` to be run instead of installing a module. (The same can be achieved by using `/bin/true`.)

  The next time the loading of the module is attempted, the `/bin/false` will be executed instead. This will prevent the module from being loaded on-demand. If the excluded module is required for other specific hardware, there might be unexpected side effects.

  ```
  # echo "install module_name /bin/false" >> /etc/modprobe.d/local-dontload.conf   #step3

  ```
* **Now continue with the relevant steps for your system's version of RHEL:**

  + Finishing Steps for [RHEL 8 and RHEL 9](#rhel8andrhel9only)
  + Finishing Steps for [RHEL 7](#rhel7only)
  + Finishing Steps for [RHEL 6](#rhel6only)
  + Finishing Steps for [RHEL 5](#rhel5only)

---

### Finishing Steps for Red Hat Enterprise Linux 8 and 9 only.

* **[ step4 ]** Make a backup copy of your initramfs.

  ```
  # cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step5 ]** If the kernel module is part of the initramfs (use `lsinitrd /boot/initramfs-$(uname -r).img|grep module-name.ko` to verify), then you should rebuild your initial ramdisk image, omitting the module to be avoided (see [How to rebuild the initial ramdisk image in Red Hat Enterprise Linux](https://access.redhat.com/solutions/1958) for more information).

  ```
  # dracut --omit-drivers module_name -f

  ```

  **Optional**: To make this persistent across future kernel upgrades and initramfs rebuilds, add the driver to omit to dracut's permanent configuration:

  ```
  # MODNAME="module_name"; echo "omit_dracutmodules+=\" $MODNAME \"" >> /etc/dracut.conf.d/omit-$MODNAME.conf

  ```

  To remove the persistent configuration, delete the `/etc/dracut.conf.d/omit-module_name.conf` file and rebuild the initramfs.
* **[ step6 ]** Get the current kernel command line parameters.

  ```
  # grubby --info DEFAULT
  # grubby --info ALL (To view changes in all available kernels)

  ```
* **[ step7 ]** Append `module_name.blacklist=1 rd.driver.blacklist=module_name` at the end of the output found in #step 6. (For RHEL 8 and RHEL 9, `grubby` utility is actually the recommended method for altering these variables. Refer [How to manually modify the boot parameter in grub before the system boots](https://access.redhat.com/solutions/6668601) for more information).

  ```
  # grubby --args  "<module_name.blacklist=1 rd.driver.blacklist=module_name>" --update-kernel ALL
  # grubby --update-kernel=ALL --remove-args="<PARAMETER_TO_REMOVE>" (incase if we wish to remove the added parameters later)

  ```
* **[ step8 ]** Make a backup copy of the kdump initramfs.

  ```
  # cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step9 ]** Append `rd.driver.blacklist=module_name` to the `KDUMP_COMMANDLINE_APPEND` setting in `/etc/sysconfig/kdump`. This will cause it to be omitted from the kdump initramfs.

  ```
  # sed -i '/^KDUMP_COMMANDLINE_APPEND=/s/"$/ rd.driver.blacklist=module_name"/' /etc/sysconfig/kdump

  ```
* **[ step10 ]** Restart the kdump service to pick up the changes to kdump's initrd.

  ```
  # kdumpctl restart

  ```
* **[ step11 ]** Rebuild the kdump initial ramdisk image.

  ```
  # mkdumprd -f /boot/initramfs-$(uname -r)kdump.img

  ```
* **[ step12 ]** Reboot the system for changes to reflect.

  ```
  # reboot

  ```

---

### Finishing Steps for Red Hat Enterprise Linux 7 only

* **[ step4 ]** Make a backup copy of your initramfs.

  ```
  # cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step5 ]** If the kernel module is part of the initramfs (boot configuration), rebuild your initial ramdisk image, omitting the module to be avoided (see [How to rebuild the initial ramdisk image in Red Hat Enterprise Linux](https://access.redhat.com/solutions/1958) for more information).

  ```
  # dracut --omit-drivers module_name -f

  ```

  **Optional**: To make this persistent across future kernel upgrades and initramfs rebuilds, add the driver to omit to dracut's permanent configuration:

  ```
  # MODNAME="module_name"; echo "omit_dracutmodules+=\" $MODNAME \"" >> /etc/dracut.conf.d/omit-$MODNAME.conf

  ```

  To remove the persistent configuration, delete the `/etc/dracut.conf.d/omit-module_name.conf` file and rebuild the initramfs.
* **[ step6 ]** Append *module\_name*.blacklist to the kernel `cmdline`. We give it an invalid parameter of `blacklist` and set it to `1` as a way to preclude the kernel from loading it. Here we also set `rd.driver.blacklist` as another method of preventing it from being loaded.

  ```
  # sed -i '/^GRUB_CMDLINE_LINUX=/s/"$/ module_name.blacklist=1 rd.driver.blacklist=module_name"/' /etc/default/grub

  ```
* **[ step7 ]** Reinstall grub2 to put the kernel `cmdline` changes into effect. **If your system uses UEFI, the path must be changed to /boot/efi/EFI/redhat/grub.cfg**

  ```
  # grub2-mkconfig -o /boot/grub2/grub.cfg

  ```
* **[ step8 ]** Make a backup copy of the kdump initramfs.

  ```
  # cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step9 ]** Append `rd.driver.blacklist=module_name` to the `KDUMP_COMMANDLINE_APPEND` setting in `/etc/sysconfig/kdump`. This will cause it to be omitted from the kdump initramfs.

  ```
  # sed -i '/^KDUMP_COMMANDLINE_APPEND=/s/"$/ rd.driver.blacklist=module_name"/' /etc/sysconfig/kdump

  ```
* **[ step10 ]** Restart the kdump service to pick up the changes to kdump's initrd.

  ```
  # kdumpctl restart

  ```
* **[ step11 ]** Rebuild the kdump initial ramdisk image.

  ```
  # mkdumprd -f /boot/initramfs-$(uname -r)kdump.img

  ```
* **[ step12 ]** Reboot the system at a convenient time to have the changes take effect.

  ```
  # reboot

  ```

---

### Finishing Steps for Red Hat Enterprise Linux 6 only

* **[ step4 ]** Make a backup copy of your initramfs.

  ```
  # cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step5 ]** If the kernel module is part of the initramfs (boot configuration), rebuild your initial ramdisk image, omitting the module to be avoided (see [How to rebuild the initial ramdisk image in Red Hat Enterprise Linux](https://access.redhat.com/solutions/1958) for more information).

  ```
  # dracut --omit-drivers module_name -f

  ```

  **Optional**: To make this persistent across future kernel upgrades and initramfs rebuilds, add the driver to omit to dracut's permanent configuration:

  ```
  # MODNAME="module_name"; echo "omit_dracutmodules+=\"$MODNAME\"" >> /etc/dracut.conf

  ```

  To remove the persistent configuration, delete the `omit_dracutmodules` line from `/etc/dracut.conf` and rebuild the initramfs.
* **[ step6 ]** Append *module\_name*.blacklist to the kernel `cmdline`. We give it an invalid parameter of `blacklist` and set it to `1` as a way to preclude the kernel from loading it.

  ```
  # sed -i '/\s*kernel \/vmlinuz/s/$/ module_name.blacklist=1/' /boot/grub/grub.conf

  ```
* **[ step7 ]** Edit kdump's configuration file: mark it there as excluded from being loaded by kdump.

  ```
  # echo "blacklist module_name" >> /etc/kdump.conf

  ```
* **[ step8 ]** Restart the kdump service to pick up the changes to kdump's initrd.

  ```
  # service kdump restart

  ```
* **[ step9 ]** Reboot the system at a convenient time to have the changes take effect.

  ```
  # reboot

  ```

---

### Continued Steps for Red Hat Enterprise Linux 5 only

* **[ step4 ]** Make a backup copy of your initrd.

  ```
  # cp /boot/initrd-$(uname -r).img /boot/initrd-$(uname -r).img.$(date +%m-%d-%H%M%S).bak

  ```
* **[ step5 ]** If the kernel module is part of the initrd (boot configuration), rebuild your initial ramdisk image. Use the `--builtin=module_name` flag to `mkinitrd` to have it skip the module in question.

  ```
  # mkinitrd -v --builtin=module_name

  ```
* **[ step6 ]** Append *module\_name*.blacklist to the kernel `cmdline`. We give it an invalid parameter of `blacklist` and set it to `1` as a way to preclude the kernel from loading it.

  ```
  # sed -i '/\s*kernel \/vmlinuz/s/$/ module_name.blacklist=1/' /boot/grub/grub.conf

  ```
* **[ step7 ]** Reboot the system at a convenient time to have the changes take effect.

  ```
  # reboot

  ```

Kernel modules can be loaded directly, loaded as a dependency from another module, or during the boot process -- because of this, we need to take several measures to keep the module from being loaded.

---

### Red Hat Enterprise Linux 4

* Add the following line to `/etc/modprobe.conf`:

  ```
  alias <module name> off

  ```
* If the kernel module is part of the initrd (boot configuration), the initrd should be regenerated. Boot the affected kernel and run the following command to regenerate the affected kernel initrd.

  ```
  # mkinitrd /boot/initrd-$(uname -r).img $(uname -r)

  ```

### Remove Module Temporarily

* It is possible to remove any currently-loaded module by running:

  ```
  # modprobe -r <module name>

  ```

Various reasons can prevent unloading of the module.

* If a running process uses the module, then terminate the process before unloading the module.
* If a second module uses the module we try to unload, then the second module needs to be unloaded first.

### Loading Modules

The procedure for loading modules is available in the product documentation at:

* [Red Hat Enterprise Linux 8 Managing, monitoring and updating the kernel: Chapter 3. Managing kernel modules](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/managing-kernel-modules_managing-monitoring-and-updating-the-kernel#preventing-kernel-modules-from-being-automatically-loaded-at-system-boot-time_managing-kernel-modules)
* [Red Hat Enterprise Linux 6 Deployment Guide : Persistent Module Loading](http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sec-Persistent_Module_Loading.html)
* [Red Hat Enterprise Linux 5 Deployment Guide : Persistent Module Loading](http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-kernel-modules-persistant.html)
* [Red Hat Enterprise Linux 4 Reference Guide : Persistent Module Loading](http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/4/html/Reference_Guide/s1-kernel-modules-persistant.html)

### Unloading kernel modules at the early stages of the boot

If the server is getting crashed/panicked on boot due to 3rd party module then it can be unloaded in the early stage of the boot process using the below steps:

**[ step1 ]** Reboot the server and wait until the GRUB menu appears, now press any key to interrupt the default timeout value. Select the kernel to boot into using the up/down key and once selected, press the `e` key.

**[ step2 ]** Scroll to the line starting with:

- `linux16` or `linuxefi` (on UEFI systems) if RHEL 7

- `linux` if RHEL 8 or RHEL 9

**[ step3 ]** Append the following to that line:

```
module_blacklist=<module_name>

```

* Where the `<module_name>` is the name of the module that is causing the issue here. For example, if “abc” module is causing the issue then the parameter will be:

```
module_blacklist=abc

```

* Multiple modules can be specified as a comma-separated list.

**[ step4 ]** Press CTRL+x to accept the changes and to boot the system with the temporary kernel parameter changes.

**[ step5 ]** Once the system gets booted successfully disable the module permanently using the above mentioned steps for the respective RHEL version and engage the respective module vendor for further investigation.

* Note: The kernel parameter `module_blacklist` is only available from RHEL 7.3 and above.

* **Product(s)**
* [Red Hat Enterprise Linux](https://access.redhat.com/search?q=Red+Hat+Enterprise+Linux&documentKind=Article%26Solution)

* **Component**
* [kernel](https://access.redhat.com/search?q=kernel&documentKind=Article%26Solution)
* [module-init-tools](https://access.redhat.com/search?q=module-init-tools&documentKind=Article%26Solution)

* **Category**
* [Learn more](https://access.redhat.com/search?q=Learn+more&documentKind=Article%26Solution)

* **Tags**
* [kernel](https://access.redhat.com/search?q=kernel&documentKind=Article%26Solution)
* [module](https://access.redhat.com/search?q=module&documentKind=Article%26Solution)
* [rhel\_4](https://access.redhat.com/search?q=rhel_4&documentKind=Article%26Solution)
* [rhel\_5](https://access.redhat.com/search?q=rhel_5&documentKind=Article%26Solution)
* [rhel\_6](https://access.redhat.com/search?q=rhel_6&documentKind=Article%26Solution)
* [rhel\_7](https://access.redhat.com/search?q=rhel_7&documentKind=Article%26Solution)
* [rhel\_8](https://access.redhat.com/search?q=rhel_8&documentKind=Article%26Solution)
* [rhel\_9](https://access.redhat.com/search?q=rhel_9&documentKind=Article%26Solution)

This solution is part of Red Hat’s fast-track publication program, providing a huge library of solutions that Red Hat engineers have created while supporting our customers. To give you the knowledge you need the instant it becomes available, these articles may be presented in a raw and unedited form.

## Comments

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close

×
#### Request a English Translation

Are you sure you want to update a translation?
It seems an existing [English Translation](%40url) exists already.
We appreciate your interest in having Red Hat content localized to your language. Please note that excessive use of this feature could cause delays in getting specific content you are interested in translated.
Close
 [Request Japanese Translation](/solutions/41278?rate=e0p-EdmPX3WhmM_OBUJEb-CZkfVENZY5Hl5TUhIdFmI "Request Japanese Translation") [Request Chinese Translation](/solutions/41278?rate=5awcwgg48_5v3Ob5-0Oibhz7reqa6EwBFgW_5otupoI "Request Chinese Translation") [Request Korean Translation](/solutions/41278?rate=0UulgS-2S-A_4g_22reVnO2wW6AjvVu5QMd9bwEqfSk "Request Korean Translation")

×
#### Generating Machine Translation

Loading…
We are generating a machine translation for this content. Depending on the length of the content, this process could take a while.

Cancel



=== Content from git.kernel.org_6560c543_20250115_124445.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiri Kosina <jkosina@suse.cz> | 2016-02-01 11:19:17 +0100 |
| --- | --- | --- |
| committer | Jiri Kosina <jkosina@suse.cz> | 2016-02-01 11:19:17 +0100 |
| commit | [a0c80efe5956ccce9fe7ae5c78542578c07bc20a](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)) | |
| tree | [a712e934052d1d0d017f95c8ac249756284100a8](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a) | |
| parent | [aa0818c6ee8d8e4772725a43550823347bc1ad30](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=aa0818c6ee8d8e4772725a43550823347bc1ad30) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a&id2=aa0818c6ee8d8e4772725a43550823347bc1ad30)) | |
| download | [linux-a0c80efe5956ccce9fe7ae5c78542578c07bc20a.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a0c80efe5956ccce9fe7ae5c78542578c07bc20a.tar.gz) | |

floppy: fix lock\_fdc() signal handlingfloppy\_revalidate() doesn't perform any error handling on lock\_fdc()
result. lock\_fdc() might actually be interrupted by a signal (it waits for
fdc becoming non-busy interruptibly). In such case, floppy\_revalidate()
proceeds as if it had claimed the lock, but it fact it doesn't.
In case of multiple threads trying to open("/dev/fdX"), this leads to
serious corruptions all over the place, because all of a sudden there is
no critical section protection (that'd otherwise be guaranteed by locked
fd) whatsoever.
While at this, fix the fact that the 'interruptible' parameter to
lock\_fdc() doesn't make any sense whatsoever, because we always wait
interruptibly anyway.
Most of the lock\_fdc() callsites do properly handle error (and propagate
EINTR), but floppy\_revalidate() and floppy\_check\_events() don't. Fix this.
Spotted by 'syzkaller' tool.
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Tested-by: Dmitry Vyukov <dvyukov@google.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)

| -rw-r--r-- | [drivers/block/floppy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/block/floppy.c?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a) | 33 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 18 insertions, 15 deletions

| diff --git a/drivers/block/floppy.c b/drivers/block/floppy.cindex fa9bb742df6e0b..c1aacca88c8f62 100644--- a/[drivers/block/floppy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/floppy.c?id=aa0818c6ee8d8e4772725a43550823347bc1ad30)+++ b/[drivers/block/floppy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/floppy.c?id=a0c80efe5956ccce9fe7ae5c78542578c07bc20a)@@ -866,7 +866,7 @@ static void set\_fdc(int drive) }  /\* locks the driver \*/-static int lock\_fdc(int drive, bool interruptible)+static int lock\_fdc(int drive) { if (WARN(atomic\_read(&usage\_count) == 0, "Trying to lock fdc while usage count=0\n"))@@ -2173,7 +2173,7 @@ static int do\_format(int drive, struct format\_descr \*tmp\_format\_req) { int ret; - if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR;  set\_floppy(drive);@@ -2960,7 +2960,7 @@ static int user\_reset\_fdc(int drive, int arg, bool interruptible) { int ret; - if (lock\_fdc(drive, interruptible))+ if (lock\_fdc(drive)) return -EINTR;  if (arg == FD\_RESET\_ALWAYS)@@ -3243,7 +3243,7 @@ static int set\_geometry(unsigned int cmd, struct floppy\_struct \*g, if (!capable(CAP\_SYS\_ADMIN)) return -EPERM; mutex\_lock(&open\_lock);- if (lock\_fdc(drive, true)) {+ if (lock\_fdc(drive)) { mutex\_unlock(&open\_lock); return -EINTR; }@@ -3263,7 +3263,7 @@ static int set\_geometry(unsigned int cmd, struct floppy\_struct \*g, } else { int oldStretch; - if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; if (cmd != FDDEFPRM) { /\* notice a disk change immediately, else@@ -3349,7 +3349,7 @@ static int get\_floppy\_geometry(int drive, int type, struct floppy\_struct \*\*g) if (type) \*g = &floppy\_type[type]; else {- if (lock\_fdc(drive, false))+ if (lock\_fdc(drive)) return -EINTR; if (poll\_drive(false, 0) == -EINTR) return -EINTR;@@ -3433,7 +3433,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int if (UDRS->fd\_ref != 1) /\* somebody else has this drive open \*/ return -EBUSY;- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR;  /\* do the actual eject. Fails on@@ -3445,7 +3445,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int process\_fd\_request(); return ret; case FDCLRPRM:- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; current\_type[drive] = NULL; floppy\_sizes[drive] = MAX\_DISK\_SIZE << 1;@@ -3467,7 +3467,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int UDP->flags &= ~FTD\_MSG; return 0; case FDFMTBEG:- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; if (poll\_drive(true, FD\_RAW\_NEED\_DISK) == -EINTR) return -EINTR;@@ -3484,7 +3484,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int return do\_format(drive, &inparam.f); case FDFMTEND: case FDFLUSH:- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; return invalidate\_drive(bdev); case FDSETEMSGTRESH:@@ -3507,7 +3507,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int outparam = UDP; break; case FDPOLLDRVSTAT:- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; if (poll\_drive(true, FD\_RAW\_NEED\_DISK) == -EINTR) return -EINTR;@@ -3530,7 +3530,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int case FDRAWCMD: if (type) return -EINVAL;- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; set\_floppy(drive); i = raw\_cmd\_ioctl(cmd, (void \_\_user \*)param);@@ -3539,7 +3539,7 @@ static int fd\_locked\_ioctl(struct block\_device \*bdev, fmode\_t mode, unsigned int process\_fd\_request(); return i; case FDTWADDLE:- if (lock\_fdc(drive, true))+ if (lock\_fdc(drive)) return -EINTR; twaddle(); process\_fd\_request();@@ -3747,7 +3747,8 @@ static unsigned int floppy\_check\_events(struct gendisk \*disk, return DISK\_EVENT\_MEDIA\_CHANGE;  if (time\_after(jiffies, UDRS->last\_checked + UDP->checkfreq)) {- lock\_fdc(drive, false);+ if (lock\_fdc(drive))+ return -EINTR; poll\_drive(false, 0); process\_fd\_request(); }@@ -3845,7 +3846,9 @@ static int floppy\_revalidate(struct gendisk \*disk) "VFS: revalidate called on non-open device.\n")) return -EFAULT; - lock\_fdc(drive, false);+ res = lock\_fdc(drive);+ if (res)+ return res; cf = (test\_bit(FD\_DISK\_CHANGED\_BIT, &UDRS->flags) || test\_bit(FD\_VERIFY\_BIT, &UDRS->flags)); if (!(cf || test\_bit(drive, &fake\_change) || drive\_no\_geom(drive))) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 12:43:22 +0000



=== Content from access.redhat.com_85b7ee37_20250115_195740.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


