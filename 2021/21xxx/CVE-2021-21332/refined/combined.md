=== Content from github.com_0eeea58a_20250114_184802.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.27.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.27.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse/tree/v1.27.0)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse/tree/v1.27.0)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

1. [Releases](/matrix-org/synapse/releases)
2. [v1.27.0](/matrix-org/synapse/releases/tag/v1.27.0)

# v1.27.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/synapse/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.27.0)

 Loading

[View all tags](/matrix-org/synapse/tags)

![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)
[erikjohnston](/erikjohnston)
released this
16 Feb 13:30

·
[5126 commits](/matrix-org/synapse/compare/v1.27.0...develop)
to develop
since this release

[v1.27.0](/matrix-org/synapse/tree/v1.27.0)

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/8428120?s=64&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
Erik Johnston

GPG key ID: A542E4ED1B0FAC09

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`6600f0b`](/matrix-org/synapse/commit/6600f0bd572500f9b85bfeed424eff0300e2fa59)

# Synapse 1.27.0 (2021-02-16)

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](/matrix-org/synapse/blob/v1.27.0/UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](/matrix-org/synapse/blob/v1.27.0/UPGRADE.rst) for more details on these changes.

## Bugfixes

* Fix building Docker images for armv7. ([#9405](https://github.com/matrix-org/synapse/issues/9405))

# Synapse 1.27.0rc2 (2021-02-11)

## Features

* Further improvements to the user experience of registration via single sign-on. ([#9297](https://github.com/matrix-org/synapse/issues/9297))

## Bugfixes

* Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([#9302](https://github.com/matrix-org/synapse/issues/9302))
* Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([#9313](https://github.com/matrix-org/synapse/issues/9313))

## Improved Documentation

* Clarify the sample configuration for changes made to the template loading code. ([#9310](https://github.com/matrix-org/synapse/issues/9310))

# Synapse 1.27.0rc1 (2021-02-02)

## Features

* Add an admin API for getting and deleting forward extremities for a room. ([#9062](https://github.com/matrix-org/synapse/issues/9062))
* Add an admin API for retrieving the current room state of a room. ([#9168](https://github.com/matrix-org/synapse/issues/9168))
* Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858](https://github.com/matrix-org/matrix-doc/pull/2858)). ([#9183](https://github.com/matrix-org/synapse/issues/9183), [#9242](https://github.com/matrix-org/synapse/issues/9242))
* Add an admin API endpoint for shadow-banning users. ([#9209](https://github.com/matrix-org/synapse/issues/9209))
* Add ratelimits to the 3PID `/requestToken` APIs. ([#9238](https://github.com/matrix-org/synapse/issues/9238))
* Add support to the OpenID Connect integration for adding the user's email address. ([#9245](https://github.com/matrix-org/synapse/issues/9245))
* Add ratelimits to invites in rooms and to specific users. ([#9258](https://github.com/matrix-org/synapse/issues/9258))
* Improve the user experience of setting up an account via single-sign on. ([#9262](https://github.com/matrix-org/synapse/issues/9262), [#9272](https://github.com/matrix-org/synapse/issues/9272), [#9275](https://github.com/matrix-org/synapse/issues/9275), [#9276](https://github.com/matrix-org/synapse/issues/9276), [#9277](https://github.com/matrix-org/synapse/issues/9277), [#9286](https://github.com/matrix-org/synapse/issues/9286), [#9287](https://github.com/matrix-org/synapse/issues/9287))
* Add phone home stats for encrypted messages. ([#9283](https://github.com/matrix-org/synapse/issues/9283))
* Update the redirect URI for OIDC authentication. ([#9288](https://github.com/matrix-org/synapse/issues/9288))

## Bugfixes

* Fix spurious errors in logs when deleting a non-existant pusher. ([#9121](https://github.com/matrix-org/synapse/issues/9121))
* Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([#9163](https://github.com/matrix-org/synapse/issues/9163))
* Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([#9164](https://github.com/matrix-org/synapse/issues/9164))
* Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([#9165](https://github.com/matrix-org/synapse/issues/9165))
* Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([#9218](https://github.com/matrix-org/synapse/issues/9218))
* Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([#9229](https://github.com/matrix-org/synapse/issues/9229))
* Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([#9235](https://github.com/matrix-org/synapse/issues/9235))
* Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([#9265](https://github.com/matrix-org/synapse/issues/9265))
* Fix single-sign-on when the endpoints are routed to synapse workers. ([#9271](https://github.com/matrix-org/synapse/issues/9271))

## Improved Documentation

* Add docs for using Gitea as OpenID provider. ([#9134](https://github.com/matrix-org/synapse/issues/9134))
* Add link to Matrix VoIP tester for turn-howto. ([#9135](https://github.com/matrix-org/synapse/issues/9135))
* Add notes on integrating with Facebook for SSO login. ([#9244](https://github.com/matrix-org/synapse/issues/9244))

## Deprecations and Removals

* The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([#9199](https://github.com/matrix-org/synapse/issues/9199))
* Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([#9289](https://github.com/matrix-org/synapse/issues/9289))

## Internal Changes

* Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([#9045](https://github.com/matrix-org/synapse/issues/9045))
* Various improvements to the federation client. ([#9129](https://github.com/matrix-org/synapse/issues/9129))
* Speed up chain cover calculation when persisting a batch of state events at once. ([#9176](https://github.com/matrix-org/synapse/issues/9176))
* Add a `long_description_type` to the package metadata. ([#9180](https://github.com/matrix-org/synapse/issues/9180))
* Speed up batch insertion when using PostgreSQL. ([#9181](https://github.com/matrix-org/synapse/issues/9181), [#9188](https://github.com/matrix-org/synapse/issues/9188))
* Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([#9184](https://github.com/matrix-org/synapse/issues/9184))
* Improve performance of concurrent use of `StreamIDGenerators`. ([#9190](https://github.com/matrix-org/synapse/issues/9190))
* Add some missing source directories to the automatic linting script. ([#9191](https://github.com/matrix-org/synapse/issues/9191))
* Precompute joined hosts and store in Redis. ([#9198](https://github.com/matrix-org/synapse/issues/9198), [#9227](https://github.com/matrix-org/synapse/issues/9227))
* Clean-up template loading code. ([#9200](https://github.com/matrix-org/synapse/issues/9200))
* Fix the Python 3.5 old dependencies build. ([#9217](https://github.com/matrix-org/synapse/issues/9217))
* Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([#9222](https://github.com/matrix-org/synapse/issues/9222))
* Add type hints to handlers code. ([#9223](https://github.com/matrix-org/synapse/issues/9223), [#9232](https://github.com/matrix-org/synapse/issues/9232))
* Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([#9254](https://github.com/matrix-org/synapse/issues/9254))
* Minor performance improvement during TLS handshake. ([#9255](https://github.com/matrix-org/synapse/issues/9255))
* Refactor the generation of summary text for email notifications. ([#9260](https://github.com/matrix-org/synapse/issues/9260))
* Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([#9270](https://github.com/matrix-org/synapse/issues/9270))

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_47029444_20250114_184802.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-246w-56m2-5899)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-246w-56m2-5899)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Cross-site scripting (XSS) vulnerability in the password reset endpoint

Moderate

[clokep](/clokep)
published
GHSA-246w-56m2-5899
Mar 25, 2021

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.27.0

## Patched versions

>= 1.27.0

## Description

### Impact

The password reset endpoint served via Synapse was vulnerable to cross-site scripting (XSS) attacks. The impact depends on the configuration of the domain that Synapse is deployed on, but may allow access to cookies and other browser data, CSRF vulnerabilities, and access to other resources served on the same domain or parent domains.

### Patches

This is fixed in [#9200](https://github.com/matrix-org/synapse/pull/9200).

### Workarounds

Depending on the needs and configuration of the homeserver a few options are available:

1. Password resets can be disabled by delegating email to a third-party service (via the `account_threepid_delegates.email` setting) or disabling email (by not configuring the `email` setting).
2. If the homeserver is not configured to use passwords (via the `password_config.enabled` setting) then the affected endpoint can be blocked at a reverse proxy:

   * `/_synapse/client/password_reset/email/submit_token`
3. The `password_reset_confirmation.html` template can be overridden with a custom template that manually escapes the variables using [JInja2's `escape` filter](https://jinja.palletsprojects.com/en/2.11.x/templates/#escape). See the `email.template_dir` setting.

### Severity

Moderate

### CVE ID

CVE-2021-21332

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4c7ae838_20250114_184801.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9200)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9200)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Clean-up the template loading code #9200

 Merged

[clokep](/clokep)
merged 8 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/template-clean-up](/matrix-org/synapse/tree/clokep/template-clean-up "matrix-org/synapse:clokep/template-clean-up")

Jan 27, 2021

 Merged

# [Clean-up the template loading code](#top) #9200

[clokep](/clokep)
merged 8 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/template-clean-up](/matrix-org/synapse/tree/clokep/template-clean-up "matrix-org/synapse:clokep/template-clean-up")

Jan 27, 2021

[Conversation
7](/matrix-org/synapse/pull/9200)
[Commits
8](/matrix-org/synapse/pull/9200/commits)
[Checks
0](/matrix-org/synapse/pull/9200/checks)
[Files changed](/matrix-org/synapse/pull/9200/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Jan 21, 2021](#issue-791445621)

This attempts to clean-up some of the template loading code a bit:

* Enables auto-escape by default for HTML files (this was originally done in [Use the default templates when a custom template file cannot be found #8037](https://github.com/matrix-org/synapse/pull/8037), but partially disabled in [Hotfix: disable autoescape by default when rendering Jinja2 templates #8394](https://github.com/matrix-org/synapse/pull/8394)).
* Adds a new `read_template` method for reading a single template.
* Some logic clean-up.

A few things to look out for here:

* Does the SSO redirect issue still exist from [Hotfix: disable autoescape by default when rendering Jinja2 templates #8394](https://github.com/matrix-org/synapse/pull/8394)? I don't know how to reproduce this, maybe [@anoadragon453](https://github.com/anoadragon453) remembers.
* Do we need to call this out in the upgrade notes?

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 6 commits
[January 21, 2021 14:46](#commits-pushed-4364d60)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Enable autoescape for email templates.](/matrix-org/synapse/pull/9200/commits/4364d6069996191de7dfc71d6cb1ef6548596fd4 "Enable autoescape for email templates.")`

`[4364d60](/matrix-org/synapse/pull/9200/commits/4364d6069996191de7dfc71d6cb1ef6548596fd4)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Enable autoescape for SSO templates.](/matrix-org/synapse/pull/9200/commits/ca6e3b1d051e1c0078a58cd71c81c0512a980912 "Enable autoescape for SSO templates.")`

`[ca6e3b1](/matrix-org/synapse/pull/9200/commits/ca6e3b1d051e1c0078a58cd71c81c0512a980912)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Remove unused parameter.](/matrix-org/synapse/pull/9200/commits/6899434df00a3813a5820ba8c0c4fc90dfad76e4 "Remove unused parameter.")`

`[6899434](/matrix-org/synapse/pull/9200/commits/6899434df00a3813a5820ba8c0c4fc90dfad76e4)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Support loading a single template with a simpler method signature.](/matrix-org/synapse/pull/9200/commits/31620d2bddba55ce6e4cb2b11ffe5809d09571a6 "Support loading a single template with a simpler method signature.")`

`[31620d2](/matrix-org/synapse/pull/9200/commits/31620d2bddba55ce6e4cb2b11ffe5809d09571a6)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Simplify some logic.](/matrix-org/synapse/pull/9200/commits/86335912b15f3d82c6912a65c889cc1d9415d182 "Simplify some logic.")`

`[8633591](/matrix-org/synapse/pull/9200/commits/86335912b15f3d82c6912a65c889cc1d9415d182)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Newsfragment](/matrix-org/synapse/pull/9200/commits/0508a3aa051407ce425bf44c4b427d661a13255e "Newsfragment")`

`[0508a3a](/matrix-org/synapse/pull/9200/commits/0508a3aa051407ce425bf44c4b427d661a13255e)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[January 22, 2021 12:32](#event-4238337613)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Jan 22, 2021](#issuecomment-765619906)

| Following-up on a conversation from #synapse-dev:matrix.org from earlier today -- both of the redirect URLs for SSO were already being manually escaped, so turning on autoescape shouldn't change anything here. It is also possible that [#9128](https://github.com/matrix-org/synapse/pull/9128) would help with whatever problem we had been seeing.  I'll double check with some of the SSO setups though to ensure that nothing seems amiss. |
| --- |

All reactions

Sorry, something went wrong.

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
reviewed
[Jan 25, 2021](#pullrequestreview-575321717)

 [View reviewed changes](/matrix-org/synapse/pull/9200/files/0508a3aa051407ce425bf44c4b427d661a13255e)

Copy link

Member

### @erikjohnston **[erikjohnston](/erikjohnston)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think the code looks fine, I don't know the answers to the questions posed in the PR description though

Sorry, something went wrong.

All reactions

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Jan 25, 2021](#issuecomment-767038382)

| I'll double check with some of the SSO setups though to ensure that nothing seems amiss.  I did some testing here and the redirect flows for both login and UIAuth were still working fine with this branch. |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Jan 25, 2021](#issuecomment-767038851)

| I think the code looks fine, I don't know the answers to the questions posed in the PR description though  I think the first question is answered, for the second one, I suspect we should probably mention something about it. |
| --- |

All reactions

Sorry, something went wrong.

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[January 26, 2021 12:33](#event-4250454546)

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=80&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)

Copy link

Member

### **[dkasak](/dkasak)** commented [Jan 27, 2021](#issuecomment-768187829) • edited Loading

| We should definitely mention something so that people know what's up if it breaks their stuff, IMO.  Also, LGTM. |
| --- |

 👍
1
 clokep reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add upgrade notes.](/matrix-org/synapse/pull/9200/commits/b4af9578a780f0f2ef85f60b4a7418d6b1f6af36 "Add upgrade notes.")`

`[b4af957](/matrix-org/synapse/pull/9200/commits/b4af9578a780f0f2ef85f60b4a7418d6b1f6af36)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Jan 27, 2021](#issuecomment-768284608)

| I added a note about this to the upgrade docs. |
| --- |

All reactions

Sorry, something went wrong.

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Jan 27, 2021](#pullrequestreview-577335539)

 [View reviewed changes](/matrix-org/synapse/pull/9200/files/b4af9578a780f0f2ef85f60b4a7418d6b1f6af36)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=80&u=bc841c19ba33f4e3b66732ec1ebf9f3c8cd64b8e&v=4)](/erikjohnston)

Copy link

Member

### **[erikjohnston](/erikjohnston)** commented [Jan 27, 2021](#issuecomment-768287194)

| [@clokep](https://github.com/clokep) looks like you need to merge in develop? |
| --- |

 👍
1
 clokep reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/template-cl…](/matrix-org/synapse/pull/9200/commits/ba7f48a37848dcec60e99bc23ecd5e16137d2b45 "Merge remote-tracking branch 'origin/develop' into clokep/template-clean-up")`
 …

`[ba7f48a](/matrix-org/synapse/pull/9200/commits/ba7f48a37848dcec60e99bc23ecd5e16137d2b45)`

```
…ean-up
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`e54746b`](/matrix-org/synapse/commit/e54746bdf7d5c831eabe4dcea76a7626f1de73df)
into
develop

[Jan 27, 2021](https://github.com/matrix-org/synapse/pull/9200#event-4256643959)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/template-clean-up

branch
[January 27, 2021 15:59](#event-4256644067)

This was referenced Feb 1, 2021

[Improve styling and wording of SSO redirect confirm template
#9272](/matrix-org/synapse/pull/9272)
 Merged

[Replace username picker with a template
#9275](/matrix-org/synapse/pull/9275)
 Merged

[Clarify documentation about escaping URLs in templates.
#9310](/matrix-org/synapse/pull/9310)
 Merged

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Mar 6, 2021](#ref-commit-31d3054)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.28.0](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2 "Update chat/matrix-synapse to 1.28.0

Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474](https://github.com/matrix-org/synapse/issues/9474))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405](https://github.com/matrix-org/synapse/issues/9405))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297](https://github.com/matrix-org/synapse/issues/9297))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302](https://github.com/matrix-org/synapse/issues/9302))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313](https://github.com/matrix-org/synapse/issues/9313))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310](https://github.com/matrix-org/synapse/issues/9310))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062](https://github.com/matrix-org/synapse/issues/9062))
- Add an admin API for retrieving the current room state of a room. ([\#9168](https://github.com/matrix-org/synapse/issues/9168))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858](https://github.com/matrix-org/matrix-doc/pull/2858)). ([\#9183](https://github.com/matrix-org/synapse/issues/9183), [\#9242](https://github.com/matrix-org/synapse/issues/9242))
- Add an admin API endpoint for shadow-banning users. ([\#9209](https://github.com/matrix-org/synapse/issues/9209))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238](https://github.com/matrix-org/synapse/issues/9238))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245](https://github.com/matrix-org/synapse/issues/9245))
- Add ratelimits to invites in rooms and to specific users. ([\#9258](https://github.com/matrix-org/synapse/issues/9258))
- Improve the user experience of setting up an account via single-sign on. ([\#9262](https://github.com/matrix-org/synapse/issues/9262), [\#9272](https://github.com/matrix-org/synapse/issues/9272), [\#9275](https://github.com/matrix-org/synapse/issues/9275), [\#9276](https://github.com/matrix-org/synapse/issues/9276), [\#9277](https://github.com/matrix-org/synapse/issues/9277), [\#9286](https://github.com/matrix-org/synapse/issues/9286), [\#9287](https://github.com/matrix-org/synapse/issues/9287))
- Add phone home stats for encrypted messages. ([\#9283](https://github.com/matrix-org/synapse/issues/9283))
- Update the redirect URI for OIDC authentication. ([\#9288](https://github.com/matrix-org/synapse/issues/9288))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121](https://github.com/matrix-org/synapse/issues/9121))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163](https://github.com/matrix-org/synapse/issues/9163))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164](https://github.com/matrix-org/synapse/issues/9164))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165](https://github.com/matrix-org/synapse/issues/9165))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218](https://github.com/matrix-org/synapse/issues/9218))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229](https://github.com/matrix-org/synapse/issues/9229))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235](https://github.com/matrix-org/synapse/issues/9235))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265](https://github.com/matrix-org/synapse/issues/9265))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271](https://github.com/matrix-org/synapse/issues/9271))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134](https://github.com/matrix-org/synapse/issues/9134))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135](https://github.com/matrix-org/synapse/issues/9135))
- Add notes on integrating with Facebook for SSO login. ([\#9244](https://github.com/matrix-org/synapse/issues/9244))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199](https://github.com/matrix-org/synapse/issues/9199))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289](https://github.com/matrix-org/synapse/issues/9289))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045](https://github.com/matrix-org/synapse/issues/9045))
- Various improvements to the federation client. ([\#9129](https://github.com/matrix-org/synapse/issues/9129))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176](https://github.com/matrix-org/synapse/issues/9176))
- Add a `long_description_type` to the package metadata. ([\#9180](https://github.com/matrix-org/synapse/issues/9180))
- Speed up batch insertion when using PostgreSQL. ([\#9181](https://github.com/matrix-org/synapse/issues/9181), [\#9188](https://github.com/matrix-org/synapse/issues/9188))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184](https://github.com/matrix-org/synapse/issues/9184))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190](https://github.com/matrix-org/synapse/issues/9190))
- Add some missing source directories to the automatic linting script. ([\#9191](https://github.com/matrix-org/synapse/issues/9191))
- Precompute joined hosts and store in Redis. ([\#9198](https://github.com/matrix-org/synapse/issues/9198), [\#9227](https://github.com/matrix-org/synapse/issues/9227))
- Clean-up template loading code. ([\#9200](https://github.com/matrix-org/synapse/issues/9200))
- Fix the Python 3.5 old dependencies build. ([\#9217](https://github.com/matrix-org/synapse/issues/9217))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222](https://github.com/matrix-org/synapse/issues/9222))
- Add type hints to handlers code. ([\#9223](https://github.com/matrix-org/synapse/issues/9223), [\#9232](https://github.com/matrix-org/synapse/issues/9232))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254](https://github.com/matrix-org/synapse/issues/9254))
- Minor performance improvement during TLS handshake. ([\#9255](https://github.com/matrix-org/synapse/issues/9255))
- Refactor the generation of summary text for email notifications. ([\#9260](https://github.com/matrix-org/synapse/issues/9260))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270](https://github.com/matrix-org/synapse/issues/9270))")`
…

`[31d3054](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2)`

```
Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474]([matrix-org/synapse#9474](https://github.com/matrix-org/synapse/pull/9474)))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150]([matrix-org/synapse#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\#9300]([matrix-org/synapse#9300](https://github.com/matrix-org/synapse/pull/9300)), [\#9301]([matrix-org/synapse#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311]([matrix-org/synapse#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376]([matrix-org/synapse#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\#9400]([matrix-org/synapse#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257]([matrix-org/synapse#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\#9296]([matrix-org/synapse#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\#9321]([matrix-org/synapse#9321](https://github.com/matrix-org/synapse/pull/9321)), [\#9393]([matrix-org/synapse#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\#9333]([matrix-org/synapse#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361]([matrix-org/synapse#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391]([matrix-org/synapse#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\#9395]([matrix-org/synapse#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421]([matrix-org/synapse#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425]([matrix-org/synapse#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426]([matrix-org/synapse#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\#9428]([matrix-org/synapse#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433]([matrix-org/synapse#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281]([matrix-org/synapse#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291]([matrix-org/synapse#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\#9308]([matrix-org/synapse#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317]([matrix-org/synapse#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\#9322]([matrix-org/synapse#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390]([matrix-org/synapse#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\#9404]([matrix-org/synapse#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\#9407]([matrix-org/synapse#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434]([matrix-org/synapse#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429]([matrix-org/synapse#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003]([matrix-org/synapse#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\#9123]([matrix-org/synapse#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\#9240]([matrix-org/synapse#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299]([matrix-org/synapse#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\#9305]([matrix-org/synapse#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\#9307]([matrix-org/synapse#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326]([matrix-org/synapse#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362]([matrix-org/synapse#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\#9377]([matrix-org/synapse#9377](https://github.com/matrix-org/synapse/pull/9377)), [\#9396]([matrix-org/synapse#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\#9381]([matrix-org/synapse#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\#9384]([matrix-org/synapse#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\#9394]([matrix-org/synapse#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\#9408]([matrix-org/synapse#9408](https://github.com/matrix-org/synapse/pull/9408)))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405]([matrix-org/synapse#9405](https://github.com/matrix-org/synapse/pull/9405)))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297]([matrix-org/synapse#9297](https://github.com/matrix-org/synapse/pull/9297)))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302]([matrix-org/synapse#9302](https://github.com/matrix-org/synapse/pull/9302)))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313]([matrix-org/synapse#9313](https://github.com/matrix-org/synapse/pull/9313)))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310]([matrix-org/synapse#9310](https://github.com/matrix-org/synapse/pull/9310)))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062]([matrix-org/synapse#9062](https://github.com/matrix-org/synapse/pull/9062)))
- Add an admin API for retrieving the current room state of a room. ([\#9168]([matrix-org/synapse#9168](https://github.com/matrix-org/synapse/pull/9168)))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858]([matrix-org/matrix-spec-proposals#2858](https://github.com/matrix-org/matrix-spec-proposals/pull/2858))). ([\#9183]([matrix-org/synapse#9183](https://github.com/matrix-org/synapse/pull/9183)), [\#9242]([matrix-org/synapse#9242](https://github.com/matrix-org/synapse/pull/9242)))
- Add an admin API endpoint for shadow-banning users. ([\#9209]([matrix-org/synapse#9209](https://github.com/matrix-org/synapse/pull/9209)))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238]([matrix-org/synapse#9238](https://github.com/matrix-org/synapse/pull/9238)))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245]([matrix-org/synapse#9245](https://github.com/matrix-org/synapse/pull/9245)))
- Add ratelimits to invites in rooms and to specific users. ([\#9258]([matrix-org/synapse#9258](https://github.com/matrix-org/synapse/pull/9258)))
- Improve the user experience of setting up an account via single-sign on. ([\#9262]([matrix-org/synapse#9262](https://github.com/matrix-org/synapse/pull/9262)), [\#9272]([matrix-org/synapse#9272](https://github.com/matrix-org/synapse/pull/9272)), [\#9275]([matrix-org/synapse#9275](https://github.com/matrix-org/synapse/pull/9275)), [\#9276]([matrix-org/synapse#9276](https://github.com/matrix-org/synapse/pull/9276)), [\#9277]([matrix-org/synapse#9277](https://github.com/matrix-org/synapse/pull/9277)), [\#9286]([matrix-org/synapse#9286](https://github.com/matrix-org/synapse/pull/9286)), [\#9287]([matrix-org/synapse#9287](https://github.com/matrix-org/synapse/pull/9287)))
- Add phone home stats for encrypted messages. ([\#9283]([matrix-org/synapse#9283](https://github.com/matrix-org/synapse/pull/9283)))
- Update the redirect URI for OIDC authentication. ([\#9288]([matrix-org/synapse#9288](https://github.com/matrix-org/synapse/pull/9288)))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121]([matrix-org/synapse#9121](https://github.com/matrix-org/synapse/pull/9121)))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163]([matrix-org/synapse#9163](https://github.com/matrix-org/synapse/pull/9163)))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164]([matrix-org/synapse#9164](https://github.com/matrix-org/synapse/pull/9164)))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165]([matrix-org/synapse#9165](https://github.com/matrix-org/synapse/pull/9165)))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218]([matrix-org/synapse#9218](https://github.com/matrix-org/synapse/pull/9218)))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229]([matrix-org/synapse#9229](https://github.com/matrix-org/synapse/pull/9229)))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235]([matrix-org/synapse#9235](https://github.com/matrix-org/synapse/pull/9235)))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265]([matrix-org/synapse#9265](https://github.com/matrix-org/synapse/pull/9265)))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271]([matrix-org/synapse#9271](https://github.com/matrix-org/synapse/pull/9271)))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134]([matrix-org/synapse#9134](https://github.com/matrix-org/synapse/pull/9134)))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135]([matrix-org/synapse#9135](https://github.com/matrix-org/synapse/pull/9135)))
- Add notes on integrating with Facebook for SSO login. ([\#9244]([matrix-org/synapse#9244](https://github.com/matrix-org/synapse/pull/9244)))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199]([matrix-org/synapse#9199](https://github.com/matrix-org/synapse/pull/9199)))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289]([matrix-org/synapse#9289](https://github.com/matrix-org/synapse/pull/9289)))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045]([matrix-org/synapse#9045](https://github.com/matrix-org/synapse/pull/9045)))
- Various improvements to the federation client. ([\#9129]([matrix-org/synapse#9129](https://github.com/matrix-org/synapse/pull/9129)))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176]([matrix-org/synapse#9176](https://github.com/matrix-org/synapse/pull/9176)))
- Add a `long_description_type` to the package metadata. ([\#9180]([matrix-org/synapse#9180](https://github.com/matrix-org/synapse/pull/9180)))
- Speed up batch insertion when using PostgreSQL. ([\#9181]([matrix-org/synapse#9181](https://github.com/matrix-org/synapse/pull/9181)), [\#9188]([matrix-org/synapse#9188](https://github.com/matrix-org/synapse/pull/9188)))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184]([matrix-org/synapse#9184](https://github.com/matrix-org/synapse/pull/9184)))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190]([matrix-org/synapse#9190](https://github.com/matrix-org/synapse/pull/9190)))
- Add some missing source directories to the automatic linting script. ([\#9191]([matrix-org/synapse#9191](https://github.com/matrix-org/synapse/pull/9191)))
- Precompute joined hosts and store in Redis. ([\#9198]([matrix-org/synapse#9198](https://github.com/matrix-org/synapse/pull/9198)), [\#9227]([matrix-org/synapse#9227](https://github.com/matrix-org/synapse/pull/9227)))
- Clean-up template loading code. ([\#9200]([matrix-org/synapse#9200](https://github.com/matrix-org/synapse/pull/9200)))
- Fix the Python 3.5 old dependencies build. ([\#9217]([matrix-org/synapse#9217](https://github.com/matrix-org/synapse/pull/9217)))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222]([matrix-org/synapse#9222](https://github.com/matrix-org/synapse/pull/9222)))
- Add type hints to handlers code. ([\#9223]([matrix-org/synapse#9223](https://github.com/matrix-org/synapse/pull/9223)), [\#9232]([matrix-org/synapse#9232](https://github.com/matrix-org/synapse/pull/9232)))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254]([matrix-org/synapse#9254](https://github.com/matrix-org/synapse/pull/9254)))
- Minor performance improvement during TLS handshake. ([\#9255]([matrix-org/synapse#9255](https://github.com/matrix-org/synapse/pull/9255)))
- Refactor the generation of summary text for email notifications. ([\#9260]([matrix-org/synapse#9260](https://github.com/matrix-org/synapse/pull/9260)))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270]([matrix-org/synapse#9270](https://github.com/matrix-org/synapse/pull/9270)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9200).

Reviewers

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [erikjohnston](/erikjohnston)

erikjohnston approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=52&v=4)](/dkasak) [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a23783fc_20250114_184758.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2Fe54746bdf7d5c831eabe4dcea76a7626f1de73df)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2Fe54746bdf7d5c831eabe4dcea76a7626f1de73df)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

## Commit

[Permalink](/matrix-org/synapse/commit/e54746bdf7d5c831eabe4dcea76a7626f1de73df)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Clean-up the template loading code. ([#9200](https://github.com/matrix-org/synapse/pull/9200))

[Browse files](/matrix-org/synapse/tree/e54746bdf7d5c831eabe4dcea76a7626f1de73df)
Browse the repository at this point in the history

```
* Enables autoescape by default for HTML files.
* Adds a new read_template method for reading a single template.
* Some logic clean-up.
```

* Loading branch information

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

[clokep](/matrix-org/synapse/commits?author=clokep "View all commits by clokep")
authored
Jan 27, 2021

1 parent
[93b6158](/matrix-org/synapse/commit/93b61589b0bdb3845ee839e9c2a4e1adb06bd483)

commit e54746b

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**96 additions**
and
**38 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* UPGRADE.rst
  [UPGRADE.rst](#diff-b485fbf10ae53d81e9b771a809fcdd0cfa321f2628c721fc3cb7f2396db041da)
* changelog.d

  + changelog.d/9200.misc
    [9200.misc](#diff-89ae4413149b488c46f63e17ac0db80c3ff9fe836fcd3112f68e648a65b3308e)
* synapse

  + config

    - synapse/config/\_base.py
      [\_base.py](#diff-d3227e00d4de413ffbddf2eb879670a0aebc8aaebde6fcf7d347951c327c3334)
    - synapse/config/captcha.py
      [captcha.py](#diff-a0707d4ff92dbd3077975adf2518e8b5915655504cfa4cd7288abb8dda3e464a)
    - synapse/config/consent\_config.py
      [consent\_config.py](#diff-84aba13cf33cff21401c011c0bc5166edf9d457806506669f3861fa733d639fb)
    - synapse/config/registration.py
      [registration.py](#diff-30ee85c7ca970b8e91e3adf391fa3e45686bd5ce730947df0075b3f689ba199f)
  + push

    - synapse/push/mailer.py
      [mailer.py](#diff-3b81ff87862bd7da518c6bf1b8ccb79680805f8699c5fa205056a06fd492f7e6)
  + res/templates

    - synapse/res/templates/sso\_auth\_bad\_user.html
      [sso\_auth\_bad\_user.html](#diff-59a95875a0235659e2903c493064c471997f06beb564da41de91d810c1a506c9)
    - synapse/res/templates/sso\_auth\_confirm.html
      [sso\_auth\_confirm.html](#diff-4d36fc1fde75aab60b256aca4e738b26785ff7223a1a5b89d72fade7125cd703)
    - synapse/res/templates/sso\_error.html
      [sso\_error.html](#diff-f9054934059cd26f6d9e2eb3406862185795bdd0210fe890d09f07631f2ec092)
    - synapse/res/templates/sso\_login\_idp\_picker.html
      [sso\_login\_idp\_picker.html](#diff-3e9c55905e7a543f2a6a3257f51cfffe73b2a4ffe92445e39a67ea626f2c832d)
    - synapse/res/templates/sso\_redirect\_confirm.html
      [sso\_redirect\_confirm.html](#diff-379a0f03919f79f97e753c82c27ef980e00f745b268c0721d33c36d6ecfae853)

## There are no files selected for viewing

37 changes: 37 additions & 0 deletions

37
[UPGRADE.rst](#diff-b485fbf10ae53d81e9b771a809fcdd0cfa321f2628c721fc3cb7f2396db041da "UPGRADE.rst")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/UPGRADE.rst)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -85,6 +85,43 @@ for example: |
|  |  | wget https://packages.matrix.org/debian/pool/main/m/matrix-synapse-py3/matrix-synapse-py3\_1.3.0+stretch1\_amd64.deb |
|  |  | dpkg -i matrix-synapse-py3\_1.3.0+stretch1\_amd64.deb |
|  |  |  |
|  |  | Upgrading to v1.27.0 |
|  |  | ==================== |
|  |  |  |
|  |  | Changes to HTML templates |
|  |  | ------------------------- |
|  |  |  |
|  |  | The HTML templates for SSO and email notifications now have `Jinja2's autoescape <https://jinja.palletsprojects.com/en/2.11.x/api/#autoescaping>`\_ |
|  |  | enabled for files ending in ``.html``, ``.htm``, and ``.xml``. If you hae customised |
|  |  | these templates and see issues when viewing them you might need to update them. |
|  |  | It is expected that most configurations will need no changes. |
|  |  |  |
|  |  | If you have customised the templates \*names\* for these templates it is recommended |
|  |  | to verify they end in ``.html`` to ensure autoescape is enabled. |
|  |  |  |
|  |  | The above applies to the following templates: |
|  |  |  |
|  |  | \* ``add\_threepid.html`` |
|  |  | \* ``add\_threepid\_failure.html`` |
|  |  | \* ``add\_threepid\_success.html`` |
|  |  | \* ``notice\_expiry.html`` |
|  |  | \* ``notice\_expiry.html`` |
|  |  | \* ``notif\_mail.html`` (which, by default, includes ``room.html`` and ``notif.html``) |
|  |  | \* ``password\_reset.html`` |
|  |  | \* ``password\_reset\_confirmation.html`` |
|  |  | \* ``password\_reset\_failure.html`` |
|  |  | \* ``password\_reset\_success.html`` |
|  |  | \* ``registration.html`` |
|  |  | \* ``registration\_failure.html`` |
|  |  | \* ``registration\_success.html`` |
|  |  | \* ``sso\_account\_deactivated.html`` |
|  |  | \* ``sso\_auth\_bad\_user.html`` |
|  |  | \* ``sso\_auth\_confirm.html`` |
|  |  | \* ``sso\_auth\_success.html`` |
|  |  | \* ``sso\_error.html`` |
|  |  | \* ``sso\_login\_idp\_picker.html`` |
|  |  | \* ``sso\_redirect\_confirm.html`` |
|  |  |  |
|  |  | Upgrading to v1.26.0 |
|  |  | ==================== |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[changelog.d/9200.misc](#diff-89ae4413149b488c46f63e17ac0db80c3ff9fe836fcd3112f68e648a65b3308e "changelog.d/9200.misc")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/changelog.d/9200.misc)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Clean-up template loading code. |

42 changes: 26 additions & 16 deletions

42
[synapse/config/\_base.py](#diff-d3227e00d4de413ffbddf2eb879670a0aebc8aaebde6fcf7d347951c327c3334 "synapse/config/_base.py")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/config/_base.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -203,36 +203,50 @@ def read\_file(cls, file\_path, config\_name): |
|  |  | with open(file\_path) as file\_stream: |
|  |  | return file\_stream.read() |
|  |  |  |
|  |  | def read\_template(self, filename: str) -> jinja2.Template: |
|  |  | """Load a template file from disk. |
|  |  |  |
|  |  | This function will attempt to load the given template from the default Synapse |
|  |  | template directory. |
|  |  |  |
|  |  | Files read are treated as Jinja templates. The templates is not rendered yet |
|  |  | and has autoescape enabled. |
|  |  |  |
|  |  | Args: |
|  |  | filename: A template filename to read. |
|  |  |  |
|  |  | Raises: |
|  |  | ConfigError: if the file's path is incorrect or otherwise cannot be read. |
|  |  |  |
|  |  | Returns: |
|  |  | A jinja2 template. |
|  |  | """ |
|  |  | return self.read\_templates([filename])[0] |
|  |  |  |
|  |  | def read\_templates( |
|  |  | self, |
|  |  | filenames: List[str], |
|  |  | custom\_template\_directory: Optional[str] = None, |
|  |  | autoescape: bool = False, |
|  |  | self, filenames: List[str], custom\_template\_directory: Optional[str] = None, |
|  |  | ) -> List[jinja2.Template]: |
|  |  | """Load a list of template files from disk using the given variables. |
|  |  |  |
|  |  | This function will attempt to load the given templates from the default Synapse |
|  |  | template directory. If `custom\_template\_directory` is supplied, that directory |
|  |  | is tried first. |
|  |  |  |
|  |  | Files read are treated as Jinja templates. These templates are not rendered yet. |
|  |  | Files read are treated as Jinja templates. The templates are not rendered yet |
|  |  | and have autoescape enabled. |
|  |  |  |
|  |  | Args: |
|  |  | filenames: A list of template filenames to read. |
|  |  |  |
|  |  | custom\_template\_directory: A directory to try to look for the templates |
|  |  | before using the default Synapse template directory instead. |
|  |  |  |
|  |  | autoescape: Whether to autoescape variables before inserting them into the |
|  |  | template. |
|  |  |  |
|  |  | Raises: |
|  |  | ConfigError: if the file's path is incorrect or otherwise cannot be read. |
|  |  |  |
|  |  | Returns: |
|  |  | A list of jinja2 templates. |
|  |  | """ |
|  |  | templates = [] |
|  |  | search\_directories = [self.default\_template\_dir] |
|  |  |  |
|  |  | # The loader will first look in the custom template directory (if specified) for the |
| Expand All | | @@ -249,7 +263,7 @@ def read\_templates( |
|  |  | search\_directories.insert(0, custom\_template\_directory) |
|  |  |  |
|  |  | loader = jinja2.FileSystemLoader(search\_directories) |
|  |  | env = jinja2.Environment(loader=loader, autoescape=autoescape) |
|  |  | env = jinja2.Environment(loader=loader, autoescape=jinja2.select\_autoescape(),) |
|  |  |  |
|  |  | # Update the environment with our custom filters |
|  |  | env.filters.update( |
| Expand All | | @@ -259,12 +273,8 @@ def read\_templates( |
|  |  | } |
|  |  | ) |
|  |  |  |
|  |  | for filename in filenames: |
|  |  | # Load the template |
|  |  | template = env.get\_template(filename) |
|  |  | templates.append(template) |
|  |  |  |
|  |  | return templates |
|  |  | # Load the templates |
|  |  | return [env.get\_template(filename) for filename in filenames] |
|  |  |  |
|  |  |  |
|  |  | def \_format\_ts\_filter(value: int, format: str): |
| Expand Down | |  |

4 changes: 1 addition & 3 deletions

4
[synapse/config/captcha.py](#diff-a0707d4ff92dbd3077975adf2518e8b5915655504cfa4cd7288abb8dda3e464a "synapse/config/captcha.py")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/config/captcha.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,9 +28,7 @@ def read\_config(self, config, \*\*kwargs): |
|  |  | "recaptcha\_siteverify\_api", |
|  |  | "https://www.recaptcha.net/recaptcha/api/siteverify", |
|  |  | ) |
|  |  | self.recaptcha\_template = self.read\_templates( |
|  |  | ["recaptcha.html"], autoescape=True |
|  |  | )[0] |
|  |  | self.recaptcha\_template = self.read\_template("recaptcha.html") |
|  |  |  |
|  |  | def generate\_config\_section(self, \*\*kwargs): |
|  |  | return """\ |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/config/consent\_config.py](#diff-84aba13cf33cff21401c011c0bc5166edf9d457806506669f3861fa733d639fb "synapse/config/consent_config.py")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/config/consent_config.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -89,7 +89,7 @@ def \_\_init\_\_(self, \*args): |
|  |  |  |
|  |  | def read\_config(self, config, \*\*kwargs): |
|  |  | consent\_config = config.get("user\_consent") |
|  |  | self.terms\_template = self.read\_templates(["terms.html"], autoescape=True)[0] |
|  |  | self.terms\_template = self.read\_template("terms.html") |
|  |  |  |
|  |  | if consent\_config is None: |
|  |  | return |
| Expand Down | |  |

4 changes: 1 addition & 3 deletions

4
[synapse/config/registration.py](#diff-30ee85c7ca970b8e91e3adf391fa3e45686bd5ce730947df0075b3f689ba199f "synapse/config/registration.py")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/config/registration.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -176,9 +176,7 @@ def read\_config(self, config, \*\*kwargs): |
|  |  | self.session\_lifetime = session\_lifetime |
|  |  |  |
|  |  | # The success template used during fallback auth. |
|  |  | self.fallback\_success\_template = self.read\_templates( |
|  |  | ["auth\_success.html"], autoescape=True |
|  |  | )[0] |
|  |  | self.fallback\_success\_template = self.read\_template("auth\_success.html") |
|  |  |  |
|  |  | def generate\_config\_section(self, generate\_secrets=False, \*\*kwargs): |
|  |  | if generate\_secrets: |
| Expand Down | |  |

18 changes: 16 additions & 2 deletions

18
[synapse/push/mailer.py](#diff-3b81ff87862bd7da518c6bf1b8ccb79680805f8699c5fa205056a06fd492f7e6 "synapse/push/mailer.py")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/push/mailer.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -668,6 +668,15 @@ def make\_unsubscribe\_link( |
|  |  |  |
|  |  |  |
|  |  | def safe\_markup(raw\_html: str) -> jinja2.Markup: |
|  |  | """ |
|  |  | Sanitise a raw HTML string to a set of allowed tags and attributes, and linkify any bare URLs. |
|  |  |  |
|  |  | Args |
|  |  | raw\_html: Unsafe HTML. |
|  |  |  |
|  |  | Returns: |
|  |  | A Markup object ready to safely use in a Jinja template. |
|  |  | """ |
|  |  | return jinja2.Markup( |
|  |  | bleach.linkify( |
|  |  | bleach.clean( |
| Expand All | | @@ -684,8 +693,13 @@ def safe\_markup(raw\_html: str) -> jinja2.Markup: |
|  |  |  |
|  |  | def safe\_text(raw\_text: str) -> jinja2.Markup: |
|  |  | """ |
|  |  | Process text: treat it as HTML but escape any tags (ie. just escape the |
|  |  | HTML) then linkify it. |
|  |  | Sanitise text (escape any HTML tags), and then linkify any bare URLs. |
|  |  |  |
|  |  | Args |
|  |  | raw\_text: Unsafe text which might include HTML markup. |
|  |  |  |
|  |  | Returns: |
|  |  | A Markup object ready to safely use in a Jinja template. |
|  |  | """ |
|  |  | return jinja2.Markup( |
|  |  | bleach.linkify(bleach.clean(raw\_text, tags=[], attributes={}, strip=False)) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/res/templates/sso\_auth\_bad\_user.html](#diff-59a95875a0235659e2903c493064c471997f06beb564da41de91d810c1a506c9 "synapse/res/templates/sso_auth_bad_user.html")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/res/templates/sso_auth_bad_user.html)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ |
|  |  | <body> |
|  |  | <div> |
|  |  | <p> |
|  |  | We were unable to validate your <tt>{{server\_name | e}}</tt> account via |
|  |  | We were unable to validate your <tt>{{ server\_name }}</tt> account via |
|  |  | single-sign-on (SSO), because the SSO Identity Provider returned |
|  |  | different details than when you logged in. |
|  |  | </p> |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[synapse/res/templates/sso\_auth\_confirm.html](#diff-4d36fc1fde75aab60b256aca4e738b26785ff7223a1a5b89d72fade7125cd703 "synapse/res/templates/sso_auth_confirm.html")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/res/templates/sso_auth_confirm.html)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,8 +5,8 @@ |
|  |  | <body> |
|  |  | <div> |
|  |  | <p> |
|  |  | A client is trying to {{ description | e }}. To confirm this action, |
|  |  | <a href="{{ redirect\_url | e }}">re-authenticate with single sign-on</a>. |
|  |  | A client is trying to {{ description }}. To confirm this action, |
|  |  | <a href="{{ redirect\_url }}">re-authenticate with single sign-on</a>. |
|  |  | If you did not expect this, your account may be compromised! |
|  |  | </p> |
|  |  | </div> |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/res/templates/sso\_error.html](#diff-f9054934059cd26f6d9e2eb3406862185795bdd0210fe890d09f07631f2ec092 "synapse/res/templates/sso_error.html")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/res/templates/sso_error.html)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ |
|  |  | <p> |
|  |  | There was an error during authentication: |
|  |  | </p> |
|  |  | <div id="errormsg" style="margin:20px 80px">{{ error\_description | e }}</div> |
|  |  | <div id="errormsg" style="margin:20px 80px">{{ error\_description }}</div> |
|  |  | <p> |
|  |  | If you are seeing this page after clicking a link sent to you via email, make |
|  |  | sure you only click the confirmation link once, and that you open the |
| Expand Down | |  |

12 changes: 6 additions & 6 deletions

12
[synapse/res/templates/sso\_login\_idp\_picker.html](#diff-3e9c55905e7a543f2a6a3257f51cfffe73b2a4ffe92445e39a67ea626f2c832d "synapse/res/templates/sso_login_idp_picker.html")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/res/templates/sso_login_idp_picker.html)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,22 +3,22 @@ |
|  |  | <head> |
|  |  | <meta charset="UTF-8"> |
|  |  | <link rel="stylesheet" href="/\_matrix/static/client/login/style.css"> |
|  |  | <title>{{server\_name | e}} Login</title> |
|  |  | <title>{{ server\_name }} Login</title> |
|  |  | </head> |
|  |  | <body> |
|  |  | <div id="container"> |
|  |  | <h1 id="title">{{server\_name | e}} Login</h1> |
|  |  | <h1 id="title">{{ server\_name }} Login</h1> |
|  |  | <div class="login\_flow"> |
|  |  | <p>Choose one of the following identity providers:</p> |
|  |  | <form> |
|  |  | <input type="hidden" name="redirectUrl" value="{{redirect\_url | e}}"> |
|  |  | <input type="hidden" name="redirectUrl" value="{{ redirect\_url }}"> |
|  |  | <ul class="radiobuttons"> |
|  |  | {% for p in providers %} |
|  |  | <li> |
|  |  | <input type="radio" name="idp" id="prov{{loop.index}}" value="{{p.idp\_id}}"> |
|  |  | <label for="prov{{loop.index}}">{{p.idp\_name | e}}</label> |
|  |  | <input type="radio" name="idp" id="prov{{ loop.index }}" value="{{ p.idp\_id }}"> |
|  |  | <label for="prov{{ loop.index }}">{{ p.idp\_name }}</label> |
|  |  | {% if p.idp\_icon %} |
|  |  | <img src="{{p.idp\_icon | mxc\_to\_http(32, 32)}}"/> |
|  |  | <img src="{{ p.idp\_icon | mxc\_to\_http(32, 32) }}"/> |
|  |  | {% endif %} |
|  |  | </li> |
|  |  | {% endfor %} |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[synapse/res/templates/sso\_redirect\_confirm.html](#diff-379a0f03919f79f97e753c82c27ef980e00f745b268c0721d33c36d6ecfae853 "synapse/res/templates/sso_redirect_confirm.html")

Show comments

[View file](/matrix-org/synapse/blob/e54746bdf7d5c831eabe4dcea76a7626f1de73df/synapse/res/templates/sso_redirect_confirm.html)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,10 +5,10 @@ |
|  |  | <title>SSO redirect confirmation</title> |
|  |  | </head> |
|  |  | <body> |
|  |  | <p>The application at <span style="font-weight:bold">{{ display\_url | e }}</span> is requesting full access to your <span style="font-weight:bold">{{ server\_name }}</span> Matrix account.</p> |
|  |  | <p>The application at <span style="font-weight:bold">{{ display\_url }}</span> is requesting full access to your <span style="font-weight:bold">{{ server\_name }}</span> Matrix account.</p> |
|  |  | <p>If you don't recognise this address, you should ignore this and close this tab.</p> |
|  |  | <p> |
|  |  | <a href="{{ redirect\_url | e }}">I trust this address</a> |
|  |  | <a href="{{ redirect\_url }}">I trust this address</a> |
|  |  | </p> |
|  |  | </body> |
|  |  | </html> |
|  |  | </html> |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e54746b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2Fe54746bdf7d5c831eabe4dcea76a7626f1de73df) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_ad82ac63_20250114_184803.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY.mbox.gz?message=TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

# [SECURITY] Fedora 34 Update: matrix-synapse-1.38.1-1.fc34

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

1 Aug
2021

1 Aug
'21

9:05 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-a627cfd31e
2021-08-02 01:02:57.308573
--------------------------------------------------------------------------------

Name : matrix-synapse
Product : Fedora 34
Version : 1.38.1
Release : 1.fc34
URL : <https://github.com/matrix-org/synapse>
Summary : A Matrix reference homeserver written in Python using Twisted
Description :
Matrix is an ambitious new ecosystem for open federated Instant Messaging and
VoIP. Synapse is a reference "homeserver" implementation of Matrix from the
core development team at matrix.org, written in Python/Twisted. It is intended
to showcase the concept of Matrix and let folks see the spec in the context of
a coded base and let you run your own homeserver and generally help bootstrap
the ecosystem.

--------------------------------------------------------------------------------
Update Information:

Update to v1.38.1 ---- New upstream release 1.38.0, incorporating a number of
important security fixes. Upstream changelog: <https://github.com/matrix->
org/synapse/blob/v1.38.0/CHANGES.md Upstream upgrade notes: <https://matrix->
org.github.io/synapse/develop/upgrade#upgrading-to-v1380
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Jul 23 2021 Kai A. Hiller V02460@gmail.com - 1.38.1-1
- Update to v1.38.1
\* Thu Jul 22 2021 Fedora Release Engineering releng@fedoraproject.org - 1.38.0-3
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_35_Mass_Rebuild>
\* Sun Jul 18 2021 Dan Callaghan djc@djc.id.au - 1.38.0-2
- fix startup ordering of synapse.service (RHBZ#1910740)
- relax version requirement for python3-cryptography
\* Wed Jul 14 2021 Kai A. Hiller V02460@gmail.com - 1.38.0-1
- Update to v1.38.0
\* Fri Jun 4 2021 Python Maint python-maint@redhat.com - 1.26.0-3
- Rebuilt for Python 3.10
\* Tue Mar 2 2021 Zbigniew J��drzejewski-Szmek zbyszek@in.waw.pl - 1.26.0-2
- Rebuilt for updated systemd-rpm-macros
See <https://pagure.io/fesco/issue/2583>.
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1910740 - synapse.service can fail if it starts before postgresql is ready
<https://bugzilla.redhat.com/show_bug.cgi?id=1910740>
[ 2 ] Bug #1918426 - matrix-synapse-1.38.0 is available
<https://bugzilla.redhat.com/show_bug.cgi?id=1918426>
[ 3 ] Bug #1934603 - CVE-2021-21274 matrix-synapse: DoS via .well-known lookups [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934603>
[ 4 ] Bug #1934606 - CVE-2021-21273 matrix-synapse: open redirects on some federation and push requests [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934606>
[ 5 ] Bug #1944136 - CVE-2021-21332 matrix-synapse: password reset endpoint is vulnerable to XSS [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944136>
[ 6 ] Bug #1944139 - CVE-2021-21333 matrix-synapse: HTML injection in email and account expiry notifications [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944139>
[ 7 ] Bug #1949110 - CVE-2021-21393 matrix-synapse: Denial of service (via resource exhaustion) due to improper input validation on groups/communities endpoints [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949110>
[ 8 ] Bug #1949112 - CVE-2021-21392 matrix-synapse: IP blacklist bypass via transitional IPv6 addresses on dual-stack networks [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949112>
[ 9 ] Bug #1958801 - CVE-2021-21394 matrix-synapse: missing input validation may cause excessive use of disk space and memory [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1958801>
[ 10 ] Bug #1959542 - CVE-2021-29471 matrix-synapse: Denial-of-service when processing moderate length events [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1959542>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-a627cfd31e' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.


