=== Content from github.com_db366e5d_20250114_184723.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Freleases%2Ftag%2Fv6.5.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Freleases%2Ftag%2Fv6.5.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=IdentityPython%2Fpysaml2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[IdentityPython](/IdentityPython)
/
**[pysaml2](/IdentityPython/pysaml2)**
Public

* [Notifications](/login?return_to=%2FIdentityPython%2Fpysaml2) You must be signed in to change notification settings
* [Fork
  426](/login?return_to=%2FIdentityPython%2Fpysaml2)
* [Star
   570](/login?return_to=%2FIdentityPython%2Fpysaml2)

* [Code](/IdentityPython/pysaml2/tree/v6.5.0)
* [Issues
  84](/IdentityPython/pysaml2/issues)
* [Pull requests
  33](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

Additional navigation options

* [Code](/IdentityPython/pysaml2/tree/v6.5.0)
* [Issues](/IdentityPython/pysaml2/issues)
* [Pull requests](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

1. [Releases](/IdentityPython/pysaml2/releases)
2. [v6.5.0](/IdentityPython/pysaml2/releases/tag/v6.5.0)

# Version 6.5.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/IdentityPython/pysaml2/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v6.5.0)

 Loading

[View all tags](/IdentityPython/pysaml2/tags)

![@c00kiemon5ter](https://avatars.githubusercontent.com/u/97634?s=40&v=4)
[c00kiemon5ter](/c00kiemon5ter)
released this
20 Jan 12:52

·
[274 commits](/IdentityPython/pysaml2/compare/v6.5.0...master)
to master
since this release

[v6.5.0](/IdentityPython/pysaml2/tree/v6.5.0)

This tag was signed with the committer’s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/97634?s=64&v=4)](/c00kiemon5ter)
[c00kiemon5ter](/c00kiemon5ter)
Ivan Kanakarakis

GPG key ID: 762A5045469270CF
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`12ec4a7`](/IdentityPython/pysaml2/commit/12ec4a70c5aaf4c144f6b30a158193ca99bc76cd)

This commit was signed with the committer’s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/97634?s=64&v=4)](/c00kiemon5ter)
[c00kiemon5ter](/c00kiemon5ter)
Ivan Kanakarakis

GPG key ID: 762A5045469270CF
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

## 6.5.0 (2021-01-20) - Security release

* Fix processing of invalid SAML XML documents - [CVE-2021-21238](https://github.com/IdentityPython/pysaml2/security/advisories/GHSA-f4g9-h89h-jgv9)
* Fix unspecified xmlsec1 key-type preference - [CVE-2021-21239](https://github.com/IdentityPython/pysaml2/security/advisories/GHSA-5p3x-r448-pc62)
* Add more tests regarding XSW attacks
* Add XML Schemas for SAML2 and common extensions
* Fix the XML parser to not break on ePTID AttributeValues
* Fix the initialization value of the return\_addrs property of the StatusResponse object
* Fix SWAMID entity-category policy regarding eduPersonTargetedID
* data: use importlib to load package data (backwards compatibility through the importlib\_resources package)
* docs: improve the documentation for the signing\_algorithm and digest\_algorithm options
* examples: fix the logging configuration of the example-IdP
* tests: allow tests to pass on 32bit systems by properly choosing dates in test XML documents
* tests: improvements on the generation of response and assertion objects
* tests: expand tests on python-3.9 and python-3.10-dev

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.aleksey.com_1d091dc1_20250114_184736.html ===

# [xmlsec] Xmlsec preferring KeyValue element over explicitly loaded public keys?

**Greg Vishnepolsky**
greg at adallom.com

*Mon Nov 11 09:49:49 PST 2013*

* Previous message: [[xmlsec] decrypt document after encryption failed](009716.html)
* Next message: [[xmlsec] Xmlsec preferring KeyValue element over explicitly loaded public keys?](009718.html)
* **Messages sorted by:**
  [[ date ]](date.html#9717)
  [[ thread ]](thread.html#9717)
  [[ subject ]](subject.html#9717)
  [[ author ]](author.html#9717)

---

```
Hello,

I've encountered very odd behavior of xmlsec which could be dangerous /
considered a security issue.

Take a look at the following XML (from the URL below). It contains a
KeyValue tag to be filled in during signature. It can be signed as follows:

$ curl
<https://gist.github.com/gregvish/7362993/raw/6979439b13056d9622a404be40fd49d>
56381d7cb/xmlsign2.xml > test.xml

$ openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days
1000 -nodes

$ xmlsec1 --sign --privkey-pem key.pem test.xml > signed.xml

Naturally, it verifies:

$ xmlsec1 --verify --pubkey-cert-pem cert.pem signed.xml

OK

However, it also verifies with a completely unrelated public key! (when it
certainly should not!)

$ openssl req -x509 -newkey rsa:2048 -keyout other-key.pem -out
other-cert.pem -days 1000 -nodes

$ xmlsec1 --verify --pubkey-cert-pem other-cert.pem signed.xml

OK

And in fact, it would verify even if the verification is supposed to be
against an X509 CA! There aren't any certificates in this XML at all!

$ xmlsec1 --verify --trusted-pem other-cert.pem signed.xml

OK
SignedInfo References (ok/all): 1/1
Manifests References (ok/all): 0/0

Apparently, xmlsec "prefers" the value in the KeyValue element over any
other public key material that is explicitly provided to a KeysMngr!

In order to fix (work around) this behavior, apparently, the
"--enabled-key-data" flag should be passed. This way, doing the first 2
examples works as expected:

$ xmlsec1 --verify --pubkey-cert-pem cert.pem --enabled-key-data rsa
signed.xml

OK
$ xmlsec1 --verify --pubkey-cert-pem other-cert.pem --enabled-key-data rsa
signed.xml

func=xmlSecOpenSSLEvpSignatureVerify:file=signatures.c:line=346:obj=rsa-sha1
:subj=EVP_VerifyFinal:error=18:data do not match:signature do not match

FAIL

The same is true for the example with the x509 certificates. If
"--enabled-key-data x509" is provided, a valid X509Data element is expected
in the XML, and the KeyValue element is properly ignored.

I don't think this is reasonable default behavior. I'd even consider this is
a security issue, at least in the documentation. I haven't found any
documentation stating the importance of this flag. People using the library
could be prone to making this mistake.

For instance, here is a guide (#2 on google for "using xmlsec1"):
<http://users.dcc.uchile.cl/~pcamacho/tutorial/web/xmlsec/xmlsec.html> .
There, as you can see, the given usage examples exhibit this vulnerable
behavior.

This of course is not limited to the xmlsec1 command line utility, but is a
problem in the xmlsec library itself. Looking at the C code examples, only 2
out of 4 verification examples are not vulnerable to this.

The first one is called "Verifying a signature with a single key". In that
example, an xmlSecKeysMngr is not used. The following code loads the key
directly into the DSigCtx:

    /* load public key */

    dsigCtx->signKey = xmlSecCryptoAppKeyLoad(...);

This code is not vulnerable because of this. The example "Verifying a
signature with additional restrictions" is also not vulnerable, since it
explicitly sets the allowed key data (as part of the additional
restrictions).

All the other examples, that use a KeysMngr (but do not limit the key data)
are vulnerable. For instance, you may test the above (signed) XML file with
the example called "Verifying a signature with keys manager" . This is the
example called "verify2.c" on the xmlsec website
(<http://www.aleksey.com/xmlsec/api/xmlsec-verify-with-keys-mngr.html>).

$ openssl x509 -in cert.pem -pubkey -noout > pubkey.pem

$ openssl x509 -in other-cert.pem -pubkey -noout > other-pubkey.pem

$ ./verify2 signed.xml pubkey.pem

Signature is OK

So far so good...

$ ./verify2 signed.xml other-pubkey.pem

Signature is OK

Unexpected!

In order to fix this, the following patch needs to be applied to the
"verify2.c" example:

--- ex2.c       2013-11-11 18:16:36.136024683 +0200

+++ ex3.c       2013-11-11 19:28:26.825831754 +0200

@@ -254,6 +254,11 @@

         goto done;

     }

+    if(xmlSecPtrListAdd(&(dsigCtx->keyInfoReadCtx.enabledKeyData), BAD_CAST
xmlSecKeyDataRsaId) < 0) {

+        fprintf(stderr,"Error: failed to limit allowed key data\n");

+        goto done;

+    }

+

     /* Verify signature */

     if(xmlSecDSigCtxVerify(dsigCtx, node) < 0) {

         fprintf(stderr,"Error: signature verify\n");

With this patch, this is what happens:

$ ./verify2-fix signed.xml other-pubkey.pem

func=xmlSecOpenSSLEvpSignatureVerify:file=signatures.c:line=346:obj=rsa-sha1
:subj=EVP_VerifyFinal:error=18:data do not match:signature do not match

Signature is INVALID

Now it behaves as expected.

The code of this patch was taken from the "verify4.c" example, where the
limitation of the key data is described. I've looked around a bit, and in
fact, this is the only place where this feature is documented!

To sum up, I think that this issue needs to be addressed somehow. Either
this is better documented, or the default behavior is changed to be far less
"permissive".

Please tell me your thoughts on the matter, and what can/should/shot not be
done about it.

Thanks,

Greg

-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 9178 bytes
Desc: not available
URL: <<http://www.aleksey.com/pipermail/xmlsec/attachments/20131111/317a1f94/attachment.bin>>

```

---

* Previous message: [[xmlsec] decrypt document after encryption failed](009716.html)
* Next message: [[xmlsec] Xmlsec preferring KeyValue element over explicitly loaded public keys?](009718.html)
* **Messages sorted by:**
  [[ date ]](date.html#9717)
  [[ thread ]](thread.html#9717)
  [[ subject ]](subject.html#9717)
  [[ author ]](author.html#9717)

---

[More information about the xmlsec
mailing list](http://www.aleksey.com/mailman/listinfo/xmlsec)



=== Content from github.com_10f502ee_20250114_184722.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Fcommit%2F46578df0695269a16f1c94171f1429873f90ed99)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Fcommit%2F46578df0695269a16f1c94171f1429873f90ed99)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=IdentityPython%2Fpysaml2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[IdentityPython](/IdentityPython)
/
**[pysaml2](/IdentityPython/pysaml2)**
Public

* [Notifications](/login?return_to=%2FIdentityPython%2Fpysaml2) You must be signed in to change notification settings
* [Fork
  426](/login?return_to=%2FIdentityPython%2Fpysaml2)
* [Star
   570](/login?return_to=%2FIdentityPython%2Fpysaml2)

* [Code](/IdentityPython/pysaml2)
* [Issues
  84](/IdentityPython/pysaml2/issues)
* [Pull requests
  33](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

Additional navigation options

* [Code](/IdentityPython/pysaml2)
* [Issues](/IdentityPython/pysaml2/issues)
* [Pull requests](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

## Commit

[Permalink](/IdentityPython/pysaml2/commit/46578df0695269a16f1c94171f1429873f90ed99)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-5p3x-r448-pc62](https://github.com/advisories/GHSA-5p3x-r448-pc62 "GHSA-5p3x-r448-pc62")

[Browse files](/IdentityPython/pysaml2/tree/46578df0695269a16f1c94171f1429873f90ed99)
Browse the repository at this point in the history

```
Restrict the key data that xmlsec1 accepts to only x509 certs
```

* Loading branch information

[![@c00kiemon5ter](https://avatars.githubusercontent.com/u/97634?s=40&v=4)](/c00kiemon5ter)

[c00kiemon5ter](/IdentityPython/pysaml2/commits?author=c00kiemon5ter "View all commits by c00kiemon5ter")
authored
Jan 20, 2021

2 parents
[aaf6c54](/IdentityPython/pysaml2/commit/aaf6c54c9a8c6b7fc891a6ffada481dd688d9e26)
+
[751dbf5](/IdentityPython/pysaml2/commit/751dbf50a51131b13d55989395f9b115045f9737)

commit 46578df

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**227 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/saml2

  + src/saml2/sigver.py
    [sigver.py](#diff-3482e02155ca5e77a0034bd27c342d3951400f11ceea80ed7d2169e8f458f857)
* tests

  + tests/test\_xmlsec1\_key\_data.py
    [test\_xmlsec1\_key\_data.py](#diff-7913a0a2b314f1bc1d8b5618bda000b173a77b319576898c475bf5f99855fba6)
  + xmlsec1-keydata

    - tests/xmlsec1-keydata/signed-assertion-random-embedded-cert.xml
      [signed-assertion-random-embedded-cert.xml](#diff-8038f2c45b5846729840278522cd918e490a4c6bd511d16011dadab151f2099c)
    - tests/xmlsec1-keydata/signed-assertion-with-hmac.xml
      [signed-assertion-with-hmac.xml](#diff-9c34d7290378d079fccab3a2c85b42e909cd4d5e1286d63cafcf3f12ccba3fa4)
    - tests/xmlsec1-keydata/signed-response-with-hmac.xml
      [signed-response-with-hmac.xml](#diff-1b085899ee796f7fae58100cdd12fda341e792cd390b140ae0bc1fc53a5104e1)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[src/saml2/sigver.py](#diff-3482e02155ca5e77a0034bd27c342d3951400f11ceea80ed7d2169e8f458f857 "src/saml2/sigver.py")

Show comments

[View file](/IdentityPython/pysaml2/blob/46578df0695269a16f1c94171f1429873f90ed99/src/saml2/sigver.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -869,6 +869,7 @@ def validate\_signature(self, signedtext, cert\_file, cert\_type, node\_name, node\_i |
|  |  | self.xmlsec, |
|  |  | '--verify', |
|  |  | '--enabled-reference-uris', 'empty,same-doc', |
|  |  | '--enabled-key-data', 'raw-x509-cert', |
|  |  | '--pubkey-cert-{type}'.format(type=cert\_type), cert\_file, |
|  |  | '--id-attr:ID', node\_name, |
|  |  | ] |
| Expand Down | |  |

81 changes: 81 additions & 0 deletions

81
[tests/test\_xmlsec1\_key\_data.py](#diff-7913a0a2b314f1bc1d8b5618bda000b173a77b319576898c475bf5f99855fba6 "tests/test_xmlsec1_key_data.py")

Show comments

[View file](/IdentityPython/pysaml2/blob/46578df0695269a16f1c94171f1429873f90ed99/tests/test_xmlsec1_key_data.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,81 @@ |
|  |  | from datetime import datetime |
|  |  | from dateutil import parser |
|  |  | from unittest.mock import Mock |
|  |  | from unittest.mock import patch |
|  |  |  |
|  |  | from pytest import raises |
|  |  |  |
|  |  | from saml2.config import config\_factory |
|  |  | from saml2.response import authn\_response |
|  |  | from saml2.sigver import SignatureError |
|  |  |  |
|  |  | from pathutils import dotname |
|  |  | from pathutils import full\_path |
|  |  |  |
|  |  |  |
|  |  | SIGNED\_RESPONSE\_HMAC = full\_path("xmlsec1-keydata/signed-response-with-hmac.xml") |
|  |  | SIGNED\_ASSERTION\_HMAC = full\_path("xmlsec1-keydata/signed-assertion-with-hmac.xml") |
|  |  | SIGNED\_ASSERTION\_RANDOM\_EMBEDDED\_CERT = full\_path("xmlsec1-keydata/signed-assertion-random-embedded-cert.xml") |
|  |  |  |
|  |  |  |
|  |  | class TestAuthnResponse: |
|  |  | @patch('saml2.response.validate\_on\_or\_after', return\_value=True) |
|  |  | def test\_signed\_response\_with\_hmac\_should\_fail(self, mock\_validate\_on\_or\_after): |
|  |  | conf = config\_factory("sp", dotname("server\_conf")) |
|  |  | ar = authn\_response(conf, return\_addrs="https://example.org/acs/post") |
|  |  | ar.issue\_instant\_ok = Mock(return\_value=True) |
|  |  |  |
|  |  | with open(SIGNED\_RESPONSE\_HMAC) as fp: |
|  |  | xml\_response = fp.read() |
|  |  |  |
|  |  | ar.outstanding\_queries = {"id-abc": "http://localhost:8088/sso"} |
|  |  | ar.timeslack = 10000 |
|  |  |  |
|  |  | # .loads checks the response signature |
|  |  | with raises(SignatureError): |
|  |  | ar.loads(xml\_response, decode=False) |
|  |  |  |
|  |  | assert ar.ava is None |
|  |  | assert ar.name\_id is None |
|  |  |  |
|  |  | @patch('saml2.response.validate\_on\_or\_after', return\_value=True) |
|  |  | def test\_signed\_assertion\_with\_hmac\_should\_fail(self, mock\_validate\_on\_or\_after): |
|  |  | conf = config\_factory("sp", dotname("server\_conf")) |
|  |  | ar = authn\_response(conf, return\_addrs="https://example.org/acs/post") |
|  |  | ar.issue\_instant\_ok = Mock(return\_value=True) |
|  |  |  |
|  |  | with open(SIGNED\_ASSERTION\_HMAC) as fp: |
|  |  | xml\_response = fp.read() |
|  |  |  |
|  |  | ar.outstanding\_queries = {"id-abc": "http://localhost:8088/sso"} |
|  |  | ar.timeslack = 10000 |
|  |  |  |
|  |  | # .loads does not check the assertion, only the response signature |
|  |  | # use .verify to verify the contents of the response |
|  |  | assert ar.loads(xml\_response, decode=False) |
|  |  | with raises(SignatureError): |
|  |  | ar.verify() |
|  |  |  |
|  |  | assert ar.ava is None |
|  |  | assert ar.name\_id is None |
|  |  |  |
|  |  | @patch('saml2.response.validate\_on\_or\_after', return\_value=True) |
|  |  | def test\_signed\_assertion\_with\_random\_embedded\_cert\_should\_be\_ignored(self, mock\_validate\_on\_or\_after): |
|  |  | """ |
|  |  | if the embedded cert is not ignored then verification will fail |
|  |  | """ |
|  |  |  |
|  |  | conf = config\_factory("sp", dotname("server\_conf")) |
|  |  | ar = authn\_response(conf, return\_addrs="https://51.15.251.81.xip.io/acs/post") |
|  |  | ar.issue\_instant\_ok = Mock(return\_value=True) |
|  |  |  |
|  |  | with open(SIGNED\_ASSERTION\_RANDOM\_EMBEDDED\_CERT) as fp: |
|  |  | xml\_response = fp.read() |
|  |  |  |
|  |  | ar.outstanding\_queries = {"id-abc": "http://localhost:8088/sso"} |
|  |  | ar.timeslack = 10000 |
|  |  |  |
|  |  | # .loads does not check the assertion, only the response signature |
|  |  | # use .verify to verify the contents of the response |
|  |  | assert ar.loads(xml\_response, decode=False) |
|  |  | assert ar.verify() |

47 changes: 47 additions & 0 deletions

47
[tests/xmlsec1-keydata/signed-assertion-random-embedded-cert.xml](#diff-8038f2c45b5846729840278522cd918e490a4c6bd511d16011dadab151f2099c "tests/xmlsec1-keydata/signed-assertion-random-embedded-cert.xml")

Show comments

[View file](/IdentityPython/pysaml2/blob/46578df0695269a16f1c94171f1429873f90ed99/tests/xmlsec1-keydata/signed-assertion-random-embedded-cert.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,47 @@ |
|  |  | <?xml version="1.0"?> |
|  |  | <samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="the-response-id" IssueInstant="2020-12-04T07:48:09.700Z" InResponseTo="id-abc" Destination="https://51.15.251.81.xip.io/acs/post"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <samlp:Status> |
|  |  | <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/> |
|  |  | </samlp:Status> |
|  |  | <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="the-assertion-id" IssueInstant="2020-12-04T07:48:09.600Z"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"> |
|  |  | <ds:SignedInfo> |
|  |  | <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/> |
|  |  | <ds:Reference URI="#the-assertion-id"> |
|  |  | <ds:Transforms> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | </ds:Transforms> |
|  |  | <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/> |
|  |  | <ds:DigestValue>NHB0WhPWj5OyRz9N52fZrEBWK3dXT2pVVT54f4kg1tM=</ds:DigestValue> |
|  |  | </ds:Reference> |
|  |  | </ds:SignedInfo> |
|  |  | <ds:SignatureValue>Mo4ZheAEDvdPQwWvT5SOYZZ2IBELwtmBpdsn+Th+IvsanychWQ6JHYKTI8hl+3DigbqQwdsqet8n9sfdvr+D+Q7XozjVaFPdzUGC9d96Mn/vrc+JIP/ESoDjDUQEsoSBhUFlrbu7tPJDJehPgd/maIwd/GqEHWXFlm1ZWVCmaH8=</ds:SignatureValue> |
|  |  | <ds:KeyInfo> |
|  |  | <ds:X509Data> |
|  |  | <ds:X509Certificate>MIIFLDCCBBSgAwIBAgISA3UxXAgBWRS1D74GOLiAjky6MA0GCSqGSIb3DQEBCwUAMDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJSMzAeFw0yMTAxMTcyMDIxNTNaFw0yMTA0MTcyMDIxNTNaMB4xHDAaBgNVBAMTEzUxLjE1LjI1MS44MS54aXAuaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDkjSN9vZDOwE1m7g1vyiwBsKBKNItyy05BcHUkM8fabBcsavugT8uE4wYz5aeZrnKb5dbDLHaZe6Dl5GHgRO8s7REwSJ/BHT3/eMaEakLwIGE5/6QSWuBjOawPfmYarW5IqoITjSt/o/jxu3haouqbr7XYf1WOuZmc6iwGnEgm0+cVB4CA0VGnnLYfsjp9iMt3pFI8a8ipdwp5lfzZU+j8JMVEn6SZhNjjTAjcakBQmZv4Q5/yU6yqfGjG47DO62xB/PPbDy78hDorER2v8UkoDTGV4aZrZaNltHBUxNohIiQnkhuakMmbf0NhA2ExBJw6KTCCxfYkyUX3CgYzaAnxAgMBAAGjggJOMIICSjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFHD7gcF0sNITPqhwcUlFyOBrkxRFMB8GA1UdIwQYMBaAFBQusxe3WFbLrlAJQOYfr52LFMLGMFUGCCsGAQUFBwEBBEkwRzAhBggrBgEFBQcwAYYVaHR0cDovL3IzLm8ubGVuY3Iub3JnMCIGCCsGAQUFBzAChhZodHRwOi8vcjMuaS5sZW5jci5vcmcvMB4GA1UdEQQXMBWCEzUxLjE1LjI1MS44MS54aXAuaW8wTAYDVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggrBgEFBQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwggEEBgorBgEEAdZ5AgQCBIH1BIHyAPAAdQBc3EOS/uarRUSxXprUVuYQN/vV+kfcoXOUsl7m9scOygAAAXcSOcqvAAAEAwBGMEQCIFhvPWYY+2VO55bHO1Sa9zJQk7B1kvCi7sfDCxAYp7mEAiBTKx6XD0GkfNGhji0LGuelvfD7gZOUSzURlJW1ahYcgQB3APZclC/RdzAiFFQYCDCUVo7jTRMZM7/fDC8gC8xO8WTjAAABdxI5yq4AAAQDAEgwRgIhAONNwcNZ66IxsWcUNDS0B9KV8Kk4VS9b/wUFNBHAQl3SAiEAxO5GwgaK3glL/6L/J7qpiedJBAs3h5406MWC0v4uYZ8wDQYJKoZIhvcNAQELBQADggEBAAZgbgfOb4+uI9kMGF4fMiompHeUFDXGyIND6y4FsfWHJG4Fn3aG+VQN/UtHeO8UusjS13/2yw3O+PeNTstBl+q6Ssega8zTYx2j3h3RFqM9JR8SWa83B0UTgyaxX3PTmfegV4/RZxC7KQ8pqjcLwKJSTgZF6W40Jo16tKVoi0VQY/2Gre6E9D1tPVw//mDGJST/5IcbFvtr79uft76IA+T674qNgAriBKxWncSbGzE42w2QsYsGMHHJn3vKbNl7alll9eJBqvdi1Q7ay86oI7NDQ0PPwjnB0/i4BOO0qQBcBSUIPPEChcrooEqN9PwM20aoyIjje0rtDGSxnEQRrg0=</ds:X509Certificate> |
|  |  | <ds:X509Certificate>MIIEZTCCA02gAwIBAgIQQAF1BIMUpMghjISpDBbN3zANBgkqhkiG9w0BAQsFADA/MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMTDkRTVCBSb290IENBIFgzMB4XDTIwMTAwNzE5MjE0MFoXDTIxMDkyOTE5MjE0MFowMjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxCzAJBgNVBAMTAlIzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuwIVKMz2oJTTDxLsjVWSw/iC8ZmmekKIp10mqrUrucVMsa+Oa/l1yKPXD0eUFFU1V4yeqKI5GfWCPEKpTm71O8Mu243AsFzzWTjn7c9p8FoLG77AlCQlh/o3cbMT5xys4Zvv2+Q7RVJFlqnBU840yFLuta7tj95gcOKlVKu2bQ6XpUA0ayvTvGbrZjR8+muLj1cpmfgwF126cm/7gcWt0oZYPRfH5wm78Sv3htzB2nFd1EbjzK0lwYi8YGd1ZrPxGPeiXOZT/zqItkel/xMY6pgJdz+dU/nPAeX1pnAXFK9jpP+Zs5Od3FOnBv5IhR2haa4ldbsTzFID9e1RoYvbFQIDAQABo4IBaDCCAWQwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwSwYIKwYBBQUHAQEEPzA9MDsGCCsGAQUFBzAChi9odHRwOi8vYXBwcy5pZGVudHJ1c3QuY29tL3Jvb3RzL2RzdHJvb3RjYXgzLnA3YzAfBgNVHSMEGDAWgBTEp7Gkeyxx+tvhS5B1/8QVYIWJEDBUBgNVHSAETTBLMAgGBmeBDAECATA/BgsrBgEEAYLfEwEBATAwMC4GCCsGAQUFBwIBFiJodHRwOi8vY3BzLnJvb3QteDEubGV0c2VuY3J5cHQub3JnMDwGA1UdHwQ1MDMwMaAvoC2GK2h0dHA6Ly9jcmwuaWRlbnRydXN0LmNvbS9EU1RST09UQ0FYM0NSTC5jcmwwHQYDVR0OBBYEFBQusxe3WFbLrlAJQOYfr52LFMLGMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjANBgkqhkiG9w0BAQsFAAOCAQEA2UzgyfWEiDcx27sT4rP8i2tiEmxYt0l+PAK3qB8oYevO4C5z70kHejWEHx2taPDY/laBL21/WKZuNTYQHHPD5b1tXgHXbnL7KqC401dk5VvCadTQsvd8S8MXjohyc9z9/G2948kLjmE6Flh9dDYrVYA9x2O+hEPGOaEOa1eePynBgPayvUfLqjBstzLhWVQLGAkXXmNs+5ZnPBxzDJOLxhF2JIbeQAcH5H0tZrUlo5ZYyOqA7s9pO5b85o3AM/OJ+CktFBQtfvBhcJVd9wvlwPsk+uyOy2HI7mNxKKgsBTt375teA2TwUdHkhVNcsAKX1H7GNNLOEADksd86wuoXvg==</ds:X509Certificate> |
|  |  | </ds:X509Data> |
|  |  | </ds:KeyInfo> |
|  |  | </ds:Signature> |
|  |  | <saml:Subject> |
|  |  | <saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">attack-name-id</saml:NameID> |
|  |  | <saml:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"> |
|  |  | <saml:SubjectConfirmationData NotOnOrAfter="2020-12-04T07:58:09.600Z" Recipient="https://51.15.251.81.xip.io/acs/post" InResponseTo="id-abc"/> |
|  |  | </saml:SubjectConfirmation> |
|  |  | </saml:Subject> |
|  |  | <saml:Conditions NotBefore="2020-12-04T07:48:09.600Z" NotOnOrAfter="2020-12-04T07:58:09.600Z"> |
|  |  | <saml:AudienceRestriction> |
|  |  | <saml:Audience>urn:mace:example.com:saml:roland:sp</saml:Audience> |
|  |  | </saml:AudienceRestriction> |
|  |  | </saml:Conditions> |
|  |  | <saml:AuthnStatement AuthnInstant="2020-12-04T07:48:09.600Z" SessionNotOnOrAfter="2020-12-04T07:58:09.600Z" SessionIndex="\_samling\_8227405\_474676521"> |
|  |  | <saml:AuthnContext> |
|  |  | <saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef> |
|  |  | </saml:AuthnContext> |
|  |  | </saml:AuthnStatement> |
|  |  | </saml:Assertion> |
|  |  | </samlp:Response> |

49 changes: 49 additions & 0 deletions

49
[tests/xmlsec1-keydata/signed-assertion-with-hmac.xml](#diff-9c34d7290378d079fccab3a2c85b42e909cd4d5e1286d63cafcf3f12ccba3fa4 "tests/xmlsec1-keydata/signed-assertion-with-hmac.xml")

Show comments

[View file](/IdentityPython/pysaml2/blob/46578df0695269a16f1c94171f1429873f90ed99/tests/xmlsec1-keydata/signed-assertion-with-hmac.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,49 @@ |
|  |  | <?xml version="1.0"?> |
|  |  | <samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="theresponse" IssueInstant="2020-12-04T07:48:09.700Z" InResponseTo="id-abc" Destination="https://example.org/acs/post"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <samlp:Status> |
|  |  | <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/> |
|  |  | </samlp:Status> |
|  |  | <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="theassertion" IssueInstant="2020-12-04T07:48:09.600Z"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"> |
|  |  | <ds:SignedInfo> |
|  |  | <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#hmac-sha1"/> |
|  |  | <ds:Reference URI="#theassertion"> |
|  |  | <ds:Transforms> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | </ds:Transforms> |
|  |  | <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/> |
|  |  | <ds:DigestValue>3eSifM9ENDpX4ore08DbmBaW3WrqLZMv57QMk0ACEPk=</ds:DigestValue> |
|  |  | </ds:Reference> |
|  |  | </ds:SignedInfo> |
|  |  | <ds:SignatureValue>8v8fec9UyJ5g/GcZmkrG3gQT/eI=</ds:SignatureValue> |
|  |  | <ds:KeyInfo> |
|  |  | <ds:KeyValue> |
|  |  | <HMACKeyValue xmlns="http://www.aleksey.com/xmlsec/2002">Rk9PCg==</HMACKeyValue> |
|  |  | </ds:KeyValue> |
|  |  | <ds:X509Data> |
|  |  | <ds:X509Certificate>MIICXgIBAAKBgQDJg2cms7MqjniT8Fi/XkNHZNPbNVQyMUMXE9tXOdqwYCA1cc8vQdzkihscQMXy3iPw2cMggBu6gjMTOSOxECkuvX5ZCclKr8pXAJM5cY6gVOaVO2PdTZcvDBKGbiaNefiEw5hnoZomqZGp8wHNLAUkwtH9vjqqvxyS/vclc6k2ewIDAQABAoGBAKD2emW6ssmyhfQ9ztYFuJ4FlwiJf5icKuf7L4BsMRgjoHawUvt/k69l9aPKxZNrB7BycV+7lOqU57FaOf1MWGeWzsU5bYUVpFzOVwsY4umtsO78QGKLZe+91Z+ktOlmL3scAymAgE88Jmr0g8FC46Vv4Sam7zMCtmOvA9fYog1ZAkEA8lAe+XihSuZI6IZcdRdB6QJ5cgAJoZdWKKtUovb5Ah2w4D/ebkfpsQJK44aSR5GbnrnqSaMeLJMRz++Td0edHwJBANTlUBzoo3ihcBOZ0VzGYgDIG8foCTEf3jDBYNYaY9RH/c4P50GkDa4PBqtf1f+VORwAsC2NTeY6HUEWMpvfXyUCQQChQ3FZ1k6B6oDbP5CI3NGgoWTx2dSPFojgyCWrz3IpVllA5UDDZFjC1SPCCO2Rc/Z9zH2ARG7we3B/UpJx79dBAkEAiPc6sk6NFQevpjyYcDqFRIF5NgQ3Ha6l8PIITdZOkXz7cX3Txuw3jNrH7KtMbxDe3AApWDUHf+21cnFIf/WWLQJAeG0KKBfZw1iRu9vlcYakGWRUSga78QDy08uHDtxQLXxOfSvm/y8N1KrEsXf/cJzHUGQJrqk8nLzR5mTRqnAZWA==</ds:X509Certificate> |
|  |  | </ds:X509Data> |
|  |  | </ds:KeyInfo> |
|  |  | </ds:Signature> |
|  |  | <saml:Subject> |
|  |  | <saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">attack-name-id</saml:NameID> |
|  |  | <saml:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"> |
|  |  | <saml:SubjectConfirmationData NotOnOrAfter="2020-12-04T07:58:09.600Z" Recipient="https://example.org/acs/post" InResponseTo="id-abc"/> |
|  |  | </saml:SubjectConfirmation> |
|  |  | </saml:Subject> |
|  |  | <saml:Conditions NotBefore="2020-12-04T07:48:09.600Z" NotOnOrAfter="2020-12-04T07:58:09.600Z"> |
|  |  | <saml:AudienceRestriction> |
|  |  | <saml:Audience>https://example.org/sp.xml</saml:Audience> |
|  |  | </saml:AudienceRestriction> |
|  |  | </saml:Conditions> |
|  |  | <saml:AuthnStatement AuthnInstant="2020-12-04T07:48:09.600Z" SessionNotOnOrAfter="2020-12-04T07:58:09.600Z" SessionIndex="\_samling\_8227405\_474676521"> |
|  |  | <saml:AuthnContext> |
|  |  | <saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef> |
|  |  | </saml:AuthnContext> |
|  |  | </saml:AuthnStatement> |
|  |  | </saml:Assertion> |
|  |  | </samlp:Response> |

49 changes: 49 additions & 0 deletions

49
[tests/xmlsec1-keydata/signed-response-with-hmac.xml](#diff-1b085899ee796f7fae58100cdd12fda341e792cd390b140ae0bc1fc53a5104e1 "tests/xmlsec1-keydata/signed-response-with-hmac.xml")

Show comments

[View file](/IdentityPython/pysaml2/blob/46578df0695269a16f1c94171f1429873f90ed99/tests/xmlsec1-keydata/signed-response-with-hmac.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,49 @@ |
|  |  | <?xml version="1.0"?> |
|  |  | <samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="theresponse" IssueInstant="2020-12-04T07:48:09.700Z" InResponseTo="id-abc" Destination="https://example.org/acs/post"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"> |
|  |  | <ds:SignedInfo> |
|  |  | <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#hmac-sha1"/> |
|  |  | <ds:Reference URI="#theresponse"> |
|  |  | <ds:Transforms> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/> |
|  |  | <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> |
|  |  | </ds:Transforms> |
|  |  | <ds:DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/> |
|  |  | <ds:DigestValue>/tLLJtWfBNGVGkPWs09wGxvKL/rPVWt5maNs9DWbHfQ=</ds:DigestValue> |
|  |  | </ds:Reference> |
|  |  | </ds:SignedInfo> |
|  |  | <ds:SignatureValue>iInSCge8AdweKTwZ9Z8P6e8Kb24=</ds:SignatureValue> |
|  |  | <ds:KeyInfo> |
|  |  | <ds:KeyValue> |
|  |  | <HMACKeyValue xmlns="http://www.aleksey.com/xmlsec/2002">Rk9PCg==</HMACKeyValue> |
|  |  | </ds:KeyValue> |
|  |  | <ds:X509Data> |
|  |  | <ds:X509Certificate>MIICXgIBAAKBgQDJg2cms7MqjniT8Fi/XkNHZNPbNVQyMUMXE9tXOdqwYCA1cc8vQdzkihscQMXy3iPw2cMggBu6gjMTOSOxECkuvX5ZCclKr8pXAJM5cY6gVOaVO2PdTZcvDBKGbiaNefiEw5hnoZomqZGp8wHNLAUkwtH9vjqqvxyS/vclc6k2ewIDAQABAoGBAKD2emW6ssmyhfQ9ztYFuJ4FlwiJf5icKuf7L4BsMRgjoHawUvt/k69l9aPKxZNrB7BycV+7lOqU57FaOf1MWGeWzsU5bYUVpFzOVwsY4umtsO78QGKLZe+91Z+ktOlmL3scAymAgE88Jmr0g8FC46Vv4Sam7zMCtmOvA9fYog1ZAkEA8lAe+XihSuZI6IZcdRdB6QJ5cgAJoZdWKKtUovb5Ah2w4D/ebkfpsQJK44aSR5GbnrnqSaMeLJMRz++Td0edHwJBANTlUBzoo3ihcBOZ0VzGYgDIG8foCTEf3jDBYNYaY9RH/c4P50GkDa4PBqtf1f+VORwAsC2NTeY6HUEWMpvfXyUCQQChQ3FZ1k6B6oDbP5CI3NGgoWTx2dSPFojgyCWrz3IpVllA5UDDZFjC1SPCCO2Rc/Z9zH2ARG7we3B/UpJx79dBAkEAiPc6sk6NFQevpjyYcDqFRIF5NgQ3Ha6l8PIITdZOkXz7cX3Txuw3jNrH7KtMbxDe3AApWDUHf+21cnFIf/WWLQJAeG0KKBfZw1iRu9vlcYakGWRUSga78QDy08uHDtxQLXxOfSvm/y8N1KrEsXf/cJzHUGQJrqk8nLzR5mTRqnAZWA==</ds:X509Certificate> |
|  |  | </ds:X509Data> |
|  |  | </ds:KeyInfo> |
|  |  | </ds:Signature> |
|  |  | <samlp:Status> |
|  |  | <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/> |
|  |  | </samlp:Status> |
|  |  | <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0" ID="theassertion" IssueInstant="2020-12-04T07:48:09.600Z"> |
|  |  | <saml:Issuer>urn:mace:example.com:saml:roland:idp</saml:Issuer> |
|  |  | <saml:Subject> |
|  |  | <saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">attack-name-id</saml:NameID> |
|  |  | <saml:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"> |
|  |  | <saml:SubjectConfirmationData NotOnOrAfter="2020-12-04T07:58:09.600Z" Recipient="https://example.org/acs/post" InResponseTo="id-abc"/> |
|  |  | </saml:SubjectConfirmation> |
|  |  | </saml:Subject> |
|  |  | <saml:Conditions NotBefore="2020-12-04T07:48:09.600Z" NotOnOrAfter="2020-12-04T07:58:09.600Z"> |
|  |  | <saml:AudienceRestriction> |
|  |  | <saml:Audience>https://example.org/sp.xml</saml:Audience> |
|  |  | </saml:AudienceRestriction> |
|  |  | </saml:Conditions> |
|  |  | <saml:AuthnStatement AuthnInstant="2020-12-04T07:48:09.600Z" SessionNotOnOrAfter="2020-12-04T07:58:09.600Z" SessionIndex="\_samling\_8227405\_474676521"> |
|  |  | <saml:AuthnContext> |
|  |  | <saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml:AuthnContextClassRef> |
|  |  | </saml:AuthnContext> |
|  |  | </saml:AuthnStatement> |
|  |  | </saml:Assertion> |
|  |  | </samlp:Response> |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `46578df`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Fcommit%2F46578df0695269a16f1c94171f1429873f90ed99) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c67a593c_20250115_113135.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Fsecurity%2Fadvisories%2FGHSA-5p3x-r448-pc62)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIdentityPython%2Fpysaml2%2Fsecurity%2Fadvisories%2FGHSA-5p3x-r448-pc62)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=IdentityPython%2Fpysaml2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[IdentityPython](/IdentityPython)
/
**[pysaml2](/IdentityPython/pysaml2)**
Public

* [Notifications](/login?return_to=%2FIdentityPython%2Fpysaml2) You must be signed in to change notification settings
* [Fork
  426](/login?return_to=%2FIdentityPython%2Fpysaml2)
* [Star
   571](/login?return_to=%2FIdentityPython%2Fpysaml2)

* [Code](/IdentityPython/pysaml2)
* [Issues
  84](/IdentityPython/pysaml2/issues)
* [Pull requests
  33](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

Additional navigation options

* [Code](/IdentityPython/pysaml2)
* [Issues](/IdentityPython/pysaml2/issues)
* [Pull requests](/IdentityPython/pysaml2/pulls)
* [Actions](/IdentityPython/pysaml2/actions)
* [Security](/IdentityPython/pysaml2/security)
* [Insights](/IdentityPython/pysaml2/pulse)

# Unspecified xmlsec1 key-type preference

Critical

[c00kiemon5ter](/c00kiemon5ter)
published
GHSA-5p3x-r448-pc62
Jan 20, 2021

## Package

pysaml2
(pypi)

## Affected versions

<= 6.4.1

## Patched versions

6.5.0

## Description

### Impact

All users of pysaml2 that use the default `CryptoBackendXmlSec1` backend and need to verify signed SAML documents are impacted. `pysaml2 <= 6.4.1` does not ensure that a signed SAML document is correctly signed. The default `CryptoBackendXmlSec1` backend is using the `xmlsec1` binary to verify the signature of signed SAML documents, but by default, `xmlsec1` accepts any type of key found within the given document. `xmlsec1` needs to be configured explicitly to only use only *x509 certificates* for the verification process of the SAML document signature.

### Patches

Users should upgrade to pysaml2 `v6.5.0`.

### Workarounds

No workaround provided at this point.

### References

This issue has been reported in the past at the xmlsec1 mailing list:

<https://www.aleksey.com/pipermail/xmlsec/2013/009717.html>

### Credits

* Brian Wolff

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [pysaml2](https://github.com/IdentityPython/pysaml2)
* Email us at the incident-response address

### Severity

Critical

### CVE ID

CVE-2021-21239

### Weaknesses

No CWEs

### Credits

* [![@bawolff](https://avatars.githubusercontent.com/u/6529932?s=40&v=4)](/bawolff)
  [bawolff](/bawolff)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from pypi.org_45f48ba2_20250114_184730.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn’t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from lists.debian.org_18758b8b_20250114_184729.html ===


---

[[Date Prev](msg00037.html)][Date Next]
[[Thread Prev](msg00037.html)][Thread Next]
[[Date Index](maillist.html#00038)]
[[Thread Index](threads.html#00038)]

# [SECURITY] [DLA 2577-1] python-pysaml2 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2577-1] python-pysaml2 security update
* *From*: Abhijith PA <abhijith@debian.org>
* *Date*: Fri, 26 Feb 2021 10:35:51 +0530
* *Message-id*: <[[🔎]](/msgid-search/YDiBr9FikZXNm%2BbK%40disroot.org) [YDiBr9FikZXNm+bK@disroot.org](msg00038.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2577-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Abhijith PA
February 26, 2021                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : python-pysaml2
Version        : 3.0.0-5+deb9u2
CVE ID         : CVE-2017-1000433 CVE-2021-21239
Debian Bug     : 886423 CVE-2021-21239

Several issues have been found in python-pysaml2, a pure python
implementation of SAML Version 2 Standard.

CVE-2017-1000433

     pysaml2 accept any password when run with python optimizations
     enabled. This allows attackers to log in as any user without
     knowing their password.

CVE-2021-21239

     pysaml2 has an improper verification of cryptographic signature
     vulnerability. Users of pysaml2 that use the default
     CryptoBackendXmlSec1 backend and need to verify signed SAML
     documents are impacted. PySAML2 does not ensure that a signed
     SAML document is correctly signed. The default
     CryptoBackendXmlSec1 backend is using the xmlsec1 binary to
     verify the signature of signed SAML documents, but by default
     xmlsec1 accepts any type of key found within the given document.
     xmlsec1 needs to be configured explicitly to only use only _x509
     certificates_ for the verification process of the SAML document signature.

For Debian 9 stretch, these problems have been fixed in version
3.0.0-5+deb9u2.

We recommend that you upgrade your python-pysaml2 packages.

For the detailed security status of python-pysaml2 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/python-pysaml2>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEE7xPqJqaY/zX9fJAuhj1N8u2cKO8FAmA4ga8ACgkQhj1N8u2c
KO/LTA//eEbx/AXF6YAQIhqpf7iJ/i3EiOWAPupCQWPdj3c8YPEi6iHmWS1ilka+
pNhll5fl/QmYrUUojKIr3915XWCcElzUVVfS5pfoZD7ZoC06E8fEPuC0RYDMPp3d
+q4LlDFgEVgbG502lOCARj370VFZ/D1vK/jVYe9/ZH4CXlRFxVCLQl7oXFOK2l2s
UGqGxQa0J1ROSHoazYuUL521opW/RWHKJvcjkT8OLRn/f0n8HUxQT3PEyP2VZ4Pz
jtms+BjOfbbZbCGIzY9hW1TF97gWOXErwUwNoRt2jAqOKhDZmuXExSxNhLtGYs1y
SyDvR8bmOZYQNJJRVn5KuvsVvoHm1NLXx1CczF+3STb+6dprTqAvtawGjjJ7DykJ
ATcroKRXrUZ/YRsTNNSkqUDEIZ5NC0/jxXreZVfC0+SXpWUokuY7V2p3nPgL6IQj
xrvmkohG+kdzG9t/6HAOHmwSrNf38FVfOxkvt+3AAdXcw1169u9ZqJGETjpzvctj
AAKMJSWBVrhTYqK9ICli+0P47nqPB4h2Lvm0U1E/OxuSjxcXi+2VKURq6AIv5QRW
D8hcxAFSxpT49L+F2iU2UKzF6eZSG2xl/lcZAnavd+Fw/DmrT34qv57oLm+VWckJ
l5rrWXUSOO/vEE/xtriCb9solgP9nDG7c9+w6Uh9plFVzgPn+T8=
=GU8r
-----END PGP SIGNATURE-----

```

---


