Based on the provided content, here's an analysis of CVE-2021-21246:

**Root cause of vulnerability:**
The vulnerability stems from a missing security check in the `/users/{id}` REST API endpoint of the `UserResource` in OneDev. While the `/users/` endpoint correctly enforces administrator-only access, the `/users/{id}` endpoint lacks any authorization checks, allowing unauthenticated access to user details.

**Weaknesses/vulnerabilities present:**
- **Missing Authorization Check:** The primary weakness is the absence of a security check on the `/users/{id}` endpoint, which allows unauthorized access to user information.
- **Sensitive Data Exposure:** The API returns full user details, including sensitive access tokens, when accessed.

**Impact of exploitation:**
- **Sensitive Data Leak:** Attackers can obtain user access tokens through the vulnerable endpoint.
- **Account Impersonation:** The leaked access tokens can be used to impersonate the compromised user, granting access to their projects and potentially leading to further unauthorized actions.
- **Code Access:** The leaked tokens can be used to clone code via HTTP(S) protocol in the build spec.
- **Privilege Escalation:** If the compromised user is an administrator, the attacker can gain full control over the application.

**Attack vectors:**
- **Direct API Access:** Attackers can directly send GET requests to the `/users/{id}` endpoint via HTTP(S) to retrieve user information.

**Required attacker capabilities/position:**
- **Network Access:** The attacker needs network access to the OneDev server hosting the vulnerable API.
- **No authentication required:** The attacker does not need to authenticate or have any user credentials for accessing the vulnerable endpoint.

**Additional Notes:**
- The fix for this vulnerability involves removing user info from the restful api.
- The advisory indicates that the vulnerability was discovered by @pwntester.
- The vulnerability is considered "Critical".
- The affected versions are < 4.0.2 and the patched version is 4.0.3.