=== Content from github.com_7a5e1aac_20250114_182758.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-5wrh-4jwv-5w78)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-5wrh-4jwv-5w78)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# IP blacklist bypass via transitional IPv6 addresses on dual-stack networks

Moderate

[richvdh](/richvdh)
published
GHSA-5wrh-4jwv-5w78
Apr 12, 2021

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.28.0

## Patched versions

>= 1.28.0

## Description

### Impact

Requests to user provided domains were not restricted to external IP addresses when transitional IPv6 addresses were used. Outbound requests to federation, identity servers, when calculating the key validity for third-party invite events, sending push notifications, and generating URL previews are affected. This could cause Synapse to make requests to internal infrastructure on dual-stack networks.

### Patches

This issue is fixed by [#9240](https://github.com/matrix-org/synapse/pull/9240).

### Workarounds

Outbound requests to the following address ranges can be blocked by a firewall, if unused for internal communication between systems:

* `::ffff/80`
* `::0000/80` (note that this IP range is considered deprecated by the IETF)
* `2002::/16` (note that this IP range is considered deprecated by the IETF)

### References

* [RFC3056](https://tools.ietf.org/html/rfc3056)
* [RFC4291](https://tools.ietf.org/html/rfc4291)

### Severity

Moderate

### CVE ID

CVE-2021-21392

### Weaknesses

No CWEs

### Credits

* [![@mscherer](https://avatars.githubusercontent.com/u/230335?s=40&v=4)](/mscherer)
  [mscherer](/mscherer)
  Analyst

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from lists.fedoraproject.org_ad82ac63_20250114_182759.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

Ã—
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY.mbox.gz?message=TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

# [SECURITY] Fedora 34 Update: matrix-synapse-1.38.1-1.fc34

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesï¼ fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesï¼ fedoraproject.org")

1 Aug
2021

1 Aug
'21

9:05 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-a627cfd31e
2021-08-02 01:02:57.308573
--------------------------------------------------------------------------------

Name : matrix-synapse
Product : Fedora 34
Version : 1.38.1
Release : 1.fc34
URL : <https://github.com/matrix-org/synapse>
Summary : A Matrix reference homeserver written in Python using Twisted
Description :
Matrix is an ambitious new ecosystem for open federated Instant Messaging and
VoIP. Synapse is a reference "homeserver" implementation of Matrix from the
core development team at matrix.org, written in Python/Twisted. It is intended
to showcase the concept of Matrix and let folks see the spec in the context of
a coded base and let you run your own homeserver and generally help bootstrap
the ecosystem.

--------------------------------------------------------------------------------
Update Information:

Update to v1.38.1 ---- New upstream release 1.38.0, incorporating a number of
important security fixes. Upstream changelog: <https://github.com/matrix->
org/synapse/blob/v1.38.0/CHANGES.md Upstream upgrade notes: <https://matrix->
org.github.io/synapse/develop/upgrade#upgrading-to-v1380
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Jul 23 2021 Kai A. Hiller V02460@gmail.com - 1.38.1-1
- Update to v1.38.1
\* Thu Jul 22 2021 Fedora Release Engineering releng@fedoraproject.org - 1.38.0-3
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_35_Mass_Rebuild>
\* Sun Jul 18 2021 Dan Callaghan djc@djc.id.au - 1.38.0-2
- fix startup ordering of synapse.service (RHBZ#1910740)
- relax version requirement for python3-cryptography
\* Wed Jul 14 2021 Kai A. Hiller V02460@gmail.com - 1.38.0-1
- Update to v1.38.0
\* Fri Jun 4 2021 Python Maint python-maint@redhat.com - 1.26.0-3
- Rebuilt for Python 3.10
\* Tue Mar 2 2021 Zbigniew Jï¿½ï¿½drzejewski-Szmek zbyszek@in.waw.pl - 1.26.0-2
- Rebuilt for updated systemd-rpm-macros
See <https://pagure.io/fesco/issue/2583>.
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1910740 - synapse.service can fail if it starts before postgresql is ready
<https://bugzilla.redhat.com/show_bug.cgi?id=1910740>
[ 2 ] Bug #1918426 - matrix-synapse-1.38.0 is available
<https://bugzilla.redhat.com/show_bug.cgi?id=1918426>
[ 3 ] Bug #1934603 - CVE-2021-21274 matrix-synapse: DoS via .well-known lookups [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934603>
[ 4 ] Bug #1934606 - CVE-2021-21273 matrix-synapse: open redirects on some federation and push requests [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934606>
[ 5 ] Bug #1944136 - CVE-2021-21332 matrix-synapse: password reset endpoint is vulnerable to XSS [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944136>
[ 6 ] Bug #1944139 - CVE-2021-21333 matrix-synapse: HTML injection in email and account expiry notifications [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944139>
[ 7 ] Bug #1949110 - CVE-2021-21393 matrix-synapse: Denial of service (via resource exhaustion) due to improper input validation on groups/communities endpoints [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949110>
[ 8 ] Bug #1949112 - CVE-2021-21392 matrix-synapse: IP blacklist bypass via transitional IPv6 addresses on dual-stack networks [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949112>
[ 9 ] Bug #1958801 - CVE-2021-21394 matrix-synapse: missing input validation may cause excessive use of disk space and memory [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1958801>
[ 10 ] Bug #1959542 - CVE-2021-29471 matrix-synapse: Denial-of-service when processing moderate length events [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1959542>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-a627cfd31e' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from pypi.org_362695ea_20250114_182800.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldnâ€™t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from github.com_4bd5997d_20250114_182755.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9240)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9240)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Convert blacklisted IPv4 addresses to compatible IPv6 addresses. #9240

 Merged

[clokep](/clokep)
merged 9 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/ips-update](/matrix-org/synapse/tree/clokep/ips-update "matrix-org/synapse:clokep/ips-update")

Feb 3, 2021

 Merged

# [Convert blacklisted IPv4 addresses to compatible IPv6 addresses.](#top) #9240

[clokep](/clokep)
merged 9 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/ips-update](/matrix-org/synapse/tree/clokep/ips-update "matrix-org/synapse:clokep/ips-update")

Feb 3, 2021

[Conversation
18](/matrix-org/synapse/pull/9240)
[Commits
9](/matrix-org/synapse/pull/9240/commits)
[Checks
0](/matrix-org/synapse/pull/9240/checks)
[Files changed](/matrix-org/synapse/pull/9240/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Jan 27, 2021](#issue-795104320) â€¢ edited Loading

This automatically converts IPv4 addresses to some obscure IPv6 address ranges:

* IPv6 with embedded IPv4
* IPv4-compatible IPv6
* 6to4 addresses

This expands on some of the conversation in [#8870 (comment)](https://github.com/matrix-org/synapse/pull/8870#discussion_r535485437).

~~An alternative approach to this would be to automatically do these conversions for any IPv4 addresses that get blocked at runtime, not just for the default.~~ This approach is now taken.

Sorry, something went wrong.

All reactions

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Deny access to additional IP addresses by default.](/matrix-org/synapse/pull/9240/commits/ad1ac2a15b015c46b2110f54b82dae3fe02c2ab7 "Deny access to additional IP addresses by default.

Including IPv6 with embedded IPv4, IPv4-compatible IPv6, and 6to4
addresses.")`
 â€¦

`[ad1ac2a](/matrix-org/synapse/pull/9240/commits/ad1ac2a15b015c46b2110f54b82dae3fe02c2ab7)`

```
Including IPv6 with embedded IPv4, IPv4-compatible IPv6, and 6to4
addresses.
```

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
[force-pushed](/matrix-org/synapse/compare/3e45f46998159503246d66d55189d852bb9eca0c..ad1ac2a15b015c46b2110f54b82dae3fe02c2ab7)
the
clokep/ips-update

branch
from
[`3e45f46`](/matrix-org/synapse/commit/3e45f46998159503246d66d55189d852bb9eca0c) to
[`ad1ac2a`](/matrix-org/synapse/commit/ad1ac2a15b015c46b2110f54b82dae3fe02c2ab7)  [Compare](/matrix-org/synapse/compare/3e45f46998159503246d66d55189d852bb9eca0c..ad1ac2a15b015c46b2110f54b82dae3fe02c2ab7)
[January 27, 2021 13:32](#event-4255873576)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested review from
a team
and removed request for
a team
[January 27, 2021 13:34](#event-4255879779)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Jan 27, 2021](#issuecomment-768296970)

| An alternative approach to this would be to automatically do these conversions for any IPv4 addresses that get blocked at runtime, not just for the default.  From some chatter I think we're going to switch to this instead. |
| --- |

All reactions

Sorry, something went wrong.

 [clokep](/clokep)
added 2 commits
[January 27, 2021 13:05](#commits-pushed-4e1c7bb)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Apply additional IPv6 to custom blacklists.](/matrix-org/synapse/pull/9240/commits/4e1c7bbb311caa7dde8c1b98f774da7cb5668ddf "Apply additional IPv6 to custom blacklists.")`

`[4e1c7bb](/matrix-org/synapse/pull/9240/commits/4e1c7bbb311caa7dde8c1b98f774da7cb5668ddf)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add better configuration errors.](/matrix-org/synapse/pull/9240/commits/b959dfc149e219a93cb837910812c1573a20a3a0 "Add better configuration errors.")`

`[b959dfc](/matrix-org/synapse/pull/9240/commits/b959dfc149e219a93cb837910812c1573a20a3a0)`

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
commented
[Jan 27, 2021](#pullrequestreview-577627540)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/b959dfc149e219a93cb837910812c1573a20a3a0)

[synapse/config/server.py](/matrix-org/synapse/pull/9240/files/b959dfc149e219a93cb837910812c1573a20a3a0#diff-ed5d3e39ad2209c1ac0dbeb3592493fd1f196491b7181e3d35b95b91930b3df6)

Show resolved

Hide resolved

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[January 27, 2021 18:18](#event-4257310710)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
changed the title
~~Deny access to additional IP addresses by default.~~
Convert blacklisted IPv4 addresses to compatible IPv6 addresses.
[Jan 27, 2021](#event-4258110661)

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Jan 28, 2021](#pullrequestreview-578260791)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/b959dfc149e219a93cb837910812c1573a20a3a0)

[synapse/config/server.py](/matrix-org/synapse/pull/9240/files/b959dfc149e219a93cb837910812c1573a20a3a0#diff-ed5d3e39ad2209c1ac0dbeb3592493fd1f196491b7181e3d35b95b91930b3df6)

|  |  | result.add(network) |
| --- | --- | --- |
|  |  |  |
|  |  | # It is possible that these already exist in the set, but that's OK. |
|  |  | if ":" not in str(network): |

Copy link

Member

### @erikjohnston **[erikjohnston](/erikjohnston)** [Jan 28, 2021](#discussion_r566039090)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

*How* is there not a `network.is_ipv4()`???

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Jan 28, 2021](#discussion_r566073451)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think because every IPv4 network is technically an IPv6 network too since all of IPv4 is included in IPv6? ðŸ¤·

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Jan 28, 2021](#discussion_r566073963)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So really all of this works around a bug in netaddr that it doesn't understand the different forms of IPv6 addresses really encompass the same networks as the IPv4 ones. ðŸ¤·

Sorry, something went wrong.

All reactions

Copy link

Member

### @erikjohnston **[erikjohnston](/erikjohnston)** [Jan 28, 2021](#discussion_r566097504)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

ðŸ¤·

Sorry, something went wrong.

All reactions

[synapse/config/server.py](/matrix-org/synapse/pull/9240/files/b959dfc149e219a93cb837910812c1573a20a3a0#diff-ed5d3e39ad2209c1ac0dbeb3592493fd1f196491b7181e3d35b95b91930b3df6)

Show resolved

Hide resolved

 [clokep](/clokep)
added 3 commits
[February 1, 2021 17:16](#commits-pushed-fdd6e40)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Update blacklist for 0.0.0.0.](/matrix-org/synapse/pull/9240/commits/fdd6e40f9b6a5f2fd0749a31aa36625784726351 "Update blacklist for 0.0.0.0.")`

`[fdd6e40](/matrix-org/synapse/pull/9240/commits/fdd6e40f9b6a5f2fd0749a31aa36625784726351)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/ips-update](/matrix-org/synapse/pull/9240/commits/b865d41e8e6bb44279d886850743901a0d52fa90 "Merge remote-tracking branch 'origin/develop' into clokep/ips-update")`

`[b865d41](/matrix-org/synapse/pull/9240/commits/b865d41e8e6bb44279d886850743901a0d52fa90)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add additional IP ranges.](/matrix-org/synapse/pull/9240/commits/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5 "Add additional IP ranges.")`

`[e424dc3](/matrix-org/synapse/pull/9240/commits/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Feb 1, 2021](#issuecomment-771205410)

| Based on <https://en.wikipedia.org/wiki/Reserved_IP_addresses> I also added a few more IP ranges for testing networks and IPv6 multicast (which doesn't make sense). |
| --- |

All reactions

Sorry, something went wrong.

[![dkasak](https://avatars.githubusercontent.com/u/463342?s=60&v=4)](/dkasak)

**[dkasak](/dkasak)**
suggested changes
[Feb 2, 2021](#pullrequestreview-581184892)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5)

[synapse/config/server.py](/matrix-org/synapse/pull/9240/files/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5#diff-ed5d3e39ad2209c1ac0dbeb3592493fd1f196491b7181e3d35b95b91930b3df6)

Show resolved

Hide resolved

[docs/sample\_config.yaml](/matrix-org/synapse/pull/9240/files/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)

Show resolved

Hide resolved

[docs/sample\_config.yaml](/matrix-org/synapse/pull/9240/files/e424dc3433ebbaa60b1fcf6d23675435cbfb96f5#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)

Show resolved

Hide resolved

 [clokep](/clokep)
and others
added 2 commits
[February 2, 2021 07:15](#commits-pushed-fe51f65)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Apply suggestions from code review](/matrix-org/synapse/pull/9240/commits/fe51f658a7fbfd1685a037504e947111908b6f9f "Apply suggestions from code review

Co-authored-by: Denis Kasak <dkasak@termina.org.uk>")`
 â€¦

`[fe51f65](/matrix-org/synapse/pull/9240/commits/fe51f658a7fbfd1685a037504e947111908b6f9f)`

```
Co-authored-by: Denis Kasak <dkasak@termina.org.uk>
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Revert "Update blacklist for 0.0.0.0."](/matrix-org/synapse/pull/9240/commits/b155953dd8e201bcceede794995a48e89c2b691d "Revert \"Update blacklist for 0.0.0.0.\"

This reverts commit fdd6e40f9b6a5f2fd0749a31aa36625784726351.

This causes ::1 to always be blacklisted and breaks Docker.")`
 â€¦

`[b155953](/matrix-org/synapse/pull/9240/commits/b155953dd8e201bcceede794995a48e89c2b691d)`

```
This reverts commit [fdd6e40](https://github.com/matrix-org/synapse/commit/fdd6e40f9b6a5f2fd0749a31aa36625784726351).

This causes ::1 to always be blacklisted and breaks Docker.
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Feb 2, 2021](#issuecomment-771887587)

| [@dkasak](https://github.com/dkasak) / [@erikjohnston](https://github.com/erikjohnston) Are we happy with the current bit of this PR? I think it is in good shape now. |
| --- |

All reactions

Sorry, something went wrong.

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Feb 2, 2021](#pullrequestreview-581673534)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/b155953dd8e201bcceede794995a48e89c2b691d)

Copy link

Member

### @erikjohnston **[erikjohnston](/erikjohnston)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Code looks fine, I think the ip ranges makes sense, but let's wait for [@dkasak](https://github.com/dkasak) to confirm

Sorry, something went wrong.

All reactions

 [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&u=bc841c19ba33f4e3b66732ec1ebf9f3c8cd64b8e&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
requested a review
from [dkasak](/dkasak)
[February 2, 2021 18:58](#event-4281101601)

[![dkasak](https://avatars.githubusercontent.com/u/463342?s=60&v=4)](/dkasak)

**[dkasak](/dkasak)**
suggested changes
[Feb 2, 2021](#pullrequestreview-581685794)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/b155953dd8e201bcceede794995a48e89c2b691d)

Copy link

Member

### @dkasak **[dkasak](/dkasak)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks good to me too, apart from two minor things.

(do we Approve or Request changes in such scenarios?)

Sorry, something went wrong.

All reactions

[synapse/config/repository.py](/matrix-org/synapse/pull/9240/files/b155953dd8e201bcceede794995a48e89c2b691d#diff-93cc7d2bb16bade8a31d19c3f919055b5c93490fb5ab935c5486aeb87178f335)
Outdated

Show resolved

Hide resolved

[synapse/config/server.py](/matrix-org/synapse/pull/9240/files/b155953dd8e201bcceede794995a48e89c2b691d#diff-ed5d3e39ad2209c1ac0dbeb3592493fd1f196491b7181e3d35b95b91930b3df6)
Outdated

Show resolved

Hide resolved

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

`[Fix copy and paste errors](/matrix-org/synapse/pull/9240/commits/48648d97dae371341b3a21a9ed9eb570f4884d6e "Fix copy and paste errors

Co-authored-by: Denis Kasak <dkasak@termina.org.uk>")`
 â€¦

`[48648d9](/matrix-org/synapse/pull/9240/commits/48648d97dae371341b3a21a9ed9eb570f4884d6e)`

```
Co-authored-by: Denis Kasak <dkasak@termina.org.uk>
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Feb 2, 2021](#issuecomment-771928692)

| Looks good to me too, apart from two minor things.  Good catches!  (do we Approve or Request changes in such scenarios?)  My rule of thumb is request changes if you want to look at them again before they get merged; approve if you're OK with the author making the changes and merging. |
| --- |

 ðŸ‘
1
 dkasak reacted with thumbs up emoji

All reactions

* ðŸ‘
  1 reaction

Sorry, something went wrong.

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from [dkasak](/dkasak)
[February 2, 2021 19:47](#event-4281336151)

[![dkasak](https://avatars.githubusercontent.com/u/463342?s=60&v=4)](/dkasak)

**[dkasak](/dkasak)**
approved these changes
[Feb 2, 2021](#pullrequestreview-581716634)

 [View reviewed changes](/matrix-org/synapse/pull/9240/files/48648d97dae371341b3a21a9ed9eb570f4884d6e)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`4ca054a`](/matrix-org/synapse/commit/4ca054a4eaa714d0befb4fc30b19a1131e52c9cc)
into
develop

[Feb 3, 2021](https://github.com/matrix-org/synapse/pull/9240#event-4284911758)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/ips-update

branch
[February 3, 2021 12:13](#event-4284911818)

[clokep](/clokep)
added a commit
that referenced
this pull request
[Feb 19, 2021](#ref-commit-d9f1dcc)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

`[Merge tag 'v1.28.0rc1' into develop](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8 "Merge tag 'v1.28.0rc1' into develop

Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))")`
â€¦

`[d9f1dcc](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8)`

```
Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\[#9150](https://github.com/matrix-org/synapse/pull/9150)]([#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\[#9300](https://github.com/matrix-org/synapse/pull/9300)]([#9300](https://github.com/matrix-org/synapse/pull/9300)), [\[#9301](https://github.com/matrix-org/synapse/pull/9301)]([#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\[#9311](https://github.com/matrix-org/synapse/pull/9311)]([#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\[#9376](https://github.com/matrix-org/synapse/pull/9376)]([#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\[#9400](https://github.com/matrix-org/synapse/pull/9400)]([#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\[#9257](https://github.com/matrix-org/synapse/pull/9257)]([#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\[#9296](https://github.com/matrix-org/synapse/pull/9296)]([#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\[#9321](https://github.com/matrix-org/synapse/pull/9321)]([#9321](https://github.com/matrix-org/synapse/pull/9321)), [\[#9393](https://github.com/matrix-org/synapse/pull/9393)]([#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\[#9333](https://github.com/matrix-org/synapse/pull/9333)]([#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\[#9361](https://github.com/matrix-org/synapse/pull/9361)]([#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\[#9391](https://github.com/matrix-org/synapse/pull/9391)]([#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\[#9395](https://github.com/matrix-org/synapse/pull/9395)]([#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\[#9421](https://github.com/matrix-org/synapse/pull/9421)]([#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\[#9425](https://github.com/matrix-org/synapse/pull/9425)]([#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\[#9426](https://github.com/matrix-org/synapse/pull/9426)]([#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\[#9428](https://github.com/matrix-org/synapse/pull/9428)]([#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\[#9433](https://github.com/matrix-org/synapse/pull/9433)]([#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\[#9281](https://github.com/matrix-org/synapse/pull/9281)]([#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\[#9291](https://github.com/matrix-org/synapse/pull/9291)]([#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\[#9308](https://github.com/matrix-org/synapse/pull/9308)]([#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\[#9317](https://github.com/matrix-org/synapse/pull/9317)]([#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\[#9322](https://github.com/matrix-org/synapse/pull/9322)]([#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\[#9390](https://github.com/matrix-org/synapse/pull/9390)]([#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\[#9404](https://github.com/matrix-org/synapse/pull/9404)]([#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\[#9407](https://github.com/matrix-org/synapse/pull/9407)]([#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\[#9434](https://github.com/matrix-org/synapse/pull/9434)]([#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\[#9429](https://github.com/matrix-org/synapse/pull/9429)]([#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\[#9003](https://github.com/matrix-org/synapse/pull/9003)]([#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\[#9123](https://github.com/matrix-org/synapse/pull/9123)]([#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\[#9240](https://github.com/matrix-org/synapse/pull/9240)]([#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\[#9299](https://github.com/matrix-org/synapse/pull/9299)]([#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\[#9305](https://github.com/matrix-org/synapse/pull/9305)]([#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\[#9307](https://github.com/matrix-org/synapse/pull/9307)]([#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\[#9326](https://github.com/matrix-org/synapse/pull/9326)]([#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\[#9362](https://github.com/matrix-org/synapse/pull/9362)]([#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\[#9377](https://github.com/matrix-org/synapse/pull/9377)]([#9377](https://github.com/matrix-org/synapse/pull/9377)), [\[#9396](https://github.com/matrix-org/synapse/pull/9396)]([#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\[#9381](https://github.com/matrix-org/synapse/pull/9381)]([#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\[#9384](https://github.com/matrix-org/synapse/pull/9384)]([#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\[#9394](https://github.com/matrix-org/synapse/pull/9394)]([#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\[#9408](https://github.com/matrix-org/synapse/pull/9408)]([#9408](https://github.com/matrix-org/synapse/pull/9408)))
```

[Half-Shot](/Half-Shot)
pushed a commit
that referenced
this pull request
[Feb 20, 2021](#ref-commit-f85823a)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep) [![@Half-Shot](https://avatars.githubusercontent.com/u/2072976?s=40&v=4)](/Half-Shot)

`[Convert blacklisted IPv4 addresses to compatible IPv6 addresses. (](/matrix-org/synapse/commit/f85823adba74735e59b75ee7b8c67f9d44019e51 "Convert blacklisted IPv4 addresses to compatible IPv6 addresses. (#9240)

Also add a few more IP ranges to the default blacklist.")[#9240](https://github.com/matrix-org/synapse/pull/9240)[)](/matrix-org/synapse/commit/f85823adba74735e59b75ee7b8c67f9d44019e51 "Convert blacklisted IPv4 addresses to compatible IPv6 addresses. (#9240)

Also add a few more IP ranges to the default blacklist.")`
â€¦

`[f85823a](/matrix-org/synapse/commit/f85823adba74735e59b75ee7b8c67f9d44019e51)`

```
Also add a few more IP ranges to the default blacklist.
```

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Mar 6, 2021](#ref-commit-31d3054)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.28.0](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2 "Update chat/matrix-synapse to 1.28.0

Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474](https://github.com/matrix-org/synapse/issues/9474))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache â”€ as well as a pub/sub mechanism â”€ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405](https://github.com/matrix-org/synapse/issues/9405))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297](https://github.com/matrix-org/synapse/issues/9297))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302](https://github.com/matrix-org/synapse/issues/9302))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313](https://github.com/matrix-org/synapse/issues/9313))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310](https://github.com/matrix-org/synapse/issues/9310))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062](https://github.com/matrix-org/synapse/issues/9062))
- Add an admin API for retrieving the current room state of a room. ([\#9168](https://github.com/matrix-org/synapse/issues/9168))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858](https://github.com/matrix-org/matrix-doc/pull/2858)). ([\#9183](https://github.com/matrix-org/synapse/issues/9183), [\#9242](https://github.com/matrix-org/synapse/issues/9242))
- Add an admin API endpoint for shadow-banning users. ([\#9209](https://github.com/matrix-org/synapse/issues/9209))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238](https://github.com/matrix-org/synapse/issues/9238))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245](https://github.com/matrix-org/synapse/issues/9245))
- Add ratelimits to invites in rooms and to specific users. ([\#9258](https://github.com/matrix-org/synapse/issues/9258))
- Improve the user experience of setting up an account via single-sign on. ([\#9262](https://github.com/matrix-org/synapse/issues/9262), [\#9272](https://github.com/matrix-org/synapse/issues/9272), [\#9275](https://github.com/matrix-org/synapse/issues/9275), [\#9276](https://github.com/matrix-org/synapse/issues/9276), [\#9277](https://github.com/matrix-org/synapse/issues/9277), [\#9286](https://github.com/matrix-org/synapse/issues/9286), [\#9287](https://github.com/matrix-org/synapse/issues/9287))
- Add phone home stats for encrypted messages. ([\#9283](https://github.com/matrix-org/synapse/issues/9283))
- Update the redirect URI for OIDC authentication. ([\#9288](https://github.com/matrix-org/synapse/issues/9288))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121](https://github.com/matrix-org/synapse/issues/9121))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163](https://github.com/matrix-org/synapse/issues/9163))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164](https://github.com/matrix-org/synapse/issues/9164))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165](https://github.com/matrix-org/synapse/issues/9165))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218](https://github.com/matrix-org/synapse/issues/9218))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229](https://github.com/matrix-org/synapse/issues/9229))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235](https://github.com/matrix-org/synapse/issues/9235))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265](https://github.com/matrix-org/synapse/issues/9265))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271](https://github.com/matrix-org/synapse/issues/9271))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134](https://github.com/matrix-org/synapse/issues/9134))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135](https://github.com/matrix-org/synapse/issues/9135))
- Add notes on integrating with Facebook for SSO login. ([\#9244](https://github.com/matrix-org/synapse/issues/9244))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199](https://github.com/matrix-org/synapse/issues/9199))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289](https://github.com/matrix-org/synapse/issues/9289))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045](https://github.com/matrix-org/synapse/issues/9045))
- Various improvements to the federation client. ([\#9129](https://github.com/matrix-org/synapse/issues/9129))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176](https://github.com/matrix-org/synapse/issues/9176))
- Add a `long_description_type` to the package metadata. ([\#9180](https://github.com/matrix-org/synapse/issues/9180))
- Speed up batch insertion when using PostgreSQL. ([\#9181](https://github.com/matrix-org/synapse/issues/9181), [\#9188](https://github.com/matrix-org/synapse/issues/9188))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184](https://github.com/matrix-org/synapse/issues/9184))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190](https://github.com/matrix-org/synapse/issues/9190))
- Add some missing source directories to the automatic linting script. ([\#9191](https://github.com/matrix-org/synapse/issues/9191))
- Precompute joined hosts and store in Redis. ([\#9198](https://github.com/matrix-org/synapse/issues/9198), [\#9227](https://github.com/matrix-org/synapse/issues/9227))
- Clean-up template loading code. ([\#9200](https://github.com/matrix-org/synapse/issues/9200))
- Fix the Python 3.5 old dependencies build. ([\#9217](https://github.com/matrix-org/synapse/issues/9217))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222](https://github.com/matrix-org/synapse/issues/9222))
- Add type hints to handlers code. ([\#9223](https://github.com/matrix-org/synapse/issues/9223), [\#9232](https://github.com/matrix-org/synapse/issues/9232))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254](https://github.com/matrix-org/synapse/issues/9254))
- Minor performance improvement during TLS handshake. ([\#9255](https://github.com/matrix-org/synapse/issues/9255))
- Refactor the generation of summary text for email notifications. ([\#9260](https://github.com/matrix-org/synapse/issues/9260))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270](https://github.com/matrix-org/synapse/issues/9270))")`
â€¦

`[31d3054](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2)`

```
Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474]([matrix-org/synapse#9474](https://github.com/matrix-org/synapse/pull/9474)))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150]([matrix-org/synapse#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\#9300]([matrix-org/synapse#9300](https://github.com/matrix-org/synapse/pull/9300)), [\#9301]([matrix-org/synapse#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311]([matrix-org/synapse#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376]([matrix-org/synapse#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\#9400]([matrix-org/synapse#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257]([matrix-org/synapse#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\#9296]([matrix-org/synapse#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\#9321]([matrix-org/synapse#9321](https://github.com/matrix-org/synapse/pull/9321)), [\#9393]([matrix-org/synapse#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\#9333]([matrix-org/synapse#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361]([matrix-org/synapse#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391]([matrix-org/synapse#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\#9395]([matrix-org/synapse#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421]([matrix-org/synapse#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425]([matrix-org/synapse#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426]([matrix-org/synapse#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\#9428]([matrix-org/synapse#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433]([matrix-org/synapse#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281]([matrix-org/synapse#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291]([matrix-org/synapse#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\#9308]([matrix-org/synapse#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317]([matrix-org/synapse#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\#9322]([matrix-org/synapse#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390]([matrix-org/synapse#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\#9404]([matrix-org/synapse#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\#9407]([matrix-org/synapse#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434]([matrix-org/synapse#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429]([matrix-org/synapse#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003]([matrix-org/synapse#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\#9123]([matrix-org/synapse#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\#9240]([matrix-org/synapse#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299]([matrix-org/synapse#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\#9305]([matrix-org/synapse#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\#9307]([matrix-org/synapse#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326]([matrix-org/synapse#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362]([matrix-org/synapse#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\#9377]([matrix-org/synapse#9377](https://github.com/matrix-org/synapse/pull/9377)), [\#9396]([matrix-org/synapse#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\#9381]([matrix-org/synapse#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\#9384]([matrix-org/synapse#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\#9394]([matrix-org/synapse#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\#9408]([matrix-org/synapse#9408](https://github.com/matrix-org/synapse/pull/9408)))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache â”€ as well as a pub/sub mechanism â”€ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405]([matrix-org/synapse#9405](https://github.com/matrix-org/synapse/pull/9405)))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297]([matrix-org/synapse#9297](https://github.com/matrix-org/synapse/pull/9297)))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302]([matrix-org/synapse#9302](https://github.com/matrix-org/synapse/pull/9302)))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313]([matrix-org/synapse#9313](https://github.com/matrix-org/synapse/pull/9313)))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310]([matrix-org/synapse#9310](https://github.com/matrix-org/synapse/pull/9310)))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062]([matrix-org/synapse#9062](https://github.com/matrix-org/synapse/pull/9062)))
- Add an admin API for retrieving the current room state of a room. ([\#9168]([matrix-org/synapse#9168](https://github.com/matrix-org/synapse/pull/9168)))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858]([matrix-org/matrix-spec-proposals#2858](https://github.com/matrix-org/matrix-spec-proposals/pull/2858))). ([\#9183]([matrix-org/synapse#9183](https://github.com/matrix-org/synapse/pull/9183)), [\#9242]([matrix-org/synapse#9242](https://github.com/matrix-org/synapse/pull/9242)))
- Add an admin API endpoint for shadow-banning users. ([\#9209]([matrix-org/synapse#9209](https://github.com/matrix-org/synapse/pull/9209)))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238]([matrix-org/synapse#9238](https://github.com/matrix-org/synapse/pull/9238)))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245]([matrix-org/synapse#9245](https://github.com/matrix-org/synapse/pull/9245)))
- Add ratelimits to invites in rooms and to specific users. ([\#9258]([matrix-org/synapse#9258](https://github.com/matrix-org/synapse/pull/9258)))
- Improve the user experience of setting up an account via single-sign on. ([\#9262]([matrix-org/synapse#9262](https://github.com/matrix-org/synapse/pull/9262)), [\#9272]([matrix-org/synapse#9272](https://github.com/matrix-org/synapse/pull/9272)), [\#9275]([matrix-org/synapse#9275](https://github.com/matrix-org/synapse/pull/9275)), [\#9276]([matrix-org/synapse#9276](https://github.com/matrix-org/synapse/pull/9276)), [\#9277]([matrix-org/synapse#9277](https://github.com/matrix-org/synapse/pull/9277)), [\#9286]([matrix-org/synapse#9286](https://github.com/matrix-org/synapse/pull/9286)), [\#9287]([matrix-org/synapse#9287](https://github.com/matrix-org/synapse/pull/9287)))
- Add phone home stats for encrypted messages. ([\#9283]([matrix-org/synapse#9283](https://github.com/matrix-org/synapse/pull/9283)))
- Update the redirect URI for OIDC authentication. ([\#9288]([matrix-org/synapse#9288](https://github.com/matrix-org/synapse/pull/9288)))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121]([matrix-org/synapse#9121](https://github.com/matrix-org/synapse/pull/9121)))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163]([matrix-org/synapse#9163](https://github.com/matrix-org/synapse/pull/9163)))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164]([matrix-org/synapse#9164](https://github.com/matrix-org/synapse/pull/9164)))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165]([matrix-org/synapse#9165](https://github.com/matrix-org/synapse/pull/9165)))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218]([matrix-org/synapse#9218](https://github.com/matrix-org/synapse/pull/9218)))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229]([matrix-org/synapse#9229](https://github.com/matrix-org/synapse/pull/9229)))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235]([matrix-org/synapse#9235](https://github.com/matrix-org/synapse/pull/9235)))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265]([matrix-org/synapse#9265](https://github.com/matrix-org/synapse/pull/9265)))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271]([matrix-org/synapse#9271](https://github.com/matrix-org/synapse/pull/9271)))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134]([matrix-org/synapse#9134](https://github.com/matrix-org/synapse/pull/9134)))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135]([matrix-org/synapse#9135](https://github.com/matrix-org/synapse/pull/9135)))
- Add notes on integrating with Facebook for SSO login. ([\#9244]([matrix-org/synapse#9244](https://github.com/matrix-org/synapse/pull/9244)))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199]([matrix-org/synapse#9199](https://github.com/matrix-org/synapse/pull/9199)))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289]([matrix-org/synapse#9289](https://github.com/matrix-org/synapse/pull/9289)))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045]([matrix-org/synapse#9045](https://github.com/matrix-org/synapse/pull/9045)))
- Various improvements to the federation client. ([\#9129]([matrix-org/synapse#9129](https://github.com/matrix-org/synapse/pull/9129)))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176]([matrix-org/synapse#9176](https://github.com/matrix-org/synapse/pull/9176)))
- Add a `long_description_type` to the package metadata. ([\#9180]([matrix-org/synapse#9180](https://github.com/matrix-org/synapse/pull/9180)))
- Speed up batch insertion when using PostgreSQL. ([\#9181]([matrix-org/synapse#9181](https://github.com/matrix-org/synapse/pull/9181)), [\#9188]([matrix-org/synapse#9188](https://github.com/matrix-org/synapse/pull/9188)))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184]([matrix-org/synapse#9184](https://github.com/matrix-org/synapse/pull/9184)))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190]([matrix-org/synapse#9190](https://github.com/matrix-org/synapse/pull/9190)))
- Add some missing source directories to the automatic linting script. ([\#9191]([matrix-org/synapse#9191](https://github.com/matrix-org/synapse/pull/9191)))
- Precompute joined hosts and store in Redis. ([\#9198]([matrix-org/synapse#9198](https://github.com/matrix-org/synapse/pull/9198)), [\#9227]([matrix-org/synapse#9227](https://github.com/matrix-org/synapse/pull/9227)))
- Clean-up template loading code. ([\#9200]([matrix-org/synapse#9200](https://github.com/matrix-org/synapse/pull/9200)))
- Fix the Python 3.5 old dependencies build. ([\#9217]([matrix-org/synapse#9217](https://github.com/matrix-org/synapse/pull/9217)))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222]([matrix-org/synapse#9222](https://github.com/matrix-org/synapse/pull/9222)))
- Add type hints to handlers code. ([\#9223]([matrix-org/synapse#9223](https://github.com/matrix-org/synapse/pull/9223)), [\#9232]([matrix-org/synapse#9232](https://github.com/matrix-org/synapse/pull/9232)))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254]([matrix-org/synapse#9254](https://github.com/matrix-org/synapse/pull/9254)))
- Minor performance improvement during TLS handshake. ([\#9255]([matrix-org/synapse#9255](https://github.com/matrix-org/synapse/pull/9255)))
- Refactor the generation of summary text for email notifications. ([\#9260]([matrix-org/synapse#9260](https://github.com/matrix-org/synapse/pull/9260)))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270]([matrix-org/synapse#9270](https://github.com/matrix-org/synapse/pull/9270)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9240).

Reviewers

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [erikjohnston](/erikjohnston)

erikjohnston approved these changes

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak) [dkasak](/dkasak)

dkasak approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=52&v=4)](/dkasak) [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


