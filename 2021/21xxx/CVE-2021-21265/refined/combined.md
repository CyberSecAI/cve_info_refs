=== Content from github.com_eb81d19e_20250114_232357.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fcommit%2Ff638d3f78cfe91d7f6658820f9d5e424306a3db0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fcommit%2Ff638d3f78cfe91d7f6658820f9d5e424306a3db0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=octobercms%2Foctober)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[octobercms](/octobercms)
/
**[october](/octobercms/october)**
Public

* [Notifications](/login?return_to=%2Foctobercms%2Foctober) You must be signed in to change notification settings
* [Fork
  2.2k](/login?return_to=%2Foctobercms%2Foctober)
* [Star
   11.1k](/login?return_to=%2Foctobercms%2Foctober)

* [Code](/octobercms/october)
* [Issues
  3](/octobercms/october/issues)
* [Pull requests
  0](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

Additional navigation options

* [Code](/octobercms/october)
* [Issues](/octobercms/october/issues)
* [Pull requests](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

## Commit

[Permalink](/octobercms/october/commit/f638d3f78cfe91d7f6658820f9d5e424306a3db0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add app.trustedHosts config and force host checks on password reset ([#…](https://github.com/octobercms/october/pull/5423)

[Browse files](/octobercms/october/tree/f638d3f78cfe91d7f6658820f9d5e424306a3db0)
Browse the repository at this point in the history

```
[…5423](https://github.com/octobercms/october/pull/5423))

Add app.trustedHosts config and force host checks on backend password reset.

Related: [octobercms/library@f29865a](https://github.com/octobercms/library/commit/f29865a)
(cherry picked from commit f555ab6)
```

* Loading branch information

Ben Thomson
authored and
Luke Towers
committed
Jan 4, 2021

1 parent
[ea67b61](/octobercms/october/commit/ea67b615e4d1b47863bb3ac76cc80eede974376f)

commit f638d3f

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**45 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* config

  + config/app.php
    [app.php](#diff-950397cc5ef29707b54d0c774bd94af85836bab1a27f2f86533d832d25caf224)
* modules/backend/controllers

  + modules/backend/controllers/Auth.php
    [Auth.php](#diff-da01d1047deb5f487fc726ee05d4e5b3bca05ce40213db21758aad94689a857b)

## There are no files selected for viewing

30 changes: 30 additions & 0 deletions

30
[config/app.php](#diff-950397cc5ef29707b54d0c774bd94af85836bab1a27f2f86533d832d25caf224 "config/app.php")

Show comments

[View file](/octobercms/october/blob/f638d3f78cfe91d7f6658820f9d5e424306a3db0/config/app.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -43,6 +43,36 @@ |
|  |  |  |
|  |  | 'url' => 'http://localhost', |
|  |  |  |
|  |  | /\* |
|  |  | |-------------------------------------------------------------------------- |
|  |  | | Trusted hosts |
|  |  | |-------------------------------------------------------------------------- |
|  |  | | |
|  |  | | You may specify valid hosts for your application as an array or boolean |
|  |  | | below. This helps prevent host header poisoning attacks. |
|  |  | | |
|  |  | | Possible values: |
|  |  | | - `true`: Trust the host specified in app.url, as well as the "www" |
|  |  | | subdomain, if applicable. |
|  |  | | - `false`: Disable the trusted hosts feature. |
|  |  | | - array: Defines the domains to be trusted hosts. Each item should be |
|  |  | | a string defining a domain, IP address, or a regex pattern. |
|  |  | | |
|  |  | | Example of array values: |
|  |  | | |
|  |  | | 'trustedHosts' => [ |
|  |  | | 'example.com', // Matches just example.com |
|  |  | | 'www.example.com', // Matches just www.example.com |
|  |  | | '^(.+\.)?example\.com$', // Matches example.com and all subdomains |
|  |  | | 'https://example.com', // Matches just example.com |
|  |  | | ], |
|  |  | | |
|  |  | | NOTE: Even when set to `false`, this functionality is explicitly enabled |
|  |  | | on the Backend password reset flow for security reasons. |
|  |  | \*/ |
|  |  |  |
|  |  | 'trustedHosts' => true, |
|  |  |  |
|  |  | /\* |
|  |  | |-------------------------------------------------------------------------- |
|  |  | | Application Timezone |
| Expand Down | |  |

15 changes: 15 additions & 0 deletions

15
[modules/backend/controllers/Auth.php](#diff-da01d1047deb5f487fc726ee05d4e5b3bca05ce40213db21758aad94689a857b "modules/backend/controllers/Auth.php")

Show comments

[View file](/octobercms/october/blob/f638d3f78cfe91d7f6658820f9d5e424306a3db0/modules/backend/controllers/Auth.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,6 +13,7 @@ |
|  |  | use ValidationException; |
|  |  | use Exception; |
|  |  | use Config; |
|  |  | use October\Rain\Foundation\Http\Middleware\CheckForTrustedHost; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Authentication controller |
| Expand Down  Expand Up | | @@ -147,6 +148,20 @@ public function restore() |
|  |  | \*/ |
|  |  | public function restore\_onSubmit() |
|  |  | { |
|  |  | // Force Trusted Host verification on password reset link generation |
|  |  | // regardless of config to protect against host header poisoning |
|  |  | $trustedHosts = Config::get('app.trustedHosts', false); |
|  |  | if ($trustedHosts === false) { |
|  |  | $hosts = CheckForTrustedHost::processTrustedHosts(true); |
|  |  |  |
|  |  | if (count($hosts)) { |
|  |  | Request::setTrustedHosts($hosts); |
|  |  |  |
|  |  | // Trigger the host validation logic |
|  |  | Request::getHost(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $rules = [ |
|  |  | 'login' => 'required|between:2,255' |
|  |  | ]; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f638d3f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fcommit%2Ff638d3f78cfe91d7f6658820f9d5e424306a3db0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_87afac73_20250114_232357.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fsecurity%2Fadvisories%2FGHSA-xhfx-hgmf-v6vp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Foctober%2Fsecurity%2Fadvisories%2FGHSA-xhfx-hgmf-v6vp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=octobercms%2Foctober)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[octobercms](/octobercms)
/
**[october](/octobercms/october)**
Public

* [Notifications](/login?return_to=%2Foctobercms%2Foctober) You must be signed in to change notification settings
* [Fork
  2.2k](/login?return_to=%2Foctobercms%2Foctober)
* [Star
   11.1k](/login?return_to=%2Foctobercms%2Foctober)

* [Code](/octobercms/october)
* [Issues
  3](/octobercms/october/issues)
* [Pull requests
  0](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

Additional navigation options

* [Code](/octobercms/october)
* [Issues](/octobercms/october/issues)
* [Pull requests](/octobercms/october/pulls)
* [Actions](/octobercms/october/actions)
* [Security](/octobercms/october/security)
* [Insights](/octobercms/october/pulse)

# Potential Host Header Poisoning on misconfigured servers

Moderate

[daftspunk](/daftspunk)
published
GHSA-xhfx-hgmf-v6vp
Mar 10, 2021

## Package

composer

october/backend
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<1.1.2

## Patched versions

1.1.2

## Description

### Impact

When running on servers that are configured to accept a wildcard as a hostname (i.e. the server routes any request, regardless of the HOST header to an October CMS instance) the potential exists for Host Header Poisoning attacks to succeed. See the following resources for more information on Host Header Poisoning:

* <https://portswigger.net/web-security/host-header>
* <https://dzone.com/articles/what-is-a-host-header-attack>

### Patches

A feature has been added in v1.1.2 to allow a set of trusted hosts to be specified in the application.

### Workarounds

* Apply [octobercms/library@f86fcbc](https://github.com/octobercms/library/commit/f86fcbcd066d6f8b939e8fe897409d152b11c3c6) & [f638d3f](https://github.com/octobercms/october/commit/f638d3f78cfe91d7f6658820f9d5e424306a3db0) to your installation manually if unable to upgrade to v1.1.2.
* Check that the configuration setting `cms.linkPolicy` is set to `force`.

### Alternative Workaround

Check to make sure that your web server does not accept any hostname when serving your web application.

1. Add an entry called `testing.tld` to your computer's host file and direct it to your server's IP address
2. Open the address `testing.tld` in your web browser
3. Make sure an October CMS website is not available at this address

If an October CMS website is returned, configure your webserver to only allow known hostnames. If you require assistance with this, please contact your server administrator.

### References

Reported by [Abdullah Hussam](https://github.com/ahussam)

### For More Information

If you have any questions or comments about this advisory:

* Email us at hello@octobercms.com

### Threat Assessment

[![Screen Shot 2021-01-15 at 4 12 57 PM](https://user-images.githubusercontent.com/7253840/104783859-92fb3600-574c-11eb-9e21-c0dc05d230a9.png)](https://user-images.githubusercontent.com/7253840/104783859-92fb3600-574c-11eb-9e21-c0dc05d230a9.png)

### Severity

Moderate

### CVE ID

CVE-2021-21265

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_db2399c0_20250114_232355.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2Ff86fcbcd066d6f8b939e8fe897409d152b11c3c6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2Ff86fcbcd066d6f8b939e8fe897409d152b11c3c6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=octobercms%2Flibrary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[octobercms](/octobercms)
/
**[library](/octobercms/library)**
Public

* [Notifications](/login?return_to=%2Foctobercms%2Flibrary) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2Foctobercms%2Flibrary)
* [Star
   157](/login?return_to=%2Foctobercms%2Flibrary)

* [Code](/octobercms/library)
* [Pull requests
  0](/octobercms/library/pulls)
* [Actions](/octobercms/library/actions)
* [Security](/octobercms/library/security)
* [Insights](/octobercms/library/pulse)

Additional navigation options

* [Code](/octobercms/library)
* [Pull requests](/octobercms/library/pulls)
* [Actions](/octobercms/library/actions)
* [Security](/octobercms/library/security)
* [Insights](/octobercms/library/pulse)

## Commit

[Permalink](/octobercms/library/commit/f86fcbcd066d6f8b939e8fe897409d152b11c3c6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add trusted hosts support to library ([#549](https://github.com/octobercms/library/pull/549))

[Browse files](/octobercms/library/tree/f86fcbcd066d6f8b939e8fe897409d152b11c3c6)
Browse the repository at this point in the history

```
Adds support for a new configuration value app.trustedHosts that defines the allowed hosts for the application. This allows a developer to prevent host header poisoning.

Possible values:

true: Trust the host specified in app.url, as well as all subdomains.
false: Disable the trusted hosts feature.
array: Defines the domains to be trusted hosts. Each item should be a string defining a domain, or a regex pattern.

Related: [octobercms/october#5423](https://github.com/octobercms/october/pull/5423)
(cherry picked from commit [f29865a](https://github.com/octobercms/library/commit/f29865ae3db7a03be7c49294cd93980ec457f10d))
```

* Loading branch information

Ben Thomson
authored and
Luke Towers
committed
Jan 4, 2021

1 parent
[b57093b](/octobercms/library/commit/b57093b473f597051b5f16be1efe39e5eabd3df4)

commit f86fcbc

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**377 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + Foundation/Http

    - src/Foundation/Http/Kernel.php
      [Kernel.php](#diff-54c4033b1601525d76f2633f76d02aae90a726c7dde7da4e11822151e59bdda4)
    - Middleware

      * src/Foundation/Http/Middleware/CheckForTrustedHost.php
        [CheckForTrustedHost.php](#diff-25fa1eb570e4c381198dcffea34a2c648e9d3ad5d05afe7a657d156fd120d7b0)
  + Http/Middleware

    - src/Http/Middleware/TrustHosts.php
      [TrustHosts.php](#diff-5939f335c1d166f511b252526b7dc7a8eeffe50a05a286ee946d00f0c81419ba)
* tests/Foundation/Http/Middleware

  + tests/Foundation/Http/Middleware/CheckForTrustedHostTest.php
    [CheckForTrustedHostTest.php](#diff-6b177d5a5eeec4ca048f4c2faf5ec0e8fb130d21aaccf62a1ba3f49f1c5c6c1f)

## There are no files selected for viewing

13 changes: 7 additions & 6 deletions

13
[src/Foundation/Http/Kernel.php](#diff-54c4033b1601525d76f2633f76d02aae90a726c7dde7da4e11822151e59bdda4 "src/Foundation/Http/Kernel.php")

Show comments

[View file](/octobercms/library/blob/f86fcbcd066d6f8b939e8fe897409d152b11c3c6/src/Foundation/Http/Kernel.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,13 +10,13 @@ class Kernel extends HttpKernel |
|  |  | \* @var array |
|  |  | \*/ |
|  |  | protected $bootstrappers = [ |
|  |  | '\October\Rain\Foundation\Bootstrap\RegisterClassLoader', |
|  |  | '\October\Rain\Foundation\Bootstrap\LoadEnvironmentVariables', |
|  |  | '\October\Rain\Foundation\Bootstrap\LoadConfiguration', |
|  |  | '\October\Rain\Foundation\Bootstrap\LoadTranslation', |
|  |  | \October\Rain\Foundation\Bootstrap\RegisterClassLoader::class, |
|  |  | \October\Rain\Foundation\Bootstrap\LoadEnvironmentVariables::class, |
|  |  | \October\Rain\Foundation\Bootstrap\LoadConfiguration::class, |
|  |  | \October\Rain\Foundation\Bootstrap\LoadTranslation::class, |
|  |  | \Illuminate\Foundation\Bootstrap\HandleExceptions::class, |
|  |  | \Illuminate\Foundation\Bootstrap\RegisterFacades::class, |
|  |  | '\October\Rain\Foundation\Bootstrap\RegisterOctober', |
|  |  | \October\Rain\Foundation\Bootstrap\RegisterOctober::class, |
|  |  | \Illuminate\Foundation\Bootstrap\RegisterProviders::class, |
|  |  | \Illuminate\Foundation\Bootstrap\BootProviders::class, |
|  |  | ]; |
| Expand All | | @@ -27,7 +27,8 @@ class Kernel extends HttpKernel |
|  |  | \* @var array |
|  |  | \*/ |
|  |  | protected $middleware = [ |
|  |  | '\October\Rain\Foundation\Http\Middleware\CheckForMaintenanceMode', |
|  |  | \October\Rain\Foundation\Http\Middleware\CheckForTrustedHost::class, |
|  |  | \October\Rain\Foundation\Http\Middleware\CheckForMaintenanceMode::class, |
|  |  | ]; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

82 changes: 82 additions & 0 deletions

82
[src/Foundation/Http/Middleware/CheckForTrustedHost.php](#diff-25fa1eb570e4c381198dcffea34a2c648e9d3ad5d05afe7a657d156fd120d7b0 "src/Foundation/Http/Middleware/CheckForTrustedHost.php")

Show comments

[View file](/octobercms/library/blob/f86fcbcd066d6f8b939e8fe897409d152b11c3c6/src/Foundation/Http/Middleware/CheckForTrustedHost.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,82 @@ |
|  |  | <?php namespace October\Rain\Foundation\Http\Middleware; |
|  |  |  |
|  |  | use Config; |
|  |  | use October\Rain\Http\Middleware\TrustHosts as BaseMiddleware; |
|  |  |  |
|  |  | class CheckForTrustedHost extends BaseMiddleware |
|  |  | { |
|  |  | /\*\* |
|  |  | \* Get the host patterns that should be trusted. |
|  |  | \* |
|  |  | \* Trusted hosts should be defined in the `config/app.php` configuration file as an array, ie.: |
|  |  | \* |
|  |  | \* 'trustedHosts' => [ |
|  |  | \* 'example.com', // Matches just example.com |
|  |  | \* 'www.example.com', // Matches just www.example.com |
|  |  | \* '^(.+\.)?example\.com$', // Matches example.com and all subdomains |
|  |  | \* 'https://example.com', // Matches just example.com |
|  |  | \* ], |
|  |  | \* |
|  |  | \* or as a boolean - if true, it will trust the `app.url` host and all subdomains, if false it |
|  |  | \* will disable the feature entirely. |
|  |  | \* |
|  |  | \* Hosts can be defined as regex patterns for complex matching. |
|  |  | \* |
|  |  | \* @return array |
|  |  | \*/ |
|  |  | public function hosts() |
|  |  | { |
|  |  | return self::processTrustedHosts(Config::get('app.trustedHosts', [])); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Processes the trusted hosts into an array of patterns the match for host header checks. |
|  |  | \* |
|  |  | \* @param array|bool $hosts |
|  |  | \* @return array |
|  |  | \*/ |
|  |  | public static function processTrustedHosts($hosts) |
|  |  | { |
|  |  | if ($hosts === true) { |
|  |  | $url = Config::get('app.url', null); |
|  |  |  |
|  |  | // If no app URL is set, then disable trusted hosts. |
|  |  | if (is\_null($url)) { |
|  |  | return []; |
|  |  | } |
|  |  |  |
|  |  | // Allow both the domain and the `www` subdomain for app.url |
|  |  | // regardless of the presence of www in the app.url value |
|  |  | $host = parse\_url($url, PHP\_URL\_HOST); |
|  |  | if (preg\_match('/^www\.(.\*?)$/i', $host, $matches)) { |
|  |  | $host = '^(www\.)?' . preg\_quote($matches[1]) . '$'; |
|  |  | } else { |
|  |  | $host = '^(www\.)?' . preg\_quote($host) . '$'; |
|  |  | } |
|  |  |  |
|  |  | $hosts = [$host]; |
|  |  | } elseif ($hosts === false) { |
|  |  | return []; |
|  |  | } |
|  |  |  |
|  |  | $hosts = array\_map(function ($host) { |
|  |  | // If a URL is provided, extract the host |
|  |  | if (filter\_var($host, FILTER\_VALIDATE\_URL)) { |
|  |  | $host = parse\_url($host, PHP\_URL\_HOST); |
|  |  | } |
|  |  |  |
|  |  | // Prepare IP address & plain hostname values to be processed by the regex filter |
|  |  | if ( |
|  |  | filter\_var($host, FILTER\_VALIDATE\_IP) |
|  |  | || filter\_var($host, FILTER\_VALIDATE\_DOMAIN, FILTER\_FLAG\_HOSTNAME) |
|  |  | ) { |
|  |  | return '^' . preg\_quote($host) . '$'; |
|  |  | } |
|  |  |  |
|  |  | // Allow everything else through as is |
|  |  | return $host; |
|  |  | }, $hosts); |
|  |  |  |
|  |  | return $hosts; |
|  |  | } |
|  |  | } |

71 changes: 71 additions & 0 deletions

71
[src/Http/Middleware/TrustHosts.php](#diff-5939f335c1d166f511b252526b7dc7a8eeffe50a05a286ee946d00f0c81419ba "src/Http/Middleware/TrustHosts.php")

Show comments

[View file](/octobercms/library/blob/f86fcbcd066d6f8b939e8fe897409d152b11c3c6/src/Http/Middleware/TrustHosts.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,71 @@ |
|  |  | <?php namespace October\Rain\Http\Middleware; |
|  |  |  |
|  |  | use Illuminate\Contracts\Foundation\Application; |
|  |  | use Illuminate\Http\Request; |
|  |  |  |
|  |  | abstract class TrustHosts |
|  |  | { |
|  |  | /\*\* |
|  |  | \* The application instance. |
|  |  | \* |
|  |  | \* @var \Illuminate\Contracts\Foundation\Application |
|  |  | \*/ |
|  |  | protected $app; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Create a new middleware instance. |
|  |  | \* |
|  |  | \* @param \Illuminate\Contracts\Foundation\Application $app |
|  |  | \* @return void |
|  |  | \*/ |
|  |  | public function \_\_construct(Application $app) |
|  |  | { |
|  |  | $this->app = $app; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the host patterns that should be trusted. |
|  |  | \* |
|  |  | \* @return array |
|  |  | \*/ |
|  |  | abstract public function hosts(); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Handle the incoming request. |
|  |  | \* |
|  |  | \* @param \Illuminate\Http\Request $request |
|  |  | \* @param callable $next |
|  |  | \* @return \Illuminate\Http\Response |
|  |  | \*/ |
|  |  | public function handle(Request $request, $next) |
|  |  | { |
|  |  | if ($this->shouldSpecifyTrustedHosts()) { |
|  |  | Request::setTrustedHosts(array\_filter($this->hosts())); |
|  |  | } |
|  |  |  |
|  |  | return $next($request); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Determine if the application should specify trusted hosts. |
|  |  | \* |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | protected function shouldSpecifyTrustedHosts() |
|  |  | { |
|  |  | return $this->app['config']->get('app.env') !== 'local' |
|  |  | && $this->app->runningUnitTests() === false; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get a regular expression matching the application URL and all of its subdomains. |
|  |  | \* |
|  |  | \* @return string|null |
|  |  | \*/ |
|  |  | protected function allSubdomainsOfApplicationUrl() |
|  |  | { |
|  |  | if ($host = parse\_url($this->app['config']->get('app.url'), PHP\_URL\_HOST)) { |
|  |  | return '^(.+\.)?'.preg\_quote($host).'$'; |
|  |  | } |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f86fcbc`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foctobercms%2Flibrary%2Fcommit%2Ff86fcbcd066d6f8b939e8fe897409d152b11c3c6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


