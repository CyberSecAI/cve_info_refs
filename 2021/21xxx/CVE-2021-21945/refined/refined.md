Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2021-21945

**Root Cause:** Heap-based buffer overflow in the TIFF parser of Accusoft ImageGear, specifically when handling the second set of 12 bits in a pixel when `BitsPerSample` is `0xc` and the image uses planar configuration.

**Weaknesses/Vulnerabilities:**
*   **Heap-based Buffer Overflow:** The vulnerability occurs due to a missing boundary check when copying data from the source buffer (`src_buff`) to the destination buffer (`dest_buff`). The code calculates the destination offset incorrectly, causing out-of-bounds writes when `BitsPerSample` is `0xc` and planar configuration is used.
*   **Incorrect Offset Calculation**: The `sample_index` is incremented by `SamplesPerPixel` in each iteration, leading to a non-sequential writing pattern in the destination buffer. The size of `dest_buff` is not checked against the calculated destination offset.

**Impact of Exploitation:**
*   **Heap-based buffer overflow:** This can lead to memory corruption, potentially allowing an attacker to overwrite critical data structures.
*   **Arbitrary Code Execution:** The memory corruption could be exploited to achieve arbitrary code execution, leading to full system compromise.

**Attack Vectors:**
*   **Malicious TIFF File:** The attacker needs to provide a specially crafted TIFF file to the vulnerable application. The malicious file must contain specific tag values.
*   **File Parsing:** The vulnerability is triggered during the parsing of the malicious TIFF file by Accusoft ImageGear.

**Required Attacker Capabilities/Position:**
*   The attacker needs to be able to provide a malicious TIFF file to an application that uses the vulnerable Accusoft ImageGear library. No special privileges are needed.
*   No user interaction is necessary beyond opening or processing the malicious file with the vulnerable software.

**Technical Details:**

The vulnerability occurs within the `FUN_10074d50` function, which handles the parsing of TIFF data when certain conditions are met (`SamplesPerPixel > 2`, `BitsPerSample = 0xc`, `PlanarConfiguration = 2`). Specifically, the issue occurs during the second 12-bit data copy at the location marked `[1]`:

```
*(ushort *)((int)dest_buff + sample_index * 2) =
    CONCAT11(*curren_src_byte_cur,src_buff[loop_index_+1]) & 0xfff;
```

The `sample_index` is improperly calculated which leads to out-of-bounds write. The calculation is based on the `SamplesPerPixel` tag value and the loop iteration.

The `TIFF_parse` function allocates the source and destination buffers. The size of the source buffer `src_size` is calculated as `(((BitsPerSample & 0xffff) * width + 7) >> 3) * 5`, while the size of the destination buffer is calculated as `dest_size = (((next_mult_of_8_of_BitsPerSample * SamplesPerPixel * ImageWidth) + 0x1f) >> 3) & 0xfffffffc`. The different formulas and the incorrect offset calculation leads to the vulnerability.