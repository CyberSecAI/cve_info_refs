=== Content from github.com_42ce0734_20250114_224040.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.25.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.25.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse/tree/v1.25.0)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse/tree/v1.25.0)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

1. [Releases](/matrix-org/synapse/releases)
2. [v1.25.0](/matrix-org/synapse/releases/tag/v1.25.0)

# v1.25.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/synapse/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.25.0)

 Loading

[View all tags](/matrix-org/synapse/tags)

![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)
[erikjohnston](/erikjohnston)
released this
13 Jan 10:35

·
[5343 commits](/matrix-org/synapse/compare/v1.25.0...develop)
to develop
since this release

[v1.25.0](/matrix-org/synapse/tree/v1.25.0)

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/8428120?s=64&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
Erik Johnston

GPG key ID: A542E4ED1B0FAC09

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`ebd534b`](/matrix-org/synapse/commit/ebd534b58d9d53dc5086a9dd9cb176868c7b93ef)

# Synapse 1.25.0 (2021-01-13)

## Ending Support for Python 3.5 and Postgres 9.5

With this release, the Synapse team is announcing a formal deprecation policy for our platform dependencies, like Python and PostgreSQL:

All future releases of Synapse will follow the upstream end-of-life schedules.

Which means:

* This is the last release which guarantees support for Python 3.5.
* We will end support for PostgreSQL 9.5 early next month.
* We will end support for Python 3.6 and PostgreSQL 9.6 near the end of the year.

Crucially, this means **we will not produce .deb packages for Debian 9 (Stretch) or Ubuntu 16.04 (Xenial)** beyond the transition period described below.

The website <https://endoflife.date/> has convenient summaries of the support schedules for projects like [Python](https://endoflife.date/python) and [PostgreSQL](https://endoflife.date/postgresql).

If you are unable to upgrade your environment to a supported version of Python or Postgres, we encourage you to consider using the [Synapse Docker images](/matrix-org/synapse/blob/v1.25.0/INSTALL.md#docker-images-and-ansible-playbooks) instead.

### Transition Period

We will make a good faith attempt to avoid breaking compatibility in all releases through the end of March 2021. However, critical security vulnerabilities in dependencies or other unanticipated circumstances may arise which necessitate breaking compatibility earlier.

We intend to continue producing .deb packages for Debian 9 (Stretch) and Ubuntu 16.04 (Xenial) through the transition period.

## Removal warning

The old [Purge Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/purge_room.md)

and [Shutdown Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/shutdown_room.md)

are deprecated and will be removed in a future release. They will be replaced by the

[Delete Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/rooms.md#delete-room-api).

`POST /_synapse/admin/v1/rooms/<room_id>/delete` replaces `POST /_synapse/admin/v1/purge_room` and

`POST /_synapse/admin/v1/shutdown_room/<room_id>`.

## Bugfixes

* Fix HTTP proxy support when using a proxy that is on a blacklisted IP. Introduced in v1.25.0rc1. Contributed by [@Bubu](https://github.com/Bubu). ([#9084](https://github.com/matrix-org/synapse/issues/9084))

# Synapse 1.25.0rc1 (2021-01-06)

## Features

* Add an admin API that lets server admins get power in rooms in which local users have power. ([#8756](https://github.com/matrix-org/synapse/issues/8756))
* Add optional HTTP authentication to replication endpoints. ([#8853](https://github.com/matrix-org/synapse/issues/8853))
* Improve the error messages printed as a result of configuration problems for extension modules. ([#8874](https://github.com/matrix-org/synapse/issues/8874))
* Add the number of local devices to Room Details Admin API. Contributed by [@dklimpel](https://github.com/dklimpel). ([#8886](https://github.com/matrix-org/synapse/issues/8886))
* Add `X-Robots-Tag` header to stop web crawlers from indexing media. Contributed by Aaron Raimist. ([#8887](https://github.com/matrix-org/synapse/issues/8887))
* Spam-checkers may now define their methods as `async`. ([#8890](https://github.com/matrix-org/synapse/issues/8890))
* Add support for allowing users to pick their own user ID during a single-sign-on login. ([#8897](https://github.com/matrix-org/synapse/issues/8897), [#8900](https://github.com/matrix-org/synapse/issues/8900), [#8911](https://github.com/matrix-org/synapse/issues/8911), [#8938](https://github.com/matrix-org/synapse/issues/8938), [#8941](https://github.com/matrix-org/synapse/issues/8941), [#8942](https://github.com/matrix-org/synapse/issues/8942), [#8951](https://github.com/matrix-org/synapse/issues/8951))
* Add an `email.invite_client_location` configuration option to send a web client location to the invite endpoint on the identity server which allows customisation of the email template. ([#8930](https://github.com/matrix-org/synapse/issues/8930))
* The search term in the list room and list user Admin APIs is now treated as case-insensitive. ([#8931](https://github.com/matrix-org/synapse/issues/8931))
* Apply an IP range blacklist to push and key revocation requests. ([#8821](https://github.com/matrix-org/synapse/issues/8821), [#8870](https://github.com/matrix-org/synapse/issues/8870), [#8954](https://github.com/matrix-org/synapse/issues/8954))
* Add an option to allow re-use of user-interactive authentication sessions for a period of time. ([#8970](https://github.com/matrix-org/synapse/issues/8970))
* Allow running the redact endpoint on workers. ([#8994](https://github.com/matrix-org/synapse/issues/8994))

## Bugfixes

* Fix bug where we might not correctly calculate the current state for rooms with multiple extremities. ([#8827](https://github.com/matrix-org/synapse/issues/8827))
* Fix a long-standing bug in the register admin endpoint (`/_synapse/admin/v1/register`) when the `mac` field was not provided. The endpoint now properly returns a 400 error. Contributed by [@edwargix](https://github.com/edwargix). ([#8837](https://github.com/matrix-org/synapse/issues/8837))
* Fix a long-standing bug on Synapse instances supporting Single-Sign-On, where users would be prompted to enter their password to confirm certain actions, even though they have not set a password. ([#8858](https://github.com/matrix-org/synapse/issues/8858))
* Fix a longstanding bug where a 500 error would be returned if the `Content-Length` header was not provided to the upload media resource. ([#8862](https://github.com/matrix-org/synapse/issues/8862))
* Add additional validation to pusher URLs to be compliant with the specification. ([#8865](https://github.com/matrix-org/synapse/issues/8865))
* Fix the error code that is returned when a user tries to register on a homeserver on which new-user registration has been disabled. ([#8867](https://github.com/matrix-org/synapse/issues/8867))
* Fix a bug where `PUT /_synapse/admin/v2/users/<user_id>` failed to create a new user when `avatar_url` is specified. Bug introduced in Synapse v1.9.0. ([#8872](https://github.com/matrix-org/synapse/issues/8872))
* Fix a 500 error when attempting to preview an empty HTML file. ([#8883](https://github.com/matrix-org/synapse/issues/8883))
* Fix occasional deadlock when handling SIGHUP. ([#8918](https://github.com/matrix-org/synapse/issues/8918))
* Fix login API to not ratelimit application services that have ratelimiting disabled. ([#8920](https://github.com/matrix-org/synapse/issues/8920))
* Fix bug where we ratelimited auto joining of rooms on registration (using `auto_join_rooms` config). ([#8921](https://github.com/matrix-org/synapse/issues/8921))
* Fix a bug where deactivated users appeared in the user directory when their profile information was updated. ([#8933](https://github.com/matrix-org/synapse/issues/8933), [#8964](https://github.com/matrix-org/synapse/issues/8964))
* Fix bug introduced in Synapse v1.24.0 which would cause an exception on startup if both `enabled` and `localdb_enabled` were set to `False` in the `password_config` setting of the configuration file. ([#8937](https://github.com/matrix-org/synapse/issues/8937))
* Fix a bug where 500 errors would be returned if the `m.room_history_visibility` event had invalid content. ([#8945](https://github.com/matrix-org/synapse/issues/8945))
* Fix a bug causing common English words to not be considered for a user directory search. ([#8959](https://github.com/matrix-org/synapse/issues/8959))
* Fix bug where application services couldn't register new ghost users if the server had reached its MAU limit. ([#8962](https://github.com/matrix-org/synapse/issues/8962))
* Fix a long-standing bug where a `m.image` event without a `url` would cause errors on push. ([#8965](https://github.com/matrix-org/synapse/issues/8965))
* Fix a small bug in v2 state resolution algorithm, which could also cause performance issues for rooms with large numbers of power levels. ([#8971](https://github.com/matrix-org/synapse/issues/8971))
* Add validation to the `sendToDevice` API to raise a missing parameters error instead of a 500 error. ([#8975](https://github.com/matrix-org/synapse/issues/8975))
* Add validation of group IDs to raise a 400 error instead of a 500 eror. ([#8977](https://github.com/matrix-org/synapse/issues/8977))

## Improved Documentation

* Fix the "Event persist rate" section of the included grafana dashboard by adding missing prometheus rules. ([#8802](https://github.com/matrix-org/synapse/issues/8802))
* Combine related media admin API docs. ([#8839](https://github.com/matrix-org/synapse/issues/8839))
* Fix an error in the documentation for the SAML username mapping provider. ([#8873](https://github.com/matrix-org/synapse/issues/8873))
* Clarify comments around template directories in `sample_config.yaml`. ([#8891](https://github.com/matrix-org/synapse/issues/8891))
* Move instructions for database setup, adjusted heading levels and improved syntax highlighting in [INSTALL.md](/matrix-org/synapse/blob/INSTALL.md). Contributed by [@fossterer](https://github.com/fossterer). ([#8987](https://github.com/matrix-org/synapse/issues/8987))
* Update the example value of `group_creation_prefix` in the sample configuration. ([#8992](https://github.com/matrix-org/synapse/issues/8992))
* Link the Synapse developer room to the development section in the docs. ([#9002](https://github.com/matrix-org/synapse/issues/9002))

## Deprecations and Removals

* Deprecate Shutdown Room and Purge Room Admin APIs. ([#8829](https://github.com/matrix-org/synapse/issues/8829))

## Internal Changes

* Properly store the mapping of external ID to Matrix ID for CAS users. ([#8856](https://github.com/matrix-org/synapse/issues/8856), [#8958](https://github.com/matrix-org/synapse/issues/8958))
* Remove some unnecessary stubbing from unit tests. ([#8861](https://github.com/matrix-org/synapse/issues/8861))
* Remove unused `FakeResponse` class from unit tests. ([#8864](https://github.com/matrix-org/synapse/issues/8864))
* Pass `room_id` to `get_auth_chain_difference`. ([#8879](https://github.com/matrix-org/synapse/issues/8879))
* Add type hints to push module. ([#8880](https://github.com/matrix-org/synapse/issues/8880), [#8882](https://github.com/matrix-org/synapse/issues/8882), [#8901](https://github.com/matrix-org/synapse/issues/8901), [#8940](https://github.com/matrix-org/synapse/issues/8940), [#8943](https://github.com/matrix-org/synapse/issues/8943), [#9020](https://github.com/matrix-org/synapse/issues/9020))
* Simplify logic for handling user-interactive-auth via single-sign-on servers. ([#8881](https://github.com/matrix-org/synapse/issues/8881))
* Skip the SAML tests if the requirements (`pysaml2` and `xmlsec1`) aren't available. ([#8905](https://github.com/matrix-org/synapse/issues/8905))
* Fix multiarch docker image builds. ([#8906](https://github.com/matrix-org/synapse/issues/8906))
* Don't publish `latest` docker image until all archs are built. ([#8909](https://github.com/matrix-org/synapse/issues/8909))
* Various clean-ups to the structured logging and logging context code. ([#8916](https://github.com/matrix-org/synapse/issues/8916), [#8935](https://github.com/matrix-org/synapse/issues/8935))
* Automatically drop stale forward-extremities under some specific conditions. ([#8929](https://github.com/matrix-org/synapse/issues/8929))
* Refactor test utilities for injecting HTTP requests. ([#8946](https://github.com/matrix-org/synapse/issues/8946))
* Add a maximum size of 50 kilobytes to .well-known lookups. ([#8950](https://github.com/matrix-org/synapse/issues/8950))
* Fix bug in `generate_log_config` script which made it write empty files. ([#8952](https://github.com/matrix-org/synapse/issues/8952))
* Clean up tox.ini file; disable coverage checking for non-test runs. ([#8963](https://github.com/matrix-org/synapse/issues/8963))
* Add type hints to the admin and room list handlers. ([#8973](https://github.com/matrix-org/synapse/issues/8973))
* Add type hints to the receipts and user directory handlers. ([#8976](https://github.com/matrix-org/synapse/issues/8976))
* Drop the unused `local_invites` table. ([#8979](https://github.com/matrix-org/synapse/issues/8979))
* Add type hints to the base storage code. ([#8980](https://github.com/matrix-org/synapse/issues/8980))
* Support using PyJWT v2.0.0 in the test suite. ([#8986](https://github.com/matrix-org/synapse/issues/8986))
* Fix `tests.federation.transport.RoomDirectoryFederationTests` and ensure it runs in CI. ([#8998](https://github.com/matrix-org/synapse/issues/8998))
* Add type hints to the crypto module. ([#8999](https://github.com/matrix-org/synapse/issues/8999))

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_ad82ac63_20250114_224043.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY.mbox.gz?message=TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

# [SECURITY] Fedora 34 Update: matrix-synapse-1.38.1-1.fc34

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

2 Aug
2021

2 Aug
'21

2:05 a.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-a627cfd31e
2021-08-02 01:02:57.308573
--------------------------------------------------------------------------------

Name : matrix-synapse
Product : Fedora 34
Version : 1.38.1
Release : 1.fc34
URL : <https://github.com/matrix-org/synapse>
Summary : A Matrix reference homeserver written in Python using Twisted
Description :
Matrix is an ambitious new ecosystem for open federated Instant Messaging and
VoIP. Synapse is a reference "homeserver" implementation of Matrix from the
core development team at matrix.org, written in Python/Twisted. It is intended
to showcase the concept of Matrix and let folks see the spec in the context of
a coded base and let you run your own homeserver and generally help bootstrap
the ecosystem.

--------------------------------------------------------------------------------
Update Information:

Update to v1.38.1 ---- New upstream release 1.38.0, incorporating a number of
important security fixes. Upstream changelog: <https://github.com/matrix->
org/synapse/blob/v1.38.0/CHANGES.md Upstream upgrade notes: <https://matrix->
org.github.io/synapse/develop/upgrade#upgrading-to-v1380
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Jul 23 2021 Kai A. Hiller V02460@gmail.com - 1.38.1-1
- Update to v1.38.1
\* Thu Jul 22 2021 Fedora Release Engineering releng@fedoraproject.org - 1.38.0-3
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_35_Mass_Rebuild>
\* Sun Jul 18 2021 Dan Callaghan djc@djc.id.au - 1.38.0-2
- fix startup ordering of synapse.service (RHBZ#1910740)
- relax version requirement for python3-cryptography
\* Wed Jul 14 2021 Kai A. Hiller V02460@gmail.com - 1.38.0-1
- Update to v1.38.0
\* Fri Jun 4 2021 Python Maint python-maint@redhat.com - 1.26.0-3
- Rebuilt for Python 3.10
\* Tue Mar 2 2021 Zbigniew J��drzejewski-Szmek zbyszek@in.waw.pl - 1.26.0-2
- Rebuilt for updated systemd-rpm-macros
See <https://pagure.io/fesco/issue/2583>.
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1910740 - synapse.service can fail if it starts before postgresql is ready
<https://bugzilla.redhat.com/show_bug.cgi?id=1910740>
[ 2 ] Bug #1918426 - matrix-synapse-1.38.0 is available
<https://bugzilla.redhat.com/show_bug.cgi?id=1918426>
[ 3 ] Bug #1934603 - CVE-2021-21274 matrix-synapse: DoS via .well-known lookups [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934603>
[ 4 ] Bug #1934606 - CVE-2021-21273 matrix-synapse: open redirects on some federation and push requests [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934606>
[ 5 ] Bug #1944136 - CVE-2021-21332 matrix-synapse: password reset endpoint is vulnerable to XSS [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944136>
[ 6 ] Bug #1944139 - CVE-2021-21333 matrix-synapse: HTML injection in email and account expiry notifications [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944139>
[ 7 ] Bug #1949110 - CVE-2021-21393 matrix-synapse: Denial of service (via resource exhaustion) due to improper input validation on groups/communities endpoints [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949110>
[ 8 ] Bug #1949112 - CVE-2021-21392 matrix-synapse: IP blacklist bypass via transitional IPv6 addresses on dual-stack networks [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949112>
[ 9 ] Bug #1958801 - CVE-2021-21394 matrix-synapse: missing input validation may cause excessive use of disk space and memory [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1958801>
[ 10 ] Bug #1959542 - CVE-2021-29471 matrix-synapse: Denial-of-service when processing moderate length events [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1959542>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-a627cfd31e' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_91575fcb_20250114_224039.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8821)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8821)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Apply the federation\_ip\_range\_blacklist to push and key revocation requests #8821

 Merged

[clokep](/clokep)
merged 16 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/ip-blacklists](/matrix-org/synapse/tree/clokep/ip-blacklists "matrix-org/synapse:clokep/ip-blacklists")

Dec 2, 2020

 Merged

# [Apply the federation\_ip\_range\_blacklist to push and key revocation requests](#top) #8821

[clokep](/clokep)
merged 16 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/ip-blacklists](/matrix-org/synapse/tree/clokep/ip-blacklists "matrix-org/synapse:clokep/ip-blacklists")

Dec 2, 2020

[Conversation
15](/matrix-org/synapse/pull/8821)
[Commits
16](/matrix-org/synapse/pull/8821/commits)
[Checks
0](/matrix-org/synapse/pull/8821/checks)
[Files changed](/matrix-org/synapse/pull/8821/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Nov 25, 2020](#issue-751075583) • edited Loading

This fixes an oversight in the application of the `federation_ip_range_blacklist` which was not correctly being applied to push servers or to key revocation requests.

As part of this I abstracted / cleaned-up some of the code dealing with HTTP clients and the IP range blacklists.

Full list of changes:

* Applies `federation_ip_range_blacklist` to push, key revocation, and well-known requests.
  + Note that well-known requests were already protected by connecting to these servers due to a confusing way that DNS resolution is done in Twisted. I thought it best to apply it explicitly here.
* Updates the identity server requests (which already used the blacklist) to use the new shared code.
* Abstracts the wrapping code for blocking DNS resolution to blacklisted IPs. (This was copied and pasted in a couple of spots.)
* Renames `get_http_client` to `get_federation_http_client` for clarity (and moves this code so all the HTTP client getters are together).

This should be reviewable commit-by-commit.

After this change there's a few things still using HTTP clients without a blacklist:

* `get_simple_http_client`:
  + Replication -- only connects to IPs given in the configuration.
  + Module API -- this is given to various plugins which are responsibility for handling this themselves.
* `get_proxied_http_client`, note that these all user URLs provided via the config.
  + CAS / OIDC queries. (Note that OIDC the exact URL isn't provided in the config, but it is somewhat assumed the SSO server is "trusted" in what it returns.)
  + Phone home stats.
  + reCAPTCHA auth checker

Sorry, something went wrong.

 👍
1
 SMicheal reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

 [clokep](/clokep)
added 4 commits
[November 25, 2020 15:26](#commits-pushed-9e8b37f)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Apply the federation_ip_range_blacklist to push.](/matrix-org/synapse/pull/8821/commits/9e8b37f1cecda122edd03ba06ca15e3b2c1f0844 "Apply the federation_ip_range_blacklist to push.")`

`[9e8b37f](/matrix-org/synapse/pull/8821/commits/9e8b37f1cecda122edd03ba06ca15e3b2c1f0844)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Use the new blacklisted client for identity.](/matrix-org/synapse/pull/8821/commits/2c4d34b37057ba07c9a1ef2d4d9d3b6f0a5d7b4e "Use the new blacklisted client for identity.")`

`[2c4d34b](/matrix-org/synapse/pull/8821/commits/2c4d34b37057ba07c9a1ef2d4d9d3b6f0a5d7b4e)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Remove unused HTTP clients.](/matrix-org/synapse/pull/8821/commits/8741ba4073a9b12b91022afc36a4596342495582 "Remove unused HTTP clients.")`

`[8741ba4](/matrix-org/synapse/pull/8821/commits/8741ba4073a9b12b91022afc36a4596342495582)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Apply the federation_ip_range_blacklist to key revocation.](/matrix-org/synapse/pull/8821/commits/1adfd358f58b9ed6bfbc772232005cd52cba1113 "Apply the federation_ip_range_blacklist to key revocation.")`

`[1adfd35](/matrix-org/synapse/pull/8821/commits/1adfd358f58b9ed6bfbc772232005cd52cba1113)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
[force-pushed](/matrix-org/synapse/compare/cb0251d88d9f43e279921b148db9e8cb1fa1258e..6c5b8349ea4360bd2a26be3571750ce506266d88)
the
clokep/ip-blacklists

branch
2 times, most recently
from
[`cb0251d`](/matrix-org/synapse/commit/cb0251d88d9f43e279921b148db9e8cb1fa1258e) to
[`6c5b834`](/matrix-org/synapse/commit/6c5b8349ea4360bd2a26be3571750ce506266d88)  [Compare](/matrix-org/synapse/compare/cb0251d88d9f43e279921b148db9e8cb1fa1258e..6c5b8349ea4360bd2a26be3571750ce506266d88)
[November 25, 2020 20:45](#event-4039795375)

 [clokep](/clokep)
added 4 commits
[November 25, 2020 16:10](#commits-pushed-82c067d)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Apply the federation_ip_range_blacklist to well-known look-ups.](/matrix-org/synapse/pull/8821/commits/82c067d2e8ecce84c5eefe13d4f9df41933d9c38 "Apply the federation_ip_range_blacklist to well-known look-ups.

These protections were already being applied due to the use of
IPBlacklistingResolver, but making it explicit should help ensure
there are fewer avenues for holes.")`
 …

`[82c067d](/matrix-org/synapse/pull/8821/commits/82c067d2e8ecce84c5eefe13d4f9df41933d9c38)`

```
These protections were already being applied due to the use of
IPBlacklistingResolver, but making it explicit should help ensure
there are fewer avenues for holes.
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Abstract the code to blacklist IP address resolutions.](/matrix-org/synapse/pull/8821/commits/f559354dd15fa2201a1bad6de3358154f36c570b "Abstract the code to blacklist IP address resolutions.")`

`[f559354](/matrix-org/synapse/pull/8821/commits/f559354dd15fa2201a1bad6de3358154f36c570b)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Rename get_http_client to get_federation_http_client.](/matrix-org/synapse/pull/8821/commits/b22a244741e01feebcae90c3e06203eb078e6a89 "Rename get_http_client to get_federation_http_client.")`

`[b22a244](/matrix-org/synapse/pull/8821/commits/b22a244741e01feebcae90c3e06203eb078e6a89)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add a newsfragment.](/matrix-org/synapse/pull/8821/commits/2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41 "Add a newsfragment.")`

`[2d2b5f4](/matrix-org/synapse/pull/8821/commits/2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
[force-pushed](/matrix-org/synapse/compare/6c5b8349ea4360bd2a26be3571750ce506266d88..2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41)
the
clokep/ip-blacklists

branch
from
[`6c5b834`](/matrix-org/synapse/commit/6c5b8349ea4360bd2a26be3571750ce506266d88) to
[`2d2b5f4`](/matrix-org/synapse/commit/2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41)  [Compare](/matrix-org/synapse/compare/6c5b8349ea4360bd2a26be3571750ce506266d88..2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41)
[November 25, 2020 21:10](#event-4039860942)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[November 25, 2020 21:32](#event-4039918681)

[![richvdh](https://avatars.githubusercontent.com/u/1389908?s=60&v=4)](/richvdh)

**[richvdh](/richvdh)**
reviewed
[Nov 26, 2020](#pullrequestreview-539219888)

 [View reviewed changes](/matrix-org/synapse/pull/8821/files/1adfd358f58b9ed6bfbc772232005cd52cba1113)

Copy link

Member

### @richvdh **[richvdh](/richvdh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

generally seems sensible, but I has thoughts.

Sorry, something went wrong.

All reactions

[docs/sample\_config.yaml](/matrix-org/synapse/pull/8821/files/8741ba4073a9b12b91022afc36a4596342495582..1adfd358f58b9ed6bfbc772232005cd52cba1113#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)
Outdated

|  |  | @@ -650,7 +650,7 @@ acme: | |
| --- | --- | --- | --- |
|  |  | # servers provided by user input. |
|  |  | # |
|  |  | # As of Synapse v1.24.0 this option also affects any outbound requests to push |
|  |  | # servers provided by user input. |
|  |  | # servers provided by user input and to key revocation requests. |

Copy link

Member

### @richvdh **[richvdh](/richvdh)** [Nov 26, 2020](#discussion_r530954003)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

we should be clearer about what sort of "key" this is talking about. It might be clearer to say "for checking key validitity for third-party invite events".

Sorry, something went wrong.

 😄
1
 SMicheal reacted with laugh emoji

All reactions

* 😄
  1 reaction

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=80&v=4)](/richvdh)

Copy link

Member

### **[richvdh](/richvdh)** commented [Nov 26, 2020](#issuecomment-734255136)

| ... which github seems to have eaten. so, here they are again.   * It's not obvious to me that we should be using the `federation_ip_blacklist` for push and third-party-invite foo, which are really nothing to do with federation. (I could say the same for id servers, but that ship has somewhat sailed.) Maybe it would be better to have a separate option `ip_blacklist`, which either replaces `federation_ip_blacklist`, or which `federation_ip_blacklist` overrides, if specified. Backwards-compat could be a bit fiddly though. * It seems `BlacklistingAgentWrapper` is essentially redundant, since `HostnameEndpoint` sends even IP addresses to the resolver which will trap any blacklisted endpoints. (Is that correct? Has it always been correct? I feel like there was a good reason for having to do this twice? Maybe it's just for clearer logging/errors?) If so, it might be better to capitalise on that and do away with the agent wrapper, rather than having to remember to keep the two parts of blacklisting in sync. * This is probably out of scope here, but the whole blacklisting arrangement feels fiddly and fragile. Maybe it would be better to construct our Agents with a different EndpointFactory, which can return endpoints which are a bit like `HostnameEndpoint` but can check addresses against the blacklist just before connecting. |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
self-assigned this
[Nov 30, 2020](#event-4052014164)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Nov 30, 2020](#issuecomment-735823984)

| It's not obvious to me that we should be using the `federation_ip_blacklist` for push and third-party-invite foo, which are really nothing to do with federation. (I could say the same for id servers, but that ship has somewhat sailed.) Maybe it would be better to have a separate option `ip_blacklist`, which either replaces `federation_ip_blacklist`, or which `federation_ip_blacklist` overrides, if specified. Backwards-compat could be a bit fiddly though.  I went back and forth on this a bit and was originally planning to make it separate, but then saw that ID servers used the same setting. I think having a new option which applies to federation, ID servers, push, and key revocation is reasonable. The backwards compatibility path wold use `federation_ip_blacklist` if it exists, but only for federation / ID servers.  It seems `BlacklistingAgentWrapper` is essentially redundant, since `HostnameEndpoint` sends even IP addresses to the resolver which will trap any blacklisted endpoints. (Is that correct? Has it always been correct? I feel like there was a good reason for having to do this twice? Maybe it's just for clearer logging/errors?) If so, it might be better to capitalise on that and do away with the agent wrapper, rather than having to remember to keep the two parts of blacklisting in sync.  I believe this is correct. I don't know if it has always been correct, but I think that has always been Twisted's logic. I wonder if this code was added in-case IP addresses were no longer sent to the resolver in the future? I'll take another look and see what I can do to clarify this code.  This is probably out of scope here, but the whole blacklisting arrangement feels fiddly and fragile. Maybe it would be better to construct our Agents with a different EndpointFactory, which can return endpoints which are a bit like `HostnameEndpoint` but can check addresses against the blacklist just before connecting.  This sounds more ideal, although I think you still need to handle the resolution of names to IPs and blacklisting those outside of the endpoint? Maybe not though, I'll look into if it is reasonable! |
| --- |

All reactions

Sorry, something went wrong.

 [clokep](/clokep)
added 4 commits
[November 30, 2020 14:51](#commits-pushed-2a8d6c6)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add a ip_range_blacklist setting and fallback to federation_ip_range_…](/matrix-org/synapse/pull/8821/commits/2a8d6c6138f7e882ea265763565fe862d5eed025 "Add a ip_range_blacklist setting and fallback to federation_ip_range_blacklist.")`
 …

`[2a8d6c6](/matrix-org/synapse/pull/8821/commits/2a8d6c6138f7e882ea265763565fe862d5eed025)`

```
…blacklist.
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists](/matrix-org/synapse/pull/8821/commits/d5ba7a927f86163b9d5fa7ec5e9e90a89e5c1a3e "Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists")`

`[d5ba7a9](/matrix-org/synapse/pull/8821/commits/d5ba7a927f86163b9d5fa7ec5e9e90a89e5c1a3e)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Lint](/matrix-org/synapse/pull/8821/commits/7233d25cbfe920d7559ef6ac68105f9653d93659 "Lint")`

`[7233d25](/matrix-org/synapse/pull/8821/commits/7233d25cbfe920d7559ef6ac68105f9653d93659)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Fix whitespace.](/matrix-org/synapse/pull/8821/commits/772ab206501548664b747e7e5ccc710ec875a350 "Fix whitespace.")`

`[772ab20](/matrix-org/synapse/pull/8821/commits/772ab206501548664b747e7e5ccc710ec875a350)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Nov 30, 2020](#issuecomment-736077036)

| I made the config changes that were requested.  I'm still investigating whether this could use a custom `EndpointFactory` instead, it seems the interactions with the `ProxyAgent` (and `MatrixFederationAgent` only kind of being an `Agent`) might make this hard though.  I'm hoping to at least wrap things a bit nicer so you only have to call a single blacklisting wrapper instead of two. |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists](/matrix-org/synapse/pull/8821/commits/4a33a09231bfacbe8818bf33b92d29acafebdff9 "Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists")`

`[4a33a09](/matrix-org/synapse/pull/8821/commits/4a33a09231bfacbe8818bf33b92d29acafebdff9)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Dec 1, 2020](#issuecomment-736586382)

| It seems `BlacklistingAgentWrapper` is essentially redundant, since `HostnameEndpoint` sends even IP addresses to the resolver which will trap any blacklisted endpoints. (Is that correct? Has it always been correct? I feel like there was a good reason for having to do this twice? Maybe it's just for clearer logging/errors?) If so, it might be better to capitalise on that and do away with the agent wrapper, rather than having to remember to keep the two parts of blacklisting in sync.  I believe this is correct. I don't know if it has always been correct, but I think that has always been Twisted's logic. I wonder if this code was added in-case IP addresses were no longer sent to the resolver in the future? I'll take another look and see what I can do to clarify this code.  It seems this was added and discussed when this was added: <https://github.com/matrix-org/synapse/pull/4215/files#r243271396>, it seems the last question wasn't really answered though.  Looking through the Twisted agent code, the following happens:   1. The [`Agent`](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/web/client.py#L1656-L1657) by default instantiates an endpoint factory using [`_StandardEndpointFactory`](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/web/client.py#L1533). 2. The `_StandardEndpointFactory` unconditionally creates [`HostnameEndpoint`](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/web/client.py#L1591) instances (sometimes those [get wrapped for TLS](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/web/client.py#L1597), but that doesn't change this logic). 3. The `HostnameEndpoint` unconditionally calls [`resolveHostName`](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/internet/endpoints.py#L930-L932) on the reactor. (See the [logic for choosing a name resolver](https://github.com/twisted/twisted/blob/twisted-20.3.0/src/twisted/internet/endpoints.py#L827-L849), but in our case it will always use `reactor.nameResolver`.)   Unless it is considered a bug that `HostnameResolver` calls `resolveHostName` for IP addresses than I believe the agent wrapper is duplicative. A difference to note is that the `BlacklistingAgentWrapper` does allow for a [specific error message to be raised](https://github.com/matrix-org/synapse/blob/968939bdacc66be91aeba440a6b2ae7bc84731f1/synapse/http/client.py#L240-L241), while the `IPBlacklistingResolver` can only pretend that [the host could not be resolved](https://github.com/matrix-org/synapse/blob/968939bdacc66be91aeba440a6b2ae7bc84731f1/synapse/http/client.py#L173-L179).  To the follow-on question about whether we should be using a custom endpoint. I think this is possible, but would require quite a bit of refactoring since the `ProxyAgent`, which is [used by `SimpleHttpClient`](https://github.com/matrix-org/synapse/blob/968939bdacc66be91aeba440a6b2ae7bc84731f1/synapse/http/client.py#L324-L331), uses it's own type of endpoints. I do wonder if using the blacklist + the proxy even makes sense though. If you are using a proxy I would expect the proxy to do any blacklisting for you? I think with that change it would be reasonable to use a custom endpoint instead, which would clean-up this code quite a bit. |
| --- |

All reactions

Sorry, something went wrong.

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
commented
[Dec 1, 2020](#pullrequestreview-542239195)

 [View reviewed changes](/matrix-org/synapse/pull/8821/files/4a33a09231bfacbe8818bf33b92d29acafebdff9)

[docs/sample\_config.yaml](/matrix-org/synapse/pull/8821/files/4a33a09231bfacbe8818bf33b92d29acafebdff9#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)

|  |  | # |
| --- | --- | --- |
|  |  | # (0.0.0.0 and :: are always blacklisted, whether or not they are explicitly |
|  |  | # listed here, since they correspond to unroutable addresses.) |
|  |  | # |
|  |  | federation\_ip\_range\_blacklist: |
|  |  | # This option replaces federation\_ip\_range\_blacklist in Synapse v1.24.0. |

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Dec 1, 2020](#discussion_r533676891)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I debated how much to mention `federation_ip_range_blacklist` at all. I suspect we'll want to add something to the upgrade notes. The current implementation actually lets you provide two different blacklists (one for push/key validity and one for federation/identity servers). I'm unsure if we should make that a feature (and document it) or if that's an implementation detail and `federation_ip_range_blacklist` is deprecated. 😄

Sorry, something went wrong.

All reactions

Copy link

Member

### @richvdh **[richvdh](/richvdh)** [Dec 2, 2020](#discussion_r534088848)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I vote for the latter :)

Sorry, something went wrong.

 👍
1
 clokep reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from [richvdh](/richvdh)
[December 1, 2020 19:46](#event-4058926030)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Dec 1, 2020](#issuecomment-736777838)

| [@richvdh](https://github.com/richvdh) Requesting your review again, please take a look at the previous comment and let me know if you think additional changes are needed here, in particular I'm unsure about trying to remove `BlacklistingAgentWrapper` (see [#8821 (comment)](https://github.com/matrix-org/synapse/pull/8821#issuecomment-736586382)) and would appreciate further thoughts from you! |
| --- |

All reactions

Sorry, something went wrong.

[![richvdh](https://avatars.githubusercontent.com/u/1389908?s=60&v=4)](/richvdh)

**[richvdh](/richvdh)**
reviewed
[Dec 2, 2020](#pullrequestreview-542734639)

 [View reviewed changes](/matrix-org/synapse/pull/8821/files/4a33a09231bfacbe8818bf33b92d29acafebdff9)

[docs/sample\_config.yaml](/matrix-org/synapse/pull/8821/files/2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41..4a33a09231bfacbe8818bf33b92d29acafebdff9#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)
Outdated

Comment on lines
649
 to
650

|  |  | # The outbound requests for federation, identity servers, push servers, and for |
| --- | --- | --- |
|  |  | # checking key validitity for third-party invite events |

Copy link

Member

### @richvdh **[richvdh](/richvdh)** [Dec 2, 2020](#discussion_r534088521)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

this sentence no verb

Sorry, something went wrong.

All reactions

[docs/sample\_config.yaml](/matrix-org/synapse/pull/8821/files/4a33a09231bfacbe8818bf33b92d29acafebdff9#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)

|  |  | # |
| --- | --- | --- |
|  |  | # (0.0.0.0 and :: are always blacklisted, whether or not they are explicitly |
|  |  | # listed here, since they correspond to unroutable addresses.) |
|  |  | # |
|  |  | federation\_ip\_range\_blacklist: |
|  |  | # This option replaces federation\_ip\_range\_blacklist in Synapse v1.24.0. |

Copy link

Member

### @richvdh **[richvdh](/richvdh)** [Dec 2, 2020](#discussion_r534088848)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I vote for the latter :)

Sorry, something went wrong.

 👍
1
 clokep reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![richvdh](https://avatars.githubusercontent.com/u/1389908?s=60&v=4)](/richvdh)

**[richvdh](/richvdh)**
approved these changes
[Dec 2, 2020](#pullrequestreview-542735537)

 [View reviewed changes](/matrix-org/synapse/pull/8821/files/4a33a09231bfacbe8818bf33b92d29acafebdff9)

Copy link

Member

### @richvdh **[richvdh](/richvdh)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

lgtm.

Sorry, something went wrong.

All reactions

[synapse/config/federation.py](/matrix-org/synapse/pull/8821/files/2d2b5f40fe80b8ff8f95a14dfc47ad36f9801a41..4a33a09231bfacbe8818bf33b92d29acafebdff9#diff-a3aad28a4c7bba8432003312ef01a6e6a6fea7eca485be5f4076adca82039e99)
Outdated

Show resolved

Hide resolved

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=80&v=4)](/richvdh)

Copy link

Member

### **[richvdh](/richvdh)** commented [Dec 2, 2020](#issuecomment-737170217)

| Unless it is considered a bug that HostnameResolver calls resolveHostName for IP addresses than I believe the agent wrapper is duplicative.  I don't *think* it's a bug; and if that behaviour ever changes, then I think we'd quickly catch it in our tests, so I would favour the simplicity that comes from removing it. However...  A difference to note is that the BlacklistingAgentWrapper does allow for a specific error message to be raised, while the IPBlacklistingResolver can only pretend that the host could not be resolved.  I suspect this makes it worth keeping. "Unknown host" is an extremely confusing error message, particularly when the "host" in question is an IP address.  I do wonder if using the blacklist + the proxy even makes sense though. If you are using a proxy I would expect the proxy to do any blacklisting for you?  I think it has to, since (with the exception of literal IP addresses) it's only the proxy that sees the IP addresses in question?  So a custom endpoint type is probably the ultimate solution here - but it's a matter for a separate PR. |
| --- |

 👍
1
 clokep reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)

`[Fix typo.](/matrix-org/synapse/pull/8821/commits/a502bdc55e353862d87e5deb387e79c75920c762 "Fix typo.

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>")`
 …

`[a502bdc](/matrix-org/synapse/pull/8821/commits/a502bdc55e353862d87e5deb387e79c75920c762)`

```
Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Dec 2, 2020](#issuecomment-737272688)

| Thanks! I'll file a follow-up about the endpoint stuff. |
| --- |

All reactions

Sorry, something went wrong.

 [clokep](/clokep)
added 2 commits
[December 2, 2020 09:44](#commits-pushed-67de92d)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Clarify wording in the sample configuration.](/matrix-org/synapse/pull/8821/commits/67de92dbed9c2c50ec134609751cac1758403549 "Clarify wording in the sample configuration.")`

`[67de92d](/matrix-org/synapse/pull/8821/commits/67de92dbed9c2c50ec134609751cac1758403549)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists](/matrix-org/synapse/pull/8821/commits/f4deee7d8461c14fc4dbdab6a76ee1b85c64e54f "Merge remote-tracking branch 'origin/develop' into clokep/ip-blacklists")`

`[f4deee7](/matrix-org/synapse/pull/8821/commits/f4deee7d8461c14fc4dbdab6a76ee1b85c64e54f)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
mentioned this pull request
[Dec 2, 2020](#ref-issue-755341568)

[Implement a blacklisting endpoint (instead of a blacklisting reactor and agent wrapper)
#8860](/matrix-org/synapse/issues/8860)

Open

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Dec 2, 2020](#issuecomment-737279263)

| Thanks! I'll file a follow-up about the endpoint stuff.  See [#8860](https://github.com/matrix-org/synapse/issues/8860). |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`30fba62`](/matrix-org/synapse/commit/30fba6210834a4ecd91badf0c8f3eb278b72e746)
into
develop

[Dec 2, 2020](https://github.com/matrix-org/synapse/pull/8821#event-4063169622)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/ip-blacklists

branch
[December 2, 2020 16:09](#event-4063169718)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
mentioned this pull request
[Dec 3, 2020](#ref-pullrequest-756447694)

[Default to the blacklisting reserved IP ranges.
#8870](/matrix-org/synapse/pull/8870)
 Merged

[clokep](/clokep)
added a commit
that referenced
this pull request
[Jan 6, 2021](#ref-commit-0312266)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

`[Merge tag 'v1.25.0rc1' into develop](/matrix-org/synapse/commit/0312266ee3b5fd527006f8ce5228fa8f227acbe4 "Merge tag 'v1.25.0rc1' into develop

Synapse 1.25.0rc1 (2021-01-06)
==============================

Removal warning
---------------

The old [Purge Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/purge_room.md)
and [Shutdown Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/shutdown_room.md)
are deprecated and will be removed in a future release. They will be replaced by the
[Delete Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/rooms.md#delete-room-api).

`POST /_synapse/admin/v1/rooms/<room_id>/delete` replaces `POST /_synapse/admin/v1/purge_room` and
`POST /_synapse/admin/v1/shutdown_room/<room_id>`.

Features
--------

- Add an admin API that lets server admins get power in rooms in which local users have power. ([\#8756](https://github.com/matrix-org/synapse/issues/8756))
- Add optional HTTP authentication to replication endpoints. ([\#8853](https://github.com/matrix-org/synapse/issues/8853))
- Improve the error messages printed as a result of configuration problems for extension modules. ([\#8874](https://github.com/matrix-org/synapse/issues/8874))
- Add the number of local devices to Room Details Admin API. Contributed by @dklimpel. ([\#8886](https://github.com/matrix-org/synapse/issues/8886))
- Add `X-Robots-Tag` header to stop web crawlers from indexing media. Contributed by Aaron Raimist. ([\#8887](https://github.com/matrix-org/synapse/issues/8887))
- Spam-checkers may now define their methods as `async`. ([\#8890](https://github.com/matrix-org/synapse/issues/8890))
- Add support for allowing users to pick their own user ID during a single-sign-on login. ([\#8897](https://github.com/matrix-org/synapse/issues/8897), [\#8900](https://github.com/matrix-org/synapse/issues/8900), [\#8911](https://github.com/matrix-org/synapse/issues/8911), [\#8938](https://github.com/matrix-org/synapse/issues/8938), [\#8941](https://github.com/matrix-org/synapse/issues/8941), [\#8942](https://github.com/matrix-org/synapse/issues/8942), [\#8951](https://github.com/matrix-org/synapse/issues/8951))
- Add an `email.invite_client_location` configuration option to send a web client location to the invite endpoint on the identity server which allows customisation of the email template. ([\#8930](https://github.com/matrix-org/synapse/issues/8930))
- The search term in the list room and list user Admin APIs is now treated as case-insensitive. ([\#8931](https://github.com/matrix-org/synapse/issues/8931))
- Apply an IP range blacklist to push and key revocation requests. ([\#8821](https://github.com/matrix-org/synapse/issues/8821), [\#8870](https://github.com/matrix-org/synapse/issues/8870), [\#8954](https://github.com/matrix-org/synapse/issues/8954))
- Add an option to allow re-use of user-interactive authentication sessions for a period of time. ([\#8970](https://github.com/matrix-org/synapse/issues/8970))
- Allow running the redact endpoint on workers. ([\#8994](https://github.com/matrix-org/synapse/issues/8994))

Bugfixes
--------

- Fix bug where we might not correctly calculate the current state for rooms with multiple extremities. ([\#8827](https://github.com/matrix-org/synapse/issues/8827))
- Fix a long-standing bug in the register admin endpoint (`/_synapse/admin/v1/register`) when the `mac` field was not provided. The endpoint now properly returns a 400 error. Contributed by @edwargix. ([\#8837](https://github.com/matrix-org/synapse/issues/8837))
- Fix a long-standing bug on Synapse instances supporting Single-Sign-On, where users would be prompted to enter their password to confirm certain actions, even though they have not set a password. ([\#8858](https://github.com/matrix-org/synapse/issues/8858))
- Fix a longstanding bug where a 500 error would be returned if the `Content-Length` header was not provided to the upload media resource. ([\#8862](https://github.com/matrix-org/synapse/issues/8862))
- Add additional validation to pusher URLs to be compliant with the specification. ([\#8865](https://github.com/matrix-org/synapse/issues/8865))
- Fix the error code that is returned when a user tries to register on a homeserver on which new-user registration has been disabled. ([\#8867](https://github.com/matrix-org/synapse/issues/8867))
- Fix a bug where `PUT /_synapse/admin/v2/users/<user_id>` failed to create a new user when `avatar_url` is specified. Bug introduced in Synapse v1.9.0. ([\#8872](https://github.com/matrix-org/synapse/issues/8872))
- Fix a 500 error when attempting to preview an empty HTML file. ([\#8883](https://github.com/matrix-org/synapse/issues/8883))
- Fix occasional deadlock when handling SIGHUP. ([\#8918](https://github.com/matrix-org/synapse/issues/8918))
- Fix login API to not ratelimit application services that have ratelimiting disabled. ([\#8920](https://github.com/matrix-org/synapse/issues/8920))
- Fix bug where we ratelimited auto joining of rooms on registration (using `auto_join_rooms` config). ([\#8921](https://github.com/matrix-org/synapse/issues/8921))
- Fix a bug where deactivated users appeared in the user directory when their profile information was updated. ([\#8933](https://github.com/matrix-org/synapse/issues/8933), [\#8964](https://github.com/matrix-org/synapse/issues/8964))
- Fix bug introduced in Synapse v1.24.0 which would cause an exception on startup if both `enabled` and `localdb_enabled` were set to `False` in the `password_config` setting of the configuration file. ([\#8937](https://github.com/matrix-org/synapse/issues/8937))
- Fix a bug where 500 errors would be returned if the `m.room_history_visibility` event had invalid content. ([\#8945](https://github.com/matrix-org/synapse/issues/8945))
- Fix a bug causing common English words to not be considered for a user directory search. ([\#8959](https://github.com/matrix-org/synapse/issues/8959))
- Fix bug where application services couldn't register new ghost users if the server had reached its MAU limit. ([\#8962](https://github.com/matrix-org/synapse/issues/8962))
- Fix a long-standing bug where a `m.image` event without a `url` would cause errors on push. ([\#8965](https://github.com/matrix-org/synapse/issues/8965))
- Fix a small bug in v2 state resolution algorithm, which could also cause performance issues for rooms with large numbers of power levels. ([\#8971](https://github.com/matrix-org/synapse/issues/8971))
- Add validation to the `sendToDevice` API to raise a missing parameters error instead of a 500 error. ([\#8975](https://github.com/matrix-org/synapse/issues/8975))
- Add validation of group IDs to raise a 400 error instead of a 500 eror. ([\#8977](https://github.com/matrix-org/synapse/issues/8977))

Improved Documentation
----------------------

- Fix the \"Event persist rate\" section of the included grafana dashboard by adding missing prometheus rules. ([\#8802](https://github.com/matrix-org/synapse/issues/8802))
- Combine related media admin API docs. ([\#8839](https://github.com/matrix-org/synapse/issues/8839))
- Fix an error in the documentation for the SAML username mapping provider. ([\#8873](https://github.com/matrix-org/synapse/issues/8873))
- Clarify comments around template directories in `sample_config.yaml`. ([\#8891](https://github.com/matrix-org/synapse/issues/8891))
- Moved instructions for database setup, adjusted heading levels and improved syntax highlighting in [INSTALL.md](../INSTALL.md). Contributed by fossterer. ([\#8987](https://github.com/matrix-org/synapse/issues/8987))
- Update the example value of `group_creation_prefix` in the sample configuration. ([\#8992](https://github.com/matrix-org/synapse/issues/8992))
- Link the Synapse developer room to the development section in the docs. ([\#9002](https://github.com/matrix-org/synapse/issues/9002))

Deprecations and Removals
-------------------------

- Deprecate Shutdown Room and Purge Room Admin APIs. ([\#8829](https://github.com/matrix-org/synapse/issues/8829))

Internal Changes
----------------

- Properly store the mapping of external ID to Matrix ID for CAS users. ([\#8856](https://github.com/matrix-org/synapse/issues/8856), [\#8958](https://github.com/matrix-org/synapse/issues/8958))
- Remove some unnecessary stubbing from unit tests. ([\#8861](https://github.com/matrix-org/synapse/issues/8861))
- Remove unused `FakeResponse` class from unit tests. ([\#8864](https://github.com/matrix-org/synapse/issues/8864))
- Pass `room_id` to `get_auth_chain_difference`. ([\#8879](https://github.com/matrix-org/synapse/issues/8879))
- Add type hints to push module. ([\#8880](https://github.com/matrix-org/synapse/issues/8880), [\#8882](https://github.com/matrix-org/synapse/issues/8882), [\#8901](https://github.com/matrix-org/synapse/issues/8901), [\#8940](https://github.com/matrix-org/synapse/issues/8940), [\#8943](https://github.com/matrix-org/synapse/issues/8943), [\#9020](https://github.com/matrix-org/synapse/issues/9020))
- Simplify logic for handling user-interactive-auth via single-sign-on servers. ([\#8881](https://github.com/matrix-org/synapse/issues/8881))
- Skip the SAML tests if the requirements (`pysaml2` and `xmlsec1`) aren't available. ([\#8905](https://github.com/matrix-org/synapse/issues/8905))
- Fix multiarch docker image builds. ([\#8906](https://github.com/matrix-org/synapse/issues/8906))
- Don't publish `latest` docker image until all archs are built. ([\#8909](https://github.com/matrix-org/synapse/issues/8909))
- Various clean-ups to the structured logging and logging context code. ([\#8916](https://github.com/matrix-org/synapse/issues/8916), [\#8935](https://github.com/matrix-org/synapse/issues/8935))
- Automatically drop stale forward-extremities under some specific conditions. ([\#8929](https://github.com/matrix-org/synapse/issues/8929))
- Refactor test utilities for injecting HTTP requests. ([\#8946](https://github.com/matrix-org/synapse/issues/8946))
- Add a maximum size of 50 kilobytes to .well-known lookups. ([\#8950](https://github.com/matrix-org/synapse/issues/8950))
- Fix bug in `generate_log_config` script which made it write empty files. ([\#8952](https://github.com/matrix-org/synapse/issues/8952))
- Clean up tox.ini file; disable coverage checking for non-test runs. ([\#8963](https://github.com/matrix-org/synapse/issues/8963))
- Add type hints to the admin and room list handlers. ([\#8973](https://github.com/matrix-org/synapse/issues/8973))
- Add type hints to the receipts and user directory handlers. ([\#8976](https://github.com/matrix-org/synapse/issues/8976))
- Drop the unused `local_invites` table. ([\#8979](https://github.com/matrix-org/synapse/issues/8979))
- Add type hints to the base storage code. ([\#8980](https://github.com/matrix-org/synapse/issues/8980))
- Support using PyJWT v2.0.0 in the test suite. ([\#8986](https://github.com/matrix-org/synapse/issues/8986))
- Fix `tests.federation.transport.RoomDirectoryFederationTests` and ensure it runs in CI. ([\#8998](https://github.com/matrix-org/synapse/issues/8998))
- Add type hints to the crypto module. ([\#8999](https://github.com/matrix-org/synapse/issues/8999))")`
…

`[0312266](/matrix-org/synapse/commit/0312266ee3b5fd527006f8ce5228fa8f227acbe4)`

```
Synapse 1.25.0rc1 (2021-01-06)
==============================

Removal warning
---------------

The old [Purge Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/purge_room.md>)
and [Shutdown Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/shutdown_room.md>)
are deprecated and will be removed in a future release. They will be replaced by the
[Delete Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/rooms.md#delete-room-api>).

`POST /_synapse/admin/v1/rooms/<room_id>/delete` replaces `POST /_synapse/admin/v1/purge_room` and
`POST /_synapse/admin/v1/shutdown_room/<room_id>`.

Features
--------

- Add an admin API that lets server admins get power in rooms in which local users have power. ([\[#8756](https://github.com/matrix-org/synapse/pull/8756)]([#8756](https://github.com/matrix-org/synapse/pull/8756)))
- Add optional HTTP authentication to replication endpoints. ([\[#8853](https://github.com/matrix-org/synapse/pull/8853)]([#8853](https://github.com/matrix-org/synapse/pull/8853)))
- Improve the error messages printed as a result of configuration problems for extension modules. ([\[#8874](https://github.com/matrix-org/synapse/pull/8874)]([#8874](https://github.com/matrix-org/synapse/pull/8874)))
- Add the number of local devices to Room Details Admin API. Contributed by [@dklimpel](https://github.com/dklimpel). ([\[#8886](https://github.com/matrix-org/synapse/pull/8886)]([#8886](https://github.com/matrix-org/synapse/pull/8886)))
- Add `X-Robots-Tag` header to stop web crawlers from indexing media. Contributed by Aaron Raimist. ([\[#8887](https://github.com/matrix-org/synapse/pull/8887)]([#8887](https://github.com/matrix-org/synapse/pull/8887)))
- Spam-checkers may now define their methods as `async`. ([\[#8890](https://github.com/matrix-org/synapse/pull/8890)]([#8890](https://github.com/matrix-org/synapse/pull/8890)))
- Add support for allowing users to pick their own user ID during a single-sign-on login. ([\[#8897](https://github.com/matrix-org/synapse/pull/8897)]([#8897](https://github.com/matrix-org/synapse/pull/8897)), [\[#8900](https://github.com/matrix-org/synapse/pull/8900)]([#8900](https://github.com/matrix-org/synapse/pull/8900)), [\[#8911](https://github.com/matrix-org/synapse/pull/8911)]([#8911](https://github.com/matrix-org/synapse/pull/8911)), [\[#8938](https://github.com/matrix-org/synapse/pull/8938)]([#8938](https://github.com/matrix-org/synapse/pull/8938)), [\[#8941](https://github.com/matrix-org/synapse/pull/8941)]([#8941](https://github.com/matrix-org/synapse/pull/8941)), [\[#8942](https://github.com/matrix-org/synapse/pull/8942)]([#8942](https://github.com/matrix-org/synapse/pull/8942)), [\[#8951](https://github.com/matrix-org/synapse/pull/8951)]([#8951](https://github.com/matrix-org/synapse/pull/8951)))
- Add an `email.invite_client_location` configuration option to send a web client location to the invite endpoint on the identity server which allows customisation of the email template. ([\[#8930](https://github.com/matrix-org/synapse/pull/8930)]([#8930](https://github.com/matrix-org/synapse/pull/8930)))
- The search term in the list room and list user Admin APIs is now treated as case-insensitive. ([\[#8931](https://github.com/matrix-org/synapse/pull/8931)]([#8931](https://github.com/matrix-org/synapse/pull/8931)))
- Apply an IP range blacklist to push and key revocation requests. ([\[#8821](https://github.com/matrix-org/synapse/pull/8821)]([#8821](https://github.com/matrix-org/synapse/pull/8821)), [\[#8870](https://github.com/matrix-org/synapse/pull/8870)]([#8870](https://github.com/matrix-org/synapse/pull/8870)), [\[#8954](https://github.com/matrix-org/synapse/pull/8954)]([#8954](https://github.com/matrix-org/synapse/pull/8954)))
- Add an option to allow re-use of user-interactive authentication sessions for a period of time. ([\[#8970](https://github.com/matrix-org/synapse/pull/8970)]([#8970](https://github.com/matrix-org/synapse/pull/8970)))
- Allow running the redact endpoint on workers. ([\[#8994](https://github.com/matrix-org/synapse/pull/8994)]([#8994](https://github.com/matrix-org/synapse/pull/8994)))

Bugfixes
--------

- Fix bug where we might not correctly calculate the current state for rooms with multiple extremities. ([\[#8827](https://github.com/matrix-org/synapse/pull/8827)]([#8827](https://github.com/matrix-org/synapse/pull/8827)))
- Fix a long-standing bug in the register admin endpoint (`/_synapse/admin/v1/register`) when the `mac` field was not provided. The endpoint now properly returns a 400 error. Contributed by [@edwargix](https://github.com/edwargix). ([\[#8837](https://github.com/matrix-org/synapse/pull/8837)]([#8837](https://github.com/matrix-org/synapse/pull/8837)))
- Fix a long-standing bug on Synapse instances supporting Single-Sign-On, where users would be prompted to enter their password to confirm certain actions, even though they have not set a password. ([\[#8858](https://github.com/matrix-org/synapse/pull/8858)]([#8858](https://github.com/matrix-org/synapse/pull/8858)))
- Fix a longstanding bug where a 500 error would be returned if the `Content-Length` header was not provided to the upload media resource. ([\[#8862](https://github.com/matrix-org/synapse/pull/8862)]([#8862](https://github.com/matrix-org/synapse/pull/8862)))
- Add additional validation to pusher URLs to be compliant with the specification. ([\[#8865](https://github.com/matrix-org/synapse/pull/8865)]([#8865](https://github.com/matrix-org/synapse/pull/8865)))
- Fix the error code that is returned when a user tries to register on a homeserver on which new-user registration has been disabled. ([\[#8867](https://github.com/matrix-org/synapse/pull/8867)]([#8867](https://github.com/matrix-org/synapse/pull/8867)))
- Fix a bug where `PUT /_synapse/admin/v2/users/<user_id>` failed to create a new user when `avatar_url` is specified. Bug introduced in Synapse v1.9.0. ([\[#8872](https://github.com/matrix-org/synapse/pull/8872)]([#8872](https://github.com/matrix-org/synapse/pull/8872)))
- Fix a 500 error when attempting to preview an empty HTML file. ([\[#8883](https://github.com/matrix-org/synapse/pull/8883)]([#8883](https://github.com/matrix-org/synapse/pull/8883)))
- Fix occasional deadlock when handling SIGHUP. ([\[#8918](https://github.com/matrix-org/synapse/pull/8918)]([#8918](https://github.com/matrix-org/synapse/pull/8918)))
- Fix login API to not ratelimit application services that have ratelimiting disabled. ([\[#8920](https://github.com/matrix-org/synapse/pull/8920)]([#8920](https://github.com/matrix-org/synapse/pull/8920)))
- Fix bug where we ratelimited auto joining of rooms on registration (using `auto_join_rooms` config). ([\[#8921](https://github.com/matrix-org/synapse/pull/8921)]([#8921](https://github.com/matrix-org/synapse/pull/8921)))
- Fix a bug where deactivated users appeared in the user directory when their profile information was updated. ([\[#8933](https://github.com/matrix-org/synapse/pull/8933)]([#8933](https://github.com/matrix-org/synapse/pull/8933)), [\[#8964](https://github.com/matrix-org/synapse/pull/8964)]([#8964](https://github.com/matrix-org/synapse/pull/8964)))
- Fix bug introduced in Synapse v1.24.0 which would cause an exception on startup if both `enabled` and `localdb_enabled` were set to `False` in the `password_config` setting of the configuration file. ([\[#8937](https://github.com/matrix-org/synapse/pull/8937)]([#8937](https://github.com/matrix-org/synapse/pull/8937)))
- Fix a bug where 500 errors would be returned if the `m.room_history_visibility` event had invalid content. ([\[#8945](https://github.com/matrix-org/synapse/pull/8945)]([#8945](https://github.com/matrix-org/synapse/pull/8945)))
- Fix a bug causing common English words to not be considered for a user directory search. ([\[#8959](https://github.com/matrix-org/synapse/pull/8959)]([#8959](https://github.com/matrix-org/synapse/pull/8959)))
- Fix bug where application services couldn't register new ghost users if the server had reached its MAU limit. ([\[#8962](https://github.com/matrix-org/synapse/pull/8962)]([#8962](https://github.com/matrix-org/synapse/pull/8962)))
- Fix a long-standing bug where a `m.image` event without a `url` would cause errors on push. ([\[#8965](https://github.com/matrix-org/synapse/pull/8965)]([#8965](https://github.com/matrix-org/synapse/pull/8965)))
- Fix a small bug in v2 state resolution algorithm, which could also cause performance issues for rooms with large numbers of power levels. ([\[#8971](https://github.com/matrix-org/synapse/pull/8971)]([#8971](https://github.com/matrix-org/synapse/pull/8971)))
- Add validation to the `sendToDevice` API to raise a missing parameters error instead of a 500 error. ([\[#8975](https://github.com/matrix-org/synapse/pull/8975)]([#8975](https://github.com/matrix-org/synapse/pull/8975)))
- Add validation of group IDs to raise a 400 error instead of a 500 eror. ([\[#8977](https://github.com/matrix-org/synapse/pull/8977)]([#8977](https://github.com/matrix-org/synapse/pull/8977)))

Improved Documentation
----------------------

- Fix the "Event persist rate" section of the included grafana dashboard by adding missing prometheus rules. ([\[#8802](https://github.com/matrix-org/synapse/pull/8802)]([#8802](https://github.com/matrix-org/synapse/pull/8802)))
- Combine related media admin API docs. ([\[#8839](https://github.com/matrix-org/synapse/pull/8839)]([#8839](https://github.com/matrix-org/synapse/pull/8839)))
- Fix an error in the documentation for the SAML username mapping provider. ([\[#8873](https://github.com/matrix-org/synapse/pull/8873)]([#8873](https://github.com/matrix-org/synapse/pull/8873)))
- Clarify comments around template directories in `sample_config.yaml`. ([\[#8891](https://github.com/matrix-org/synapse/pull/8891)]([#8891](https://github.com/matrix-org/synapse/pull/8891)))
- Moved instructions for database setup, adjusted heading levels and improved syntax highlighting in [INSTALL.md](../INSTALL.md). Contributed by fossterer. ([\[#8987](https://github.com/matrix-org/synapse/pull/8987)]([#8987](https://github.com/matrix-org/synapse/pull/8987)))
- Update the example value of `group_creation_prefix` in the sample configuration. ([\[#8992](https://github.com/matrix-org/synapse/pull/8992)]([#8992](https://github.com/matrix-org/synapse/pull/8992)))
- Link the Synapse developer room to the development section in the docs. ([\[#9002](https://github.com/matrix-org/synapse/pull/9002)]([#9002](https://github.com/matrix-org/synapse/pull/9002)))

Deprecations and Removals
-------------------------

- Deprecate Shutdown Room and Purge Room Admin APIs. ([\[#8829](https://github.com/matrix-org/synapse/pull/8829)]([#8829](https://github.com/matrix-org/synapse/pull/8829)))

Internal Changes
----------------

- Properly store the mapping of external ID to Matrix ID for CAS users. ([\[#8856](https://github.com/matrix-org/synapse/pull/8856)]([#8856](https://github.com/matrix-org/synapse/pull/8856)), [\[#8958](https://github.com/matrix-org/synapse/pull/8958)]([#8958](https://github.com/matrix-org/synapse/pull/8958)))
- Remove some unnecessary stubbing from unit tests. ([\[#8861](https://github.com/matrix-org/synapse/pull/8861)]([#8861](https://github.com/matrix-org/synapse/pull/8861)))
- Remove unused `FakeResponse` class from unit tests. ([\[#8864](https://github.com/matrix-org/synapse/pull/8864)]([#8864](https://github.com/matrix-org/synapse/pull/8864)))
- Pass `room_id` to `get_auth_chain_difference`. ([\[#8879](https://github.com/matrix-org/synapse/pull/8879)]([#8879](https://github.com/matrix-org/synapse/pull/8879)))
- Add type hints to push module. ([\[#8880](https://github.com/matrix-org/synapse/pull/8880)]([#8880](https://github.com/matrix-org/synapse/pull/8880)), [\[#8882](https://github.com/matrix-org/synapse/pull/8882)]([#8882](https://github.com/matrix-org/synapse/pull/8882)), [\[#8901](https://github.com/matrix-org/synapse/pull/8901)]([#8901](https://github.com/matrix-org/synapse/pull/8901)), [\[#8940](https://github.com/matrix-org/synapse/pull/8940)]([#8940](https://github.com/matrix-org/synapse/pull/8940)), [\[#8943](https://github.com/matrix-org/synapse/pull/8943)]([#8943](https://github.com/matrix-org/synapse/pull/8943)), [\[#9020](https://github.com/matrix-org/synapse/pull/9020)]([#9020](https://github.com/matrix-org/synapse/pull/9020)))
- Simplify logic for handling user-interactive-auth via single-sign-on servers. ([\[#8881](https://github.com/matrix-org/synapse/pull/8881)]([#8881](https://github.com/matrix-org/synapse/pull/8881)))
- Skip the SAML tests if the requirements (`pysaml2` and `xmlsec1`) aren't available. ([\[#8905](https://github.com/matrix-org/synapse/pull/8905)]([#8905](https://github.com/matrix-org/synapse/pull/8905)))
- Fix multiarch docker image builds. ([\[#8906](https://github.com/matrix-org/synapse/pull/8906)]([#8906](https://github.com/matrix-org/synapse/pull/8906)))
- Don't publish `latest` docker image until all archs are built. ([\[#8909](https://github.com/matrix-org/synapse/pull/8909)]([#8909](https://github.com/matrix-org/synapse/pull/8909)))
- Various clean-ups to the structured logging and logging context code. ([\[#8916](https://github.com/matrix-org/synapse/pull/8916)]([#8916](https://github.com/matrix-org/synapse/pull/8916)), [\[#8935](https://github.com/matrix-org/synapse/pull/8935)]([#8935](https://github.com/matrix-org/synapse/pull/8935)))
- Automatically drop stale forward-extremities under some specific conditions. ([\[#8929](https://github.com/matrix-org/synapse/pull/8929)]([#8929](https://github.com/matrix-org/synapse/pull/8929)))
- Refactor test utilities for injecting HTTP requests. ([\[#8946](https://github.com/matrix-org/synapse/pull/8946)]([#8946](https://github.com/matrix-org/synapse/pull/8946)))
- Add a maximum size of 50 kilobytes to .well-known lookups. ([\[#8950](https://github.com/matrix-org/synapse/pull/8950)]([#8950](https://github.com/matrix-org/synapse/pull/8950)))
- Fix bug in `generate_log_config` script which made it write empty files. ([\[#8952](https://github.com/matrix-org/synapse/pull/8952)]([#8952](https://github.com/matrix-org/synapse/pull/8952)))
- Clean up tox.ini file; disable coverage checking for non-test runs. ([\[#8963](https://github.com/matrix-org/synapse/pull/8963)]([#8963](https://github.com/matrix-org/synapse/pull/8963)))
- Add type hints to the admin and room list handlers. ([\[#8973](https://github.com/matrix-org/synapse/pull/8973)]([#8973](https://github.com/matrix-org/synapse/pull/8973)))
- Add type hints to the receipts and user directory handlers. ([\[#8976](https://github.com/matrix-org/synapse/pull/8976)]([#8976](https://github.com/matrix-org/synapse/pull/8976)))
- Drop the unused `local_invites` table. ([\[#8979](https://github.com/matrix-org/synapse/pull/8979)]([#8979](https://github.com/matrix-org/synapse/pull/8979)))
- Add type hints to the base storage code. ([\[#8980](https://github.com/matrix-org/synapse/pull/8980)]([#8980](https://github.com/matrix-org/synapse/pull/8980)))
- Support using PyJWT v2.0.0 in the test suite. ([\[#8986](https://github.com/matrix-org/synapse/pull/8986)]([#8986](https://github.com/matrix-org/synapse/pull/8986)))
- Fix `tests.federation.transport.RoomDirectoryFederationTests` and ensure it runs in CI. ([\[#8998](https://github.com/matrix-org/synapse/pull/8998)]([#8998](https://github.com/matrix-org/synapse/pull/8998)))
- Add type hints to the crypto module. ([\[#8999](https://github.com/matrix-org/synapse/pull/8999)]([#8999](https://github.com/matrix-org/synapse/pull/8999)))
```

This was referenced Jan 12, 2021

[don't apply blacklist to proxy connections
#9084](/matrix-org/synapse/pull/9084)
 Merged

[Fix using reactor as ip whitelist
#9098](/matrix-org/synapse/pull/9098)
 Merged

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Jan 13, 2021](#ref-commit-77c50e6)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.25](/NetBSD/pkgsrc/commit/77c50e6d6eba834d4ef70412227be0506fc9a3e3 "Update chat/matrix-synapse to 1.25

Synapse 1.25.0 (2021-01-13)
===========================

Ending Support for Python 3.5 and Postgres 9.5
----------------------------------------------

With this release, the Synapse team is announcing a formal deprecation policy for our platform dependencies, like Python and PostgreSQL:

All future releases of Synapse will follow the upstream end-of-life schedules.

Which means:

* This is the last release which guarantees support for Python 3.5.
* We will end support for PostgreSQL 9.5 early next month.
* We will end support for Python 3.6 and PostgreSQL 9.6 near the end of the year.

Crucially, this means __we will not produce .deb packages for Debian 9 (Stretch) or Ubuntu 16.04 (Xenial)__ beyond the transition period described below.

The website https://endoflife.date/ has convenient summaries of the support schedules for projects like [Python](https://endoflife.date/python) and [PostgreSQL](https://endoflife.date/postgresql).

If you are unable to upgrade your environment to a supported version of Python or Postgres, we encourage you to consider using the [Synapse Docker images](./INSTALL.md#docker-images-and-ansible-playbooks) instead.

### Transition Period

We will make a good faith attempt to avoid breaking compatibility in all releases through the end of March 2021. However, critical security vulnerabilities in dependencies or other unanticipated circumstances may arise which necessitate breaking compatibility earlier.

We intend to continue producing .deb packages for Debian 9 (Stretch) and Ubuntu 16.04 (Xenial) through the transition period.

Removal warning
---------------

The old [Purge Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/purge_room.md)
and [Shutdown Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/shutdown_room.md)
are deprecated and will be removed in a future release. They will be replaced by the
[Delete Room API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api/rooms.md#delete-room-api).

`POST /_synapse/admin/v1/rooms/<room_id>/delete` replaces `POST /_synapse/admin/v1/purge_room` and
`POST /_synapse/admin/v1/shutdown_room/<room_id>`.

Bugfixes
--------

- Fix HTTP proxy support when using a proxy that is on a blacklisted IP. Introduced in v1.25.0rc1. Contributed by @Bubu. ([\#9084](https://github.com/matrix-org/synapse/issues/9084))

Synapse 1.25.0rc1 (2021-01-06)
==============================

Features
--------

- Add an admin API that lets server admins get power in rooms in which local users have power. ([\#8756](https://github.com/matrix-org/synapse/issues/8756))
- Add optional HTTP authentication to replication endpoints. ([\#8853](https://github.com/matrix-org/synapse/issues/8853))
- Improve the error messages printed as a result of configuration problems for extension modules. ([\#8874](https://github.com/matrix-org/synapse/issues/8874))
- Add the number of local devices to Room Details Admin API. Contributed by @dklimpel. ([\#8886](https://github.com/matrix-org/synapse/issues/8886))
- Add `X-Robots-Tag` header to stop web crawlers from indexing media. Contributed by Aaron Raimist. ([\#8887](https://github.com/matrix-org/synapse/issues/8887))
- Spam-checkers may now define their methods as `async`. ([\#8890](https://github.com/matrix-org/synapse/issues/8890))
- Add support for allowing users to pick their own user ID during a single-sign-on login. ([\#8897](https://github.com/matrix-org/synapse/issues/8897), [\#8900](https://github.com/matrix-org/synapse/issues/8900), [\#8911](https://github.com/matrix-org/synapse/issues/8911), [\#8938](https://github.com/matrix-org/synapse/issues/8938), [\#8941](https://github.com/matrix-org/synapse/issues/8941), [\#8942](https://github.com/matrix-org/synapse/issues/8942), [\#8951](https://github.com/matrix-org/synapse/issues/8951))
- Add an `email.invite_client_location` configuration option to send a web client location to the invite endpoint on the identity server which allows customisation of the email template. ([\#8930](https://github.com/matrix-org/synapse/issues/8930))
- The search term in the list room and list user Admin APIs is now treated as case-insensitive. ([\#8931](https://github.com/matrix-org/synapse/issues/8931))
- Apply an IP range blacklist to push and key revocation requests. ([\#8821](https://github.com/matrix-org/synapse/issues/8821), [\#8870](https://github.com/matrix-org/synapse/issues/8870), [\#8954](https://github.com/matrix-org/synapse/issues/8954))
- Add an option to allow re-use of user-interactive authentication sessions for a period of time. ([\#8970](https://github.com/matrix-org/synapse/issues/8970))
- Allow running the redact endpoint on workers. ([\#8994](https://github.com/matrix-org/synapse/issues/8994))

Bugfixes
--------

- Fix bug where we might not correctly calculate the current state for rooms with multiple extremities. ([\#8827](https://github.com/matrix-org/synapse/issues/8827))
- Fix a long-standing bug in the register admin endpoint (`/_synapse/admin/v1/register`) when the `mac` field was not provided. The endpoint now properly returns a 400 error. Contributed by @edwargix. ([\#8837](https://github.com/matrix-org/synapse/issues/8837))
- Fix a long-standing bug on Synapse instances supporting Single-Sign-On, where users would be prompted to enter their password to confirm certain actions, even though they have not set a password. ([\#8858](https://github.com/matrix-org/synapse/issues/8858))
- Fix a longstanding bug where a 500 error would be returned if the `Content-Length` header was not provided to the upload media resource. ([\#8862](https://github.com/matrix-org/synapse/issues/8862))
- Add additional validation to pusher URLs to be compliant with the specification. ([\#8865](https://github.com/matrix-org/synapse/issues/8865))
- Fix the error code that is returned when a user tries to register on a homeserver on which new-user registration has been disabled. ([\#8867](https://github.com/matrix-org/synapse/issues/8867))
- Fix a bug where `PUT /_synapse/admin/v2/users/<user_id>` failed to create a new user when `avatar_url` is specified. Bug introduced in Synapse v1.9.0. ([\#8872](https://github.com/matrix-org/synapse/issues/8872))
- Fix a 500 error when attempting to preview an empty HTML file. ([\#8883](https://github.com/matrix-org/synapse/issues/8883))
- Fix occasional deadlock when handling SIGHUP. ([\#8918](https://github.com/matrix-org/synapse/issues/8918))
- Fix login API to not ratelimit application services that have ratelimiting disabled. ([\#8920](https://github.com/matrix-org/synapse/issues/8920))
- Fix bug where we ratelimited auto joining of rooms on registration (using `auto_join_rooms` config). ([\#8921](https://github.com/matrix-org/synapse/issues/8921))
- Fix a bug where deactivated users appeared in the user directory when their profile information was updated. ([\#8933](https://github.com/matrix-org/synapse/issues/8933), [\#8964](https://github.com/matrix-org/synapse/issues/8964))
- Fix bug introduced in Synapse v1.24.0 which would cause an exception on startup if both `enabled` and `localdb_enabled` were set to `False` in the `password_config` setting of the configuration file. ([\#8937](https://github.com/matrix-org/synapse/issues/8937))
- Fix a bug where 500 errors would be returned if the `m.room_history_visibility` event had invalid content. ([\#8945](https://github.com/matrix-org/synapse/issues/8945))
- Fix a bug causing common English words to not be considered for a user directory search. ([\#8959](https://github.com/matrix-org/synapse/issues/8959))
- Fix bug where application services couldn't register new ghost users if the server had reached its MAU limit. ([\#8962](https://github.com/matrix-org/synapse/issues/8962))
- Fix a long-standing bug where a `m.image` event without a `url` would cause errors on push. ([\#8965](https://github.com/matrix-org/synapse/issues/8965))
- Fix a small bug in v2 state resolution algorithm, which could also cause performance issues for rooms with large numbers of power levels. ([\#8971](https://github.com/matrix-org/synapse/issues/8971))
- Add validation to the `sendToDevice` API to raise a missing parameters error instead of a 500 error. ([\#8975](https://github.com/matrix-org/synapse/issues/8975))
- Add validation of group IDs to raise a 400 error instead of a 500 eror. ([\#8977](https://github.com/matrix-org/synapse/issues/8977))

Improved Documentation
----------------------

- Fix the \"Event persist rate\" section of the included grafana dashboard by adding missing prometheus rules. ([\#8802](https://github.com/matrix-org/synapse/issues/8802))
- Combine related media admin API docs. ([\#8839](https://github.com/matrix-org/synapse/issues/8839))
- Fix an error in the documentation for the SAML username mapping provider. ([\#8873](https://github.com/matrix-org/synapse/issues/8873))
- Clarify comments around template directories in `sample_config.yaml`. ([\#8891](https://github.com/matrix-org/synapse/issues/8891))
- Move instructions for database setup, adjusted heading levels and improved syntax highlighting in [INSTALL.md](../INSTALL.md). Contributed by @fossterer. ([\#8987](https://github.com/matrix-org/synapse/issues/8987))
- Update the example value of `group_creation_prefix` in the sample configuration. ([\#8992](https://github.com/matrix-org/synapse/issues/8992))
- Link the Synapse developer room to the development section in the docs. ([\#9002](https://github.com/matrix-org/synapse/issues/9002))

Deprecations and Removals
-------------------------

- Deprecate Shutdown Room and Purge Room Admin APIs. ([\#8829](https://github.com/matrix-org/synapse/issues/8829))

Internal Changes
----------------

- Properly store the mapping of external ID to Matrix ID for CAS users. ([\#8856](https://github.com/matrix-org/synapse/issues/8856), [\#8958](https://github.com/matrix-org/synapse/issues/8958))
- Remove some unnecessary stubbing from unit tests. ([\#8861](https://github.com/matrix-org/synapse/issues/8861))
- Remove unused `FakeResponse` class from unit tests. ([\#8864](https://github.com/matrix-org/synapse/issues/8864))
- Pass `room_id` to `get_auth_chain_difference`. ([\#8879](https://github.com/matrix-org/synapse/issues/8879))
- Add type hints to push module. ([\#8880](https://github.com/matrix-org/synapse/issues/8880), [\#8882](https://github.com/matrix-org/synapse/issues/8882), [\#8901](https://github.com/matrix-org/synapse/issues/8901), [\#8940](https://github.com/matrix-org/synapse/issues/8940), [\#8943](https://github.com/matrix-org/synapse/issues/8943), [\#9020](https://github.com/matrix-org/synapse/issues/9020))
- Simplify logic for handling user-interactive-auth via single-sign-on servers. ([\#8881](https://github.com/matrix-org/synapse/issues/8881))
- Skip the SAML tests if the requirements (`pysaml2` and `xmlsec1`) aren't available. ([\#8905](https://github.com/matrix-org/synapse/issues/8905))
- Fix multiarch docker image builds. ([\#8906](https://github.com/matrix-org/synapse/issues/8906))
- Don't publish `latest` docker image until all archs are built. ([\#8909](https://github.com/matrix-org/synapse/issues/8909))
- Various clean-ups to the structured logging and logging context code. ([\#8916](https://github.com/matrix-org/synapse/issues/8916), [\#8935](https://github.com/matrix-org/synapse/issues/8935))
- Automatically drop stale forward-extremities under some specific conditions. ([\#8929](https://github.com/matrix-org/synapse/issues/8929))
- Refactor test utilities for injecting HTTP requests. ([\#8946](https://github.com/matrix-org/synapse/issues/8946))
- Add a maximum size of 50 kilobytes to .well-known lookups. ([\#8950](https://github.com/matrix-org/synapse/issues/8950))
- Fix bug in `generate_log_config` script which made it write empty files. ([\#8952](https://github.com/matrix-org/synapse/issues/8952))
- Clean up tox.ini file; disable coverage checking for non-test runs. ([\#8963](https://github.com/matrix-org/synapse/issues/8963))
- Add type hints to the admin and room list handlers. ([\#8973](https://github.com/matrix-org/synapse/issues/8973))
- Add type hints to the receipts and user directory handlers. ([\#8976](https://github.com/matrix-org/synapse/issues/8976))
- Drop the unused `local_invites` table. ([\#8979](https://github.com/matrix-org/synapse/issues/8979))
- Add type hints to the base storage code. ([\#8980](https://github.com/matrix-org/synapse/issues/8980))
- Support using PyJWT v2.0.0 in the test suite. ([\#8986](https://github.com/matrix-org/synapse/issues/8986))
- Fix `tests.federation.transport.RoomDirectoryFederationTests` and ensure it runs in CI. ([\#8998](https://github.com/matrix-org/synapse/issues/8998))
- Add type hints to the crypto module. ([\#8999](https://github.com/matrix-org/synapse/issues/8999))")`
…

`[77c50e6](/NetBSD/pkgsrc/commit/77c50e6d6eba834d4ef70412227be0506fc9a3e3)`

```
Synapse 1.25.0 (2021-01-13)
===========================

Ending Support for Python 3.5 and Postgres 9.5
----------------------------------------------

With this release, the Synapse team is announcing a formal deprecation policy for our platform dependencies, like Python and PostgreSQL:

All future releases of Synapse will follow the upstream end-of-life schedules.

Which means:

* This is the last release which guarantees support for Python 3.5.
* We will end support for PostgreSQL 9.5 early next month.
* We will end support for Python 3.6 and PostgreSQL 9.6 near the end of the year.

Crucially, this means __we will not produce .deb packages for Debian 9 (Stretch) or Ubuntu 16.04 (Xenial)__ beyond the transition period described below.

The website <https://endoflife.date/> has convenient summaries of the support schedules for projects like [Python](<https://endoflife.date/python>) and [PostgreSQL](<https://endoflife.date/postgresql>).

If you are unable to upgrade your environment to a supported version of Python or Postgres, we encourage you to consider using the [Synapse Docker images](./INSTALL.md#docker-images-and-ansible-playbooks) instead.

### Transition Period

We will make a good faith attempt to avoid breaking compatibility in all releases through the end of March 2021. However, critical security vulnerabilities in dependencies or other unanticipated circumstances may arise which necessitate breaking compatibility earlier.

We intend to continue producing .deb packages for Debian 9 (Stretch) and Ubuntu 16.04 (Xenial) through the transition period.

Removal warning
---------------

The old [Purge Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/purge_room.md>)
and [Shutdown Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/shutdown_room.md>)
are deprecated and will be removed in a future release. They will be replaced by the
[Delete Room API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api/rooms.md#delete-room-api>).

`POST /_synapse/admin/v1/rooms/<room_id>/delete` replaces `POST /_synapse/admin/v1/purge_room` and
`POST /_synapse/admin/v1/shutdown_room/<room_id>`.

Bugfixes
--------

- Fix HTTP proxy support when using a proxy that is on a blacklisted IP. Introduced in v1.25.0rc1. Contributed by [@Bubu](https://github.com/Bubu). ([\#9084]([matrix-org/synapse#9084](https://github.com/matrix-org/synapse/pull/9084)))

Synapse 1.25.0rc1 (2021-01-06)
==============================

Features
--------

- Add an admin API that lets server admins get power in rooms in which local users have power. ([\#8756]([matrix-org/synapse#8756](https://github.com/matrix-org/synapse/pull/8756)))
- Add optional HTTP authentication to replication endpoints. ([\#8853]([matrix-org/synapse#8853](https://github.com/matrix-org/synapse/pull/8853)))
- Improve the error messages printed as a result of configuration problems for extension modules. ([\#8874]([matrix-org/synapse#8874](https://github.com/matrix-org/synapse/pull/8874)))
- Add the number of local devices to Room Details Admin API. Contributed by [@dklimpel](https://github.com/dklimpel). ([\#8886]([matrix-org/synapse#8886](https://github.com/matrix-org/synapse/pull/8886)))
- Add `X-Robots-Tag` header to stop web crawlers from indexing media. Contributed by Aaron Raimist. ([\#8887]([matrix-org/synapse#8887](https://github.com/matrix-org/synapse/pull/8887)))
- Spam-checkers may now define their methods as `async`. ([\#8890]([matrix-org/synapse#8890](https://github.com/matrix-org/synapse/pull/8890)))
- Add support for allowing users to pick their own user ID during a single-sign-on login. ([\#8897]([matrix-org/synapse#8897](https://github.com/matrix-org/synapse/pull/8897)), [\#8900]([matrix-org/synapse#8900](https://github.com/matrix-org/synapse/pull/8900)), [\#8911]([matrix-org/synapse#8911](https://github.com/matrix-org/synapse/pull/8911)), [\#8938]([matrix-org/synapse#8938](https://github.com/matrix-org/synapse/pull/8938)), [\#8941]([matrix-org/synapse#8941](https://github.com/matrix-org/synapse/pull/8941)), [\#8942]([matrix-org/synapse#8942](https://github.com/matrix-org/synapse/pull/8942)), [\#8951]([matrix-org/synapse#8951](https://github.com/matrix-org/synapse/pull/8951)))
- Add an `email.invite_client_location` configuration option to send a web client location to the invite endpoint on the identity server which allows customisation of the email template. ([\#8930]([matrix-org/synapse#8930](https://github.com/matrix-org/synapse/pull/8930)))
- The search term in the list room and list user Admin APIs is now treated as case-insensitive. ([\#8931]([matrix-org/synapse#8931](https://github.com/matrix-org/synapse/pull/8931)))
- Apply an IP range blacklist to push and key revocation requests. ([\#8821]([matrix-org/synapse#8821](https://github.com/matrix-org/synapse/pull/8821)), [\#8870]([matrix-org/synapse#8870](https://github.com/matrix-org/synapse/pull/8870)), [\#8954]([matrix-org/synapse#8954](https://github.com/matrix-org/synapse/pull/8954)))
- Add an option to allow re-use of user-interactive authentication sessions for a period of time. ([\#8970]([matrix-org/synapse#8970](https://github.com/matrix-org/synapse/pull/8970)))
- Allow running the redact endpoint on workers. ([\#8994]([matrix-org/synapse#8994](https://github.com/matrix-org/synapse/pull/8994)))

Bugfixes
--------

- Fix bug where we might not correctly calculate the current state for rooms with multiple extremities. ([\#8827]([matrix-org/synapse#8827](https://github.com/matrix-org/synapse/pull/8827)))
- Fix a long-standing bug in the register admin endpoint (`/_synapse/admin/v1/register`) when the `mac` field was not provided. The endpoint now properly returns a 400 error. Contributed by [@edwargix](https://github.com/edwargix). ([\#8837]([matrix-org/synapse#8837](https://github.com/matrix-org/synapse/pull/8837)))
- Fix a long-standing bug on Synapse instances supporting Single-Sign-On, where users would be prompted to enter their password to confirm certain actions, even though they have not set a password. ([\#8858]([matrix-org/synapse#8858](https://github.com/matrix-org/synapse/pull/8858)))
- Fix a longstanding bug where a 500 error would be returned if the `Content-Length` header was not provided to the upload media resource. ([\#8862]([matrix-org/synapse#8862](https://github.com/matrix-org/synapse/pull/8862)))
- Add additional validation to pusher URLs to be compliant with the specification. ([\#8865]([matrix-org/synapse#8865](https://github.com/matrix-org/synapse/pull/8865)))
- Fix the error code that is returned when a user tries to register on a homeserver on which new-user registration has been disabled. ([\#8867]([matrix-org/synapse#8867](https://github.com/matrix-org/synapse/pull/8867)))
- Fix a bug where `PUT /_synapse/admin/v2/users/<user_id>` failed to create a new user when `avatar_url` is specified. Bug introduced in Synapse v1.9.0. ([\#8872]([matrix-org/synapse#8872](https://github.com/matrix-org/synapse/pull/8872)))
- Fix a 500 error when attempting to preview an empty HTML file. ([\#8883]([matrix-org/synapse#8883](https://github.com/matrix-org/synapse/pull/8883)))
- Fix occasional deadlock when handling SIGHUP. ([\#8918]([matrix-org/synapse#8918](https://github.com/matrix-org/synapse/pull/8918)))
- Fix login API to not ratelimit application services that have ratelimiting disabled. ([\#8920]([matrix-org/synapse#8920](https://github.com/matrix-org/synapse/pull/8920)))
- Fix bug where we ratelimited auto joining of rooms on registration (using `auto_join_rooms` config). ([\#8921]([matrix-org/synapse#8921](https://github.com/matrix-org/synapse/pull/8921)))
- Fix a bug where deactivated users appeared in the user directory when their profile information was updated. ([\#8933]([matrix-org/synapse#8933](https://github.com/matrix-org/synapse/pull/8933)), [\#8964]([matrix-org/synapse#8964](https://github.com/matrix-org/synapse/pull/8964)))
- Fix bug introduced in Synapse v1.24.0 which would cause an exception on startup if both `enabled` and `localdb_enabled` were set to `False` in the `password_config` setting of the configuration file. ([\#8937]([matrix-org/synapse#8937](https://github.com/matrix-org/synapse/pull/8937)))
- Fix a bug where 500 errors would be returned if the `m.room_history_visibility` event had invalid content. ([\#8945]([matrix-org/synapse#8945](https://github.com/matrix-org/synapse/pull/8945)))
- Fix a bug causing common English words to not be considered for a user directory search. ([\#8959]([matrix-org/synapse#8959](https://github.com/matrix-org/synapse/pull/8959)))
- Fix bug where application services couldn't register new ghost users if the server had reached its MAU limit. ([\#8962]([matrix-org/synapse#8962](https://github.com/matrix-org/synapse/pull/8962)))
- Fix a long-standing bug where a `m.image` event without a `url` would cause errors on push. ([\#8965]([matrix-org/synapse#8965](https://github.com/matrix-org/synapse/pull/8965)))
- Fix a small bug in v2 state resolution algorithm, which could also cause performance issues for rooms with large numbers of power levels. ([\#8971]([matrix-org/synapse#8971](https://github.com/matrix-org/synapse/pull/8971)))
- Add validation to the `sendToDevice` API to raise a missing parameters error instead of a 500 error. ([\#8975]([matrix-org/synapse#8975](https://github.com/matrix-org/synapse/pull/8975)))
- Add validation of group IDs to raise a 400 error instead of a 500 eror. ([\#8977]([matrix-org/synapse#8977](https://github.com/matrix-org/synapse/pull/8977)))

Improved Documentation
----------------------

- Fix the "Event persist rate" section of the included grafana dashboard by adding missing prometheus rules. ([\#8802]([matrix-org/synapse#8802](https://github.com/matrix-org/synapse/pull/8802)))
- Combine related media admin API docs. ([\#8839]([matrix-org/synapse#8839](https://github.com/matrix-org/synapse/pull/8839)))
- Fix an error in the documentation for the SAML username mapping provider. ([\#8873]([matrix-org/synapse#8873](https://github.com/matrix-org/synapse/pull/8873)))
- Clarify comments around template directories in `sample_config.yaml`. ([\#8891]([matrix-org/synapse#8891](https://github.com/matrix-org/synapse/pull/8891)))
- Move instructions for database setup, adjusted heading levels and improved syntax highlighting in [INSTALL.md](../INSTALL.md). Contributed by [@fossterer](https://github.com/fossterer). ([\#8987]([matrix-org/synapse#8987](https://github.com/matrix-org/synapse/pull/8987)))
- Update the example value of `group_creation_prefix` in the sample configuration. ([\#8992]([matrix-org/synapse#8992](https://github.com/matrix-org/synapse/pull/8992)))
- Link the Synapse developer room to the development section in the docs. ([\#9002]([matrix-org/synapse#9002](https://github.com/matrix-org/synapse/pull/9002)))

Deprecations and Removals
-------------------------

- Deprecate Shutdown Room and Purge Room Admin APIs. ([\#8829]([matrix-org/synapse#8829](https://github.com/matrix-org/synapse/pull/8829)))

Internal Changes
----------------

- Properly store the mapping of external ID to Matrix ID for CAS users. ([\#8856]([matrix-org/synapse#8856](https://github.com/matrix-org/synapse/pull/8856)), [\#8958]([matrix-org/synapse#8958](https://github.com/matrix-org/synapse/pull/8958)))
- Remove some unnecessary stubbing from unit tests. ([\#8861]([matrix-org/synapse#8861](https://github.com/matrix-org/synapse/pull/8861)))
- Remove unused `FakeResponse` class from unit tests. ([\#8864]([matrix-org/synapse#8864](https://github.com/matrix-org/synapse/pull/8864)))
- Pass `room_id` to `get_auth_chain_difference`. ([\#8879]([matrix-org/synapse#8879](https://github.com/matrix-org/synapse/pull/8879)))
- Add type hints to push module. ([\#8880]([matrix-org/synapse#8880](https://github.com/matrix-org/synapse/pull/8880)), [\#8882]([matrix-org/synapse#8882](https://github.com/matrix-org/synapse/pull/8882)), [\#8901]([matrix-org/synapse#8901](https://github.com/matrix-org/synapse/pull/8901)), [\#8940]([matrix-org/synapse#8940](https://github.com/matrix-org/synapse/pull/8940)), [\#8943]([matrix-org/synapse#8943](https://github.com/matrix-org/synapse/pull/8943)), [\#9020]([matrix-org/synapse#9020](https://github.com/matrix-org/synapse/pull/9020)))
- Simplify logic for handling user-interactive-auth via single-sign-on servers. ([\#8881]([matrix-org/synapse#8881](https://github.com/matrix-org/synapse/pull/8881)))
- Skip the SAML tests if the requirements (`pysaml2` and `xmlsec1`) aren't available. ([\#8905]([matrix-org/synapse#8905](https://github.com/matrix-org/synapse/pull/8905)))
- Fix multiarch docker image builds. ([\#8906]([matrix-org/synapse#8906](https://github.com/matrix-org/synapse/pull/8906)))
- Don't publish `latest` docker image until all archs are built. ([\#8909]([matrix-org/synapse#8909](https://github.com/matrix-org/synapse/pull/8909)))
- Various clean-ups to the structured logging and logging context code. ([\#8916]([matrix-org/synapse#8916](https://github.com/matrix-org/synapse/pull/8916)), [\#8935]([matrix-org/synapse#8935](https://github.com/matrix-org/synapse/pull/8935)))
- Automatically drop stale forward-extremities under some specific conditions. ([\#8929]([matrix-org/synapse#8929](https://github.com/matrix-org/synapse/pull/8929)))
- Refactor test utilities for injecting HTTP requests. ([\#8946]([matrix-org/synapse#8946](https://github.com/matrix-org/synapse/pull/8946)))
- Add a maximum size of 50 kilobytes to .well-known lookups. ([\#8950]([matrix-org/synapse#8950](https://github.com/matrix-org/synapse/pull/8950)))
- Fix bug in `generate_log_config` script which made it write empty files. ([\#8952]([matrix-org/synapse#8952](https://github.com/matrix-org/synapse/pull/8952)))
- Clean up tox.ini file; disable coverage checking for non-test runs. ([\#8963]([matrix-org/synapse#8963](https://github.com/matrix-org/synapse/pull/8963)))
- Add type hints to the admin and room list handlers. ([\#8973]([matrix-org/synapse#8973](https://github.com/matrix-org/synapse/pull/8973)))
- Add type hints to the receipts and user directory handlers. ([\#8976]([matrix-org/synapse#8976](https://github.com/matrix-org/synapse/pull/8976)))
- Drop the unused `local_invites` table. ([\#8979]([matrix-org/synapse#8979](https://github.com/matrix-org/synapse/pull/8979)))
- Add type hints to the base storage code. ([\#8980]([matrix-org/synapse#8980](https://github.com/matrix-org/synapse/pull/8980)))
- Support using PyJWT v2.0.0 in the test suite. ([\#8986]([matrix-org/synapse#8986](https://github.com/matrix-org/synapse/pull/8986)))
- Fix `tests.federation.transport.RoomDirectoryFederationTests` and ensure it runs in CI. ([\#8998]([matrix-org/synapse#8998](https://github.com/matrix-org/synapse/pull/8998)))
- Add type hints to the crypto module. ([\#8999]([matrix-org/synapse#8999](https://github.com/matrix-org/synapse/pull/8999)))
```

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
mentioned this pull request
[Feb 24, 2021](#ref-issue-809351845)

[url\_preview\_ip\_range\_blacklist not honored
#9417](/matrix-org/synapse/issues/9417)

Closed

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)
[anoadragon453](/anoadragon453)
mentioned this pull request
[Mar 19, 2021](#ref-pullrequest-836136428)

[Port "Add support for no\_proxy and case insensitive env variables" from mainline to dinsic
matrix-org/synapse-dinsic#93](/matrix-org/synapse-dinsic/pull/93)
 Merged

[anoadragon453](/anoadragon453)
added a commit
to matrix-org/synapse-dinsic
that referenced
this pull request
[Mar 22, 2021](#ref-commit-232b324)
[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)

`[Port "Add support for no_proxy and case insensitive env variables" fr…](/matrix-org/synapse-dinsic/commit/232b324c38b3914509550aa895b791a33874c915 "Port \"Add support for no_proxy and case insensitive env variables\" from mainline to dinsic (#93)

This PR is simply porting https://github.com/matrix-org/synapse/pull/9372 to dinsic.

I also had to bring in https://github.com/matrix-org/synapse/pull/8821 and https://github.com/matrix-org/synapse/pull/9084 for this code to work properly - a sign that we should merge mainline into dinsic again soon.")`
…

`[232b324](/matrix-org/synapse-dinsic/commit/232b324c38b3914509550aa895b791a33874c915)`

```
…om mainline to dinsic ([#93](https://github.com/matrix-org/synapse-dinsic/pull/93))

This PR is simply porting [matrix-org/synapse#9372](https://github.com/matrix-org/synapse/pull/9372) to dinsic.

I also had to bring in [matrix-org/synapse#8821](https://github.com/matrix-org/synapse/pull/8821) and [matrix-org/synapse#9084](https://github.com/matrix-org/synapse/pull/9084) for this code to work properly - a sign that we should merge mainline into dinsic again soon.
```

[![@matrixbot](https://avatars.githubusercontent.com/u/10127976?s=40&v=4)](/matrixbot)
[matrixbot](/matrixbot)
mentioned this pull request
[Dec 21, 2023](#ref-issue-2046134501)

[Implement a blacklisting endpoint (instead of a blacklisting reactor and agent wrapper)
element-hq/synapse#8860](/element-hq/synapse/issues/8860)

Open

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8821).

Reviewers

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh) [richvdh](/richvdh)

richvdh approved these changes

Assignees

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [clokep](/clokep)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=52&v=4)](/richvdh)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_787a207b_20250114_224034.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2F30fba6210834a4ecd91badf0c8f3eb278b72e746)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2F30fba6210834a4ecd91badf0c8f3eb278b72e746)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

## Commit

[Permalink](/matrix-org/synapse/commit/30fba6210834a4ecd91badf0c8f3eb278b72e746)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Apply an IP range blacklist to push and key revocation requests. ([#8821](https://github.com/matrix-org/synapse/pull/8821))

[Browse files](/matrix-org/synapse/tree/30fba6210834a4ecd91badf0c8f3eb278b72e746)
Browse the repository at this point in the history

```
Replaces the `federation_ip_range_blacklist` configuration setting with an
`ip_range_blacklist` setting with wider scope. It now applies to:

* Federation
* Identity servers
* Push notifications
* Checking key validitity for third-party invite events

The old `federation_ip_range_blacklist` setting is still honored if present, but
with reduced scope (it only applies to federation and identity servers).
```

* Loading branch information

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

[clokep](/matrix-org/synapse/commits?author=clokep "View all commits by clokep")
authored
Dec 2, 2020

1 parent
[c5b6abd](/matrix-org/synapse/commit/c5b6abd53d1549c7a7cc30c644dd8921bfc10ea2)

commit 30fba62

 Show file tree

 Hide file tree

Showing
**43 changed files**
with
**176 additions**
and
**115 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changelog.d

  + changelog.d/8821.bugfix
    [8821.bugfix](#diff-78bde019e330af8af4e87ab06f14f92ef79d4e2e34713028ca0359682388cd1b)
* docs

  + docs/sample\_config.yaml
    [sample\_config.yaml](#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50)
* synapse

  + app

    - synapse/app/generic\_worker.py
      [generic\_worker.py](#diff-cec3e0420be3c586de1288d7bb9fbbb5ba429eff8e6ee4f5879e9007eb45b14f)
  + config

    - synapse/config/federation.py
      [federation.py](#diff-a3aad28a4c7bba8432003312ef01a6e6a6fea7eca485be5f4076adca82039e99)
  + crypto

    - synapse/crypto/keyring.py
      [keyring.py](#diff-dc50147b1e53e98fac29dce4c09f91ea667371dcd4c7722cb8a3c52d4fb0be1a)
  + federation

    - synapse/federation/federation\_server.py
      [federation\_server.py](#diff-996dafa2cabdf043e51a444e5d3c5ba8389d48e6cdab0d469677974bd470d58f)
    - transport

      * synapse/federation/transport/client.py
        [client.py](#diff-09c25d20bf6df7d5ac41a7a78ceaa91020ee625b6bd3315ed151e37d1e945983)
  + handlers

    - synapse/handlers/federation.py
      [federation.py](#diff-0bc92da3d703202f5b9be2d3f845e375f5b1a6bc6ba61705a8af9be1121f5e42)
    - synapse/handlers/identity.py
      [identity.py](#diff-f53dc2b43f0e206c2b56886917fe5298f45fec5a7d34818381c88a69a93475c4)
  + http

    - synapse/http/client.py
      [client.py](#diff-66444b92f547d9edb90914be0717bbe92d7b02ce10b65b4546b6c629af563ae9)
    - federation

      * synapse/http/federation/matrix\_federation\_agent.py
        [matrix\_federation\_agent.py](#diff-7d60480ce0406e905864f9cd1b28b1790517cb7bfbfdae328d41220133eb3497)
    - synapse/http/matrixfederationclient.py
      [matrixfederationclient.py](#diff-a53ea02bf6a0cbb98e925b47e71f4ffb149075536543c1eca15366fc65c90aef)
  + push

    - synapse/push/httppusher.py
      [httppusher.py](#diff-870d797e72b9b0db3d4c9cccdbc51e2e7ce39305e435d94b03af8c6c7793d971)
  + rest/media/v1

    - synapse/rest/media/v1/media\_repository.py
      [media\_repository.py](#diff-d87d85c544d5cb5523ca53beeb28e9deac391e1b297eb5fde6875c1c3e0afb19)
  + synapse/server.py
    [server.py](#diff-866c3d74edb6e0478fbd9f241551fc9d4a9468e7b2fee8a262ecd02c07de5127)
* tests

  + api

    - tests/api/test\_filtering.py
      [test\_filtering.py](#diff-adc32d3c96bfe7a1b60fe32f0c1a186f133e199ea82950e1901a70166f593a6a)
  + app

    - tests/app/test\_frontend\_proxy.py
      [test\_frontend\_proxy.py](#diff-57bdf2fc0c1b9154bb894e763deac58a9e464f2f443d27a59d1cfb2a60a32b97)
    - tests/app/test\_openid\_listener.py
      [test\_openid\_listener.py](#diff-ecdba10dbbdf84107a9239cee24172e59b20a453fede219364672a7f90120c28)
  + crypto

    - tests/crypto/test\_keyring.py
      [test\_keyring.py](#diff-14f992133dbc79ca2ac32678b8391a41fb3848e0807cf6f04bee1028f771fe8d)
  + handlers

    - tests/handlers/test\_device.py
      [test\_device.py](#diff-1321cd6219b79ce179f6020303093bcc939dd379898805513d3c9e493e25a11d)
    - tests/handlers/test\_directory.py
      [test\_directory.py](#diff-8ff7d42cb3b681719a9cc49a3b78f812d21ea285d5c34b5e71507ac23dd97774)
    - tests/handlers/test\_federation.py
      [test\_federation.py](#diff-76a6c73434aa6e4b24d5c10c012da7ce10b2c53730112c1efc5524840ce67802)
    - tests/handlers/test\_presence.py
      [test\_presence.py](#diff-cd607bfa767174e99f557c0009394ba4bf16e414b7a09013376e8ab1a7474fbd)
    - tests/handlers/test\_profile.py
      [test\_profile.py](#diff-b5803e73d0bba7aef1803dab1e2157e37c4dcb43ee70b79b60037779e4af0a6f)
    - tests/handlers/test\_typing.py
      [test\_typing.py](#diff-6fb18b186fc320fddfca635927c6b83f8b3360ef5ed2f1e6101612d20d3b0b11)
  + http/federation

    - tests/http/federation/test\_matrix\_federation\_agent.py
      [test\_matrix\_federation\_agent.py](#diff-433005b0b4c240474be987e6288c5f7c4494e8e5eadb180640962c8b8c321cfc)
  + push

    - tests/push/test\_http.py
      [test\_http.py](#diff-fc50eb453359646f21e02c22cc1719f3f0e58ce448df99234f071c50d65bd861)
  + replication

    - tests/replication/\_base.py
      [\_base.py](#diff-a9ebf2431c74f44306a4d023bec932eb7b2d65d298c06ef6ea204d4d1c4b5b38)
    - tests/replication/test\_federation\_sender\_shard.py
      [test\_federation\_sender\_shard.py](#diff-911bf872522c4ecae39b5173c0718f076d1a5eedcebf54e5f79a9814a8f68d5b)
    - tests/replication/test\_pusher\_shard.py
      [test\_pusher\_shard.py](#diff-f6b9258a4d42fcd9cdf0bd0b1c96503e5109d4235be31d4e68dd55ef19dbe8a3)
  + rest

    - admin

      * tests/rest/admin/test\_admin.py
        [test\_admin.py](#diff-9a2d21c78e8e75d036c37e08442eaba54a35a30cb6301d79962167a0eac4b629)
    - client/v1

      * tests/rest/client/v1/test\_presence.py
        [test\_presence.py](#diff-9a7d4f9c5021c176416a189ecdfcc90e119ef983e0388e5e6dfe5dcaa6e60ce4)
      * tests/rest/client/v1/test\_profile.py
        [test\_profile.py](#diff-4755362f1ed91daea3a616c198f24f0f44a54f8910e3a40f24ef207c26572de5)
      * tests/rest/client/v1/test\_rooms.py
        [test\_rooms.py](#diff-fc047b99c1c3105dc4b7790a26e71e837628b542bb281162989597cf019223d6)
      * tests/rest/client/v1/test\_typing.py
        [test\_typing.py](#diff-e3774d6c0467c3a55654e89a43cfb5f1d694cd7e15ff02450e7d654a6889678e)
    - key/v2

      * tests/rest/key/v2/test\_remote\_key\_resource.py
        [test\_remote\_key\_resource.py](#diff-cf63a4ba66474d6da8e8627be58b6118be62f592498a2ae3488e4987d2f0affd)
    - media/v1

      * tests/rest/media/v1/test\_media\_storage.py
        [test\_media\_storage.py](#diff-18522cfe7ecbf53585c659d1fe2c33b9903a6e8ab35e22638fe287fee07c7910)
  + storage

    - tests/storage/test\_e2e\_room\_keys.py
      [test\_e2e\_room\_keys.py](#diff-a234bb1929cfac04c0a31f15228349fa6be2d5e28c8f9b3d8499df312a392cad)
    - tests/storage/test\_purge.py
      [test\_purge.py](#diff-ba775e9e907e5910cca0f4b1c14b4ed07a10eb4133171157e25050714e473b34)
    - tests/storage/test\_redaction.py
      [test\_redaction.py](#diff-0a249ef72a2c19fe9d0a19ba9c85997247870198a2b691ca4425a9a933eb8922)
    - tests/storage/test\_roommember.py
      [test\_roommember.py](#diff-8581d2a69757ef84698bdc6f02f49ac297c3978a35577c2022ceaad2d0a9aeaf)
  + tests/test\_federation.py
    [test\_federation.py](#diff-1b0f6b59f3dc80f413c00c0aca692a8af6f060e247e0d7f7d147db8db4a44da3)
  + tests/test\_server.py
    [test\_server.py](#diff-5620588ecb93aec064fe16ec7e5c10f6669041c927717e0f57b3f9a44ffec5ac)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[changelog.d/8821.bugfix](#diff-78bde019e330af8af4e87ab06f14f92ef79d4e2e34713028ca0359682388cd1b "changelog.d/8821.bugfix")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/changelog.d/8821.bugfix)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Apply the `federation\_ip\_range\_blacklist` to push and key revocation requests. |

14 changes: 8 additions & 6 deletions

14
[docs/sample\_config.yaml](#diff-48ee4f3967bc96bc276a51fc2e69ea6a2ddbf2dbdbef59752f94f1e33e736e50 "docs/sample_config.yaml")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/docs/sample_config.yaml)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -642,17 +642,19 @@ acme: |
|  |  | # - nyc.example.com |
|  |  | # - syd.example.com |
|  |  |  |
|  |  | # Prevent federation requests from being sent to the following |
|  |  | # blacklist IP address CIDR ranges. If this option is not specified, or |
|  |  | # specified with an empty list, no ip range blacklist will be enforced. |
|  |  | # Prevent outgoing requests from being sent to the following blacklisted IP address |
|  |  | # CIDR ranges. If this option is not specified, or specified with an empty list, |
|  |  | # no IP range blacklist will be enforced. |
|  |  | # |
|  |  | # As of Synapse v1.4.0 this option also affects any outbound requests to identity |
|  |  | # servers provided by user input. |
|  |  | # The blacklist applies to the outbound requests for federation, identity servers, |
|  |  | # push servers, and for checking key validitity for third-party invite events. |
|  |  | # |
|  |  | # (0.0.0.0 and :: are always blacklisted, whether or not they are explicitly |
|  |  | # listed here, since they correspond to unroutable addresses.) |
|  |  | # |
|  |  | federation\_ip\_range\_blacklist: |
|  |  | # This option replaces federation\_ip\_range\_blacklist in Synapse v1.24.0. |
|  |  | # |
|  |  | ip\_range\_blacklist: |
|  |  | - '127.0.0.0/8' |
|  |  | - '10.0.0.0/8' |
|  |  | - '172.16.0.0/12' |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[synapse/app/generic\_worker.py](#diff-cec3e0420be3c586de1288d7bb9fbbb5ba429eff8e6ee4f5879e9007eb45b14f "synapse/app/generic_worker.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/app/generic_worker.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -266,7 +266,6 @@ def \_\_init\_\_(self, hs): |
|  |  | super().\_\_init\_\_(hs) |
|  |  | self.hs = hs |
|  |  | self.is\_mine\_id = hs.is\_mine\_id |
|  |  | self.http\_client = hs.get\_simple\_http\_client() |
|  |  |  |
|  |  | self.\_presence\_enabled = hs.config.use\_presence |
|  |  |  |
| Expand Down | |  |

40 changes: 25 additions & 15 deletions

40
[synapse/config/federation.py](#diff-a3aad28a4c7bba8432003312ef01a6e6a6fea7eca485be5f4076adca82039e99 "synapse/config/federation.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/config/federation.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,22 +36,30 @@ def read\_config(self, config, \*\*kwargs): |
|  |  | for domain in federation\_domain\_whitelist: |
|  |  | self.federation\_domain\_whitelist[domain] = True |
|  |  |  |
|  |  | self.federation\_ip\_range\_blacklist = config.get( |
|  |  | "federation\_ip\_range\_blacklist", [] |
|  |  | ) |
|  |  | ip\_range\_blacklist = config.get("ip\_range\_blacklist", []) |
|  |  |  |
|  |  | # Attempt to create an IPSet from the given ranges |
|  |  | try: |
|  |  | self.federation\_ip\_range\_blacklist = IPSet( |
|  |  | self.federation\_ip\_range\_blacklist |
|  |  | ) |
|  |  |  |
|  |  | # Always blacklist 0.0.0.0, :: |
|  |  | self.federation\_ip\_range\_blacklist.update(["0.0.0.0", "::"]) |
|  |  | self.ip\_range\_blacklist = IPSet(ip\_range\_blacklist) |
|  |  | except Exception as e: |
|  |  | raise ConfigError("Invalid range(s) provided in ip\_range\_blacklist: %s" % e) |
|  |  | # Always blacklist 0.0.0.0, :: |
|  |  | self.ip\_range\_blacklist.update(["0.0.0.0", "::"]) |
|  |  |  |
|  |  | # The federation\_ip\_range\_blacklist is used for backwards-compatibility |
|  |  | # and only applies to federation and identity servers. If it is not given, |
|  |  | # default to ip\_range\_blacklist. |
|  |  | federation\_ip\_range\_blacklist = config.get( |
|  |  | "federation\_ip\_range\_blacklist", ip\_range\_blacklist |
|  |  | ) |
|  |  | try: |
|  |  | self.federation\_ip\_range\_blacklist = IPSet(federation\_ip\_range\_blacklist) |
|  |  | except Exception as e: |
|  |  | raise ConfigError( |
|  |  | "Invalid range(s) provided in federation\_ip\_range\_blacklist: %s" % e |
|  |  | ) |
|  |  | # Always blacklist 0.0.0.0, :: |
|  |  | self.federation\_ip\_range\_blacklist.update(["0.0.0.0", "::"]) |
|  |  |  |
|  |  | federation\_metrics\_domains = config.get("federation\_metrics\_domains") or [] |
|  |  | validate\_config( |
| Expand All | | @@ -76,17 +84,19 @@ def generate\_config\_section(self, config\_dir\_path, server\_name, \*\*kwargs): |
|  |  | # - nyc.example.com |
|  |  | # - syd.example.com |
|  |  |  |
|  |  | # Prevent federation requests from being sent to the following |
|  |  | # blacklist IP address CIDR ranges. If this option is not specified, or |
|  |  | # specified with an empty list, no ip range blacklist will be enforced. |
|  |  | # Prevent outgoing requests from being sent to the following blacklisted IP address |
|  |  | # CIDR ranges. If this option is not specified, or specified with an empty list, |
|  |  | # no IP range blacklist will be enforced. |
|  |  | # |
|  |  | # As of Synapse v1.4.0 this option also affects any outbound requests to identity |
|  |  | # servers provided by user input. |
|  |  | # The blacklist applies to the outbound requests for federation, identity servers, |
|  |  | # push servers, and for checking key validitity for third-party invite events. |
|  |  | # |
|  |  | # (0.0.0.0 and :: are always blacklisted, whether or not they are explicitly |
|  |  | # listed here, since they correspond to unroutable addresses.) |
|  |  | # |
|  |  | federation\_ip\_range\_blacklist: |
|  |  | # This option replaces federation\_ip\_range\_blacklist in Synapse v1.24.0. |
|  |  | # |
|  |  | ip\_range\_blacklist: |
|  |  | - '127.0.0.0/8' |
|  |  | - '10.0.0.0/8' |
|  |  | - '172.16.0.0/12' |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[synapse/crypto/keyring.py](#diff-dc50147b1e53e98fac29dce4c09f91ea667371dcd4c7722cb8a3c52d4fb0be1a "synapse/crypto/keyring.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/crypto/keyring.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -578,7 +578,7 @@ class PerspectivesKeyFetcher(BaseV2KeyFetcher): |
|  |  | def \_\_init\_\_(self, hs): |
|  |  | super().\_\_init\_\_(hs) |
|  |  | self.clock = hs.get\_clock() |
|  |  | self.client = hs.get\_http\_client() |
|  |  | self.client = hs.get\_federation\_http\_client() |
|  |  | self.key\_servers = self.config.key\_servers |
|  |  |  |
|  |  | async def get\_keys(self, keys\_to\_fetch): |
| Expand Down  Expand Up | | @@ -748,7 +748,7 @@ class ServerKeyFetcher(BaseV2KeyFetcher): |
|  |  | def \_\_init\_\_(self, hs): |
|  |  | super().\_\_init\_\_(hs) |
|  |  | self.clock = hs.get\_clock() |
|  |  | self.client = hs.get\_http\_client() |
|  |  | self.client = hs.get\_federation\_http\_client() |
|  |  |  |
|  |  | async def get\_keys(self, keys\_to\_fetch): |
|  |  | """ |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[synapse/federation/federation\_server.py](#diff-996dafa2cabdf043e51a444e5d3c5ba8389d48e6cdab0d469677974bd470d58f "synapse/federation/federation_server.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/federation/federation_server.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -845,7 +845,6 @@ class FederationHandlerRegistry: |
|  |  |  |
|  |  | def \_\_init\_\_(self, hs: "HomeServer"): |
|  |  | self.config = hs.config |
|  |  | self.http\_client = hs.get\_simple\_http\_client() |
|  |  | self.clock = hs.get\_clock() |
|  |  | self.\_instance\_name = hs.get\_instance\_name() |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/federation/transport/client.py](#diff-09c25d20bf6df7d5ac41a7a78ceaa91020ee625b6bd3315ed151e37d1e945983 "synapse/federation/transport/client.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/federation/transport/client.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,7 +35,7 @@ class TransportLayerClient: |
|  |  |  |
|  |  | def \_\_init\_\_(self, hs): |
|  |  | self.server\_name = hs.hostname |
|  |  | self.client = hs.get\_http\_client() |
|  |  | self.client = hs.get\_federation\_http\_client() |
|  |  |  |
|  |  | @log\_function |
|  |  | def get\_room\_state\_ids(self, destination, room\_id, event\_id): |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/handlers/federation.py](#diff-0bc92da3d703202f5b9be2d3f845e375f5b1a6bc6ba61705a8af9be1121f5e42 "synapse/handlers/federation.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/handlers/federation.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -140,7 +140,7 @@ def \_\_init\_\_(self, hs: "HomeServer"): |
|  |  | self.\_message\_handler = hs.get\_message\_handler() |
|  |  | self.\_server\_notices\_mxid = hs.config.server\_notices\_mxid |
|  |  | self.config = hs.config |
|  |  | self.http\_client = hs.get\_simple\_http\_client() |
|  |  | self.http\_client = hs.get\_proxied\_blacklisted\_http\_client() |
|  |  | self.\_instance\_name = hs.get\_instance\_name() |
|  |  | self.\_replication = hs.get\_replication\_data\_handler() |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[synapse/handlers/identity.py](#diff-f53dc2b43f0e206c2b56886917fe5298f45fec5a7d34818381c88a69a93475c4 "synapse/handlers/identity.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/handlers/identity.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,13 +46,13 @@ class IdentityHandler(BaseHandler): |
|  |  | def \_\_init\_\_(self, hs): |
|  |  | super().\_\_init\_\_(hs) |
|  |  |  |
|  |  | # An HTTP client for contacting trusted URLs. |
|  |  | self.http\_client = SimpleHttpClient(hs) |
|  |  | # We create a blacklisting instance of SimpleHttpClient for contacting identity |
|  |  | # servers specified by clients |
|  |  | # An HTTP client for contacting identity servers specified by clients. |
|  |  | self.blacklisting\_http\_client = SimpleHttpClient( |
|  |  | hs, ip\_blacklist=hs.config.federation\_ip\_range\_blacklist |
|  |  | ) |
|  |  | self.federation\_http\_client = hs.get\_http\_client() |
|  |  | self.federation\_http\_client = hs.get\_federation\_http\_client() |
|  |  | self.hs = hs |
|  |  |  |
|  |  | async def threepid\_from\_creds( |
| Expand Down | |  |

46 changes: 32 additions & 14 deletions

46
[synapse/http/client.py](#diff-66444b92f547d9edb90914be0717bbe92d7b02ce10b65b4546b6c629af563ae9 "synapse/http/client.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/http/client.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -125,7 +125,7 @@ def \_scheduler(x): |
|  |  | return \_scheduler |
|  |  |  |
|  |  |  |
|  |  | class IPBlacklistingResolver: |
|  |  | class \_IPBlacklistingResolver: |
|  |  | """ |
|  |  | A proxy for reactor.nameResolver which only produces non-blacklisted IP |
|  |  | addresses, preventing DNS rebinding attacks on URL preview. |
| Expand Down  Expand Up | | @@ -199,6 +199,35 @@ def resolutionComplete() -> None: |
|  |  | return r |
|  |  |  |
|  |  |  |
|  |  | @implementer(IReactorPluggableNameResolver) |
|  |  | class BlacklistingReactorWrapper: |
|  |  | """ |
|  |  | A Reactor wrapper which will prevent DNS resolution to blacklisted IP |
|  |  | addresses, to prevent DNS rebinding. |
|  |  | """ |
|  |  |  |
|  |  | def \_\_init\_\_( |
|  |  | self, |
|  |  | reactor: IReactorPluggableNameResolver, |
|  |  | ip\_whitelist: Optional[IPSet], |
|  |  | ip\_blacklist: IPSet, |
|  |  | ): |
|  |  | self.\_reactor = reactor |
|  |  |  |
|  |  | # We need to use a DNS resolver which filters out blacklisted IP |
|  |  | # addresses, to prevent DNS rebinding. |
|  |  | self.\_nameResolver = \_IPBlacklistingResolver( |
|  |  | self.\_reactor, ip\_whitelist, ip\_blacklist |
|  |  | ) |
|  |  |  |
|  |  | def \_\_getattr\_\_(self, attr: str) -> Any: |
|  |  | # Passthrough to the real reactor except for the DNS resolver. |
|  |  | if attr == "nameResolver": |
|  |  | return self.\_nameResolver |
|  |  | else: |
|  |  | return getattr(self.\_reactor, attr) |
|  |  |  |
|  |  |  |
|  |  | class BlacklistingAgentWrapper(Agent): |
|  |  | """ |
|  |  | An Agent wrapper which will prevent access to IP addresses being accessed |
| Expand Down  Expand Up | | @@ -292,22 +321,11 @@ def \_\_init\_\_( |
|  |  | self.user\_agent = self.user\_agent.encode("ascii") |
|  |  |  |
|  |  | if self.\_ip\_blacklist: |
|  |  | real\_reactor = hs.get\_reactor() |
|  |  | # If we have an IP blacklist, we need to use a DNS resolver which |
|  |  | # filters out blacklisted IP addresses, to prevent DNS rebinding. |
|  |  | nameResolver = IPBlacklistingResolver( |
|  |  | real\_reactor, self.\_ip\_whitelist, self.\_ip\_blacklist |
|  |  | self.reactor = BlacklistingReactorWrapper( |
|  |  | hs.get\_reactor(), self.\_ip\_whitelist, self.\_ip\_blacklist |
|  |  | ) |
|  |  |  |
|  |  | @implementer(IReactorPluggableNameResolver) |
|  |  | class Reactor: |
|  |  | def \_\_getattr\_\_(\_self, attr): |
|  |  | if attr == "nameResolver": |
|  |  | return nameResolver |
|  |  | else: |
|  |  | return getattr(real\_reactor, attr) |
|  |  |  |
|  |  | self.reactor = Reactor() |
|  |  | else: |
|  |  | self.reactor = hs.get\_reactor() |
|  |  |  |
| Expand Down | |  |

16 changes: 12 additions & 4 deletions

16
[synapse/http/federation/matrix\_federation\_agent.py](#diff-7d60480ce0406e905864f9cd1b28b1790517cb7bfbfdae328d41220133eb3497 "synapse/http/federation/matrix_federation_agent.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/http/federation/matrix_federation_agent.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,7 @@ |
|  |  | import urllib.parse |
|  |  | from typing import List, Optional |
|  |  |  |
|  |  | from netaddr import AddrFormatError, IPAddress |
|  |  | from netaddr import AddrFormatError, IPAddress, IPSet |
|  |  | from zope.interface import implementer |
|  |  |  |
|  |  | from twisted.internet import defer |
| Expand All | | @@ -31,6 +31,7 @@ |
|  |  | from twisted.web.iweb import IAgent, IAgentEndpointFactory, IBodyProducer |
|  |  |  |
|  |  | from synapse.crypto.context\_factory import FederationPolicyForHTTPS |
|  |  | from synapse.http.client import BlacklistingAgentWrapper |
|  |  | from synapse.http.federation.srv\_resolver import Server, SrvResolver |
|  |  | from synapse.http.federation.well\_known\_resolver import WellKnownResolver |
|  |  | from synapse.logging.context import make\_deferred\_yieldable, run\_in\_background |
| Expand Down  Expand Up | | @@ -70,6 +71,7 @@ def \_\_init\_\_( |
|  |  | reactor: IReactorCore, |
|  |  | tls\_client\_options\_factory: Optional[FederationPolicyForHTTPS], |
|  |  | user\_agent: bytes, |
|  |  | ip\_blacklist: IPSet, |
|  |  | \_srv\_resolver: Optional[SrvResolver] = None, |
|  |  | \_well\_known\_resolver: Optional[WellKnownResolver] = None, |
|  |  | ): |
| Expand All | | @@ -90,12 +92,18 @@ def \_\_init\_\_( |
|  |  | self.user\_agent = user\_agent |
|  |  |  |
|  |  | if \_well\_known\_resolver is None: |
|  |  | # Note that the name resolver has already been wrapped in a |
|  |  | # IPBlacklistingResolver by MatrixFederationHttpClient. |
|  |  | \_well\_known\_resolver = WellKnownResolver( |
|  |  | self.\_reactor, |
|  |  | agent=Agent( |
|  |  | agent=BlacklistingAgentWrapper( |
|  |  | Agent( |
|  |  | self.\_reactor, |
|  |  | pool=self.\_pool, |
|  |  | contextFactory=tls\_client\_options\_factory, |
|  |  | ), |
|  |  | self.\_reactor, |
|  |  | pool=self.\_pool, |
|  |  | contextFactory=tls\_client\_options\_factory, |
|  |  | ip\_blacklist=ip\_blacklist, |
|  |  | ), |
|  |  | user\_agent=self.user\_agent, |
|  |  | ) |
| Expand Down | |  |

26 changes: 8 additions & 18 deletions

26
[synapse/http/matrixfederationclient.py](#diff-a53ea02bf6a0cbb98e925b47e71f4ffb149075536543c1eca15366fc65c90aef "synapse/http/matrixfederationclient.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/http/matrixfederationclient.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,11 +26,10 @@ |
|  |  | from canonicaljson import encode\_canonical\_json |
|  |  | from prometheus\_client import Counter |
|  |  | from signedjson.sign import sign\_json |
|  |  | from zope.interface import implementer |
|  |  |  |
|  |  | from twisted.internet import defer |
|  |  | from twisted.internet.error import DNSLookupError |
|  |  | from twisted.internet.interfaces import IReactorPluggableNameResolver, IReactorTime |
|  |  | from twisted.internet.interfaces import IReactorTime |
|  |  | from twisted.internet.task import \_EPSILON, Cooperator |
|  |  | from twisted.web.http\_headers import Headers |
|  |  | from twisted.web.iweb import IBodyProducer, IResponse |
| Expand All | | @@ -45,7 +44,7 @@ |
|  |  | from synapse.http import QuieterFileBodyProducer |
|  |  | from synapse.http.client import ( |
|  |  | BlacklistingAgentWrapper, |
|  |  | IPBlacklistingResolver, |
|  |  | BlacklistingReactorWrapper, |
|  |  | encode\_query\_args, |
|  |  | readBodyToFile, |
|  |  | ) |
| Expand Down  Expand Up | | @@ -221,31 +220,22 @@ def \_\_init\_\_(self, hs, tls\_client\_options\_factory): |
|  |  | self.signing\_key = hs.signing\_key |
|  |  | self.server\_name = hs.hostname |
|  |  |  |
|  |  | real\_reactor = hs.get\_reactor() |
|  |  |  |
|  |  | # We need to use a DNS resolver which filters out blacklisted IP |
|  |  | # addresses, to prevent DNS rebinding. |
|  |  | nameResolver = IPBlacklistingResolver( |
|  |  | real\_reactor, None, hs.config.federation\_ip\_range\_blacklist |
|  |  | self.reactor = BlacklistingReactorWrapper( |
|  |  | hs.get\_reactor(), None, hs.config.federation\_ip\_range\_blacklist |
|  |  | ) |
|  |  |  |
|  |  | @implementer(IReactorPluggableNameResolver) |
|  |  | class Reactor: |
|  |  | def \_\_getattr\_\_(\_self, attr): |
|  |  | if attr == "nameResolver": |
|  |  | return nameResolver |
|  |  | else: |
|  |  | return getattr(real\_reactor, attr) |
|  |  |  |
|  |  | self.reactor = Reactor() |
|  |  |  |
|  |  | user\_agent = hs.version\_string |
|  |  | if hs.config.user\_agent\_suffix: |
|  |  | user\_agent = "%s %s" % (user\_agent, hs.config.user\_agent\_suffix) |
|  |  | user\_agent = user\_agent.encode("ascii") |
|  |  |  |
|  |  | self.agent = MatrixFederationAgent( |
|  |  | self.reactor, tls\_client\_options\_factory, user\_agent |
|  |  | self.reactor, |
|  |  | tls\_client\_options\_factory, |
|  |  | user\_agent, |
|  |  | hs.config.federation\_ip\_range\_blacklist, |
|  |  | ) |
|  |  |  |
|  |  | # Use a BlacklistingAgentWrapper to prevent circumventing the IP |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/push/httppusher.py](#diff-870d797e72b9b0db3d4c9cccdbc51e2e7ce39305e435d94b03af8c6c7793d971 "synapse/push/httppusher.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/push/httppusher.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,7 +100,7 @@ def \_\_init\_\_(self, hs, pusherdict): |
|  |  | if "url" not in self.data: |
|  |  | raise PusherConfigException("'url' required in data for HTTP pusher") |
|  |  | self.url = self.data["url"] |
|  |  | self.http\_client = hs.get\_proxied\_http\_client() |
|  |  | self.http\_client = hs.get\_proxied\_blacklisted\_http\_client() |
|  |  | self.data\_minus\_url = {} |
|  |  | self.data\_minus\_url.update(self.data) |
|  |  | del self.data\_minus\_url["url"] |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[synapse/rest/media/v1/media\_repository.py](#diff-d87d85c544d5cb5523ca53beeb28e9deac391e1b297eb5fde6875c1c3e0afb19 "synapse/rest/media/v1/media_repository.py")

Show comments

[View file](/matrix-org/synapse/blob/30fba6210834a4ecd91badf0c8f3eb278b72e746/synapse/rest/media/v1/media_repository.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -66,7 +66,7 @@ class MediaRepository: |
|  |  | def \_\_init\_\_(self, hs): |
|  |  | self.hs = hs |
|  |  | self.auth = hs.get\_auth() |
|  |  | self.client = hs.get\_http\_client() |
|  |  | self.client = hs.get\_federation\_http\_client() |
|  |  | self.clock = hs.get\_clock() |
|  |  | self.server\_name = hs.hostname |
|  |  | self.store = hs.get\_datastore() |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `30fba62`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fcommit%2F30fba6210834a4ecd91badf0c8f3eb278b72e746) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e01aaaa0_20250114_224041.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-v936-j8gp-9q3p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-v936-j8gp-9q3p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Open redirects on some federation and push requests

Low

[clokep](/clokep)
published
GHSA-v936-j8gp-9q3p
Feb 25, 2021

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.25.0

## Patched versions

>= 1.25.0

## Description

### Impact

Requests to user provided domains were not restricted to external IP addresses when calculating the key validity for third-party invite events and sending push notifications. This could cause Synapse to make requests to internal infrastructure. The type of request was not controlled by the user, although limited modification of request bodies was possible.

For the most thorough protection server administrators should remove the deprecated `federation_ip_range_blacklist` from their settings after upgrading to Synapse v1.25.0 which will result in Synapse using the improved default IP address restrictions. See the new `ip_range_blacklist` and `ip_range_whitelist` settings if more specific control is necessary.

### Patches

Issue is resolved by [#8821](https://github.com/matrix-org/synapse/pull/8821). Further improvements to protect homeservers by default were made in [#8870](https://github.com/matrix-org/synapse/pull/8870) and [#8954](https://github.com/matrix-org/synapse/pull/8954).

### Workarounds

Requests to internal IP addresses could be blocked at the system or network level.

### Severity

Low

### CVE ID

CVE-2021-21273

### Weaknesses

No CWEs

### Credits

* [![@mscherer](https://avatars.githubusercontent.com/u/230335?s=40&v=4)](/mscherer)
  [mscherer](/mscherer)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


