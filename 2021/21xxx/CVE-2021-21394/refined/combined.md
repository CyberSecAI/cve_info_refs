=== Content from github.com_ce7bf70f_20250114_211831.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9321)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9321)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Type hints and validation improvements #9321

 Merged

[clokep](/clokep)
merged 5 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/misc-val](/matrix-org/synapse/tree/clokep/misc-val "matrix-org/synapse:clokep/misc-val")

Feb 8, 2021

 Merged

# [Type hints and validation improvements](#top) #9321

[clokep](/clokep)
merged 5 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/misc-val](/matrix-org/synapse/tree/clokep/misc-val "matrix-org/synapse:clokep/misc-val")

Feb 8, 2021

[Conversation
0](/matrix-org/synapse/pull/9321)
[Commits
5](/matrix-org/synapse/pull/9321/commits)
[Checks
0](/matrix-org/synapse/pull/9321/checks)
[Files changed](/matrix-org/synapse/pull/9321/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Feb 4, 2021](#issue-801392864)

* Adds some type hints to the groups servlet and stringutils code.
* Assert the maximum length some input values for spec compliance.

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 5 commits
[February 4, 2021 09:19](#commits-pushed-181d91f)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add length checks for client secret.](/matrix-org/synapse/pull/9321/commits/181d91f988043c3380269d4aa41f0d3741ecb079 "Add length checks for client secret.")`

`[181d91f](/matrix-org/synapse/pull/9321/commits/181d91f988043c3380269d4aa41f0d3741ecb079)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Improve some type hints.](/matrix-org/synapse/pull/9321/commits/cd1f97c1b38fedba303164a25f53e65413785aee "Improve some type hints.")`

`[cd1f97c](/matrix-org/synapse/pull/9321/commits/cd1f97c1b38fedba303164a25f53e65413785aee)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Improve some validation of profile data.](/matrix-org/synapse/pull/9321/commits/dd2a8fb441ec5d572f8687b5c617522138afb05f "Improve some validation of profile data.")`

`[dd2a8fb](/matrix-org/synapse/pull/9321/commits/dd2a8fb441ec5d572f8687b5c617522138afb05f)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add more type hints.](/matrix-org/synapse/pull/9321/commits/d31196a432ff710783f668b7ea74144d5e137c5a "Add more type hints.")`

`[d31196a](/matrix-org/synapse/pull/9321/commits/d31196a432ff710783f668b7ea74144d5e137c5a)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Newsfragment](/matrix-org/synapse/pull/9321/commits/a4aaf29e134407db21dbc804ae2e78af41e93e22 "Newsfragment")`

`[a4aaf29](/matrix-org/synapse/pull/9321/commits/a4aaf29e134407db21dbc804ae2e78af41e93e22)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[February 4, 2021 16:21](#event-4291791615)

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Feb 8, 2021](#pullrequestreview-585683936)

 [View reviewed changes](/matrix-org/synapse/pull/9321/files/a4aaf29e134407db21dbc804ae2e78af41e93e22)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`3f58fc8`](/matrix-org/synapse/commit/3f58fc848d0002de4605bed91603a1f9f245d128)
into
develop

[Feb 8, 2021](https://github.com/matrix-org/synapse/pull/9321#event-4305133813)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/misc-val

branch
[February 8, 2021 18:59](#event-4305133866)

[clokep](/clokep)
added a commit
that referenced
this pull request
[Feb 19, 2021](#ref-commit-d9f1dcc)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

`[Merge tag 'v1.28.0rc1' into develop](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8 "Merge tag 'v1.28.0rc1' into develop

Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))")`
…

`[d9f1dcc](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8)`

```
Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\[#9150](https://github.com/matrix-org/synapse/pull/9150)]([#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\[#9300](https://github.com/matrix-org/synapse/pull/9300)]([#9300](https://github.com/matrix-org/synapse/pull/9300)), [\[#9301](https://github.com/matrix-org/synapse/pull/9301)]([#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\[#9311](https://github.com/matrix-org/synapse/pull/9311)]([#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\[#9376](https://github.com/matrix-org/synapse/pull/9376)]([#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\[#9400](https://github.com/matrix-org/synapse/pull/9400)]([#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\[#9257](https://github.com/matrix-org/synapse/pull/9257)]([#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\[#9296](https://github.com/matrix-org/synapse/pull/9296)]([#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\[#9321](https://github.com/matrix-org/synapse/pull/9321)]([#9321](https://github.com/matrix-org/synapse/pull/9321)), [\[#9393](https://github.com/matrix-org/synapse/pull/9393)]([#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\[#9333](https://github.com/matrix-org/synapse/pull/9333)]([#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\[#9361](https://github.com/matrix-org/synapse/pull/9361)]([#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\[#9391](https://github.com/matrix-org/synapse/pull/9391)]([#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\[#9395](https://github.com/matrix-org/synapse/pull/9395)]([#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\[#9421](https://github.com/matrix-org/synapse/pull/9421)]([#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\[#9425](https://github.com/matrix-org/synapse/pull/9425)]([#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\[#9426](https://github.com/matrix-org/synapse/pull/9426)]([#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\[#9428](https://github.com/matrix-org/synapse/pull/9428)]([#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\[#9433](https://github.com/matrix-org/synapse/pull/9433)]([#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\[#9281](https://github.com/matrix-org/synapse/pull/9281)]([#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\[#9291](https://github.com/matrix-org/synapse/pull/9291)]([#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\[#9308](https://github.com/matrix-org/synapse/pull/9308)]([#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\[#9317](https://github.com/matrix-org/synapse/pull/9317)]([#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\[#9322](https://github.com/matrix-org/synapse/pull/9322)]([#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\[#9390](https://github.com/matrix-org/synapse/pull/9390)]([#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\[#9404](https://github.com/matrix-org/synapse/pull/9404)]([#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\[#9407](https://github.com/matrix-org/synapse/pull/9407)]([#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\[#9434](https://github.com/matrix-org/synapse/pull/9434)]([#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\[#9429](https://github.com/matrix-org/synapse/pull/9429)]([#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\[#9003](https://github.com/matrix-org/synapse/pull/9003)]([#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\[#9123](https://github.com/matrix-org/synapse/pull/9123)]([#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\[#9240](https://github.com/matrix-org/synapse/pull/9240)]([#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\[#9299](https://github.com/matrix-org/synapse/pull/9299)]([#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\[#9305](https://github.com/matrix-org/synapse/pull/9305)]([#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\[#9307](https://github.com/matrix-org/synapse/pull/9307)]([#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\[#9326](https://github.com/matrix-org/synapse/pull/9326)]([#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\[#9362](https://github.com/matrix-org/synapse/pull/9362)]([#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\[#9377](https://github.com/matrix-org/synapse/pull/9377)]([#9377](https://github.com/matrix-org/synapse/pull/9377)), [\[#9396](https://github.com/matrix-org/synapse/pull/9396)]([#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\[#9381](https://github.com/matrix-org/synapse/pull/9381)]([#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\[#9384](https://github.com/matrix-org/synapse/pull/9384)]([#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\[#9394](https://github.com/matrix-org/synapse/pull/9394)]([#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\[#9408](https://github.com/matrix-org/synapse/pull/9408)]([#9408](https://github.com/matrix-org/synapse/pull/9408)))
```

[Half-Shot](/Half-Shot)
pushed a commit
that referenced
this pull request
[Feb 20, 2021](#ref-commit-19d6db3)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep) [![@Half-Shot](https://avatars.githubusercontent.com/u/2072976?s=40&v=4)](/Half-Shot)

`[Type hints and validation improvements. (](/matrix-org/synapse/commit/19d6db319db83de6a359e973f34bfa9e9b5b4d71 "Type hints and validation improvements. (#9321)

* Adds type hints to the groups servlet and stringutils code.
* Assert the maximum length of some input values for spec compliance.")[#9321](https://github.com/matrix-org/synapse/pull/9321)[)](/matrix-org/synapse/commit/19d6db319db83de6a359e973f34bfa9e9b5b4d71 "Type hints and validation improvements. (#9321)

* Adds type hints to the groups servlet and stringutils code.
* Assert the maximum length of some input values for spec compliance.")`
…

`[19d6db3](/matrix-org/synapse/commit/19d6db319db83de6a359e973f34bfa9e9b5b4d71)`

```
* Adds type hints to the groups servlet and stringutils code.
* Assert the maximum length of some input values for spec compliance.
```

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Mar 6, 2021](#ref-commit-31d3054)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.28.0](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2 "Update chat/matrix-synapse to 1.28.0

Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474](https://github.com/matrix-org/synapse/issues/9474))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405](https://github.com/matrix-org/synapse/issues/9405))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297](https://github.com/matrix-org/synapse/issues/9297))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302](https://github.com/matrix-org/synapse/issues/9302))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313](https://github.com/matrix-org/synapse/issues/9313))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310](https://github.com/matrix-org/synapse/issues/9310))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062](https://github.com/matrix-org/synapse/issues/9062))
- Add an admin API for retrieving the current room state of a room. ([\#9168](https://github.com/matrix-org/synapse/issues/9168))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858](https://github.com/matrix-org/matrix-doc/pull/2858)). ([\#9183](https://github.com/matrix-org/synapse/issues/9183), [\#9242](https://github.com/matrix-org/synapse/issues/9242))
- Add an admin API endpoint for shadow-banning users. ([\#9209](https://github.com/matrix-org/synapse/issues/9209))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238](https://github.com/matrix-org/synapse/issues/9238))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245](https://github.com/matrix-org/synapse/issues/9245))
- Add ratelimits to invites in rooms and to specific users. ([\#9258](https://github.com/matrix-org/synapse/issues/9258))
- Improve the user experience of setting up an account via single-sign on. ([\#9262](https://github.com/matrix-org/synapse/issues/9262), [\#9272](https://github.com/matrix-org/synapse/issues/9272), [\#9275](https://github.com/matrix-org/synapse/issues/9275), [\#9276](https://github.com/matrix-org/synapse/issues/9276), [\#9277](https://github.com/matrix-org/synapse/issues/9277), [\#9286](https://github.com/matrix-org/synapse/issues/9286), [\#9287](https://github.com/matrix-org/synapse/issues/9287))
- Add phone home stats for encrypted messages. ([\#9283](https://github.com/matrix-org/synapse/issues/9283))
- Update the redirect URI for OIDC authentication. ([\#9288](https://github.com/matrix-org/synapse/issues/9288))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121](https://github.com/matrix-org/synapse/issues/9121))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163](https://github.com/matrix-org/synapse/issues/9163))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164](https://github.com/matrix-org/synapse/issues/9164))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165](https://github.com/matrix-org/synapse/issues/9165))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218](https://github.com/matrix-org/synapse/issues/9218))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229](https://github.com/matrix-org/synapse/issues/9229))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235](https://github.com/matrix-org/synapse/issues/9235))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265](https://github.com/matrix-org/synapse/issues/9265))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271](https://github.com/matrix-org/synapse/issues/9271))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134](https://github.com/matrix-org/synapse/issues/9134))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135](https://github.com/matrix-org/synapse/issues/9135))
- Add notes on integrating with Facebook for SSO login. ([\#9244](https://github.com/matrix-org/synapse/issues/9244))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199](https://github.com/matrix-org/synapse/issues/9199))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289](https://github.com/matrix-org/synapse/issues/9289))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045](https://github.com/matrix-org/synapse/issues/9045))
- Various improvements to the federation client. ([\#9129](https://github.com/matrix-org/synapse/issues/9129))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176](https://github.com/matrix-org/synapse/issues/9176))
- Add a `long_description_type` to the package metadata. ([\#9180](https://github.com/matrix-org/synapse/issues/9180))
- Speed up batch insertion when using PostgreSQL. ([\#9181](https://github.com/matrix-org/synapse/issues/9181), [\#9188](https://github.com/matrix-org/synapse/issues/9188))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184](https://github.com/matrix-org/synapse/issues/9184))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190](https://github.com/matrix-org/synapse/issues/9190))
- Add some missing source directories to the automatic linting script. ([\#9191](https://github.com/matrix-org/synapse/issues/9191))
- Precompute joined hosts and store in Redis. ([\#9198](https://github.com/matrix-org/synapse/issues/9198), [\#9227](https://github.com/matrix-org/synapse/issues/9227))
- Clean-up template loading code. ([\#9200](https://github.com/matrix-org/synapse/issues/9200))
- Fix the Python 3.5 old dependencies build. ([\#9217](https://github.com/matrix-org/synapse/issues/9217))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222](https://github.com/matrix-org/synapse/issues/9222))
- Add type hints to handlers code. ([\#9223](https://github.com/matrix-org/synapse/issues/9223), [\#9232](https://github.com/matrix-org/synapse/issues/9232))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254](https://github.com/matrix-org/synapse/issues/9254))
- Minor performance improvement during TLS handshake. ([\#9255](https://github.com/matrix-org/synapse/issues/9255))
- Refactor the generation of summary text for email notifications. ([\#9260](https://github.com/matrix-org/synapse/issues/9260))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270](https://github.com/matrix-org/synapse/issues/9270))")`
…

`[31d3054](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2)`

```
Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474]([matrix-org/synapse#9474](https://github.com/matrix-org/synapse/pull/9474)))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150]([matrix-org/synapse#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\#9300]([matrix-org/synapse#9300](https://github.com/matrix-org/synapse/pull/9300)), [\#9301]([matrix-org/synapse#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311]([matrix-org/synapse#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376]([matrix-org/synapse#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\#9400]([matrix-org/synapse#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257]([matrix-org/synapse#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\#9296]([matrix-org/synapse#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\#9321]([matrix-org/synapse#9321](https://github.com/matrix-org/synapse/pull/9321)), [\#9393]([matrix-org/synapse#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\#9333]([matrix-org/synapse#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361]([matrix-org/synapse#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391]([matrix-org/synapse#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\#9395]([matrix-org/synapse#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421]([matrix-org/synapse#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425]([matrix-org/synapse#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426]([matrix-org/synapse#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\#9428]([matrix-org/synapse#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433]([matrix-org/synapse#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281]([matrix-org/synapse#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291]([matrix-org/synapse#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\#9308]([matrix-org/synapse#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317]([matrix-org/synapse#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\#9322]([matrix-org/synapse#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390]([matrix-org/synapse#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\#9404]([matrix-org/synapse#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\#9407]([matrix-org/synapse#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434]([matrix-org/synapse#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429]([matrix-org/synapse#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003]([matrix-org/synapse#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\#9123]([matrix-org/synapse#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\#9240]([matrix-org/synapse#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299]([matrix-org/synapse#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\#9305]([matrix-org/synapse#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\#9307]([matrix-org/synapse#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326]([matrix-org/synapse#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362]([matrix-org/synapse#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\#9377]([matrix-org/synapse#9377](https://github.com/matrix-org/synapse/pull/9377)), [\#9396]([matrix-org/synapse#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\#9381]([matrix-org/synapse#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\#9384]([matrix-org/synapse#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\#9394]([matrix-org/synapse#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\#9408]([matrix-org/synapse#9408](https://github.com/matrix-org/synapse/pull/9408)))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405]([matrix-org/synapse#9405](https://github.com/matrix-org/synapse/pull/9405)))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297]([matrix-org/synapse#9297](https://github.com/matrix-org/synapse/pull/9297)))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302]([matrix-org/synapse#9302](https://github.com/matrix-org/synapse/pull/9302)))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313]([matrix-org/synapse#9313](https://github.com/matrix-org/synapse/pull/9313)))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310]([matrix-org/synapse#9310](https://github.com/matrix-org/synapse/pull/9310)))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062]([matrix-org/synapse#9062](https://github.com/matrix-org/synapse/pull/9062)))
- Add an admin API for retrieving the current room state of a room. ([\#9168]([matrix-org/synapse#9168](https://github.com/matrix-org/synapse/pull/9168)))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858]([matrix-org/matrix-spec-proposals#2858](https://github.com/matrix-org/matrix-spec-proposals/pull/2858))). ([\#9183]([matrix-org/synapse#9183](https://github.com/matrix-org/synapse/pull/9183)), [\#9242]([matrix-org/synapse#9242](https://github.com/matrix-org/synapse/pull/9242)))
- Add an admin API endpoint for shadow-banning users. ([\#9209]([matrix-org/synapse#9209](https://github.com/matrix-org/synapse/pull/9209)))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238]([matrix-org/synapse#9238](https://github.com/matrix-org/synapse/pull/9238)))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245]([matrix-org/synapse#9245](https://github.com/matrix-org/synapse/pull/9245)))
- Add ratelimits to invites in rooms and to specific users. ([\#9258]([matrix-org/synapse#9258](https://github.com/matrix-org/synapse/pull/9258)))
- Improve the user experience of setting up an account via single-sign on. ([\#9262]([matrix-org/synapse#9262](https://github.com/matrix-org/synapse/pull/9262)), [\#9272]([matrix-org/synapse#9272](https://github.com/matrix-org/synapse/pull/9272)), [\#9275]([matrix-org/synapse#9275](https://github.com/matrix-org/synapse/pull/9275)), [\#9276]([matrix-org/synapse#9276](https://github.com/matrix-org/synapse/pull/9276)), [\#9277]([matrix-org/synapse#9277](https://github.com/matrix-org/synapse/pull/9277)), [\#9286]([matrix-org/synapse#9286](https://github.com/matrix-org/synapse/pull/9286)), [\#9287]([matrix-org/synapse#9287](https://github.com/matrix-org/synapse/pull/9287)))
- Add phone home stats for encrypted messages. ([\#9283]([matrix-org/synapse#9283](https://github.com/matrix-org/synapse/pull/9283)))
- Update the redirect URI for OIDC authentication. ([\#9288]([matrix-org/synapse#9288](https://github.com/matrix-org/synapse/pull/9288)))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121]([matrix-org/synapse#9121](https://github.com/matrix-org/synapse/pull/9121)))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163]([matrix-org/synapse#9163](https://github.com/matrix-org/synapse/pull/9163)))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164]([matrix-org/synapse#9164](https://github.com/matrix-org/synapse/pull/9164)))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165]([matrix-org/synapse#9165](https://github.com/matrix-org/synapse/pull/9165)))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218]([matrix-org/synapse#9218](https://github.com/matrix-org/synapse/pull/9218)))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229]([matrix-org/synapse#9229](https://github.com/matrix-org/synapse/pull/9229)))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235]([matrix-org/synapse#9235](https://github.com/matrix-org/synapse/pull/9235)))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265]([matrix-org/synapse#9265](https://github.com/matrix-org/synapse/pull/9265)))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271]([matrix-org/synapse#9271](https://github.com/matrix-org/synapse/pull/9271)))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134]([matrix-org/synapse#9134](https://github.com/matrix-org/synapse/pull/9134)))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135]([matrix-org/synapse#9135](https://github.com/matrix-org/synapse/pull/9135)))
- Add notes on integrating with Facebook for SSO login. ([\#9244]([matrix-org/synapse#9244](https://github.com/matrix-org/synapse/pull/9244)))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199]([matrix-org/synapse#9199](https://github.com/matrix-org/synapse/pull/9199)))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289]([matrix-org/synapse#9289](https://github.com/matrix-org/synapse/pull/9289)))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045]([matrix-org/synapse#9045](https://github.com/matrix-org/synapse/pull/9045)))
- Various improvements to the federation client. ([\#9129]([matrix-org/synapse#9129](https://github.com/matrix-org/synapse/pull/9129)))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176]([matrix-org/synapse#9176](https://github.com/matrix-org/synapse/pull/9176)))
- Add a `long_description_type` to the package metadata. ([\#9180]([matrix-org/synapse#9180](https://github.com/matrix-org/synapse/pull/9180)))
- Speed up batch insertion when using PostgreSQL. ([\#9181]([matrix-org/synapse#9181](https://github.com/matrix-org/synapse/pull/9181)), [\#9188]([matrix-org/synapse#9188](https://github.com/matrix-org/synapse/pull/9188)))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184]([matrix-org/synapse#9184](https://github.com/matrix-org/synapse/pull/9184)))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190]([matrix-org/synapse#9190](https://github.com/matrix-org/synapse/pull/9190)))
- Add some missing source directories to the automatic linting script. ([\#9191]([matrix-org/synapse#9191](https://github.com/matrix-org/synapse/pull/9191)))
- Precompute joined hosts and store in Redis. ([\#9198]([matrix-org/synapse#9198](https://github.com/matrix-org/synapse/pull/9198)), [\#9227]([matrix-org/synapse#9227](https://github.com/matrix-org/synapse/pull/9227)))
- Clean-up template loading code. ([\#9200]([matrix-org/synapse#9200](https://github.com/matrix-org/synapse/pull/9200)))
- Fix the Python 3.5 old dependencies build. ([\#9217]([matrix-org/synapse#9217](https://github.com/matrix-org/synapse/pull/9217)))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222]([matrix-org/synapse#9222](https://github.com/matrix-org/synapse/pull/9222)))
- Add type hints to handlers code. ([\#9223]([matrix-org/synapse#9223](https://github.com/matrix-org/synapse/pull/9223)), [\#9232]([matrix-org/synapse#9232](https://github.com/matrix-org/synapse/pull/9232)))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254]([matrix-org/synapse#9254](https://github.com/matrix-org/synapse/pull/9254)))
- Minor performance improvement during TLS handshake. ([\#9255]([matrix-org/synapse#9255](https://github.com/matrix-org/synapse/pull/9255)))
- Refactor the generation of summary text for email notifications. ([\#9260]([matrix-org/synapse#9260](https://github.com/matrix-org/synapse/pull/9260)))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270]([matrix-org/synapse#9270](https://github.com/matrix-org/synapse/pull/9270)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9321).

Reviewers

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [erikjohnston](/erikjohnston)

erikjohnston approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from pypi.org_362695ea_20250114_211839.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn’t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from lists.fedoraproject.org_ad82ac63_20250114_211838.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY.mbox.gz?message=TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

# [SECURITY] Fedora 34 Update: matrix-synapse-1.38.1-1.fc34

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

1 Aug
2021

1 Aug
'21

9:05 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-a627cfd31e
2021-08-02 01:02:57.308573
--------------------------------------------------------------------------------

Name : matrix-synapse
Product : Fedora 34
Version : 1.38.1
Release : 1.fc34
URL : <https://github.com/matrix-org/synapse>
Summary : A Matrix reference homeserver written in Python using Twisted
Description :
Matrix is an ambitious new ecosystem for open federated Instant Messaging and
VoIP. Synapse is a reference "homeserver" implementation of Matrix from the
core development team at matrix.org, written in Python/Twisted. It is intended
to showcase the concept of Matrix and let folks see the spec in the context of
a coded base and let you run your own homeserver and generally help bootstrap
the ecosystem.

--------------------------------------------------------------------------------
Update Information:

Update to v1.38.1 ---- New upstream release 1.38.0, incorporating a number of
important security fixes. Upstream changelog: <https://github.com/matrix->
org/synapse/blob/v1.38.0/CHANGES.md Upstream upgrade notes: <https://matrix->
org.github.io/synapse/develop/upgrade#upgrading-to-v1380
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Jul 23 2021 Kai A. Hiller V02460@gmail.com - 1.38.1-1
- Update to v1.38.1
\* Thu Jul 22 2021 Fedora Release Engineering releng@fedoraproject.org - 1.38.0-3
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_35_Mass_Rebuild>
\* Sun Jul 18 2021 Dan Callaghan djc@djc.id.au - 1.38.0-2
- fix startup ordering of synapse.service (RHBZ#1910740)
- relax version requirement for python3-cryptography
\* Wed Jul 14 2021 Kai A. Hiller V02460@gmail.com - 1.38.0-1
- Update to v1.38.0
\* Fri Jun 4 2021 Python Maint python-maint@redhat.com - 1.26.0-3
- Rebuilt for Python 3.10
\* Tue Mar 2 2021 Zbigniew J��drzejewski-Szmek zbyszek@in.waw.pl - 1.26.0-2
- Rebuilt for updated systemd-rpm-macros
See <https://pagure.io/fesco/issue/2583>.
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1910740 - synapse.service can fail if it starts before postgresql is ready
<https://bugzilla.redhat.com/show_bug.cgi?id=1910740>
[ 2 ] Bug #1918426 - matrix-synapse-1.38.0 is available
<https://bugzilla.redhat.com/show_bug.cgi?id=1918426>
[ 3 ] Bug #1934603 - CVE-2021-21274 matrix-synapse: DoS via .well-known lookups [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934603>
[ 4 ] Bug #1934606 - CVE-2021-21273 matrix-synapse: open redirects on some federation and push requests [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1934606>
[ 5 ] Bug #1944136 - CVE-2021-21332 matrix-synapse: password reset endpoint is vulnerable to XSS [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944136>
[ 6 ] Bug #1944139 - CVE-2021-21333 matrix-synapse: HTML injection in email and account expiry notifications [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1944139>
[ 7 ] Bug #1949110 - CVE-2021-21393 matrix-synapse: Denial of service (via resource exhaustion) due to improper input validation on groups/communities endpoints [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949110>
[ 8 ] Bug #1949112 - CVE-2021-21392 matrix-synapse: IP blacklist bypass via transitional IPv6 addresses on dual-stack networks [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1949112>
[ 9 ] Bug #1958801 - CVE-2021-21394 matrix-synapse: missing input validation may cause excessive use of disk space and memory [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1958801>
[ 10 ] Bug #1959542 - CVE-2021-29471 matrix-synapse: Denial-of-service when processing moderate length events [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=1959542>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-a627cfd31e' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY/#TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_0d0ef5a0_20250114_211837.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-w9fg-xffh-p362)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-w9fg-xffh-p362)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Denial of service (via resource exhaustion) due to improper input validation on third-party identifier endpoints

Low

[richvdh](/richvdh)
published
GHSA-w9fg-xffh-p362
Apr 12, 2021

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

> 0.17.0

## Patched versions

>= 1.28.0

## Description

### Impact

Missing input validation of some parameters on the endpoints used to confirm third-party identifiers could cause excessive use of disk space and memory leading to resource exhaustion.

### Patches

The issue is fixed by [#9321](https://github.com/matrix-org/synapse/pull/9321).

### Workarounds

Depending on the needs and configuration of the homeserver a few options are available:

1. Using email as third-party identifiers be disabled by not configuring the `email` setting.
2. Using phone numbers as third-party identifiers can be disabled by ensuring that `account_threepid_delegates.msisdn` is not configured.
3. Additionally, the affected endpoint patterns can be blocked at a reverse proxy:

   * `^/_matrix/client/(r0|unstable)/register/email`
   * `^/_matrix/client/(r0|unstable)/register/msisdn`
   * `^/_matrix/client/(r0|unstable)/account/password`
   * `^/_matrix/client/(r0|unstable)/account/3pid`

### Severity

Low

### CVE ID

CVE-2021-21394

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e8811504_20250114_211835.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9393)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9393)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Add type hints to groups code #9393

 Merged

[clokep](/clokep)
merged 11 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/group-types](/matrix-org/synapse/tree/clokep/group-types "matrix-org/synapse:clokep/group-types")

Feb 17, 2021

 Merged

# [Add type hints to groups code](#top) #9393

[clokep](/clokep)
merged 11 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/group-types](/matrix-org/synapse/tree/clokep/group-types "matrix-org/synapse:clokep/group-types")

Feb 17, 2021

[Conversation
14](/matrix-org/synapse/pull/9393)
[Commits
11](/matrix-org/synapse/pull/9393/commits)
[Checks
0](/matrix-org/synapse/pull/9393/checks)
[Files changed](/matrix-org/synapse/pull/9393/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Feb 11, 2021](#issue-806594458)

This adds some type hints to the groups code, fixing some issues that mypy found and also adds some validation to bring it more inline with the way that rooms and users are handled.

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 5 commits
[February 11, 2021 12:22](#commits-pushed-2dcc7b8)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add type hints to groups server and attestations.](/matrix-org/synapse/pull/9393/commits/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e "Add type hints to groups server and attestations.")`

`[2dcc7b8](/matrix-org/synapse/pull/9393/commits/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add some validation while we're here.](/matrix-org/synapse/pull/9393/commits/ac781e870521c7ef0d4e6454b0162de8d69c36ae "Add some validation while we're here.")`

`[ac781e8](/matrix-org/synapse/pull/9393/commits/ac781e870521c7ef0d4e6454b0162de8d69c36ae)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Newsfragment](/matrix-org/synapse/pull/9393/commits/1bd20743d6be88cec7ea2c9283324461042eaab6 "Newsfragment")`

`[1bd2074](/matrix-org/synapse/pull/9393/commits/1bd20743d6be88cec7ea2c9283324461042eaab6)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Lint](/matrix-org/synapse/pull/9393/commits/00ed2b247ae5d553af374c93b5235f84272876c4 "Lint")`

`[00ed2b2](/matrix-org/synapse/pull/9393/commits/00ed2b247ae5d553af374c93b5235f84272876c4)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Handle some parameters being optional.](/matrix-org/synapse/pull/9393/commits/a82b77b50238bae2102db2eedbe22b6eb0255512 "Handle some parameters being optional.")`

`[a82b77b](/matrix-org/synapse/pull/9393/commits/a82b77b50238bae2102db2eedbe22b6eb0255512)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
[February 12, 2021 16:09](#event-4325544609)

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Feb 15, 2021](#pullrequestreview-590401526)

 [View reviewed changes](/matrix-org/synapse/pull/9393/files/a82b77b50238bae2102db2eedbe22b6eb0255512)

[![anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=60&v=4)](/anoadragon453)

**[anoadragon453](/anoadragon453)**
suggested changes
[Feb 15, 2021](#pullrequestreview-590402245)

 [View reviewed changes](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e)

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Few minor things, but on the whole looks great.

Sorry, something went wrong.

All reactions

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

Show resolved

Hide resolved

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

|  |  | @@ -322,6 +345,7 @@ async def get\_rooms\_in\_group(self, group\_id, requester\_user\_id): | |
| --- | --- | --- | --- |
|  |  | chunk = [] |
|  |  | for room\_result in room\_results: |
|  |  | room\_id = room\_result["room\_id"] |
|  |  | assert isinstance(room\_id, str) |

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Feb 15, 2021](#discussion_r576136796)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Is it possible to instead just add return type hints to `get_rooms_in_group` (and possibly move the `assert` to there since it's coming from a remote server)?

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Feb 16, 2021](#discussion_r577109038)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`get_rooms_in_group` already has return types, but it returns a dictionary that includes both `str` and `bool` values. I've updated it to use a `TypedDict`.

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Feb 16, 2021](#discussion_r577109312)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'd really rather we returned attrs classes here or something simpler than dictionaries which repeat the same key over and over. 😢

Sorry, something went wrong.

 👍
1
 anoadragon453 reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

|  |  | @@ -615,6 +672,7 @@ async def invite\_to\_group(self, group\_id, user\_id, requester\_user\_id, content): | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | if self.hs.is\_mine\_id(user\_id): |
|  |  | groups\_local = self.hs.get\_groups\_local\_handler() |
|  |  | assert isinstance(groups\_local, GroupsLocalHandler) |

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Feb 15, 2021](#discussion_r576138879)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Could we have a more helpful error message here in case someone does end up routing whatever endpoint uses this to a worker?

```
if isinstance(groups_local, GroupsLocalHandler):
    logger.error("Worker process attempted to invite a user to a group. This is only supported by the main process.")
    raise SynapseError(500, "Unable to invite user to group")
```

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Feb 16, 2021](#discussion_r577103462)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think having a 500 error from the assertion is fine, but I'll add a message to it.

Sorry, something went wrong.

All reactions

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Feb 17, 2021](#discussion_r577585576)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hmm, I'm not sure if "Misconfiguration of workers for groups." gives a sysadmin much to go on in terms of resolving the issue. Might still be nice to add a log line pointing out the issue? Or are we trying to keep things vague in case worker setup changes in the future?

Sorry, something went wrong.

All reactions

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

Show resolved

Hide resolved

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

Show resolved

Hide resolved

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

Show resolved

Hide resolved

[synapse/groups/groups\_server.py](/matrix-org/synapse/pull/9393/files/2dcc7b85d0c9533a0844b0a7b07b5fe4fc93400e#diff-769e47949983f7d261eb387b497b012e97a599f61112aa2b0ef9fc2086daf86c)
Outdated

Show resolved

Hide resolved

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&v=4)](/anoadragon453)

`[Clarify docstrings](/matrix-org/synapse/pull/9393/commits/9073c5ac5b5e778d99f52edd772f67b3d9170024 "Clarify docstrings

Co-authored-by: Andrew Morgan <1342360+anoadragon453@users.noreply.github.com>")`
 …

`[9073c5a](/matrix-org/synapse/pull/9393/commits/9073c5ac5b5e778d99f52edd772f67b3d9170024)`

```
Co-authored-by: Andrew Morgan <1342360+anoadragon453@users.noreply.github.com>
```

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from [anoadragon453](/anoadragon453)
[February 16, 2021 20:22](#event-4338104508)

 [clokep](/clokep)
added 3 commits
[February 16, 2021 16:50](#commits-pushed-135c8a3)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Return a 404.](/matrix-org/synapse/pull/9393/commits/135c8a3c590595f39fe4c9b11355a6d8d5bd3144 "Return a 404.")`

`[135c8a3](/matrix-org/synapse/pull/9393/commits/135c8a3c590595f39fe4c9b11355a6d8d5bd3144)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add messages to assertions.](/matrix-org/synapse/pull/9393/commits/85baed7130593715caacd103117251483094d80a "Add messages to assertions.")`

`[85baed7](/matrix-org/synapse/pull/9393/commits/85baed7130593715caacd103117251483094d80a)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Use a TypedDict.](/matrix-org/synapse/pull/9393/commits/eb1d4a178f01f402bd4b6502ef11378453cd8453 "Use a TypedDict.")`

`[eb1d4a1](/matrix-org/synapse/pull/9393/commits/eb1d4a178f01f402bd4b6502ef11378453cd8453)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Feb 16, 2021](#issuecomment-780140264)

| Ugh, my push failed. I just pushed now though so hopefully the new build will pass... |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Merge remote-tracking branch 'origin/develop' into clokep/group-types](/matrix-org/synapse/pull/9393/commits/4d477eb9b9b7ca5a95a60f35f3ee0ddd1aa02205 "Merge remote-tracking branch 'origin/develop' into clokep/group-types")`

`[4d477eb](/matrix-org/synapse/pull/9393/commits/4d477eb9b9b7ca5a95a60f35f3ee0ddd1aa02205)`

[![anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=60&v=4)](/anoadragon453)

**[anoadragon453](/anoadragon453)**
approved these changes
[Feb 17, 2021](#pullrequestreview-592160562)

 [View reviewed changes](/matrix-org/synapse/pull/9393/files/4d477eb9b9b7ca5a95a60f35f3ee0ddd1aa02205)

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Had a query about the main vs. worker logging in [#9393 (comment)](https://github.com/matrix-org/synapse/pull/9393#discussion_r577585576), but the rest lgtm!

Sorry, something went wrong.

All reactions

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Improve assertion messages.](/matrix-org/synapse/pull/9393/commits/aecc3cc5b17f9f297d00f341ab5ca234551ca840 "Improve assertion messages.")`

`[aecc3cc](/matrix-org/synapse/pull/9393/commits/aecc3cc5b17f9f297d00f341ab5ca234551ca840)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`d2f0ec1`](/matrix-org/synapse/commit/d2f0ec12d5c8f113095408888e87e191ac546499)
into
develop

[Feb 17, 2021](https://github.com/matrix-org/synapse/pull/9393#event-4341441649)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/group-types

branch
[February 17, 2021 13:41](#event-4341441701)

[clokep](/clokep)
added a commit
that referenced
this pull request
[Feb 19, 2021](#ref-commit-d9f1dcc)
[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

`[Merge tag 'v1.28.0rc1' into develop](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8 "Merge tag 'v1.28.0rc1' into develop

Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))")`
…

`[d9f1dcc](/matrix-org/synapse/commit/d9f1dccba9fd4c8853ffdde25bf1d9598bc53bc8)`

```
Synapse 1.28.0rc1 (2021-02-19)
==============================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\[#9150](https://github.com/matrix-org/synapse/pull/9150)]([#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\[#9300](https://github.com/matrix-org/synapse/pull/9300)]([#9300](https://github.com/matrix-org/synapse/pull/9300)), [\[#9301](https://github.com/matrix-org/synapse/pull/9301)]([#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\[#9311](https://github.com/matrix-org/synapse/pull/9311)]([#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\[#9376](https://github.com/matrix-org/synapse/pull/9376)]([#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\[#9400](https://github.com/matrix-org/synapse/pull/9400)]([#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\[#9257](https://github.com/matrix-org/synapse/pull/9257)]([#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\[#9296](https://github.com/matrix-org/synapse/pull/9296)]([#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\[#9321](https://github.com/matrix-org/synapse/pull/9321)]([#9321](https://github.com/matrix-org/synapse/pull/9321)), [\[#9393](https://github.com/matrix-org/synapse/pull/9393)]([#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\[#9333](https://github.com/matrix-org/synapse/pull/9333)]([#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\[#9361](https://github.com/matrix-org/synapse/pull/9361)]([#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\[#9391](https://github.com/matrix-org/synapse/pull/9391)]([#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\[#9395](https://github.com/matrix-org/synapse/pull/9395)]([#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\[#9421](https://github.com/matrix-org/synapse/pull/9421)]([#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\[#9425](https://github.com/matrix-org/synapse/pull/9425)]([#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\[#9426](https://github.com/matrix-org/synapse/pull/9426)]([#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\[#9428](https://github.com/matrix-org/synapse/pull/9428)]([#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\[#9433](https://github.com/matrix-org/synapse/pull/9433)]([#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\[#9281](https://github.com/matrix-org/synapse/pull/9281)]([#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\[#9291](https://github.com/matrix-org/synapse/pull/9291)]([#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\[#9308](https://github.com/matrix-org/synapse/pull/9308)]([#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\[#9317](https://github.com/matrix-org/synapse/pull/9317)]([#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\[#9322](https://github.com/matrix-org/synapse/pull/9322)]([#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\[#9390](https://github.com/matrix-org/synapse/pull/9390)]([#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\[#9404](https://github.com/matrix-org/synapse/pull/9404)]([#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\[#9407](https://github.com/matrix-org/synapse/pull/9407)]([#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\[#9434](https://github.com/matrix-org/synapse/pull/9434)]([#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\[#9429](https://github.com/matrix-org/synapse/pull/9429)]([#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\[#9003](https://github.com/matrix-org/synapse/pull/9003)]([#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\[#9123](https://github.com/matrix-org/synapse/pull/9123)]([#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\[#9240](https://github.com/matrix-org/synapse/pull/9240)]([#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\[#9299](https://github.com/matrix-org/synapse/pull/9299)]([#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\[#9305](https://github.com/matrix-org/synapse/pull/9305)]([#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\[#9307](https://github.com/matrix-org/synapse/pull/9307)]([#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\[#9326](https://github.com/matrix-org/synapse/pull/9326)]([#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\[#9362](https://github.com/matrix-org/synapse/pull/9362)]([#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\[#9377](https://github.com/matrix-org/synapse/pull/9377)]([#9377](https://github.com/matrix-org/synapse/pull/9377)), [\[#9396](https://github.com/matrix-org/synapse/pull/9396)]([#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\[#9381](https://github.com/matrix-org/synapse/pull/9381)]([#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\[#9384](https://github.com/matrix-org/synapse/pull/9384)]([#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\[#9394](https://github.com/matrix-org/synapse/pull/9394)]([#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\[#9408](https://github.com/matrix-org/synapse/pull/9408)]([#9408](https://github.com/matrix-org/synapse/pull/9408)))
```

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Mar 6, 2021](#ref-commit-31d3054)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.28.0](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2 "Update chat/matrix-synapse to 1.28.0

Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474](https://github.com/matrix-org/synapse/issues/9474))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150](https://github.com/matrix-org/synapse/issues/9150))
- Further improvements to the user experience of registration via single sign-on. ([\#9300](https://github.com/matrix-org/synapse/issues/9300), [\#9301](https://github.com/matrix-org/synapse/issues/9301))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311](https://github.com/matrix-org/synapse/issues/9311))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376](https://github.com/matrix-org/synapse/issues/9376))
- Add the shadow-banning status to the admin API for user info. ([\#9400](https://github.com/matrix-org/synapse/issues/9400))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257](https://github.com/matrix-org/synapse/issues/9257))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the \"session expired\" error page during SSO registration was badly formatted. ([\#9296](https://github.com/matrix-org/synapse/issues/9296))
- Assert a maximum length for some parameters for spec compliance. ([\#9321](https://github.com/matrix-org/synapse/issues/9321), [\#9393](https://github.com/matrix-org/synapse/issues/9393))
- Fix additional errors when previewing URLs: \"AttributeError 'NoneType' object has no attribute 'xpath'\" and \"ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.\". ([\#9333](https://github.com/matrix-org/synapse/issues/9333))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361](https://github.com/matrix-org/synapse/issues/9361))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391](https://github.com/matrix-org/synapse/issues/9391))
- Fix a long-standing bug when upgrading a room: \"TypeError: '>' not supported between instances of 'NoneType' and 'int'\". ([\#9395](https://github.com/matrix-org/synapse/issues/9395))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421](https://github.com/matrix-org/synapse/issues/9421))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425](https://github.com/matrix-org/synapse/issues/9425))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426](https://github.com/matrix-org/synapse/issues/9426))
- Fix a bug introduced in v1.27.0: \"TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType.\" related to the user directory. ([\#9428](https://github.com/matrix-org/synapse/issues/9428))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433](https://github.com/matrix-org/synapse/issues/9433))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281](https://github.com/matrix-org/synapse/issues/9281))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291](https://github.com/matrix-org/synapse/issues/9291))
- Correct name of Synapse's service file in TURN howto. ([\#9308](https://github.com/matrix-org/synapse/issues/9308))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317](https://github.com/matrix-org/synapse/issues/9317))
- Update installation instructions on Fedora. ([\#9322](https://github.com/matrix-org/synapse/issues/9322))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390](https://github.com/matrix-org/synapse/issues/9390))
- Update docs for using Gitea as OpenID provider. ([\#9404](https://github.com/matrix-org/synapse/issues/9404))
- Document that pusher instances are shardable. ([\#9407](https://github.com/matrix-org/synapse/issues/9407))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434](https://github.com/matrix-org/synapse/issues/9434))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429](https://github.com/matrix-org/synapse/issues/9429))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003](https://github.com/matrix-org/synapse/issues/9003))
- Add experimental support for running Synapse with PyPy. ([\#9123](https://github.com/matrix-org/synapse/issues/9123))
- Deny access to additional IP addresses by default. ([\#9240](https://github.com/matrix-org/synapse/issues/9240))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299](https://github.com/matrix-org/synapse/issues/9299))
- Add debug logging for SRV lookups. Contributed by @Bubu. ([\#9305](https://github.com/matrix-org/synapse/issues/9305))
- Improve logging for OIDC login flow. ([\#9307](https://github.com/matrix-org/synapse/issues/9307))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326](https://github.com/matrix-org/synapse/issues/9326))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362](https://github.com/matrix-org/synapse/issues/9362))
- Convert tests to use `HomeserverTestCase`. ([\#9377](https://github.com/matrix-org/synapse/issues/9377), [\#9396](https://github.com/matrix-org/synapse/issues/9396))
- Update the version of black used to 20.8b1. ([\#9381](https://github.com/matrix-org/synapse/issues/9381))
- Allow OIDC config to override discovered values. ([\#9384](https://github.com/matrix-org/synapse/issues/9384))
- Remove some dead code from the acceptance of room invites path. ([\#9394](https://github.com/matrix-org/synapse/issues/9394))
- Clean up an unused method in the presence handler code. ([\#9408](https://github.com/matrix-org/synapse/issues/9408))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405](https://github.com/matrix-org/synapse/issues/9405))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297](https://github.com/matrix-org/synapse/issues/9297))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302](https://github.com/matrix-org/synapse/issues/9302))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313](https://github.com/matrix-org/synapse/issues/9313))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310](https://github.com/matrix-org/synapse/issues/9310))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062](https://github.com/matrix-org/synapse/issues/9062))
- Add an admin API for retrieving the current room state of a room. ([\#9168](https://github.com/matrix-org/synapse/issues/9168))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858](https://github.com/matrix-org/matrix-doc/pull/2858)). ([\#9183](https://github.com/matrix-org/synapse/issues/9183), [\#9242](https://github.com/matrix-org/synapse/issues/9242))
- Add an admin API endpoint for shadow-banning users. ([\#9209](https://github.com/matrix-org/synapse/issues/9209))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238](https://github.com/matrix-org/synapse/issues/9238))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245](https://github.com/matrix-org/synapse/issues/9245))
- Add ratelimits to invites in rooms and to specific users. ([\#9258](https://github.com/matrix-org/synapse/issues/9258))
- Improve the user experience of setting up an account via single-sign on. ([\#9262](https://github.com/matrix-org/synapse/issues/9262), [\#9272](https://github.com/matrix-org/synapse/issues/9272), [\#9275](https://github.com/matrix-org/synapse/issues/9275), [\#9276](https://github.com/matrix-org/synapse/issues/9276), [\#9277](https://github.com/matrix-org/synapse/issues/9277), [\#9286](https://github.com/matrix-org/synapse/issues/9286), [\#9287](https://github.com/matrix-org/synapse/issues/9287))
- Add phone home stats for encrypted messages. ([\#9283](https://github.com/matrix-org/synapse/issues/9283))
- Update the redirect URI for OIDC authentication. ([\#9288](https://github.com/matrix-org/synapse/issues/9288))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121](https://github.com/matrix-org/synapse/issues/9121))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163](https://github.com/matrix-org/synapse/issues/9163))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164](https://github.com/matrix-org/synapse/issues/9164))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165](https://github.com/matrix-org/synapse/issues/9165))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218](https://github.com/matrix-org/synapse/issues/9218))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229](https://github.com/matrix-org/synapse/issues/9229))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235](https://github.com/matrix-org/synapse/issues/9235))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265](https://github.com/matrix-org/synapse/issues/9265))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271](https://github.com/matrix-org/synapse/issues/9271))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134](https://github.com/matrix-org/synapse/issues/9134))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135](https://github.com/matrix-org/synapse/issues/9135))
- Add notes on integrating with Facebook for SSO login. ([\#9244](https://github.com/matrix-org/synapse/issues/9244))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199](https://github.com/matrix-org/synapse/issues/9199))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289](https://github.com/matrix-org/synapse/issues/9289))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045](https://github.com/matrix-org/synapse/issues/9045))
- Various improvements to the federation client. ([\#9129](https://github.com/matrix-org/synapse/issues/9129))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176](https://github.com/matrix-org/synapse/issues/9176))
- Add a `long_description_type` to the package metadata. ([\#9180](https://github.com/matrix-org/synapse/issues/9180))
- Speed up batch insertion when using PostgreSQL. ([\#9181](https://github.com/matrix-org/synapse/issues/9181), [\#9188](https://github.com/matrix-org/synapse/issues/9188))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184](https://github.com/matrix-org/synapse/issues/9184))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190](https://github.com/matrix-org/synapse/issues/9190))
- Add some missing source directories to the automatic linting script. ([\#9191](https://github.com/matrix-org/synapse/issues/9191))
- Precompute joined hosts and store in Redis. ([\#9198](https://github.com/matrix-org/synapse/issues/9198), [\#9227](https://github.com/matrix-org/synapse/issues/9227))
- Clean-up template loading code. ([\#9200](https://github.com/matrix-org/synapse/issues/9200))
- Fix the Python 3.5 old dependencies build. ([\#9217](https://github.com/matrix-org/synapse/issues/9217))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222](https://github.com/matrix-org/synapse/issues/9222))
- Add type hints to handlers code. ([\#9223](https://github.com/matrix-org/synapse/issues/9223), [\#9232](https://github.com/matrix-org/synapse/issues/9232))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254](https://github.com/matrix-org/synapse/issues/9254))
- Minor performance improvement during TLS handshake. ([\#9255](https://github.com/matrix-org/synapse/issues/9255))
- Refactor the generation of summary text for email notifications. ([\#9260](https://github.com/matrix-org/synapse/issues/9260))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270](https://github.com/matrix-org/synapse/issues/9270))")`
…

`[31d3054](/NetBSD/pkgsrc/commit/31d305433550d669947a745038a6c65b62f7bea2)`

```
Synapse 1.28.0 (2021-02-25)
===========================

Note that this release drops support for ARMv7 in the official Docker images, due to repeated problems building for ARMv7 (and the associated maintenance burden this entails).

This release also fixes the documentation included in v1.27.0 around the callback URI for SAML2 identity providers. If your server is configured to use single sign-on via a SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Internal Changes
----------------

- Revert change in v1.28.0rc1 to remove the deprecated SAML endpoint. ([\#9474]([matrix-org/synapse#9474](https://github.com/matrix-org/synapse/pull/9474)))

Synapse 1.28.0rc1 (2021-02-19)
==============================

Removal warning
---------------

The v1 list accounts API is deprecated and will be removed in a future release.
This API was undocumented and misleading. It can be replaced by the
[v2 list accounts API](<https://github.com/matrix-org/synapse/blob/release-v1.28.0/docs/admin_api/user_admin_api.rst#list-accounts>),
which has been available since Synapse 1.7.0 (2019-12-13).

Please check if you're using any scripts which use the admin API and replace
`GET /_synapse/admin/v1/users/<user_id>` with `GET /_synapse/admin/v2/users`.

Features
--------

- New admin API to get the context of an event: `/_synapse/admin/rooms/{roomId}/context/{eventId}`. ([\#9150]([matrix-org/synapse#9150](https://github.com/matrix-org/synapse/pull/9150)))
- Further improvements to the user experience of registration via single sign-on. ([\#9300]([matrix-org/synapse#9300](https://github.com/matrix-org/synapse/pull/9300)), [\#9301]([matrix-org/synapse#9301](https://github.com/matrix-org/synapse/pull/9301)))
- Add hook to spam checker modules that allow checking file uploads and remote downloads. ([\#9311]([matrix-org/synapse#9311](https://github.com/matrix-org/synapse/pull/9311)))
- Add support for receiving OpenID Connect authentication responses via form `POST`s rather than `GET`s. ([\#9376]([matrix-org/synapse#9376](https://github.com/matrix-org/synapse/pull/9376)))
- Add the shadow-banning status to the admin API for user info. ([\#9400]([matrix-org/synapse#9400](https://github.com/matrix-org/synapse/pull/9400)))

Bugfixes
--------

- Fix long-standing bug where sending email notifications would fail for rooms that the server had since left. ([\#9257]([matrix-org/synapse#9257](https://github.com/matrix-org/synapse/pull/9257)))
- Fix bug introduced in Synapse 1.27.0rc1 which meant the "session expired" error page during SSO registration was badly formatted. ([\#9296]([matrix-org/synapse#9296](https://github.com/matrix-org/synapse/pull/9296)))
- Assert a maximum length for some parameters for spec compliance. ([\#9321]([matrix-org/synapse#9321](https://github.com/matrix-org/synapse/pull/9321)), [\#9393]([matrix-org/synapse#9393](https://github.com/matrix-org/synapse/pull/9393)))
- Fix additional errors when previewing URLs: "AttributeError 'NoneType' object has no attribute 'xpath'" and "ValueError: Unicode strings with encoding declaration are not supported. Please use bytes input or XML fragments without declaration.". ([\#9333]([matrix-org/synapse#9333](https://github.com/matrix-org/synapse/pull/9333)))
- Fix a bug causing Synapse to impose the wrong type constraints on fields when processing responses from appservices to `/_matrix/app/v1/thirdparty/user/{protocol}`. ([\#9361]([matrix-org/synapse#9361](https://github.com/matrix-org/synapse/pull/9361)))
- Fix bug where Synapse would occasionally stop reconnecting to Redis after the connection was lost. ([\#9391]([matrix-org/synapse#9391](https://github.com/matrix-org/synapse/pull/9391)))
- Fix a long-standing bug when upgrading a room: "TypeError: '>' not supported between instances of 'NoneType' and 'int'". ([\#9395]([matrix-org/synapse#9395](https://github.com/matrix-org/synapse/pull/9395)))
- Reduce the amount of memory used when generating the URL preview of a file that is larger than the `max_spider_size`. ([\#9421]([matrix-org/synapse#9421](https://github.com/matrix-org/synapse/pull/9421)))
- Fix a long-standing bug in the deduplication of old presence, resulting in no deduplication. ([\#9425]([matrix-org/synapse#9425](https://github.com/matrix-org/synapse/pull/9425)))
- The `ui_auth.session_timeout` config option can now be specified in terms of number of seconds/minutes/etc/. Contributed by Rishabh Arya. ([\#9426]([matrix-org/synapse#9426](https://github.com/matrix-org/synapse/pull/9426)))
- Fix a bug introduced in v1.27.0: "TypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType." related to the user directory. ([\#9428]([matrix-org/synapse#9428](https://github.com/matrix-org/synapse/pull/9428)))

Updates to the Docker image
---------------------------

- Drop support for ARMv7 in Docker images. ([\#9433]([matrix-org/synapse#9433](https://github.com/matrix-org/synapse/pull/9433)))

Improved Documentation
----------------------

- Reorganize CHANGELOG.md. ([\#9281]([matrix-org/synapse#9281](https://github.com/matrix-org/synapse/pull/9281)))
- Add note to `auto_join_rooms` config option explaining existing rooms must be publicly joinable. ([\#9291]([matrix-org/synapse#9291](https://github.com/matrix-org/synapse/pull/9291)))
- Correct name of Synapse's service file in TURN howto. ([\#9308]([matrix-org/synapse#9308](https://github.com/matrix-org/synapse/pull/9308)))
- Fix the braces in the `oidc_providers` section of the sample config. ([\#9317]([matrix-org/synapse#9317](https://github.com/matrix-org/synapse/pull/9317)))
- Update installation instructions on Fedora. ([\#9322]([matrix-org/synapse#9322](https://github.com/matrix-org/synapse/pull/9322)))
- Add HTTP/2 support to the nginx example configuration. Contributed by David Vo. ([\#9390]([matrix-org/synapse#9390](https://github.com/matrix-org/synapse/pull/9390)))
- Update docs for using Gitea as OpenID provider. ([\#9404]([matrix-org/synapse#9404](https://github.com/matrix-org/synapse/pull/9404)))
- Document that pusher instances are shardable. ([\#9407]([matrix-org/synapse#9407](https://github.com/matrix-org/synapse/pull/9407)))
- Fix erroneous documentation from v1.27.0 about updating the SAML2 callback URL. ([\#9434]([matrix-org/synapse#9434](https://github.com/matrix-org/synapse/pull/9434)))

Deprecations and Removals
-------------------------

- Deprecate old admin API `GET /_synapse/admin/v1/users/<user_id>`. ([\#9429]([matrix-org/synapse#9429](https://github.com/matrix-org/synapse/pull/9429)))

Internal Changes
----------------

- Fix 'object name reserved for internal use' errors with recent versions of SQLite. ([\#9003]([matrix-org/synapse#9003](https://github.com/matrix-org/synapse/pull/9003)))
- Add experimental support for running Synapse with PyPy. ([\#9123]([matrix-org/synapse#9123](https://github.com/matrix-org/synapse/pull/9123)))
- Deny access to additional IP addresses by default. ([\#9240]([matrix-org/synapse#9240](https://github.com/matrix-org/synapse/pull/9240)))
- Update the `Cursor` type hints to better match PEP 249. ([\#9299]([matrix-org/synapse#9299](https://github.com/matrix-org/synapse/pull/9299)))
- Add debug logging for SRV lookups. Contributed by [@Bubu](https://github.com/Bubu). ([\#9305]([matrix-org/synapse#9305](https://github.com/matrix-org/synapse/pull/9305)))
- Improve logging for OIDC login flow. ([\#9307]([matrix-org/synapse#9307](https://github.com/matrix-org/synapse/pull/9307)))
- Share the code for handling required attributes between the CAS and SAML handlers. ([\#9326]([matrix-org/synapse#9326](https://github.com/matrix-org/synapse/pull/9326)))
- Clean up the code to load the metadata for OpenID Connect identity providers. ([\#9362]([matrix-org/synapse#9362](https://github.com/matrix-org/synapse/pull/9362)))
- Convert tests to use `HomeserverTestCase`. ([\#9377]([matrix-org/synapse#9377](https://github.com/matrix-org/synapse/pull/9377)), [\#9396]([matrix-org/synapse#9396](https://github.com/matrix-org/synapse/pull/9396)))
- Update the version of black used to 20.8b1. ([\#9381]([matrix-org/synapse#9381](https://github.com/matrix-org/synapse/pull/9381)))
- Allow OIDC config to override discovered values. ([\#9384]([matrix-org/synapse#9384](https://github.com/matrix-org/synapse/pull/9384)))
- Remove some dead code from the acceptance of room invites path. ([\#9394]([matrix-org/synapse#9394](https://github.com/matrix-org/synapse/pull/9394)))
- Clean up an unused method in the presence handler code. ([\#9408]([matrix-org/synapse#9408](https://github.com/matrix-org/synapse/pull/9408)))

Synapse 1.27.0 (2021-02-16)
===========================

Note that this release includes a change in Synapse to use Redis as a cache ─ as well as a pub/sub mechanism ─ if Redis support is enabled for workers. No action is needed by server administrators, and we do not expect resource usage of the Redis instance to change dramatically.

This release also changes the callback URI for OpenID Connect (OIDC) and SAML2 identity providers. If your server is configured to use single sign-on via an OIDC/OAuth2 or SAML2 IdP, you may need to make configuration changes. Please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

This release also changes escaping of variables in the HTML templates for SSO or email notifications. If you have customised these templates, please review [UPGRADE.rst](UPGRADE.rst) for more details on these changes.

Bugfixes
--------

- Fix building Docker images for armv7. ([\#9405]([matrix-org/synapse#9405](https://github.com/matrix-org/synapse/pull/9405)))

Synapse 1.27.0rc2 (2021-02-11)
==============================

Features
--------

- Further improvements to the user experience of registration via single sign-on. ([\#9297]([matrix-org/synapse#9297](https://github.com/matrix-org/synapse/pull/9297)))

Bugfixes
--------

- Fix ratelimiting introduced in v1.27.0rc1 for invites to respect the `ratelimit` flag on application services. ([\#9302]([matrix-org/synapse#9302](https://github.com/matrix-org/synapse/pull/9302)))
- Do not automatically calculate `public_baseurl` since it can be wrong in some situations. Reverts behaviour introduced in v1.26.0. ([\#9313]([matrix-org/synapse#9313](https://github.com/matrix-org/synapse/pull/9313)))

Improved Documentation
----------------------

- Clarify the sample configuration for changes made to the template loading code. ([\#9310]([matrix-org/synapse#9310](https://github.com/matrix-org/synapse/pull/9310)))

Synapse 1.27.0rc1 (2021-02-02)
==============================

Features
--------

- Add an admin API for getting and deleting forward extremities for a room. ([\#9062]([matrix-org/synapse#9062](https://github.com/matrix-org/synapse/pull/9062)))
- Add an admin API for retrieving the current room state of a room. ([\#9168]([matrix-org/synapse#9168](https://github.com/matrix-org/synapse/pull/9168)))
- Add experimental support for allowing clients to pick an SSO Identity Provider ([MSC2858]([matrix-org/matrix-spec-proposals#2858](https://github.com/matrix-org/matrix-spec-proposals/pull/2858))). ([\#9183]([matrix-org/synapse#9183](https://github.com/matrix-org/synapse/pull/9183)), [\#9242]([matrix-org/synapse#9242](https://github.com/matrix-org/synapse/pull/9242)))
- Add an admin API endpoint for shadow-banning users. ([\#9209]([matrix-org/synapse#9209](https://github.com/matrix-org/synapse/pull/9209)))
- Add ratelimits to the 3PID `/requestToken` APIs. ([\#9238]([matrix-org/synapse#9238](https://github.com/matrix-org/synapse/pull/9238)))
- Add support to the OpenID Connect integration for adding the user's email address. ([\#9245]([matrix-org/synapse#9245](https://github.com/matrix-org/synapse/pull/9245)))
- Add ratelimits to invites in rooms and to specific users. ([\#9258]([matrix-org/synapse#9258](https://github.com/matrix-org/synapse/pull/9258)))
- Improve the user experience of setting up an account via single-sign on. ([\#9262]([matrix-org/synapse#9262](https://github.com/matrix-org/synapse/pull/9262)), [\#9272]([matrix-org/synapse#9272](https://github.com/matrix-org/synapse/pull/9272)), [\#9275]([matrix-org/synapse#9275](https://github.com/matrix-org/synapse/pull/9275)), [\#9276]([matrix-org/synapse#9276](https://github.com/matrix-org/synapse/pull/9276)), [\#9277]([matrix-org/synapse#9277](https://github.com/matrix-org/synapse/pull/9277)), [\#9286]([matrix-org/synapse#9286](https://github.com/matrix-org/synapse/pull/9286)), [\#9287]([matrix-org/synapse#9287](https://github.com/matrix-org/synapse/pull/9287)))
- Add phone home stats for encrypted messages. ([\#9283]([matrix-org/synapse#9283](https://github.com/matrix-org/synapse/pull/9283)))
- Update the redirect URI for OIDC authentication. ([\#9288]([matrix-org/synapse#9288](https://github.com/matrix-org/synapse/pull/9288)))

Bugfixes
--------

- Fix spurious errors in logs when deleting a non-existant pusher. ([\#9121]([matrix-org/synapse#9121](https://github.com/matrix-org/synapse/pull/9121)))
- Fix a long-standing bug where Synapse would return a 500 error when a thumbnail did not exist (and auto-generation of thumbnails was not enabled). ([\#9163]([matrix-org/synapse#9163](https://github.com/matrix-org/synapse/pull/9163)))
- Fix a long-standing bug where an internal server error was raised when attempting to preview an HTML document in an unknown character encoding. ([\#9164]([matrix-org/synapse#9164](https://github.com/matrix-org/synapse/pull/9164)))
- Fix a long-standing bug where invalid data could cause errors when calculating the presentable room name for push. ([\#9165]([matrix-org/synapse#9165](https://github.com/matrix-org/synapse/pull/9165)))
- Fix bug where we sometimes didn't detect that Redis connections had died, causing workers to not see new data. ([\#9218]([matrix-org/synapse#9218](https://github.com/matrix-org/synapse/pull/9218)))
- Fix a bug where `None` was passed to Synapse modules instead of an empty dictionary if an empty module `config` block was provided in the homeserver config. ([\#9229]([matrix-org/synapse#9229](https://github.com/matrix-org/synapse/pull/9229)))
- Fix a bug in the `make_room_admin` admin API where it failed if the admin with the greatest power level was not in the room. Contributed by Pankaj Yadav. ([\#9235]([matrix-org/synapse#9235](https://github.com/matrix-org/synapse/pull/9235)))
- Prevent password hashes from getting dropped if a client failed threepid validation during a User Interactive Auth stage. Removes a workaround for an ancient bug in Riot Web <v0.7.4. ([\#9265]([matrix-org/synapse#9265](https://github.com/matrix-org/synapse/pull/9265)))
- Fix single-sign-on when the endpoints are routed to synapse workers. ([\#9271]([matrix-org/synapse#9271](https://github.com/matrix-org/synapse/pull/9271)))

Improved Documentation
----------------------

- Add docs for using Gitea as OpenID provider. ([\#9134]([matrix-org/synapse#9134](https://github.com/matrix-org/synapse/pull/9134)))
- Add link to Matrix VoIP tester for turn-howto. ([\#9135]([matrix-org/synapse#9135](https://github.com/matrix-org/synapse/pull/9135)))
- Add notes on integrating with Facebook for SSO login. ([\#9244]([matrix-org/synapse#9244](https://github.com/matrix-org/synapse/pull/9244)))

Deprecations and Removals
-------------------------

- The `service_url` parameter in `cas_config` is deprecated in favor of `public_baseurl`. ([\#9199]([matrix-org/synapse#9199](https://github.com/matrix-org/synapse/pull/9199)))
- Add new endpoint `/_synapse/client/saml2` for SAML2 authentication callbacks, and deprecate the old endpoint `/_matrix/saml2`. ([\#9289]([matrix-org/synapse#9289](https://github.com/matrix-org/synapse/pull/9289)))

Internal Changes
----------------

- Add tests to `test_user.UsersListTestCase` for List Users Admin API. ([\#9045]([matrix-org/synapse#9045](https://github.com/matrix-org/synapse/pull/9045)))
- Various improvements to the federation client. ([\#9129]([matrix-org/synapse#9129](https://github.com/matrix-org/synapse/pull/9129)))
- Speed up chain cover calculation when persisting a batch of state events at once. ([\#9176]([matrix-org/synapse#9176](https://github.com/matrix-org/synapse/pull/9176)))
- Add a `long_description_type` to the package metadata. ([\#9180]([matrix-org/synapse#9180](https://github.com/matrix-org/synapse/pull/9180)))
- Speed up batch insertion when using PostgreSQL. ([\#9181]([matrix-org/synapse#9181](https://github.com/matrix-org/synapse/pull/9181)), [\#9188]([matrix-org/synapse#9188](https://github.com/matrix-org/synapse/pull/9188)))
- Emit an error at startup if different Identity Providers are configured with the same `idp_id`. ([\#9184]([matrix-org/synapse#9184](https://github.com/matrix-org/synapse/pull/9184)))
- Improve performance of concurrent use of `StreamIDGenerators`. ([\#9190]([matrix-org/synapse#9190](https://github.com/matrix-org/synapse/pull/9190)))
- Add some missing source directories to the automatic linting script. ([\#9191]([matrix-org/synapse#9191](https://github.com/matrix-org/synapse/pull/9191)))
- Precompute joined hosts and store in Redis. ([\#9198]([matrix-org/synapse#9198](https://github.com/matrix-org/synapse/pull/9198)), [\#9227]([matrix-org/synapse#9227](https://github.com/matrix-org/synapse/pull/9227)))
- Clean-up template loading code. ([\#9200]([matrix-org/synapse#9200](https://github.com/matrix-org/synapse/pull/9200)))
- Fix the Python 3.5 old dependencies build. ([\#9217]([matrix-org/synapse#9217](https://github.com/matrix-org/synapse/pull/9217)))
- Update `isort` to v5.7.0 to bypass a bug where it would disagree with `black` about formatting. ([\#9222]([matrix-org/synapse#9222](https://github.com/matrix-org/synapse/pull/9222)))
- Add type hints to handlers code. ([\#9223]([matrix-org/synapse#9223](https://github.com/matrix-org/synapse/pull/9223)), [\#9232]([matrix-org/synapse#9232](https://github.com/matrix-org/synapse/pull/9232)))
- Fix Debian package building on Ubuntu 16.04 LTS (Xenial). ([\#9254]([matrix-org/synapse#9254](https://github.com/matrix-org/synapse/pull/9254)))
- Minor performance improvement during TLS handshake. ([\#9255]([matrix-org/synapse#9255](https://github.com/matrix-org/synapse/pull/9255)))
- Refactor the generation of summary text for email notifications. ([\#9260]([matrix-org/synapse#9260](https://github.com/matrix-org/synapse/pull/9260)))
- Restore PyPy compatibility by not calling CPython-specific GC methods when under PyPy. ([\#9270]([matrix-org/synapse#9270](https://github.com/matrix-org/synapse/pull/9270)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F9393).

Reviewers

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [erikjohnston](/erikjohnston)

erikjohnston approved these changes

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&v=4)](/anoadragon453) [anoadragon453](/anoadragon453)

anoadragon453 approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=52&v=4)](/anoadragon453) [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


