```
{
  "CVE-2021-21704": {
    "Description": "The vulnerability lies in the `firebird_fetch_blob` function within the PDO Firebird extension of PHP. Specifically, when fetching BLOB data from a Firebird database, a missing check for integer overflow during memory allocation can lead to a crash. A malicious Firebird server or a man-in-the-middle attacker could send a crafted response with a large BLOB length value, causing `erealloc` to be called with a value that exceeds `ZEND_ULONG_MAX`, resulting in a crash due to memory allocation failure. Additionally,  the `firebird_stmt_execute` function in `ext/pdo_firebird/firebird_statement.c` is also vulnerable. The `result_size` variable is not checked against the size of the buffer, and the `len` variable which is passed to `isc_vax_integer()` is not validated. This can lead to a crash or infinite loop. Also the  `firebird_handle_doer` function in `ext/pdo_firebird/firebird_driver.c` is vulnerable, as the `result_size` can be greater than the buffer, and the `len` variable passed to `isc_vax_integer()` can be invalid. This can also lead to a crash. Furthermore the `firebird_info_cb` callback is vulnerable to a stack buffer overflow. The callback concatenates strings without proper length checks, leading to a buffer overflow on the stack. A crafted server response containing a large version string could trigger this vulnerability. The issue stems from using `strcat` without verifying buffer sizes. A malicious Firebird server or a man-in-the-middle attacker can trigger a crash by sending crafted responses.",
    "Root cause": "Integer overflow during memory allocation in `firebird_fetch_blob`, missing checks in `firebird_stmt_execute` and `firebird_handle_doer`, and lack of length validation during string concatenation in `firebird_info_cb`.",
    "Weaknesses": [
      "Integer overflow",
      "Missing input validation",
      "Stack buffer overflow",
       "Use of insecure functions like `strcat`"
    ],
    "Impact": "Denial of Service (DoS) due to crashes. For `firebird_info_cb`, also possible code execution through buffer overflow, though less likely.",
    "Attack vectors": [
      "Malicious Firebird server",
      "Man-in-the-middle attacker"
    ],
    "Required attacker capabilities/position": "Ability to intercept or manipulate communication with the PHP application's Firebird server."
  }
}
```