=== Content from github.com_b2e0bfad_20250114_194310.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fmaster%2FCHANGELOG.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fmaster%2FCHANGELOG.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=carrierwaveuploader%2Fcarrierwave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[carrierwaveuploader](/carrierwaveuploader)
/
**[carrierwave](/carrierwaveuploader/carrierwave)**
Public

* [Notifications](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)
* [Star
   8.8k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)

* [Code](/carrierwaveuploader/carrierwave)
* [Issues
  33](/carrierwaveuploader/carrierwave/issues)
* [Pull requests
  5](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects
  0](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

Additional navigation options

* [Code](/carrierwaveuploader/carrierwave)
* [Issues](/carrierwaveuploader/carrierwave/issues)
* [Pull requests](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

## Files

 master
## Breadcrumbs

1. [carrierwave](/carrierwaveuploader/carrierwave/tree/master)
/
# CHANGELOG.md

Copy path Blame  Blame
## Latest commit

## History

[History](/carrierwaveuploader/carrierwave/commits/master/CHANGELOG.md)172 lines (132 loc) · 21.2 KB master
## Breadcrumbs

1. [carrierwave](/carrierwaveuploader/carrierwave/tree/master)
/
# CHANGELOG.md

Top
## File metadata and controls

* Preview
* Code
* Blame

172 lines (132 loc) · 21.2 KB[Raw](https://github.com/carrierwaveuploader/carrierwave/raw/refs/heads/master/CHANGELOG.md)
# Carrierwave History/Changelog

All notable changes to this project will be documented in this file.
This project adheres to [Semantic Versioning](http://semver.org/).

## [Unreleased]

## 3.1.1 - 2025-01-12

### Fixed

* Stop calling #mb\_chars, as it is no longer necessary (@chaadow [#2773](https://github.com/carrierwaveuploader/carrierwave/pull/2773))
* Fix to raise error when imagemagick is missing on Alpine >= 3.19 (@danwilliams-fl [#2772](https://github.com/carrierwaveuploader/carrierwave/pull/2772))
* Fix #dup with custom serialisation (@nassim-platogo [#2771](https://github.com/carrierwaveuploader/carrierwave/pull/2771))
* Fix SanitizedFile#read to behave in the same way with IO#read with arguments (@mshibuya [9eace1c](https://github.com/carrierwaveuploader/carrierwave/commit/9eace1c7625808565baeb72a52ec293589b62dfe), [#2770](https://github.com/carrierwaveuploader/carrierwave/issues/2770))

## 3.1.0 - 2024-12-14

*No changes.*

## 3.1.0.rc - 2024-12-07

### Added

* Support for AWS S3 FIPS endpoints (@matt-domsch-sp [#2763](https://github.com/carrierwaveuploader/carrierwave/pull/2763), [04bfab3](https://github.com/carrierwaveuploader/carrierwave/commit/04bfab3f00b8290965e72fd944a8beb0477c5e8e), [#2762](https://github.com/carrierwaveuploader/carrierwave/issues/2762))
* Add CarrierWave::Storage::Fog::File#empty? (@mshibuya [2d1af56](https://github.com/carrierwaveuploader/carrierwave/commit/2d1af56cd798da65b16b2285f67ef049f0af8c35), [#1926](https://github.com/carrierwaveuploader/carrierwave/issues/1926))

### Changed

* Show warning when conditionals are used with :convert (@mshibuya [fb287f3](https://github.com/carrierwaveuploader/carrierwave/commit/fb287f326eb6d4e759f56ec1f008c957466b0331), [#2723](https://github.com/carrierwaveuploader/carrierwave/issues/2723))
* Rename #version\_exists? to #version\_active?, to reduce confusion (@mshibuya [21ca90a](https://github.com/carrierwaveuploader/carrierwave/commit/21ca90a1b0ecfd5a10b82af43c03bee6bedf2801), [#1926](https://github.com/carrierwaveuploader/carrierwave/issues/1926))

### Fixed

* Fix incompatibility with MiniMagick >= 5.0 (@mshibuya [a60d8d8](https://github.com/carrierwaveuploader/carrierwave/commit/a60d8d8a33bc2aa6b0ff09c745def6b8e1a892e9), [#2761](https://github.com/carrierwaveuploader/carrierwave/issues/2761))
* Fix incompatibility with uri gem >= 1.0 (@ollym [#2760](https://github.com/carrierwaveuploader/carrierwave/pull/2760), [#2759](https://github.com/carrierwaveuploader/carrierwave/issues/2759))
* Clear download errors on reassigning remote urls (@mshibuya [bb8c6e1](https://github.com/carrierwaveuploader/carrierwave/commit/bb8c6e1f9eccae8650c70ab46ca487ec878cda0b), [#2725](https://github.com/carrierwaveuploader/carrierwave/issues/2725))

## 3.1.0.beta - 2024-09-01

### Added

* Add support for the `crop` processing method (@clickworkorange [#2721](https://github.com/carrierwaveuploader/carrierwave/pull/2721))
* Add global `skip_ssrf_protection` configuration (@rajyan [#2696](https://github.com/carrierwaveuploader/carrierwave/pull/2696), [#2695](https://github.com/carrierwaveuploader/carrierwave/issues/2695))

### Changed

* Show warning if #filename is safeguarded as in the pre-3.x style (@mshibuya [#2718](https://github.com/carrierwaveuploader/carrierwave/pull/2718), [#2708](https://github.com/carrierwaveuploader/carrierwave/issues/2708))

### Fixed

* Fix version names starting with a non-alphabet character lead to NameError (@r7kamura [#2748](https://github.com/carrierwaveuploader/carrierwave/pull/2748), [#2722](https://github.com/carrierwaveuploader/carrierwave/issues/2722))
* Fix Rails 7.2 incompatibility due to incorrect use of ActiveSupport::Deprecation (@mshibuya [b25477d](https://github.com/carrierwaveuploader/carrierwave/commit/b25477d4dc2b32ee3da896714b081e6123737fa3), [8761240](https://github.com/carrierwaveuploader/carrierwave/commit/8761240283abc2e58bd97004f30a9419cad34109), [#2751](https://github.com/carrierwaveuploader/carrierwave/issues/2751))
* Fix assigning a file with the same name not marking the column as changed (@mshibuya [47f1737](https://github.com/carrierwaveuploader/carrierwave/commit/47f1737443f47cd188e555836b26ccdfcee91d49), [#2719](https://github.com/carrierwaveuploader/carrierwave/issues/2719))
* Fix content type magic detection for files packaged in .zip (@dzhikvas [#2705](https://github.com/carrierwaveuploader/carrierwave/pull/2705), [#2704](https://github.com/carrierwaveuploader/carrierwave/issues/2704))

## 3.0.7 - 2024-03-23

### Security

* Fix Content-Type allowlist bypass vulnerability remained (@mshibuya [00676e2](https://github.com/carrierwaveuploader/carrierwave/commit/00676e23d7f4beac12beddee6f2486b686fb7e46), [GHSA-vfmv-jfc5-pjjw](https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-vfmv-jfc5-pjjw))

## 3.0.6 - 2024-03-09

### Fixed

* Fix #derived\_versions and #active\_sibling\_versions returning an Array where Hash is expected (@mshibuya [46e4f20](https://github.com/carrierwaveuploader/carrierwave/commit/46e4f20f8f85f75043cec76aa1f331c55a3ba103))
* Fix incompatibility with Marcel 1.0.3 (@schinery [#2728](https://github.com/carrierwaveuploader/carrierwave/pull/2728), [#2729](https://github.com/carrierwaveuploader/carrierwave/issues/2729))
* Fix assigning a file with the same name not marking the column as changed (@mshibuya [4c65b39](https://github.com/carrierwaveuploader/carrierwave/commit/4c65b393cd85b66bc256d04363cf3e3a97c8fd64), [#2719](https://github.com/carrierwaveuploader/carrierwave/issues/2719))
* Fix failing to remove files with ActiveRecord 7.1 after\_commit order change enabled (@mshibuya [63113e9](https://github.com/carrierwaveuploader/carrierwave/commit/63113e96dc172114cb92af239ba73e50ed8a72f2), [#2713](https://github.com/carrierwaveuploader/carrierwave/issues/2713))

## 3.0.5 - 2023-11-29

### Fixed

* Remove unnecessary if clause within #filename left in the uploader template (@rajyan, [#2711](https://github.com/carrierwaveuploader/carrierwave/pull/2711))

### Security

* Fix Content-Type allowlist bypass vulnerability, possibly leading to XSS (@mshibuya, [863d425](https://github.com/carrierwaveuploader/carrierwave/commit/863d425c76eba12c3294227b39018f6b2dccbbf3), [GHSA-gxhx-g4fq-49hj](https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-gxhx-g4fq-49hj))

## 3.0.4 - 2023-10-08

### Fixed

* Fix model's dirty state remaining after update (@rajyan [#2707](https://github.com/carrierwaveuploader/carrierwave/pull/2707), [#2702](https://github.com/carrierwaveuploader/carrierwave/issues/2702))
* Fix #dup modifying the original object (@rajyan [#2690](https://github.com/carrierwaveuploader/carrierwave/pull/2690), [#2706](https://github.com/carrierwaveuploader/carrierwave/pull/2706), [#2689](https://github.com/carrierwaveuploader/carrierwave/issues/2689), [#2700](https://github.com/carrierwaveuploader/carrierwave/issues/2700))
* Fix #dup not respecting the :mount\_on option, causing MissingAttributeError (@marsz [#2691](https://github.com/carrierwaveuploader/carrierwave/pull/2691))

## 3.0.3 - 2023-08-21

### Fixed

* Fix #dup modifying the original object (@mshibuya [37f36f7](https://github.com/carrierwaveuploader/carrierwave/commit/37f36f7ccf035ffb19cbd3964928b3abf2d5e1b1), [#2687](https://github.com/carrierwaveuploader/carrierwave/issues/2687))
* Fix wrongly removing files on transaction rollback (@mshibuya, @rajyan [eb03fe1](https://github.com/carrierwaveuploader/carrierwave/commit/eb03fe124c3a7acf3ffc913c7d432208ba3aa7ca), [#2686](https://github.com/carrierwaveuploader/carrierwave/pull/2686), [#2685](https://github.com/carrierwaveuploader/carrierwave/issues/2685))

## 3.0.2 - 2023-08-01

### Fixed

* Fix deduplicated filename not being persisted (@mshibuya [#2679](https://github.com/carrierwaveuploader/carrierwave/pull/2679), [#2678](https://github.com/carrierwaveuploader/carrierwave/issues/2678), [#2677](https://github.com/carrierwaveuploader/carrierwave/pull/2677))

## 3.0.1 - 2023-07-22

### Fixed

* Fix not respecting the parent's #enable\_processing value after reading its own (@mshibuya [2df0f53](https://github.com/carrierwaveuploader/carrierwave/commit/2df0f53f1d5fa30a198aa148ef33f1ab924404e4), [#2676](https://github.com/carrierwaveuploader/carrierwave/issues/2676))
* Fix NoMethodError when a record is rolled back (@y-yagi [#2674](https://github.com/carrierwaveuploader/carrierwave/pull/2674), [#2675](https://github.com/carrierwaveuploader/carrierwave/issues/2675))
* Fix filename suffix being removed due to unnecessary deduplication (@mshibuya [d68a111](https://github.com/carrierwaveuploader/carrierwave/commit/d68a1111cfae4309d703caa19d9c19226bc01686), [#2672](https://github.com/carrierwaveuploader/carrierwave/issues/2672))
* Fix #dup causing unintended name deduplication of copied files (@mshibuya [b732acd](https://github.com/carrierwaveuploader/carrierwave/commit/b732acd63209897e6375a3706330df2c38e3f327), [#2670](https://github.com/carrierwaveuploader/carrierwave/issues/2670))
* Fix initialization failing when active\_support/core\_ext is not loaded yet (@mshibuya [875d972](https://github.com/carrierwaveuploader/carrierwave/commit/875d972dc78b8416de7768457793baa4d6220a4f))

## 3.0.0 - 2023-07-02

*No changes.*

## 3.0.0.rc - 2023-06-11

### Added

* Support adding suffix to filename on store when path collides with the existing ones (@mshibuya [07a5632](https://github.com/carrierwaveuploader/carrierwave/commit/07a5632a3f30ddcb21b10a75f003a7eaeaa072ad), [#1855](https://github.com/carrierwaveuploader/carrierwave/issues/1855))
* Add image dimension validation (@TsubasaYoshida [#2592](https://github.com/carrierwaveuploader/carrierwave/pull/2592), [3b1f8b4](https://github.com/carrierwaveuploader/carrierwave/commit/3b1f8b41f8c0896aa6ebe64bac23622c14a8b8d9))
* Provide validation error details via ActiveModel::Errors#details (@mshibuya [9013999](https://github.com/carrierwaveuploader/carrierwave/commit/90139995fc11978da909db71b1d43c0690c7c9d2), [#2150](https://github.com/carrierwaveuploader/carrierwave/issues/2150))
* Support clearing #remote\_urls by assigning nil (@mshibuya [8307f93](https://github.com/carrierwaveuploader/carrierwave/commit/8307f93c29b833d34efaae63c33d36e737d94715), [#2067](https://github.com/carrierwaveuploader/carrierwave/issues/2067))
* Support configuration of download retry wait time (@tricknotes [#2646](https://github.com/carrierwaveuploader/carrierwave/pull/2646))
* Support for ActiveRecord::Base#dup (@mshibuya, @BrianHawley [19b33b8](https://github.com/carrierwaveuploader/carrierwave/commit/19b33b876cd58e7af28dc718fd4f47bb539b78f9), [#2645](https://github.com/carrierwaveuploader/carrierwave/pull/2645), [#1962](https://github.com/carrierwaveuploader/carrierwave/issues/1962))
* Add CarrierWave::Storage::Fog::File#to\_file for interface consistency with SanitizedFile (@mshibuya [68ce83a](https://github.com/carrierwaveuploader/carrierwave/commit/68ce83a7b105d52c6af1b410727dd590c3960f7d), [#1960](https://github.com/carrierwaveuploader/carrierwave/issues/1960))
* Allow SanitizedFile to accept read with an optional length and output\_buffer arguments (@mshibuya [9096459](https://github.com/carrierwaveuploader/carrierwave/commit/90964596aa3d0b7acea584012f0f5888d622ea1b), [#1959](https://github.com/carrierwaveuploader/carrierwave/issues/1959))

### Changed

* Stop relying on ActiveModel::Dirty change tracking for removal of unnecessary files (@mshibuya [aac25c1](https://github.com/carrierwaveuploader/carrierwave/commit/aac25c10af4218d6e1e70f90154b847b54ce0334))
* Create versions lazily to reflect subclass configurations properly (@mshibuya [1531a67](https://github.com/carrierwaveuploader/carrierwave/commit/1531a67366f0e25e3d298133a72c81b6c9c0dc83), [#1957](https://github.com/carrierwaveuploader/carrierwave/issues/1957), [#2619](https://github.com/carrierwaveuploader/carrierwave/issues/2619))
* [BREAKING CHANGE] Use the resulting file extension on changing format by :convert (@mshibuya [#2659](https://github.com/carrierwaveuploader/carrierwave/pull/2659), [#2125](https://github.com/carrierwaveuploader/carrierwave/issues/2125), [#2126](https://github.com/carrierwaveuploader/carrierwave/issues/2126), [#2254](https://github.com/carrierwaveuploader/carrierwave/issues/2254))
* Prioritize Magic-detected content type for spoof-tolerance (@mshibuya [a2ca59c](https://github.com/carrierwaveuploader/carrierwave/commit/a2ca59cbe67046ba7818c64849a9a4ffa90306db), [#2570](https://github.com/carrierwaveuploader/carrierwave/issues/2570))
* Handle assignments in an ActiveModel::Dirty-friendly way (@mshibuya [#2658](https://github.com/carrierwaveuploader/carrierwave/pull/2658), [#2404](https://github.com/carrierwaveuploader/carrierwave/issues/2404), [#2409](https://github.com/carrierwaveuploader/carrierwave/issues/2409), [#2468](https://github.com/carrierwaveuploader/carrierwave/issues/2468))
* Give a stable name to classes created by the mount\_uploader block (@mshibuya [f5b09b8](https://github.com/carrierwaveuploader/carrierwave/commit/f5b09b844d99245a3b4d0ba01efd4972be4ee5be), [#2407](https://github.com/carrierwaveuploader/carrierwave/issues/2407), [#2471](https://github.com/carrierwaveuploader/carrierwave/issues/2471))
* Give a stable name to version classes (@mshibuya [a9de756](https://github.com/carrierwaveuploader/carrierwave/commit/a9de7565eabb4cdca05bb090cdf797eb1720c09c), [#2407](https://github.com/carrierwaveuploader/carrierwave/issues/2407), [#2471](https://github.com/carrierwaveuploader/carrierwave/issues/2471))

### Fixed

* Fix CarrierWave::Storage::Fog::File#read breaking when the file doesn't exist (@mshibuya [246eb01](https://github.com/carrierwaveuploader/carrierwave/commit/246eb012e15a75f7621bf9933f90a0f4742bd6e8), [#2524](https://github.com/carrierwaveuploader/carrierwave/issues/2524))
* Fix to preserve the original URI as much as possible on download (@mshibuya [2f3afaf](https://github.com/carrierwaveuploader/carrierwave/commit/2f3afafb738ae848a8a2d164780571cf9a7eb6ce), [#2631](https://github.com/carrierwaveuploader/carrierwave/issues/2631))
* Fix not to invoke content type detection on #copy\_to as it's costly (@mshibuya [6c6e2dc](https://github.com/carrierwaveuploader/carrierwave/commit/6c6e2dc9cf7747c0c1571d315473b246ef582e1f), [#2465](https://github.com/carrierwaveuploader/carrierwave/issues/2465))
* Fix calling #=~ on non-String breaking in Ruby 3.2 (@aubinlrx [#2653](https://github.com/carrierwaveuploader/carrierwave/pull/2653), [fd03ddd](https://github.com/carrierwaveuploader/carrierwave/commit/fd03dddef55025cab83936fc2957e3c8c58772ae))
* Fix #clean\_cache! to respect the uploader's root, not the global one (@sawasaki-narumi [#2652](https://github.com/carrierwaveuploader/carrierwave/pull/2652), [3cb9992](https://github.com/carrierwaveuploader/carrierwave/commit/3cb9992cc5fb8b113fe5b050651361f35d94adb4), [#2113](https://github.com/carrierwaveuploader/carrierwave/issues/2113))
* Fix to use helper method #fog\_provider instead of checking #fog\_credentials (@joshuamsager [#2660](https://github.com/carrierwaveuploader/carrierwave/pull/2660))
* Fix being unable to delete a file by assigning nil (@mshibuya [f8ea354](https://github.com/carrierwaveuploader/carrierwave/commit/f8ea35445e51c438b8cc8baf3e50079b5d423e34), [#2654](https://github.com/carrierwaveuploader/carrierwave/issues/2654), [#2613](https://github.com/carrierwaveuploader/carrierwave/pull/2613))
* Fix to raise exception when ImageMagick is not installed (@mshibuya [d90c399](https://github.com/carrierwaveuploader/carrierwave/commit/d90c399a6d2338203b1382f4ac4269863444d60d), [#2060](https://github.com/carrierwaveuploader/carrierwave/issues/2060))
* Fix to remove unnecessary floodfill in CarrierWave::RMagick#resize\_and\_pad (@mshibuya [f34a9bd](https://github.com/carrierwaveuploader/carrierwave/commit/f34a9bd26ed3e1006033a783c2ae8d86369993f6))
* Fix `#{column}_cache=` fails to be stored when set as a nested attribute (@mshibuya [e84d11e](https://github.com/carrierwaveuploader/carrierwave/commit/e84d11ec508d286ebab28195da815816abc62e41), [#2206](https://github.com/carrierwaveuploader/carrierwave/issues/2206))
* Fix to use AWS S3 regional endpoints when using virtual-hosted style (@mshibuya [8dace34](https://github.com/carrierwaveuploader/carrierwave/commit/8dace3456b5d1e0c3212ed1dc6c8b47dfd63b8ff), [#2523](https://github.com/carrierwaveuploader/carrierwave/issues/2523))
* Fix to respect condition on processing a derived version (@mshibuya [1fecddc](https://github.com/carrierwaveuploader/carrierwave/commit/1fecddc8ffe43426e9b5044dedfa7ac0b091cad8), [#2516](https://github.com/carrierwaveuploader/carrierwave/issues/2516))
* Fix #recreate\_versions! affecting the original file (@mshibuya [a67bfb6](https://github.com/carrierwaveuploader/carrierwave/commit/a67bfb696dcba14c7cdfa2c1b5481f04d3ef8dae), [5f00715](https://github.com/carrierwaveuploader/carrierwave/commit/5f00715747d44dd7f57ee990a6b471ed786ac764), [#2480](https://github.com/carrierwaveuploader/carrierwave/issues/2480), [#2655](https://github.com/carrierwaveuploader/carrierwave/issues/2655))
* Fix `remove_#{column}!` doesn't remove the file immediately (@mshibuya [b719fb3](https://github.com/carrierwaveuploader/carrierwave/commit/b719fb373c48f23e874dfa1a333a954c01967fc1), [#2540](https://github.com/carrierwaveuploader/carrierwave/issues/2540))
* Fix column value populated without a file when using filename override (@mshibuya [f1eff6e](https://github.com/carrierwaveuploader/carrierwave/commit/f1eff6e212fb0c374c9235968bfc4e7580bf1e2a), [#2284](https://github.com/carrierwaveuploader/carrierwave/issues/2284))
* Fix boolean configurations couldn't be set to false on a per-uploader basis (@megane42 [#2642](https://github.com/carrierwaveuploader/carrierwave/pull/2642))
* Fix #clean\_cache! breaking with directories that doesn't conform to CarrierWave's cache\_id format (@BrianHawley [#2641](https://github.com/carrierwaveuploader/carrierwave/pull/2641))

## 3.0.0.beta - 2022-11-19

### Added

* Add basename and fix extension value for fog file (@leductienttkt [#2587](https://github.com/carrierwaveuploader/carrierwave/pull/2587))
* Allow uploaders to accept unless conditions (@Vpatel1093 [#2588](https://github.com/carrierwaveuploader/carrierwave/pull/2588))
* Add retry option to download from remote url (@tashirosota [#2577](https://github.com/carrierwaveuploader/carrierwave/pull/2577))

### Deprecated

* #denylist was deprecated to prefer explicitly opting-in (@mshibuya [7a40ef7](https://github.com/carrierwaveuploader/carrierwave/commit/7a40ef7c4d5f3033f0f8401323f80bde14ca72b9), [#2536](https://github.com/carrierwaveuploader/carrierwave/issues/2536))

### Changed

* Completely migrate to allowlist/denylist terminology (@mshibuya [7a40ef7](https://github.com/carrierwaveuploader/carrierwave/commit/7a40ef7c4d5f3033f0f8401323f80bde14ca72b9), [#2536](https://github.com/carrierwaveuploader/carrierwave/issues/2536))
* Remove implementation-dependent information from an error message (@akihikodaki [#2499](https://github.com/carrierwaveuploader/carrierwave/pull/2499))
* Replace mini\_mime with marcel (@pjmartorell [#2552](https://github.com/carrierwaveuploader/carrierwave/pull/2552))
* [BREAKING CHANGE] Change to store files on after\_save hook instead of after\_commit, with performing cleanup when transaction is rolled back (@fsateler [#2546](https://github.com/carrierwaveuploader/carrierwave/pull/2546))

### Removed

* Drop support for Ruby < 2.5 and Rails 5.x (@mshibuya [229594f](https://github.com/carrierwaveuploader/carrierwave/commit/229594fb2ac7cfa59586162c0b3fc3d0b5bab978))
* Remove support for Merb (@seuros [#2566](https://github.com/carrierwaveuploader/carrierwave/pull/2566))

### Fixed

* Add Workaround for 'undefined method closed?' error caused by ssrf\_filter 1.1 (@mshibuya [65bf0d9](https://github.com/carrierwaveuploader/carrierwave/commit/65bf0d94759f7d522a36698d4b81e3635b8ca572), [#2628](https://github.com/carrierwaveuploader/carrierwave/issues/2628))
* Fix Ruby 2.7 keyword argument warning in uploader process (@nachiket87 [#2636](https://github.com/carrierwaveuploader/carrierwave/pull/2636), [#2635](https://github.com/carrierwaveuploader/carrierwave/issues/2635))
* Raise DownloadError when no content is returned (@BrianHawley [#2633](https://github.com/carrierwaveuploader/carrierwave/pull/2633), [#2632](https://github.com/carrierwaveuploader/carrierwave/issues/2632))
* Add workaround for the API change in ssrf\_filter 1.1 (@BrianHawley [#2629](https://github.com/carrierwaveuploader/carrierwave/pull/2629), [#2625](https://github.com/carrierwaveuploader/carrierwave/issues/2625))
* Fix Content-Type not being copied when using fog-google (@smnscp [#2614](https://github.com/carrierwaveuploader/carrierwave/pull/2614))
* Fix failing to save after limiting the columns with ActiveRecord's #select (@wonda-tea-coffee [#2613](https://github.com/carrierwaveuploader/carrierwave/pull/2613), [#2608](https://github.com/carrierwaveuploader/carrierwave/issues/2608))
* Fix content type detection for JSON files (@smnscp [#2618](https://github.com/carrierwaveuploader/carrierwave/pull/2618))
* Remove invalid byte sequences from the sanitized filename (@alexdunae [#2606](https://github.com/carrierwaveuploader/carrierwave/pull/2606))
* Fix issue with copying a fog file larger than 5GB (@slonopotamus [#2583](https://github.com/carrierwaveuploader/carrierwave/pull/2583))
* Stop closing StringIO-based file after CarrierWave::SanitizedFile#read (@aleksandrs-ledovskis [#2571](https://github.com/carrierwaveuploader/carrierwave/pull/2571))

Please check [2.x-stable](https://github.com/carrierwaveuploader/carrierwave/blob/2.x-stable/CHANGELOG.md) for previous changes.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d42f2191_20250114_194311.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fmaster%2FCHANGELOG.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fmaster%2FCHANGELOG.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=carrierwaveuploader%2Fcarrierwave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[carrierwaveuploader](/carrierwaveuploader)
/
**[carrierwave](/carrierwaveuploader/carrierwave)**
Public

* [Notifications](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)
* [Star
   8.8k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)

* [Code](/carrierwaveuploader/carrierwave)
* [Issues
  33](/carrierwaveuploader/carrierwave/issues)
* [Pull requests
  5](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects
  0](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

Additional navigation options

* [Code](/carrierwaveuploader/carrierwave)
* [Issues](/carrierwaveuploader/carrierwave/issues)
* [Pull requests](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

## Files

 master
## Breadcrumbs

1. [carrierwave](/carrierwaveuploader/carrierwave/tree/master)
/
# CHANGELOG.md

Copy path Blame  Blame
## Latest commit

## History

[History](/carrierwaveuploader/carrierwave/commits/master/CHANGELOG.md)172 lines (132 loc) · 21.2 KB master
## Breadcrumbs

1. [carrierwave](/carrierwaveuploader/carrierwave/tree/master)
/
# CHANGELOG.md

Top
## File metadata and controls

* Preview
* Code
* Blame

172 lines (132 loc) · 21.2 KB[Raw](https://github.com/carrierwaveuploader/carrierwave/raw/refs/heads/master/CHANGELOG.md)
# Carrierwave History/Changelog

All notable changes to this project will be documented in this file.
This project adheres to [Semantic Versioning](http://semver.org/).

## [Unreleased]

## 3.1.1 - 2025-01-12

### Fixed

* Stop calling #mb\_chars, as it is no longer necessary (@chaadow [#2773](https://github.com/carrierwaveuploader/carrierwave/pull/2773))
* Fix to raise error when imagemagick is missing on Alpine >= 3.19 (@danwilliams-fl [#2772](https://github.com/carrierwaveuploader/carrierwave/pull/2772))
* Fix #dup with custom serialisation (@nassim-platogo [#2771](https://github.com/carrierwaveuploader/carrierwave/pull/2771))
* Fix SanitizedFile#read to behave in the same way with IO#read with arguments (@mshibuya [9eace1c](https://github.com/carrierwaveuploader/carrierwave/commit/9eace1c7625808565baeb72a52ec293589b62dfe), [#2770](https://github.com/carrierwaveuploader/carrierwave/issues/2770))

## 3.1.0 - 2024-12-14

*No changes.*

## 3.1.0.rc - 2024-12-07

### Added

* Support for AWS S3 FIPS endpoints (@matt-domsch-sp [#2763](https://github.com/carrierwaveuploader/carrierwave/pull/2763), [04bfab3](https://github.com/carrierwaveuploader/carrierwave/commit/04bfab3f00b8290965e72fd944a8beb0477c5e8e), [#2762](https://github.com/carrierwaveuploader/carrierwave/issues/2762))
* Add CarrierWave::Storage::Fog::File#empty? (@mshibuya [2d1af56](https://github.com/carrierwaveuploader/carrierwave/commit/2d1af56cd798da65b16b2285f67ef049f0af8c35), [#1926](https://github.com/carrierwaveuploader/carrierwave/issues/1926))

### Changed

* Show warning when conditionals are used with :convert (@mshibuya [fb287f3](https://github.com/carrierwaveuploader/carrierwave/commit/fb287f326eb6d4e759f56ec1f008c957466b0331), [#2723](https://github.com/carrierwaveuploader/carrierwave/issues/2723))
* Rename #version\_exists? to #version\_active?, to reduce confusion (@mshibuya [21ca90a](https://github.com/carrierwaveuploader/carrierwave/commit/21ca90a1b0ecfd5a10b82af43c03bee6bedf2801), [#1926](https://github.com/carrierwaveuploader/carrierwave/issues/1926))

### Fixed

* Fix incompatibility with MiniMagick >= 5.0 (@mshibuya [a60d8d8](https://github.com/carrierwaveuploader/carrierwave/commit/a60d8d8a33bc2aa6b0ff09c745def6b8e1a892e9), [#2761](https://github.com/carrierwaveuploader/carrierwave/issues/2761))
* Fix incompatibility with uri gem >= 1.0 (@ollym [#2760](https://github.com/carrierwaveuploader/carrierwave/pull/2760), [#2759](https://github.com/carrierwaveuploader/carrierwave/issues/2759))
* Clear download errors on reassigning remote urls (@mshibuya [bb8c6e1](https://github.com/carrierwaveuploader/carrierwave/commit/bb8c6e1f9eccae8650c70ab46ca487ec878cda0b), [#2725](https://github.com/carrierwaveuploader/carrierwave/issues/2725))

## 3.1.0.beta - 2024-09-01

### Added

* Add support for the `crop` processing method (@clickworkorange [#2721](https://github.com/carrierwaveuploader/carrierwave/pull/2721))
* Add global `skip_ssrf_protection` configuration (@rajyan [#2696](https://github.com/carrierwaveuploader/carrierwave/pull/2696), [#2695](https://github.com/carrierwaveuploader/carrierwave/issues/2695))

### Changed

* Show warning if #filename is safeguarded as in the pre-3.x style (@mshibuya [#2718](https://github.com/carrierwaveuploader/carrierwave/pull/2718), [#2708](https://github.com/carrierwaveuploader/carrierwave/issues/2708))

### Fixed

* Fix version names starting with a non-alphabet character lead to NameError (@r7kamura [#2748](https://github.com/carrierwaveuploader/carrierwave/pull/2748), [#2722](https://github.com/carrierwaveuploader/carrierwave/issues/2722))
* Fix Rails 7.2 incompatibility due to incorrect use of ActiveSupport::Deprecation (@mshibuya [b25477d](https://github.com/carrierwaveuploader/carrierwave/commit/b25477d4dc2b32ee3da896714b081e6123737fa3), [8761240](https://github.com/carrierwaveuploader/carrierwave/commit/8761240283abc2e58bd97004f30a9419cad34109), [#2751](https://github.com/carrierwaveuploader/carrierwave/issues/2751))
* Fix assigning a file with the same name not marking the column as changed (@mshibuya [47f1737](https://github.com/carrierwaveuploader/carrierwave/commit/47f1737443f47cd188e555836b26ccdfcee91d49), [#2719](https://github.com/carrierwaveuploader/carrierwave/issues/2719))
* Fix content type magic detection for files packaged in .zip (@dzhikvas [#2705](https://github.com/carrierwaveuploader/carrierwave/pull/2705), [#2704](https://github.com/carrierwaveuploader/carrierwave/issues/2704))

## 3.0.7 - 2024-03-23

### Security

* Fix Content-Type allowlist bypass vulnerability remained (@mshibuya [00676e2](https://github.com/carrierwaveuploader/carrierwave/commit/00676e23d7f4beac12beddee6f2486b686fb7e46), [GHSA-vfmv-jfc5-pjjw](https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-vfmv-jfc5-pjjw))

## 3.0.6 - 2024-03-09

### Fixed

* Fix #derived\_versions and #active\_sibling\_versions returning an Array where Hash is expected (@mshibuya [46e4f20](https://github.com/carrierwaveuploader/carrierwave/commit/46e4f20f8f85f75043cec76aa1f331c55a3ba103))
* Fix incompatibility with Marcel 1.0.3 (@schinery [#2728](https://github.com/carrierwaveuploader/carrierwave/pull/2728), [#2729](https://github.com/carrierwaveuploader/carrierwave/issues/2729))
* Fix assigning a file with the same name not marking the column as changed (@mshibuya [4c65b39](https://github.com/carrierwaveuploader/carrierwave/commit/4c65b393cd85b66bc256d04363cf3e3a97c8fd64), [#2719](https://github.com/carrierwaveuploader/carrierwave/issues/2719))
* Fix failing to remove files with ActiveRecord 7.1 after\_commit order change enabled (@mshibuya [63113e9](https://github.com/carrierwaveuploader/carrierwave/commit/63113e96dc172114cb92af239ba73e50ed8a72f2), [#2713](https://github.com/carrierwaveuploader/carrierwave/issues/2713))

## 3.0.5 - 2023-11-29

### Fixed

* Remove unnecessary if clause within #filename left in the uploader template (@rajyan, [#2711](https://github.com/carrierwaveuploader/carrierwave/pull/2711))

### Security

* Fix Content-Type allowlist bypass vulnerability, possibly leading to XSS (@mshibuya, [863d425](https://github.com/carrierwaveuploader/carrierwave/commit/863d425c76eba12c3294227b39018f6b2dccbbf3), [GHSA-gxhx-g4fq-49hj](https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-gxhx-g4fq-49hj))

## 3.0.4 - 2023-10-08

### Fixed

* Fix model's dirty state remaining after update (@rajyan [#2707](https://github.com/carrierwaveuploader/carrierwave/pull/2707), [#2702](https://github.com/carrierwaveuploader/carrierwave/issues/2702))
* Fix #dup modifying the original object (@rajyan [#2690](https://github.com/carrierwaveuploader/carrierwave/pull/2690), [#2706](https://github.com/carrierwaveuploader/carrierwave/pull/2706), [#2689](https://github.com/carrierwaveuploader/carrierwave/issues/2689), [#2700](https://github.com/carrierwaveuploader/carrierwave/issues/2700))
* Fix #dup not respecting the :mount\_on option, causing MissingAttributeError (@marsz [#2691](https://github.com/carrierwaveuploader/carrierwave/pull/2691))

## 3.0.3 - 2023-08-21

### Fixed

* Fix #dup modifying the original object (@mshibuya [37f36f7](https://github.com/carrierwaveuploader/carrierwave/commit/37f36f7ccf035ffb19cbd3964928b3abf2d5e1b1), [#2687](https://github.com/carrierwaveuploader/carrierwave/issues/2687))
* Fix wrongly removing files on transaction rollback (@mshibuya, @rajyan [eb03fe1](https://github.com/carrierwaveuploader/carrierwave/commit/eb03fe124c3a7acf3ffc913c7d432208ba3aa7ca), [#2686](https://github.com/carrierwaveuploader/carrierwave/pull/2686), [#2685](https://github.com/carrierwaveuploader/carrierwave/issues/2685))

## 3.0.2 - 2023-08-01

### Fixed

* Fix deduplicated filename not being persisted (@mshibuya [#2679](https://github.com/carrierwaveuploader/carrierwave/pull/2679), [#2678](https://github.com/carrierwaveuploader/carrierwave/issues/2678), [#2677](https://github.com/carrierwaveuploader/carrierwave/pull/2677))

## 3.0.1 - 2023-07-22

### Fixed

* Fix not respecting the parent's #enable\_processing value after reading its own (@mshibuya [2df0f53](https://github.com/carrierwaveuploader/carrierwave/commit/2df0f53f1d5fa30a198aa148ef33f1ab924404e4), [#2676](https://github.com/carrierwaveuploader/carrierwave/issues/2676))
* Fix NoMethodError when a record is rolled back (@y-yagi [#2674](https://github.com/carrierwaveuploader/carrierwave/pull/2674), [#2675](https://github.com/carrierwaveuploader/carrierwave/issues/2675))
* Fix filename suffix being removed due to unnecessary deduplication (@mshibuya [d68a111](https://github.com/carrierwaveuploader/carrierwave/commit/d68a1111cfae4309d703caa19d9c19226bc01686), [#2672](https://github.com/carrierwaveuploader/carrierwave/issues/2672))
* Fix #dup causing unintended name deduplication of copied files (@mshibuya [b732acd](https://github.com/carrierwaveuploader/carrierwave/commit/b732acd63209897e6375a3706330df2c38e3f327), [#2670](https://github.com/carrierwaveuploader/carrierwave/issues/2670))
* Fix initialization failing when active\_support/core\_ext is not loaded yet (@mshibuya [875d972](https://github.com/carrierwaveuploader/carrierwave/commit/875d972dc78b8416de7768457793baa4d6220a4f))

## 3.0.0 - 2023-07-02

*No changes.*

## 3.0.0.rc - 2023-06-11

### Added

* Support adding suffix to filename on store when path collides with the existing ones (@mshibuya [07a5632](https://github.com/carrierwaveuploader/carrierwave/commit/07a5632a3f30ddcb21b10a75f003a7eaeaa072ad), [#1855](https://github.com/carrierwaveuploader/carrierwave/issues/1855))
* Add image dimension validation (@TsubasaYoshida [#2592](https://github.com/carrierwaveuploader/carrierwave/pull/2592), [3b1f8b4](https://github.com/carrierwaveuploader/carrierwave/commit/3b1f8b41f8c0896aa6ebe64bac23622c14a8b8d9))
* Provide validation error details via ActiveModel::Errors#details (@mshibuya [9013999](https://github.com/carrierwaveuploader/carrierwave/commit/90139995fc11978da909db71b1d43c0690c7c9d2), [#2150](https://github.com/carrierwaveuploader/carrierwave/issues/2150))
* Support clearing #remote\_urls by assigning nil (@mshibuya [8307f93](https://github.com/carrierwaveuploader/carrierwave/commit/8307f93c29b833d34efaae63c33d36e737d94715), [#2067](https://github.com/carrierwaveuploader/carrierwave/issues/2067))
* Support configuration of download retry wait time (@tricknotes [#2646](https://github.com/carrierwaveuploader/carrierwave/pull/2646))
* Support for ActiveRecord::Base#dup (@mshibuya, @BrianHawley [19b33b8](https://github.com/carrierwaveuploader/carrierwave/commit/19b33b876cd58e7af28dc718fd4f47bb539b78f9), [#2645](https://github.com/carrierwaveuploader/carrierwave/pull/2645), [#1962](https://github.com/carrierwaveuploader/carrierwave/issues/1962))
* Add CarrierWave::Storage::Fog::File#to\_file for interface consistency with SanitizedFile (@mshibuya [68ce83a](https://github.com/carrierwaveuploader/carrierwave/commit/68ce83a7b105d52c6af1b410727dd590c3960f7d), [#1960](https://github.com/carrierwaveuploader/carrierwave/issues/1960))
* Allow SanitizedFile to accept read with an optional length and output\_buffer arguments (@mshibuya [9096459](https://github.com/carrierwaveuploader/carrierwave/commit/90964596aa3d0b7acea584012f0f5888d622ea1b), [#1959](https://github.com/carrierwaveuploader/carrierwave/issues/1959))

### Changed

* Stop relying on ActiveModel::Dirty change tracking for removal of unnecessary files (@mshibuya [aac25c1](https://github.com/carrierwaveuploader/carrierwave/commit/aac25c10af4218d6e1e70f90154b847b54ce0334))
* Create versions lazily to reflect subclass configurations properly (@mshibuya [1531a67](https://github.com/carrierwaveuploader/carrierwave/commit/1531a67366f0e25e3d298133a72c81b6c9c0dc83), [#1957](https://github.com/carrierwaveuploader/carrierwave/issues/1957), [#2619](https://github.com/carrierwaveuploader/carrierwave/issues/2619))
* [BREAKING CHANGE] Use the resulting file extension on changing format by :convert (@mshibuya [#2659](https://github.com/carrierwaveuploader/carrierwave/pull/2659), [#2125](https://github.com/carrierwaveuploader/carrierwave/issues/2125), [#2126](https://github.com/carrierwaveuploader/carrierwave/issues/2126), [#2254](https://github.com/carrierwaveuploader/carrierwave/issues/2254))
* Prioritize Magic-detected content type for spoof-tolerance (@mshibuya [a2ca59c](https://github.com/carrierwaveuploader/carrierwave/commit/a2ca59cbe67046ba7818c64849a9a4ffa90306db), [#2570](https://github.com/carrierwaveuploader/carrierwave/issues/2570))
* Handle assignments in an ActiveModel::Dirty-friendly way (@mshibuya [#2658](https://github.com/carrierwaveuploader/carrierwave/pull/2658), [#2404](https://github.com/carrierwaveuploader/carrierwave/issues/2404), [#2409](https://github.com/carrierwaveuploader/carrierwave/issues/2409), [#2468](https://github.com/carrierwaveuploader/carrierwave/issues/2468))
* Give a stable name to classes created by the mount\_uploader block (@mshibuya [f5b09b8](https://github.com/carrierwaveuploader/carrierwave/commit/f5b09b844d99245a3b4d0ba01efd4972be4ee5be), [#2407](https://github.com/carrierwaveuploader/carrierwave/issues/2407), [#2471](https://github.com/carrierwaveuploader/carrierwave/issues/2471))
* Give a stable name to version classes (@mshibuya [a9de756](https://github.com/carrierwaveuploader/carrierwave/commit/a9de7565eabb4cdca05bb090cdf797eb1720c09c), [#2407](https://github.com/carrierwaveuploader/carrierwave/issues/2407), [#2471](https://github.com/carrierwaveuploader/carrierwave/issues/2471))

### Fixed

* Fix CarrierWave::Storage::Fog::File#read breaking when the file doesn't exist (@mshibuya [246eb01](https://github.com/carrierwaveuploader/carrierwave/commit/246eb012e15a75f7621bf9933f90a0f4742bd6e8), [#2524](https://github.com/carrierwaveuploader/carrierwave/issues/2524))
* Fix to preserve the original URI as much as possible on download (@mshibuya [2f3afaf](https://github.com/carrierwaveuploader/carrierwave/commit/2f3afafb738ae848a8a2d164780571cf9a7eb6ce), [#2631](https://github.com/carrierwaveuploader/carrierwave/issues/2631))
* Fix not to invoke content type detection on #copy\_to as it's costly (@mshibuya [6c6e2dc](https://github.com/carrierwaveuploader/carrierwave/commit/6c6e2dc9cf7747c0c1571d315473b246ef582e1f), [#2465](https://github.com/carrierwaveuploader/carrierwave/issues/2465))
* Fix calling #=~ on non-String breaking in Ruby 3.2 (@aubinlrx [#2653](https://github.com/carrierwaveuploader/carrierwave/pull/2653), [fd03ddd](https://github.com/carrierwaveuploader/carrierwave/commit/fd03dddef55025cab83936fc2957e3c8c58772ae))
* Fix #clean\_cache! to respect the uploader's root, not the global one (@sawasaki-narumi [#2652](https://github.com/carrierwaveuploader/carrierwave/pull/2652), [3cb9992](https://github.com/carrierwaveuploader/carrierwave/commit/3cb9992cc5fb8b113fe5b050651361f35d94adb4), [#2113](https://github.com/carrierwaveuploader/carrierwave/issues/2113))
* Fix to use helper method #fog\_provider instead of checking #fog\_credentials (@joshuamsager [#2660](https://github.com/carrierwaveuploader/carrierwave/pull/2660))
* Fix being unable to delete a file by assigning nil (@mshibuya [f8ea354](https://github.com/carrierwaveuploader/carrierwave/commit/f8ea35445e51c438b8cc8baf3e50079b5d423e34), [#2654](https://github.com/carrierwaveuploader/carrierwave/issues/2654), [#2613](https://github.com/carrierwaveuploader/carrierwave/pull/2613))
* Fix to raise exception when ImageMagick is not installed (@mshibuya [d90c399](https://github.com/carrierwaveuploader/carrierwave/commit/d90c399a6d2338203b1382f4ac4269863444d60d), [#2060](https://github.com/carrierwaveuploader/carrierwave/issues/2060))
* Fix to remove unnecessary floodfill in CarrierWave::RMagick#resize\_and\_pad (@mshibuya [f34a9bd](https://github.com/carrierwaveuploader/carrierwave/commit/f34a9bd26ed3e1006033a783c2ae8d86369993f6))
* Fix `#{column}_cache=` fails to be stored when set as a nested attribute (@mshibuya [e84d11e](https://github.com/carrierwaveuploader/carrierwave/commit/e84d11ec508d286ebab28195da815816abc62e41), [#2206](https://github.com/carrierwaveuploader/carrierwave/issues/2206))
* Fix to use AWS S3 regional endpoints when using virtual-hosted style (@mshibuya [8dace34](https://github.com/carrierwaveuploader/carrierwave/commit/8dace3456b5d1e0c3212ed1dc6c8b47dfd63b8ff), [#2523](https://github.com/carrierwaveuploader/carrierwave/issues/2523))
* Fix to respect condition on processing a derived version (@mshibuya [1fecddc](https://github.com/carrierwaveuploader/carrierwave/commit/1fecddc8ffe43426e9b5044dedfa7ac0b091cad8), [#2516](https://github.com/carrierwaveuploader/carrierwave/issues/2516))
* Fix #recreate\_versions! affecting the original file (@mshibuya [a67bfb6](https://github.com/carrierwaveuploader/carrierwave/commit/a67bfb696dcba14c7cdfa2c1b5481f04d3ef8dae), [5f00715](https://github.com/carrierwaveuploader/carrierwave/commit/5f00715747d44dd7f57ee990a6b471ed786ac764), [#2480](https://github.com/carrierwaveuploader/carrierwave/issues/2480), [#2655](https://github.com/carrierwaveuploader/carrierwave/issues/2655))
* Fix `remove_#{column}!` doesn't remove the file immediately (@mshibuya [b719fb3](https://github.com/carrierwaveuploader/carrierwave/commit/b719fb373c48f23e874dfa1a333a954c01967fc1), [#2540](https://github.com/carrierwaveuploader/carrierwave/issues/2540))
* Fix column value populated without a file when using filename override (@mshibuya [f1eff6e](https://github.com/carrierwaveuploader/carrierwave/commit/f1eff6e212fb0c374c9235968bfc4e7580bf1e2a), [#2284](https://github.com/carrierwaveuploader/carrierwave/issues/2284))
* Fix boolean configurations couldn't be set to false on a per-uploader basis (@megane42 [#2642](https://github.com/carrierwaveuploader/carrierwave/pull/2642))
* Fix #clean\_cache! breaking with directories that doesn't conform to CarrierWave's cache\_id format (@BrianHawley [#2641](https://github.com/carrierwaveuploader/carrierwave/pull/2641))

## 3.0.0.beta - 2022-11-19

### Added

* Add basename and fix extension value for fog file (@leductienttkt [#2587](https://github.com/carrierwaveuploader/carrierwave/pull/2587))
* Allow uploaders to accept unless conditions (@Vpatel1093 [#2588](https://github.com/carrierwaveuploader/carrierwave/pull/2588))
* Add retry option to download from remote url (@tashirosota [#2577](https://github.com/carrierwaveuploader/carrierwave/pull/2577))

### Deprecated

* #denylist was deprecated to prefer explicitly opting-in (@mshibuya [7a40ef7](https://github.com/carrierwaveuploader/carrierwave/commit/7a40ef7c4d5f3033f0f8401323f80bde14ca72b9), [#2536](https://github.com/carrierwaveuploader/carrierwave/issues/2536))

### Changed

* Completely migrate to allowlist/denylist terminology (@mshibuya [7a40ef7](https://github.com/carrierwaveuploader/carrierwave/commit/7a40ef7c4d5f3033f0f8401323f80bde14ca72b9), [#2536](https://github.com/carrierwaveuploader/carrierwave/issues/2536))
* Remove implementation-dependent information from an error message (@akihikodaki [#2499](https://github.com/carrierwaveuploader/carrierwave/pull/2499))
* Replace mini\_mime with marcel (@pjmartorell [#2552](https://github.com/carrierwaveuploader/carrierwave/pull/2552))
* [BREAKING CHANGE] Change to store files on after\_save hook instead of after\_commit, with performing cleanup when transaction is rolled back (@fsateler [#2546](https://github.com/carrierwaveuploader/carrierwave/pull/2546))

### Removed

* Drop support for Ruby < 2.5 and Rails 5.x (@mshibuya [229594f](https://github.com/carrierwaveuploader/carrierwave/commit/229594fb2ac7cfa59586162c0b3fc3d0b5bab978))
* Remove support for Merb (@seuros [#2566](https://github.com/carrierwaveuploader/carrierwave/pull/2566))

### Fixed

* Add Workaround for 'undefined method closed?' error caused by ssrf\_filter 1.1 (@mshibuya [65bf0d9](https://github.com/carrierwaveuploader/carrierwave/commit/65bf0d94759f7d522a36698d4b81e3635b8ca572), [#2628](https://github.com/carrierwaveuploader/carrierwave/issues/2628))
* Fix Ruby 2.7 keyword argument warning in uploader process (@nachiket87 [#2636](https://github.com/carrierwaveuploader/carrierwave/pull/2636), [#2635](https://github.com/carrierwaveuploader/carrierwave/issues/2635))
* Raise DownloadError when no content is returned (@BrianHawley [#2633](https://github.com/carrierwaveuploader/carrierwave/pull/2633), [#2632](https://github.com/carrierwaveuploader/carrierwave/issues/2632))
* Add workaround for the API change in ssrf\_filter 1.1 (@BrianHawley [#2629](https://github.com/carrierwaveuploader/carrierwave/pull/2629), [#2625](https://github.com/carrierwaveuploader/carrierwave/issues/2625))
* Fix Content-Type not being copied when using fog-google (@smnscp [#2614](https://github.com/carrierwaveuploader/carrierwave/pull/2614))
* Fix failing to save after limiting the columns with ActiveRecord's #select (@wonda-tea-coffee [#2613](https://github.com/carrierwaveuploader/carrierwave/pull/2613), [#2608](https://github.com/carrierwaveuploader/carrierwave/issues/2608))
* Fix content type detection for JSON files (@smnscp [#2618](https://github.com/carrierwaveuploader/carrierwave/pull/2618))
* Remove invalid byte sequences from the sanitized filename (@alexdunae [#2606](https://github.com/carrierwaveuploader/carrierwave/pull/2606))
* Fix issue with copying a fog file larger than 5GB (@slonopotamus [#2583](https://github.com/carrierwaveuploader/carrierwave/pull/2583))
* Stop closing StringIO-based file after CarrierWave::SanitizedFile#read (@aleksandrs-ledovskis [#2571](https://github.com/carrierwaveuploader/carrierwave/pull/2571))

Please check [2.x-stable](https://github.com/carrierwaveuploader/carrierwave/blob/2.x-stable/CHANGELOG.md) for previous changes.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_80621d52_20250114_194313.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fcommit%2F012702eb3ba1663452aa025831caa304d1a665c0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fcommit%2F012702eb3ba1663452aa025831caa304d1a665c0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=carrierwaveuploader%2Fcarrierwave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[carrierwaveuploader](/carrierwaveuploader)
/
**[carrierwave](/carrierwaveuploader/carrierwave)**
Public

* [Notifications](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)
* [Star
   8.8k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)

* [Code](/carrierwaveuploader/carrierwave)
* [Issues
  33](/carrierwaveuploader/carrierwave/issues)
* [Pull requests
  5](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects
  0](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

Additional navigation options

* [Code](/carrierwaveuploader/carrierwave)
* [Issues](/carrierwaveuploader/carrierwave/issues)
* [Pull requests](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

## Commit

[Permalink](/carrierwaveuploader/carrierwave/commit/012702eb3ba1663452aa025831caa304d1a665c0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix SSRF vulnerability in the remote file download feature

[Browse files](/carrierwaveuploader/carrierwave/tree/012702eb3ba1663452aa025831caa304d1a665c0)
Browse the repository at this point in the history

```
Closes [#2509](https://github.com/carrierwaveuploader/carrierwave/issues/2509), Refs. [GHSA-fwcm-636p-68r5](https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-fwcm-636p-68r5 "GHSA-fwcm-636p-68r5")
```

* Loading branch information

[![@mshibuya](https://avatars.githubusercontent.com/u/486678?s=40&v=4)](/mshibuya)

[mshibuya](/carrierwaveuploader/carrierwave/commits?author=mshibuya "View all commits by mshibuya")
committed
Feb 8, 2021

1 parent
[09f9f27](/carrierwaveuploader/carrierwave/commit/09f9f27c0259d5c644caf0e93cf2582f32784018)

commit 012702e

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**197 additions**
and
**60 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* carrierwave.gemspec
  [carrierwave.gemspec](#diff-df4064aef935f4118b771c147bc291200a5a4deb1bb1fae5f0804a1a0c71452c)
* features/step\_definitions

  + features/step\_definitions/download\_steps.rb
    [download\_steps.rb](#diff-37ad0529d3f50d7734bc05561f6e1eed7bfdb420fc07f05d20253cd7b51f171a)
* lib/carrierwave/downloader

  + lib/carrierwave/downloader/base.rb
    [base.rb](#diff-6baa53a55223e94564f37bc0c4123151fe1764f3982405b18221a2b4f1598f07)
  + lib/carrierwave/downloader/remote\_file.rb
    [remote\_file.rb](#diff-4a2d54b0f13584668712c85bdaca93348f5e577890266b1d1887fe9f0b31ec2a)
* spec

  + downloader

    - spec/downloader/base\_spec.rb
      [base\_spec.rb](#diff-3c69658c2a777d155bed6ba36a73f5d5a40575327a993fad7ef7d81e9b3b1f94)
    - spec/downloader/remote\_file\_spec.rb
      [remote\_file\_spec.rb](#diff-fab4e53a574edf51d95653716d6715a3a7f227fe5844e2b18c494d561ebfd04a)
  + spec/mount\_multiple\_spec.rb
    [mount\_multiple\_spec.rb](#diff-bd53eec6fcf5b1be2de9757d7e1c10aac1e807d16ac5bf1776e514dbd1aeb79b)
  + spec/mount\_single\_spec.rb
    [mount\_single\_spec.rb](#diff-55bd8972d8a2997979533cd76fafa9c4eef35899f2badbd9870becf7559835fd)
  + orm

    - spec/orm/activerecord\_spec.rb
      [activerecord\_spec.rb](#diff-48bc92466ff9653e1ae5c5b60134a0c7c631b0d414f0d9b0b4642e84097a650b)
  + spec/spec\_helper.rb
    [spec\_helper.rb](#diff-89eebfcbc0f14b6d989517837ca1e94fce4e2ce9a03233641cd936f2b8d2ed94)
  + uploader

    - spec/uploader/download\_spec.rb
      [download\_spec.rb](#diff-cdc172d77afc73f1e156d8726e3ff2b9bddb4f19647bfe0e33adef627ebd1ad4)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[carrierwave.gemspec](#diff-df4064aef935f4118b771c147bc291200a5a4deb1bb1fae5f0804a1a0c71452c "carrierwave.gemspec")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/carrierwave.gemspec)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,6 +27,7 @@ Gem::Specification.new do |s| |
|  |  | s.add\_dependency "image\_processing", "~> 1.1" |
|  |  | s.add\_dependency "mimemagic", ">= 0.3.0" |
|  |  | s.add\_dependency "addressable", "~> 2.6" |
|  |  | s.add\_dependency "ssrf\_filter", "~> 1.0" |
|  |  | if RUBY\_ENGINE == 'jruby' |
|  |  | s.add\_development\_dependency 'activerecord-jdbcpostgresql-adapter' |
|  |  | else |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[features/step\_definitions/download\_steps.rb](#diff-37ad0529d3f50d7734bc05561f6e1eed7bfdb420fc07f05d20253cd7b51f171a "features/step_definitions/download_steps.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/features/step_definitions/download_steps.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | When /^I download the file '([^']+)'/ do |url| |
|  |  | unless ENV['REMOTE'] == 'true' |
|  |  | stub\_request(:get, "s3.amazonaws.com/Monkey/testfile.txt"). |
|  |  | stub\_request(:get, %r{/Monkey/testfile.txt}). |
|  |  | to\_return(body: "S3 Remote File", headers: { "Content-Type" => "text/plain" }) |
|  |  | end |
|  |  |  |
| Expand Down | |  |

37 changes: 35 additions & 2 deletions

37
[lib/carrierwave/downloader/base.rb](#diff-6baa53a55223e94564f37bc0c4123151fe1764f3982405b18221a2b4f1598f07 "lib/carrierwave/downloader/base.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/lib/carrierwave/downloader/base.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,5 @@ |
|  |  | require 'open-uri' |
|  |  | require 'ssrf\_filter' |
|  |  | require 'addressable' |
|  |  | require 'carrierwave/downloader/remote\_file' |
|  |  |  |
| Expand All | | @@ -22,12 +23,22 @@ def initialize(uploader) |
|  |  | def download(url, remote\_headers = {}) |
|  |  | headers = remote\_headers. |
|  |  | reverse\_merge('User-Agent' => "CarrierWave/#{CarrierWave::VERSION}") |
|  |  | uri = process\_uri(url.to\_s) |
|  |  | begin |
|  |  | file = OpenURI.open\_uri(process\_uri(url.to\_s), headers) |
|  |  | if skip\_ssrf\_protection?(uri) |
|  |  | response = OpenURI.open\_uri(process\_uri(url.to\_s), headers) |
|  |  | else |
|  |  | request = nil |
|  |  | response = SsrfFilter.get(uri, headers: headers) do |req| |
|  |  | request = req |
|  |  | end |
|  |  | response.uri = request.uri |
|  |  | response.value |
|  |  | end |
|  |  | rescue StandardError => e |
|  |  | raise CarrierWave::DownloadError, "could not download file: #{e.message}" |
|  |  | end |
|  |  | CarrierWave::Downloader::RemoteFile.new(file) |
|  |  | CarrierWave::Downloader::RemoteFile.new(response) |
|  |  | end |
|  |  |  |
|  |  | ## |
| Expand All | | @@ -49,6 +60,28 @@ def process\_uri(uri) |
|  |  | rescue URI::InvalidURIError, Addressable::URI::InvalidURIError |
|  |  | raise CarrierWave::DownloadError, "couldn't parse URL: #{uri}" |
|  |  | end |
|  |  |  |
|  |  | ## |
|  |  | # If this returns true, SSRF protection will be bypassed. |
|  |  | # You can override this if you want to allow accessing specific local URIs that are not SSRF exploitable. |
|  |  | # |
|  |  | # === Parameters |
|  |  | # |
|  |  | # [uri (URI)] The URI where the remote file is stored |
|  |  | # |
|  |  | # === Examples |
|  |  | # |
|  |  | # class CarrierWave::Downloader::CustomDownloader < CarrierWave::Downloader::Base |
|  |  | # def skip\_ssrf\_protection?(uri) |
|  |  | # uri.hostname == 'localhost' && uri.port == 80 |
|  |  | # end |
|  |  | # end |
|  |  | # |
|  |  | # my\_uploader.downloader = CarrierWave::Downloader::CustomDownloader |
|  |  | # |
|  |  | def skip\_ssrf\_protection?(uri) |
|  |  | false |
|  |  | end |
|  |  | end |
|  |  | end |
|  |  | end |

33 changes: 27 additions & 6 deletions

33
[lib/carrierwave/downloader/remote\_file.rb](#diff-4a2d54b0f13584668712c85bdaca93348f5e577890266b1d1887fe9f0b31ec2a "lib/carrierwave/downloader/remote_file.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/lib/carrierwave/downloader/remote_file.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,15 +1,36 @@ |
|  |  | module CarrierWave |
|  |  | module Downloader |
|  |  | class RemoteFile |
|  |  | attr\_reader :file |
|  |  | attr\_reader :file, :uri |
|  |  |  |
|  |  | def initialize(file) |
|  |  | @file = file.is\_a?(String) ? StringIO.new(file) : file |
|  |  | case file |
|  |  | when String |
|  |  | @file = StringIO.new(file) |
|  |  | when Net::HTTPResponse |
|  |  | @file = StringIO.new(file.body) |
|  |  | @content\_type = file.content\_type |
|  |  | @headers = file |
|  |  | @uri = file.uri |
|  |  | else |
|  |  | @file = file |
|  |  | @content\_type = file.content\_type |
|  |  | @headers = file.meta |
|  |  | @uri = file.base\_uri |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | def content\_type |
|  |  | @content\_type || 'application/octet-stream' |
|  |  | end |
|  |  |  |
|  |  | def headers |
|  |  | @headers || {} |
|  |  | end |
|  |  |  |
|  |  | def original\_filename |
|  |  | filename = filename\_from\_header || filename\_from\_uri |
|  |  | mime\_type = MiniMime.lookup\_by\_content\_type(file.content\_type) |
|  |  | mime\_type = MiniMime.lookup\_by\_content\_type(content\_type) |
|  |  | unless File.extname(filename).present? || mime\_type.blank? |
|  |  | filename = "#{filename}.#{mime\_type.extension}" |
|  |  | end |
| Expand All | | @@ -23,16 +44,16 @@ def respond\_to?(\*args) |
|  |  | private |
|  |  |  |
|  |  | def filename\_from\_header |
|  |  | return nil unless file.meta.include? 'content-disposition' |
|  |  | return nil unless headers['content-disposition'] |
|  |  |  |
|  |  | match = file.meta['content-disposition'].match(/filename=(?:"([^"]+)"|([^";]+))/) |
|  |  | match = headers['content-disposition'].match(/filename=(?:"([^"]+)"|([^";]+))/) |
|  |  | return nil unless match |
|  |  |  |
|  |  | match[1].presence || match[2].presence |
|  |  | end |
|  |  |  |
|  |  | def filename\_from\_uri |
|  |  | CGI.unescape(File.basename(file.base\_uri.path)) |
|  |  | CGI.unescape(File.basename(uri.path)) |
|  |  | end |
|  |  |  |
|  |  | def method\_missing(\*args, &block) |
| Expand Down | |  |

71 changes: 51 additions & 20 deletions

71
[spec/downloader/base\_spec.rb](#diff-3c69658c2a777d155bed6ba36a73f5d5a40575327a993fad7ef7d81e9b3b1f94 "spec/downloader/base_spec.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/spec/downloader/base_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,21 +26,6 @@ |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | context "with a URL with internationalized domain name" do |
|  |  | let(:uri) { "http://ドメイン名例.jp/#{CGI.escape(filename)}" } |
|  |  | before do |
|  |  | stub\_request(:get, 'http://xn--eckwd4c7cu47r2wf.jp/test.jpg').to\_return(body: file) |
|  |  | end |
|  |  |  |
|  |  | it "converts to Punycode URI" do |
|  |  | expect(subject.process\_uri(uri).to\_s).to eq 'http://xn--eckwd4c7cu47r2wf.jp/test.jpg' |
|  |  | end |
|  |  |  |
|  |  | it "downloads a file" do |
|  |  | expect(subject.download(uri).file.read).to eq file |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | context "with equal and colons in the query path" do |
|  |  | let(:query) { 'test=query&with=equal&before=colon:param' } |
|  |  | let(:uri) { "https://example.com/#{filename}?#{query}" } |
| Expand Down  Expand Up | | @@ -77,10 +62,6 @@ |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | it "raises an error when trying to download a local file" do |
|  |  | expect { subject.download('/etc/passwd') }.to raise\_error(CarrierWave::DownloadError) |
|  |  | end |
|  |  |  |
|  |  | context "with missing file" do |
|  |  | before do |
|  |  | stub\_request(:get, uri).to\_return(status: 404) |
| Expand All | | @@ -95,6 +76,20 @@ |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | context "with server error" do |
|  |  | before do |
|  |  | stub\_request(:get, uri).to\_return(status: 500) |
|  |  | end |
|  |  |  |
|  |  | it "raises an error when trying to download" do |
|  |  | expect{ subject.download(uri) }.to raise\_error(CarrierWave::DownloadError) |
|  |  | end |
|  |  |  |
|  |  | it "doesn't obscure original exception message" do |
|  |  | expect { subject.download(uri) }.to raise\_error(CarrierWave::DownloadError, /could not download file: 500/) |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | context "with a url that contains space" do |
|  |  | let(:filename) { "my test.jpg" } |
|  |  | before do |
| Expand All | | @@ -111,7 +106,7 @@ |
|  |  | before do |
|  |  | stub\_request(:get, uri). |
|  |  | to\_return(status: 301, body: "Redirecting", headers: { "Location" => another\_uri }) |
|  |  | stub\_request(:get, another\_uri).to\_return(body: file) |
|  |  | stub\_request(:get, /redirected.jpg/).to\_return(body: file) |
|  |  | end |
|  |  |  |
|  |  | it "retrieves redirected file" do |
| Expand All | | @@ -123,7 +118,31 @@ |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | context "with SSRF prevention" do |
|  |  | before do |
|  |  | stub\_request(:get, 'http://169.254.169.254/').to\_return(body: file) |
|  |  | stub\_request(:get, 'http://127.0.0.1/').to\_return(body: file) |
|  |  | end |
|  |  |  |
|  |  | it "prevents accessing local files" do |
|  |  | expect { subject.download('/etc/passwd') }.to raise\_error(CarrierWave::DownloadError) |
|  |  | expect { subject.download('file:///etc/passwd') }.to raise\_error(CarrierWave::DownloadError) |
|  |  | end |
|  |  |  |
|  |  | it "prevents accessing internal addresses" do |
|  |  | expect { uploader.download!("http://169.254.169.254/") }.to raise\_error CarrierWave::DownloadError |
|  |  | expect { uploader.download!("http://lvh.me/") }.to raise\_error CarrierWave::DownloadError |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | describe '#process\_uri' do |
|  |  | it "converts a URL with internationalized domain name to Punycode URI" do |
|  |  | uri = "http://ドメイン名例.jp/#{CGI.escape(filename)}" |
|  |  | processed = subject.process\_uri(uri) |
|  |  | expect(processed.class).to eq(URI::HTTP) |
|  |  | expect(processed.to\_s).to eq 'http://xn--eckwd4c7cu47r2wf.jp/test.jpg' |
|  |  | end |
|  |  |  |
|  |  | it "parses but not escape already escaped uris" do |
|  |  | uri = 'http://example.com/%5B.jpg' |
|  |  | processed = subject.process\_uri(uri) |
| Expand Down  Expand Up | | @@ -178,4 +197,16 @@ |
|  |  | expect { subject.process\_uri(uri) }.to raise\_error(CarrierWave::DownloadError) |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | describe "#skip\_ssrf\_protection?" do |
|  |  | let(:uri) { 'http://localhost/test.jpg' } |
|  |  | before do |
|  |  | WebMock.stub\_request(:get, uri).to\_return(body: file) |
|  |  | allow(subject).to receive(:skip\_ssrf\_protection?).and\_return(true) |
|  |  | end |
|  |  |  |
|  |  | it "allows local request to be made" do |
|  |  | expect(subject.download(uri).read).to eq 'this is stuff' |
|  |  | end |
|  |  | end |
|  |  | end |

56 changes: 47 additions & 9 deletions

56
[spec/downloader/remote\_file\_spec.rb](#diff-fab4e53a574edf51d95653716d6715a3a7f227fe5844e2b18c494d561ebfd04a "spec/downloader/remote_file_spec.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/spec/downloader/remote_file_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,23 +1,61 @@ |
|  |  | require 'spec\_helper' |
|  |  |  |
|  |  | describe CarrierWave::Downloader::RemoteFile do |
|  |  | subject { CarrierWave::Downloader::RemoteFile.new(file) } |
|  |  | let(:file) do |
|  |  | File.open(file\_path("test.jpg")).tap { |f| OpenURI::Meta.init(f) } |
|  |  | Net::HTTPSuccess.new('1.0', '200', "").tap do |response| |
|  |  | response.body = File.read(file\_path("test.jpg")) |
|  |  | response.instance\_variable\_set(:@read, true) |
|  |  | response.uri = URI.parse 'http://example.com/test' |
|  |  | response['content-type'] = 'image/jpeg' |
|  |  | response['vary'] = 'Accept-Encoding' |
|  |  | end |
|  |  | end |
|  |  | subject { CarrierWave::Downloader::RemoteFile.new(file) } |
|  |  |  |
|  |  | before do |
|  |  | subject.base\_uri = URI.parse 'http://example.com/test' |
|  |  | subject.meta\_add\_field 'content-type', 'image/jpeg' |
|  |  | context 'with Net::HTTPResponse instance' do |
|  |  | it 'returns content type' do |
|  |  | expect(subject.content\_type).to eq 'image/jpeg' |
|  |  | end |
|  |  |  |
|  |  | it 'returns header' do |
|  |  | expect(subject.headers['vary']).to eq 'Accept-Encoding' |
|  |  | end |
|  |  |  |
|  |  | it 'returns URI' do |
|  |  | expect(subject.uri.to\_s).to eq 'http://example.com/test' |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | it 'sets file extension based on content-type if missing' do |
|  |  | expect(subject.original\_filename).to eq "test.jpeg" |
|  |  | context 'with OpenURI::Meta instance' do |
|  |  | let(:file) do |
|  |  | File.open(file\_path("test.jpg")).tap { |f| OpenURI::Meta.init(f) }.tap do |file| |
|  |  | file.base\_uri = URI.parse 'http://example.com/test' |
|  |  | file.meta\_add\_field 'content-type', 'image/jpeg' |
|  |  | file.meta\_add\_field 'vary', 'Accept-Encoding' |
|  |  | end |
|  |  | end |
|  |  | it 'returns content type' do |
|  |  | expect(subject.content\_type).to eq 'image/jpeg' |
|  |  | end |
|  |  |  |
|  |  | it 'returns header' do |
|  |  | expect(subject.headers['vary']).to eq 'Accept-Encoding' |
|  |  | end |
|  |  |  |
|  |  | it 'returns URI' do |
|  |  | expect(subject.uri.to\_s).to eq 'http://example.com/test' |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | describe 'with content-disposition' do |
|  |  |  |
|  |  | describe '#original\_filename' do |
|  |  | let(:content\_disposition){ nil } |
|  |  | before do |
|  |  | subject.meta\_add\_field 'content-disposition', content\_disposition |
|  |  | file['content-disposition'] = content\_disposition if content\_disposition |
|  |  | end |
|  |  |  |
|  |  | it 'sets file extension based on content-type if missing' do |
|  |  | expect(subject.original\_filename).to eq "test.jpeg" |
|  |  | end |
|  |  |  |
|  |  | context 'when filename is quoted' do |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[spec/mount\_multiple\_spec.rb](#diff-bd53eec6fcf5b1be2de9757d7e1c10aac1e807d16ac5bf1776e514dbd1aeb79b "spec/mount_multiple_spec.rb")

Show comments

[View file](/carrierwaveuploader/carrierwave/blob/012702eb3ba1663452aa025831caa304d1a665c0/spec/mount_multiple_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -504,7 +504,7 @@ def monkey |
|  |  | describe "#remote\_images\_urls" do |
|  |  | subject { instance.remote\_images\_urls } |
|  |  |  |
|  |  | before { stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) } |
|  |  | before { stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) } |
|  |  |  |
|  |  | context "returns nil" do |
|  |  | it { is\_expected.to be\_nil } |
| Expand All | | @@ -521,7 +521,7 @@ def monkey |
|  |  | subject(:images) { instance.images } |
|  |  |  |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "http://www.example.com/test.txt").to\_return(status: 404) |
|  |  | instance.remote\_images\_urls = remote\_images\_url |
|  |  | end |
| Expand Down  Expand Up | | @@ -733,7 +733,7 @@ def extension\_whitelist |
|  |  |  |
|  |  | context "when file was downloaded" do |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | instance.remote\_images\_urls = ["http://www.example.com/#{test\_file\_name}"] |
|  |  | end |
|  |  |  |
| Expand Down  Expand Up | | @@ -790,7 +790,7 @@ def monkey |
|  |  |  |
|  |  | context "when file was downloaded" do |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | instance.remote\_images\_urls = ["http://www.example.com/#{test\_file\_name}"] |
|  |  | end |
|  |  |  |
| Expand All | | @@ -803,8 +803,8 @@ def monkey |
|  |  | subject(:images\_download\_errors) { instance.images\_download\_errors } |
|  |  |  |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "www.example.com/missing.jpg").to\_return(status: 404) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: File.read(test\_file\_stub)) |
|  |  | stub\_request(:get, "http://www.example.com/missing.jpg").to\_return(status: 404) |
|  |  | end |
|  |  |  |
|  |  | describe "default behaviour" do |
| Expand Down  Expand Up | | @@ -978,7 +978,7 @@ def extension\_whitelist |
|  |  |  |
|  |  | context "when a downloaded image fails an integity check" do |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: test\_file\_stub) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: test\_file\_stub) |
|  |  | end |
|  |  |  |
|  |  | it { expect(running {instance.remote\_images\_urls = ["http://www.example.com/#{test\_file\_name}"]}).to raise\_error(CarrierWave::IntegrityError) } |
| Expand Down  Expand Up | | @@ -1010,7 +1010,7 @@ def monkey |
|  |  |  |
|  |  | context "when a downloaded image fails an integity check" do |
|  |  | before do |
|  |  | stub\_request(:get, "www.example.com/#{test\_file\_name}").to\_return(body: test\_file\_stub) |
|  |  | stub\_request(:get, "http://www.example.com/#{test\_file\_name}").to\_return(body: test\_file\_stub) |
|  |  | end |
|  |  |  |
|  |  | it { expect(running {instance.remote\_images\_urls = ["http://www.example.com/#{test\_file\_name}"]}).to raise\_error(CarrierWave::ProcessingError) } |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `012702e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fcommit%2F012702eb3ba1663452aa025831caa304d1a665c0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c6c0678d_20250114_194314.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fsecurity%2Fadvisories%2FGHSA-fwcm-636p-68r5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fsecurity%2Fadvisories%2FGHSA-fwcm-636p-68r5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=carrierwaveuploader%2Fcarrierwave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[carrierwaveuploader](/carrierwaveuploader)
/
**[carrierwave](/carrierwaveuploader/carrierwave)**
Public

* [Notifications](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)
* [Star
   8.8k](/login?return_to=%2Fcarrierwaveuploader%2Fcarrierwave)

* [Code](/carrierwaveuploader/carrierwave)
* [Issues
  33](/carrierwaveuploader/carrierwave/issues)
* [Pull requests
  5](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects
  0](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

Additional navigation options

* [Code](/carrierwaveuploader/carrierwave)
* [Issues](/carrierwaveuploader/carrierwave/issues)
* [Pull requests](/carrierwaveuploader/carrierwave/pulls)
* [Actions](/carrierwaveuploader/carrierwave/actions)
* [Projects](/carrierwaveuploader/carrierwave/projects)
* [Wiki](/carrierwaveuploader/carrierwave/wiki)
* [Security](/carrierwaveuploader/carrierwave/security)
* [Insights](/carrierwaveuploader/carrierwave/pulse)

# SSRF vulnerability in CarrierWave remote file upload

Moderate

[mshibuya](/mshibuya)
published
GHSA-fwcm-636p-68r5
Feb 8, 2021

## Package

bundler

carrierwave
([RubyGems](/advisories?query=ecosystem%3Arubygems))

## Affected versions

< 2.1.1 and < 1.3.2

## Patched versions

2.1.1, 1.3.2

## Description

### Impact

[CarrierWave download feature](https://github.com/carrierwaveuploader/carrierwave#uploading-files-from-a-remote-location) has an SSRF vulnerability, allowing attacks to provide DNS entries or IP addresses that are intended for internal use and gather information about the Intranet infrastructure of the platform.

### Patches

Upgrade to [2.1.1](https://rubygems.org/gems/carrierwave/versions/2.1.1) or [1.3.2](https://rubygems.org/gems/carrierwave/versions/1.3.2).

### Workarounds

Using proper network segmentation and applying the principle of least privilege to outbound connections from application servers can reduce the severity of SSRF vulnerabilities. Ideally the vulnerable gem should run on an isolated server without access to any internal network resources or cloud metadata access.

### References

[Server-Side Request Forgery Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [CarrierWave repo](https://github.com/carrierwaveuploader/carrierwave)
* Email me at mit.shibuya@gmail.com

### Severity

Moderate

### CVE ID

CVE-2021-21288

### Weaknesses

No CWEs

### Credits

* [![@chadwilken](https://avatars.githubusercontent.com/u/2219044?s=40&v=4)](/chadwilken)
  [chadwilken](/chadwilken)
  Analyst
* [![@phosphore](https://avatars.githubusercontent.com/u/1053079?s=40&v=4)](/phosphore)
  [phosphore](/phosphore)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from rubygems.org_136db47b_20250114_194316.html ===


[⬢
RubyGems](/ "RubyGems") Navigation menu

Search Gems…

[Releases](https://rubygems.org/releases)
[Blog](https://blog.rubygems.org)
[Gems](/gems)
[Guides](https://guides.rubygems.org)
[Sign in](/sign_in)
[Sign up](/sign_up)

# [carrierwave](/gems/carrierwave) *3.1.1*

Upload files in your Ruby applications, map them to a range of ORMs, store them on different backends.

## Gemfile: =

## install: =

### Versions:

1. [3.1.1](/gems/carrierwave/versions/3.1.1)
   January 12, 2025
   (53 KB)
2. [3.1.0](/gems/carrierwave/versions/3.1.0)
   December 14, 2024
   (53 KB)
3. [3.1.0.rc](/gems/carrierwave/versions/3.1.0.rc)
   December 07, 2024
   (53 KB)
4. [3.1.0.beta](/gems/carrierwave/versions/3.1.0.beta)
   September 01, 2024
   (53 KB)
5. [3.0.7](/gems/carrierwave/versions/3.0.7)
   March 23, 2024
   (51 KB)

[Show all versions (86 total)](https://rubygems.org/gems/carrierwave/versions)

### Runtime Dependencies (6):

[**activemodel**](/gems/activemodel)
>= 6.0.0

[**activesupport**](/gems/activesupport)
>= 6.0.0

[**addressable**](/gems/addressable)
~> 2.6

[**image\_processing**](/gems/image_processing)
~> 1.1

[**marcel**](/gems/marcel)
~> 1.0.0

[**ssrf\_filter**](/gems/ssrf_filter)
~> 1.0

### Development Dependencies (15):

[**csv**](/gems/csv)
~> 3.0

[**cucumber**](/gems/cucumber)
>= 0

[**fog-aws**](/gems/fog-aws)
>= 0

[**fog-google**](/gems/fog-google)
~> 1.7, != 1.12.1

[**fog-local**](/gems/fog-local)
>= 0

[**generator\_spec**](/gems/generator_spec)
>= 0.9.1

[**mini\_magick**](/gems/mini_magick)
>= 3.6.0

[**pry**](/gems/pry)
>= 0

[**pry-byebug**](/gems/pry-byebug)
>= 0

[**rmagick**](/gems/rmagick)
>= 2.16

[**rspec**](/gems/rspec)
~> 3.4

[**rspec-retry**](/gems/rspec-retry)
>= 0

[**rubocop**](/gems/rubocop)
~> 1.28

[**timecop**](/gems/timecop)
>= 0

[**webmock**](/gems/webmock)
>= 0

[Show all transitive dependencies](/gems/carrierwave/versions/3.1.1/dependencies)

### Owners:

[![](/users/296/avatar.jpeg?size=48&theme=light)](/profiles/jnicklas "jnicklas")[![](/users/349/avatar.jpeg?size=48&theme=light)](/profiles/trevorturk "trevorturk")[![](/users/43692/avatar.jpeg?size=48&theme=light)](/profiles/bensie "bensie")[![](/users/53064/avatar.jpeg?size=48&theme=light)](/profiles/mshibuya "mshibuya")[![](/users/60885/avatar.jpeg?size=48&theme=light)](/profiles/thiagofm "thiagofm")
### Pushed by:

[![](/users/53064/avatar.jpeg?size=48&theme=light)](/profiles/mshibuya "mshibuya")
### Authors:

* Jonas Nicklas

### SHA 256 checksum:

=

[← Previous version](/gems/carrierwave/versions/3.1.0)

## Total downloads 109,638,913

## For this version 4,794

## Version Released: January 12, 2025 9:38am

## License: MIT

## Required Ruby Version: *>= 2.5.0*

### Links:

[Homepage](https://github.com/carrierwaveuploader/carrierwave)
[Source Code](https://github.com/carrierwaveuploader/carrierwave/)
[Documentation](https://www.rubydoc.info/gems/carrierwave/3.1.1)
[Wiki](https://github.com/carrierwaveuploader/carrierwave/wiki)
[Mailing List](http://groups.google.com/group/carrierwave)
[Bug Tracker](https://github.com/carrierwaveuploader/carrierwave/issues)
[Download](/downloads/carrierwave-3.1.1.gem)
[Review changes](https://my.diffend.io/gems/carrierwave/prev/3.1.1)
[Badge](https://badge.fury.io/rb/carrierwave/install)
[Subscribe](/sign_in)
[RSS](/gems/carrierwave/versions.atom)
Report abuse
[Reverse dependencies](/gems/carrierwave/reverse_dependencies)

[Status](https://status.rubygems.org)
[Uptime](https://uptime.rubygems.org)
[Code](https://github.com/rubygems/rubygems.org)
[Data](/pages/data)
[Discuss](https://groups.google.com/group/rubygems-org)
[Stats](/stats)
[Contribute](https://guides.rubygems.org/contributing/)
[About](/pages/about)
Help
[API](https://guides.rubygems.org/rubygems-org-api)
[Security](/pages/security)

RubyGems.org is the Ruby community’s gem hosting service. Instantly [publish your gems](https://guides.rubygems.org/publishing/) and then [install them](https://guides.rubygems.org/command-reference/#gem-install). Use [the API](https://guides.rubygems.org/rubygems-org-api/) to find out more about [available gems](/gems). [Become a contributor](https://guides.rubygems.org/contributing/) and improve the site yourself.

RubyGems.org is made possible through a partnership with the greater Ruby community. [Fastly](https://www.fastly.com/) provides bandwidth and CDN support, [Ruby Central](https://www.rubycentral.org/) covers infrastructure costs, and funds ongoing development and ops work. [Learn more about our sponsors and how they work together](/pages/sponsors).

We need your help to fund the developer time that keeps RubyGems.org running smoothly for everyone. [Join Ruby Central today](https://rubycentral.org/#/portal/signup).

[Supported by
Ruby Central](https://rubycentral.org/)
[Designed by
DockYard](https://dockyard.com/ruby-on-rails-consulting)
[Resolved with
DNSimple](https://dnsimple.link/resolving-rubygems)
[Monitored by
Datadog](https://www.datadoghq.com/)
[Gems served by
Fastly](https://www.fastly.com/)
[Monitored by
Honeybadger](https://www.honeybadger.io/)
[Verified by
Domainr](https://domainr.com/)
[Secured by
Whitesource](https://mend.io/)

[English](/gems/carrierwave?locale=en)

[Nederlands](/gems/carrierwave?locale=nl)

[简体中文](/gems/carrierwave?locale=zh-CN)

[正體中文](/gems/carrierwave?locale=zh-TW)

[Português do Brasil](/gems/carrierwave?locale=pt-BR)

[Français](/gems/carrierwave?locale=fr)

[Español](/gems/carrierwave?locale=es)

[Deutsch](/gems/carrierwave?locale=de)

[日本語](/gems/carrierwave?locale=ja)


