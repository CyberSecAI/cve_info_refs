=== Content from gist.github.com_2c029fdf_20250115_093758.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@wadealexc](https://avatars.githubusercontent.com/u/18387287?s=64&v=4)](/wadealexc)

# [wadealexc](/wadealexc)/**[A\_DESCRIPTION.md](/wadealexc/2490d522e81a796af9efcad1686e6754)** Secret

Last active
November 25, 2022 10:41

Show Gist options

* [Download ZIP](/wadealexc/2490d522e81a796af9efcad1686e6754/archive/447540aa6b0913f023abcf81492be76ae568132c.zip)

* [Star
  (2)
  2](/login?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/wadealexc/2490d522e81a796af9efcad1686e6754.js&quot;&gt;&lt;/script&gt;
* Save wadealexc/2490d522e81a796af9efcad1686e6754 to your computer and use it in GitHub Desktop.

[Code](/wadealexc/2490d522e81a796af9efcad1686e6754)
[Revisions
8](/wadealexc/2490d522e81a796af9efcad1686e6754/revisions)
[Stars
1](/wadealexc/2490d522e81a796af9efcad1686e6754/stargazers)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/wadealexc/2490d522e81a796af9efcad1686e6754.js&quot;&gt;&lt;/script&gt;

Save wadealexc/2490d522e81a796af9efcad1686e6754 to your computer and use it in GitHub Desktop.

[Download ZIP](/wadealexc/2490d522e81a796af9efcad1686e6754/archive/447540aa6b0913f023abcf81492be76ae568132c.zip)

 [Raw](/wadealexc/2490d522e81a796af9efcad1686e6754/raw/447540aa6b0913f023abcf81492be76ae568132c/A_DESCRIPTION.md)

[**A\_DESCRIPTION.md**](#file-a_description-md)

# BLS "Malleability" PoC Description

**Problem 1:** BLS signature validation in lotus uses `blst` library method `VerifyCompressed`. This method accepts signatures in 2 forms: "serialized", and "compressed", meaning that BLS signatures can be provided as either of 2 unique byte arrays.

* [(Link - `VerifyCompressed`)](https://github.com/supranational/blst/blob/1cbb16ed9580dcd3e9593b71221fcf2a048faaef/bindings/go/blst.go#L271-L279): See `AggregateVerifyCompressed`, which accepts both signatures and public keys in serialized and compressed forms.
* [(Link - `blsSigner.Verify`)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/lib/sigs/bls/init.go#L52-L57): Invokes `VerifyCompressed`

**Problem 2:** Lotus block validation functions perform a uniqueness check on provided blocks. Two blocks are considered distinct if the CIDs of their blockheader do not match. The CID method for blockheader includes the `BlockSig` of the block.

* [(Link - `BlockHeader.ToStorageBlock`)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/types/blockheader.go#L87-L91): Serializes the blockheader with `BlockSig` included

**As a result:** Two blocks that are identical in every way (except that one uses a "serialized" `BlockSig` and the other "compressed"), will be considered distinct blocks. These problems occur in at least 3 locations in lotus code:

1. `/chain/sync.go::ValidateBlock`:
   * Checks if the provided block has already been validated by comparing its CID against already-validated blocks [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/sync.go#L692-L701)
   * Checks block signature using `VerifyCompressed` [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/sync.go#L872-L877)
2. `/chain/vm/syscalls.go::VerifyConsensusFault`:
   * Compares two submitted blocks using their CID [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/vm/syscalls.go#L119-L122)
   * Verifies both blocks' signatures using `VerifyCompressed` [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/vm/syscalls.go#L190-L199)
3. `/chain/sub/incoming.go::Validate`:
   * Checks against blocks in cache using CID [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/sub/incoming.go#L328-L333)
   * Verifies block signature using `VerifyCompressed` [(ref)](https://github.com/filecoin-project/lotus/blob/476df99179157c9d0019d2bcc9a9a4fb6b31d876/chain/sub/incoming.go#L315)

**Remediation:** Blocks should be checked for uniqueness without the inclusion of the `BlockSig`.

**Notes:** The code below is a POC that `VerifyCompressed` will accept signatures when provided in both forms: "serialized" and "compressed". The console output of the POC follows:

```
Verifying signature...
P2Affine.Verify: Valid!
================
Serialized: 04f423a63f915e347f19ef629741251e26518ced0a14d5130ed8760e0bf91c72f085ba6b984f15ef7f7ea9d3421fd4a910d40ec76a3a31452574234ed00039e55a01f4994328604ae60134b6854b2a5082810e1a676826de5c8babf057ceb8421915f1fd5cdb1cd38de7a9016c0e5eeeb29ac0d3c29a128476258cf39e0ce04d1bff8f02984c79eb57bebe75a73a66a813fec8d09868929e5bfe9f55d3185abcb74337a11868577071420e7cede325c0c75ca0ba90aeb8040e0e4eecacb21143
(len: 192)
================
Compressed: a4f423a63f915e347f19ef629741251e26518ced0a14d5130ed8760e0bf91c72f085ba6b984f15ef7f7ea9d3421fd4a910d40ec76a3a31452574234ed00039e55a01f4994328604ae60134b6854b2a5082810e1a676826de5c8babf057ceb842
(len: 96)
================
VerifyCompressed(sigSerialized, pkSerialized): Valid!
VerifyCompressed(sigSerialized, pkCompressed): Valid!
VerifyCompressed(sigCompressed, pkSerialized): Valid!
VerifyCompressed(sigCompressed, pkCompressed): Valid!

```

 [Raw](/wadealexc/2490d522e81a796af9efcad1686e6754/raw/447540aa6b0913f023abcf81492be76ae568132c/go.mod)

[**go.mod**](#file-go-mod)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | module github.com/wadeAlexC/bls-poc |
| --- | --- |
|  |  |
|  | go 1.15 |
|  |  |
|  | require github.com/supranational/blst v0.2.0 |

 [Raw](/wadealexc/2490d522e81a796af9efcad1686e6754/raw/447540aa6b0913f023abcf81492be76ae568132c/main.go)

[**main.go**](#file-main-go)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | package main |
| --- | --- |
|  |  |
|  | import ( |
|  | "crypto/rand" |
|  | "fmt" |
|  |  |
|  | blst "github.com/supranational/blst/bindings/go" |
|  | ) |
|  |  |
|  | type PublicKey = blst.P1Affine |
|  | type Signature = blst.P2Affine |
|  | type AggregateSignature = blst.P2Aggregate |
|  | type AggregatePublicKey = blst.P1Aggregate |
|  |  |
|  | func main() { |
|  | var ikm [32]byte |
|  | \_, \_ = rand.Read(ikm[:]) |
|  | sk := blst.KeyGen(ikm[:]) |
|  | pk := new(PublicKey).From(sk) |
|  |  |
|  | var dst = []byte("BLS\_SIG\_BLS12381G2\_XMD:SHA-256\_SSWU\_RO\_NUL\_") |
|  | msg := []byte("BLS-MALLEABILITY-POC") |
|  | sig := new(Signature).Sign(sk, msg, dst) |
|  |  |
|  | fmt.Println("Verifying signature...") |
|  |  |
|  | fmt.Printf("P2Affine.Verify: ") |
|  | if !sig.Verify(pk, msg, dst) { |
|  | fmt.Println("ERROR: Invalid!") |
|  | } else { |
|  | fmt.Println("Valid!") |
|  | } |
|  |  |
|  | fmt.Println("================") |
|  |  |
|  | // Serialize and compress signatures and pks |
|  | sigSerialized := sig.Serialize() |
|  | sigCompressed := sig.Compress() |
|  | pkSerialized := pk.Serialize() |
|  | pkCompressed := pk.Compress() |
|  |  |
|  | // Print signature bytes. Length must be under 200 to meet CBOR unmarshal restrictions |
|  | fmt.Printf("Serialized: %x\n(len: %d)\n", sigSerialized, len(sigSerialized)) |
|  | fmt.Println("================") |
|  | fmt.Printf("Compressed: %x\n(len: %d)\n", sigCompressed, len(sigCompressed)) |
|  | fmt.Println("================") |
|  |  |
|  | // 1. VerifyCompressed with serialized signature / serialized PK |
|  | fmt.Printf("VerifyCompressed(sigSerialized, pkSerialized): ") |
|  | if !new(Signature).VerifyCompressed(sigSerialized, pkSerialized, msg, dst) { |
|  | fmt.Println("ERROR: Invalid!") |
|  | } else { |
|  | fmt.Println("Valid!") |
|  | } |
|  |  |
|  | // 2. VerifyCompressed with serialized signature / compressed PK |
|  | fmt.Printf("VerifyCompressed(sigSerialized, pkCompressed): ") |
|  | if !new(Signature).VerifyCompressed(sigSerialized, pkCompressed, msg, dst) { |
|  | fmt.Println("ERROR: Invalid!") |
|  | } else { |
|  | fmt.Println("Valid!") |
|  | } |
|  |  |
|  | // 3. VerifyCompressed with compressed signature / serialized PK |
|  | fmt.Printf("VerifyCompressed(sigCompressed, pkSerialized): ") |
|  | if !new(Signature).VerifyCompressed(sigCompressed, pkSerialized, msg, dst) { |
|  | fmt.Println("ERROR: Invalid!") |
|  | } else { |
|  | fmt.Println("Valid!") |
|  | } |
|  |  |
|  | // 4. VerifyCompressed with compressed signature / compressed PK |
|  | fmt.Printf("VerifyCompressed(sigCompressed, pkCompressed): ") |
|  | if !new(Signature).VerifyCompressed(sigCompressed, pkCompressed, msg, dst) { |
|  | fmt.Println("ERROR: Invalid!") |
|  | } else { |
|  | fmt.Println("Valid!") |
|  | } |
|  | } |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FwadeAlexC%2F2490d522e81a796af9efcad1686e6754)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9dfd914f_20250115_093800.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilecoin-project%2Flotus%2Fsecurity%2Fadvisories%2FGHSA-4g52-pqcj-phvh)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilecoin-project%2Flotus%2Fsecurity%2Fadvisories%2FGHSA-4g52-pqcj-phvh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=filecoin-project%2Flotus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[filecoin-project](/filecoin-project)
/
**[lotus](/filecoin-project/lotus)**
Public

* [Notifications](/login?return_to=%2Ffilecoin-project%2Flotus) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffilecoin-project%2Flotus)
* [Star
   2.9k](/login?return_to=%2Ffilecoin-project%2Flotus)

* [Code](/filecoin-project/lotus)
* [Issues
  588](/filecoin-project/lotus/issues)
* [Pull requests
  60](/filecoin-project/lotus/pulls)
* [Discussions](/filecoin-project/lotus/discussions)
* [Actions](/filecoin-project/lotus/actions)
* [Projects
  1](/filecoin-project/lotus/projects)
* [Security](/filecoin-project/lotus/security)
* [Insights](/filecoin-project/lotus/pulse)

Additional navigation options

* [Code](/filecoin-project/lotus)
* [Issues](/filecoin-project/lotus/issues)
* [Pull requests](/filecoin-project/lotus/pulls)
* [Discussions](/filecoin-project/lotus/discussions)
* [Actions](/filecoin-project/lotus/actions)
* [Projects](/filecoin-project/lotus/projects)
* [Security](/filecoin-project/lotus/security)
* [Insights](/filecoin-project/lotus/pulse)

# BLS Signature "Malleability"

Critical

[dignifiedquire](/dignifiedquire)
published
GHSA-4g52-pqcj-phvh
Apr 15, 2021

## Package

lotus

## Affected versions

< 1.5.0

## Patched versions

1.5.0

## Description

### Impact

1. BLS signature validation in lotus uses blst library method VerifyCompressed. This method accepts signatures in 2 forms: "serialized", and "compressed", meaning that BLS signatures can be provided as either of 2 unique byte arrays.
2. Lotus block validation functions perform a uniqueness check on provided blocks. Two blocks are considered distinct if the CIDs of their blockheader do not match. The CID method for blockheader includes the BlockSig of the block.

The result of these issues is that it would be possible to punish miners for valid blocks, as there are two different valid block CIDs available for each block, even though this must be unique.

### Patches

By switching from the go based `blst` bindings over to the bindings in `filecoin-ffi`, the code paths now ensure that all signatures are compressed by size and the way they are deserialized.

This happened in [#5393](https://github.com/filecoin-project/lotus/pull/5393)

### References

* Original POC: <https://gist.github.com/wadeAlexC/2490d522e81a796af9efcad1686e6754>

### Severity

Critical

### CVE ID

CVE-2021-21405

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_af13edd2_20250115_093759.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilecoin-project%2Flotus%2Fpull%2F5393)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilecoin-project%2Flotus%2Fpull%2F5393)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=filecoin-project%2Flotus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[filecoin-project](/filecoin-project)
/
**[lotus](/filecoin-project/lotus)**
Public

* [Notifications](/login?return_to=%2Ffilecoin-project%2Flotus) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffilecoin-project%2Flotus)
* [Star
   2.9k](/login?return_to=%2Ffilecoin-project%2Flotus)

* [Code](/filecoin-project/lotus)
* [Issues
  588](/filecoin-project/lotus/issues)
* [Pull requests
  60](/filecoin-project/lotus/pulls)
* [Discussions](/filecoin-project/lotus/discussions)
* [Actions](/filecoin-project/lotus/actions)
* [Projects
  1](/filecoin-project/lotus/projects)
* [Security](/filecoin-project/lotus/security)
* [Insights](/filecoin-project/lotus/pulse)

Additional navigation options

* [Code](/filecoin-project/lotus)
* [Issues](/filecoin-project/lotus/issues)
* [Pull requests](/filecoin-project/lotus/pulls)
* [Discussions](/filecoin-project/lotus/discussions)
* [Actions](/filecoin-project/lotus/actions)
* [Projects](/filecoin-project/lotus/projects)
* [Security](/filecoin-project/lotus/security)
* [Insights](/filecoin-project/lotus/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ffilecoin-project%2Flotus%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ffilecoin-project%2Flotus%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# refactor: switch to filecoin-ffi bls api for bls signatures #5393

 Merged

[magik6k](/magik6k)
merged 6 commits into
[master](/filecoin-project/lotus/tree/master "filecoin-project/lotus:master")
from
[feat-refactor-bls](/filecoin-project/lotus/tree/feat-refactor-bls "filecoin-project/lotus:feat-refactor-bls")

Jan 25, 2021

 Merged

# [refactor: switch to filecoin-ffi bls api for bls signatures](#top) #5393

[magik6k](/magik6k)
merged 6 commits into
[master](/filecoin-project/lotus/tree/master "filecoin-project/lotus:master")
from
[feat-refactor-bls](/filecoin-project/lotus/tree/feat-refactor-bls "filecoin-project/lotus:feat-refactor-bls")

Jan 25, 2021

[Conversation
0](/filecoin-project/lotus/pull/5393)
[Commits
6](/filecoin-project/lotus/pull/5393/commits)
[Checks
0](/filecoin-project/lotus/pull/5393/checks)
[Files changed](/filecoin-project/lotus/pull/5393/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=60&v=4)](/dignifiedquire)

Copy link

Contributor

### @dignifiedquire **[dignifiedquire](/dignifiedquire)** commented [Jan 20, 2021](#issue-790074736) • edited Loading

With [filecoin-project/filecoin-ffi#159](https://github.com/filecoin-project/filecoin-ffi/pull/159) the ffi now uses `blst` as the signature backend, matching the existing functionality. This allows us to simplify the ffi contexts, and remove the git submodule for blst in here.

Due to the streamlining, I am seeing a nice perf increase

```
master
BenchmarkBLSVerify-64                693           1816108 ns/op

feat-refactor-bls
BenchmarkBLSVerify-64                904           1245841 ns/op

```

Sorry, something went wrong.

All reactions

 [dignifiedquire](/dignifiedquire)
added 2 commits
[January 20, 2021 16:19](#commits-pushed-187a499)

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=40&v=4)](/dignifiedquire)

`[remove extern/blst](/filecoin-project/lotus/pull/5393/commits/187a499cca577fddc31d7c95127844e538a6bcae "remove extern/blst")`

`[187a499](/filecoin-project/lotus/pull/5393/commits/187a499cca577fddc31d7c95127844e538a6bcae)`

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=40&v=4)](/dignifiedquire)

`[refactor: switch to filecoin-ffi bls api for bls signatures](/filecoin-project/lotus/pull/5393/commits/3d9eb226faf87a626d8abc3af19a7cfe14011c3e "refactor: switch to filecoin-ffi bls api for bls signatures")`

`[3d9eb22](/filecoin-project/lotus/pull/5393/commits/3d9eb226faf87a626d8abc3af19a7cfe14011c3e)`

 [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
changed the base branch from
master

to
next

[January 25, 2021 10:22](#event-4244795149)

 [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
changed the base branch from
next

to
master

[January 25, 2021 10:22](#event-4244796838)

 [magik6k](/magik6k)
added 3 commits
[January 25, 2021 13:57](#commits-pushed-9b62e22)

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&v=4)](/magik6k)

`[Use filecoin-ffi master](/filecoin-project/lotus/pull/5393/commits/9b62e224d58fa4b6a31cf256127fc1dba2b6ae8c "Use filecoin-ffi master")`

`[9b62e22](/filecoin-project/lotus/pull/5393/commits/9b62e224d58fa4b6a31cf256127fc1dba2b6ae8c)`

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&v=4)](/magik6k)

`[Fix lint](/filecoin-project/lotus/pull/5393/commits/6d368179e1199ca39d9f4e698dcc17df5cae2ef1 "Fix lint")`

`[6d36817](/filecoin-project/lotus/pull/5393/commits/6d368179e1199ca39d9f4e698dcc17df5cae2ef1)`

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&v=4)](/magik6k)

`[Fix lint](/filecoin-project/lotus/pull/5393/commits/bd6321d2c0aeb244815016fbf4723ee9720fe6cc "Fix lint")`

`[bd6321d](/filecoin-project/lotus/pull/5393/commits/bd6321d2c0aeb244815016fbf4723ee9720fe6cc)`

 [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
marked this pull request as ready for review
[January 25, 2021 15:13](#event-4246111117)

 [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
requested review from
[Kubuxu](/Kubuxu),
[magik6k](/magik6k) and
[whyrusleeping](/whyrusleeping)
as [code owners](/filecoin-project/lotus/blob/d6c06881eeb16b8097fcda24d247005287927a3b/.github/CODEOWNERS#L11)
[January 25, 2021 15:13](#event-4246111143)

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&v=4)](/magik6k)

`[Update FFI more, fix zero aggregate sigs](/filecoin-project/lotus/pull/5393/commits/e4f4fa2c7de808c1ce12800e1a97fcc53a3d41f8 "Update FFI more, fix zero aggregate sigs")`

`[e4f4fa2](/filecoin-project/lotus/pull/5393/commits/e4f4fa2c7de808c1ce12800e1a97fcc53a3d41f8)`

[![magik6k](https://avatars.githubusercontent.com/u/3867941?s=60&v=4)](/magik6k)

**[magik6k](/magik6k)**
approved these changes
[Jan 25, 2021](#pullrequestreview-575758197)

 [View reviewed changes](/filecoin-project/lotus/pull/5393/files/e4f4fa2c7de808c1ce12800e1a97fcc53a3d41f8)

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
merged commit [`2609080`](/filecoin-project/lotus/commit/260908015f41324db5a31d7ee5724df08af186dc)
into
master

[Jan 25, 2021](https://github.com/filecoin-project/lotus/pull/5393#event-4247447889)

 [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k)
[magik6k](/magik6k)
deleted the
feat-refactor-bls

branch
[January 25, 2021 19:56](#event-4247448017)

[bibibong](/bibibong)
pushed a commit
to EpiK-Protocol/go-epik
that referenced
this pull request
[Feb 22, 2021](#ref-commit-1c26694)
[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&u=dce4fbe3e2503d3f6fa964e932262406576ced07&v=4)](/magik6k) [![@bibibong](https://avatars.githubusercontent.com/u/12828925?s=40&v=4)](/bibibong)

`[Merge pull request](/EpiK-Protocol/go-epik/commit/1c26694eb600f19d121436760b34a4ed11848591 "Merge pull request #5393 from filecoin-project/feat-refactor-bls

refactor: switch to filecoin-ffi bls api for bls signatures") [filecoin-project#5393](https://github.com/filecoin-project/lotus/pull/5393) [from filecoin-project/feat-r…](/EpiK-Protocol/go-epik/commit/1c26694eb600f19d121436760b34a4ed11848591 "Merge pull request #5393 from filecoin-project/feat-refactor-bls

refactor: switch to filecoin-ffi bls api for bls signatures")`
…

`[1c26694](/EpiK-Protocol/go-epik/commit/1c26694eb600f19d121436760b34a4ed11848591)`

```
…efactor-bls

refactor: switch to filecoin-ffi bls api for bls signatures
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ffilecoin-project%2Flotus%2Fpull%2F5393)

Reviewers

[![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=40&v=4)](/magik6k) [magik6k](/magik6k)

magik6k approved these changes

[![@Kubuxu](https://avatars.githubusercontent.com/u/2259282?s=40&v=4)](/Kubuxu) [Kubuxu](/Kubuxu)

 Awaiting requested review from Kubuxu

[![@whyrusleeping](https://avatars.githubusercontent.com/u/1243164?s=40&v=4)](/whyrusleeping) [whyrusleeping](/whyrusleeping)

 Awaiting requested review from whyrusleeping

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=52&v=4)](/dignifiedquire) [![@magik6k](https://avatars.githubusercontent.com/u/3867941?s=52&v=4)](/magik6k)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


