```
{
  "vulnerability": {
    "root_cause": "The `copy_with` method in `httpx.URL` improperly handled URLs with invalid or unusual formatting, particularly those with multiple slashes after the scheme. This allowed the parsing logic to be bypassed, leading to incorrect URL construction.",
    "weaknesses": [
      "Improper Input Validation (CWE-20)"
    ],
    "impact": "An attacker could potentially bypass security checks, leading to Server-Side Request Forgery (SSRF) vulnerabilities. By manipulating the URL input, attackers could cause the application to make requests to unintended internal resources. This would lead to information leaks, access to sensitive data, and other malicious activities.",
    "attack_vectors": [
      "Network",
      "By providing a specially crafted URL string to `httpx.URL`"
    ],
    "required_attacker_capabilities": "The attacker only needs to control the URL string that is provided to the `httpx.URL` constructor or `copy_with` method. No privileges or user interaction is required."
  },
  "details": [
    {
      "file": "github.com_5d501435_20250115_111925.html",
      "detail": "The vulnerability lies in the improper input validation of the httpx.URL class, httpx.Client, and functions that use httpx.URL.copy_with. An attacker can exploit this vulnerability by crafting a URL that bypasses parsing and security checks, leading to SSRF vulnerabilities."
    },
     {
      "file": "gist.github.com_3074b7fd_20250114_181219.html",
      "detail": "A proof of concept (PoC) script demonstrates how the copy_with method can be manipulated to change the netloc and potentially bypass security checks. The PoC shows that functions using copy_with, such as copy_set_param, copy_add_param, copy_remove_param, copy_merge_params, and scheme modification, are also vulnerable. It also highlights how an attacker can control the base_url in httpx.Client and bypass naive checks. It further shows how a request with a relative path is constructed incorrectly, and how SSRF vulnerabilities are possible."
    },
    {
      "file": "github.com_c603a86f_20250115_111929.html",
      "detail": "A patch for the vulnerability was made which corrects the behavior of copy_with by normalizing the URI reference before creating a new URL object. This ensures that the URL properties are set correctly and prevents unintended changes to the host or path. Also, a new test was added to cover this security fix. This shows how the vulnerability is addressed through a code change."
    },
     {
      "file": "github.com_786169ee_20250115_111924.html",
      "detail": "The commit e9b0c85 shows the code changes made to address the improper input validation issue, it involves modifying the `copy_with` method in httpx/_urls.py to perform normalization on the URI reference and also the addition of a new test case to verify the fix, specifically checking for unexpected changes on the URL after calling `copy_with`"
    },
    {
        "file": "github.com_b67d5df0_20250114_181223.html",
        "detail": "This discussion thread highlights that the vulnerability can lead to SSRF and how it was handled by the developers. It also provides a reference to the CVE and the associated pull request that fixed the issue"
    },
    {
       "file":"github.com_ead9b0b1_20250115_111928.html",
       "detail":"This diff view of the vulnerable code shows how the `copy_with` method was implemented and how it was vulnerable to improper input. It shows the previous version of the vulnerable code."
     },
      {
       "file":"github.com_b4372f3c_20250114_181224.html",
        "detail":"This issue discussion shows how this vulnerability can be exploited to bypass blacklist checks, how `httpx.Client` and `httpx.Proxy` are affected, and how it was patched with reference to CVE and GHSA"
      }
  ]
}
```