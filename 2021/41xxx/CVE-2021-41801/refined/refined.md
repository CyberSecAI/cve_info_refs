Based on the provided content, here's an analysis of CVE-2021-41801:

**Root cause of vulnerability:**
The `ReplaceText` MediaWiki extension was not properly checking user permissions before executing text replacement jobs. This allowed a user who had their permissions revoked (e.g., by being blocked) to continue performing text replacement actions that they were no longer authorized to perform.

**Weaknesses/vulnerabilities present:**
*   **Missing Authorization Check:** The `ReplaceTextJob` class lacked a check to ensure that the user still possessed the `replacetext` permission right at the time of job execution. It relied on the initial permission check at the time the job was created/queued, which could become invalid if user permissions changed after the job was queued and before it ran.

**Impact of exploitation:**
*   **Unauthorized Actions:** A blocked user or a user who had their permissions revoked could continue to modify pages using the `ReplaceText` extension, potentially causing vandalism or other unwanted changes even after administrative intervention.
*   **Circumvention of Administrative Controls:** Blocking a user or removing permissions would not immediately prevent them from performing text replacements if jobs were already queued.

**Attack vectors:**
*   An attacker would need to use the `ReplaceText` extension to queue jobs, then get their permissions revoked by being blocked, or have their user rights removed. Jobs submitted before permissions revocation would still execute.

**Required attacker capabilities/position:**
*   The attacker needs a user account that initially has the `replacetext` permission right.
*   The attacker needs to be able to submit text replacement jobs through the `ReplaceText` special page or an API.

**Additional details:**
*   The vulnerability was addressed by adding a permission check within the `ReplaceTextJob::run` method. This check uses `PermissionManager->userCan` to verify that the user still has the necessary `replacetext` right.
*   The fix ensures that if the user no longer has permission (due to being blocked or rights revocation), the job will not proceed. It uses the correct `userCan` method to properly detect a blocked user.
*   The fix involved modifying the return value of the function to prevent the job from being retried when it fails due to permission issues.
*   The fix was backported to multiple branches of the MediaWiki software: REL1_31, REL1_35, REL1_36, REL1_37 and master.
*  A bug was found in the initial fix for MediaWiki 1.35 which was missing a `use` statement and was fixed.
* The patch would only stop users who were blocked between the job being submitted, and the job being run.