=== Content from github.com_db46398a_20250114_214908.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fe7f497570abb6b4ae5af4970620cd880e4c0c904)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fe7f497570abb6b4ae5af4970620cd880e4c0c904)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/e7f497570abb6b4ae5af4970620cd880e4c0c904)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix segfault on OOM in Conv2D.

[Browse files](/tensorflow/tensorflow/tree/e7f497570abb6b4ae5af4970620cd880e4c0c904)
Browse the repository at this point in the history

```
PiperOrigin-RevId: 404655317
Change-Id: I33588dbd3f5d0fef980e3c908bf5515a9ee09ce7
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Oct 20, 2021

1 parent
[e021452](/tensorflow/tensorflow/commit/e0214528739cad3bd02fbf2696a793dc342ffb94)

commit e7f4975

Showing
**1 changed file**
with
**12 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

15 changes: 12 additions & 3 deletions

15
[tensorflow/core/kernels/conv\_ops.cc](#diff-2829f84f2d7dcdc12ceca22668762914e0deca7ef3f0505faabffdc64a65657b "tensorflow/core/kernels/conv_ops.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/e7f497570abb6b4ae5af4970620cd880e4c0c904/tensorflow/core/kernels/conv_ops.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -183,20 +183,29 @@ struct LaunchGrouped { |
|  |  | auto on\_shuffled = [&]() { shuffles\_completed.DecrementCount(); }; |
|  |  |  |
|  |  | // Shuffle input into temporary tensor. |
|  |  | Tensor input\_shuffled(input.dtype(), TensorShape(post\_shuffle(input))); |
|  |  | Tensor input\_shuffled; |
|  |  | OP\_REQUIRES\_OK( |
|  |  | ctx, ctx->allocate\_temp(input.dtype(), TensorShape(post\_shuffle(input)), |
|  |  | &input\_shuffled)); |
|  |  | input\_shuffled.tensor<T, 5>().device(device, on\_shuffled) = |
|  |  | input.shaped<T, 5>(pre\_shuffle(input)).shuffle(shuffle); |
|  |  |  |
|  |  | // Shuffle filter into temporary tensor. |
|  |  | Tensor filter\_shuffled(filter.dtype(), TensorShape(post\_shuffle(filter))); |
|  |  | Tensor filter\_shuffled; |
|  |  | OP\_REQUIRES\_OK(ctx, ctx->allocate\_temp(filter.dtype(), |
|  |  | TensorShape(post\_shuffle(filter)), |
|  |  | &filter\_shuffled)); |
|  |  | filter\_shuffled.tensor<T, 5>().device(device, on\_shuffled) = |
|  |  | filter.shaped<T, 5>(pre\_shuffle(filter)).shuffle(shuffle); |
|  |  |  |
|  |  | // Wait for the completion of input/filter shuffles. |
|  |  | shuffles\_completed.Wait(); |
|  |  |  |
|  |  | // Write group convolution results into temporary output tensor. |
|  |  | Tensor output\_shuffled(output->dtype(), TensorShape(post\_shuffle(\*output))); |
|  |  | Tensor output\_shuffled; |
|  |  | OP\_REQUIRES\_OK(ctx, ctx->allocate\_temp(output->dtype(), |
|  |  | TensorShape(post\_shuffle(\*output)), |
|  |  | &output\_shuffled)); |
|  |  |  |
|  |  | for (int64\_t i = 0; i < num\_groups; ++i) { |
|  |  | // TODO(ezhulenev): Run this loop using `parallelFor` (regular parallelFor |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e7f4975`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fe7f497570abb6b4ae5af4970620cd880e4c0c904) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2cbcaa6a_20250114_214907.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fda4aad5946be30e5f049920fa076e1f7ef021261)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fda4aad5946be30e5f049920fa076e1f7ef021261)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/da4aad5946be30e5f049920fa076e1f7ef021261)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Roll forward [ab0ca4b](https://github.com/tensorflow/tensorflow/commit/ab0ca4bbc66a476aea305f81c69e0201b5876d0a). The internal test that it broke has been fixed.

[Browse files](/tensorflow/tensorflow/tree/da4aad5946be30e5f049920fa076e1f7ef021261)
Browse the repository at this point in the history

```
PiperOrigin-RevId: 401913101
Change-Id: I67f095899187e38101fbb10289c5e444b0a9e8c0
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Oct 9, 2021

1 parent
[79e495c](/tensorflow/tensorflow/commit/79e495c8d47f60fd31a7aa55ef726ffd155995c6)

commit da4aad5

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**197 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow

  + core/kernels

    - tensorflow/core/kernels/maxpooling\_op.cc
      [maxpooling\_op.cc](#diff-19f5d06e55cdd7346664ecb69548a7f56e976d55942f0ebbb29697a5abfc54a1)
    - tensorflow/core/kernels/pooling\_ops\_3d.cc
      [pooling\_ops\_3d.cc](#diff-ea6836bb70afeac71dac24c345fd237741097ee374a8df238ba5a6bd641eea11)
    - tensorflow/core/kernels/pooling\_ops\_common.cc
      [pooling\_ops\_common.cc](#diff-48d3928afea0c4f11bda2a7101a088bdbd93a820254e2f182570b59b2455149f)
    - tensorflow/core/kernels/pooling\_ops\_common.h
      [pooling\_ops\_common.h](#diff-0edd1d69cbc1e97362a5b7ab14ded8906f486421c2463639f27e8317d125e272)
  + python/kernel\_tests

    - tensorflow/python/kernel\_tests/pooling\_ops\_3d\_test.py
      [pooling\_ops\_3d\_test.py](#diff-ebbea3c6c9750c96928ed65bafa40b36e4da7872b94a0ba57ec774950a759554)
    - tensorflow/python/kernel\_tests/pooling\_ops\_test.py
      [pooling\_ops\_test.py](#diff-695549cbf89e37a9a40dec54695789f3c4157e5a06533e3103800c8e4f0aa2a1)

## There are no files selected for viewing

47 changes: 47 additions & 0 deletions

47
[tensorflow/core/kernels/maxpooling\_op.cc](#diff-19f5d06e55cdd7346664ecb69548a7f56e976d55942f0ebbb29697a5abfc54a1 "tensorflow/core/kernels/maxpooling_op.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/core/kernels/maxpooling_op.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -325,6 +325,14 @@ class MaxPoolingGradOp : public OpKernel { |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | OP\_REQUIRES(context, tensor\_out.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", tensor\_out.shape())); |
|  |  | OP\_REQUIRES(context, out\_backprop.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", out\_backprop.shape())); |
|  |  |  |
|  |  | Tensor\* output = nullptr; |
|  |  | OP\_REQUIRES\_OK(context, context->forward\_input\_or\_allocate\_output( |
| Expand Down  Expand Up | | @@ -538,6 +546,18 @@ class MaxPoolingGradGradOp : public OpKernel { |
|  |  | /\*explicit\_paddings=\*/{}, |
|  |  | FORMAT\_NHWC, |
|  |  | tensor\_in.shape()}; |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | OP\_REQUIRES(context, tensor\_out.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", tensor\_out.shape())); |
|  |  | OP\_REQUIRES( |
|  |  | context, out\_grad\_backprop.shape() == tensor\_in.shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", tensor\_in.shape(), |
|  |  | ", but got ", out\_grad\_backprop.shape())); |
|  |  |  |
|  |  | Tensor\* output = nullptr; |
|  |  | OP\_REQUIRES\_OK(context, context->forward\_input\_or\_allocate\_output( |
|  |  | {2}, 0, tensor\_out.shape(), &output)); |
| Expand Down  Expand Up | | @@ -742,6 +762,17 @@ class MaxPoolingGradGradOp<Eigen::GpuDevice, T> : public OpKernel { |
|  |  | /\*explicit\_paddings=\*/{}, |
|  |  | data\_format\_, |
|  |  | tensor\_in.shape()}; |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | OP\_REQUIRES(context, tensor\_out.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", tensor\_out.shape())); |
|  |  | OP\_REQUIRES( |
|  |  | context, out\_grad\_backprop.shape() == tensor\_in.shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", tensor\_in.shape(), |
|  |  | ", but got ", out\_grad\_backprop.shape())); |
|  |  |  |
|  |  | functor::MaxPoolGradBackwardNoMask<T>()( |
|  |  | data\_format\_, tensor\_in.flat<T>().data(), tensor\_out.flat<T>().data(), |
| Expand Down  Expand Up | | @@ -1096,6 +1127,14 @@ class MaxPoolingGradWithArgmaxOp : public OpKernel { |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | OP\_REQUIRES(context, grad\_in.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", grad\_in.shape())); |
|  |  | OP\_REQUIRES(context, argmax.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected argmax shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", argmax.shape())); |
|  |  |  |
|  |  | TensorShape out\_shape({params.tensor\_in\_batch, params.tensor\_in\_rows, |
|  |  | params.tensor\_in\_cols, params.depth}); |
| Expand Down  Expand Up | | @@ -1156,6 +1195,14 @@ class MaxPoolingGradGradWithArgmaxOp : public OpKernel { |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | OP\_REQUIRES( |
|  |  | context, grad\_in.shape() == tensor\_in.shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", tensor\_in.shape(), |
|  |  | ", but got ", grad\_in.shape())); |
|  |  | OP\_REQUIRES(context, argmax.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected argmax shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", argmax.shape())); |
|  |  |  |
|  |  | TensorShape out\_shape({params.tensor\_in\_batch, params.out\_height, |
|  |  | params.out\_width, params.depth}); |
| Expand Down | |  |

21 changes: 21 additions & 0 deletions

21
[tensorflow/core/kernels/pooling\_ops\_3d.cc](#diff-ea6836bb70afeac71dac24c345fd237741097ee374a8df238ba5a6bd641eea11 "tensorflow/core/kernels/pooling_ops_3d.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/core/kernels/pooling_ops_3d.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -366,6 +366,19 @@ class MaxPooling3dGradOp : public OpKernel { |
|  |  |  |
|  |  | OP\_REQUIRES\_OK(context, Get3dOutputSize(input\_size, window, stride, |
|  |  | padding\_, &out, &padding)); |
|  |  |  |
|  |  | const int64\_t depth = GetTensorDim(tensor\_in, data\_format\_, 'C'); |
|  |  | const int64\_t in\_batch = GetTensorDim(tensor\_in, data\_format\_, 'N'); |
|  |  | TensorShape out\_shape = ShapeFromFormat(data\_format\_, in\_batch, |
|  |  | {{out[2], out[1], out[0]}}, depth); |
|  |  | OP\_REQUIRES( |
|  |  | context, tensor\_out.shape() == out\_shape, |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", out\_shape, |
|  |  | ", but got ", tensor\_out.shape())); |
|  |  | OP\_REQUIRES(context, out\_backprop.shape() == out\_shape, |
|  |  | errors::InvalidArgument("Expected grad shape to be ", out\_shape, |
|  |  | ", but got ", out\_backprop.shape())); |
|  |  |  |
|  |  | LaunchMaxPooling3dGradOp<Device, T>::launch( |
|  |  | context, tensor\_in, tensor\_out, out\_backprop, window, stride, out, |
|  |  | padding, data\_format\_, input\_backprop); |
| Expand Down  Expand Up | | @@ -712,6 +725,14 @@ class MaxPooling3dGradGradOp : public OpKernel { |
|  |  | Pool3dParameters params{context, ksize\_, stride\_, |
|  |  | padding\_, data\_format\_, tensor\_in.shape()}; |
|  |  | if (!context->status().ok()) return; // params is invalid |
|  |  | OP\_REQUIRES(context, tensor\_out.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", tensor\_out.shape())); |
|  |  | OP\_REQUIRES( |
|  |  | context, out\_grad\_backprop.shape() == tensor\_in.shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", tensor\_in.shape(), |
|  |  | ", but got ", out\_grad\_backprop.shape())); |
|  |  |  |
|  |  | Tensor\* output = nullptr; |
|  |  | OP\_REQUIRES\_OK(context, context->forward\_input\_or\_allocate\_output( |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[tensorflow/core/kernels/pooling\_ops\_common.cc](#diff-48d3928afea0c4f11bda2a7101a088bdbd93a820254e2f182570b59b2455149f "tensorflow/core/kernels/pooling_ops_common.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/core/kernels/pooling_ops_common.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -465,6 +465,16 @@ void DnnPoolingGradOp<T>::Compute( |
|  |  | if (!context->status().ok()) { |
|  |  | return; |
|  |  | } |
|  |  | if (tensor\_out) { |
|  |  | OP\_REQUIRES(context, tensor\_out->shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected orig\_output shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", tensor\_out->shape())); |
|  |  | } |
|  |  | OP\_REQUIRES(context, out\_backprop.shape() == params.forward\_output\_shape(), |
|  |  | errors::InvalidArgument("Expected grad shape to be ", |
|  |  | params.forward\_output\_shape(), |
|  |  | ", but got ", out\_backprop.shape())); |
|  |  |  |
|  |  | TensorFormat transformed\_input\_data\_format = data\_format; |
|  |  |  |
| Expand Down | |  |

5 changes: 0 additions & 5 deletions

5
[tensorflow/core/kernels/pooling\_ops\_common.h](#diff-0edd1d69cbc1e97362a5b7ab14ded8906f486421c2463639f27e8317d125e272 "tensorflow/core/kernels/pooling_ops_common.h")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/core/kernels/pooling_ops_common.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -83,11 +83,6 @@ struct PoolParameters { |
|  |  | TensorFormat data\_format; |
|  |  | }; |
|  |  |  |
|  |  | // Checks if the sizes of the paddings are less than the size of window. |
|  |  | // This is required for MaxPool because it pads with -inf, so the pooling |
|  |  | // window cannot fully cover the padded area. |
|  |  | Status CheckPaddingSize(PoolParameters& params); |
|  |  |  |
|  |  | // An implementation of MaxPooling (forward). |
|  |  | // TODO (yongtang): Remove MaxPoolingOp and use MaxPoolingV2Op, |
|  |  | // QuantizedMaxPoolingOp depends on MaxPoolingOp so keep intact for now |
| Expand Down | |  |

42 changes: 42 additions & 0 deletions

42
[tensorflow/python/kernel\_tests/pooling\_ops\_3d\_test.py](#diff-ebbea3c6c9750c96928ed65bafa40b36e4da7872b94a0ba57ec774950a759554 "tensorflow/python/kernel_tests/pooling_ops_3d_test.py")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/python/kernel_tests/pooling_ops_3d_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,9 +16,13 @@ |
|  |  |  |
|  |  | import numpy as np |
|  |  |  |
|  |  | from tensorflow.python.eager import context |
|  |  | from tensorflow.python.framework import constant\_op |
|  |  | from tensorflow.python.framework import errors |
|  |  | from tensorflow.python.framework import errors\_impl |
|  |  | from tensorflow.python.framework import test\_util |
|  |  | from tensorflow.python.ops import array\_ops |
|  |  | from tensorflow.python.ops import gen\_nn\_ops |
|  |  | from tensorflow.python.ops import gradient\_checker |
|  |  | from tensorflow.python.ops import gradients\_impl |
|  |  | from tensorflow.python.ops import nn\_ops |
| Expand Down  Expand Up | | @@ -515,6 +519,44 @@ def testMaxPool3DZeroPoolSize(self): |
|  |  | pool\_3d = f(input\_tensor, ksize=[2, 2, 0], strides=1, padding="VALID") |
|  |  | self.evaluate(pool\_3d) |
|  |  |  |
|  |  | def testMaxPoolGradEagerShapeErrors(self): |
|  |  | with context.eager\_mode(): |
|  |  | orig\_in = array\_ops.ones((1, 1, 1, 1, 1)) |
|  |  |  |
|  |  | # Test invalid orig\_out shape |
|  |  | orig\_out = array\_ops.ones((1, 1, 1, 1, 2)) |
|  |  | grad = array\_ops.ones((1, 1, 1, 1, 1)) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected orig\_output shape to be \[1,1,1,1,1\], but got " |
|  |  | r"\[1,1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool3d\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1, 1], |
|  |  | strides=[1, 1, 1, 1, 1], padding="VALID") |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected orig\_output shape to be \[1,1,1,1,1\], but got " |
|  |  | r"\[1,1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool3d\_grad\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1, 1], |
|  |  | strides=[1, 1, 1, 1, 1], padding="VALID") |
|  |  |  |
|  |  | # Test invalid grad shape |
|  |  | orig\_out = array\_ops.ones((1, 1, 1, 1, 1)) |
|  |  | grad = array\_ops.ones((1, 1, 1, 1, 2)) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1,1\], but got \[1,1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool3d\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1, 1], |
|  |  | strides=[1, 1, 1, 1, 1], padding="VALID") |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1,1\], but got \[1,1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool3d\_grad\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1, 1], |
|  |  | strides=[1, 1, 1, 1, 1], padding="VALID") |
|  |  |  |
|  |  |  |
|  |  | if \_\_name\_\_ == "\_\_main\_\_": |
|  |  | test.main() |

77 changes: 77 additions & 0 deletions

77
[tensorflow/python/kernel\_tests/pooling\_ops\_test.py](#diff-695549cbf89e37a9a40dec54695789f3c4157e5a06533e3103800c8e4f0aa2a1 "tensorflow/python/kernel_tests/pooling_ops_test.py")

Show comments

[View file](/tensorflow/tensorflow/blob/da4aad5946be30e5f049920fa076e1f7ef021261/tensorflow/python/kernel_tests/pooling_ops_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -618,6 +618,7 @@ def testMaxPoolExplicitPaddingAdvanced(self, \*\*kwargs): |
|  |  |  |
|  |  | @parameterized.parameters( |
|  |  | GetTestConfigsDicts(nn\_ops.max\_pool, nn\_ops.max\_pool\_v2)) |
|  |  | @test\_util.xla\_allow\_fallback("XLA doesn't support explicit padding") |
|  |  | @test\_util.run\_deprecated\_v1 |
|  |  | def testMaxPoolNegativeInputExpPaddingAdv(self, \*\*kwargs): |
|  |  | expected\_output = [-1, -1, -3, -5, -7, -7, -9, -11, -19, -19, -21, -23, -31, |
| Expand Down  Expand Up | | @@ -2390,6 +2391,82 @@ def testExplicitPaddingBatch(self): |
|  |  | explicit\_paddings=[1, 1, 1, 1, 1, 1, 0, 0], |
|  |  | data\_format="NHWC")) |
|  |  |  |
|  |  | def testMaxPoolGradEagerShapeErrors(self): |
|  |  | with context.eager\_mode(): |
|  |  | orig\_in = array\_ops.ones((1, 1, 1, 1)) |
|  |  |  |
|  |  | # Test invalid orig\_out shape |
|  |  | orig\_out = array\_ops.ones((1, 1, 1, 2)) |
|  |  | grad = array\_ops.ones((1, 1, 1, 1)) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected orig\_output shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected orig\_output shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  |  |
|  |  | # Test invalid grad shape |
|  |  | orig\_out = array\_ops.ones((1, 1, 1, 1)) |
|  |  | grad = array\_ops.ones((1, 1, 1, 2)) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_grad( |
|  |  | orig\_in, orig\_out, grad, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  |  |
|  |  | def testMaxPoolGradWithArgmaxEagerShapeErrors(self): |
|  |  | with context.eager\_mode(): |
|  |  | inp = array\_ops.ones((1, 1, 1, 1)) |
|  |  |  |
|  |  | # Test invalid grad shape |
|  |  | grad = array\_ops.ones((1, 1, 1, 2)) |
|  |  | argmax = array\_ops.zeros((1, 1, 1, 1), dtype=dtypes.int64) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_with\_argmax( |
|  |  | inp, grad, argmax, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  | # max\_pool\_grad\_grad\_with\_argmax is only implemented for GPUs |
|  |  | if test.is\_gpu\_available(): |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected grad shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_grad\_with\_argmax( |
|  |  | inp, grad, argmax, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  |  |
|  |  | # Test invalid argmax shape |
|  |  | grad = array\_ops.ones((1, 1, 1, 1)) |
|  |  | argmax = array\_ops.ones((1, 1, 1, 2), dtype=dtypes.int64) |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected argmax shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_with\_argmax( |
|  |  | inp, grad, argmax, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  | # max\_pool\_grad\_grad\_with\_argmax is only implemented for GPUs |
|  |  | if test.is\_gpu\_available(): |
|  |  | with self.assertRaisesRegex( |
|  |  | errors\_impl.InvalidArgumentError, |
|  |  | r"Expected argmax shape to be \[1,1,1,1\], but got \[1,1,1,2\]"): |
|  |  | gen\_nn\_ops.max\_pool\_grad\_grad\_with\_argmax( |
|  |  | inp, grad, argmax, ksize=[1, 1, 1, 1], strides=[1, 1, 1, 1], |
|  |  | padding="VALID") |
|  |  |  |
|  |  |  |
|  |  | def GetMaxPoolFwdTest(input\_size, filter\_size, strides, padding): |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `da4aad5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fda4aad5946be30e5f049920fa076e1f7ef021261) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ceb72db3_20250114_214904.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F579261dcd446385831fe4f7457d802a59685121d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F579261dcd446385831fe4f7457d802a59685121d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/579261dcd446385831fe4f7457d802a59685121d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix crash in MatrixSolve when inputs have different batch dimensions.

[Browse files](/tensorflow/tensorflow/tree/579261dcd446385831fe4f7457d802a59685121d)
Browse the repository at this point in the history

```
Before, the process would crash or certain elements would be silently ignored. Now an InvalidArgument is raised.

PiperOrigin-RevId: 384844020
Change-Id: Iba44417e383bdd0e1abc4012bfca83b2377dd335
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Jul 15, 2021

1 parent
[cd5a9ad](/tensorflow/tensorflow/commit/cd5a9ad1338b01f5fd8ce64ed86ad09bf26468ee)

commit 579261d

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**15 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow

  + core/kernels/linalg

    - tensorflow/core/kernels/linalg/matrix\_solve\_op.cc
      [matrix\_solve\_op.cc](#diff-581021372434dd151274db85a36c47aea8242248b45b65d0aa453e43ce5ac093)
  + python/kernel\_tests

    - tensorflow/python/kernel\_tests/matrix\_solve\_op\_test.py
      [matrix\_solve\_op\_test.py](#diff-4a6755b4a9fac87c489e4536c6471e81e5b4c2d2532250b9e4807c00b16a500f)

## There are no files selected for viewing

11 changes: 9 additions & 2 deletions

11
[tensorflow/core/kernels/linalg/matrix\_solve\_op.cc](#diff-581021372434dd151274db85a36c47aea8242248b45b65d0aa453e43ce5ac093 "tensorflow/core/kernels/linalg/matrix_solve_op.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/579261dcd446385831fe4f7457d802a59685121d/tensorflow/core/kernels/linalg/matrix_solve_op.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -143,15 +143,22 @@ class MatrixSolveOpGpu : public AsyncOpKernel { |
|  |  | done); |
|  |  | OP\_REQUIRES\_ASYNC( |
|  |  | context, input.dim\_size(ndims - 2) == n, |
|  |  | errors::InvalidArgument("Input matrices must be squares, got", |
|  |  | errors::InvalidArgument("Input matrices must be squares, got ", |
|  |  | input.dim\_size(ndims - 2), " != ", n), |
|  |  | done); |
|  |  | OP\_REQUIRES\_ASYNC(context, rhs.dim\_size(ndims - 2) == n, |
|  |  | errors::InvalidArgument( |
|  |  | "Input matrix and right-hand side must have the " |
|  |  | "same number of rows, got", |
|  |  | "same number of rows, got ", |
|  |  | n, " != ", rhs.dim\_size(ndims - 2)), |
|  |  | done); |
|  |  | for (int dim = 0; dim < ndims - 2; dim++) { |
|  |  | OP\_REQUIRES\_ASYNC( |
|  |  | context, input.dim\_size(dim) == rhs.dim\_size(dim), |
|  |  | errors::InvalidArgument( |
|  |  | "All input tensors must have the same outer dimensions."), |
|  |  | done); |
|  |  | } |
|  |  |  |
|  |  | // Allocate output. |
|  |  | Tensor\* output; |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[tensorflow/python/kernel\_tests/matrix\_solve\_op\_test.py](#diff-4a6755b4a9fac87c489e4536c6471e81e5b4c2d2532250b9e4807c00b16a500f "tensorflow/python/kernel_tests/matrix_solve_op_test.py")

Show comments

[View file](/tensorflow/tensorflow/blob/579261dcd446385831fe4f7457d802a59685121d/tensorflow/python/kernel_tests/matrix_solve_op_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,6 +112,12 @@ def testWrongDimensions(self): |
|  |  | with self.assertRaises((ValueError, errors\_impl.InvalidArgumentError)): |
|  |  | self.evaluate(linalg\_ops.matrix\_solve(matrix, rhs)) |
|  |  |  |
|  |  | # The matrix and right-hand side should have the same batch dimensions |
|  |  | matrix = np.random.normal(size=(2, 6, 2, 2)) |
|  |  | rhs = np.random.normal(size=(2, 3, 2, 2)) |
|  |  | with self.assertRaises((ValueError, errors\_impl.InvalidArgumentError)): |
|  |  | self.evaluate(linalg\_ops.matrix\_solve(matrix, rhs)) |
|  |  |  |
|  |  | def testNotInvertible(self): |
|  |  | # The input should be invertible. |
|  |  | with self.assertRaisesOpError("Input matrix is not invertible."): |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `579261d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F579261dcd446385831fe4f7457d802a59685121d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_aa04ee5b_20250114_214906.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F68422b215e618df5ad375bcdc6d2052e9fd3080a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F68422b215e618df5ad375bcdc6d2052e9fd3080a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/68422b215e618df5ad375bcdc6d2052e9fd3080a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add shape checks to GPU TridiagonalMatMul.

[Browse files](/tensorflow/tensorflow/tree/68422b215e618df5ad375bcdc6d2052e9fd3080a)
Browse the repository at this point in the history

```
When given invalid shapes, the GPU TridiagonalMatMul op could read invalid or uninitialized GPU memory.

PiperOrigin-RevId: 401775483
Change-Id: Ib5500aeb8225e50d4ce790b06d2c34751f544ad8
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Oct 8, 2021

1 parent
[c36d5a1](/tensorflow/tensorflow/commit/c36d5a188b78ee4cd5f81218b47eeef20becd06f)

commit 68422b2

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**73 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow

  + core/kernels/linalg

    - tensorflow/core/kernels/linalg/tridiagonal\_matmul\_op\_gpu.cu.cc
      [tridiagonal\_matmul\_op\_gpu.cu.cc](#diff-746fa166e226a1ab5da8259f3bb13afdf4d81a154c8dc9dfb032b4b910fba555)
  + python/kernel\_tests

    - tensorflow/python/kernel\_tests/tridiagonal\_matmul\_op\_test.py
      [tridiagonal\_matmul\_op\_test.py](#diff-ae2f26c5199d43d3a6e4661d59acef698518f63051cf3d96843fe1104a5c42fa)

## There are no files selected for viewing

39 changes: 39 additions & 0 deletions

39
[tensorflow/core/kernels/linalg/tridiagonal\_matmul\_op\_gpu.cu.cc](#diff-746fa166e226a1ab5da8259f3bb13afdf4d81a154c8dc9dfb032b4b910fba555 "tensorflow/core/kernels/linalg/tridiagonal_matmul_op_gpu.cu.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/68422b215e618df5ad375bcdc6d2052e9fd3080a/tensorflow/core/kernels/linalg/tridiagonal_matmul_op_gpu.cu.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -66,6 +66,12 @@ class TridiagonalMatMulOpGpu : public OpKernel { |
|  |  | const Tensor& rhs = context->input(3); |
|  |  |  |
|  |  | const int ndims = rhs.dims(); |
|  |  | OP\_REQUIRES( |
|  |  | context, ndims >= 2, |
|  |  | errors::InvalidArgument("Input must have rank >= 2, but got ", ndims)); |
|  |  | OP\_REQUIRES\_OK(context, ValidateInputTensor(superdiag, "superdiag", rhs)); |
|  |  | OP\_REQUIRES\_OK(context, ValidateInputTensor(maindiag, "maindiag", rhs)); |
|  |  | OP\_REQUIRES\_OK(context, ValidateInputTensor(subdiag, "subdiag", rhs)); |
|  |  | int64 batch\_size = 1; |
|  |  | for (int i = 0; i < ndims - 2; i++) { |
|  |  | batch\_size \*= rhs.dim\_size(i); |
| Expand All | | @@ -85,6 +91,39 @@ class TridiagonalMatMulOpGpu : public OpKernel { |
|  |  | maindiag.flat<Scalar>().data(), subdiag.flat<Scalar>().data(), |
|  |  | rhs.flat<Scalar>().data(), output->flat<Scalar>().data())); |
|  |  | } |
|  |  |  |
|  |  | private: |
|  |  | Status ValidateInputTensor(const Tensor& tensor, |
|  |  | const std::string& tensor\_name, |
|  |  | const Tensor& rhs) { |
|  |  | const int ndims = rhs.dims(); |
|  |  | if (tensor.dims() != ndims) { |
|  |  | return errors::InvalidArgument(tensor\_name, |
|  |  | " must have same rank as rhs, but got ", |
|  |  | tensor.dims(), " and ", ndims); |
|  |  | } |
|  |  | for (int i = 0; i < ndims - 2; i++) { |
|  |  | if (tensor.dim\_size(i) != rhs.dim\_size(i)) { |
|  |  | return errors::InvalidArgument( |
|  |  | tensor\_name, |
|  |  | " must have same outer dimensions as rhs, but for index ", i, |
|  |  | ", got ", tensor.dim\_size(i), " and ", rhs.dim\_size(i)); |
|  |  | } |
|  |  | } |
|  |  | if (tensor.dim\_size(ndims - 2) != 1) { |
|  |  | return errors::InvalidArgument( |
|  |  | tensor\_name, "'s second-to-last dimension must be 1, but got ", |
|  |  | tensor.dim\_size(ndims - 2)); |
|  |  | } |
|  |  | if (tensor.dim\_size(ndims - 1) != rhs.dim\_size(ndims - 2)) { |
|  |  | return errors::InvalidArgument(tensor\_name, |
|  |  | "'s last dimension size must be rhs's " |
|  |  | "second-to-last dimension size, but got ", |
|  |  | tensor.dim\_size(ndims - 1), " and ", |
|  |  | rhs.dim\_size(ndims - 2)); |
|  |  | } |
|  |  | return Status::OK(); |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | REGISTER\_LINALG\_OP\_GPU("TridiagonalMatMul", (TridiagonalMatMulOpGpu<float>), |
| Expand Down | |  |

34 changes: 34 additions & 0 deletions

34
[tensorflow/python/kernel\_tests/tridiagonal\_matmul\_op\_test.py](#diff-ae2f26c5199d43d3a6e4661d59acef698518f63051cf3d96843fe1104a5c42fa "tensorflow/python/kernel_tests/tridiagonal_matmul_op_test.py")

Show comments

[View file](/tensorflow/tensorflow/blob/68422b215e618df5ad375bcdc6d2052e9fd3080a/tensorflow/python/kernel_tests/tridiagonal_matmul_op_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,12 +19,15 @@ |
|  |  | import numpy as np |
|  |  |  |
|  |  | from tensorflow.python.client import session |
|  |  | from tensorflow.python.eager import context |
|  |  | from tensorflow.python.framework import constant\_op |
|  |  | from tensorflow.python.framework import dtypes |
|  |  | from tensorflow.python.framework import errors\_impl |
|  |  | from tensorflow.python.framework import ops |
|  |  | from tensorflow.python.ops import array\_ops |
|  |  | from tensorflow.python.ops import control\_flow\_ops |
|  |  | from tensorflow.python.ops import gradient\_checker\_v2 |
|  |  | from tensorflow.python.ops import linalg\_ops |
|  |  | from tensorflow.python.ops import math\_ops |
|  |  | from tensorflow.python.ops import variables |
|  |  | from tensorflow.python.ops.linalg import linalg\_impl |
| Expand Down  Expand Up | | @@ -175,6 +178,37 @@ def testGradientComplexWithBatches(self): |
|  |  | rhs = self.\_randomComplexArray((b, m, n)) |
|  |  | self.\_gradientTest(diags, rhs, dtype=dtypes.complex128) |
|  |  |  |
|  |  | def \_testErrorWithShapesEager(self, exception\_regex, superdiag\_shape, |
|  |  | maindiag\_shape, subdiag\_shape, rhs\_shape): |
|  |  | with context.eager\_mode(): |
|  |  | superdiag = array\_ops.ones(superdiag\_shape) |
|  |  | maindiag = array\_ops.ones(maindiag\_shape) |
|  |  | subdiag = array\_ops.ones(subdiag\_shape) |
|  |  | rhs = array\_ops.ones(rhs\_shape) |
|  |  | with self.assertRaisesRegex(errors\_impl.InvalidArgumentError, |
|  |  | exception\_regex): |
|  |  | linalg\_ops.tridiagonal\_mat\_mul(superdiag, maindiag, subdiag, rhs) |
|  |  |  |
|  |  | def testInvalidShapesEagerGpu(self): |
|  |  | if not test.is\_gpu\_available(): |
|  |  | self.skipTest('Test requires GPU') |
|  |  | self.\_testErrorWithShapesEager('Input must have rank >= 2, but got ', |
|  |  | [2], [2], [2], [2]) |
|  |  | self.\_testErrorWithShapesEager( |
|  |  | 'superdiag must have same rank as rhs, but got 3 and 2', |
|  |  | [2, 1, 2], [2, 1], [2, 1], [2, 2]) |
|  |  | self.\_testErrorWithShapesEager( |
|  |  | 'maindiag must have same outer dimensions as rhs, but for index 0, got ' |
|  |  | '3 and 2', |
|  |  | [2, 1, 2], [3, 1, 2], [2, 1, 2], [2, 2, 2]) |
|  |  | self.\_testErrorWithShapesEager( |
|  |  | "subdiag's second-to-last dimension must be 1, but got 3", |
|  |  | [2, 1, 2], [2, 1, 2], [2, 3, 2], [2, 2, 2]) |
|  |  | self.\_testErrorWithShapesEager( |
|  |  | "subdiag's last dimension size must be rhs's second-to-last dimension " |
|  |  | "size, but got 3 and 2", |
|  |  | [2, 1, 2], [2, 1, 2], [2, 1, 3], [2, 2, 2]) |
|  |  |  |
|  |  | # Benchmark |
|  |  | class TridiagonalMatMulBenchmark(test.Benchmark): |
|  |  | sizes = [(100000, 1, 1), (1000000, 1, 1), (10000000, 1, 1), (100000, 10, 1), |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `68422b2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F68422b215e618df5ad375bcdc6d2052e9fd3080a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_649aa109_20250114_214909.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-pgcq-h79j-2f69)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-pgcq-h79j-2f69)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

# Incomplete validation of shapes in multiple TF ops

Moderate

[mihaimaruseac](/mihaimaruseac)
published
GHSA-pgcq-h79j-2f69
Nov 4, 2021

## Package

pip

tensorflow, tensorflow-cpu, tensorflow-gpu
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 2.7.0

## Patched versions

2.4.4, 2.5.2, 2.6.1

## Description

### Impact

Several TensorFlow operations are missing validation for the shapes of the tensor arguments involved in the call. Depending on the API, this can result in undefined behavior and segfault or `CHECK`-fail related crashes but in some scenarios writes and reads from heap populated arrays are also possible.

We have discovered these issues internally via tooling while working on improving/testing GPU op determinism. As such, we don't have reproducers and there will be multiple fixes for these issues.

### Patches

We have patched the issue in GitHub commits [68422b215e618df5ad375bcdc6d2052e9fd3080a](https://github.com/tensorflow/tensorflow/commit/68422b215e618df5ad375bcdc6d2052e9fd3080a), [4d74d8a00b07441cba090a02e0dd9ed385145bf4](https://github.com/tensorflow/tensorflow/commit/4d74d8a00b07441cba090a02e0dd9ed385145bf4), [579261dcd446385831fe4f7457d802a59685121d](https://github.com/tensorflow/tensorflow/commit/579261dcd446385831fe4f7457d802a59685121d), [da4aad5946be30e5f049920fa076e1f7ef021261](https://github.com/tensorflow/tensorflow/commit/da4aad5946be30e5f049920fa076e1f7ef021261), [4dddb2fd0b01cdd196101afbba6518658a2c9e07](https://github.com/tensorflow/tensorflow/commit/4dddb2fd0b01cdd196101afbba6518658a2c9e07), and [e7f497570abb6b4ae5af4970620cd880e4c0c904](https://github.com/tensorflow/tensorflow/commit/e7f497570abb6b4ae5af4970620cd880e4c0c904).

These fixes will be included in TensorFlow 2.7.0. We will also cherrypick these commits on TensorFlow 2.6.1, TensorFlow 2.5.2, and TensorFlow 2.4.4, as these are also affected and still in supported range.

### For more information

Please consult [our security guide](https://github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

### Severity

Moderate

### CVE ID

CVE-2021-41206

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_483415ce_20250114_214902.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4d74d8a00b07441cba090a02e0dd9ed385145bf4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4d74d8a00b07441cba090a02e0dd9ed385145bf4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommit%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/4d74d8a00b07441cba090a02e0dd9ed385145bf4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix crash in softmax-xent when some input dimensions are 1.

[Browse files](/tensorflow/tensorflow/tree/4d74d8a00b07441cba090a02e0dd9ed385145bf4)
Browse the repository at this point in the history

```
Before, tf.nn.softmax_cross_entropy_with_logits would fail a CHECK if one input tensor had shape (1, 1) and the other did not.

In particular, the call to ToIndexArray<2> here <https://github.com/tensorflow/tensorflow/blob/1f3da84a89702d3b4f234ee83762d738caffe098/tensorflow/core/kernels/xent_op.cc#L99> would fail, since the call assumed the array had two dimensions. If both dimensions were 1, BCast would merge the two dimensions into a single dimension. Passing fewer_dims_optimization=false stops this optimization

PiperOrigin-RevId: 384844496
Change-Id: Ifb02dc74964132c3ed3f3bc98b0858dbe4e258b7
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Jul 15, 2021

1 parent
[ffae69d](/tensorflow/tensorflow/commit/ffae69dcc556a4a12bc029afb1c4cca6dd56bcad)

commit 4d74d8a

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**18 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow

  + core/kernels

    - tensorflow/core/kernels/xent\_op.cc
      [xent\_op.cc](#diff-f67b5a65bf74681c3ea29a8b7d6c00c26e40dcf243559de5d62c3b0b45a25831)
  + python/kernel\_tests

    - tensorflow/python/kernel\_tests/xent\_op\_test.py
      [xent\_op\_test.py](#diff-ce77c828f5ac1e5ca436c0c31afc58ca967b5f0f70600a6751f44479aba62075)
    - tensorflow/python/kernel\_tests/xent\_op\_test\_base.py
      [xent\_op\_test\_base.py](#diff-a5cbc1d8c03cb323ef052514efdd2a939fe2c3f81722024e42c0448c592d8edd)

## There are no files selected for viewing

23 changes: 8 additions & 15 deletions

23
[tensorflow/core/kernels/xent\_op.cc](#diff-f67b5a65bf74681c3ea29a8b7d6c00c26e40dcf243559de5d62c3b0b45a25831 "tensorflow/core/kernels/xent_op.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/4d74d8a00b07441cba090a02e0dd9ed385145bf4/tensorflow/core/kernels/xent_op.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,7 +46,8 @@ class SoftmaxXentWithLogitsOp : public OpKernel { |
|  |  | TensorShape shape\_in = logits\_in.shape(); |
|  |  |  |
|  |  | BCast bcast(BCast::FromShape(logits\_in.shape()), |
|  |  | BCast::FromShape(labels\_in.shape())); |
|  |  | BCast::FromShape(labels\_in.shape()), |
|  |  | /\*fewer\_dims\_optimization=\*/false); |
|  |  | if (!logits\_in.IsSameSize(labels\_in)) { |
|  |  | OP\_REQUIRES(context, bcast.IsValid(), |
|  |  | errors::InvalidArgument( |
| Expand Down  Expand Up | | @@ -88,20 +89,12 @@ class SoftmaxXentWithLogitsOp : public OpKernel { |
|  |  | {0}, 1, shape\_in, &back\_out)); |
|  |  | if (shape\_in.dim\_size(0) > 0) { |
|  |  | functor::XentFunctor<Device, T> functor; |
|  |  | if (logits\_in.IsSameSize(labels\_in)) { |
|  |  | functor(context->eigen\_device<Device>(), shape\_in.AsEigenDSizes<2>(), |
|  |  | Eigen::array<Eigen::DenseIndex, 2>{1, 1}, |
|  |  | Eigen::array<Eigen::DenseIndex, 2>{1, 1}, logits\_in.matrix<T>(), |
|  |  | labels\_in.matrix<T>(), scratch.matrix<T>(), loss\_out->vec<T>(), |
|  |  | back\_out->matrix<T>()); |
|  |  | } else { |
|  |  | functor(context->eigen\_device<Device>(), shape\_in.AsEigenDSizes<2>(), |
|  |  | BCast::ToIndexArray<2>(bcast.x\_bcast()), |
|  |  | BCast::ToIndexArray<2>(bcast.y\_bcast()), |
|  |  | logits\_in.template shaped<T, 2>(bcast.x\_reshape()), |
|  |  | labels\_in.template shaped<T, 2>(bcast.y\_reshape()), |
|  |  | scratch.matrix<T>(), loss\_out->vec<T>(), back\_out->matrix<T>()); |
|  |  | } |
|  |  | functor(context->eigen\_device<Device>(), shape\_in.AsEigenDSizes<2>(), |
|  |  | BCast::ToIndexArray<2>(bcast.x\_bcast()), |
|  |  | BCast::ToIndexArray<2>(bcast.y\_bcast()), |
|  |  | logits\_in.template shaped<T, 2>(bcast.x\_reshape()), |
|  |  | labels\_in.template shaped<T, 2>(bcast.y\_reshape()), |
|  |  | scratch.matrix<T>(), loss\_out->vec<T>(), back\_out->matrix<T>()); |
|  |  | } |
|  |  | } |
|  |  | }; |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[tensorflow/python/kernel\_tests/xent\_op\_test.py](#diff-ce77c828f5ac1e5ca436c0c31afc58ca967b5f0f70600a6751f44479aba62075 "tensorflow/python/kernel_tests/xent_op_test.py")

Show comments

[View file](/tensorflow/tensorflow/blob/4d74d8a00b07441cba090a02e0dd9ed385145bf4/tensorflow/python/kernel_tests/xent_op_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -63,6 +63,13 @@ def testFeaturesBroadcast(self): |
|  |  | self.assertAllCloseAccordingToType(np\_loss, tf\_loss) |
|  |  | self.assertAllCloseAccordingToType(np\_gradient, tf\_gradient) |
|  |  |  |
|  |  | tf\_f = constant\_op.constant(np.array([[1.]]).astype(np.float32)) |
|  |  | tf\_l = constant\_op.constant(np.array([[1.], [1.]]).astype(np.float32)) |
|  |  | tf\_loss, tf\_gradient = gen\_nn\_ops.softmax\_cross\_entropy\_with\_logits( |
|  |  | tf\_f, tf\_l) |
|  |  | self.assertAllClose([0, 0], tf\_loss) |
|  |  | self.assertAllCloseAccordingToType([[0], [0]], tf\_gradient) |
|  |  |  |
|  |  | @test\_util.run\_deprecated\_v1 |
|  |  | def testNotMatrix(self): |
|  |  | with self.cached\_session(): |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[tensorflow/python/kernel\_tests/xent\_op\_test\_base.py](#diff-a5cbc1d8c03cb323ef052514efdd2a939fe2c3f81722024e42c0448c592d8edd "tensorflow/python/kernel_tests/xent_op_test_base.py")

Show comments

[View file](/tensorflow/tensorflow/blob/4d74d8a00b07441cba090a02e0dd9ed385145bf4/tensorflow/python/kernel_tests/xent_op_test_base.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -151,6 +151,9 @@ def \_testLabelsBroadcast(self, uniform\_labels\_gradient): |
|  |  | labels = np.array([[0., 0., 0., 1.]]).astype(np.float16) |
|  |  | logits = np.array([[1., 1., 1., 1.], [1., 2., 3., 4.]]).astype(np.float16) |
|  |  | self.\_testXent2D(labels, logits, with\_placeholders=True) |
|  |  | labels = np.array([[1.]]).astype(np.float16) |
|  |  | logits = np.array([[1.], [2.]]).astype(np.float16) |
|  |  | self.\_testXent2D(labels, logits, with\_placeholders=True) |
|  |  | labels = np.array([[0.], [2.], [0.25]]).astype(np.float16) |
|  |  | logits = np.array([[1., 1., 1., 1.], [1., 2., 3., 4.], |
|  |  | [1., 2., 3., 4.]]).astype(np.float16) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4d74d8a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4d74d8a00b07441cba090a02e0dd9ed385145bf4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8433aa84_20250114_214903.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4dddb2fd0b01cdd196101afbba6518658a2c9e07)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4dddb2fd0b01cdd196101afbba6518658a2c9e07)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  827](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/4dddb2fd0b01cdd196101afbba6518658a2c9e07)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix segfault in pools on empty shapes when certain dimension were ver…

[Browse files](/tensorflow/tensorflow/tree/4dddb2fd0b01cdd196101afbba6518658a2c9e07)
Browse the repository at this point in the history

```
…y large.

Pooling ops multiply certain components of the input shape, e.g. by multiplying input.shape[1] * input.shape[2] * input.shape[3]. This multiplication could overflow an int64 value if shape[0] was 0 but shape[1], shape[2], and shape[3] were very large, e.g. by passing an input with shape (0, 2**25, 2**25, 2**25).

PiperOrigin-RevId: 404644978
Change-Id: Ic79f89c970357ca2962b1f231449066db9403146
```

* Loading branch information

[![@reedwm](https://avatars.githubusercontent.com/u/6510203?s=40&v=4)](/reedwm) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[reedwm](/tensorflow/tensorflow/commits?author=reedwm "View all commits by reedwm")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Oct 20, 2021

1 parent
[b84cc9a](/tensorflow/tensorflow/commit/b84cc9a4abd7d087653b430d26579d2d1fe3c6e9)

commit 4dddb2f

Showing
**1 changed file**
with
**9 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

9 changes: 9 additions & 0 deletions

9
[tensorflow/core/kernels/pooling\_ops\_common.h](#diff-0edd1d69cbc1e97362a5b7ab14ded8906f486421c2463639f27e8317d125e272 "tensorflow/core/kernels/pooling_ops_common.h")

Show comments

[View file](/tensorflow/tensorflow/blob/4dddb2fd0b01cdd196101afbba6518658a2c9e07/tensorflow/core/kernels/pooling_ops_common.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -189,6 +189,9 @@ class MaxPoolingOp : public OpKernel { |
|  |  | void SpatialMaxPool(OpKernelContext\* context, Tensor\* output, |
|  |  | const Tensor& tensor\_in, const PoolParameters& params, |
|  |  | const Padding& padding) { |
|  |  | if (output->NumElements() == 0) { |
|  |  | return; |
|  |  | } |
|  |  | // On GPU, use Eigen's Spatial Max Pooling. On CPU, use an |
|  |  | // EigenMatrix version that is currently faster than Eigen's |
|  |  | // Spatial MaxPooling implementation. |
| Expand Down  Expand Up | | @@ -443,6 +446,9 @@ class MaxPoolingV2Op : public OpKernel { |
|  |  | void SpatialMaxPool(OpKernelContext\* context, Tensor\* output, |
|  |  | const Tensor& tensor\_in, const PoolParameters& params, |
|  |  | const Padding& padding) { |
|  |  | if (output->NumElements() == 0) { |
|  |  | return; |
|  |  | } |
|  |  | // On GPU, use Eigen's Spatial Max Pooling. On CPU, use an |
|  |  | // EigenMatrix version that is currently faster than Eigen's |
|  |  | // Spatial MaxPooling implementation. |
| Expand Down  Expand Up | | @@ -561,6 +567,9 @@ template <typename Device, typename T> |
|  |  | void SpatialAvgPool(OpKernelContext\* context, Tensor\* output, |
|  |  | const Tensor& input, const PoolParameters& params, |
|  |  | const Padding& padding) { |
|  |  | if (output->NumElements() == 0) { |
|  |  | return; |
|  |  | } |
|  |  | typedef Eigen::Map<const Eigen::Matrix<T, Eigen::Dynamic, Eigen::Dynamic>> |
|  |  | ConstEigenMatrixMap; |
|  |  | typedef Eigen::Map<Eigen::Matrix<T, Eigen::Dynamic, Eigen::Dynamic>> |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4dddb2f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F4dddb2fd0b01cdd196101afbba6518658a2c9e07) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


