=== Content from github.com_dfdaca53_20250115_134016.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16841)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16841)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=RIOT-OS%2FRIOT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RIOT-OS](/RIOT-OS)
/
**[RIOT](/RIOT-OS/RIOT)**
Public

* [Notifications](/login?return_to=%2FRIOT-OS%2FRIOT) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2FRIOT-OS%2FRIOT)
* [Star
   5.4k](/login?return_to=%2FRIOT-OS%2FRIOT)

* [Code](/RIOT-OS/RIOT)
* [Issues
  382](/RIOT-OS/RIOT/issues)
* [Pull requests
  387](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects
  0](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

Additional navigation options

* [Code](/RIOT-OS/RIOT)
* [Issues](/RIOT-OS/RIOT/issues)
* [Pull requests](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# net/ieee802154\_security doc: Shape security expectations #16841

 Merged

[chrysn](/chrysn)
merged 1 commit into
[RIOT-OS:master](/RIOT-OS/RIOT/tree/master "RIOT-OS/RIOT:master")
from
[chrysn-pull-requests:802154-security-expectations](/chrysn-pull-requests/RIOT/tree/802154-security-expectations "chrysn-pull-requests/RIOT:802154-security-expectations")

Sep 13, 2021

 Merged

# [net/ieee802154\_security doc: Shape security expectations](#top) #16841

[chrysn](/chrysn)
merged 1 commit into
[RIOT-OS:master](/RIOT-OS/RIOT/tree/master "RIOT-OS/RIOT:master")
from
[chrysn-pull-requests:802154-security-expectations](/chrysn-pull-requests/RIOT/tree/802154-security-expectations "chrysn-pull-requests/RIOT:802154-security-expectations")

Sep 13, 2021

[Conversation
1](/RIOT-OS/RIOT/pull/16841)
[Commits
1](/RIOT-OS/RIOT/pull/16841/commits)
[Checks
0](/RIOT-OS/RIOT/pull/16841/checks)
[Files changed](/RIOT-OS/RIOT/pull/16841/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![chrysn](https://avatars.githubusercontent.com/u/442326?s=60&v=4)](/chrysn)

Copy link

Member

### @chrysn **[chrysn](/chrysn)** commented [Sep 12, 2021](#issue-994217991) • edited Loading

### Contribution description

The security module introduced in [#15150](https://github.com/RIOT-OS/RIOT/pull/15150) was, in my understanding, not intended for security critical use ("waives to use a proper key store to mitigate complexity"), but that didn't come across clearly in the documentation, and might thus give wrong impressions.

### Testing procedure

* Doc only change: Look at the new infobox in ~~ieee802154\_\_security\_8h.html~~ group\_\_net\_\_ieee802154\_\_security.html of the built documentation.

### Issues/PRs references

[#15150](https://github.com/RIOT-OS/RIOT/pull/15150) was where the module was introduced

[edit: Hotfixed after I found that the box wound up in the header file and not the module description]

Sorry, something went wrong.

All reactions

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
[Area: network](/RIOT-OS/RIOT/labels/Area%3A%20network)
Area: Networking
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System
labels
[Sep 12, 2021](#event-5289434468)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
added
[Area: doc](/RIOT-OS/RIOT/labels/Area%3A%20doc)
Area: Documentation
[Area: security](/RIOT-OS/RIOT/labels/Area%3A%20security)
Area: Security-related libraries and subsystems
[Type: enhancement](/RIOT-OS/RIOT/labels/Type%3A%20enhancement)
The issue suggests enhanceable parts / The PR enhances parts of the codebase / documentation
[CI: ready for build](/RIOT-OS/RIOT/labels/CI%3A%20ready%20for%20build)
If set, CI server will compile all applications for all available boards for the labeled PR
and removed
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System
labels
[Sep 12, 2021](#event-5289434770)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)

`[net/ieee802154_security doc: Shape security expectations](/RIOT-OS/RIOT/pull/16841/commits/5710d5ff340754a1f4df510dacbbe84fe1ac1446 "net/ieee802154_security doc: Shape security expectations")`

`[5710d5f](/RIOT-OS/RIOT/pull/16841/commits/5710d5ff340754a1f4df510dacbbe84fe1ac1446)`

 [![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
[force-pushed](/RIOT-OS/RIOT/compare/73b66fea745365cc2261ba1341233736f8cb54c4..5710d5ff340754a1f4df510dacbbe84fe1ac1446)
the
802154-security-expectations

branch
from
[`73b66fe`](/RIOT-OS/RIOT/commit/73b66fea745365cc2261ba1341233736f8cb54c4) to
[`5710d5f`](/RIOT-OS/RIOT/commit/5710d5ff340754a1f4df510dacbbe84fe1ac1446)  [Compare](/RIOT-OS/RIOT/compare/73b66fea745365cc2261ba1341233736f8cb54c4..5710d5ff340754a1f4df510dacbbe84fe1ac1446)
[September 12, 2021 18:20](#event-5289462405)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System
and removed
[Area: doc](/RIOT-OS/RIOT/labels/Area%3A%20doc)
Area: Documentation
labels
[Sep 12, 2021](#event-5289462603)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
added
the
[Area: doc](/RIOT-OS/RIOT/labels/Area%3A%20doc)
Area: Documentation
label
[Sep 12, 2021](#event-5289463108)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Sep 12, 2021](#issuecomment-917706951)

| [Deep CI link to the changed spot in the documentation](https://11808-7370241-gh.circle-artifacts.com/0/doc/group__net__ieee802154__security.html) |
| --- |

All reactions

Sorry, something went wrong.

 [![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
requested review from
[benpicco](/benpicco),
[jia200x](/jia200x) and
[maribu](/maribu)
[September 12, 2021 20:43](#event-5289580963)

[![maribu](https://avatars.githubusercontent.com/u/2041729?s=60&v=4)](/maribu)

**[maribu](/maribu)**
approved these changes
[Sep 13, 2021](#pullrequestreview-752318748)

 [View reviewed changes](/RIOT-OS/RIOT/pull/16841/files/5710d5ff340754a1f4df510dacbbe84fe1ac1446)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
merged commit [`88de3c3`](/RIOT-OS/RIOT/commit/88de3c3d312f7e77a9f4e1704a532f68740445a1)
into
RIOT-OS:master

[Sep 13, 2021](https://github.com/RIOT-OS/RIOT/pull/16841#event-5290526628)

 [![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
deleted the
802154-security-expectations

branch
[September 13, 2021 05:45](#event-5290528228)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
mentioned this pull request
[Sep 14, 2021](#ref-issue-995683197)

[ieee802154\_security: Nonce is reused after reboot
#16844](/RIOT-OS/RIOT/issues/16844)

Open

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=40&v=4)](/benpicco)
[benpicco](/benpicco)
added this to the [Release 2021.10](/RIOT-OS/RIOT/milestone/36) milestone
[Oct 20, 2021](#event-5491918280)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16841)

Reviewers

[![@maribu](https://avatars.githubusercontent.com/u/2041729?s=40&v=4)](/maribu) [maribu](/maribu)

maribu approved these changes

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=40&v=4)](/benpicco) [benpicco](/benpicco)

 Awaiting requested review from benpicco

[![@jia200x](https://avatars.githubusercontent.com/u/1260616?s=40&v=4)](/jia200x) [jia200x](/jia200x)

 Awaiting requested review from jia200x

Assignees

No one assigned

Labels

[Area: doc](/RIOT-OS/RIOT/labels/Area%3A%20doc)
Area: Documentation
[Area: network](/RIOT-OS/RIOT/labels/Area%3A%20network)
Area: Networking
[Area: security](/RIOT-OS/RIOT/labels/Area%3A%20security)
Area: Security-related libraries and subsystems
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System
[CI: ready for build](/RIOT-OS/RIOT/labels/CI%3A%20ready%20for%20build)
If set, CI server will compile all applications for all available boards for the labeled PR
[Type: enhancement](/RIOT-OS/RIOT/labels/Type%3A%20enhancement)
The issue suggests enhanceable parts / The PR enhances parts of the codebase / documentation

Projects

None yet

Milestone

 [**Release 2021.10**](/RIOT-OS/RIOT/milestone/36 "Release 2021.10")

Development

Successfully merging this pull request may close these issues.

3 participants

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=52&v=4)](/chrysn) [![@maribu](https://avatars.githubusercontent.com/u/2041729?s=52&v=4)](/maribu) [![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=52&v=4)](/benpicco)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.rfc-editor.org_a9ba5859_20250115_134020.html ===

[[RFC Home](https://www.rfc-editor.org "RFC Editor")] [[TEXT](/rfc/rfc8180.txt)|[PDF](/rfc/pdfrfc/rfc8180.txt.pdf)|[HTML](/rfc/rfc8180.html)] [[Tracker](https://datatracker.ietf.org/doc/rfc8180 "IETF Datatracker information for this document")] [[IPR](https://datatracker.ietf.org/ipr/search/?rfc=8180&submit=rfc "IPR disclosures related to this document")] [[Errata](/errata/rfc8180)] [[Info page](https://www.rfc-editor.org/info/rfc8180 "Info page")]

 BEST CURRENT PRACTICE
 Errata Exist
```
Internet Engineering Task Force (IETF)                X. Vilajosana, Ed.
Request for Comments: 8180               Universitat Oberta de Catalunya
BCP: 210                                                       K. Pister
Category: Best Current Practice        University of California Berkeley
ISSN: 2070-1721                                              T. Watteyne
                                                          Analog Devices
                                                                May 2017

Minimal IPv6 over the TSCH Mode of IEEE 802.15.4e (6TiSCH) Configuration

Abstract

   This document describes a minimal mode of operation for an IPv6 over
   the TSCH mode of IEEE 802.15.4e (6TiSCH) network.  This minimal mode
   of operation specifies the baseline set of protocols that need to be
   supported and the recommended configurations and modes of operation
   sufficient to enable a 6TiSCH functional network.  6TiSCH provides
   IPv6 connectivity over a Time-Slotted Channel Hopping (TSCH) mesh
   composed of IEEE Std 802.15.4 TSCH links.  This minimal mode uses a
   collection of protocols with the respective configurations, including
   the IPv6 Low-Power Wireless Personal Area Network (6LoWPAN)
   framework, enabling interoperable IPv6 connectivity over IEEE Std
   802.15.4 TSCH.  This minimal configuration provides the necessary
   bandwidth for network and security bootstrapping and defines the
   proper link between the IETF protocols that interface to IEEE Std
   802.15.4 TSCH.  This minimal mode of operation should be implemented
   by all 6TiSCH-compliant devices.

Status of This Memo

   This memo documents an Internet Best Current Practice.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   BCPs is available in [Section 2 of RFC 7841](./rfc7841#section-2).

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   [http://www.rfc-editor.org/info/rfc8180](https://www.rfc-editor.org/info/rfc8180).

Vilajosana, et al.        Best Current Practice                 [Page 1]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to [BCP 78](https://www.rfc-editor.org/bcp/bcp78) and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<http://trustee.ietf.org/license-info>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Vilajosana, et al.        Best Current Practice                 [Page 2]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

Table of Contents

   [1](#section-1).  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   [4](#page-4)
   [2](#section-2).  Requirements Language . . . . . . . . . . . . . . . . . . . .   [4](#page-4)
   [3](#section-3).  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   [5](#page-5)
   [4](#section-4).  IEEE Std 802.15.4 Settings  . . . . . . . . . . . . . . . . .   [5](#page-5)
     [4.1](#section-4.1).  TSCH Schedule . . . . . . . . . . . . . . . . . . . . . .   [6](#page-6)
     [4.2](#section-4.2).  Cell Options  . . . . . . . . . . . . . . . . . . . . . .   [8](#page-8)
     [4.3](#section-4.3).  Retransmissions . . . . . . . . . . . . . . . . . . . . .   [8](#page-8)
     [4.4](#section-4.4).  Timeslot Timing . . . . . . . . . . . . . . . . . . . . .   [8](#page-8)
     [4.5](#section-4.5).  Frame Contents  . . . . . . . . . . . . . . . . . . . . .   [8](#page-8)
       [4.5.1](#section-4.5.1).  IEEE Std 802.15.4 Header  . . . . . . . . . . . . . .   [8](#page-8)
       [4.5.2](#section-4.5.2).  Enhanced Beacon Frame . . . . . . . . . . . . . . . .   [9](#page-9)
       [4.5.3](#section-4.5.3).  Acknowledgment Frame  . . . . . . . . . . . . . . . .  [10](#page-10)
     [4.6](#section-4.6).  Link-Layer Security . . . . . . . . . . . . . . . . . . .  [10](#page-10)
   [5](#section-5).  RPL Settings  . . . . . . . . . . . . . . . . . . . . . . . .  [11](#page-11)
     [5.1](#section-5.1).  Objective Function  . . . . . . . . . . . . . . . . . . .  [11](#page-11)
       [5.1.1](#section-5.1.1).  Rank Computation  . . . . . . . . . . . . . . . . . .  [11](#page-11)
       [5.1.2](#section-5.1.2).  Rank Computation Example  . . . . . . . . . . . . . .  [13](#page-13)
     [5.2](#section-5.2).  Mode of Operation . . . . . . . . . . . . . . . . . . . .  [14](#page-14)
     [5.3](#section-5.3).  Trickle Timer . . . . . . . . . . . . . . . . . . . . . .  [14](#page-14)
     [5.4](#section-5.4).  Packet Contents . . . . . . . . . . . . . . . . . . . . .  [14](#page-14)
   [6](#section-6).  Network Formation and Lifetime  . . . . . . . . . . . . . . .  [14](#page-14)
     [6.1](#section-6.1).  Value of the Join Metric Field  . . . . . . . . . . . . .  [14](#page-14)
     [6.2](#section-6.2).  Time-Source Neighbor Selection  . . . . . . . . . . . . .  [15](#page-15)
     [6.3](#section-6.3).  When to Start Sending EBs . . . . . . . . . . . . . . . .  [15](#page-15)
     [6.4](#section-6.4).  Hysteresis  . . . . . . . . . . . . . . . . . . . . . . .  [15](#page-15)
   [7](#section-7).  Implementation Recommendations  . . . . . . . . . . . . . . .  [16](#page-16)
     [7.1](#section-7.1).  Neighbor Table  . . . . . . . . . . . . . . . . . . . . .  [16](#page-16)
     [7.2](#section-7.2).  Queues and Priorities . . . . . . . . . . . . . . . . . .  [16](#page-16)
     [7.3](#section-7.3).  Recommended Settings  . . . . . . . . . . . . . . . . . .  [17](#page-17)
   [8](#section-8).  Security Considerations . . . . . . . . . . . . . . . . . . .  [17](#page-17)
   [9](#section-9).  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  [19](#page-19)
   [10](#section-10). References  . . . . . . . . . . . . . . . . . . . . . . . . .  [19](#page-19)
     [10.1](#section-10.1).  Normative References . . . . . . . . . . . . . . . . . .  [19](#page-19)
     [10.2](#section-10.2).  Informative References . . . . . . . . . . . . . . . . .  [21](#page-21)
   [Appendix A](#appendix-A).  Examples . . . . . . . . . . . . . . . . . . . . . .  [23](#page-23)
     [A.1](#appendix-A.1).  Example: EB with Default Timeslot Template  . . . . . . .  [23](#page-23)
     [A.2](#appendix-A.2).  Example: EB with Custom Timeslot Template . . . . . . . .  [25](#page-25)
     [A.3](#appendix-A.3).  Example: Link-layer Acknowledgment  . . . . . . . . . . .  [27](#page-27)
     [A.4](#appendix-A.4).  Example: Auxiliary Security Header  . . . . . . . . . . .  [27](#page-27)
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  [28](#page-28)
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  [28](#page-28)

Vilajosana, et al.        Best Current Practice                 [Page 3]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[1](#section-1).  Introduction

   A 6TiSCH network provides IPv6 connectivity [[RFC2460](./rfc2460 "\"Internet Protocol, Version 6 (IPv6) Specification\"")] over a Time-
   Slotted Channel Hopping (TSCH) mesh [[RFC7554](./rfc7554 "\"Using IEEE 802.15.4e Time-Slotted Channel Hopping (TSCH) in the Internet of Things (IoT): Problem Statement\"")] composed of IEEE Std
   802.15.4 TSCH links [[IEEE.802.15.4](#ref-IEEE.802.15.4)].  IPv6 connectivity is obtained
   by the use of the 6LoWPAN framework ([[RFC4944](./rfc4944 "\"Transmission of IPv6 Packets over IEEE 802.15.4 Networks\"")], [[RFC6282](./rfc6282 "\"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks\"")],
   [[RFC8025](./rfc8025 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Paging Dispatch\"")],[[RFC8138](./rfc8138 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Routing Header\"")], and [[RFC6775](./rfc6775 "\"Neighbor Discovery Optimization for IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs)\"")]), RPL [[RFC6550](./rfc6550 "\"RPL: IPv6 Routing Protocol for Low-Power and Lossy Networks\"")], and the RPL
   Objective Function 0 (OF0) [[RFC6552](./rfc6552 "\"Objective Function Zero for the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")].

   This specification defines operational parameters and procedures for
   a minimal mode of operation to build a 6TiSCH network.  Any 6TiSCH-
   compliant device should implement this mode of operation.  This
   operational parameter configuration provides the necessary bandwidth
   for nodes to bootstrap the network.  The bootstrap process includes
   initial network configuration and security bootstrapping.  In this
   specification, the 802.15.4 TSCH mode, the 6LoWPAN framework, RPL
   [[RFC6550](./rfc6550 "\"RPL: IPv6 Routing Protocol for Low-Power and Lossy Networks\"")], and the RPL Objective Function 0 (OF0) [[RFC6552](./rfc6552 "\"Objective Function Zero for the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")] are used
   unmodified.  Parameters and particular operations of TSCH are
   specified to guarantee interoperability between nodes in a 6TiSCH
   network.

   In a 6TiSCH network, nodes follow a communication schedule as per
   802.15.4 TSCH.  Nodes learn the communication schedule upon joining
   the network.  When following this specification, the learned schedule
   is the same for all nodes and does not change over time.  Future
   specifications may define mechanisms for dynamically managing the
   communication schedule.  Dynamic scheduling solutions are out of
   scope of this document.

   IPv6 addressing and compression are achieved by the 6LoWPAN
   framework.  The framework includes [[RFC4944](./rfc4944 "\"Transmission of IPv6 Packets over IEEE 802.15.4 Networks\"")], [[RFC6282](./rfc6282 "\"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks\"")], [[RFC8025](./rfc8025 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Paging Dispatch\"")],
   the 6LoWPAN Routing Header dispatch [[RFC8138](./rfc8138 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Routing Header\"")] for addressing and
   header compression, and [[RFC6775](./rfc6775 "\"Neighbor Discovery Optimization for IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs)\"")] for Duplicate Address Detection
   (DAD) and address resolution.

   More advanced work is expected in the future to complement the
   minimal configuration with dynamic operations that can adapt the
   schedule to the needs of the traffic at run time.

[2](#section-2).  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in [BCP](https://www.rfc-editor.org/bcp/bcp14)
   [14](https://www.rfc-editor.org/bcp/bcp14) [[RFC2119](./rfc2119 "\"Key words for use in RFCs to Indicate Requirement Levels\"")] [[RFC8174](./rfc8174 "\"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words\"")] when, and only when, they appear in all
   capitals, as shown here.

Vilajosana, et al.        Best Current Practice                 [Page 4]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[3](#section-3).  Terminology

   This document uses terminology from [[TERMS-6TiSCH](#ref-TERMS-6TiSCH)].  The following
   concepts are used in this document:

   802.15.4:  We use "802.15.4" as a short version of "IEEE Std
      802.15.4" in this document.

   SFD:  Start of Frame Delimiter

   RX:  Reception

   TX:  Transmission

   IE:  Information Element

   EB:  Enhanced Beacon

   ASN:  Absolute Slot Number

   Join Metric:  Field in the TSCH Synchronization IE representing the
      topological distance between the node sending the EB and the PAN
      coordinator.

   PAN:  Personal Area Network

   MLME:  MAC Layer Management Entity

[4](#section-4).  IEEE Std 802.15.4 Settings

   An implementation compliant with this specification MUST implement
   IEEE Std 802.15.4 [[IEEE.802.15.4](#ref-IEEE.802.15.4)] in Time-Slotted Channel Hopping
   (TSCH) mode.

   The remainder of this section details the RECOMMENDED TSCH settings,
   which are summarized in Figure 1.  Any of the properties marked in
   the EB column are announced in the EBs the nodes send [[IEEE.802.15.4](#ref-IEEE.802.15.4)]
   and learned by those joining the network.  Changing their value means
   changing the contents of the EB.

   In case of discrepancy between the values in this specification and
   IEEE Std 802.15.4 [[IEEE.802.15.4](#ref-IEEE.802.15.4)], the IEEE standard has precedence.

Vilajosana, et al.        Best Current Practice                 [Page 5]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   +--------------------------------+------------------------------+---+
   |           Property             |     Recommended Setting      |EB*|
   +--------------------------------+------------------------------+---+
   | Slotframe Size                 | Tunable. Trades off          | X |
   |                                | bandwidth against energy.    |   |
   +--------------------------------+------------------------------+---+
   | Number of scheduled cells**    | 1                            | X |
   | (active)                       | Timeslot        0x0000       |   |
   |                                | Channel Offset  0x0000       |   |
   |                                | Link Options = (TX Link = 1, |   |
   |                                | RX Link = 1, Shared Link = 1,|   |
   |                                | Timekeeping = 1)             |   |
   +--------------------------------+------------------------------+---+
   | Number of unscheduled cells    | All remaining cells in the   | X |
   | (off)                          | slotframe.                   |   |
   +--------------------------------+------------------------------+---+
   | Max Number MAC retransmissions | 3 (4 transmission attempts)  |   |
   +--------------------------------+------------------------------+---+
   | Timeslot template              | IEEE Std 802.15.4 default    | X |
   |                                | (macTimeslotTemplateId=0)    |   |
   +--------------------------------+------------------------------+---+
   | Enhanced Beacon Period         | Tunable. Trades off join     |   |
   | (EB_PERIOD)                    | time against energy.         |   |
   +--------------------------------+------------------------------+---+
   | Number used frequencies        | IEEE Std 802.15.4 default    | X |
   | (2.4 GHz O-QPSK PHY)           | (16)                         |   |
   +--------------------------------+------------------------------+---+
   | Channel Hopping sequence       | IEEE Std 802.15.4 default    | X |
   | (2.4 GHz O-QPSK PHY)           | (macHoppingSequenceID = 0)   |   |
   +--------------------------------+------------------------------+---+
     * An "X" in this column means this property's value is announced
       in the EB; hence, a new node learns it when joining.
    ** This cell LinkType is set to ADVERTISING.

           Figure 1: Recommended IEEE Std 802.15.4 TSCH Settings

[4.1](#section-4.1).  TSCH Schedule

   This minimal mode of operation uses a single slotframe.  The TSCH
   slotframe is composed of a tunable number of timeslots.  The
   slotframe size (i.e., the number of timeslots it contains) trades off
   bandwidth for energy consumption.  The slotframe size needs to be
   tuned; the way of tuning it is out of scope of this specification.
   The slotframe size is announced in the EB.  The RECOMMENDED value for
   the slotframe handle (macSlotframeHandle) is 0x00.  An implementation
   MAY choose to use a different slotframe handle, for example, to add
   other slotframes with higher priority.  The use of other slotframes
   is out of the scope of this document.

Vilajosana, et al.        Best Current Practice                 [Page 6]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   There is only a single scheduled cell in the slotframe.  This cell
   MAY be scheduled at any slotOffset/channelOffset within the
   slotframe.  The location of that cell in the schedule is announced in
   the EB.  The LinkType of the scheduled cell is ADVERTISING to allow
   EBs to be sent on it.

   Figure 2 shows an example of a slotframe of length 101 timeslots,
   resulting in a radio duty cycle below 0.99%.

      Chan.  +----------+----------+          +----------+
      Off.0  | TxRxS/EB |   OFF    |          |   OFF    |
      Chan.  +----------+----------+          +----------+
      Off.1  |   OFF    |   OFF    |   ...    |   OFF    |
             +----------+----------+          +----------+
                 .
                 .
                 .
      Chan.  +----------+----------+          +----------+
      Off.15 |   OFF    |   OFF    |          |   OFF    |
             +----------+----------+          +----------+

   slotOffset     0          1                    100

   EB:  Enhanced Beacon
   Tx:  Transmit
   Rx:  Receive
   S:   Shared
   OFF: Unscheduled by this specification

            Figure 2: Example Slotframe of Length 101 Timeslots

   A node MAY use the scheduled cell to transmit/receive all types of
   link-layer frames.  EBs are sent to the link-layer broadcast address
   and are not acknowledged.  Data frames are sent unicast and are
   acknowledged by the receiving neighbor.

   All remaining cells in the slotframe are unscheduled.  Dynamic
   scheduling solutions may be defined in the future that schedule those
   cells.  One example is the 6top Protocol (6P) [[PROTO-6P](#ref-PROTO-6P)].  Dynamic
   scheduling solutions are out of scope of this document.

   The default values of the TSCH timeslot template (defined in
   Section 8.4.2.2.3 of [[IEEE.802.15.4](#ref-IEEE.802.15.4)]) and channel hopping sequence
   (defined in Section 6.2.10 of [[IEEE.802.15.4](#ref-IEEE.802.15.4)]) SHOULD be used.  A
   node MAY use different values by properly announcing them in its EB.

Vilajosana, et al.        Best Current Practice                 [Page 7]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[4.2](#section-4.2).  Cell Options

   In the scheduled cell, a node transmits if there is a packet to
   transmit and listens otherwise (both "TX" and "RX" bits are set).
   When a node transmits, requesting a link-layer acknowledgment per
   [[IEEE.802.15.4](#ref-IEEE.802.15.4)], and does not receive the requested acknowledgement,
   it uses a back-off mechanism to resolve possible collisions ("Shared"
   bit is set).  A node joining the network maintains time
   synchronization to its initial time-source neighbor using that cell
   ("Timekeeping" bit is set).

   This translates into a Link Option for this cell:

      b0 = TX Link = 1 (set)
      b1 = RX Link = 1 (set)
      b2 = Shared Link = 1 (set)
      b3 = Timekeeping = 1 (set)
      b4 = Priority = 0 (clear)
      b5-b7 = Reserved = 0 (clear)

[4.3](#section-4.3).  Retransmissions

   Per Figure 1, the RECOMMENDED maximum number of link-layer
   retransmissions is 3.  This means that, for packets requiring an
   acknowledgment, if none are received after a total of 4 attempts, the
   transmission is considered failed and the link layer MUST notify the
   upper layer.  Packets not requiring an acknowledgment (including EBs)
   are not retransmitted.

[4.4](#section-4.4).  Timeslot Timing

   Per Figure 1, the RECOMMENDED timeslot template is the default one
   (macTimeslotTemplateId=0) defined in [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

[4.5](#section-4.5).  Frame Contents

   [IEEE.802.15.4] defines the format of frames.  Through a set of
   flags, [[IEEE.802.15.4](#ref-IEEE.802.15.4)] allows for several fields to be present (or
   not), to have different lengths, and to have different values.  This
   specification details the RECOMMENDED contents of 802.15.4 frames,
   while strictly complying with [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

[4.5.1](#section-4.5.1).  IEEE Std 802.15.4 Header

   The Frame Version field MUST be set to 0b10 (Frame Version 2).  The
   Sequence Number field MAY be elided.

Vilajosana, et al.        Best Current Practice                 [Page 8]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   The EB Destination Address field MUST be set to 0xFFFF (short
   broadcast address).  The EB Source Address field SHOULD be set as the
   node's short address if this is supported.  Otherwise, the long
   address MUST be used.

   The PAN ID Compression bit SHOULD indicate that the Source PAN ID is
   "Not Present" and the Destination PAN ID is "Present".  The value of
   the PAN ID Compression bit is specified in Table 7-2 of the IEEE Std
   802.15.4-2015 specification and depends on the type of the
   destination and source link-layer addresses (e.g., short, extended,
   not present).

   Nodes follow the reception and rejection rules as per Section 6.7.2
   of [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

   The nonce is formatted according to [[IEEE.802.15.4](#ref-IEEE.802.15.4)].  In the IEEE Std
   802.15.4 specification [[IEEE.802.15.4](#ref-IEEE.802.15.4)], nonce generation is described
   in [Section 9.3.2.2](#section-9.3.2.2), and byte ordering is described in [Section 9.3.1](#section-9.3.1),
   Annex B.2, and Annex B.2.2.

[4.5.2](#section-4.5.2).  Enhanced Beacon Frame

   After booting, a TSCH node starts in an unsynchronized, unjoined
   state.  Initial synchronization is achieved by listening for EBs.
   EBs from multiple networks may be heard.  Many mechanisms exist for
   discrimination between networks, the details of which are out of
   scope.

   The IEEE Std 802.15.4 specification does not define how often EBs are
   sent, nor their contents [[IEEE.802.15.4](#ref-IEEE.802.15.4)].  In a minimal TSCH
   configuration, a node SHOULD send an EB every EB_PERIOD.  Tuning
   EB_PERIOD allows a trade-off between joining time and energy
   consumption.

   EBs should be used to obtain information about local networks and to
   synchronize ASN and time offset of the specific network that the node
   decides to join.  Once joined to a particular network, a node MAY
   choose to continue to listen for EBs, to gather more information
   about other networks, for example.  During the joining process,
   before secure connections to time parents have been created, a node
   MAY maintain synchronization using EBs.  [[RFC7554](./rfc7554 "\"Using IEEE 802.15.4e Time-Slotted Channel Hopping (TSCH) in the Internet of Things (IoT): Problem Statement\"")] discusses
   different time synchronization approaches.

   The IEEE Std 802.15.4 specification requires EBs to be sent in order
   to enable nodes to join the network.  The EBs SHOULD carry the
   Information Elements (IEs) listed below [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

Vilajosana, et al.        Best Current Practice                 [Page 9]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   TSCH Synchronization IE:  Contains synchronization information such
      as ASN and Join Metric.  The value of the Join Metric field is
      discussed in [Section 6.1](#section-6.1).

   TSCH Timeslot IE:  Contains the timeslot template identifier.  This
      template is used to specify the internal timing of the timeslot.
      This specification RECOMMENDS the default timeslot template.

   Channel Hopping IE:  Contains the channel hopping sequence
      identifier.  This specification RECOMMENDS the default channel
      hopping sequence.

   TSCH Slotframe and Link IE:  Enables joining nodes to learn the
      initial schedule to be used as they join the network.  This
      document RECOMMENDS the use of a single cell.

   If a node strictly follows the recommended setting from Figure 1, the
   EB it sends has the exact same contents as an EB it received when
   joining, except for the Join Metric field in the TSCH Synchronization
   IE.

   When a node has already joined a network (i.e., it has received an
   EB) synchronized to the EB sender and configured its schedule
   following this specification, the node SHOULD ignore subsequent EBs
   that try to change the configured parameters.  This does not preclude
   listening to EBs from other networks.

[4.5.3](#section-4.5.3).  Acknowledgment Frame

   Per [[IEEE.802.15.4](#ref-IEEE.802.15.4)], each acknowledgment contains an ACK/NACK Time
   Correction IE.

[4.6](#section-4.6).  Link-Layer Security

   When securing link-layer frames, link-layer frames MUST be secured by
   the link-layer security mechanisms defined in IEEE Std 802.15.4
   [[IEEE.802.15.4](#ref-IEEE.802.15.4)].  Link-layer authentication MUST be applied to the
   entire frame, including the 802.15.4 header.  Link-layer encryption
   MAY be applied to 802.15.4 Payload IEs and the 802.15.4 payload.

   This specification assumes the existence of two cryptographic keys:

      Key K1 is used to authenticate EBs.  EBs MUST be authenticated
      only (no encryption); their contents are defined in [Section 4.5.2](#section-4.5.2).

      Key K2 is used to authenticate and encrypt DATA and ACKNOWLEDGMENT
      frames.

Vilajosana, et al.        Best Current Practice                [Page 10]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   These keys can be pre-configured or learned during a key distribution
   phase.  Key distribution mechanisms are defined, for example, in
   [[SEC-6TISCH](#ref-SEC-6TISCH)] and [[SEC-JOIN-6TISCH](#ref-SEC-JOIN-6TISCH)].  Key distribution is out of scope
   of this document.

   The behavior of a Joining Node (JN) is different depending on which
   key(s) are pre-configured:

      If both keys K1 and K2 are pre-configured, the JN does not rely on
      a key distribution phase to learn K1 or K2.

      If key K1 is pre-configured but not key K2, the JN authenticates
      EBs using K1 and relies on the key distribution phase to learn K2.

      If neither key K1 nor key K2 is pre-configured, the JN accepts EBs
      as defined in [Section 6.3.1.2](#section-6.3.1.2) of IEEE Std 802.15.4
      [[IEEE.802.15.4](#ref-IEEE.802.15.4)], i.e., they are passed forward even "if the status
      of the unsecuring process indicated an error".  The JN then runs
      the key distribution phase to learn K1 and K2.  During that
      process, the node that JN is talking to uses the secExempt
      mechanism (see Section 9.2.4 of [[IEEE.802.15.4](#ref-IEEE.802.15.4)]) to process frames
      from JN.  Once the key distribution phase is done, the node that
      has installed secExempts for the JN MUST clear the installed
      exception rules.

   In the event of a network reset, the new network MUST either use new
   cryptographic keys or ensure that the ASN remains monotonically
   increasing.

[5](#section-5).  RPL Settings

   In a multi-hop topology, the RPL routing protocol [[RFC6550](./rfc6550 "\"RPL: IPv6 Routing Protocol for Low-Power and Lossy Networks\"")] MAY be
   used.

[5.1](#section-5.1).  Objective Function

   If RPL is used, nodes MUST implement the RPL Objective Function Zero
   (OF0) [[RFC6552](./rfc6552 "\"Objective Function Zero for the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")].

[5.1.1](#section-5.1.1).  Rank Computation

   The Rank computation is described in [Section 4.1 of [RFC6552]](./rfc6552#section-4.1).  A
   node's Rank (see Figure 4 for an example) is computed by the
   following equations:

      R(N) = R(P) + rank_increment

      rank_increment = (Rf*Sp + Sr) * MinHopRankIncrease

Vilajosana, et al.        Best Current Practice                [Page 11]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   Figure 3 lists the OF0 parameter values that MUST be used if RPL is
   used.

       +----------------------+-------------------------------------+
       |    OF0 Parameters    |              Value                  |
       +----------------------+-------------------------------------+
       | Rf                   |                                   1 |
       +----------------------+-------------------------------------+
       | Sp                   |                           (3*ETX)-2 |
       +----------------------+-------------------------------------+
       | Sr                   |                                   0 |
       +----------------------+-------------------------------------+
       | MinHopRankIncrease   | DEFAULT_MIN_HOP_RANK_INCREASE (256) |
       +----------------------+-------------------------------------+
       | MINIMUM_STEP_OF_RANK |                                   1 |
       +----------------------+-------------------------------------+
       | MAXIMUM_STEP_OF_RANK |                                   9 |
       +----------------------+-------------------------------------+
       | ETX limit to select  |                                   3 |
       | a parent             |                                     |
       +----------------------+-------------------------------------+

                         Figure 3: OF0 Parameters

   The step_of_rank (Sp) uses the Expected Transmission Count (ETX)
   [[RFC6551](./rfc6551 "\"Routing Metrics Used for Path Calculation in Low-Power and Lossy Networks\"")].

   An implementation MUST follow OF0's normalization guidance as
   discussed in Sections [1](#section-1) and [4.1](#section-4.1) of [[RFC6552](./rfc6552 "\"Objective Function Zero for the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")].  Sp SHOULD be
   calculated as (3*ETX)-2.  The minimum value of Sp
   (MINIMUM_STEP_OF_RANK) indicates a good quality link.  The maximum
   value of Sp (MAXIMUM_STEP_OF_RANK) indicates a poor quality link.
   The default value of Sp (DEFAULT_STEP_OF_RANK) indicates an average
   quality link.  Candidate parents with ETX greater than 3 SHOULD NOT
   be selected.  This avoids having ETX values on used links that are
   larger that the maximum allowed transmission attempts.

Vilajosana, et al.        Best Current Practice                [Page 12]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[5.1.2](#section-5.1.2).  Rank Computation Example

   This section illustrates the use of OF0 (see Figure 4).  We have:

      rank_increment = ((3*numTx/numTxAck)-2)*minHopRankIncrease = 512

       +-------+
       |   0   | R(minHopRankIncrease) = 256
       |       | DAGRank(R(0)) = 1
       +-------+
           |
           |
       +-------+
       |   1   | R(1)=R(0) + 512 = 768
       |       | DAGRank(R(1)) = 3
       +-------+
           |
           |
       +-------+
       |   2   | R(2)=R(1) + 512 = 1280
       |       | DAGRank(R(2)) = 5
       +-------+
           |
           |
       +-------+
       |   3   | R(3)=R(2) + 512 = 1792
       |       | DAGRank(R(3)) = 7
       +-------+
           |
           |
       +-------+
       |   4   | R(4)=R(3) + 512 = 2304
       |       | DAGRank(R(4)) = 9
       +-------+
           |
           |
       +-------+
       |   5   | R(5)=R(4) + 512 = 2816
       |       | DAGRank(R(5)) = 11
       +-------+

       Figure 4: Rank computation example for a 5-hop network where
                 numTx=100 and numTxAck=75 for all links.

Vilajosana, et al.        Best Current Practice                [Page 13]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[5.2](#section-5.2).  Mode of Operation

   When RPL is used, nodes MUST implement the non-storing mode of
   operation (see [Section 9.7 of [RFC6550]](./rfc6550#section-9.7)).  The storing mode of
   operation (see [Section 9.8 of [RFC6550]](./rfc6550#section-9.8)) SHOULD be implemented by
   nodes with enough capabilities.  Nodes not implementing RPL MUST join
   as leaf nodes.

[5.3](#section-5.3).  Trickle Timer

   RPL signaling messages such as DODAG Information Objects (DIOs) are
   sent using the Trickle algorithm (see [Section 8.3.1 of [RFC6550]](./rfc6550#section-8.3.1) and
   [Section 4.2 of [RFC6206]](./rfc6206#section-4.2)).  For this specification, the Trickle timer
   MUST be used with the RPL-defined default values (see [Section 8.3.1
   of [RFC6550]](./rfc6550#section-8.3.1)).

[5.4](#section-5.4).  Packet Contents

   RPL information and hop-by-hop extension headers MUST follow
   [[RFC6553](./rfc6553 "\"The Routing Protocol for Low- Power and Lossy Networks (RPL) Option for Carrying RPL Information in Data-Plane Datagrams\"")] and [[RFC6554](./rfc6554 "\"An IPv6 Routing Header for Source Routes with the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")].  For cases in which the packets formed at
   the Low-Power and Lossy Network (LLN) need to cross through
   intermediate routers, these MUST follow the IP-in-IP encapsulation
   requirement specified by [[RFC6282](./rfc6282 "\"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks\"")] and [[RFC2460](./rfc2460 "\"Internet Protocol, Version 6 (IPv6) Specification\"")].  Routing extension
   headers such as RPL Packet Information (RPI) [[RFC6550](./rfc6550 "\"RPL: IPv6 Routing Protocol for Low-Power and Lossy Networks\"")] and Source
   Routing Header (SRH) [[RFC6554](./rfc6554 "\"An IPv6 Routing Header for Source Routes with the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")], and outer IP headers in case of
   encapsulation, MUST be compressed according to [[RFC8138](./rfc8138 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Routing Header\"")] and
   [[RFC8025](./rfc8025 "\"IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Paging Dispatch\"")].

[6](#section-6).  Network Formation and Lifetime

[6.1](#section-6.1).  Value of the Join Metric Field

   The Join Metric of the TSCH Synchronization IE in the EB MUST be
   calculated based on the routing metric of the node, normalized to a
   value between 0 and 255.  A lower value of the Join Metric indicates
   the node sending the EB is topologically "closer" to the root of the
   network.  A lower value of the Join Metric hence indicates higher
   preference for a joining node to synchronize to that neighbor.

   In case the network uses RPL, the Join Metric of any node (including
   the Directed Acyclic Graph (DAG) root) MUST be set to
   DAGRank(rank)-1.  According to [Section 5.1.1](#section-5.1.1), DAGRank(rank(0)) = 1.
   DAGRank(rank(0))-1 = 0 is compliant with 802.15.4's requirement of
   having the root use Join Metric = 0.

   In case the network does not use RPL, the Join Metric value MUST
   follow the rules specified by [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

Vilajosana, et al.        Best Current Practice                [Page 14]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[6.2](#section-6.2).  Time-Source Neighbor Selection

   When a node joins a network, it may hear EBs sent by different nodes
   already in the network.  The decision of which neighbor to
   synchronize to (e.g., which neighbor becomes the node's initial time-
   source neighbor) is implementation specific.  For example, after
   having received the first EB, a node MAY listen for at most
   MAX_EB_DELAY seconds until it has received EBs from
   NUM_NEIGHBOURS_TO_WAIT distinct neighbors.  Recommended values for
   MAX_EB_DELAY and NUM_NEIGHBOURS_TO_WAIT are defined in Figure 5.
   When receiving EBs from distinct neighbors, the node MAY use the Join
   Metric field in each EB to select the initial time-source neighbor,
   as described in [Section 6.3.6](#section-6.3.6) of IEEE Std 802.15.4 [[IEEE.802.15.4](#ref-IEEE.802.15.4)].

   At any time, a node MUST maintain synchronization to at least one
   time-source neighbor.  A node's time-source neighbor MUST be chosen
   among the neighbors in its RPL routing parent set when RPL is used.
   In the case a node cannot maintain connectivity to at least one time-
   source neighbor, the node looses synchronization and needs to join
   the network again.

[6.3](#section-6.3).  When to Start Sending EBs

   When a RPL node joins the network, it MUST NOT send EBs before having
   acquired a RPL Rank to avoid inconsistencies in the time
   synchronization structure.  This applies to other routing protocols
   with their corresponding routing metrics.  As soon as a node acquires
   routing information (e.g., a RPL Rank, see [Section 5.1.1](#section-5.1.1)), it SHOULD
   start sending EBs.

[6.4](#section-6.4).  Hysteresis

   Per [[RFC6552](./rfc6552 "\"Objective Function Zero for the Routing Protocol for Low-Power and Lossy Networks (RPL)\"")] and [[RFC6719](./rfc6719 "\"The Minimum Rank with Hysteresis Objective Function\"")], the specification RECOMMENDS the use of
   a boundary value (PARENT_SWITCH_THRESHOLD) to avoid constant changes
   of the parent when ranks are compared.  When evaluating a parent that
   belongs to a smaller path cost than the current minimum path, the
   candidate node is selected as the new parent only if the difference
   between the new path and the current path is greater than the defined
   PARENT_SWITCH_THRESHOLD.  Otherwise, the node MAY continue to use the
   current preferred parent.  Per [[RFC6719](./rfc6719 "\"The Minimum Rank with Hysteresis Objective Function\"")], the PARENT_SWITCH_THRESHOLD
   SHOULD be set to 192 when the ETX metric is used (in the form
   128*ETX); the recommendation for this document is to use
   PARENT_SWITCH_THRESHOLD equal to 640 if the metric being used is
   ((3*ETX)-2)*minHopRankIncrease or a proportional value.  This deals
   with hysteresis both for routing parent and time-source neighbor
   selection.

Vilajosana, et al.        Best Current Practice                [Page 15]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[7](#section-7).  Implementation Recommendations

[7.1](#section-7.1).  Neighbor Table

   The exact format of the neighbor table is implementation specific.
   The RECOMMENDED per-neighbor information is (taken from the [[openwsn](#ref-openwsn "\"OpenWSN: a standards-based low-power wireless development environment\"")]
   implementation):

   identifier: Identifier(s) of the neighbor (e.g., EUI-64).

   numTx:      Number of link-layer transmission attempts to that
               neighbor.

   numTxAck:   Number of transmitted link-layer frames that have been
               link-layer acknowledged by that neighbor.

   numRx:      Number of link-layer frames received from that neighbor.

   timestamp:  When the last frame was received from that neighbor.
               This can be based on the ASN counter or any other time
               base.  It can be used to trigger a keep-alive message.

   routing metric:  The RPL Rank of that neighbor, for example.

   time-source neighbor:  A flag indicating whether this neighbor is a
               time-source neighbor.

[7.2](#section-7.2).  Queues and Priorities

   The IEEE Std 802.15.4 specification [[IEEE.802.15.4](#ref-IEEE.802.15.4)] does not define
   the use of queues to handle upper-layer data (either application or
   control data from upper layers).  The following rules are
   RECOMMENDED:

      A node is configured to keep in the queues a configurable number
      of upper-layer packets per link (default NUM_UPPERLAYER_PACKETS)
      for a configurable time that should cover the join process
      (default MAX_JOIN_TIME).

      Frames generated by the 802.15.4 layer (including EBs) are queued
      with a priority higher than frames coming from higher layers.

      A frame type BEACON is queued with higher priority than frame
      types DATA.

Vilajosana, et al.        Best Current Practice                [Page 16]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[7.3](#section-7.3).  Recommended Settings

   Figure 5 lists RECOMMENDED values for the settings discussed in this
   specification.

           +-------------------------+-------------------+
           | Parameter               | RECOMMENDED Value |
           +-------------------------+-------------------+
           | MAX_EB_DELAY            |               180 |
           +-------------------------+-------------------+
           | NUM_NEIGHBOURS_TO_WAIT  |                 2 |
           +-------------------------+-------------------+
           | PARENT_SWITCH_THRESHOLD |               640 |
           +-------------------------+-------------------+
           | NUM_UPPERLAYER_PACKETS  |                 1 |
           +-------------------------+-------------------+
           | MAX_JOIN_TIME           |               300 |
           +-------------------------+-------------------+

                      Figure 5: Recommended Settings

[8](#section-8).  Security Considerations

   This document is concerned only with link-layer security.

   By their nature, many Internet of Things (IoT) networks have nodes in
   physically vulnerable locations.  We should assume that nodes will be
   physically compromised, their memories examined, and their keys
   extracted.  Fixed secrets will not remain secret.  This impacts the
   node-joining process.  Provisioning a network with a fixed link key
   K2 is not secure.  For most applications, this implies that there
   will be a joining phase during which some level of authorization will
   be allowed for nodes that have not been authenticated.  Details are
   out of scope, but the link layer must provide some flexibility here.

   If an attacker has obtained K1, it can generate fake EBs to attack a
   whole network by sending authenticated EBs.  The attacker can cause
   the joining node to initiate the joining process to the attacker.  In
   the case that the joining process includes authentication and
   distribution of a K2, then the joining process will fail and the JN
   will notice the attack.  If K2 is also compromised, the JN will not
   notice the attack and the network will be compromised.

   Even if an attacker does not know the value of K1 and K2
   ([Section 4.6](#section-4.6)), it can still generate fake EB frames authenticated
   with an arbitrary key.  Here we discuss the impact these fake EBs can
   have, depending on what key(s) are pre-provisioned.

Vilajosana, et al.        Best Current Practice                [Page 17]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

      If both K1 and K2 are pre-provisioned; a joining node can
      distinguish legitimate from fake EBs and join the legitimate
      network.  The fake EBs have no impact.

      The same holds if K1 is pre-provisioned but not K2.

      If neither K1 nor K2 is pre-provisioned, a joining node may
      mistake a fake EB for a legitimate one and initiate a joining
      process to the attacker.  That joining process will fail, as the
      joining node will not be able to authenticate the attacker during
      the security handshake.  This will force the joining node to start
      over listening for an EB.  So while the joining node never joins
      the attacker, this costs the joining node time and energy and is a
      vector of attack.

   Choosing what key(s) to pre-provision needs to balance the different
   discussions above.

   Once the joining process is over, the node that has joined can
   authenticate EBs (it knows K1).  This means it can process their
   contents and use EBs for synchronization.

   ASN provides a nonce for security operations in a slot.  Any re-use
   of ASN with a given key exposes information about encrypted packet
   contents and risks replay attacks.  Replay attacks are prevented
   because, when the network resets, either the new network uses new
   cryptographic key(s) or ensures that the ASN increases monotonically
   ([Section 4.6](#section-4.6)).

   Maintaining accurate time synchronization is critical for network
   operation.  Accepting timing information from unsecured sources MUST
   be avoided during normal network operation, as described in
   [Section 4.5.2](#section-4.5.2).  During joining, a node may be susceptible to timing
   attacks before key K1 and K2 are learned.  During network operation,
   a node MAY maintain statistics on time updates from neighbors and
   monitor for anomalies.

   Denial-of-Service (DoS) attacks at the Media Access Control (MAC)
   layer in an LLN are easy to achieve simply by Radio Frequency (RF)
   jamming.  This is the base case against which more sophisticated DoS
   attacks should be judged.  For example, sending fake EBs announcing a
   very low Join Metric may cause a node to waste time and energy trying
   to join a fake network even when legitimate EBs are being heard.
   Proper join security will prevent the node from joining the false
   flag, but by then the time and energy will have been wasted.
   However, the energy cost to the attacker would be lower and the

Vilajosana, et al.        Best Current Practice                [Page 18]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   energy cost to the joining node would be higher if the attacker
   simply sent loud short packets in the middle of any valid EB that it
   hears.

   ACK reception probability is less than 100% due to changing channel
   conditions and unintentional or intentional jamming.  This will cause
   the sending node to retransmit the same packet until it is
   acknowledged or a retransmission limit is reached.  Upper-layer
   protocols should take this into account, possibly using a sequence
   number to match retransmissions.

   The 6TiSCH layer SHOULD keep track of anomalous events and report
   them to a higher authority.  For example, EBs reporting low Join
   Metrics for networks that cannot be joined, as described above, may
   be a sign of attack.  Additionally, in normal network operation,
   message integrity check failures on packets with a valid Cyclic
   Redundancy Check (CRC) will occur at a rate on the order of once per
   million packets.  Any significant deviation from this rate may be a
   sign of a network attack.  Along the same lines, time updates in ACKs
   or EBs that are inconsistent with the MAC-layer's sense of time and
   its own plausible time-error drift rate may also be a result of
   network attack.

[9](#section-9).  IANA Considerations

   This document does not require any IANA actions.

[10](#section-10).  References

[10.1](#section-10.1).  Normative References

   [IEEE.802.15.4]
              IEEE, "IEEE Standard for Low-Rate Wireless Networks",
              IEEE 802.15.4,
              <<http://ieeexplore.ieee.org/document/7460875/>>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", [BCP 14](https://www.rfc-editor.org/bcp/bcp14), [RFC 2119](./rfc2119),
              DOI 10.17487/RFC2119, March 1997,
              <[http://www.rfc-editor.org/info/rfc2119](https://www.rfc-editor.org/info/rfc2119)>.

   [RFC2460]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", [RFC 2460](./rfc2460), DOI 10.17487/RFC2460,
              December 1998, <[http://www.rfc-editor.org/info/rfc2460](https://www.rfc-editor.org/info/rfc2460)>.

Vilajosana, et al.        Best Current Practice                [Page 19]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   [RFC4944]  Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler,
              "Transmission of IPv6 Packets over IEEE 802.15.4
              Networks", [RFC 4944](./rfc4944), DOI 10.17487/RFC4944, September 2007,
              <[http://www.rfc-editor.org/info/rfc4944](https://www.rfc-editor.org/info/rfc4944)>.

   [RFC6206]  Levis, P., Clausen, T., Hui, J., Gnawali, O., and J. Ko,
              "The Trickle Algorithm", [RFC 6206](./rfc6206), DOI 10.17487/RFC6206,
              March 2011, <[http://www.rfc-editor.org/info/rfc6206](https://www.rfc-editor.org/info/rfc6206)>.

   [RFC6282]  Hui, J., Ed. and P. Thubert, "Compression Format for IPv6
              Datagrams over IEEE 802.15.4-Based Networks", [RFC 6282](./rfc6282),
              DOI 10.17487/RFC6282, September 2011,
              <[http://www.rfc-editor.org/info/rfc6282](https://www.rfc-editor.org/info/rfc6282)>.

   [RFC6550]  Winter, T., Ed., Thubert, P., Ed., Brandt, A., Hui, J.,
              Kelsey, R., Levis, P., Pister, K., Struik, R., Vasseur,
              JP., and R. Alexander, "RPL: IPv6 Routing Protocol for
              Low-Power and Lossy Networks", [RFC 6550](./rfc6550),
              DOI 10.17487/RFC6550, March 2012,
              <[http://www.rfc-editor.org/info/rfc6550](https://www.rfc-editor.org/info/rfc6550)>.

   [RFC6551]  Vasseur, JP., Ed., Kim, M., Ed., Pister, K., Dejean, N.,
              and D. Barthel, "Routing Metrics Used for Path Calculation
              in Low-Power and Lossy Networks", [RFC 6551](./rfc6551),
              DOI 10.17487/RFC6551, March 2012,
              <[http://www.rfc-editor.org/info/rfc6551](https://www.rfc-editor.org/info/rfc6551)>.

   [RFC6552]  Thubert, P., Ed., "Objective Function Zero for the Routing
              Protocol for Low-Power and Lossy Networks (RPL)",
              [RFC 6552](./rfc6552), DOI 10.17487/RFC6552, March 2012,
              <[http://www.rfc-editor.org/info/rfc6552](https://www.rfc-editor.org/info/rfc6552)>.

   [RFC6553]  Hui, J. and JP. Vasseur, "The Routing Protocol for Low-
              Power and Lossy Networks (RPL) Option for Carrying RPL
              Information in Data-Plane Datagrams", [RFC 6553](./rfc6553),
              DOI 10.17487/RFC6553, March 2012,
              <[http://www.rfc-editor.org/info/rfc6553](https://www.rfc-editor.org/info/rfc6553)>.

   [RFC6554]  Hui, J., Vasseur, JP., Culler, D., and V. Manral, "An IPv6
              Routing Header for Source Routes with the Routing Protocol
              for Low-Power and Lossy Networks (RPL)", [RFC 6554](./rfc6554),
              DOI 10.17487/RFC6554, March 2012,
              <[http://www.rfc-editor.org/info/rfc6554](https://www.rfc-editor.org/info/rfc6554)>.

   [RFC6719]  Gnawali, O. and P. Levis, "The Minimum Rank with
              Hysteresis Objective Function", [RFC 6719](./rfc6719),
              DOI 10.17487/RFC6719, September 2012,
              <[http://www.rfc-editor.org/info/rfc6719](https://www.rfc-editor.org/info/rfc6719)>.

Vilajosana, et al.        Best Current Practice                [Page 20]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   [RFC6775]  Shelby, Z., Ed., Chakrabarti, S., Nordmark, E., and C.
              Bormann, "Neighbor Discovery Optimization for IPv6 over
              Low-Power Wireless Personal Area Networks (6LoWPANs)",
              [RFC 6775](./rfc6775), DOI 10.17487/RFC6775, November 2012,
              <[http://www.rfc-editor.org/info/rfc6775](https://www.rfc-editor.org/info/rfc6775)>.

   [RFC8025]  Thubert, P., Ed. and R. Cragie, "IPv6 over Low-Power
              Wireless Personal Area Network (6LoWPAN) Paging Dispatch",
              [RFC 8025](./rfc8025), DOI 10.17487/RFC8025, November 2016,
              <[http://www.rfc-editor.org/info/rfc8025](https://www.rfc-editor.org/info/rfc8025)>.

   [RFC8138]  Thubert, P., Ed., Bormann, C., Toutain, L., and R. Cragie,
              "IPv6 over Low-Power Wireless Personal Area Network
              (6LoWPAN) Routing Header", [RFC 8138](./rfc8138), DOI 10.17487/RFC8138,
              April 2017, <[http://www.rfc-editor.org/info/rfc8138](https://www.rfc-editor.org/info/rfc8138)>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in [RFC](./rfc2119)
              [2119](./rfc2119) Key Words", [BCP 14](https://www.rfc-editor.org/bcp/bcp14), [RFC 8174](./rfc8174), DOI 10.17487/RFC8174,
              May 2017, <[http://www.rfc-editor.org/info/rfc8174](https://www.rfc-editor.org/info/rfc8174)>.

[10.2](#section-10.2).  Informative References

   [openwsn]  Watteyne, T., Vilajosana, X., Kerkez, B., Chraim, F.,
              Weekly, K., Wang, Q., Glaser, S., and K. Pister, "OpenWSN:
              a standards-based low-power wireless development
              environment", Transactions on Emerging Telecommunications
              Technologies, Volume 23 Issue 5, pages 480-493, DOI
              10.1002/ett.2558, August 2012.

   [PROTO-6P]
              Wang, Q., Vilajosana, X., and T. Watteyne, "6top Protocol
              (6P)", Work in Progress, [draft-ietf-6tisch-6top-protocol-](./draft-ietf-6tisch-6top-protocol-05)
              [05](./draft-ietf-6tisch-6top-protocol-05), May 2017.

   [RFC7554]  Watteyne, T., Ed., Palattella, M., and L. Grieco, "Using
              IEEE 802.15.4e Time-Slotted Channel Hopping (TSCH) in the
              Internet of Things (IoT): Problem Statement", [RFC 7554](./rfc7554),
              DOI 10.17487/RFC7554, May 2015,
              <[http://www.rfc-editor.org/info/rfc7554](https://www.rfc-editor.org/info/rfc7554)>.

   [SEC-6TISCH]
              Vucinic, M., Simon, J., Pister, K., and M. Richardson,
              "Minimal Security Framework for 6TiSCH", Work in
              Progress, [draft-ietf-6tisch-minimal-security-02](./draft-ietf-6tisch-minimal-security-02), March
              2017.

Vilajosana, et al.        Best Current Practice                [Page 21]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   [SEC-JOIN-6TISCH]
              Richardson, M., ["6tisch Secure Join protocol"](https://www.google.com/search?sitesearch=datatracker.ietf.org%2Fdoc%2Fhtml%2F&q=inurl:draft-+%226tisch+Secure+Join+protocol%22), Work in
              Progress, [draft-ietf-6tisch-dtsecurity-secure-join-01](./draft-ietf-6tisch-dtsecurity-secure-join-01),
              February 2017.

   [TERMS-6TiSCH]
              Palattella, M., Thubert, P., Watteyne, T., and Q. Wang,
              "Terminology in IPv6 over the TSCH mode of IEEE
              802.15.4e", Work in Progress, [draft-ietf-6tisch-](./draft-ietf-6tisch-terminology-08)
              [terminology-08](./draft-ietf-6tisch-terminology-08), December 2016.

Vilajosana, et al.        Best Current Practice                [Page 22]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[Appendix A](#appendix-A).  Examples

   This section contains several example packets.  Each example contains
   (1) a schematic header diagram, (2) the corresponding bytestream, and
   (3) a description of each of the IEs that form the packet.  Packet
   formats are specific for the [[IEEE.802.15.4](#ref-IEEE.802.15.4)] revision and may vary in
   future releases of the IEEE standard.  In case of differences between
   the packet content presented in this section and [[IEEE.802.15.4](#ref-IEEE.802.15.4)], the
   latter has precedence.

   The MAC header fields are described in a specific order.  All field
   formats in this example are depicted in the order in which they are
   transmitted, from left to right, where the leftmost bit is
   transmitted first.  Bits within each field are numbered from 0
   (leftmost and least significant) to k - 1 (rightmost and most
   significant), where the length of the field is k bits.  Fields that
   are longer than a single octet are sent to the PHY in the order from
   the octet containing the lowest numbered bits to the octet containing
   the highest numbered bits (little endian).

[A.1](#appendix-A.1).  Example: EB with Default Timeslot Template

                        1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Len1 =   0  |Element ID=0x7e|0|    Len2 = 26        |GrpId=1|1|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Len3 =   6    |Sub ID = 0x1a|0|           ASN
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ASN                                | Join Metric   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Len4 = 0x01  |Sub ID = 0x1c|0| TT ID = 0x00  |   Len5 = 0x01
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |ID=0x9 |1| CH ID = 0x00  | Len6 = 0x0A   |Sub ID = 0x1b|0|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   #SF = 0x01  | SF ID = 0x00  |   SF LEN = 0x65 (101 slots)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | #Links = 0x01 |      SLOT OFFSET = 0x0000     |    CHANNEL
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    OFF  = 0x0000  |Link OPT = 0x0F|         NO MAC PAYLOAD
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Bytestream:

       00 3F 1A 88 06 1A ASN#0 ASN#1 ASN#2 ASN#3 ASN#4 JP 01 1C 00
       01 C8 00 0A 1B 01 00 65 00 01 00 00 00 00 0F

Vilajosana, et al.        Best Current Practice                [Page 23]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

   Description of the IEs:

       #Header IE Header
           Len1 = Header IE Length (0)
           Element ID = 0x7e - termination IE indicating Payload IE
               coming next
           Type 0

       #Payload IE Header (MLME)
           Len2 = Payload IE Len (26 bytes)
           Group ID = 1 MLME (Nested)
           Type = 1

       #MLME-SubIE TSCH Synchronization
           Len3 = Length in bytes of the sub-IE payload (6 bytes)
           Sub-ID = 0x1a (MLME-SubIE TSCH Synchronization)
           Type = Short (0)
           ASN  = Absolute Sequence Number (5 bytes)
           Join Metric = 1 byte

       #MLME-SubIE TSCH Timeslot
           Len4 = Length in bytes of the sub-IE payload (1 byte)
           Sub-ID = 0x1c (MLME-SubIE Timeslot)
           Type = Short (0)
           Timeslot template ID = 0x00 (default)

       #MLME-SubIE Channel Hopping
           Len5 = Length in bytes of the sub-IE payload (1 byte)
           Sub-ID = 0x09 (MLME-SubIE Channel Hopping)
           Type = Long (1)
           Hopping Sequence ID = 0x00 (default)

       #MLME-SubIE TSCH Slotframe and Link
           Len6 = Length in bytes of the sub-IE payload (10 bytes)
           Sub-ID = 0x1b (MLME-SubIE TSCH Slotframe and Link)
           Type = Short (0)
           Number of slotframes = 0x01
           Slotframe handle = 0x00
           Slotframe size = 101 slots (0x65)
           Number of Links (Cells) = 0x01
           Timeslot = 0x0000 (2B)
           Channel Offset = 0x0000 (2B)
           Link Options = 0x0F
           (TX Link = 1, RX Link = 1, Shared Link = 1,
            Timekeeping = 1 )

Vilajosana, et al.        Best Current Practice                [Page 24]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

[A.2](#appendix-A.2).  Example: EB with Custom Timeslot Template

   Using a custom timeslot template in EBs: setting timeslot length to
   15 ms.

                        1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Len1 =   0  |Element ID=0x7e|0|    Len2 = 53        |GrpId=1|1|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Len3 =   6    |Sub ID = 0x1a|0|           ASN
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ASN                                | Join Metric   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Len4 = 25    |Sub ID = 0x1c|0| TT ID = 0x01  | macTsCCAOffset
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 2700        |  macTsCCA = 128               | macTsTxOffset
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 3180        |  macTsRxOffset = 1680         | macTsRxAckDelay
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 1200        |  macTsTxAckDelay = 1500       | macTsRxWait
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 3300        |  macTsAckWait = 600           | macTsRxTx
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 192         |  macTsMaxAck  = 2400          | macTsMaxTx
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     = 4256        | macTsTimeslotLength = 15000   | Len5 = 0x01
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |ID=0x9 |1| CH ID = 0x00  | Len6 = 0x0A   | ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Bytestream:

   00 3F 1A 88 06 1A ASN#0 ASN#1 ASN#2 ASN#3 ASN#4 JP 19 1C 01 8C 0A 80
   00 6C 0C 90 06 B0 04 DC 05 E4 0C 58 02 C0 00 60 09 A0 10 98 3A 01 C8
   00 0A ...

   Description of the IEs:

       #Header IE Header
           Len1 = Header IE Length (none)
           Element ID = 0x7e - termination IE indicating Payload IE
               coming next
           Type 0

Vilajosana, et al.        Best Current Practice                [Page 25]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

       #Payload IE Header (MLME)
           Len2 = Payload IE Len (53 bytes)
           Group ID = 1 MLME (Nested)
           Type = 1

       #MLME-SubIE TSCH Synchronization
           Len3 = Length in bytes of the sub-IE payload (6 bytes)
           Sub-ID = 0x1a (MLME-SubIE TSCH Synchronization)
           Type = Short (0)
           ASN  = Absolute Sequence Number (5 bytes)
           Join Metric = 1 byte

       #MLME-SubIE TSCH Timeslot
           Len4 = Length in bytes of the sub-IE payload (25 bytes)
           Sub-ID = 0x1c (MLME-SubIE Timeslot)
           Type = Short (0)
           Timeslot template ID = 0x01 (non-default)

           The 15 ms timeslot announced:
           +--------------------------------+------------+
           | IEEE 802.15.4 TSCH parameter   | Value (us) |
           +--------------------------------+------------+
           | macTsCCAOffset                 |       2700 |
           +--------------------------------+------------+
           | macTsCCA                       |        128 |
           +--------------------------------+------------+
           | macTsTxOffset                  |       3180 |
           +--------------------------------+------------+
           | macTsRxOffset                  |       1680 |
           +--------------------------------+------------+
           | macTsRxAckDelay                |       1200 |
           +--------------------------------+------------+
           | macTsTxAckDelay                |       1500 |
           +--------------------------------+------------+
           | macTsRxWait                    |       3300 |
           +--------------------------------+------------+
           | macTsAckWait                   |        600 |
           +--------------------------------+------------+
           | macTsRxTx                      |        192 |
           +--------------------------------+------------+
           | macTsMaxAck                    |       2400 |
           +--------------------------------+------------+
           | macTsMaxTx                     |       4256 |
           +--------------------------------+------------+
           | macTsTimeslotLength            |      15000 |
           +--------------------------------+------------+

Vilajosana, et al.        Best Current Practice                [Page 26]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

       #MLME-SubIE Channel Hopping
           Len5 = Length in bytes of the sub-IE payload. (1 byte)
           Sub-ID = 0x09 (MLME-SubIE Channel Hopping)
           Type = Long (1)
           Hopping Sequence ID = 0x00 (default)

[A.3](#appendix-A.3).  Example: Link-layer Acknowledgment

   Enhanced Acknowledgment packets carry the Time Correction IE (Header
   IE).

                        1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Len1 =   2  |Element ID=0x1e|0|        Time Sync Info         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Bytestream:

       02 0F TS#0 TS#1

   Description of the IEs:

       #Header IE Header
           Len1 = Header IE Length (2 bytes)
           Element ID = 0x1e - ACK/NACK Time Correction IE
           Type 0

[A.4](#appendix-A.4).  Example: Auxiliary Security Header

   802.15.4 Auxiliary Security Header with the Security Level set to
   ENC-MIC-32.

                        1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |L = 5|M=1|1|1|0|Key Index = IDX|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Bytestream:

       6D IDX#0

   Security Auxiliary Header fields in the example:

       #Security Control (1 byte)
           L = Security Level ENC-MIC-32 (5)
           M = Key Identifier Mode (0x01)

Vilajosana, et al.        Best Current Practice                [Page 27]
```

---

```

[RFC 8180](./rfc8180)                     6TiSCH Minimal                     May 2017

           Frame Counter Suppression = 1 (omitting Frame Counter field)
           ASN in Nonce = 1 (construct Nonce from 5 byte ASN)
           Reserved = 0

       #Key Identifier (1 byte)
           Key Index = IDX (deployment-specific KeyIndex parameter that
                       identifies the cryptographic key)

Acknowledgments

   The authors acknowledge the guidance and input from Rene Struik, Pat
   Kinney, Michael Richardson, Tero Kivinen, Nicola Accettura, Malisa
   Vucinic, and Jonathan Simon.  Thanks to Charles Perkins, Brian E.
   Carpenter, Ralph Droms, Warren Kumari, Mirja Kuehlewind, Ben
   Campbell, Benoit Claise, and Suresh Krishnan for the exhaustive and
   detailed reviews.  Thanks to Simon Duquennoy, Guillaume Gaillard,
   Tengfei Chang, and Jonathan Munoz for the detailed review of the
   examples section.  Thanks to 6TiSCH co-chair Pascal Thubert for his
   guidance and advice.

Authors' Addresses

   Xavier Vilajosana (editor)
   Universitat Oberta de Catalunya
   156 Rambla Poblenou
   Barcelona, Catalonia  08018
   Spain

   Email: xvilajosana@uoc.edu

   Kris Pister
   University of California Berkeley
   512 Cory Hall
   Berkeley, California  94720
   United States of America

   Email: pister@eecs.berkeley.edu

   Thomas Watteyne
   Analog Devices
   32990 Alvarado-Niles Road, Suite 910
   Union City, CA  94587
   United States of America

   Email: twatteyne@linear.com

Vilajosana, et al.        Best Current Practice                [Page 28]

```


=== Content from datatracker.ietf.org_8db6d217_20250115_134018.html ===


* Light
* Dark
* Auto

[draft-selander-ace-ake-authz-03

Internet-Draft](/doc/draft-selander-ace-ake-authz/)

|  | Title |  | Lightweight Authorization for Authenticated Key Exchange. |
| --- | --- | --- | --- |
| Document | Document type |  | This is an older version of an Internet-Draft whose latest revision state is "Replaced". This document is an Internet-Draft (I-D). Anyone may submit an I-D to the IETF. This I-D is **not endorsed by the IETF** and has **no formal standing** in the [IETF standards process](/doc/rfc2026/). |
| --- | --- | --- | --- |
|  | Select version |  | * [00](/doc/html/draft-selander-ace-ake-authz-00) * [01](/doc/html/draft-selander-ace-ake-authz-01) * [02](/doc/html/draft-selander-ace-ake-authz-02) * [03](/doc/html/draft-selander-ace-ake-authz-03) * [04](/doc/html/draft-selander-ace-ake-authz-04) * [05](/doc/html/draft-selander-ace-ake-authz-05) |
|  | Compare versions |  | draft-selander-ace-ake-authz-05  draft-selander-ace-ake-authz-04  draft-selander-ace-ake-authz-03  draft-selander-ace-ake-authz-02  draft-selander-ace-ake-authz-01  draft-selander-ace-ake-authz-00   draft-selander-ace-ake-authz-05  draft-selander-ace-ake-authz-04  draft-selander-ace-ake-authz-03  draft-selander-ace-ake-authz-02  draft-selander-ace-ake-authz-01  draft-selander-ace-ake-authz-00   Side-by-side  Inline |
|  | Authors |  | [Göran Selander](/person/goran.selander%40ericsson.com "Datatracker profile of Göran Selander") , [John Preuß Mattsson](/person/john.mattsson%40gmail.com "Datatracker profile of John Preuß Mattsson") , [Mališa Vučinić](/person/malisa.vucinic%40inria.fr "Datatracker profile of Mališa Vučinić") , [Michael Richardson](/person/mcr%2Bietf%40sandelman.ca "Datatracker profile of Michael Richardson") , [Aurelio Schellenbaum](/person/scnm%40zhaw.ch "Datatracker profile of Aurelio Schellenbaum") |
|  | Replaced by |  | [draft-selander-lake-authz](/doc/html/draft-selander-lake-authz "Lightweight Authorization for EDHOC")[draft-selander-lake-authz](/doc/html/draft-selander-lake-authz "Lightweight Authorization using Ephemeral Diffie-Hellman Over COSE") |
|  | RFC stream |  | (None) |
|  | Other formats |  | [txt](https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt) [xml](https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.xml) [bibtex](/doc/draft-selander-ace-ake-authz/03/bibtex/) [bibxml](/doc/bibxml3/draft-selander-ace-ake-authz-03.xml) |
|  |  |  | [Report a bug](https://github.com/ietf-tools/datatracker/issues/new/choose) |

```
Network Working Group                                        G. Selander
Internet-Draft                                               J. Mattsson
Intended status: Informational                               Ericsson AB
Expires: November 5, 2021                                     M. Vucinic
                                                                   INRIA
                                                           M. Richardson
                                                Sandelman Software Works
                                                         A. Schellenbaum
                                     Institute of Embedded Systems, ZHAW
                                                            May 04, 2021

       Lightweight Authorization for Authenticated Key Exchange.
                    draft-selander-ace-ake-authz-03

Abstract

   This document describes a procedure for augmenting the authenticated
   Diffie-Hellman key exchange EDHOC with third party assisted
   authorization targeting constrained IoT deployments ([RFC 7228](/doc/html/rfc7228)).

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of [BCP 78](/doc/html/bcp78) and [BCP 79](/doc/html/bcp79).

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <https://datatracker.ietf.org/drafts/current/>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 5, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to [BCP 78](/doc/html/bcp78) and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<https://trustee.ietf.org/license-info>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect

Selander, et al.        Expires November 5, 2021                [Page 1]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   [1](#section-1).  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   [2](#page-2)
     [1.1](#section-1.1).  Terminology . . . . . . . . . . . . . . . . . . . . . . .   [3](#page-3)
   [2](#section-2).  Problem Description . . . . . . . . . . . . . . . . . . . . .   [3](#page-3)
   [3](#section-3).  Assumptions . . . . . . . . . . . . . . . . . . . . . . . . .   [4](#page-4)
     [3.1](#section-3.1).  Device  . . . . . . . . . . . . . . . . . . . . . . . . .   [4](#page-4)
     [3.2](#section-3.2).  Domain Authenticator  . . . . . . . . . . . . . . . . . .   [4](#page-4)
     [3.3](#section-3.3).  Authorization Server  . . . . . . . . . . . . . . . . . .   [5](#page-5)
   [4](#section-4).  The Protocol  . . . . . . . . . . . . . . . . . . . . . . . .   [5](#page-5)
     [4.1](#section-4.1).  Device <-> Authorization Server . . . . . . . . . . . . .   [7](#page-7)
     [4.2](#section-4.2).  Device <-> Authenticator  . . . . . . . . . . . . . . . .  [10](#page-10)
     [4.3](#section-4.3).  Authenticator <-> Authorization Server  . . . . . . . . .  [12](#page-12)
   [5](#section-5).  ACE Profile . . . . . . . . . . . . . . . . . . . . . . . . .  [14](#page-14)
     [5.1](#section-5.1).  Protocol Overview . . . . . . . . . . . . . . . . . . . .  [15](#page-15)
     [5.2](#section-5.2).  AS Request Creation Hints . . . . . . . . . . . . . . . .  [15](#page-15)
     [5.3](#section-5.3).  Client-to-AS Request  . . . . . . . . . . . . . . . . . .  [16](#page-16)
     [5.4](#section-5.4).  AS-to-Client Response . . . . . . . . . . . . . . . . . .  [16](#page-16)
   [6](#section-6).  Security Considerations . . . . . . . . . . . . . . . . . . .  [17](#page-17)
   [7](#section-7).  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  [17](#page-17)
   [8](#section-8).  Informative References  . . . . . . . . . . . . . . . . . . .  [17](#page-17)
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  [19](#page-19)

[1](#section-1).  Introduction

   For constrained IoT deployments [[RFC7228](/doc/html/rfc7228 "\"Terminology for Constrained-Node Networks\"")] the overhead contributed by
   security protocols may be significant which motivates the
   specification of lightweight protocols that are optimizing, in
   particular, message overhead (see [[I-D.ietf-lake-reqs](#ref-I-D.ietf-lake-reqs)]).  This
   document describes a procedure for augmenting the lightweight
   authenticated Diffie-Hellman key exchange EDHOC [[I-D.ietf-lake-edhoc](#ref-I-D.ietf-lake-edhoc)]
   with third party assisted authorization.

   The procedure involves a device, a domain authenticator and an
   authorization server.  The device and authenticator perform mutual
   authentication and authorization, assisted by the authorization
   server which provides relevant authorization information to the
   device (a "voucher") and to the authenticator.

   The protocol assumes that authentication between device and
   authenticator is performed with EDHOC, and defines the integration of
   a lightweight authorization procedure using the Auxiliary Data
   defined in EDHOC.

Selander, et al.        Expires November 5, 2021                [Page 2]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   In this document we consider the target interaction to be
   "enrollment", for example certificate enrollment (such as
   [[I-D.selander-ace-coap-est-oscore](#ref-I-D.selander-ace-coap-est-oscore)]) or joining a network for the
   first time (e.g.  [[I-D.ietf-6tisch-minimal-security](#ref-I-D.ietf-6tisch-minimal-security)]), but it can be
   applied to authorize other target interactions.

   The protocol enables a low message count by performing authorization
   and enrollment in parallel with authentication, instead of in
   sequence which is common for network access.  It further reuses
   protocol elements from EDHOC leading to reduced message sizes on
   constrained links.

   This protocol is applicable to a wide variety of settings, and can be
   mapped to different authorization architectures.  This document
   specifies a profile of the ACE framework [[I-D.ietf-ace-oauth-authz](#ref-I-D.ietf-ace-oauth-authz)].
   Other settings such as EAP [[RFC3748](/doc/html/rfc3748 "\"Extensible Authentication Protocol (EAP)\"")] are out of scope for this
   specification.

[1.1](#section-1.1).  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in [BCP](/doc/html/bcp14)
   [14](/doc/html/bcp14) [[RFC2119](/doc/html/rfc2119 "\"Key words for use in RFCs to Indicate Requirement Levels\"")] [[RFC8174](/doc/html/rfc8174 "\"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words\"")] when, and only when, they appear in all
   capitals, as shown here.

[2](#section-2).  Problem Description

   The (potentially constrained) device wants to enroll into a domain
   over a constrained link.  The device authenticates and enforces
   authorization of the (non-constrained) domain authenticator with the
   help of a voucher, and makes the enrollment request.  The domain
   authenticator authenticates the device and authorizes its enrollment.
   Authentication between device and domain authenticator is made with
   the lightweight authenticated Diffie-Hellman key exchange protocol
   EDHOC [[I-D.ietf-lake-edhoc](#ref-I-D.ietf-lake-edhoc)].  The procedure is assisted by a (non-
   constrained) authorization server located in a non-constrained
   network behind the domain authenticator providing information to the
   device and to the domain authenticator as part of the protocol.

   The objective of this document is to specify such a protocol which is
   lightweight over the constrained link and reuses elements of EDHOC.
   See illustration in Figure 1.

Selander, et al.        Expires November 5, 2021                [Page 3]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

                      Voucher
                EDHOC  Info
   +----------+  |    |   +---------------+  Voucher  +---------------+
   |          |  |    |   |               |  Request  |               |
   |  Device  |--|----o-->|    Domain     |---------->| Authorization |
   |          |<-|---o----| Authenticator |<----------|     Server    |
   |    (U)   |--|---|--->|      (V)      |  Voucher  |       (W)     |
   |          |      |    |               |  Response |               |
   +----------+      |    +---------------+           +---------------+
                     Voucher

       Figure 1: Overview of message flow.  Link between U anv V is
      constrained but link between V and W is not.  Voucher Info and
                 Voucher are sent in EDHOC Auxiliary Data.

[3](#section-3).  Assumptions

[3.1](#section-3.1).  Device

   The device is pre-provisioned with an identity ID_U and asymmetric
   key credentials: a private key, a public key (PK_U), and optionally a
   public key certificate (Cert_PK_U), issued by a trusted third party
   such as e.g. the device manufacturer, used to authenticate to the
   domain authenticator.  ID_U may be a reference or pointer to the
   certificate.

   The device is also provisioned with information about its
   authorization server:

   o  At least one static public DH key of the authorization server
      (G_W) used to ensure secure communication with the device (see
      [Section 4.1](#section-4.1)).

   o  Location information about the authorization server (LOC_W), e.g.
      its domain name.  This information may be available in the device
      certificate Cert_PK_U.

[3.2](#section-3.2).  Domain Authenticator

   The domain authenticator has a private key and a corresponding public
   key PK_V used to authenticate to the device.

   The domain authenticator needs to be able to locate the authorization
   server of the device for which LOC_W is expected to be sufficient.
   The communication between domain authenticator and authorization
   server is assumed to be mutually authenticated and protected;

Selander, et al.        Expires November 5, 2021                [Page 4]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   authentication credentials and communication security is out of
   scope, except for as specified below in this section.

   The domain authenticator may in principle use differents credentials
   for authenticating to the authorization server and to the device, for
   which PK_V is used.  However, the domain authenticator MUST prove
   possession of private key of PK_V to the authorization server since
   the authorization server is asserting (by means of the voucher to the
   device) that this credential belongs to the domain authenticator.

   In this version of the draft it is assumed that the domain
   authenticator authenticates to the authorization server with PK_V
   using some authentication protocol providing proof of possession of
   the private key, for example TLS 1.3 [[RFC8446](/doc/html/rfc8446 "\"The Transport Layer Security (TLS) Protocol Version 1.3\"")].  A future version of
   this draft may specify explicit proof of possession of the private
   key of PK_V in the voucher request, e.g., by including a signature of
   the voucher request with the private key corresponding to PK_V.

[3.3](#section-3.3).  Authorization Server

   The authorization server has the private DH key corresponding to G_W,
   which is used to secure the communication with the device (see
   [Section 4.1](#section-4.1)).

   Authentication credentials and communication security used with the
   domain authenticator is out of scope, except for the need to verify
   the possession of the private key of PK_V as specified in
   [Section 3.2](#section-3.2).

   The authorization server provides to the device the authorization
   decision for enrollment with the domain authenticator in the form of
   a voucher.  The authorization server provides information to the
   domain authenticator about the device, such as the the device's
   certificate Cert_PK_U.

   The authorization server needs to be available during the execution
   of the protocol.

[4](#section-4).  The Protocol

   Three security sessions are going on in parallel (as detailed in the
   subsections):

   o  Between device (U) and (domain) authenticator (V),

   o  between authenticator and authorization server (W), and

Selander, et al.        Expires November 5, 2021                [Page 5]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   o  between device and authorization server mediated by the
      authenticator.

   The most relevant message fields of EDHOC [[I-D.ietf-lake-edhoc](#ref-I-D.ietf-lake-edhoc)] in
   this specification are shown within brackets { ... } (see Figure 2):

   o  G_X: the x-coordinate of the ephemeral public Diffie-Hellman key
      of party U

   o  AD_1: Auxiliary Data of message_1

   o  AD_2: Auxiliary Data of message_2

   o  ID_CRED_R: data enabling the party U to obtain the credentials
      containing the public authentication key of the responder V

   o  ID_CRED_I: data enabling the party V to obtain the credentials
      containing the public authentication key of the initiator U

   o  Sig_or_MAC_2: a signature or MAC made by party V with use of the
      private key of V

   o  Sig_or_MAC_3: a signature or MAC made by party U with use of the
      private key of U

Selander, et al.        Expires November 5, 2021                [Page 6]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   U                                    V                              W
   |                                    |                              |
   |            {G_X, AD_1}             |                              |
   +----------------------------------->|                              |
   |          EDHOC message_1           |    G_X, CC, AEAD(K_1; ID_U)  |
   |                                    +----------------------------->|
   |                                    |    Voucher Request (VREQ)    |
   |                                    |                              |
   |                                    |    G_X, CERT_PK_U, Voucher   |
   |                                    |<-----------------------------+
   |                                    |    Voucher Response (VRES)   |
   |  {ID_CRED_R, Sig_or_MAC_2, AD_2}   |                              |
   |<-----------------------------------+                              |
   |          EDHOC message_2           |                              |
   |                                    |                              |
   |      {ID_CRED_I, Sig_or_MAC_3}     |                              |
   +----------------------------------->|                              |
   |          EDHOC message_3           |                              |

   where
   AD_1 = (T0, LOC_W, CC, AEAD(K1; ID_U))
   AD_2 = (T1, Voucher)
   Voucher = AEAD(K_2; V_TYPE, PK_V, G_X, ID_U)

     Figure 2: W-assisted authorization of AKE between U and V: EDHOC
      between U and V, and Voucher Request/Response between V and W.

[4.1](#section-4.1).  Device <-> Authorization Server

   The communication between device and authorization server is carried
   out via the authenticator protected between the endpoints (protocol
   between U and W in Figure 2) using an ECIES hybrid encryption scheme
   (see [[I-D.irtf-cfrg-hpke](#ref-I-D.irtf-cfrg-hpke)]): The device uses the private key
   corresponding to its ephemeral DH key G_X generated for EDHOC
   message_1 (see [Section 4.2](#section-4.2)) together with the static public DH key of
   the authorization server G_W to generate a shared secret G_XW.  The
   shared secret is used to derive AEAD encryption keys to protect data
   between device and authorization server.  The data is carried in AD_1
   and AD_2 (between device and authenticator) and in Voucher Request/
   Response (between authenticator and authorization server).

   TODO: Reference relevant ECIES scheme in [[I-D.irtf-cfrg-hpke](#ref-I-D.irtf-cfrg-hpke)].

   TODO: Define derivation of encryption keys (K_1, K_2) and nonces
   (N_1, N_2) for the both directions

   AD_1 SHALL be the following CBOR sequence:

Selander, et al.        Expires November 5, 2021                [Page 7]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   AD_1 = (
       T0:              int,
       LOC_W:           tstr,
       CC:              bstr,
       CIPHERTEXT_RQ:   bstr
   )

   where

   o  T0 is the Auxiliary Data Type (TBD in relevant IANA registry)

   and the rest is Voucher Info:

   o  LOC_W is location information about the authorization server

   o  CC is a crypto context identifier for the security context between
      the device and the authorization server

   o  'CIPHERTEXT_RQ' is the authenticated encrypted identity of the
      device with CC as Additional Data, more specifically:

   'CIPHERTEXT_RQ' is 'ciphertext' of COSE_Encrypt0 ([Section 5.2](#section-5.2)-5.3 of
   [[RFC8152](/doc/html/rfc8152 "\"CBOR Object Signing and Encryption (COSE)\"")]) computed from the following:

   o  the secret key K_1

   o  the nonce N_1

   o  'protected' is a byte string of size 0

   o  'plaintext and 'external_aad' as below:

   plaintext = (
       ID_U:            bstr
    )

   external_aad = (
       CC:              bstr
    )

   where

   o  ID_U is the identity of the device, for example a reference or
      pointer to the device certificate

   o  CC is defined above.

   AD_2 SHALL be the following CBOR sequence:

Selander, et al.        Expires November 5, 2021                [Page 8]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   AD_2 = (
       T1:             int,
       Voucher:        bstr
   )

   where

   o  T1 is the Auxiliary Data Type (TBD in relevant IANA registry)

   and 'Voucher' is defined in [Section 4.1.1](#section-4.1.1).

[4.1.1](#section-4.1.1).  Voucher

   The voucher is an assertion by the authorization server to the device
   that the authorization server has performed the relevant
   verifications and that the device is authorized to continue the
   protocol with the authenticator.  The voucher consists essentially of
   a message authentication code which binds the identity of the
   authenticator to message_1 of EDHOC.

   More specifically 'Voucher' is the 'ciphertext' of COSE_Encrypt0
   ([Section 5.2 of [RFC8152]](/doc/html/rfc8152#section-5.2)) computed from the following:

   o  the secret key K_2

   o  the nonce N_2

   o  'protected' is a byte string of size 0

   o  'plaintext' is empty (plaintext = nil)

   o  'external_aad' as below:

   external_aad = bstr .cbor external_aad_array

   external_aad_array = [
       V_TYPE:        int,
       PK_V:          bstr,
       G_X:           bstr,
       CC:            bstr,
       ID_U:          bstr
   ]

   where

   o  'V_TYPE' indicates the type of voucher used

Selander, et al.        Expires November 5, 2021                [Page 9]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   o  PK_V is a COSE_Key containing the public authentication key of the
      authenticator.  The public key MUST be an Elliptic Curve Diffie-
      Hellman key, COSE key type 'kty' = 'EC2' or 'OKP'.

      *  COSE_Keys of type OKP SHALL only include the parameters 1
         (kty), -1 (crv), and -2 (x-coordinate).  COSE_Keys of type EC2
         SHALL only include the parameters 1 (kty), -1 (crv), -2
         (x-coordinate), and -3 (y-coordinate).  The parameters SHALL be
         encoded in decreasing order.

   o  G_X is the ephemeral key of the device sent in EDHOC message_1

   o  CC and ID_U are defined in [Section 4.1](#section-4.1)

   All parameters, except 'V_TYPE', are as received in the voucher
   request (see [Section 4.3](#section-4.3)).

   TODO: Consider making the voucher a CBOR Map to indicate type of
   voucher, to indicate the feature (cf.  [Section 4.3](#section-4.3)).  Alternatively,
   include V_TYPE in 'unprotected'.

[4.2](#section-4.2).  Device <-> Authenticator

   The device and authenticator run the EDHOC protocol authenticated
   with public keys (PK_U and PK_V) of the device and the authenticator,
   see protocol between U and V in Figure 2.  The normal EDHOC
   processing is omitted here.

[4.2.1](#section-4.2.1).  Message 1

[4.2.1.1](#section-4.2.1.1).  Device processing

   The device composes EDHOC message_1 with specific parameters pre-
   configured, such as EDHOC method.  The correlation properties (see
   Section 3.1 of [[I-D.ietf-lake-edhoc](#ref-I-D.ietf-lake-edhoc)]) are defined by the transport of
   the messages.  The static public DH key G_W of the authorization
   server defines the ECDH curve of the selected cipher suite in
   SUITES_I.  As part of the normal EDHOC processing, the device
   generates the ephemeral public key G_X.  A new G_X MUST be generated
   for each execution of the protocol.  The ephemeral key G_X is reused
   in the ECIES scheme, see [Section 4.1](#section-4.1).

   The device sends EDHOC message_1 with AD_1 as specified in
   [Section 4.1](#section-4.1).

Selander, et al.        Expires November 5, 2021               [Page 10]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

[4.2.1.2](#section-4.2.1.2).  Authenticator processing

   The authenticator receives EDHOC message_1 from the device, which
   triggers the voucher request to the authorization server as described
   in [Section 4.3](#section-4.3).

[4.2.2](#section-4.2.2).  Message 2

[4.2.2.1](#section-4.2.2.1).  Authenticator processing

   The authenticator receives the voucher response from the
   authorization server as described in [Section 4.3](#section-4.3).

   The authenticator sends EDHOC message_2 to the device with the
   voucher (see [Section 4.1](#section-4.1)) in AD_2.  The public key PK_V is carried in
   ID_CRED_R of message_2 encoded as a COSE header_map, see Section 4.1
   of [[I-D.ietf-lake-edhoc](#ref-I-D.ietf-lake-edhoc)].  The Sig_or_MAC_2 field calculated using
   the private key corresponding to PK_V is either signature or MAC
   depending on EDHOC method.

[4.2.2.2](#section-4.2.2.2).  Device processing

   In addition to normal EDHOC verifications, the device MUST verify the
   voucher by calculating the same message authentication code as when
   it was generated (see [Section 4.1.1](#section-4.1.1)) and compare with what was
   received in message_2.

   The input in this calculation includes:

   o  The ephemeral key G_X, sent in message_1.

   o  The identity ID_U, sent in message_1.

   o  The public key of the authenticator PK_V, received in message_2.

   If the voucher does not verify, the device MUST discontinue the
   protocol.

[4.2.3](#section-4.2.3).  Message 3

[4.2.3.1](#section-4.2.3.1).  Device processing

   If all verifications are passed, the device sends EDHOC message_3.

   The message field ID_CRED_I contains data enabling the authenticator
   to retrieve the public key of the device, PK_U.  Since the
   authenticator before sending message_2 received a certificate of PK_U

Selander, et al.        Expires November 5, 2021               [Page 11]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   from the authorization server (see [Section 4.3](#section-4.3)), ID_CRED_I SHALL be a
   COSE header_map of type 'kid' with the empty byte string as value:

   ID_CRED_I =
   {
     4 : h''
   }

   The Sig_or_MAC_3 field calculated using the private key corresponding
   to PK_U is either signature or MAC depending on EDHOC method.

   AD_3 MAY contain an enrolment request, see
   [[I-D.mattsson-cose-cbor-cert-compress](#ref-I-D.mattsson-cose-cbor-cert-compress)], or other request which the
   device is now authorized to make.

   EDHOC message_3 may be combined with an OSCORE request, see
   [[I-D.palombini-core-oscore-edhoc](#ref-I-D.palombini-core-oscore-edhoc)].

[4.2.3.2](#section-4.2.3.2).  Authenticator processing

   The authenticator performs the normal EDHOC verifications of
   message_3, with the exception that the Sig_or_MAC_3 field MUST be
   verified using the public key included in Cert_PK_U (see
   [Section 4.3.2](#section-4.3.2)) received from the authorization server.  The
   authenticator MUST ignore any key related information obtained in
   ID_CRED_I.

   This enables the authenticator to verify that message_3 was generated
   by the device authorized by the authorization server as part of the
   associated Voucher Request/Response procedure (see [Section 4.3](#section-4.3)).

[4.3](#section-4.3).  Authenticator <-> Authorization Server

   The authenticator and authorization server are assumed to have, or to
   be able to, set up a secure connection, for example TLS 1.3
   authenticated with certificates.  The authenticator is assumed to
   authenticate with the public key PK_V, see [Section 3.2](#section-3.2).

   This secure connection protects the Voucher Request/Response Protocol
   (see protocol between V and W in Figure 2).

   The ephemeral public key G_X sent in EDHOC message_1 from device to
   authenticator serves as challenge/response nonce for the Voucher
   Request/Response Protocol, and binds together instances of the two
   protocols.

Selander, et al.        Expires November 5, 2021               [Page 12]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

[4.3.1](#section-4.3.1).  Voucher Request

[4.3.1.1](#section-4.3.1.1).  Authenticator processing

   Unless already in place, the authenticator and the authorization
   server establish a secure connection.  The autenticator uses G_X
   received from the device as a nonce associated to this connection
   with the authorization server.  If the same value of the nonce G_X is
   already used for a connection with this or other authorization
   server, the protocol SHALL be discontinued.

   The authenticator sends the voucher request to the authorization
   server.  The Voucher_Request SHALL be a CBOR array as defined below:

   Voucher_Request = [
       G_X:             bstr,
       CC:              bstr,
       CIPHERTEXT_RQ:   bstr
   ]

   where the parameters are defined in [Section 4.1](#section-4.1).

   TODO: Add in VREQ the optional parameters ?PK_V:bstr, and ?PoP:bstr
   to support the case when V uses different keys to authenticate to U
   and W.  One case to study is when V authenticates to U with static DH
   and to W with signature.

[4.3.1.2](#section-4.3.1.2).  Authorization Server processing

   The authorization server receives the voucher request, verifies and
   decrypts the identity ID_U of the device, and associates the nonce
   G_X to ID_U.  If G_X is not unique among nonces associated to this
   identity, the protocol SHALL be discontinued.

[4.3.2](#section-4.3.2).  Voucher Response

[4.3.2.1](#section-4.3.2.1).  Authorization Server processing

   The authorization server uses the identity of the device, ID_U, to
   look up the device certificate, Cert_PK_U.

   The authorization server retrieves the public key of V used to
   authenticate the secure connection with the authenticator, and
   constructs the corresponding COSE_Key as defined in [Section 4.1.1](#section-4.1.1).

   The authorization server generates the voucher response and sends it
   to the authenticator over the secure connection.  The
   Voucher_Response SHALL be a CBOR array as defined below:

Selander, et al.        Expires November 5, 2021               [Page 13]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   Voucher_Response = [
       G_X:            bstr,
       CERT_PK_U:      bstr,
       Voucher:        bstr
   ]

   where

   o  G_X is copied from the associated voucher request.

   o  CERT_PK_U is the device certificate of the public key PK_U, issued
      by a trusted third party.  The format of this certificate is out
      of scope.

   o  The voucher is defined in [Section 4.1.1](#section-4.1.1).

[4.3.2.2](#section-4.3.2.2).  Authenticator processing

   The authenticator receives the voucher response from the
   authorization server over the secure connection.  If the received G_X
   does not match the value of the nonce associated to the secure
   connection, the protocol SHALL be discontinued.

   The authenticator verifies the certificate CERT_PK_U.

   TODO: The voucher response may contain a "Voucher-info" field as an
   alternative to make the Voucher a CBOR Map (see [Section 4.1](#section-4.1))

[5](#section-5).  ACE Profile

   The messages specified in this document may be carried between the
   endpoints in various protocols.  This section defines an embedding as
   a profile of the ACE framework (see [Appendix C](#appendix-C) of
   [[I-D.ietf-ace-oauth-authz](#ref-I-D.ietf-ace-oauth-authz)]).

   U plays the role of the ACE Resource Server (RS).  V plays the role
   of the ACE Client (C).  W plays the role of the ACE Authorization
   Server (AS).

   C and RS use the Auxiliary Data in the EDHOC protocol to communicate.
   C and RS use the EDHOC protocol to protect their communication.
   EDHOC also provides mutual authentication of C and RS, assisted by
   the AS.

Selander, et al.        Expires November 5, 2021               [Page 14]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

[5.1](#section-5.1).  Protocol Overview

          RS                                C                     AS
          |          EDHOC message_1        |                     |
          |  AD1=AS Request Creation Hints  |                     |
          |-------------------------------->|     POST /token     |
          |                                 |-------------------->|
          |                                 |                     |
          |                                 | Access Token +      |
          |          EDHOC message_2        |  Access Information |
          |          AD2=Access Token       |<--------------------|
          |<--------------------------------|                     |
          |          EDHOC message_3        |                     |
          |-------------------------------->|                     |

             Figure 3: Overview of the protocol mapping to ACE

   RS proactively sends the AS Request Creation Hints message to C to
   signal the information on where C can reach the AS.  RS piggybacks
   the AS Request Creation Hints message using Auxiliary Data of EDHOC
   message_1.  Before continuing the EDHOC exchange, based on the AS
   Request Creation Hints information, C sends a POST request to the
   token endpoint at the AS requesting the access token.  The AS issues
   an assertion to C that is cryptographically protected based on the
   secret shared between the AS and RS.  In this profile, the assertion
   is encoded as a Bearer Token.  C presents this token to RS in the
   Auxiliary Data of the EDHOC message_2.  RS verifies the token based
   on the possession of the shared secret with the AS and authenticates
   C.

[5.2](#section-5.2).  AS Request Creation Hints

   Parameters that can appear in the AS Request Creation Hints message
   are specified in Section 5.1.2. of [[I-D.ietf-ace-oauth-authz](#ref-I-D.ietf-ace-oauth-authz)].  RS
   MUST use the "AS" parameter to transport LOC_W, i.e. an absolute URI
   where C can reach the AS.  RS MUST use the "audience" parameter to
   transport the CBOR sequence consisting of two elements: CC, the
   crypto context; CIPHERTEXT_RQ, the authenticated encrypted identity
   of the RS.  The "cnonce" parameter MUST be implied to G_X, i.e. the
   ephemeral public key of the RS in the underlying EDHOC exchange.  The
   "cnonce" parameter is not carried in the AS Request Creation Hints
   message for byte saving reasons.  AS Request Creation Hints MUST be
   carried within Auxiliary Data of the EDHOC message_1 (AD_1).

   An example AD_1 value in CBOR diagnostic notation is shown below:

Selander, et al.        Expires November 5, 2021               [Page 15]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   AD_1:
   {
       "AS" : "coaps://as.example.com/token",
       "audience": << h'73',h'737570657273...' >>
   }

[5.3](#section-5.3).  Client-to-AS Request

   The protocol that provides the secure connection between C and the AS
   is out-of-scope.  This can, for example, be TLS 1.3.  What is
   important is that the two peers are mutually authenticated, and that
   the secure connection provides message integrity, confidentiality and
   freshness.  It is also necessary for the AS to be able to extract the
   public key of C used in the underlying security handshake.

   C sends the POST request to the token endpoint at the AS following
   Section 5.6.1. of [[I-D.ietf-ace-oauth-authz](#ref-I-D.ietf-ace-oauth-authz)].  C MUST set the
   "audience" parameter to the value received in AS Request Creation
   Hints.  C MUST set the "cnonce" parameter to G_X, the ephemeral
   public key of RS in the EDHOC exchange.

   An example exchange using CoAP and CBOR diagnostic notation is shown
   below:

       Header: POST (Code=0.02)
       Uri-Host: "as.example.com"
       Uri-Path: "token"
       Content-Format: "application/ace+cbor"
       Payload:
       {
           "audience" : << h'73',h'737570657273...' >>
           "cnonce" : h'756E73686172...'
       }

[5.4](#section-5.4).  AS-to-Client Response

   Given successful authorization of C at the AS, the AS responds by
   issuing a Bearer token and retrieves the certificate of RS on behalf
   of C.  The access token and the certificate are passed back to C, who
   uses it to complete the EDHOC exchange.  This document extends the
   ACE framework by registering a new Access Information parameter:

   rsp_ad: OPTIONAL.  Carries additional information from the AS to C
   associated with the access token.

   When responding to C, the AS MUST set the "ace_profile" parameter to
   "edhoc-authz".  The AS MUST set the "token_type" parameter to
   "Bearer".  The access token MUST be formatted as specified in

Selander, et al.        Expires November 5, 2021               [Page 16]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   [Section 4.1.1](#section-4.1.1).  The AS MUST set the "rsp_ad" parameter to the
   certificate of RS.  To be able to do so, AS first needs to decrypt
   the audience value, and based on it retrieve the corresponding RS
   certificate.

   An example AS response to C is shown below:

       2.01 Created
       Content-Format: application/ace+cbor
       Max-Age: 3600
       Payload:
       {
           "ace_profile" : "edhoc-authz",
           "token_type" : "Bearer",
           "access_token" : h'666F726571756172746572...',
           "rsp_ad" : h'61726973746F64656D6F637261746963616C...'
       }

   TODO: Add cnonce = G_X to this message to match the current version
   of the voucher response.

[6](#section-6).  Security Considerations

   TODO: Identity protection of device

   TODO: Use of G_X as ephemeral key between device and authenticator,
   and between device and authorization server

[7](#section-7).  IANA Considerations

   TODO: CC registry

   TODO: Voucher type registry

   TODO: register rsp_ad ACE parameter

[8](#section-8).  Informative References

   [I-D.ietf-6tisch-minimal-security]
              Vucinic, M., Simon, J., Pister, K., and M. Richardson,
              "Constrained Join Protocol (CoJP) for 6TiSCH", [draft-ietf-](/doc/html/draft-ietf-6tisch-minimal-security-15)
              [6tisch-minimal-security-15](/doc/html/draft-ietf-6tisch-minimal-security-15) (work in progress), December
              2019.

Selander, et al.        Expires November 5, 2021               [Page 17]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   [I-D.ietf-ace-oauth-authz]
              Seitz, L., Selander, G., Wahlstroem, E., Erdtman, S., and
              H. Tschofenig, "Authentication and Authorization for
              Constrained Environments (ACE) using the OAuth 2.0
              Framework (ACE-OAuth)", [draft-ietf-ace-oauth-authz-40](/doc/html/draft-ietf-ace-oauth-authz-40)
              (work in progress), April 2021.

   [I-D.ietf-lake-edhoc]
              Selander, G., Mattsson, J., and F. Palombini, "Ephemeral
              Diffie-Hellman Over COSE (EDHOC)", [draft-ietf-lake-](/doc/html/draft-ietf-lake-edhoc-06)
              [edhoc-06](/doc/html/draft-ietf-lake-edhoc-06) (work in progress), April 2021.

   [I-D.ietf-lake-reqs]
              Vucinic, M., Selander, G., Mattsson, J. P., and D. Garcia-
              Carrillo, "Requirements for a Lightweight AKE for OSCORE",
              [draft-ietf-lake-reqs-04](/doc/html/draft-ietf-lake-reqs-04) (work in progress), June 2020.

   [I-D.irtf-cfrg-hpke]
              Barnes, R. L., Bhargavan, K., Lipp, B., and C. A. Wood,
              "Hybrid Public Key Encryption", [draft-irtf-cfrg-hpke-08](/doc/html/draft-irtf-cfrg-hpke-08)
              (work in progress), February 2021.

   [I-D.mattsson-cose-cbor-cert-compress]
              Raza, S., Hoeglund, J., Selander, G., Mattsson, J. P., and
              M. Furuhed, "CBOR Encoded X.509 Certificates (C509
              Certificates)", [draft-mattsson-cose-cbor-cert-compress-08](/doc/html/draft-mattsson-cose-cbor-cert-compress-08)
              (work in progress), February 2021.

   [I-D.palombini-core-oscore-edhoc]
              Palombini, F., Tiloca, M., Hoeglund, R., Hristozov, S.,
              and G. Selander, "Combining EDHOC and OSCORE", [draft-](/doc/html/draft-palombini-core-oscore-edhoc-02)
              [palombini-core-oscore-edhoc-02](/doc/html/draft-palombini-core-oscore-edhoc-02) (work in progress),
              February 2021.

   [I-D.selander-ace-coap-est-oscore]
              Selander, G., Raza, S., Furuhed, M., Vucinic, M., and T.
              Claeys, "Protecting EST Payloads with OSCORE", [draft-](/doc/html/draft-selander-ace-coap-est-oscore-04)
              [selander-ace-coap-est-oscore-04](/doc/html/draft-selander-ace-coap-est-oscore-04) (work in progress),
              November 2020.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", [BCP 14](/doc/html/bcp14), [RFC 2119](/doc/html/rfc2119),
              DOI 10.17487/RFC2119, March 1997,
              <<https://www.rfc-editor.org/info/rfc2119>>.

Selander, et al.        Expires November 5, 2021               [Page 18]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   [RFC3748]  Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H.
              Levkowetz, Ed., "Extensible Authentication Protocol
              (EAP)", [RFC 3748](/doc/html/rfc3748), DOI 10.17487/RFC3748, June 2004,
              <<https://www.rfc-editor.org/info/rfc3748>>.

   [RFC7228]  Bormann, C., Ersue, M., and A. Keranen, "Terminology for
              Constrained-Node Networks", [RFC 7228](/doc/html/rfc7228),
              DOI 10.17487/RFC7228, May 2014,
              <<https://www.rfc-editor.org/info/rfc7228>>.

   [RFC8152]  Schaad, J., "CBOR Object Signing and Encryption (COSE)",
              [RFC 8152](/doc/html/rfc8152), DOI 10.17487/RFC8152, July 2017,
              <<https://www.rfc-editor.org/info/rfc8152>>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in [RFC](/doc/html/rfc2119)
              [2119](/doc/html/rfc2119) Key Words", [BCP 14](/doc/html/bcp14), [RFC 8174](/doc/html/rfc8174), DOI 10.17487/RFC8174,
              May 2017, <<https://www.rfc-editor.org/info/rfc8174>>.

   [RFC8446]  Rescorla, E., "The Transport Layer Security (TLS) Protocol
              Version 1.3", [RFC 8446](/doc/html/rfc8446), DOI 10.17487/RFC8446, August 2018,
              <<https://www.rfc-editor.org/info/rfc8446>>.

Authors' Addresses

   Goeran Selander
   Ericsson AB

   Email: goran.selander@ericsson.com

   John Preuss Mattsson
   Ericsson AB

   Email: john.mattsson@ericsson.com

   Malisa Vucinic
   INRIA

   Email: malisa.vucinic@inria.fr

   Michael Richardson
   Sandelman Software Works

   Email: mcr+ietf@sandelman.ca

Selander, et al.        Expires November 5, 2021               [Page 19]
```

---

```

Internet-Draft     Lightweight Authorization for AKE.           May 2021

   Aurelio Schellenbaum
   Institute of Embedded Systems, ZHAW

   Email: aureliorubendario.schellenbaum@zhaw.ch

Selander, et al.        Expires November 5, 2021               [Page 20]

```

[Datatracker](/doc/draft-selander-ace-ake-authz/)

draft-selander-ace-ake-authz-03

This is an older version of an Internet-Draft whose latest revision state is "Replaced".

* Info
* Contents
* Prefs

| Document | Document type |  | This is an older version of an Internet-Draft whose latest revision state is "Replaced". This document is an Internet-Draft (I-D). Anyone may submit an I-D to the IETF. This I-D is **not endorsed by the IETF** and has **no formal standing** in the [IETF standards process](/doc/rfc2026/). |
| --- | --- | --- | --- |
|  | Select version |  | * [00](/doc/html/draft-selander-ace-ake-authz-00) * [01](/doc/html/draft-selander-ace-ake-authz-01) * [02](/doc/html/draft-selander-ace-ake-authz-02) * [03](/doc/html/draft-selander-ace-ake-authz-03) * [04](/doc/html/draft-selander-ace-ake-authz-04) * [05](/doc/html/draft-selander-ace-ake-authz-05) |
|  | Compare versions |  | draft-selander-ace-ake-authz-05  draft-selander-ace-ake-authz-04  draft-selander-ace-ake-authz-03  draft-selander-ace-ake-authz-02  draft-selander-ace-ake-authz-01  draft-selander-ace-ake-authz-00   draft-selander-ace-ake-authz-05  draft-selander-ace-ake-authz-04  draft-selander-ace-ake-authz-03  draft-selander-ace-ake-authz-02  draft-selander-ace-ake-authz-01  draft-selander-ace-ake-authz-00   Side-by-side  Inline |
|  | Authors |  | [Göran Selander](/person/goran.selander%40ericsson.com "Datatracker profile of Göran Selander") , [John Preuß Mattsson](/person/john.mattsson%40gmail.com "Datatracker profile of John Preuß Mattsson") , [Mališa Vučinić](/person/malisa.vucinic%40inria.fr "Datatracker profile of Mališa Vučinić") , [Michael Richardson](/person/mcr%2Bietf%40sandelman.ca "Datatracker profile of Michael Richardson") , [Aurelio Schellenbaum](/person/scnm%40zhaw.ch "Datatracker profile of Aurelio Schellenbaum") |
|  | Replaced by |  | [draft-selander-lake-authz](/doc/html/draft-selander-lake-authz "Lightweight Authorization for EDHOC")[draft-selander-lake-authz](/doc/html/draft-selander-lake-authz "Lightweight Authorization using Ephemeral Diffie-Hellman Over COSE") |
|  | RFC stream |  | (None) |
|  | Other formats |  | [txt](https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt) [xml](https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.xml) [bibtex](/doc/draft-selander-ace-ake-authz/03/bibtex/) [bibxml](/doc/bibxml3/draft-selander-ace-ake-authz-03.xml) |

[Report a datatracker bug](https://github.com/ietf-tools/datatracker/issues/new/choose)

Show sidebar by default

Yes

No

Tab to show by default

Info

Contents

HTMLization configuration

HTMLize the plaintext

Plaintextify the HTML

Maximum font size

Page dependencies

Inline

Reference

Citation links

 Go to reference section

Go to linked document

![](//analytics.ietf.org/piwik.php?idsite=7)



=== Content from github.com_09e22a56_20250115_134020.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16730)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16730)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=RIOT-OS%2FRIOT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RIOT-OS](/RIOT-OS)
/
**[RIOT](/RIOT-OS/RIOT)**
Public

* [Notifications](/login?return_to=%2FRIOT-OS%2FRIOT) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2FRIOT-OS%2FRIOT)
* [Star
   5.4k](/login?return_to=%2FRIOT-OS%2FRIOT)

* [Code](/RIOT-OS/RIOT)
* [Issues
  382](/RIOT-OS/RIOT/issues)
* [Pull requests
  387](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects
  0](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

Additional navigation options

* [Code](/RIOT-OS/RIOT)
* [Issues](/RIOT-OS/RIOT/issues)
* [Pull requests](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# net/gcoap: add functions to read and set the next message id #16730

 Closed

[janosbrodbeck](/janosbrodbeck)
wants to merge
1
commit into
[RIOT-OS:master](/RIOT-OS/RIOT/tree/master "RIOT-OS/RIOT:master")
from
[janosbrodbeck:pr/gcoap/msg\_id\_init\_read](/janosbrodbeck/RIOT/tree/pr/gcoap/msg_id_init_read "janosbrodbeck/RIOT:pr/gcoap/msg_id_init_read")

 Closed

# [net/gcoap: add functions to read and set the next message id](#top) #16730

[janosbrodbeck](/janosbrodbeck)
wants to merge
1
commit into
[RIOT-OS:master](/RIOT-OS/RIOT/tree/master "RIOT-OS/RIOT:master")
from
[janosbrodbeck:pr/gcoap/msg\_id\_init\_read](/janosbrodbeck/RIOT/tree/pr/gcoap/msg_id_init_read "janosbrodbeck/RIOT:pr/gcoap/msg_id_init_read")

[Conversation
11](/RIOT-OS/RIOT/pull/16730)
[Commits
1](/RIOT-OS/RIOT/pull/16730/commits)
[Checks
0](/RIOT-OS/RIOT/pull/16730/checks)
[Files changed](/RIOT-OS/RIOT/pull/16730/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=60&v=4)](/janosbrodbeck)

Copy link

Member

### @janosbrodbeck **[janosbrodbeck](/janosbrodbeck)** commented [Aug 13, 2021](#issue-970542355)

### Contribution description

This PR adds two new functions to gcoap, which allow to read the next message ID and to set it to a given value.

Currently, the next message ID is randomly generated while init, but that is not always wanted. I need to set it manually.

I intentionally named the function "read" to make it indirectly clear that this is not part of the regular use-case of gcoap. Well, I hope it does that with this naming :D

### Testing procedure

Apply this small patch for the gcoap example:

```
diff --git a/examples/gcoap/gcoap_cli.c b/examples/gcoap/gcoap_cli.c
index f089a65c7b..ab3080b947 100644
--- a/examples/gcoap/gcoap_cli.c
+++ b/examples/gcoap/gcoap_cli.c
@@ -328,6 +328,7 @@ int gcoap_cli_cmd(int argc, char **argv)
 #endif
         printf(" CLI requests sent: %u\n", req_count);
         printf("CoAP open requests: %u\n", open_reqs);
+        printf("Next message ID: %u\n", gcoap_read_next_message_id());
         printf("Configured Proxy: ");
         if (_proxied) {
             char addrstr[IPV6_ADDR_MAX_STR_LEN];
@@ -488,6 +489,6 @@ void gcoap_cli_init(void)
         printf("gcoap: cannot add credential to DTLS sock: %d\n", res);
     }
 #endif
-
+    gcoap_set_next_message_id(10);
     gcoap_register_listener(&_listener);
 }

```

1. `coap info` shows the next message ID. It is set to 10 by default with this patch.
2. Send a request to a server (request does not need to succeed)
3. Next message ID should be 11

### Issues/PRs references

Sorry, something went wrong.

All reactions

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=40&v=4)](/janosbrodbeck)

`[net/gcoap: add functions to read and set the next message id](/RIOT-OS/RIOT/pull/16730/commits/4376af9ea34b1d532e9017892235b715e297795e "net/gcoap: add functions to read and set the next message id")`

`[4376af9](/RIOT-OS/RIOT/pull/16730/commits/4376af9ea34b1d532e9017892235b715e297795e)`

 [![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=40&u=935b21fae4a972d35c91fd722c884a99787bdcea&v=4)](/janosbrodbeck)
[janosbrodbeck](/janosbrodbeck)
requested review from
[cgundogan](/cgundogan),
[haukepetersen](/haukepetersen),
[miri64](/miri64) and
[PeterKietzmann](/PeterKietzmann)
as [code owners](/RIOT-OS/RIOT/blob/1fd645ebcddb0ca4c971c3616c4e86920c3fc1dc/CODEOWNERS#L128)
[August 13, 2021 16:12](#event-5156618219)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
[Area: CoAP](/RIOT-OS/RIOT/labels/Area%3A%20CoAP)
Area: Constrained Application Protocol implementations
[Area: network](/RIOT-OS/RIOT/labels/Area%3A%20network)
Area: Networking
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System
labels
[Aug 13, 2021](#event-5156619110)

 [![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=40&v=4)](/benpicco)
[benpicco](/benpicco)
requested a review
from [chrysn](/chrysn)
[August 13, 2021 16:31](#event-5156700909)

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=80&v=4)](/benpicco)

Copy link

Contributor

### **[benpicco](/benpicco)** commented [Aug 13, 2021](#issuecomment-898586941)

| Under what circumstances does it make sense to control the message id? Isn't it like a sequence number that is only used internally? |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Aug 13, 2021](#issuecomment-898591840) via email

| Looks sound technically. I can't follow the "read" rationale, have you considered "gcoap\_peek\_message\_id"? (Given it's something that usually auto-increments, and I understand the accessor to not have that side effect). Just: Why would you ever need to set the next MID? After all, exposing API that's really supposed to work automatically adds pitfalls for users that might be tempted to use CoAP outside of what it's designed for, and understanding why you need it here might help shape the warning the function comes with. (Right now I'd say "just never use that outside of debugging or if you try to reproduce a particular byte pattern on the wire for testing", but your PR implies you have a case). (For cross-reference, I had to touch this around the sending of separate responses ([#14395](https://github.com/RIOT-OS/RIOT/pull/14395)), but there I had to \*take\* a new MID, which would imply yet a different API and not need a setter then.) |
| --- |

All reactions

Sorry, something went wrong.

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=80&u=935b21fae4a972d35c91fd722c884a99787bdcea&v=4)](/janosbrodbeck)

Copy link

Member

Author

### **[janosbrodbeck](/janosbrodbeck)** commented [Aug 13, 2021](#issuecomment-898597093)

| Under what circumstances does it make sense to control the message id? Isn't it like a sequence number that is only used internally?  When you want to maintain the next message ID between reboots or anything that reinitialize gcoap. Run into the scenario that a server maintained a larger message cache. After reboot, I got randomly a recent used message ID -> server responded with the previous response from the previous request because it had the same message ID. But then gcoap couldn't match because of a token mismatch.  Technically, this is not wrong of the server, even if it can forecast the scenario by the given token. According to the RFC, however, the token does not play a role here, only the message ID.  It may be a specific problem, and you may have to question the server here as well...but my main thought is primarily "I want to maintain the next message ID between reboots/hibernations". |
| --- |

All reactions

Sorry, something went wrong.

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=80&v=4)](/benpicco)

Copy link

Contributor

### **[benpicco](/benpicco)** commented [Aug 13, 2021](#issuecomment-898599776)

| Hm but how many messages does the server cache that even with just a 16 bit message ID a collision is likely? To me that sounds more like a case of a poor source of randomness.  Do you still have the issue if you use `prng_hwrng`? |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Aug 13, 2021](#issuecomment-898607884) via email

| That does make sense (although I'm surprised it is hit ... EXCHANGE\_LIFETIME defaults to 247 seconds, but yeah at 100 requests per second this hits 50-50 on reaching the cache after a reboot, and at 10/s it's still 4% by the back of the envelope). API-wise, I'd suggest a different approach though: gcoap could define an opaque type (OK no such thing in C, but say in the docs that the fields may change) describing its state, with a `gcoap\_hibernate\_dump(\*type)` and a `gcoap\_resume\_from(const \*type)` function. The type's content would depend on build flags, would always contain MIDs but possibly also token (making reboots unnoticable to those observing token values) and possibly DTLS or OSCORE resumption data later. Of course, if as Ben suggested it's all just about lack of randomness, then the same approach applies but to the RNG ;-) |
| --- |

All reactions

Sorry, something went wrong.

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=80&v=4)](/benpicco)

Copy link

Contributor

### **[benpicco](/benpicco)** commented [Aug 14, 2021](#issuecomment-898910928)

| I would really prefer if we could avoid such a workaround and instead make sure the PRNG is properly seeded across reboots if no HWRNG is available. If we can store a next message ID we could as well store a next seed - and that would benefit all users of functionality. |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Aug 14, 2021](#issuecomment-898946834) via email

| Janos, can you clarify whether MIDs collide due to lack of entropy or due to large message numbers? |
| --- |

All reactions

Sorry, something went wrong.

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=80&u=935b21fae4a972d35c91fd722c884a99787bdcea&v=4)](/janosbrodbeck)

Copy link

Member

Author

### **[janosbrodbeck](/janosbrodbeck)** commented [Aug 14, 2021](#issuecomment-898961380)

| I've checked and the `prng_hwrng` module is used. I had also looked at the distribution of the generated message ID after reboots two weeks ago, and that certainly looked random to me and not pseudorandom with a seed.  The message cache also does not hold a number of messages, but for a fixed period of time (server is based on californium). This scenario occurs very, very rarely, but it did happen. We are not even necessarily talking about a high number of messages. Reducing the cache time will probably solve the problem completely (test is already scheduled for next week) for my case, but you have to choose your traffic, cache and reboot timings wisely so that you have no chance for this problem at all.  I don't consider restoring the previous message ID as a workaround. I see this as a complete solution approach, because the probability, as small as it is, is given that after a reboot you get an identical message ID to the last X. And the consequence is that the client in case of CON messages tries the request several times (depending on the number of retransmissions) without success.  I'll take another look at it, I just don't have the hardware for it right now. |
| --- |

 👍
1
 benpicco reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Aug 16, 2021](#issuecomment-899602078) via email

| In light of that I'd consider the general issue worth pursuing, albeit with the preference that it's exposed API-wise as some kind of persisting state. It may be even worth considering to phrase the persistence more generically (like, OS-wide data to store for resumption after a shutdown), even if the only user of it is gcoap (and I'd suppose an RNG would be next), but if that's out of scope for here I'd understand and see it as a prototype for future "store this and restore later" parts that may be subsumed in an OS-wide thing. |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Sep 12, 2021](#issuecomment-917690813)

| How shall we continue on this?  I have a pretty concrete idea already on how system-wide extensible permission with minimal wear on the flash could be done, but don't get around to implementing this now.  [@janosbrodbeck](https://github.com/janosbrodbeck), what were your plans for backing the numbers? When would you have planned to extract the numbers? Presumably on controlled shutdowns ... hbo uncontrolled ones? Would they work also if the CoAP stack (really, on long term RIOT as a whole) called some "please persist this now" event? |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
mentioned this pull request
[Sep 14, 2021](#ref-issue-995683197)

[ieee802154\_security: Nonce is reused after reboot
#16844](/RIOT-OS/RIOT/issues/16844)

Open

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=80&u=935b21fae4a972d35c91fd722c884a99787bdcea&v=4)](/janosbrodbeck)

Copy link

Member

Author

### **[janosbrodbeck](/janosbrodbeck)** commented [Nov 21, 2021](#issuecomment-974732961)

| [@janosbrodbeck](https://github.com/janosbrodbeck), what were your plans for backing the numbers? When would you have planned to extract the numbers? Presumably on controlled shutdowns ... hbo uncontrolled ones? Would they work also if the CoAP stack (really, on long term RIOT as a whole) called some "please persist this now" event?  Only controlled shutdowns were planned for the first time. A persist-event would imho only help, when a generic API would exist for that which then calls all supported/persist-enabled modules to persist now. That would then replace module specific persistance calls before a shutdown. If I got your idea correct.  How shall we continue on this?  I won't be working on the topic for the foreseeable future. I would close this PR, if that is okay. If someone else comes up with another idea/implementation that would be great. |
| --- |

All reactions

Sorry, something went wrong.

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=40&u=935b21fae4a972d35c91fd722c884a99787bdcea&v=4)](/janosbrodbeck)
[janosbrodbeck](/janosbrodbeck)
closed this
[Nov 27, 2021](#event-5680179508)

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
mentioned this pull request
[Dec 24, 2021](#ref-pullrequest-1086917664)

[cpu: add flash\_writable section to linker script
#17436](/RIOT-OS/RIOT/pull/17436)
 Merged

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
mentioned this pull request
[Nov 29, 2022](#ref-pullrequest-1467293125)

[nanocoap: add coap\_next\_msg\_id()
#18991](/RIOT-OS/RIOT/pull/18991)
 Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fpull%2F16730)

Reviewers

[![@cgundogan](https://avatars.githubusercontent.com/u/739129?s=40&v=4)](/cgundogan) [cgundogan](/cgundogan)

 Awaiting requested review from cgundogan

[![@haukepetersen](https://avatars.githubusercontent.com/u/620834?s=40&v=4)](/haukepetersen) [haukepetersen](/haukepetersen)

 Awaiting requested review from haukepetersen

[![@miri64](https://avatars.githubusercontent.com/u/675644?s=40&v=4)](/miri64) [miri64](/miri64)

 Awaiting requested review from miri64

 miri64 is a code owner

[![@PeterKietzmann](https://avatars.githubusercontent.com/u/7765855?s=40&v=4)](/PeterKietzmann) [PeterKietzmann](/PeterKietzmann)

 Awaiting requested review from PeterKietzmann

 PeterKietzmann is a code owner

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn) [chrysn](/chrysn)

 Awaiting requested review from chrysn

Assignees

No one assigned

Labels

[Area: CoAP](/RIOT-OS/RIOT/labels/Area%3A%20CoAP)
Area: Constrained Application Protocol implementations
[Area: network](/RIOT-OS/RIOT/labels/Area%3A%20network)
Area: Networking
[Area: sys](/RIOT-OS/RIOT/labels/Area%3A%20sys)
Area: System

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@janosbrodbeck](https://avatars.githubusercontent.com/u/5045674?s=52&v=4)](/janosbrodbeck) [![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=52&v=4)](/benpicco) [![@chrysn](https://avatars.githubusercontent.com/u/442326?s=52&v=4)](/chrysn)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_211a9ec8_20250115_091133.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fissues%2F16844)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fissues%2F16844)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=RIOT-OS%2FRIOT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RIOT-OS](/RIOT-OS)
/
**[RIOT](/RIOT-OS/RIOT)**
Public

* [Notifications](/login?return_to=%2FRIOT-OS%2FRIOT) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2FRIOT-OS%2FRIOT)
* [Star
   5.4k](/login?return_to=%2FRIOT-OS%2FRIOT)

* [Code](/RIOT-OS/RIOT)
* [Issues
  382](/RIOT-OS/RIOT/issues)
* [Pull requests
  387](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects
  0](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

Additional navigation options

* [Code](/RIOT-OS/RIOT)
* [Issues](/RIOT-OS/RIOT/issues)
* [Pull requests](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FRIOT-OS%2FRIOT%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# ieee802154\_security: Nonce is reused after reboot #16844

Open

[chrysn](/chrysn) opened this issue
Sep 14, 2021
· 10 comments

Open

# [ieee802154\_security: Nonce is reused after reboot](#top) #16844

[chrysn](/chrysn) opened this issue
Sep 14, 2021
· 10 comments

Labels
[Area: security](/RIOT-OS/RIOT/labels/Area%3A%20security)
Area: Security-related libraries and subsystems
[Type: bug](/RIOT-OS/RIOT/labels/Type%3A%20bug)
The issue reports a bug / The PR fixes a bug (including spelling errors)

## Comments

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

### **[chrysn](/chrysn)** commented [Sep 14, 2021](#issue-995683197)

| Description The frame counter used with ieee802154\_security is initialized with 0 at startup. While it is protected against overflow, it is not protected against being reset, and that reset happens whenever the device restarts.  As the key is flashed into the device in ieee802154\_security's normal operation, and the sender LL address is constant per device, the same nonce (varying only through the resetting frame counter) is used in the AES encryption multiple times. Reuse of the same (nonce, key) breaks confidentiality guarantees.  (AES-CCM is used here, so AIU it's [not as bad](https://crypto.stackexchange.com/questions/26790/how-bad-it-is-using-the-same-iv-twice-with-aes-gcm) as if GCM were used, when there'd be key leakage). Steps to reproduce the issue (All done on microbit-v2; I have high confidence in this working on any 802.15.4 encryption capable device).   * Sniff for packages, eg. by building the default module. * Build the gcoap example with `USEMODULE+=ieee802154_security` * Send out a GET request to the sniffer module, path `/hello_world/coap` * Repeat the request a few times (to cancel any jitter in the number of messages sent during startup) * Reboot the device, eg. by power cycling it * Send out GET requests to the same address, path `/.well-known/core`  Expected results  * Requests after the reboot use different sequence numbers.  Actual results  * Requests after the reboot start from the same zero sequence number again. * Requests have byte-wise identical requests in regions of equal content, eg. (asterisks mine)  ``` ~~ SNIP  0 - size:  45 byte, type: NETTYPE_UNDEF (0) 00000000  06  05  00  00  00  9B  51  C4  68  F6  D4  E9  4D  96 *89  5E* 00000010  1F  F2  60  BC *95* 33  80  F2 *20* FE  90  EE  78  4A  D5  74 00000020 *39  91  74* F6  84  6E  DE  C4  CC  3C  05  7A  60  ```  ``` ~~ SNIP  0 - size:  45 byte, type: NETTYPE_UNDEF (0) 00000000  06  05  00  00  00  9B  51  C4  68  F6  D4  E9  7A  AB *89  5E* 00000010  0A  D1  65  84 *95* 75  92  FB *20* FD  E2  F2  79  57  CE  7E 00000020 *39  91  74* E5  91  6F  6B  A7  FE  CE  0F  A9  14  ```  (Note the `20` in the second row where the shared "l" of "hello" and "well" is, as well as the "\x04co" of the "core" / "coap" option; variation is in MIDs (first row bytes 12-13), token (second row, first 4 bytes) and the diverting texts). Versions and cross-references All since introduction in 2021.01 until current HEAD.  Since [#16841](https://github.com/RIOT-OS/RIOT/pull/16841), the module in question has been marked as experimental.  Disclosing this has been discussed in the [closed security list](https://forum.riot-os.org/t/security-issues-with-ieee802154-security/3348/11), and was deemed responsible given the overall circumstances.  [CVE-2021-41061](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41061) has been assigned to this issue. Road forward This is not trivial to fix, as we don't have any committed persistence inside generic devices, and even with 6TiSCH minimal security the problem is just shifted (for [section 4.6](https://www.rfc-editor.org/rfc/rfc8180.html#section-4.6) requires monotony of ASNs on the device which is equivalent to this problem, although it'd shift the attack difficulty to an active replay of old beacons). Likewise, most advanced modes need persistence, until (with [ace-ake-authz](https://datatracker.ietf.org/doc/html/draft-selander-ace-ake-authz-03)) asymmetric negotiation comes into play.  Off my head I don't know any standard solutions that can do with neither asymmetric cryptography nor local persistence; some randomness based scheme could possibly be deployed but it'd be very ad-hoc, custom and eventually not easier than the existing solutions.  I think that the discussion in [#16730](https://github.com/RIOT-OS/RIOT/pull/16730) can serve as a starting point. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=40&v=4)](/chrysn)
[chrysn](/chrysn)
added
[Type: bug](/RIOT-OS/RIOT/labels/Type%3A%20bug)
The issue reports a bug / The PR fixes a bug (including spelling errors)
[Area: security](/RIOT-OS/RIOT/labels/Area%3A%20security)
Area: Security-related libraries and subsystems
labels
[Sep 14, 2021](#event-5297594687)

[![@miri64](https://avatars.githubusercontent.com/u/675644?s=80&u=ddc0fa64e6b79aeadc94b7061bef6e052be4d8c7&v=4)](/miri64)

Copy link

Member

### **[miri64](/miri64)** commented [Sep 14, 2021](#issuecomment-918961906) • edited Loading

| Could [SRAM PUF](https://doc.riot-os.org/group__sys__puf__sram.html) help here at least with the nounce generation? |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Sep 14, 2021](#issuecomment-918984215) • edited Loading

| I don't see a full story from it, but maybe ...  If we went for an entropy approach, its nose component could help to make sure there's enough of it. (At least in cold starts; do we have something to carry over in warm starts?). But no matter how good our source of randomness after a million messages with many reboots inbetween (5 byte = 40 bit ~= 1000\*\*4, at sqrt(n) we have good birthday chances) it still becomes likely. No standard says that these *can* be random, but outside 6TiSCH I don't think any implementation has hard requirements on the numbers being ascending either (I'm unaware of any monotony based replay protection, but then again I don't know many 6lo implementations in the first place).  The PUF itself, as I understand it, would only give us more data that doesn't change across reboots (like the key and the LL address already do).  Hm ... I wouldn't see random initialization at startup as a solution to the whole problem, but given that the full solution will need long-term work, it might be a band-aid worth putting on.  (Also, running the numbers made me look into flash cycles -- on nrf52 with a 2-page persistence area we get 10k erase cycles \* 128 writable words \* 2 pages ~= 2 million reboots; I hope to optimize soft reboots so that only hard reboots need flashing. So the randomness approach is probably even practical, but still I wouldn't want to declare it as "just use it that way").  [edit: fixed cycle numbers] |
| --- |

 👍
1
 miri64 reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@fabian18](https://avatars.githubusercontent.com/u/15147337?s=80&v=4)](/fabian18)

Copy link

Contributor

### **[fabian18](/fabian18)** commented [Sep 14, 2021](#issuecomment-919073939)

| So with `SRAM PUF` we could start with a random frame counter? As far as I understand the problem, this does not really solve it, because the frame counter sequences of two boot up sessions could still overlap and if the second sequence starts at a lower counter than the first session finished with, the receiving device would identify the frames of the sender as replays. Given that the receiving device implements replay protection which is currently not the case for RIOT because it requires more memory and leads to more complexity.  As far as I understand we would need persistent storage to solve the issue. [@maribu](https://github.com/maribu) suggested to use `backup_ram`, which I think is very promising, but needs hardware features. I coded something on a local [branch](https://github.com/fabian18/RIOT/tree/ieee802154_security_persistent_frame_counter), but I am not quite satisfied yet with it. The frame counter starts at 0 on cold boot. On reset and flash it continues where it ended with. To also not start at 0 on cold boot, we would probably need en external EEPROM. |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Sep 14, 2021](#issuecomment-919106194)

| We could start with a random frame counter with or without the SRAM PUF -- but the SRAM PUF gives better randomness at a cold start. (How good randomness we have generally depends on hardware support; the SRAM PUF can provide some in those cases where there is no good hardware entropy source).  As for backup\_ram, what are we talking about here?   * Just a memory section that's not cleared on soft reboots? (That won't solve the general issue unless you're OK with the device working only if it's continuously powered from flashing time -- but it can eliminate both wear and sequence number waste in warm reboots, even through hardfaults etc.) * Low-power memory that survives sleep states but is best-effort when the device is unplugged? (Same, but gives the benefits also across the full deep-sleep cycles). * Actually long-term retained memory? That'd be great and yes we can probably manage with this. (But who has something like this, and how is it not just EEPROM?)   In general, the requirements are:   * Persistence: Once data is lost, the device can't rejoin the network w/o rekeying (or the device changing its LL address). * Persistence indication: If data that was once successfully written there is lost, it must be clearly indicated to the reader that data was lost. * Atomicity: If there is a write hole, then power loss at the point of writing would break persistence.   If something can't provide atomicity, it's not too bad -- that can be solved in software using ordered writes and some primitive journaling. If persistence indication is not provided, checksums can fill in.  Populating anything other than flash might during flashing could be tricky (I guess the words give it away). There are tricks that can be done with flashing (eg. we could flash keys and a 0xffffffff first-start indicator, and on first start the device clears the persistent-RAM, starts counting there, and invalidates the first-start indicator), but the clearer approach is then probably to flash a key-less (or otherwise invalid) configuration and then populate the persistent-RAM through the debugger, automated through the console or whatever. -- But all these apply only if there is viable long-term backupped RAM available in the first place. |
| --- |

All reactions

Sorry, something went wrong.

[![@fabian18](https://avatars.githubusercontent.com/u/15147337?s=80&v=4)](/fabian18)

Copy link

Contributor

### **[fabian18](/fabian18)** commented [Sep 14, 2021](#issuecomment-919123113)

| As for backup\_ram, what are we talking about here?  Just a memory section that's not cleared on soft reboots? (That won't solve the general issue unless you're OK with the device working only if it's continuously powered from flashing time -- but it can eliminate both wear and sequence number waste in warm reboots, even through hardfaults etc.)  Exactly!  Low-power memory that survives sleep states but is best-effort when the device is unplugged? (Same, but gives the benefits also across the full deep-sleep cycles).  It depends ... See macro `CPU_BACKUP_RAM_NOT_RETAINED`. Some CPUs do retain data during sleep mode e.g. the stm32´s have a dedicated regulator for that. But others `saml21`, according to the definition of `CPU_BACKUP_RAM_NOT_RETAINED = 1` do not.  Actually long-term retained memory? That'd be great and yes we can probably manage with this. (But who has something like this, and how is it not just EEPROM?  Sorry the "external" was a bit misleading. It does not matter if we use peripheral or external EEPROM. I know that at least some AVRs (`mega2560`) have internal EEPROM. And RIOT´s external EPROMS are `at24cxxx` and `at25xxx`. |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Sep 14, 2021](#issuecomment-919131065) via email

| CPU\_BACKUP\_RAM\_NOT\_RETAINED It does not matter if we use peripheral or external EEPROM Can we create (or, in light of NIH discussions, find and evaluate) an abstraction for the needed persistence that is backed by whatever is there (or is configured; "device breaks if battery backup ever fails" can be OK for some cases)? (That'd need a full story for the "non-flash data at flash time" problem, but so what). |
| --- |

All reactions

Sorry, something went wrong.

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=80&v=4)](/benpicco)

Copy link

Contributor

### **[benpicco](/benpicco)** commented [Sep 14, 2021](#issuecomment-919570713)

| There is also `periph_rtc_mem` ([#16758](https://github.com/RIOT-OS/RIOT/pull/16758), [#16802](https://github.com/RIOT-OS/RIOT/pull/16802)) where some RTCs allow you to store a few bytes that are kept during deep sleep.  "device breaks if battery backup ever fails" can be OK for some cases  I'm not sure why it has to break. The device was at some point in a state where it had not joined the network yet. Why can't it simply return to that state if it lost it's semi-persistent configuration?  "device needs to be paired again if battery backup ever fails" sounds much better to me. |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Sep 15, 2021](#issuecomment-919753478)

| Good point, rtc\_mem could be another backend.  I'm not sure why it has to break.  Because the device can't join the network again even with re-pairing. A repairing (no pun intended) that makes the device joinable would involve rekeying the full network, at which point we're at the complexity levels of CoJP again.  But to avoid that breakage ...  What we *could probably* (warning: again we're in unspecified territory) do as a slightly better band-aid is working with absolute time. Quite like the ASNs of 6tisch but less synchronized: If the devices can guarantee that they'll send at most, say 1000 messages per second (which might be realistic from the radio properties), then the key on the PC would come with an absolute timestamp of when it was created, and what's the message rate (is 1000msg/s are a bound already enforced by the physical layer?). Then any device can be rejoined without rekeying if its sequence number is set to the current time in the relevant scale. There's no need for the device to keep monotonous time, just to count -- as long as it adheres to the data rate, its highest sent seqno will always be less than the current time.  It'd be still worse than the full 6TiSCH solution, but a key could still live for like 30 years on the usable 5 byte sequence numbers. (Worse because   * there's still the issue of getting the persisted state into the device, * we consume sequence numbers faster than ASNs to be pessimistic about clock differences and that stuff, and * unlike in 6TiSCH we have to send these 5 bytes with every message   but still)  With that, the remaining limitation would be that once persistence is lost, the device needs to obtain a trusted time again in the key's time scale. |
| --- |

All reactions

Sorry, something went wrong.

[![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=40&v=4)](/benpicco)
[benpicco](/benpicco)
mentioned this issue
[Dec 21, 2021](#ref-pullrequest-1083792154)

[cpu/esp\_common: change esp\_now key param
#17419](/RIOT-OS/RIOT/pull/17419)
 Open

[![@fabian18](https://avatars.githubusercontent.com/u/15147337?s=40&v=4)](/fabian18)
[fabian18](/fabian18)
mentioned this issue
[Sep 11, 2022](#ref-pullrequest-1368882982)

[ieee802154\_security: add internal descriptor organization for replay protection
#18575](/RIOT-OS/RIOT/pull/18575)
 Open

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Apr 19, 2023](#issuecomment-1515294105)

| Reading RFC9030 (yes that's 6TiSCH, but CoJP=RFC9031 doesn't reiterate everything that's there), there's an alternative to keeping sequence numbers locally and rekyeing: It says [at the end of this section](https://datatracker.ietf.org/doc/html/rfc9030#name-validating-asn) that the nonce is not necessarily built from the MAC address, but can also be built from the short identifier.  That still leaves us with the problem that the device has to know which short identifier it's supposed to be using, which again means we'd need CoJP, but at least this doesn't need extra information to the CoJP (that'd tell it the MAC address), and the CoJP can get away without rekeying the network for as long as it is not running out of short identifers. CoJP when used [with EDHOC](https://www.ietf.org/archive/id/draft-selander-lake-authz-00.html#name-use-with-constrained-join-p) doesn't need any local persistence, so it's easy again.  It may be worth pointing out that there are two kinds of persistence we're having here:   1. Persistence of counters associated with one key: This is something the application can solve (although I'd really like to have a tool to hand the application as an OS). 2. Persistence of counters for a key that may be used across a reflash with a completely different example / program. This is what we don't even have a plan for solving -- but using any variant of CoJP (even the OSCORE-only one with the type-1 persistence issue) in combination with short identifiers that the JRC guarantees are not reused on a key gets us around the problem (and I think that's good enough). |
| --- |

All reactions

Sorry, something went wrong.

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=80&v=4)](/chrysn)

Copy link

Member

Author

### **[chrysn](/chrysn)** commented [Apr 19, 2023](#issuecomment-1515483012)

| Truth be told, I'm not sure where 802.15.4 says short addresses are legal; investigating -- but appreciating help there ([@mcr](https://github.com/mcr), maybe?). |
| --- |

All reactions

Sorry, something went wrong.

[![@fabian18](https://avatars.githubusercontent.com/u/15147337?s=40&v=4)](/fabian18)
[fabian18](/fabian18)
mentioned this issue
[May 7, 2023](#ref-pullrequest-1699004791)

[sys: runtime configuration module with persistent storage backends
#19557](/RIOT-OS/RIOT/pull/19557)
 Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fissues%2F16844)

Assignees

No one assigned

Labels

[Area: security](/RIOT-OS/RIOT/labels/Area%3A%20security)
Area: Security-related libraries and subsystems
[Type: bug](/RIOT-OS/RIOT/labels/Type%3A%20bug)
The issue reports a bug / The PR fixes a bug (including spelling errors)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@chrysn](https://avatars.githubusercontent.com/u/442326?s=52&v=4)](/chrysn) [![@miri64](https://avatars.githubusercontent.com/u/675644?s=52&v=4)](/miri64) [![@benpicco](https://avatars.githubusercontent.com/u/1301112?s=52&v=4)](/benpicco) [![@fabian18](https://avatars.githubusercontent.com/u/15147337?s=52&v=4)](/fabian18)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from crypto.stackexchange.com_20b236ca_20250115_134014.html ===


[Skip to main content](#content)

#### Stack Exchange Network

Stack Exchange network consists of 183 Q&A communities including [Stack Overflow](https://stackoverflow.com), the largest, most trusted online community for developers to learn, share their knowledge, and build their careers.

[Visit Stack Exchange](https://stackexchange.com)

Loading…

* [Tour
  Start here for a quick overview of the site](/tour)
* [Help Center
  Detailed answers to any questions you might have](/help)
* [Meta
  Discuss the workings and policies of this site](https://crypto.meta.stackexchange.com)
* [About Us
  Learn more about Stack Overflow the company, and our products](https://stackoverflow.co/)

4. ### [current community](https://crypto.stackexchange.com)

   * [Cryptography](https://crypto.stackexchange.com)

     [help](https://crypto.stackexchange.com/help)
     [chat](https://chat.stackexchange.com?tab=site&host=crypto.stackexchange.com)
   * [Cryptography Meta](https://crypto.meta.stackexchange.com)
   ### your communities

   [Sign up](https://crypto.stackexchange.com/users/signup?ssrc=site_switcher&returnurl=https%3a%2f%2fcrypto.stackexchange.com%2fquestions%2f26790%2fhow-bad-it-is-using-the-same-iv-twice-with-aes-gcm) or [log in](https://crypto.stackexchange.com/users/login?ssrc=site_switcher&returnurl=https%3a%2f%2fcrypto.stackexchange.com%2fquestions%2f26790%2fhow-bad-it-is-using-the-same-iv-twice-with-aes-gcm) to customize your list.

   ### [more stack exchange communities](https://stackexchange.com/sites)

   [company blog](https://stackoverflow.blog)
6. [Log in](https://crypto.stackexchange.com/users/login?ssrc=head&returnurl=https%3a%2f%2fcrypto.stackexchange.com%2fquestions%2f26790%2fhow-bad-it-is-using-the-same-iv-twice-with-aes-gcm)
7. [Sign up](https://crypto.stackexchange.com/users/signup?ssrc=head&returnurl=https%3a%2f%2fcrypto.stackexchange.com%2fquestions%2f26790%2fhow-bad-it-is-using-the-same-iv-twice-with-aes-gcm)

[![Cryptography](https://cdn.sstatic.net/Sites/crypto/Img/logo.svg?v=87c028c5e448)](https://crypto.stackexchange.com)

1. 1. [Home](/)
   2. [Questions](/questions)
   3. [Tags](/tags)
   5. [Users](/users)
   6. [Companies](https://stackoverflow.com/jobs/companies?so_medium=crypto&so_source=SiteNav)
   7. [Unanswered](/unanswered)
2. Teams
   ![](https://cdn.sstatic.net/Img/teams/teams-promo.svg?v=e507948b81bf)

   Ask questions, find answers and collaborate at work with Stack Overflow for Teams.

   [Try Teams for free](https://stackoverflowteams.com/teams/create/free/?utm_medium=referral&utm_source=crypto-community&utm_campaign=side-bar&utm_content=explore-teams)
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=crypto-community&utm_campaign=side-bar&utm_content=explore-teams)
3. Teams
4. Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=crypto-community&utm_campaign=side-bar&utm_content=explore-teams-compact)

**Teams**

Q&A for work

Connect and share knowledge within a single location that is structured and easy to search.

[Learn more about Teams](https://stackoverflow.co/teams/)

# [How bad it is using the same IV twice with AES/GCM?](/questions/26790/how-bad-it-is-using-the-same-iv-twice-with-aes-gcm)

[Ask Question](/questions/ask)

Asked
9 years, 6 months ago

Modified
[5 years, 8 months ago](?lastactivity "2019-05-09 16:02:34Z")

Viewed
26k times

29

$\begingroup$

I understand that initialization vectors (IV) should not be used twice when using AES/GCM. I am using a counter as an initialization vector. Every time I send out a new packet (I am developing an UDP based protocol that needs packet encryption) I increment the counter and use it as IV.

However, since I will generally need that protocol to transfer files and to send [keepalives](https://en.wikipedia.org/wiki/Keepalive) for very very extended periods of time, in principle for very large files it is conceivable to send more than $2^{32}$ packets, or over the years it is conceivable to send out $2^{32}$ keepalives. To keep the IVs always unique, I would probably need to use a 64 bits integer, but that is 4 bytes more of overhead per packet, that can sum up to quite large quantities which I would like to avoid if not strictly necessary.

So I wonder: how bad it is to reuse the IVs with AES/GCM? Can I have an idea of how dangerous that can be? I mean: if as soon as I repeat an IV **once** I get immediately so easily exposed to an attack that I could just give out my key publicly, then I have to take countermeasures. However, if that becomes dangerous only when I use the same IV a lot of times, that is completely another thing.

* [aes](/questions/tagged/aes "show questions tagged 'aes'")
* [initialization-vector](/questions/tagged/initialization-vector "show questions tagged 'initialization-vector'")
* [gcm](/questions/tagged/gcm "show questions tagged 'gcm'")
* [nonce](/questions/tagged/nonce "show questions tagged 'nonce'")

[Share](/q/26790 "Short permalink to this question")

[Improve this question](/posts/26790/edit)

Follow

[edited Apr 3, 2019 at 11:42](/posts/26790/revisions "show all edits to this post")

[![kelalaka's user avatar](https://lh4.googleusercontent.com/-NZb6uZzo4Gg/AAAAAAAAAAI/AAAAAAAAAo0/xTr6RvgMTRw/photo.jpg?sz=64)](/users/18298/kelalaka)

[kelalaka](/users/18298/kelalaka)
49.5k1212 gold badges120120 silver badges206206 bronze badges

asked Jul 7, 2015 at 23:40

[![Matteo Monti's user avatar](https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=64&d=identicon&r=PG)](/users/25475/matteo-monti)

[Matteo Monti](/users/25475/matteo-monti)Matteo Monti
1,46722 gold badges1414 silver badges1919 bronze badges

$\endgroup$

1

* $\begingroup$
  As per its definition IV can not be reused. Re-using IV - it would no longer be an IV anymore. That is because IV is required to be random.
  $\endgroup$
  – [Elis Byberi](/users/56160/elis-byberi "101 reputation")

  Commented
  Mar 6, 2020 at 14:20

Add a comment
 |

## 2 Answers 2

Sorted by:

[Reset to default](/questions/26790/how-bad-it-is-using-the-same-iv-twice-with-aes-gcm?answertab=scoredesc#tab-top)

Highest score (default)

Date modified (newest first)

Date created (oldest first)

29

$\begingroup$

**Even a *single* AES-GCM nonce reuse can be catastrophic.**

* A *single* nonce reuse leaks the xor of plaintexts, so if one plaintext is known the adversary can completely decrypt the other. This is the same as for a two-time pad.
* In messages up to $\ell$ blocks long, after a *single* nonce reuse the adversary can narrow the authentication key down to $\ell$ possibilities with polynomial root-finding and thereby forge messages with high success probability $1/\ell$.
  + How? An $\ell$-block message is a polynomial of degree $\ell$ with zero constant term; the authenticator under secret key $r, s$ is $m \mapsto m(r) + s$, where $r$ is reused between messages and $s$ is derived as a secret function of the nonce. Find authenticators $a = m(r) + s$ and $a' = m'(r) + s$ for distinct messages under the same nonce, and only the ${\leq}\ell$ possible roots of the degree-$\ell$ polynomial $m(r) - m'(r) + a' - a$ in $r$ are possible values of the authentication key.

**Use 96-bit nonces; if you don't—if, instead, you use smaller *or* larger nonces—it will be *as if* you chose nonces randomly, and the number of messages you can safely handle drops dramatically.** But you can, of course, pad, say, a 64-bit nonce into 96 bits: what matters is only that the nonces be *unique*.

If the cost of a >32-bit nonce is prohibitive, you could periodically rekey. For example, if you first establish a long-term key $k$, you can use $\operatorname{HMAC-SHA256}\_k(i)$ as the key during the $i^{\mathit{th}}$ epoch, where each epoch covers four billion messages, and $i$ is encoded into a bit string in some canonical way.

[Share](/a/68525 "Short permalink to this answer")

[Improve this answer](/posts/68525/edit)

Follow

[edited May 9, 2019 at 16:02](/posts/68525/revisions "show all edits to this post")

answered Apr 4, 2019 at 1:25

[![Squeamish Ossifrage's user avatar](https://i.sstatic.net/mq8lg.jpg?s=64)](/users/49826/squeamish-ossifrage)

[Squeamish Ossifrage](/users/49826/squeamish-ossifrage)Squeamish Ossifrage
49.5k33 gold badges119119 silver badges227227 bronze badges

$\endgroup$

0

Add a comment
 |

14

$\begingroup$

Reusing an IV **once** opens you up to someone finding the XOR of those two plaintext, seriously compromising their confidentiality. Moreover, with GCM, a single IV reuse leaks significant information about the key used for authentication; if there are even a few pairs of reused IVs (not even one IV used many times; a few IVs each of which are used twice is enough) can compromise the authentication key. GCM being a stream cipher, it is totally malleable if the authentication mechanism fails (the MAC is the *only* thing preventing tampering).

Moreover, there are mild concerns if you use a non-96-bit IV with NIST-spec GCM. NIST's GCM is designed for 96-bit IVs, and if you specify a different-length one there are weaknesses in the function used to compute the "real" IV.

[Source.](http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/Joux_comments.pdf)

[Share](/a/26793 "Short permalink to this answer")

[Improve this answer](/posts/26793/edit)

Follow

answered Jul 8, 2015 at 0:53

[![cpast's user avatar](https://www.gravatar.com/avatar/88a8d19b6696ff432f6e8f1ac9141398?s=64&d=identicon&r=PG)](/users/18113/cpast)

[cpast](/users/18113/cpast)cpast
3,63711 gold badge1616 silver badges2828 bronze badges

$\endgroup$

8

* 3

  $\begingroup$
  I'd just like to add that if you ARE concerned about the possibility of IV reuse, possibly due to being on a platform with really poor randomness, then you can use an IV misuse resistant scheme.
  $\endgroup$
  – [Yehuda Lindell](/users/25354/yehuda-lindell "28,160 reputation")

  Commented
  Jul 8, 2015 at 8:06
* $\begingroup$
  @cpast Thanks! I will definitely try to avoid reusing then. About the problem of the iv not being 96 bits long: can I just pad it with zeros, I suppose?
  $\endgroup$
  – [Matteo Monti](/users/25475/matteo-monti "1,467 reputation")

  Commented
  Jul 8, 2015 at 14:25
* 5

  $\begingroup$
  Actually, if you just reuse an IV once (for distinct plaintexts/AADs), the attacker can limit the possible values for $H$ to a handful of values.
  $\endgroup$
  – [poncho](/users/452/poncho "151,259 reputation")

  Commented
  Jul 8, 2015 at 16:44
* 1

  $\begingroup$
  @SamGinrich The AES-GCM spec takes a single IV for the entire ciphertext, not per-block. The IV is translated into counter values for each block, but the IV *itself* is a parameter for the entire encrypted and tagged message. So reusing an IV means using it for two distinct messages that use the same key. (That said, if the same counter is used on *any* two blocks in a counter mode, you're in serious trouble. Doesn't matter how far apart they are.)
  $\endgroup$
  – [cpast](/users/18113/cpast "3,637 reputation")

  Commented
  Nov 26, 2024 at 13:58
* 1

  $\begingroup$
  @SamGinrich Correct. If you split a long message into two parts before encrypting, you need to give them different IVs.
  $\endgroup$
  – [cpast](/users/18113/cpast "3,637 reputation")

  Commented
  Nov 27, 2024 at 2:45

 |
Show **3** more comments

## Your Answer

Thanks for contributing an answer to Cryptography Stack Exchange!

* Please be sure to *answer the question*. Provide details and share your research!

But *avoid* …

* Asking for help, clarification, or responding to other answers.
* Making statements based on opinion; back them up with references or personal experience.

Use MathJax to format equations. [MathJax reference](https://crypto.meta.stackexchange.com/questions/171/using-mathjax-tex-on-the-cryptography-site).

To learn more, see our [tips on writing great answers](/help/how-to-answer).

Draft saved
Draft discarded

### Sign up or [log in](/users/login?ssrc=question_page&returnurl=https%3a%2f%2fcrypto.stackexchange.com%2fquestions%2f26790%2fhow-bad-it-is-using-the-same-iv-twice-with-aes-gcm%23new-answer)

 Sign up using Google

 Sign up using Email and Password

Submit
### Post as a guest

Name

Email

Required, but never shown

### Post as a guest

Name

Email

Required, but never shown

Post Your Answer

Discard

By clicking “Post Your Answer”, you agree to our [terms of service](https://stackoverflow.com/legal/terms-of-service/public) and acknowledge you have read our [privacy policy](https://stackoverflow.com/legal/privacy-policy).

## Not the answer you're looking for? Browse other questions tagged * [aes](/questions/tagged/aes "show questions tagged 'aes'") * [initialization-vector](/questions/tagged/initialization-vector "show questions tagged 'initialization-vector'") * [gcm](/questions/tagged/gcm "show questions tagged 'gcm'") * [nonce](/questions/tagged/nonce "show questions tagged 'nonce'") or [ask your own question](/questions/ask).

* The Overflow Blog
* [Robots building robots in a robotic factory](https://stackoverflow.blog/2025/01/14/robots-building-robots-in-a-robotic-factory/)

#### Linked

[0](/q/73093 "Question score (upvotes - downvotes)")
[Can I use a fixed IV with AES-GCM if I only encrypt unique plaintext values?](/questions/73093/can-i-use-a-fixed-iv-with-aes-gcm-if-i-only-encrypt-unique-plaintext-values?noredirect=1)

[1](/q/112309 "Question score (upvotes - downvotes)")
[IV for AES-GCM with AAD only](/questions/112309/iv-for-aes-gcm-with-aad-only?noredirect=1)

[11](/q/58329 "Question score (upvotes - downvotes)")
[Can AES-GCM be broken if initialisation vector is known?](/questions/58329/can-aes-gcm-be-broken-if-initialisation-vector-is-known?noredirect=1)

[16](/q/84357 "Question score (upvotes - downvotes)")
[What are the rules for using AES-GCM correctly?](/questions/84357/what-are-the-rules-for-using-aes-gcm-correctly?noredirect=1)

[7](/q/72444 "Question score (upvotes - downvotes)")
[Is the Java function AES/CBC/PKCS5Padding vulnerable to padding oracle?](/questions/72444/is-the-java-function-aes-cbc-pkcs5padding-vulnerable-to-padding-oracle?noredirect=1)

[4](/q/43329 "Question score (upvotes - downvotes)")
[How should I encrypt filenames in my scenario?](/questions/43329/how-should-i-encrypt-filenames-in-my-scenario?noredirect=1)

[5](/q/78350 "Question score (upvotes - downvotes)")
[Line by line encrypted logging stored with iv/salt/iterations. How safe is it?](/questions/78350/line-by-line-encrypted-logging-stored-with-iv-salt-iterations-how-safe-is-it?noredirect=1)

[5](/q/109675 "Question score (upvotes - downvotes)")
[What best to put in unused nonce bytes when using AES-GCM-SIV](/questions/109675/what-best-to-put-in-unused-nonce-bytes-when-using-aes-gcm-siv?noredirect=1)

[3](/q/78164 "Question score (upvotes - downvotes)")
[Size of IV in AES-GCM according to RFC 4106](/questions/78164/size-of-iv-in-aes-gcm-according-to-rfc-4106?noredirect=1)

[10](/q/82105 "Question score (upvotes - downvotes)")
[Are there any weak nonce-misuse resistant encryption scheme?](/questions/82105/are-there-any-weak-nonce-misuse-resistant-encryption-scheme?noredirect=1)

[See more linked questions](/questions/linked/26790)

#### Related

[10](/q/6533 "Question score (upvotes - downvotes)")
[Unique GCM/CCM initial counters without recipient side message counters](/questions/6533/unique-gcm-ccm-initial-counters-without-recipient-side-message-counters)

[9](/q/25060 "Question score (upvotes - downvotes)")
[nonce of AES-GCM in SSL](/questions/25060/nonce-of-aes-gcm-in-ssl)

[43](/q/26783 "Question score (upvotes - downvotes)")
[Ciphertext and tag size and IV transmission with AES in GCM mode](/questions/26783/ciphertext-and-tag-size-and-iv-transmission-with-aes-in-gcm-mode)

[6](/q/41965 "Question score (upvotes - downvotes)")
[How does the GCM encryption limit affect TLS connections?](/questions/41965/how-does-the-gcm-encryption-limit-affect-tls-connections)

[8](/q/52674 "Question score (upvotes - downvotes)")
[Deterministic Encryption with AES GCM - how to choose the IV (nonce)](/questions/52674/deterministic-encryption-with-aes-gcm-how-to-choose-the-iv-nonce)

[4](/q/85696 "Question score (upvotes - downvotes)")
[Designing a secure UDP-based communication protocol](/questions/85696/designing-a-secure-udp-based-communication-protocol)

[2](/q/86557 "Question score (upvotes - downvotes)")
[Encrypt a big file in blocks with AES-GCM: how many nonce do we need?](/questions/86557/encrypt-a-big-file-in-blocks-with-aes-gcm-how-many-nonce-do-we-need)

[2](/q/86697 "Question score (upvotes - downvotes)")
[With AES-CTR does the block input need to be implemented as nonce || counter?](/questions/86697/with-aes-ctr-does-the-block-input-need-to-be-implemented-as-nonce-counter)

[2](/q/112355 "Question score (upvotes - downvotes)")
[Is AES-GCM safe if same key is used for both uplink and downlink, assuming last IV bit tells the direction](/questions/112355/is-aes-gcm-safe-if-same-key-is-used-for-both-uplink-and-downlink-assuming-last)

#### [Hot Network Questions](https://stackexchange.com/questions?tab=hot)

* [Diode from CD-RW drive won't burn](https://electronics.stackexchange.com/questions/735917/diode-from-cd-rw-drive-wont-burn)
* [An SSD from a Dell XPS laptop without the small tang (finger?). What am I looking at?](https://superuser.com/questions/1870478/an-ssd-from-a-dell-xps-laptop-without-the-small-tang-finger-what-am-i-lookin)
* [Looking for direct neighbors in a trianglemesh](https://mathematica.stackexchange.com/questions/310177/looking-for-direct-neighbors-in-a-trianglemesh)
* [Why do we need \phantom{{}+{}} for proper alignment in one case while a simple \phantom{+} would do in another](https://tex.stackexchange.com/questions/735045/why-do-we-need-phantom-for-proper-alignment-in-one-case-while-a-simple)
* [What does v(t) in the utility function 𝑢(𝑡, 𝑐)=𝑣(𝑡)+𝑐 mean? How can we conclude quasi linearity from this?](https://economics.stackexchange.com/questions/59805/what-does-vt-in-the-utility-function-mean-how-can-we-con)
* [/usr/bin/env and command with pound symbol in it](https://apple.stackexchange.com/questions/478006/usr-bin-env-and-command-with-pound-symbol-in-it)
* [Cryptic Family Reunion: Key to my Heart](https://puzzling.stackexchange.com/questions/130088/cryptic-family-reunion-key-to-my-heart)
* [Meaning of "This work was supported by author own support"](https://academia.stackexchange.com/questions/216099/meaning-of-this-work-was-supported-by-author-own-support)
* [Interpret a SqueezeL string](https://codegolf.stackexchange.com/questions/277661/interpret-a-squeezel-string)
* ["A speedy car" — Is this phrase natural to you?](https://ell.stackexchange.com/questions/361221/a-speedy-car-is-this-phrase-natural-to-you)
* [How do I calculate the averages of values per date and category and display them lagged?](https://stackoverflow.com/questions/79355614/how-do-i-calculate-the-averages-of-values-per-date-and-category-and-display-them)
* [When someone, instead of listening, assumes your views (only to disagree)](https://ell.stackexchange.com/questions/361205/when-someone-instead-of-listening-assumes-your-views-only-to-disagree)
* [ConLang for a pet that talks through buttons...?](https://writing.stackexchange.com/questions/70657/conlang-for-a-pet-that-talks-through-buttons)
* [How to handle inheritance in a world with reincarnation?](https://worldbuilding.stackexchange.com/questions/264094/how-to-handle-inheritance-in-a-world-with-reincarnation)
* [Can a turbofan engine thrust reverser cowl open from friction during a belly landing?](https://aviation.stackexchange.com/questions/107715/can-a-turbofan-engine-thrust-reverser-cowl-open-from-friction-during-a-belly-lan)
* [Is it acceptable in Japan to wear outdoor shoes inside for health reasons?](https://travel.stackexchange.com/questions/193011/is-it-acceptable-in-japan-to-wear-outdoor-shoes-inside-for-health-reasons)
* [when to trade the fianchetto bishop in closed sicilian](https://chess.stackexchange.com/questions/46568/when-to-trade-the-fianchetto-bishop-in-closed-sicilian)
* [Why is homemade food preferable over replicated food?](https://movies.stackexchange.com/questions/124282/why-is-homemade-food-preferable-over-replicated-food)
* [What is the current status of the billionaire tax in France?](https://politics.stackexchange.com/questions/90296/what-is-the-current-status-of-the-billionaire-tax-in-france)
* [Why did Saturn V have fins?](https://space.stackexchange.com/questions/67691/why-did-saturn-v-have-fins)
* [Where is the abandoned railway station in the “Commissario Montalbano” episode “Par Condicio?”](https://movies.stackexchange.com/questions/124286/where-is-the-abandoned-railway-station-in-the-commissario-montalbano-episode)
* [Is it possible to leave a tenure-track assistant professorship to move into a research-focused position (i.e., research staff/scientist)?](https://academia.stackexchange.com/questions/216110/is-it-possible-to-leave-a-tenure-track-assistant-professorship-to-move-into-a-re)
* [Story identification - alcoholic android](https://scifi.stackexchange.com/questions/294230/story-identification-alcoholic-android)
* [Banding appearing in skin of chaacter with subsurafce scattering during render](https://blender.stackexchange.com/questions/329760/banding-appearing-in-skin-of-chaacter-with-subsurafce-scattering-during-render)

more hot questions

[Question feed](/feeds/question/26790 "Feed of this question and its answers")

# Subscribe to RSS

Question feed

To subscribe to this RSS feed, copy and paste this URL into your RSS reader.

![](/posts/26790/ivc/29f0?prg=55da6c4a-c418-4e71-86ef-9a89f0fffad8)

##### [Cryptography](/)

* [Tour](/tour)
* [Help](/help)
* [Chat](https://chat.stackexchange.com?tab=site&host=crypto.stackexchange.com)
* [Contact](/contact)
* [Feedback](https://crypto.meta.stackexchange.com)

##### [Company](https://stackoverflow.co/)

* [Stack Overflow](https://stackoverflow.com)
* [Teams](https://stackoverflow.co/teams/)
* [Advertising](https://stackoverflow.co/advertising/)
* [Talent](https://stackoverflow.co/advertising/employer-branding/)
* [About](https://stackoverflow.co/)
* [Press](https://stackoverflow.co/company/press/)
* [Legal](https://stackoverflow.com/legal)
* [Privacy Policy](https://stackoverflow.com/legal/privacy-policy)
* [Terms of Service](https://stackoverflow.com/legal/terms-of-service/public)
* Cookie Settings
* [Cookie Policy](https://stackoverflow.com/legal/cookie-policy)

##### [Stack Exchange Network](https://stackexchange.com)

* [Technology](https://stackexchange.com/sites#technology)
* [Culture & recreation](https://stackexchange.com/sites#culturerecreation)
* [Life & arts](https://stackexchange.com/sites#lifearts)
* [Science](https://stackexchange.com/sites#science)
* [Professional](https://stackexchange.com/sites#professional)
* [Business](https://stackexchange.com/sites#business)
* [API](https://api.stackexchange.com/)
* [Data](https://data.stackexchange.com/)

* [Blog](https://stackoverflow.blog?blb=1)
* [Facebook](https://www.facebook.com/officialstackoverflow/)
* [Twitter](https://twitter.com/stackoverflow)
* [LinkedIn](https://linkedin.com/company/stack-overflow)
* [Instagram](https://www.instagram.com/thestackoverflow)

Site design / logo © 2025 Stack Exchange Inc;
user contributions licensed under
[CC BY-SA](https://stackoverflow.com/help/licensing)
.
rev 2025.1.15.21106


