=== Content from github.com_e1748471_20250114_203922.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Freleases%2Ftag%2F4.1.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Freleases%2Ftag%2F4.1.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=elabftw%2Felabftw)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[elabftw](/elabftw)
/
**[elabftw](/elabftw/elabftw)**
Public

* [Notifications](/login?return_to=%2Felabftw%2Felabftw) You must be signed in to change notification settings
* [Fork
  223](/login?return_to=%2Felabftw%2Felabftw)
* [Star
   1k](/login?return_to=%2Felabftw%2Felabftw)

* [Code](/elabftw/elabftw/tree/4.1.0)
* [Issues
  176](/elabftw/elabftw/issues)
* [Pull requests
  5](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

Additional navigation options

* [Code](/elabftw/elabftw/tree/4.1.0)
* [Issues](/elabftw/elabftw/issues)
* [Pull requests](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

1. [Releases](/elabftw/elabftw/releases)
2. [4.1.0](/elabftw/elabftw/releases/tag/4.1.0)

# eLabFTW-4.1.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/elabftw/elabftw/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...4.1.0)

 Loading

[View all tags](/elabftw/elabftw/tags)

![@NicolasCARPi](https://avatars.githubusercontent.com/u/3043706?s=40&v=4)
[NicolasCARPi](/NicolasCARPi)
released this
30 Sep 16:00

·
[2175 commits](/elabftw/elabftw/compare/4.1.0...master)
to master
since this release

[4.1.0](/elabftw/elabftw/tree/4.1.0)

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/3043706?s=64&v=4)](/NicolasCARPi)
[NicolasCARPi](/NicolasCARPi)
Nicolas CARPi

GPG key ID: 3F1E365415256C7E

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`d479eb3`](/elabftw/elabftw/commit/d479eb32b84e6e813a4143e95d860f955fa243aa)

# Changelog

## Version 4.1.0

Release notes:

This version is full of bugfixes and enhancements, with a few new features too. As it contains some security improvements, it is recommended to all users to update to this version as soon as possible.

Breaking changes:

No breaking changes from 4.0.11, update like usual.

Important changes for SAML users:

* Some settings that were in the "SP" part are now attached to the IDP. This means you can now configure different IDP with different values for expected "email", "team", "firstname" and "lastname" attributes. Previous values are copied during upgrade to each IDP, so there is no breaking change and nothing for you to do after upgrade. ([#2879](https://github.com/elabftw/elabftw/pull/2879))

Bugfixes:

* Fix markdown editor preview button
* Fix a toggle button not working on Sysconfig page
* Fix json editor behavior ([#2882](https://github.com/elabftw/elabftw/pull/2882) by [@mbolten](https://github.com/mbolten))
* Fix incorrect position of cursor in doodle on wide image (fix 2781 via [#2875](https://github.com/elabftw/elabftw/pull/2875) by [@mbolten](https://github.com/mbolten))
* Fix linked item import button ([#2860](https://github.com/elabftw/elabftw/issues/2860))
* Fix plasmid viewer for timestamped experiments ([#2855](https://github.com/elabftw/elabftw/pull/2855) by [@mbolten](https://github.com/mbolten))
* Fix metadata not saving changes on admin panel (fix [#2832](https://github.com/elabftw/elabftw/issues/2832) via [#2845](https://github.com/elabftw/elabftw/pull/2845))
* Fix create shortcut ([#2838](https://github.com/elabftw/elabftw/pull/2838) by [@mbolten](https://github.com/mbolten))
* Fix item category name with special characters ([#2812](https://github.com/elabftw/elabftw/issues/2812))
* Fix switch editor ([#2810](https://github.com/elabftw/elabftw/pull/2810))
* Fix user not able to add existing tags if admin setting for creating tags is set to no (not default)
* Fix issue with incorrect date in database ([#2910](https://github.com/elabftw/elabftw/issues/2910))
* Fix mathjax in markdown preview ([#2921](https://github.com/elabftw/elabftw/pull/2921))

New features:

* Allow admins to force using templates for experiments
* Add QR code only pdf generation (PR [#2955](https://github.com/elabftw/elabftw/pull/2955) fix [#2940](https://github.com/elabftw/elabftw/issues/2940))
* Add metadata search on search page ([#2941](https://github.com/elabftw/elabftw/pull/2941))
* Add a button to go back to the top of the page (fix [#2925](https://github.com/elabftw/elabftw/issues/2925))
* Add a warning if an entry was modified less than 600 seconds ago by someone else (fix [#2243](https://github.com/elabftw/elabftw/issues/2243))

Enhancements:

* Remove the bold styling of column names during CSV import. See [#2897](https://github.com/elabftw/elabftw/issues/2897)
* Stop asking for "confirmation password" and instead provide a way to toggle the visibility of the input field
* Password reset email now sent in text and email formats
* Make sure we cannot unarchive a user if another active account with same email exists
* Hide archived users from team page
* Add items to linked items when '#' type shortcut link is used in editor ([#2861](https://github.com/elabftw/elabftw/pull/2861) by [@mbolten](https://github.com/mbolten))
* Add keepalive function to inform users of session timeout
* Increase maximum height of images in pdf
* Add tag autocompletion in show mode
* Display message to user if tag creation is not available
* Add autocomplete hints for browsers on some fields (email, password, name)
* Sort available languages in user control panel
* Hide the share button if anonymous login is not possible
* Make the title column in table mode wider

API:

* Add a function to append to body (see [elabftw/elabapy#23](https://github.com/elabftw/elabapy/issues/23))

Security:

* Multiple improvements in the way passwords are reset and accounts are protected from brute-force guessing.
* Password reset links valid for 15 minutes now

Dev corner:

* Code improvements all over the place, as always
* New Tab class to deal with tabs
* Removed stale assets/files
* Add global namespace imports in phpcs ([#2890](https://github.com/elabftw/elabftw/pull/2890) by [@mbolten](https://github.com/mbolten))
* Add CITATION.cff
* Upgrade dependencies
* Update i18n terms
* Replace callbacks with MutationObserver ([#2876](https://github.com/elabftw/elabftw/pull/2876))
* Move assets in their correct place /cleanup files ([#2874](https://github.com/elabftw/elabftw/pull/2874) [#2873](https://github.com/elabftw/elabftw/pull/2873) [#2872](https://github.com/elabftw/elabftw/pull/2872) by [@mbolten](https://github.com/mbolten))
* Replace deprecated methods for csv ([#2851](https://github.com/elabftw/elabftw/pull/2851) by [@mbolten](https://github.com/mbolten))
* Remove old code ([#2842](https://github.com/elabftw/elabftw/pull/2842), [#2841](https://github.com/elabftw/elabftw/pull/2841) by [@mbolten](https://github.com/mbolten))
* Add many unit tests
* Fix minification of JS assets
* Mathjax configuration rework ([#2936](https://github.com/elabftw/elabftw/pull/2936) by Marcel Bolten)

Contributions:

Shoutout to Marcel Bolten for proposing many good quality code changes!

### Contributors

* [![@mbolten](https://avatars.githubusercontent.com/u/44693589?s=64&v=4)](https://github.com/mbolten)

mbolten

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from owasp.org_024cdf7b_20250114_203924.html ===


For full functionality of this site it is necessary to enable JavaScript. Here are the  [instructions how to enable JavaScript in your web browser](http://turnonjs.com/).

[![OWASP logo](https://owasp.org/assets/images/logo.png)](https://owasp.org/)

[![](https://owasp.org/assets/images/logo.png)](https://owasp.org/)

 [Store](https://owasp.org/store)
[Donate](https://owasp.org/donate?reponame=www-community)
[Join](https://owasp.org/membership)

This website uses cookies to analyze our traffic and only share that information with our analytics partners.

Accept

x

[Store](https://owasp.org/store)
[Donate](https://owasp.org/donate?reponame=www-community)
[Join](https://owasp.org/membership)

# Slow Down Online Guessing Attacks with Device Cookies

**Author:** Anton Dedov

**Contributor(s):** Daniel Waller

## Intro

Device cookies as additional authenticator for users devices have been
discussed and used in practice for some time already.
For example, it was discussed by Marc Heuse at
[PasswordsCon 14](http://passwords14.item.ntnu.no/).

Marc speculates on various techniques for blocking online attacks and comes
to notion of “device cookie” as good protection alternative (see the
[talk](https://mediasite.ntnu.no/Mediasite/Play/2133729a627b44a491778e135f602a611d) on Hydra at
PasswordsCon 14, specifically from 32:50).
As well as Alec Muffett at the same conference mentions “datr cookie” from Facebook (look from
10:15 of the [talk](https://mediasite.ntnu.no/Mediasite/Play/db5258ede8f94e69ad763fbe30f105a71d)).

The main idea behind the protocol is to issue a special “device” cookie
to every client (browser) when it is used to successfully authenticate a
user in a system.
The device cookie can be used to:

* Distinguish between known/trusted and unknown/untrusted clients
* Establish universal temporary lockouts for all untrusted clients
* Lockout trusted clients individually

## Why?

There are few well-known ways to [deal with online attacks](controls/Blocking_Brute_Force_Attacks):

* Temporary account lockout
* Use CAPTCHA to slow down attacker

Other tricks, like producing confusing answers for attacker are more
like “security by obscurity” and cannot be used as first-class
protection mechanism.

Temporary account lockout after several failed attempts is too simple of a target for DoS attacks against legitimate users.
There is variation of this method that locks out pair of account/IP.
It is better in regarding to DoS issues but have security downsides:

* Attacks from botnets can be effective
* Attacks through proxies can be effective

Moreover, it is not so trivial to implement account/IP lockout.
Consider multiple proxies with chaining addresses in “X-Forwarded-For” header or IPv6.

The method described in this writing may be viewed as variant of
account/IP blocking. But it proposes to use a browser cookie instead of
an IP address. Thus it may be more predictable from security perspective
and easier to implement.

## Protocol

Protocol parameters:

* T – Time period for lockout duration/attempt counting
* N – Max number of failed authentication attempts allowed during *T*

The sign ∎ hereafter states for end of algorithm.

### Entry point for authentication request

1. If the incoming request contains a device cookie:
   1. [validate device cookie](#validate-device-cookie)
   2. if device cookie is invalid, proceed to step 2.
   3. if the device cookie is in the lockout list -> reject authentication attempt ∎
   4. else -> [authenticate user](#authenticate-user)
2. If authentication from untrusted clients is locked out for this user -> reject authentication attempt ∎
3. Else -> [authenticate user](#authenticate-user) ∎

### Authenticate user

1. Check user credentials
2. If credentials are valid
   1. [issue new device cookie to user’s client](#issue-new-device-cookie)
   2. proceed with authenticated user
3. Else
   1. [register failed authentication attempt](#register-failed-authentication-attempt)
   2. reject authentication attempt ∎

### Register failed authentication attempt

1. Register a failed authentication attempt with following information: { user, time, device cookie (if present) }
2. If device cookie is present
   1. count number of failed authentication attempts within time period *T* for this specific cookie
   2. if number of failed attempts within *T* > *N* -> put device cookie in lockout list until now() + *T*
3. Else (= no device cookie present)
   1. count number of all failed authentication attempts for this user during time period *T*
   2. if number of failed attempts within *T* > *N* -> lockout **ALL** authentication attempts from untrusted clients for this specific user until now() + *T*

### Issue new device cookie

Issue a browser cookie with a value like “LOGIN,NONCE,SIGNATURE”, where:

* LOGIN – User’s login name (or internal ID) corresponding to an authenticated user
* NONCE – Nonce of sufficient length or random value from CSRNG source
* SIGNATURE – HMAC(secret-key, “LOGIN,NONCE”)
* secret-key – server’s secret cryptographic key

### Validate device cookie

1. Validate that the device cookie is formatted as described [above](#issue-new-device-cookie)
2. Validate that SIGNATURE == HMAC(secret-key, “LOGIN,NONCE”)
3. Validate that LOGIN represents the user who is actually trying to authenticate

### Notes

* Putting the device cookie in a lockout list has the same effect as if the client had no device cookie. So clients with device cookies are potentially allowed to make *N* \* 2 failed authentication attempts before actual lockout.
* Issuing a new device cookie after each successful authentication allows us to avoid making decisions in situations like:
  > “Should the system block a device cookie if there were registered *N*-1 failed attempts, then one successful authentication, and then again 1 failed attempt? All within period *T*.”

## Implementation Tips

It is good idea to use a standard format for device cookies.
So, if the size of a cookie is not an issue, it is recommended to use [JWT](https://jwt.io/).

The following standard [claims](https://tools.ietf.org/html/rfc7519#page-9) can be used:

* sub – LOGIN
* jti – NONCE

**Important**: If you already use JWT for storing session tokens or other security stuff,
make sure you cannot confuse device cookies with other types of tokens.
There are two possible ways to mitigate this threat:

1. Use different signature / encryption keys for different token types
2. Add **aud** claim into device cookie token that unambiguously refers to brute force protection subsystem (e.g. “aud” : “brute-force-protection” or “device cookie”).

## Threat Analysis

| Threat | Threat details | Mitigation |
| --- | --- | --- |
| Online attack against one user | Attacker performs a guessing attack against a specific account from an untrusted client(s). | As long as the lockout for untrusted clients blocks authN attempts for a specific user from all untrusted clients, the number of guesses is restricted with (*N/T*)\*24h per day.  E.g. for *N* = 10 and *T* = 1h, any attacker will be limited with 240 attempts per day per user or 87600 attempts per user/year regardless of how large the botnet in their possession is.  If there is a [good password policy](http://password-policy-testing.wikidot.com/results#toc5) in place that limits minimum number attempts to [106](http://research.microsoft.com/pubs/227130/WhatsaSysadminToDo.pdf) then the targeted attack will last (on average) 5 years. |
| Online attack using stolen device cookies | Attacker performs long-running guessing attack against specific account(s) from known clients.  Using valid device cookies allows the attacker to scale attacks linearly, e.g. each device cookie adds extra *N* attempts per *T* for specific user. | There may be two ways to steal device cookies:   * Using physical access to a known client * Active attack against a remote client   In both cases if the attacker can steal device cookies on a regular basis they may have enough power to steal not only device cookies but also session cookies or even passwords. However in our security model this attack is irrelevant if device cookies are adequately protected (use **Secure** and **HttpOnly** flags).  **Proposal**: Accidental access to one device cookie contributes little to attack speed. Applications may implement persistent lockout for certain device cookies to address such cases. E.g. permanently lockout a device cookie after *N*\*10 failed attempts. |
| Online attack against multiple users | Attacker performs guessing attack against a specific number of accounts from untrusted clients.  Attacker may try the same password from a long list against many (all) accounts in a system without reaching *N* failed attempts per account during period *T*. | There is no specific mitigation for this threat in the protocol.  Good password policy may be a sufficient countermeasure for such attacks.  Additionally an application may temporarily require CAPTCHA solving for authentication from **untrusted** clients in case there are too many authentication attempts for different accounts during a specified period of time. |
| Spoof device cookie | Attacker may try to forge a valid device cookie for any user in a system. | Proper crypto implementation: HMAC and random secret key. |
| Tamper with existing device cookie | Attacker may try to tamper with a device cookie valid for one user to make it suitable for another. | Proper crypto implementation: HMAC and random secret key. |
| DoS for specific account | Attackers may cause permanent lockout for all untrusted devices for a specific user. Thus the user may be blocked from loggging into the system as they would need to login from a **new device** or to login after **cleaning up their browser cache**. | Issue a valid device cookie after visiting password reset link (an actual password reset is not necessary). Thus, if the user demonstrates their possession of a personal email account then the system may trust a client to try entering their credentials. |
| DoS for specific account when client is used by different accounts | There are situations when the same client is legitimately used to authenticate different users. For example, a family-shared PC or tablet. Thus, after successful authentication of one user another legitimate user will be treated as user of untrusted client and will be susceptible to a DoS attack. | Cases where the same client is shared between legitimate users may be considered out of scope by default.  If such cases are critical for application usability, it may deal with them by issuing device cookies with names that contain LOGIN and analyze them accordingly. |

---

[Watch](https://github.com/owasp/www-community/subscription)
[Star](https://github.com/owasp/www-community)

**The OWASP® Foundation** works to improve the security of software through its community-led open source software projects,
hundreds of chapters worldwide, tens of thousands of members, and by hosting local and global conferences.

### Upcoming OWASP Global Events

## Corporate Supporters

[Become a corporate supporter](https://owasp.org/supporters)

* [HOME](https://owasp.org/)
* [PROJECTS](https://owasp.org/projects/)
* [CHAPTERS](https://owasp.org/chapters/)
* [EVENTS](https://owasp.org/events/)
* [ABOUT](https://owasp.org/about/)
* [PRIVACY](https://owasp.org/www-policy/operational/privacy)
* [SITEMAP](https://owasp.org/sitemap/)
* [CONTACT](https://owasp.org/contact/)

OWASP, the OWASP logo, and Global AppSec are registered trademarks and AppSec Days, AppSec California, AppSec Cali, SnowFROC, and LASCON are trademarks of the OWASP Foundation, Inc. Unless otherwise specified, all content on the site is Creative Commons Attribution-ShareAlike v4.0 and provided without warranty of service or accuracy. For more information, please refer to our [General Disclaimer](/www-policy/operational/general-disclaimer.html). OWASP does not endorse or recommend commercial products or services, allowing our community to remain vendor neutral with the collective wisdom of the best minds in software security worldwide. Copyright 2025, OWASP Foundation, Inc.



=== Content from github.com_07396571_20250114_203924.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Fsecurity%2Fadvisories%2FGHSA-q67h-5pc3-g6jv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Fsecurity%2Fadvisories%2FGHSA-q67h-5pc3-g6jv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=elabftw%2Felabftw)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[elabftw](/elabftw)
/
**[elabftw](/elabftw/elabftw)**
Public

* [Notifications](/login?return_to=%2Felabftw%2Felabftw) You must be signed in to change notification settings
* [Fork
  223](/login?return_to=%2Felabftw%2Felabftw)
* [Star
   1k](/login?return_to=%2Felabftw%2Felabftw)

* [Code](/elabftw/elabftw)
* [Issues
  176](/elabftw/elabftw/issues)
* [Pull requests
  5](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

Additional navigation options

* [Code](/elabftw/elabftw)
* [Issues](/elabftw/elabftw/issues)
* [Pull requests](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

# Bypass bruteforce protection on login form

Low

[NicolasCARPi](/NicolasCARPi)
published
GHSA-q67h-5pc3-g6jv
Oct 22, 2021

## Package

elabftw
(web app)

## Affected versions

<4.1.0

## Patched versions

4.1.0

## Description

### Impact

This vulnerability affects users of the eLabFTW before 4.1.0, it allows attackers to bypass a brute-force protection mechanism by using many different forged PHPSESSID values in HTTP Cookie header.

Note that the protection that was in place before 4.1.0 was never intended to be unbreakable, and in fact must have caused more troubles to legitimate users rather than a potential attacker.

### Patches

This issue has been addressed by implementing state of the art brute force login protection, as recommended by [Owasp](https://owasp.org/www-community/Slow_Down_Online_Guessing_Attacks_with_Device_Cookies) with Device Cookies.

This mechanism will not impact users and will effectively thwart any brute-force attempts at guessing passwords. How it works quickly:

* a successful login will create a cookie on the device
* trying too many passwords from an untrusted device (no device cookies) will lock the account
* a locked account can only log in from a trusted device
* even a good password guess on a locked account will be unsuccessful

### Workarounds

The only correct way to address this is to upgrade to version 4.1.0. Adding rate limitation upstream of the eLabFTW service is of course a valid option, with or without upgrading.

### References

This vulnerability was found and responsibly disclosed by [@krastanoel](https://github.com/krastanoel).

See published paper: <https://www.exploit-db.com/docs/50436>

### For more information

If you have any questions or comments about this advisory:

* Open an issue [here](https://github.com/elabftw/elabftw/issues/new/choose)
* Or create a discussion [here](https://github.com/elabftw/elabftw/discussions/)

### Severity

Low

### CVE ID

CVE-2021-41171

### Weaknesses

[CWE-307](/advisories?query=cwe%3A307)

### Credits

* [![@krastanoel](https://avatars.githubusercontent.com/u/87141617?s=40&v=4)](/krastanoel)
  [krastanoel](/krastanoel)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.exploit-db.com_c1fb8eee_20250114_203925.html ===
Brute-force login and Bypass
Account lockout on elabFTW 1.8.5

samguy, krastanoel[at]gmail[dot]com

2021-07-08

1
1
1
1

2
2
3

4

11

12

Contents

1 Introduction

1.1 What is elabFTW .
.
1.2 Affected version .
.
.
1.3 Mitigation .

.

.

2 Technical analysis

Lockout process

2.1
2.2 Attack process

.

.
.

3 Exploitation

4 Conclusion

.
.
.

.
.

.
.
.

.
.

.
.
.

.
.

.
.
.

.
.

.
.
.

.
.

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
.

.

5 Appendix A: Account Enumeration

i

1 Introduction

This paper will explain how to bypass brute-force protection or account lockout on elabFTW 1.8.5.
During a penetration test, I came across this speciﬁc version and it has an authenticated remote code
execution vulnerability so it needs valid accounts and credentials. The protection bypass was found
using code review and then leveraged that to automate the attacks using Burp Suite Intruder.

1.1 What is elabFTW

eLabFTW is a free and open source electronic laboratory notebook for researchers.1 Once installed on
a server, it allows researchers to track their experiments, but also to manage their assets in the lab
(antibodies, mouse, siRNAs, proteins, etc.).

1.2 Affected version

The attacks have been speciﬁcally tested against versions 1.8.5 and it has been ﬁxed in version 4.1.0.2

1.3 Mitigation

1. create readFailedLoginByIp function on app/models/Logs.php to execute query where user ﬁeld

is REMOTE_ADDR and the body is Failed login attempt.

2. Invoke readFailedLoginByIp function on login.php to validates if the count is reach the failed

attempt limit and banned.

1https://github.com/elabftw/elabftw
2https://github.com/elabftw/elabftw/releases/tag/4.1.0

1

2 Technical analysis

This section will explain how the lockout process works by testing the login page while also reviewing
the source code and then making an attack process.

2.1 Lockout process

Assuming the administrator email is already known as “administrator@elabftw.local” with a wrong
password submitted in the login form will produce a failed login message. See Appendix A to enumerate
valid email accounts.

From the ﬂash messages above, failing 3 times will result in being banned for 1 hour. Let’s ﬁnd out
where in the source code these messages are triggered.

2

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

From the grep result above there are two ﬁles triggering the error messages: LoginController.php and
login.html. Upon further inspection in LoginController.php ﬁle at line 74 there is an if-else validation
for login failed attempt.

74

75

76

77

78

79

80

if (!$Session->has('failed_attempt')) {
$Session->set('failed_attempt', 1);

} else {

$n = $Session->get('failed_attempt');
$n++;
$Session->set('failed_attempt', $n);

}

The code above will set failed_attempt key with value 1 in $Session variable if it’s not exist or,
increment the value if it does. Because PHP handles and tracks $Session variable using PHPSESSID
in a Cookie request header, which is controlled by user, the bypass is very obvious. Simply using random
value in PHPSESSID or, completely removing the Cookie header on each request to login.php will force
the application to create a new session and the failed_attempt key will always be set to 1.

When inspecting the login page a hidden input called formkey was found and it’s required along with
email and password as a data submitted to LoginController.php

2.2 Attack process

This section will assemble what was found when identifying how the lockout process works.

1. Make a GET request to login.php

• Extract PHPSESSID from the response header
• Extract formkey from the response body

2. Make a POST request to LoginController.php with PHPSESSID and formkey from step 1 included

and, use valid email address and wordlists for password on data ﬁeld

3. Follow url redirections from step 2 response location header

• If url redirect location is login.php, automatically remove the Cookie header
• If url redirect location is not login.php, the attack is succeed

samguy, krastanoel[at]gmail[dot]com

3

3 Exploitation

The exploitation will use Burp Suite’s Intruder3 tool to automate the attack process. First step is to
extract PHPSESSID and formkey from the login.php assuming the request was already made from the
browser through Burp Suite Proxy. Navigating to Proxy > HTTP History, right-clicking on the GET request
/login.php and select Send to Intruder:

Now navigate to Intruder window and choose Positions tab and remove a Cookie header if it exists:

3https://portswigger.net/burp/documentation/desktop/tools/intruder/using

4

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Next, choose Options tab and scroll down to Grep Extract. Tick Extract the following items from re-
sponses and set Maximum capture length to 150:

Click Add button then Refetch response and notice Set-Cookie header is being set. Select PHPSESSID
value and click OK:

Click Add button again and do the same for formkey value:

samguy, krastanoel[at]gmail[dot]com

5

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Select Always option on Redirections:

Navigate to HTTP History tab on Proxy window then select POST /app/controllers/LoginController.php
and copy the raw request:

samguy, krastanoel[at]gmail[dot]com

6

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Go back to Positions tab on Intruder window and paste copied raw request in the editor and then click
Add § button to set a mark on these ﬁelds: PHPSESSID,password,formkey and set Attack type
to Pitchfork:

Next, clicking the Payloads tab to set 3 payloads. Payload set 1 for PHPSESSID cookie value using
“Recursive Grep”:

samguy, krastanoel[at]gmail[dot]com

7

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Payload set 2 for password and set Payload type to “Simple list” then click Load to choose a small
wordlist ﬁle from /usr/share/wordlists/wfuzz/others/common_pass.txt:

samguy, krastanoel[at]gmail[dot]com

8

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Payload set 3 for formkey using “Recursive Grep”:

Using Mitmproxy command-line mitmdump as upstream proxy to automatically remove Cookie header
when following a redirect location request to /app/controllers/../../login.php.

kali@kali:~$ mitmdump -p8081 -k -H ":~q ~m GET .*/app/controllers/../../login.php:Cookie:''"
Proxy server listening at http://*:8081

Navigate to Project options > Connections > Upstream Proxy Servers, toggle Override user options and
click Add button. Specify the Destination host to target domain elabftw.local, Proxy host to 127.0.0.1
and Proxy port: 8081 and click OK:

samguy, krastanoel[at]gmail[dot]com

9

Brute-force login and Bypass Account lockout on elabFTW 1.8.5

2021-07-08

Go back to Intruder window and start the attack by clicking on Start attack button:

See image above the Payload1 values are always changing and these values are taken from PHPSESSID
columns for the next request. Forcing the application to create a new session so the failed_attempt
key will always be set to 1. The lockout process successfully bypassed.

Notice in the highlighted request, the Length size is bigger than others and in the Response 1 tab, the
Location header is pointed at “../../experiments.php” meaning the attack is successful.

samguy, krastanoel[at]gmail[dot]com

10

4 Conclusion

Brute-force attacks are often used to break through an application or services to reach the intended
goal. The goal is usually to extract conﬁdential data or in this case is to gain administrative access to
the application control panel to be able to exploit another critical vulnerability to fully take control of
the system.

The brute-force protection on elabFTW can be bypassed because the attacker has control over the
request header sent to the application. Meanwhile the application itself has to track failed login
attempts through the request header and then stored in the session that was created by the default
framework function.

Saving data in the sessions are common practices in web developments however, for this speciﬁc case
it’s better to have more strict implementation. Looking at the source code elabFTW maintainer opt out
to block the request by ip and instead, use a combination of remote ip-address concat with browser
user-agent and encrypted using md5. This implementation is also obvious to bypass just by changing
the browser user-agent because the attacker has control over the browser.

The elabFTW already has what it needs to prevent this attack, again looking at the source code the
application is already logging the failed attempt in the database. By adding a function to query and
extract the log based on the ipaddress and the failed attempt message, the result can be counted and
validated if it’s already reached the attempt limit to be banned.

11

5 Appendix A: Account Enumeration

Valid email account is needed to perform successful brute-force attacks on this application. Surprisingly
the reset password form page response can be used to determine if the email exists using wfuzz.

kali@kali:~$ wfuzz -c -L -u

,→

,→

"https://elabftw.local/app/controllers/ResetPasswordController.php" -d
"email=FUZZ@elabftw.local&Submit=" -b "PHPSESSID=FUZZ" -w names.txt --hs 'Email not found'

12



=== Content from github.com_8d651333_20250114_203921.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Fcommit%2F8e92afeec4c3a68dc88333881b7e6307f425706b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Fcommit%2F8e92afeec4c3a68dc88333881b7e6307f425706b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=elabftw%2Felabftw)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[elabftw](/elabftw)
/
**[elabftw](/elabftw/elabftw)**
Public

* [Notifications](/login?return_to=%2Felabftw%2Felabftw) You must be signed in to change notification settings
* [Fork
  223](/login?return_to=%2Felabftw%2Felabftw)
* [Star
   1k](/login?return_to=%2Felabftw%2Felabftw)

* [Code](/elabftw/elabftw)
* [Issues
  176](/elabftw/elabftw/issues)
* [Pull requests
  5](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

Additional navigation options

* [Code](/elabftw/elabftw)
* [Issues](/elabftw/elabftw/issues)
* [Pull requests](/elabftw/elabftw/pulls)
* [Discussions](/elabftw/elabftw/discussions)
* [Actions](/elabftw/elabftw/actions)
* [Security](/elabftw/elabftw/security)
* [Insights](/elabftw/elabftw/pulse)

## Commit

[Permalink](/elabftw/elabftw/commit/8e92afeec4c3a68dc88333881b7e6307f425706b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add JWT anti brute-force login protection ([#2831](https://github.com/elabftw/elabftw/pull/2831))

[Browse files](/elabftw/elabftw/tree/8e92afeec4c3a68dc88333881b7e6307f425706b)
Browse the repository at this point in the history

```
* WIP: better brute force login protection

* split device token classes

* mv schema to 63

* use int(10) in schema too

* add sysadmin action to clear locked users/devices

* remove the FK on authfail

* remove authfail users_id fk constraint in structure.sql

* catch the invalid device token exception

* remove the banned users stuff

* change invalid token message

* cleanup the exceptions a bit

* get rid of the useless InvalidCsrfTokenException

* remove unused js import

* introduce the AuthenticatedUser and AnonymousUser classes

and improve the App and init.inc.php files

* remove the populateFromEmail method from Users

* get rid of the useless SessionAuth

and rearrange init Auth and App

* be more specific about which kind of user can be loaded in App

* change Update class signature

* use init.inc.php in ApiController

* don't store the whole teamconfigarr in app
```

* Loading branch information

[![@NicolasCARPi](https://avatars.githubusercontent.com/u/3043706?s=40&v=4)](/NicolasCARPi)

[NicolasCARPi](/elabftw/elabftw/commits?author=NicolasCARPi "View all commits by NicolasCARPi")
authored
Aug 8, 2021

1 parent
[20e785f](/elabftw/elabftw/commit/20e785fed8450bdda78e8dc2954c91f31b685ccc)

commit 8e92afe

 Show file tree

 Hide file tree

Showing
**83 changed files**
with
**1,104 additions**
and
**749 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* composer.json
  [composer.json](#diff-d2ab9925cad7eac58e0ff4cc0d251a937ecf49e4b6bf57f8b95aab76648a9d34)
* composer.lock
  [composer.lock](#diff-f37acfaa6b11f575a9a6f41a75fa73a61d0f8ebc2c9b8cddc215d8aca10e44f5)
* src

  + classes

    - src/classes/App.php
      [App.php](#diff-81c916c932f30a02e2c426e38fa2abe06567c3bcb9945f5f01e5fc7acfac9ad1)
    - src/classes/Auth.php
      [Auth.php](#diff-9410ad4c121a7e81759ad456e0c73f4149fce9513bc22867178d5e06c4c736a9)
    - src/classes/Csrf.php
      [Csrf.php](#diff-8849a530f21ef02cc71dc9f484c0b358874d7625542a1d21c5fca0cea4506bf9)
    - src/classes/Db.php
      [Db.php](#diff-d0f4293f79f8d0eaccd11a7c6f2c738396f4dd9148328c9a77b975e6790864eb)
    - src/classes/Update.php
      [Update.php](#diff-3d67ba9de084c56e2851e2074347a871cca87ec26465538ec7cec6fc281857b2)
  + commands

    - src/commands/CheckDatabase.php
      [CheckDatabase.php](#diff-a2cb60881b024991d13ce6efb6a411b51d4c5861ba2fb91bfc8ffa95f18d8c6d)
    - src/commands/UpdateDatabase.php
      [UpdateDatabase.php](#diff-fe9be8c004a3e6d60697c98b0b333922abe09b0f38a665e30ac088e04941d5f0)
  + controllers

    - src/controllers/LoginController.php
      [LoginController.php](#diff-686bf553c54dbcbcab5f48c9cf3f15c7d9ef8b9e2d442f809ec50a41b075a5d5)
  + exceptions

    - src/exceptions/DatabaseErrorException.php
      [DatabaseErrorException.php](#diff-7d15a498298ee94962e44158270cd8fa846bf4a0aa97a004b12d6678e451d356)
    - src/exceptions/FilesystemErrorException.php
      [FilesystemErrorException.php](#diff-464db5ed8e69ae86c5f458d421ccf762b64a196b0fc15616460485dad7bd3336)
    - src/exceptions/IllegalActionException.php
      [IllegalActionException.php](#diff-c969390e10f4a68f4a59af66f80f7665f22197fc1601e3fd574f0f52f302d0cd)
    - src/exceptions/ImproperActionException.php
      [ImproperActionException.php](#diff-d8c9b12fba5da7c83cb6a2aa27af1f6437808105a2517aba70907f7d797c6bcc)
    - src/exceptions/InvalidCredentialsException.php
      [InvalidCredentialsException.php](#diff-8394a9af610ef68f676063f33adca03b4dbe0029f5fe963c56c6844dba289056)
    - src/exceptions/InvalidCsrfTokenException.php
      [InvalidCsrfTokenException.php](#diff-ddd2a3167ca2e08898dfae6cb0b7750b6739aac63467a9ce651c0c194eedd3af)
    - src/exceptions/InvalidDeviceTokenException.php
      [InvalidDeviceTokenException.php](#diff-77b802a8ca0ee872159de89c37629a1d8e652b5ccd82ec6aaa980d92ff23c4d0)
    - src/exceptions/InvalidSchemaException.php
      [InvalidSchemaException.php](#diff-26b0d8b665f272393bb4abae70ab4c73b638139e0bd4407bc797cbfd7d8e57b8)
    - src/exceptions/ProcessFailedException.php
      [ProcessFailedException.php](#diff-b5540ded22310004ad3acaedf9fabbc3cc3d711c427620d5bd8da8e506da2c89)
    - src/exceptions/QuantumException.php
      [QuantumException.php](#diff-40ddd4e77ec5995452ae215846b8fed47ff411dcfdfea2ebf208d2577cc1dbb1)
    - src/exceptions/ResourceNotFoundException.php
      [ResourceNotFoundException.php](#diff-78431df12773b48da4eca4248b5184f6b2c7c73b3d4812b2b6d2dea69564f0b1)
    - src/exceptions/UnauthorizedException.php
      [UnauthorizedException.php](#diff-54899f517361695b26e41022b41ede4add7b1ed862d015f876a1a2ebc8358990)
    - src/exceptions/WithMessageException.php
      [WithMessageException.php](#diff-fb84ef3c1641ff967cb0f91fc8dc57b3b923740ca6a852969a0c329b432c67d8)
  + models

    - src/models/AnonymousUser.php
      [AnonymousUser.php](#diff-f221b1ea75d4c08122575ce90918c25a4bb85b07b06eb6a78e9126fe9a55776e)
    - src/models/AuthFail.php
      [AuthFail.php](#diff-22ce1ea72701d058c41bd2360144e7bb07007f028b07c14293e6f57b6c2137bc)
    - src/models/AuthenticatedUser.php
      [AuthenticatedUser.php](#diff-2169dfb5b52691be6a73ddeb4b6869cd905bf52938f0bf9ac772e786c105467b)
    - src/models/BannedUsers.php
      [BannedUsers.php](#diff-eb20a7d56ccca41392cc6d5d455f97611dd6532668187f41e7ac5bd07f6726ab)
    - src/models/Config.php
      [Config.php](#diff-c13399cf2d12d1946e9b237b7ec3c5b7e6f03b3e4e7f9bf941c963356121a4ac)
    - src/models/ExistingUser.php
      [ExistingUser.php](#diff-272c24164c4b18372a7ea310c94a5d88610e59f99eced57be7c323fe49994f82)
    - src/models/Tags.php
      [Tags.php](#diff-276978519b19c95665a3a08039f18a42e90b17f8fb73e83dce9fd6ac7803b989)
    - src/models/Uploads.php
      [Uploads.php](#diff-5a0e0340d26ad33481203d3bb24bc006e4bb95ffcf7b6b3d5573a3242b876ce3)
    - src/models/Users.php
      [Users.php](#diff-702ffb2165b9cf0974c69878ca87bc8e1e3139b93f1c9d95a9034314f7dd21d7)
    - src/models/ValidatedUser.php
      [ValidatedUser.php](#diff-438dd7a0154c3e4a98b88c0047333a5825589bd7a414839366a014dc74143167)
  + services

    - src/services/DeviceToken.php
      [DeviceToken.php](#diff-8c92caa5a73ff3abe9e78fda2e31b01383cfb830a75ffc1510a5a7037da35e42)
    - src/services/DeviceTokenValidator.php
      [DeviceTokenValidator.php](#diff-9e8a474e6d6efb06c6c3d843ae39153a748b7480bad7ff6c95242af55ca623d6)
    - src/services/ExternalAuth.php
      [ExternalAuth.php](#diff-b528eb8fe0adaeeb344b4ff551cabf0c51ba96d87d446e745e3324710bfd98c2)
    - src/services/ImportCsv.php
      [ImportCsv.php](#diff-0f13b0168ba8ec44e7a78e112709ef08c3b44fd0cd9e7cf8b96275b689aa3b65)
    - src/services/LdapAuth.php
      [LdapAuth.php](#diff-b90cece95c301788bcf100e6fb1c25951b4d2fb09a8a47bc37858e94f5d762d7)
    - src/services/LocalAuth.php
      [LocalAuth.php](#diff-2e799eaa6f9ecf0c40e6382b114235987217f362758a1014d170a6cc11f862c5)
    - src/services/LoginHelper.php
      [LoginHelper.php](#diff-113ab60a2880f446d04c2614d0d767422780dea7c0c29bf9e73cfcdc1d5ed788)
    - src/services/MfaAuth.php
      [MfaAuth.php](#diff-6bd6aa4a7633c852ff25ae754737c866fca158bdff39b592857153f805ee3aa0)
    - src/services/Populate.php
      [Populate.php](#diff-1f3ebfe779c94a7768c46efdd139b96984885170f158a255bfb955ab0fa79462)
    - src/services/SamlAuth.php
      [SamlAuth.php](#diff-8ddc6a9dcd8808aa054930cb24fdcb9368fe4329777d6f7ef899717ef468eca9)
    - src/services/SessionAuth.php
      [SessionAuth.php](#diff-8a2ecbbb63dfe48a8959eee3abb3d7878291b0a4eeb64e8685074bb072187eec)
  + sql

    - src/sql/schema63.sql
      [schema63.sql](#diff-e145f24a4eba84b2e2b0c6c3e0e858dc40bf2a49bd7878112fd3d43a719440c3)
    - src/sql/structure.sql
      [structure.sql](#diff-198a09ca906cd0b7c57e175d65b3bdedf1c32378dd640c24e52c5a4b658b374d)
  + templates

    - src/templates/admin.html
      [admin.html](#diff-a1dbfb6bde7d768e2e48e3f0f9a44a682191e18ba5aa4270826e1e26b8c61a30)
    - src/templates/failed-attempt.html
      [failed-attempt.html](#diff-5f6f6729a26b3c28f6f1a911503704e689d9a3b235904bfbf5dbe5bb41dca95f)
    - src/templates/head.html
      [head.html](#diff-e2adcbdbac73eddb2d725642eafc8ff5d37b3a889927bb5c1c322a3355e88de1)
    - src/templates/login.html
      [login.html](#diff-3f2e2d0552c2277dbff566deb28013ad889f3293d6808587debb6ea68a9e7202)
    - src/templates/sysconfig.html
      [sysconfig.html](#diff-b63c9450153c42dab6a239550d6e96ceaec8affc7ce5557e8499c469bba14e96)
  + tools

    - src/tools/phpstan.neon
      [phpstan.neon](#diff-0c89d51e84da51fed82870ffde32a25860b8f4074dc91daab73406a648af2a83)
  + ts

    - src/ts/sysconfig.ts
      [sysconfig.ts](#diff-e857808e826af33ff68774674a67f8db16af6a5d9462a47dc34f7b24b90df767)
* tests

  + tests/docker-compose.yml
    [docker-compose.yml](#diff-e63f0ca35966a726ffc6894c07d1fe38b1870304c71f615e9cd404789c357732)
  + unit

    - classes

      * tests/unit/classes/AuthTest.php
        [AuthTest.php](#diff-64d8f76a01eb2a524634c110edd2cdb29dba4fda62613cc059a730cf68266f8f)
    - models

      * tests/unit/models/AuthFailTest.php
        [AuthFailTest.php](#diff-7f96df1ac3df1c0e44898320252119276e7623f6f3a14c402ebc70f4317bd8c9)
      * tests/unit/models/BannedUsersTest.php
        [BannedUsersTest.php](#diff-5188abd6cb93e0525891caac599558577b397ab23e3e3a07586dc296c1f594ae)
      * tests/unit/models/UsersTest.php
        [UsersTest.php](#diff-a834123bc6f578da3ec0610a04b6923c5d25d70cd54a4c0464736e063f890b34)
    - services

      * tests/unit/services/DeviceTokenTest.php
        [DeviceTokenTest.php](#diff-0037d581a3287dd72da32d811dd3c5102ab890359ca93dfc5210d506bd543457)
      * tests/unit/services/DeviceTokenValidatorTest.php
        [DeviceTokenValidatorTest.php](#diff-7b6d44c2c6a79903bfa849a05dde8d04eb65a8712ceed12944245a94cc041478)
      * tests/unit/services/LocalAuthTest.php
        [LocalAuthTest.php](#diff-d3b65ea104fb40f1d704097f4c4ef7e66e8a67b864dcc20750d19c53d8f11f54)
      * tests/unit/services/SessionAuthTest.php
        [SessionAuthTest.php](#diff-ecef05b4cc80a0cbabc54be588b9bc3e4805795f23284889dbe066d1cb6d9222)
* web

  + web/admin.php
    [admin.php](#diff-f9add40c5c1b154ce5fd3d4953d399818535e5c0c7e5bbd7ece84ff0b70565bf)
  + app

    - controllers

      * web/app/controllers/AdminController.php
        [AdminController.php](#diff-75b6714064f4c3d4b40d842ad16d5bb9c62e4925ff7a0bbdf9b93fde3c8bf4d7)
      * web/app/controllers/ApiController.php
        [ApiController.php](#diff-8352808d5519f83b0f76344f4dfe16e797836a01d001a25786f704a03d682bae)
      * web/app/controllers/CreateUserController.php
        [CreateUserController.php](#diff-96042ece6919d0a0073c4ee797f890f0ff2538f635b431f138d1fea9faf26e48)
      * web/app/controllers/EntityAjaxController.php
        [EntityAjaxController.php](#diff-790a83db81ed1b8c06137b2705be03360f6f06c172e7243c2389f8943cf2ea3c)
      * web/app/controllers/IdpsController.php
        [IdpsController.php](#diff-3f6f5adf5a520c0e4f069090c40a7612c72478f4a646cc86698f315bd8aa9bb0)
      * web/app/controllers/ImportController.php
        [ImportController.php](#diff-3b8b00590d81cd73ed8ce1776ff5eb03ad5cdccff3e7da5b65c572c479212c4a)
      * web/app/controllers/LoginController.php
        [LoginController.php](#diff-02a8b7c453dac470b51b3a9d6c8b423c37d3ec9540954fe517a59948dad2a2ca)
      * web/app/controllers/RegisterController.php
        [RegisterController.php](#diff-0b8bbfec39d0c5357f82e07564a9ea7617040b2ad9eb335ad5c2e00ffb51a511)
      * web/app/controllers/RequestHandler.php
        [RequestHandler.php](#diff-0c5acc6b1237fa0d800f114797cbc7e8c699eeaa10d51b7234abcf2ee9b12572)
      * web/app/controllers/ResetPasswordController.php
        [ResetPasswordController.php](#diff-1d5281123b11772f944cf99580cbda30c4916cb420f7ee825ecba416ef4482ab)
      * web/app/controllers/SortableAjaxController.php
        [SortableAjaxController.php](#diff-1ce158b835743febe9e9c2944c809d27cd2c9beac069cccd845a38ec2b5102f3)
      * web/app/controllers/SysconfigAjaxController.php
        [SysconfigAjaxController.php](#diff-b508743569cc19f9500cc1f0884c1758140dc5cba386ac51c3bd5e032dcb47d2)
      * web/app/controllers/TeamController.php
        [TeamController.php](#diff-6a97181e400960c0efa9250166a3c9582e5ef24d66860bc43adda6a637e32bca)
      * web/app/controllers/UcpController.php
        [UcpController.php](#diff-9450e4a8417e528a3d644a17be4949208e532b160ecd9e817603fb60ce389c5f)
      * web/app/controllers/UsersAjaxController.php
        [UsersAjaxController.php](#diff-2774a8aa42e598e858505c2a58a19ff95b7137528167eca0a20ed31aac71e65f)
      * web/app/controllers/UsersController.php
        [UsersController.php](#diff-fa892aee06054540dd27ae0e89870fbd08d332f48bd974180f143b61c2c7cdaf)
    - web/app/init.inc.php
      [init.inc.php](#diff-e52a8d2daccf84c22e799e5433afec2c9fd45cdf6871ae76cde9729a67279200)
  + web/database.php
    [database.php](#diff-e3968310d1c2be9dbac455cd47f540704b30004669d6b7fd96348319884cc032)
  + web/login.php
    [login.php](#diff-39f3543baa42ee6a14eaa8f9b3a0e58bdb3d23f62feb539f8d0588d7e358b35d)
  + web/sysconfig.php
    [sysconfig.php](#diff-97cf5f008f457be69a3441bc0fd15b1420d67a6cdb141b3b5185bfcc30051733)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[composer.json](#diff-d2ab9925cad7eac58e0ff4cc0d251a937ecf49e4b6bf57f8b95aab76648a9d34 "composer.json")

Show comments

[View file](/elabftw/elabftw/blob/8e92afeec4c3a68dc88333881b7e6307f425706b/composer.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,7 +38,8 @@ |
|  |  | "robthree/twofactorauth": "^1.7.0", |
|  |  | "directorytree/ldaprecord": "^2.0.3", |
|  |  | "league/flysystem": "^1.1", |
|  |  | "league/flysystem-memory": "^1.0" |
|  |  | "league/flysystem-memory": "^1.0", |
|  |  | "lcobucci/jwt": "^4.1" |
|  |  | }, |
|  |  | "require-dev": { |
|  |  | "roave/security-advisories": "dev-master", |
| Expand Down | |  |

137 changes: 136 additions & 1 deletion

137
[composer.lock](#diff-f37acfaa6b11f575a9a6f41a75fa73a61d0f8ebc2c9b8cddc215d8aca10e44f5 "composer.lock")

Show comments

[View file](/elabftw/elabftw/blob/8e92afeec4c3a68dc88333881b7e6307f425706b/composer.lock)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

109 changes: 84 additions & 25 deletions

109
[src/classes/App.php](#diff-81c916c932f30a02e2c426e38fa2abe06567c3bcb9945f5f01e5fc7acfac9ad1 "src/classes/App.php")

Show comments

[View file](/elabftw/elabftw/blob/8e92afeec4c3a68dc88333881b7e6307f425706b/src/classes/App.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,27 +1,35 @@ |
|  |  | <?php |
|  |  | <?php declare(strict\_types=1); |
|  |  | /\*\* |
|  |  | \* @package Elabftw\Elabftw |
|  |  | \* @author Nicolas CARPi <nico-git@deltablot.email> |
|  |  | \* @copyright 2012 Nicolas CARPi |
|  |  | \* @license https://www.gnu.org/licenses/agpl-3.0.html AGPL-3.0 |
|  |  | \* @see https://www.elabftw.net Official website |
|  |  | \*/ |
|  |  | declare(strict\_types=1); |
|  |  |  |
|  |  | namespace Elabftw\Elabftw; |
|  |  |  |
|  |  | use function basename; |
|  |  | use function bindtextdomain; |
|  |  | use function dirname; |
|  |  | use Elabftw\Exceptions\UnauthorizedException; |
|  |  | use Elabftw\Models\AnonymousUser; |
|  |  | use Elabftw\Models\AuthenticatedUser; |
|  |  | use Elabftw\Models\Config; |
|  |  | use Elabftw\Models\Teams; |
|  |  | use Elabftw\Models\Users; |
|  |  | use Elabftw\Services\Check; |
|  |  | use Elabftw\Traits\TwigTrait; |
|  |  | use Elabftw\Traits\UploadTrait; |
|  |  | use function in\_array; |
|  |  | use Monolog\Handler\ErrorLogHandler; |
|  |  | use Monolog\Logger; |
|  |  | use function substr; |
|  |  | use function putenv; |
|  |  | use function setlocale; |
|  |  | use Symfony\Component\HttpFoundation\Request; |
|  |  | use Symfony\Component\HttpFoundation\Session\Flash\FlashBag; |
|  |  | use Symfony\Component\HttpFoundation\Session\SessionInterface; |
|  |  | use function textdomain; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This is a super class holding various global objects |
| Expand All | | @@ -37,14 +45,16 @@ class App |
|  |  |  |
|  |  | public string $pageTitle = 'Lab manager'; |
|  |  |  |
|  |  | public string $linkName = 'Documentation'; |
|  |  |  |
|  |  | public string $linkHref = 'https://doc.elabftw.net'; |
|  |  |  |
|  |  | public array $ok = array(); |
|  |  |  |
|  |  | public array $ko = array(); |
|  |  |  |
|  |  | public array $warning = array(); |
|  |  |  |
|  |  | public array $teamConfigArr = array(); |
|  |  |  |
|  |  | protected Db $Db; |
|  |  |  |
|  |  | public function \_\_construct(public Request $Request, public SessionInterface $Session, public Config $Config, public Logger $Log, public Csrf $Csrf) |
| Expand All | | @@ -61,7 +71,7 @@ public function \_\_construct(public Request $Request, public SessionInterface $Se |
|  |  | $this->Users = new Users(); |
|  |  | $this->Db = Db::getConnection(); |
|  |  | // UPDATE SQL SCHEMA if necessary or show error message if version mismatch |
|  |  | $Update = new Update($this->Config, new Sql()); |
|  |  | $Update = new Update((int) $this->Config->configArr['schema'], new Sql()); |
|  |  | $Update->checkSchema(); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -91,29 +101,39 @@ public function getMinPasswordLength(): int |
|  |  | return Check::MIN\_PASSWORD\_LENGTH; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* If the current user is authenticated, load Users with an id |
|  |  | \*/ |
|  |  | public function loadUser(Users $users): void |
|  |  | //-\*-\*-\*-\*-\*-\*-\*\*-\*-\*-\*-\*-\*-\*-\*-// |
|  |  | // \_ \_ // |
|  |  | // | |\_\_ \_\_\_ \_\_\_ | |\_ // |
|  |  | // | '\_ \ / \_ \ / \_ \| \_\_| // |
|  |  | // | |\_) | (\_) | (\_) | |\_ // |
|  |  | // |\_.\_\_/ \\_\_\_/ \\_\_\_/ \\_\_| // |
|  |  | // // |
|  |  | //-\*-\*-\*-\*-\*-\*-\*\*-\*-\*-\*-\*-\*-\*-\*-// |
|  |  | public function boot(): void |
|  |  | { |
|  |  | $this->Users = $users; |
|  |  |  |
|  |  | // team config |
|  |  | $Teams = new Teams($this->Users); |
|  |  | $this->teamConfigArr = $Teams->read(new ContentParams()); |
|  |  | } |
|  |  | // load the Users with a userid if we are auth and not anon |
|  |  | if ($this->Session->has('is\_auth') && $this->Session->get('userid') !== 0) { |
|  |  | $this->loadUser(new AuthenticatedUser( |
|  |  | $this->Session->get('userid'), |
|  |  | $this->Session->get('team'), |
|  |  | )); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the lang (in short form like 'en' or 'fr') for the HTML attribute in head.html template |
|  |  | \*/ |
|  |  | public function getLangForHtmlAttribute(): string |
|  |  | { |
|  |  | $lang = 'en'; |
|  |  | if (isset($this->Users->userData['lang'])) { |
|  |  | $lang = substr($this->Users->userData['lang'], 0, 2); |
|  |  | // ANONYMOUS |
|  |  | if ($this->Session->get('is\_anon') === 1) { |
|  |  | // anon user only has access to a subset of pages |
|  |  | $allowedPages = array('index.php', 'experiments.php', 'database.php', 'search.php', 'make.php'); |
|  |  | if (!in\_array(basename($this->Request->getScriptName()), $allowedPages, true)) { |
|  |  | throw new UnauthorizedException(); |
|  |  | } |
|  |  |  |
|  |  | $this->loadUser(new AnonymousUser( |
|  |  | $this->Session->get('team'), |
|  |  | $this->getLang(), |
|  |  | )); |
|  |  | } |
|  |  |  |
|  |  | return $lang; |
|  |  | $this->initi18n(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -127,4 +147,43 @@ public function render(string $template, array $variables): string |
|  |  | { |
|  |  | return $this->getTwig($this->Config)->render($template, array\_merge(array('App' => $this), $variables)); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the lang of our current user |
|  |  | \*/ |
|  |  | public function getLang(): string |
|  |  | { |
|  |  | // if we have an authenticated user, use their lang setting |
|  |  | if ($this->Users instanceof AuthenticatedUser) { |
|  |  | return $this->Users->userData['lang']; |
|  |  | } |
|  |  | // default lang is the server configured one |
|  |  | return $this->Config->configArr['lang']; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Load a user object in our user field |
|  |  | \*/ |
|  |  | private function loadUser(AuthenticatedUser | AnonymousUser $users): void |
|  |  | { |
|  |  | $this->Users = $users; |
|  |  | // we have an user in a team, load the top menu link |
|  |  | $Teams = new Teams($this->Users); |
|  |  | $teamConfigArr = $Teams->read(new ContentParams()); |
|  |  | $this->linkName = $teamConfigArr['link\_name']; |
|  |  | $this->linkHref = $teamConfigArr['link\_href']; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Configure gettext domain |
|  |  | \*/ |
|  |  | private function initi18n(): void |
|  |  | { |
|  |  | $locale = $this->getLang() . '.utf8'; |
|  |  | $domain = 'messages'; |
|  |  | putenv("LC\_ALL=$locale"); |
|  |  | setlocale(LC\_ALL, $locale); |
|  |  | bindtextdomain($domain, dirname(\_\_DIR\_\_, 2) . '/src/langs'); |
|  |  | textdomain($domain); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8e92afe`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felabftw%2Felabftw%2Fcommit%2F8e92afeec4c3a68dc88333881b7e6307f425706b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


