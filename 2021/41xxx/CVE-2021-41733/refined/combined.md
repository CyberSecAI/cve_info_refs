=== Content from github.com_9a47e466_20250114_184228.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foppia%2Foppia%2Fpull%2F13892)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foppia%2Foppia%2Fpull%2F13892)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=oppia%2Foppia)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[oppia](/oppia)
/
**[oppia](/oppia/oppia)**
Public

* [Notifications](/login?return_to=%2Foppia%2Foppia) You must be signed in to change notification settings
* [Fork
  4.3k](/login?return_to=%2Foppia%2Foppia)
* [Star
   5.9k](/login?return_to=%2Foppia%2Foppia)

* [Code](/oppia/oppia)
* [Issues
  1.4k](/oppia/oppia/issues)
* [Pull requests
  40](/oppia/oppia/pulls)
* [Discussions](/oppia/oppia/discussions)
* [Actions](/oppia/oppia/actions)
* [Projects
  6](/oppia/oppia/projects)
* [Wiki](/oppia/oppia/wiki)
* [Security](/oppia/oppia/security)
* [Insights](/oppia/oppia/pulse)

Additional navigation options

* [Code](/oppia/oppia)
* [Issues](/oppia/oppia/issues)
* [Pull requests](/oppia/oppia/pulls)
* [Discussions](/oppia/oppia/discussions)
* [Actions](/oppia/oppia/actions)
* [Projects](/oppia/oppia/projects)
* [Wiki](/oppia/oppia/wiki)
* [Security](/oppia/oppia/security)
* [Insights](/oppia/oppia/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Foppia%2Foppia%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Foppia%2Foppia%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Secure manual URL redirection in the frontend #13892

 Merged

[brianrodri](/brianrodri)
merged 6 commits into
[oppia:develop](/oppia/oppia/tree/develop "oppia/oppia:develop")
from
[brianrodri:secure-redirection](/brianrodri/oppia/tree/secure-redirection "brianrodri/oppia:secure-redirection")

Sep 25, 2021

 Merged

# [Secure manual URL redirection in the frontend](#top) #13892

[brianrodri](/brianrodri)
merged 6 commits into
[oppia:develop](/oppia/oppia/tree/develop "oppia/oppia:develop")
from
[brianrodri:secure-redirection](/brianrodri/oppia/tree/secure-redirection "brianrodri/oppia:secure-redirection")

Sep 25, 2021

[Conversation
15](/oppia/oppia/pull/13892)
[Commits
6](/oppia/oppia/pull/13892/commits)
[Checks
0](/oppia/oppia/pull/13892/checks)
[Files changed](/oppia/oppia/pull/13892/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![brianrodri](https://avatars.githubusercontent.com/u/5094060?s=60&v=4)](/brianrodri)

Copy link

Contributor

### @brianrodri **[brianrodri](/brianrodri)** commented [Sep 21, 2021](#issue-1003008387)

## Overview

1. This PR fixes or fixes part of #N/A.
2. This PR does the following: Verifies that the URLs we redirect to are valid before navigating to them.

## Essential Checklist

* The PR title starts with "Fix #bugnum: ", followed by a short, clear summary of the changes. (If this PR fixes part of an issue, prefix the title with "Fix part of #bugnum: ...".)
* The linter/Karma presubmit checks have passed locally on your machine.
* "Allow edits from maintainers" is checked. (See [here](https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/allowing-changes-to-a-pull-request-branch-created-from-a-fork) for instructions on how to enable it.)
  + This lets reviewers restart your CircleCI tests for you.
* The PR is made from a branch that's **not** called "develop".

## Proof that changes are correct

No proof of changes needed because this does not change the UX of the app.

## PR Pointers

* Make sure to follow the [instructions for making a code change](https://github.com/oppia/oppia/wiki/Contributing-code-to-Oppia#instructions-for-making-a-code-change).
* Oppiabot will notify you when you don't add a PR\_CHANGELOG label. If you are unable to do so, please @-mention a code owner (who will be in the Reviewers list), or ask on [Gitter](https://gitter.im/oppia/oppia-chat).
* For what code owners will expect, see the [Code Owner's wiki page](https://github.com/oppia/oppia/wiki/Oppia%27s-code-owners-and-checks-to-be-carried-out-by-developers).
* Make sure your PR follows conventions in the [style guide](https://github.com/oppia/oppia/wiki/Coding-style-guide), otherwise this will lead to review delays.
* Never force push. If you do, your PR will be closed.
* Oppiabot can assign anyone for review/help if you leave a comment like the following: "{{Question/comment}} @{{reviewer\_username}} PTAL"
* Some of the e2e tests are flaky, and can fail for reasons unrelated to your PR. We are working on fixing this, but in the meantime, if you need to restart the tests, please check the ["If your build fails" wiki page](https://github.com/oppia/oppia/wiki/If-your-build-fails).

Sorry, something went wrong.

All reactions

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[Secure manual URL redirection in the frontend](/oppia/oppia/pull/13892/commits/1d5a6b255271689013370f2ed704eb68e3f5d76f "Secure manual URL redirection in the frontend")`

`[1d5a6b2](/oppia/oppia/pull/13892/commits/1d5a6b255271689013370f2ed704eb68e3f5d76f)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
added
the
[PR CHANGELOG: Bug fixes -- @nithusha21](/oppia/oppia/labels/PR%20CHANGELOG%3A%20Bug%20fixes%20--%20%40nithusha21)
label
[Sep 21, 2021](#event-5337683078)

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
requested review from
[srijanreddy98](/srijanreddy98) and
[vojtechjelinek](/vojtechjelinek)
as [code owners](/oppia/oppia/blob/477e6c914b48bef561cc010323579d885e81edec/.github/CODEOWNERS#L304)
[September 21, 2021 18:12](#event-5337683110)

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
requested a review
from a team
[September 21, 2021 18:12](#event-5337683117)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=80&v=4)](/apps/oppiabot)

Copy link

### **[oppiabot](/apps/oppiabot) bot** commented [Sep 21, 2021](#issuecomment-924237188)

| Hi [@brianrodri](https://github.com/brianrodri) please assign the required reviewer(s) for this PR. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
requested review from
[gp201](/gp201) and
[Radesh-kumar](/Radesh-kumar)
[September 21, 2021 18:12](#event-5337683150)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
assigned [brianrodri](/brianrodri)
[Sep 21, 2021](#event-5337683262)

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
requested a review
from [seanlip](/seanlip)
[September 21, 2021 18:13](#event-5337683760)

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
assigned [vojtechjelinek](/vojtechjelinek), [seanlip](/seanlip), [srijanreddy98](/srijanreddy98), [gp201](/gp201) and [Radesh-kumar](/Radesh-kumar) and unassigned [brianrodri](/brianrodri)
[Sep 21, 2021](#event-5337686240)

[![Radesh-kumar](https://avatars.githubusercontent.com/u/54100702?s=60&v=4)](/Radesh-kumar)

**[Radesh-kumar](/Radesh-kumar)**
approved these changes
[Sep 21, 2021](#pullrequestreview-760109809)

 [View reviewed changes](/oppia/oppia/pull/13892/files/1d5a6b255271689013370f2ed704eb68e3f5d76f)

Copy link

Contributor

### @Radesh-kumar **[Radesh-kumar](/Radesh-kumar)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM!

Sorry, something went wrong.

All reactions

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
unassigned [Radesh-kumar](/Radesh-kumar)
[Sep 21, 2021](#event-5337760589)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=80&v=4)](/apps/oppiabot)

Copy link

### **[oppiabot](/apps/oppiabot) bot** commented [Sep 21, 2021](#issuecomment-924247952)

| Unassigning [@Radesh-kumar](https://github.com/Radesh-kumar) since they have already approved the PR. |
| --- |

All reactions

Sorry, something went wrong.

 [brianrodri](/brianrodri)
added 2 commits
[September 21, 2021 16:44](#commits-pushed-68b0a1c)

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[update more URL components](/oppia/oppia/pull/13892/commits/68b0a1cc1aeea81652e02f0f180e108e8955c901 "update more URL components")`

`[68b0a1c](/oppia/oppia/pull/13892/commits/68b0a1cc1aeea81652e02f0f180e108e8955c901)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[add code coverage](/oppia/oppia/pull/13892/commits/a1234db0ec801d17dbe4038fd49660b2ac3d0500 "add code coverage")`

`[a1234db](/oppia/oppia/pull/13892/commits/a1234db0ec801d17dbe4038fd49660b2ac3d0500)`

[brianrodri](/brianrodri)
added a commit
to brianrodri/oppia
that referenced
this pull request
[Sep 21, 2021](#ref-commit-f0b67c6)
[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)

`[cherry-pickable copy of](/brianrodri/oppia/commit/f0b67c655fab4acf47dca2168509993170c404dd "cherry-pickable copy of #13892") [oppia#13892](https://github.com/oppia/oppia/pull/13892)`

`[f0b67c6](/brianrodri/oppia/commit/f0b67c655fab4acf47dca2168509993170c404dd)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
mentioned this pull request
[Sep 21, 2021](#ref-pullrequest-1003343373)

[Cherry-pickable copy of #13892
#13894](/oppia/oppia/pull/13894)
 Closed

4 tasks

[brianrodri](/brianrodri)
added a commit
to brianrodri/oppia
that referenced
this pull request
[Sep 21, 2021](#ref-commit-078c2f3)
[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)

`[cherry-pickable copy of](/brianrodri/oppia/commit/078c2f30f37a80d6fc35f5c58256fe0e424f0698 "cherry-pickable copy of #13892") [oppia#13892](https://github.com/oppia/oppia/pull/13892)`

`[078c2f3](/brianrodri/oppia/commit/078c2f30f37a80d6fc35f5c58256fe0e424f0698)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
mentioned this pull request
[Sep 21, 2021](#ref-pullrequest-1003347595)

[Cherry-pickable copy of #13892
#13895](/oppia/oppia/pull/13895)
 Closed

4 tasks

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
removed the request for review
from [gp201](/gp201)
[September 21, 2021 21:54](#event-5338973830)

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
unassigned [gp201](/gp201)
[Sep 21, 2021](#event-5338974582)

[brianrodri](/brianrodri)
added a commit
to brianrodri/oppia
that referenced
this pull request
[Sep 21, 2021](#ref-commit-abd34f4)
[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)

`[cherry-pickable copy of](/brianrodri/oppia/commit/abd34f44b4991fa4a91cf6451b8a20bd3698ab02 "cherry-pickable copy of #13892") [oppia#13892](https://github.com/oppia/oppia/pull/13892)`

`[abd34f4](/brianrodri/oppia/commit/abd34f44b4991fa4a91cf6451b8a20bd3698ab02)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
mentioned this pull request
[Sep 21, 2021](#ref-pullrequest-1003470192)

[Cherry-pickable copy of #13892
#13896](/oppia/oppia/pull/13896)
 Merged

4 tasks

[![seanlip](https://avatars.githubusercontent.com/u/10575562?s=60&v=4)](/seanlip)

**[seanlip](/seanlip)**
approved these changes
[Sep 22, 2021](#pullrequestreview-760414562)

 [View reviewed changes](/oppia/oppia/pull/13892/files/a1234db0ec801d17dbe4038fd49660b2ac3d0500)

Copy link

Member

### @seanlip **[seanlip](/seanlip)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks, LGTM!

Sorry, something went wrong.

All reactions

[![@seanlip](https://avatars.githubusercontent.com/u/10575562?s=40&v=4)](/seanlip)
[seanlip](/seanlip)
removed their assignment
[Sep 22, 2021](#event-5340109004)

[seanlip](/seanlip)
pushed a commit
that referenced
this pull request
[Sep 22, 2021](#ref-commit-981567e)
[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)

`[Secure manual URL redirection in the frontend -- cherrypickable copy of](/oppia/oppia/commit/981567ed42f0eb947fa6d2bc2258d6b3d4461f85 "Secure manual URL redirection in the frontend -- cherrypickable copy of #13892 (#13896)")`
…

`[981567e](/oppia/oppia/commit/981567ed42f0eb947fa6d2bc2258d6b3d4461f85)`

```
[#13892](https://github.com/oppia/oppia/pull/13892) ([#13896](https://github.com/oppia/oppia/pull/13896))
```

[![gp201](https://avatars.githubusercontent.com/u/30050862?s=60&v=4)](/gp201)

**[gp201](/gp201)**
approved these changes
[Sep 22, 2021](#pullrequestreview-760418451)

 [View reviewed changes](/oppia/oppia/pull/13892/files/a1234db0ec801d17dbe4038fd49660b2ac3d0500)

Copy link

Contributor

### @gp201 **[gp201](/gp201)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM!

Sorry, something went wrong.

All reactions

[![srijanreddy98](https://avatars.githubusercontent.com/u/23002114?s=60&v=4)](/srijanreddy98)

**[srijanreddy98](/srijanreddy98)**
approved these changes
[Sep 22, 2021](#pullrequestreview-760518278)

 [View reviewed changes](/oppia/oppia/pull/13892/files/a1234db0ec801d17dbe4038fd49660b2ac3d0500)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
unassigned [srijanreddy98](/srijanreddy98)
[Sep 22, 2021](#event-5340926600)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=80&v=4)](/apps/oppiabot)

Copy link

### **[oppiabot](/apps/oppiabot) bot** commented [Sep 22, 2021](#issuecomment-924643016)

| Unassigning [@srijanreddy98](https://github.com/srijanreddy98) since they have already approved the PR. |
| --- |

All reactions

Sorry, something went wrong.

[![PauloASilva](https://avatars.githubusercontent.com/u/2962581?s=60&v=4)](/PauloASilva)

**[PauloASilva](/PauloASilva)**
suggested changes
[Sep 22, 2021](#pullrequestreview-760626022)

 [View reviewed changes](/oppia/oppia/pull/13892/files/a1234db0ec801d17dbe4038fd49660b2ac3d0500)

Copy link

### @PauloASilva **[PauloASilva](/PauloASilva)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`getSafeReturnUrl()` current implementation still allows redirecting to external websites.

Sorry, something went wrong.

All reactions

[core/templates/services/utils.service.ts](/oppia/oppia/pull/13892/files/a1234db0ec801d17dbe4038fd49660b2ac3d0500#diff-c2cfe2fb52f142dc6514b69c05fb1d222a5f72ed774a9bac9fba36a40f5eb698)

|  |  | @@ -128,6 +128,46 @@ export class UtilsService { | |
| --- | --- | --- | --- |
|  |  | element.offsetHeight < element.scrollHeight); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Determines whether the URL is pointing to a page on the Oppia site. |
|  |  | getSafeReturnUrl(urlString: string): string { |

Copy link

### @PauloASilva **[PauloASilva](/PauloASilva)** [Sep 22, 2021](#discussion_r713726959) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`getSafeReturnUrl('//evil.com')` returns `//evil.com`, what may allow redirect to external websites:

1. `new URL('//evil.com')` (line 144) throws exception but validation continues
2. `new URL('//evil.com', document.baseURI);` (line 157) succeeds
3. `'//evil.com'.charAt(0) !== '/'`(line 163) condition is satisfied

Only relative URLs should be considered safe.

If, redirecting to external websites is a requirement, then known host names should be kept in an AllowList and the `urlString` checked against that list.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @brianrodri **[brianrodri](/brianrodri)** [Sep 22, 2021](#discussion_r713896635) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Gotcha, thanks! Redirecting to external websites is not a requirement, so we're fine with only trusting relative paths. Do you know of an API that can detect them securely? Or would checking for a second `/` suffice?

Sorry, something went wrong.

All reactions

Copy link

### @PauloASilva **[PauloASilva](/PauloASilva)** [Sep 22, 2021](#discussion_r713948831) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I am not an Angular expert but would some of the [available Router methods](https://angular.io/api/router/Router) do the job e.g. [`navigateByUrl()`](https://angular.io/api/router/Router#navigatebyurl)?

I see that [Angular Router has a `parseUrl()` method](https://angular.io/api/router/Router#parseurl): it may worth a look at.

If I had to do it in plain JavaScript/TypeScript, probably I would go with something simple (please don't use it as is without further testing):

```
getSafeReturnUrl(urlString: string): string {
  const anchor = document.createElement('a');
  anchor.href = urlString;

  return (anchor.host === window.location.host)? urlString : '/';
}
```

| Input | Output |
| --- | --- |
| `//evil.com` | `/` |
| `https://evil.com` | `/` |
| `javascript:alert(1)` | `/` |
| `data:,Hello%2C%20World%21` | `/` |
| `/login` | `/login` |
| `/` | `/` |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @brianrodri **[brianrodri](/brianrodri)** [Sep 22, 2021](#discussion_r714001770)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is super helpful, thanks Paulo!

I know [@srijanreddy98](https://github.com/srijanreddy98) has been promoting the usage of Angular router. Srijan, do you know of a way to protect against these "fake return URLs" using angular/routers?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @brianrodri **[brianrodri](/brianrodri)** [Sep 22, 2021](#discussion_r714036673) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

For now, I've added more test cases and a simple additional check since the approach you provided doesn't protect us from URL-encoded attacks. For now, we're at least a little more secure (I can't find an exhaustive list of test cases, so I'll consider this resolved since our current coverage seems "good enough").

Sorry, something went wrong.

All reactions

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=80&v=4)](/apps/oppiabot)

Copy link

### **[oppiabot](/apps/oppiabot) bot** commented [Sep 22, 2021](#issuecomment-924719973)

| Hi [@brianrodri](https://github.com/brianrodri), it looks like some changes were requested on this pull request by [@PauloASilva](https://github.com/PauloASilva). PTAL. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
assigned [brianrodri](/brianrodri)
[Sep 22, 2021](#event-5341581364)

 [brianrodri](/brianrodri)
added 2 commits
[September 22, 2021 11:00](#commits-pushed-6ab819e)

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[add more test cases and security](/oppia/oppia/pull/13892/commits/6ab819e281a62de713b670cd91b5970ed2915083 "add more test cases and security")`

`[6ab819e](/oppia/oppia/pull/13892/commits/6ab819e281a62de713b670cd91b5970ed2915083)`

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[fix lint](/oppia/oppia/pull/13892/commits/1150c0335a36dc1f1b9ea63fcea5103a57d29743 "fix lint")`

`[1150c03](/oppia/oppia/pull/13892/commits/1150c0335a36dc1f1b9ea63fcea5103a57d29743)`

[![@seanlip](https://avatars.githubusercontent.com/u/10575562?s=40&v=4)](/seanlip)
[seanlip](/seanlip)
mentioned this pull request
[Sep 22, 2021](#ref-pullrequest-1004742809)

[Secure redirection hotfix
#13901](/oppia/oppia/pull/13901)
 Merged

4 tasks

[seanlip](/seanlip)
pushed a commit
that referenced
this pull request
[Sep 23, 2021](#ref-commit-6d27d86)
[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)

`[Secure redirection hotfix (](/oppia/oppia/commit/6d27d86b3f58429806c1909d8415ca7cd8f46e9d "Secure redirection hotfix (#13901)

* cherry-pickable copy of #13892

* add more test cases and security")[#13901](https://github.com/oppia/oppia/pull/13901)[)](/oppia/oppia/commit/6d27d86b3f58429806c1909d8415ca7cd8f46e9d "Secure redirection hotfix (#13901)

* cherry-pickable copy of #13892

* add more test cases and security")`
…

`[6d27d86](/oppia/oppia/commit/6d27d86b3f58429806c1909d8415ca7cd8f46e9d)`

```
* cherry-pickable copy of [#13892](https://github.com/oppia/oppia/pull/13892)

* add more test cases and security
```

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
removed their assignment
[Sep 23, 2021](#event-5347672736)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
added
the
[PR: don't merge - STALE BUILD](/oppia/oppia/labels/PR%3A%20don%27t%20merge%20-%20STALE%20BUILD)
label
[Sep 25, 2021](#event-5359292985)

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=80&v=4)](/apps/oppiabot)

Copy link

### **[oppiabot](/apps/oppiabot) bot** commented [Sep 25, 2021](#issuecomment-927023761)

| Hi [@brianrodri](https://github.com/brianrodri), the build of this PR is stale and this could result in tests failing in develop. Please update this pull request with the latest changes from develop. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&v=4)](/brianrodri)

`[Merge remote-tracking branch 'upstream/develop' into secure-redirection](/oppia/oppia/pull/13892/commits/11a7838e2269729b17513eca910b04951daa83ee "Merge remote-tracking branch 'upstream/develop' into secure-redirection")`

`[11a7838](/oppia/oppia/pull/13892/commits/11a7838e2269729b17513eca910b04951daa83ee)`

[![@oppiabot](https://avatars.githubusercontent.com/in/11091?s=40&v=4)](/apps/oppiabot)
[oppiabot](/apps/oppiabot)
bot
removed
the
[PR: don't merge - STALE BUILD](/oppia/oppia/labels/PR%3A%20don%27t%20merge%20-%20STALE%20BUILD)
label
[Sep 25, 2021](#event-5359745768)

[![vojtechjelinek](https://avatars.githubusercontent.com/u/10142938?s=60&v=4)](/vojtechjelinek)

**[vojtechjelinek](/vojtechjelinek)**
approved these changes
[Sep 25, 2021](#pullrequestreview-763624403)

 [View reviewed changes](/oppia/oppia/pull/13892/files/11a7838e2269729b17513eca910b04951daa83ee)

Copy link

Contributor

### @vojtechjelinek **[vojtechjelinek](/vojtechjelinek)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM!

Sorry, something went wrong.

All reactions

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
merged commit [`8812985`](/oppia/oppia/commit/88129853022f8f3d4416344e0350701d984b7c43)
into
oppia:develop

[Sep 25, 2021](https://github.com/oppia/oppia/pull/13892#event-5360142483)

 [![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=40&u=74e8aa541e4c4a29b54fe6e2d8e7f07c03b6a844&v=4)](/brianrodri)
[brianrodri](/brianrodri)
deleted the
secure-redirection

branch
[September 25, 2021 19:21](#event-5360142531)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Foppia%2Foppia%2Fpull%2F13892)

Reviewers

[![@PauloASilva](https://avatars.githubusercontent.com/u/2962581?s=40&v=4)](/PauloASilva) [PauloASilva](/PauloASilva)

PauloASilva requested changes

[![@Radesh-kumar](https://avatars.githubusercontent.com/u/54100702?s=40&v=4)](/Radesh-kumar) [Radesh-kumar](/Radesh-kumar)

Radesh-kumar approved these changes

[![@gp201](https://avatars.githubusercontent.com/u/30050862?s=40&v=4)](/gp201) [gp201](/gp201)

gp201 approved these changes

[![@srijanreddy98](https://avatars.githubusercontent.com/u/23002114?s=40&v=4)](/srijanreddy98) [srijanreddy98](/srijanreddy98)

srijanreddy98 approved these changes

[![@seanlip](https://avatars.githubusercontent.com/u/10575562?s=40&v=4)](/seanlip) [seanlip](/seanlip)

seanlip approved these changes

[![@vojtechjelinek](https://avatars.githubusercontent.com/u/10142938?s=40&v=4)](/vojtechjelinek) [vojtechjelinek](/vojtechjelinek)

vojtechjelinek approved these changes

Assignees

[![@vojtechjelinek](https://avatars.githubusercontent.com/u/10142938?s=40&v=4)](/vojtechjelinek) [vojtechjelinek](/vojtechjelinek)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@brianrodri](https://avatars.githubusercontent.com/u/5094060?s=52&v=4)](/brianrodri) [![@PauloASilva](https://avatars.githubusercontent.com/u/2962581?s=52&v=4)](/PauloASilva) [![@vojtechjelinek](https://avatars.githubusercontent.com/u/10142938?s=52&v=4)](/vojtechjelinek) [![@seanlip](https://avatars.githubusercontent.com/u/10575562?s=52&v=4)](/seanlip) [![@srijanreddy98](https://avatars.githubusercontent.com/u/23002114?s=52&v=4)](/srijanreddy98) [![@gp201](https://avatars.githubusercontent.com/u/30050862?s=52&v=4)](/gp201) [![@Radesh-kumar](https://avatars.githubusercontent.com/u/54100702?s=52&v=4)](/Radesh-kumar)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


