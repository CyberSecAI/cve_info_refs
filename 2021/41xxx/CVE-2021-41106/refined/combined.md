=== Content from github.com_5d409e34_20250114_231748.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2F8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2F8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=lcobucci%2Fjwt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lcobucci](/lcobucci)
/
**[jwt](/lcobucci/jwt)**
Public

* [Notifications](/login?return_to=%2Flcobucci%2Fjwt) You must be signed in to change notification settings
* [Fork
  601](/login?return_to=%2Flcobucci%2Fjwt)
* [Star
   7.3k](/login?return_to=%2Flcobucci%2Fjwt)

* [Code](/lcobucci/jwt)
* [Issues
  9](/lcobucci/jwt/issues)
* [Pull requests
  3](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects
  0](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

Additional navigation options

* [Code](/lcobucci/jwt)
* [Issues](/lcobucci/jwt/issues)
* [Pull requests](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

## Commit

[Permalink](/lcobucci/jwt/commit/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Ensure key contents is used for all hashing algorithms

[Browse files](/lcobucci/jwt/tree/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73)
Browse the repository at this point in the history

```
On v3.4.0 we introduced the
`Lcobucci\JWT\Signer\Key\LocalFileReference`, which was designed to be
used with OpenSSL-based algorithms and avoid having to load the file
contents into user-land to sign/verify tokens.

However, other algorithms don't understand the scheme `file://` and will
incorrectly use the file path as the signing key.

This modifies and deprecates `LocalFileReference` to avoid that
misleading behaviour.

Co-authored-by: Anton Smirnov <sandfox@sandfox.me>
Co-authored-by: Marco Pivetta <ocramius@gmail.com>
```

* Loading branch information

[![@lcobucci](https://avatars.githubusercontent.com/u/201963?s=40&v=4)](/lcobucci) [![@arokettu](https://avatars.githubusercontent.com/u/963485?s=40&v=4)](/arokettu) [![@Ocramius](https://avatars.githubusercontent.com/u/154256?s=40&v=4)](/Ocramius)

3 people

committed
Sep 27, 2021

1 parent
[80784ee](/lcobucci/jwt/commit/80784ee7a72747820f9dce675cc4541dfea15f8a)

commit 8175de5

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**64 additions**
and
**25 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/configuration.md
    [configuration.md](#diff-17ed18489a956f326ec0fe4040850c5bc9261d4631fb42da4c52891d74a59180)
  + docs/upgrading.md
    [upgrading.md](#diff-0220ca71b6e5d1c80ad9e3dedd642059ed9a26c2a5ae414e46f022d2e688c9a6)
* phpstan.neon.dist
  [phpstan.neon.dist](#diff-6f19df6a6307a48db0940e6897591fb08776d2db8a6134737aa708defdb5c92d)
* src/Signer/Key

  + src/Signer/Key/LocalFileReference.php
    [LocalFileReference.php](#diff-64650eab428467e243e1195a602e1ac353d1bdbef34b77d510acd952af740cd3)
* test

  + functional

    - test/functional/HmacTokenTest.php
      [HmacTokenTest.php](#diff-000a09f36e3c8348c2b390573591951ae67c80aad1b1f743588a57d2d26c7475)
  + unit/Signer

    - test/unit/Signer/EcdsaTest.php
      [EcdsaTest.php](#diff-624d0ef5fdc57f69806f9a0928757562ffdd2f7d90407cd67e048a22724ae435)
    - Key

      * test/unit/Signer/Key/LocalFileReferenceTest.php
        [LocalFileReferenceTest.php](#diff-d3be1cb103646417c37977946138db6461d761bd82b4fba25f1ec2ab34686a64)
    - test/unit/Signer/RsaTest.php
      [RsaTest.php](#diff-5c8256ad5c1b66891061f1790b4151b4f4fab4441dbccde910473c1bba692701)

## There are no files selected for viewing

5 changes: 1 addition & 4 deletions

5
[docs/configuration.md](#diff-17ed18489a956f326ec0fe4040850c5bc9261d4631fb42da4c52891d74a59180 "docs/configuration.md")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/docs/configuration.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -41,10 +41,8 @@ Or provide a file path: |
|  |  |  |
|  |  | ```php |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  |  |
|  |  | $key = InMemory::file(\_\_DIR\_\_ . '/path-to-my-key-stored-in-a-file.pem'); // this reads the file and keeps its contents in memory |
|  |  | $key = LocalFileReference::file(\_\_DIR\_\_ . '/path-to-my-key-stored-in-a-file.pem'); // this just keeps a reference to file |
|  |  | ``` |
|  |  |  |
|  |  | #### For symmetric algorithms |
| Expand Down  Expand Up | | @@ -78,13 +76,12 @@ This means that it's fine to distribute your \*\*public key\*\*. However, the \*\*priv |
|  |  | ```php |
|  |  | use Lcobucci\JWT\Configuration; |
|  |  | use Lcobucci\JWT\Signer; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  |  |
|  |  | $configuration = Configuration::forAsymmetricSigner( |
|  |  | // You may use RSA or ECDSA and all their variations (256, 384, and 512) |
|  |  | new Signer\Rsa\Sha256(), |
|  |  | LocalFileReference::file(\_\_DIR\_\_ . '/my-private-key.pem'), |
|  |  | InMemory::file(\_\_DIR\_\_ . '/my-private-key.pem'), |
|  |  | InMemory::base64Encoded('mBC5v1sOKVvbdEitdSBenu59nfNfhwkedkJVNabosTw=') |
|  |  | // You may also override the JOSE encoder/decoder if needed by providing extra arguments here |
|  |  | ); |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[docs/upgrading.md](#diff-0220ca71b6e5d1c80ad9e3dedd642059ed9a26c2a5ae414e46f022d2e688c9a6 "docs/upgrading.md")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/docs/upgrading.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -96,9 +96,8 @@ You can find more information on how to use the configuration object, [here](con |
|  |  | ### Use new `Key` objects |
|  |  |  |
|  |  | `Lcobucci\JWT\Signer\Key` has been converted to an interface in `v4.0`. |
|  |  | We provide two new implementations: `Lcobucci\JWT\Signer\Key\InMemory` and `Lcobucci\JWT\Signer\Key\LocalFileReference`. |
|  |  |  |
|  |  | `Lcobucci\JWT\Signer\Key\InMemory` is a drop-in replacement of the behaviour for `Lcobucci\JWT\Signer\Key` in `v3.x`. |
|  |  | We provide `Lcobucci\JWT\Signer\Key\InMemory`, a drop-in replacement of the behaviour for `Lcobucci\JWT\Signer\Key` in `v3.x`. |
|  |  | You will need to pick the appropriated named constructor to migrate your code: |
|  |  |  |
|  |  | ```diff |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[phpstan.neon.dist](#diff-6f19df6a6307a48db0940e6897591fb08776d2db8a6134737aa708defdb5c92d "phpstan.neon.dist")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/phpstan.neon.dist)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,3 +6,4 @@ parameters: |
|  |  |  |
|  |  | ignoreErrors: |
|  |  | - '#.\*OpenSSLAsymmetricKey.\*#' |
|  |  | - '#Call to method .\* of deprecated class Lcobucci\\JWT\\Signer\\Key\\LocalFileReference#' |

8 changes: 7 additions & 1 deletion

8
[src/Signer/Key/LocalFileReference.php](#diff-64650eab428467e243e1195a602e1ac353d1bdbef34b77d510acd952af740cd3 "src/Signer/Key/LocalFileReference.php")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/src/Signer/Key/LocalFileReference.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,12 +9,14 @@ |
|  |  | use function strpos; |
|  |  | use function substr; |
|  |  |  |
|  |  | /\*\* @deprecated please use {@see InMemory} instead \*/ |
|  |  | final class LocalFileReference implements Key |
|  |  | { |
|  |  | private const PATH\_PREFIX = 'file://'; |
|  |  |  |
|  |  | private string $path; |
|  |  | private string $passphrase; |
|  |  | private string $contents; |
|  |  |  |
|  |  | private function \_\_construct(string $path, string $passphrase) |
|  |  | { |
| Expand All | | @@ -38,7 +40,11 @@ public static function file(string $path, string $passphrase = ''): self |
|  |  |  |
|  |  | public function contents(): string |
|  |  | { |
|  |  | return self::PATH\_PREFIX . $this->path; |
|  |  | if (! isset($this->contents)) { |
|  |  | $this->contents = InMemory::file($this->path)->contents(); |
|  |  | } |
|  |  |  |
|  |  | return $this->contents; |
|  |  | } |
|  |  |  |
|  |  | public function passphrase(): string |
| Expand Down | |  |

40 changes: 40 additions & 0 deletions

40
[test/functional/HmacTokenTest.php](#diff-000a09f36e3c8348c2b390573591951ae67c80aad1b1f743588a57d2d26c7475 "test/functional/HmacTokenTest.php")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/test/functional/HmacTokenTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,12 +7,17 @@ |
|  |  | use Lcobucci\JWT\Signer\Hmac\Sha256; |
|  |  | use Lcobucci\JWT\Signer\Hmac\Sha512; |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  | use Lcobucci\JWT\Token; |
|  |  | use Lcobucci\JWT\Validation\Constraint\SignedWith; |
|  |  | use Lcobucci\JWT\Validation\RequiredConstraintsViolated; |
|  |  | use PHPUnit\Framework\TestCase; |
|  |  |  |
|  |  | use function assert; |
|  |  | use function file\_put\_contents; |
|  |  | use function is\_string; |
|  |  | use function sys\_get\_temp\_dir; |
|  |  | use function tempnam; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @covers \Lcobucci\JWT\Configuration |
| Expand Down  Expand Up | | @@ -131,4 +136,39 @@ public function everythingShouldWorkWhenUsingATokenGeneratedByOtherLibs(): void |
|  |  | self::assertTrue($this->config->validator()->validate($token, $constraint)); |
|  |  | self::assertEquals('world', $token->claims()->get('hello')); |
|  |  | } |
|  |  |  |
|  |  | /\*\* @test \*/ |
|  |  | public function signatureValidationWithLocalFileKeyReferenceWillOperateWithKeyContents(): void |
|  |  | { |
|  |  | $key = tempnam(sys\_get\_temp\_dir(), 'key'); |
|  |  | assert(is\_string($key)); |
|  |  |  |
|  |  | file\_put\_contents($key, 'just a dummy key'); |
|  |  |  |
|  |  | $validKey = LocalFileReference::file($key); |
|  |  | $invalidKey = InMemory::plainText('file://' . $key); |
|  |  | $signer = new Sha256(); |
|  |  | $configuration = Configuration::forSymmetricSigner($signer, $validKey); |
|  |  | $validator = $configuration->validator(); |
|  |  |  |
|  |  | $token = $configuration->builder() |
|  |  | ->withClaim('foo', 'bar') |
|  |  | ->getToken($configuration->signer(), $configuration->signingKey()); |
|  |  |  |
|  |  | self::assertFalse( |
|  |  | $validator->validate( |
|  |  | $token, |
|  |  | new SignedWith($signer, $invalidKey) |
|  |  | ), |
|  |  | 'Token cannot be validated against the \*\*path\*\* of the key' |
|  |  | ); |
|  |  |  |
|  |  | self::assertTrue( |
|  |  | $validator->validate( |
|  |  | $token, |
|  |  | new SignedWith($signer, $validKey) |
|  |  | ), |
|  |  | 'Token can be validated against the \*\*contents\*\* of the key' |
|  |  | ); |
|  |  | } |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[test/unit/Signer/EcdsaTest.php](#diff-624d0ef5fdc57f69806f9a0928757562ffdd2f7d90407cd67e048a22724ae435 "test/unit/Signer/EcdsaTest.php")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/test/unit/Signer/EcdsaTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,6 +56,7 @@ private function getSigner(): Ecdsa |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Ecdsa::\_\_construct |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function signShouldReturnTheAHashBasedOnTheOpenSslSignature(): void |
|  |  | { |
| Expand Down  Expand Up | | @@ -88,6 +89,7 @@ public function signShouldReturnTheAHashBasedOnTheOpenSslSignature(): void |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Ecdsa::\_\_construct |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function verifyShouldDelegateToEcdsaSignerUsingPublicKey(): void |
|  |  | { |
| Expand Down | |  |

26 changes: 8 additions & 18 deletions

26
[test/unit/Signer/Key/LocalFileReferenceTest.php](#diff-d3be1cb103646417c37977946138db6461d761bd82b4fba25f1ec2ab34686a64 "test/unit/Signer/Key/LocalFileReferenceTest.php")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/test/unit/Signer/Key/LocalFileReferenceTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,11 @@ |
|  |  | use org\bovigo\vfs\vfsStream; |
|  |  | use PHPUnit\Framework\TestCase; |
|  |  |  |
|  |  | /\*\* @coversDefaultClass \Lcobucci\JWT\Signer\Key\LocalFileReference \*/ |
|  |  | /\*\* |
|  |  | \* @coversDefaultClass \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | final class LocalFileReferenceTest extends TestCase |
|  |  | { |
|  |  | /\*\* @before \*/ |
| Expand All | | @@ -33,20 +37,6 @@ public function thereShouldBeNoReferenceToAFileThatDoesNotExist(): void |
|  |  | LocalFileReference::file(vfsStream::url('root/test2.pem')); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @test |
|  |  | \* |
|  |  | \* @covers ::file |
|  |  | \* @covers ::\_\_construct |
|  |  | \* @covers ::contents |
|  |  | \*/ |
|  |  | public function pathShouldBeNormalised(): void |
|  |  | { |
|  |  | $key = LocalFileReference::file('file://' . vfsStream::url('root/test.pem')); |
|  |  |  |
|  |  | self::assertSame('file://vfs://root/test.pem', $key->contents()); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @test |
|  |  | \* |
| Expand All | | @@ -55,11 +45,11 @@ public function pathShouldBeNormalised(): void |
|  |  | \* @covers ::contents |
|  |  | \* @covers ::passphrase |
|  |  | \*/ |
|  |  | public function contentsShouldReturnOnlyTheReferenceToTheFile(): void |
|  |  | public function pathShouldBeNormalised(): void |
|  |  | { |
|  |  | $key = LocalFileReference::file(vfsStream::url('root/test.pem'), 'test'); |
|  |  | $key = LocalFileReference::file('file://' . vfsStream::url('root/test.pem'), 'test'); |
|  |  |  |
|  |  | self::assertSame('file://vfs://root/test.pem', $key->contents()); |
|  |  | self::assertSame('testing', $key->contents()); |
|  |  | self::assertSame('test', $key->passphrase()); |
|  |  | } |
|  |  | } |

4 changes: 4 additions & 0 deletions

4
[test/unit/Signer/RsaTest.php](#diff-5c8256ad5c1b66891061f1790b4151b4f4fab4441dbccde910473c1bba692701 "test/unit/Signer/RsaTest.php")

Show comments

[View file](/lcobucci/jwt/blob/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73/test/unit/Signer/RsaTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ final class RsaTest extends TestCase |
|  |  | \* @covers \Lcobucci\JWT\Signer\OpenSSL |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function signShouldReturnAValidOpensslSignature(): void |
|  |  | { |
| Expand Down  Expand Up | | @@ -100,6 +101,7 @@ public function signShouldRaiseAnExceptionWhenKeyIsNotParseable(): void |
|  |  | \* @covers \Lcobucci\JWT\Signer\InvalidKeyProvided |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function signShouldRaiseAnExceptionWhenKeyTypeIsNotRsa(): void |
|  |  | { |
| Expand All | | @@ -119,6 +121,7 @@ public function signShouldRaiseAnExceptionWhenKeyTypeIsNotRsa(): void |
|  |  | \* @covers \Lcobucci\JWT\Signer\OpenSSL |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function verifyShouldReturnTrueWhenSignatureIsValid(): void |
|  |  | { |
| Expand Down  Expand Up | | @@ -161,6 +164,7 @@ public function verifyShouldRaiseAnExceptionWhenKeyIsNotParseable(): void |
|  |  | \* @covers \Lcobucci\JWT\Signer\InvalidKeyProvided |
|  |  | \* |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\LocalFileReference |
|  |  | \* @uses \Lcobucci\JWT\Signer\Key\InMemory |
|  |  | \*/ |
|  |  | public function verifyShouldRaiseAnExceptionWhenKeyTypeIsNotRsa(): void |
|  |  | { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8175de5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2F8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_73aaaabd_20250114_231751.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2Fc45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2Fc45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=lcobucci%2Fjwt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lcobucci](/lcobucci)
/
**[jwt](/lcobucci/jwt)**
Public

* [Notifications](/login?return_to=%2Flcobucci%2Fjwt) You must be signed in to change notification settings
* [Fork
  601](/login?return_to=%2Flcobucci%2Fjwt)
* [Star
   7.3k](/login?return_to=%2Flcobucci%2Fjwt)

* [Code](/lcobucci/jwt)
* [Issues
  9](/lcobucci/jwt/issues)
* [Pull requests
  3](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects
  0](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

Additional navigation options

* [Code](/lcobucci/jwt)
* [Issues](/lcobucci/jwt/issues)
* [Pull requests](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

## Commit

[Permalink](/lcobucci/jwt/commit/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Ensure key contents is used for all hashing algorithms

[Browse files](/lcobucci/jwt/tree/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c)
Browse the repository at this point in the history

```
On v3.4.0 we introduced the
`Lcobucci\JWT\Signer\Key\LocalFileReference`, which was designed to be
used with OpenSSL-based algorithms and avoid having to load the file
contents into user-land to sign/verify tokens.

However, other algorithms don't understand the scheme `file://` and will
incorrectly use the file path as the signing key.

This modifies and deprecates `LocalFileReference` to avoid that
misleading behaviour.

Co-authored-by: Anton Smirnov <sandfox@sandfox.me>
Co-authored-by: Marco Pivetta <ocramius@gmail.com>
```

* Loading branch information

[![@lcobucci](https://avatars.githubusercontent.com/u/201963?s=40&v=4)](/lcobucci) [![@arokettu](https://avatars.githubusercontent.com/u/963485?s=40&v=4)](/arokettu) [![@Ocramius](https://avatars.githubusercontent.com/u/154256?s=40&v=4)](/Ocramius)

3 people

committed
Sep 27, 2021

1 parent
[511629a](/lcobucci/jwt/commit/511629a54465e89a31d3d7e4cf0935feab8b14c1)

commit c45bb8b

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**45 additions**
and
**14 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/configuration.md
    [configuration.md](#diff-17ed18489a956f326ec0fe4040850c5bc9261d4631fb42da4c52891d74a59180)
  + docs/upgrading.md
    [upgrading.md](#diff-0220ca71b6e5d1c80ad9e3dedd642059ed9a26c2a5ae414e46f022d2e688c9a6)
* src/Signer/Key

  + src/Signer/Key/LocalFileReference.php
    [LocalFileReference.php](#diff-64650eab428467e243e1195a602e1ac353d1bdbef34b77d510acd952af740cd3)
* test/functional

  + test/functional/HmacTokenTest.php
    [HmacTokenTest.php](#diff-000a09f36e3c8348c2b390573591951ae67c80aad1b1f743588a57d2d26c7475)

## There are no files selected for viewing

5 changes: 1 addition & 4 deletions

5
[docs/configuration.md](#diff-17ed18489a956f326ec0fe4040850c5bc9261d4631fb42da4c52891d74a59180 "docs/configuration.md")

Show comments

[View file](/lcobucci/jwt/blob/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c/docs/configuration.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -41,10 +41,8 @@ Or provide a file path: |
|  |  |  |
|  |  | ```php |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  |  |
|  |  | $key = InMemory::file(\_\_DIR\_\_ . '/path-to-my-key-stored-in-a-file.pem'); // this reads the file and keeps its contents in memory |
|  |  | $key = LocalFileReference::file(\_\_DIR\_\_ . '/path-to-my-key-stored-in-a-file.pem'); // this just keeps a reference to file |
|  |  | ``` |
|  |  |  |
|  |  | #### For symmetric algorithms |
| Expand Down  Expand Up | | @@ -78,13 +76,12 @@ This means that it's fine to distribute your \*\*public key\*\*. However, the \*\*priv |
|  |  | ```php |
|  |  | use Lcobucci\JWT\Configuration; |
|  |  | use Lcobucci\JWT\Signer; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  |  |
|  |  | $configuration = Configuration::forAsymmetricSigner( |
|  |  | // You may use RSA or ECDSA and all their variations (256, 384, and 512) |
|  |  | new Signer\RSA\Sha256(), |
|  |  | LocalFileReference::file(\_\_DIR\_\_ . '/my-private-key.pem'), |
|  |  | InMemory::file(\_\_DIR\_\_ . '/my-private-key.pem'), |
|  |  | InMemory::base64Encoded('mBC5v1sOKVvbdEitdSBenu59nfNfhwkedkJVNabosTw=') |
|  |  | // You may also override the JOSE encoder/decoder if needed by providing extra arguments here |
|  |  | ); |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[docs/upgrading.md](#diff-0220ca71b6e5d1c80ad9e3dedd642059ed9a26c2a5ae414e46f022d2e688c9a6 "docs/upgrading.md")

Show comments

[View file](/lcobucci/jwt/blob/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c/docs/upgrading.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -96,9 +96,8 @@ You can find more information on how to use the configuration object, [here](con |
|  |  | ### Use new `Key` objects |
|  |  |  |
|  |  | `Lcobucci\JWT\Signer\Key` has been converted to an interface in `v4.0`. |
|  |  | We provide two new implementations: `Lcobucci\JWT\Signer\Key\InMemory` and `Lcobucci\JWT\Signer\Key\LocalFileReference`. |
|  |  |  |
|  |  | `Lcobucci\JWT\Signer\Key\InMemory` is a drop-in replacement of the behaviour for `Lcobucci\JWT\Signer\Key` in `v3.x`. |
|  |  | We provide `Lcobucci\JWT\Signer\Key\InMemory`, a drop-in replacement of the behaviour for `Lcobucci\JWT\Signer\Key` in `v3.x`. |
|  |  | You will need to pick the appropriated named constructor to migrate your code: |
|  |  |  |
|  |  | ```diff |
| Expand Down | |  |

10 changes: 2 additions & 8 deletions

10
[src/Signer/Key/LocalFileReference.php](#diff-64650eab428467e243e1195a602e1ac353d1bdbef34b77d510acd952af740cd3 "src/Signer/Key/LocalFileReference.php")

Show comments

[View file](/lcobucci/jwt/blob/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c/src/Signer/Key/LocalFileReference.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,7 @@ |
|  |  | use function strpos; |
|  |  | use function substr; |
|  |  |  |
|  |  | /\*\* @deprecated Use \Lcobucci\JWT\Signer\Key\InMemory::file() instead \*/ |
|  |  | final class LocalFileReference extends Key |
|  |  | { |
|  |  | const PATH\_PREFIX = 'file://'; |
| Expand All | | @@ -26,13 +27,6 @@ public static function file($path, $passphrase = '') |
|  |  | $path = substr($path, 7); |
|  |  | } |
|  |  |  |
|  |  | if (! file\_exists($path)) { |
|  |  | throw FileCouldNotBeRead::onPath($path); |
|  |  | } |
|  |  |  |
|  |  | $key = new self('', $passphrase); |
|  |  | $key->content = self::PATH\_PREFIX . $path; |
|  |  |  |
|  |  | return $key; |
|  |  | return new self(self::PATH\_PREFIX . $path, $passphrase); |
|  |  | } |
|  |  | } |

41 changes: 41 additions & 0 deletions

41
[test/functional/HmacTokenTest.php](#diff-000a09f36e3c8348c2b390573591951ae67c80aad1b1f743588a57d2d26c7475 "test/functional/HmacTokenTest.php")

Show comments

[View file](/lcobucci/jwt/blob/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c/test/functional/HmacTokenTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,10 +10,16 @@ |
|  |  | use Lcobucci\JWT\Builder; |
|  |  | use Lcobucci\JWT\CheckForDeprecations; |
|  |  | use Lcobucci\JWT\Parser; |
|  |  | use Lcobucci\JWT\Signer\Key\InMemory; |
|  |  | use Lcobucci\JWT\Signer\Key\LocalFileReference; |
|  |  | use Lcobucci\JWT\Token; |
|  |  | use Lcobucci\JWT\Signature; |
|  |  | use Lcobucci\JWT\Signer\Hmac\Sha256; |
|  |  | use Lcobucci\JWT\Signer\Hmac\Sha512; |
|  |  | use ReflectionProperty; |
|  |  | use function file\_put\_contents; |
|  |  | use function sys\_get\_temp\_dir; |
|  |  | use function tempnam; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @author Luís Otávio Cobucci Oblonczyk <lcobucci@gmail.com> |
| Expand Down  Expand Up | | @@ -197,4 +203,39 @@ public function everythingShouldWorkWhenUsingATokenGeneratedByOtherLibs() |
|  |  | $this->assertEquals('world', $token->getClaim('hello')); |
|  |  | $this->assertTrue($token->verify($this->signer, 'testing')); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @test |
|  |  | \* |
|  |  | \* @coversNothing |
|  |  | \* |
|  |  | \* @see \Lcobucci\JWT\Signer\Key::setContent() |
|  |  | \*/ |
|  |  | public function signatureValidationWithLocalFileKeyReferenceWillOperateWithKeyContents() |
|  |  | { |
|  |  | $key = tempnam(sys\_get\_temp\_dir(), 'key'); |
|  |  | file\_put\_contents($key, 'just a dummy key'); |
|  |  |  |
|  |  | $validKey = LocalFileReference::file($key); |
|  |  | $invalidKey = InMemory::plainText($key); |
|  |  | $signer = new Sha256(); |
|  |  |  |
|  |  | // 3.4.x implicitly extracts key contents, when `file://` is detected |
|  |  | $reflectionContents = new ReflectionProperty(InMemory::class, 'content'); |
|  |  | $reflectionContents->setAccessible(true); |
|  |  | $reflectionContents->setValue($invalidKey, 'file://' . $key); |
|  |  |  |
|  |  | $token = (new Builder()) |
|  |  | ->withClaim('foo', 'bar') |
|  |  | ->getToken($signer, $validKey); |
|  |  |  |
|  |  | self::assertFalse( |
|  |  | $token->verify($signer, $invalidKey), |
|  |  | 'Token cannot be validated against the \*\*path\*\* of the key' |
|  |  | ); |
|  |  | self::assertTrue( |
|  |  | $token->verify($signer, $validKey), |
|  |  | 'Token can be validated against the \*\*contents\*\* of the key' |
|  |  | ); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c45bb8b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fcommit%2Fc45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_bf94f5e0_20250114_231753.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fsecurity%2Fadvisories%2FGHSA-7322-jrq4-x5hf)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flcobucci%2Fjwt%2Fsecurity%2Fadvisories%2FGHSA-7322-jrq4-x5hf)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=lcobucci%2Fjwt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lcobucci](/lcobucci)
/
**[jwt](/lcobucci/jwt)**
Public

* [Notifications](/login?return_to=%2Flcobucci%2Fjwt) You must be signed in to change notification settings
* [Fork
  601](/login?return_to=%2Flcobucci%2Fjwt)
* [Star
   7.3k](/login?return_to=%2Flcobucci%2Fjwt)

* [Code](/lcobucci/jwt)
* [Issues
  9](/lcobucci/jwt/issues)
* [Pull requests
  3](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects
  0](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

Additional navigation options

* [Code](/lcobucci/jwt)
* [Issues](/lcobucci/jwt/issues)
* [Pull requests](/lcobucci/jwt/pulls)
* [Discussions](/lcobucci/jwt/discussions)
* [Actions](/lcobucci/jwt/actions)
* [Projects](/lcobucci/jwt/projects)
* [Wiki](/lcobucci/jwt/wiki)
* [Security](/lcobucci/jwt/security)
* [Insights](/lcobucci/jwt/pulse)

# File reference keys leads to incorrect hashes on HMAC algorithms

Low

[lcobucci](/lcobucci)
published
GHSA-7322-jrq4-x5hf
Sep 28, 2021

## Package

composer

lcobucci/jwt
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>=3.4.0,<3.4.6; >=4.0.0, <4.0.4; >=4.1.0, <4.1.5

## Patched versions

3.4.6, 4.0.4, 4.1.5

## Description

### Impact

Users of HMAC-based algorithms (HS256, HS384, and HS512) combined with `Lcobucci\JWT\Signer\Key\LocalFileReference` as key are having their tokens issued/validated using the file path as hashing key - instead of the contents.

The HMAC hashing functions take any string as input and, since users can issue and validate tokens, people are lead to believe that everything works properly.

### Patches

All versions have been patched to always load the file contents, deprecated the `Lcobucci\JWT\Signer\Key\LocalFileReference`, and suggest `Lcobucci\JWT\Signer\Key\InMemory` as the alternative.

### Workarounds

Use `Lcobucci\JWT\Signer\Key\InMemory` instead of `Lcobucci\JWT\Signer\Key\LocalFileReference` to create the instances of your keys:

```
-use Lcobucci\JWT\Signer\Key\LocalFileReference;
+use Lcobucci\JWT\Signer\Key\InMemory;

-$key = LocalFileReference::file(__DIR__ . '/public-key.pem');
+$key = InMemory::file(__DIR__ . '/public-key.pem');
```
### References

* OpenSSL [file reference format](https://www.php.net/manual/en/function.openssl-pkey-get-private.php#refsect1-function.openssl-pkey-get-private-parameters)
* [HMAC hashing](https://www.php.net/manual/en/function.hash-hmac.php)
* Fix for 3.4: [c45bb8b](https://github.com/lcobucci/jwt/commit/c45bb8b961a8e742d8f6b88ef5ff1bd5cca5d01c)
* Fix for 4.x: [8175de5](https://github.com/lcobucci/jwt/commit/8175de5b841fbe3fd97d2d49b3fc15c4ecb39a73)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [lcobucci/jwt](https://github.com/lcobucci/jwt/issues/new)
* Email us at lcobucci@php.net

### Severity

Low

### CVE ID

CVE-2021-41106

### Weaknesses

No CWEs

### Credits

* [![@arokettu](https://avatars.githubusercontent.com/u/963485?s=40&v=4)](/arokettu)
  [arokettu](/arokettu)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


