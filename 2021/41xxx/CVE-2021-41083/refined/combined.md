=== Content from github.com_17cf458a_20250114_202130.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjustingit%2Fdada-mail%2Fcommit%2Fd4d3d86d08c816b4da75a5ef45abc12188772459)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjustingit%2Fdada-mail%2Fcommit%2Fd4d3d86d08c816b4da75a5ef45abc12188772459)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=justingit%2Fdada-mail)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[justingit](/justingit)
/
**[dada-mail](/justingit/dada-mail)**
Public

* [Notifications](/login?return_to=%2Fjustingit%2Fdada-mail) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fjustingit%2Fdada-mail)
* [Star
   174](/login?return_to=%2Fjustingit%2Fdada-mail)

* [Code](/justingit/dada-mail)
* [Issues
  160](/justingit/dada-mail/issues)
* [Pull requests
  1](/justingit/dada-mail/pulls)
* [Discussions](/justingit/dada-mail/discussions)
* [Actions](/justingit/dada-mail/actions)
* [Projects
  0](/justingit/dada-mail/projects)
* [Wiki](/justingit/dada-mail/wiki)
* [Security](/justingit/dada-mail/security)
* [Insights](/justingit/dada-mail/pulse)

Additional navigation options

* [Code](/justingit/dada-mail)
* [Issues](/justingit/dada-mail/issues)
* [Pull requests](/justingit/dada-mail/pulls)
* [Discussions](/justingit/dada-mail/discussions)
* [Actions](/justingit/dada-mail/actions)
* [Projects](/justingit/dada-mail/projects)
* [Wiki](/justingit/dada-mail/wiki)
* [Security](/justingit/dada-mail/security)
* [Insights](/justingit/dada-mail/pulse)

## Commit

[Permalink](/justingit/dada-mail/commit/d4d3d86d08c816b4da75a5ef45abc12188772459)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

This adds CSRF protection to the profiles.

[Browse files](/justingit/dada-mail/tree/d4d3d86d08c816b4da75a5ef45abc12188772459)
Browse the repository at this point in the history

* Loading branch information

[![@justingit](https://avatars.githubusercontent.com/u/39739?s=40&v=4)](/justingit)

[justingit](/justingit/dada-mail/commits?author=justingit "View all commits by justingit")
committed
Sep 20, 2021

1 parent
[626af66](/justingit/dada-mail/commit/626af66455ec74dd9b90ffb21121b45ab821d08a)

commit d4d3d86

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**138 additions**
and
**44 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* dada

  + DADA

    - dada/DADA/App.pm
      [App.pm](#diff-1c07c085d878119a7673ee4b6ab92668cd2bebbac038226d0ecfbaf89be2fb48)
    - Profile

      * dada/DADA/Profile/Session.pm
        [Session.pm](#diff-522b19183f55a6aeeaa920d02e3e7c4289500ed6a52194404460a9d54df57e18)
    - Template

      * dada/DADA/Template/Widgets.pm
        [Widgets.pm](#diff-fa71ac4abe165cee4be4aee4fbc1a009f352c4598329f20b3925cb095a99cce1)
  + templates

    - dada/templates/profile\_home.tmpl
      [profile\_home.tmpl](#diff-ca197e4b0ff2a5e90e78c6db6001bfea7b5cb5821974d66912c4bf51991246ec)
    - dada/templates/profile\_login.tmpl
      [profile\_login.tmpl](#diff-e9a14d3d9cf23c3414fca252fd914c6cff3597d94df33c91236abdb8d70e76b7)

## There are no files selected for viewing

71 changes: 47 additions & 24 deletions

71
[dada/DADA/App.pm](#diff-1c07c085d878119a7673ee4b6ab92668cd2bebbac038226d0ecfbaf89be2fb48 "dada/DADA/App.pm")

Show comments

[View file](/justingit/dada-mail/blob/d4d3d86d08c816b4da75a5ef45abc12188772459/dada/DADA/App.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15086,14 +15086,11 @@ sub profile\_login { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (  $DADA::Config::PROFILE\_OPTIONS->{enabled} != 1) { |
|  |  | if ( $DADA::Config::PROFILE\_OPTIONS->{enabled} != 1) { |
|  |  | return $self->default(); |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | if ( $DADA::Config::PROFILE\_OPTIONS->{enabled} != 1 ) { |
|  |  | return $self->default(); |
|  |  | } |
|  |  |  |
|  |  | require DADA::Profile; |
|  |  | ### |
|  |  | my $all\_errors = []; |
| Expand All | | @@ -15109,7 +15106,6 @@ sub profile\_login { |
|  |  | my $prof\_sess = DADA::Profile::Session->new; |
|  |  |  |
|  |  | if ( $q->param('process') != 1 ) { |
|  |  |  |
|  |  | if ( $prof\_sess->is\_logged\_in( { -cgi\_obj => $q } ) |
|  |  | && $q->param('logged\_out') != 1 ) |
|  |  | { |
| Expand All | | @@ -15118,13 +15114,20 @@ sub profile\_login { |
|  |  | -url => $DADA::Config::PROGRAM\_URL . '/profile/' ); |
|  |  | } |
|  |  | else { |
|  |  | my $scrn = ''; |
|  |  | my $scrn = ''; |
|  |  | my $using\_captcha = 0; |
|  |  |  |
|  |  | if ( $DADA::Config::PROFILE\_OPTIONS->{enable\_captcha} == 1 ) { |
|  |  | $using\_captcha = can\_use\_Google\_reCAPTCHA(); |
|  |  | } |
|  |  |  |
|  |  | my $auth\_state; |
|  |  | if ( $DADA::Config::DISABLE\_OUTSIDE\_LOGINS == 1 ) { |
|  |  | require DADA::Security::SimpleAuthStringState; |
|  |  | my $sast = DADA::Security::SimpleAuthStringState->new; |
|  |  | $auth\_state = $sast->make\_state; |
|  |  | } |
|  |  |  |
|  |  | $scrn = DADA::Template::Widgets::wrap\_screen( |
|  |  | { |
|  |  | -screen => 'profile\_login.tmpl', |
| Expand Down  Expand Up | | @@ -15167,6 +15170,9 @@ sub profile\_login { |
|  |  | removal => scalar $q->param('removal') || '', |
|  |  | WHOLE\_URL => $whole\_url, |
|  |  |  |
|  |  | auth\_state => $auth\_state, |
|  |  |  |
|  |  |  |
|  |  | # This should probably be deprecated, as I'm handling this in |
|  |  | # DADA::Template::Widgets, now |
|  |  | %{ DADA::Profile::feature\_enabled() } |
| Expand All | | @@ -15180,19 +15186,20 @@ sub profile\_login { |
|  |  | else { |
|  |  | my ( $status, $errors ) = $prof\_sess->validate\_profile\_login( |
|  |  | { |
|  |  | -email => xss\_filter( scalar $q->param('login\_email') ), |
|  |  | -password => xss\_filter( scalar $q->param('login\_password') ), |
|  |  | -email => xss\_filter( scalar $q->param('login\_email') ), |
|  |  | -password => xss\_filter( scalar $q->param('login\_password') ), |
|  |  | -auth\_state => xss\_filter( scalar $q->param('auth\_state') ), |
|  |  |  |
|  |  | }, |
|  |  | ); |
|  |  |  |
|  |  | if ( $status == 1 ) { |
|  |  | my $cookie = $prof\_sess->login( |
|  |  | { |
|  |  | -email => xss\_filter( scalar $q->param('login\_email') ), |
|  |  | -password => |
|  |  | xss\_filter( scalar $q->param('login\_password') ), |
|  |  | }, |
|  |  | -email  => xss\_filter( scalar $q->param('login\_email') ), |
|  |  | -password  => xss\_filter( scalar $q->param('login\_password') ), |
|  |  | -skip\_validation => 1, |
|  |  | }, |
|  |  | ); |
|  |  |  |
|  |  | #DEV: encoding? |
| Expand Down  Expand Up | | @@ -15397,18 +15404,31 @@ sub profile { |
|  |  | if ( $DADA::Config::PROFILE\_OPTIONS->{enabled} != 1) { |
|  |  | return $self->default(); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | require DADA::Profile::Session; |
|  |  | my $prof\_sess = DADA::Profile::Session->new; |
|  |  |  |
|  |  | if ( $prof\_sess->is\_logged\_in( { -cgi\_obj => $q } ) ) { |
|  |  | my $email = $prof\_sess->get( { -cgi\_obj => $q } ); |
|  |  | if ($prof\_sess->is\_logged\_in( { -cgi\_obj => $q } ) ) { |
|  |  |  |
|  |  | if(length($q->param('process')) > 0) { |
|  |  |  |
|  |  | if($prof\_sess->check\_csrf($q) == 0){ |
|  |  | $prof\_sess->logout; |
|  |  | $q->param('flavor', 'profile\_login'); |
|  |  | return $self->profile\_login(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | my $prof\_data = $prof\_sess->get( { -cgi\_obj => $q } ); |
|  |  |  |
|  |  | require DADA::Profile::Fields; |
|  |  | require DADA::Profile; |
|  |  |  |
|  |  | my $prof = DADA::Profile->new( { -email => $email } ); |
|  |  | my $dpf = DADA::Profile::Fields->new( { -email => $email } ); |
|  |  | my $prof = DADA::Profile->new( { -email => $prof\_data->{email} } ); |
|  |  | my $dpf = DADA::Profile::Fields->new( { -email => $prof\_data->{email} } ); |
|  |  | my $subscriber\_fields = |
|  |  | $dpf->{manager}->fields( { -show\_hidden\_fields => 0, } ); |
|  |  | my $field\_attr = $dpf->{manager}->get\_all\_field\_attributes; |
| Expand Down  Expand Up | | @@ -15614,7 +15634,7 @@ sub profile { |
|  |  | my $dps = DADA::Profile::Settings->new({-list => $list}); |
|  |  | my $r = $dps->save( |
|  |  | { |
|  |  | -email => $email, |
|  |  | -email => $prof\_data->{email}, |
|  |  | -setting => 'delivery\_prefs', |
|  |  | -value => $delivery\_prefs, |
|  |  | } |
| Expand Down  Expand Up | | @@ -15682,7 +15702,7 @@ sub profile { |
|  |  | my $dasu = DADA::App::Subscriptions::Unsub->new( |
|  |  | { -list => $i->{list} } ); |
|  |  | my $unsub\_link = $dasu->unsub\_link( |
|  |  | { -email => $email, -mid => '00000000000000' } ); |
|  |  | { -email => $prof\_data->{email}, -mid => '00000000000000' } ); |
|  |  |  |
|  |  | my $digest\_timeframe = |
|  |  | formatted\_runtime( $ls->param('digest\_schedule') ); |
| Expand All | | @@ -15695,7 +15715,7 @@ sub profile { |
|  |  | ); |
|  |  | my $s = $dps->fetch( |
|  |  | { |
|  |  | -email => $email, |
|  |  | -email => $prof\_data->{email}, |
|  |  | } |
|  |  | ); |
|  |  | my $delivery\_prefs = $s->{delivery\_prefs} || 'individual'; |
| Expand All | | @@ -15722,7 +15742,8 @@ sub profile { |
|  |  | -vars => { |
|  |  | errors => scalar $q->param('errors') |
|  |  | || 0, |
|  |  | 'profile.email' => $email, |
|  |  | 'profile.email' => $prof\_data->{email}, |
|  |  | csrf\_token => $prof\_data->{token}, |
|  |  | subscriber\_fields => $fields, |
|  |  | subscriptions => $filled, |
|  |  | has\_subscriptions => $has\_subscriptions, |
| Expand All | | @@ -15749,7 +15770,7 @@ sub profile { |
|  |  | $DADA::Config::PROFILE\_OPTIONS->{gravatar\_options} |
|  |  | ->{enable\_gravators}, |
|  |  | gravatar\_img\_url => |
|  |  | gravatar\_img\_url( { -email => $email, } ), |
|  |  | gravatar\_img\_url( { -email => $prof\_data->{email}, } ), |
|  |  | protected\_directories => $protected\_directories, |
|  |  | WHOLE\_URL => $whole\_url, |
|  |  | %{ DADA::Profile::feature\_enabled() }, |
| Expand Down  Expand Up | | @@ -16014,8 +16035,10 @@ sub profile\_update\_email { |
|  |  | my $prof\_sess = DADA::Profile::Session->new; |
|  |  | my $cookie = $prof\_sess->login( |
|  |  | { |
|  |  | -email => $profile\_info->{'profile.update\_email'}, |
|  |  | -no\_pass => 1, |
|  |  | -email => $profile\_info->{'profile.update\_email'}, |
|  |  | -no\_pass => 1, |
|  |  | -skip\_validation => 1, |
|  |  |  |
|  |  | } |
|  |  | ); |
|  |  |  |
| Expand Down | |  |

75 changes: 65 additions & 10 deletions

75
[dada/DADA/Profile/Session.pm](#diff-522b19183f55a6aeeaa920d02e3e7c4289500ed6a52194404460a9d54df57e18 "dada/DADA/Profile/Session.pm")

Show comments

[View file](/justingit/dada-mail/blob/d4d3d86d08c816b4da75a5ef45abc12188772459/dada/DADA/Profile/Session.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -90,13 +90,20 @@ sub \_login\_cookie { |
|  |  |  |
|  |  | require CGI::Session; |
|  |  |  |
|  |  | use DADA::Security::Password; |
|  |  |  |
|  |  | my $token = DADA::Security::Password::generate\_rand\_string(undef, 41); |
|  |  |  |
|  |  | my $session = new CGI::Session( $self->{dsn}, $q, $self->{dsn\_args} ); |
|  |  |  |
|  |  | $session->param( 'email', cased($args->{ -email }) ); |
|  |  | $session->param( '\_logged\_in', 1 ); |
|  |  | $session->param( 'email', cased($args->{ -email }) ); |
|  |  | $session->param( '\_logged\_in', 1 ); |
|  |  | $session->param( 'token', $token); |
|  |  |  |
|  |  |  |
|  |  | $session->expire( $DADA::Config::COOKIE\_PARAMS{ -expires } ); |
|  |  | $session->expire( '\_logged\_in', $DADA::Config::COOKIE\_PARAMS{ -expires } ); |
|  |  | $session->expire( $DADA::Config::COOKIE\_PARAMS{ -expires } ); |
|  |  | $session->expire( '\_logged\_in', $DADA::Config::COOKIE\_PARAMS{ -expires } ); |
|  |  | $session->expire( 'token', $DADA::Config::COOKIE\_PARAMS{ -expires } ); |
|  |  |  |
|  |  | $cookie = $q->cookie( |
|  |  | %{$DADA::Config::PROFILE\_OPTIONS->{cookie\_params}}, |
| Expand All | | @@ -106,10 +113,6 @@ sub \_login\_cookie { |
|  |  | ) : () |
|  |  |  |
|  |  | ); |
|  |  |  |
|  |  | # My proposal to address the situation is quit relying on flush() happen |
|  |  | # automatically, and recommend that people use an explicit flush() |
|  |  | # instead, which works reliably for everyone. |
|  |  | $session->flush(); |
|  |  |  |
|  |  | return $cookie; |
| Expand All | | @@ -124,7 +127,16 @@ sub login { |
|  |  | require CGI; |
|  |  | my $q = new CGI; |
|  |  |  |
|  |  | my ( $status, $errors ) = $self->validate\_profile\_login($args); |
|  |  | my ($status, $errors); |
|  |  |  |
|  |  | if($args->{-skip\_validation} == 0){ |
|  |  | ( $status, $errors ) = $self->validate\_profile\_login($args); |
|  |  | } |
|  |  | else { |
|  |  | $status = 1; |
|  |  | $errors = {}; |
|  |  | } |
|  |  |  |
|  |  | if ( $status == 0 ) { |
|  |  | croak "login failed."; |
|  |  | } |
| Expand Down  Expand Up | | @@ -182,6 +194,20 @@ sub validate\_profile\_login { |
|  |  | incorrect\_pass => 0, |
|  |  | }; |
|  |  |  |
|  |  |  |
|  |  | require DADA::Security::SimpleAuthStringState; |
|  |  | my $sast = DADA::Security::SimpleAuthStringState->new; |
|  |  | my $auth\_state = $args->{-auth\_state}; |
|  |  |  |
|  |  | if ( $DADA::Config::DISABLE\_OUTSIDE\_LOGINS == 1 ) { |
|  |  | if ( $sast->check\_state($auth\_state) != 1 ) { |
|  |  | $status = 0; |
|  |  | $errors->{invalid\_form} = 1; |
|  |  | } |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | require DADA::Profile; |
|  |  | my $prof = DADA::Profile->new( |
|  |  | { |
| Expand Down  Expand Up | | @@ -217,6 +243,30 @@ sub validate\_profile\_login { |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | sub check\_csrf { |
|  |  | my $self = shift; |
|  |  | my $q = shift; |
|  |  |  |
|  |  | my $s = CGI::Session->load( $self->{dsn}, $q, $self->{dsn\_args} ) |
|  |  | or croak 'failed to load session: ' . CGI::Session->errstr(); |
|  |  |  |
|  |  | if ( $s->is\_expired ) { |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | if ( $s->is\_empty ) { |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | if($q->param('csrf\_token') eq $s->param('token') ){ |
|  |  | return 1; |
|  |  | } |
|  |  | else { |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | } |
|  |  | sub is\_logged\_in { |
|  |  |  |
|  |  | my $self = shift; |
| Expand All | | @@ -230,6 +280,8 @@ sub is\_logged\_in { |
|  |  | $q = new CGI; |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | my $s = CGI::Session->load( $self->{dsn}, $q, $self->{dsn\_args} ) |
|  |  | or croak 'failed to load session: ' . CGI::Session->errstr(); |
|  |  |  |
| Expand Down  Expand Up | | @@ -272,7 +324,10 @@ sub get { |
|  |  | require CGI::Session; |
|  |  |  |
|  |  | my $session = new CGI::Session( $self->{dsn}, $q, $self->{dsn\_args} ); |
|  |  | return $session->param('email'); |
|  |  | return { |
|  |  | email => $session->param('email'), |
|  |  | token => $session->param('token'), |
|  |  | }; |
|  |  |  |
|  |  | } |
|  |  |  |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[dada/DADA/Template/Widgets.pm](#diff-fa71ac4abe165cee4be4aee4fbc1a009f352c4598329f20b3925cb095a99cce1 "dada/DADA/Template/Widgets.pm")

Show comments

[View file](/justingit/dada-mail/blob/d4d3d86d08c816b4da75a5ef45abc12188772459/dada/DADA/Template/Widgets.pm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1250,7 +1250,7 @@ sub profile\_widget { |
|  |  |  |
|  |  |  |
|  |  | my $scr = ''; |
|  |  | my $email  = ''; |
|  |  | my $prof\_data = {}; |
|  |  | my $is\_logged\_in = 0; |
|  |  | my $profiles\_enabled = $DADA::Config::PROFILE\_OPTIONS->{enabled}; |
|  |  | if ( $DADA::Config::PROFILE\_OPTIONS->{enabled} != 1) |
| Expand All | | @@ -1261,7 +1261,7 @@ sub profile\_widget { |
|  |  | if(defined($prof\_sess\_obj)){ |
|  |  | if ( $prof\_sess\_obj->is\_logged\_in( { -cgi\_obj => $q } ) ) { |
|  |  | $is\_logged\_in = 1; |
|  |  | $email = $prof\_sess\_obj->get( { -cgi\_obj => $q } ); |
|  |  | $prof\_data = $prof\_sess\_obj->get( { -cgi\_obj => $q } ); |
|  |  | } |
|  |  | } |
|  |  | else { |
| Expand All | | @@ -1273,7 +1273,7 @@ sub profile\_widget { |
|  |  | my $prof\_sess = DADA::Profile::Session->new; |
|  |  | if ( $prof\_sess->is\_logged\_in( { -cgi\_obj => $q } ) ) { |
|  |  | $is\_logged\_in = 1; |
|  |  | $email = $prof\_sess->get( { -cgi\_obj => $q } ); |
|  |  | $prof\_data = $prof\_sess->get( { -cgi\_obj => $q } ); |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand All | | @@ -1285,11 +1285,11 @@ sub profile\_widget { |
|  |  | -vars => { |
|  |  | profiles\_enabled => $profiles\_enabled, |
|  |  | is\_logged\_in => $is\_logged\_in, |
|  |  | 'profile.email' => $email, |
|  |  | 'profile.email' => $prof\_data->{email}, |
|  |  | gravators\_enabled => $DADA::Config::PROFILE\_OPTIONS->{gravatar\_options}->{enable\_gravators}, |
|  |  | gravatar\_img\_url => gravatar\_img\_url( |
|  |  | { |
|  |  | -email => $email, |
|  |  | -email => $prof\_data->{email}, |
|  |  | -size => 45, |
|  |  | } |
|  |  | ), |
| Expand Down | |  |

17 changes: 12 additions & 5 deletions

17
[dada/templates/profile\_home.tmpl](#diff-ca197e4b0ff2a5e90e78c6db6001bfea7b5cb5821974d66912c4bf51991246ec "dada/templates/profile_home.tmpl")

Show comments

[View file](/justingit/dada-mail/blob/d4d3d86d08c816b4da75a5ef45abc12188772459/dada/templates/profile_home.tmpl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -254,10 +254,11 @@ |
|  |  | <legend>Delivery Preferences:</legend> |
|  |  | <form action="<!-- tmpl\_var S\_PROGRAM\_URL -->" method="post"> |
|  |  |  |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="profile\_delivery\_preferences" > |
|  |  | <input type="hidden" name="list" value="<!-- tmpl\_var list\_settings.list -->" > |
|  |  |  |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="profile\_delivery\_preferences" > |
|  |  | <input type="hidden" name="list" value="<!-- tmpl\_var list\_settings.list -->" > |
|  |  | <input type="hidden" name="csrf\_token" value="<!-- tmpl\_var csrf\_token -->"> |
|  |  |  |
|  |  | <div class="row"> |
|  |  | <div class="small-10 medium-5 large-4 columns"> |
|  |  |  |
| Expand Down  Expand Up | | @@ -346,8 +347,10 @@ |
|  |  | <div class="content-box section-box"> |
|  |  |  |
|  |  | <form action="<!-- tmpl\_var PROGRAM\_URL -->" method="post" accept-charset="<!-- tmpl\_var HTML\_CHARSET -->" id="membership\_profile\_fields"> |
|  |  | <input type="hidden" name="flavor"  value="profile" > |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="edit\_subscriber\_fields" > |
|  |  | <input type="hidden" name="csrf\_token" value="<!-- tmpl\_var csrf\_token -->"> |
|  |  |  |
|  |  | <!-- tmpl\_loop subscriber\_fields --> |
|  |  |  |
|  |  | <div class="row"> |
| Expand Down  Expand Up | | @@ -425,6 +428,8 @@ |
|  |  | <form action="<!-- tmpl\_var PROGRAM\_URL -->" method="post" accept-charset="<!-- tmpl\_var HTML\_CHARSET -->"> |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="update\_email" > |
|  |  | <input type="hidden" name="csrf\_token" value="<!-- tmpl\_var csrf\_token -->"> |
|  |  |  |
|  |  | <!-- tmpl\_if errors\_update\_email --> |
|  |  | <!-- tmpl\_if error\_invalid\_email --> |
|  |  | <p class="error"> |
| Expand Down  Expand Up | | @@ -471,6 +476,7 @@ |
|  |  | <form action="<!-- tmpl\_var PROGRAM\_URL -->" method="post" accept-charset="<!-- tmpl\_var HTML\_CHARSET -->"> |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="change\_password" > |
|  |  | <input type="hidden" name="csrf\_token" value="<!-- tmpl\_var csrf\_token -->"> |
|  |  |  |
|  |  | <!-- tmpl\_if errors\_change\_password --> |
|  |  | <p class="error"> |
| Expand Down  Expand Up | | @@ -513,6 +519,7 @@ |
|  |  | <form action="<!-- tmpl\_var PROGRAM\_URL -->" method="post" accept-charset="<!-- tmpl\_var HTML\_CHARSET -->"> |
|  |  | <input type="hidden" name="flavor" value="profile" > |
|  |  | <input type="hidden" name="process" value="delete\_profile" > |
|  |  | <input type="hidden" name="csrf\_token" value="<!-- tmpl\_var csrf\_token -->"> |
|  |  |  |
|  |  | <div class="alert-box info radius"> |
|  |  | Deleting your profile will remove all your profile information, but |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d4d3d86`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjustingit%2Fdada-mail%2Fcommit%2Fd4d3d86d08c816b4da75a5ef45abc12188772459) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2fdfbdd8_20250114_202131.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjustingit%2Fdada-mail%2Fsecurity%2Fadvisories%2FGHSA-344m-p829-2r38)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjustingit%2Fdada-mail%2Fsecurity%2Fadvisories%2FGHSA-344m-p829-2r38)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=justingit%2Fdada-mail)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[justingit](/justingit)
/
**[dada-mail](/justingit/dada-mail)**
Public

* [Notifications](/login?return_to=%2Fjustingit%2Fdada-mail) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fjustingit%2Fdada-mail)
* [Star
   174](/login?return_to=%2Fjustingit%2Fdada-mail)

* [Code](/justingit/dada-mail)
* [Issues
  160](/justingit/dada-mail/issues)
* [Pull requests
  1](/justingit/dada-mail/pulls)
* [Discussions](/justingit/dada-mail/discussions)
* [Actions](/justingit/dada-mail/actions)
* [Projects
  0](/justingit/dada-mail/projects)
* [Wiki](/justingit/dada-mail/wiki)
* [Security](/justingit/dada-mail/security)
* [Insights](/justingit/dada-mail/pulse)

Additional navigation options

* [Code](/justingit/dada-mail)
* [Issues](/justingit/dada-mail/issues)
* [Pull requests](/justingit/dada-mail/pulls)
* [Discussions](/justingit/dada-mail/discussions)
* [Actions](/justingit/dada-mail/actions)
* [Projects](/justingit/dada-mail/projects)
* [Wiki](/justingit/dada-mail/wiki)
* [Security](/justingit/dada-mail/security)
* [Insights](/justingit/dada-mail/pulse)

# CSRF Vulnerabilities Found in versions 11.15.1 and below

High

[justingit](/justingit)
published
GHSA-344m-p829-2r38
Sep 20, 2021

## Package

No package listed

## Affected versions

<11.16.0

## Patched versions

11.16.0

## Description

### Enhanced Cross-Site Request Forgery (CSRF) Prevention

In theory (and confirmed), a bad actor could give someone a carefully crafted web page via email, SMS, etc, that - when visited, could allow them control of the list control panel as if the bad actor was logged in themselves. This includes changing any mailing list password, as well as the Dada Mail Root Password - which could effectively shut out actual list owners of the mailing list and allow the bad actor complete and unfettered control of your mailing list. This vulnerability also affects profile logins.

For this vulnerability to work, the target of the bad actor would need to be logged into the list control panel themselves. This CSRF vulnerability in Dada Mail affects all versions of Dada Mail v11.15.1 and below. Although we know of no known CSRF exploits that have happened in the wild, this vulnerability has been confirmed by our testing, and by a third party.

Security enhancements added to v11.16.0:

* CSRF protection to all list control panel screens (including plugins) when logged in
* Initial CSRF protection on the actual list control panel login form is enabled by default

  This feature was available in Dada Mail, but was not enabled by default
* CSRF protection for any a user who logs into their profile would be able to do when logged in
* CSRF protection for the initial profile login form
* Login cookies for both the list control panel and profiles have the, "SameSite" flag added, and set to, "Lax"
* Login cookies for both the list control panel and profiles have the, "secure" flag added, and set to, "1", if the connection is under https
* Google reCAPTCHA added to the Change List Password, Change Dada Mail Root Password, Profile login, and Profile Registration

  You'll want to set up Google reCAPTCHA in the included Dada Mail installer.

### More Details

Here's an overview of CSRF:

<https://owasp.org/www-community/attacks/csrf>

v11.16.0 comes with Cross-Site Request Forgery prevention using the **Double Submit Cookie** pattern: (<https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#double-submit-cookie>).

To enhance this, we also "HMAC the token with a secret key known only by the server and place this value in a cookie" (as described in the above doc), and set cookies to have, **SameSite** set to, **Lax** (instead of not setting SameSite at all), (<https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#samesite-cookie-attribute>),

### Additional Suggestions to Help Harden Security

* Run Dada Mail under https

  Running Dada Mail under https will protect sensitive data from being able to read in transmission.
* Set up Google reCAPTCHA

  Google reCAPTCHA helps stop automated submission of forms in Dada Mail.

### Severity

High

### CVE ID

CVE-2021-41083

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


