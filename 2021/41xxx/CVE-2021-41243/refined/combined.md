=== Content from github.com_c7a06f62_20250115_084945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbaserproject%2Fbasercms%2Fsecurity%2Fadvisories%2FGHSA-7rpc-9m88-cf9w)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbaserproject%2Fbasercms%2Fsecurity%2Fadvisories%2FGHSA-7rpc-9m88-cf9w)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=baserproject%2Fbasercms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[baserproject](/baserproject)
/
**[basercms](/baserproject/basercms)**
Public

* [Notifications](/login?return_to=%2Fbaserproject%2Fbasercms) You must be signed in to change notification settings
* [Fork
  131](/login?return_to=%2Fbaserproject%2Fbasercms)
* [Star
   174](/login?return_to=%2Fbaserproject%2Fbasercms)

* [Code](/baserproject/basercms)
* [Issues
  265](/baserproject/basercms/issues)
* [Pull requests
  13](/baserproject/basercms/pulls)
* [Actions](/baserproject/basercms/actions)
* [Projects
  2](/baserproject/basercms/projects)
* [Wiki](/baserproject/basercms/wiki)
* [Security](/baserproject/basercms/security)
* [Insights](/baserproject/basercms/pulse)

Additional navigation options

* [Code](/baserproject/basercms)
* [Issues](/baserproject/basercms/issues)
* [Pull requests](/baserproject/basercms/pulls)
* [Actions](/baserproject/basercms/actions)
* [Projects](/baserproject/basercms/projects)
* [Wiki](/baserproject/basercms/wiki)
* [Security](/baserproject/basercms/security)
* [Insights](/baserproject/basercms/pulse)

# OS Command Injection Vulnerability

Low

[ryuring](/ryuring)
published
GHSA-7rpc-9m88-cf9w
Nov 25, 2021

## Package

PagesController
(baserCMS)

## Affected versions

<= 4.5.3

## Patched versions

4.5.4

## Description

There is a OS Command Injection Vulnerability on the management system of baserCMS.

This is a vulnerability that needs to be addressed when the management system is used by an unspecified number of users.

If you are eligible, please update to the new version as soon as possible.

Target

baserCMS 4.5.3 and earlier versions

Vulnerability

OS Command Injection Vulnerability.

Countermeasures

Update to the latest version of baserCMS

Credits

Akagi Yusuke @NTT-ME

### Severity

Low

### CVE ID

CVE-2021-41243

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_39ef49ea_20250115_084945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbaserproject%2Fbasercms%2Fcommit%2F9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbaserproject%2Fbasercms%2Fcommit%2F9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=baserproject%2Fbasercms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[baserproject](/baserproject)
/
**[basercms](/baserproject/basercms)**
Public

* [Notifications](/login?return_to=%2Fbaserproject%2Fbasercms) You must be signed in to change notification settings
* [Fork
  131](/login?return_to=%2Fbaserproject%2Fbasercms)
* [Star
   174](/login?return_to=%2Fbaserproject%2Fbasercms)

* [Code](/baserproject/basercms)
* [Issues
  265](/baserproject/basercms/issues)
* [Pull requests
  13](/baserproject/basercms/pulls)
* [Actions](/baserproject/basercms/actions)
* [Projects
  2](/baserproject/basercms/projects)
* [Wiki](/baserproject/basercms/wiki)
* [Security](/baserproject/basercms/security)
* [Insights](/baserproject/basercms/pulse)

Additional navigation options

* [Code](/baserproject/basercms)
* [Issues](/baserproject/basercms/issues)
* [Pull requests](/baserproject/basercms/pulls)
* [Actions](/baserproject/basercms/actions)
* [Projects](/baserproject/basercms/projects)
* [Wiki](/baserproject/basercms/wiki)
* [Security](/baserproject/basercms/security)
* [Insights](/baserproject/basercms/pulse)

## Commit

[Permalink](/baserproject/basercms/commit/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-7rpc-9m88-cf9w](https://github.com/advisories/GHSA-7rpc-9m88-cf9w "GHSA-7rpc-9m88-cf9w")

[Browse files](/baserproject/basercms/tree/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff)
Browse the repository at this point in the history

```
* 固定ページプレビュー実行時に入力内容検証を追加

* SimpleZipの利用を停止しZipArchiveの利用に切り替え

* 不要コード除去

* BcZip利用時、ZipArchiveをopenしていない場合エラーログが出力される問題を改善
```

* Loading branch information

[![@gondoh](https://avatars.githubusercontent.com/u/2033263?s=40&v=4)](/gondoh)

[gondoh](/baserproject/basercms/commits?author=gondoh "View all commits by gondoh")
authored
Nov 25, 2021

1 parent
[c3295a5](/baserproject/basercms/commit/c3295a50607ee3eb4f2ec8c503cc9a33195eba7c)

commit 9088b99

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**198 additions**
and
**543 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/webroot/theme/admin-third

  + Installations/admin

    - app/webroot/theme/admin-third/Installations/admin/step2.php
      [step2.php](#diff-fde8b733ede22b39f952744638b6c43a50af0c6447df0908ed68e2669585fc8b)
  + Tools/admin

    - app/webroot/theme/admin-third/Tools/admin/log.php
      [log.php](#diff-20eb08617f2a837a1586630bcce4b4787b8083bb5aa7e2b1e1b62e36dc578b6b)
* lib/Baser

  + Config

    - lib/Baser/Config/setting.php
      [setting.php](#diff-64254f480621ab52a2bee81ae224dec82a339aae342e9b8ebb3b4a2d1f8cfcb6)
  + Controller

    - Component

      * lib/Baser/Controller/Component/BcManagerComponent.php
        [BcManagerComponent.php](#diff-cb38e2ead60c59dd0b0e585de7ea228583445e2b49cd9860d11b0452af580d70)
    - lib/Baser/Controller/PagesController.php
      [PagesController.php](#diff-07bd29eca4b2882ad43d901d5ed0f41b8b65d952e511b0078b36562491a0c6bd)
    - lib/Baser/Controller/ThemesController.php
      [ThemesController.php](#diff-5d486ee5f40c8eba57ed56f69ece0596e122ee6186f44e534b2c82bfb8528db4)
    - lib/Baser/Controller/ToolsController.php
      [ToolsController.php](#diff-7afec3db109d894c9d7945d3a9395f11dae61f7de1159041f95cc1dfb873e269)
  + Lib

    - lib/Baser/Lib/BcZip.php
      [BcZip.php](#diff-d1fad1c14eb8763eded146311320ec48fc6fc34609f4e22381d59b864d4b18ae)
  + Vendor

    - lib/Baser/Vendor/Simplezip.php
      [Simplezip.php](#diff-fd6b8387ce49701f5b49d665ddab40c9c728c3a13cfdd20cab3648d99bc0ab13)

## There are no files selected for viewing

18 changes: 18 additions & 0 deletions

18
[app/webroot/theme/admin-third/Installations/admin/step2.php](#diff-fde8b733ede22b39f952744638b6c43a50af0c6447df0908ed68e2669585fc8b "app/webroot/theme/admin-third/Installations/admin/step2.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/app/webroot/theme/admin-third/Installations/admin/step2.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -388,7 +388,25 @@ class="bca-main\_\_text"><?php echo \_\_d('baser', 'セーフモードがOnの場合 |
|  |  | </ul> |
|  |  | <?php endif ?> |
|  |  | </div> |
|  |  |  |
|  |  | <div class="panel-box bca-panel-box corner10"> |
|  |  | <h3 class="bca-panel-box\_\_title"><?php echo \_\_d('baser', '拡張モジュール') ?></h3> |
|  |  | <ul class="section"> |
|  |  | <li class='<?php if ($zipOk) echo 'check'; else echo 'failed'; ?>'> |
|  |  | <?php echo \_\_d('baser', 'Zip') ?><br/> |
|  |  | <div class="check-result"> |
|  |  | <?php if ($zipOk): ?> |
|  |  | <?php echo \_\_d('baser', '利用可') ?> |
|  |  | <?php else: ?> |
|  |  | <?php echo \_\_d('baser', '利用不可') ?><br/> |
|  |  | <small><?php echo \_\_d('baser', 'テーマなどのzipダウンロードが制限されます。') ?></small> |
|  |  | <?php endif ?> |
|  |  | </div> |
|  |  | </li> |
|  |  | </ul> |
|  |  | </div> |
|  |  | </div> |
|  |  |  |
|  |  |  |
|  |  | <form action="<?php echo $this->request->base ?>/installations/step2" method="post" id="checkenv"> |
|  |  | <?php echo $this->BcForm->hidden('clicked') ?> |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[app/webroot/theme/admin-third/Tools/admin/log.php](#diff-20eb08617f2a837a1586630bcce4b4787b8083bb5aa7e2b1e1b62e36dc578b6b "app/webroot/theme/admin-third/Tools/admin/log.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/app/webroot/theme/admin-third/Tools/admin/log.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,11 +16,13 @@ |
|  |  | ?> |
|  |  |  |
|  |  |  |
|  |  | <?php if ($zipEnable): ?> |
|  |  | <div class="section bca-main\_\_section"> |
|  |  | <h2 class="bca-main\_\_heading" data-bca-heading-size="lg"><?php echo \_\_d('baser', 'ログ(エラーログ)の取得') ?></h2> |
|  |  | <p class="bca-main\_\_text"><?php echo \_\_d('baser', 'ログ(エラーログ)をPCにダウンロードします。') ?></p> |
|  |  | <p class="bca-main\_\_text"><?php $this->BcBaser->link(\_\_d('baser', 'ダウンロード'), ['download'], ['class' => 'button-small bca-btn', 'data-bca-btn-type' => 'download']) ?> </p> |
|  |  | </div> |
|  |  | <?php endif; ?> |
|  |  |  |
|  |  | <div class="section bca-main\_\_section"> |
|  |  | <h2 class="bca-main\_\_heading" data-bca-heading-size="lg"><?php echo \_\_d('baser', 'エラーログの削除') ?></h2> |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[lib/Baser/Config/setting.php](#diff-64254f480621ab52a2bee81ae224dec82a339aae342e9b8ebb3b4a2d1f8cfcb6 "lib/Baser/Config/setting.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/lib/Baser/Config/setting.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -478,6 +478,16 @@ |
|  |  | 'systemMessageLangFromSiteSetting' => true |
|  |  | ]; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Zipモジュールなし |
|  |  | \*/ |
|  |  | if (!extension\_loaded('zip')) { |
|  |  | unset($config['BcApp']['adminNavigation']['Systems']['Theme']['menus']['ThemesDownload']); |
|  |  | unset($config['BcApp']['adminNavigation']['Systems']['Theme']['menus']['ThemesDownloadDefaultDataPattern']); |
|  |  | unset($config['BcApp']['adminNavigation']['Systems']['Tools']['menus']['ToolsMaintenance']); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\*\* |
|  |  | \* システム要件 |
|  |  | \*/ |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[lib/Baser/Controller/Component/BcManagerComponent.php](#diff-cb38e2ead60c59dd0b0e585de7ea228583445e2b49cd9860d11b0452af580d70 "lib/Baser/Controller/Component/BcManagerComponent.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/lib/Baser/Controller/Component/BcManagerComponent.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1387,13 +1387,15 @@ public function checkEnv() |
|  |  | 'phpGd' => extension\_loaded('gd'), |
|  |  | 'phpPdo' => extension\_loaded('pdo'), |
|  |  | 'phpXml' => extension\_loaded('xml'), |
|  |  | 'phpZip' => extension\_loaded('zip'), |
|  |  | 'apacheRewrite' => $rewriteInstalled, |
|  |  | ]; |
|  |  | $check = [ |
|  |  | 'encodingOk' => (preg\_match('/UTF-8/i', $status['encoding'])? true : false), |
|  |  | 'gdOk' => $status['phpGd'], |
|  |  | 'pdoOk' => $status['phpPdo'], |
|  |  | 'xmlOk' => $status['phpXml'], |
|  |  | 'zipOk' => $status['phpZip'], |
|  |  | 'phpVersionOk' => version\_compare(preg\_replace('/[a-z-]/', '', $status['phpVersion']), Configure::read('BcRequire.phpVersion'), '>='), |
|  |  | 'phpMemoryOk' => ((($status['phpMemory'] >= Configure::read('BcRequire.phpMemory')) || $status['phpMemory'] == -1) === true) |
|  |  | ]; |
| Expand Down | |  |

15 changes: 15 additions & 0 deletions

15
[lib/Baser/Controller/PagesController.php](#diff-07bd29eca4b2882ad43d901d5ed0f41b8b65d952e511b0078b36562491a0c6bd "lib/Baser/Controller/PagesController.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/lib/Baser/Controller/PagesController.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -410,8 +410,16 @@ public function display() |
|  |  | // POSTパラメータのコードに含まれるscriptタグをそのままHTMLに出力するとブラウザによりXSSと判定される |
|  |  | // 一度データをセッションに退避する |
|  |  | if ($this->BcContents->preview === 'default') { |
|  |  | // 入力validation |
|  |  | $check = ['content\_tmp' => $this->request->data['Page']['contents\_tmp']]; |
|  |  | if (!$this->Page->containsScript($check)) { |
|  |  | $this->BcMessage->setError(\_\_d('baser', '本稿欄でスクリプトの入力は許可されていません。')); |
|  |  | $this->notFound(); |
|  |  | } |
|  |  |  |
|  |  | $sessionKey = \_\_CLASS\_\_ . '\_preview\_default\_' . $this->request->data['Content']['entity\_id']; |
|  |  | $this->request->data = $this->Content->saveTmpFiles($this->request->data, mt\_rand(0, 99999999)); |
|  |  |  |
|  |  | $this->Session->write($sessionKey, $this->request->data); |
|  |  | $query = []; |
|  |  | if ($this->request->query) { |
| Expand All | | @@ -431,6 +439,13 @@ public function display() |
|  |  | } |
|  |  |  |
|  |  | if ($this->BcContents->preview === 'draft') { |
|  |  | // 入力validation |
|  |  | $check = ['content\_tmp' => $this->request->data['Page']['contents\_tmp']]; |
|  |  | if (!$this->Page->containsScript($check)) { |
|  |  | $this->BcMessage->setError(\_\_d('baser', '本稿欄でスクリプトの入力は許可されていません。')); |
|  |  | $this->notFound(); |
|  |  | } |
|  |  |  |
|  |  | $this->request->data = $this->Content->saveTmpFiles($this->request->data, mt\_rand(0, 99999999)); |
|  |  | $this->request->params['Content']['eyecatch'] = $this->request->data['Content']['eyecatch']; |
|  |  |  |
| Expand Down | |  |

52 changes: 39 additions & 13 deletions

52
[lib/Baser/Controller/ThemesController.php](#diff-5d486ee5f40c8eba57ed56f69ece0596e122ee6186f44e534b2c82bfb8528db4 "lib/Baser/Controller/ThemesController.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/lib/Baser/Controller/ThemesController.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,7 +10,7 @@ |
|  |  | \* @license https://basercms.net/license/index.html |
|  |  | \*/ |
|  |  |  |
|  |  | App::uses('Simplezip', 'Vendor'); |
|  |  | App::uses('BcZip', 'Lib'); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Class ThemesController |
| Expand Down  Expand Up | | @@ -95,7 +95,6 @@ public function admin\_add() |
|  |  |  |
|  |  | $name = $this->request->data['Theme']['file']['name']; |
|  |  | move\_uploaded\_file($this->request->data['Theme']['file']['tmp\_name'], TMP . $name); |
|  |  | App::uses('BcZip', 'Lib'); |
|  |  | $BcZip = new BcZip(); |
|  |  | if (!$BcZip->extract(TMP . $name, BASER\_THEMES)) { |
|  |  | $msg = \_\_d('baser', 'アップロードしたZIPファイルの展開に失敗しました。'); |
| Expand Down  Expand Up | | @@ -573,11 +572,17 @@ protected function \_applyTheme($theme) |
|  |  | \*/ |
|  |  | public function admin\_download\_default\_data\_pattern() |
|  |  | { |
|  |  | if (!extension\_loaded('zip')) { |
|  |  | $this->notFound(); |
|  |  | } |
|  |  |  |
|  |  | $this->autoRender = false; |
|  |  | set\_time\_limit(0); |
|  |  | ini\_set('memory\_limit', -1); |
|  |  |  |
|  |  | /\* コアのCSVを生成 \*/ |
|  |  | $tmpDir = TMP . 'csv' . DS; |
|  |  | $distPath = TMP . 'default.zip'; |
|  |  | $Folder = new Folder(); |
|  |  | $Folder->create($tmpDir); |
|  |  | emptyFolder($tmpDir); |
| Expand All | | @@ -604,13 +609,20 @@ public function admin\_download\_default\_data\_pattern() |
|  |  | } |
|  |  | ftruncate($fp, 0); |
|  |  | fwrite($fp, implode("\n", $records)); |
|  |  |  |
|  |  | /\* ZIPに固めてダウンロード \*/ |
|  |  | $fileName = 'default'; |
|  |  | $Simplezip = new Simplezip(); |
|  |  | $Simplezip->addFolder($tmpDir); |
|  |  | $Simplezip->download($fileName); |
|  |  | $bcZip = new BcZip(); |
|  |  | $bcZip->create($tmpDir, $distPath); |
|  |  |  |
|  |  | header("Cache-Control: no-store"); |
|  |  | header("Content-Type: application/zip"); |
|  |  | header("Content-Disposition: attachment; filename=" . basename($distPath) . ";"); |
|  |  | header("Content-Length: " . filesize($distPath)); |
|  |  | while (ob\_get\_level()) { ob\_end\_clean(); } |
|  |  | echo readfile($distPath); |
|  |  |  |
|  |  | emptyFolder($tmpDir); |
|  |  | exit(); |
|  |  | unlink($distPath); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -671,19 +683,33 @@ function \_writeCsv($plugin, $path, $exclude = []) |
|  |  | \*/ |
|  |  | public function admin\_download() |
|  |  | { |
|  |  | if (!extension\_loaded('zip')) { |
|  |  | $this->notFound(); |
|  |  | } |
|  |  |  |
|  |  | $this->autoRender = false; |
|  |  | $tmpDir = TMP . 'theme' . DS; |
|  |  | $orgPath = BASER\_THEMES . $this->siteConfigs['theme'] . DS; |
|  |  | $sourcePath = $tmpDir . $this->siteConfigs['theme']; |
|  |  | $distPath = $sourcePath . '.zip'; |
|  |  |  |
|  |  | $Folder = new Folder(); |
|  |  | $Folder->create($tmpDir); |
|  |  | $path = BASER\_THEMES . $this->siteConfigs['theme'] . DS; |
|  |  | $Folder->copy([ |
|  |  | 'from' => $path, |
|  |  | 'to' => $tmpDir . $this->siteConfigs['theme'], |
|  |  | 'from' => $orgPath, |
|  |  | 'to' => $sourcePath, |
|  |  | 'chmod' => 0777 |
|  |  | ]); |
|  |  | $Simplezip = new Simplezip(); |
|  |  | $Simplezip->addFolder($tmpDir); |
|  |  | $Simplezip->download($this->siteConfigs['theme']); |
|  |  | $bcZip = new BcZip(); |
|  |  | $bcZip->create($sourcePath, $distPath); |
|  |  |  |
|  |  | header("Cache-Control: no-store"); |
|  |  | header("Content-Type: application/zip"); |
|  |  | header("Content-Disposition: attachment; filename=" . basename($distPath) . ";"); |
|  |  | header("Content-Length: " . filesize($distPath)); |
|  |  | while (ob\_get\_level()) { ob\_end\_clean(); } |
|  |  | echo readfile($distPath); |
|  |  |  |
|  |  | $Folder->delete($tmpDir); |
|  |  | } |
|  |  | } |

90 changes: 69 additions & 21 deletions

90
[lib/Baser/Controller/ToolsController.php](#diff-7afec3db109d894c9d7945d3a9395f11dae61f7de1159041f95cc1dfb873e269 "lib/Baser/Controller/ToolsController.php")

Show comments

[View file](/baserproject/basercms/blob/9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff/lib/Baser/Controller/ToolsController.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,7 +10,7 @@ |
|  |  | \* @license https://basercms.net/license/index.html |
|  |  | \*/ |
|  |  |  |
|  |  | App::uses('Simplezip', 'Vendor'); |
|  |  | App::uses('BcZip', 'Lib'); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Class ToolsController |
| Expand Down  Expand Up | | @@ -93,9 +93,13 @@ public function admin\_index() |
|  |  | public function admin\_maintenance($mode = '') |
|  |  | { |
|  |  | $this->\_checkReferer(); |
|  |  | $zipEnable = extension\_loaded('zip'); |
|  |  | if (!$zipEnable) { |
|  |  | $this->notFound(); |
|  |  | } |
|  |  |  |
|  |  | switch($mode) { |
|  |  | case 'backup': |
|  |  | set\_time\_limit(0); |
|  |  | $this->\_backupDb($this->request->query['backup\_encoding']); |
|  |  | break; |
|  |  | case 'restore': |
| Expand Down  Expand Up | | @@ -155,10 +159,10 @@ protected function \_restoreDb($data) |
|  |  | if (!move\_uploaded\_file($data['Tool']['backup']['tmp\_name'], $targetPath)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\* ZIPファイルを解凍する \*/ |
|  |  | $Simplezip = new Simplezip(); |
|  |  | if (!$Simplezip->unzip($targetPath, $tmpPath)) { |
|  |  | $bcZip = new BcZip(); |
|  |  | if (!$bcZip->extract($targetPath, $tmpPath)) { |
|  |  | return false; |
|  |  | } |
|  |  | @unlink($targetPath); |
| Expand Down  Expand Up | | @@ -255,8 +259,12 @@ protected function \_loadBackup($path, $encoding) |
|  |  | \*/ |
|  |  | protected function \_backupDb($encoding) |
|  |  | { |
|  |  | $tmpDir = TMP . 'schemas' . DS; |
|  |  | set\_time\_limit(0); |
|  |  |  |
|  |  | $version = str\_replace(' ', '\_', $this->getBaserVersion()); |
|  |  | $tmpDir = TMP . 'schemas' . DS; |
|  |  | $distPath = TMP . 'baserbackup\_' . $version . '\_' . date('Ymd\_His') . '.zip'; |
|  |  |  |
|  |  | $this->\_resetTmpSchemaFolder(); |
|  |  | clearAllCache(); |
|  |  | $this->\_writeBackup($tmpDir . 'core' . DS, '', $encoding); |
| Expand All | | @@ -267,13 +275,21 @@ protected function \_backupDb($encoding) |
|  |  | $this->\_writeBackup($tmpDir . 'plugin' . DS, $plugin['Plugin']['name'], $encoding); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // ZIP圧縮して出力 |
|  |  | $fileName = 'baserbackup\_' . $version . '\_' . date('Ymd\_His'); |
|  |  | $Simplezip = new Simplezip(); |
|  |  | $Simplezip->addFolder($tmpDir); |
|  |  | $Simplezip->download($fileName); |
|  |  | $bcZip = new BcZip(); |
|  |  | $bcZip->create($tmpDir, $distPath); |
|  |  |  |
|  |  | header("Cache-Control: no-store"); |
|  |  | header("Content-Type: application/zip"); |
|  |  | header("Content-Disposition: attachment; filename=" . basename($distPath) . ";"); |
|  |  | header("Content-Length: " . filesize($distPath)); |
|  |  | while (ob\_get\_level()) { ob\_end\_clean(); } |
|  |  | echo readfile($distPath); |
|  |  |  |
|  |  | unlink($distPath); |
|  |  | $this->\_resetTmpSchemaFolder(); |
|  |  | exit(); |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -312,6 +328,7 @@ protected function \_writeBackup($path, $plugin = '', $encoding) |
|  |  | public function admin\_write\_schema() |
|  |  | { |
|  |  | $path = TMP . 'schemas' . DS; |
|  |  | $distPath = TMP . 'schemas.zip'; |
|  |  |  |
|  |  | /\* 表示設定 \*/ |
|  |  | $this->pageTitle = \_\_d('baser', 'スキーマファイル生成'); |
| Expand All | | @@ -336,10 +353,26 @@ public function admin\_write\_schema() |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | $Simplezip = new Simplezip(); |
|  |  | $Simplezip->addFolder($path); |
|  |  | $Simplezip->download('schemas'); |
|  |  | exit(); |
|  |  | // ZIP圧縮して出力 |
|  |  | set\_time\_limit(0); |
|  |  | $this->autoRender = false; |
|  |  |  |
|  |  | // 不要ディレクトリの削除 |
|  |  | rmdir($path . 'core'); |
|  |  | rmdir($path . 'plugin'); |
|  |  |  |
|  |  | $bcZip = new BcZip(); |
|  |  | $bcZip->create($path, $distPath); |
|  |  |  |
|  |  | header("Cache-Control: no-store"); |
|  |  | header("Content-Type: application/zip"); |
|  |  | header("Content-Disposition: attachment; filename=" . basename($distPath) . ";"); |
|  |  | header("Content-Length: " . filesize($distPath)); |
|  |  | while (ob\_get\_level()) { ob\_end\_clean(); } |
|  |  | echo readfile($distPath); |
|  |  |  |
|  |  | unlink($distPath); |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -401,12 +434,16 @@ protected function \_resetTmpSchemaFolder() |
|  |  | \*/ |
|  |  | public function admin\_log($mode = '') |
|  |  | { |
|  |  | $zipEnable = extension\_loaded('zip'); |
|  |  | $errorLogPath = TMP . 'logs' . DS . 'error.log'; |
|  |  | switch($mode) { |
|  |  | case 'download': |
|  |  | set\_time\_limit(0); |
|  |  | if (!$zipEnable) { |
|  |  | $this->notFound(); |
|  |  | } |
|  |  | $this->autoRender = false; |
|  |  | if ($this->\_downloadErrorLog()) { |
|  |  | exit(); |
|  |  | return; |
|  |  | } |
|  |  | $this->BcMessage->setInfo('エラーログが存在しません。'); |
|  |  | $this->redirect(['action' => 'log']); |
| Expand Down  Expand Up | | @@ -441,6 +478,7 @@ public function admin\_log($mode = '') |
|  |  |  |
|  |  | $this->pageTitle = \_\_d('baser', 'データメンテナンス'); |
|  |  | $this->help = 'tools\_log'; |
|  |  | $this->set('zipEnable', $zipEnable); |
|  |  | $this->set('fileSize', $fileSize); |
|  |  | } |
|  |  |  |
| Expand All | | @@ -451,17 +489,27 @@ public function admin\_log($mode = '') |
|  |  | \*/ |
|  |  | protected function \_downloadErrorLog() |
|  |  | { |
|  |  | set\_time\_limit(0); |
|  |  |  |
|  |  | $tmpDir = TMP . 'logs' . DS; |
|  |  | $distPath = TMP . 'basercms\_logs\_' . date('Ymd\_His') . '.zip'; |
|  |  | $Folder = new Folder($tmpDir); |
|  |  | $files = $Folder->read(true, true, false); |
|  |  | if (count($files[0]) === 0 && count($files[1]) === 0) { |
|  |  | return false; |
|  |  | } |
|  |  | // ZIP圧縮して出力 |
|  |  | $fileName = 'basercms\_logs\_' . date('Ymd\_His'); |
|  |  | $Simplezip = new Simplezip(); |
|  |  | $Simplezip->addFolder($tmpDir); |
|  |  | $Simplezip->download($fileName); |
|  |  | $bcZip = new BcZip(); |
|  |  | $bcZip->create($tmpDir, $distPath); |
|  |  |  |
|  |  | header("Cache-Control: no-store"); |
|  |  | header("Content-Type: application/zip"); |
|  |  | header("Content-Disposition: attachment; filename=" . basename($distPath) . ";"); |
|  |  | header("Content-Length: " . filesize($distPath)); |
|  |  | while (ob\_get\_level()) { ob\_end\_clean(); } |
|  |  | echo readfile($distPath); |
|  |  |  |
|  |  | unlink($distPath); |
|  |  | return true; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9088b99`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbaserproject%2Fbasercms%2Fcommit%2F9088b99c329d1faff3a2f1269f37b9a9d8d5f6ff) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


