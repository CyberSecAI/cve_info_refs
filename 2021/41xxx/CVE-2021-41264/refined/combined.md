=== Content from github.com_95c20ecb_20250115_102452.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-5vp3-v4hc-gx76)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-5vp3-v4hc-gx76)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

# UUPSUpgradeable vulnerability in OpenZeppelin Contracts

Critical

[frangio](/frangio)
published
GHSA-5vp3-v4hc-gx76
Sep 14, 2021

## Package

npm

@openzeppelin/contracts
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>= 4.1.0 < 4.3.2

## Patched versions

4.3.2

npm

@openzeppelin/contracts-upgradeable
([npm](/advisories?query=ecosystem%3Anpm))

>= 4.1.0 < 4.3.2

4.3.2

## Description

### Impact

Upgradeable contracts using `UUPSUpgradeable` may be vulnerable to an attack affecting uninitialized implementation contracts. We will update this advisory with more information soon.

### Patches

A fix is included in version 4.3.2 of `@openzeppelin/contracts` and `@openzeppelin/contracts-upgradeable`.

### Workarounds

Initialize implementation contracts using `UUPSUpgradeable` by invoking the initializer function (usually called `initialize`). An example is provided [in the forum](https://forum.openzeppelin.com/t/security-advisory-initialize-uups-implementation-contracts/15301).

### References

[Post-mortem](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680).

### For more information

If you have any questions or comments about this advisory, or need assistance executing the mitigation, email us at security@openzeppelin.com.

### Severity

Critical

### CVE ID

CVE-2021-41264

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from forum.openzeppelin.com_51845a3e_20250115_102451.html ===


[OpenZeppelin Forum](/)

# [Security advisory: Initialize UUPS implementation contracts](/t/security-advisory-initialize-uups-implementation-contracts/15301)

[General](/c/general/announcements/21)

[Announcements](/c/general/announcements/21)

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 9, 2021, 8:50pm

1

Update September 14th: We have published a [security advisory](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-5vp3-v4hc-gx76) and released [Contracts v4.3.2](https://github.com/OpenZeppelin/openzeppelin-contracts/releases/tag/v4.3.2) with a hotfix for this vulnerability. Still, it is now recommended you always initialize your implementation contracts as explained below.

Update September 16th: We have now published a post-mortem with a lot of detail at [UUPSUpgradeable Vulnerability Post-mortem](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680).

---

Due to a [vulnerability in OpenZeppelin Contracts v4.1.0 through v4.3.1](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-5vp3-v4hc-gx76), all projects using the UUPS proxy pattern should `initialize` their implementation contracts.

To help mitigate this situation, we have already executed transactions to initialize over 150 implementation contracts from multiple projects we identified across Mainnet, Polygon, xDAI, Binance, and Avalanche. These transactions were sent from address `0x37E8d216c3f6c79eC695FBD0cB9842e62fB84370` via a batching contract at `0x310fAC62C976d8F6FDFA34332a56EA1a05493b5b` on all networks.

As an example on how to execute the mitigation, given the following upgradeable ERC20 contract:

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.2;

import "@openzeppelin/contracts-upgradeable/token/ERC20/ERC20Upgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract MyToken is Initializable, ERC20Upgradeable, OwnableUpgradeable, UUPSUpgradeable {
    function initialize() initializer public {
        __ERC20_init("MyToken", "MTK");
        __Ownable_init();
        __UUPSUpgradeable_init();
    }

    function _authorizeUpgrade(address newImplementation)
        internal
        onlyOwner
        override
    {}
}

```

A transaction must be sent to the implementation contract (not the proxy) to invoke the `initialize` method. You can find out the address of the implementation contract given a proxy in Etherscan (if your contract source code is verified) on the “Read as Proxy” tab of the “Contract” section.

We will be releasing more information about the vulnerability along with a fix for the Contracts package next week, in order to give time to all projects to execute this mitigation.

6 Likes

[UUPSUpgradeable Vulnerability Post-mortem](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680)

[The Motorbike Level: Appreciation on Turning a Vulnerability into an Education Resource](https://forum.openzeppelin.com/t/the-motorbike-level-appreciation-on-turning-a-vulnerability-into-an-education-resource/18489)

[Help understanding UUPSProxies, Ownership and Pausability](https://forum.openzeppelin.com/t/help-understanding-uupsproxies-ownership-and-pausability/40654/4)

[poria-cat](https://forum.openzeppelin.com/u/poria-cat)

September 10, 2021, 2:04am

2

Hey, guys. If your contract not verified in Etherscan or others, just use below code to get your implemention address.

```
const { getImplementationAddress } =  require('@openzeppelin/upgrades-core');

const implementationAddress = await getImplementationAddress(provider, proxyAddress);

console.log('contract implementation is:', implementationAddress);

```

7 Likes

[Toufik](https://forum.openzeppelin.com/u/Toufik)

September 12, 2021, 6:58am

3

Thanks for the warning!

Can you confirm it only applies to UUPS inherited SC and not for the Transparent Proxy one's?

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 12, 2021, 11:02pm

4

![](https://sea2.discourse-cdn.com/flex016/user_avatar/forum.openzeppelin.com/toufik/48/6124_2.png) Toufik:
> Can you confirm it only applies to UUPS inherited SC and not for the Transparent Proxy one's?

Indeed, this only affects UUPS and not Transparent.

[Ken\_Chan](https://forum.openzeppelin.com/u/Ken_Chan)

September 13, 2021, 10:19pm

5

Hi [@spalladino](/u/spalladino) do the implementations need to be initialized with values that match the proxies? Or can they hold any value? I'm asking this because our project has multiple proxies sharing a single implementation contract.

[frangio](https://forum.openzeppelin.com/u/frangio)

September 14, 2021, 1:00am

6

[@Ken\_Chan](/u/ken_chan) They do not have to be values that match the proxies. In fact, it is better if they are gibberish values, so that the contract is left in an unusable state.

[David.Gimenez](https://forum.openzeppelin.com/u/David.Gimenez)

September 14, 2021, 8:18pm

7

Hi [@spalladino](/u/spalladino), [@frangio](/u/frangio) thanks for working on this.

We have been one of the 150 projects benefited by the initialization that your team carried out last week.

The question is; Were the implementation contract roles assigned to a specific account or were they loaded with gibberish values?

Thanks again guys, we appreciate your effort !

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 14, 2021, 8:50pm

8

![](https://sea2.discourse-cdn.com/flex016/user_avatar/forum.openzeppelin.com/david.gimenez/48/4698_2.png) David.Gimenez:
> The question is; Were the implementation contract roles assigned to a specific account or were they loaded with gibberish values?

Depends. If your initializer assigned roles to `msg.sender`, then the role was assigned to the batch contract, which we selfdestructed after the operation. If it accepted the address of each role as a parameter, then it was assigned to a dummy contract with the following code, required to pass the initializer checks we found on the multiple contracts.

```
contract Fake is IERC165 {
    function name() public pure returns (string memory) { return "Nil"; }
    function symbol() public pure returns (string memory) { return "NIL"; }
    function decimals() public pure returns (uint) { return 18; }

    function lp() public view returns (address) { return address(this); }
    function token0() public view returns (address) { return address(this); }
    function token1() public view returns (address) { return address(this); }
    function rewardsToken() public view returns (address) { return address(this); }
    function WETH() public view returns (address) { return address(this); }
    function factory() public view returns (address) { return address(this); }

    function supportsInterface(bytes4 interfaceId) public pure override returns (bool) {
        return interfaceId != 0xffffffff;
    }
}

```

[David.Gimenez](https://forum.openzeppelin.com/u/David.Gimenez)

September 14, 2021, 9:20pm

9

Great! Thanks for the quick reply!

1 Like

[jcespedes](https://forum.openzeppelin.com/u/jcespedes)

September 16, 2021, 12:42pm

10

Hey guys, thank you for this information!, If we were to stay at 4.3.1, would be ensuring the initialization of the Implementation contracts be enough?, The increased bytecode size of patch 4.3.2 is troublesome on many of my contracts! ![:dizzy_face:](https://emoji.discourse-cdn.com/twitter/dizzy_face.png?v=10 ":dizzy_face:").

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 16, 2021, 2:24pm

11

![](https://sea2.discourse-cdn.com/flex016/user_avatar/forum.openzeppelin.com/jcespedes/48/8969_2.png) jcespedes:
> would be ensuring the initialization of the Implementation contracts be enough?,

As long as you ensure that no one can call the `upgradeTo` or `upgradeToAndCall` methods directly on your implementation contracts, you're good!

1 Like

[jcespedes](https://forum.openzeppelin.com/u/jcespedes)

September 16, 2021, 3:11pm

12

You made it crystal clear to me, thanks a lot Santiago!

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 16, 2021, 5:36pm

13

We've just released a post-mortem with more details about this vulnerability here: [UUPSUpgradeable Vulnerability Post-mortem](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680).

[caffeinum](https://forum.openzeppelin.com/u/caffeinum)

September 22, 2021, 2:07am

14

Am I correct that if you're still in development, there is this easy fix to add this to your implementation?

```
    /// @custom:oz-upgrades-unsafe-allow constructor
    constructor() initializer {} // <== ADDING THIS

    function initialize(
        // ... arguments
    ) public initializer {
        __ERC20_init(_name, _symbol);
        __Ownable_init();

        // ... your initializer logic
    }

```

Basically, this added constructor ensures that on implementation contract, the real initializer cannot be called. Thus, as the owner of the contract is non-initialized, no one can do anything meaningful with the contract

On the other hand, it's impossible to call constructor in proxied versions, so the real initializer is the only initializer that can be used

1 Like

[spalladino](https://forum.openzeppelin.com/u/spalladino)

September 22, 2021, 6:41pm

15

Hey [@caffeinum](/u/caffeinum)! That's correct, we have updated [our documentation](https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable#initializing_the_implementation_contract) to reflect that:

> ### Initializing the Implementation Contract
>
> Do not leave an implementation contract uninitialized. An uninitialized implementation contract can be taken over by an attacker, which may impact the proxy. You can either invoke the initializer manually, or you can include a constructor to automatically mark it as initialized when it is deployed:
>
> ```
> /// @custom:oz-upgrades-unsafe-allow constructor
> constructor() initializer {}
>
> ```

Just make sure that flagging the implementation as initialized is enough for preventing any calls to `upgradeTo` on the implementation contract. Or make sure you're using the latest version of OpenZeppelin Contracts which includes the fix to prevent direct `upgradeTo` calls to the implementation.

1 Like

[pasevin](https://forum.openzeppelin.com/u/pasevin)

October 10, 2021, 8:48am

16

Hi, so just to be clear. If using the latest version of OpenZeppelin do we still need to add this fix?

```
/// @custom:oz-upgrades-unsafe-allow constructor
constructor() initializer {}

```

I see it's mentioned in the documentation and is still being generated by the Wizard.

[spalladino](https://forum.openzeppelin.com/u/spalladino)

October 12, 2021, 12:00pm

17

Hey! While the latest version should protect against this vulnerability, we still recommend that you initialize implementation contracts for an extra layer of defense.

3 Likes

[Deploying Upgradeable Proxies and Proxy Admin from Factory contract](https://forum.openzeppelin.com/t/deploying-upgradeable-proxies-and-proxy-admin-from-factory-contract/12132/19)

[bobeu](https://forum.openzeppelin.com/u/bobeu)

October 12, 2021, 5:15pm

18

Thank you for the update. I just got a clue from this announcement.

[swaylock](https://forum.openzeppelin.com/u/swaylock)

October 20, 2021, 6:52pm

19

> They do not have to be values that match the proxies. In fact, it is better if they are gibberish values, so that the contract is left in an unusable state.

I am needing some fake wallet and contract addresses for this purpose. How to get one that isn't a security risk?

[frangio](https://forum.openzeppelin.com/u/frangio)

October 21, 2021, 8:26pm

20

`0x00..00` or `0x00..dead` could be used.

**[next page →](/t/security-advisory-initialize-uups-implementation-contracts/15301?page=2)**

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Help understanding UUPSProxies, Ownership and Pausability](https://forum.openzeppelin.com/t/help-understanding-uupsproxies-ownership-and-pausability/40654)  [Upgrades](/c/support/upgrades/35) [proxies](https://forum.openzeppelin.com/tag/proxies) | 5 | 250 | June 3, 2024 |
| [UUPSUpgradeable Vulnerability Post-mortem](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680)  [Announcements](/c/general/announcements/21) | 13 | 14571 | March 16, 2024 |
| [Usage of UUPS](https://forum.openzeppelin.com/t/usage-of-uups/23304)  [Contracts](/c/support/contracts/18) | 4 | 2127 | February 4, 2022 |
| [Possible approaches for new version of implementation contracts](https://forum.openzeppelin.com/t/possible-approaches-for-new-version-of-implementation-contracts/38464)  [Upgrades](/c/support/upgrades/35) | 9 | 836 | November 15, 2023 |
| [Initializing admin in the constructor of a UUPS proxy contract](https://forum.openzeppelin.com/t/initializing-admin-in-the-constructor-of-a-uups-proxy-contract/34232)  [Upgrades](/c/support/upgrades/35) | 1 | 986 | January 16, 2023 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://openzeppelin.com/tos/)
* [Privacy Policy](https://openzeppelin.com/privacy/)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from github.com_269c29fd_20250115_102452.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2F024cc50df478d2e8f78539819749e94d6df60592)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2F024cc50df478d2e8f78539819749e94d6df60592)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

## Commit

[Permalink](/OpenZeppelin/openzeppelin-contracts/commit/024cc50df478d2e8f78539819749e94d6df60592)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Restrict upgrade to proxy context in UUPSUpgradeable

[Browse files](/OpenZeppelin/openzeppelin-contracts/tree/024cc50df478d2e8f78539819749e94d6df60592)
Browse the repository at this point in the history

```
Co-authored-by: Francisco Giordano <frangio.1@gmail.com>
(cherry picked from commit [6241995](https://github.com/OpenZeppelin/openzeppelin-contracts/commit/6241995ad323952e38f8d405103ed994a2dcde8e))
```

* Loading branch information

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx) [![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

[Amxx](/OpenZeppelin/openzeppelin-contracts/commits?author=Amxx "View all commits by Amxx")
authored and
[frangio](/OpenZeppelin/openzeppelin-contracts/commits?author=frangio "View all commits by frangio")
committed
Sep 14, 2021

1 parent
[6edb6dd](/OpenZeppelin/openzeppelin-contracts/commit/6edb6dd1ca43d05a762d84c688116b3327f5e490)

commit 024cc50

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**23 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* contracts/proxy/utils

  + contracts/proxy/utils/UUPSUpgradeable.sol
    [UUPSUpgradeable.sol](#diff-750b4e194e55b2a0202b651973b9d92d153f58476452a55df4b93ebe6991e948)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/024cc50df478d2e8f78539819749e94d6df60592/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,9 @@ |
|  |  | # Changelog |
|  |  |  |
|  |  | ## 4.3.2 |
|  |  |  |
|  |  | \* `UUPSUpgradeable`: Add modifiers to prevent `upgradeTo` and `upgradeToAndCall` being executed on any contract that is not the active ERC1967 proxy. This prevents these functions being called on implementation contracts or minimal ERC1167 clones, in particular. |
|  |  |  |
|  |  | ## 4.3.1 (2021-08-26) |
|  |  |  |
|  |  | \* `TimelockController`: Add additional isOperationReady check. |
| Expand Down | |  |

22 changes: 19 additions & 3 deletions

22
[contracts/proxy/utils/UUPSUpgradeable.sol](#diff-750b4e194e55b2a0202b651973b9d92d153f58476452a55df4b93ebe6991e948 "contracts/proxy/utils/UUPSUpgradeable.sol")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/024cc50df478d2e8f78539819749e94d6df60592/contracts/proxy/utils/UUPSUpgradeable.sol)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,16 +17,32 @@ import "../ERC1967/ERC1967Upgrade.sol"; |
|  |  | \* \_Available since v4.1.\_ |
|  |  | \*/ |
|  |  | abstract contract UUPSUpgradeable is ERC1967Upgrade { |
|  |  | /// @custom:oz-upgrades-unsafe-allow state-variable-immutable state-variable-assignment |
|  |  | address private immutable \_\_self = address(this); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dev Check that the execution is being performed through a delegatecall call and that the execution context is |
|  |  | \* a proxy contract with an implementation (as defined in ERC1967) pointing to self. This should only be the case |
|  |  | \* for UUPS and transparent proxies that are using the current contract as their implementation. Execution of a |
|  |  | \* function through ERC1167 minimal proxies (clones) would not normally pass this test, but is not guaranteed to |
|  |  | \* fail. |
|  |  | \*/ |
|  |  | modifier onlyProxy() { |
|  |  | require(address(this) != \_\_self, "Function must be called through delegatecall"); |
|  |  | require(\_getImplementation() == \_\_self, "Function must be called through active proxy"); |
|  |  | \_; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dev Upgrade the implementation of the proxy to `newImplementation`. |
|  |  | \* |
|  |  | \* Calls {\_authorizeUpgrade}. |
|  |  | \* |
|  |  | \* Emits an {Upgraded} event. |
|  |  | \*/ |
|  |  | function upgradeTo(address newImplementation) external virtual { |
|  |  | function upgradeTo(address newImplementation) external virtual onlyProxy { |
|  |  | \_authorizeUpgrade(newImplementation); |
|  |  | \_upgradeToAndCallSecure(newImplementation, bytes(""), false); |
|  |  | \_upgradeToAndCallSecure(newImplementation, new bytes(0), false); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -37,7 +53,7 @@ abstract contract UUPSUpgradeable is ERC1967Upgrade { |
|  |  | \* |
|  |  | \* Emits an {Upgraded} event. |
|  |  | \*/ |
|  |  | function upgradeToAndCall(address newImplementation, bytes memory data) external payable virtual { |
|  |  | function upgradeToAndCall(address newImplementation, bytes memory data) external payable virtual onlyProxy { |
|  |  | \_authorizeUpgrade(newImplementation); |
|  |  | \_upgradeToAndCallSecure(newImplementation, data, true); |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `024cc50`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2F024cc50df478d2e8f78539819749e94d6df60592) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


