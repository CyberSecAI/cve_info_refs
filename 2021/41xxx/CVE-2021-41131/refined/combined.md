=== Content from github.com_7834a7a2_20250114_182831.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fsecurity%2Fadvisories%2FGHSA-wjw6-2cqr-j4qr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fsecurity%2Fadvisories%2FGHSA-wjw6-2cqr-j4qr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

# Client metadata path-traversal flaw can result in files written outside of metadata store

Moderate

[joshuagl](/joshuagl)
published
GHSA-wjw6-2cqr-j4qr
Oct 19, 2021

## Package

pip

tuf
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<= v0.18.1

## Patched versions

v0.19

## Description

### Impact

In both clients (`tuf/client` and `tuf/ngclient`), there is a path traversal vulnerability that in the worst case can overwrite files ending in `.json` anywhere on the client system on a call to `get_one_valid_targetinfo()`. It occurs because the rolename is used to form the filename, and may contain path traversal characters (ie `../../name.json`).

The impact is mitigated by a few facts:

* It only affects implementations that allow arbitrary rolename selection for delegated targets metadata
* The attack requires the ability to A) insert new metadata for the path-traversing role and B) get the role delegated by an existing targets metadata
* The written file content is heavily restricted since it needs to be a valid, signed targets file. The file extension is always .json.

### Patches

A fix is available in version 0.19 or newer.

### Workarounds

None that do not require code changes. Clients can restrict the allowed character set for rolenames, or they can store metadata in files named in a way that is not vulnerable: neither of these approaches is possible without modifying python-tuf.

### References

* [The issue where this was discovered](https://github.com/theupdateframework/python-tuf/issues/1527)
* [Proof of Concept demonstrating the flaw](https://github.com/jku/path-traversal-poc)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [python-tuf](https://github.com/theupdateframework/python-tuf/issues)
* Contact the maintainers by email or Slack

### Severity

Moderate

### CVE ID

CVE-2021-41131

### Weaknesses

No CWEs

### Credits

* [![@jku](https://avatars.githubusercontent.com/u/31889?s=40&v=4)](/jku)
  [jku](/jku)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_23698084_20250114_182830.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fissues%2F1527)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fissues%2F1527)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftheupdateframework%2Fpython-tuf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Metadata API: Delegation role names validation #1527

Closed

[MVrachev](/MVrachev) opened this issue
Aug 20, 2021
¬∑ 15 comments

Closed

# [Metadata API: Delegation role names validation](#top) #1527

[MVrachev](/MVrachev) opened this issue
Aug 20, 2021
¬∑ 15 comments

Labels
[backlog](/theupdateframework/python-tuf/labels/backlog)
Issues to address with priority for current development goals
[discussion](/theupdateframework/python-tuf/labels/discussion)
Discussions related to the design, implementation and operation of the project

## Comments

[![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=80&u=2511bd2517b368d78d034a55521bc63618106b3b&v=4)](/MVrachev)

Copy link

Collaborator

### **[MVrachev](/MVrachev)** commented [Aug 20, 2021](#issue-975822427) ‚Ä¢ edited by jku Loading

| **Description of issue or feature request**: Delegation role names are not restricted in any way in the spec, but they are targets metadata role names. They could be `"."`, `"../../filename"` or `1.role`. The problem is that at some point those delegation role names are used when constructing an URL used to download the delegated target metadata file: <https://github.com/theupdateframework/tuf/blob/e9106b59cdb5bbfb4260c5ffc3144e79f8f9596a/tuf/ngclient/updater.py#L287> which is likely to be a problem.  **Current behavior**: No validation is used for Delegation role names.  **Expected behavior**: Escape special symbols like `.` or `\`. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

### **[trishankatdatadog](/trishankatdatadog)** commented [Aug 20, 2021](#issuecomment-902889679)

| Cc [@asraa](https://github.com/asraa) [@mnm678](https://github.com/mnm678) [@joshuagl](https://github.com/joshuagl) |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 21, 2021](#issuecomment-903082118) ‚Ä¢ edited Loading

| I don't know of specific problems with using these as urls (although those might exist as well), but the obvious problems are in client using the rolename as part of a local file name (this is not just how the reference client is implemented, the spec seems to require doing this): in this client case role names like `1.root` or `snapshot` or `../../filename` could easily be pretty bad if we assume an attacker having the ability to create new roles and delegations in the server and then client writing files with filenames fromed from these role names.  I don't think think escaping is enough: we probably should not allow rolenames with any of `['.', '/', '\0']` in them and also should not allow `root/snapshot/timestamp/targets` as delegated targets role names. |
| --- |

All reactions

Sorry, something went wrong.

[![@asraa](https://avatars.githubusercontent.com/u/5194569?s=80&u=f7434e64e439c0a6534a4e77cebb842499736cc3&v=4)](/asraa)

Copy link

### **[asraa](/asraa)** commented [Aug 23, 2021](#issuecomment-903871213)

| I don't think think escaping is enough: we probably should not allow rolenames with any of ['.', '/', '\0'] in them and also should not allow root/snapshot/timestamp/targets as delegated targets role names.  Ah, yeah, by and large I agree. In the case of Sigstore delegations to projects, e.g. `github.com/kubernetes/kubernetes`, we were thinking of using the full URL (to avoid e.g. github vs gitlab collisions) as the project name, which would obviously cause problems. I'm really not sure what the right answer is here, if we should sanitize it in the application uniformly by removing the `/`. I definitely think there should be rolename validation. |
| --- |

All reactions

Sorry, something went wrong.

[![@mnm678](https://avatars.githubusercontent.com/u/11727761?s=80&v=4)](/mnm678)

Copy link

Contributor

### **[mnm678](/mnm678)** commented [Aug 23, 2021](#issuecomment-903921046)

| Maybe this should be part of the filesystem API? That way `.` and `/`' could be disallowed for unix-like filesystems, but could be allowed, with restrictions for sigstore delegations to git repo urls.  Although, these role names are in signed metadata, so it might be reasonable to just trust the delegator to know what a reasonable role name is for a particular situation. |
| --- |

 üëç
1
 asraa reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 23, 2021](#issuecomment-903933421) ‚Ä¢ edited Loading

| Maybe this should be part of the filesystem API? That way `.` and `/`' could be disallowed for unix-like filesystems, but could be allowed, with restrictions for sigstore delegations to git repo urls.  I'm not suggesting banning e.g. dots because filesystems can't cope with them (they certainly can). But if you implement clients/repository tools that use the filesystem to store metadata, you end up with code that writes a lot of files with either "ROLENAME.EXT" or "VERSION.ROLENAME.EXT". So let's assume there is a file `1.root.json` in our metadata storage: is that the first version of "root" role or a non-versioned "1.root" role? ü§∑  In other words, I don't think this is just a filesystem compatibility issue, I think it's a "this may lead to bugs or vulnerabilities because the spec demands using role name as filename - issue". It could be I'm overreacting but I definitely have to review all of my own file saving code with this in mind... |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 23, 2021](#issuecomment-903950607) ‚Ä¢ edited Loading

| Ah, yeah, by and large I agree. In the case of Sigstore delegations to projects, e.g. `github.com/kubernetes/kubernetes`, we were thinking of using the full URL (to avoid e.g. github vs gitlab collisions)  Yeah I can see really reasonable use cases here... preventing this does seem bad.  Maybe we need to think about changing the filename aspect instead: either review all the possible conflicting cases WRT versions and names or use something safe as filename (straw man suggestion: rolename hashes as filenames) |
| --- |

All reactions

Sorry, something went wrong.

[![@asraa](https://avatars.githubusercontent.com/u/5194569?s=80&u=f7434e64e439c0a6534a4e77cebb842499736cc3&v=4)](/asraa)

Copy link

### **[asraa](/asraa)** commented [Aug 23, 2021](#issuecomment-904055301)

| So let's assume there is a file 1.root.json in our metadata storage: is that the first version of "root" role or a non-versioned "1.root" role?  Ugh, what a case. Yeah, this turns hairy. You could say we expect that if there's a . then interpret that as a VERSION, but then we get really weird parsing rules like, we expect rolenames to start with an ^[0-9] character, or say we only expect [a-z], \_ that end up limiting our possible name and uses of URLs.  safe as filename (straw man suggestion: rolename hashes as filenames)  Yeah interesting! This all be solved by having the delegation object include a `"file": <sha>.json` that you'd sign over. I guess it doesn't have to be a sha, but the ref implementation could use that. |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

### **[trishankatdatadog](/trishankatdatadog)** commented [Aug 23, 2021](#issuecomment-904076835)

| Ugh, what a case. Yeah, this turns hairy. You could say we expect that if there's a . then interpret that as a VERSION, but then we get really weird parsing rules like, we expect rolenames to start with an ^[0-9] character, or say we only expect [a-z], \_ that end up limiting our possible name and uses of URLs.  Clients should not store consistent snapshots of metadata with version numbers in the filename, but this may complicate consistent snapshots on the server side. You may see funny things like `1.1.root.json` (version 1 of the "1.root" role).  I'm not sure this is a security issue: as long as one cannot forge keys, we should be ok, but need to think about this a bit more. |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 24, 2021](#issuecomment-904369658) ‚Ä¢ edited Loading

| Clients should not store consistent snapshots of metadata with version numbers in the filename [...]  spec say does say that, you are right... but one of the reasons I noticed this was that I was planning to store versioned files for root as it would help with bootstrapping from a "more" trusted root ([#1168](https://github.com/theupdateframework/python-tuf/issues/1168)). Since "1.root" is also a valid rolename, this obviously isn't currently safe -- and I don't think this is immediately obvious to a client developer: it wasn't to me.  I'm not sure this is a security issue: as long as one cannot forge keys, we should be ok, but need to think about this a bit more.  For the client, I'm not yet convinced: A rolename like "../../filename" could mean a badly written client might overwrite a file in my home directory *when I just queried some target info, didn't even download anything*. I don't think "but that requires repository key compromise" is a good enough explanation at that point.  I'm actually not sure what a well written client should do with role "../../filename" |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

### **[trishankatdatadog](/trishankatdatadog)** commented [Aug 24, 2021](#issuecomment-904661265)

| For the client, I'm not yet convinced: A rolename like "../../filename" could mean a badly written client might overwrite a file in my home directory *when I just queried some target info, didn't even download anything*. I don't think "but that requires repository key compromise" is a good enough explanation at that point.  Agreed. I think we should able to define good rolenames without opening any funny path-traversal attacks.  A regex that allows for simple rolenames but also GitHub repos should work. Might be a bit too restrictive to keep absolutely everybody happy, but better than allowing nothing complicated, and also safe. What does everyone think? |
| --- |

All reactions

Sorry, something went wrong.

[![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=80&u=4702e77d6907972296aea7fc4fa9f73b6c916f66&v=4)](/trishankatdatadog)

Copy link

Member

### **[trishankatdatadog](/trishankatdatadog)** commented [Aug 24, 2021](#issuecomment-904661710)

| And also, obviously, this becomes a <https://github.com/theupdateframework/specification> rather than implementation-specific issue |
| --- |

 üëç
1
 jku reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 25, 2021](#issuecomment-905282226) ‚Ä¢ edited Loading

| Collecting some observations from the thread:   * Using arbitrary strings (urls, paths, whatever) as rolenames is a feature and we should try not to limit it * Using those rolenames as filenames is problematic (for both repository and client) as not all strings are actually valid filenames -- but the spec at times requires using the rolename as filename. Sanitizing the filename is difficult (as collisions must be prevented) * Using those rolenames as filenames is also problematic because it can lead to path traversal with roles like `../../../filename`. This is especially an issue for the client as rolename is *input* from remote that should not be trusted more than is required (the input is verified by threshold of signatures, but still not something to blindly obey if it tells me to overwrite files in my home dir...) * There are no known security issues with arbitrary rolenames as files and version numbers, but the area seems ripe for them: is `1.role.json` the metadata for the role `role` or the role `1.role`?   My thinking right now is that the spec can not both require using rolenames as filenames and say that rolenames are arbitrary strings: it's impossible to implement safely or reliably. In fact spec should not require the storage format anyway: we already know implementations might not use files at all (see Warehouse). Possibly a complementary "implementor notes" document should instead explain the issues and offer advice.   ---   As for this immediate Metadata API implemention issue (how do we validate rolenames): I guess we don't (since I believe we don't want to prevent arbitrary strings as rolenames):   * filename validity is the responsibility of the code choosing the filename * preventing path traversal is also the responsibility of the code choosing the filename/path   We could still prevent delegated roles names being any of the toplevel role names -- it might prevent some weird corner cases from happening |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
added
the
[discussion](/theupdateframework/python-tuf/labels/discussion)
Discussions related to the design, implementation and operation of the project
label
[Aug 25, 2021](#event-5205468293)

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
mentioned this issue
[Aug 27, 2021](#ref-issue-635528669)

[Remove file system requirements
theupdateframework/specification#103](/theupdateframework/specification/issues/103)

Open

[![@sechkova](https://avatars.githubusercontent.com/u/44640795?s=40&v=4)](/sechkova)
[sechkova](/sechkova)
added
the
[backlog](/theupdateframework/python-tuf/labels/backlog)
Issues to address with priority for current development goals
label
[Sep 1, 2021](#event-5238175607)

[![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=40&u=2511bd2517b368d78d034a55521bc63618106b3b&v=4)](/MVrachev)
[MVrachev](/MVrachev)
mentioned this issue
[Sep 2, 2021](#ref-issue-986625210)

[ngclient: prevent using rolenames as filenames if they are dangerous
#1562](/theupdateframework/python-tuf/issues/1562)

Closed

[![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=80&u=2511bd2517b368d78d034a55521bc63618106b3b&v=4)](/MVrachev)

Copy link

Collaborator

Author

### **[MVrachev](/MVrachev)** commented [Sep 2, 2021](#issuecomment-911605259) ‚Ä¢ edited Loading

| Collecting some observations from the thread:   * Using arbitrary strings (urls, paths, whatever) as rolenames is a feature and we should try not to limit it * Using those rolenames as filenames is problematic (for both repository and client) as not all strings are actually valid filenames -- but the spec at times requires using the rolename as filename. Sanitizing the filename is difficult (as collisions must be prevented) * Using those rolenames as filenames is also problematic because it can lead to path traversal with roles like `../../../filename`. This is especially an issue for the client as rolename is *input* from remote that should not be trusted more than is required (the input is verified by threshold of signatures, but still not something to blindly obey if it tells me to overwrite files in my home dir...) * There are no known security issues with arbitrary rolenames as files and version numbers, but the area seems ripe for them: is `1.role.json` the metadata for the role `role` or the role `1.role`?   My thinking right now is that the spec can not both require using rolenames as filenames and say that rolenames are arbitrary strings: it's impossible to implement safely or reliably. In fact spec should not require the storage format anyway: we already know implementations might not use files at all (see Warehouse). Possibly a complementary "implementor notes" document should instead explain the issues and offer advice.  As for this immediate Metadata API implemention issue (how do we validate rolenames): I guess we don't (since I believe we don't want to prevent arbitrary strings as rolenames):   * filename validity is the responsibility of the code choosing the filename * preventing path traversal is also the responsibility of the code choosing the filename/path   We could still prevent delegated roles names being any of the toplevel role names -- it might prevent some weird corner cases from happening  [@jku](https://github.com/jku) I agree with all of your thoughts here. To summarize we will:   * validate that role names are not using top-level metadata names in Metadata API: [Metadata API: prevent Delegation role names to be one of top level metadata roles¬†#1558](https://github.com/theupdateframework/python-tuf/issues/1558) * validate that role names are not used as file names in ngclient: [ngclient: prevent using rolenames as filenames if they are dangerous¬†#1562](https://github.com/theupdateframework/python-tuf/issues/1562)   With this, I think we have specified this issue scope and split it into two. I don't think we need this issue anymore. Does somebody disagrees and am I missing something? |
| --- |

All reactions

Sorry, something went wrong.

[![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=80&u=2511bd2517b368d78d034a55521bc63618106b3b&v=4)](/MVrachev)

Copy link

Collaborator

Author

### **[MVrachev](/MVrachev)** commented [Nov 17, 2021](#issuecomment-971573394)

| [@jku](https://github.com/jku) do you agree we can close this issue?  The item left is validating that DelegatedRole names are not top-level metadata names. This is discussed in [#1558](https://github.com/theupdateframework/python-tuf/issues/1558). |
| --- |

All reactions

Sorry, something went wrong.

[![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=40&u=2511bd2517b368d78d034a55521bc63618106b3b&v=4)](/MVrachev)
[MVrachev](/MVrachev)
mentioned this issue
[Nov 17, 2021](#ref-issue-697991041)

[Add input validation to simple metadata api
#1140](/theupdateframework/python-tuf/issues/1140)

Closed

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Nov 18, 2021](#issuecomment-972661168)

| yeah agreed.   * using rolenames as filenames is dangerous, but we've decided to address this at the point where filenames are formed, and to not limit rolenames in general * we can still limit delegated rolenames to not be one of top level role names as in 1558 (but this is just a belt-and-suspenders approach: client is not vulnerable to this) |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
closed this as [completed](/theupdateframework/python-tuf/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Nov 18, 2021](#event-5637212366)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fissues%2F1527)

Assignees

No one assigned

Labels

[backlog](/theupdateframework/python-tuf/labels/backlog)
Issues to address with priority for current development goals
[discussion](/theupdateframework/python-tuf/labels/discussion)
Discussions related to the design, implementation and operation of the project

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

6 participants

[![@jku](https://avatars.githubusercontent.com/u/31889?s=52&v=4)](/jku) [![@asraa](https://avatars.githubusercontent.com/u/5194569?s=52&v=4)](/asraa) [![@mnm678](https://avatars.githubusercontent.com/u/11727761?s=52&v=4)](/mnm678) [![@MVrachev](https://avatars.githubusercontent.com/u/16246778?s=52&v=4)](/MVrachev) [![@trishankatdatadog](https://avatars.githubusercontent.com/u/33133073?s=52&v=4)](/trishankatdatadog) [![@sechkova](https://avatars.githubusercontent.com/u/44640795?s=52&v=4)](/sechkova)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_35f10907_20250114_182828.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F4ad7ae48fda594b640139c3b7eae21ed5155a102)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F4ad7ae48fda594b640139c3b7eae21ed5155a102)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theupdateframework%2Fpython-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[python-tuf](/theupdateframework/python-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fpython-tuf) You must be signed in to change notification settings
* [Fork
  275](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)
* [Star
   1.6k](/login?return_to=%2Ftheupdateframework%2Fpython-tuf)

* [Code](/theupdateframework/python-tuf)
* [Issues
  85](/theupdateframework/python-tuf/issues)
* [Pull requests
  5](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects
  0](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/python-tuf)
* [Issues](/theupdateframework/python-tuf/issues)
* [Pull requests](/theupdateframework/python-tuf/pulls)
* [Actions](/theupdateframework/python-tuf/actions)
* [Projects](/theupdateframework/python-tuf/projects)
* [Security](/theupdateframework/python-tuf/security)
* [Insights](/theupdateframework/python-tuf/pulse)

## Commit

[Permalink](/theupdateframework/python-tuf/commit/4ad7ae48fda594b640139c3b7eae21ed5155a102)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-wjw6-2cqr-j4qr](https://github.com/advisories/GHSA-wjw6-2cqr-j4qr "GHSA-wjw6-2cqr-j4qr")

[Browse files](/theupdateframework/python-tuf/tree/4ad7ae48fda594b640139c3b7eae21ed5155a102)
Browse the repository at this point in the history

```
Fix client issue with rolenames as filenames
```

* Loading branch information

[![@joshuagl](https://avatars.githubusercontent.com/u/13888612?s=40&v=4)](/joshuagl)

[joshuagl](/theupdateframework/python-tuf/commits?author=joshuagl "View all commits by joshuagl")
authored
Oct 19, 2021

2 parents
[4d8cbc7](/theupdateframework/python-tuf/commit/4d8cbc70109c131b74b4a64f83eacf54f131b5d5)
+
[6773778](/theupdateframework/python-tuf/commit/677377899e38094e9e1a175a31b6736f00c32d7a)

commit 4ad7ae4

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**424 additions**
and
**236 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tests

  + repository\_data/fishy\_rolenames

    - tests/repository\_data/fishy\_rolenames/1.a.json
      [1.a.json](#diff-62901f2b60870c10f2e80b12729e4d52034efd464d976e7226fca6f484d650c9)
    - metadata

      * tests/repository\_data/fishy\_rolenames/metadata/1...json
        [1...json](#diff-3613e00470cbaf6de53ea9a046ed6aaac93a3f795ce6a3d10c85be39a6c6f425)
      * tests/repository\_data/fishy\_rolenames/metadata/1.root.json
        [1.root.json](#diff-a0f68eaf4756822d7437a91716adc453130d9b8c980704320abc2e08dd874566)
      * tests/repository\_data/fishy\_rolenames/metadata/1.targets.json
        [1.targets.json](#diff-264435006e239a09244ee7091ec5490fc635ddcc32336d043cb266d8bf7c161d)
      * tests/repository\_data/fishy\_rolenames/metadata/1.√∂.json
        [1.√∂.json](#diff-a3616762288c275c335b203e27e60c0d1a59f60410fd315ede4a529bbdfbb432)
      * tests/repository\_data/fishy\_rolenames/metadata/2.snapshot.json
        [2.snapshot.json](#diff-c5d99c2ea8aa74caded86e0e791a3a423bf5ffd7448ad27936e7aac22e56be01)
      * tests/repository\_data/fishy\_rolenames/metadata/timestamp.json
        [timestamp.json](#diff-2fd25c61ba4bce9841ac1d7fb666bc204d26b22d1f5028f83baa34d847bfa9cf)
  + tests/repository\_simulator.py
    [repository\_simulator.py](#diff-5df61d769c48d57692091569b5b378230a966602531808435bb5e121da613fef)
  + tests/test\_updater.py
    [test\_updater.py](#diff-906c8650352f360773f89fb317f460569c63aacf8ad9234a567b6b977ebe0bfe)
  + tests/test\_updater\_with\_simulator.py
    [test\_updater\_with\_simulator.py](#diff-118364bc81800abf804a4308982a6003a690783d6b4aa3f30e5d8ec1e78dd001)
* tuf

  + client

    - tuf/client/updater.py
      [updater.py](#diff-9ea8a1bf8ff58c5148fbd8bafc0792dde8ef97ec8d86d998119e0f2537026046)
  + ngclient

    - tuf/ngclient/updater.py
      [updater.py](#diff-25f01b8a851f7c568b80bd2a7ab7fe5943bf8f32efd1a4c1e1c6227e54f419aa)

## There are no files selected for viewing

15 changes: 15 additions & 0 deletions

15
[tests/repository\_data/fishy\_rolenames/1.a.json](#diff-62901f2b60870c10f2e80b12729e4d52034efd464d976e7226fca6f484d650c9 "tests/repository_data/fishy_rolenames/1.a.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/1.a.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,15 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "056a036ef6f15c1dbff1f3d61dfadfc9e92699f6b66a2e21513698b576cc498d", |
|  |  | "sig": "6550a087bd0f01648f57e02a275f20c8e38974271d73739c446f53a028c4118e070b1d37224bc022ab6e0500c8051494f276365868ed6039ec49c7ecd8b9f602" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "targets", |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "spec\_version": "1.0.19", |
|  |  | "targets": {}, |
|  |  | "version": 1 |
|  |  | } |
|  |  | } |

15 changes: 15 additions & 0 deletions

15
[tests/repository\_data/fishy\_rolenames/metadata/1...json](#diff-3613e00470cbaf6de53ea9a046ed6aaac93a3f795ce6a3d10c85be39a6c6f425 "tests/repository_data/fishy_rolenames/metadata/1...json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/1...json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,15 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "c4f5b1013293e01cedb1680fc3aa670278fd46277c62d0bfa24ffff5f0ad0602", |
|  |  | "sig": "c0266de0724c2ab9c14e679b258033fe3aff8ce3c99419479456170975bb43de9e8539caed437cccc8e6c6068252a921f7badc5384149dab18261a7f157ae406" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "targets", |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "spec\_version": "1.0.19", |
|  |  | "targets": {}, |
|  |  | "version": 1 |
|  |  | } |
|  |  | } |

71 changes: 71 additions & 0 deletions

71
[tests/repository\_data/fishy\_rolenames/metadata/1.root.json](#diff-a0f68eaf4756822d7437a91716adc453130d9b8c980704320abc2e08dd874566 "tests/repository_data/fishy_rolenames/metadata/1.root.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/1.root.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,71 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "b24fc41c37a5e3c7b504516351633494e462137338182d8f701dc889acbd2eb6", |
|  |  | "sig": "1d3b9cebfdab388db500d01cb2cd499f016320029df17bf2f1196d8f83f12d041832dc165f23667e537d8a8aa66c716d19835bd2bcd55d4c18bbbd0c6eaf4b06" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "root", |
|  |  | "consistent\_snapshot": true, |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "keys": { |
|  |  | "965e45aad2af966bafe3719a99152fa34576a07b61742e6501c0b235fd3b8f9c": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "d98dace51d795525971342b9f7317cea0d743710dca932543fedb92bb083c2c0" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | }, |
|  |  | "b24fc41c37a5e3c7b504516351633494e462137338182d8f701dc889acbd2eb6": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "46d386175220afd55ad9b09b6b18fa96cd69e25bc29c97ed7024a522e7e7938c" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | }, |
|  |  | "c808865e701882b89c075941ca158034d8c47bde97f1dcdb2afd854334a3ffef": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "a7beb72fb686a645f5ffd52e246a55d2914411853c70a5b47d837ed7b4c40734" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | }, |
|  |  | "e1f4f87b77838c39ec348fc6e74a10e28272fb6bf3f45bff09cd694148150095": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "efdf10805063c1b7356f40ede43d2c5c6d2d11d79e350887ce96fe5d1e44901a" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | } |
|  |  | }, |
|  |  | "roles": { |
|  |  | "root": { |
|  |  | "keyids": [ |
|  |  | "b24fc41c37a5e3c7b504516351633494e462137338182d8f701dc889acbd2eb6" |
|  |  | ], |
|  |  | "threshold": 1 |
|  |  | }, |
|  |  | "snapshot": { |
|  |  | "keyids": [ |
|  |  | "e1f4f87b77838c39ec348fc6e74a10e28272fb6bf3f45bff09cd694148150095" |
|  |  | ], |
|  |  | "threshold": 1 |
|  |  | }, |
|  |  | "targets": { |
|  |  | "keyids": [ |
|  |  | "c808865e701882b89c075941ca158034d8c47bde97f1dcdb2afd854334a3ffef" |
|  |  | ], |
|  |  | "threshold": 1 |
|  |  | }, |
|  |  | "timestamp": { |
|  |  | "keyids": [ |
|  |  | "965e45aad2af966bafe3719a99152fa34576a07b61742e6501c0b235fd3b8f9c" |
|  |  | ], |
|  |  | "threshold": 1 |
|  |  | } |
|  |  | }, |
|  |  | "spec\_version": "1.0.19", |
|  |  | "version": 1 |
|  |  | } |
|  |  | } |

75 changes: 75 additions & 0 deletions

75
[tests/repository\_data/fishy\_rolenames/metadata/1.targets.json](#diff-264435006e239a09244ee7091ec5490fc635ddcc32336d043cb266d8bf7c161d "tests/repository_data/fishy_rolenames/metadata/1.targets.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/1.targets.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,75 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "c808865e701882b89c075941ca158034d8c47bde97f1dcdb2afd854334a3ffef", |
|  |  | "sig": "ffa055ab5108f9d22f309fecd0160b02971d7a454c8d48db4f99cdaf114b329a401b756a11e42630bff6667ad897fb05f501e3299d25fe786d12651cb0db6c06" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "targets", |
|  |  | "delegations": { |
|  |  | "keys": { |
|  |  | "056a036ef6f15c1dbff1f3d61dfadfc9e92699f6b66a2e21513698b576cc498d": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "45d4d9ee28ef61506695130fe600d637e5f2de0de72473c280b02b89467d7aab" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | }, |
|  |  | "c4f5b1013293e01cedb1680fc3aa670278fd46277c62d0bfa24ffff5f0ad0602": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "abe021d7594f04467627c2be390c665b311dceb83cceb685edc9b90a6e229d08" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | }, |
|  |  | "e38fb1b3a2dea12551541bbb205f09609d9386e147207182c8b900bc0a25e2b8": { |
|  |  | "keytype": "ed25519", |
|  |  | "keyval": { |
|  |  | "public": "52b790190bccf730fad4b769e7073c1551938101483ff8612534eb9105426dce" |
|  |  | }, |
|  |  | "scheme": "ed25519" |
|  |  | } |
|  |  | }, |
|  |  | "roles": [ |
|  |  | { |
|  |  | "keyids": [ |
|  |  | "056a036ef6f15c1dbff1f3d61dfadfc9e92699f6b66a2e21513698b576cc498d" |
|  |  | ], |
|  |  | "name": "../a", |
|  |  | "paths": [ |
|  |  | "\*" |
|  |  | ], |
|  |  | "terminating": false, |
|  |  | "threshold": 1 |
|  |  | }, |
|  |  | { |
|  |  | "keyids": [ |
|  |  | "c4f5b1013293e01cedb1680fc3aa670278fd46277c62d0bfa24ffff5f0ad0602" |
|  |  | ], |
|  |  | "name": ".", |
|  |  | "paths": [ |
|  |  | "\*" |
|  |  | ], |
|  |  | "terminating": false, |
|  |  | "threshold": 1 |
|  |  | }, |
|  |  | { |
|  |  | "keyids": [ |
|  |  | "e38fb1b3a2dea12551541bbb205f09609d9386e147207182c8b900bc0a25e2b8" |
|  |  | ], |
|  |  | "name": "\u00f6", |
|  |  | "paths": [ |
|  |  | "\*" |
|  |  | ], |
|  |  | "terminating": false, |
|  |  | "threshold": 1 |
|  |  | } |
|  |  | ] |
|  |  | }, |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "spec\_version": "1.0.19", |
|  |  | "targets": {}, |
|  |  | "version": 1 |
|  |  | } |
|  |  | } |

15 changes: 15 additions & 0 deletions

15
[tests/repository\_data/fishy\_rolenames/metadata/1.√∂.json](#diff-a3616762288c275c335b203e27e60c0d1a59f60410fd315ede4a529bbdfbb432 "tests/repository_data/fishy_rolenames/metadata/1.√∂.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/1.%C3%B6.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,15 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "e38fb1b3a2dea12551541bbb205f09609d9386e147207182c8b900bc0a25e2b8", |
|  |  | "sig": "854fdccea623c33bf968c7ef5abea6e5e5f7c390a691ae0ae5ad87a7580fc00910b566d5dbdbfcaa948f2d8fe4348eecd5a12710d05f576aecf83fbec32c580b" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "targets", |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "spec\_version": "1.0.19", |
|  |  | "targets": {}, |
|  |  | "version": 1 |
|  |  | } |
|  |  | } |

28 changes: 28 additions & 0 deletions

28
[tests/repository\_data/fishy\_rolenames/metadata/2.snapshot.json](#diff-c5d99c2ea8aa74caded86e0e791a3a423bf5ffd7448ad27936e7aac22e56be01 "tests/repository_data/fishy_rolenames/metadata/2.snapshot.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/2.snapshot.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,28 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "e1f4f87b77838c39ec348fc6e74a10e28272fb6bf3f45bff09cd694148150095", |
|  |  | "sig": "f00f4b0040dc6879e7ad69867ba611d52bd5e9993cbfd27e6d8073449356c716b4277093c67ae70eba90ab0367a070e69be750284e70e1135615832efda54008" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "snapshot", |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "meta": { |
|  |  | "../a.json": { |
|  |  | "version": 1 |
|  |  | }, |
|  |  | "..json": { |
|  |  | "version": 1 |
|  |  | }, |
|  |  | "targets.json": { |
|  |  | "version": 1 |
|  |  | }, |
|  |  | "\u00f6.json": { |
|  |  | "version": 1 |
|  |  | } |
|  |  | }, |
|  |  | "spec\_version": "1.0.19", |
|  |  | "version": 2 |
|  |  | } |
|  |  | } |

19 changes: 19 additions & 0 deletions

19
[tests/repository\_data/fishy\_rolenames/metadata/timestamp.json](#diff-2fd25c61ba4bce9841ac1d7fb666bc204d26b22d1f5028f83baa34d847bfa9cf "tests/repository_data/fishy_rolenames/metadata/timestamp.json")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_data/fishy_rolenames/metadata/timestamp.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,19 @@ |
|  |  | { |
|  |  | "signatures": [ |
|  |  | { |
|  |  | "keyid": "965e45aad2af966bafe3719a99152fa34576a07b61742e6501c0b235fd3b8f9c", |
|  |  | "sig": "5a0040f56454f2f338acb8a81b4c2e170e0bc61219a7cd823f635dfc9faeefcf30dfe9c792f148a25949cc9594f8ac1bfffe436b737eff140d236eba57fe9e08" |
|  |  | } |
|  |  | ], |
|  |  | "signed": { |
|  |  | "\_type": "timestamp", |
|  |  | "expires": "2021-10-22T11:21:56Z", |
|  |  | "meta": { |
|  |  | "snapshot.json": { |
|  |  | "version": 2 |
|  |  | } |
|  |  | }, |
|  |  | "spec\_version": "1.0.19", |
|  |  | "version": 2 |
|  |  | } |
|  |  | } |

81 changes: 59 additions & 22 deletions

81
[tests/repository\_simulator.py](#diff-5df61d769c48d57692091569b5b378230a966602531808435bb5e121da613fef "tests/repository_simulator.py")

Show comments

[View file](/theupdateframework/python-tuf/blob/4ad7ae48fda594b640139c3b7eae21ed5155a102/tests/repository_simulator.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,6 +59,8 @@ |
|  |  | from tuf.api.serialization.json import JSONSerializer |
|  |  | from tuf.exceptions import FetcherHTTPError |
|  |  | from tuf.api.metadata import ( |
|  |  | DelegatedRole, |
|  |  | Delegations, |
|  |  | Key, |
|  |  | Metadata, |
|  |  | MetaFile, |
| Expand Down  Expand Up | | @@ -106,6 +108,9 @@ def \_\_init\_\_(self): |
|  |  | self.dump\_dir = None |
|  |  | self.dump\_version = 0 |
|  |  |  |
|  |  | now = datetime.utcnow() |
|  |  | self.safe\_expiry = now.replace(microsecond=0) + timedelta(days=30) |
|  |  |  |
|  |  | self.\_initialize() |
|  |  |  |
|  |  | @property |
| Expand Down  Expand Up | | @@ -135,20 +140,19 @@ def create\_key(self) -> Tuple[Key, SSlibSigner]: |
|  |  |  |
|  |  | def \_initialize(self): |
|  |  | """Setup a minimal valid repository""" |
|  |  | expiry = datetime.utcnow().replace(microsecond=0) + timedelta(days=30) |
|  |  |  |
|  |  | targets = Targets(1, SPEC\_VER, expiry, {}, None) |
|  |  | targets = Targets(1, SPEC\_VER, self.safe\_expiry, {}, None) |
|  |  | self.md\_targets = Metadata(targets, OrderedDict()) |
|  |  |  |
|  |  | meta = {"targets.json": MetaFile(targets.version)} |
|  |  | snapshot = Snapshot(1, SPEC\_VER, expiry, meta) |
|  |  | snapshot = Snapshot(1, SPEC\_VER, self.safe\_expiry, meta) |
|  |  | self.md\_snapshot = Metadata(snapshot, OrderedDict()) |
|  |  |  |
|  |  | snapshot\_meta = MetaFile(snapshot.version) |
|  |  | timestamp = Timestamp(1, SPEC\_VER, expiry, snapshot\_meta) |
|  |  | timestamp = Timestamp(1, SPEC\_VER, self.safe\_expiry, snapshot\_meta) |
|  |  | self.md\_timestamp = Metadata(timestamp, OrderedDict()) |
|  |  |  |
|  |  | root = Root(1, SPEC\_VER, expiry, {}, {}, True) |
|  |  | root = Root(1, SPEC\_VER, self.safe\_expiry, {}, {}, True) |
|  |  | for role in ["root", "timestamp", "snapshot", "targets"]: |
|  |  | key, signer = self.create\_key() |
|  |  | root.roles[role] = Role([], 1) |
| Expand All | | @@ -172,27 +176,27 @@ def publish\_root(self): |
|  |  | def fetch(self, url: str) -> Iterator[bytes]: |
|  |  | if not self.root.consistent\_snapshot: |
|  |  | raise NotImplementedError("non-consistent snapshot not supported") |
|  |  |  |
|  |  | spliturl = parse.urlparse(url) |
|  |  | if spliturl.path.startswith("/metadata/"): |
|  |  | parts = spliturl.path[len("/metadata/") :].split(".") |
|  |  | if len(parts) == 3: |
|  |  | version: Optional[int] = int(parts[0]) |
|  |  | role = parts[1] |
|  |  | else: |
|  |  | path = parse.urlparse(url).path |
|  |  | if path.startswith("/metadata/") and path.endswith(".json"): |
|  |  | ver\_and\_name = path[len("/metadata/") :][: -len(".json")] |
|  |  | # only consistent\_snapshot supported ATM: timestamp is special case |
|  |  | if ver\_and\_name == "timestamp": |
|  |  | version = None |
|  |  | role = parts[0] |
|  |  | role = "timestamp" |
|  |  | else: |
|  |  | version, \_, role = ver\_and\_name.partition(".") |
|  |  | version = int(version) |
|  |  | yield self.\_fetch\_metadata(role, version) |
|  |  | elif spliturl.path.startswith("/targets/"): |
|  |  | elif path.startswith("/targets/"): |
|  |  | # figure out target path and hash prefix |
|  |  | path = spliturl.path[len("/targets/") :] |
|  |  | dir\_parts, sep , prefixed\_filename = path.rpartition("/") |
|  |  | target\_path = path[len("/targets/") :] |
|  |  | dir\_parts, sep , prefixed\_filename = target\_path.rpartition("/") |
|  |  | prefix, \_, filename = prefixed\_filename.partition(".") |
|  |  | target\_path = f"{dir\_parts}{sep}{filename}" |
|  |  |  |
|  |  | yield self.\_fetch\_target(target\_path, prefix) |
|  |  | else: |
|  |  | raise FetcherHTTPError(f"Unknown path '{spliturl.path}'", 404) |
|  |  | raise FetcherHTTPError(f"Unknown path '{path}'", 404) |
|  |  |  |
|  |  | def \_fetch\_target(self, target\_path: str, hash: Optional[str]) -> bytes: |
|  |  | """Return data for 'target\_path', checking 'hash' if it is given. |
| Expand Down  Expand Up | | @@ -268,12 +272,14 @@ def update\_timestamp(self): |
|  |  |  |
|  |  | def update\_snapshot(self): |
|  |  | for role, delegate in self.all\_targets(): |
|  |  | self.snapshot.meta[f"{role}.json"].version = delegate.version |
|  |  |  |
|  |  | hashes = None |
|  |  | length = None |
|  |  | if self.compute\_metafile\_hashes\_length: |
|  |  | hashes, length = self.\_compute\_hashes\_and\_length(role) |
|  |  | self.snapshot.meta[f"{role}.json"].hashes = hashes |
|  |  | self.snapshot.meta[f"{role}.json"].length = length |
|  |  |  |
|  |  | self.snapshot.meta[f"{role}.json"] = MetaFile( |
|  |  | delegate.version, length, hashes |
|  |  | ) |
|  |  |  |
|  |  | self.snapshot.version += 1 |
|  |  | self.update\_timestamp() |
| Expand All | | @@ -288,6 +294,37 @@ def add\_target(self, role: str, data: bytes, path: str): |
|  |  | targets.targets[path] = target |
|  |  | self.target\_files[path] = RepositoryTarget(data, target) |
|  |  |  |
|  |  | def add\_delegation( |
|  |  | self, |
|  |  | delegator\_name: str, |
|  |  | name: str, |
|  |  | targets: Targets, |
|  |  | terminating: bool, |
|  |  | paths: Optional[List[str]], |
|  |  | hash\_prefixes: Optional[List[str]], |
|  |  | ): |
|  |  | if delegator\_name == "targets": |
|  |  | delegator = self.targets |
|  |  | else: |
|  |  | delegator = self.md\_delegates[delegator\_name].signed |
|  |  |  |
|  |  | # Create delegation |
|  |  | role = DelegatedRole(name, [], 1, terminating, paths, hash\_prefixes) |
|  |  | if delegator.delegations is None: |
|  |  | delegator.delegations = Delegations({}, {}) |
|  |  | # put delegation last by default |
|  |  | delegator.delegations.roles[role.name] = role |
|  |  |  |
|  |  | # By default add one new key for the role |
|  |  | key, signer = self.create\_key() |
|  |  | delegator.add\_key(role.name, key) |
|  |  | if role.name not in self.signers: |
|  |  | self.signers[role.name] = [] |
|  |  | self.signers[role.name].append(signer) |
|  |  |  |
|  |  | # Add metadata for the role |
|  |  | self.md\_delegates[role.name] = Metadata(targets, OrderedDict()) |
|  |  |  |
|  |  | def write(self): |
|  |  | """Dump current repository metadata to self.dump\_dir |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4ad7ae4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fpython-tuf%2Fcommit%2F4ad7ae48fda594b640139c3b7eae21ed5155a102) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


