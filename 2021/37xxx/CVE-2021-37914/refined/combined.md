=== Content from github.com_9516433b_20250115_081113.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-workflows%2Fissues%2F6441)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-workflows%2Fissues%2F6441)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=argoproj%2Fargo-workflows)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-workflows](/argoproj/argo-workflows)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-workflows) You must be signed in to change notification settings
* [Fork
  3.2k](/login?return_to=%2Fargoproj%2Fargo-workflows)
* [Star
   15.3k](/login?return_to=%2Fargoproj%2Fargo-workflows)

* [Code](/argoproj/argo-workflows)
* [Issues
  983](/argoproj/argo-workflows/issues)
* [Pull requests
  139](/argoproj/argo-workflows/pulls)
* [Discussions](/argoproj/argo-workflows/discussions)
* [Actions](/argoproj/argo-workflows/actions)
* [Projects
  1](/argoproj/argo-workflows/projects)
* [Security](/argoproj/argo-workflows/security)
* [Insights](/argoproj/argo-workflows/pulse)

Additional navigation options

* [Code](/argoproj/argo-workflows)
* [Issues](/argoproj/argo-workflows/issues)
* [Pull requests](/argoproj/argo-workflows/pulls)
* [Discussions](/argoproj/argo-workflows/discussions)
* [Actions](/argoproj/argo-workflows/actions)
* [Projects](/argoproj/argo-workflows/projects)
* [Security](/argoproj/argo-workflows/security)
* [Insights](/argoproj/argo-workflows/pulse)

# workflow re-write vulnerability using input parameter¬†#6441

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#6285](https://github.com/argoproj/argo-workflows/pull/6285)Closed[workflow re-write vulnerability using input parameter](#top)#6441[#6285](https://github.com/argoproj/argo-workflows/pull/6285)Copy linkLabels[type/featureFeature request](https://github.com/argoproj/argo-workflows/issues?q=state%3Aopen%20label%3A%22type%2Ffeature%22)Feature request[type/securitySecurity related](https://github.com/argoproj/argo-workflows/issues?q=state%3Aopen%20label%3A%22type%2Fsecurity%22)Security relatedMilestone[v3.1](https://github.com/argoproj/argo-workflows/milestone/22)![@alexec](https://avatars.githubusercontent.com/u/1142830?u=c893f99c152727beb204caea70ed45ee936b20b2&v=4&size=80)
## Description

![@alexec](https://avatars.githubusercontent.com/u/1142830?u=c893f99c152727beb204caea70ed45ee936b20b2&v=4&size=48)[alexec](https://github.com/alexec)opened [on Jul 28, 2021](https://github.com/argoproj/argo-workflows/issues/6441#issue-955021937)
# Summary

It's possible to rewrite parts of a workflow on-cluster using only an input parameter. Operators who allows users to run workflows specifying input parameters are vulnerable to this.

# Details

From @mac9416 :

It's possible to rewrite parts of a workflow on-cluster using only an input parameter. This relies on taking advantage of the fact that the output of expression templates is evaluated a a literal part of the JSON-stringified template.

The following workflow accepts a string param, performs a trivial transformation (in this case, just printing it), and then passes the output as an env var to be printed.

The poisoned param value is able to overwrite "args" because 1) the golang JSON marshaler allows duplicate keys and, 2) the stringified template keys seem to be alphabetically-ordered, so the poisoned "env" value can override the original "args" field.

This is just a quick proof-of-concept. The motivated attacker could probably find a lot of different and nefarious ways to mutate a workflow.

I believe this PR would close the vulnerability: [#6285](https://github.com/argoproj/argo-workflows/pull/6285)

```
# argo submit rewrite-args.yaml -p 'a="}], "args": ["echo nope"], "env": [{"name": "MESSAGE", "value": "unused'
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: rewrite-args
spec:
  entrypoint: main
  arguments:
    parameters:
      - name: a
  templates:
    - name: main
      steps:
        - - name: concat
            template: concat
        - - name: print
            template: print
            arguments:
              parameters:
                - name: message
                  value: "{{steps.concat.outputs.result}}"
    - name: concat
      script:
        image: debian:9.4
        command: [bash]
        env:
          - name: A
            value: "{{workflow.parameters.a}}"
        source: |
          echo "$A"
    - name: print
      inputs:
        parameters:
          - name: message
      container:
        image: debian:9.4
        command: [bash, -c]
        args:
          - echo "$MESSAGE"
        env:
          - name: MESSAGE
            value: "{{=inputs.parameters['message']}}"

```

Note: there seems to be some non-determinism involved. The expected behavior is for the "print" step to output "this happens instead". If instead you get an error, re-submit a few times.

---

**Message from the maintainers**:

Impacted by this bug? Give it a üëç. We prioritise the issues with the most üëç.

## Metadata

### Assignees

No one assigned

### Labels

[type/featureFeature request](https://github.com/argoproj/argo-workflows/issues?q=state%3Aopen%20label%3A%22type%2Ffeature%22)Feature request[type/securitySecurity related](https://github.com/argoproj/argo-workflows/issues?q=state%3Aopen%20label%3A%22type%2Fsecurity%22)Security related
### Type

No type
### Projects

No projects
### Milestone

* [v3.1](https://github.com/argoproj/argo-workflows/milestone/22)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_0231623e_20250115_081119.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-workflows%2Fpull%2F6442)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-workflows%2Fpull%2F6442)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=argoproj%2Fargo-workflows)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-workflows](/argoproj/argo-workflows)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-workflows) You must be signed in to change notification settings
* [Fork
  3.2k](/login?return_to=%2Fargoproj%2Fargo-workflows)
* [Star
   15.3k](/login?return_to=%2Fargoproj%2Fargo-workflows)

* [Code](/argoproj/argo-workflows)
* [Issues
  983](/argoproj/argo-workflows/issues)
* [Pull requests
  139](/argoproj/argo-workflows/pulls)
* [Discussions](/argoproj/argo-workflows/discussions)
* [Actions](/argoproj/argo-workflows/actions)
* [Projects
  1](/argoproj/argo-workflows/projects)
* [Security](/argoproj/argo-workflows/security)
* [Insights](/argoproj/argo-workflows/pulse)

Additional navigation options

* [Code](/argoproj/argo-workflows)
* [Issues](/argoproj/argo-workflows/issues)
* [Pull requests](/argoproj/argo-workflows/pulls)
* [Discussions](/argoproj/argo-workflows/discussions)
* [Actions](/argoproj/argo-workflows/actions)
* [Projects](/argoproj/argo-workflows/projects)
* [Security](/argoproj/argo-workflows/security)
* [Insights](/argoproj/argo-workflows/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fargoproj%2Fargo-workflows%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fargoproj%2Fargo-workflows%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# feat!: Rewrite templating. #6442

 Closed

[alexec](/alexec)
wants to merge
6
commits into
[argoproj:master](/argoproj/argo-workflows/tree/master "argoproj/argo-workflows:master")
from
[alexec:map-tmpl](/alexec/argo-workflows/tree/map-tmpl "alexec/argo-workflows:map-tmpl")

 Closed

# [feat!: Rewrite templating.](#top) #6442

[alexec](/alexec)
wants to merge
6
commits into
[argoproj:master](/argoproj/argo-workflows/tree/master "argoproj/argo-workflows:master")
from
[alexec:map-tmpl](/alexec/argo-workflows/tree/map-tmpl "alexec/argo-workflows:map-tmpl")

[Conversation
21](/argoproj/argo-workflows/pull/6442)
[Commits
6](/argoproj/argo-workflows/pull/6442/commits)
[Checks
0](/argoproj/argo-workflows/pull/6442/checks)
[Files changed](/argoproj/argo-workflows/pull/6442/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![alexec](https://avatars.githubusercontent.com/u/1142830?s=60&v=4)](/alexec)

Copy link

Contributor

### @alexec **[alexec](/alexec)** commented [Jul 28, 2021](#issue-955051840)

Signed-off-by: Alex Collins alex\_collins@intuit.com

Our current templating system is a source of many edge-case bugs and is full of sticking-plasters to deal with these edge-cases. It also has a security issue that allows users to re-write a workflow using input parameters (see [#6441](https://github.com/argoproj/argo-workflows/issues/6441)) that cannot be fixed with the current solution.

I expect some users are probably using the ability to re-write templates to insert or change workflows, so this is a breaking change.

This PoC changes the solution, so that rather than templating the whole object, we only template values that are strings.

Sorry, something went wrong.

All reactions

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[feat!: Rewrite templating. BREAKING CHANGE](/argoproj/argo-workflows/pull/6442/commits/78c792569c0a26bccbce70f527598222d1d14590 "feat!: Rewrite templating. BREAKING CHANGE

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[78c7925](/argoproj/argo-workflows/pull/6442/commits/78c792569c0a26bccbce70f527598222d1d14590)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Jul 28, 2021](#issuecomment-888467162)

| The following tests are failing:  [image](https://user-images.githubusercontent.com/1142830/127364202-d3c6e86c-45af-4687-87b0-3c6e7d412235.png)  TestNestedTemplateParallelismLimit  ``` withParam value could not be parsed as a JSON list: [1,2,3,4]\\n: invalid character '\\\\' after top-level value  ```  TestParamAggregation  ```         	            	expected: "[\"odd\",\"even\"]"         	            	actual  : "[\\\"odd\\\",\\\"even\\\"]"  ```  TestStepsFailFast  ``` withParam value could not be parsed as a JSON list: [\\\"a\\\", \\\"b\\\", \\\"c\\\"]\\n: invalid character '\\\\' looking for beginning of value  ```  TestInputParametersAsJson  ```         	            	expected: "Workflow: [{\"name\":\"parameter1\",\"value\":\"value1\"}]. Template: [{\"name\":\"parameter1\",\"value\":\"value1\"},{\"name\":\"parameter2\",\"value\":\"template2\"}]"         	            	actual  : "Workflow: [{\\\"name\\\":\\\"parameter1\\\",\\\"value\\\":\\\"value1\\\"}]. Template: [{\\\"name\\\":\\\"parameter1\\\",\\\"value\\\":\\\"value1\\\"},{\\\"name\\\":\\\"parameter2\\\",\\\"value\\\":\\\"template2\\\"}]"  ```  TestExpandWithItemsMap  ```         	            	expected: "debian 9.1 JSON({\"os\":\"debian\",\"version\":9.1})"         	            	actual  : "debian 9.1 JSON({\\\"os\\\":\\\"debian\\\",\\\"version\\\":9.1})"  ```  TestSubstituteGlobalVariables  ```         	Error:      	"[{\"name\":\"whalesay1\",\"inputs\":{},\"outputs\":{},\"metadata\":{},\"container\":{\"name\":\"\",\"image\":\"docker/whalesay:latest\",\"command\":[\"cowsay\"],\"args\":[\"mutex1\"],\"resources\":{}}}]" does not contain "{{workflow.parameters.message}}"  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Jul 28, 2021](#issuecomment-888472814)

| @mac9416 I'd love to get your thoughts on this. |
| --- |

All reactions

Sorry, something went wrong.

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Jul 28, 2021](#issuecomment-888496208)

| Will take a look! |
| --- |

All reactions

Sorry, something went wrong.

[![crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=60&v=4)](/crenshaw-dev)

**[crenshaw-dev](/crenshaw-dev)**
reviewed
[Jul 28, 2021](#pullrequestreview-717310574)

 [View reviewed changes](/argoproj/argo-workflows/pull/6442/files/78c792569c0a26bccbce70f527598222d1d14590)

Copy link

Member

### @crenshaw-dev **[crenshaw-dev](/crenshaw-dev)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Having only really looked at `replace.go`, I love the approach. Will read some more and try to see why the tests might be failing / how to fix that.

Sorry, something went wrong.

All reactions

[util/template/replace.go](/argoproj/argo-workflows/pull/6442/files/78c792569c0a26bccbce70f527598222d1d14590#diff-f052cf13b02f8aaed79df3589c9f5d0124dc630043901ef3a2c89cc3d829dd90)

|  |  | if err != nil { |
| --- | --- | --- |
|  |  | return err |
|  |  | } |
|  |  | data, err = json.Marshal(y) |

Copy link

Member

### @crenshaw-dev **[crenshaw-dev](/crenshaw-dev)** [Jul 28, 2021](#discussion_r678531100)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I *think* you could equivalently call `json.Valid` and return `y` directly. But I guess then you wouldn't be able to bubble up the marshalling error.

Sorry, something went wrong.

All reactions

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Jul 28, 2021](#issuecomment-888556504)

| I haven't validated this yet, but I wonder if the test failures are because `simpleReplace` still calls `strconv.Quote`.  I'm not sure what issues the `strconv.Quote` was trying to resolve. But if that call was just "don't let the result break the JSON", then I think only running the templating engine on `string`s resolves that issue, and the `strconv.Quote` call can be removed. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[remove strconv.Quote](/argoproj/argo-workflows/pull/6442/commits/e43ae16bec9db40f980c8aa00f21c9f18d86cf9f "remove strconv.Quote

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[e43ae16](/argoproj/argo-workflows/pull/6442/commits/e43ae16bec9db40f980c8aa00f21c9f18d86cf9f)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Jul 28, 2021](#issuecomment-888619311)

| [@alexec](https://github.com/alexec) is that a real test failure or a flake test failure? I get the same thing consistently locally. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Jul 28, 2021](#issuecomment-888625658)

| `TestGetPodByNode` did not fail locally for me. I'd like [@sarabala1979](https://github.com/sarabala1979) to comment on `TestSubstituteGlobalVariables`, looks like correct behaviour to me. |
| --- |

 üëç
1
 crenshaw-dev reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@sarabala1979](https://avatars.githubusercontent.com/u/33908564?s=80&u=890015e0d271258251a0f4f6ce1a1d590e586db1&v=4)](/sarabala1979)

Copy link

Member

### **[sarabala1979](/sarabala1979)** commented [Aug 2, 2021](#issuecomment-890735582) ‚Ä¢ edited Loading

| [@alexec](https://github.com/alexec) Template level `Workflow.parameters` has to be substituted during the template execution otherwise template will have a stale value if that parameter is updated during another step/dag execution. [#6401](https://github.com/argoproj/argo-workflows/pull/6401) |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Aug 2, 2021](#issuecomment-891133212) ‚Ä¢ edited Loading

| It seems to me that we have some edge case behavior going on that it might be hard to compensate for. |
| --- |

All reactions

Sorry, something went wrong.

[![@sarabala1979](https://avatars.githubusercontent.com/u/33908564?s=80&u=890015e0d271258251a0f4f6ce1a1d590e586db1&v=4)](/sarabala1979)

Copy link

Member

### **[sarabala1979](/sarabala1979)** commented [Aug 2, 2021](#issuecomment-891136415)

| It seems to me that we have some edge case behavior going on that it might be hard to compensate for.  yes this edge case scenario, but it is a real usecase.  you can add below code will work. Templates substitution will happen in `executeTemplate` function with updated value.  ``` 	execWfSpec := woc.execWf.Spec  	// To Avoid the stale Global parameter value substitution to templates. 	// Updated Global parameter values will be substituted in 'executetemplate' for templates. 	execWfSpec.Templates = nil ``` |
| --- |

All reactions

Sorry, something went wrong.

[![crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=60&v=4)](/crenshaw-dev)

**[crenshaw-dev](/crenshaw-dev)**
reviewed
[Aug 2, 2021](#pullrequestreview-720372606)

 [View reviewed changes](/argoproj/argo-workflows/pull/6442/files/e43ae16bec9db40f980c8aa00f21c9f18d86cf9f)

[workflow/controller/operator.go](/argoproj/argo-workflows/pull/6442/files/e43ae16bec9db40f980c8aa00f21c9f18d86cf9f#diff-f321d4af83fcf8311dc80c0d50c59ac4c240f761206e7bb652709870eb9feb43)
Outdated

|  |  | return err |
| --- | --- | --- |
|  |  | } |
|  |  | return nil |
|  |  | return template.Replace(&woc.execWf.Spec, woc.globalParams, true) |

Copy link

Member

### @crenshaw-dev **[crenshaw-dev](/crenshaw-dev)** [Aug 2, 2021](#discussion_r681098850) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | return template.Replace(&woc.execWf.Spec, woc.globalParams, true) |
| --- | --- |
|  | execWfSpec := woc.execWf.Spec |
|  |  |
|  | // To Avoid the stale Global parameter value substitution to templates. |
|  | // Updated Global parameter values will be substituted in 'executetemplate' for templates. |
|  | execWfSpec.Templates = nil |
|  |  |
|  | return template.Replace(&execWfSpec, woc.globalParams, true) |

[@sarabala1979](https://github.com/sarabala1979) like this?

Sorry, something went wrong.

All reactions

Copy link

Member

### @sarabala1979 **[sarabala1979](/sarabala1979)** [Aug 2, 2021](#discussion_r681107622)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

yes

Sorry, something went wrong.

All reactions

Copy link

Member

### @sarabala1979 **[sarabala1979](/sarabala1979)** [Aug 2, 2021](#discussion_r681107979)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

return template.Replace(&execWfSpec, woc.globalParams, true)

Sorry, something went wrong.

 üëç
1
 crenshaw-dev reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Aug 2, 2021](#issuecomment-891202292)

| I'm closing this PR. I think it is too risky. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
closed this
[Aug 2, 2021](#event-5100371051)

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Aug 2, 2021](#issuecomment-891207747)

| [@alexec](https://github.com/alexec) should I continue working on [#6285](https://github.com/argoproj/argo-workflows/pull/6285)? |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Aug 2, 2021](#issuecomment-891213647)

| I really don't know what the best solution is with templates. Bugs are a game of whack-a-mole. |
| --- |

All reactions

Sorry, something went wrong.

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Aug 2, 2021](#issuecomment-891217861)

| Given:   1. expression templates introduce a security vulnerability and 2. the bug also eliminates a major (the primary?) use case for expression templates (the possibility to generate JSON lists containing strings to use with `withParam`)   I feel like it's worth either playing a bit more whack-a-mole or removing the expression template feature.  Is there any set of tests/validations we could perform on [#6285](https://github.com/argoproj/argo-workflows/pull/6285) which would provide sufficient confidence that it is safe? Would be happy to schedule a call to discuss what that would look like. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
linked an issue
[Aug 2, 2021](#event-5100532547)
that may be
closed
by this pull request

[workflow re-write vulnerability using input parameter
#6441](/argoproj/argo-workflows/issues/6441)

Closed

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Aug 2, 2021](#issuecomment-891239077)

| It was my understanding from you email that the vulnerability ([#6441](https://github.com/argoproj/argo-workflows/issues/6441)) exists for any template. It sound like you think it only exists for *expression tag templates*. Users can remove the vulnerability by starting the controller using `EXPRESSION_TEMPLATES=false`, but that is not helpful if you are already using that feature.  Can you please double-confirm if this is only a problem with expression templates?  That given, if this is a new issue, or an existing issue, the we should have a plan to fix it. That doesn't need to be in v3.1, but should probably be in v3.2 (releases take 3 months to rollout).  This PR ([#6442](https://github.com/argoproj/argo-workflows/pull/6442)) is a big change, and therefore risky, so I'd want to do more testing. I'm not sure that'd make it in time for v3.2  Your PR ([#6285](https://github.com/argoproj/argo-workflows/pull/6285)) isolates changes to the expression code. So this is low risk and suitable for back-porting to v3.1. |
| --- |

All reactions

Sorry, something went wrong.

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=80&u=16cdc1365da4d671ad31d847f7b903474430bdd0&v=4)](/crenshaw-dev)

Copy link

Member

### **[crenshaw-dev](/crenshaw-dev)** commented [Aug 2, 2021](#issuecomment-891243097) ‚Ä¢ edited Loading

| It sound like you think it only exists for expression tag templates. Users can remove the vulnerability by starting the controller using EXPRESSION\_TEMPLATES=false, but that is not helpful if you are already using that feature.  That is all correct. I should have made the email more clear. I believe the *non-expression tag template* code avoids the vulnerability by running the evaluated expression value through `strconv.Quote`, ensuring the value *cannot* escape its JSON string container. (As far as I can tell, injecting an unescaped `"` is the only way to escape the containing string and modify the JSON-encoded workflow. `strconv.Quote` escapes all double-quotes.)  This PR ([#6442](https://github.com/argoproj/argo-workflows/pull/6442)) is a big change, and therefore risky, so I'd want to do more testing. I'm not sure that'd make it in time for v3.2  Yep. I *like* this PR more because it clearly isolates expressions (and their evaluated values) to the strings in which they're defined. But I agree, it's riskier.  Your PR ([#6285](https://github.com/argoproj/argo-workflows/pull/6285)) isolates changes to the expression code. So this is low risk and suitable for back-porting to v3.1.  In that case, I'll spend some time validating the metrics template behavior (I'm just slightly uneasy about that code) and then un-mark it as a draft.  Still happy to hop on a call if anything here could use clarification or you have any guidance on additional work you'd like to see done for [#6285](https://github.com/argoproj/argo-workflows/pull/6285). |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[Merge branch 'master' into map-tmpl](/argoproj/argo-workflows/pull/6442/commits/e7b75984f2107966005338ef7374538e0d57604b "Merge branch 'master' into map-tmpl

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[e7b7598](/argoproj/argo-workflows/pull/6442/commits/e7b75984f2107966005338ef7374538e0d57604b)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=80&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)

Copy link

Contributor

Author

### **[alexec](/alexec)** commented [Aug 2, 2021](#issuecomment-891322689)

| Lets go with your PR for v3.1, and maybe in v3.2 or v3.3 we can consider this more riskly change. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[revert](/argoproj/argo-workflows/pull/6442/commits/5b96b8085aae92ca3715e7c435e9cee39648d9df "revert

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[5b96b80](/argoproj/argo-workflows/pull/6442/commits/5b96b8085aae92ca3715e7c435e9cee39648d9df)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
mentioned this pull request
[Sep 8, 2021](#ref-issue-988194403)

[Expression results are printed incorrectly at random
#6673](/argoproj/argo-workflows/issues/6673)

Closed

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
reopened this
[Sep 22, 2021](#event-5344411395)

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
changed the title
~~feat!: Rewrite templating. BREAKING CHANGE~~
feat!: Rewrite templating.
[Sep 22, 2021](#event-5344412641)

 [alexec](/alexec)
added 2 commits
[September 22, 2021 09:25](#commits-pushed-ee6b6b3)

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[Merge branch 'master' into map-tmpl](/argoproj/argo-workflows/pull/6442/commits/ee6b6b3d6bd99b44837fdd7581e6cb72dcfa4690 "Merge branch 'master' into map-tmpl

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[ee6b6b3](/argoproj/argo-workflows/pull/6442/commits/ee6b6b3d6bd99b44837fdd7581e6cb72dcfa4690)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&v=4)](/alexec)

`[ok](/argoproj/argo-workflows/pull/6442/commits/f1d58e60b1981cb7d4e6dcbf83e2a43d4ec3d7a7 "ok

Signed-off-by: Alex Collins <alex_collins@intuit.com>")`
 ‚Ä¶

`[f1d58e6](/argoproj/argo-workflows/pull/6442/commits/f1d58e60b1981cb7d4e6dcbf83e2a43d4ec3d7a7)`

```
Signed-off-by: Alex Collins <alex_collins@intuit.com>
```

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
closed this
[Sep 22, 2021](#event-5344532062)

 [![@alexec](https://avatars.githubusercontent.com/u/1142830?s=40&u=c893f99c152727beb204caea70ed45ee936b20b2&v=4)](/alexec)
[alexec](/alexec)
deleted the
map-tmpl

branch
[May 3, 2022 20:32](#event-6543879186)

[![@agilgur5](https://avatars.githubusercontent.com/u/4970083?s=40&u=355810fb13a9f872315e7a7b2fc71fcedea191cc&v=4)](/agilgur5)
[agilgur5](/agilgur5)
added
the
[area/templating](/argoproj/argo-workflows/labels/area/templating)
Templating with `{{...}}`
label
[Oct 1, 2023](#event-10520090639)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-workflows%2Fpull%2F6442)

Reviewers

[![@sarabala1979](https://avatars.githubusercontent.com/u/33908564?s=40&v=4)](/sarabala1979) [sarabala1979](/sarabala1979)

sarabala1979 left review comments

[![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=40&v=4)](/crenshaw-dev) [crenshaw-dev](/crenshaw-dev)

crenshaw-dev left review comments

Assignees

No one assigned

Labels

[area/templating](/argoproj/argo-workflows/labels/area/templating)
Templating with `{{...}}`

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [workflow re-write vulnerability using input parameter](https://github.com/argoproj/argo-workflows/issues/6441)

4 participants

[![@alexec](https://avatars.githubusercontent.com/u/1142830?s=52&v=4)](/alexec) [![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=52&v=4)](/crenshaw-dev) [![@sarabala1979](https://avatars.githubusercontent.com/u/33908564?s=52&v=4)](/sarabala1979) [![@agilgur5](https://avatars.githubusercontent.com/u/4970083?s=52&v=4)](/agilgur5)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


