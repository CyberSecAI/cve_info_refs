=== Content from www.openhub.net_6381d138_20250114_184136.html ===

openhub.net
Black Duck Software, Inc.
[![Open Hub](/assets/logo/BlackDuckLogo-6697adc63e07340464201a2ad534d3d3e44f95d36edda20b140440d34f05372f.svg)](https://www.blackduck.com)

[Open Hub](/)

* [Follow @

  OH](https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fopenhub.net%2Fp%2Frcdcap&region=follow_link&screen_name=bdopenhub&source=followbutton&variant=2.0)
* [Sign In](/sessions/new)
* [Join Now](/accounts/new)

* [Projects](/explore/projects)
* [People](/people)
* [Organizations](/explore/orgs)
* [Tools](/tools)
* [Blog](https://community.blackduck.com/s/black-duck-open-hub?tabset-c30ff=d9d77)
* [BDSA](/vulnerabilities/bdsa)
Projects

+ People
+ Projects
+ Organizations
+ Forums

[![img avatar](https://s3.amazonaws.com/cloud.ohloh.net/attachments/56412/rcdcap-logo_med.png)](/p/rcdcap)

# [RCDCap](/p/rcdcap)

[Settings](/p/rcdcap/settings)
|
[Report Duplicate](/p/rcdcap/duplicates/new)

[0](/p/rcdcap/users)

I Use This!
×
#### Login Required

Log in to Open Hub

Remember Me

Activity Not Available

#### Project Summary

RCDCap is a remote capture preprocessor. It could be used for capturing traffic remotely by using CISCO ERSPAN and HP ERM.

#### Tags

[administration](/tags?names=administration) [arp](/tags?names=arp) [cisco](/tags?names=cisco) [decapsulation](/tags?names=decapsulation) [erm](/tags?names=erm) [erspan](/tags?names=erspan) [ipv4](/tags?names=ipv4) [networking](/tags?names=networking) [packetsniffer](/tags?names=packetsniffer) [pipeline](/tags?names=pipeline) [plugins](/tags?names=plugins) [tap](/tags?names=tap) [vlan](/tags?names=vlan) [vlan8021q](/tags?names=vlan8021q)

#### In a Nutshell, RCDCap...

### Code analysis has not completed

The Open Hub computes statistics on FOSS projects by examining source code and commit history in source code management systems. The source code for this project has been located, but the analysis isn't complete. Feel free to [check its progress](/p/rcdcap/enlistments).

#### Quick Reference

[Project Links:](/p/rcdcap/links)

[Download](http://sourceforge.net/project/showfiles.php?group_id=752151)

[Code Locations:](/p/rcdcap/enlistments)

http://hg.code.sf.net/p/rcdcap/code

[Similar Projects:](/p/rcdcap/similar)

![](/assets/spinner-f6ecff617ec2ba7f559e6f535cad9b70a3f91120737535dab4d4548a6c83576c.gif)

[Managers:](/p/rcdcap/managers)

[Zdravko Velinov](/accounts/zeroeffect)

#### [Licenses](/p/rcdcap/licenses)

##### [GNU General Public License v3.0 or later](https://openhub.net/licenses/gpl3_or_later)

##### Permitted

Commercial Use

Modify

Distribute

Place Warranty

Use Patent Claims

##### Forbidden

Sub-License

Hold Liable

##### Required

Distribute Original

Disclose Source

Include Copyright

State Changes

Include License

Include Install Instructions

These details are provided for information only. No information here is legal advice and should not be used as such.

#### [All Licenses](/licenses)

#### This Project has No vulnerabilities Reported Against it

#### Did You Know...

* ...
  in 2016, 47% of companies did not have formal process in place to track OS code
* ...
  anyone with an Open Hub account can update a project's tags
* ...
  nearly 1 in 3 companies have no process for identifying, tracking,
  or remediating known open source vulnerabilities
* ...
  you can subscribe to e-mail newsletters to receive update from the [Open Hub blog](http://blog.openhub.net/)

### Code analysis has not completed

The Open Hub computes statistics on FOSS projects by examining source code and commit history in source code management systems. The source code for this project has been located, but the analysis isn't complete. Feel free to [check its progress](/p/rcdcap/enlistments).

#### [Community Rating](/p/rcdcap/reviews/summary)

Be the first to rate this project

Click to add your rating

![](/assets/spinner-f6ecff617ec2ba7f559e6f535cad9b70a3f91120737535dab4d4548a6c83576c.gif)

[Review this Project!](/p/rcdcap/reviews/new)

#### [Project Summary](/p/rcdcap)

* [News](/p/rcdcap/rss_articles)
* [Settings](/p/rcdcap/settings)
* [Sharing Widgets](/p/rcdcap/widgets)
* [Related Projects](/p/rcdcap/similar)

#### Code Data

* [Languages](/p/rcdcap/analyses/latest/languages_summary)
* [Cost Estimates](/p/rcdcap/estimated_cost)
* [Security](/p/rcdcap/security)

#### SCM Data

* [Commits](/p/rcdcap/commits/summary)
* [Contributors](/p/rcdcap/contributors/summary)

#### Community Data

* [Users](/p/rcdcap/users)
* [Ratings & Reviews](/p/rcdcap/reviews/summary)
* [User & Contributor Locations](/p/rcdcap/map)

[![Open Hub](/assets/logo/BlackDuckLogo-6697adc63e07340464201a2ad534d3d3e44f95d36edda20b140440d34f05372f.svg)](/)

ABOUT BLACK DUCK

[Application Security Testing](https://www.blackduck.com/solutions/application-security-testing.html)

[Application Security Services](https://www.blackduck.com/services.html)

[AppSec Program Development](https://www.blackduck.com/services/security-program/strategy-planning.html)

[Training](https://www.blackduck.com/training.html)

ABOUT OPEN HUB

[Forums](https://community.blackduck.com/s/black-duck-open-hub)

[Terms](https://community.blackduck.com/s/article/Black-Duck-Open-Hub-Terms-of-Use)

[Privacy](https://community.blackduck.com/s/article/Black-Duck-Open-Hub-Open-Hub-Privacy-Policy)

[Open Hub UI Source Code](https://github.com/blackducksoftware/ohloh-ui)

[Contact Us](/cdn-cgi/l/email-protection#8fa9eee2ffb4acbebfbab4a9eee2ffb4acbebebfb4a9eee2ffb4acbebfbdb4a9eee2ffb4acbebebeb4a9eee2ffb4acbfb9bbb4a9eee2ffb4acbebebeb4a9eee2ffb4acbebebdb4a9eee2ffb4acbebfbeb4a9eee2ffb4acbebebfb4a9eee2ffb4acbebfbbb4a9eee2ffb4acbebeb8b4a9eee2ffb4acbfb6b7b4a9eee2ffb4acbfbbb9b4a9eee2ffb4acbebebfb4a9eee2ffb4acbebfbeb4a9eee2ffb4acbebeb9b4)

©
2025
[Black Duck Software, Inc.](http://www.blackduck.com)
All Rights Reserved.

This site uses cookies to give you the best possible experience.
By using the site, you consent to our use of cookies.
For more information, please see our
[Privacy Policy](https://community.blackduck.com/s/article/Black-Duck-Open-Hub-Open-Hub-Privacy-Policy)

Agree



=== Content from hg.code.sf.net_edec96ee_20250114_184135.html ===

[![mercurial](/static/hglogo.png)](https://www.mercurial-scm.org/)

* [log](/p/rcdcap/code/shortlog/0af05606c55b)
* [graph](/p/rcdcap/code/graph/0af05606c55b)
* [tags](/p/rcdcap/code/tags)
* [bookmarks](/p/rcdcap/code/bookmarks)
* [branches](/p/rcdcap/code/branches)

* changeset
* [raw](/p/rcdcap/code/raw-rev/0af05606c55b)
* [browse](/p/rcdcap/code/file/0af05606c55b)

* [help](/p/rcdcap/code/help)

## [Mercurial](/) > [p](/p) > [rcdcap](/p/rcdcap) > [code](/p/rcdcap/code)

### changeset 188:[0af05606c55b](/p/rcdcap/code/rev/0af05606c55b)

Find changesets by keywords (author, files, the commit message), revision
number or hash, or [revset expression](/p/rcdcap/code/help/revsets).

added bounds checks - should fix crashes

| author | bugtester@bugtester-VirtualBox |
| --- | --- |
| date | Sun, 13 Jun 2021 00:19:12 +0300 |
| parents | [bd547d5b0a3a](/p/rcdcap/code/rev/bd547d5b0a3a) |
| children | [5a68637237e3](/p/rcdcap/code/rev/5a68637237e3) |
| files | [source/include/rcdcap/memory.hh](/p/rcdcap/code/file/0af05606c55b/source/include/rcdcap/memory.hh) [source/src/erspan-processor.cc](/p/rcdcap/code/file/0af05606c55b/source/src/erspan-processor.cc) [source/src/hp-erm-processor.cc](/p/rcdcap/code/file/0af05606c55b/source/src/hp-erm-processor.cc) [source/tests/common-buffer-test.cc](/p/rcdcap/code/file/0af05606c55b/source/tests/common-buffer-test.cc) |
| diffstat | 4 files changed, 49 insertions(+), 19 deletions(-) [+] [-]  | [source/include/rcdcap/memory.hh](#l1.1) | 27 |  | | --- | --- | --- | | [source/src/erspan-processor.cc](#l2.1) | 14 |  | | [source/src/hp-erm-processor.cc](#l3.1) | 12 |  | | [source/tests/common-buffer-test.cc](#l4.1) | 15 |  | |

line wrap: on
 line diff
```

--- a/source/include/rcdcap/memory.hh	Sun May 24 12:25:57 2020 -0700
+++ b/source/include/rcdcap/memory.hh	Sun Jun 13 00:19:12 2021 +0300
@@ -19,6 +19,8 @@
 #define _RCDCAP_MEMORY_HH_

 #include <memory>
+#include <algorithm>
+#include <cassert>

 #ifdef _WIN32
 #   ifdef __MINGW32__
@@ -36,6 +38,21 @@

 namespace RCDCap
 {
+template<class InputIt, class OutputIt>
+OutputIt copy_checked(InputIt first, InputIt last, OutputIt d_first, size_t offset, size_t len)
+{
+    size_t dist = std::distance(first, last);
+    assert(dist <= len - offset);
+    return std::copy(first, last, d_first);
+}
+
+template<class InputIt, class OutputIt>
+OutputIt copy_n_checked(InputIt first, size_t dist, OutputIt d_first, size_t offset, size_t len)
+{
+    assert(dist <= len - offset);
+    return std::copy_n(first, dist, d_first);
+}
+
 //! Returns next multiple of base.
 inline size_t round(size_t n, size_t base)
 {
@@ -78,11 +95,11 @@
     }
 };

-template<typename T, typename... TArgs>
-inline std::unique_ptr<T> make_unique(TArgs&&... args)
-{
-    return std::unique_ptr<T>(new T(std::forward<TArgs>(args)...));
-}
+template<typename T, typename... TArgs>
+inline std::unique_ptr<T> make_unique(TArgs&&... args)
+{
+    return std::unique_ptr<T>(new T(std::forward<TArgs>(args)...));
+}
 }

 #endif /* _RCDCAP_MEMORY_HH_ */
\ No newline at end of file
```
```

--- a/source/src/erspan-processor.cc	Sun May 24 12:25:57 2020 -0700
+++ b/source/src/erspan-processor.cc	Sun Jun 13 00:19:12 2021 +0300
@@ -86,9 +86,17 @@
         offset += sizeof(ERSPANHeader);
         if(m_VLANEnabled)
         {
-            std::copy_n(&packet[offset], MACHeader802_1Q::getVLANTagOffset(), packet);
-            std::copy(&packet[offset + MACHeader802_1Q::getVLANTagOffset()],
-                    &packet[caplen], &packet[MACHeader802_1Q::getVLANTagOffset()+MACHeader802_1Q::getVLANTagSize()]);
+            // Thanks to Kasif Dekel and Ronen Shustin
+            if(caplen < offset + MACHeader802_1Q::getVLANTagOffset() ||
+               offset < MACHeader802_1Q::getVLANTagSize() ||
+               caplen < sizeof(MACHeader802_1Q))
+                return;
+            // caplen - offset - MACHeader802_1Q::getVLANTagOffset() >
+            //   caplen - MACHeader802_1Q::getVLANTagOffset() - MACHeader802_1Q::getVLANTagSize()
+
+            copy_n_checked(&packet[offset], MACHeader802_1Q::getVLANTagOffset(), packet, 0, caplen);
+            copy_checked(&packet[offset + MACHeader802_1Q::getVLANTagOffset()],
+                         &packet[caplen], packet, MACHeader802_1Q::getVLANTagOffset()+MACHeader802_1Q::getVLANTagSize(), caplen);
             auto& eth_header = *reinterpret_cast<MACHeader802_1Q*>(packet);
             eth_header.setVLANTPID();
             eth_header.setVLANPriority(priority);
```
```

--- a/source/src/hp-erm-processor.cc	Sun May 24 12:25:57 2020 -0700
+++ b/source/src/hp-erm-processor.cc	Sun Jun 13 00:19:12 2021 +0300
@@ -92,9 +92,15 @@
     assert((int)offset >= 0);
     if(m_VLANEnabled)
     {
-        std::copy_n(&packet[offset], MACHeader802_1Q::getVLANTagOffset(), packet);
-        std::copy(&packet[offset + MACHeader802_1Q::getVLANTagOffset()],
-                  &packet[caplen], &packet[MACHeader802_1Q::getVLANTagOffset()+MACHeader802_1Q::getVLANTagSize()]);
+        // Thanks to Kasif Dekel and Ronen Shustin
+        if(caplen < offset + MACHeader802_1Q::getVLANTagOffset() ||
+           offset < MACHeader802_1Q::getVLANTagSize() ||
+           caplen < sizeof(MACHeader802_1Q))
+            return;
+
+        copy_n_checked(&packet[offset], MACHeader802_1Q::getVLANTagOffset(), packet, 0, caplen);
+        copy_checked(&packet[offset + MACHeader802_1Q::getVLANTagOffset()],
+                     &packet[caplen], packet, MACHeader802_1Q::getVLANTagOffset() + MACHeader802_1Q::getVLANTagSize(), caplen);
         auto& eth_header = *reinterpret_cast<MACHeader802_1Q*>(packet);
         eth_header.setVLANTPID();
         eth_header.setVLANPriority(priority);
```
```

--- a/source/tests/common-buffer-test.cc	Sun May 24 12:25:57 2020 -0700
+++ b/source/tests/common-buffer-test.cc	Sun Jun 13 00:19:12 2021 +0300
@@ -62,16 +62,16 @@

     std::random_device r;
     std::default_random_engine engine(r());
-    std::uniform_int<int> distro(0, 1);
-    std::uniform_int<int> caplen_distro(4, 9000);
-    std::uniform_int<size_t> burst_size_distro(1, 100);
+    std::uniform_int_distribution<int> distro(0, 1);
+    std::uniform_int_distribution<int> caplen_distro(4, 9000);
+    std::uniform_int_distribution<size_t> burst_size_distro(1, 100);

     size_t burst_size = burst_size_distro(engine);
     RCDCap::PacketInfo* first_packet = nullptr;
     for(size_t idx = 0, burst_idx = 0; idx < m_TotalPackets; idx++)
     {
         size_t offset = 0;
-        auto& mac_header = reinterpret_cast<RCDCap::MACHeader&>(packet_assembly[offset]);
+        //auto& mac_header = reinterpret_cast<RCDCap::MACHeader&>(packet_assembly[offset]);
         offset += sizeof(RCDCap::MACHeader);
         auto& ip_header = reinterpret_cast<RCDCap::IPv4Header&>(packet_assembly[offset]);
         ip_header.setIHL(sizeof(RCDCap::IPv4Header)/4);
@@ -150,11 +150,10 @@
     auto processor = boost::make_shared<RCDCap::ERSPANProcessor>(io_service, src->getBuffer(), true);
     src->attach(processor);

-    RCDCap::uint32 ip = 0;
     auto sink = boost::make_shared<RCDCap::DiscardSink>(io_service, *src);
     processor->attach(sink);

-    auto worker_count = boost::thread::hardware_concurrency();
+    size_t worker_count = boost::thread::hardware_concurrency();
     std::unique_ptr<boost::thread[]> workers(new boost::thread[worker_count]);
     {
     boost::asio::io_service::work work(io_service);
@@ -163,12 +162,12 @@
         ++i)
     {
         workers[i] = boost::thread(boost::bind(&boost::asio::io_service::run, &io_service));
-        auto hnd = workers[i].native_handle();
+        //auto hnd = workers[i].native_handle();
     }

     src->start();
     }
-    for (auto i = 0; i < worker_count; ++i)
+    for (size_t i = 0; i < worker_count; ++i)
         workers[i].join();
 }

```


