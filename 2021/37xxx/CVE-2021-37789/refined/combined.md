=== Content from github.com_cd0c39a2_20250114_201216.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnothings%2Fstb%2Fissues%2F1178)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnothings%2Fstb%2Fissues%2F1178)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nothings%2Fstb)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nothings](/nothings)
/
**[stb](/nothings/stb)**
Public

* [Notifications](/login?return_to=%2Fnothings%2Fstb) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fnothings%2Fstb)
* [Star
   27.6k](/login?return_to=%2Fnothings%2Fstb)

* [Code](/nothings/stb)
* [Issues
  159](/nothings/stb/issues)
* [Pull requests
  131](/nothings/stb/pulls)
* [Discussions](/nothings/stb/discussions)
* [Actions](/nothings/stb/actions)
* [Projects
  0](/nothings/stb/projects)
* [Security](/nothings/stb/security)
* [Insights](/nothings/stb/pulse)

Additional navigation options

* [Code](/nothings/stb)
* [Issues](/nothings/stb/issues)
* [Pull requests](/nothings/stb/pulls)
* [Discussions](/nothings/stb/discussions)
* [Actions](/nothings/stb/actions)
* [Projects](/nothings/stb/projects)
* [Security](/nothings/stb/security)
* [Insights](/nothings/stb/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnothings%2Fstb%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnothings%2Fstb%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# heap-buffer-overflow in stbi\_\_jpeg\_load #1178

Closed

[bufanremi](/bufanremi) opened this issue
Jul 22, 2021
· 2 comments

Closed

# [heap-buffer-overflow in stbi\_\_jpeg\_load](#top) #1178

[bufanremi](/bufanremi) opened this issue
Jul 22, 2021
· 2 comments

Labels
[1 stb\_image](/nothings/stb/labels/1%20stb_image)
[2 bug w/ repro](/nothings/stb/labels/2%20bug%20w/%20repro)
[5 merged-dev](/nothings/stb/labels/5%20merged-dev)
Merged into development branch

## Comments

[![@bufanremi](https://avatars.githubusercontent.com/u/87419707?s=80&v=4)](/bufanremi)

Copy link

### **[bufanremi](/bufanremi)** commented [Jul 22, 2021](#issue-950573228)

| [poc.zip](https://github.com/nothings/stb/files/6861922/poc.zip) I find heap-buffer-overflow in stbi\_\_jpeg\_load with lastest version: 2.27 `clang test.cpp -fsanitize=address -o test`  `./test poc.jpg`  ASAN log:  ``` ==11092==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62e00000b98f at pc 0x00000051515b bp 0x7ffe7ac04ea0 sp 0x7ffe7ac04e98 READ of size 1 at 0x62e00000b98f thread T0     #0 0x51515a in stbi__resample_row_v_2(unsigned char*, unsigned char*, unsigned char*, int, int) (/home/test/stb/test+0x51515a)     #1 0x511a00 in load_jpeg_image(stbi__jpeg*, int*, int*, int*, int) (/home/test/stb/test+0x511a00)     #2 0x4e9039 in stbi__jpeg_load(stbi__context*, int*, int*, int*, int, stbi__result_info*) (/home/test/stb/test+0x4e9039)     #3 0x4e294f in stbi__load_main(stbi__context*, int*, int*, int*, int, stbi__result_info*, int) (/home/test/stb/test+0x4e294f)     #4 0x4d59fb in stbi__load_and_postprocess_8bit(stbi__context*, int*, int*, int*, int) (/home/test/stb/test+0x4d59fb)     #5 0x4d5744 in stbi_load_from_file (/home/test/stb/test+0x4d5744)     #6 0x4d5540 in stbi_load (/home/test/stb/test+0x4d5540)     #7 0x4dbcc8 in main (/home/test/stb/test+0x4dbcc8)     #8 0x7f9947da3bf6 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310     #9 0x41b669 in _start (/home/test/stb/test+0x41b669)  0x62e00000b98f is located 0 bytes to the right of 46479-byte region [0x62e000000400,0x62e00000b98f) allocated by thread T0 here:     #0 0x4966ad in malloc /local/mnt/workspace/bcain_clang_vm-bcain-aus_3184/final/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3     #1 0x4d9c44 in stbi__malloc(unsigned long) (/home/test/stb/test+0x4d9c44)     #2 0x4fbe26 in stbi__malloc_mad2(int, int, int) (/home/test/stb/test+0x4fbe26)     #3 0x50ecd5 in stbi__process_frame_header(stbi__jpeg*, int) (/home/test/stb/test+0x50ecd5)     #4 0x503133 in stbi__decode_jpeg_header(stbi__jpeg*, int) (/home/test/stb/test+0x503133)     #5 0x514b69 in stbi__decode_jpeg_image(stbi__jpeg*) (/home/test/stb/test+0x514b69)     #6 0x5101a8 in load_jpeg_image(stbi__jpeg*, int*, int*, int*, int) (/home/test/stb/test+0x5101a8)     #7 0x4e9039 in stbi__jpeg_load(stbi__context*, int*, int*, int*, int, stbi__result_info*) (/home/test/stb/test+0x4e9039)     #8 0x4e294f in stbi__load_main(stbi__context*, int*, int*, int*, int, stbi__result_info*, int) (/home/test/stb/test+0x4e294f)     #9 0x4d59fb in stbi__load_and_postprocess_8bit(stbi__context*, int*, int*, int*, int) (/home/test/stb/test+0x4d59fb)     #10 0x4d5744 in stbi_load_from_file (/home/test/stb/test+0x4d5744)     #11 0x4d5540 in stbi_load (/home/test/stb/test+0x4d5540)     #12 0x4dbcc8 in main (/home/test/stb/test+0x4dbcc8)     #13 0x7f9947da3bf6 in __libc_start_main /build/glibc-S9d2JN/glibc-2.27/csu/../csu/libc-start.c:310  SUMMARY: AddressSanitizer: heap-buffer-overflow (/home/test/stb/test+0x51515a) in stbi__resample_row_v_2(unsigned char*, unsigned char*, unsigned char*, int, int) Shadow bytes around the buggy address:   0x0c5c7fff96e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff96f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff9700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff9710: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c5c7fff9720: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c5c7fff9730: 00[07]fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9740: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9750: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9760: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9770: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c5c7fff9780: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==11092==ABORTING  ```  Analyze this bug: In stbi\_imgae.h version less than 2.27, the function load\_jpeg\_image will calculate the w\_lores, and image\_x, and in function stbi\_\_process\_frame\_header, the will clac z->img\_comp[i].w2, In some special h and v values, w\_lores is not equal to z->img\_comp[k].w2, and load\_jpeg\_image will call r->resample to copy w\_lores size , So it leads to oob read |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)
[rygorous](/rygorous)
added
[1 stb\_image](/nothings/stb/labels/1%20stb_image)
[2 bug w/ repro](/nothings/stb/labels/2%20bug%20w/%20repro)
labels
[Jul 25, 2021](#event-5064532393)

[rygorous](/rygorous)
added a commit
that referenced
this issue
[Jul 26, 2021](#ref-commit-5ba0baa)
[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)

`[stb_image: Reject fractional JPEG component subsampling ratios](/nothings/stb/commit/5ba0baaa269b3fd681828e0e3b3ac0f1472eaf40 "stb_image: Reject fractional JPEG component subsampling ratios

The component resamplers are not written to support this and I've
never seen it happen in a real (non-crafted) JPEG file so I'm
fine rejecting this as outright corrupt.

Fixes issue #1178.")`
…

`[5ba0baa](/nothings/stb/commit/5ba0baaa269b3fd681828e0e3b3ac0f1472eaf40)`

```
The component resamplers are not written to support this and I've
never seen it happen in a real (non-crafted) JPEG file so I'm
fine rejecting this as outright corrupt.

Fixes issue [#1178](https://github.com/nothings/stb/issues/1178).
```

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=80&v=4)](/rygorous)

Copy link

Collaborator

### **[rygorous](/rygorous)** commented [Jul 26, 2021](#issuecomment-886346284)

| Thanks for the repro, fix for this issue is pushed to the dev branch and will be in the next release.  The underlying problem here is that the resampling code assumes that the plane resampling factors are integer factors (i.e. planes need to be upscaled by 2x, 3x or similar) and in this case the ratio works out to 1.5x; the calculation in `stbi__process_frame_header` calculates component sizes from the correct underlying ratios, whereas the actual resampling code computes an integer sampling ratio (rounding down) which yields different results.  All real JPEGs I've ever encountered have integer subsampling factors, so I just changed `stbi__process_frame_header` to check that the ratios indeed work out to integers and report the file as corrupt when they are not. It would not be hard to fix the calculation of `w_lores` but the resampler would then still be computing garbage because it's using an incorrect integer approximation to the actual subsampling factor, and making the resampler aware of arbitrary ratios would add a fair amount of complexity to support a feature that is very unlikely to ever occur outside of crafted/malicious files. |
| --- |

All reactions

Sorry, something went wrong.

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)
[rygorous](/rygorous)
added
the
[5 merged-dev](/nothings/stb/labels/5%20merged-dev)
Merged into development branch
label
[Jul 26, 2021](#event-5065881033)

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)
[rygorous](/rygorous)
mentioned this issue
[Dec 25, 2022](#ref-issue-1510340369)

[stb\_image.h security issue : heap-based buffer over-read in stbi\_\_tga\_load
#1424](/nothings/stb/issues/1424)

Closed

[rygorous](/rygorous)
added a commit
that referenced
this issue
[Jan 22, 2023](#ref-commit-94be770)
[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)

`[stb_image: Reject fractional JPEG component subsampling ratios](/nothings/stb/commit/94be770ef6d5e1091290e3af217a0fbd1ef1172e "stb_image: Reject fractional JPEG component subsampling ratios

The component resamplers are not written to support this and I've
never seen it happen in a real (non-crafted) JPEG file so I'm
fine rejecting this as outright corrupt.

Fixes issue #1178.")`
…

`[94be770](/nothings/stb/commit/94be770ef6d5e1091290e3af217a0fbd1ef1172e)`

```
The component resamplers are not written to support this and I've
never seen it happen in a real (non-crafted) JPEG file so I'm
fine rejecting this as outright corrupt.

Fixes issue [#1178](https://github.com/nothings/stb/issues/1178).
```

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=80&v=4)](/rygorous)

Copy link

Collaborator

### **[rygorous](/rygorous)** commented [Jan 22, 2023](#issuecomment-1399633492)

| Fix was merged into master on Aug 13, 2021 and this bug wasn't closed, but it's fixed. |
| --- |

All reactions

Sorry, something went wrong.

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=40&v=4)](/rygorous)
[rygorous](/rygorous)
closed this as [completed](/nothings/stb/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jan 22, 2023](#event-8329748281)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnothings%2Fstb%2Fissues%2F1178)

Assignees

No one assigned

Labels

[1 stb\_image](/nothings/stb/labels/1%20stb_image)
[2 bug w/ repro](/nothings/stb/labels/2%20bug%20w/%20repro)
[5 merged-dev](/nothings/stb/labels/5%20merged-dev)
Merged into development branch

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@rygorous](https://avatars.githubusercontent.com/u/1077496?s=52&v=4)](/rygorous) [![@bufanremi](https://avatars.githubusercontent.com/u/87419707?s=52&v=4)](/bufanremi)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_52dd273e_20250114_201216.html ===


---

[[Date Prev](msg00044.html)][Date Next]
[[Thread Prev](msg00044.html)][Thread Next]
[[Date Index](maillist.html#00045)]
[[Thread Index](threads.html#00045)]

# [SECURITY] [DLA 3305-1] libstb security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3305-1] libstb security update
* *From*: Adrian Bunk <bunk@debian.org>
* *Date*: Tue, 31 Jan 2023 23:59:46 +0200
* *Message-id*: <[[🔎]](/msgid-search/Y9mPUqrtHDf4WpP0%40localhost) [Y9mPUqrtHDf4WpP0@localhost](msg00045.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3305-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>        Adrian Bunk <bunk@debian.org>
January 31, 2023                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : libstb
Version        : 0.0~git20180212.15.e6afb9c-1+deb10u1
CVE ID         : CVE-2018-16981 CVE-2019-13217 CVE-2019-13218 CVE-2019-13219
                 CVE-2019-13220 CVE-2019-13221 CVE-2019-13222 CVE-2019-13223
                 CVE-2021-28021 CVE-2021-37789 CVE-2021-42715 CVE-2022-28041
                 CVE-2022-28042
Debian Bug     : 934966 1014530 1023693 1014531 1014532

Several vulnerabilities have been fixed in the libstb library.

CVE-2018-16981

    Heap-based buffer overflow in stbi__out_gif_code().

CVE-2019-13217

    Heap buffer overflow in the Vorbis start_decoder().

CVE-2019-13218

    Division by zero in the Vorbis predict_point().

CVE-2019-13219

    NULL pointer dereference in the Vorbis get_window().

CVE-2019-13220

    Uninitialized stack variables in the Vorbis start_decoder().

CVE-2019-13221

    Buffer overflow in the Vorbis compute_codewords().

CVE-2019-13222

    Out-of-bounds read of a global buffer in the Vorbis draw_line().

CVE-2019-13223

    Reachable assertion in the Vorbis lookup1_values().

CVE-2021-28021

    Buffer overflow in stbi__extend_receive().

CVE-2021-37789

    Heap-based buffer overflow in stbi__jpeg_load().

CVE-2021-42715

    The HDR loader parsed truncated end-of-file RLE scanlines as an
    infinite sequence of zero-length runs.

CVE-2022-28041

    Integer overflow in stbi__jpeg_decode_block_prog_dc().

CVE-2022-28042

    Heap-based use-after-free in stbi__jpeg_huff_decode().

For Debian 10 buster, these problems have been fixed in version
0.0~git20180212.15.e6afb9c-1+deb10u1.

We recommend that you upgrade your libstb packages.

For the detailed security status of libstb please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/libstb>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEOvp1f6xuoR0v9F3wiNJCh6LYmLEFAmPZj1IACgkQiNJCh6LY
mLH+lA/8DtWLi71FsiGFnOVokrZsHnR8eVDQiK5ldjmLgiynRzEeZfNMwYjG86xH
hsmk6SVeFI8CEKeXzJq36BOcP2VCpq/lR4WYfPkl7U2txnheTQTUjIn7mXG4GQOB
M5XtW2EZTKyh5E/ei51cVRQBOCssKMPGpV1VkPSA1DmWZjPN9c0OOJEwsJzq3tHZ
2HqtNzyzFruk8oHDRfATJCko1N+6LtKVMEu8sgJTrwVNSetY2YjBikoJP4BvCxFb
gHB90EBh7ezvvgCQ2152YRtTTuLcK0C1cUgVu+47JRPVBkciVj49hHN6QgoHZPpa
EvJr7tFKkAW9oKVF2N8bM+NH4GIRtNpwpWXCiQn7TXLXEPAtJzr2HE7TLX4hQcry
i04SfrPXiTlvHjNXx7h81B5q7ZmWncNsIXAr9f2nmrEMP8s4zUtujJ3d7qs94bFp
Rf09VPlWfw/ZVBMvSd3xz8u/igKvKC1GlVz8nrcRdWYeyUWSIKSnJP/f4coTPmXI
6zweAyWRVYQgh7Em7fKXRw1Q9w8JqBMPVXRqfRMjodgKG3gKA2OafIgMOhERr0CQ
aiVj0v4Ln9guDTkJpfSI4nmfmU6EGldfE5K7SMB8NrExWiebjN3y5JBM7hzB3aKe
4TKx3dppa0hHd5e4jdlY/AepKtjSBgWgSc38OqA8C1/fGk1qNzc=
=Qh3l
-----END PGP SIGNATURE-----

```

---


