=== Content from github.com_e8da3fa9_20250115_222940.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fsecurity%2Fadvisories%2FGHSA-q5vh-6whw-x745)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fsecurity%2Fadvisories%2FGHSA-q5vh-6whw-x745)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=microsoft%2Fonefuzz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 1, 2023. It is now read-only.

[microsoft](/microsoft)
/
**[onefuzz](/microsoft/onefuzz)**
Public archive

* [Notifications](/login?return_to=%2Fmicrosoft%2Fonefuzz) You must be signed in to change notification settings
* [Fork
  198](/login?return_to=%2Fmicrosoft%2Fonefuzz)
* [Star
   2.8k](/login?return_to=%2Fmicrosoft%2Fonefuzz)

* [Code](/microsoft/onefuzz)
* [Issues
  192](/microsoft/onefuzz/issues)
* [Pull requests
  41](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects
  0](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

Additional navigation options

* [Code](/microsoft/onefuzz)
* [Issues](/microsoft/onefuzz/issues)
* [Pull requests](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

# Incomplete authorization in multi-tenant deployments

Critical

[bmc-msft](/bmc-msft)
published
GHSA-q5vh-6whw-x745
Aug 13, 2021

## Package

pip

onefuzz
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

> 2.12.0

## Patched versions

2.31.0

## Description

## Impact

Starting with OneFuzz 2.12.0 or greater, an incomplete authorization check allows an authenticated user from any Azure Active Directory tenant to make authorized API calls to a vulnerable OneFuzz instance.

To be vulnerable, a OneFuzz deployment must be:

* Version 2.12.0 or greater
* Deployed with the non-default [`--multi_tenant_domain`](https://github.com/microsoft/onefuzz/blob/2.30.0/src/deployment/deploy.py#L1021) option

This can result in read/write access to private data such as:

* Software vulnerability and crash information
* Security testing tools
* Proprietary code and symbols

Via authorized API calls, this also enables tampering with existing data and unauthorized code execution on Azure compute resources.

## Patches

This issue is resolved starting in release 2.31.0, via the addition of application-level check of the bearer token's `issuer` against an administrator-configured allowlist.

## Workarounds

Users can restrict access to the tenant of a deployed OneFuzz instance < 2.31.0 by redeploying in the default configuration, which omits the `--multi_tenant_domain` option.

## References

You can find an overview of the Microsoft Identity Platform [here](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview). This vulnerability applies to the multi-tenant application pattern, as described [here](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant).

## For more information

If you have any questions or comments about this advisory:

* Open an issue in [OneFuzz](https://github.com/microsoft/onefuzz)
* Email us at fuzzing@microsoft.com

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:L

### CVE ID

CVE-2021-37705

### Weaknesses

[CWE-285](/advisories?query=cwe%3A285) [CWE-346](/advisories?query=cwe%3A346)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_86a3f11f_20250115_222943.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1124)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1124)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=microsoft%2Fonefuzz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 1, 2023. It is now read-only.

[microsoft](/microsoft)
/
**[onefuzz](/microsoft/onefuzz)**
Public archive

* [Notifications](/login?return_to=%2Fmicrosoft%2Fonefuzz) You must be signed in to change notification settings
* [Fork
  198](/login?return_to=%2Fmicrosoft%2Fonefuzz)
* [Star
   2.8k](/login?return_to=%2Fmicrosoft%2Fonefuzz)

* [Code](/microsoft/onefuzz)
* [Issues
  192](/microsoft/onefuzz/issues)
* [Pull requests
  41](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects
  0](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

Additional navigation options

* [Code](/microsoft/onefuzz)
* [Issues](/microsoft/onefuzz/issues)
* [Pull requests](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

# update memoization to 0.4.0 #1124

 Merged

1 commit merged into
[microsoft:main](/microsoft/onefuzz/tree/main "microsoft/onefuzz:main")
from
[bmc-msft:update-python-memoization-0.4.0](/bmc-msft/onefuzz/tree/update-python-memoization-0.4.0 "bmc-msft/onefuzz:update-python-memoization-0.4.0")

Aug 5, 2021

 Merged

# [update memoization to 0.4.0](#top) #1124

1 commit merged into
[microsoft:main](/microsoft/onefuzz/tree/main "microsoft/onefuzz:main")
from
[bmc-msft:update-python-memoization-0.4.0](/bmc-msft/onefuzz/tree/update-python-memoization-0.4.0 "bmc-msft/onefuzz:update-python-memoization-0.4.0")

Aug 5, 2021

[Conversation
1](/microsoft/onefuzz/pull/1124)
[Commits
1](/microsoft/onefuzz/pull/1124/commits)
[Checks
0](/microsoft/onefuzz/pull/1124/checks)
[Files changed](/microsoft/onefuzz/pull/1124/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=60&v=4)](/bmc-msft)

Copy link

Contributor

### @bmc-msft **[bmc-msft](/bmc-msft)** commented [Aug 2, 2021](#issue-958565347)

This primarily meant to enable addressing a warning for caching functions without arguments.

<https://github.com/lonelyenvoy/python-memoization/releases/tag/v0.4.0>

Sorry, something went wrong.

All reactions

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[update memoization to 0.4.0](/microsoft/onefuzz/pull/1124/commits/69478deab2304fc44ce776b947e232b4c4e69dbd "update memoization to 0.4.0")`

`[69478de](/microsoft/onefuzz/pull/1124/commits/69478deab2304fc44ce776b947e232b4c4e69dbd)`

[![chkeita](https://avatars.githubusercontent.com/u/244326?s=60&v=4)](/chkeita)

**[chkeita](/chkeita)**
approved these changes
[Aug 2, 2021](#pullrequestreview-720651639)

 [View reviewed changes](/microsoft/onefuzz/pull/1124/files/69478deab2304fc44ce776b947e232b4c4e69dbd)

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=40&u=cc2ea45e2472e87dcbe9f6ab319c3b0fc067361e&v=4)](/bmc-msft)
[bmc-msft](/bmc-msft)
added
[auto-merge](/microsoft/onefuzz/labels/auto-merge)
[passed-integration-tests](/microsoft/onefuzz/labels/passed-integration-tests)
labels
[Aug 5, 2021](#event-5118336757)

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

### **[ghost](/ghost)** commented [Aug 5, 2021](#issuecomment-893566022)

| Hello [@bmc-msft](https://github.com/bmc-msft)!  Because this pull request has the `auto-merge` label, I will be glad to assist with helping to merge this pull request once all check-in policies pass. p.s. you can customize the way I help with merging this pull request, such as holding this pull request until a specific person approves. Simply @mention me (`@msftbot`) and give me an instruction to get started! Learn more [here](https://github.com/microsoft/fluentui/wiki/Advanced-auto-merge). |
| --- |

All reactions

Sorry, something went wrong.

![@ghost](https://avatars.githubusercontent.com/u/10137?s=40&v=4)
**ghost**
merged commit [`5efc676`](/microsoft/onefuzz/commit/5efc676f9aa88143d6e8647e79d9140184e4ccd6)
into
microsoft:main

[Aug 5, 2021](https://github.com/microsoft/onefuzz/pull/1124#event-5118339039)

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
locked as **resolved** and limited conversation to collaborators
[Sep 8, 2021](#event-5268588804)

This pull request was **closed**.

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1124).

Reviewers

[![@chkeita](https://avatars.githubusercontent.com/u/244326?s=40&v=4)](/chkeita) [chkeita](/chkeita)

chkeita approved these changes

Assignees

No one assigned

Labels

[auto-merge](/microsoft/onefuzz/labels/auto-merge)
[passed-integration-tests](/microsoft/onefuzz/labels/passed-integration-tests)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=52&v=4)](/bmc-msft) [![@chkeita](https://avatars.githubusercontent.com/u/244326?s=52&v=4)](/chkeita) [![@demoray](https://avatars.githubusercontent.com/u/47821?s=52&v=4)](/demoray)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8e7e4968_20250115_093254.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Freleases%2Ftag%2F2.31.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Freleases%2Ftag%2F2.31.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=microsoft%2Fonefuzz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 1, 2023. It is now read-only.

[microsoft](/microsoft)
/
**[onefuzz](/microsoft/onefuzz)**
Public archive

* [Notifications](/login?return_to=%2Fmicrosoft%2Fonefuzz) You must be signed in to change notification settings
* [Fork
  198](/login?return_to=%2Fmicrosoft%2Fonefuzz)
* [Star
   2.8k](/login?return_to=%2Fmicrosoft%2Fonefuzz)

* [Code](/microsoft/onefuzz/tree/2.31.0)
* [Issues
  192](/microsoft/onefuzz/issues)
* [Pull requests
  41](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects
  0](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

Additional navigation options

* [Code](/microsoft/onefuzz/tree/2.31.0)
* [Issues](/microsoft/onefuzz/issues)
* [Pull requests](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

1. [Releases](/microsoft/onefuzz/releases)
2. [2.31.0](/microsoft/onefuzz/releases/tag/2.31.0)

# 2.31.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/microsoft/onefuzz/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...2.31.0)

 Loading

[View all tags](/microsoft/onefuzz/tags)

![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=40&v=4)
[bmc-msft](/bmc-msft)
released this
13 Aug 19:27

·
[1338 commits](/microsoft/onefuzz/compare/2.31.0...main)
to main
since this release

[2.31.0](/microsoft/onefuzz/tree/2.31.0)

[`a77f81f`](/microsoft/onefuzz/commit/a77f81f1c7409aeb627265417fafa9da9e64bb7d)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

### Added

* Supervisor: Added recording of STDOUT and STDERR of the supervisor to file. [#1109](https://github.com/microsoft/onefuzz/pull/1109)
* CLI/Service/Agent: Supervisor tasks can now optionally have a managed coverage container. [#1123](https://github.com/microsoft/onefuzz/pull/1123)

### Changed

* Agent/Supervisor/Proxy: Updated multiple third-party Rust dependencies. [#1151](https://github.com/microsoft/onefuzz/pull/1151), [#1149](https://github.com/microsoft/onefuzz/pull/1149), [#1145](https://github.com/microsoft/onefuzz/pull/1145), [#1134](https://github.com/microsoft/onefuzz/pull/1134), [#1135](https://github.com/microsoft/onefuzz/pull/1135), [#1137](https://github.com/microsoft/onefuzz/pull/1137), [#1133](https://github.com/microsoft/onefuzz/pull/1133), [#1138](https://github.com/microsoft/onefuzz/pull/1138), [#1132](https://github.com/microsoft/onefuzz/pull/1132), [#1140](https://github.com/microsoft/onefuzz/pull/1140),
* Service: Enabled testing of the Azure Devops work item rendering. [#1144](https://github.com/microsoft/onefuzz/pull/1144)
* Agent: Continued development related to upcoming features. [#1142](https://github.com/microsoft/onefuzz/pull/1142)
* CLI: No longer retry service API requests that fail with service-level errors. [#1129](https://github.com/microsoft/onefuzz/pull/1129)
* Agent/Supervisor/Proxy: Addressed multiple new `cargo-clippy` warnings. [#1125](https://github.com/microsoft/onefuzz/pull/1125)
* CLI/Service: Updated third-party Python dependencies. [#1124](https://github.com/microsoft/onefuzz/pull/1124)

### Fixed

* Service: Fixed an issue with incomplete authorization in multi-tenant deployments. [CVE-2021-37705](https://github.com/microsoft/onefuzz/security/advisories/GHSA-q5vh-6whw-x745) [#1153](https://github.com/microsoft/onefuzz/pull/1153)

 Assets
8

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from pypi.org_322ec8fe_20250115_093255.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn’t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from github.com_ac18624f_20250115_222942.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1153)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1153)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=microsoft%2Fonefuzz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 1, 2023. It is now read-only.

[microsoft](/microsoft)
/
**[onefuzz](/microsoft/onefuzz)**
Public archive

* [Notifications](/login?return_to=%2Fmicrosoft%2Fonefuzz) You must be signed in to change notification settings
* [Fork
  198](/login?return_to=%2Fmicrosoft%2Fonefuzz)
* [Star
   2.8k](/login?return_to=%2Fmicrosoft%2Fonefuzz)

* [Code](/microsoft/onefuzz)
* [Issues
  192](/microsoft/onefuzz/issues)
* [Pull requests
  41](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects
  0](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

Additional navigation options

* [Code](/microsoft/onefuzz)
* [Issues](/microsoft/onefuzz/issues)
* [Pull requests](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

# Fixed an issue with incomplete authorization in multi-tenant deployments #1153

 Closed

[bmc-msft](/bmc-msft)
wants to merge
9
commits into
[microsoft:main](/microsoft/onefuzz/tree/main "microsoft/onefuzz:main")
from
[bmc-msft:verify-aad-tenants](/bmc-msft/onefuzz/tree/verify-aad-tenants "bmc-msft/onefuzz:verify-aad-tenants")

 Closed

# [Fixed an issue with incomplete authorization in multi-tenant deployments](#top) #1153

[bmc-msft](/bmc-msft)
wants to merge
9
commits into
[microsoft:main](/microsoft/onefuzz/tree/main "microsoft/onefuzz:main")
from
[bmc-msft:verify-aad-tenants](/bmc-msft/onefuzz/tree/verify-aad-tenants "bmc-msft/onefuzz:verify-aad-tenants")

[Conversation
0](/microsoft/onefuzz/pull/1153)
[Commits
9](/microsoft/onefuzz/pull/1153/commits)
[Checks
0](/microsoft/onefuzz/pull/1153/checks)
[Files changed](/microsoft/onefuzz/pull/1153/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=60&v=4)](/bmc-msft)

Copy link

Contributor

### @bmc-msft **[bmc-msft](/bmc-msft)** commented [Aug 13, 2021](#issue-970629157)

 *No description provided.*

Sorry, something went wrong.

All reactions

 [demoray](/demoray)
added 8 commits
[August 10, 2021 14:20](#commits-pushed-7c4f626)

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[verify aad tenants, primarily needed in multi-tenant deployments](/microsoft/onefuzz/pull/1153/commits/7c4f6262a4856406761fad0f7a0050e5300a39b9 "verify aad tenants, primarily needed in multi-tenant deployments")`

`[7c4f626](/microsoft/onefuzz/pull/1153/commits/7c4f6262a4856406761fad0f7a0050e5300a39b9)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[add logging and fix trailing slash for issuer](/microsoft/onefuzz/pull/1153/commits/dd74d284cf0146f283b2edd80cba25c877ad31b8 "add logging and fix trailing slash for issuer")`

`[dd74d28](/microsoft/onefuzz/pull/1153/commits/dd74d284cf0146f283b2edd80cba25c877ad31b8)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[handle call_if* not supporting additional argument callbacks](/microsoft/onefuzz/pull/1153/commits/203d48dca08f09c18b25d8b2ead8780235b32b52 "handle call_if* not supporting additional argument callbacks")`

`[203d48d](/microsoft/onefuzz/pull/1153/commits/203d48dca08f09c18b25d8b2ead8780235b32b52)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[add logging](/microsoft/onefuzz/pull/1153/commits/354b9667721d4444f3dfd79f20b55a2fb6b1311e "add logging")`

`[354b966](/microsoft/onefuzz/pull/1153/commits/354b9667721d4444f3dfd79f20b55a2fb6b1311e)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[Merge branch 'main' into verify-aad-tenants](/microsoft/onefuzz/pull/1153/commits/c6e211f980731922f07c432e35b172bcac4b65bd "Merge branch 'main' into verify-aad-tenants")`

`[c6e211f](/microsoft/onefuzz/pull/1153/commits/c6e211f980731922f07c432e35b172bcac4b65bd)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[include new datatype in webhook docs](/microsoft/onefuzz/pull/1153/commits/bd4248b2b75dc0c1dce2327e90728d9b135984f5 "include new datatype in webhook docs")`

`[bd4248b](/microsoft/onefuzz/pull/1153/commits/bd4248b2b75dc0c1dce2327e90728d9b135984f5)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[Merge branch 'main' into verify-aad-tenants](/microsoft/onefuzz/pull/1153/commits/f8bcbfd77c79fa9bb1caccca80473a38b3721eb9 "Merge branch 'main' into verify-aad-tenants")`

`[f8bcbfd](/microsoft/onefuzz/pull/1153/commits/f8bcbfd77c79fa9bb1caccca80473a38b3721eb9)`

[![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

`[fix pytypes unit tests](/microsoft/onefuzz/pull/1153/commits/776c0f2be48b1d5a1f56787fe58fc93ff77975fb "fix pytypes unit tests")`

`[776c0f2](/microsoft/onefuzz/pull/1153/commits/776c0f2be48b1d5a1f56787fe58fc93ff77975fb)`

[![ranweiler](https://avatars.githubusercontent.com/u/515835?s=60&v=4)](/ranweiler)

**[ranweiler](/ranweiler)**
approved these changes
[Aug 13, 2021](#pullrequestreview-729881074)

 [View reviewed changes](/microsoft/onefuzz/pull/1153/files/776c0f2be48b1d5a1f56787fe58fc93ff77975fb)

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=40&v=4)](/bmc-msft)

`[Merge branch 'main' into verify-aad-tenants](/microsoft/onefuzz/pull/1153/commits/895da09b3c2c4ee3dee85f70a9f8fc8f36857546 "Merge branch 'main' into verify-aad-tenants")`

`[895da09](/microsoft/onefuzz/pull/1153/commits/895da09b3c2c4ee3dee85f70a9f8fc8f36857546)`

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=40&u=cc2ea45e2472e87dcbe9f6ab319c3b0fc067361e&v=4)](/bmc-msft)
[bmc-msft](/bmc-msft)
closed this
[Aug 13, 2021](#event-5157249494)

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
locked as **resolved** and limited conversation to collaborators
[Sep 13, 2021](#event-5289746050)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fpull%2F1153).

Reviewers

[![@ranweiler](https://avatars.githubusercontent.com/u/515835?s=40&v=4)](/ranweiler) [ranweiler](/ranweiler)

ranweiler approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=52&v=4)](/bmc-msft) [![@ranweiler](https://avatars.githubusercontent.com/u/515835?s=52&v=4)](/ranweiler) [![@demoray](https://avatars.githubusercontent.com/u/47821?s=52&v=4)](/demoray)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f2384f6c_20250115_093251.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fcommit%2F2fcb4998887959b4fa11894a068d689189742cb1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fcommit%2F2fcb4998887959b4fa11894a068d689189742cb1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=microsoft%2Fonefuzz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 1, 2023. It is now read-only.

[microsoft](/microsoft)
/
**[onefuzz](/microsoft/onefuzz)**
Public archive

* [Notifications](/login?return_to=%2Fmicrosoft%2Fonefuzz) You must be signed in to change notification settings
* [Fork
  198](/login?return_to=%2Fmicrosoft%2Fonefuzz)
* [Star
   2.8k](/login?return_to=%2Fmicrosoft%2Fonefuzz)

* [Code](/microsoft/onefuzz)
* [Issues
  192](/microsoft/onefuzz/issues)
* [Pull requests
  41](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects
  0](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

Additional navigation options

* [Code](/microsoft/onefuzz)
* [Issues](/microsoft/onefuzz/issues)
* [Pull requests](/microsoft/onefuzz/pulls)
* [Discussions](/microsoft/onefuzz/discussions)
* [Actions](/microsoft/onefuzz/actions)
* [Projects](/microsoft/onefuzz/projects)
* [Security](/microsoft/onefuzz/security)
* [Insights](/microsoft/onefuzz/pulse)

## Commit

[Permalink](/microsoft/onefuzz/commit/2fcb4998887959b4fa11894a068d689189742cb1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-q5vh-6whw-x745](https://github.com/advisories/GHSA-q5vh-6whw-x745 "GHSA-q5vh-6whw-x745")

[Browse files](/microsoft/onefuzz/tree/2fcb4998887959b4fa11894a068d689189742cb1)
Browse the repository at this point in the history

```
* verify aad tenants, primarily needed in multi-tenant deployments

* add logging and fix trailing slash for issuer

* handle call_if* not supporting additional argument callbacks

* add logging

* include new datatype in webhook docs

* fix pytypes unit tests

Co-authored-by: Brian Caswell <bmc@shmoo.com>
```

* Loading branch information

[![@bmc-msft](https://avatars.githubusercontent.com/u/41130664?s=40&v=4)](/bmc-msft) [![@demoray](https://avatars.githubusercontent.com/u/47821?s=40&v=4)](/demoray)

[bmc-msft](/microsoft/onefuzz/commits?author=bmc-msft "View all commits by bmc-msft")
and
[demoray](/microsoft/onefuzz/commits?author=demoray "View all commits by demoray")
authored
Aug 13, 2021

1 parent
[ba3a6ea](/microsoft/onefuzz/commit/ba3a6eab04ea049c712502ad593df25eb98e987e)

commit 2fcb499

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**193 additions**
and
**31 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/webhook\_events.md
    [webhook\_events.md](#diff-bad29be292c5afd509830adfc7fbebd3aee30713e54f25051adfce89fb5eb26f)
* src

  + api-service

    - \_\_app\_\_

      * info

        + src/api-service/\_\_app\_\_/info/\_\_init\_\_.py
          [\_\_init\_\_.py](#diff-bd8b0d252c77153869d364e0c30c4921c91b8360276ca1085a54643b44a3a3d6)
      * negotiate

        + src/api-service/\_\_app\_\_/negotiate/\_\_init\_\_.py
          [\_\_init\_\_.py](#diff-0f70d705017d2ad7924078404ff907d5c006797b926dcc9b84b3fbd58f47bc61)
      * onefuzzlib

        + src/api-service/\_\_app\_\_/onefuzzlib/config.py
          [config.py](#diff-edb09498c7f667f3d70fcd9e9c847ab6ff8f63ea22b58bfc1ca95902ec97e7c1)
        + src/api-service/\_\_app\_\_/onefuzzlib/user\_credentials.py
          [user\_credentials.py](#diff-c19b007ae59501bdd50361a60ef15fcbd3e22c7e6f68f5b11cb97b75b822bb5d)
    - tests

      * src/api-service/tests/test\_auth\_check.py
        [test\_auth\_check.py](#diff-0025ada54acb93040ef99999c1d712355b3159143683e6cb7153ff54d2f6c4af)
  + deployment

    - src/deployment/azuredeploy.json
      [azuredeploy.json](#diff-af60771c5f21e93b6a2c6f9378ee9a6ed812008076b45b884124c83a39279917)
    - src/deployment/deploy.py
      [deploy.py](#diff-0489104f2cf3e8ff8968514b328b6cb496d9519ee74fa9f24b612ec060f2b4cf)
    - src/deployment/set\_admins.py
      [set\_admins.py](#diff-f974e48303a720bf6a5ba5cbc8c1181b8f1d7cb40350be70b1321b27a11cfdbe)
  + pytypes

    - extra

      * src/pytypes/extra/generate-docs.py
        [generate-docs.py](#diff-0699b16c66073910b84adc6868a2ab1c0b50af5b6caf5a464f45403e7e2636bc)
    - onefuzztypes

      * src/pytypes/onefuzztypes/models.py
        [models.py](#diff-18a3baa5f9f53de1b7e1ca7cddb6735bc0c35f216943fa31d7fe4c51f92a97ba)
    - tests

      * src/pytypes/tests/test\_instance\_config\_update.py
        [test\_instance\_config\_update.py](#diff-e336f7200be73e0c78682e5fa45d170aded0ed1b58caa5a766d0e6e0c31f3881)

## There are no files selected for viewing

27 changes: 26 additions & 1 deletion

27
[docs/webhook\_events.md](#diff-bad29be292c5afd509830adfc7fbebd3aee30713e54f25051adfce89fb5eb26f "docs/webhook_events.md")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/docs/webhook_events.md)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -641,7 +641,10 @@ Each event will be submitted via HTTP POST to the user provided URL. |
|  |  | "admins": [ |
|  |  | "00000000-0000-0000-0000-000000000000" |
|  |  | ], |
|  |  | "allow\_pool\_management": true |
|  |  | "allow\_pool\_management": true, |
|  |  | "allowed\_aad\_tenants": [ |
|  |  | "00000000-0000-0000-0000-000000000000" |
|  |  | ] |
|  |  | } |
|  |  | } |
|  |  | ``` |
| Expand All | | @@ -665,8 +668,19 @@ Each event will be submitted via HTTP POST to the user provided URL. |
|  |  | "default": true, |
|  |  | "title": "Allow Pool Management", |
|  |  | "type": "boolean" |
|  |  | }, |
|  |  | "allowed\_aad\_tenants": { |
|  |  | "items": { |
|  |  | "format": "uuid", |
|  |  | "type": "string" |
|  |  | }, |
|  |  | "title": "Allowed Aad Tenants", |
|  |  | "type": "array" |
|  |  | } |
|  |  | }, |
|  |  | "required": [ |
|  |  | "allowed\_aad\_tenants" |
|  |  | ], |
|  |  | "title": "InstanceConfig", |
|  |  | "type": "object" |
|  |  | } |
| Expand Down  Expand Up | | @@ -5599,8 +5613,19 @@ Each event will be submitted via HTTP POST to the user provided URL. |
|  |  | "default": true, |
|  |  | "title": "Allow Pool Management", |
|  |  | "type": "boolean" |
|  |  | }, |
|  |  | "allowed\_aad\_tenants": { |
|  |  | "items": { |
|  |  | "format": "uuid", |
|  |  | "type": "string" |
|  |  | }, |
|  |  | "title": "Allowed Aad Tenants", |
|  |  | "type": "array" |
|  |  | } |
|  |  | }, |
|  |  | "required": [ |
|  |  | "allowed\_aad\_tenants" |
|  |  | ], |
|  |  | "title": "InstanceConfig", |
|  |  | "type": "object" |
|  |  | }, |
| Expand Down | |  |

11 changes: 10 additions & 1 deletion

11
[src/api-service/\_\_app\_\_/info/\_\_init\_\_.py](#diff-bd8b0d252c77153869d364e0c30c4921c91b8360276ca1085a54643b44a3a3d6 "src/api-service/__app__/info/__init__.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/api-service/__app__/info/__init__.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,11 +14,12 @@ |
|  |  | get\_instance\_id, |
|  |  | get\_subscription, |
|  |  | ) |
|  |  | from ..onefuzzlib.endpoint\_authorization import call\_if\_user |
|  |  | from ..onefuzzlib.request import ok |
|  |  | from ..onefuzzlib.versions import versions |
|  |  |  |
|  |  |  |
|  |  | def main(req: func.HttpRequest) -> func.HttpResponse: |
|  |  | def get(req: func.HttpRequest) -> func.HttpResponse: |
|  |  | response = ok( |
|  |  | Info( |
|  |  | resource\_group=get\_base\_resource\_group(), |
| Expand All | | @@ -32,3 +33,11 @@ def main(req: func.HttpRequest) -> func.HttpResponse: |
|  |  | ) |
|  |  |  |
|  |  | return response |
|  |  |  |
|  |  |  |
|  |  | def main(req: func.HttpRequest) -> func.HttpResponse: |
|  |  | methods = {"GET": get} |
|  |  | method = methods[req.method] |
|  |  | result = call\_if\_user(req, method) |
|  |  |  |
|  |  | return result |

23 changes: 18 additions & 5 deletions

23
[src/api-service/\_\_app\_\_/negotiate/\_\_init\_\_.py](#diff-0f70d705017d2ad7924078404ff907d5c006797b926dcc9b84b3fbd58f47bc61 "src/api-service/__app__/negotiate/__init__.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/api-service/__app__/negotiate/__init__.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,8 @@ |
|  |  |  |
|  |  | import azure.functions as func |
|  |  |  |
|  |  | from ..onefuzzlib.endpoint\_authorization import call\_if\_user |
|  |  |  |
|  |  | # This endpoint handles the signalr negotation |
|  |  | # As we do not differentiate from clients at this time, we pass the Functions runtime |
|  |  | # provided connection straight to the client |
| Expand All | | @@ -14,8 +16,19 @@ |
|  |  |  |
|  |  |  |
|  |  | def main(req: func.HttpRequest, connectionInfoJson: str) -> func.HttpResponse: |
|  |  | return func.HttpResponse( |
|  |  | connectionInfoJson, |
|  |  | status\_code=200, |
|  |  | headers={"Content-type": "application/json"}, |
|  |  | ) |
|  |  | # NOTE: this is a sub-method because the call\_if\* do not support callbacks with |
|  |  | # additional arguments at this time. Once call\_if\* supports additional arguments, |
|  |  | # this should be made a generic function |
|  |  | def post(req: func.HttpRequest) -> func.HttpResponse: |
|  |  | return func.HttpResponse( |
|  |  | connectionInfoJson, |
|  |  | status\_code=200, |
|  |  | headers={"Content-type": "application/json"}, |
|  |  | ) |
|  |  |  |
|  |  | methods = {"POST": post} |
|  |  | method = methods[req.method] |
|  |  |  |
|  |  | result = call\_if\_user(req, method) |
|  |  |  |
|  |  | return result |

2 changes: 1 addition & 1 deletion

2
[src/api-service/\_\_app\_\_/onefuzzlib/config.py](#diff-edb09498c7f667f3d70fcd9e9c847ab6ff8f63ea22b58bfc1ca95902ec97e7c1 "src/api-service/__app__/onefuzzlib/config.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/api-service/__app__/onefuzzlib/config.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,7 +25,7 @@ def key\_fields(cls) -> Tuple[str, Optional[str]]: |
|  |  | def fetch(cls) -> "InstanceConfig": |
|  |  | entry = cls.get(get\_instance\_name()) |
|  |  | if entry is None: |
|  |  | entry = cls() |
|  |  | entry = cls(allowed\_aad\_tenants=[]) |
|  |  | entry.save() |
|  |  | return entry |
|  |  |  |
| Expand Down | |  |

26 changes: 24 additions & 2 deletions

26
[src/api-service/\_\_app\_\_/onefuzzlib/user\_credentials.py](#diff-c19b007ae59501bdd50361a60ef15fcbd3e22c7e6f68f5b11cb97b75b822bb5d "src/api-service/__app__/onefuzzlib/user_credentials.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/api-service/__app__/onefuzzlib/user_credentials.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,14 +3,18 @@ |
|  |  | # Copyright (c) Microsoft Corporation. |
|  |  | # Licensed under the MIT License. |
|  |  |  |
|  |  | from typing import Optional |
|  |  | import logging |
|  |  | from typing import List, Optional |
|  |  | from uuid import UUID |
|  |  |  |
|  |  | import azure.functions as func |
|  |  | import jwt |
|  |  | from memoization import cached |
|  |  | from onefuzztypes.enums import ErrorCode |
|  |  | from onefuzztypes.models import Error, Result, UserInfo |
|  |  |  |
|  |  | from .config import InstanceConfig |
|  |  |  |
|  |  |  |
|  |  | def get\_bearer\_token(request: func.HttpRequest) -> Optional[str]: |
|  |  | auth: str = request.headers.get("Authorization", None) |
| Expand Down  Expand Up | | @@ -39,6 +43,13 @@ def get\_auth\_token(request: func.HttpRequest) -> Optional[str]: |
|  |  | return str(token\_header) |
|  |  |  |
|  |  |  |
|  |  | @cached(ttl=60) |
|  |  | def get\_allowed\_tenants() -> List[str]: |
|  |  | config = InstanceConfig.fetch() |
|  |  | entries = [f"https://sts.windows.net/{x}/" for x in config.allowed\_aad\_tenants] |
|  |  | return entries |
|  |  |  |
|  |  |  |
|  |  | def parse\_jwt\_token(request: func.HttpRequest) -> Result[UserInfo]: |
|  |  | """Obtains the Access Token from the Authorization Header""" |
|  |  | token\_str = get\_auth\_token(request) |
| Expand All | | @@ -48,9 +59,20 @@ def parse\_jwt\_token(request: func.HttpRequest) -> Result[UserInfo]: |
|  |  | errors=["unable to find authorization token"], |
|  |  | ) |
|  |  |  |
|  |  | # This token has already been verified by the azure authentication layer |
|  |  | # The JWT token has already been verified by the azure authentication layer, |
|  |  | # but we need to verify the tenant is as we expect. |
|  |  | token = jwt.decode(token\_str, options={"verify\_signature": False}) |
|  |  |  |
|  |  | if "iss" not in token: |
|  |  | return Error( |
|  |  | code=ErrorCode.INVALID\_REQUEST, errors=["missing issuer from token"] |
|  |  | ) |
|  |  |  |
|  |  | tenants = get\_allowed\_tenants() |
|  |  | if token["iss"] not in tenants: |
|  |  | logging.error("issuer not from allowed tenant: %s - %s", token["iss"], tenants) |
|  |  | return Error(code=ErrorCode.INVALID\_REQUEST, errors=["unauthorized AAD issuer"]) |
|  |  |  |
|  |  | application\_id = UUID(token["appid"]) if "appid" in token else None |
|  |  | object\_id = UUID(token["oid"]) if "oid" in token else None |
|  |  | upn = token.get("upn") |
| Expand Down | |  |

53 changes: 42 additions & 11 deletions

53
[src/api-service/tests/test\_auth\_check.py](#diff-0025ada54acb93040ef99999c1d712355b3159143683e6cb7153ff54d2f6c4af "src/api-service/tests/test_auth_check.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/api-service/tests/test_auth_check.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ |
|  |  |  |
|  |  | import os |
|  |  | import unittest |
|  |  | from uuid import uuid4 |
|  |  | from uuid import UUID, uuid4 |
|  |  |  |
|  |  | from onefuzztypes.models import UserInfo |
|  |  |  |
| Expand All | | @@ -25,29 +25,41 @@ def test\_modify\_config(self) -> None: |
|  |  | user2 = uuid4() |
|  |  |  |
|  |  | # no admins set |
|  |  | self.assertTrue(can\_modify\_config\_impl(InstanceConfig(), UserInfo())) |
|  |  | self.assertTrue( |
|  |  | can\_modify\_config\_impl( |
|  |  | InstanceConfig(allowed\_aad\_tenants=[UUID(int=0)]), UserInfo() |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # with oid, but no admin |
|  |  | self.assertTrue( |
|  |  | can\_modify\_config\_impl(InstanceConfig(), UserInfo(object\_id=user1)) |
|  |  | can\_modify\_config\_impl( |
|  |  | InstanceConfig(allowed\_aad\_tenants=[UUID(int=0)]), |
|  |  | UserInfo(object\_id=user1), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # is admin |
|  |  | self.assertTrue( |
|  |  | can\_modify\_config\_impl( |
|  |  | InstanceConfig(admins=[user1]), UserInfo(object\_id=user1) |
|  |  | InstanceConfig(allowed\_aad\_tenants=[UUID(int=0)], admins=[user1]), |
|  |  | UserInfo(object\_id=user1), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # no user oid set |
|  |  | self.assertFalse( |
|  |  | can\_modify\_config\_impl(InstanceConfig(admins=[user1]), UserInfo()) |
|  |  | can\_modify\_config\_impl( |
|  |  | InstanceConfig(allowed\_aad\_tenants=[UUID(int=0)], admins=[user1]), |
|  |  | UserInfo(), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # not an admin |
|  |  | self.assertFalse( |
|  |  | can\_modify\_config\_impl( |
|  |  | InstanceConfig(admins=[user1]), UserInfo(object\_id=user2) |
|  |  | InstanceConfig(allowed\_aad\_tenants=[UUID(int=0)], admins=[user1]), |
|  |  | UserInfo(object\_id=user2), |
|  |  | ) |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -58,36 +70,55 @@ def test\_manage\_pools(self) -> None: |
|  |  | # by default, any can modify |
|  |  | self.assertIsNone( |
|  |  | check\_can\_manage\_pools\_impl( |
|  |  | InstanceConfig(allow\_pool\_management=True), UserInfo() |
|  |  | InstanceConfig( |
|  |  | allowed\_aad\_tenants=[UUID(int=0)], allow\_pool\_management=True |
|  |  | ), |
|  |  | UserInfo(), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # with oid, but no admin |
|  |  | self.assertIsNone( |
|  |  | check\_can\_manage\_pools\_impl( |
|  |  | InstanceConfig(allow\_pool\_management=True), UserInfo(object\_id=user1) |
|  |  | InstanceConfig( |
|  |  | allowed\_aad\_tenants=[UUID(int=0)], allow\_pool\_management=True |
|  |  | ), |
|  |  | UserInfo(object\_id=user1), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # is admin |
|  |  | self.assertIsNone( |
|  |  | check\_can\_manage\_pools\_impl( |
|  |  | InstanceConfig(allow\_pool\_management=False, admins=[user1]), |
|  |  | InstanceConfig( |
|  |  | allowed\_aad\_tenants=[UUID(int=0)], |
|  |  | allow\_pool\_management=False, |
|  |  | admins=[user1], |
|  |  | ), |
|  |  | UserInfo(object\_id=user1), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # no user oid set |
|  |  | self.assertIsNotNone( |
|  |  | check\_can\_manage\_pools\_impl( |
|  |  | InstanceConfig(allow\_pool\_management=False, admins=[user1]), UserInfo() |
|  |  | InstanceConfig( |
|  |  | allowed\_aad\_tenants=[UUID(int=0)], |
|  |  | allow\_pool\_management=False, |
|  |  | admins=[user1], |
|  |  | ), |
|  |  | UserInfo(), |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | # not an admin |
|  |  | self.assertIsNotNone( |
|  |  | check\_can\_manage\_pools\_impl( |
|  |  | InstanceConfig(allow\_pool\_management=False, admins=[user1]), |
|  |  | InstanceConfig( |
|  |  | allowed\_aad\_tenants=[UUID(int=0)], |
|  |  | allow\_pool\_management=False, |
|  |  | admins=[user1], |
|  |  | ), |
|  |  | UserInfo(object\_id=user2), |
|  |  | ) |
|  |  | ) |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/deployment/azuredeploy.json](#diff-af60771c5f21e93b6a2c6f9378ee9a6ed812008076b45b884124c83a39279917 "src/deployment/azuredeploy.json")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/deployment/azuredeploy.json)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -821,6 +821,10 @@ |
|  |  | "scaleset-identity": { |
|  |  | "type": "string", |
|  |  | "value": "[variables('scaleset\_identity')]" |
|  |  | }, |
|  |  | "tenant\_id": { |
|  |  | "type": "string", |
|  |  | "value": "[subscription().tenantId]" |
|  |  | } |
|  |  | } |
|  |  | } |

24 changes: 20 additions & 4 deletions

24
[src/deployment/deploy.py](#diff-0489104f2cf3e8ff8968514b328b6cb496d9519ee74fa9f24b612ec060f2b4cf "src/deployment/deploy.py")

Show comments

[View file](/microsoft/onefuzz/blob/2fcb4998887959b4fa11894a068d689189742cb1/src/deployment/deploy.py)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -72,7 +72,7 @@ |
|  |  | set\_app\_audience, |
|  |  | update\_pool\_registration, |
|  |  | ) |
|  |  | from set\_admins import update\_admins |
|  |  | from set\_admins import update\_admins, update\_allowed\_aad\_tenants |
|  |  |  |
|  |  | # Found by manually assigning the User.Read permission to application |
|  |  | # registration in the admin portal. The values are in the manifest under |
| Expand Down  Expand Up | | @@ -130,7 +130,8 @@ def \_\_init\_\_( |
|  |  | multi\_tenant\_domain: str, |
|  |  | upgrade: bool, |
|  |  | subscription\_id: Optional[str], |
|  |  | admins: List[UUID] |
|  |  | admins: List[UUID], |
|  |  | allowed\_aad\_tenants: List[UUID], |
|  |  | ): |
|  |  | self.subscription\_id = subscription\_id |
|  |  | self.resource\_group = resource\_group |
| Expand Down  Expand Up | | @@ -161,6 +162,7 @@ def \_\_init\_\_( |
|  |  | self.export\_appinsights = export\_appinsights |
|  |  | self.log\_service\_principal = log\_service\_principal |
|  |  | self.admins = admins |
|  |  | self.allowed\_aad\_tenants = allowed\_aad\_tenants |
|  |  |  |
|  |  | machine = platform.machine() |
|  |  | system = platform.system() |
| Expand Down  Expand Up | | @@ -560,13 +562,20 @@ def apply\_migrations(self) -> None: |
|  |  | table\_service = TableService(account\_name=name, account\_key=key) |
|  |  | migrate(table\_service, self.migrations) |
|  |  |  |
|  |  | def set\_admins(self) -> None: |
|  |  | def set\_instance\_config(self) -> None: |
|  |  | name = self.results["deploy"]["func-name"]["value"] |
|  |  | key = self.results["deploy"]["func-key"]["value"] |
|  |  | tenant = UUID(self.results["deploy"]["tenant\_id"]["value"]) |
|  |  | table\_service = TableService(account\_name=name, account\_key=key) |
|  |  |  |
|  |  | if self.admins: |
|  |  | update\_admins(table\_service, self.application\_name, self.admins) |
|  |  |  |
|  |  | tenants = self.allowed\_aad\_tenants |
|  |  | if tenant not in tenants: |
|  |  | tenants.append(tenant) |
|  |  | update\_allowed\_aad\_tenants(table\_service, self.application\_name, tenants) |
|  |  |  |
|  |  | def create\_queues(self) -> None: |
|  |  | logger.info("creating eventgrid destination queue") |
|  |  |  |
| Expand Down  Expand Up | | @@ -926,7 +935,7 @@ def main() -> None: |
|  |  |  |
|  |  | full\_deployment\_states = rbac\_only\_states + [ |
|  |  | ("apply\_migrations", Client.apply\_migrations), |
|  |  | ("set\_admins", Client.set\_admins), |
|  |  | ("set\_instance\_config", Client.set\_instance\_config), |
|  |  | ("queues", Client.create\_queues), |
|  |  | ("eventgrid", Client.create\_eventgrid), |
|  |  | ("tools", Client.upload\_tools), |
| Expand Down  Expand Up | | @@ -1038,6 +1047,12 @@ def main() -> None: |
|  |  | nargs="\*", |
|  |  | help="set the list of administrators (by OID in AAD)", |
|  |  | ) |
|  |  | parser.add\_argument( |
|  |  | "--allowed\_aad\_tenants", |
|  |  | type=UUID, |
|  |  | nargs="\*", |
|  |  | help="Set additional AAD tenants beyond the tenant the app is deployed in", |
|  |  | ) |
|  |  |  |
|  |  | args = parser.parse\_args() |
|  |  |  |
| Expand Down  Expand Up | | @@ -1066,6 +1081,7 @@ def main() -> None: |
|  |  | upgrade=args.upgrade, |
|  |  | subscription\_id=args.subscription\_id, |
|  |  | admins=args.set\_admins, |
|  |  | allowed\_aad\_tenants=args.allowed\_aad\_tenants or [], |
|  |  | ) |
|  |  | if args.verbose: |
|  |  | level = logging.DEBUG |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2fcb499`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fonefuzz%2Fcommit%2F2fcb4998887959b4fa11894a068d689189742cb1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


