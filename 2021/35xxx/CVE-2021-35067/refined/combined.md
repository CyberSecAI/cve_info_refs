=== Content from infosec.rm-it.de_0bca79d3_20250114_224458.html ===

[Skip to primary content](#content)
# [InfoSec @ rm-it](https://infosec.rm-it.de/)

##

[![InfoSec @ rm-it](https://infosec.rm-it.de/wp-content/uploads/2017/07/header2.png)](https://infosec.rm-it.de/)
Search

### Main menu

* [Home](https://infosec.rm-it.de/)
* [About me](https://infosec.rm-it.de/about-me/)
* [Publications](https://infosec.rm-it.de/publications/)
* [Impressum](https://infosec.rm-it.de/impressum/)

### Post navigation

[← Previous](https://infosec.rm-it.de/2020/11/04/basetech-ip-camera-analysis/)
[Next →](https://infosec.rm-it.de/2022/07/17/hackthebox-business-ctf-2022-trade/)

# Meross Smart Wi-Fi Garage Door Opener analysis

Posted on [2021-06-18](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/ "15:00")  by  [Roman](https://infosec.rm-it.de/author/roman/ "View all posts by Roman")

# Intro

This post is another research project I conducted while in COVID-19 lockdown. The Meross Smart Wi-Fi Garage Door Opener (MSG100, firmware version 3.1.15, hardware version 3.5.0) is an addition you can add to your existing garage door opener. This device is connected via wireless LAN to your network and allows you to trigger open or close requests through a mobile application. You do not have to be locally in the same network for this to work, you can close, open or view the status from anywhere in the world.

This is a rather long blog post, if you are only interested in the vulnerabilities you can skip right to them by skipping to [that chapter](#vulns). The vulnerabilities were closed by Meross since the publication of this post.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage01-1024x772.jpg)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage01-scaled.jpg)

Practically the device is acting as a remote controlled button. If you press the open or close function in the mobile application, the device simply closes a electrical circuit which should be connected to the existing garage opener. Closing that circuit tells the garage door to close or open. It also includes a sensor to check if the door is closed or not. Power is provided through a USB connector.

After identifying vulnerabilities in this device I also verified that they affect at least the Meross Smart Wi-Fi Plug (MSS210, firmware version 5.1.1, hardware version 5.0.0). Possibly all devices which use this platform could be affected by this.

# Recon

To set up the device the Meross mobile app is required. To use it, we need to first create a new account.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage02-169x300.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage02.png)

Afterwards we can start to add the new device to our account. The app guides us through this setup. When the device first boots up it opens a wireless LAN hotspot. The mobile app instructs us to connect to it.

During this setup a secret key is being deployed on the device. This key appears to be specific to the logged in user.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage15.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage15.png)

After that setup, the device now connects to the provided wireless network and is ready to use. As the device is now part of the network, the first step was to run a port scan against it:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage03.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage03.png)

The device only opens one port, it is accepting HTTP requests on port 80. Simply requesting anything from it did not work, running any sort of directory brute force tool against it reliably crashed the device.

Next an iPhone was set up to send all traffic to a interception proxy and the application was used while being connected to the network. In that state, the mobile app directly uses the web server on the device to communicate with it.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage04-1024x357.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage04.png)

As can be seen in the screenshot, the message the web server accepts is JSON formatted and contains a payload as well as a header section. The header always contains a “`sign`” field. This field is signed using the previously deployed secret key. Any change of the message is detected and the system does not execute it:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage05-1024x430.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage05.png)

In the above case the timestamp was tampered with, and the device correctly rejected this message. Interestingly it appears that only the content of the header is signed but not the payload. Replaying that message but changing the “`open`” field in the header does get executed:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage06-1024x425.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage06.png)

This means if an attacker captures the request to close the garage door, that message can be altered to open the garage (or vice versa). Also this reveals that the device has no protection at all against replay attacks. The header includes a “`timestamp`” field which is part of the signature, but it is not verified that the timestamp is in an acceptable time-frame. Even a day old message can be replayed and it will get executed by the device.

Next the iPhone was moved to a different network to simulate the “open from anywhere” functionality. When doing so, the interception proxy did not capture any traffic that contained messages to open the garage door.

Capturing the network traffic at that point showed that the app does communicate outgoing on port 443 with host “54.77.214.248”, the traffic was encrypted but it was not HTTPS: [![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage07-1024x502.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage07.png)

The hostname “`mqtt-eu.meross.com`” already gave a hint that its using the MQTT protocol.

# Investigating the MQTT server

The Meross MQTT details have already been investigated by others. I found the GitHub repository [albertogeniola/MerossIot](https://github.com/albertogeniola/MerossIot) as well as [Apollon77/meross-cloud](https://github.com/Apollon77/meross-cloud) extremely helpful. Basically to connect to the Meross MQTT server we need the following:

* Username: the internal user ID assigned by Meross to our account
* Password: the secret key concatenated to the user ID, passed through md5
* Client ID: a specific string in the form of “app:<any md5-sum>”
* Topic(s) to subscribe to: topic names were already part of the HTTP messages

This is all easily obtainable, logging in with the mobile application gives us both the user ID as well as the secret key:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage08-1024x302.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage08.png)

Using the secret key we can create the password:

```

echo -n '1245194654bb6420ca3756d09030059deb828ad' |md5sum
774b1d8d8dfc2f38ffe78f93676a81e7  -

```

With this information we can now connect to the Meross MQTT server. I couldn’t figure out why, but I didn’t manage to connect through “`mosquitto_sub`“. Instead I used [MQTT Explorer](https://mqtt-explorer.com/) which worked without any problems.

The connection to the MQTT server will be done as the user “`1245194`“. This user was created only for this purpose. This user never had a device enrolled or attached to its account.

We use the following connection details:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage09.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage09.png)

As the client ID we set “`app:ca09923818dd826a8c09c702877db82b`” and that is all that is required to generally connect.

The structure of the used topics were found through the [albertogeniola/MerossIot](https://github.com/albertogeniola/MerossIot/blob/0.4.X.X/meross_iot/utilities/mqtt.py) GitHub repository. Each user on the platform has its own MQTT topic in the form of “`/app/<$userID>/subscribe`“. In this case, we do not subscribe to our own user ID, instead we subscribe to “`1238435`” – this is the user that has the device attached to its account.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage10.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage10.png)

The connection with this setup is allowed. When the device is now being used by the owner or if the sensors notice a state change we also get those messages. For example, if the sensor is triggered from closed to open state the following message is sent to this topic:

```

{
  "header": {
    "triggerSrc": "DevicePysical",
    "timestampMs": 591,
    "timestamp": 1615975130,
    "sign": "67978ce3534b49079c5cdf5eb0ece248",
    "payloadVersion": 1,
    "namespace": "Appliance.GarageDoor.State",
    "method": "PUSH",
    "messageId": "8d73746387e131c8e09c637989a3a7de",
    "from": "/appliance/2008141004674336100348e1e92b352d/publish"
  },
  "payload": {
    "state": [
      {
        "open": 1,
        "lmTime": 1615975130,
        "channel": 0
      }
    ]
  }
}

```

In the payload this just tells us that at a specific time the state changed to “`1`“. In the header it is indicated that this being sent as a “`PUSH`” message. However, the message contains something much more interesting. In line 11 the “`from`” field tells us the ID of the garage opener device which triggered this message.

We reconnect to the MQTT server and this time we also subscribe to the topics “`/appliance/2008141004674336100348e1e92b352d/publish`” and “`/appliance/2008141004674336100348e1e92b352d/subscribe`“:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage11.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage11.png)

If the real user of the device now triggers an action, we can see the following message in the “`/appliance/2008141004674336100348e1e92b352d/subscribe`” topic:

```

{
  "payload" : {
    "state" : {
      "channel" : 0,
      "uuid" : "2008141004674336100348e1e92b352d",
      "open" : 1
    }
  },
  "header" : {
    "messageId" : "12c60e2beb46fb657ed06f96aad701fd",
    "method" : "SET",
    "from" : "\/app\/1238435-94CF07DCAD0730A36B1B895C61B45534\/subscribe",
    "payloadVersion" : 1,
    "namespace" : "Appliance.GarageDoor.State",
    "uuid" : "2008141004674336100348e1e92b352d",
    "sign" : "287965cf84bdf08b557163604acbd247",
    "triggerSrc" : "iOS",
    "timestamp" : 1615976692
  }
}

```

This is the signed message which was sent to open the garage. This message can now be taken and be resent using the MQTT service to open or close the garage door. Since the payload is not signed only a single “`SET`” message must be captured and as there is no replay protection this message can be used at any later time.

This absolutely works, resending this message like this:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage12.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage12.png)

Triggers the local device to close the door, closing the door is causing the device indicate this with loud beeping.

With these two issues combined, an attacker could capture the signed messages over a longer period of time and at some point replay them to open all garage doors that were actively used in the observation timeframe.

# Vulnerabilities

This is the condensed list of vulnerabilities identified during this research in order of appearance.

## 1. No replay attack protection (CVE-**2021-35067**)

The Meross devices accept JSON payload to trigger actions such as open or close of garage doors. This JSON is either sent directly via plain-text HTTP to the device if the mobile app is in the same network or through MQTT if the mobile app is anywhere else.

The JSON is signed, but no replay protection has been implemented. Additionally only the header is signed, not the full payload. Even a days old message can be re-sent to the device which will execute it. An attacker must only gain access to the close or open message once. They can then later re-use it multiple times.

Due to the incomplete signing of the JSON a message to close the device can be altered to open it.

*Update on 2021-06-18:*Meross told me they are releasing firmware version 3.2.3 which resolves this. I was not able to verify this yet due to time constraints.

*Update on 2021-07-04:* I was able to confirm that the vulnerability is closed in version 3.2.3.

## 2. MQTT server allows access to other devices

The central Meross MQTT server does not check if the connecting user ID is identical with the user ID to which it is subscribing. Practically this means that attackers can access the MQTT user ID topics of all users. They must only guess the user IDs which are numeric and ascending.

If the real user is triggering actions on the device while the attacker is subscribed to the user ID topic, then the unique device ID will be leaked. Using this the attacker can then subscribe to the device specific topic.

If the real user is again triggering an action, then the attacker gains access to the signed message with which this action was triggered. This message can then be replayed as per the previous vulnerability.

*Update on 2021-05-30:* Meross has fixed this vulnerability.

It is no longer possible to subscribe to topics of other users.

# Conclusion

The Meross system contained multiple flaws which combined could have given attackers the ability to unauthorized open garage doors. The same was possible with Meross smart Wi-Fi plugs, they simply used different device IDs but the process was exactly the same.

The devices did not protect against replay attacks of any messages.

Additionally these messages were not protected when the mobile application is used outside of the local network. Anyone could subscribe to the MQTT topics on the central Meross MQTT server and gain access to these signed messages.

An attacker could wait to get access to the desired message (open/close or on/off) and replay it at a later time.

After contacting Meross with the details of the vulnerabilities they responded very quickly and showed an effort to fix the vulnerabilities. In the end the MQTT vulnerabilities were completely resolved. Meross also released a new firmware version which should resolve the replay attack vulnerability, however I could not verify this yet due to time constrains (*Update*: I confirmed that this is resolved as well).

However, without the ability to capture the signed messages centrally from the MQTT server, the risk of this vulnerability is greatly reduced even if the replay attack is still possible. An attacker would now need to be in a position to already capture network traffic to the garage door opener locally in the network.

# Disclosure timeline

2021-03-17: Vulnerabilities initially identified, first attempt to contact Meross

2021-03-20: Sent vulnerability report to correct contact

2021-03-24: Meross acknowledges the vulnerabilities, says they are working on a fix

2021-05-24: Meross releases fixes and invite me to test them

2021-05-30: I retest and confirm the MQTT issue to be fixed but replay attack remains unfixed, asking Meross for clarification

2021-06-18: Meross says version 3.2.3 fixes the replay vulnerability

2021-06-18: Publication of this blogpost after 90 days since initial disclosure

2021-06-29: Meross responded that CVE-2021-35067 has been assigned to the replay attack vulnerability

2021-07-04: I was able to confirm that version 3.2.3 fixes the replay attack vulnerability

This entry was posted in [Research](https://infosec.rm-it.de/category/research/) by [Roman](https://infosec.rm-it.de/author/roman/). Bookmark the [permalink](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/ "Permalink to Meross Smart Wi-Fi Garage Door Opener analysis").

## 6 thoughts on “Meross Smart Wi-Fi Garage Door Opener analysis”

1. ![](https://secure.gravatar.com/avatar/6ac20ff137222a5f6d8601a124c8761d?s=68&d=mm&r=g)Gerard on [2021-10-05 at 10:17](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-10757) said:

   Good job!

   But why is still in reserved state the CVE-2021-35067 ?

   [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=10757#respond)
   * ![](https://secure.gravatar.com/avatar/d8d088755860c7441743a211c1752354?s=39&d=mm&r=g)Roman on [2021-10-05 at 21:05](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-10771) said:

     It was requested by the manufacturer, I have requested publication through Mitre now but I’m not sure if this will work.

     I don’t know which CNA even assigned the CVE.

     [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=10771#respond)
     + ![](https://secure.gravatar.com/avatar/6ac20ff137222a5f6d8601a124c8761d?s=39&d=mm&r=g)Gerard on [2021-10-07 at 02:31](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-11038) said:

       Hi again Roman;

       I also requested one through default MITRE as CNA of last resort but received no answer. I forwarded to Spanish (INCIBE) that act as root role and finally have a CVE ID but under reserved state (INCIBE is working with Meross before get the publication of the vulnerability). I discovered that the wifi password is sent in plaintext Base 64 codification in an smart wifi wall switch product, MSS550X. My work is explained here:

       <https://www.slideshare.net/fuguet/my-neighbors-flat-smells-like-data>

       A video was made to transmit the awareness of it:

       <https://youtu.be/pMzULxYDsNM>

       Many thanks and take care

       [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=11038#respond)
       - ![](https://secure.gravatar.com/avatar/321a9dadac42ee22c8e5e21dc8ff139c?s=39&d=mm&r=g)Gerard on [2021-11-06 at 01:50](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-12366) said:

         This is my true evidence that I wasn’t lying, no fake:

         CVE-2021-3774

         <https://www.cve.org/CVERecord?id=CVE-2021-3774>

         [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=12366#respond)
         * ![](https://secure.gravatar.com/avatar/d8d088755860c7441743a211c1752354?s=39&d=mm&r=g)Roman on [2021-11-06 at 09:30](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-12381) said:

           Nice one!

           My CVE also got published in the meantime.
3. Pingback: [Blurams Lumi Security Camera analysis | InfoSec @ rm-it](https://infosec.rm-it.de/2024/02/01/blurams-lumi-security-camera-analysis/)

### Leave a Reply [Cancel reply](/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

### Recent Posts

* [Circumvention of Apple iOS Mail App “Different Reply Address” warning](https://infosec.rm-it.de/2024/06/24/circumvention-of-apple-ios-mail-app-different-reply-address-warning/)
* [Blurams Lumi Security Camera analysis](https://infosec.rm-it.de/2024/02/01/blurams-lumi-security-camera-analysis/)
* [HackTheBox Business CTF 2022 – Trade](https://infosec.rm-it.de/2022/07/17/hackthebox-business-ctf-2022-trade/)
* [Meross Smart Wi-Fi Garage Door Opener analysis](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/)
* [BASETech IP camera analysis](https://infosec.rm-it.de/2020/11/04/basetech-ip-camera-analysis/)
### Archives

* [June 2024](https://infosec.rm-it.de/2024/06/)
* [February 2024](https://infosec.rm-it.de/2024/02/)
* [July 2022](https://infosec.rm-it.de/2022/07/)
* [June 2021](https://infosec.rm-it.de/2021/06/)
* [November 2020](https://infosec.rm-it.de/2020/11/)
* [June 2020](https://infosec.rm-it.de/2020/06/)
* [April 2020](https://infosec.rm-it.de/2020/04/)
* [March 2020](https://infosec.rm-it.de/2020/03/)
* [January 2020](https://infosec.rm-it.de/2020/01/)
* [December 2019](https://infosec.rm-it.de/2019/12/)
* [November 2019](https://infosec.rm-it.de/2019/11/)
* [October 2019](https://infosec.rm-it.de/2019/10/)
* [September 2019](https://infosec.rm-it.de/2019/09/)
* [July 2019](https://infosec.rm-it.de/2019/07/)
* [April 2019](https://infosec.rm-it.de/2019/04/)
* [December 2018](https://infosec.rm-it.de/2018/12/)
* [October 2018](https://infosec.rm-it.de/2018/10/)
* [August 2018](https://infosec.rm-it.de/2018/08/)
* [July 2018](https://infosec.rm-it.de/2018/07/)
* [June 2018](https://infosec.rm-it.de/2018/06/)
* [April 2018](https://infosec.rm-it.de/2018/04/)
* [March 2018](https://infosec.rm-it.de/2018/03/)
* [February 2018](https://infosec.rm-it.de/2018/02/)
* [November 2017](https://infosec.rm-it.de/2017/11/)
* [August 2017](https://infosec.rm-it.de/2017/08/)
* [July 2017](https://infosec.rm-it.de/2017/07/)
* [June 2017](https://infosec.rm-it.de/2017/06/)
* [January 2016](https://infosec.rm-it.de/2016/01/)
* [June 2012](https://infosec.rm-it.de/2012/06/)
* [April 2012](https://infosec.rm-it.de/2012/04/)
### Categories

* [CTF](https://infosec.rm-it.de/category/ctf/)
* [HackTheBox](https://infosec.rm-it.de/category/hackthebox/)
* [Research](https://infosec.rm-it.de/category/research/)
* [Uncategorized](https://infosec.rm-it.de/category/uncategorized/)

[Proudly powered by WordPress](https://wordpress.org/ "Semantic Personal Publishing Platform")



=== Content from infosec.rm-it.de_b14a766b_20250114_224457.html ===

[Skip to primary content](#content)
# [InfoSec @ rm-it](https://infosec.rm-it.de/)

##

[![InfoSec @ rm-it](https://infosec.rm-it.de/wp-content/uploads/2017/07/header2.png)](https://infosec.rm-it.de/)
Search

### Main menu

* [Home](https://infosec.rm-it.de/)
* [About me](https://infosec.rm-it.de/about-me/)
* [Publications](https://infosec.rm-it.de/publications/)
* [Impressum](https://infosec.rm-it.de/impressum/)

### Post navigation

[← Previous](https://infosec.rm-it.de/2020/11/04/basetech-ip-camera-analysis/)
[Next →](https://infosec.rm-it.de/2022/07/17/hackthebox-business-ctf-2022-trade/)

# Meross Smart Wi-Fi Garage Door Opener analysis

Posted on [2021-06-18](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/ "15:00")  by  [Roman](https://infosec.rm-it.de/author/roman/ "View all posts by Roman")

# Intro

This post is another research project I conducted while in COVID-19 lockdown. The Meross Smart Wi-Fi Garage Door Opener (MSG100, firmware version 3.1.15, hardware version 3.5.0) is an addition you can add to your existing garage door opener. This device is connected via wireless LAN to your network and allows you to trigger open or close requests through a mobile application. You do not have to be locally in the same network for this to work, you can close, open or view the status from anywhere in the world.

This is a rather long blog post, if you are only interested in the vulnerabilities you can skip right to them by skipping to [that chapter](#vulns). The vulnerabilities were closed by Meross since the publication of this post.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage01-1024x772.jpg)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage01-scaled.jpg)

Practically the device is acting as a remote controlled button. If you press the open or close function in the mobile application, the device simply closes a electrical circuit which should be connected to the existing garage opener. Closing that circuit tells the garage door to close or open. It also includes a sensor to check if the door is closed or not. Power is provided through a USB connector.

After identifying vulnerabilities in this device I also verified that they affect at least the Meross Smart Wi-Fi Plug (MSS210, firmware version 5.1.1, hardware version 5.0.0). Possibly all devices which use this platform could be affected by this.

# Recon

To set up the device the Meross mobile app is required. To use it, we need to first create a new account.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage02-169x300.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage02.png)

Afterwards we can start to add the new device to our account. The app guides us through this setup. When the device first boots up it opens a wireless LAN hotspot. The mobile app instructs us to connect to it.

During this setup a secret key is being deployed on the device. This key appears to be specific to the logged in user.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage15.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage15.png)

After that setup, the device now connects to the provided wireless network and is ready to use. As the device is now part of the network, the first step was to run a port scan against it:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage03.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage03.png)

The device only opens one port, it is accepting HTTP requests on port 80. Simply requesting anything from it did not work, running any sort of directory brute force tool against it reliably crashed the device.

Next an iPhone was set up to send all traffic to a interception proxy and the application was used while being connected to the network. In that state, the mobile app directly uses the web server on the device to communicate with it.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage04-1024x357.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage04.png)

As can be seen in the screenshot, the message the web server accepts is JSON formatted and contains a payload as well as a header section. The header always contains a “`sign`” field. This field is signed using the previously deployed secret key. Any change of the message is detected and the system does not execute it:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage05-1024x430.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage05.png)

In the above case the timestamp was tampered with, and the device correctly rejected this message. Interestingly it appears that only the content of the header is signed but not the payload. Replaying that message but changing the “`open`” field in the header does get executed:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage06-1024x425.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage06.png)

This means if an attacker captures the request to close the garage door, that message can be altered to open the garage (or vice versa). Also this reveals that the device has no protection at all against replay attacks. The header includes a “`timestamp`” field which is part of the signature, but it is not verified that the timestamp is in an acceptable time-frame. Even a day old message can be replayed and it will get executed by the device.

Next the iPhone was moved to a different network to simulate the “open from anywhere” functionality. When doing so, the interception proxy did not capture any traffic that contained messages to open the garage door.

Capturing the network traffic at that point showed that the app does communicate outgoing on port 443 with host “54.77.214.248”, the traffic was encrypted but it was not HTTPS: [![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage07-1024x502.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage07.png)

The hostname “`mqtt-eu.meross.com`” already gave a hint that its using the MQTT protocol.

# Investigating the MQTT server

The Meross MQTT details have already been investigated by others. I found the GitHub repository [albertogeniola/MerossIot](https://github.com/albertogeniola/MerossIot) as well as [Apollon77/meross-cloud](https://github.com/Apollon77/meross-cloud) extremely helpful. Basically to connect to the Meross MQTT server we need the following:

* Username: the internal user ID assigned by Meross to our account
* Password: the secret key concatenated to the user ID, passed through md5
* Client ID: a specific string in the form of “app:<any md5-sum>”
* Topic(s) to subscribe to: topic names were already part of the HTTP messages

This is all easily obtainable, logging in with the mobile application gives us both the user ID as well as the secret key:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage08-1024x302.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage08.png)

Using the secret key we can create the password:

```

echo -n '1245194654bb6420ca3756d09030059deb828ad' |md5sum
774b1d8d8dfc2f38ffe78f93676a81e7  -

```

With this information we can now connect to the Meross MQTT server. I couldn’t figure out why, but I didn’t manage to connect through “`mosquitto_sub`“. Instead I used [MQTT Explorer](https://mqtt-explorer.com/) which worked without any problems.

The connection to the MQTT server will be done as the user “`1245194`“. This user was created only for this purpose. This user never had a device enrolled or attached to its account.

We use the following connection details:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage09.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage09.png)

As the client ID we set “`app:ca09923818dd826a8c09c702877db82b`” and that is all that is required to generally connect.

The structure of the used topics were found through the [albertogeniola/MerossIot](https://github.com/albertogeniola/MerossIot/blob/0.4.X.X/meross_iot/utilities/mqtt.py) GitHub repository. Each user on the platform has its own MQTT topic in the form of “`/app/<$userID>/subscribe`“. In this case, we do not subscribe to our own user ID, instead we subscribe to “`1238435`” – this is the user that has the device attached to its account.

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage10.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage10.png)

The connection with this setup is allowed. When the device is now being used by the owner or if the sensors notice a state change we also get those messages. For example, if the sensor is triggered from closed to open state the following message is sent to this topic:

```

{
  "header": {
    "triggerSrc": "DevicePysical",
    "timestampMs": 591,
    "timestamp": 1615975130,
    "sign": "67978ce3534b49079c5cdf5eb0ece248",
    "payloadVersion": 1,
    "namespace": "Appliance.GarageDoor.State",
    "method": "PUSH",
    "messageId": "8d73746387e131c8e09c637989a3a7de",
    "from": "/appliance/2008141004674336100348e1e92b352d/publish"
  },
  "payload": {
    "state": [
      {
        "open": 1,
        "lmTime": 1615975130,
        "channel": 0
      }
    ]
  }
}

```

In the payload this just tells us that at a specific time the state changed to “`1`“. In the header it is indicated that this being sent as a “`PUSH`” message. However, the message contains something much more interesting. In line 11 the “`from`” field tells us the ID of the garage opener device which triggered this message.

We reconnect to the MQTT server and this time we also subscribe to the topics “`/appliance/2008141004674336100348e1e92b352d/publish`” and “`/appliance/2008141004674336100348e1e92b352d/subscribe`“:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage11.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage11.png)

If the real user of the device now triggers an action, we can see the following message in the “`/appliance/2008141004674336100348e1e92b352d/subscribe`” topic:

```

{
  "payload" : {
    "state" : {
      "channel" : 0,
      "uuid" : "2008141004674336100348e1e92b352d",
      "open" : 1
    }
  },
  "header" : {
    "messageId" : "12c60e2beb46fb657ed06f96aad701fd",
    "method" : "SET",
    "from" : "\/app\/1238435-94CF07DCAD0730A36B1B895C61B45534\/subscribe",
    "payloadVersion" : 1,
    "namespace" : "Appliance.GarageDoor.State",
    "uuid" : "2008141004674336100348e1e92b352d",
    "sign" : "287965cf84bdf08b557163604acbd247",
    "triggerSrc" : "iOS",
    "timestamp" : 1615976692
  }
}

```

This is the signed message which was sent to open the garage. This message can now be taken and be resent using the MQTT service to open or close the garage door. Since the payload is not signed only a single “`SET`” message must be captured and as there is no replay protection this message can be used at any later time.

This absolutely works, resending this message like this:

[![](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage12.png)](https://infosec.rm-it.de/wp-content/uploads/2021/03/garage12.png)

Triggers the local device to close the door, closing the door is causing the device indicate this with loud beeping.

With these two issues combined, an attacker could capture the signed messages over a longer period of time and at some point replay them to open all garage doors that were actively used in the observation timeframe.

# Vulnerabilities

This is the condensed list of vulnerabilities identified during this research in order of appearance.

## 1. No replay attack protection (CVE-**2021-35067**)

The Meross devices accept JSON payload to trigger actions such as open or close of garage doors. This JSON is either sent directly via plain-text HTTP to the device if the mobile app is in the same network or through MQTT if the mobile app is anywhere else.

The JSON is signed, but no replay protection has been implemented. Additionally only the header is signed, not the full payload. Even a days old message can be re-sent to the device which will execute it. An attacker must only gain access to the close or open message once. They can then later re-use it multiple times.

Due to the incomplete signing of the JSON a message to close the device can be altered to open it.

*Update on 2021-06-18:*Meross told me they are releasing firmware version 3.2.3 which resolves this. I was not able to verify this yet due to time constraints.

*Update on 2021-07-04:* I was able to confirm that the vulnerability is closed in version 3.2.3.

## 2. MQTT server allows access to other devices

The central Meross MQTT server does not check if the connecting user ID is identical with the user ID to which it is subscribing. Practically this means that attackers can access the MQTT user ID topics of all users. They must only guess the user IDs which are numeric and ascending.

If the real user is triggering actions on the device while the attacker is subscribed to the user ID topic, then the unique device ID will be leaked. Using this the attacker can then subscribe to the device specific topic.

If the real user is again triggering an action, then the attacker gains access to the signed message with which this action was triggered. This message can then be replayed as per the previous vulnerability.

*Update on 2021-05-30:* Meross has fixed this vulnerability.

It is no longer possible to subscribe to topics of other users.

# Conclusion

The Meross system contained multiple flaws which combined could have given attackers the ability to unauthorized open garage doors. The same was possible with Meross smart Wi-Fi plugs, they simply used different device IDs but the process was exactly the same.

The devices did not protect against replay attacks of any messages.

Additionally these messages were not protected when the mobile application is used outside of the local network. Anyone could subscribe to the MQTT topics on the central Meross MQTT server and gain access to these signed messages.

An attacker could wait to get access to the desired message (open/close or on/off) and replay it at a later time.

After contacting Meross with the details of the vulnerabilities they responded very quickly and showed an effort to fix the vulnerabilities. In the end the MQTT vulnerabilities were completely resolved. Meross also released a new firmware version which should resolve the replay attack vulnerability, however I could not verify this yet due to time constrains (*Update*: I confirmed that this is resolved as well).

However, without the ability to capture the signed messages centrally from the MQTT server, the risk of this vulnerability is greatly reduced even if the replay attack is still possible. An attacker would now need to be in a position to already capture network traffic to the garage door opener locally in the network.

# Disclosure timeline

2021-03-17: Vulnerabilities initially identified, first attempt to contact Meross

2021-03-20: Sent vulnerability report to correct contact

2021-03-24: Meross acknowledges the vulnerabilities, says they are working on a fix

2021-05-24: Meross releases fixes and invite me to test them

2021-05-30: I retest and confirm the MQTT issue to be fixed but replay attack remains unfixed, asking Meross for clarification

2021-06-18: Meross says version 3.2.3 fixes the replay vulnerability

2021-06-18: Publication of this blogpost after 90 days since initial disclosure

2021-06-29: Meross responded that CVE-2021-35067 has been assigned to the replay attack vulnerability

2021-07-04: I was able to confirm that version 3.2.3 fixes the replay attack vulnerability

This entry was posted in [Research](https://infosec.rm-it.de/category/research/) by [Roman](https://infosec.rm-it.de/author/roman/). Bookmark the [permalink](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/ "Permalink to Meross Smart Wi-Fi Garage Door Opener analysis").

## 6 thoughts on “Meross Smart Wi-Fi Garage Door Opener analysis”

1. ![](https://secure.gravatar.com/avatar/6ac20ff137222a5f6d8601a124c8761d?s=68&d=mm&r=g)Gerard on [2021-10-05 at 10:17](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-10757) said:

   Good job!

   But why is still in reserved state the CVE-2021-35067 ?

   [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=10757#respond)
   * ![](https://secure.gravatar.com/avatar/d8d088755860c7441743a211c1752354?s=39&d=mm&r=g)Roman on [2021-10-05 at 21:05](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-10771) said:

     It was requested by the manufacturer, I have requested publication through Mitre now but I’m not sure if this will work.

     I don’t know which CNA even assigned the CVE.

     [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=10771#respond)
     + ![](https://secure.gravatar.com/avatar/6ac20ff137222a5f6d8601a124c8761d?s=39&d=mm&r=g)Gerard on [2021-10-07 at 02:31](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-11038) said:

       Hi again Roman;

       I also requested one through default MITRE as CNA of last resort but received no answer. I forwarded to Spanish (INCIBE) that act as root role and finally have a CVE ID but under reserved state (INCIBE is working with Meross before get the publication of the vulnerability). I discovered that the wifi password is sent in plaintext Base 64 codification in an smart wifi wall switch product, MSS550X. My work is explained here:

       <https://www.slideshare.net/fuguet/my-neighbors-flat-smells-like-data>

       A video was made to transmit the awareness of it:

       <https://youtu.be/pMzULxYDsNM>

       Many thanks and take care

       [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=11038#respond)
       - ![](https://secure.gravatar.com/avatar/321a9dadac42ee22c8e5e21dc8ff139c?s=39&d=mm&r=g)Gerard on [2021-11-06 at 01:50](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-12366) said:

         This is my true evidence that I wasn’t lying, no fake:

         CVE-2021-3774

         <https://www.cve.org/CVERecord?id=CVE-2021-3774>

         [Reply ↓](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/?replytocom=12366#respond)
         * ![](https://secure.gravatar.com/avatar/d8d088755860c7441743a211c1752354?s=39&d=mm&r=g)Roman on [2021-11-06 at 09:30](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#comment-12381) said:

           Nice one!

           My CVE also got published in the meantime.
3. Pingback: [Blurams Lumi Security Camera analysis | InfoSec @ rm-it](https://infosec.rm-it.de/2024/02/01/blurams-lumi-security-camera-analysis/)

### Leave a Reply [Cancel reply](/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

### Recent Posts

* [Circumvention of Apple iOS Mail App “Different Reply Address” warning](https://infosec.rm-it.de/2024/06/24/circumvention-of-apple-ios-mail-app-different-reply-address-warning/)
* [Blurams Lumi Security Camera analysis](https://infosec.rm-it.de/2024/02/01/blurams-lumi-security-camera-analysis/)
* [HackTheBox Business CTF 2022 – Trade](https://infosec.rm-it.de/2022/07/17/hackthebox-business-ctf-2022-trade/)
* [Meross Smart Wi-Fi Garage Door Opener analysis](https://infosec.rm-it.de/2021/06/18/meross-smart-wi-fi-garage-door-opener-analysis/)
* [BASETech IP camera analysis](https://infosec.rm-it.de/2020/11/04/basetech-ip-camera-analysis/)
### Archives

* [June 2024](https://infosec.rm-it.de/2024/06/)
* [February 2024](https://infosec.rm-it.de/2024/02/)
* [July 2022](https://infosec.rm-it.de/2022/07/)
* [June 2021](https://infosec.rm-it.de/2021/06/)
* [November 2020](https://infosec.rm-it.de/2020/11/)
* [June 2020](https://infosec.rm-it.de/2020/06/)
* [April 2020](https://infosec.rm-it.de/2020/04/)
* [March 2020](https://infosec.rm-it.de/2020/03/)
* [January 2020](https://infosec.rm-it.de/2020/01/)
* [December 2019](https://infosec.rm-it.de/2019/12/)
* [November 2019](https://infosec.rm-it.de/2019/11/)
* [October 2019](https://infosec.rm-it.de/2019/10/)
* [September 2019](https://infosec.rm-it.de/2019/09/)
* [July 2019](https://infosec.rm-it.de/2019/07/)
* [April 2019](https://infosec.rm-it.de/2019/04/)
* [December 2018](https://infosec.rm-it.de/2018/12/)
* [October 2018](https://infosec.rm-it.de/2018/10/)
* [August 2018](https://infosec.rm-it.de/2018/08/)
* [July 2018](https://infosec.rm-it.de/2018/07/)
* [June 2018](https://infosec.rm-it.de/2018/06/)
* [April 2018](https://infosec.rm-it.de/2018/04/)
* [March 2018](https://infosec.rm-it.de/2018/03/)
* [February 2018](https://infosec.rm-it.de/2018/02/)
* [November 2017](https://infosec.rm-it.de/2017/11/)
* [August 2017](https://infosec.rm-it.de/2017/08/)
* [July 2017](https://infosec.rm-it.de/2017/07/)
* [June 2017](https://infosec.rm-it.de/2017/06/)
* [January 2016](https://infosec.rm-it.de/2016/01/)
* [June 2012](https://infosec.rm-it.de/2012/06/)
* [April 2012](https://infosec.rm-it.de/2012/04/)
### Categories

* [CTF](https://infosec.rm-it.de/category/ctf/)
* [HackTheBox](https://infosec.rm-it.de/category/hackthebox/)
* [Research](https://infosec.rm-it.de/category/research/)
* [Uncategorized](https://infosec.rm-it.de/category/uncategorized/)

[Proudly powered by WordPress](https://wordpress.org/ "Semantic Personal Publishing Platform")


