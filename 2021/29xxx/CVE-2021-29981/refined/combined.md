=== Content from security.gentoo.org_ffa2d904_20250114_204906.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202202-03**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-91.6.0:esr"

```

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-91.6.0:esr"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-97.0:rapid"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-97.0:rapid"

```
### References

* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29972](https://nvd.nist.gov/vuln/detail/CVE-2021-29972)
* [CVE-2021-29974](https://nvd.nist.gov/vuln/detail/CVE-2021-29974)
* [CVE-2021-29975](https://nvd.nist.gov/vuln/detail/CVE-2021-29975)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29977](https://nvd.nist.gov/vuln/detail/CVE-2021-29977)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29981](https://nvd.nist.gov/vuln/detail/CVE-2021-29981)
* [CVE-2021-29982](https://nvd.nist.gov/vuln/detail/CVE-2021-29982)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29987](https://nvd.nist.gov/vuln/detail/CVE-2021-29987)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-29990](https://nvd.nist.gov/vuln/detail/CVE-2021-29990)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38491](https://nvd.nist.gov/vuln/detail/CVE-2021-38491)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43540](https://nvd.nist.gov/vuln/detail/CVE-2021-43540)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0511](https://nvd.nist.gov/vuln/detail/CVE-2022-0511)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22753](https://nvd.nist.gov/vuln/detail/CVE-2022-22753)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22755](https://nvd.nist.gov/vuln/detail/CVE-2022-22755)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22757](https://nvd.nist.gov/vuln/detail/CVE-2022-22757)
* [CVE-2022-22758](https://nvd.nist.gov/vuln/detail/CVE-2022-22758)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22762](https://nvd.nist.gov/vuln/detail/CVE-2022-22762)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* MOZ-2021-0004
* MOZ-2021-0005
* MOZ-2021-0006
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

February 21, 2022

**Latest revision**

February 21, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [802768](https://bugs.gentoo.org/show_bug.cgi?id=802768)
* [807947](https://bugs.gentoo.org/show_bug.cgi?id=807947)
* [813498](https://bugs.gentoo.org/show_bug.cgi?id=813498)
* [821385](https://bugs.gentoo.org/show_bug.cgi?id=821385)
* [828538](https://bugs.gentoo.org/show_bug.cgi?id=828538)
* [831039](https://bugs.gentoo.org/show_bug.cgi?id=831039)
* [832992](https://bugs.gentoo.org/show_bug.cgi?id=832992)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_6b3ff753_20250114_204908.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-36

## Security Vulnerabilities fixed in Thunderbird 91

Announced
August 11, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Thunderbird incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Thunderbird on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Thunderbird 91](#CVE-2021-29989)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Kershaw Chang, Philipp, Chris Peterson, Sebastian Hengst, Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in versions of Thunderbird prior to 91. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568%2C1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_c3cab586_20250114_204907.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-33

## Security Vulnerabilities fixed in Firefox 91

Announced
August 10, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 91

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29983: Firefox for Android could get stuck in fullscreen mode](#CVE-2021-29983)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox for Android could get stuck in fullscreen mode and not exit it even after normal interactions that should cause it to exit.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1719088](https://bugzilla.mozilla.org/show_bug.cgi?id=1719088)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Firefox on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

#### [#CVE-2021-29990: Memory safety bugs fixed in Firefox 91](#CVE-2021-29990)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Kershaw Chang, Philipp, Chris Peterson, and Sebastian Hengst reported memory safety bugs present in Firefox 90. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_5a3c9dc6_20250114_204906.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1707774)
* [XML](/show_bug.cgi?ctype=xml&id=1707774)

Closed
[Bug 1707774](/show_bug.cgi?id=1707774)
(CVE-2021-29981)

Opened 4 years ago
Closed 4 years ago

# Live range splitting can lead to conflicting assignments (was: Assertion failure: \*def->output() == alloc, at jit/RegisterAllocator.cpp:257)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Live range splitting can lead to conflicting assignments (was: Assertion failure: \*def->output() == alloc, at jit/RegisterAllocator.cpp:257)

## Categories

### (Core :: JavaScript Engine: JIT, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

91 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected) |
| firefox88 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=unaffected) |
| firefox89 | --- | [disabled](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=disabled) |
| firefox90 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix) |
| firefox91 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox88 |  | unaffected |
| firefox89 |  | disabled |
| firefox90 |  | wontfix |
| firefox91 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: lth)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/07d963875f2649f1be70d286f5164fb4?d=mm&size=40)  [lth](/user_profile?user_id=499633)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

### (Blocks 1 open bug, Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1715203](/show_bug.cgi?id=1715203 "RESOLVED FIXED - Create abstraction to aid register selection during lowering")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[gkw-js-fuzzing](/show_bug.cgi?id=1890610 "NEW - [meta] Gary JavaScript engine Fuzzing")

Dependency [tree](/showdependencytree.cgi?id=1707774&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1707774)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1686626](/show_bug.cgi?id=1686626 "RESOLVED FIXED - Enable Ion by default for wasm on AArch64")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sec-survey][post-critsmash-triage][adv-main91+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29981

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sec-survey][post-critsmash-triage][adv-main91+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a3695606_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a4886895_553429 "4 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 5 obsolete files)

| [testcase.wasm](/attachment.cgi?id=9218516)  [4 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   106 bytes, application/wasm |  | [Details](/attachment.cgi?id=9218516&action=edit) |
| --- | --- | --- |
| [03-regalloc-1707774.diff](/attachment.cgi?id=9220748)  [4 years ago](#c19)  [Julian Seward [:jseward]](/user_profile?user_id=346453)   3.38 KB, patch |  | [Details](/attachment.cgi?id=9220748&action=edit) | [Diff](/attachment.cgi?id=9220748&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1707774&attachment=9220748) |
| [experiment.patch](/attachment.cgi?id=9221486)  [4 years ago](#c21)  [Lars T Hansen [:lth]](/user_profile?user_id=499633)   1.57 KB, patch |  | [Details](/attachment.cgi?id=9221486&action=edit) | [Diff](/attachment.cgi?id=9221486&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1707774&attachment=9221486) |
| [Tweaks + test case to demonstrate issue](/attachment.cgi?id=9222922)  [4 years ago](#c32)  [Lars T Hansen [:lth]](/user_profile?user_id=499633)   2.88 KB, text/plain |  | [Details](/attachment.cgi?id=9222922&action=edit) |
| [Bug 1707774 - Fix. r?jseward](/attachment.cgi?id=9222926)  [4 years ago](#c33)  [Lars T Hansen [:lth]](/user_profile?user_id=499633)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9222926&action=edit) | [Review](/attachment.cgi?id=9222926) |
| [Bug 1707774 - Test case and comments. r?jseward](/attachment.cgi?id=9222927)  [4 years ago](#c34)  [Lars T Hansen [:lth]](/user_profile?user_id=499633)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9222927&action=edit) | [Review](/attachment.cgi?id=9222927) |
| [Bug 1707774 - More subtle equality on MDefinition\* during lowering. r=nbp!,jandem!,jseward!](/attachment.cgi?id=9224423)  [4 years ago](#c38)  [Lars T Hansen [:lth]](/user_profile?user_id=499633)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9224423&action=edit) | [Review](/attachment.cgi?id=9224423) |
| [advisory.txt](/attachment.cgi?id=9235152)  [3 years ago](#c46)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   244 bytes, text/plain |  | [Details](/attachment.cgi?id=9235152&action=edit) |
| [advisory.txt](/attachment.cgi?id=9235166)  [3 years ago](#c47)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   255 bytes, text/plain |  | [Details](/attachment.cgi?id=9235166&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1707774#c0)• 4 years ago |
|  | |

Attached file
[testcase.wasm](attachment.cgi?id=9218516)
— [Details](attachment.cgi?id=9218516&action=edit)

This is `testcase.wrapper`, `testcase.wasm` is attached.

```
new WebAssembly.Instance(new WebAssembly.Module(read(scriptArgs[0], "binary")));

```
```
Process 36979 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
    frame #0: 0x0000000100977330 js-dbg-64-darwin-arm64-15253a3168d2`_OUTLINED_FUNCTION_0 [opt]
js-dbg-64-darwin-arm64-15253a3168d2`_OUTLINED_FUNCTION_0:
->  0x100977330 <+0>: str    w19, [x8]
    0x100977334 <+4>: b      0x101406e94               ; symbol stub for: abort

js-dbg-64-darwin-arm64-15253a3168d2`_OUTLINED_FUNCTION_1:
    0x100977338 <+0>: mov    w19, #0x476
    0x10097733c <+4>: mov    w2, #0x476
Target 0: (js-dbg-64-darwin-arm64-15253a3168d2) stopped.
(lldb) bt
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
  * frame #0: 0x0000000100977330 js-dbg-64-darwin-arm64-15253a3168d2`_OUTLINED_FUNCTION_0 [opt]
    frame #1: 0x000000010132dafc js-dbg-64-darwin-arm64-15253a3168d2`js::jit::AllocationIntegrityState::checkIntegrity(js::jit::LBlock*, js::jit::LInstruction*, unsigned int, js::jit::LAllocation) (.cold.17) at RegisterAllocator.cpp:39:19 [opt]
    frame #2: 0x000000010096d280 js-dbg-64-darwin-arm64-15253a3168d2`js::jit::AllocationIntegrityState::checkIntegrity(this=0x000000016fdf9a98, block=0x00000001060ebc28, ins=<unavailable>, vreg=7, alloc=(bits_ = 27)) at RegisterAllocator.cpp:257:9 [opt]
    frame #3: 0x000000010096bf80 js-dbg-64-darwin-arm64-15253a3168d2`js::jit::AllocationIntegrityState::check(this=0x000000016fdf9a98) at RegisterAllocator.cpp:207:14 [opt]
    frame #4: 0x00000001008ab05c js-dbg-64-darwin-arm64-15253a3168d2`js::jit::GenerateLIR(mir=0x000000016fdf9ef0) at Ion.cpp:1536:26 [opt]
    frame #5: 0x00000001009fe26c js-dbg-64-darwin-arm64-15253a3168d2`js::wasm::IonCompileFunctions(moduleEnv=0x000000016fdfda90, compilerEnv=<unavailable>, lifo=0x0000000105785820, inputs=<unavailable>, code=<unavailable>, error=<unavailable>) at WasmIonCompile.cpp:5760:23 [opt]
    frame #6: 0x00000001009e8c6c js-dbg-64-darwin-arm64-15253a3168d2`ExecuteCompileTask(task=0x0000000105785800, error=0x000000016fdfde50) at WasmGenerator.cpp:781:16 [opt]
    frame #7: 0x00000001009e9610 js-dbg-64-darwin-arm64-15253a3168d2`js::wasm::ModuleGenerator::finishFuncDefs() [inlined] js::wasm::ModuleGenerator::locallyCompileCurrentTask(this=0x000000016fdfc8d0) at WasmGenerator.cpp:842:8 [opt]
    frame #8: 0x00000001009e9608 js-dbg-64-darwin-arm64-15253a3168d2`js::wasm::ModuleGenerator::finishFuncDefs(this=0x000000016fdfc8d0) at WasmGenerator.cpp:980 [opt]
    frame #9: 0x00000001009c33b0 js-dbg-64-darwin-arm64-15253a3168d2`bool DecodeCodeSection<js::wasm::Decoder>(env=0x000000016fdfda90, d=0x000000016fdfc890, mg=0x000000016fdfc8d0) at WasmCompile.cpp:686:13 [opt]
    frame #10: 0x00000001009c304c js-dbg-64-darwin-arm64-15253a3168d2`js::wasm::CompileBuffer(args=<unavailable>, bytecode=<unavailable>, error=<unavailable>, warnings=<unavailable>, listener=<unavailable>) at WasmCompile.cpp:708:8 [opt]
    frame #11: 0x0000000100a1375c js-dbg-64-darwin-arm64-15253a3168d2`js::WasmModuleObject::construct(cx=0x0000000105743000, argc=<unavailable>, vp=<unavailable>) at WasmJS.cpp:1517:7 [opt]
    frame #12: 0x0000000100073eb0 js-dbg-64-darwin-arm64-15253a3168d2`CallJSNative(cx=0x0000000105743000, native=(js-dbg-64-darwin-arm64-15253a3168d2`js::WasmModuleObject::construct(JSContext*, unsigned int, JS::Value*) at WasmJS.cpp:1483), reason=<unavailable>, args=0x000000016fdfe198)(JSContext*, unsigned int, JS::Value*), js::CallReason, JS::CallArgs const&) at Interpreter.cpp:437:13 [opt]
    frame #13: 0x000000010007c5f4 js-dbg-64-darwin-arm64-15253a3168d2`CallJSNativeConstructor(cx=0x0000000105743000, native=(js-dbg-64-darwin-arm64-15253a3168d2`js::WasmModuleObject::construct(JSContext*, unsigned int, JS::Value*) at WasmJS.cpp:1483), args=0x000000016fdfe198)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&) at Interpreter.cpp:453:8 [opt]
    frame #14: 0x00000001000748b0 js-dbg-64-darwin-arm64-15253a3168d2`InternalConstruct(cx=<unavailable>, args=0x000000016fdfe198) at Interpreter.cpp:626:14 [opt]
    frame #15: 0x00000001000745d8 js-dbg-64-darwin-arm64-15253a3168d2`js::ConstructFromStack(cx=<unavailable>, args=<unavailable>) at Interpreter.cpp:672:10 [opt] [artificial]
    frame #16: 0x000000010006b900 js-dbg-64-darwin-arm64-15253a3168d2`Interpret(cx=<unavailable>, state=0x000000016fdfe630) at Interpreter.cpp:3238:16 [opt]
    frame #17: 0x00000001000648f0 js-dbg-64-darwin-arm64-15253a3168d2`js::RunScript(cx=0x0000000105743000, state=0x000000016fdfe630) at Interpreter.cpp:406:13 [opt]
    frame #18: 0x00000001000750e4 js-dbg-64-darwin-arm64-15253a3168d2`js::ExecuteKernel(cx=0x0000000105743000, script=<unavailable>, envChainArg=JS::HandleObject @ x21, newTargetValue=<unavailable>, evalInFrame=(ptr_ = 0), result=JS::MutableHandleValue @ 0x000000016fdfe6a0) at Interpreter.cpp:776:13 [opt]
    frame #19: 0x0000000100075320 js-dbg-64-darwin-arm64-15253a3168d2`js::Execute(cx=0x0000000105743000, script=JS::HandleScript @ x21, envChain=JS::HandleObject @ x20, rval=JS::MutableHandleValue @ x19) at Interpreter.cpp:808:10 [opt]
    frame #20: 0x000000010015de94 js-dbg-64-darwin-arm64-15253a3168d2`ExecuteScript(cx=0x0000000105743000, envChain=JS::HandleObject @ 0x000000016fdfe780, script=JS::HandleScript @ 0x000000016fdfe778, rval=JS::MutableHandleValue @ x19) at CompilationAndEvaluation.cpp:491:10 [opt]
    frame #21: 0x000000010015e068 js-dbg-64-darwin-arm64-15253a3168d2`JS_ExecuteScript(cx=0x0000000105743000, scriptArg=JS::HandleScript @ x19) at CompilationAndEvaluation.cpp:515:10 [opt]
    frame #22: 0x00000001000463cc js-dbg-64-darwin-arm64-15253a3168d2`RunFile(cx=0x0000000105743000, filename=<unavailable>, file=<unavailable>, compileMethod=<unavailable>, compileOnly=false) at js.cpp:1065:10 [opt]
    frame #23: 0x0000000100045d68 js-dbg-64-darwin-arm64-15253a3168d2`Process(cx=0x0000000105743000, filename="testcase.wrapper", forceTTY=false, kind=FileScript) at js.cpp:1656:14 [opt]
    frame #24: 0x00000001000103b4 js-dbg-64-darwin-arm64-15253a3168d2`Shell(JSContext*, js::cli::OptionParser*, char**) at js.cpp:10934:10 [opt]
    frame #25: 0x0000000100010360 js-dbg-64-darwin-arm64-15253a3168d2`Shell(cx=<unavailable>, op=0x000000016fdff270, envp=<unavailable>) at js.cpp:11658 [opt]
    frame #26: 0x000000010000a908 js-dbg-64-darwin-arm64-15253a3168d2`main(argc=<unavailable>, argv=<unavailable>, envp=<unavailable>) at js.cpp:12613:12 [opt]
    frame #27: 0x000000019b1c5f34 libdyld.dylib`start + 4

```
```
The first bad revision is:
changeset:   https://hg.mozilla.org/mozilla-central/rev/b3dfcb849dd2
user:        Julian Seward
date:        Wed Apr 14 07:43:27 2021 +0000
summary:     Bug 1686626 - Enable Ion by default for wasm on AArch64.  r=lth.

```

Run with `--fuzzing-safe --no-threads --no-baseline --no-ion testcase.wrapper testcase.wasm`, compile with `AUTOCONF=/usr/local/Cellar/autoconf213/2.13/bin/autoconf213 AR=ar sh ./configure --enable-debug --with-ccache --enable-gczeal --enable-debug-symbols --disable-tests`, tested on m-c rev 15253a3168d2.

Not sure if this is s-s, I'd leave it to Julian/Lars.

Flags: sec-bounty?Flags: needinfo?(jseward)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1707774#c1)• 4 years ago |
|  | |

I'll take a look.

Flags: needinfo?(jseward)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1707774#c2)• 4 years ago |
|  | |

Simplified tc, run in a debug-enabled build without any special flags:

```
new WebAssembly.Module(wasmTextToBinary(`
(module
  (func (result i64)
    (local i32 i64)
    (if (global.get 0)
        (return (i64.const 7)))
    loop
      (if (global.get 0)
          (return (i64.const 8)))
    end
    (if (global.get 0)
        (return (i64.const 6)))
    (local.set 1 (i64.mul (local.get 1) (local.get 1)))
    (if (global.get 0)
        (return (local.get 1)))
    (global.set 0 (local.get 0))
    (i64.add (i64.load (local.get 0)) (local.get 1)))
  (memory (;0;) 1)
  (global (;0;) (mut i32) (i32.const 2)))
`))

```

None of the remaining expressions appear removable, and in the last if, the value returned can't be replaced by a constant.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1707774#c3)• 4 years ago |
|  | |

Also fails on an ARM64 simulator build, M1 hardware not required. But does not fail on x64, so this is something about how the JIT is configured / used.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1707774#c4)• 4 years ago |
|  | |

On ARM64,

```
 void LIRGeneratorARM64::lowerForMulInt64(LMulI64* ins, MMul* mir,
                                          MDefinition* lhs, MDefinition* rhs) {
   ins->setInt64Operand(0, useInt64RegisterAtStart(lhs));
   ins->setInt64Operand(INT64_PIECES, (lhs != rhs)
                                         ? useInt64Register(rhs)
                                         : useInt64RegisterAtStart(rhs));
   defineInt64ReuseInput(ins, mir, 0);
 }

```

However, while lhs == rhs in the input, the input is also a constant (local 1 starts out as zero and is not updated at that point), and apparently useInt64RegisterAtStart does not work well with constant inputs. The allocator produces this mess:

```
[RegAlloc]   Block 7 [successor 8] [successor 9]
[RegAlloc]     [28,29 Integer64] [def v6<g>:x1]
[RegAlloc]     [MoveGroup] [x1 -> x3]
[RegAlloc]     [30,31 Integer64] [def v7<g>:x1]
[RegAlloc]     [MoveGroup] [x3 -> x1] [x3 -> x2]
[RegAlloc]     [32,33 MulI64] [def v8<g>:x1] [use v6:r x1] [use v7:r x1]
[RegAlloc]     [MoveGroup] [x1 -> x3]
[RegAlloc]     [34,35 TestIAndBranch] [use v2:r x0]

```

If we guard against this s.t. we use useInt64Register also if rhs is constant:

```
diff --git a/js/src/jit/arm64/Lowering-arm64.cpp b/js/src/jit/arm64/Lowering-arm64.cpp
--- a/js/src/jit/arm64/Lowering-arm64.cpp
+++ b/js/src/jit/arm64/Lowering-arm64.cpp
@@ -153,7 +153,7 @@ void LIRGeneratorARM64::lowerForALUInt64
 void LIRGeneratorARM64::lowerForMulInt64(LMulI64* ins, MMul* mir,
                                          MDefinition* lhs, MDefinition* rhs) {
   ins->setInt64Operand(0, useInt64RegisterAtStart(lhs));
-  ins->setInt64Operand(INT64_PIECES, (lhs != rhs)
+  ins->setInt64Operand(INT64_PIECES, (lhs != rhs || rhs->isConstant())
                                          ? useInt64Register(rhs)
                                          : useInt64RegisterAtStart(rhs));
   defineInt64ReuseInput(ins, mir, 0);

```

then the allocation is sane:

```
[RegAlloc]   Block 7 [successor 8] [successor 9]
[RegAlloc]     [32,33 Integer64] [def v8<g>:x0]
[RegAlloc]     [34,35 Integer64] [def v9<g>:x2]
[RegAlloc]     [36,37 MulI64] [def v10<g>:x0] [use v8:r x0] [use v9:r x2]
[RegAlloc]     [MoveGroup] [x0 -> x3]
[RegAlloc]     [38,39 TestIAndBranch] [use v4:r x1]

```

though not actually good, obviously.

But *I think* that what we want is not that guard but something deeper in the regalloc that handles the constant case for us by forcing the constant, if present, into a register. Presumably there's a divergence here between the 32-bit and the 64-bit case, that we've just not come across before.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1707774#c5)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15381996 "1 revision") |
|  | |

MIPS64 does not have this problem for multiply, as it uses useInt64OrConstant(AtStart) here, we're running into this on ARM64 only because we (possibly I) were too lazy to implement support for multiply-by-constant earlier.

MWasmStore could be similarly afflicted on ARM64 and MIPS64 because it has a useInt64RegisterAtStart for an rhs operand that could plausibly be a constant. There appear to be no other uses of useInt64RegisterAtStart in non-lhs contexts.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1707774#c6)• 4 years ago |
|  | |

It could however look like it's the handling of v6 (the lhs for the multiply) that is the problem:

```
[RegAlloc] Allocating  v6 [29,33) (def) v6:r?@32 ## v8 [33,48) (def) v8:x0@37 v8:r@47 [priority 19] [weight 473]
[RegAlloc]   Requirement x0, due to use at 37
[RegAlloc]   x0 collides with  v2 [5,8) x0 (def) v2:r@7 ## v2 [12,18) x0 v2:r@17 ## v2 [22,24) x0 v2:r@23 ## v2 [28,36) x0 v2:r@35 [weight 526]
[RegAlloc]   bundle does not contain hot code
[RegAlloc]   bundle is defined by a register
[RegAlloc]   bundle has no register uses
[RegAlloc]     splitting bundle  v6 [29,33) (def) ## v8 [33,48) (def) into:
[RegAlloc]        v6 [29,30) (def)
[RegAlloc]        v6 [32,33) v6:r?@32
[RegAlloc]        v8 [33,34) (def)
[RegAlloc]        v8 [36,38) v8:x0@37
[RegAlloc]        v8 [46,48) v8:r@47
[RegAlloc]        v6 [30,33) ## v8 [34,48)

```

This split has two overlapping bundles for v6, [32,33) and [30,33) ## [34,48), where the first is allocated to x2 and the second is allocated to x3, based on subsequent spew. This could account for the assertion.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a33177_499633)• 4 years ago |

Blocks: [1687626](/show_bug.cgi?id=1687626 "RESOLVED FIXED - Ship Ion for WebAssembly on ARM64")Severity: -- → S2Priority: -- → P1

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1707774#c7)• 4 years ago |
|  | |

Set release status flags based on info from the regressing [bug 1686626](/show_bug.cgi?id=1686626 "RESOLVED FIXED - Enable Ion by default for wasm on AArch64")

[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=unaffected)
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1707774#c8)• 4 years ago |
|  | |

Feature is nightly-only until FF90.

[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1707774#c9)• 4 years ago |
|  | |

(In reply to Lars T Hansen [:lth] from [comment #8](/show_bug.cgi?id=1707774#c8 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"))

> Feature is nightly-only until FF90.

We prefer "disabled" rather than "unaffected". "unaffected" means the bug doesn't exist, in which case we wouldn't have testcases that "work".

Lars didn't directly answer the question, but misusing JIT registers sounds ungood for security. Please correct if wrong.

Group: core-security → javascript-core-security
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=unaffected) → [disabled](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=disabled)Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1707774#c10)• 4 years ago |
|  | |

Nomenclature correction seen; thanks.

Re severity, I think we'll have to wait and see, if it turns out to be only a problem with the i64 multiplication code or even with how the regalloc handles 64-bit values then this is relatively benign, but if it's a problem with the register allocator's general splitting logic then it's likely bad.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1707774#c11)• 4 years ago |
|  | |

Slightly simplified further, it gets rid of the spurious i32 local and makes the result not depend on the value loaded from memory, it becomes clear that a number of things are for their effect on the shape of the compile-time flow graph or on run-time control flow:

```
new WebAssembly.Module(wasmTextToBinary(`
(module
  (func (result i64)
    (local $n i64)                ;; zero
    (if (global.get $flag)        ;; do not
        (return (i64.const 7)))   ;;  touch $n
    loop                          ;;   but
      (if (global.get $flag)      ;;    introduce
          (return (i64.const 8))) ;;     confusing
    end                           ;;      control
    (if (global.get $flag)        ;;       flow
        (return (i64.const 6)))   ;;        constructs
    (local.set $n                 ;; $n = zero, but this is
      (i64.mul (local.get $n)     ;;  not known because i64.mul
               (local.get $n)))   ;;   is not constant folded
    (if (global.get $flag)        ;; conditionally
        (return (local.get $n)))  ;;  read $n
    (global.set $flag             ;; introduce
      (i32.const 1))              ;;  global effect
    (i64.load (i32.const 48))     ;; maybe traps
    drop                          ;;  but ignore result
    (local.get $n))               ;; read $n
  (memory 1)
  (global $flag (mut i32) (i32.const 2)))
`))

```

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1707774#c12)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15385892 "1 revision") |
|  | |

Odds and ends:

Replacing `loop` with `block` has the effect of removing an intermediate Block in the flow graph that contains only a Goto. In turn this means that v6 is given higher priority than v2 (the value read from the global) during allocation and so no splitting is triggered for v6 to resolve the fact that x0 is busy (for v2) yet needed for v6 (for the result of the function); hence the `block` version succeeds.

Presumably, `loop` ensures that v2 gets higher priority because it is presumed to be used more (because, it's in a loop).

FWIW, `loop` has a secondary effect: it introduces an interrupt check. Not obvious that this matters for anything.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1707774#c13)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15385909 "3 revisions") |
|  | |

Getting rid of loop by using v2 more, and get rid of the setting of $flag. I'm starting to suspect that the effect of the load is simply to make x0 be allocated to something other than $n in the function tail.

```
new WebAssembly.Module(wasmTextToBinary(`
(module
  (func (result i64)
    (local $n i64)                ;; zero
    (if (global.get $flag)        ;; give $flag high priority;
        (return (i64.const 7)))   ;;  do not touch $n
    (if (global.get $flag)
        (return (i64.const 8)))
    (if (global.get $flag)
        (return (i64.const 9)))
    (if (global.get $flag)
        (return (i64.const 10)))
    (if (global.get $flag)
        (return (i64.const 11)))
    (if (global.get $flag)
        (return (i64.const 12)))
    (local.set $n                 ;; $n = zero, but this is
      (i64.mul (local.get $n)     ;;  not known because i64.mul
               (local.get $n)))   ;;   is not constant folded
    (if (global.get $flag)        ;; conditionally
        (return (local.get $n)))  ;;  read $n
    (i64.load (i32.const 48))     ;; maybe traps
    drop                          ;;  but ignore result
    (local.get $n))               ;; read $n
  (memory 1)
  (global $flag (mut i32) (i32.const 2)))
`))

```

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1707774#c14)• 4 years ago |
|  | |

Assigning to Julian on the preliminary assumption that this is a problem with range splitting.

Assignee: nobody → jsewardStatus: NEW → ASSIGNED

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1707774#c15)• 4 years ago |
|  | |

Here are two possible fixes for discussion. They seem to work in that they

don't break jit-tests, and they don't fail on the above case. Both fixes

require implementing multiply-by-constant in CodeGenerator::visitMulI64, which

I have done, and seems wise anyway.

-- Proposal 1 ------------------------

```
void LIRGeneratorARM64::lowerForMulInt64(LMulI64* ins, MMul* mir,
                                         MDefinition* lhs, MDefinition* rhs) {
  ins->setInt64Operand(0, useInt64RegisterAtStart(lhs));
  ins->setInt64Operand(INT64_PIECES, useInt64RegisterOrConstant(rhs));
  defineInt64ReuseInput(ins, mir, 0);
}

```

This forces the left operand into a register, and the right operand into

either a different register or into a constant. For the test case in [comment 13](/show_bug.cgi?id=1707774#c13 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)")

that produces

```
[Codegen] # instruction Integer64
[Codegen] [7] d2800001        mov     x1, #0x0
[Codegen] # instruction MulI64
[Codegen] [7] d2800010        mov     x16, #0x0
[Codegen] [7] 9b107c21        mul     x1, x1, x16
[Codegen] # instruction MoveGroup
[Codegen] [7] aa0103e2        mov     x2, x1

```

and for a modified version of it, in which the operand is made non-constant by

adding this line

```
(local.set $n (i64.extend_i32_u (global.get $flag)))

```

it produces

```
[Codegen] # instruction MoveGroup
[Codegen] [7] aa0103e2        mov     x2, x1
[Codegen] # instruction MulI64
[Codegen] [7] 9b017c42        mul     x2, x2, x1
[Codegen] # instruction MoveGroup
[Codegen] [7] aa0203e1        mov     x1, x2

```

-- Proposal 2 ------------------------

This is the same as Proposal 1 except that we special-case multiplication of

the same non-constant value by itself:

```
  ins->setInt64Operand(0, useInt64RegisterAtStart(lhs));
  ins->setInt64Operand(INT64_PIECES,
                       (lhs == rhs && !rhs->isConstant())
                         ? useInt64RegisterAtStart(rhs)
                         : useInt64RegisterOrConstant(rhs));
  defineInt64ReuseInput(ins, mir, 0);

```

For the [comment 13](/show_bug.cgi?id=1707774#c13 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") test case unmodified, the result is unchanged:

```
[Codegen] # instruction Integer64
[Codegen] [7] d2800001        mov     x1, #0x0
[Codegen] # instruction MulI64
[Codegen] [7] d2800010        mov     x16, #0x0
[Codegen] [7] 9b107c21        mul     x1, x1, x16
[Codegen] # instruction MoveGroup
[Codegen] [7] aa0103e2        mov     x2, x1

```

For the non-constant case we avoid forcing the right-hand operand into

different register, hence giving just

```
[Codegen] # instruction MulI64
[Codegen] [7] 9b007c00        mul     x0, x0, x0

```

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1707774#c16)• 4 years ago |
|  | |

Would either of the fixes in [comment 15](/show_bug.cgi?id=1707774#c15 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") be acceptable? If so, which is

preferred? My inner conservative engineer would tend towards Proposal 1 on

the basis that Proposal 2 adds a path for what sounds like a rare occurrence

-- squaring of unknown integers -- and hence constitutes a

verification/testing hazard. (If this was floating point I'd think

differently, since squaring numbers in FP is very common).

I continue to investigate why the original failure happened at all, since that

seems important to understand.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1707774#c17)• 4 years ago |
|  | |

I agree Proposal 1 is preferable, but I don't think this issue is so urgent that we have to land a temporary fix quite yet - it's a Nightly-only issue after all, so far as we know, and even if it's not, the fix would apply only to Nightly, being Ion-on-ARM64 specific. IMO it is more important to find out what's going on here.

(If we were required to land a temp fix for ARM64, I might even suggest [comment 4](/show_bug.cgi?id=1707774#c4 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") as the simpler one, but that's a discussion for later. There are other, probably even simpler, solutions.)

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1707774#c18)• 4 years ago |
|  | |

Another point of reference: changing `LIRGeneratorARM64::lowerForMulInt64` to

using exactly the same scheme as `lowerForALUInt64` just above (literally,

copy-n-paste), together with handling constant RHS args in

`CodeGenerator::visitMulI64`, also works. In some sense this is a less risky

fix, because we're reusing the same scheme as `lowerForALUInt64` and that is

surely a well-trodden path.

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1707774#c19)• 4 years ago |
|  | |

Attached patch

[03-regalloc-1707774.diff](attachment.cgi?id=9220748&action=diff)
— [Details](attachment.cgi?id=9220748&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1707774&attachment=9220748)

Fallback fix, which, per [comment 18](/show_bug.cgi?id=1707774#c18 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"), we can likely deploy at low risk,

should nothing better come along.

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1707774#c20)• 4 years ago |
|  | |

Despite investigation I have not been able to determine the root cause of the

failure. Here's what I have so far. First, a smaller testcase:

```
new WebAssembly.Module(wasmTextToBinary(`
(module
  (func (result i64)
    (local $n i64)                ;; zero
    (if (i32.add (global.get $flag)
                 (i32.add (global.get $flag)
                          (global.get $flag)))  ;; give flag high prio
        (return (i64.const 8)))
    (local.set $n                 ;; $n = zero, but this is
      (i64.mul (local.get $n)     ;;  not known because i64.mul
               (local.get $n)))   ;;   is not constant folded
    (if (global.get $flag)        ;; conditionally
        (return (local.get $n)))  ;;  read $n
    (i64.load (i32.const 48))     ;; maybe traps
    drop                          ;;  but ignore result
    (local.get $n))               ;; read $n
  (memory 1)
  (global $flag (mut i32) (i32.const 2)))
`))

```

The relevant block is this (with debug printing modified per [bug 1710025](/show_bug.cgi?id=1710025 "RESOLVED FIXED - Make Ion's regalloc debug output easier to read")):

```
[RegAlloc]   Block 2 [successor 3] [successor 4]
[RegAlloc]     16-17 Integer64 [def v6<g>]
[RegAlloc]     18-19 Integer64 [def v7<g>]
[RegAlloc]     20-21 MulI64 [def v8<g>:tied(0)] [use v6:A] [use v7:R]
[RegAlloc]     22-23 TestIAndBranch [use v2:R]

```

The assertion failure happens because the output of insn 18-19 is given

conflicting allocations `x1` and `x3`.

Working forward through the pipeline, the interesting values are `v6`, `v7`

and `v8`. Live range analysis for them appears correct:

```
[RegAlloc] Live ranges by virtual register (after grouping/queueing regs):
[RegAlloc]   v6 17-20 { 17_def 20_v6:A }
[RegAlloc]   v7 19-20 { 19_def 20_v7:R }
[RegAlloc]   v8 21-31 { 21_def 25_v8:F:x0 31_v8:F:x0 }

```

`v6` and `v8` are determined to be non-overlapping and hence are put in the

same bundle.

```
[RegAlloc] Live ranges by bundle (after grouping/queueing regs):
[RegAlloc]   v6 17-20 { 17_def 20_v6:A } ## v8 21-31 { 21_def 25_v8:F:x0 31_v8:F:x0 }
[RegAlloc]   v7 19-20 { 19_def 20_v7:R }

```

Subsequently the `v6` / `v8` bundle is split:

```
[RegAlloc]     splitting bundle  v6 17-20 { 17_def } ## v8 21-31 { 21_def } into:
[RegAlloc]        v6 17-17 { 17_def }
[RegAlloc]        v6 20-20 { 20_v6:A }
[RegAlloc]        v8 21-21 { 21_def }
[RegAlloc]        v8 24-25 { 25_v8:F:x0 }
[RegAlloc]        v8 30-31 { 31_v8:F:x0 }
[RegAlloc]        v6 18-20 { } ## v8 22-31 { }

```

viz: `v6` is defined at 17, is used at 20, and is live but with no uses or

defs for 18, 19 and 20. As observed in [comment 6](/show_bug.cgi?id=1707774#c6 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"), it's strange that this

final bundle has `v6` live at 20, since that overlaps the singleton use at

20-20.

It's also strange that the `v8` ranges after the split -- 21-21, 24-25 and

30-31 -- don't cover it's pre-split range 21-31. I don't know if that's

intended or not.

In any case, the incorrect allocation is soon visible in the output:

```
[RegAlloc]   Block 2 [successor 3] [successor 4]
[RegAlloc]     16-17 Integer64 [def v6<g>:x1]
[RegAlloc]     MoveGroup [x1 -> x3]
[RegAlloc]     18-19 Integer64 [def v7<g>:x1]
[RegAlloc]     MoveGroup [x3 -> x1] [x3 -> x2]
[RegAlloc]     20-21 MulI64 [def v8<g>:x1] [use v6:R x1] [use v7:R x1]

```

16-17 writes the first of the multiply's args to `x1`, and that is copied into

`x3`. Then 18-19 writes the second arg to `x1`, but that is then overwritten

by the subsequent `MoveGroup`.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1707774#c21)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15405767 "1 revision") |
|  | |

Attached patch

[experiment.patch](attachment.cgi?id=9221486&action=diff) (obsolete)
— [Details](attachment.cgi?id=9221486&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1707774&attachment=9221486)

The problem is not limited to arm64 and it is not limited to 64-bit values.

Attached is a simple change that makes the 32-bit multiply on arm64 and arm use the same codegen strategy as the arm64 64-bit multiply (no constant folding + twice useRegisterAtStart + defineReuseInput). My reduced test case from [comment 11](/show_bug.cgi?id=1707774#c11 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"), converted to 32-bit in the obvious way, triggers the assert on both arm64 and arm.

(On x86 and x64 multiply is weird because it uses fixed registers, so it's not straightforward to test there.)

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1707774#c22)• 4 years ago |
|  | |

Referring to the incorrect output in [comment 20](/show_bug.cgi?id=1707774#c20 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"), viz:

```
[RegAlloc]   Block 2 [successor 3] [successor 4]
[RegAlloc]     16-17 Integer64 [def v6<g>:x1]
[RegAlloc]     MoveGroup [x1 -> x3]
[RegAlloc]     18-19 Integer64 [def v7<g>:x1]
[RegAlloc]     MoveGroup [x3 -> x1] [x3 -> x2]
[RegAlloc]     20-21 MulI64 [def v8<g>:x1] [use v6:R x1] [use v7:R x1]

```

the question I keep coming back to is: why does the second `MoveGroup`

overwrite `x1`? This is clearly wrong and this is also what the original

`*def->output() == alloc` assertion failure detected. In this case, for 18-19,

`v7` has been allocated to `x1` (that's what `*def->output()` tells us), but

`alloc`, which was also originally `x1`, got changed by the `MoveGroup` to

`x3`, hence causing the assertion to fail.

So I'm inclined to look into where the `MoveGroup` came from and why

it overwrites `x1`.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1707774#c23)• 4 years ago |
|  | |

I think the MoveGroup is not the problem per se. The question is, why is v6 allocated to x1 on line 20? The backtrace of allocations earlier in the run gives a different picture of this, with allocations that are seemingly perfectly consistent: v6 -> x1 for 16-17, v6 -> x3 for 18-19, v6 -> x2 for 20-21, v7 -> x1 for 18-20, v8 to x1 for 21 ->. The x3 assignment comes in via spill logic and is forced because v7 becomes allocated to x1. Observe that this assignment explains the initial x1 -> x3 move and the x3 -> x2 move. But then *something happens*, and suddenly v6 -> x1 on 20 contrary to the reported allocations, and i believe that this is what precipitates the x3 -> x1 move in the preceding MoveGroup.

So what is that "something"? Clearly the MUST\_REUSE constraint ties v6 and v8 together. So the x3 -> x1 move can't be avoided (except by allocating a different register to v8). But this means that v7 cannot be allocated to x1. The problem only arises if both the input values to the multiply are the same, so there's definitely a problem related to that. The input value need not be zero, I've tested this, but it looks like it needs to be a constant value known to the compiler. I can add 3 to $n at the beginning of the function and I see the same failure (but if I do so conditionally there is no failure). The constants can be defined with two different names, $m and $n. They can both be non-zero but must have the same value for the failure to occur.

More and more this looks to me to be a problem about shared structure somewhere. The LIR nodes that are the lhs and rhs inputs to the multiply operation are the same node in memory, so when defineReuseInput updates one it presumably updates the other... including the virtual register...

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1707774#c24)• 4 years ago |
|  | |

I believe I have a smoking gun. Consider the patch on [comment 21](/show_bug.cgi?id=1707774#c21 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"). Set a breakpoint in lowerMulI and then step. Before the call to useRegisterAtStart(lhs), lhs->virtualRegister() is zero. After the call it is 9 (because in the test case I use this is v9; it corresponds to v6 in Julian's test case and the discussion above). After the call to useRegisterAtStart(rhs) [sic], lhs->virtualRegister() is 10 (what is v7 above). Now, there are two separate LIR nodes here with separate virtual registers, but when we call defineReuseInput for the lhs we use lhs->virtualRegister() which should be 9 (which is what is recorded in the LIR node) but is 10 (because it's recorded in the MIR node). It's hard to pin down *precisely* what goes wrong but it stands to reason that this will not end well, and it is consistent with symptoms, notably [comment 23](/show_bug.cgi?id=1707774#c23 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)").

Looking through our code base for 'lhs == rhs' and 'lhs != rhs' to look for trouble spots, I find few candidates. All are a result of the regalloc requirement that if the lhs is useAtStart then the rhs must be useAtStart too if lhs == rhs. I'm unable as of yet to determine whether these uses are benign or not.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1707774#c25)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15406236 "1 revision") |
|  | |

In a sense, it seems to me that the bug is that when the input nodes are the same, we should not be required or allowed to specify a use for the rhs because its use is already specified.

To wit, this code for multiply lowering:

```
  if (lhs == rhs) {
    LUse def = useRegisterAtStart(lhs);
    lir->setOperand(0, def);
    lir->setOperand(1, def);
  } else {
    lir->setOperand(1, useRegister(rhs));
  }
  defineReuseInput(lir, mul, 0);

```

passes the regalloc and generates good code.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1707774#c26)• 4 years ago |
|  | |

Recording a thought: It's probably an important factor here that the constant is regenerated twice in the block because of emitAtUses. We have what looks like one MIR node but it turns into two LIR nodes, strictly because of emitAtUses. This happens for almost nothing else. We should consider whether this is a factor in this pattern, it would explain why we're not seeing more breakage.

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1707774#c27)• 4 years ago |
|  | |

(In reply to Lars T Hansen [:lth] from [comment #24](/show_bug.cgi?id=1707774#c24 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"))

> […] but when we call defineReuseInput for the lhs we use lhs->virtualRegister() which should be 9 (which is what is recorded in the LIR node) but is 10 (because it's recorded in the MIR node). […]

Could it be related to the commutative aspect of the multiplication? We have so code in the Lowering which attempts to swap the operands based on some properties.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1707774#c28)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15406443 "3 revisions") |
|  | |

No, I think this is actually a really obscure bug in how emitAtUses combines with reuseInput. If all the following conditions are met:

* a MIR node gets two input operands that are the same MIR node
* this shared input is an integer constant, so EmittedAtUses is true for it
* the lowering calls useRegisterAtStart (not useRegisterOrConstantAtStart) twice, one for "each" operand, lhs before rhs
* the lowering uses defineReuseInput on the lhs

then the MIR node gets two LIR nodes because the emitAtUses generates a new LIR node for each call to useRegisterAtStart, each with a vreg. The vreg is recorded in the MIR node after the LIR node has been created, by define(). But the MIR node can only hold one of the vregs and will hold only the rhs vreg (because the LIR node for the rhs was created last). Now the compiler can become confused because its vreg reflects the vreg of the rhs, not the vreg of the lhs.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a1861256_499633)• 4 years ago |

Assignee: jseward → lhansen

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1707774#c29)• 4 years ago |
|  | |

I'm still working on tracking down *precisely* what happens, but the clobbering of v6 in line 20-21 in [comment 22](/show_bug.cgi?id=1707774#c22 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") happens at the bottom of the MUST\_REUSE\_INPUT case of reifyAllocations. This general nest of code is also responsible for inserting the x3 -> x1 move. Initially, the allocation is set up correctly at the top of the inner `use` loop: v6 is allocated to x2 where the previous input move left it. The allocation for v6 is then overwritten by the MUST\_REUSE\_INPUT logic, as it should be, and a move is created.

It could look like the register allocator has gotten itself into a bad state by the time we get to this point. We must have v8==v6 by constraint, and v8 has been allocated to x1, which it can be because v7 (also allocated to x1) is dead by the time v8 is defined. But this leads to the seemingly impossible situation where both v6 and v7 must be in x1 at the start of the operation. (Of course it's not quite impossible since these represent the same value and could share a register, but I don't think that that's something the allocator recognizes as possible.) The allocator could fix that problem by moving v7 to another register, but the real issue seems to be that v7 was allowed to be allocated to x1 at all. But whether this is a problem with, say, the splitting logic not taking input reuse into account, or a problem stemming from the two LIR nodes for the constants sharing a single MIR node and hence being confused about their virtual register assignments, I don't know yet.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1707774#c30)• 4 years ago |
|  | |

With a reuse of `input` as `output` at some `ins`, `input` is marked as live through `inputOf(ins)` and `output` is marked as live starting from `outputOf(ins)`, but there is nothing to link the two *directly*. Their ranges are merged, but can later be split again as a result of allocation failure (this is what happens here), disconnecting `input` from `output`. This lack of connection allows unrelated values whose lifetimes end at `inputOf(ins)` to be allocated to the same register as `output`, getting in the way of the need for `input` to have that register, and making the assignment in `reifyAllocations()` that updates the allocation of `input` unsound. This is a general register allocation bug, not specific to arm64.

It's not obvious how to fix this. Attempts to extend the live range of `output` to start at `inputOf(ins)` or the live range of `input` to end at `outputOf(ins)` run into various problems with invariants in the allocator.

It's also not appealing to add a loop in `reifyAllocations()` to look for conflicts among the inputs and move conflicting non-reused values out of the way, though it would probably be sound to do so, as any conflicting values' lifetimes should end at `inputOf(ins)`.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1707774#c31)• 4 years ago |
|  | |

My best guess for how to attempt a fix for this is to not split the bundle in `BacktrackingAllocator::splitAt()` at uses that are being reused by the using instruction. There is already a fairly complicated guard for when to allow splitting that special-cases FIXED registers; this seems somehow analogous.

I'm going to do the following:

* upgrade this to a JIT bug and change the title to reflect my current understanding
* add a patch here with some code and a test case that allows the bug to be demonstrated reliably
* offer a workaround patch for ARM64 only and land that, unblocking ARM64 Ion shipping

I may not be able to expedite a general fix for this bug so I may unassign it from myself after fixing the ARM64 case; we'll see.

Component: Javascript: WebAssembly → JavaScript Engine: JITSummary: Assertion failure: \*def->output() == alloc, at jit/RegisterAllocator.cpp:257 → Live range splitting can lead to conflicting assignments (was: Assertion failure: \*def->output() == alloc, at jit/RegisterAllocator.cpp:257)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1707774#c32)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15415735 "1 revision") |
|  | |

Attached file
[Tweaks + test case to demonstrate issue](attachment.cgi?id=9222922)
— [Details](attachment.cgi?id=9222922&action=edit)

This has a simplified test case derived from the original, and some very minor tweaks to Ion and arm64 lowering to reproduce the original problem in a controlled setting using only 32-bit operands. Basically, we disable constant folding for MulI and force the lowering of MulI to useRegisterAtStart for both its input operands.

To use this, apply the patch, then make a build with --enable-debug --enable-simulator=arm64 (or run natively on arm64 hardware), then run the shell as `.../js --wasm-compiler=ion .../jit-test/tests/wasm/regress/bug1707774.js`. The assert should be triggered. Running with IONFLAGS=regalloc it will be possible to observe the confused register use in the MulI instruction: both inputs, which are distinct, use the same register.

I believe there is *nothing* special about using MulI here or about being on arm64 or indeed about using wasm code, it is just a clean and localized way to demonstrate the problem, and meshes with the discussion earlier on the bug.

[Attachment #9221486](/attachment.cgi?id=9221486&action=edit "experiment.patch") -
Attachment is obsolete: true

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a2098050_499633)• 4 years ago |

Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1707774#c33)• 4 years ago |
|  | |

Attached file
[Bug 1707774 - Fix. r?jseward](attachment.cgi?id=9222926) (obsolete)
— [Details](attachment.cgi?id=9222926&action=edit)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1707774#c34)• 4 years ago |
|  | |

Attached file
[Bug 1707774 - Test case and comments. r?jseward](attachment.cgi?id=9222927) (obsolete)
— [Details](attachment.cgi?id=9222927&action=edit)

This demonstrates a problem in live range splitting leading to a confused register

assignment; an assertion fails in debug builds on arm64. The problem is however

cross-platform in the presence of the right use directives + defineReuseInput,

and is not specific to int64.

Depends on D115679

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a2103906_600971)• 4 years ago |

[Attachment #9222926](/attachment.cgi?id=9222926&action=edit "Bug 1707774 - Fix. r?jseward") -
Attachment is obsolete: true

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1707774#c35)• 4 years ago |
|  | |

The proposed fix ([comment 25](/show_bug.cgi?id=1707774#c25 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"), [comment 33](/show_bug.cgi?id=1707774#c33 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)")) does not work because it violates other invariants of the code generator, specifically, reusing the definition as in [comment 25](/show_bug.cgi?id=1707774#c25 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") leads to a null pointer in the MIR node's rhs. Since the eventual fate of mul64 on arm64 is to not reuse its input register, I will instead offer a fix for that on [bug 1710024](/show_bug.cgi?id=1710024 "RESOLVED FIXED - ARM64: Avoid defineReuseInput") and let that be the narrow fix for the arm64 problem originally reported here.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1707774#c36)• 4 years ago |
|  | |

No longer blocks [bug 1687626](/show_bug.cgi?id=1687626 "RESOLVED FIXED - Ship Ion for WebAssembly on ARM64") because a workaround has landed on [bug 1710024](/show_bug.cgi?id=1710024 "RESOLVED FIXED - ARM64: Avoid defineReuseInput").

No longer blocks: [1687626](/show_bug.cgi?id=1687626 "RESOLVED FIXED - Ship Ion for WebAssembly on ARM64")

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1707774#c37)• 4 years ago |
|  | |

There is a previously documented constraint in the register allocator, see a comment at <https://searchfox.org/mozilla-central/source/js/src/jit/x86-shared/Lowering-x86-shared.cpp#927>, that speaks to this case (though obviously it's not documented *in the register allocator...*). Quoting:

```
  // The rhs is tricky due to register allocator restrictions:
  //  - if lhs == rhs and lhs is AtStart then rhs must be AtStart too
  //  - if lhs != rhs and lhs is AtStart then rhs must not be AtStart,
  //    this appears to have something to do with risk of the rhs
  //    being clobbered.  Anyway it doesn't matter much, since the
  //    liveness of rhs will not prevent the lhs register to be reused
  //    for the output.

```

This applies only to the defineReuseInput case; normal define is not affected I believe.

When this constraint is violated, for example, by making the code at the above location use useRegisterAtStart for both its arguments even when lhs != rhs, then the same regalloc assertion that gave rise to the present bug is triggered.

What is happening in our present use case is that the MIR node is the same for the lhs and rhs, yet gives rise to different LIR nodes (due to it being a constant with emitAtuses). Thus in cases where we end up testing lhs == rhs to determine whether to use useRegisterAtStart or useRegister, we will go wrong if lhs == rhs and it is an emitAtUses constant, since in this case we should be using useRegister because there are two different LIR nodes.

Since the regalloc catches this bug in debug builds at least, it may be that the best "fix" (it does not actually fix the problem, it just prevents is from happening) is to instead change the few spots in the code that may have this problem because they're testing lhs == rhs or lhs != rhs. The remaining spots all appear to be in in Lowering-x86-shared.cpp. The best fix is probably to package up the comparison into a predicate that can take all this complexity into account.

I have considered whether we might add an additional assert somewhere but I'm not sure what that would look like. Nodes can legitimately reuse multiple inputs (as when doing reuseInput on a 64-bit value on a 32-bit platform). It may be that a test would create a map from uses to definitions for every instruction and trip an assert when the number of useRegisterAtStart exceeds the number of reused inputs.

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1707774#c38)• 4 years ago |
|  | |

Attached file
[Bug 1707774 - More subtle equality on MDefinition\* during lowering. r=nbp!,jandem!,jseward!](attachment.cgi?id=9224423) (obsolete)
— [Details](attachment.cgi?id=9224423&action=edit)

In instances where an MDefinition\* can map to more than one LIR node,

a simple pointer test is insufficient to avoid breaking the regalloc

invariant that if one LIR node argument to a multi-operand operation

is reused for the result, then other distinct LIR node arguments

cannot be used atStart. (This invariant is implicit: when it is

broken, an assert will sometimes fire in when the regalloc attempts to

verify that its allocation is coherent.)

This patch abstracts the equality test into a predicate, uses the

predicate everywhere relevant, and makes the predicate take into

account the one situation where it is known that the MIR node maps to

two LIR nodes: when it is an emitAtUses constant. The patch also

documents the more complicated condition.

(This commit message may be elided for landing, depending on whether

we think this is a problem that can be exploited. There are no known

failures resulting from failing to obey the invariant.)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1707774#c39)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15432710 "1 revision") |
|  | |

Comment on [attachment 9224423](/attachment.cgi?id=9224423 "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") [[details]](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!")

[Bug 1707774](/show_bug.cgi?id=1707774 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") - More subtle equality on MDefinition\* during lowering. r=nbp!,jandem!,jseward!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Likely very tricky. The current patch fixes no actual bugs, see [comment 37](/show_bug.cgi?id=1707774#c37 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)"); it just creates a framework that helps prevent us from running into those bugs. To get to an exploit from this, an attacker would have to understand that what the patch does is prevent a register allocation confusion from occuring in very obscure cases, and from that, construct a wasm program that exploits that confusion with a test case that is more complicated than we've seen. (The test case that started this bug is almost certainly benign, in that it causes the confusion of two integer-valued registers that contain the same value. An assertion catches that in a debug build only.) The patch is copiously commented but the comments don't point directly at this possible confusion. If need be, I can remove comments and commit msg and land later, but I feel this is not necessary.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All - it's an old problem stemming from a weird interaction between the register allocator and the optimizer
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: I don't think we should do that, but in principle patches for older branches could be derived fairly straightforwardly from this one.
* **How likely is this patch to cause regressions; how much testing does it need?**: It is not likely to cause regressions; it guards against a very, very obscure problem and otherwise is no functional change from current code.
[Attachment #9224423](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1707774#c40)• 4 years ago |
|  | |

If you don't think we need to uplift; I'm okay with that given the description; but in that case I'd like to land it under a public bug. Is that doable?

Flags: needinfo?(lhansen)

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1707774#c41)• 4 years ago |
|  | |

Yes, I can create a reasonable public placeholder bug for it and land under that, no problem.

Flags: needinfo?(lhansen)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1707774#c42)• 4 years ago |
|  | |

Comment on [attachment 9224423](/attachment.cgi?id=9224423 "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") [[details]](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!")

[Bug 1707774](/show_bug.cgi?id=1707774 "RESOLVED FIXED - Live range splitting can lead to conflicting assignments (was: Assertion failure: *def->output() == alloc, at jit/RegisterAllocator.cpp:257)") - More subtle equality on MDefinition\* during lowering. r=nbp!,jandem!,jseward!

Revision D116464 was moved to [bug 1715203](/show_bug.cgi?id=1715203 "RESOLVED FIXED - Create abstraction to aid register selection during lowering"). Setting [attachment 9224423](/attachment.cgi?id=9224423 "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") [[details]](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") to obsolete.

[Attachment #9224423](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") -
Attachment is obsolete: true
[Attachment #9224423](/attachment.cgi?id=9224423&action=edit "Bug 1707774 - More subtle equality on MDefinition* during lowering.  r=nbp!,jandem!,jseward!") -
Flags: sec-approval?

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1707774#c43)• 4 years ago |
|  | |

Re the sec-bounty, a brief summary. While all the patches that address the bug have landed in the open, the original TC uncovered a previously unrecognized weakness in lowering/register allocation that could lead to extremely obscure but deterministic register confusion failures in the field (exploitability is unknown). And while the TC was for the ARM64 compiler, which is shipping only in FF90, said failures, if discovered, would affect x86/x64 on all branches.

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3672397_580382)• 4 years ago |

Depends on: [1715203](/show_bug.cgi?id=1715203 "RESOLVED FIXED - Create abstraction to aid register selection during lowering")

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1707774#c44)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1707774&comment_id=15440175 "1 revision") |
|  | |

Addressed by patches on [bug 1715203](/show_bug.cgi?id=1715203 "RESOLVED FIXED - Create abstraction to aid register selection during lowering") and (earlier) [bug 1710024](/show_bug.cgi?id=1710024 "RESOLVED FIXED - ARM64: Avoid defineReuseInput").

Status: ASSIGNED → RESOLVEDClosed: 4 years agoResolution: --- → FIXED

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3687557_575867)• 4 years ago |

Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3689935_580382)• 4 years ago |

Group: javascript-core-security → core-security-release
[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix)
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)Target Milestone: --- → 91 Branch

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3690124_600971)• 4 years ago |

[Attachment #9222927](/attachment.cgi?id=9222927&action=edit "Bug 1707774 - Test case and comments. r?jseward") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3695606_1689)• 4 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1707774#c45)• 4 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1707774) to reply.

Flags: needinfo?(lhansen)Whiteboard: [sec-survey]

|  | [Lars T Hansen [:lth]](/user_profile?user_id=499633)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a3786324_499633)• 4 years ago |

Flags: needinfo?(lhansen)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a4886895_553429)• 4 years ago |

Flags: qe-verify-Whiteboard: [sec-survey] → [sec-survey][post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a8779080_578488)• 3 years ago |

Whiteboard: [sec-survey][post-critsmash-triage] → [sec-survey][post-critsmash-triage][adv-main90+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a8779356_578488)• 3 years ago |

Whiteboard: [sec-survey][post-critsmash-triage][adv-main90+] → [sec-survey][post-critsmash-triage][adv-main91+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1707774#c46)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235152) (obsolete)
— [Details](attachment.cgi?id=9235152&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a8790027_578488)• 3 years ago |

Alias: CVE-2021-29981

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1707774#c47)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235166)
— [Details](attachment.cgi?id=9235166&action=edit)

[Attachment #9235152](/attachment.cgi?id=9235152&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1707774#c48)• 3 years ago |
|  | |

(Nit for :tjr) "led lead" -> "led"

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1707774#c49)• 3 years ago |
|  | |

Thanks! I've corrected that in the staged yml file.

Flags: needinfo?(tom)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a18172185_1689)• 3 years ago |

Group: core-security-release

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a18172185_546015)• 3 years ago |

Has Regression Range: --- → yesKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a93204077_132034)• 9 months ago |

Blocks: [gkw-js-fuzzing](/show_bug.cgi?id=1890610 "NEW - [meta] Gary JavaScript engine Fuzzing")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1707774#a97608870_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1707774&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


