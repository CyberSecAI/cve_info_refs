=== Content from bugzilla.mozilla.org_4611e561_20250114_194213.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1713638)
* [XML](/show_bug.cgi?ctype=xml&id=1713638)

Closed
[Bug 1713638](/show_bug.cgi?id=1713638)
(CVE-2021-29971)

Opened 4 years ago
Closed 4 years ago

# The site permissions feature is leaking permissions to sites with the same scheme/port.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

The site permissions feature is leaking permissions to sites with the same scheme/port.

## Categories

### (Fenix :: General, defect)

[Product:](/describecomponents.cgi?product=Fenix)

Fenix
▾

Fenix
**Firefox for Android**: Fenix is an Android browser built using Android Components that re-imagines how a mobile browser would look if it was built from scratch to demonstrate better design for typical mobile use cases ([more info](https://www.mozilla.org/en-us/firefox/mobile/)).
[See Open Bugs in This Product](/buglist.cgi?product=Fenix&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Fenix)
Watch This Product

[Component:](/describecomponents.cgi?product=Fenix&component=General#General)

General
▾

Fenix :: General
For bugs in Firefox Android which do not fit into other more specific components
[See Open Bugs in This Component](/buglist.cgi?product=Fenix&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Fenix&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Fenix&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### (firefox89 wontfix, firefox90 fixed, firefox91 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox89 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=wontfix) |
| firefox90 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed) |
| firefox91 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox89 |  | wontfix |
| firefox90 |  | fixed |
| firefox91 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: amejia, Assigned: amejia)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5b94ed5fbd4cd2feb68a13aa1ff2cde7?d=mm&size=40)  [amejia](/user_profile?user_id=623634)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5b94ed5fbd4cd2feb68a13aa1ff2cde7?d=mm&size=40)  [amejia](/user_profile?user_id=623634)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e49a28e5fed7340a3e51d46100902d93?d=mm&size=40)  [boek](/user_profile?user_id=599885)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1797822](/show_bug.cgi?id=1797822 "NEW - Site permission prompts show the full origin like https://permission.site:443 instead of just the hostname like permission.site")

## Details

### (Keywords: csectype-priv-escalation, sec-high, Whiteboard: [adv-main90+][post-critsmash-triage])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29971

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main90+][post-critsmash-triage]

Change Request:

---

Bug Flags:

|  | sec-bounty | ? |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [db\_permissions\_example.png](/attachment.cgi?id=9224322)  [4 years ago](#c0)  [Arturo Mejia [:amejia]](/user_profile?user_id=623634)   85.84 KB, image/png |  | [Details](/attachment.cgi?id=9224322&action=edit) |
| --- | --- | --- |
| [0001-Improvements-to-site-permissions.patch](/attachment.cgi?id=9225057)  [4 years ago](#c4)  [Arturo Mejia [:amejia]](/user_profile?user_id=623634)   13.89 KB, patch |  | [Details](/attachment.cgi?id=9225057&action=edit) | [Diff](/attachment.cgi?id=9225057&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9225057) |
| [AC-Improvements-to-site-permissions.patch](/attachment.cgi?id=9226579)  [4 years ago](#c9)  [Arturo Mejia [:amejia]](/user_profile?user_id=623634)   20.99 KB, patch | sebastian : [review+](#c11 "4 years ago")  tjr : [sec-approval+](#c16 "4 years ago") | [Details](/attachment.cgi?id=9226579&action=edit) | [Diff](/attachment.cgi?id=9226579&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579) |
| [FENIX-Improvements-to-site-permissions.patch](/attachment.cgi?id=9226580)  [4 years ago](#c10)  [Arturo Mejia [:amejia]](/user_profile?user_id=623634)   6.85 KB, patch | csadilek : [review+](#a1211853_590895 "4 years ago")  tjr : [sec-approval+](#a1376204_578488 "4 years ago") | [Details](/attachment.cgi?id=9226580&action=edit) | [Diff](/attachment.cgi?id=9226580&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226580) |
| [advisory.txt](/attachment.cgi?id=9230317)  [4 years ago](#c19)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   357 bytes, text/plain |  | [Details](/attachment.cgi?id=9230317&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1713638#c0)• 4 years ago |
|  | |

Attached image
[db\_permissions\_example.png](attachment.cgi?id=9224322)
— [Details](attachment.cgi?id=9224322&action=edit)

Reading over the weekend about Origin, origin attributes and principals, I noticed there is a security gap on my implementation of site permissions, [I'm storing only the host name](https://github.com/mozilla-mobile/android-components/blob/83b60ae0cd3c01047dfabda93156733814c771a1/components/feature/sitepermissions/src/main/java/mozilla/components/feature/sitepermissions/SitePermissionsFeature.kt#L164) (see the attachment db\_permissions\_example.png), instead of the [origin (Schema + host + port)](https://datatracker.ietf.org/doc/html/rfc6454#section-3.2)  on the Site permissions DB, causing that sites under different **schema and port but with the same host share the same permission with each other**, for example:

<https://example.com/>

<http://example.com:8080/>

<https://example.com:4343/>

Based on the rules of same [origin](https://datatracker.ietf.org/doc/html/rfc6454#section-3.2), these three sites, should be treated as completely different sites, but in my implementation as I'm only storing the host, all of the three will shared permissions between each other.

For example, an user navigates to <https://example.com/> and grants location permission, this will cause that <http://example.com:8080/> and <https://example.com:4343/> will also have the location permission granted.

In 91, we are expecting to land a [patch](https://bugzilla.mozilla.org/show_bug.cgi?id=1699480) that will migrate AC site permissions db to geckoView storage ( that will store site permissions based on principals) , but this will only cover Content permission media permission (Camera and microphone) are still going to be stored on AC see <https://bugzilla.mozilla.org/show_bug.cgi?id=1712756>.

We would like the security team to assess the severity of the issue to see the steps to follow.

Thanks in advance, and sorry for all the trouble.

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1713638#c1)• 4 years ago |
|  | |

Adding some GeckoView folks to figure out whether we can move saving media permissions to GV too (like content permissions in [bug 1712756](/show_bug.cgi?id=1712756 "NEW - Explore the option of storing Media permissions on the GV") / 91+). Ideally A-C doesn't need to store anything here and then we can't do it wrong (afaik we do not know about all origin properties to do the right thing?). :)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1713638#c2)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1713638&comment_id=15427817 "1 revision") |
|  | |

That will be ideal, this way AC will not have to store principals to support container or other origin attributes for Media permissions, and we will share the same logic as FF Desktop.

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a95353_5898)• 4 years ago |

Group: partner-confidential

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1713638#c3)• 4 years ago |
|  | |

I was initially thinking `sec-moderate` because at least it requires a user to grant the permission, but by not taking the scheme into account anyone local could set up a MITM insecure http site to take advantage of these permissions.

And that's even before getting to originAttributes, where the engine keeps track of "super origins" for various privacy and security reasons that we'll want Fenix to also do.

Principals are the only real thing -- compare those, and that can't really be done in the front end.

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1713638#c4)• 4 years ago |
|  | |

Attached patch

[0001-Improvements-to-site-permissions.patch](attachment.cgi?id=9225057&action=diff) (obsolete)
— [Details](attachment.cgi?id=9225057&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9225057)

This is a draft with minimal tests just to validate the idea, on it I'm doing two principal things:

1. Triggering a migration on the site permissions DB to update the `origin` column that now only holds the `host`, and updating it to have the following pattern `https://$origin_column:443`, as we were not getting permission requests on `http` sites, none `http` permissions should be on the db, I'm defaulting all the already existing permissions to be updated to schema `https` and port `443` that it's the default for `https`.
2. Making sure all new permissions will store the `origin` (schema + host + port).
Assignee: nobody → amejiamarmol
[Attachment #9225057](/attachment.cgi?id=9225057&action=edit "0001-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1713638#c5)• 4 years ago |
|  | |

I chatted with Christian about the patch and we would like to get feedback from the security team about #1 (the migration aspect).

We would like to confirm if it's an acceptable solution to migrate existing permissions this way, as the only other alternative we see is deleting/reseting all site permissions, meaning users will be prompted again.

To provide some context about the approach above. We don't get permission requests for `HTTP` content, so I have a good level of confidence that all the data on the db should be for `HTTPS` sites. However, we're not sure about the ports, because we didn't store that information when the permissions was requested, but in most of the cases, in my opinion I think default port will a good option, and as part of the migration I'm assuming that all sites were from the default port `443` for `HTTPS` sites. The origin column on the db entries will end up with this pattern `https://$origin_column:443` after the migration.

Thanks in advance.

Flags: needinfo?(dveditz)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1713638#c6)• 4 years ago |
|  | |

I agree the front-end shouldn't have to deal with this stuff. Ideally we can store all permissions in GV (so basically do [Bug 1712756](/show_bug.cgi?id=1712756 "NEW - Explore the option of storing Media permissions on the GV")), in hindsight we should have provided a way for the front-end to easily check whether two permissions belong to the same origin.

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1713638#c7)• 4 years ago |
|  | |

(In reply to Arturo Mejia from [comment #5](/show_bug.cgi?id=1713638#c5 "RESOLVED FIXED - The site permissions feature is leaking permissions to sites with the same scheme/port."))

> I chatted with Christian about the patch and we would like to get feedback from the security team about #1 (the migration aspect).
>
> We would like to confirm if it's an acceptable solution to migrate existing permissions this way, as the only other alternative we see is deleting/reseting all site permissions, meaning users will be prompted again.
>
> To provide some context about the approach above. We don't get permission requests for `HTTP` content, so I have a good level of confidence that all the data on the db should be for `HTTPS` sites. However, we're not sure about the ports, because we didn't store that information when the permissions was requested, but in most of the cases, in my opinion I think default port will a good option, and as part of the migration I'm assuming that all sites were from the default port `443` for `HTTPS` sites. The origin column on the db entries will end up with this pattern `https://$origin_column:443` after the migration.
>
> Thanks in advance.

Hi Daniel, I would like to confirm the question above, should we own that decision or the security team do?

Thanks in advance!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1713638#c8)• 4 years ago |
|  | |

The security team will insist that we compare origins going forward. How we get from here to there is a collaboration since the work falls on engineering and the product folks will likely have opinions on the user experience.

Your plan to assume `https://` and port 443 is fine. It's sure to be correct almost always in practice, and in the rare case the port was incorrect it's still more secure than today because the permission could only be abused by someone with a valid cert for the domain and no longer over an unencrypted http connection.

Flags: needinfo?(dveditz)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1713638#c9)• 4 years ago |
|  | |

Attached patch

[AC-Improvements-to-site-permissions.patch](attachment.cgi?id=9226579&action=diff)
— [Details](attachment.cgi?id=9226579&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579)

This patch covers the AC changes.

[Attachment #9225057](/attachment.cgi?id=9225057&action=edit "0001-Improvements-to-site-permissions.patch") -
Attachment is obsolete: true
[Attachment #9225057](/attachment.cgi?id=9225057&action=edit "0001-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek)
[Attachment #9226579](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1713638#c10)• 4 years ago |
|  | |

Attached patch

[FENIX-Improvements-to-site-permissions.patch](attachment.cgi?id=9226580&action=diff)
— [Details](attachment.cgi?id=9226580&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226580)

This patch covers the Fenix changes.

[Attachment #9226580](/attachment.cgi?id=9226580&action=edit "FENIX-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a959943_623634)• 4 years ago |

[Attachment #9226579](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek) → review?(s.kaspari)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1713638#c11)• 4 years ago |
|  | |

Comment on [attachment 9226579](/attachment.cgi?id=9226579 "AC-Improvements-to-site-permissions.patch") [[details]](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") [[diff]](/attachment.cgi?id=9226579&action=diff "AC-Improvements-to-site-permissions.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579)
AC-Improvements-to-site-permissions.patch
Review of [attachment 9226579](/attachment.cgi?id=9226579 "AC-Improvements-to-site-permissions.patch") [[details]](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") [[diff]](/attachment.cgi?id=9226579&action=diff "AC-Improvements-to-site-permissions.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579):
-----------------------------------------------------------------
This LGTM for checking the full origin (protocol, host, port).
But still feels like we should get discuss [bug 1712756](/show_bug.cgi?id=1712756 "NEW - Explore the option of storing Media permissions on the GV") with the GV team as soon as possible, so that we can check the full principal and do not have to maintain this logic in A-C.
::: components/support/ktx/src/main/java/mozilla/components/support/ktx/kotlin/String.kt
@@ +138,5 @@
> +fun String.getOrigin(): String {
> + val url = URL(this)
> + val port = if (url.port == -1) url.defaultPort else url.port
> + return URL(url.protocol, url.host, port, "").toString()
> +}
The URL class can throw `MalformedURLException` if it cannot parse the URL. Do we need to protect against this here?
@@ +144,5 @@
> +/\*\*
> + \* Returns an origin without the default port.
> + \* For example for an input of "<https://mozilla.org:443>" you will get "<https://mozilla.org>".
> + \*/
> +fun String.stripDefaultProtocol(): String {
The name of the function says "protocol", but it strips the "port"? :)
[Attachment #9226579](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") -
Flags: review?(s.kaspari) → review+

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1713638#c12)• 4 years ago |
|  | |

Thanks for the review, I will update the patches with your feedback!

> But still feels like we should get discuss [bug 1712756](/show_bug.cgi?id=1712756 "NEW - Explore the option of storing Media permissions on the GV") with the GV team as soon as possible, so that we can check the full principal and do not have to maintain this logic in A-C.

I'm agree we should continue the discussion. From [Agi's comment 6](https://bugzilla.mozilla.org/show_bug.cgi?id=1713638#c6), sounds like the GV team is opened to store all permissions. He could help us to clarify that point.

Flags: needinfo?(agi)

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a1211853_590895)• 4 years ago |

[Attachment #9226580](/attachment.cgi?id=9226580&action=edit "FENIX-Improvements-to-site-permissions.patch") -
Flags: review?(csadilek) → review+

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1713638#c13)• 4 years ago |
|  | |

I agree, I'll discuss with the team wrt priority

Flags: needinfo?(agi)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1713638#c14)• 4 years ago |
|  | |

Comment on [attachment 9226579](/attachment.cgi?id=9226579 "AC-Improvements-to-site-permissions.patch") [[details]](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") [[diff]](/attachment.cgi?id=9226579&action=diff "AC-Improvements-to-site-permissions.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579)

AC-Improvements-to-site-permissions.patch

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not easy, as only sites with previous permissions granted but with a different schema or port can exploit
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All of them
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely to cause regressions. Not much as the migration will happen right after the user starts the app.

  but basic testing of having an affected version and seeing sites are migrated to the correct origin(schema + domain + port) is required.
[Attachment #9226579](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") -
Flags: sec-approval?

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a1221375_623634)• 4 years ago |

[Attachment #9226580](/attachment.cgi?id=9226580&action=edit "FENIX-Improvements-to-site-permissions.patch") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1713638#c15)• 4 years ago |
|  | |

Approved to land and uplift when ready

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a1376204_578488)• 4 years ago |

[Attachment #9226580](/attachment.cgi?id=9226580&action=edit "FENIX-Improvements-to-site-permissions.patch") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1713638#c16)• 4 years ago |
|  | |

Comment on [attachment 9226579](/attachment.cgi?id=9226579 "AC-Improvements-to-site-permissions.patch") [[details]](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") [[diff]](/attachment.cgi?id=9226579&action=diff "AC-Improvements-to-site-permissions.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1713638&attachment=9226579)

AC-Improvements-to-site-permissions.patch

I missed the other one

[Attachment #9226579](/attachment.cgi?id=9226579&action=edit "AC-Improvements-to-site-permissions.patch") -
Flags: sec-approval? → sec-approval+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1713638#c17)• 4 years ago |
|  | |

android-components:

* master: <https://github.com/mozilla-mobile/android-components/commit/54c391787c1ed679c0ab9b0f58557b78da81eb3b>
* 90 branch: <https://github.com/mozilla-mobile/android-components/commit/b9acdc18981236245d79a91554cf1df8a5a60cd2>

fenix:

* master: <https://github.com/mozilla-mobile/fenix/commit/251bfc7fe900c5a741bc630aeb77cf97b0feb646>
* 90 branch: coming soon
Group: mobile-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 4 years ago
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=wontfix)
[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected)
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1713638#c18)• 4 years ago |
|  | |

90 branch: <https://github.com/mozilla-mobile/fenix/commit/34b1e77dbc54d1f8db536545e37cdaf86b39bd00>

Included in the 90.0.0-beta.5 build.

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a3122559_578488)• 4 years ago |

Whiteboard: [adv-main90+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1713638#c19)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9230317)
— [Details](attachment.cgi?id=9230317&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a3321859_578488)• 4 years ago |

Alias: CVE-2021-29971

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a3966962_458186)• 3 years ago |

Whiteboard: [adv-main90+] → [adv-main90+][post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a15177445_1689)• 3 years ago |

Group: core-security-release

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a45067083_430528)• 2 years ago |

Component: Security: Android → GeneralOS: Unspecified → Android

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1713638#a112289617_430528)• 25 days ago |

See Also: → [1797822](/show_bug.cgi?id=1797822 "NEW - Site permission prompts show the full origin like https://permission.site:443 instead of just the hostname like permission.site")
You need to [log in](/show_bug.cgi?id=1713638&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Arturo Mejia [:amejia]](/user_profile?user_id=623634)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_c3ac9c70_20250114_194213.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-28

## Security Vulnerabilities fixed in Firefox 90

Announced
July 13, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 90

#### [#CVE-2021-29970: Use-after-free in accessibility features of a document](#CVE-2021-29970)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A malicious webpage could have triggered a use-after-free, memory corruption, and a potentially exploitable crash.
*This bug only affected Firefox when accessibility was enabled.*

##### References

* [Bug 1709976](https://bugzilla.mozilla.org/show_bug.cgi?id=1709976)

#### [#CVE-2021-29971: Granted permissions only compared host; omitting scheme and port on Android](#CVE-2021-29971)

Reporter
Arturo Mejia
Impact
high
##### Description

If a user had granted a permission to a webpage and saved that grant, any webpage running on the same host - irrespective of scheme or port - would be granted that permission.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1713638](https://bugzilla.mozilla.org/show_bug.cgi?id=1713638)

#### [#CVE-2021-30547: Out of bounds write in ANGLE](#CVE-2021-30547)

Reporter
(Unknown)
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1715766](https://bugzilla.mozilla.org/show_bug.cgi?id=1715766)

#### [#CVE-2021-29972: Use of out-of-date library included use-after-free vulnerability](#CVE-2021-29972)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

A user-after-free vulnerability was found via testing, and traced to an out-of-date Cairo library. Updating the library resolved the issue, and may have remediated other, unknown security vulnerabilities as well.

##### References

* [Bug 1696816](https://bugzilla.mozilla.org/show_bug.cgi?id=1696816)

#### [#CVE-2021-29973: Password autofill on HTTP websites was enabled without user interaction on Android](#CVE-2021-29973)

Reporter
Wladimir Palant working with Include Security
Impact
moderate
##### Description

Password autofill was enabled without user interaction on insecure websites on Firefox for Android. This was corrected to require user interaction with the page before a user's password would be entered by the browser's autofill functionality.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1701932](https://bugzilla.mozilla.org/show_bug.cgi?id=1701932)

#### [#CVE-2021-29974: HSTS errors could be overridden when network partitioning was enabled](#CVE-2021-29974)

Reporter
Peter Gerber
Impact
moderate
##### Description

When network partitioning was enabled, e.g. as a result of Enhanced Tracking Protection settings, a TLS error page would allow the user to override an error on a domain which had specified HTTP Strict Transport Security (which implies that the error should not be override-able.) This issue did not affect the network connections, and they were correctly upgraded to HTTPS automatically.

##### References

* [Bug 1704843](https://bugzilla.mozilla.org/show_bug.cgi?id=1704843)

#### [#CVE-2021-29975: Text message could be overlaid on top of another website](#CVE-2021-29975)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through a series of DOM manipulations, a message, over which the attacker had control of the text but not HTML or formatting, could be overlaid on top of another domain (with the new domain correctly shown in the address bar) resulting in possible user confusion.

##### References

* [Bug 1713259](https://bugzilla.mozilla.org/show_bug.cgi?id=1713259)

#### [#CVE-2021-29976: Memory safety bugs fixed in Firefox 90 and Firefox ESR 78.12](#CVE-2021-29976)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Emil Ghitta, Tyson Smith, Valentin Gosu, Olli Pettay, and Randell Jesup reported memory safety bugs present in Firefox 89 and Firefox ESR 78.11. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 90 and Firefox ESR 78.12](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1700895%2C1703334%2C1706910%2C1711576%2C1714391)

#### [#CVE-2021-29977: Memory safety bugs fixed in Firefox 90](#CVE-2021-29977)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Andrew McCreight, Tyson Smith, Christian Holler, and Gabriele Svelto reported memory safety bugs present in Firefox 89. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 90](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1665836%2C1686138%2C1704316%2C1706314%2C1709931%2C1712084%2C1712357%2C1714066)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


