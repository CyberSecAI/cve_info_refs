=== Content from www.mozilla.org_8a98e4d8_20250114_201447.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-35

## Security Vulnerabilities fixed in Thunderbird 78.13

Announced
August 10, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 78.13

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Thunderbird incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29989: Memory safety bugs fixed in Thunderbird 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Simon Giesecke, Sandor Molnar, and Olli Pettay reported memory safety bugs present in Thunderbird 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_795b7589_20250114_201447.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-34

## Security Vulnerabilities fixed in Firefox ESR 78.13

Announced
August 10, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 78.13

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Simon Giesecke, Sandor Molnar, and Olli Pettay reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_e84c88fe_20250114_201443.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1717922)
* [XML](/show_bug.cgi?ctype=xml&id=1717922)

Closed
[Bug 1717922](/show_bug.cgi?id=1717922)
(CVE-2021-29988)

Opened 4 years ago
Closed 4 years ago

# AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

92 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | [91+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=91%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=verified) |
| firefox90 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix) |
| firefox91 | [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=verified) |
| firefox92 | --- | [verified](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 | 91+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox90 |  | wontfix |
| firefox91 | + | verified |
| firefox92 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sourc7, Assigned: emilio)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1d91d22a4892f16f744b31fd4286144e?d=mm&size=40)  [emilio](/user_profile?user_id=546716)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1f6e740893c5a41879a277dd0b0a0c4a?d=mm&size=40)  [sourc7](/user_profile?user_id=537720)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1717462](/show_bug.cgi?id=1717462 "RESOLVED DUPLICATE - AddressSanitizer: use-after-poison [@ nsLineBox::GetChildCount] with READ of size 2")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main91+][adv-esr78.13+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29988

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main91+][adv-esr78.13+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2323818_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [tsmith](/user_profile?user_id=486634) | [in-testsuite](#a1021610_486634 "4 years ago") | ? |
| --- | --- | --- |
| [tsmith](/user_profile?user_id=486634) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (13 files, 2 obsolete files)

| [bof-interesting.html](/attachment.cgi?id=9228632)  [4 years ago](#c0)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   506 bytes, text/html |  | [Details](/attachment.cgi?id=9228632&action=edit) |
| --- | --- | --- |
| [asan.linux.txt](/attachment.cgi?id=9228633)  [4 years ago](#c1)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   24.69 KB, text/plain |  | [Details](/attachment.cgi?id=9228633&action=edit) |
| [valgrind-bof-testcase.txt](/attachment.cgi?id=9228749)  [4 years ago](#c4)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   98.17 KB, text/plain |  | [Details](/attachment.cgi?id=9228749&action=edit) |
| [valgrind-segv-testcase.txt](/attachment.cgi?id=9228750)  [4 years ago](#c5)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   9.11 KB, text/plain |  | [Details](/attachment.cgi?id=9228750&action=edit) |
| [asan.segv.txt](/attachment.cgi?id=9228870)  [4 years ago](#c8)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   12.14 KB, text/plain |  | [Details](/attachment.cgi?id=9228870&action=edit) |
| [testcase.new.html](/attachment.cgi?id=9228872)  [4 years ago](#c9)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   241 bytes, text/html |  | [Details](/attachment.cgi?id=9228872&action=edit) |
| [bof-universal.html](/attachment.cgi?id=9228873)  [4 years ago](#c10)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   621 bytes, text/html |  | [Details](/attachment.cgi?id=9228873&action=edit) |
| [asan.bof.txt](/attachment.cgi?id=9228874)  [4 years ago](#c11)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   31.90 KB, text/plain |  | [Details](/attachment.cgi?id=9228874&action=edit) |
| [Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame](/attachment.cgi?id=9230681)  [4 years ago](#c18)  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)   48 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#c32 "3 years ago")  jcristau : [approval-mozilla-release-](#c31 "3 years ago")  tjr : [sec-approval+](#c21 "4 years ago") | [Details](/attachment.cgi?id=9230681&action=edit) | [Review](/attachment.cgi?id=9230681) |
| [GetChildCount-0x4141.html](/attachment.cgi?id=9231788)  [3 years ago](#c23)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   658 bytes, text/html |  | [Details](/attachment.cgi?id=9231788&action=edit) |
| [asan-0x4141-windows.txt](/attachment.cgi?id=9231789)  [3 years ago](#c24)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   14.49 KB, text/plain |  | [Details](/attachment.cgi?id=9231789&action=edit) |
| [ESR patch](/attachment.cgi?id=9232383)  [3 years ago](#c30)  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)   8.37 KB, patch | jcristau : [approval-mozilla-esr78+](#c35 "3 years ago") | [Details](/attachment.cgi?id=9232383&action=edit) | [Diff](/attachment.cgi?id=9232383&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1717922&attachment=9232383) |
| [ESR patch w/ fix for comment 37](/attachment.cgi?id=9233057)  [3 years ago](#c38)  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)   7.02 KB, patch |  | [Details](/attachment.cgi?id=9233057&action=edit) | [Diff](/attachment.cgi?id=9233057&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1717922&attachment=9233057) |
| [ESR patch, take 3 (just the expectation file removed)](/attachment.cgi?id=9233276)  [3 years ago](#c43)  [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)   6.13 KB, text/plain |  | [Details](/attachment.cgi?id=9233276&action=edit) |
| [advisory.txt](/attachment.cgi?id=9235144)  [3 years ago](#c47)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   238 bytes, text/plain |  | [Details](/attachment.cgi?id=9235144&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1717922#c0)• 4 years ago |
|  | |

Attached file
[bof-interesting.html](attachment.cgi?id=9228632)
— [Details](attachment.cgi?id=9228632&action=edit)

When Accesibility `Activated: true` on `about:support` then after visit the bof-interesting.html, the tab immediately crashed with heap-buffer-overflow in `nsLineBox::GetChildCount()`.

Interestingly when minimizing the testcase with Lithium I got some different ASan report:

* heap-buffer-overflow with READ size of 2
* SEGV on unknown address `0x00a57fff8003` or `0x00a6ffff8002`
* access-violation on unknown address `0x0241fd38002` (on Windows 10)
* use-after-poison with READ size of 2

Mozregression show it is regression of [Bug 1542807 - Remove legacy layout code path for ::marker (nsBulletFrame)](https://bugzilla.mozilla.org/show_bug.cgi?id=1542807).

## Steps to reproduce:

1. Open Screen Reader (e.g. Microsoft Narrator, Orca on Linux, or VoiceOver on macOS)
2. Open Firefox Nightly or Firefox ASan
3. Visit attached bof-interesting.html
4. Tab crashed with heap-buffer-overflow (on Linux) or access-violation (on Windows 10)

## ASan output:

```
=================================================================
==527348==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62500020510c at pc 0x7fa831a45f09 bp 0x7fff0e24db40 sp 0x7fff0e24db38
READ of size 2 at 0x62500020510c thread T0 (file:// Content)
    #0 0x7fa831a45f08 in nsLineBox::GetChildCount() const /builds/worker/checkouts/gecko/layout/generic/nsLineBox.h:322:12
    #1 0x7fa831d96aa9 in BuildTextRuns /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:1517:28
    #2 0x7fa831d96aa9 in nsTextFrame::EnsureTextRun(nsTextFrame::TextRunType, mozilla::gfx::DrawTarget*, nsIFrame*, nsLineList_iterator const*, unsigned int*) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:2991:7
    #3 0x7fa831da326a in nsTextFrame::GetRenderedText(unsigned int, unsigned int, nsIFrame::TextOffsetType, nsIFrame::TrailingWhitespace) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:9895:20
    #4 0x7fa8349b7ee3 in mozilla::a11y::NotificationController::WillRefresh(mozilla::TimeStamp) /builds/worker/checkouts/gecko/accessible/base/NotificationController.cpp:685:46
    #5 0x7fa8318f9159 in nsRefreshDriver::Tick(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp, nsRefreshDriver::IsExtraTick) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:2240:12
    #6 0x7fa831905d67 in TickDriver /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:348:13
    #7 0x7fa831905d67 in mozilla::RefreshDriverTimer::TickRefreshDrivers(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:326:7
    #8 0x7fa831905acd in mozilla::RefreshDriverTimer::Tick(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:342:5
    #9 0x7fa831905855 in mozilla::VsyncRefreshDriverTimer::RunRefreshDrivers(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:775:5
    #10 0x7fa831904e5f in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:704:16
    #11 0x7fa83190441b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyParentProcessVsync() /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:617:7
    #12 0x7fa831903b91 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::VsyncEvent const&) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:538:9
    #13 0x7fa830badb8f in mozilla::dom::VsyncChild::RecvNotify(mozilla::VsyncEvent const&, float const&) /builds/worker/checkouts/gecko/dom/ipc/VsyncChild.cpp:68:15
    #14 0x7fa82bae214c in mozilla::dom::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PVsyncChild.cpp:178:54
    #15 0x7fa82b892f1f in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PBackgroundChild.cpp:6091:32
    #16 0x7fa82b4b1616 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2085:25
    #17 0x7fa82b4af10c in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2012:9
    #18 0x7fa82b4b031e in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1860:3
    #19 0x7fa82b4b0a9b in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1891:13
    #20 0x7fa82a3dce22 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502:16
    #21 0x7fa82a3a9940 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805:26
    #22 0x7fa82a3a7188 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641:15
    #23 0x7fa82a3a789d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425:36
    #24 0x7fa82a3e7101 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
    #25 0x7fa82a3e7101 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
    #26 0x7fa82a3c4298 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1152:16
    #27 0x7fa82a3cf0dc in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #28 0x7fa82b4b824a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #29 0x7fa82b3c42b1 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #30 0x7fa82b3c42b1 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #31 0x7fa82b3c42b1 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #32 0x7fa83140a4e7 in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
    #33 0x7fa8352fe60f in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #34 0x7fa82b3c42b1 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #35 0x7fa82b3c42b1 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #36 0x7fa82b3c42b1 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #37 0x7fa8352fdfe4 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #38 0x55e44770742d in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #39 0x55e447707851 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327:18
    #40 0x7fa846c3cb24 in __libc_start_main (/usr/lib/libc.so.6+0x27b24)
    #41 0x55e44765874c in _start (/tmp/m-c-20210623155828-asan-opt/firefox+0x5674c)

0x62500020510c is located 12 bytes to the right of 8192-byte region [0x625000203100,0x625000205100)
allocated by thread T0 (file:// Content) here:
    #0 0x55e4476d37ad in malloc /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3
    #1 0x7fa82a385fa0 in mozilla::ArenaAllocator<8192ul, 8ul>::AllocateChunk(unsigned long) /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:170:15
    #2 0x7fa831a9b3bd in InternalAllocate /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:204:25
    #3 0x7fa831a9b3bd in Allocate /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:66:12
    #4 0x7fa831a9b3bd in mozilla::ArenaAllocator<8192ul, 8ul>::Allocate(unsigned long) /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:70:15
    #5 0x7fa831b13f55 in AllocateByObjectID /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:271:32
    #6 0x7fa831b13f55 in AllocateFrame /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:263:12
    #7 0x7fa831b13f55 in operator new /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:36:1
    #8 0x7fa831b13f55 in NS_NewViewportFrame(mozilla::PresShell*, mozilla::ComputedStyle*) /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:33:10
    #9 0x7fa8319f0292 in nsCSSFrameConstructor::ConstructRootFrame() /builds/worker/checkouts/gecko/layout/base/nsCSSFrameConstructor.cpp:2486:7
    #10 0x7fa83195744e in mozilla::PresShell::Initialize() /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:1879:36
    #11 0x7fa82d31fa8b in nsContentSink::StartLayout(bool) /builds/worker/checkouts/gecko/dom/base/nsContentSink.cpp:871:30
    #12 0x7fa82c1a7459 in nsHtml5TreeOpExecutor::StartLayout(bool*) /builds/worker/checkouts/gecko/parser/html/nsHtml5TreeOpExecutor.cpp:826:18
==527348==WARNING: Symbolizer buffer too small
    #13 0x7fa82c1b201b  (/tmp/m-c-20210623155828-asan-opt/libxul.so+0x54e501b)
==527348==WARNING: Symbolizer buffer too small
    #14 0x7fa82c1a612e  (/tmp/m-c-20210623155828-asan-opt/libxul.so+0x54d912e)
    #15 0x7fa82c1a5307 in umberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #16 0x7fa82c1a5307 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #17 0x7fa82c1a5307 in decltype(auto) mozilla::detail::VariantImplementation<unsigned char, 7ul, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>::match<nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*)::TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>&>(nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*)::TreeOperationMatcher&&, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>&) /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #18 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #19 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #20 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #21 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #22 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #23 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #24 0x7fa82c1ac1c6 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #25 0x7fa82c1ac1c6 in match<TreeOperationMatcher> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:851:12
    #26 0x7fa82c1ac1c6 in nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*) /builds/worker/checkouts/gecko/parser/html/nsHtml5TreeOperation.cpp:1213:21
    #27 0x7fa82a398dcf in nsHtml5ExecutorFlusher::Run() /builds/worker/checkouts/gecko/parser/html/nsHtml5StreamParser.cpp:179:18
    #28 0x7fa82a3dce22 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
    #29 0x7fa82a3a9940 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502:16
    #30 0x7fa82a3a7188 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805:26
    #31 0x7fa82a3a789d in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641:15
    #32 0x7fa82a3e7101 in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425:36
    #33 0x7fa82a3c4298 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
    #34 0x7fa82a3c4298 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
    #35 0x7fa82a3cf0dc in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1152:16
    #36 0x7fa82b4b824a in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #37 0x7fa82b3c42b1 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #38 0x7fa83140a4e7 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #39 0x7fa83140a4e7 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #40 0x7fa83140a4e7 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #41 0x7fa8352fe60f in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
    #42 0x7fa82b3c42b1 in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #43 0x7fa8352fdfe4 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #44 0x7fa8352fdfe4 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #45 0x7fa8352fdfe4 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #46 0x55e44770742d in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #47 0x55e447707851 in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #48 0x7fa846c3cb24 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327:18

SUMMARY: AddressSanitizer: heap-buffer-overflow (/tmp/m-c-20210623155828-asan-opt/libxul.so+0xad78f08) in __libc_start_main
Shadow bytes around the buggy address:
  0x0c4a800389d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a800389e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a800389f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a80038a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a80038a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f7
=>0x0c4a80038a20: fa[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a50: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==527348==ABORTING

```
Flags: sec-bounty?

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1717922#c1)• 4 years ago |
|  | |

Attached file
[asan.linux.txt](attachment.cgi?id=9228633)
— [Details](attachment.cgi?id=9228633&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1717922#c2)• 4 years ago |
|  | |

Tyson thinks our fuzzers have logged this already. ni? to him to find it.

Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a962_486634)• 4 years ago |

Group: firefox-core-security → layout-core-securityComponent: Security → Disability Access APIsFlags: needinfo?(twsmith)Product: Firefox → Core

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1717922#c3)• 4 years ago |
|  | |

Jamie, Eitan: This looks similar to [bug 1610088](/show_bug.cgi?id=1610088 "RESOLVED FIXED - use-after-poison in [@ BuildTextRuns]")

Flags: needinfo?(jteh)Flags: needinfo?(eitan)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1717922#c4)• 4 years ago |
|  | |

Attached file
[valgrind-bof-testcase.txt](attachment.cgi?id=9228749)
— [Details](attachment.cgi?id=9228749&action=edit)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1717922#c5)• 4 years ago |
|  | |

Attached file
[valgrind-segv-testcase.txt](attachment.cgi?id=9228750)
— [Details](attachment.cgi?id=9228750&action=edit)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1717922#c6)• 4 years ago |
|  | |

The crash occurs after checking out to commit [Bug 1542807 part 1 - Create generated content and use normal box construction for list-style-type/list-style-image ::markers.](https://hg.mozilla.org/mozilla-central/rev/82bc8b9b8bb8723c7bcb7c7f8c7031c30343e74f)

I confirmed it no longer crashed after commenting line of code `aAddChild(child)` on `nsCSSFrameConstructor::CreateGeneratedContentFromListStyleType` function as following:

```
void nsCSSFrameConstructor::CreateGeneratedContentFromListStyleType(
    nsFrameConstructorState& aState, const ComputedStyle& aPseudoStyle,
    const FunctionRef<void(nsIContent*)> aAddChild) {
  ...
  if (!needUseNode) {
    nsAutoString text;
    node->GetText(WritingMode(&aPseudoStyle), counterStyle, text);
    // Note that we're done with 'node' in this case.  It's not inserted into
    // any list so it's deleted when we return.
    RefPtr<nsIContent> child = CreateGenConTextNode(aState, text, nullptr);
    // aAddChild(child);
    return;
  }

  nsCounterList* counterList =
      mCounterManager.CounterListFor(nsGkAtoms::list_item);
  auto initializer = MakeUnique<nsGenConInitializer>(
      std::move(node), counterList, &nsCSSFrameConstructor::CountersDirty);
  RefPtr<nsIContent> child =
      CreateGenConTextNode(aState, EmptyString(), std::move(initializer));
  // aAddChild(child);
}

```

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a95252_537720)• 4 years ago |

Summary: AddressSanitizer: heap-buffer-overflow and SEGV in a11y::NotificationController::WillRefresh -> nsLineBox::GetChildCount() → AddressSanitizer: heap-buffer-overflow and SEGV in nsLineBox::GetChildCount()

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1717922#c7)• 4 years ago |
|  | |

I found new testcase it can be triggered without Accesibility: `Activated` `true` or without screen reader, hereby the following ASan report:

```
AddressSanitizer:DEADLYSIGNAL
=================================================================
==97526==ERROR: AddressSanitizer: SEGV on unknown address 0x0016ffff8014 (pc 0x7f2bd967faaf bp 0x7ffd1776abb0 sp 0x7ffd1776abb0 T0)
==97526==The signal is caused by a READ memory access.
    #0 0x7f2bd967faaf in EntryCount /builds/worker/workspace/obj-build/dist/include/PLDHashTable.h:434:40
    #1 0x7f2bd967faaf in Count /builds/worker/workspace/obj-build/dist/include/nsTHashtable.h:274:42
    #2 0x7f2bd967faaf in nsTBaseHashSet<nsPtrHashKey<nsIFrame> >::Count() const /builds/worker/workspace/obj-build/dist/include/nsTHashSet.h:53:55
    #3 0x7f2bd99d00a9 in BuildTextRuns /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:1517:28
    #4 0x7f2bd99d00a9 in nsTextFrame::EnsureTextRun(nsTextFrame::TextRunType, mozilla::gfx::DrawTarget*, nsIFrame*, nsLineList_iterator const*, unsigned int*) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:2991:7
    #5 0x7f2bd9997dbc in nsTextFrame::RecomputeOverflow(nsIFrame*, bool) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:9771:31
    #6 0x7f2bd99974f5 in nsLineLayout::RelativePositionFrames(nsLineLayout::PerSpanData*, mozilla::OverflowAreas&) /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.cpp:3311:18
    #7 0x7f2bd99973b6 in nsLineLayout::RelativePositionFrames(nsLineLayout::PerSpanData*, mozilla::OverflowAreas&) /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.cpp:3295:7
    #8 0x7f2bd99973b6 in nsLineLayout::RelativePositionFrames(nsLineLayout::PerSpanData*, mozilla::OverflowAreas&) /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.cpp:3295:7
    #9 0x7f2bd9780c72 in RelativePositionFrames /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.h:117:5
    #10 0x7f2bd9780c72 in nsBlockFrame::PlaceLine(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFloatManager::SavedState*, nsFlowAreaRect&, int&, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4988:15
    #11 0x7f2bd977f128 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4477:12
    #12 0x7f2bd9777d6e in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4235:9
    #13 0x7f2bd9771519 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3215:5
    #14 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #15 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #16 0x7f2bd979b87f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1000:14
    #17 0x7f2bd9aeb945 in nsTableWrapperFrame::ReflowChild(nsPresContext*, nsIFrame*, mozilla::ReflowInput const&, mozilla::ReflowOutput&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/tables/nsTableWrapperFrame.cpp:848:21
    #18 0x7f2bd9aec660 in nsTableWrapperFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/tables/nsTableWrapperFrame.cpp:960:5
    #19 0x7f2bd977c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #20 0x7f2bd97746e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #21 0x7f2bd9771666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #22 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #23 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #24 0x7f2bd977c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #25 0x7f2bd97746e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #26 0x7f2bd9771666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #27 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #28 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #29 0x7f2bd977c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #30 0x7f2bd97746e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #31 0x7f2bd9771666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #32 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #33 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #34 0x7f2bd977c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #35 0x7f2bd97746e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #36 0x7f2bd9771666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #37 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #38 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #39 0x7f2bd977c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #40 0x7f2bd97746e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #41 0x7f2bd9771666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #42 0x7f2bd9768e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #43 0x7f2bd976206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #44 0x7f2bd979b87f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1000:14
    #45 0x7f2bd979a024 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsCanvasFrame.cpp:819:7
    #46 0x7f2bd979b87f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1000:14
    #47 0x7f2bd9824fad in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:758:3
    #48 0x7f2bd982682c in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:881:3
    #49 0x7f2bd982cb3e in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:1300:3
    #50 0x7f2bd97521c6 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1040:14
    #51 0x7f2bd9751806 in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:374:7
    #52 0x7f2bd95946b4 in mozilla::PresShell::DoReflow(nsIFrame*, bool, mozilla::OverflowChangedTracker*) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:9573:11
    #53 0x7f2bd95a5567 in mozilla::PresShell::ProcessReflowCommands(bool) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:9744:24    #54 0x7f2bd95a3e71 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:4230:11
    #55 0x7f2bd95331b7 in FlushPendingNotifications /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:1411:5
    #56 0x7f2bd95331b7 in nsRefreshDriver::Tick(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp, nsRefreshDriver::IsExtraTick) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:2328:20
    #57 0x7f2bd953f777 in TickDriver /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:348:13
    #58 0x7f2bd953f777 in mozilla::RefreshDriverTimer::TickRefreshDrivers(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:326:7
    #59 0x7f2bd953f4dd in mozilla::RefreshDriverTimer::Tick(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:342:5
    #60 0x7f2bd953f265 in mozilla::VsyncRefreshDriverTimer::RunRefreshDrivers(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:775:5
    #61 0x7f2bd953e86f in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::layers::BaseTransactionId<mozilla::VsyncIdType>, mozilla::TimeStamp) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:704:16
    #62 0x7f2bd953de2b in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyParentProcessVsync() /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:617:7
    #63 0x7f2bd953d5a1 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::VsyncEvent const&) /builds/worker/checkouts/gecko/layout/base/nsRefreshDriver.cpp:538:9
    #64 0x7f2bd87dfbbf in mozilla::dom::VsyncChild::RecvNotify(mozilla::VsyncEvent const&, float const&) /builds/worker/checkouts/gecko/dom/ipc/VsyncChild.cpp:68:15
    #65 0x7f2bd370f2fc in mozilla::dom::PVsyncChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PVsyncChild.cpp:178:54
    #66 0x7f2bd34c00cf in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PBackgroundChild.cpp:6091:32
    #67 0x7f2bd30de7c6 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2085:25
    #68 0x7f2bd30dc2bc in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2012:9
    #69 0x7f2bd30dd4ce in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1860:3
    #70 0x7f2bd30ddc4b in mozilla::ipc::MessageChannel::MessageTask::Run() /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1891:13
    #71 0x7f2bd2009b92 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502:16
    #72 0x7f2bd1fd66b0 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805:26
    #73 0x7f2bd1fd3ef8 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641:15
    #74 0x7f2bd1fd460d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425:36
    #75 0x7f2bd2013e71 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
    #76 0x7f2bd2013e71 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
    #77 0x7f2bd1ff1008 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1152:16
    #78 0x7f2bd1ffbe4c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #79 0x7f2bd30e53fa in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #80 0x7f2bd2ff1461 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #81 0x7f2bd2ff1461 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #82 0x7f2bd2ff1461 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #83 0x7f2bd9043c37 in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
    #84 0x7f2bdcf39bef in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #85 0x7f2bd2ff1461 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #86 0x7f2bd2ff1461 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #87 0x7f2bd2ff1461 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #88 0x7f2bdcf395c4 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #89 0x55baf399642d in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #90 0x55baf3996851 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327:18
    #91 0x7f2bee87bb24 in __libc_start_main (/usr/lib/libc.so.6+0x27b24)
    #92 0x55baf38e774c in _start (/tmp/m-c-20210624093849-asan-opt/firefox+0x5674c)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /builds/worker/workspace/obj-build/dist/include/PLDHashTable.h:434:40 in EntryCount
==97526==ABORTING

```

I'm currently minimizing the testcase. I'll attach the new testcase after the testcase is minimized.

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1717922#c8)• 4 years ago |
|  | |

Attached file
[asan.segv.txt](attachment.cgi?id=9228870)
— [Details](attachment.cgi?id=9228870&action=edit)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1717922#c9)• 4 years ago |
|  | |

Attached file
[testcase.new.html](attachment.cgi?id=9228872)
— [Details](attachment.cgi?id=9228872&action=edit)

Hereby I attach the new testcase that trigger SEGV without accessibility or screen reader. Tested working on Firefox Nightly 91.0a1 (2021-06-24) (64-bit) and m-c-20210624093849-asan-opt.

The crash reasons occurred same as on [comment 6](/show_bug.cgi?id=1717922#c6 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()"), I think we can re-assign the component and mark this as [Bug 1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)") regression.

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1717922#c10)• 4 years ago |
|  | |

Attached file
[bof-universal.html](attachment.cgi?id=9228873)
— [Details](attachment.cgi?id=9228873&action=edit)

Alright great! It turns out by adding CSS code from testcase.new.html (on [comment 9](/show_bug.cgi?id=1717922#c9 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()")) to bof-interesting.html (on [comment 0](/show_bug.cgi?id=1717922#c0 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()")) it can trigger the heap-buffer-overflow without require a11y accessibility.

## ASan output:

```
==322466==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62500020510c at pc 0x7fdadd75f919 bp 0x7ffcd670ea40 sp 0x7ffcd670ea38
READ of size 2 at 0x62500020510c thread T0 (file:// Content)
    #0 0x7fdadd75f918 in nsLineBox::GetChildCount() const /builds/worker/checkouts/gecko/layout/generic/nsLineBox.h:322:12
    #1 0x7fdaddab00a9 in BuildTextRuns /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:1517:28
    #2 0x7fdaddab00a9 in nsTextFrame::EnsureTextRun(nsTextFrame::TextRunType, mozilla::gfx::DrawTarget*, nsIFrame*, nsLineList_iterator const*, unsigned int*) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:2991:7
    #3 0x7fdadda77dbc in nsTextFrame::RecomputeOverflow(nsIFrame*, bool) /builds/worker/checkouts/gecko/layout/generic/nsTextFrame.cpp:9771:31
    #4 0x7fdadda774f5 in nsLineLayout::RelativePositionFrames(nsLineLayout::PerSpanData*, mozilla::OverflowAreas&) /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.cpp:3311:18
    #5 0x7fdadda773b6 in nsLineLayout::RelativePositionFrames(nsLineLayout::PerSpanData*, mozilla::OverflowAreas&) /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.cpp:3295:7
    #6 0x7fdadd860c72 in RelativePositionFrames /builds/worker/checkouts/gecko/layout/generic/nsLineLayout.h:117:5
    #7 0x7fdadd860c72 in nsBlockFrame::PlaceLine(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFloatManager::SavedState*, nsFlowAreaRect&, int&, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4988:15
    #8 0x7fdadd85f128 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4477:12
    #9 0x7fdadd857d6e in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:4235:9
    #10 0x7fdadd851519 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3215:5
    #11 0x7fdadd848e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #12 0x7fdadd84206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #13 0x7fdadd85c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #14 0x7fdadd8546e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #15 0x7fdadd851666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #16 0x7fdadd848e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #17 0x7fdadd84206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #18 0x7fdadd85c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #19 0x7fdadd8546e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #20 0x7fdadd851666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #21 0x7fdadd848e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #22 0x7fdadd84206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #23 0x7fdadd85c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #24 0x7fdadd8546e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #25 0x7fdadd851666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #26 0x7fdadd848e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #27 0x7fdadd84206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #28 0x7fdadd85c693 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockReflowContext.cpp:288:11
    #29 0x7fdadd8546e2 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3871:11
    #30 0x7fdadd851666 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:3212:5
    #31 0x7fdadd848e70 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:2749:7
    #32 0x7fdadd84206b in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsBlockFrame.cpp:1380:3
    #33 0x7fdadd87b87f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1000:14
    #34 0x7fdadd87a024 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsCanvasFrame.cpp:819:7
    #35 0x7fdadd87b87f in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1000:14
    #36 0x7fdadd904fad in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:758:3
    #37 0x7fdadd90682c in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:881:3
    #38 0x7fdadd90cb3e in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/nsGfxScrollFrame.cpp:1300:3
    #39 0x7fdadd8321c6 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, nsIFrame::ReflowChildFlags, nsReflowStatus&, nsOverflowContinuationTracker*) /builds/worker/checkouts/gecko/layout/generic/nsContainerFrame.cpp:1040:14
    #40 0x7fdadd831806 in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:374:7
    #41 0x7fdadd6746b4 in mozilla::PresShell::DoReflow(nsIFrame*, bool, mozilla::OverflowChangedTracker*) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:9573:11
    #42 0x7fdadd685567 in mozilla::PresShell::ProcessReflowCommands(bool) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:9744:24
    #43 0x7fdadd683e71 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:4230:11
    #44 0x7fdad8e3ddc7 in FlushPendingNotifications /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:1411:5
    #45 0x7fdad8e3ddc7 in mozilla::dom::Document::FlushPendingNotifications(mozilla::ChangesToFlush) /builds/worker/checkouts/gecko/dom/base/Document.cpp:10594:16
    #46 0x7fdad7cf745c in nsDocLoader::DocLoaderIsEmpty(bool, mozilla::Maybe<nsresult> const&) /builds/worker/checkouts/gecko/uriloader/base/nsDocLoader.cpp:732:14
    #47 0x7fdad7cfa159 in nsDocLoader::OnStopRequest(nsIRequest*, nsresult) /builds/worker/checkouts/gecko/uriloader/base/nsDocLoader.cpp:670:5
    #48 0x7fdae058fe5f in nsDocShell::OnStopRequest(nsIRequest*, nsresult) /builds/worker/checkouts/gecko/docshell/base/nsDocShell.cpp:13515:23
    #49 0x7fdad63a61be in mozilla::net::nsLoadGroup::NotifyRemovalObservers(nsIRequest*, nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsLoadGroup.cpp:614:22
    #50 0x7fdad63a8983 in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsLoadGroup.cpp:518:10
    #51 0x7fdad8e43d10 in mozilla::dom::Document::DoUnblockOnload() /builds/worker/checkouts/gecko/dom/base/Document.cpp:11347:18
    #52 0x7fdad8dfff8e in mozilla::dom::Document::UnblockOnload(bool) /builds/worker/checkouts/gecko/dom/base/Document.cpp:11277:9
    #53 0x7fdad8e223cf in mozilla::dom::Document::DispatchContentLoadedEvents() /builds/worker/checkouts/gecko/dom/base/Document.cpp:7785:3
    #54 0x7fdad8ede5af in applyImpl<mozilla::dom::Document, void (mozilla::dom::Document::*)()> /builds/worker/workspace/obj-build/dist/include/nsThreadUtils.h:1150:12
    #55 0x7fdad8ede5af in apply<mozilla::dom::Document, void (mozilla::dom::Document::*)()> /builds/worker/workspace/obj-build/dist/include/nsThreadUtils.h:1156:12
    #56 0x7fdad8ede5af in mozilla::detail::RunnableMethodImpl<mozilla::dom::Document*, void (mozilla::dom::Document::*)(), true, (mozilla::RunnableKind)0>::Run() /builds/worker/workspace/obj-build/dist/include/nsThreadUtils.h:1203:13
    #57 0x7fdad60a5b4f in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
    #58 0x7fdad60e9b92 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502:16
    #59 0x7fdad60b66b0 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805:26
    #60 0x7fdad60b3ef8 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641:15
    #61 0x7fdad60b460d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425:36
    #62 0x7fdad60f3e71 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
    #63 0x7fdad60f3e71 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
    #64 0x7fdad60d1008 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1152:16
    #65 0x7fdad60dbe4c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #66 0x7fdad71c53fa in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #67 0x7fdad70d1461 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #68 0x7fdad70d1461 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #69 0x7fdad70d1461 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #70 0x7fdadd123c37 in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
    #71 0x7fdae1019bef in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #72 0x7fdad70d1461 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #73 0x7fdad70d1461 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #74 0x7fdad70d1461 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #75 0x7fdae10195c4 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #76 0x562491ed642d in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #77 0x562491ed6851 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327:18
    #78 0x7fdaf295cb24 in __libc_start_main (/usr/lib/libc.so.6+0x27b24)
    #79 0x562491e2774c in _start (/tmp/m-c-20210624093849-asan-opt/firefox+0x5674c)

0x62500020510c is located 12 bytes to the right of 8192-byte region [0x625000203100,0x625000205100)
allocated by thread T0 (file:// Content) here:
    #0 0x562491ea27ad in malloc /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3
    #1 0x7fdad6092d20 in mozilla::ArenaAllocator<8192ul, 8ul>::AllocateChunk(unsigned long) /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:170:15
    #2 0x7fdadd7b4dcd in InternalAllocate /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:204:25
    #3 0x7fdadd7b4dcd in Allocate /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:66:12
    #4 0x7fdadd7b4dcd in mozilla::ArenaAllocator<8192ul, 8ul>::Allocate(unsigned long) /builds/worker/workspace/obj-build/dist/include/mozilla/ArenaAllocator.h:70:15
    #5 0x7fdadd82d965 in AllocateByObjectID /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:271:32
    #6 0x7fdadd82d965 in AllocateFrame /builds/worker/workspace/obj-build/dist/include/mozilla/PresShell.h:263:12
    #7 0x7fdadd82d965 in operator new /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:36:1
    #8 0x7fdadd82d965 in NS_NewViewportFrame(mozilla::PresShell*, mozilla::ComputedStyle*) /builds/worker/checkouts/gecko/layout/generic/ViewportFrame.cpp:33:10
    #9 0x7fdadd709ca2 in nsCSSFrameConstructor::ConstructRootFrame() /builds/worker/checkouts/gecko/layout/base/nsCSSFrameConstructor.cpp:2486:7
    #10 0x7fdadd670e5e in mozilla::PresShell::Initialize() /builds/worker/checkouts/gecko/layout/base/PresShell.cpp:1879:36
    #11 0x7fdad902e75b in nsContentSink::StartLayout(bool) /builds/worker/checkouts/gecko/dom/base/nsContentSink.cpp:871:30
    #12 0x7fdad7eb4d09 in nsHtml5TreeOpExecutor::StartLayout(bool*) /builds/worker/checkouts/gecko/parser/html/nsHtml5TreeOpExecutor.cpp:826:18
==322466==WARNING: Symbolizer buffer too small
    #13 0x7fdad7ebf8cb  (/tmp/m-c-20210624093849-asan-opt/libxul.so+0x54e98cb)
==322466==WARNING: Symbolizer buffer too small
    #14 0x7fdad7eb39de  (/tmp/m-c-20210624093849-asan-opt/libxul.so+0x54dd9de)
    #15 0x7fdad7eb2bb7 in umberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #16 0x7fdad7eb2bb7 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #17 0x7fdad7eb2bb7 in decltype(auto) mozilla::detail::VariantImplementation<unsigned char, 7ul, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>::match<nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*)::TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>&>(nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*)::TreeOperationMatcher&&, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu>&) /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #18 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #19 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #20 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #21 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #22 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #23 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #24 0x7fdad7eb9a76 in match<TreeOperationMatcher, mozilla::Variant<uninitialized, opAppend, opDetach, opAppendChildrenToNewParent, opFosterParent, opAppendToDocument, opAddAttributes, nsHtml5DocumentMode, opCreateHTMLElement, opCreateSVGElement, opCreateMathMLElement, opSetFormElement, opAppendText, opFosterParentText, opAppendComment, opAppendCommentToDocument, opAppendDoctypeToDocument, opGetDocumentFragmentForTemplate, opGetFosterParent, opMarkAsBroken, opRunScript, opRunScriptAsyncDefer, opPreventScriptExecution, opDoneAddingChildren, opDoneCreatingElement, opSetDocumentCharset, opCharsetSwitchTo, opUpdateStyleSheet, opProcessOfflineManifest, opMarkMalformedIfScript, opStreamEnded, opSetStyleLineNumber, opSetScriptLineNumberAndFreeze, opSvgLoad, opMaybeComplainAboutCharset, opMaybeComplainAboutDeepTree, opAddClass, opAddViewSourceHref, opAddViewSourceBase, opAddErrorType, opAddLineNumberId, opStartLayout, opEnableEncodingMenu> &> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:278:14
    #25 0x7fdad7eb9a76 in match<TreeOperationMatcher> /builds/worker/workspace/obj-build/dist/include/mozilla/Variant.h:851:12
    #26 0x7fdad7eb9a76 in nsHtml5TreeOperation::Perform(nsHtml5TreeOpExecutor*, nsIContent**, bool*, bool*) /builds/worker/checkouts/gecko/parser/html/nsHtml5TreeOperation.cpp:1213:21
    #27 0x7fdad60a5b4f in nsHtml5ExecutorFlusher::Run() /builds/worker/checkouts/gecko/parser/html/nsHtml5StreamParser.cpp:179:18
    #28 0x7fdad60e9b92 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
    #29 0x7fdad60b66b0 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502:16
    #30 0x7fdad60b3ef8 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805:26
    #31 0x7fdad60b460d in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641:15
    #32 0x7fdad60f3e71 in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425:36
    #33 0x7fdad60d1008 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
    #34 0x7fdad60d1008 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
    #35 0x7fdad60dbe4c in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1152:16
    #36 0x7fdad71c53fa in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #37 0x7fdad70d1461 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #38 0x7fdadd123c37 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #39 0x7fdadd123c37 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #40 0x7fdadd123c37 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #41 0x7fdae1019bef in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
    #42 0x7fdad70d1461 in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #43 0x7fdae10195c4 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #44 0x7fdae10195c4 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #45 0x7fdae10195c4 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #46 0x562491ed642d in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #47 0x562491ed6851 in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #48 0x7fdaf295cb24 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327:18

SUMMARY: AddressSanitizer: heap-buffer-overflow (/tmp/m-c-20210624093849-asan-opt/libxul.so+0xad89918) in __libc_start_main
Shadow bytes around the buggy address:
  0x0c4a800389d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a800389e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a800389f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a80038a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a80038a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f7
=>0x0c4a80038a20: fa[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a50: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c4a80038a70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==322466==ABORTING

```

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1717922#c11)• 4 years ago |
|  | |

Attached file
[asan.bof.txt](attachment.cgi?id=9228874)
— [Details](attachment.cgi?id=9228874&action=edit)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1717922#c12)• 4 years ago |
|  | |

Hi Tyson, based on new comment above it no longer require a11y accessibility. Can this be re-assigned to Layout component? and marked this as regression for [Bug 1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)")?

Flags: needinfo?(twsmith)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1021610_486634)• 4 years ago |

Type: task → defect
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected)Component: Disability Access APIs → Layout: Text and FontsFlags: needinfo?(twsmith) → in-testsuite?Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Eitan Isaacson [:eeejay]](/user_profile?user_id=291675) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1106831_291675)• 4 years ago |

Flags: needinfo?(eitan)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1717922#c13)• 4 years ago |
|  | |

Mats, it sounds like this might be a regression from [bug 1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)"). Could you take a look? Thanks.

Flags: needinfo?(jteh) → needinfo?(mats)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Regressed by: [1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1717922#c14)• 4 years ago |
|  | |

[Tracking Requested - why for this release]: possibly sec-high regression

[tracking-firefox91](/buglist.cgi?f1=cf_tracking_firefox91&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%3F)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1717922#c15)• 4 years ago |
|  | |

Mats is on PTO, I'll try to poke.

Flags: needinfo?(emilio)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1507286_24572)• 4 years ago |

[tracking-firefox91](/buglist.cgi?f1=cf_tracking_firefox91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1717922#c16)• 4 years ago |
|  | |

So the main issue is that we have a `<details>` element with `display: inline list-item`, but we end up constructing a `DetailsFrame`, which is a block and tries to deal with outside list items in a way such as that it assumes it is a block.

Something like this already starts triggering some fishy `NS_ASSERTION`s in inline layout:

```
<details style="display: inline list-item; list-style-position: outside"></details>

```

Which the final crash here is just a consequence of.

The outside list item is supposed to get blockified [here](https://searchfox.org/mozilla-central/rev/3ba42a92cea3e61163091e7fe4d22bcda74a1e5a/servo/components/style/style_adjuster.rs#258-266), but of course `<details>` passes that check through because its computed `display` value is `list-item`.

I can think of two solutions, both of them are breaking changes but I think it should be pretty much fine since we're the only ones implementing `display: inline list-item`:

* Always blockify `list-style-position: outside` markers (regardless of the display value). `list-style-position: outside` is already effectively ignored for `display: inline list-item`, and it should be ok. But perhaps this causes unfortunate IB splits, not sure.
* Force `list-style-position: inside` for `display: inline list-item`. This is kind of unfortunate (in the "we need more style adjustments" sense), but might be an slightly less breaking change.

Maybe we can/should do both of those. I'll check on how many tests rely on the current behavior vs. the proposals above.

Or, perhaps we should unship `display: inline list-item` until this is solved with more working group feedback. Given all the different solutions to this problem we can do, it might be the best course of action... Thoughts Jonathan (given both Mats and Daniel are on PTO)?

Flags: needinfo?(jfkthame)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1717922#c17)• 4 years ago |
|  | |

Or we could just blockify at used-value time instead like we do for `<legend>` I guess. Not a fan of that code but...

Assignee: nobody → emilioFlags: needinfo?(mats)Flags: needinfo?(jfkthame)Flags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1717922#c18)• 4 years ago |
|  | |

Attached file
[Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame](attachment.cgi?id=9230681)
— [Details](attachment.cgi?id=9230681&action=edit)

Trusting the display value in style\_adjuster is wrong, as some elements

force a given kind of frame (like <details>).

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1717922#c19)• 4 years ago |
|  | |

Yeah - it looks like we shipped `inline list-item` way back in Firefox 70, so given how long it's been there, I would be reluctant to (temporarily) unship it while seeking feedback/deciding on a way forward here. So I'd be more inclined to go with your suggestion above, even if it feels a bit ugly. Thanks!

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1717922#c20)• 4 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not super-easy.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: I think all, actually, [bug 1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)") just exposed this in more cases but the same codepath could be hit before using `content`
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: I don't think it'd be hard.
* **How likely is this patch to cause regressions; how much testing does it need?**: not very likely, reuses an existing codepath for `<legend>` in `<fieldset>`, and the bug is triggered when a css value that only Firefox implements is used, so I'd say that it is pretty hard for this to cause regressions in the wild.
[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: sec-approval?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1618328_406194)• 4 years ago |

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected)
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1618344_406194)• 4 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)No longer regressed by: [1542807](/show_bug.cgi?id=1542807 "RESOLVED FIXED - Remove legacy layout code path for ::marker (nsBulletFrame)")

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1717922#c21)• 4 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

Approved to land and uplift when there are patches

[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: sec-approval? → sec-approval+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1823808_1689)• 4 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Summary: AddressSanitizer: heap-buffer-overflow and SEGV in nsLineBox::GetChildCount() → AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1717922#c22)• 4 years ago |
|  | |

Blockify outside markers at used value time rather than at computed value time. r=jfkthame

<https://hg.mozilla.org/integration/autoland/rev/3b45a991147b12d55720854c57da73bd37d9de97>

<https://hg.mozilla.org/mozilla-central/rev/3b45a991147b>

Group: layout-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 4 years ago
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 92 Branch

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a1958906_580382)• 3 years ago |

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix)
[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
--- → [91+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=91%2B)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1717922#c23)• 3 years ago |
|  | |

Attached file
[GetChildCount-0x4141.html](attachment.cgi?id=9231788)
— [Details](attachment.cgi?id=9231788&action=edit)

Hi Dan, I think this one should be sec-high or sec-critical, I found the AV address is controllable through `font-size` value (e.g. AV to `0x41410002b88f` or `0x42420002c3e3`) on Windows 10.

Furthermore on Arch Linux with another testcase (which controlled through `padding-top` value) I also able to hit SEGV on unknown address `0x4141bfff8002` or `0x42425fff8002`.

Flags: needinfo?(dveditz)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1717922#c24)• 3 years ago |
|  | |

Attached file
[asan-0x4141-windows.txt](attachment.cgi?id=9231789)
— [Details](attachment.cgi?id=9231789&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1717922#c25)• 3 years ago |
|  | |

Emilio: on my nightly non-ASAN crash it looks like it's dereferencing an nsIFrame object. Why didn't frame-poisoning save us here?

[bp-76f9de1a-5470-49af-91ea-73e2e0210720](https://crash-stats.mozilla.org/report/index/76f9de1a-5470-49af-91ea-73e2e0210720)

Flags: needinfo?(dveditz) → needinfo?(emilio)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2323818_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1717922#c26)• 3 years ago |
|  | |

We're dereferencing an nsIFrame\* pointer, but not a deleted one or anything. We're running past the end of a linebox iterator. On a debug build this assert fires: <https://searchfox.org/mozilla-central/rev/699174544b058f13f02e7586b3c8fdbf438f084b/layout/generic/nsLineBox.h#760-761>

Flags: needinfo?(emilio)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1717922#c27)• 3 years ago |
|  | |

The patch landed in nightly and beta is affected.

:emilio, is this bug important enough to require an uplift?

If not please set `status_beta` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1717922#c28)• 3 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

### Beta/Release Uplift Approval Request

* **User impact if declined**: Security issue.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: open test-case in [comment 10](/show_bug.cgi?id=1717922#c10 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()")
* **List of other uplifts needed**: none
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Relatively straight-forward patch that prevents the wrong type of frame to be constructed.
* **String changes made/needed**: none
Flags: needinfo?(emilio)
[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: approval-mozilla-beta?

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2387893_546716)• 3 years ago |

Flags: qe-verify+

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1717922#c29)• 3 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

### Beta/Release Uplift Approval Request

* **User impact if declined**: see above
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: see above
* **List of other uplifts needed**: none
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: see above
* **String changes made/needed**: none
[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: approval-mozilla-release?

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1717922#c30)• 3 years ago |
|  | |

Attached patch

[ESR patch](attachment.cgi?id=9232383&action=diff) (obsolete)
— [Details](attachment.cgi?id=9232383&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1717922&attachment=9232383)

It needs some extra code that isn't on ESR but same patch other than that.

[Approval Request Comment]

If this is not a sec:{high,crit} bug, please state case for ESR consideration:

User impact if declined:

Fix Landed on Version:

Risk to taking this patch (and alternatives if risky): Relatively low-risk.

See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.

[Attachment #9232383](/attachment.cgi?id=9232383&action=edit "ESR patch") -
Flags: approval-mozilla-esr78?

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2393548_546716)• 3 years ago |

[Attachment #9232383](/attachment.cgi?id=9232383&action=edit "ESR patch") -
Attachment is patch: true

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1717922#c31)• 3 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

let's skip this for release and let it ship with 91

[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1717922#c32)• 3 years ago |
|  | |

Comment on [attachment 9230681](/attachment.cgi?id=9230681 "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") [[details]](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame")

[Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()") - Blockify outside markers at used value time rather than at computed value time. r=jfkthame

Approved for 91 beta 6, thanks.

[Attachment #9230681](/attachment.cgi?id=9230681&action=edit "Bug 1717922 - Blockify outside markers at used value time rather than at computed value time. r=jfkthame") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1717922#c33)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/50d267e852f6>

[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1717922#c34)• 3 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1717922) to reply.

Flags: needinfo?(emilio)Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][sec-survey]

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2460741_546716)• 3 years ago |

Flags: needinfo?(emilio)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1717922#c35)• 3 years ago |
|  | |

Comment on [attachment 9232383](/attachment.cgi?id=9232383 "ESR patch") [[details]](/attachment.cgi?id=9232383&action=edit "ESR patch") [[diff]](/attachment.cgi?id=9232383&action=diff "ESR patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1717922&attachment=9232383)

ESR patch

approved for 78.13esr

[Attachment #9232383](/attachment.cgi?id=9232383&action=edit "ESR patch") -
Flags: approval-mozilla-esr78? → approval-mozilla-esr78+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1717922#c36)• 3 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr78/rev/9490ae4af3b8>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1717922#c37)• 3 years ago |
|  | |

Backed out for causing wpt failures in marker-computed-size.html:

<https://hg.mozilla.org/releases/mozilla-esr78/rev/cb47d9f70f81d05779825c53f40da20016668dda>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=mozilla-esr78&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunning%2Cpending%2Crunnable&revision=0d35cd18cdd357fb07e511ea5b922d95bdd3f812&selectedTaskRun=ErBKYSL8QI-mqs38wmKplA.0>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=346029548&repo=mozilla-esr78>

Various fails and passes in the test.

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)Flags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1717922#c38)• 3 years ago |
|  | |

Attached patch

[ESR patch w/ fix for comment 37](attachment.cgi?id=9233057&action=diff) (obsolete)
— [Details](attachment.cgi?id=9233057&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1717922&attachment=9233057)

I left the style blockification there because the `nsComputedDOMStyle` code relies on it in ESR.

Flags: needinfo?(emilio) → needinfo?(aryx.bugmail)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2809326_546716)• 3 years ago |

[Attachment #9233057](/attachment.cgi?id=9233057&action=edit "ESR patch w/ fix for comment 37") -
Attachment is patch: true

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1717922#c39)• 3 years ago |
|  | |

Pascal will do the uplift tomorrow.

Flags: needinfo?(aryx.bugmail) → needinfo?(pascalc)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1717922#c40)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr78/rev/4538308a7ec6>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)Flags: needinfo?(pascalc)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1717922#c41)• 3 years ago |
|  | |

Backed out changeset 4538308a7ec6 ([Bug 1717922](/show_bug.cgi?id=1717922 "RESOLVED FIXED - AddressSanitizer: out-of-bounds read and SEGV in nsLineBox::GetChildCount()")) for failures on marker-display-computed.html. a=backout

<https://hg.mozilla.org/releases/mozilla-esr78/rev/73435f09e1d9e00fce7f31a66e060fef4c10ec58>

Flags: needinfo?(emilio)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2905072_24572)• 3 years ago |

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1717922#c42)• 3 years ago |
|  | |

*failure log:* <https://treeherder.mozilla.org/logviewer?job_id=346449585&repo=mozilla-esr78&lineNumber=43250>

```
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO - TEST-PASS | /css/css-pseudo/marker-display-computed.html | Computed 'display' for inside ::marker, variant content
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO - TEST-UNEXPECTED-PASS | /css/css-pseudo/marker-display-computed.html | Computed 'display' for outside ::marker, variant default - expected FAIL
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO - TEST-INFO | expected FAIL
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO -
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO - TEST-UNEXPECTED-PASS | /css/css-pseudo/marker-display-computed.html | Computed 'display' for outside ::marker, variant color - expected FAIL
[task 2021-07-27T11:00:23.091Z] 11:00:23     INFO - TEST-INFO | expected FAIL
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO -
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO - TEST-UNEXPECTED-PASS | /css/css-pseudo/marker-display-computed.html | Computed 'display' for outside ::marker, variant string - expected FAIL
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO - TEST-INFO | expected FAIL
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO -
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO - TEST-UNEXPECTED-PASS | /css/css-pseudo/marker-display-computed.html | Computed 'display' for outside ::marker, variant content - expected FAIL
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO - TEST-INFO | expected FAIL
[task 2021-07-27T11:00:23.092Z] 11:00:23     INFO - TEST-OK | /css/css-pseudo/marker-display-computed.html | took 681ms

```

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1717922#c43)• 3 years ago |
|  | |

Attached file
[ESR patch, take 3 (just the expectation file removed)](attachment.cgi?id=9233276)
— [Details](attachment.cgi?id=9233276&action=edit)

Gah, of course, if I leave the style blockification I don't need to remove add `testing/web-platform/meta/css/css-pseudo/marker-display-computed.html.ini`...

[Attachment #9232383](/attachment.cgi?id=9232383&action=edit "ESR patch") -
Attachment is obsolete: true
[Attachment #9233057](/attachment.cgi?id=9233057&action=edit "ESR patch w/ fix for comment 37") -
Attachment is obsolete: trueFlags: needinfo?(emilio) → needinfo?(pascalc)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1717922#c44)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr78/rev/c3427a79e7df>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)Flags: needinfo?(pascalc)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a2973021_551058)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Daniel Cicas [:dcicas], Release QA](/user_profile?user_id=629433) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1717922#c45)• 3 years ago |
|  | |

Hello!

I can reproduce this issue on 91.0a1 (BuildID: 20210623214552).

I can confirm that this issue is fixed on Fx 91.0b8, Fx 92.0a1 (BuildID: 20210728215815) and Fx 78.13.0 (Treeherder build: <https://treeherder.mozilla.org/jobs?repo=mozilla-esr78&selectedTaskRun=bJNT9PRKQdWCktCY9dGTrg.0> ) on Win 10, Ubuntu 18.04 and mac OS 11.4.

|  | [Daniel Cicas [:dcicas], Release QA](/user_profile?user_id=629433) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a3072972_629433)• 3 years ago |

[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=verified)
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=verified)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=verified)Flags: qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a3779466_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey] → [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main91+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1717922#c47)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235144)
— [Details](attachment.cgi?id=9235144&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a3790207_578488)• 3 years ago |

Alias: CVE-2021-29988

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a3790654_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main91+] → [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main91+][adv-esr78.13+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a37080158_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1717922#a92609042_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1717922&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_6b3ff753_20250114_201448.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-36

## Security Vulnerabilities fixed in Thunderbird 91

Announced
August 11, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Thunderbird incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Thunderbird on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Thunderbird 91](#CVE-2021-29989)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Kershaw Chang, Philipp, Chris Peterson, Sebastian Hengst, Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in versions of Thunderbird prior to 91. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568%2C1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_ffa2d904_20250114_201445.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202202-03**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-91.6.0:esr"

```

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-91.6.0:esr"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-97.0:rapid"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-97.0:rapid"

```
### References

* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29972](https://nvd.nist.gov/vuln/detail/CVE-2021-29972)
* [CVE-2021-29974](https://nvd.nist.gov/vuln/detail/CVE-2021-29974)
* [CVE-2021-29975](https://nvd.nist.gov/vuln/detail/CVE-2021-29975)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29977](https://nvd.nist.gov/vuln/detail/CVE-2021-29977)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29981](https://nvd.nist.gov/vuln/detail/CVE-2021-29981)
* [CVE-2021-29982](https://nvd.nist.gov/vuln/detail/CVE-2021-29982)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29987](https://nvd.nist.gov/vuln/detail/CVE-2021-29987)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-29990](https://nvd.nist.gov/vuln/detail/CVE-2021-29990)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38491](https://nvd.nist.gov/vuln/detail/CVE-2021-38491)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43540](https://nvd.nist.gov/vuln/detail/CVE-2021-43540)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0511](https://nvd.nist.gov/vuln/detail/CVE-2022-0511)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22753](https://nvd.nist.gov/vuln/detail/CVE-2022-22753)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22755](https://nvd.nist.gov/vuln/detail/CVE-2022-22755)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22757](https://nvd.nist.gov/vuln/detail/CVE-2022-22757)
* [CVE-2022-22758](https://nvd.nist.gov/vuln/detail/CVE-2022-22758)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22762](https://nvd.nist.gov/vuln/detail/CVE-2022-22762)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* MOZ-2021-0004
* MOZ-2021-0005
* MOZ-2021-0006
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

February 21, 2022

**Latest revision**

February 21, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [802768](https://bugs.gentoo.org/show_bug.cgi?id=802768)
* [807947](https://bugs.gentoo.org/show_bug.cgi?id=807947)
* [813498](https://bugs.gentoo.org/show_bug.cgi?id=813498)
* [821385](https://bugs.gentoo.org/show_bug.cgi?id=821385)
* [828538](https://bugs.gentoo.org/show_bug.cgi?id=828538)
* [831039](https://bugs.gentoo.org/show_bug.cgi?id=831039)
* [832992](https://bugs.gentoo.org/show_bug.cgi?id=832992)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_c3cab586_20250114_201446.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-33

## Security Vulnerabilities fixed in Firefox 91

Announced
August 10, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 91

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29983: Firefox for Android could get stuck in fullscreen mode](#CVE-2021-29983)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox for Android could get stuck in fullscreen mode and not exit it even after normal interactions that should cause it to exit.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1719088](https://bugzilla.mozilla.org/show_bug.cgi?id=1719088)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Firefox on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

#### [#CVE-2021-29990: Memory safety bugs fixed in Firefox 91](#CVE-2021-29990)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Kershaw Chang, Philipp, Chris Peterson, and Sebastian Hengst reported memory safety bugs present in Firefox 90. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_067c0658_20250114_201445.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Thunderbird: Multiple Vulnerabilities — GLSA **202208-14**

Multiple vulnerabilities have been found in Mozilla Thunderbird, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **91.12.0** |
| Unaffected versions | >= **91.12.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **91.12.0** |
| Unaffected versions | >= **91.12.0** |

### Background

Mozilla Thunderbird is a popular open-source email client from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Thunderbird. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-91.12.0"

```

All Mozilla Thunderbird binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-bin-91.12.0"

```
### References

* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-29967](https://nvd.nist.gov/vuln/detail/CVE-2021-29967)
* [CVE-2021-29969](https://nvd.nist.gov/vuln/detail/CVE-2021-29969)
* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38492](https://nvd.nist.gov/vuln/detail/CVE-2021-38492)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-40529](https://nvd.nist.gov/vuln/detail/CVE-2021-40529)
* [CVE-2021-43528](https://nvd.nist.gov/vuln/detail/CVE-2021-43528)
* [CVE-2021-43529](https://nvd.nist.gov/vuln/detail/CVE-2021-43529)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0566](https://nvd.nist.gov/vuln/detail/CVE-2022-0566)
* [CVE-2022-1196](https://nvd.nist.gov/vuln/detail/CVE-2022-1196)
* [CVE-2022-1197](https://nvd.nist.gov/vuln/detail/CVE-2022-1197)
* [CVE-2022-1520](https://nvd.nist.gov/vuln/detail/CVE-2022-1520)
* [CVE-2022-1529](https://nvd.nist.gov/vuln/detail/CVE-2022-1529)
* [CVE-2022-1802](https://nvd.nist.gov/vuln/detail/CVE-2022-1802)
* [CVE-2022-1834](https://nvd.nist.gov/vuln/detail/CVE-2022-1834)
* [CVE-2022-2200](https://nvd.nist.gov/vuln/detail/CVE-2022-2200)
* [CVE-2022-2226](https://nvd.nist.gov/vuln/detail/CVE-2022-2226)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* [CVE-2022-24713](https://nvd.nist.gov/vuln/detail/CVE-2022-24713)
* [CVE-2022-26381](https://nvd.nist.gov/vuln/detail/CVE-2022-26381)
* [CVE-2022-26383](https://nvd.nist.gov/vuln/detail/CVE-2022-26383)
* [CVE-2022-26384](https://nvd.nist.gov/vuln/detail/CVE-2022-26384)
* [CVE-2022-26386](https://nvd.nist.gov/vuln/detail/CVE-2022-26386)
* [CVE-2022-26387](https://nvd.nist.gov/vuln/detail/CVE-2022-26387)
* [CVE-2022-26485](https://nvd.nist.gov/vuln/detail/CVE-2022-26485)
* [CVE-2022-26486](https://nvd.nist.gov/vuln/detail/CVE-2022-26486)
* [CVE-2022-28281](https://nvd.nist.gov/vuln/detail/CVE-2022-28281)
* [CVE-2022-28282](https://nvd.nist.gov/vuln/detail/CVE-2022-28282)
* [CVE-2022-28285](https://nvd.nist.gov/vuln/detail/CVE-2022-28285)
* [CVE-2022-28286](https://nvd.nist.gov/vuln/detail/CVE-2022-28286)
* [CVE-2022-28289](https://nvd.nist.gov/vuln/detail/CVE-2022-28289)
* [CVE-2022-29909](https://nvd.nist.gov/vuln/detail/CVE-2022-29909)
* [CVE-2022-29911](https://nvd.nist.gov/vuln/detail/CVE-2022-29911)
* [CVE-2022-29912](https://nvd.nist.gov/vuln/detail/CVE-2022-29912)
* [CVE-2022-29913](https://nvd.nist.gov/vuln/detail/CVE-2022-29913)
* [CVE-2022-29914](https://nvd.nist.gov/vuln/detail/CVE-2022-29914)
* [CVE-2022-29916](https://nvd.nist.gov/vuln/detail/CVE-2022-29916)
* [CVE-2022-29917](https://nvd.nist.gov/vuln/detail/CVE-2022-29917)
* [CVE-2022-31736](https://nvd.nist.gov/vuln/detail/CVE-2022-31736)
* [CVE-2022-31737](https://nvd.nist.gov/vuln/detail/CVE-2022-31737)
* [CVE-2022-31738](https://nvd.nist.gov/vuln/detail/CVE-2022-31738)
* [CVE-2022-31740](https://nvd.nist.gov/vuln/detail/CVE-2022-31740)
* [CVE-2022-31741](https://nvd.nist.gov/vuln/detail/CVE-2022-31741)
* [CVE-2022-31742](https://nvd.nist.gov/vuln/detail/CVE-2022-31742)
* [CVE-2022-31747](https://nvd.nist.gov/vuln/detail/CVE-2022-31747)
* [CVE-2022-34468](https://nvd.nist.gov/vuln/detail/CVE-2022-34468)
* [CVE-2022-34470](https://nvd.nist.gov/vuln/detail/CVE-2022-34470)
* [CVE-2022-34472](https://nvd.nist.gov/vuln/detail/CVE-2022-34472)
* [CVE-2022-34478](https://nvd.nist.gov/vuln/detail/CVE-2022-34478)
* [CVE-2022-34479](https://nvd.nist.gov/vuln/detail/CVE-2022-34479)
* [CVE-2022-34481](https://nvd.nist.gov/vuln/detail/CVE-2022-34481)
* [CVE-2022-34484](https://nvd.nist.gov/vuln/detail/CVE-2022-34484)
* [CVE-2022-36318](https://nvd.nist.gov/vuln/detail/CVE-2022-36318)
* [CVE-2022-36319](https://nvd.nist.gov/vuln/detail/CVE-2022-36319)
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

August 10, 2022

**Latest revision**

August 10, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [794085](https://bugs.gentoo.org/show_bug.cgi?id=794085)
* [802759](https://bugs.gentoo.org/show_bug.cgi?id=802759)
* [807943](https://bugs.gentoo.org/show_bug.cgi?id=807943)
* [811912](https://bugs.gentoo.org/show_bug.cgi?id=811912)
* [813501](https://bugs.gentoo.org/show_bug.cgi?id=813501)
* [822294](https://bugs.gentoo.org/show_bug.cgi?id=822294)
* [828539](https://bugs.gentoo.org/show_bug.cgi?id=828539)
* [831040](https://bugs.gentoo.org/show_bug.cgi?id=831040)
* [833520](https://bugs.gentoo.org/show_bug.cgi?id=833520)
* [834805](https://bugs.gentoo.org/show_bug.cgi?id=834805)
* [845057](https://bugs.gentoo.org/show_bug.cgi?id=845057)
* [846596](https://bugs.gentoo.org/show_bug.cgi?id=846596)
* [849047](https://bugs.gentoo.org/show_bug.cgi?id=849047)
* [857048](https://bugs.gentoo.org/show_bug.cgi?id=857048)
* [864577](https://bugs.gentoo.org/show_bug.cgi?id=864577)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


