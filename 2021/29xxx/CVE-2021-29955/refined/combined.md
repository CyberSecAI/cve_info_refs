=== Content from www.mozilla.org_3674978e_20250114_230608.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-11

## Security Vulnerabilities fixed in Firefox ESR 78.9

Announced
March 23, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 78.9

**Note**: This advisory was updated June 8, 2021 to include CVE-2021-29955 which was also fixed in this release.

#### [#CVE-2021-29955: Transient Execution Vulnerability allowed leaking arbitrary memory address](#CVE-2021-29955)

Reporter
Hany Ragab, Enrico Barberis, Herbert Bos, and Cristiano Giuffrida from the VUSec group at VU Amsterdam
Impact
high
##### Description

A transient execution vulnerability, named Floating Point Value Injection (FPVI) allowed an attacker to leak arbitrary memory addresses and may have also enabled JIT type confusion attacks. (A related vulnerability, Speculative Code Store Bypass (SCSB), did not affect Firefox.)

##### References

* [Bug 1692972](https://bugzilla.mozilla.org/show_bug.cgi?id=1692972)

#### [#CVE-2021-23981: Texture upload into an unbound backing buffer resulted in an out-of-bound read](#CVE-2021-23981)

Reporter
Abraruddin Khan and Omair
Impact
high
##### Description

A texture upload of a Pixel Buffer Object could have confused the WebGL code to skip binding the buffer used to unpack it, resulting in memory corruption and a potentially exploitable information leak or crash.

##### References

* [Bug 1692832](https://bugzilla.mozilla.org/show_bug.cgi?id=1692832)

#### [#CVE-2021-4127: Angle graphics library out of date](#CVE-2021-4127)

Reporter
Mozilla Developers, Abraruddin Khan and Omair
Impact
high
##### Description

An out of date graphics library (Angle) likely contained vulnerabilities that could potentially be exploited.

##### References

* [Bug 1691547](https://bugzilla.mozilla.org/show_bug.cgi?id=1691547)

#### [#CVE-2021-23982: Internal network hosts could have been probed by a malicious webpage](#CVE-2021-23982)

Reporter
Samy Kamkar, Ben Seri, and Gregory Vishnepolsky
Impact
moderate
##### Description

Using techniques that built on the slipstream research, a malicious webpage could have scanned both an internal network's hosts as well as services running on the user's local machine utilizing WebRTC connections.

##### References

* [Bug 1677046](https://bugzilla.mozilla.org/show_bug.cgi?id=1677046)

#### [#CVE-2021-23984: Malicious extensions could have spoofed popup information](#CVE-2021-23984)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious extension could have opened a popup window lacking an address bar. The title of the popup lacking an address bar should not be fully controllable, but in this situation was. This could have been used to spoof a website and attempt to trick the user into providing credentials.

##### References

* [Bug 1693664](https://bugzilla.mozilla.org/show_bug.cgi?id=1693664)

#### [#CVE-2021-23987: Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](#CVE-2021-23987)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Alexis Beingessner, Tyson Smith, Julien Wajsberg, and Matthew Gregan reported memory safety bugs present in Firefox 86 and Firefox ESR 78.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1513519%2C1683439%2C1690169%2C1690718)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_3b796b51_20250114_230607.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-10

## Security Vulnerabilities fixed in Firefox 87

Announced
March 23, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 87

**Note**: This advisory was updated May 3, 2021 to include CVE-2021-29951 and again on June 8, 2021 to include CVE-2021-29955 - both were also fixed in this release.

#### [#CVE-2021-29955: Transient Execution Vulnerability allowed leaking arbitrary memory address](#CVE-2021-29955)

Reporter
Hany Ragab, Enrico Barberis, Herbert Bos, and Cristiano Giuffrida from the VUSec group at VU Amsterdam
Impact
high
##### Description

A transient execution vulnerability, named Floating Point Value Injection (FPVI) allowed an attacker to leak arbitrary memory addresses and may have also enabled JIT type confusion attacks. (A related vulnerability, Speculative Code Store Bypass (SCSB), did not affect Firefox.)

##### References

* [Bug 1692972](https://bugzilla.mozilla.org/show_bug.cgi?id=1692972)

#### [#CVE-2021-23981: Texture upload into an unbound backing buffer resulted in an out-of-bound read](#CVE-2021-23981)

Reporter
Abraruddin Khan and Omair
Impact
high
##### Description

A texture upload of a Pixel Buffer Object could have confused the WebGL code to skip binding the buffer used to unpack it, resulting in memory corruption and a potentially exploitable information leak or crash.

##### References

* [Bug 1692832](https://bugzilla.mozilla.org/show_bug.cgi?id=1692832)

#### [#CVE-2021-29951: Mozilla Maintenance Service could have been started or stopped by domain users](#CVE-2021-29951)

Reporter
James Forshaw
Impact
moderate
##### Description

The Mozilla Maintenance Service granted SERVICE\_START access to `BUILTIN|Users` which, in a domain network, grants normal remote users access to start or stop the service. This could be used to prevent the browser update service from operating (if an attacker spammed the 'Stop' command); but also exposed attack surface in the maintenance service.
*Note: This issue only affected Windows operating systems older than Win 10 build 1709. Other operating systems are unaffected.*

##### References

* [Bug 1690062](https://bugzilla.mozilla.org/show_bug.cgi?id=1690062)

#### [#CVE-2021-23982: Internal network hosts could have been probed by a malicious webpage](#CVE-2021-23982)

Reporter
Samy Kamkar, Ben Seri, and Gregory Vishnepolsky
Impact
moderate
##### Description

Using techniques that built on the slipstream research, a malicious webpage could have scanned both an internal network's hosts as well as services running on the user's local machine utilizing WebRTC connections.

##### References

* [Bug 1677046](https://bugzilla.mozilla.org/show_bug.cgi?id=1677046)

#### [#CVE-2021-23983: Transitions for invalid ::marker properties resulted in memory corruption](#CVE-2021-23983)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

By causing a transition on a parent node by removing a CSS rule, an invalid property for a marker could have been applied, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1692684](https://bugzilla.mozilla.org/show_bug.cgi?id=1692684)

#### [#CVE-2021-23984: Malicious extensions could have spoofed popup information](#CVE-2021-23984)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious extension could have opened a popup window lacking an address bar. The title of the popup lacking an address bar should not be fully controllable, but in this situation was. This could have been used to spoof a website and attempt to trick the user into providing credentials.

##### References

* [Bug 1693664](https://bugzilla.mozilla.org/show_bug.cgi?id=1693664)

#### [#CVE-2021-23985: Devtools remote debugging feature could have been enabled without indication to the user](#CVE-2021-23985)

Reporter
Anonymous working with Trend Micro's Zero Day Initiative
Impact
low
##### Description

If an attacker is able to alter specific about:config values (for example malware running on the user's computer), the Devtools remote debugging feature could have been enabled in a way that was unnoticable to the user. This would have allowed a remote attacker (able to make a direct network connection to the victim) to monitor the user's browsing activity and (plaintext) network traffic. This was addressed by providing a visual cue when Devtools has an open network socket.

##### References

* [Bug 1659129](https://bugzilla.mozilla.org/show_bug.cgi?id=1659129)

#### [#CVE-2021-23986: A malicious extension could have performed credential-less same origin policy violations](#CVE-2021-23986)

Reporter
Armin Ebert
Impact
low
##### Description

A malicious extension with the 'search' permission could have installed a new search engine whose favicon referenced a cross-origin URL. The response to this cross-origin request could have been read by the extension, allowing a same-origin policy bypass by the extension, which should not have cross-origin permissions. This cross-origin request was made without cookies, so the sensitive information disclosed by the violation was limited to local-network resources or resources that perform IP-based authentication.

##### References

* [Bug 1692623](https://bugzilla.mozilla.org/show_bug.cgi?id=1692623)

#### [#CVE-2021-23987: Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](#CVE-2021-23987)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Matthew Gregan, Tyson Smith, Julien Wajsberg, and Alexis Beingessner reported memory safety bugs present in Firefox 86 and Firefox ESR 78.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1513519%2C1683439%2C1690169%2C1690718)

#### [#CVE-2021-23988: Memory safety bugs fixed in Firefox 87](#CVE-2021-23988)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Tyson Smith and Christian Holler reported memory safety bugs present in Firefox 86. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 87](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1684994%2C1686653)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_e11b23ba_20250114_230606.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1692972)
* [XML](/show_bug.cgi?ctype=xml&id=1692972)

Closed
[Bug 1692972](/show_bug.cgi?id=1692972)
(CVE-2021-29955)

Opened 4 years ago
Closed 4 years ago

# FPVI & SCSB Disclosure (Feb 12, ‘21)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

FPVI & SCSB Disclosure (Feb 12, ‘21)

## Categories

### (Core :: JavaScript Engine: JIT, task)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

task

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

88 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | [87+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=87%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) |
| firefox86 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix) |
| firefox87 | [+](/buglist.cgi?f1=cf_tracking_firefox87&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed) |
| firefox88 | [+](/buglist.cgi?f1=cf_tracking_firefox88&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 | 87+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox86 |  | wontfix |
| firefox87 | + | fixed |
| firefox88 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: freddy, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=40)  [freddy](/user_profile?user_id=428608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-priv-escalation, reporter-external, sec-high, Whiteboard: [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-][adv-esr78.9-][sec-survey])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29955

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-][adv-esr78.9-][sec-survey]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2459663_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | [qe-verify](#a2082152_458186 "4 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files)

| [fpvi-scsb-mozilla-disclosure-02-12-2021.zip](/attachment.cgi?id=9203448)  [4 years ago](#c1)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   1.42 MB, application/zip |  | [Details](/attachment.cgi?id=9203448&action=edit) |
| --- | --- | --- |
| [FPVI & SCSB Disclosure.pdf](/attachment.cgi?id=9203449)  [4 years ago](#c2)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   508.97 KB, application/pdf |  | [Details](/attachment.cgi?id=9203449&action=edit) |
| [machine\_clear.pdf](/attachment.cgi?id=9203450)  [4 years ago](#c3)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   1.03 MB, application/pdf |  | [Details](/attachment.cgi?id=9203450&action=edit) |
| [fpvi-scsb-mozilla-disclosure-02-23-2021.zip](/attachment.cgi?id=9204835)  [4 years ago](#c21)  [Enrico Barberis](/user_profile?user_id=680017)   1.43 MB, application/octet-stream |  | [Details](/attachment.cgi?id=9204835&action=edit) |
| [Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!](/attachment.cgi?id=9206591)  [4 years ago](#c23)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   48 bytes, text/x-phabricator-request | jcristau : [approval-mozilla-beta+](#c32 "4 years ago")  RyanVM : [approval-mozilla-esr78+](#c34 "4 years ago")  tjr : [sec-approval+](#c28 "4 years ago") | [Details](/attachment.cgi?id=9206591&action=edit) | [Review](/attachment.cgi?id=9206591) |
| [Patch for ESR78](/attachment.cgi?id=9208634)  [4 years ago](#c37)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   7.45 KB, patch |  | [Details](/attachment.cgi?id=9208634&action=edit) | [Diff](/attachment.cgi?id=9208634&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1692972&attachment=9208634) |
| [advisory.txt](/attachment.cgi?id=9225814)  [4 years ago](#c45)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   419 bytes, text/plain |  | [Details](/attachment.cgi?id=9225814&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1692972#c0)• 4 years ago |
|  | |

I am filing this on behalf of Hany Ragab, Enrico Barberis, Herbert Bos, and Cristiano Giuffrida from the VUSec group at VU Amsterdam, who sent an email to security@mozilla.org:

Hi,

This is to inform you we at VUSec just disclosed two new transient execution vulnerabilities to Intel and AMD. We term such vulnerabilities Floating Point Value Injection (or FPVI) and Speculative Code Store Bypass (or SCSB)---due to the similarities with LVI and Spectre-SSB. We don’t yet know if these have already been disclosed by others, but we wanted to give you all the information as early as possible (due to a long history of communication issues with Intel). We’re currently aiming for a 90-day embargo period.

PFA the same archive disclosed to Intel & AMD, containing: (i) the paper documenting the vulnerabilities and our analysis just submitted to USENIX Security (Winter); (ii) a disclosure overview document briefly introducing FPVI & SCSB, our proposed mitigations, and Proof-of-Concept exploits (PoCs); (iii) two PoCs inspired by real-world applications (browsers) to reproduce FPVI & SCSB.

Note that while our exploits use SpiderMonkey as a point of reference, they’re both native PoCs that cannot directly run in a SpiderMonkey sandbox. We believe producing end-to-end exploits in JavaScript just requires additional engineering effort especially for FPVI, since we have verified the JIT engine is affected. We’re working on end-to-end exploits in ongoing work and we’ll update you as soon as we have results. Luckily, the mitigations are relatively simple. Both issues can be mitigated with Fission. Without Fission, SCSB’s mitigation is straightforward (i.e., use a serializing instruction like lfence on x86 in FlushICache), while FPVI imposes some performance/precision tradeoffs (see disclosure overview and paper for details). We’re concurrently disclosing these issues to Chromium. We’d like to know if you are able to inform other browser vendors besides Chromium.

Please let us know if you have questions/comments, we’re happy to discuss these issues in more detail. Please CC mc@vusec.net in all future communication on this issue. This is to reach the “MC team” disclosing the vulnerabilities, that is “Hany Ragab, Enrico Barberis, Herbert Bos, and Cristiano Giuffrida from the VUSec group at VU Amsterdam”.

Please let us also know if you’d also like this report filed on Bugzilla, as suggested at <https://www.mozilla.org/en-US/about/governance/policies/security-group/bugs>.

Best,

Cristiano (on behalf of the MC @VUSec team)

PS.: mc@vusec.net is simply an alias for hany.ragab@vu.nl, e.barberis@vu.nl,

herbertb@cs.vu.nl, giuffrida@cs.vu.nl, you can find the corresponding PGP keys here:

<https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x409784444f2ac8f2643eb39d0515f11a30c299fa> (Hany)

<https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x4f6517e19584e1c454d4c36ee2ef4734fc503bda> (Enrico)

<https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xb9d27a126befc1ba3cdd6866f3e2f9f5fa47c706> (Herbert)

<https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x038bd8776dd243469da4df1c7a0c07dcc87edb69> (Cristiano)

Flags: sec-bounty?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1692972#c1)• 4 years ago |
|  | |

Attached file
[fpvi-scsb-mozilla-disclosure-02-12-2021.zip](attachment.cgi?id=9203448)
— [Details](attachment.cgi?id=9203448&action=edit)

Attached is the decrypted zip

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1692972#c2)• 4 years ago |
|  | |

Attached file
[FPVI & SCSB Disclosure.pdf](attachment.cgi?id=9203449)
— [Details](attachment.cgi?id=9203449&action=edit)

For convenience here is pdf 1 from the zip

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1692972#c3)• 4 years ago |
|  | |

Attached file
[machine\_clear.pdf](attachment.cgi?id=9203450)
— [Details](attachment.cgi?id=9203450&action=edit)

For convenience here is pdf 2 from the zip

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a26469_578488)• 4 years ago |

[Attachment #9203450](/attachment.cgi?id=9203450&action=edit "machine_clear.pdf") -
Attachment description: For convenience here is pdf 1 from the zip → machine\_clear.pdf

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1692972#c4)• 4 years ago |
|  | |

Hi jandem, could you take a look at these?

My intuition is that SCSB would be a simple mitigation that wouldn't be a big performance impact.

I'm curious how practical we think FPVI is to exploit in practice in the browser; if it requires a Flush+Reload timing attack for each... byte? of the target value, with our timer mitigations this seems like a very slow channel. The mitigation sounds like it would have some measurable performance impact.

Curious to know your thoughts.

Group: firefox-core-security → core-securityComponent: Security → JavaScript Engine: JITFlags: needinfo?(jdemooij)Product: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a29446_1689)• 4 years ago |

Group: core-security → javascript-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a29605_1689)• 4 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?]

|  | [Cristiano Giuffrida](/user_profile?user_id=680016) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1692972#c5)• 4 years ago |
|  | |

Hi Tom,

thanks for opening the issue on our behalf. Quick comments from our end:

## SCSB

I'd be surprised if the SCSB mitigation wasn't indeed trivial (code- and performance-wise) given that pretty much the same (serializing) code is already needed for non-x86 architectures for instruction cache flushing.

## FPVI

Indeed one needs to implement a Flush+Reload-style covert channel (Evict+Reload) or similar in the browser to leak information. One problem with relying on timer mitigations to break practical exploitation of such channel is that one can bypass them by simply repeating the leak (i.e., with multiple Reload buffers) and amplify the signal. We used a similar technique in the ret2ret2spec (Spectre-RSB) exploit we disclosed in a separate issue (<https://bugzilla.mozilla.org/show_bug.cgi?id=1644174>). Of course, this will still slow down exploitation by a factor of N (where N is the number of Reload buffers needed to get a signal with the jittery timer), but it's not quite clear where the bar is in terms of leakage rate for practical exploitation.

Also compared to Spectre exploitation based on RSB or BHT mistraining in the browser, FPVI's leakage rate is higher. Since there is no predictor involved, one can repeat one leakage iteration after another without any intermediate steps to (re)train the branch predictor a la Spectre-RSB/BHT. This significantly improves the leakage rate and might be able to compensate for the extra iterations needed to amplify the signal and bypass the timer mitigations. See, for instance, Figure 5 in the paper, where the experiments from Hany & Enrico show the (native) leakage rate of FPVI is almost as fast as the raw Flush+Reload covert channel bandwidth, an improvement of over 5x wrt to classic Spectre-BHT.

Cristiano

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1692972#c6)• 4 years ago |
|  | |

Thanks for the great bug report.

Still reading through this, but for SCSB I wonder if this is actually a problem in SpiderMonkey because all of our JIT/Wasm code is W^X, which means we do a relatively expensive `mprotect` between writing the code and making it executable. I'd be a bit surprised if this doesn't end up doing a similar cache flush? The PoC uses RWX, it would be interesting to see if it can be made to trigger with similar `mprotects` around the `memcpy`.

|  | [Cristiano Giuffrida](/user_profile?user_id=680016) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1692972#c7)• 4 years ago |
|  | |

@Jan

Thanks for the comment!

Re mprotect & SCSB: there are multiple aspects at play here:

* Having a complex syscall between the "W" and the "X" indeed requires a fairly large transient execution window for exploitation, which might be hard to come by and ultimately stop practical exploits. However, I would worry this "mitigation" is fragile and it'd be better to opt for "security-by-design" mitigations (e.g., Hany & Enrico found surprisingly large windows on some AMD architectures).
* In theory, syscalls like mprotect() should flush the instruction cache, since the OS faces the same W+X issues as a JIT engine. However, just like common JIT engines, common operating system implementations do not do any flushing on x86 since it's (architecturally) unnecessary. See the implementation of flush\_icache\_page() in the Linux kernel as an example (no-op on x86).
* The remaining way syscalls like mprotect() can kill the signal is to use a serializing instruction somewhere. In the case of mprotect(), the mandatory "invlpg" instruction does the trick (as Hany & Enrico confirmed experimentally---this behavior is also explicitly documented in Intel/AMD manuals). But the same might not apply to other syscalls (the "syscall" instruction itself is not documented to be a serializing one, at least).

In short, to implement a future-proof mitigation strategy, IMO a good option is to simply place a cheap lfence instruction (or similar) in the FlushICache() function. Or alternatively, if all the code paths will always go through a mprotect() syscall by design, explicitly document that such paths rely on the mprotect() code itself (e.g., invlpg) to serialize the execution and kill the signal.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1692972#c8)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1692972&comment_id=15269650 "1 revision") |
|  | |

(In reply to Cristiano Giuffrida from [comment #7](/show_bug.cgi?id=1692972#c7 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> The remaining way syscalls like mprotect() can kill the signal is to use a serializing instruction somewhere. In the case of mprotect(), the mandatory "invlpg" instruction does the trick (as Hany & Enrico confirmed experimentally---this behavior is also explicitly documented in Intel/AMD manuals).

Thanks, that's good to know because this applies to us.

> In short, to implement a future-proof mitigation strategy, IMO a good option is to simply place a cheap lfence instruction (or similar) in the FlushICache() function. Or alternatively, if all the code paths will always go through a mprotect() syscall by design, explicitly document that such paths rely on the mprotect() code itself (e.g., invlpg) to serialize the execution and kill the signal.

We have just [one caller](https://searchfox.org/mozilla-central/rev/0379f315c75a2875d716b4f5e1a18bf27188f1e6/js/src/jit/ProcessExecutableMemory.cpp#745) of `FlushICache`, right before we do the `VirtualProtect/mprotect`. This was by design: if we flush when we make code executable, we can never forget or miss an ICache flush.

Furthermore, looking at `ReprotectRegion`, we already [do this](https://searchfox.org/mozilla-central/rev/0379f315c75a2875d716b4f5e1a18bf27188f1e6/js/src/jit/ProcessExecutableMemory.cpp#775) right before the `mprotect`:

```
  std::atomic_thread_fence(std::memory_order_seq_cst);

```

I verified this ends up compiling to an `mfence` on x64. So I think we're good here for two separate reasons.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1692972#c9)• 4 years ago |
|  | |

For FPVI, when looking at the jit.txt output in the attached zip file, you can see that we generate the following shape guard for the `return z[0]` in the JS code:

```
0000019A  33 d2                     xor %edx, %edx
0000019C  49 bb a8 b8 f9 3d bc 3f 00 00
                                    mov $0x3FBC3DF9B8A8, %r11
000001A6  4c 39 59 08               cmpq %r11, 0x08(%rcx)
000001AA  0f 85 c6 02 00 00         jnz 0x0000000000000476
000001B0  48 0f 45 ca               cmovnz %rdx, %rcx
000001B4  48 ba 40 d0 f7 3d bc 3f 00 00
... perform the element load ...

```

The `xor` and `cmovnz` here are Spectre mitigations: we zero the object register with a `cmov` if the object's shape doesn't match what we expect. Isn't this `cmovnz` going to thwart the transient execution path here as well? (Unless you manage to get a memory address that has the same shape value stored at offset 8 on the transient path.)

Flags: needinfo?(giuffrida)

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1692972#c10)• 4 years ago |
|  | |

Dear jandem,

the `000001B0 48 0f 45 ca cmovnz %rdx, %rcx` is never executed during the transient path.

This is what is executed during the transient execution window generated by the FP division:

```
0000005F  f2 0f 5e ca               divsd %xmm2, %xmm1
00000063  f2 0f 5e c1               divsd %xmm1, %xmm0
00000067  66 48 0f 7e c0            movq %xmm0, %rax   //rax = 0xfffe0deadbeef000 for transient path only (-Infinity for arch path)
0000006C  e9 05 00 00 00            jmp 0x0000000000000076
...
00000076  48 8b c8                  mov %rax, %rcx
00000079  48 c1 e9 2f               shr $0x2F, %rcx
0000007D  81 f9 fc ff 01 00         cmp $0x1FFFC, %ecx
00000083  0f 84 f7 01 00 00         jz 0x0000000000000280   //branch taken: 0xfffe0deadbeef000>>0x2f==0x1fffc
...
00000280  48 ba 00 00 00 00 00 00 fe ff
                                    mov $0xFFFE000000000000, %rdx
0000028A  48 33 d0                  xor %rax, %rdx  //rdx = 0xdeadbeef000
0000028D  48 8b 0a                  movq (%rdx), %rcx
00000290  48 8b 09                  movq (%rcx), %rcx

```

(The code above is exactly what you can find in fpvi.S)

As you can see no `cmov` is present in this path.

Additionally, `cmov` stops the speculation only for the corresponding branch, not the entire FP transient window.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1692972#c11)• 4 years ago |
|  | |

(In reply to Enrico Barberis from [comment #10](/show_bug.cgi?id=1692972#c10 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> (The code above is exactly what you can find in fpvi.S)
>
> As you can see no `cmov` is present in this path.

If I understand correctly, `fpvi.S` is *based on* code generated by SpiderMonkey, especially the first part, but the `transient_path:` part is not what SpiderMonkey generates because the JIT would emit extra (shape or similar) guards before loading from the object, as you can see in jit.txt. Is that right?

I'm just making sure I understand what is required to exploit this in our engine.

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1692972#c12)• 4 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #11](/show_bug.cgi?id=1692972#c11 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> (In reply to Enrico Barberis from [comment #10](/show_bug.cgi?id=1692972#c10 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))
>
> > (The code above is exactly what you can find in fpvi.S)
> >
> > As you can see no `cmov` is present in this path.
>
> If I understand correctly, `fpvi.S` is *based on* code generated by SpiderMonkey, especially the first part, but the `transient_path:` part is not what SpiderMonkey generates because the JIT would emit extra (shape or similar) guards before loading from the object, as you can see in jit.txt. Is that right?
>
> I'm just making sure I understand what is required to exploit this in our engine.

`fpvi.S` contains only code generated by Spidermonkey. We have just removed the non-executed code for readability.

The code trace that I listed above was verified using gdb by setting a breakpoint to js-shell on `00000067 66 48 0f 7e c0 movq %xmm0, %rax` and then by replacing `rax` with `0xfffe0deadbeef000` using `set $rax = 0xfffe0deadbeef000`. In this way, we were able to simulate what happens in the transient path.

Unfortunately, our knowledge of Spidermonkey's inner details is very limited. I believe that the transient read `0000028D 48 8b 0a movq (%rdx), %rcx` is made without any shape-guard since the engine is still verifying that `0xdeadbeef000` is an array.

In order for the attack to be successful, the following requirements are needed:

1. the `divsd` operands are under attacker controls
2. shortly after the `divsd`, a tag check is made. This is necessary to perform type-confusion. In the provided PoC, the engine considers `0xfffe0deadbeef000` as JSObject.
3. The type-confusion leads to a Flush+Reload gadget `read reload_buf[ (*((uint32_t *)0xfffe0deadbeef000) & 0xff) << 10 ]`.

Another example that can show how a (partial) desired gadget looks like is:

```
//always pass s as string to speculative optimize for string arguments
function length(s) {
    return (s.length & 0xff)*1024
}

```

That is jit'ed as follow:

```
00000005  48 8b 44 24 28            movq 0x28(%rsp), %rax  //rax = 0xfffb0deadbeef000 speculatively
0000000A  49 bb 00 00 00 00 00 00 fb ff
                                    mov $0xFFFB000000000000, %r11
00000014  4c 33 d8                  xor %rax, %r11
00000017  49 8b c3                  mov %r11, %rax
0000001A  49 c1 eb 2f               shr $0x2F, %r11
0000001E  0f 85 32 00 00 00         jnz 0x0000000000000056
00000024  8b 40 04                  movl 0x04(%rax), %eax  //Access length attribute
00000027  25 ff 00 00 00            and $0xFF, %eax
0000002C  c1 e0 0a                  shl $0x0A, %eax
0000002F  48 b9 00 00 00 00 00 80 f8 ff
                                    mov $0xFFF8800000000000, %rcx
00000039  48 0b c8                  or %rax, %rcx
0000003C  c3                        ret

```

By calling `length()` with the transient division result `0xfffb0deadbeef000`, it is possible to perform a transient read to `deadbeef004` .

The `(... & 0xff)*1024` is just there to provide a first step towards the full desired gadget `reload_buf[(s.length&0xff)<<10]`.

Currently, we are trying to build a new PoC using this string length "trick", however, we are having some troubles in making the division and the tag check close enough.

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1692972#c13)• 4 years ago |
|  | |

One additional comment: I guess the real issue here is that NaN-boxing is based on the idea that is not possible to generate FP results in the form `0xfffXXXXXXXXXXXXX` while using FPVI it is possible (in a transient path).

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1692972#c14)• 4 years ago |
|  | |

Thanks for your comments. `string.length` is indeed an interesting one that doesn't require additional guards.

For FPVI, I can't think of a good JIT mitigation. The option to treat denormals as zero is a nuclear one that's pretty risky because it will affect how (a lot of) code behaves. JS/Wasm code, but also C++ code if we don't restrict it to JS (which is fairly difficult because we often call into the DOM). For example, [this post](https://randomascii.wordpress.com/2012/05/20/thats-not-normalthe-performance-of-odd-floats/) explains how disabling denormals can result in division-by-zero to show up.

Given our timer mitigations and the absence of end-to-end exploits at this point, it's possible we can wait for Fission, which is expected to start rolling out to release in Q3. Unfortunately that does leave a window of a few months.

If we wanted to mitigate this in the JIT, the double-to-Value boxing step is a potential place to do it, maybe a CMP + CMOV on that path to zero the register if it's not a double. The performance overhead of that wouldn't be great though.

Do you have any insight on which floating-point operations are vulnerable to this? For example, is `addsd` also affected?

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1692972#c15)• 4 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #14](/show_bug.cgi?id=1692972#c14 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> Thanks for your comments. `string.length` is indeed an interesting one that doesn't require additional guards.
>
> For FPVI, I can't think of a good JIT mitigation. The option to treat denormals as zero is a nuclear one that's pretty risky because it will affect how (a lot of) code behaves. JS/Wasm code, but also C++ code if we don't restrict it to JS (which is fairly difficult because we often call into the DOM). For example, [this post](https://randomascii.wordpress.com/2012/05/20/thats-not-normalthe-performance-of-odd-floats/) explains how disabling denormals can result in division-by-zero to show up.

I agree DAZ and FTZ is not a viable solution. Very likely many current implementations rely on denormal results.

> If we wanted to mitigate this in the JIT, the double-to-Value boxing step is a potential place to do it, maybe a CMP + CMOV on that path to zero the register if it's not a double. The performance overhead of that wouldn't be great though.

Currently, we also believe that conditional masking is a possible solution while Fission is not yet deployed.

> Do you have any insight on which floating-point operations are vulnerable to this? For example, is `addsd` also affected?

We have verified that transient results are generated for all the add,sub,mul and div of x87, SSE or AVX instructions on FP numbers.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1692972#c16)• 4 years ago |
|  | |

(In reply to Enrico Barberis from [comment #15](/show_bug.cgi?id=1692972#c15 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> > If we wanted to mitigate this in the JIT, the double-to-Value boxing step is a potential place to do it, maybe a CMP + CMOV on that path to zero the register if it's not a double. The performance overhead of that wouldn't be great though.
>
> Currently, we also believe that conditional masking is a possible solution while Fission is not yet deployed.
>
> > Do you have any insight on which floating-point operations are vulnerable to this? For example, is `addsd` also affected?
>
> We have verified that transient results are generated for all the add,sub,mul and div of x87, SSE or AVX instructions on FP numbers.

Thanks, that's good to know.

Another option is to add a fence before `string.length` (and maybe `string[n]`). The reasoning being that the interesting Value types here are:

* String: `string.length` is the easiest vector as you found out.
* Object: harder to abuse because this generally requires extra guards and loads, especially with Warp.
* Symbol: opaque to the JITs
* BigInt: we have some fast paths, but also comes with bounds checks, overhead to create a new BigInt etc.

So if strings are the easy vector, and they're already giving you difficulties, maybe it would be sufficient to fence those in functions that do double arithmetic, at least until Fission ships later this year.

I'm curious to hear your opinion on this.

|  | [Cristiano Giuffrida](/user_profile?user_id=680016) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1692972#c17)• 4 years ago |
|  | |

Hi Jan,

re SCSB:

Great, indeed looks like you already have plenty of serialization on that path.

re FPVI:

For the general mitigation, you suggested using CMOV-based masking in the double-to-Value boxing step. I assume the double-to-Value boxing step happens when the floating-point value escapes and the JIT engine gives up on tracking its type at compile time? If so, this is exactly the mitigation we also discussed internally (e.g., lfence or better conditional masking at escape points). Since after the value escapes every use needs to go through non-trivial NaN-unboxing logic, we figured the extra CMP+CMOV wouldn't have a significant performance impact. Is that not the case?

For the exploit-driven mitigation, I don't think we have studied all the relevant code paths to be able to comment on general effectiveness. Hany and Enrico did look at string and Object, and both seem viable for exploitation, with different challenges. In particular, "string.length" makes it trivial to leak information through classic Flush+Reload, but requires a large(r) transient execution window for exploitation (to fit the corresponding checks). Despite the challenges, I think Enrico is already making good progress on a full exploit. Object dereferences (e.g., z[0]), on the other hand, seem to easily fit in a transient execution window, but yield a non-conventional covert channel using the secret data as the target address of a memory access. One can still leak the secret by using translation side channels (e.g., see our ASLR^Cache or AnC paper), but this only works for secrets that look like canonical addresses. So straightforward leaks are, in principle, limited to pointers stored in memory. And I don't know how high on your priority list an ASLR bypass is at this point. Nonetheless, note that, with some massaging and sliding, I would expect an attacker to be able to leak secrets beyond stored pointers, but high-entropy secrets like tokens, passwords, etc. are probably out of reach.

Flags: needinfo?(giuffrida)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1692972#c18)• 4 years ago |
|  | |

Thanks for your comments, they have been really helpful.

We will experiment with using CMP/CMOV for `LBox` (or `LBoxFloatingPoint` on x86) and see how that affects perf. It's hard to mitigate these issues completely, but that plugs the most obvious hole and combined with the embargo period and timer mitigations it will hopefully be sufficient until Fission arrives.

|  | [Cristiano Giuffrida](/user_profile?user_id=680016) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1692972#c19)• 4 years ago |
|  | |

Happy to help! Please keep us posted.

Enrico and Hany will also report on progress with the exploit.

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1692972#c20)• 4 years ago |
|  | |

The regressions we saw with object-biased nan-boxing ([bug 1559072](/show_bug.cgi?id=1559072 "RESOLVED FIXED - 12.23 - 13% kraken (linux64-shippable, linux64-shippable-qr, windows10-64-shippable, windows10-64-shippable-qr) regression on push ae799ea48e2cf970b0d780cdfc7494b8fabfb16c")) might be a rough order-of-magnitude estimate of the slowdown from CMP/CMOV when storing doubles. IIRC, the worst regression came in code like `for (...) a[i] = b[i] * c[i]`, where additional overhead on loads and stores was a significant fraction of the entire loop body. Warp already bit the bullet and added `GuardToDouble`s in that loop, though, so maybe a couple extra instructions won't be as noticeable.

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1692972#c21)• 4 years ago |
|  | |

Attached file
[fpvi-scsb-mozilla-disclosure-02-23-2021.zip](attachment.cgi?id=9204835)
— [Details](attachment.cgi?id=9204835&action=edit)

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1692972#c22)• 4 years ago |
|  | |

Finally, we have an update regarding the exploit: we are able to **leak arbitrary memory addresses exploiting transient type confusion**. Compared to the previous PoC we have changed the type-confusion from object to string and enlarged the transient window using FPU pressure.

For the time being, the covert-channel is obtained by making `clflush` and precise timers accessible from JS. Eventually, the exploit can be implemented "patchless" (See paper for more details).

All the details and the source code are present in the attached zip `fpvi-scsb-mozilla-disclosure-02-23-2021.zip`.

We have also updated the paper together with the disclosure document to reflect these changes.

All the added/modified files are specified by the CHANGELOG.

To help the discussion, I will share here the core part of the exploit:

```
    //the *two/two is a trick to enlarge the transient window due to higher FPU pressure
    z = x/(y*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two*two/two)

    //At this point z has two possible values:
    //architectural_z   = JSDouble value -inf
    //transient_z       = JSString pointer to 0xdeadbeef000
    if (typeof z == "string") {
        return reload_buf8[(z.length&0xff)<<STRIDE_LOG]
    } else {
        return hot;
    }

```

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a744051_1689)• 4 years ago |

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1692972#c23)• 4 years ago |
|  | |

Attached file
[Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!](attachment.cgi?id=9206591)
— [Details](attachment.cgi?id=9206591&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a1306928_600971)• 4 years ago |

Assignee: nobody → jdemooijStatus: NEW → ASSIGNED

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1692972#c24)• 4 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #18](/show_bug.cgi?id=1692972#c18 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> We will experiment with using CMP/CMOV for `LBox` (or `LBoxFloatingPoint` on x86) and see how that affects perf. It's hard to mitigate these issues completely, but that plugs the most obvious hole and combined with the embargo period and timer mitigations it will hopefully be sufficient until Fission arrives.

I posted a patch for this. I didn't see a measurable slowdown on some JS shell benchmarks I tried so that's good news.

This is not a complete fix, but it's a stopgap for the most easily exploited case that's used by the paper/PoCs here.

Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1692972#c25)• 4 years ago |
|  | |

Comment on [attachment 9206591](/attachment.cgi?id=9206591 "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") [[details]](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!")

[Bug 1692972](/show_bug.cgi?id=1692972 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)") - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Pretty difficult, but it might draw some attention to this variant. Not sure if it makes sense to hold off a bit on landing this or to just go ahead.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: N/A
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Should apply.
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely.
[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: sec-approval?

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1692972#c26)• 4 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

Is it possible to have a look at the current patch?

If I try to open [Bug 1692972](/show_bug.cgi?id=1692972 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)") I get the error "Access Denied: Restricted Differential Revision".

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1692972#c27)• 4 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

My bad! I can now see the attached patch. Sorry for the spam

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1692972#c28)• 4 years ago |
|  | |

Comment on [attachment 9206591](/attachment.cgi?id=9206591 "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") [[details]](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!")

[Bug 1692972](/show_bug.cgi?id=1692972 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)") - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!

sec-approved to land, please request uplift.

[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: sec-approval?
[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: sec-approval+
[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: approval-mozilla-esr78?
[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: approval-mozilla-beta?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a1907043_580382)• 4 years ago |

[status-firefox86](/buglist.cgi?f1=cf_status_firefox86&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix)
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected)
[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)
[tracking-firefox87](/buglist.cgi?f1=cf_tracking_firefox87&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox87&o1=equals&v1=%2B)
[tracking-firefox88](/buglist.cgi?f1=cf_tracking_firefox88&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox88&o1=equals&v1=%2B)
[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
--- → [87+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=87%2B)

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1692972#c29)• 4 years ago |
|  | |

We have verified that the proposed patch kills the signal in our test environment.

Indeed, we observed the JIT'ed code changing from

```
divsd %xmm1, %xmm0
movq %xmm0, %rbp
jmp 0x00000000000001D1

```

to

```
divsd %xmm1, %xmm0
movq %xmm0, %rbp
mov $0xFFF80000FFFFFFFF, %r11
cmp %rbp, %r11
cmovb %r11, %rbp
jmp 0x0000000000000190

```

where the `cmov` is correctly stopping the transient value.

To the best of our knowledge, `cmov` is the most desirable countermeasure due to its low overhead.

Kudos for the patch in such a short amount of time :)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1692972#c30)• 4 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/df86e60f3b6281090d37e13250523baede97bf5a>

(In reply to Enrico Barberis from [comment #29](/show_bug.cgi?id=1692972#c29 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)"))

> We have verified that the proposed patch kills the signal in our test environment.

Thanks a lot for checking that!

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1692972#c31)• 4 years ago |
|  | |

Add DoubleValue masking for LBox/LBoxFloatingPoint. r=iain

<https://hg.mozilla.org/mozilla-central/rev/df86e60f3b62>

Group: javascript-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 4 years ago
[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 88 Branch

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1692972#c32)• 4 years ago |
|  | |

Comment on [attachment 9206591](/attachment.cgi?id=9206591 "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") [[details]](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!")

[Bug 1692972](/show_bug.cgi?id=1692972 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)") - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!

approved for 87.0b9

[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1692972#c33)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/b129bba64358>

[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1692972#c34)• 4 years ago |
|  | |

Comment on [attachment 9206591](/attachment.cgi?id=9206591 "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") [[details]](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!")

[Bug 1692972](/show_bug.cgi?id=1692972 "RESOLVED FIXED - FPVI & SCSB Disclosure (Feb 12, ‘21)") - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!

Approved for 78.9esr.

[Attachment #9206591](/attachment.cgi?id=9206591&action=edit "Bug 1692972 - Add DoubleValue masking for LBox/LBoxFloatingPoint. r?iain!") -
Flags: approval-mozilla-esr78? → approval-mozilla-esr78+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1692972#c35)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr78/rev/e11e53daf76d>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1692972#c36)• 4 years ago |
|  | |

Backed out from ESR78 for build bustage.

<https://hg.mozilla.org/releases/mozilla-esr78/rev/92e6877143422e4f768fb202cd26f216e1500c1a>

<https://treeherder.mozilla.org/logviewer?job_id=332876342&repo=mozilla-esr78&lineNumber=2083>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1692972#c37)• 4 years ago |
|  | |

Attached patch

[Patch for ESR78](attachment.cgi?id=9208634&action=diff)
— [Details](attachment.cgi?id=9208634&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1692972&attachment=9208634)

This backports cmpPtrMovePtr for x64 because ESR78 didn't have it. I verified this builds and passes jit-tests.

Flags: needinfo?(jdemooij) → needinfo?(ryanvm)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1692972#c38)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr78/rev/906e64cb23014c7108b8ad75c9289405e89c0406>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)Flags: needinfo?(ryanvm)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a2082152_458186)• 4 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a2459314_578488)• 4 years ago |

Whiteboard: [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?] → [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a2459663_1689)• 4 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a2533956_578488)• 4 years ago |

Whiteboard: [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-] → [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-][adv-esr78.9-]

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1692972#c39)• 4 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1692972) to reply.

Flags: needinfo?(jdemooij)Whiteboard: [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-][adv-esr78.9-] → [Disclosure date ≈2021-05-12][reporter-external] [client-bounty-form] [verif?][adv-main87-][adv-esr78.9-][sec-survey]

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1692972#c40)• 4 years ago |
|  | |

Hi everyone, we have a couple of questions from our side:

1. Is there a CVE assigned to this bug?
2. We cannot find this vulnerability anywhere on this page <https://www.mozilla.org/en-US/security/known-vulnerabilities/firefox/> . Can you confirm from which version the mitigation is included?

We would like to report this information in our paper.

Thank you

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a7175435_580382)• 4 years ago |

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1692972#c41)• 4 years ago |
|  | |

We have not assigned a CVE or published an advisory to respect the disclosure date. We have intended to update our published advsiory for Firefox 87 and 78.9 when it is safe to do so. Please let us know when we can do that. I reserved [CVE-2021-29955](https://www.cve.org/CVERecord?id=CVE-2021-29955) for FPVI in Spidermonkey though.

Alias: CVE-2021-29955Flags: needinfo?(tom)

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1692972#c42)• 4 years ago |
|  | |

Thank you for the update, the agreed public disclosure date is **June 8th**.

Have you already reserved a link for the security advisory?

We are asking for this information in advance due to our paper deadlines.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608)  Reporter |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1692972#c43)• 4 years ago |
|  | |

We will update our existing security advisories.

You can already find them for Firefox 87 at <https://www.mozilla.org/en-US/security/advisories/mfsa2021-10/> and Firefox ESR 78.9 at <https://www.mozilla.org/en-US/security/advisories/mfsa2021-11/> - we expect these URLs to be stable.

|  | [Enrico Barberis](/user_profile?user_id=680017) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1692972#c44)• 4 years ago |
|  | |

One last update from our side: the coordinated disclosure is on June 8 at 10 am PDT.

When public, you will find all information here:

project page: <https://www.vusec.net/projects/fpvi-scsb>

paper: <http://download.vusec.net/papers/fpvi-scsb_sec21.pdf>

repo: <https://github.com/vusec/fpvi-scsb>

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608)  Reporter |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1692972#c45)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9225814)
— [Details](attachment.cgi?id=9225814&action=edit)

Adding advisory. We'll attempt to publish this jointly (or shortly after) the disclosure at 9am PDT.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a24190372_1689)• 3 years ago |

Group: core-security-release

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a44078585_375297)• 3 years ago |

Flags: needinfo?(jdemooij)

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692972#a103627308_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1692972&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tom Ritter [:tjr]](/user_profile?user_id=578488)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


