=== Content from bugzilla.mozilla.org_123f85b4_20250114_195101.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1719088)
* [XML](/show_bug.cgi?ctype=xml&id=1719088)

Closed
[Bug 1719088](/show_bug.cgi?id=1719088)
(CVE-2021-29983)

Opened 4 years ago
Closed 3 years ago

# Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame

## Categories

### (GeckoView :: General, defect, P1)

[Product:](/describecomponents.cgi?product=GeckoView)

GeckoView
▾

GeckoView
The GeckoView components for Android
[See Open Bugs in This Product](/buglist.cgi?product=GeckoView&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=GeckoView)
Watch This Product

[Component:](/describecomponents.cgi?product=GeckoView&component=General#General)

General
▾

GeckoView :: General
The GeckoView embedding widget for Android
[See Open Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=GeckoView&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### (firefox90 wontfix, firefox91+ verified, firefox92+ verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

92 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox90 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix) |
| firefox91 | [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=verified) |
| firefox92 | [+](/buglist.cgi?f1=cf_tracking_firefox92&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox90 |  | wontfix |
| firefox91 | + | verified |
| firefox92 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sourc7, Assigned: agi)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2f23a572bdd06777026ab2c155cfe0c0?d=mm&size=40)  [agi](/user_profile?user_id=421286)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1f6e740893c5a41879a277dd0b0a0c4a?d=mm&size=40)  [sourc7](/user_profile?user_id=537720)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/418efed494240195b86667307fe63d5c?d=mm&size=40)  [owlish](/user_profile?user_id=579431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1718796](/show_bug.cgi?id=1718796 "VERIFIED FIXED - Invoke Element.requestFullscreen without Fullscreen Security Notification leads to Address Bar UI spoofing")

## Details

### (Keywords: csectype-spoof, reporter-external, sec-high, Whiteboard: [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?][adv-main91+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29983

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?][adv-main91+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2015891_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [fullscreen-persistent.fenix.html](/attachment.cgi?id=9229653)  [4 years ago](#c0)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   621.80 KB, text/html |  | [Details](/attachment.cgi?id=9229653&action=edit) |
| --- | --- | --- |
| [Firefox for Android - Lock Exit Fullscreen Mode.mp4](/attachment.cgi?id=9229655)  [4 years ago](#c1)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   659.91 KB, video/mp4 |  | [Details](/attachment.cgi?id=9229655&action=edit) |
| [Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.](/attachment.cgi?id=9232252)  [3 years ago](#c8)  [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)   48 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#c15 "3 years ago")  tjr : [sec-approval+](#c12 "3 years ago") | [Details](/attachment.cgi?id=9232252&action=edit) | [Review](/attachment.cgi?id=9232252) |
| [20210803\_095101.mp4](/attachment.cgi?id=9234384)  [3 years ago](#c20)  [Lorand Janos](/user_profile?user_id=635881)   5.81 MB, video/mp4 |  | [Details](/attachment.cgi?id=9234384&action=edit) |
| [advisory.txt](/attachment.cgi?id=9235154)  [3 years ago](#c21)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   304 bytes, text/plain |  | [Details](/attachment.cgi?id=9235154&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1719088#c0)• 4 years ago |
|  | |

Attached file
[fullscreen-persistent.fenix.html](attachment.cgi?id=9229653)
— [Details](attachment.cgi?id=9229653&action=edit)

When I try to reproduce [Bug 1718796](/show_bug.cgi?id=1718796 "VERIFIED FIXED - Invoke Element.requestFullscreen without Fullscreen Security Notification leads to Address Bar UI spoofing") in Firefox for Android, after the browser goes into fullscreen mode I unable to exit the fullscreen using back button, the fullscreen mode is persistent it still persist even navigate to different origin.

Currently the testcase is still intermittent, so there is still chance to able to exit the fullscreen,

probably timing between iFrame element target and entering fullscreen.

## Tested on:

* Firefox Nightly 91.0a1 (Build #2015819979)
* Firefox Beta 90.0.0-beta.6 (Build #2015818371)
* Firefox 89.1.1 (Build #2015812947)

## Steps to reproduce:

1. Visit attached fullscreen-persistent.fenix.html
2. Single tap or double tap on the page
3. When browser goes into fullscreen
4. Press back button repeatedly
5. The browser won't exit the fullscreen, if otherwise after press back try to tap the page again.
Flags: sec-bounty?

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1719088#c1)• 4 years ago |
|  | |

Attached video
[Firefox for Android - Lock Exit Fullscreen Mode.mp4](attachment.cgi?id=9229655)
— [Details](attachment.cgi?id=9229655&action=edit)

On the following video it shows I can't get out of full screen mode even repeatedly pressing the back button, interestingly after focus on the form (which can be done automatically with JavaScript) the Android autocomplete will appear along with the Android status bar displayed in the top bar, which makes the spoof more convincing.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a193888_159069)• 4 years ago |

Group: firefox-core-security → mobile-core-securityType: task → defectComponent: Security → Security: AndroidProduct: Firefox → Fenix

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1719088#c2)• 4 years ago |
|  | |

We can start with `sec-high` because it could be a very convincing spoof, but it's not quite clear how much of that is due to [bug 1718796](/show_bug.cgi?id=1718796 "VERIFIED FIXED - Invoke Element.requestFullscreen without Fullscreen Security Notification leads to Address Bar UI spoofing") and how much due to this specific aspect. (Don't be lulled by the particular POC -- imagine the flashing frames are invisible and the page has something convincing for you to click on)

Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Petru-Mugurel Lingurar [:petru]](/user_profile?user_id=613831) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1719088#c3)• 4 years ago |
|  | |

I'll be trying to fix this for Fenix. Can someone add me on #1718796 ?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1719088#c4)• 4 years ago |
|  | |

Done.

|  | [Petru-Mugurel Lingurar [:petru]](/user_profile?user_id=613831) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1719088#c5)• 3 years ago |
|  | |

Looking into this I see Fenix & AC working as expected.

The problem with not being able to exit fullscreen is because of the current flow in which the app will call `geckoSession.exitFullScreen()` which does [mEventDispatcher.dispatch("GeckoViewContent:ExitFullScreen", null)](https://searchfox.org/mozilla-central/rev/70a94bffbb73d2b0ba751fb3905428fdbcd4d402/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#2370) and then will wait for a fullscreen update from Gecko [here](https://github.com/mozilla-mobile/android-components/blob/8faefe1e7523f4cc92314ac2247f47b0ba2f19b6/components/browser/engine-gecko/src/main/java/mozilla/components/browser/engine/gecko/GeckoEngineSession.kt#L807-L809).

`onFullScreenChange(false)` normally comes when users press back in a fullscreen video but in the case presented here this callback does not fire after we request from GeckoView to exit fullscreen.

Don't know if the app should always exist fullscreen even if the browser is still in fullscreen and not wait for the `onFullScreenChange(false)` callback. @Christian? @Agi?

Flags: needinfo?(csadilek)Flags: needinfo?(agi)

|  | [Petru-Mugurel Lingurar [:petru]](/user_profile?user_id=613831) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1719088#c6)• 3 years ago |
|  | |

In the meantime, looks like there is nothing actionable on Fenix.

If the bug from #1718796 is resolved in Gecko/GeckoView the fix will trickle down to Fenix.

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1719088#c7)• 3 years ago |
|  | |

I think we should avoid mismatching the fullscreen state between GV and Fenix, I can definitely see more bugs coming from GV thinking it's in fullscreen and Fenix thinking it's not. I'll try to figure out what's going on here.

Flags: needinfo?(agi)

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a1423595_590895)• 3 years ago |

Flags: needinfo?(csadilek)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1719088#c8)• 3 years ago |
|  | |

Attached file
[Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.](attachment.cgi?id=9232252)
— [Details](attachment.cgi?id=9232252&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a1425616_600971)• 3 years ago |

Assignee: nobody → agiStatus: NEW → ASSIGNED

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1719088#c9)• 3 years ago |
| thankyou | |

The context here is that we have a method called `sendToAllChildren` which... does not actually do that. It sends events to all *ancestors* of the browsingContext instead. So when GeckoView is trying to exit fullscreen it will try to send the `GeckoView:DOMFullscreenExited` message to the root actor and its ancestors (which don't exist) instead of sending it to the children.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a1497936_600971)• 3 years ago |

[Attachment #9232252](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") -
Attachment description: Bug 1719088 - Refactor sendToAllChildren. → Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1719088#c10)• 3 years ago |
|  | |

copying from slack:

> thinking about this more (and looking at Desktop's code) I think we can do something even simpler
>
> there's a method on Document to exit fullscreen that desktop uses
>
> we need to rename the method too, but we can do it in another patch to avoid pointing fingers at the problem

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1719088#c11)• 3 years ago |
|  | |

Comment on [attachment 9232252](/attachment.cgi?id=9232252 "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") [[details]](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.")

[Bug 1719088](/show_bug.cgi?id=1719088 "RESOLVED FIXED - Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame") - Use document.exitFullscreen instead of traversing the tree.

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch is worded as a simplification and it doesn't directly point a the fact that fullscreen in iframes is broken. One people start looking at fullscreen it might not take long until they find the problem though.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Patch should be identical for all branches
* **How likely is this patch to cause regressions; how much testing does it need?**: It could break fullscreen in edge cases.
[Attachment #9232252](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") -
Flags: sec-approval?

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a1581460_421286)• 3 years ago |

Severity: -- → S3Component: Security: Android → GeneralPriority: -- → P1Product: Fenix → GeckoView

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1719088#c12)• 3 years ago |
|  | |

Comment on [attachment 9232252](/attachment.cgi?id=9232252 "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") [[details]](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.")

[Bug 1719088](/show_bug.cgi?id=1719088 "RESOLVED FIXED - Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame") - Use document.exitFullscreen instead of traversing the tree.

Approved to land. I don't think Fenix has an uplift need?

[Attachment #9232252](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") -
Flags: sec-approval? → sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1719088#c13)• 3 years ago |
|  | |

Use document.exitFullscreen instead of traversing the tree. r=aklotz

<https://hg.mozilla.org/integration/autoland/rev/ede907c3def22d5bbdefc682a73a8c7585636a6f>

<https://hg.mozilla.org/mozilla-central/rev/ede907c3def2>

Group: mobile-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 92 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2015891_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2015962_1689)• 3 years ago |

See Also: → [1718796](/show_bug.cgi?id=1718796 "VERIFIED FIXED - Invoke Element.requestFullscreen without Fullscreen Security Notification leads to Address Bar UI spoofing")Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2102503_75935)• 3 years ago |

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix)
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected)
[tracking-firefox91](/buglist.cgi?f1=cf_tracking_firefox91&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B)
[tracking-firefox92](/buglist.cgi?f1=cf_tracking_firefox92&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox92&o1=equals&v1=%2B)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1719088#c14)• 3 years ago |
|  | |

Comment on [attachment 9232252](/attachment.cgi?id=9232252 "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") [[details]](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.")

[Bug 1719088](/show_bug.cgi?id=1719088 "RESOLVED FIXED - Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame") - Use document.exitFullscreen instead of traversing the tree.

### Beta/Release Uplift Approval Request

* **User impact if declined**: A malicious code could lock fullscren in Fenix
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: - Open testcase in bug

* Verify that full-screen can be exited by pressing "back" on the device

* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: simple change, worst case scenario we add some unrelated fullscreen locks
* **String changes made/needed**:
[Attachment #9232252](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") -
Flags: approval-mozilla-beta?

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2179017_421286)• 3 years ago |

Flags: qe-verify+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1719088#c15)• 3 years ago |
|  | |

Comment on [attachment 9232252](/attachment.cgi?id=9232252 "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") [[details]](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.")

[Bug 1719088](/show_bug.cgi?id=1719088 "RESOLVED FIXED - Firefox for Android Lock Exit Fullscreen Mode with Recursive iFrame") - Use document.exitFullscreen instead of traversing the tree.

Approved for uplift on the beta branch before Monday's beta to release merge so if can make it into Fenix 91, thanks.

[Attachment #9232252](/attachment.cgi?id=9232252&action=edit "Bug 1719088 - Use document.exitFullscreen instead of traversing the tree.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1719088#c16)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/5aa3ee8c3f76>

[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2500260_553429)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1719088#c17)• 3 years ago |
|  | |

I've tested it using the steps from the description and I managed to reproduce it with the latest Nightly 92.0a1 (2021-08-02T05:08:16.189754) build.

I also checked on the latest GV where it is also reproducible.

Device used: Google Pixel 4 (Android 11).

Was not reproducible on the latest Nightly using an Android 12 device.

Flags: needinfo?(agi)

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2522994_635881)• 3 years ago |

Flags: qe-verify+

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1719088#c18)• 3 years ago |
|  | |

Weird, I can't reproduce on my Pixel 3a and my S10 on Android 11 (and I could before the change). I'll try other devices too.

Status: RESOLVED → REOPENEDFlags: needinfo?(agi)Resolution: FIXED → ---

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1719088#c19)• 3 years ago |
|  | |

I can't reproduce this anymore on Mi 9T Android 10 (real devices) and Pixel 4 API 30 Android 11 x86\_64 (Android Emulator) with Firefox Nightly 92.0a1 (Build #2015825739 arm64) (Build #2015825743 x86\_64).

I also tried this on AWS Device Farm (which using real devices) with Google Pixel 4A on Android 11, I can exit the fullscreen everytime I press the back button on Firefox Nightly 92.0a1 (Build #2015825739). On Firefox 90.1.3 (Build #2015824995) pressing back button won't exit the fullscreen.

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1719088#c20)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1719088&comment_id=15512203 "1 revision") |
|  | |

Attached video
[20210803\_095101.mp4](attachment.cgi?id=9234384)
— [Details](attachment.cgi?id=9234384&action=edit)

I retested it and managed to activate the back button.

Aside from the latest Nightly, I also tested on the latest Beta (91.0.0-beta.6) where it also appears fixed.

I will close the issue as verified.

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2584202_635881)• 3 years ago |

Flags: qe-verify+

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2587414_635881)• 3 years ago |

Status: REOPENED → RESOLVEDClosed: 3 years ago → 3 years agoResolution: --- → FIXED

|  | [Sorina Florean [:sflorean]](/user_profile?user_id=565577) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2594819_565577)• 3 years ago |

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=verified)Flags: qe-verify+

|  | [Lorand Janos](/user_profile?user_id=635881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2595270_635881)• 3 years ago |

[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=verified)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2866949_578488)• 3 years ago |

Whiteboard: [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?] → [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?][adv-main90+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2867172_578488)• 3 years ago |

Whiteboard: [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?][adv-main90+] → [keep hidden while bug 1718796 is][reporter-external] [client-bounty-form] [verif?][adv-main91+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1719088#c21)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235154)
— [Details](attachment.cgi?id=9235154&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a2877915_578488)• 3 years ago |

Alias: CVE-2021-29983

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a36168020_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719088#a91696932_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1719088&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_c3cab586_20250114_195102.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-33

## Security Vulnerabilities fixed in Firefox 91

Announced
August 10, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 91

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29983: Firefox for Android could get stuck in fullscreen mode](#CVE-2021-29983)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox for Android could get stuck in fullscreen mode and not exit it even after normal interactions that should cause it to exit.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1719088](https://bugzilla.mozilla.org/show_bug.cgi?id=1719088)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Firefox on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

#### [#CVE-2021-29990: Memory safety bugs fixed in Firefox 91](#CVE-2021-29990)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Kershaw Chang, Philipp, Chris Peterson, and Sebastian Hengst reported memory safety bugs present in Firefox 90. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


