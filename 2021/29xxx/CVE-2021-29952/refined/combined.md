=== Content from bugzilla.mozilla.org_1fd68d7c_20250114_203731.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1704227)
* [XML](/show_bug.cgi?ctype=xml&id=1704227)

Closed
[Bug 1704227](/show_bug.cgi?id=1704227)
(CVE-2021-29952)

Opened 4 years ago
Closed 4 years ago

# ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]

## Categories

### (Core :: Graphics: WebRender, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20WebRender#Graphics%3A%20WebRender)

Graphics: WebRender
▾

Core :: Graphics: WebRender
Bugs related to the integration of WebRender into Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20WebRender&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20WebRender&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20WebRender)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

90 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected) |
| firefox88 | [+](/buglist.cgi?f1=cf_tracking_firefox88&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=fixed) |
| firefox89 | [+](/buglist.cgi?f1=cf_tracking_firefox89&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed) |
| firefox90 | [+](/buglist.cgi?f1=cf_tracking_firefox90&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox88 | + | fixed |
| firefox89 | + | fixed |
| firefox90 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tsmith, Assigned: aosmond)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bff3d32989145dfc299efa3b8dac36f7?d=mm&size=40)  [aosmond](/user_profile?user_id=505306)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2837b951fa7dc639a2568203478ff0a?d=mm&size=40)  [tsmith](/user_profile?user_id=486634)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2f22cafad5e74490468a55973c7c14fe?d=mm&size=40)  [gw](/user_profile?user_id=504871)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

### (Blocks 2 open bugs)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[domino](/show_bug.cgi?id=1340565 "NEW - [meta] (domino) Bugs found while fuzzing with domino")

[tsan](/show_bug.cgi?id=929478 "NEW - [meta] Make TSan (ThreadSanitizer) usable with Firefox")

Dependency [tree](/showdependencytree.cgi?id=1704227&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1704227)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1693765](/show_bug.cgi?id=1693765 "RESOLVED DUPLICATE - Crash in [@ core::ptr::drop_in_place<T> | core::ptr::drop_in_place<T> | webrender_bindings::bindings::wr_api_delete] [@ wr_api_delete]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-race, sec-moderate)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29952

[Keywords:](/describekeywords.cgi)

[csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [noni](/user_profile?user_id=458186) | [qe-verify](#a3587178_458186 "4 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]](https://crash-stats.mozilla.org/signature/?signature=core%3A%3Aptr%3A%3Adrop_in_place%3CT%3E%20%7C%20core%3A%3Aptr%3A%3Adrop_in_place%3CT%3E%20%7C%20webrender_bindings%3A%3Abindings%3A%3Awr_api_delete)

[[@ core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]](https://crash-stats.mozilla.org/signature/?signature=core%3A%3Aptr%3A%3Adrop_in_place%3CT%3E%20%7C%20webrender_bindings%3A%3Abindings%3A%3Awr_api_delete)

[[@ wr\_api\_delete ]](https://crash-stats.mozilla.org/signature/?signature=wr_api_delete)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Detailed Crash Information](/attachment.cgi?id=9214846)  [4 years ago](#c0)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   17.67 KB, text/plain |  | [Details](/attachment.cgi?id=9214846&action=edit) |
| --- | --- | --- |
| [Bug 1704227.](/attachment.cgi?id=9217909)  [4 years ago](#c4)  [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)   48 bytes, text/x-phabricator-request | tjr : [approval-mozilla-beta+](#c9 "4 years ago")  RyanVM : [approval-mozilla-release+](#c13 "4 years ago")  tjr : [sec-approval+](#c9 "4 years ago") | [Details](/attachment.cgi?id=9217909&action=edit) | [Review](/attachment.cgi?id=9217909) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1704227#c0)• 4 years ago |
|  | |

Attached file
[Detailed Crash Information](attachment.cgi?id=9214846)
— [Details](attachment.cgi?id=9214846&action=edit)

The attached crash information was detected by ThreadSanitizer while fuzzing build mozilla-central 20210409-7bc2dd06085f. Unfortunately a test case is not available.

### General information about TSan reports

#### Why fix races?

Data races are undefined behavior and can cause crashes as well as correctness issues. Compiler optimizations can cause racy code to have unpredictable and hard-to-reproduce behavior.

#### Rating

If you think this race can cause crashes or correctness issues, it would be great to rate the bug appropriately as P1/P2 and/or indicating this in the bug. This makes it a lot easier for us to assess the actual impact that these reports make and if they are helpful to you.

#### False Positives / Benign Races

Typically, races reported by TSan are not false positives [1], but it is possible that the race is benign. Even in this case it would be nice to come up with a fix if it is easily doable and does not regress performance. Every race that we cannot fix will have to remain on the suppression list and slows down the overall TSan performance. Also note that seemingly benign races can possibly be harmful (also depending on the compiler, optimizations and the architecture) [2][3].

[1] One major exception is the involvement of uninstrumented code from third-party libraries.

[2] <http://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong>

[3] How to miscompile programs with "benign" data races: <https://www.usenix.org/legacy/events/hotpar11/tech/final_files/Boehm.pdf>

#### Suppressing unfixable races

If the bug cannot be fixed, then a runtime suppression needs to be added in mozglue/build/TsanOptions.cpp. The suppressions match on the full stack, so it should be picked such that it is unique to this particular race. The bug number of this bug should also be included so we have some documentation on why this suppression was added.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a832465_279663)• 4 years ago |

Blocks: [gfx-triage](/show_bug.cgi?id=1632611 "NEW - [Meta] Graphics Triage Tracker")Severity: -- → S3

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1704227#c1)• 4 years ago |
|  | |

From the stacks, it looks like WebRenderBridgeParent::RecvShutdownSync() is causing WebRenderBridgeParent::ClearResources() to run on the compositor thread, and that's racing with some actual use of a WebRender data structure on a WRScene~ilder#6 thread.

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1704227#c2)• 4 years ago |
|  | |

The scene builder thread really shouldn't be calling that API to get the CompositorBridgeParent. I suspect we can defer to this the compositor thread and avoid the race.

Assignee: nobody → aosmond

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a1113904_505306)• 4 years ago |

No longer blocks: [gfx-triage](/show_bug.cgi?id=1632611 "NEW - [Meta] Graphics Triage Tracker")

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1704227#c3)• 4 years ago |
|  | |

We have a similar issue at the other call site at <https://searchfox.org/mozilla-central/rev/f018480dfed4fc583703a5770a6db9ab9dc0fb99/gfx/webrender_bindings/RenderThread.cpp#1214>

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1704227#c4)• 4 years ago |
|  | |

Attached file
[Bug 1704227.](attachment.cgi?id=9217909)
— [Details](attachment.cgi?id=9217909&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1704227#c5)• 4 years ago |
|  | |

This is a shutdown race, so I'm going to mark it as sec-moderate.

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1704227#c6)• 4 years ago |
|  | |

Comment on [attachment 9217909](/attachment.cgi?id=9217909 "Bug 1704227.") [[details]](/attachment.cgi?id=9217909&action=edit "Bug 1704227.")

[Bug 1704227](/show_bug.cgi?id=1704227 "RESOLVED FIXED - ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]").

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Given how simple the function we should be calling on the compositor thread is, I imagine they can figure out there is a race with CompositorBridgeParent/WebRenderAPI somewhat easily.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All, disabled in ESR by default
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: Same patch should apply
* **How likely is this patch to cause regressions; how much testing does it need?**: Minimal chance of regressions
[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: sec-approval?

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1704227#c7)• 4 years ago |
|  | |

FWIW, I believe a similar race could occur when a window is closed, not just shutdown.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1704227#c8)• 4 years ago |
|  | |

Thanks for the clarification. I think I'll just leave it as sec-moderate as it still seems tricky to exploit, but maybe it should be sec-high.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1704227#c9)• 4 years ago |
|  | |

Comment on [attachment 9217909](/attachment.cgi?id=9217909 "Bug 1704227.") [[details]](/attachment.cgi?id=9217909&action=edit "Bug 1704227.")

[Bug 1704227](/show_bug.cgi?id=1704227 "RESOLVED FIXED - ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]").

Approved to land and uplift

[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: sec-approval?
[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: sec-approval+
[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: approval-mozilla-beta+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1704227#c10)• 4 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/a9690e74a6bdfa95138c5a489ece78e72d718af7>

<https://hg.mozilla.org/mozilla-central/rev/a9690e74a6bd>

Group: gfx-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 4 years ago
[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 90 Branch

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1704227#c11)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/3f0da71b532518202a0e79eb9b73efddeee9a712>

[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a1536005_75935)• 4 years ago |

[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected)
[tracking-firefox89](/buglist.cgi?f1=cf_tracking_firefox89&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox89&o1=equals&v1=%2B)
[tracking-firefox90](/buglist.cgi?f1=cf_tracking_firefox90&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox90&o1=equals&v1=%2B)

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a1734110_505306)• 4 years ago |

Crash Signature: [@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]

|  | [Andrew Osmond [:aosmond] (he/him)](/user_profile?user_id=505306)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1704227#c12)• 4 years ago |
|  | |

Comment on [attachment 9217909](/attachment.cgi?id=9217909 "Bug 1704227.") [[details]](/attachment.cgi?id=9217909&action=edit "Bug 1704227.")

[Bug 1704227](/show_bug.cgi?id=1704227 "RESOLVED FIXED - ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]").

### Beta/Release Uplift Approval Request

* **User impact if declined**: Potential vulnerability and related crash at low rates observed in the wild
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The scene builder thread is posting a message to the compositor thread to do some work. We just move more of the work to the compositor thread, which is normally where that sort of thing is done which by its very nature avoids all sorts of potential races.
* **String changes made/needed**:
[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: approval-mozilla-release?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1704227#c13)• 4 years ago |
|  | |

Comment on [attachment 9217909](/attachment.cgi?id=9217909 "Bug 1704227.") [[details]](/attachment.cgi?id=9217909&action=edit "Bug 1704227.")

[Bug 1704227](/show_bug.cgi?id=1704227 "RESOLVED FIXED - ThreadSanitizer: data race [@ mozilla::layers::WebRenderBridgeParent::ClearResources] vs. [@ mozilla::layers::CompositorBridgeParent::GetCompositorBridgeParentFromWindowId]").

Approved for 88.0.1.

[Attachment #9217909](/attachment.cgi?id=9217909&action=edit "Bug 1704227.") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1704227#c14)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/71818a6aa1fd>

[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix) → [fixed](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=fixed)
[tracking-firefox88](/buglist.cgi?f1=cf_tracking_firefox88&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox88&o1=equals&v1=%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a2130059_578488)• 4 years ago |

Alias: CVE-2021-29952

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a3448284_575867)• 4 years ago |

Crash Signature: [@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ] → [@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]
[@ core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete]
[@ wr\_api\_delete]

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a3587178_458186)• 4 years ago |

Crash Signature: [@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]
[@ core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete]
[@ wr\_api\_delete] → [@ core::ptr::drop\_in\_place<T> | core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete ]
[@ core::ptr::drop\_in\_place<T> | webrender\_bindings::bindings::wr\_api\_delete]
[@ wr\_api\_delete]QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1704227#a19639184_1689)• 3 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1704227&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_45a53195_20250114_203733.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-20

## Security Vulnerabilities fixed in Firefox 88.0.1, Firefox for Android 88.1.3

Announced
May 5, 2021
Impact
critical
Products
Firefox, Firefox for Android
Fixed in

* Firefox 88.0.1
* Firefox for Android 88.1.3

#### [#CVE-2021-29953: Universal Cross-Site Scripting via pop-up prompts](#CVE-2021-29953)

Reporter
Wladimir Palant working with Include Security
Impact
critical
##### Description

By triggering multiple pop-up prompts containing `javascript:` URLs, a malicious webpage could have forced a Firefox for Android user into executing attacker-controlled JavaScript in the context of another domain, resulting in a Universal Cross-Site Scripting vulnerability.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1701684](https://bugzilla.mozilla.org/show_bug.cgi?id=1701684)

#### [#CVE-2021-29952: Race condition in Web Render Components](#CVE-2021-29952)

Reporter
Tyson Smith
Impact
high
##### Description

When Web Render components were destructed, a race condition could have caused undefined behavior, and we presume that with enough effort may have been exploitable to run arbitrary code.

##### References

* [Bug 1704227](https://bugzilla.mozilla.org/show_bug.cgi?id=1704227)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


