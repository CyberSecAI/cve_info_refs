=== Content from git.kernel.org_e16db0e2_20250114_204821.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michael Braun <michael-dev@fami-braun.de> | 2021-03-04 20:52:52 +0100 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2021-03-05 13:13:32 -0800 |
| commit | [d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)) | |
| tree | [2e9d2ce85e8e2696b9018404cbdf16671dca7068](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f) | |
| parent | [155b23e6e53475ca3b8c2a946299b4d4dd6a5a1e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=155b23e6e53475ca3b8c2a946299b4d4dd6a5a1e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f&id2=155b23e6e53475ca3b8c2a946299b4d4dd6a5a1e)) | |
| download | [linux-d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f.tar.gz) | |

gianfar: fix jumbo packets+napi+rx overrun crashWhen using jumbo packets and overrunning rx queue with napi enabled,
the following sequence is observed in gfar\_add\_rx\_frag:
| lstatus | | skb |
t | lstatus, size, flags | first | len, data\_len, \*ptr |
---+--------------------------------------+-------+-----------------------+
13 | 18002348, 9032, INTERRUPT LAST | 0 | 9600, 8000, f554c12e |
12 | 10000640, 1600, INTERRUPT | 0 | 8000, 6400, f554c12e |
11 | 10000640, 1600, INTERRUPT | 0 | 6400, 4800, f554c12e |
10 | 10000640, 1600, INTERRUPT | 0 | 4800, 3200, f554c12e |
09 | 10000640, 1600, INTERRUPT | 0 | 3200, 1600, f554c12e |
08 | 14000640, 1600, INTERRUPT FIRST | 0 | 1600, 0, f554c12e |
07 | 14000640, 1600, INTERRUPT FIRST | 1 | 0, 0, f554c12e |
06 | 1c000080, 128, INTERRUPT LAST FIRST | 1 | 0, 0, abf3bd6e |
05 | 18002348, 9032, INTERRUPT LAST | 0 | 8000, 6400, c5a57780 |
04 | 10000640, 1600, INTERRUPT | 0 | 6400, 4800, c5a57780 |
03 | 10000640, 1600, INTERRUPT | 0 | 4800, 3200, c5a57780 |
02 | 10000640, 1600, INTERRUPT | 0 | 3200, 1600, c5a57780 |
01 | 10000640, 1600, INTERRUPT | 0 | 1600, 0, c5a57780 |
00 | 14000640, 1600, INTERRUPT FIRST | 1 | 0, 0, c5a57780 |
So at t=7 a new packets is started but not finished, probably due to rx
overrun - but rx overrun is not indicated in the flags. Instead a new
packets starts at t=8. This results in skb->len to exceed size for the LAST
fragment at t=13 and thus a negative fragment size added to the skb.
This then crashes:
kernel BUG at include/linux/skbuff.h:2277!
Oops: Exception in kernel mode, sig: 5 [#1]
...
NIP [c04689f4] skb\_pull+0x2c/0x48
LR [c03f62ac] gfar\_clean\_rx\_ring+0x2e4/0x844
Call Trace:
[ec4bfd38] [c06a84c4] \_raw\_spin\_unlock\_irqrestore+0x60/0x7c (unreliable)
[ec4bfda8] [c03f6a44] gfar\_poll\_rx\_sq+0x48/0xe4
[ec4bfdc8] [c048d504] \_\_napi\_poll+0x54/0x26c
[ec4bfdf8] [c048d908] net\_rx\_action+0x138/0x2c0
[ec4bfe68] [c06a8f34] \_\_do\_softirq+0x3a4/0x4fc
[ec4bfed8] [c0040150] run\_ksoftirqd+0x58/0x70
[ec4bfee8] [c0066ecc] smpboot\_thread\_fn+0x184/0x1cc
[ec4bff08] [c0062718] kthread+0x140/0x144
[ec4bff38] [c0012350] ret\_from\_kernel\_thread+0x14/0x1c
This patch fixes this by checking for computed LAST fragment size, so a
negative sized fragment is never added.
In order to prevent the newer rx frame from getting corrupted, the FIRST
flag is checked to discard the incomplete older frame.
Signed-off-by: Michael Braun <michael-dev@fami-braun.de>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)

| -rw-r--r-- | [drivers/net/ethernet/freescale/gianfar.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/gianfar.c?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/freescale/gianfar.c b/drivers/net/ethernet/freescale/gianfar.cindex 541de32ea6622e..1cf8ef717453dd 100644--- a/[drivers/net/ethernet/freescale/gianfar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/gianfar.c?id=155b23e6e53475ca3b8c2a946299b4d4dd6a5a1e)+++ b/[drivers/net/ethernet/freescale/gianfar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/gianfar.c?id=d8861bab48b6c1fc3cdbcab8ff9d1eaea43afe7f)@@ -2390,6 +2390,10 @@ static bool gfar\_add\_rx\_frag(struct gfar\_rx\_buff \*rxb, u32 lstatus, if (lstatus & BD\_LFLAG(RXBD\_LAST)) size -= skb->len; + WARN(size < 0, "gianfar: rx fragment size underflow");+ if (size < 0)+ return false;+ skb\_add\_rx\_frag(skb, skb\_shinfo(skb)->nr\_frags, page, rxb->page\_offset + RXBUF\_ALIGNMENT, size, GFAR\_RXB\_TRUESIZE);@@ -2552,6 +2556,17 @@ static int gfar\_clean\_rx\_ring(struct gfar\_priv\_rx\_q \*rx\_queue, if (lstatus & BD\_LFLAG(RXBD\_EMPTY)) break; + /\* lost RXBD\_LAST descriptor due to overrun \*/+ if (skb &&+ (lstatus & BD\_LFLAG(RXBD\_FIRST))) {+ /\* discard faulty buffer \*/+ dev\_kfree\_skb(skb);+ skb = NULL;+ rx\_queue->stats.rx\_dropped++;++ /\* can continue normally \*/+ }+ /\* order rx buffer descriptor reads \*/ rmb(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:46:58 +0000



=== Content from lists.debian.org_c7478d10_20250114_204822.html ===


---

[[Date Prev](msg00018.html)][[Date Next](msg00020.html)]
[[Thread Prev](msg00018.html)][[Thread Next](msg00020.html)]
[[Date Index](maillist.html#00019)]
[[Thread Index](threads.html#00019)]

# [SECURITY] [DLA 2690-1] linux-4.19 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2690-1] linux-4.19 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 23 Jun 2021 02:05:06 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YNJ6snBT8PswHq1D%40decadent.org.uk)Â [YNJ6snBT8PswHq1D@decadent.org.uk](msg00019.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2690-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
June 22, 2021                                 <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.194-1~deb9u1
CVE ID         : CVE-2020-24586 CVE-2020-24587 CVE-2020-24588 CVE-2020-25670
                 CVE-2020-25671 CVE-2020-25672 CVE-2020-26139 CVE-2020-26147
                 CVE-2020-26558 CVE-2020-29374 CVE-2021-0129 CVE-2021-3483
                 CVE-2021-3506 CVE-2021-3564 CVE-2021-3573 CVE-2021-3587
                 CVE-2021-23133 CVE-2021-23134 CVE-2021-28688 CVE-2021-28964
                 CVE-2021-28971 CVE-2021-29154 CVE-2021-29155 CVE-2021-29264
                 CVE-2021-29647 CVE-2021-29650 CVE-2021-31829 CVE-2021-31916
                 CVE-2021-32399 CVE-2021-33034
Debian Bug     : 986949 988352 989451

Several vulnerabilities have been discovered in the Linux kernel that
may lead to the execution of arbitrary code, privilege escalation,
denial of service, or information leaks.

CVE-2020-24586, CVE-2020-24587, CVE-2020-26147

    Mathy Vanhoef discovered that many Wi-Fi implementations,
    including Linux's mac80211, did not correctly implement reassembly
    of fragmented packets.  In some circumstances, an attacker within
    range of a network could exploit these flaws to forge arbitrary
    packets and/or to access sensitive data on that network.

CVE-2020-24588

    Mathy Vanhoef discovered that most Wi-Fi implementations,
    including Linux's mac80211, did not authenticate the "is
    aggregated" packet header flag.  An attacker within range of a
    network could exploit this to forge arbitrary packets on that
    network.

CVE-2020-25670, CVE-2020-25671, CVE-2021-23134

    kiyin (å°¹äº®) of TenCent discovered several reference counting bugs
    in the NFC LLCP implementation which could lead to use-after-free.
    A local user could exploit these for denial of service (crash or
    memory corruption) or possibly for privilege escalation.

    Nadav Markus and Or Cohen of Palo Alto Networks discovered that
    the original fixes for these introduced a new bug that could
    result in use-after-free and double-free.  This has also been
    fixed.

CVE-2020-25672

    kiyin (å°¹äº®) of TenCent discovered a memory leak in the NFC LLCP
    implementation.  A local user could exploit this for denial of
    service (memory exhaustion).

CVE-2020-26139

    Mathy Vanhoef discovered that a bug in some Wi-Fi implementations,
    including Linux's mac80211.  When operating in AP mode, they would
    forward EAPOL frames from one client to another while the sender
    was not yet authenticated.  An attacker within range of a network
    could use this for denial of service or as an aid to exploiting
    other vulnerabilities.

CVE-2020-26558, CVE-2021-0129

    Researchers at ANSSI discovered vulnerabilities in the Bluetooth
    Passkey authentication method, and in Linux's implementation of
    it.  An attacker within range of two Bluetooth devices while they
    pair using Passkey authentication could exploit this to obtain the
    shared secret (Passkey) and then impersonate either of the devices
    to each other.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

CVE-2021-3483

    é©¬å“²å®‡ (Zheyu Ma) reported a bug in the "nosy" driver for TI
    PCILynx FireWire controllers, which could lead to list corruption
    and a use-after-free.  On a system that uses this driver, local
    users granted access to /dev/nosy could exploit this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2021-3506

    The ADLab of venustech discovered a bug in the F2FS driver which
    could lead to an out-of-bounds read when accessing a crafted
    filesystem.  A local user permitted to mount arbitrary filesystems
    could exploit this to cause a denial of service (crash) or other
    security impact.

CVE-2021-3564, CVE-2021-3573, CVE-2021-32399

    The BlockSec team discovered several race conditions in the
    Bluetooth subsystem that could lead to a use-after-free or
    double-free.  A local user could exploit these to caue a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2021-3587

    Active Defense Lab of Venustech discovered a potential null
    pointer dereference in the NFC LLCP implementation.  A local user
    could use this to cause a denial of service (crash).

CVE-2021-23133

    Or Cohen of Palo Alto Networks discovered a race condition in the
    SCTP implementation, which can lead to list corruption.  A local
    user could exploit this to cause a denial of service (crash or
    memory corruption) or possibly for privilege escalation.

CVE-2021-28688 (XSA-371)

    It was discovered that the original fix for CVE-2021-26930
    (XSA-365) introduced a potential resource leak.  A malicious guest
    could presumably exploit this to cause a denial of service
    (resource exhaustion) within the host.

CVE-2021-28964

    Zygo Blaxell reported a race condition in the Btrfs driver which
    can lead to an assertion failure.  On systems using Btrfs, a local
    user could exploit this to cause a denial of service (crash).

CVE-2021-28971

    Vince Weaver reported a bug in the performance event handler for
    Intel PEBS.  A workaround for a hardware bug on Intel CPUs
    codenamed "Haswell" and earlier could lead to a null pointer
    dereference.  On systems with the affected CPUs, if users are
    permitted to access performance events, a local user may exploit
    this to cause a denial of service (crash).

    By default, unprivileged users do not have access to performance
    events, which mitigates this issue.  This is controlled by the
    kernel.perf_event_paranoid sysctl.

CVE-2021-29154

    It was discovered that the Extended BPF (eBPF) JIT compiler
    for x86_64 generated incorrect branch instructions in some
    cases.  On systems where eBPF JIT is enabled, users could
    exploit this to execute arbitrary code in the kernel.

    By default, eBPF JIT is disabled, mitigating this issue.  This is
    controlled by the net.core.bpf_jit_enable sysctl.

CVE-2021-29155, CVE-2021-31829

    Piotr Krysiuk and Benedict Schlueter discovered that the Extended
    BPF (eBPF) verifier did not completely protect against information
    leaks due to speculative execution.  A local user could exploit
    these to obtain sensitive information from kernel memory.

CVE-2021-29264

    It was discovered that the "gianfar" Ethernet driver used with
    some Freescale SoCs did not correctly handle a Rx queue overrun
    when jumbo packets were enabled.  On systems using this driver and
    jumbo packets, an attacker on the network could exploit this to
    cause a denial of service (crash).

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-29647

    The syzbot tool found an information leak in the Qualcomm IPC
    Router (qrtr) implementation.

    This protocol is not enabled in Debian's official kernel
    configurations.

CVE-2021-29650

    It was discovered that a data race in the netfilter subsystem
    could lead to a null pointer dereference during replacement of a
    table.  A local user with CAP_NET_ADMIN capability in any user
    namespace could use this to cause a denial of service (crash).

    By default, unprivileged users cannot create user namespaces,
    which mitigates this issue.  This is controlled by the
    kernel.unprivileged_userns_clone sysctl.

CVE-2021-31916

    Dan Carpenter reported incorrect parameter validation in the
    device-mapper (dm) subsystem, which could lead to a heap buffer
    overrun.  However, only users with CAP_SYS_ADMIN capability
    (i.e. root-equivalent) could trigger this bug, so it did not
    have any security impact in this kernel version.

CVE-2021-33034

    The syzbot tool found a bug in the Bluetooth subsystem that could
    lead to a use-after-free.  A local user could use this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

For Debian 9 stretch, these problems have been fixed in version
4.19.194-1~deb9u1.  This update additionally fixes Debian bug
#986949, #988352, and #989451; and includes many more bug fixes from
stable updates 4.19.182-4.19.194 inclusive.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-4.19>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgptr7vLkVKjA.pgp)**

*Description:* PGP signature

---


