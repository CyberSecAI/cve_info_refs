=== Content from security.gentoo.org_ffa2d904_20250114_185104.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202202-03**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-91.6.0:esr"

```

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-91.6.0:esr"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-97.0:rapid"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-97.0:rapid"

```
### References

* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29972](https://nvd.nist.gov/vuln/detail/CVE-2021-29972)
* [CVE-2021-29974](https://nvd.nist.gov/vuln/detail/CVE-2021-29974)
* [CVE-2021-29975](https://nvd.nist.gov/vuln/detail/CVE-2021-29975)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29977](https://nvd.nist.gov/vuln/detail/CVE-2021-29977)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29981](https://nvd.nist.gov/vuln/detail/CVE-2021-29981)
* [CVE-2021-29982](https://nvd.nist.gov/vuln/detail/CVE-2021-29982)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29987](https://nvd.nist.gov/vuln/detail/CVE-2021-29987)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-29990](https://nvd.nist.gov/vuln/detail/CVE-2021-29990)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38491](https://nvd.nist.gov/vuln/detail/CVE-2021-38491)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43540](https://nvd.nist.gov/vuln/detail/CVE-2021-43540)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0511](https://nvd.nist.gov/vuln/detail/CVE-2022-0511)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22753](https://nvd.nist.gov/vuln/detail/CVE-2022-22753)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22755](https://nvd.nist.gov/vuln/detail/CVE-2022-22755)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22757](https://nvd.nist.gov/vuln/detail/CVE-2022-22757)
* [CVE-2022-22758](https://nvd.nist.gov/vuln/detail/CVE-2022-22758)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22762](https://nvd.nist.gov/vuln/detail/CVE-2022-22762)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* MOZ-2021-0004
* MOZ-2021-0005
* MOZ-2021-0006
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

February 21, 2022

**Latest revision**

February 21, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [802768](https://bugs.gentoo.org/show_bug.cgi?id=802768)
* [807947](https://bugs.gentoo.org/show_bug.cgi?id=807947)
* [813498](https://bugs.gentoo.org/show_bug.cgi?id=813498)
* [821385](https://bugs.gentoo.org/show_bug.cgi?id=821385)
* [828538](https://bugs.gentoo.org/show_bug.cgi?id=828538)
* [831039](https://bugs.gentoo.org/show_bug.cgi?id=831039)
* [832992](https://bugs.gentoo.org/show_bug.cgi?id=832992)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_8a98e4d8_20250114_185107.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-35

## Security Vulnerabilities fixed in Thunderbird 78.13

Announced
August 10, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 78.13

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Thunderbird incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29989: Memory safety bugs fixed in Thunderbird 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Simon Giesecke, Sandor Molnar, and Olli Pettay reported memory safety bugs present in Thunderbird 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_795b7589_20250114_185107.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-34

## Security Vulnerabilities fixed in Firefox ESR 78.13

Announced
August 10, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 78.13

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Simon Giesecke, Sandor Molnar, and Olli Pettay reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_067c0658_20250114_185105.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Thunderbird: Multiple Vulnerabilities — GLSA **202208-14**

Multiple vulnerabilities have been found in Mozilla Thunderbird, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **91.12.0** |
| Unaffected versions | >= **91.12.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **91.12.0** |
| Unaffected versions | >= **91.12.0** |

### Background

Mozilla Thunderbird is a popular open-source email client from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Thunderbird. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-91.12.0"

```

All Mozilla Thunderbird binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-bin-91.12.0"

```
### References

* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-29967](https://nvd.nist.gov/vuln/detail/CVE-2021-29967)
* [CVE-2021-29969](https://nvd.nist.gov/vuln/detail/CVE-2021-29969)
* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38492](https://nvd.nist.gov/vuln/detail/CVE-2021-38492)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-40529](https://nvd.nist.gov/vuln/detail/CVE-2021-40529)
* [CVE-2021-43528](https://nvd.nist.gov/vuln/detail/CVE-2021-43528)
* [CVE-2021-43529](https://nvd.nist.gov/vuln/detail/CVE-2021-43529)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0566](https://nvd.nist.gov/vuln/detail/CVE-2022-0566)
* [CVE-2022-1196](https://nvd.nist.gov/vuln/detail/CVE-2022-1196)
* [CVE-2022-1197](https://nvd.nist.gov/vuln/detail/CVE-2022-1197)
* [CVE-2022-1520](https://nvd.nist.gov/vuln/detail/CVE-2022-1520)
* [CVE-2022-1529](https://nvd.nist.gov/vuln/detail/CVE-2022-1529)
* [CVE-2022-1802](https://nvd.nist.gov/vuln/detail/CVE-2022-1802)
* [CVE-2022-1834](https://nvd.nist.gov/vuln/detail/CVE-2022-1834)
* [CVE-2022-2200](https://nvd.nist.gov/vuln/detail/CVE-2022-2200)
* [CVE-2022-2226](https://nvd.nist.gov/vuln/detail/CVE-2022-2226)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* [CVE-2022-24713](https://nvd.nist.gov/vuln/detail/CVE-2022-24713)
* [CVE-2022-26381](https://nvd.nist.gov/vuln/detail/CVE-2022-26381)
* [CVE-2022-26383](https://nvd.nist.gov/vuln/detail/CVE-2022-26383)
* [CVE-2022-26384](https://nvd.nist.gov/vuln/detail/CVE-2022-26384)
* [CVE-2022-26386](https://nvd.nist.gov/vuln/detail/CVE-2022-26386)
* [CVE-2022-26387](https://nvd.nist.gov/vuln/detail/CVE-2022-26387)
* [CVE-2022-26485](https://nvd.nist.gov/vuln/detail/CVE-2022-26485)
* [CVE-2022-26486](https://nvd.nist.gov/vuln/detail/CVE-2022-26486)
* [CVE-2022-28281](https://nvd.nist.gov/vuln/detail/CVE-2022-28281)
* [CVE-2022-28282](https://nvd.nist.gov/vuln/detail/CVE-2022-28282)
* [CVE-2022-28285](https://nvd.nist.gov/vuln/detail/CVE-2022-28285)
* [CVE-2022-28286](https://nvd.nist.gov/vuln/detail/CVE-2022-28286)
* [CVE-2022-28289](https://nvd.nist.gov/vuln/detail/CVE-2022-28289)
* [CVE-2022-29909](https://nvd.nist.gov/vuln/detail/CVE-2022-29909)
* [CVE-2022-29911](https://nvd.nist.gov/vuln/detail/CVE-2022-29911)
* [CVE-2022-29912](https://nvd.nist.gov/vuln/detail/CVE-2022-29912)
* [CVE-2022-29913](https://nvd.nist.gov/vuln/detail/CVE-2022-29913)
* [CVE-2022-29914](https://nvd.nist.gov/vuln/detail/CVE-2022-29914)
* [CVE-2022-29916](https://nvd.nist.gov/vuln/detail/CVE-2022-29916)
* [CVE-2022-29917](https://nvd.nist.gov/vuln/detail/CVE-2022-29917)
* [CVE-2022-31736](https://nvd.nist.gov/vuln/detail/CVE-2022-31736)
* [CVE-2022-31737](https://nvd.nist.gov/vuln/detail/CVE-2022-31737)
* [CVE-2022-31738](https://nvd.nist.gov/vuln/detail/CVE-2022-31738)
* [CVE-2022-31740](https://nvd.nist.gov/vuln/detail/CVE-2022-31740)
* [CVE-2022-31741](https://nvd.nist.gov/vuln/detail/CVE-2022-31741)
* [CVE-2022-31742](https://nvd.nist.gov/vuln/detail/CVE-2022-31742)
* [CVE-2022-31747](https://nvd.nist.gov/vuln/detail/CVE-2022-31747)
* [CVE-2022-34468](https://nvd.nist.gov/vuln/detail/CVE-2022-34468)
* [CVE-2022-34470](https://nvd.nist.gov/vuln/detail/CVE-2022-34470)
* [CVE-2022-34472](https://nvd.nist.gov/vuln/detail/CVE-2022-34472)
* [CVE-2022-34478](https://nvd.nist.gov/vuln/detail/CVE-2022-34478)
* [CVE-2022-34479](https://nvd.nist.gov/vuln/detail/CVE-2022-34479)
* [CVE-2022-34481](https://nvd.nist.gov/vuln/detail/CVE-2022-34481)
* [CVE-2022-34484](https://nvd.nist.gov/vuln/detail/CVE-2022-34484)
* [CVE-2022-36318](https://nvd.nist.gov/vuln/detail/CVE-2022-36318)
* [CVE-2022-36319](https://nvd.nist.gov/vuln/detail/CVE-2022-36319)
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

August 10, 2022

**Latest revision**

August 10, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [794085](https://bugs.gentoo.org/show_bug.cgi?id=794085)
* [802759](https://bugs.gentoo.org/show_bug.cgi?id=802759)
* [807943](https://bugs.gentoo.org/show_bug.cgi?id=807943)
* [811912](https://bugs.gentoo.org/show_bug.cgi?id=811912)
* [813501](https://bugs.gentoo.org/show_bug.cgi?id=813501)
* [822294](https://bugs.gentoo.org/show_bug.cgi?id=822294)
* [828539](https://bugs.gentoo.org/show_bug.cgi?id=828539)
* [831040](https://bugs.gentoo.org/show_bug.cgi?id=831040)
* [833520](https://bugs.gentoo.org/show_bug.cgi?id=833520)
* [834805](https://bugs.gentoo.org/show_bug.cgi?id=834805)
* [845057](https://bugs.gentoo.org/show_bug.cgi?id=845057)
* [846596](https://bugs.gentoo.org/show_bug.cgi?id=846596)
* [849047](https://bugs.gentoo.org/show_bug.cgi?id=849047)
* [857048](https://bugs.gentoo.org/show_bug.cgi?id=857048)
* [864577](https://bugs.gentoo.org/show_bug.cgi?id=864577)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_6b3ff753_20250114_185108.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-36

## Security Vulnerabilities fixed in Thunderbird 91

Announced
August 11, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Thunderbird incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Thunderbird on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Thunderbird 91](#CVE-2021-29989)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Kershaw Chang, Philipp, Chris Peterson, Sebastian Hengst, Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in versions of Thunderbird prior to 91. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568%2C1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_f57b09b6_20250114_185104.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1722083)
* [XML](/show_bug.cgi?ctype=xml&id=1722083)

Closed
[Bug 1722083](/show_bug.cgi?id=1722083)
(CVE-2021-29985)

Opened 3 years ago
Closed 3 years ago

# TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability

## Categories

### (Core :: Audio/Video: Playback, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Audio%2FVideo%3A%20Playback#Audio%2FVideo%3A%20Playback)

Audio/Video: Playback
▾

Core :: Audio/Video: Playback
For problems related to the HTML 5 media elements (<video> and <audio>) -- including WebM, MP4, MSE and EME issues. This would also typically include decoding problems in the codecs themselves (e.g. VP8, VP9, H.264, AAC) experienced during playback.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Audio%2FVideo%3A%20Playback)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 90

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

92 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | [91+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=91%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) |
| firefox-esr91 | [91+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=91%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox90 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix) |
| firefox91 | [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) |
| firefox92 | [+](/buglist.cgi?f1=cf_tracking_firefox92&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 | 91+ | fixed |
| firefox-esr91 |  | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox90 |  | wontfix |
| firefox91 | + | fixed |
| firefox92 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: vulndiscovery, Assigned: alwu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/9f64a3c43c01820fd6be6b1ee3f326e1?d=mm&size=40)  [alwu](/user_profile?user_id=517691)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/939ae6595bc5f16958e98c866d571f81?d=mm&size=40)  [vulndiscovery](/user_profile?user_id=689405)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, sec-moderate, Whiteboard: [adv-main91+][adv-esr78.13+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29985

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main91+][adv-esr78.13+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [noni](/user_profile?user_id=458186) | [qe-verify](#a1162936_458186 "3 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 2 obsolete files)

| [UAF\_StreamBuffering.zip](/attachment.cgi?id=9232904)  [3 years ago](#c0)  [Cisco Talos](/user_profile?user_id=689405)   512.09 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9232904&action=edit) |
| --- | --- | --- |
| [TALOS-2021-1345 - Mozilla\_Firefox\_MediaCacheStream NotifyDataReceived\_use-after-free\_vulnerability.txt](/attachment.cgi?id=9232905)  [3 years ago](#c1)  [Cisco Talos](/user_profile?user_id=689405)   33.95 KB, text/plain |  | [Details](/attachment.cgi?id=9232905&action=edit) |
| [UAF\_StreamBuffering\_final.zip](/attachment.cgi?id=9233516)  [3 years ago](#c6)  [Cisco Talos](/user_profile?user_id=689405)   784.97 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9233516&action=edit) |
| [Bug 1722083 - revoke the listener first.](/attachment.cgi?id=9234720)  [3 years ago](#c17)  [Alastor Wu [:alwu]](/user_profile?user_id=517691)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-release+](#c24 "3 years ago")  RyanVM : [approval-mozilla-esr78+](#c24 "3 years ago")  RyanVM : [approval-mozilla-esr91+](#c24 "3 years ago") | [Details](/attachment.cgi?id=9234720&action=edit) | [Review](/attachment.cgi?id=9234720) |
| [advisory.txt](/attachment.cgi?id=9235155)  [3 years ago](#c27)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   188 bytes, text/plain |  | [Details](/attachment.cgi?id=9235155&action=edit) |
| [advisory.txt](/attachment.cgi?id=9235168)  [3 years ago](#c28)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   192 bytes, text/plain |  | [Details](/attachment.cgi?id=9235168&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1722083#c0)• 3 years ago |
|  | |

Attached file
[UAF\_StreamBuffering.zip](attachment.cgi?id=9232904) (obsolete)
— [Details](attachment.cgi?id=9232904&action=edit)

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0

Steps to reproduce:

None (published patch date)

TALOS-2021-1345

Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability

### Summary

An potential remote code execution vulnerability exists in the MediaCacheStream::NotifyDataReceived method of Mozilla Firefox 89.0.3 x64. A specially crafted web page can cause a use-after-free vulnerability potentially resulting in a code execution. A victim needs to visit a malicious webpage to trigger this vulnerability.

### Tested Versions

Mozilla Firefox Mozilla Firefox 89.0.3 x64

### Product URLs

<https://www.mozilla.org/en-US/firefox/new>

### CVSSv3 Score

8.8 - CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### CWE

CWE-416 - Use After Free

### Details

Mozilla Firefox is one of the most popular web browsers on the world available for a variety of the different platforms : Windows, Linux, OSX, Android and more. Its active development ensure support for the newest web technologies like HTML5 or CSS3.

This vulnerability is related with the `nsBufferedStream` component which is part of the `Stream buffering` functionality.

A malicious web page can lead to a race condition situation which can cause a use-after-free vulnerability and potential remote code execution.

Tracking an `nsBufferedStream` object life cycle we can notice that there is an allocation made :

```
previously allocated by thread T0 (Web Content) here:
	#0 0x55eb6b69ca7d in malloc /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3
	#1 0x7f031b4f9e2e in operator new[] /builds/worker/workspace/obj-build/dist/include/mozilla/cxxalloc.h:47:10
	#2 0x7f031b4f9e2e in nsBufferedStream::Init(nsISupports*, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:73:13
	#3 0x7f031b4fc05c in nsBufferedInputStream::Init(nsIInputStream*, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:335:35
	#4 0x7f031b5303ba in NS_NewBufferedInputStream(nsIInputStream**, already_AddRefed<nsIInputStream>, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsNetUtil.cpp:1330:14
	#5 0x7f031b52c483 in nsInputStreamPump::CreateBufferedStreamIfNeeded() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:672:17
	#6 0x7f031b52c0c8 in nsInputStreamPump::PeekStream(void (*)(void*, unsigned char const*, unsigned int), void*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:94:17
	#7 0x7f031b4ed088 in nsBaseChannel::OnStartRequest(nsIRequest*) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:827:14
	#8 0x7f031b52ec0e in nsInputStreamPump::OnStateStart() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:481:21
	#9 0x7f031b52e337 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:390:21
	#10 0x7f03208e4d63 in mozilla::dom::BlobURLInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/dom/file/uri/BlobURLInputStream.cpp:271:20
	#11 0x7f03208d8f84 in mozilla::(anonymous namespace)::InputStreamCallbackRunnable::Run() /builds/worker/checkouts/gecko/dom/file/ipc/RemoteLazyInputStream.cpp:54:16
	#12 0x7f031b2439cc in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
	#13 0x7f031b24d16a in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:473:16
	#14 0x7f031b24a4f8 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:757:26
	#15 0x7f031b248837 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:612:15
	#16 0x7f031b248c8d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:396:36
	#17 0x7f031b253471 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
	#18 0x7f031b253471 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_3>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
	#19 0x7f031b26cb31 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1155:16
	#20 0x7f031b27649c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
	#21 0x7f031c44968f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:87:21

```

Which is caused by a call to `URL.createObjectURL` inside the `MediaRecorder_onstop` event handler:

```
Line 1	function MediaRecorder_onstop(e)
Line 2	{
Line 3		let blob = new Blob(chunks,{ 'type' : 'audio/ogg; codecs=opus' });
Line 4		audioElement.src = URL.createObjectURL(blob);
Line 5		audioElement.play();
Line 6	}

```

Further this `nsBufferedStream` object gets deallocated:

```
0x62100323e900 is located 0 bytes inside of 4096-byte region [0x62100323e900,0x62100323f900)
freed by thread T0 (Web Content) here:
	#0 0x55eb6b69c7fd in free /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:123:3
	#1 0x7f031b4f9bbd in operator delete[] /builds/worker/workspace/obj-build/dist/include/mozilla/cxxalloc.h:60:10
	#2 0x7f031b4f9bbd in nsBufferedStream::Close() /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:84:5
	#3 0x7f031b4fec52 in Close /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:391:21
	#4 0x7f031b4fec52 in CloseWithStatus /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:671:67
	#5 0x7f031b4fec52 in non-virtual thunk to nsBufferedInputStream::CloseWithStatus(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp
	#6 0x7f031b52d41d in nsInputStreamPump::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:210:19
	#7 0x7f031b4e9618 in nsBaseChannel::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:399:15
	#8 0x7f031b4e968c in non-virtual thunk to nsBaseChannel::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp
	#9 0x7f0320bec2bd in mozilla::ChannelMediaResource::CloseChannel() /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:631:15
	#10 0x7f0320befe92 in mozilla::ChannelMediaResource::Close() /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:575:5
	#11 0x7f0320be55ef in mozilla::ChannelMediaDecoder::Shutdown() /builds/worker/checkouts/gecko/dom/media/ChannelMediaDecoder.cpp:224:40
	#12 0x7f0320a2d7c0 in mozilla::dom::HTMLMediaElement::ShutdownDecoder() /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:2206:13
	#13 0x7f0320a4ba06 in mozilla::dom::HTMLMediaElement::~HTMLMediaElement() /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:4208:5
	#14 0x7f032097ca0d in mozilla::dom::HTMLAudioElement::~HTMLAudioElement() /builds/worker/checkouts/gecko/dom/html/HTMLAudioElement.cpp:58:1
	#15 0x7f031e5e92fd in nsIContent::Destroy() /builds/worker/checkouts/gecko/dom/base/FragmentOrElement.cpp:150:1
	#16 0x7f031b0bef72 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2417:7
	#17 0x7f031b0bd73b in nsPurpleBuffer::RemoveSkippable(nsCycleCollector*, js::SliceBudget&, bool, bool, void (*)()) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2585:1
	#18 0x7f031b0bf79f in nsCycleCollector::ForgetSkippable(js::SliceBudget&, bool, bool) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2653:14
	#19 0x7f031b0c7f6d in nsCycleCollector_forgetSkippable(js::SliceBudget&, bool, bool) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:3865:21
	#20 0x7f031e816e79 in FireForgetSkippable(bool, mozilla::TimeStamp) /builds/worker/checkouts/gecko/dom/base/nsJSEnvironment.cpp:1141:3
	#21 0x7f031e81831c in CCRunnerFired(mozilla::TimeStamp) /builds/worker/checkouts/gecko/dom/base/nsJSEnvironment.cpp:1644:9
	#22 0x7f031b2364ea in operator() /builds/worker/fetches/clang/bin/../lib/gcc/x86_64-unknown-linux-gnu/7.4.0/../../../../include/c++/7.4.0/bits/std_function.h:706:14
	#23 0x7f031b2364ea in mozilla::IdleTaskRunner::Run() /builds/worker/checkouts/gecko/xpcom/threads/IdleTaskRunner.cpp:109:14

```

Notice that `nsBufferedStream` gets deallocated through the `HTMLAudioElement` element destruction (`audioElement` in our code) which might by triggered by one of our fuzzing fuctions or "page switch/reload".

Because of bad referencing handling the `nsBufferedStream` object gets reused during the `mozilla::MediaCacheStream::NotifyDataReceived` method call:

```
==54405==ERROR: AddressSanitizer: heap-use-after-free on address 0x62100323e900 at pc 0x55eb6b69bed7 bp 0x7f03072b6a70 sp 0x7f03072b6238
READ of size 4096 at 0x62100323e900 thread T22 (MediaCache)
	#0 0x55eb6b69bed6 in __asan_memcpy /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:22:3
	#1 0x7f0320c6d37c in mozilla::MediaCacheStream::NotifyDataReceived(unsigned int, unsigned int, unsigned char const*) /builds/worker/checkouts/gecko/dom/media/MediaCache.cpp:2027:7
	#2 0x7f0320bee366 in mozilla::ChannelMediaResource::CopySegmentToCache(nsIInputStream*, void*, char const*, unsigned int, unsigned int, unsigned int*) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:409:18
	#3 0x7f031b4fd0ae in nsBufferedInputStream::ReadSegments(nsresult (*)(nsIInputStream*, void*, char const*, unsigned int, unsigned int, unsigned int*), void*, unsigned int, unsigned int*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:453:12
	#4 0x7f0320bebad5 in OnDataAvailable /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:437:18
	#5 0x7f0320bebad5 in mozilla::ChannelMediaResource::Listener::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:84:21
	#6 0x7f031b4ee028 in nsBaseChannel::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:872:28
	#7 0x7f031b52f2fb in nsInputStreamPump::OnStateTransfer() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:548:23
	#8 0x7f031b52e347 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:393:21
	#9 0x7f031b4ff23b in nsBufferedInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:724:20
	#10 0x7f03208e4d63 in mozilla::dom::BlobURLInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/dom/file/uri/BlobURLInputStream.cpp:271:20
	#11 0x7f03208d8f84 in mozilla::(anonymous namespace)::InputStreamCallbackRunnable::Run() /builds/worker/checkouts/gecko/dom/file/ipc/RemoteLazyInputStream.cpp:54:16
	#12 0x7f031b26d379 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1149:16
	#13 0x7f031b27649c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
	#14 0x7f031c44ac0a in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:302:20
	#15 0x7f031c35ff11 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:335:10
	#16 0x7f031c35ff11 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:328:3
	#17 0x7f031c35ff11 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:310:3
	#18 0x7f031b267c59 in nsThread::ThreadFunc(void*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:391:10
	#19 0x7f03373bb28e in _pt_root /builds/worker/checkouts/gecko/nsprpub/pr/src/pthreads/ptthread.c:201:5
	#20 0x7f033acc158f in start_thread nptl/pthread_create.c:463:8
	#21 0x7f033a889222 in clone misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95

```

Proper heap grooming can give an attacker full control of this use-after-free vulnerability and as a result could allow it to be turned into arbitrary code execution.

### Crash Information

[ 4:29:44 AM ] :: AudioBufferSourceNode\_handler

[ 4:29:44 AM ] :: MediaStreamAudioDestinationNode\_handler

[ 4:29:44 AM ] :: Before setTimeout

[ 4:29:44 AM ] :: SEED g\_mainRandom: 2102332452

[ 4:29:45 AM ] :: Its fuzzing time!!!!

[ 4:29:45 AM ] :: SEED : g\_fuzzRandom : 146570576

[ 4:29:45 AM ] :: [fuzz\_nodes] :: Amount of mutation : 1

[ 4:29:45 AM ] :: Chosen function : fuzz\_deleteHTMLElement

[ 4:29:45 AM ] :: ()=>{ document.querySelector("audio").src = document.querySelector("audio").src; }

[ 4:29:46 AM ] :: MediaRecorder\_ondataavailable

[ 4:29:46 AM ] :: Its fuzzing time!!!!

[ 4:29:46 AM ] :: SEED : g\_fuzzRandom : 650240019

[ 4:29:46 AM ] :: [fuzz\_nodes] :: Amount of mutation : 1

[ 4:29:46 AM ] :: Chosen function : fuzz\_spin

[ 4:29:46 AM ] :: MediaRecorder\_ondataavailable

[ 4:29:46 AM ] :: Its fuzzing time!!!!

[ 4:29:46 AM ] :: SEED : g\_fuzzRandom : 1849907680

[ 4:29:46 AM ] :: [fuzz\_nodes] :: Amount of mutation : 1

[ 4:29:46 AM ] :: Chosen function : fuzz\_deleteHTMLElement

[ 4:29:46 AM ] :: ()=>{ document.body.removeChild(document.querySelector("audio")) }

[ 4:29:46 AM ] :: MediaRecorder\_onstop

[ 4:29:46 AM ] :: Its fuzzing time!!!!

[ 4:29:46 AM ] :: SEED : g\_fuzzRandom : 1240099704

[ 4:29:46 AM ] :: [fuzz\_nodes] :: Amount of mutation : 3

[ 4:29:46 AM ] :: Chosen function : fuzz\_deleteRandomNode

[ 4:29:46 AM ] :: Deleting object : AudioBufferSourceNode

[ 4:29:46 AM ] :: Chosen function : fuzz\_spin

[ 4:29:46 AM ] :: eventhandler5

[ 4:29:46 AM ] :: [5] Caller name : fuzz\_spin

[ 4:29:46 AM ] :: [object Event]

[ 4:29:46 AM ] :: ended

[ 4:29:47 AM ] :: Chosen function : fuzz\_deleteHTMLElement

[ 4:29:47 AM ] :: ()=>{ document.querySelector("audio").src = randStr(); }

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler5

[ 4:29:47 AM ] :: [object AnimationPlaybackEvent]

[ 4:29:47 AM ] :: finish

[ 4:29:47 AM ] :: eventhandler2

[ 4:29:47 AM ] :: [object IntersectionObserverEntry]

[ 4:29:47 AM ] :: undefined

[ 4:29:47 AM ] :: eventhandler2

(....)

```
==54405==ERROR: AddressSanitizer: heap-use-after-free on address 0x62100323e900 at pc 0x55eb6b69bed7 bp 0x7f03072b6a70 sp 0x7f03072b6238
READ of size 4096 at 0x62100323e900 thread T22 (MediaCache)
	#0 0x55eb6b69bed6 in __asan_memcpy /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:22:3
	#1 0x7f0320c6d37c in mozilla::MediaCacheStream::NotifyDataReceived(unsigned int, unsigned int, unsigned char const*) /builds/worker/checkouts/gecko/dom/media/MediaCache.cpp:2027:7
	#2 0x7f0320bee366 in mozilla::ChannelMediaResource::CopySegmentToCache(nsIInputStream*, void*, char const*, unsigned int, unsigned int, unsigned int*) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:409:18
	#3 0x7f031b4fd0ae in nsBufferedInputStream::ReadSegments(nsresult (*)(nsIInputStream*, void*, char const*, unsigned int, unsigned int, unsigned int*), void*, unsigned int, unsigned int*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:453:12
	#4 0x7f0320bebad5 in OnDataAvailable /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:437:18
	#5 0x7f0320bebad5 in mozilla::ChannelMediaResource::Listener::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:84:21
	#6 0x7f031b4ee028 in nsBaseChannel::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:872:28
	#7 0x7f031b52f2fb in nsInputStreamPump::OnStateTransfer() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:548:23
	#8 0x7f031b52e347 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:393:21
	#9 0x7f031b4ff23b in nsBufferedInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:724:20
	#10 0x7f03208e4d63 in mozilla::dom::BlobURLInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/dom/file/uri/BlobURLInputStream.cpp:271:20
	#11 0x7f03208d8f84 in mozilla::(anonymous namespace)::InputStreamCallbackRunnable::Run() /builds/worker/checkouts/gecko/dom/file/ipc/RemoteLazyInputStream.cpp:54:16
	#12 0x7f031b26d379 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1149:16
	#13 0x7f031b27649c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
	#14 0x7f031c44ac0a in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:302:20
	#15 0x7f031c35ff11 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:335:10
	#16 0x7f031c35ff11 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:328:3
	#17 0x7f031c35ff11 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:310:3
	#18 0x7f031b267c59 in nsThread::ThreadFunc(void*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:391:10
	#19 0x7f03373bb28e in _pt_root /builds/worker/checkouts/gecko/nsprpub/pr/src/pthreads/ptthread.c:201:5
	#20 0x7f033acc158f in start_thread nptl/pthread_create.c:463:8
	#21 0x7f033a889222 in clone misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95

0x62100323e900 is located 0 bytes inside of 4096-byte region [0x62100323e900,0x62100323f900)
freed by thread T0 (Web Content) here:
	#0 0x55eb6b69c7fd in free /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:123:3
	#1 0x7f031b4f9bbd in operator delete[] /builds/worker/workspace/obj-build/dist/include/mozilla/cxxalloc.h:60:10
	#2 0x7f031b4f9bbd in nsBufferedStream::Close() /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:84:5
	#3 0x7f031b4fec52 in Close /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:391:21
	#4 0x7f031b4fec52 in CloseWithStatus /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:671:67
	#5 0x7f031b4fec52 in non-virtual thunk to nsBufferedInputStream::CloseWithStatus(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp
	#6 0x7f031b52d41d in nsInputStreamPump::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:210:19
	#7 0x7f031b4e9618 in nsBaseChannel::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:399:15
	#8 0x7f031b4e968c in non-virtual thunk to nsBaseChannel::Cancel(nsresult) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp
	#9 0x7f0320bec2bd in mozilla::ChannelMediaResource::CloseChannel() /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:631:15
	#10 0x7f0320befe92 in mozilla::ChannelMediaResource::Close() /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:575:5
	#11 0x7f0320be55ef in mozilla::ChannelMediaDecoder::Shutdown() /builds/worker/checkouts/gecko/dom/media/ChannelMediaDecoder.cpp:224:40
	#12 0x7f0320a2d7c0 in mozilla::dom::HTMLMediaElement::ShutdownDecoder() /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:2206:13
	#13 0x7f0320a4ba06 in mozilla::dom::HTMLMediaElement::~HTMLMediaElement() /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:4208:5
	#14 0x7f032097ca0d in mozilla::dom::HTMLAudioElement::~HTMLAudioElement() /builds/worker/checkouts/gecko/dom/html/HTMLAudioElement.cpp:58:1
	#15 0x7f031e5e92fd in nsIContent::Destroy() /builds/worker/checkouts/gecko/dom/base/FragmentOrElement.cpp:150:1
	#16 0x7f031b0bef72 in SnowWhiteKiller::~SnowWhiteKiller() /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2417:7
	#17 0x7f031b0bd73b in nsPurpleBuffer::RemoveSkippable(nsCycleCollector*, js::SliceBudget&, bool, bool, void (*)()) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2585:1
	#18 0x7f031b0bf79f in nsCycleCollector::ForgetSkippable(js::SliceBudget&, bool, bool) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:2653:14
	#19 0x7f031b0c7f6d in nsCycleCollector_forgetSkippable(js::SliceBudget&, bool, bool) /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:3865:21
	#20 0x7f031e816e79 in FireForgetSkippable(bool, mozilla::TimeStamp) /builds/worker/checkouts/gecko/dom/base/nsJSEnvironment.cpp:1141:3
	#21 0x7f031e81831c in CCRunnerFired(mozilla::TimeStamp) /builds/worker/checkouts/gecko/dom/base/nsJSEnvironment.cpp:1644:9
	#22 0x7f031b2364ea in operator() /builds/worker/fetches/clang/bin/../lib/gcc/x86_64-unknown-linux-gnu/7.4.0/../../../../include/c++/7.4.0/bits/std_function.h:706:14
	#23 0x7f031b2364ea in mozilla::IdleTaskRunner::Run() /builds/worker/checkouts/gecko/xpcom/threads/IdleTaskRunner.cpp:109:14

previously allocated by thread T0 (Web Content) here:
	#0 0x55eb6b69ca7d in malloc /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3
	#1 0x7f031b4f9e2e in operator new[] /builds/worker/workspace/obj-build/dist/include/mozilla/cxxalloc.h:47:10
	#2 0x7f031b4f9e2e in nsBufferedStream::Init(nsISupports*, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:73:13
	#3 0x7f031b4fc05c in nsBufferedInputStream::Init(nsIInputStream*, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:335:35
	#4 0x7f031b5303ba in NS_NewBufferedInputStream(nsIInputStream**, already_AddRefed<nsIInputStream>, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsNetUtil.cpp:1330:14
	#5 0x7f031b52c483 in nsInputStreamPump::CreateBufferedStreamIfNeeded() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:672:17
	#6 0x7f031b52c0c8 in nsInputStreamPump::PeekStream(void (*)(void*, unsigned char const*, unsigned int), void*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:94:17
	#7 0x7f031b4ed088 in nsBaseChannel::OnStartRequest(nsIRequest*) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:827:14
	#8 0x7f031b52ec0e in nsInputStreamPump::OnStateStart() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:481:21
	#9 0x7f031b52e337 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:390:21
	#10 0x7f03208e4d63 in mozilla::dom::BlobURLInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/dom/file/uri/BlobURLInputStream.cpp:271:20
	#11 0x7f03208d8f84 in mozilla::(anonymous namespace)::InputStreamCallbackRunnable::Run() /builds/worker/checkouts/gecko/dom/file/ipc/RemoteLazyInputStream.cpp:54:16
	#12 0x7f031b2439cc in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
	#13 0x7f031b24d16a in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:473:16
	#14 0x7f031b24a4f8 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:757:26
	#15 0x7f031b248837 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:612:15
	#16 0x7f031b248c8d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:396:36
	#17 0x7f031b253471 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:37
	#18 0x7f031b253471 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_3>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
	#19 0x7f031b26cb31 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1155:16
	#20 0x7f031b27649c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
	#21 0x7f031c44968f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:87:21

Thread T22 (MediaCache) created by T0 (Web Content) here:
	#0 0x55eb6b6874ea in pthread_create /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cpp:214:3
	#1 0x7f03373ab5b4 in _PR_CreateThread /builds/worker/checkouts/gecko/nsprpub/pr/src/pthreads/ptthread.c:458:14
	#2 0x7f033739c66e in PR_CreateThread /builds/worker/checkouts/gecko/nsprpub/pr/src/pthreads/ptthread.c:533:12
	#3 0x7f031b26a09c in nsThread::Init(nsTSubstring<char> const&) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:609:18
	#4 0x7f031b2741b8 in nsThreadManager::NewNamedThread(nsTSubstring<char> const&, unsigned int, nsIThread**) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadManager.cpp:555:12
	#5 0x7f031b27e421 in NS_NewNamedThread(nsTSubstring<char> const&, nsIThread**, already_AddRefed<nsIRunnable>, unsigned int) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:169:57
	#6 0x7f0320c6181d in NS_NewNamedThread<11> /builds/worker/workspace/obj-build/dist/include/nsThreadUtils.h:85:10
	#7 0x7f0320c6181d in mozilla::MediaCache::GetMediaCache(long, bool) /builds/worker/checkouts/gecko/dom/media/MediaCache.cpp:761:19
	#8 0x7f0320c738a0 in mozilla::MediaCacheStream::Init(long) /builds/worker/checkouts/gecko/dom/media/MediaCache.cpp:2675:17
	#9 0x7f0320bef521 in mozilla::ChannelMediaResource::Open(nsIStreamListener**) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:500:30
	#10 0x7f0320be5fac in mozilla::ChannelMediaDecoder::Load(nsIChannel*, bool, nsIStreamListener**) /builds/worker/checkouts/gecko/dom/media/ChannelMediaDecoder.cpp:260:19
	#11 0x7f0320a526cb in nsresult mozilla::dom::HTMLMediaElement::SetupDecoder<mozilla::ChannelMediaDecoder, nsIChannel*&, bool&, nsIStreamListener**&>(mozilla::ChannelMediaDecoder*, nsIChannel*&, bool&, nsIStreamListener**&) /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:4844:27
	#12 0x7f0320a264cd in mozilla::dom::HTMLMediaElement::InitializeDecoderForChannel(nsIChannel*, nsIStreamListener**) /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:4927:10
	#13 0x7f0320a249ab in mozilla::dom::HTMLMediaElement::MediaLoadListener::OnStartRequest(nsIRequest*) /builds/worker/checkouts/gecko/dom/html/HTMLMediaElement.cpp:1320:7
	#14 0x7f031be4e996 in mozilla::net::HttpChannelChild::DoOnStartRequest(nsIRequest*, nsISupports*) /builds/worker/checkouts/gecko/netwerk/protocol/http/HttpChannelChild.cpp:594:20
	#15 0x7f031be4d89f in mozilla::net::HttpChannelChild::OnStartRequest(mozilla::net::nsHttpResponseHead const&, bool const&, mozilla::net::nsHttpHeaderArray const&, mozilla::net::HttpChannelOnStartRequestArgs const&) /builds/worker/checkouts/gecko/netwerk/protocol/http/HttpChannelChild.cpp:525:3
	#16 0x7f031c136cd5 in mozilla::net::ChannelEventQueue::FlushQueue() /builds/worker/checkouts/gecko/netwerk/ipc/ChannelEventQueue.cpp:90:12
	#17 0x7f031c183537 in mozilla::net::ChannelEventQueue::ResumeInternal()::CompleteResumeRunnable::Run() /builds/worker/checkouts/gecko/netwerk/ipc/ChannelEventQueue.cpp:148:17
	#18 0x7f031b2439cc in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/checkouts/gecko/xpcom/threads/SchedulerGroup.cpp:143:20
	#19 0x7f031b24d16a in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:473:16
	#20 0x7f031b24a4f8 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:757:26
	#21 0x7f031b248837 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:612:15
	#22 0x7f031b248c8d in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:396:36
	#23 0x7f031b2534a4 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:138:37
	#24 0x7f031b2534a4 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_4>::Run() /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:534:5
	#25 0x7f031b26cb31 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1155:16
	#26 0x7f031b27649c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:548:10
	#27 0x7f031c449684 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:109:5
	#28 0x7f031c35ff11 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:335:10
	#29 0x7f031c35ff11 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:328:3
	#30 0x7f031c35ff11 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:310:3
	#31 0x7f0322781f37 in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137:27
	#32 0x7f0326145f4f in XRE_RunAppShell() /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:906:20
	#33 0x7f031c35ff11 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:335:10
	#34 0x7f031c35ff11 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:328:3
	#35 0x7f031c35ff11 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:310:3
	#36 0x7f0326145813 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:738:34
	#37 0x55eb6b6cf24d in content_process_main(mozilla::Bootstrap*, int, char**) /builds/worker/checkouts/gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
	#38 0x55eb6b6cf671 in main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:309:18
	#39 0x7f033a798cb1 in __libc_start_main csu/../csu/libc-start.c:314:16

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:22:3 in __asan_memcpy
Shadow bytes around the buggy address:
  0x0c428063fcd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c428063fce0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c428063fcf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c428063fd00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c428063fd10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=>0x0c428063fd20:[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c428063fd30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c428063fd40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c428063fd50: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c428063fd60: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c428063fd70: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==54405==ABORTING

```
### Exploit Proof of Concept

Execute server.py script and navigate with Firefox to pointed url.

### Credit

Discovered by Marcin 'Icewall' Noga of Cisco Talos.

<https://talosintelligence.com/vulnerability_reports/>

### Timeline

None - Vendor Disclosure

None - Public Release

Actual results:

See report

Expected results:

See report

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1722083#c1)• 3 years ago |
|  | |

Attached file
[TALOS-2021-1345 - Mozilla\_Firefox\_MediaCacheStream NotifyDataReceived\_use-after-free\_vulnerability.txt](attachment.cgi?id=9232905)
— [Details](attachment.cgi?id=9232905&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a2771_406194)• 3 years ago |

Group: firefox-core-security → media-core-securityComponent: Untriaged → Audio/Video: PlaybackKeywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)Product: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a2832_406194)• 3 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1722083#c2)• 3 years ago |
|  | |

I'm trying to repro this no luck so far.

My current steps trying to recreate:

* Create a virutalenironment for python2 and install flask and requests
* Run the proof on concept's server.py in the venv
* Build a `--fuzzing-enalbed` + ASAN Firefox build
* Enable autoplay for audio and video in the Fx build
* Set the `fuzzing.enabled` pref to `true`
* Load the proof of concept

I've also tried to repro with the `window.dump(format);` line commented out, to see if reducing log spam helped, but it doesn't seem to.

Reporter, do you have any further suggestions for reproing this?

Flags: needinfo?(vulndiscovery)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1722083#c3)• 3 years ago |
|  | |

Sylvestre, is there a fuzzing person who might be able to help Bryce figure out how to reproduce this issue? It looks like it involves web audio stuff. Thanks.

Flags: needinfo?(sledru)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1722083#c4)• 3 years ago |
|  | |

I'm going to be out for the remainder of this week, but will grab this again when I return. :alwu from the media team is also familiar with this domain and is cced on this bug should anything come up while I'm out.

Assignee: nobody → bvandykSeverity: -- → S2Priority: -- → P2

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1722083#c5)• 3 years ago |
|  | |

I am also unable to reproduce the issue with the attached test case. I tested with the most recent ASan fuzzing build (m-c 20210726-0c272222c17b).

Qs for reporter:

* Are you able to reproduce the issue on the latest mozilla-central build (report says FF 89.0.3)?
* Was a custom prefs.js file used?
* Is the issue consistently reproducible, if not how frequently is the issue triggered by the test case?
* How long does it typically take to trigger the issue with the attached test case?
Flags: needinfo?(sledru)

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1722083#c6)• 3 years ago |
|  | |

Attached file
[UAF\_StreamBuffering\_final.zip](attachment.cgi?id=9233516)
— [Details](attachment.cgi?id=9233516&action=edit)

Hi Tyler,

We have uploaded a revised poc, hopefully you are able to trigger it now. it can take a while to trigger since it's a race condition, in our runs sometimes it took 10 minutes, but it has also taken 3h and 8h to trigger. We also retested on the nightly from yesterday July 27th and it still triggers. There's more information in the README.MD in the new archive.

The prefs file was obtained via <https://github.com/MozillaSecurity/prefpicker>

Yves

[Attachment #9232904](/attachment.cgi?id=9232904&action=edit "UAF_StreamBuffering.zip") -
Attachment is obsolete: trueFlags: needinfo?(vulndiscovery)

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1722083#c7)• 3 years ago |
|  | |

(In reply to Cisco Talos from [comment #6](/show_bug.cgi?id=1722083#c6 "RESOLVED FIXED - TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability"))

> Created [attachment 9233516](/attachment.cgi?id=9233516 "UAF_StreamBuffering_final.zip") [[details]](/attachment.cgi?id=9233516&action=edit "UAF_StreamBuffering_final.zip")
>
> UAF\_StreamBuffering\_final.zip
>
> Hi Tyler,

I mean Tyson!

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1722083#c8)• 3 years ago |
|  | |

I haven't reproduced the UAF yet but I did see this:

```
/builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:434:27: runtime error: applying non-zero offset 4096 to null pointer
    #0 0x7f226468d7f9 in nsBufferedInputStream::ReadSegments(nsresult (*)(nsIInputStream*, void*, char const*, unsigned int, unsigned int, unsigned int*), void*, unsigned int, unsigned int*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:434:27
    #1 0x7f226a057165 in OnDataAvailable /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:437:18
    #2 0x7f226a057165 in mozilla::ChannelMediaResource::Listener::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/dom/media/ChannelMediaResource.cpp:84:21
    #3 0x7f226467cf0f in nsBaseChannel::OnDataAvailable(nsIRequest*, nsIInputStream*, unsigned long, unsigned int) /builds/worker/checkouts/gecko/netwerk/base/nsBaseChannel.cpp:862:28
    #4 0x7f22646bf71e in nsInputStreamPump::OnStateTransfer() /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:532:23
    #5 0x7f22646be787 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsInputStreamPump.cpp:377:21
    #6 0x7f226468f692 in nsBufferedInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/netwerk/base/nsBufferedStreams.cpp:704:20
    #7 0x7f2269d350a3 in mozilla::dom::BlobURLInputStream::OnInputStreamReady(nsIAsyncInputStream*) /builds/worker/checkouts/gecko/dom/file/uri/BlobURLInputStream.cpp:271:20
    #8 0x7f2269d28ce4 in mozilla::(anonymous namespace)::InputStreamCallbackRunnable::Run() /builds/worker/checkouts/gecko/dom/file/ipc/RemoteLazyInputStream.cpp:54:16
    #9 0x7f22643c796b in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1142:16
    #10 0x7f22643d1e0c in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:466:10
    #11 0x7f22655f751a in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:300:20
    #12 0x7f22654e0931 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:331:10
    #13 0x7f22654e0931 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324:3
    #14 0x7f22654e0931 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306:3
    #15 0x7f22643c1418 in nsThread::ThreadFunc(void*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:390:10
    #16 0x7f228d8f53fe in _pt_root /builds/worker/checkouts/gecko/nsprpub/pr/src/pthreads/ptthread.c:201:5
    #17 0x7f228d5306da in start_thread /build/glibc-S9d2JN/glibc-2.27/nptl/pthread_create.c:463
    #18 0x7f228c50e71e in clone /build/glibc-S9d2JN/glibc-2.27/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95

```

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1722083#c9)• 3 years ago |
|  | |

Given the difficulty of triggering the issue, I'm going to clear the sec rating for now. Maybe we can reassess once the underlying issue has been figured out some more.

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1722083#c10)• 3 years ago |
|  | |

I had no luck to reproduce that either, but I have a patch which might solve this issue. Would any of you mind to download [this](https://firefox-ci-tc.services.mozilla.com/tasks/QKDPW9qdSfykOQ64rCsaCg#artifacts) (find `target.zip` that under `Artifacts`, then you can find `Firefox.exe` after unzip the file) and see if that helps or not?

Thank you so much.

Flags: needinfo?(vulndiscovery)Flags: needinfo?(twsmith)

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1722083#c11)• 3 years ago |
|  | |

Alastor, do you have a Linux build? We've been testing on Linux

Flags: needinfo?(vulndiscovery) → needinfo?(alwu)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1722083#c12)• 3 years ago |
|  | |

To be specific we will need a Linux fuzzing-asan-opt build to test.

Flags: needinfo?(twsmith)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1722083#c13)• 3 years ago |
|  | |

Ah sorry I used Windows build because I saw the user agent mentioned in the first comment was Windows. Here is the [linux-fuzzy-asan-opt task](https://firefox-ci-tc.services.mozilla.com/tasks/bir6QlvLR9q7Niz6nXV8lA#artifacts), thank you so much.

Flags: needinfo?(alwu) → needinfo?(vulndiscovery)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1722083#c14)• 3 years ago |
|  | |

With the build provided by :alwu I was only able to trigger OOMs. I was unable to reproduce the issue I was previously seeing. I'm not sure how helpful that is since I was never able to reproduce the original issue.

I will leave it to the reporter to verify.

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1722083#c15)• 3 years ago |
|  | |

The issue no longer triggers for us on Alastor's build.

Flags: needinfo?(vulndiscovery)

|  | [Bryce Seager van Dyk [:bryce] (he/him) - Not reading bugmail](/user_profile?user_id=560379) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1722083#c16)• 3 years ago |
|  | |

Assigning to Alastor as he has a patch to mitigate.

Assignee: bvandyk → alwu

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1722083#c17)• 3 years ago |
|  | |

Attached file
[Bug 1722083 - revoke the listener first.](attachment.cgi?id=9234720)
— [Details](attachment.cgi?id=9234720&action=edit)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1722083#c18)• 3 years ago |
|  | |

It looks like this landed without a security rating or approval?

Flags: needinfo?(alwu)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1032704_75935)• 3 years ago |

Status: UNCONFIRMED → ASSIGNED
[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=wontfix)
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected)
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)Ever confirmed: true

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1722083#c19)• 3 years ago |
|  | |

Base on this [guideline](https://firefox-source-docs.mozilla.org/bug-mgmt/processes/security-approval.html), this bug doesn't have sec-\* rating which seems being able to land that directly without an sec-approval. Rating was sec-high initially and was removed in [comment 9](/show_bug.cgi?id=1722083#c9 "RESOLVED FIXED - TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability") due to the difficulty of reproducing the issue, and I would consider this one as a sec-low or something.

Flags: needinfo?(alwu)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1722083#c20)• 3 years ago |
|  | |

The guideline says "For security bugs with no sec- severity rating assume the worst and follow the rules for sec-critical". That's probably overkill in this case, but it is better to wait for a rating.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1722083#c21)• 3 years ago |
|  | |

I'll mark it sec-moderate given that we have been unable to reproduce it, and it sounds like even for the reporter it isn't too easy to reproduce which mitigates the severity.

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1722083#c22)• 3 years ago |
|  | |

Sorry for causing this situation, I will wait for someone adding sec-rating next time before landing patch. Just discussed with Ryan offline and he think backout the patch doesn't help because it's also exposed to the public. And just for safe (based on the discussion by Ryan and sec-team), we decided to uplift this to release/esr91/esr78 as well and I will fill the request form for that.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1034544_75935)• 3 years ago |

[tracking-firefox91](/buglist.cgi?f1=cf_tracking_firefox91&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox91&o1=equals&v1=%2B)
[tracking-firefox92](/buglist.cgi?f1=cf_tracking_firefox92&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox92&o1=equals&v1=%2B)
[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
--- → [91+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=91%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [91+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=91%2B)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1722083#c23)• 3 years ago |
|  | |

Comment on [attachment 9234720](/attachment.cgi?id=9234720 "Bug 1722083 - revoke the listener first.") [[details]](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.")

[Bug 1722083](/show_bug.cgi?id=1722083 "RESOLVED FIXED - TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability") - revoke the listener first.

### Beta/Release Uplift Approval Request

* **User impact if declined**: Malicious sites might be able to expolit the vulnerability to excute some bad program on users' computer.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This patch simply changes the order of how we handling the shutdown of the media resource in order to prevent UAF. Does not add any new feature or structural change.
* **String changes made/needed**: no

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: this is sec-moderate.
* **User impact if declined**: Malicious sites might be able to expolit the vulnerability to excute some bad program on users' computer.
* **Fix Landed on Version**: 92
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This patch simply changes the order of how we handling the shutdown of the media resource in order to prevent UAF. Does not add any new feature or structural change.
* **String or UUID changes made by this patch**: No

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Hard to see the vulnerability simply by checking the patch because the patch just changes the order of handling shutdown of the media resource. In addition, media resource is not a public web API, and just our internal low level implementation, so it's hard for other people to think of a case that using public web APIs to hit the vulnerability.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: esr78
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: The patch is about shutdown handling which means users are going to close the media so less possible to cause regression on playback. Although the reporter has submitted a test case, none of people in Mozilla can successfully reproduce that by using that test.
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: sec-approval?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-release?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr91?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr78?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1722083#c24)• 3 years ago |
|  | |

Comment on [attachment 9234720](/attachment.cgi?id=9234720 "Bug 1722083 - revoke the listener first.") [[details]](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.")

[Bug 1722083](/show_bug.cgi?id=1722083 "RESOLVED FIXED - TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability") - revoke the listener first.

Approved for 91.0/91.0esr/78.13esr RC2.

[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-release?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-release+
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr91?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr91+
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr78?
[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: approval-mozilla-esr78+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1722083#c25)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/f51367289e74>

<https://hg.mozilla.org/releases/mozilla-esr91/rev/42e1acb39aff>

<https://hg.mozilla.org/releases/mozilla-esr78/rev/7d8548789b6c>

[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1722083#c26)• 3 years ago |
|  | |

revoke the listener first. r=bryce

<https://hg.mozilla.org/integration/autoland/rev/836f343ebca487594465a9fc57602ac77e229abe>

<https://hg.mozilla.org/mozilla-central/rev/836f343ebca4>

Group: media-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 92 Branch

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1162936_458186)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1190038_578488)• 3 years ago |

Whiteboard: [adv-main91+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1722083#c27)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235155) (obsolete)
— [Details](attachment.cgi?id=9235155&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1200733_578488)• 3 years ago |

Alias: CVE-2021-29985

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a1201055_578488)• 3 years ago |

Whiteboard: [adv-main91+] → [adv-main91+][adv-esr78.13+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1722083#c28)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9235168)
— [Details](attachment.cgi?id=9235168&action=edit)

[Attachment #9235155](/attachment.cgi?id=9235155&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Cisco Talos](/user_profile?user_id=689405)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1722083#c29)• 3 years ago |
|  | |

When will this release in stable?

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1722083#c30)• 3 years ago |
|  | |

We will be releasing next Tuesday the 10th.

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1722083#c31)• 3 years ago |
|  | |

Comment on [attachment 9234720](/attachment.cgi?id=9234720 "Bug 1722083 - revoke the listener first.") [[details]](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.")

[Bug 1722083](/show_bug.cgi?id=1722083 "RESOLVED FIXED - TALOS-2021-1345 - Mozilla Firefox MediaCacheStream::NotifyDataReceived use-after-free vulnerability") - revoke the listener first.

Clearing sec-approval flag because this is already released.

[Attachment #9234720](/attachment.cgi?id=9234720&action=edit "Bug 1722083 - revoke the listener first.") -
Flags: sec-approval?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1722083#a34490790_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1722083&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Cisco Talos](/user_profile?user_id=689405)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_c3cab586_20250114_185105.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-33

## Security Vulnerabilities fixed in Firefox 91

Announced
August 10, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 91

#### [#CVE-2021-29986: Race condition when resolving DNS names could have led to memory corruption](#CVE-2021-29986)

Reporter
pahhur
Impact
high
##### Description

A suspected race condition when calling `getaddrinfo` led to memory corruption and a potentially exploitable crash.
*Note: This issue only affected Linux operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1696138](https://bugzilla.mozilla.org/show_bug.cgi?id=1696138)

#### [#CVE-2021-29981: Live range splitting could have led to conflicting assignments in the JIT](#CVE-2021-29981)

Reporter
Gary Kwong
Impact
high
##### Description

An issue present in lowering/register allocation could have led to obscure but deterministic register confusion failures in JITted code that would lead to a potentially exploitable crash.

##### References

* [Bug 1707774](https://bugzilla.mozilla.org/show_bug.cgi?id=1707774)

#### [#CVE-2021-29988: Memory corruption as a result of incorrect style treatment](#CVE-2021-29988)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox incorrectly treated an inline list-item element as a block element, resulting in an out of bounds read or memory corruption, and a potentially exploitable crash.

##### References

* [Bug 1717922](https://bugzilla.mozilla.org/show_bug.cgi?id=1717922)

#### [#CVE-2021-29983: Firefox for Android could get stuck in fullscreen mode](#CVE-2021-29983)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Firefox for Android could get stuck in fullscreen mode and not exit it even after normal interactions that should cause it to exit.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1719088](https://bugzilla.mozilla.org/show_bug.cgi?id=1719088)

#### [#CVE-2021-29984: Incorrect instruction reordering during JIT optimization](#CVE-2021-29984)

Reporter
Lukas Bernhard
Impact
high
##### Description

Instruction reordering resulted in a sequence of instructions that would cause an object to be incorrectly considered during garbage collection. This led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1720031](https://bugzilla.mozilla.org/show_bug.cgi?id=1720031)

#### [#CVE-2021-29980: Uninitialized memory in a canvas object could have led to memory corruption](#CVE-2021-29980)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Uninitialized memory in a canvas object could have caused an incorrect free() leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722204](https://bugzilla.mozilla.org/show_bug.cgi?id=1722204)

#### [#CVE-2021-29987: Users could have been tricked into accepting unwanted permissions on Linux](#CVE-2021-29987)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

After requesting multiple permissions, and closing the first permission panel, subsequent permission panels will be displayed in a different position but still record a click in the default location, making it possible to trick a user into accepting a permission they did not want to.
*This bug only affects Firefox on Linux. Other operating systems are unaffected.*

##### References

* [Bug 1716129](https://bugzilla.mozilla.org/show_bug.cgi?id=1716129)

#### [#CVE-2021-29985: Use-after-free media channels](#CVE-2021-29985)

Reporter
Marcin 'Icewall' Noga of Cisco Talos
Impact
moderate
##### Description

A use-after-free vulnerability in media channels could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1722083](https://bugzilla.mozilla.org/show_bug.cgi?id=1722083)

#### [#CVE-2021-29982: Single bit data leak due to incorrect JIT optimization and type confusion](#CVE-2021-29982)

Reporter
Lukas Bernhard
Impact
low
##### Description

Due to incorrect JIT optimization, we incorrectly interpreted data from the wrong type of object, resulting in the potential leak of a single bit of memory.

##### References

* [Bug 1715318](https://bugzilla.mozilla.org/show_bug.cgi?id=1715318)

#### [#CVE-2021-29989: Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](#CVE-2021-29989)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Kerschbaumer, Olli Pettay, Sandor Molnar, and Simon Giesecke reported memory safety bugs present in Firefox 90 and Firefox ESR 78.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91 and Firefox ESR 78.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1662676%2C1666184%2C1719178%2C1719998%2C1720568)

#### [#CVE-2021-29990: Memory safety bugs fixed in Firefox 91](#CVE-2021-29990)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Kershaw Chang, Philipp, Chris Peterson, and Sebastian Hengst reported memory safety bugs present in Firefox 90. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 91](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544190%2C1716481%2C1717778%2C1719319%2C1722073)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


