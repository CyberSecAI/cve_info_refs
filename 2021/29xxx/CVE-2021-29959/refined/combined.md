=== Content from bugzilla.mozilla.org_857ef254_20250114_225708.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1395819)
* [XML](/show_bug.cgi?ctype=xml&id=1395819)

Closed
[Bug 1395819](/show_bug.cgi?id=1395819)
(CVE-2021-29959)

Opened 7 years ago
Closed 4 years ago

# Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio

## Categories

### (Core :: WebRTC: Audio/Video, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=WebRTC%3A%20Audio%2FVideo#WebRTC%3A%20Audio%2FVideo)

WebRTC: Audio/Video
▾

Core :: WebRTC: Audio/Video
Bugs in WebRTC audio and video capture, handling, echo cancellation, encoding, and playback
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC%3A%20Audio%2FVideo&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC%3A%20Audio%2FVideo&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=WebRTC%3A%20Audio%2FVideo)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

56 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

89 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected) |
| firefox-esr60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox55 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=wontfix) |
| firefox56 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix) |
| firefox57 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix) |
| firefox58 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix) |
| firefox59 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix) |
| firefox60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix) |
| firefox61 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix) |
| firefox62 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=wontfix) |
| firefox63 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix) |
| firefox66 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix) |
| firefox87 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=wontfix) |
| firefox88 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix) |
| firefox89 | --- | [verified](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 |  | unaffected |
| firefox-esr60 |  | wontfix |
| firefox-esr78 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox55 |  | wontfix |
| firefox56 |  | wontfix |
| firefox57 |  | wontfix |
| firefox58 |  | wontfix |
| firefox59 |  | wontfix |
| firefox60 |  | wontfix |
| firefox61 |  | wontfix |
| firefox62 |  | wontfix |
| firefox63 |  | wontfix |
| firefox64 |  | wontfix |
| firefox65 |  | wontfix |
| firefox66 |  | wontfix |
| firefox87 |  | wontfix |
| firefox88 |  | wontfix |
| firefox89 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jib, Assigned: pehrsons)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/906f005aaa08b2d109a3fa9e1b83000d?d=mm&size=40)  [pehrsons](/user_profile?user_id=489889)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/9362a14d9b87a3935eb16cfc834ed51f?d=mm&size=40)  [jib](/user_profile?user_id=456498)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/9362a14d9b87a3935eb16cfc834ed51f?d=mm&size=40)  [jib](/user_profile?user_id=456498)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

30 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1706409](/show_bug.cgi?id=1706409 "VERIFIED FIXED - Tab-crash allowing camera+microphone with MOZ_LOG=MediaManager:4")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1270572](/show_bug.cgi?id=1270572 "VERIFIED FIXED - While page already has a live track, getUserMedia should allow un-prompted re-access to same device.")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: privacy, regression, sec-low, Whiteboard: [post-critsmash-triage][adv-main89+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29959

[Keywords:](/describekeywords.cgi)

[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main89+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 2 obsolete files)

| [Bug 1395819 - Add b-c test cases for removing temporary permissions per-kind by stopping tracks. r?jib!,r?johannh!](/attachment.cgi?id=9211853)  [4 years ago](#c13)  [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9211853&action=edit) | [Review](/attachment.cgi?id=9211853) |
| --- | --- | --- |
| [Bug 1395819 - Make SourceListeners per-device and rename them DeviceListener to reflect this. r?jib](/attachment.cgi?id=9211854)  [4 years ago](#c14)  [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9211854&action=edit) | [Review](/attachment.cgi?id=9211854) |
| [Bug 1395819 - Remove unused method MediaEngineSource::Shutdown. r?jib](/attachment.cgi?id=9211855)  [4 years ago](#c15)  [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9211855&action=edit) | [Review](/attachment.cgi?id=9211855) |
| [Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!](/attachment.cgi?id=9212852)  [4 years ago](#c16)  [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9212852&action=edit) | [Review](/attachment.cgi?id=9212852) |
| [Bug 1395819 - Handle OS permission failures gracefully.](/attachment.cgi?id=9213373)  [4 years ago](#c18)  [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9213373&action=edit) | [Review](/attachment.cgi?id=9213373) |
| [advisory.txt](/attachment.cgi?id=9223707)  [4 years ago](#c24)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   379 bytes, text/plain |  | [Details](/attachment.cgi?id=9223707&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1395819#c0)• 7 years ago |
|  | |

STRs
1. Open <https://jsfiddle.net/jib1/mtLs2phL/2/>
2. When prompted, share camera and mic, but leave "Remember this decision" unchecked.
3. Wait for self-view to appear (notice hardware camera light turns on).
4. Wait 3 seconds, notice video disappears and camera hardware light goes out.
Expected result:
5. After 6 more seconds, site prompts for camera and mic again.
Actual result:
5. After 6 more seconds, camera and light come back on without permission.
It's surprising that the site can turn off the camera hardware light and yet turn the camera back on later without permission.
For it to work, the site has to keep recording using the microphone the whole time, so there's a mic recording indicator in the tab the whole time if you noticed.
Still, even for users who notice this, we think they would not have guessed the camera could come back on after the hardware light and camera live indicator have both gone out.
We should fix this to re-prompt, which would be consistent with expectations, the spec [1], and with how gum(cam+mic) works after gum(mic).
This is a regression since 53 ([bug 1270572](/show_bug.cgi?id=1270572 "VERIFIED FIXED - While page already has a live track, getUserMedia should allow un-prompted re-access to same device.")) - Marking as hidden for now.
[1] <https://w3c.github.io/mediacapture-main/getusermedia.html#dom-mediadevices-getusermedia>() says:
"For the origin identified by originIdentifier, request permission for use of the devices, while considering all devices attached to a live MediaStreamTrack in the current browsing context to have permission status "granted", resulting in a set of provided media." - We think "devices" here refers to cam and mic as separate devices.

|  | [Munro Mengjue Chiang [:mchiang] Be Mozillian since 1/19/2018](/user_profile?user_id=532887) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a248299_532887)• 7 years ago |

Assignee: nobody → mchiang

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a494260_1689)• 7 years ago |

Group: core-security → media-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1395819#c1)• 7 years ago |
|  | |

We should follow whatever the spec says, but as a user I wouldn't be surprised that if I granted permission to a page that it could turn the camera on and off at will until I leave that page (or reload).Blocks: [1270572](/show_bug.cgi?id=1270572 "VERIFIED FIXED - While page already has a live track, getUserMedia should allow un-prompted re-access to same device.")Keywords: [privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1395819#c2)• 7 years ago |
|  | |

Dan - the working group took a stricter view of this; that the potential privacy invasion (snapping photos) was serious if the website could turn your webcam light off \*and\* the indicator of access we prominently display for the camera turns off. This is less serious than if all indicators (i.e. mic) went away and then it turned the camera back on.
Note also that a site could cycle a camera on, take an image, and back off again before a user could notice or a camera LED was visible (we don't assume they're 0-delay, and believe some of them may never be visible to normal users if they're turned on and quickly back off). Perhaps the WG is wrong in assessing this, but that was the concern (given news reports of things like admins remotely turning on cameras to take occasional stills from school laptops that were taken home and in bedrooms, and people using images and audio obtained from people's computers to blackmail them).

|  | [Maire Reavy [:mreavy]](/user_profile?user_id=74434) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a663046_74434)• 7 years ago |

Rank: 12Priority: -- → P1

|  | [Munro Mengjue Chiang [:mchiang] Be Mozillian since 1/19/2018](/user_profile?user_id=532887) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1395819#c3)• 7 years ago |
|  | |

SourceListner receives EVENT\_FINISHED only when all of the tracks have been finished. [1]
Then the call flow will eventually send a recording-device-stopped message to webrtcUI.jsm [2] and withdraw the temporal permission. [3]
If there is only one track stopped, there won't be EVENT\_FINISHED fired and so no any further actions.
Since the temporal permission is not withdrawn, the 2nd gUM will be granted unpromptedly.
We need to create another event, e.g., EVENT\_TRACK\_FINISHED, and modify MediaStreamGraph / SourceListener / GetUserMediaWindowListener to fix this bug.
[1] <http://searchfox.org/mozilla-central/rev/51eae084534f522a502e4b808484cde8591cb502/dom/media/MediaStreamGraph.cpp#378-389>
[2] <http://searchfox.org/mozilla-central/rev/51eae084534f522a502e4b808484cde8591cb502/dom/media/MediaManager.cpp#485>
[3] <http://searchfox.org/mozilla-central/rev/51eae084534f522a502e4b808484cde8591cb502/browser/modules/webrtcUI.jsm#348>

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1395819#c4)• 7 years ago |
|  | |

No need to patch MediaStreamGraph here. There are already signals for tracks ending, but not in the same event.
Simplest is to keep using the MediaStreamListener, but best would be to switch to MediaStreamTrackListener since we'll soonish be able to remove MediaStreamListener completely.
MediaStreamTrackListener has a NotifyEnded method [1] that would be straight forward to use.
But to avoid risky refactoring in a sec bug, let's use MediaStreamListener::NotifyQueuedTrackChanges [2] instead.
Override it in SourceListener and ignore the queued media. Just make a check for when `aTrackEvents` contains `TRACK\_EVENT\_ENDED` (it's a flag). Then, like in `NotifyEvent`, schedule an update on main thread.
[1] <http://searchfox.org/mozilla-central/rev/e76c0fee79a34a3612740b33508276f4b37c3ee8/dom/media/MediaStreamListener.h#157>
[2] <http://searchfox.org/mozilla-central/rev/e76c0fee79a34a3612740b33508276f4b37c3ee8/dom/media/MediaStreamListener.h#103>
[3] <http://searchfox.org/mozilla-central/rev/e76c0fee79a34a3612740b33508276f4b37c3ee8/dom/media/MediaStreamTypes.h#25>

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1395819#c5)• 7 years ago |
|  | |

Mass change P1->P2 to align with new Mozilla triage process.Priority: P1 → P2

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a1158777_456498)• 7 years ago |

[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected)
[status-firefox56](/buglist.cgi?f1=cf_status_firefox56&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=affected)
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=unaffected)

|  | [Maire Reavy [:mreavy]](/user_profile?user_id=74434) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a1203066_74434)• 7 years ago |

[status-firefox55](/buglist.cgi?f1=cf_status_firefox55&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox55&o1=equals&v1=wontfix)
[status-firefox56](/buglist.cgi?f1=cf_status_firefox56&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=fix-optional)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a1677692_75935)• 7 years ago |

[status-firefox56](/buglist.cgi?f1=cf_status_firefox56&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a2234362_75935)• 7 years ago |

[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected)

|  | [Munro Mengjue Chiang [:mchiang] Be Mozillian since 1/19/2018](/user_profile?user_id=532887) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a2236173_532887)• 7 years ago |

Depends on: [1299515](/show_bug.cgi?id=1299515 "RESOLVED FIXED - Turn off camera/microphone while all tracks are muted/disabled.")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a6341447_279663)• 7 years ago |

[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1395819#c6)• 7 years ago |
|  | |

Andreas, is this still an issue?Assignee: bonchiang → nobody
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix)
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix)
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=%3F)Flags: needinfo?(apehrson)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1395819#c7)• 7 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #6](/show_bug.cgi?id=1395819#c6 "VERIFIED FIXED - Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio"))
> Andreas, is this still an issue?
Yes. No changes have been made to this logic.Flags: needinfo?(apehrson)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a16624737_75935)• 7 years ago |

[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a22353559_75935)• 7 years ago |

[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [fix-optional](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fix-optional)
[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a29672385_580382)• 6 years ago |

[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix)
[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fix-optional)
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
--- → [fix-optional](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=fix-optional)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a38398446_24572)• 6 years ago |

[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=wontfix)
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix)
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [fix-optional](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=fix-optional)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a40382311_75935)• 6 years ago |

[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fix-optional)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a44559443_451704)• 6 years ago |

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fix-optional)

|  | [Nils Ohlmeier [:drno]](/user_profile?user_id=489581) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1395819#c8)• 6 years ago |
|  | |

Andreas did your recent changes remove the MediaStreamListener like you announced in [comment #4](/show_bug.cgi?id=1395819#c4 "VERIFIED FIXED - Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio")? Is this still a problem?

Flags: needinfo?(apehrson)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1395819#c9)• 6 years ago |
|  | |

I have removed listeners, yes ([bug 1423241](/show_bug.cgi?id=1423241 "RESOLVED FIXED - Remove MediaStreamListener")). This is still a problem, yes.

Perhaps removing stream listeners has unblocked fixing this in permissions code, but I think it could have been done before too.

Permissions handling, that's where this issue really lies.

Flags: needinfo?(apehrson)

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1395819#c10)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1395819&comment_id=15301570 "1 revision") |
|  | |

### Cause

It turns out we only fire `"recording-device-stopped"` to front-end when removing an entire SourceListener [here](https://searchfox.org/mozilla-central/rev/5a66c4b4a41ab78a87c30c9db0d93c732c534402/dom/media/MediaManager.cpp#4219). For historical reasons, it may represent a camera + microphone *pair*, but only *when requested as a pair in `getUserMedia`*.

Front-end listens to `"recording-device-stopped"` to terminate temporary permissions to device + kind based on track liveliness (an empty `message.rawID` means stop all, otherwise a specific device only). This is the disconnect.

### Effect

Unprompted re-access to a camera or mic post-stop from a pair obtained in a joint gUM call, as long as the other half of the pair is kept live.

STRs: In <https://jan-ivar.github.io/dummy/gum_stop.html> click `Start Both!` + `Stop cams!` + `Start cams!` = no re-prompt. Or, click `Start Both!` + `Stop mics!` + `Start mics!` = no re-prompt.

### Fix

Remove the *pair* special case from SourceListener. It's arbitrary in the modern stack, which allows pairs of unrelated hardware anyway (e.g. BRIO cam + AirPod mic). . Well-tested. Simple fix.

### Why fix it?

On first blush, the buggy behavior may seem desirable. Especially since some web conference sites asymmetrically stop camera on facemute to work around [crbug 642785](https://crbug.com/642785), but never stop the mic on micmute (so they can implement the *"Are you speaking? you should unmute"* feature).

But it's highly unpredictable in practice: Several sites (Meet, WebEx) obtain camera and microphone separately, so it didn't happen there. Even if we got Meet to use a joint prompt, users might change their cams or mics independently anyway using the site's ⚙️ settings page, and then it wouldn't happen.

But even if we made this reliable, it wouldn't work if the site stops both tracks, which some sites (MeetEcho?) appear to do on mute/unmute. We'd end up causing re-prompts in some sites but not others for seemingly comparably functionality.

### Use case

But this does highlight a use-case: lurkers in medium-to-large meetings who spend most of their time facemuted and micmuted, only to unmute when called on to ask some question.

A superior fix to address this use case directly would seem to be to significantly increase the grace period considered in [bug 1693677](/show_bug.cgi?id=1693677 "VERIFIED FIXED - Grant a temporary grace period for re-requesting microphone or camera devices after the track stops") to minutes not seconds, for as long as the page is not navigated (then trim it down to seconds on navigation). I've filed this as [bug 1697284](/show_bug.cgi?id=1697284 "VERIFIED FIXED - Don't prompt web conference lurkers on unmute when they want to ask a question").

No longer blocks: [1270572](/show_bug.cgi?id=1270572 "VERIFIED FIXED - While page already has a live track, getUserMedia should allow un-prompted re-access to same device.")No longer depends on: [1299515](/show_bug.cgi?id=1299515 "RESOLVED FIXED - Turn off camera/microphone while all tracks are muted/disabled.")Regressed by: [1270572](/show_bug.cgi?id=1270572 "VERIFIED FIXED - While page already has a live track, getUserMedia should allow un-prompted re-access to same device.")

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a111101402_456498)• 4 years ago |

Assignee: nobody → apehrson

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1395819#c11)• 4 years ago |
|  | |

S3 because this is not **blocking** any functionality per se. It's a bit too permissive.

Severity: critical → S3Rank: 12

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a111214148_489889)• 4 years ago |

Status: NEW → ASSIGNED

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1395819#c12)• 4 years ago |
|  | |

Note, if we go with a 60 minute grace period in [bug 1697284](/show_bug.cgi?id=1697284 "VERIFIED FIXED - Don't prompt web conference lurkers on unmute when they want to ask a question"), then it should cover up the effects of this bug most of the time.

I resolved a case where this behavior interfered with a test with <https://phabricator.services.mozilla.com/D107769>.

I think this would still be good to fix, to simplify our model, but it gives us a bit more breathing room perhaps.

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1395819#c13)• 4 years ago |
|  | |

Attached file
[Bug 1395819 - Add b-c test cases for removing temporary permissions per-kind by stopping tracks. r?jib!,r?johannh!](attachment.cgi?id=9211853)
— [Details](attachment.cgi?id=9211853&action=edit)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1395819#c14)• 4 years ago |
|  | |

Attached file
[Bug 1395819 - Make SourceListeners per-device and rename them DeviceListener to reflect this. r?jib](attachment.cgi?id=9211854)
— [Details](attachment.cgi?id=9211854&action=edit)

This patch makes MediaManager notify of recording-device-events as soon as any

gUM-track has ended, as opposed to when all tracks in a gUM-request have ended.

This effectively makes temporary permissions per-track rather than per-request.

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1395819#c15)• 4 years ago |
|  | |

Attached file
[Bug 1395819 - Remove unused method MediaEngineSource::Shutdown. r?jib](attachment.cgi?id=9211855)
— [Details](attachment.cgi?id=9211855&action=edit)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1395819#c16)• 4 years ago |
|  | |

Attached file
[Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!](attachment.cgi?id=9212852) (obsolete)
— [Details](attachment.cgi?id=9212852&action=edit)

Normally when all tracks capturing a certain device for a window have stopped we

notify of "recording-device-stopped" for that window and device.

On navigation of a window, for instance, this notification is fired for all

active devices for that window before firing "recording-window-ended".

Prior to this patch we have also fired a "recording-device-stopped" without

device info as a catch-all just prior to "recording-window-ended". However,

there is no chance in the content process of missing a device and thus needing

the catch-all.

This patch removes device-less "recording-device-stopped" to simplify both code

and protocol.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1395819#c17)• 4 years ago |
|  | |

Comment on [attachment 9212852](/attachment.cgi?id=9212852 "Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!") [[details]](/attachment.cgi?id=9212852&action=edit "Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!")

[Bug 1395819](/show_bug.cgi?id=1395819 "VERIFIED FIXED - Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio") - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!

Revision D110430 was moved to [bug 1699338](/show_bug.cgi?id=1699338 "NEW"). Setting [attachment 9212852](/attachment.cgi?id=9212852 "Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!") [[details]](/attachment.cgi?id=9212852&action=edit "Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!") to obsolete.

[Attachment #9212852](/attachment.cgi?id=9212852&action=edit "Bug 1395819 - Remove recording-device-stopped notifications without device info. r?karlt!,r?johannh!,r?#webidl!") -
Attachment is obsolete: true

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1395819#c18)• 4 years ago |
|  | |

Attached file
[Bug 1395819 - Handle OS permission failures gracefully.](attachment.cgi?id=9213373) (obsolete)
— [Details](attachment.cgi?id=9213373&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113154199_600971)• 4 years ago |

[Attachment #9213373](/attachment.cgi?id=9213373&action=edit "Bug 1395819 - Handle OS permission failures gracefully.") -
Attachment description: Bug 1395819 - Handle OS permission failures gracefully. → WIP: Bug 1395819 - Handle OS permission failures gracefully.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113154720_600971)• 4 years ago |

[Attachment #9213373](/attachment.cgi?id=9213373&action=edit "Bug 1395819 - Handle OS permission failures gracefully.") -
Attachment description: WIP: Bug 1395819 - Handle OS permission failures gracefully. → Bug 1395819 - Handle OS permission failures gracefully.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113471181_600971)• 4 years ago |

[Attachment #9213373](/attachment.cgi?id=9213373&action=edit "Bug 1395819 - Handle OS permission failures gracefully.") -
Attachment is obsolete: true

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113478559_600971)• 4 years ago |

[Attachment #9211854](/attachment.cgi?id=9211854&action=edit "Bug 1395819 - Make SourceListeners per-device and rename them DeviceListener to reflect this. r?jib") -
Attachment description: Bug 1395819 - Make SourceListeners per-device and rename them DeviceListener to reflect this. r?jib,r?karlt → Bug 1395819 - Make SourceListeners per-device and rename them DeviceListener to reflect this. r?jib

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1395819#c19)• 4 years ago |
|  | |

This had landed:

Add b-c test cases for removing temporary permissions per-kind by stopping tracks. r=johannh,jib

<https://hg.mozilla.org/mozilla-central/rev/990441f04a86>

Make SourceListeners per-device and rename them DeviceListener to reflect this. r=jib

<https://hg.mozilla.org/mozilla-central/rev/46083fddeb0d>

Remove unused method MediaEngineSource::Shutdown. r=jib

<https://hg.mozilla.org/mozilla-central/rev/813c7ce3607b>

But got backed out for causing cpp failures in MediaManager.cpp:

<https://hg.mozilla.org/mozilla-central/rev/366a7dcd19f4>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=335570691&repo=autoland>

dom/media/MediaManager.cpp:3966:17: error: use of undeclared identifier 'MediaDeviceKindValues'; did you mean 'dom::MediaDeviceKindValues'?

dom/media/MediaManager.cpp:4020:32: error: use of undeclared identifier 'MediaDeviceKindValues'; did you mean 'dom::MediaDeviceKindValues'?

and more failures

Flags: needinfo?(apehrson)

|  | [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113543910_489889)• 4 years ago |

Flags: needinfo?(apehrson)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a113558305_75935)• 4 years ago |

[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix)
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=wontfix)
[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix)
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1395819#c20)• 4 years ago |
|  | |

Add b-c test cases for removing temporary permissions per-kind by stopping tracks. r=johannh,jib

<https://hg.mozilla.org/integration/autoland/rev/6e0fb393c96731102fdeec5cd5e60c9ae764509d>

Make SourceListeners per-device and rename them DeviceListener to reflect this. r=jib

<https://hg.mozilla.org/integration/autoland/rev/f5ef4c4b1c56147eb8f1e4aabdc411005872c704>

Remove unused method MediaEngineSource::Shutdown. r=jib

<https://hg.mozilla.org/integration/autoland/rev/3abc76c921f7fbc2909f9d05bb916754b80169d6>

<https://hg.mozilla.org/mozilla-central/rev/6e0fb393c967>

<https://hg.mozilla.org/mozilla-central/rev/f5ef4c4b1c56>

<https://hg.mozilla.org/mozilla-central/rev/3abc76c921f7>

Group: media-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 4 years ago
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 89 Branch

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a114088996_553429)• 4 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Giorgia Nichita, Release Desktop QA](/user_profile?user_id=683593) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1395819#c21)• 4 years ago |
|  | |

We managed to reproduce this issue on an affected Nightly build 2021-04-01 using the steps from [comment 0](/show_bug.cgi?id=1395819#c0 "VERIFIED FIXED - Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio"), with a minor difference in step 3:

1. Open <https://jsfiddle.net/jib1/mtLs2phL/2/>
2. When prompted, share camera and mic, but leave "Remember this decision" unchecked.
3. Hardware camera light turns on (Self-view does not appear, the window remains blank).
4. Wait 3 seconds,camera hardware light goes out (not the case for the self-view as it does not appear in step 3).
5. After 6 more seconds, camera and light start without permission.

We also verified this on the latest Nightly, but it occurs exactly as in the steps above. Can you please take a look at this, what should be the expected result?

Flags: needinfo?(aryx.bugmail)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a114254135_580382)• 4 years ago |

Flags: needinfo?(aryx.bugmail) → needinfo?(apehrson)

|  | [Timea Cernea [:tbabos][inactive]](/user_profile?user_id=615271) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1395819#c22)• 4 years ago |
|  | |

Hi Giorgia,

Please allow me to steal the NI? and verification of this bug as it is closely related to one of the features QA is testing. I had a talk with Jan-Ivar about this issue as it gets a bit more complicated to test due to [Bug 1697284](/show_bug.cgi?id=1697284 "VERIFIED FIXED - Don't prompt web conference lurkers on unmute when they want to ask a question"). Thanks for testing it out so far tho, and sorry for this inconvenience!

Setting up NI? for myself to handle this when I can.

Flags: needinfo?(apehrson) → needinfo?(timea.babos)

|  | [Timea Cernea [:tbabos][inactive]](/user_profile?user_id=615271) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1395819#c23)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1395819&comment_id=15370314 "1 revision") |
|  | |

Verified-fixed on latest Firefox Nightly 89.0a1 on MacOS 10.15 and Windows 10 x 64.

Verified by disabling the grace period ( privacy.webrtc.deviceGracePeriodTimeoutMs set to 0)

The permission panel will request access after following the STR provided in [Comment 10](/show_bug.cgi?id=1395819#c10 "VERIFIED FIXED - Site can turn cam & hw light back on without permission after cam light goes out, if it keeps recording audio").

Status: RESOLVED → VERIFIED
[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=verified)Flags: qe-verify+Flags: needinfo?(timea.babos)

|  | [Jan-Ivar Bruaroey [:jib] (needinfo? me)](/user_profile?user_id=456498)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a114694081_456498)• 4 years ago |

Regressions: [1706409](/show_bug.cgi?id=1706409 "VERIFIED FIXED - Tab-crash allowing camera+microphone with MOZ_LOG=MediaManager:4")

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a117859296_428608)• 4 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main89+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1395819#c24)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9223707)
— [Details](attachment.cgi?id=9223707&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a117867547_428608)• 4 years ago |

Alias: CVE-2021-29959

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a133411296_1689)• 3 years ago |

Group: core-security-release

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1395819#a137575129_575867)• 3 years ago |

Has Regression Range: --- → yes
You need to [log in](/show_bug.cgi?id=1395819&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andreas Pehrson [:pehrsons]](/user_profile?user_id=489889)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_30dfa836_20250114_225709.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-23

## Security Vulnerabilities fixed in Firefox 89

Announced
June 1, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 89

#### [#CVE-2021-29965: Password Manager on Firefox for Android susceptible to domain spoofing](#CVE-2021-29965)

Reporter
Harshit Mahendra
Impact
high
##### Description

A malicious website that causes an HTTP Authentication dialog to be spawned could trick the built-in password manager to suggest passwords for the currently active website instead of the website that triggered the dialog.

*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1709257](https://bugzilla.mozilla.org/show_bug.cgi?id=1709257)

#### [#CVE-2021-29960: Filenames printed from private browsing mode incorrectly retained in preferences](#CVE-2021-29960)

Reporter
Sebastian Hengst
Impact
moderate
##### Description

Firefox used to cache the last filename used for printing a file. When generating a filename for printing, Firefox usually suggests the web page title.
The caching and suggestion techniques combined may have lead to the title of a website visited during private browsing mode being stored on disk.

##### References

* [Bug 1675965](https://bugzilla.mozilla.org/show_bug.cgi?id=1675965)

#### [#CVE-2021-29961: Firefox UI spoof using "<select>" elements and CSS scaling](#CVE-2021-29961)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

When styling and rendering an oversized `&lt;select>` element, Firefox did not apply correct clipping which allowed an attacker to paint over the user interface.

##### References

* [Bug 1700235](https://bugzilla.mozilla.org/show_bug.cgi?id=1700235)

#### [#CVE-2021-29963: Shared cookies for search suggestions in private browsing mode](#CVE-2021-29963)

Reporter
Wladimir Palant working with Include Security
Impact
moderate
##### Description

Address bar search suggestions in private browsing mode were re-using session data from normal mode.

*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1705068](https://bugzilla.mozilla.org/show_bug.cgi?id=1705068)

#### [#CVE-2021-29964: Out of bounds-read when parsing a "WM\_COPYDATA" message](#CVE-2021-29964)

Reporter
Ronald Crane
Impact
moderate
##### Description

A locally-installed hostile program could send `WM_COPYDATA` messages that Firefox would process incorrectly, leading to an out-of-bounds read.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1706501](https://bugzilla.mozilla.org/show_bug.cgi?id=1706501)

#### [#CVE-2021-29959: Devices could be re-enabled without additional permission prompt](#CVE-2021-29959)

Reporter
Jan-Ivar Bruaroey
Impact
low
##### Description

When a user has already allowed a website to access microphone and camera, disabling camera sharing would not fully prevent the website from re-enabling it without an additional prompt.
This was only possible if the website kept recording with the microphone until re-enabling the camera.

##### References

* [Bug 1395819](https://bugzilla.mozilla.org/show_bug.cgi?id=1395819)

#### [#CVE-2021-29962: No rate-limiting for popups on Firefox for Android](#CVE-2021-29962)

Reporter
Wladimir Palant working with Include Security
Impact
low
##### Description

Firefox for Android would become unstable and hard-to-recover when a website opened too many popups.

*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1701673](https://bugzilla.mozilla.org/show_bug.cgi?id=1701673)

#### [#CVE-2021-29967: Memory safety bugs fixed in Firefox 89 and Firefox ESR 78.11](#CVE-2021-29967)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christian Holler, Anny Gakhokidze, Alexandru Michis, Gabriele Svelto reported memory safety bugs present in Firefox 88 and Firefox ESR 78.11. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 89 and Firefox ESR 78.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1602862%2C1703191%2C1703760%2C1704722%2C1706041)

#### [#CVE-2021-29966: Memory safety bugs fixed in Firefox 89](#CVE-2021-29966)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Christian Holler, Tooru Fujisawa, Tyson Smith reported memory safety bugs present in Firefox 88. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 89](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1660307%2C1686154%2C1702948%2C1708124)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_5c4cc1a0_20250114_225709.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202107-09**

Multiple vulnerabilities have been found in Mozilla Firefox, the
worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **89.0** |
| Unaffected versions | >= **78.11.0**>= **89.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **89.0** |
| Unaffected versions | >= **78.11.0**>= **89.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla
project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please
review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-78.11.0"

```

All Mozilla Firefox ESR binary users should upgrade to the latest
version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-78.11.0"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-89.0"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-89.0"

```
### References

* [CVE-2021-29959](https://nvd.nist.gov/vuln/detail/CVE-2021-29959)
* [CVE-2021-29960](https://nvd.nist.gov/vuln/detail/CVE-2021-29960)
* [CVE-2021-29961](https://nvd.nist.gov/vuln/detail/CVE-2021-29961)
* [CVE-2021-29966](https://nvd.nist.gov/vuln/detail/CVE-2021-29966)

**Release date**

July 07, 2021

**Latest revision**

July 07, 2021: 1

**Severity**

normal

**Exploitable**

local, remote

**Bugzilla entries**

* [794082](https://bugs.gentoo.org/show_bug.cgi?id=794082)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


