=== Content from www.mozilla.org_2dccd29d_20250114_191128.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-13

## Security Vulnerabilities fixed in Thunderbird 78.9.1

Announced
April 8, 2021
Impact
moderate
Products
Thunderbird
Fixed in

* Thunderbird 78.9.1

**Note**: This advisory was updated April 20, 2021 to include CVE-2021-29949 which was also fixed in this release.

#### [#CVE-2021-23991: An attacker may use Thunderbird's OpenPGP key refresh mechanism to poison an existing key](#CVE-2021-23991)

Reporter
Cure53
Impact
moderate
##### Description

If a Thunderbird user has previously imported Alice's OpenPGP key, and Alice has extended the validity period of her key, but Alice's updated key has not yet been imported, an attacker may send an email containing a crafted version of Alice's key with an invalid subkey, Thunderbird might subsequently attempt to use the invalid subkey, and will fail to send encrypted email to Alice.

##### References

* [Bug 1673240](https://bugzilla.mozilla.org/show_bug.cgi?id=1673240)

#### [#CVE-2021-23992: A crafted OpenPGP key with an invalid user ID could be used to confuse the user](#CVE-2021-23992)

Reporter
Neal Walfield
Impact
moderate
##### Description

Thunderbird did not check if the user ID associated with an OpenPGP key has a valid self signature. An attacker may create a crafted version of an OpenPGP key, by either replacing the original user ID, or by adding another user ID. If Thunderbird imports and accepts the crafted key, the Thunderbird user may falsely conclude that the false user ID belongs to the correspondent.

##### References

* [Bug 1666236](https://bugzilla.mozilla.org/show_bug.cgi?id=1666236)

#### [#CVE-2021-23993: Inability to send encrypted OpenPGP email after importing a crafted OpenPGP key](#CVE-2021-23993)

Reporter
Neal Walfield
Impact
moderate
##### Description

An attacker may perform a DoS attack to prevent a user from sending encrypted email to a correspondent. If an attacker creates a crafted OpenPGP key with a subkey that has an invalid self signature, and the Thunderbird user imports the crafted key, then Thunderbird may try to use the invalid subkey, but the RNP library rejects it from being used, causing encryption to fail.

##### References

* [Bug 1666360](https://bugzilla.mozilla.org/show_bug.cgi?id=1666360)

#### [#CVE-2021-29949: Thunderbird might execute an alternative OTR library](#CVE-2021-29949)

Reporter
Tuan Vu Pham
Impact
low
##### Description

When loading the shared library that provides the OTR protocol implementation, Thunderbird will initially attempt to open it using a filename that isn't distributed by Thunderbird. If a computer has already been infected with a malicious library of the alternative filename, and the malicious library has been copied to a directory that is contained in the search path for executable libraries, then Thunderbird will load the incorrect library.

##### References

* [Bug 1682101](https://bugzilla.mozilla.org/show_bug.cgi?id=1682101)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_58189628_20250114_191127.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1682101)
* [XML](/show_bug.cgi?ctype=xml&id=1682101)

Closed
[Bug 1682101](/show_bug.cgi?id=1682101)
(CVE-2021-29949)

Opened 4 years ago
Closed 4 years ago

# Thunderbird may use OTR library using a filename that isn't distributed

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Thunderbird may use OTR library using a filename that isn't distributed

## Categories

### (Thunderbird :: Security, defect)

[Product:](/describecomponents.cgi?product=Thunderbird)

Thunderbird
▾

Thunderbird
For bugs in MZLA's Thunderbird desktop mail client. Bugs in the back-end (e.g. protocols) should be filed in the [MailNews Core](https://bugzilla.mozilla.org/enter_bug.cgi?product=MailNews Core) product. Bugs in calendar should be filed in the [Calendar](https://bugzilla.mozilla.org/enter_bug.cgi?product=Calendar) product. Bugs for the chat features, file in the [Chat Core](https://bugzilla.mozilla.org/enter_bug.cgi?product=Chat%20Core) product.
[See Open Bugs in This Product](/buglist.cgi?product=Thunderbird&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Thunderbird)
Watch This Product

[Component:](/describecomponents.cgi?product=Thunderbird&component=Security#Security)

Security
▾

Thunderbird :: Security
For app-level security bugs.

If the problem relates to underlying components (PSM, NSS, Core, Toolkit) then please file it in the appropriate product instead of here.

[See Open Bugs in This Component](/buglist.cgi?product=Thunderbird&component=Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Thunderbird&component=Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Thunderbird&component=Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

78

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

## Tracking

### (thunderbird\_esr78+ fixed, thunderbird88 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

89 Branch

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| thunderbird\_esr78 | [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=equals&v1=fixed) |
| thunderbird88 | --- | [fixed](/buglist.cgi?f1=cf_status_thunderbird_88&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-thunderbird |  | --- |
| thunderbird\_esr78 | + | fixed |
| thunderbird88 |  | fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| thunderbird133 | --- | --- |
| thunderbird134 | --- | --- |
| thunderbird135 | --- | --- |
| thunderbird136 | --- | --- |

## People

### (Reporter: vupt.bka, Assigned: KaiE)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d11b5b0a468ed960df1fde3c304d3580?d=mm&size=40)  [KaiE](/user_profile?user_id=36541)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/02ab3753b52e5926ede375994da96e72?d=mm&size=40)  [vupt.bka](/user_profile?user_id=676018)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1700506](/show_bug.cgi?id=1700506 "RESOLVED FIXED - Perma comm/mail/test/browser/account/browser_actions.js | A promise chain failed to handle a rejection: Generating OTR private key failed: Error: Error: open requires a single argument - stack: reportKeyGenFailure@resource:///modules/OTRUI.jsm:213:11")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1685977](/show_bug.cgi?id=1685977 "RESOLVED DUPLICATE - DLL hijacking")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1700240](/show_bug.cgi?id=1700240 "RESOLVED FIXED - libotr in official builds should be consistently named")

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29949

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | wanted-thunderbird |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [Bug1682101-OTR.patch](/attachment.cgi?id=9193173)  [4 years ago](#c7)  [Rob Lemley [:rjl]](/user_profile?user_id=63411)   3.18 KB, patch | KaiE : [feedback-](#c24 "4 years ago") | [Details](/attachment.cgi?id=9193173&action=edit) | [Diff](/attachment.cgi?id=9193173&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1682101&attachment=9193173) |
| --- | --- | --- |
| [Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin](/attachment.cgi?id=9210769)  [4 years ago](#c31)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   48 bytes, text/x-phabricator-request | wsmwk : [approval-comm-beta+](#c60 "4 years ago")  wsmwk : [approval-comm-esr78+](#c63 "4 years ago") | [Details](/attachment.cgi?id=9210769&action=edit) | [Review](/attachment.cgi?id=9210769) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1682101#c0)• 4 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36

Steps to reproduce:

1. Summary:

   The newest version of Mozilla Thunderbird Product has 02 vulnerability about dll hijacking and lead attackers to perform an arbitrary code execution by loading a unverify dll.

* Vulnerability Process: thunderbird.exe (Local at : "%Program Files (x86)%\Mozilla Thunderbird\thunderbird.exe")
* The dll name Hijacked: otr-5.dll, otr.5.dll

2. Steps To Reproduce:

   When user runs thunderbird.exe 02libraries with name otr-5.dll and otr.5.dll at 1.Summary are loaded by thunderbird.exe with a relative name that makes it exposed to DLL hijacking. When an application or a service is starting on Windows it looks for the used DLLs in order to function properly. If these DLLs don’t exist or the software code is developed in an insecure way (DLL’s are called without using a fully qualified path) then it’s possible to load and execute a malicious DLL file.

It should be noted that when an application needs to load a DLL it will go through the following order:

The directory from which the application is loaded

C:\Windows\System32

C:\Windows\System

C:\Windows

The current working directory

Directories in the system PATH environment variable

3. These steps below will show how to escalate privilege:

* Create a fake dll with name "otr-5.dll". Its code just calls the notepad.exe process by cmd.exe. (with user - not admin)
* Copy the fake dll "otr-5.dll" to a folder which has writeable permission with user. I choose folder "C:\Python27" (It is contained in "Directories in the system PATH environment variable")
* Open thunderbird.exe, my fake otr-5.dll is called first, and the notepad.exe process runs.

Actual results:

Attacker can run all malicious commands on victim computer with this issue whenever user opens thunderbird.exe.

Expected results:

Thunderbird.exe should load the truth dlls with verified digital on the truth path.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a12185_29811)• 4 years ago |

Component: Untriaged → Installer

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1682101#c1)• 4 years ago |
|  | |

Wayne: why Installer? It appears we cannot ship OTR (incompatible license?) so we can't "fix" the bug by installing it ourselves into a place where we can expect it.

This broad path search [looks intentional](https://phabricator.services.mozilla.com/D17691?id=101311#inline-179633).

Tuan Vu: In my own instance of Thunderbird none of the chat functionality is active, because I never set it up. Did you set up chat and tell Thunderbird that you wanted to use OTR? Or is it looking for OTR even though you didn't? We shouldn't be opening up this risk for users who don't even want that functionality, but for those that do I'm not sure how we'll engineer a good balance between "making it work" and opening up this path injection risk if the OTR install directory happens to be later in the path than some world-writable directory.

[Suggestion off the top of my head: on first set-up do the path look-up, and when we find OTR remember that specific path in a preference. Users could edit it if they ever move OTR. I assume you've already rejected "Tell Thunderbird where OTR is installed" as unusable like used to be done for GPG in Enigmail.]

Flags: needinfo?(vupt.bka)Flags: needinfo?(vseerror)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1682101#c2)• 4 years ago |
|  | |

I don't disagree with you, I just wanted to get it out of untriaged component. I leave it to others to make a better choice.

Flags: needinfo?(vseerror)

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1682101#c3)• 4 years ago |
|  | |

Looks a lot like [bug 1530726](/show_bug.cgi?id=1530726 "RESOLVED INVALID"). It's really the "current working directory" piece check that's problematic. The others should be admin-only writable paths on Windows, and if an attacker has written a malicious DLL to one of those directories then you're already in trouble.

Official Thunderbird builds ship with libotr shared libraries for some time now. Since the broad search path is there to accommodate Linux distributions really who prefer to link to system libraries for their builds of Thunderbird, I suggest we mitigate by only checking the application directory for libotr on Windows.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1682101#c4)• 4 years ago |
|  | |

Dear Team,

First, we just need user permission to write some malicious files on those paths

Second, I detected this issue happenned when i run thunderbird (don’t care using OTR or not)

Thanks Team!

Flags: needinfo?(vupt.bka)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1682101#c5)• 4 years ago |
|  | |

(In reply to Rob Lemley [:rjl] from [comment #3](/show_bug.cgi?id=1682101#c3 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> I suggest we mitigate by only checking the application directory for libotr on Windows.

Sounds good. I wouldn't think a "system otr" dll is a thing on windows.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1682101#c6)• 4 years ago |
|  | |

Rob, if you want to make the patch, please go ahead and ask for review. If you want me to make the patch, please assign the bug to me.

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1682101#c7)• 4 years ago |
|  | |

Attached patch

[Bug1682101-OTR.patch](attachment.cgi?id=9193173&action=diff) (obsolete)
— [Details](attachment.cgi?id=9193173&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1682101&attachment=9193173)

This is what I came up with; it does the job, but I'm not particularly crazy about it. Since we have libotr, librnp, and a couple of others, is it worthwhile trying to unify the ctypes.open loading code? I looked around for inspiration but didn't see anything.

I think some simple unittests should be added as well.

[Attachment #9193173](/attachment.cgi?id=9193173&action=edit "Bug1682101-OTR.patch") -
Flags: feedback?(kaie)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1682101#c8)• 4 years ago |
|  | |

(In reply to Rob Lemley [:rjl] from [comment #7](/show_bug.cgi?id=1682101#c7 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> Created [attachment 9193173](/attachment.cgi?id=9193173 "Bug1682101-OTR.patch") [[details]](/attachment.cgi?id=9193173&action=edit "Bug1682101-OTR.patch") [[diff]](/attachment.cgi?id=9193173&action=diff "Bug1682101-OTR.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1682101&attachment=9193173)
>
> [Bug1682101](/show_bug.cgi?id=1682101 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed")-OTR.patch
>
> This is what I came up with; it does the job, but I'm not particularly crazy about it. Since we have libotr, librnp, and a couple of others, is it worthwhile trying to unify the ctypes.open loading code? I looked around for inspiration but didn't see anything.
>
> I think some simple unittests should be added as well.

Dear Mr Rob Lemley,

I think it's ok.

You should load those libs from your program path.

So this is a vuln, please patch it soon.

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1682101#c9)• 4 years ago |
|  | |

Magnus - I guess I missed Kai last week, what do you think of this approach? What about the other libs like RNP?

Flags: needinfo?(mkmelin+mozilla)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1682101#c10)• 4 years ago |
|  | |

Looks ok to me, but sorry, no real insight into what's best here. Don't we always use our own RNP?

Flags: needinfo?(mkmelin+mozilla)

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1682101#c11)• 4 years ago |
|  | |

For RNP, it first checks the application directory (and it will be there 99% of the time) but if that fails, there is a fallback to looking in standard system library locations.

<https://searchfox.org/comm-central/rev/c4336ca990fc2c70be11c7554f24bdaa40936013/mail/extensions/openpgp/content/modules/RNPLib.jsm#40-47>

And there is also potentially libgpgme: <https://searchfox.org/comm-central/source/mail/extensions/openpgp/content/modules/GPGMELib.jsm#40-47>

Honestly, this is not a Thunderbird issue. It's an insecure OS that sticks a potentially user-writable path in the search list when looking for libraries... but since that's not going to change....

If you look at the three examples I give, we have pretty much the same code copy-and-pasted to find and load these libraries. Rather than fix this for libotr and have to deal with the same problem tomorrow with libgpgme, would it make sense to write a generic loader that handles this?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1682101#c12)• 4 years ago |
|  | |

Looks like you'd need quite a bit of parametrization, which usually isn't good for readability. Maybe.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1682101#c13)• 4 years ago |
|  | |

Dear Team,

Do you have any information about this issue?

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a2688182_29811)• 4 years ago |

Flags: needinfo?(rob)

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1682101#c14)• 4 years ago |
|  | |

The attached patch should mitigate the issue, I'd like Kai to weigh in on my approach.

I thought I'd updated this bug... Thunderbird should probably not be looking for libraries that it might not find. I want to get libotr building "right" so that it's always there then we don't have this kind of issue. That work is going slowly though ([bug 1634836](/show_bug.cgi?id=1634836 "ASSIGNED - libotr not integrated into build")) so landing this fix will mitigate.

Libgpgme loading is off by default and librnp will be there with a default build.

Flags: needinfo?(rob) → needinfo?(kaie)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1682101#c15)• 4 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #1](/show_bug.cgi?id=1682101#c1 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> It appears we cannot ship OTR (incompatible license?) so we can't "fix" the bug by installing it ourselves into a place where we can expect it.

Dan, this is a misunderstanding on your side.

Thunderbird does ship OTR code by default.

We distribute LGPL shared modules.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1682101#c16)• 4 years ago |
|  | |

(In reply to Magnus Melin [:mkmelin] from [comment #5](/show_bug.cgi?id=1682101#c5 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> (In reply to Rob Lemley [:rjl] from [comment #3](/show_bug.cgi?id=1682101#c3 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))
>
> > I suggest we mitigate by only checking the application directory for libotr on Windows.
>
> Sounds good. I wouldn't think a "system otr" dll is a thing on windows.

Where does the existing code attempt to load from CWD ?

And where does the suggested patch prevent that?

Flags: needinfo?(kaie)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1682101#c17)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1682101&comment_id=15214491 "1 revision") |
|  | |

Ok, never mind, now I get it.

The code can either use an absolute path (which will limit loading from there), or using a filename w/o path, which can load from anywhere the search path configuration defines.

With your patch, your first load attempt uses useSystem=false, which causes us to construct an absolute path, using the application directory.

If that fails, on Windows and macOS you will NOT do a second attempt to load from elsewhere.

Because building OTR libs isn't yet done as part of the build, this effectively disables macOS developers from using homebrew, right?

Only on on other platforms (Linux etc.) you attempt a fallback to load files from system locations.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1682101#c18)• 4 years ago |
|  | |

So, to clarify what our bug is:

The first filename we attempt to load on Windows is a filename that we don't use in the distribution. That causes us to look for the file in alternative directories.

The remedy for the bug is to always start our search with the expected filename that we distribute. With that, the fallback is usually avoided. In order to exploit the bug, an attacker would need to delete a library from the software installation directory.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1682101#c19)• 4 years ago |
|  | |

I think the same strategy should be used for loading the RNP library.

However, for optional libraries like GPGME we need to allow the flexible approach, trying multiple filenames from multiple locations.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a2790401_36541)• 4 years ago |

Status: UNCONFIRMED → NEWComponent: Installer → SecurityEver confirmed: true

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1682101#c20)• 4 years ago |
|  | |

Dear Team,

Do you have any information about this security issue?

When will this vuln fixed?

Thanks!

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1682101#c21)• 4 years ago |
|  | |

Have you any update for this issue?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a7654666_1689)• 4 years ago |

Flags: needinfo?(kaie)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1682101#c22)• 4 years ago |
|  | |

Dear Team,

plz reply about this issue soon.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1682101#c23)• 4 years ago |
|  | |

Rob, you had not yet responded to my question in [comment 17](/show_bug.cgi?id=1682101#c17 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"), in particular:

> Because building OTR libs isn't yet done as part of the build, this effectively disables macOS developers from using homebrew, right?

Flags: needinfo?(rob)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1682101#c24)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1682101&comment_id=15323291 "1 revision") |
|  | |

Comment on [attachment 9193173](/attachment.cgi?id=9193173 "Bug1682101-OTR.patch") [[details]](/attachment.cgi?id=9193173&action=edit "Bug1682101-OTR.patch") [[diff]](/attachment.cgi?id=9193173&action=diff "Bug1682101-OTR.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1682101&attachment=9193173)

[Bug1682101](/show_bug.cgi?id=1682101 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed")-OTR.patch

[deleted - incorrect statement]

Flags: needinfo?(kaie)
[Attachment #9193173](/attachment.cgi?id=9193173&action=edit "Bug1682101-OTR.patch") -
Flags: feedback?(kaie) → feedback-

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1682101#c25)• 4 years ago |
|  | |

Sorry, my [comment 24](/show_bug.cgi?id=1682101#c24 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed") is wrong. I'm deleting it.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1682101#c26)• 4 years ago |
|  | |

In my opinion, we should allow a fallback to system directories on all platforms.

In other words, let's start by loading the expected filename from Thunderbird's directory.

If that fails (expected to fail for OTR library in developer builds ), allow loading from system directories.

We should do the same for RNP. A distribution might decide to not ship RNP, and load it from elsewhere.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1682101#c27)• 4 years ago |
|  | |

Maybe worth treating Windows differently? Doesn't seem like there's ever a need for a fallback there.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1682101#c28)• 4 years ago |
|  | |

What about Thunderbird developers who build on Windows? They won't get an OTR library as part of the build. They need to copy a downloaded library into their path.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8658250_36541)• 4 years ago |

Flags: needinfo?(rob)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8659053_36541)• 4 years ago |

[Attachment #9193173](/attachment.cgi?id=9193173&action=edit "Bug1682101-OTR.patch") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8659063_36541)• 4 years ago |

Assignee: nobody → kaie

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1682101#c29)• 4 years ago |
|  | |

Maybe have a special pref they need to set?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8659429_36541)• 4 years ago |

Summary: A security issue on your Mozilla Thunderbird Product (the newest version 78.5.1) → Thunderbird may use OTR library using a filename that isn't distributed

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1682101#c30)• 4 years ago |
|  | |

(In reply to Magnus Melin [:mkmelin] from [comment #29](/show_bug.cgi?id=1682101#c29 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> Maybe have a special pref they need to set?

Do you agree that we should be consistent across all platforms?

Let's say we require a pref for loading OTR from outside the Thunderbird distribution directory, and the default is false.

Then it would still work in all binaries that Thunderbird distributes.

However, if there is any Linux/BSD/etc. distribution that doesn't ship OTR as part of the Thunderbird package, then that distribution will fail to work. The distribution will have to change their package to set the new pref to a nonstandard value "load from the system".

Maybe this could be acceptable, but the question is, do we really need it?

What are we trying to achieve?

We want to achieve that the binary in the Thunderbird distribution directory is loaded with the highest priority. We can achieve that without a pref.

If we don't add a pref, if we always allow a fallback to load from outside the Thunderbird directory, we should still be safe - because the attacker would be required to have write access to the Thunderbird directoy, and be able to delete the primary library.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1682101#c31)• 4 years ago |
|  | |

Attached file
[Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin](attachment.cgi?id=9210769)
— [Details](attachment.cgi?id=9210769&action=edit)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1682101#c32)• 4 years ago |
|  | |

I have already tested Linux locally. We should test what console messages are printed on Windows and macOS using this patch. If the patch is correct, we should get one "trying to load" message only.

I started a try build with the patch here:

<https://treeherder.mozilla.org/jobs?repo=try-comm-central&revision=059f0d9224550850cfb0761609e1a85c360f79c2>

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1682101#c33)• 4 years ago |
|  | |

I can test on my Windows VM (win10 x64).

We have a meta bug to flag distros if they need to change something. Unfortunately, they won't see this security bug anyway. I'm on the side of not using a pref.

What if we drop the SOVERSION from the final libname? libotr.so.5 -> libotr.so? That makes this code simpler at the expense some changes to the build script. I should be able to do that easily enough.

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1682101#c34)• 4 years ago |
|  | |

See [bug 1700240](/show_bug.cgi?id=1700240 "RESOLVED FIXED - libotr in official builds should be consistently named") - libotr.dll for Windows, libotr.so for Linux, and libotr.dylib for macOS.

See Also: → [1700240](/show_bug.cgi?id=1700240 "RESOLVED FIXED - libotr in official builds should be consistently named")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1682101#c35)• 4 years ago |
|  | |

I have tested this patch and confirm it's working.

On Windows, first attempt is for libotr-5.dll and succeeds.

On macOS, first attempt is for libotr.5.dylib, which is the filename we ship.

So it should be ok to land this patch.

Loading didn't work on macOS for comm-central, because of [bug 1700349](/show_bug.cgi?id=1700349 "RESOLVED FIXED - OTR library comm-central macOS doesn't work"), which seems like a new regression.

Rob, we probably want to backport this patch to esr78 - but I wouldn't want to backport a library file rename to esr78.

So, this means, we should probably ship this patch as is, and backport.

Your new suggestion isn't bad, but it means we'll have to change this code again.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8742452_36541)• 4 years ago |

Target Milestone: --- → 89 Branch

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1682101#c36)• 4 years ago |
|  | |

<https://hg.mozilla.org/comm-central/rev/7a0a62f2aeea9ddb7c604b9e8b1cb2fb99a917d2>

Status: NEW → RESOLVEDClosed: 4 years agoResolution: --- → FIXED

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8742511_36541)• 4 years ago |

[status-thunderbird88](/buglist.cgi?f1=cf_status_thunderbird_88&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_88&o1=equals&v1=affected)
[status-thunderbird\_esr78](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=equals&v1=affected)
[tracking-thunderbird\_esr78](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=equals&v1=%3F)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1682101#c37)• 4 years ago |
|  | |

Comment on [attachment 9210769](/attachment.cgi?id=9210769 "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") [[details]](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin")

[Bug 1682101](/show_bug.cgi?id=1682101 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed") - Prefer loading of the distributed OTR library. r=mkmelin

[Approval Request Comment]

Regression caused by (bug #): no

User impact if declined: risk of loading an incorrect library

Testing completed (on c-c, etc.):

Risk to taking this patch (and alternatives if risky): low

[Attachment #9210769](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") -
Flags: approval-comm-beta?

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1682101#c38)• 4 years ago |
|  | |

Dear Team,

When will the new version published?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1682101#c39)• 4 years ago |
|  | |

It will have to go through beta. Follow this bug. Probably in 78.10 in about a month.

[tracking-thunderbird\_esr78](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr78&o1=equals&v1=%2B)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1682101#c40)• 4 years ago |
|  | |

Thanks.

Can we assign a CVE ID or have any bounty for this bug?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1682101#c41)• 4 years ago |
|  | |

Thunderbird doesn't have a bounty program.

I guess there will be a CVE.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1682101#c42)• 4 years ago |
|  | |

Oh what a pity. I saw it on scope of bounty :(

|  | [Rob Lemley [:rjl]](/user_profile?user_id=63411) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1682101#c43)• 4 years ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #35](/show_bug.cgi?id=1682101#c35 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> Rob, we probably want to backport this patch to esr78 - but I wouldn't want to backport a library file rename to esr78.
>
> So, this means, we should probably ship this patch as is, and backport.

Works for me.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1682101#c44)• 4 years ago |
|  | |

(In reply to Magnus Melin [:mkmelin] from [comment #41](/show_bug.cgi?id=1682101#c41 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> Thunderbird doesn't have a bounty program.
>
> I guess there will be a CVE.

Why has not bounty program for Thunderbird? I can't find this information anywhere.

Thunderbird is a valid product of Mozilla.

Thanks.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1682101#c45)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1682101&comment_id=15325272 "1 revision") |
|  | |

The bug bounty program is for Mozilla **Corporation** Firefox products only: <https://www.mozilla.org/en-US/security/client-bug-bounty/>

Thunderbird is its own entity, under the Mozilla Foundation.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1682101#c46)• 4 years ago |
|  | |

(In reply to Magnus Melin [:mkmelin] from [comment #45](/show_bug.cgi?id=1682101#c45 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> The bug bounty program is for Mozilla Corporation Firefox products only: <https://www.mozilla.org/en-US/security/client-bug-bounty/>
>
> Thunderbird is its own entity, under the Mozilla Foundation.

Oh i see it said: "Mozilla manages two different bug bounty programs. One focuses on Firefox and other Mozilla applications and the other covers our websites and services."

And on the hackerone, thunderbird is also on scope.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1682101#c47)• 4 years ago |
|  | |

It specifically says "Firefox, Firefox for Android, or Firefox for iOS as released by Mozilla Corporation "

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1682101#c48)• 4 years ago |
|  | |

(In reply to Tuan Vu Pham from [comment #46](/show_bug.cgi?id=1682101#c46 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> ...
>
> And on the hackerone, thunderbird is also on scope.

<https://hackerone.com/mozilla?type=team> is incorrect/out of date. Someone should correct it.

"Client Reward Guidelines

The bounty for valid critical client security bugs will be $3000 (US) cash reward and a Mozilla T-shirt. The bounty will be awarded for sec-critical and sec-high severity security bugs that meet the following criteria:

```
Security bug is present in the most recent main development (i.e., Aurora, Beta or EarlyBird, and nightly mozilla-central releases) or released versions of Firefox, Thunderbird, Firefox for Android, or in Mozilla services which could compromise users of those products, as released by Mozilla Corporation."

```

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1682101#c49)• 4 years ago |
|  | |

It also cites <https://www.mozilla.org/en-US/security/bug-bounty.html> which no longer exists.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1682101#c50)• 4 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #48](/show_bug.cgi?id=1682101#c48 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> (In reply to Tuan Vu Pham from [comment #46](/show_bug.cgi?id=1682101#c46 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))
>
> > ...
> >
> > And on the hackerone, thunderbird is also on scope.
>
> <https://hackerone.com/mozilla?type=team> is incorrect/out of date. Someone should correct it.
>
> "Client Reward Guidelines
>
> The bounty for valid critical client security bugs will be $3000 (US) cash reward and a Mozilla T-shirt. The bounty will be awarded for sec-critical and sec-high severity security bugs that meet the following criteria:
>
> ```
> Security bug is present in the most recent main development (i.e., Aurora, Beta or EarlyBird, and nightly mozilla-central releases) or released versions of Firefox, Thunderbird, Firefox for Android, or in Mozilla services which could compromise users of those products, as released by Mozilla Corporation."
>
> ```

Yes, so i just think Mozilla has bug bounty program with thunderbird because nowhere said not :D

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1682101#c51)• 4 years ago |
|  | |

I wonder which security severity rating should be assigned to this issue.

<https://wiki.mozilla.org/Security_Severity_Ratings/Client>

In order to exploit this issue, it isn't sufficient to simply download a file. The file must be copied to a directory in the execution PATH.

That is, anyone trying to abuse this issue needs to have access to the victim's name, must prepare a library with the correct name, and must have permission to copy it to one of the directories listed in PATH (or have permission to change the PATH variable).

Given that access to the victim's machine is required, I'm not sure if this qualifies as a security issue.

Is this simply a correctness fix?

Flags: needinfo?(tom)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1682101#c52)• 4 years ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #51](/show_bug.cgi?id=1682101#c51 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> I wonder which security severity rating should be assigned to this issue.
>
> <https://wiki.mozilla.org/Security_Severity_Ratings/Client>
>
> In order to exploit this issue, it isn't sufficient to simply download a file. The file must be copied to a directory in the execution PATH.
>
> That is, anyone trying to abuse this issue needs to have access to the victim's name, must prepare a library with the correct name, and must have permission to copy it to one of the directories listed in PATH (or have permission to change the PATH variable).
>
> Given that access to the victim's machine is required, I'm not sure if this qualifies as a security issue.
>
> Is this simply a correctness fix?

Oh, your product didn't check the loaded dll, it drives to load an arbitrary code. I sure that it is a security issue.

What do you think whenever your product run, a malware is called and attacker compromised your system?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1682101#c53)• 4 years ago |
|  | |

How does the malware get placed on the computer and into the executable directory?

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1682101#c54)• 4 years ago |
|  | |

(In reply to Kai Engert (:KaiE:) from [comment #53](/show_bug.cgi?id=1682101#c53 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> How does the malware get placed on the computer and into the executable directory?

It is infection step, attacker use this issue for execution step.

And attacker use it to hide from defense system to detect because the malware is loaded by a signed process.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1682101#c55)• 4 years ago |
|  | |

<https://attack.mitre.org/techniques/T1574/001/>

From mitre attack

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1682101#c56)• 4 years ago |
|  | |

I will work to correct the Hacker One profile - I didn't know that even existed.

My opinion on severity would be sec-low or sec-moderate. Not higher, certainly, because you need to be on the machine to begin with. But at least sec-low because in some configurations at least a differently- or lower-privileged process/user could use it to get code execution in Thunderbird and steal data. Maybe Dan has an opinion.

Flags: needinfo?(tom) → needinfo?(dveditz)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1682101#c57)• 4 years ago |
|  | |

<https://attack.mitre.org/techniques/T1574/001/>

From mitre attack(In reply to Tom Ritter [:tjr] (ni? for response to sec-[advisories/bounties/ratings/cves]) from [comment #56](/show_bug.cgi?id=1682101#c56 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> I will work to correct the Hacker One profile - I didn't know that even existed.
>
> My opinion on severity would be sec-low or sec-moderate. Not higher, certainly, because you need to be on the machine to begin with. But at least sec-low because in some configurations at least a differently- or lower-privileged process/user could use it to get code execution in Thunderbird and steal data. Maybe Dan has an opinion.

Thanks. What about before you work to correct? Has any bounty for this bug?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a8833137_36541)• 4 years ago |

Regressions: [1700506](/show_bug.cgi?id=1700506 "RESOLVED FIXED - Perma comm/mail/test/browser/account/browser_actions.js | A promise chain failed to handle a rejection: Generating OTR private key failed: Error: Error: open requires a single argument - stack: reportKeyGenFailure@resource:///modules/OTRUI.jsm:213:11")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1682101#c58)• 4 years ago |
|  | |

> Thanks. What about before you work to correct? Has any bounty for this bug?

We are not responsible for what HackerOne puts on their site. Our actual bounty program is published at <https://www.mozilla.org/en-US/security/bug-bounty/> and has been there for longer than HackerOne has existed. The details change from time to time, and currently our client bounty is focused on the Firefox family of products (desktop and mobile).

Flags: needinfo?(dveditz)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a9025771_36541)• 4 years ago |

[Attachment #9210769](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") -
Flags: approval-comm-esr78?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1682101#c59)• 4 years ago |
|  | |

requires follow-up fix from [bug 1700506](/show_bug.cgi?id=1700506 "RESOLVED FIXED - Perma comm/mail/test/browser/account/browser_actions.js | A promise chain failed to handle a rejection: Generating OTR private key failed: Error: Error: open requires a single argument - stack: reportKeyGenFailure@resource:///modules/OTRUI.jsm:213:11")

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1682101#c60)• 4 years ago |
|  | |

Comment on [attachment 9210769](/attachment.cgi?id=9210769 "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") [[details]](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin")

[Bug 1682101](/show_bug.cgi?id=1682101 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed") - Prefer loading of the distributed OTR library. r=mkmelin

[Triage Comment]

Approved for beta ...

(In reply to Kai Engert (:KaiE:) from [comment #59](/show_bug.cgi?id=1682101#c59 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed"))

> requires follow-up fix from [bug 1700506](/show_bug.cgi?id=1700506 "RESOLVED FIXED - Perma comm/mail/test/browser/account/browser_actions.js | A promise chain failed to handle a rejection: Generating OTR private key failed: Error: Error: open requires a single argument - stack: reportKeyGenFailure@resource:///modules/OTRUI.jsm:213:11")

Flags: needinfo?(justdave)
[Attachment #9210769](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") -
Flags: approval-comm-beta? → approval-comm-beta+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1682101#c61)• 4 years ago |
|  | |

<https://hg.mozilla.org/releases/comm-beta/rev/3bcac011ed5abc0d6d95655f8d8d5eec7c317a3c>

88.0b2

[status-thunderbird88](/buglist.cgi?f1=cf_status_thunderbird_88&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_88&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_thunderbird_88&o1=equals&v1=fixed)

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1682101#c62)• 4 years ago |
|  | |

I'm assuming I got NIed so I could uplift it, but it seems Kai has done that already. If that wasn't what you needed from me, feel free to NI again.

Flags: needinfo?(justdave)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1682101#c63)• 4 years ago |
|  | |

Comment on [attachment 9210769](/attachment.cgi?id=9210769 "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") [[details]](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin")

[Bug 1682101](/show_bug.cgi?id=1682101 "RESOLVED FIXED - Thunderbird may use OTR library using a filename that isn't distributed") - Prefer loading of the distributed OTR library. r=mkmelin

[Triage Comment]

Approved for esr78

[Attachment #9210769](/attachment.cgi?id=9210769&action=edit "Bug 1682101 - Prefer loading of the distributed OTR library. r=mkmelin") -
Flags: approval-comm-esr78? → approval-comm-esr78+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1682101#c64)• 4 years ago |
|  | |

<https://hg.mozilla.org/releases/comm-esr78/rev/7107970bf16e2729bb939ae4ef174f04b5341b9f>

78.9.1

[status-thunderbird\_esr78](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr78&o1=equals&v1=fixed)

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1682101#c65)• 4 years ago |
|  | |

Dear Team,

Is this patch released?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1682101#c66)• 4 years ago |
|  | |

Yes, in Thunderbird 78.9.1 and above.

|  | [Tuan Vu Pham](/user_profile?user_id=676018)  Reporter |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1682101#c67)• 4 years ago |
|  | |

Yeah, is this bug a security problem?

I have not seen it on the security advisor of thunderbird.

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1682101#c68)• 4 years ago |
|  | |

Theoretically, a small one yes, so good to fix. In practice, not very useful for an attacker who would have to have been able to put the dll in one of these system dirs. If he could do that, there are just easier ways to do more, in easier ways than tricking Thunderbird to load it.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a11168482_578488)• 4 years ago |

Alias: CVE-2021-29949

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1682101#a29888740_1689)• 3 years ago |

Group: mail-core-security
You need to [log in](/show_bug.cgi?id=1682101&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Rob Lemley [:rjl]](/user_profile?user_id=63411)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


