=== Content from rustsec.org_581d1217_20250114_220715.html ===


RUSTSEC-2021-0044: rocket: Use after free possible in `uri::Formatter` on panic › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/rocket/RUSTSEC-2021-0044.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/rocket/RUSTSEC-2021-0044.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0044)

# RUSTSEC-2021-0044

Use after free possible in `uri::Formatter` on panic

Reported
February 9, 2021

Issued
March 26, 2021

(last modified: June 13, 2023)

Package
[rocket](/packages/rocket.html)
([crates.io](https://crates.io/crates/rocket))

Type
INFO
Unsound

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#memory-safety](/keywords/memory-safety.html)
[#use-after-free](/keywords/use-after-free.html)

Aliases

* [CVE-2021-29935](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29935)
* [GHSA-vcw4-8ph6-7vw8](https://github.com/advisories/GHSA-vcw4-8ph6-7vw8)

References

* <https://github.com/SergioBenitez/Rocket/issues/1534>

CVSS Score
7.3
HIGH

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityLow
IntegrityLow
AvailabilityLow

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L)
Patched

* `>=0.4.7`

### Description

Affected versions of this crate transmuted a `&str` to a `&'static str` before
pushing it into a `StackVec`, this value was then popped later in the same
function.

This was assumed to be safe because the reference would be valid while the
method's stack was active. In between the push and the pop, however, a function
`f` was called that could invoke a user provided function.

If the user provided panicked, then the assumption used by the function was no
longer true and the transmute to `&'static` would create an illegal static
reference to the string. This could result in a freed string being used during
(such as in a `Drop` implementation) or after (e.g through `catch_unwind`) the
panic unwinding.

This flaw was corrected in commit [e325e2f](https://github.com/SergioBenitez/Rocket/commit/e325e2fce4d9f9f392761e9fb58b418a48cef8bb)
by using a guard object to ensure that the `&'static str` was dropped inside
the function.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


