=== Content from github.com_0ae54b10_20250114_191121.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Freleases%2Ftag%2Fv2.3.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Freleases%2Ftag%2Fv2.3.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent/tree/v2.3.0)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent/tree/v2.3.0)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

1. [Releases](/matrix-org/sydent/releases)
2. [v2.3.0](/matrix-org/sydent/releases/tag/v2.3.0)

# Sydent 2.3.0 (2021-04-15)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/sydent/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.3.0)

 Loading

[View all tags](/matrix-org/sydent/tags)

![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)
[richvdh](/richvdh)
released this
15 Apr 11:12

[v2.3.0](/matrix-org/sydent/tree/v2.3.0)

This tag was signed with the committer’s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/1389908?s=64&v=4)](/richvdh)
[richvdh](/richvdh)
Richard van der Hoff

GPG key ID: 392A2BD3423D78FF
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`c2ab108`](/matrix-org/sydent/commit/c2ab10897500dbba1c0d4be33f42985d81bbad7d)

**Note**: this will be the last release of Sydent to support Python 3.5 or earlier. Future releases will require at least Python 3.6.

## Security advisory

This release contains fixes to the following security issues:

* Denial of service attack via disk space or memory exhaustion ([CVE-2021-29430](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29430)).
* SSRF due to missing validation of hostnames ([CVE-2021-29431](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29431)).
* Malicious users could control the content of invitation emails ([CVE-2021-29432](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29432)).
* Denial of service (via resource exhaustion) due to improper input validation ([CVE-2021-29433](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29433)).

Although we are not aware of these vulnerabilities being exploited in the wild, Sydent server administrators are advised to update as soon as possible. Note that as well as changes to the package, there are also changes to the default email templates. If any templates have been updated locally, they must also be updated in line with the changes to the defaults for full protection from [CVE-2021-29432](https://github.com/advisories/GHSA-mh74-4m5g-fcjx "CVE-2021-29432").

## Features

* Accept an optional `web_client_location` argument to the invite endpoint which allows customisation of the email template. ([#326](https://github.com/matrix-org/sydent/issues/326))
* Move templates to a per-brand subdirectory of `/res`. Add `templates.path` and `brand.default` config options. ([#328](https://github.com/matrix-org/sydent/issues/328))

## Bugfixes

* Fix a regression in v2.2.0 where the wrong characters would be obfuscated in a 3pid invite. ([#317](https://github.com/matrix-org/sydent/issues/317))
* Fix a long-standing bug where invalid JSON would be accepted over the HTTP interfaces. ([#337](https://github.com/matrix-org/sydent/issues/337))
* During user registration on the identity server, validate that the MXID returned by the contacted homeserver is valid for that homeserver. ([cc97fff](https://github.com/matrix-org/sydent/commit/cc97fff))
* Ensure that `/v2/` endpoints are correctly authenticated. ([ce04a68](https://github.com/matrix-org/sydent/commit/ce04a68))
* Perform additional validation on the response received when requesting server signing keys. ([07e6da7](https://github.com/matrix-org/sydent/commit/07e6da7))
* Validate the `matrix_server_name` parameter given during user registration. ([9e57334](https://github.com/matrix-org/sydent/commit/9e57334), [8936925](https://github.com/matrix-org/sydent/commit/8936925), [3d531ed](https://github.com/matrix-org/sydent/commit/3d531ed), [0f00412](https://github.com/matrix-org/sydent/commit/0f00412))
* Limit the size of requests received from HTTP clients. ([89071a1](https://github.com/matrix-org/sydent/commit/89071a1), [0523511](https://github.com/matrix-org/sydent/commit/0523511), [f56eee3](https://github.com/matrix-org/sydent/commit/f56eee3))
* Limit the size of responses received from HTTP servers. ([89071a1](https://github.com/matrix-org/sydent/commit/89071a1), [0523511](https://github.com/matrix-org/sydent/commit/0523511), [f56eee3](https://github.com/matrix-org/sydent/commit/f56eee3))
* In invite emails, randomise the multipart boundary, and include MXIDs where available. ([4469d1d](https://github.com/matrix-org/sydent/commit/4469d1d), [6b405a8](https://github.com/matrix-org/sydent/commit/6b405a8), [65a6e91](https://github.com/matrix-org/sydent/commit/65a6e91))
* Perform additional validation on the `client_secret` and `email` parameters to various APIs. ([3175fd3](https://github.com/matrix-org/sydent/commit/3175fd3))

## Updates to the Docker image

* Base docker image on Debian rather than Alpine Linux. ([#335](https://github.com/matrix-org/sydent/issues/335))

## Internal Changes

* Fix test logging to allow braces in log output. ([#318](https://github.com/matrix-org/sydent/issues/318))
* Install prometheus\_client in the Docker image. ([#325](https://github.com/matrix-org/sydent/issues/325))
* Bump the version of signedjson to 1.1.1. ([#334](https://github.com/matrix-org/sydent/issues/334))

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a082e57f_20250114_191117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F89071a1a754c69a50deac89e6bb74002d4cda19d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F89071a1a754c69a50deac89e6bb74002d4cda19d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/89071a1a754c69a50deac89e6bb74002d4cda19d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Limit maximum request size.

[Browse files](/matrix-org/sydent/tree/89071a1a754c69a50deac89e6bb74002d4cda19d)
Browse the repository at this point in the history

```
Request size shouldn't be unbounded because there is no need for it and
it can lead to DoS in some cases.
```

* Loading branch information

Denis Kasak
committed
Apr 6, 2021

1 parent
[c951f17](/matrix-org/sydent/commit/c951f17c40f5b4ac9916738c82229f585e3c0c3a)

commit 89071a1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**22 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent/http

  + sydent/http/httpcommon.py
    [httpcommon.py](#diff-7bb88e4c6412bb64ae44f77259110a1662582b99db82ddef9dc96ebfdd002da9)
  + sydent/http/httpserver.py
    [httpserver.py](#diff-9b769944fb8322df3611a5e28b73cab03df02b1569ea0b607b51713871ef30f9)

## There are no files selected for viewing

23 changes: 20 additions & 3 deletions

23
[sydent/http/httpcommon.py](#diff-7bb88e4c6412bb64ae44f77259110a1662582b99db82ddef9dc96ebfdd002da9 "sydent/http/httpcommon.py")

Show comments

[View file](/matrix-org/sydent/blob/89071a1a754c69a50deac89e6bb74002d4cda19d/sydent/http/httpcommon.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,9 +23,15 @@ |
|  |  | from twisted.web.\_newclient import ResponseDone |
|  |  | from twisted.web.http import PotentialDataLoss |
|  |  | from twisted.web.iweb import UNKNOWN\_LENGTH |
|  |  | from twisted.web import server |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
|  |  | # Arbitrarily limited to 512 KiB. |
|  |  | MAX\_REQUEST\_SIZE = 512 \* 1024 |
|  |  |  |
|  |  |  |
|  |  | class SslComponents: |
|  |  | def \_\_init\_\_(self, sydent): |
|  |  | self.sydent = sydent |
| Expand Down  Expand Up | | @@ -61,7 +67,7 @@ def makeTrustRoot(self): |
|  |  | fp = open(caCertFilename) |
|  |  | caCert = twisted.internet.ssl.Certificate.loadPEM(fp.read()) |
|  |  | fp.close() |
|  |  | except: |
|  |  | except Exception: |
|  |  | logger.warn("Failed to open CA cert file %s", caCertFilename) |
|  |  | raise |
|  |  | logger.warn("Using custom CA cert file: %s", caCertFilename) |
| Expand All | | @@ -70,7 +76,6 @@ def makeTrustRoot(self): |
|  |  | return twisted.internet.ssl.OpenSSLDefaultPaths() |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | class BodyExceededMaxSize(Exception): |
|  |  | """The maximum allowed size of the HTTP body was exceeded.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -123,7 +128,7 @@ def dataReceived(self, data) -> None: |
|  |  | # discarded anyway. |
|  |  | self.transport.abortConnection() |
|  |  |  |
|  |  | def connectionLost(self, reason = connectionDone) -> None: |
|  |  | def connectionLost(self, reason=connectionDone) -> None: |
|  |  | # If the maximum size was already exceeded, there's nothing to do. |
|  |  | if self.deferred.called: |
|  |  | return |
| Expand Down  Expand Up | | @@ -163,3 +168,15 @@ def read\_body\_with\_max\_size(response, max\_size): |
|  |  |  |
|  |  | response.deliverBody(\_ReadBodyWithMaxSizeProtocol(d, max\_size)) |
|  |  | return d |
|  |  |  |
|  |  |  |
|  |  | class SizeLimitingRequest(server.Request): |
|  |  | def handleContentChunk(self, data): |
|  |  | if self.content.tell() + len(data) > MAX\_REQUEST\_SIZE: |
|  |  | logger.info( |
|  |  | "Aborting connection from %s because the request exceeds maximum size", |
|  |  | self.client.host) |
|  |  | self.transport.abortConnection() |
|  |  | return |
|  |  |  |
|  |  | return super().handleContentChunk(data) |

2 changes: 2 additions & 0 deletions

2
[sydent/http/httpserver.py](#diff-9b769944fb8322df3611a5e28b73cab03df02b1569ea0b607b51713871ef30f9 "sydent/http/httpserver.py")

Show comments

[View file](/matrix-org/sydent/blob/89071a1a754c69a50deac89e6bb74002d4cda19d/sydent/http/httpserver.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,6 +29,7 @@ |
|  |  | from sydent.http.servlets.authenticated\_unbind\_threepid\_servlet import ( |
|  |  | AuthenticatedUnbindThreePidServlet, |
|  |  | ) |
|  |  | from sydent.http.httpcommon import SizeLimitingRequest |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand Down  Expand Up | | @@ -129,6 +130,7 @@ def \_\_init\_\_(self, sydent): |
|  |  | v2.putChild(b'hash\_details', self.sydent.servlets.hash\_details) |
|  |  |  |
|  |  | self.factory = Site(root) |
|  |  | self.factory.requestFactory = SizeLimitingRequest |
|  |  | self.factory.displayTracebacks = False |
|  |  |  |
|  |  | def setup(self): |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `89071a1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F89071a1a754c69a50deac89e6bb74002d4cda19d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0921ac3e_20250114_191116.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0523511d2fb40f2738f8a8549868f44b96e5dab7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0523511d2fb40f2738f8a8549868f44b96e5dab7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/0523511d2fb40f2738f8a8549868f44b96e5dab7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Limit the size of .well-known lookups.

[Browse files](/matrix-org/sydent/tree/0523511d2fb40f2738f8a8549868f44b96e5dab7)
Browse the repository at this point in the history

```
This is a port of [matrix-org/synapse#8950](https://github.com/matrix-org/synapse/pull/8950) and [matrix-org/synapse#9108](https://github.com/matrix-org/synapse/pull/9108).

This is not a straight port, the code is simplified a bit:

* Type hints are removed since sydent supports Python 2.7.
* The size of the response is not returned, only the bytes.
```

* Loading branch information

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

[clokep](/matrix-org/sydent/commits?author=clokep "View all commits by clokep")
committed
Mar 17, 2021

1 parent
[4d96e71](/matrix-org/sydent/commit/4d96e71bfe036e946d0335b729e1c4cff3093645)

commit 0523511

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**108 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent/http

  + sydent/http/httpcommon.py
    [httpcommon.py](#diff-7bb88e4c6412bb64ae44f77259110a1662582b99db82ddef9dc96ebfdd002da9)
  + sydent/http/matrixfederationagent.py
    [matrixfederationagent.py](#diff-a961a1d757fa4859fb3eb37e34a1e140a1714dd2ca359307fc340782a90c62e1)

## There are no files selected for viewing

101 changes: 101 additions & 0 deletions

101
[sydent/http/httpcommon.py](#diff-7bb88e4c6412bb64ae44f77259110a1662582b99db82ddef9dc96ebfdd002da9 "sydent/http/httpcommon.py")

Show comments

[View file](/matrix-org/sydent/blob/0523511d2fb40f2738f8a8549868f44b96e5dab7/sydent/http/httpcommon.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,8 +15,14 @@ |
|  |  | # limitations under the License. |
|  |  |  |
|  |  | import logging |
|  |  | from io import BytesIO |
|  |  |  |
|  |  | import twisted.internet.ssl |
|  |  | from twisted.internet import defer, protocol |
|  |  | from twisted.internet.protocol import connectionDone |
|  |  | from twisted.web.\_newclient import ResponseDone |
|  |  | from twisted.web.http import PotentialDataLoss |
|  |  | from twisted.web.iweb import UNKNOWN\_LENGTH |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand Down  Expand Up | | @@ -62,3 +68,98 @@ def makeTrustRoot(self): |
|  |  | return twisted.internet.\_sslverify.OpenSSLCertificateAuthorities([caCert.original]) |
|  |  | else: |
|  |  | return twisted.internet.ssl.OpenSSLDefaultPaths() |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | class BodyExceededMaxSize(Exception): |
|  |  | """The maximum allowed size of the HTTP body was exceeded.""" |
|  |  |  |
|  |  |  |
|  |  | class \_DiscardBodyWithMaxSizeProtocol(protocol.Protocol): |
|  |  | """A protocol which immediately errors upon receiving data.""" |
|  |  |  |
|  |  | def \_\_init\_\_(self, deferred): |
|  |  | self.deferred = deferred |
|  |  |  |
|  |  | def \_maybe\_fail(self): |
|  |  | """ |
|  |  | Report a max size exceed error and disconnect the first time this is called. |
|  |  | """ |
|  |  | if not self.deferred.called: |
|  |  | self.deferred.errback(BodyExceededMaxSize()) |
|  |  | # Close the connection (forcefully) since all the data will get |
|  |  | # discarded anyway. |
|  |  | self.transport.abortConnection() |
|  |  |  |
|  |  | def dataReceived(self, data) -> None: |
|  |  | self.\_maybe\_fail() |
|  |  |  |
|  |  | def connectionLost(self, reason) -> None: |
|  |  | self.\_maybe\_fail() |
|  |  |  |
|  |  |  |
|  |  | class \_ReadBodyWithMaxSizeProtocol(protocol.Protocol): |
|  |  | """A protocol which reads body to a stream, erroring if the body exceeds a maximum size.""" |
|  |  |  |
|  |  | def \_\_init\_\_(self, deferred, max\_size): |
|  |  | self.stream = BytesIO() |
|  |  | self.deferred = deferred |
|  |  | self.length = 0 |
|  |  | self.max\_size = max\_size |
|  |  |  |
|  |  | def dataReceived(self, data) -> None: |
|  |  | # If the deferred was called, bail early. |
|  |  | if self.deferred.called: |
|  |  | return |
|  |  |  |
|  |  | self.stream.write(data) |
|  |  | self.length += len(data) |
|  |  | # The first time the maximum size is exceeded, error and cancel the |
|  |  | # connection. dataReceived might be called again if data was received |
|  |  | # in the meantime. |
|  |  | if self.max\_size is not None and self.length >= self.max\_size: |
|  |  | self.deferred.errback(BodyExceededMaxSize()) |
|  |  | # Close the connection (forcefully) since all the data will get |
|  |  | # discarded anyway. |
|  |  | self.transport.abortConnection() |
|  |  |  |
|  |  | def connectionLost(self, reason = connectionDone) -> None: |
|  |  | # If the maximum size was already exceeded, there's nothing to do. |
|  |  | if self.deferred.called: |
|  |  | return |
|  |  |  |
|  |  | if reason.check(ResponseDone): |
|  |  | self.deferred.callback(self.stream.getvalue()) |
|  |  | elif reason.check(PotentialDataLoss): |
|  |  | # stolen from https://github.com/twisted/treq/pull/49/files |
|  |  | # http://twistedmatrix.com/trac/ticket/4840 |
|  |  | self.deferred.callback(self.stream.getvalue()) |
|  |  | else: |
|  |  | self.deferred.errback(reason) |
|  |  |  |
|  |  |  |
|  |  | def read\_body\_with\_max\_size(response, max\_size): |
|  |  | """ |
|  |  | Read a HTTP response body to a file-object. Optionally enforcing a maximum file size. |
|  |  |  |
|  |  | If the maximum file size is reached, the returned Deferred will resolve to a |
|  |  | Failure with a BodyExceededMaxSize exception. |
|  |  |  |
|  |  | Args: |
|  |  | response: The HTTP response to read from. |
|  |  | max\_size: The maximum file size to allow. |
|  |  |  |
|  |  | Returns: |
|  |  | A Deferred which resolves to the read body. |
|  |  | """ |
|  |  | d = defer.Deferred() |
|  |  |  |
|  |  | # If the Content-Length header gives a size larger than the maximum allowed |
|  |  | # size, do not bother downloading the body. |
|  |  | if max\_size is not None and response.length != UNKNOWN\_LENGTH: |
|  |  | if response.length > max\_size: |
|  |  | response.deliverBody(\_DiscardBodyWithMaxSizeProtocol(d)) |
|  |  | return d |
|  |  |  |
|  |  | response.deliverBody(\_ReadBodyWithMaxSizeProtocol(d, max\_size)) |
|  |  | return d |

9 changes: 7 additions & 2 deletions

9
[sydent/http/matrixfederationagent.py](#diff-a961a1d757fa4859fb3eb37e34a1e140a1714dd2ca359307fc340782a90c62e1 "sydent/http/matrixfederationagent.py")

Show comments

[View file](/matrix-org/sydent/blob/0523511d2fb40f2738f8a8549868f44b96e5dab7/sydent/http/matrixfederationagent.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,11 +26,12 @@ |
|  |  | from twisted.internet import defer |
|  |  | from twisted.internet.endpoints import HostnameEndpoint, wrapClientTLS |
|  |  | from twisted.internet.interfaces import IStreamClientEndpoint |
|  |  | from twisted.web.client import URI, Agent, HTTPConnectionPool, RedirectAgent, readBody |
|  |  | from twisted.web.client import URI, Agent, HTTPConnectionPool, RedirectAgent |
|  |  | from twisted.web.http import stringToDatetime |
|  |  | from twisted.web.http\_headers import Headers |
|  |  | from twisted.web.iweb import IAgent |
|  |  |  |
|  |  | from sydent.http.httpcommon import BodyExceededMaxSize, read\_body\_with\_max\_size |
|  |  | from sydent.http.srvresolver import SrvResolver, pick\_server\_from\_list |
|  |  | from sydent.util.ttlcache import TTLCache |
|  |  |  |
| Expand All | | @@ -46,6 +47,9 @@ |
|  |  | # cap for .well-known cache period |
|  |  | WELL\_KNOWN\_MAX\_CACHE\_PERIOD = 48 \* 3600 |
|  |  |  |
|  |  | # The maximum size (in bytes) to allow a well-known file to be. |
|  |  | WELL\_KNOWN\_MAX\_SIZE = 50 \* 1024 # 50 KiB |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  | well\_known\_cache = TTLCache('well-known') |
|  |  |  |
| Expand Down  Expand Up | | @@ -316,7 +320,7 @@ def \_do\_get\_well\_known(self, server\_name): |
|  |  | logger.info("Fetching %s", uri\_str) |
|  |  | try: |
|  |  | response = yield self.\_well\_known\_agent.request(b"GET", uri) |
|  |  | body = yield readBody(response) |
|  |  | body = yield read\_body\_with\_max\_size(response, WELL\_KNOWN\_MAX\_SIZE) |
|  |  | if response.code != 200: |
|  |  | raise Exception("Non-200 response %s" % (response.code, )) |
|  |  |  |
| Expand All | | @@ -334,6 +338,7 @@ def \_do\_get\_well\_known(self, server\_name): |
|  |  | cache\_period = WELL\_KNOWN\_INVALID\_CACHE\_PERIOD |
|  |  | cache\_period += random.uniform(0, WELL\_KNOWN\_DEFAULT\_CACHE\_PERIOD\_JITTER) |
|  |  | defer.returnValue((None, cache\_period)) |
|  |  | return |
|  |  |  |
|  |  | result = parsed\_body["m.server"].encode("ascii") |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0523511`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0523511d2fb40f2738f8a8549868f44b96e5dab7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from pypi.org_1168f50a_20250114_191122.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn’t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from github.com_91d59c94_20250114_191122.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fsecurity%2Fadvisories%2FGHSA-wmg4-8cp2-hpg9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fsecurity%2Fadvisories%2FGHSA-wmg4-8cp2-hpg9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

# Denial of service attack via disk space or memory exhaustion

Moderate

[richvdh](/richvdh)
published
GHSA-wmg4-8cp2-hpg9
Apr 15, 2021

## Package

pip

matrix-sydent
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<= 2.2.0

## Patched versions

2.3.0

## Description

### Impact

Sydent does not limit the size of requests it receives from HTTP clients. A malicious user could send an HTTP request with a very large body, leading to disk space exhaustion and denial of service.

Sydent also does not limit response size for requests it makes to remote Matrix homeservers. A malicious homeserver could return a very large response, again leading to memory exhaustion and denial of service.

This affects any server which accepts registration requests from untrusted clients.

### Patches

Patched by [89071a1](https://github.com/matrix-org/sydent/commit/89071a1a754c69a50deac89e6bb74002d4cda19d), [0523511](https://github.com/matrix-org/sydent/commit/0523511d2fb40f2738f8a8549868f44b96e5dab7), [f56eee3](https://github.com/matrix-org/sydent/commit/f56eee315b6c44fdd9f6aa785cc2ec744a594428).

### Workarounds

Request sizes can be limited in an HTTP reverse-proxy.

There are no known workarounds for the problem with overlarge responses.

### References

n/a

### For more information

If you have any questions or comments about this advisory, email us at security@matrix.org.

### Severity

Moderate

### CVE ID

CVE-2021-29430

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8d075e0f_20250114_191118.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2Ff56eee315b6c44fdd9f6aa785cc2ec744a594428)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2Ff56eee315b6c44fdd9f6aa785cc2ec744a594428)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/f56eee315b6c44fdd9f6aa785cc2ec744a594428)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add max size for other HTTP calls.

[Browse files](/matrix-org/sydent/tree/f56eee315b6c44fdd9f6aa785cc2ec744a594428)
Browse the repository at this point in the history

* Loading branch information

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

[clokep](/matrix-org/sydent/commits?author=clokep "View all commits by clokep")
committed
Mar 17, 2021

1 parent
[0523511](/matrix-org/sydent/commit/0523511d2fb40f2738f8a8549868f44b96e5dab7)

commit f56eee3

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**13 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent

  + hs\_federation

    - sydent/hs\_federation/verifier.py
      [verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd)
  + http

    - sydent/http/httpclient.py
      [httpclient.py](#diff-203d0f99b7ac9eac8535e83cbae93ee7b5a2609803c67775d4d330b316d11620)
    - servlets

      * sydent/http/servlets/registerservlet.py
        [registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[sydent/hs\_federation/verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd "sydent/hs_federation/verifier.py")

Show comments

[View file](/matrix-org/sydent/blob/f56eee315b6c44fdd9f6aa785cc2ec744a594428/sydent/hs_federation/verifier.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,7 +69,7 @@ def \_getKeysForServer(self, server\_name): |
|  |  | defer.returnValue(self.cache[server\_name]['verify\_keys']) |
|  |  |  |
|  |  | client = FederationHttpClient(self.sydent) |
|  |  | result = yield client.get\_json("matrix://%s/\_matrix/key/v2/server/" % server\_name) |
|  |  | result = yield client.get\_json("matrix://%s/\_matrix/key/v2/server/" % server\_name, 1024 \* 50) |
|  |  | if 'verify\_keys' not in result: |
|  |  | raise SignatureVerifyException("No key found in response") |
|  |  |  |
| Expand Down | |  |

14 changes: 11 additions & 3 deletions

14
[sydent/http/httpclient.py](#diff-203d0f99b7ac9eac8535e83cbae93ee7b5a2609803c67775d4d330b316d11620 "sydent/http/httpclient.py")

Show comments

[View file](/matrix-org/sydent/blob/f56eee315b6c44fdd9f6aa785cc2ec744a594428/sydent/http/httpclient.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,7 @@ |
|  |  | from sydent.http.matrixfederationagent import MatrixFederationAgent |
|  |  |  |
|  |  | from sydent.http.federation\_tls\_options import ClientTLSOptionsFactory |
|  |  | from sydent.http.httpcommon import BodyExceededMaxSize, read\_body\_with\_max\_size |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand All | | @@ -34,12 +35,15 @@ class HTTPClient(object): |
|  |  | requests. |
|  |  | """ |
|  |  | @defer.inlineCallbacks |
|  |  | def get\_json(self, uri): |
|  |  | def get\_json(self, uri, max\_size = None): |
|  |  | """Make a GET request to an endpoint returning JSON and parse result |
|  |  |  |
|  |  | :param uri: The URI to make a GET request to. |
|  |  | :type uri: unicode |
|  |  |  |
|  |  | :param max\_size: The maximum size (in bytes) to allow as a response. |
|  |  | :type max\_size: int |
|  |  |  |
|  |  | :return: A deferred containing JSON parsed into a Python object. |
|  |  | :rtype: twisted.internet.defer.Deferred[dict[any, any]] |
|  |  | """ |
| Expand All | | @@ -49,7 +53,7 @@ def get\_json(self, uri): |
|  |  | b"GET", |
|  |  | uri.encode("utf8"), |
|  |  | ) |
|  |  | body = yield readBody(response) |
|  |  | body = yield read\_body\_with\_max\_size(response, max\_size) |
|  |  | try: |
|  |  | # json.loads doesn't allow bytes in Python 3.5 |
|  |  | json\_body = json.loads(body.decode("UTF-8")) |
| Expand Down  Expand Up | | @@ -94,7 +98,11 @@ def post\_json\_get\_nothing(self, uri, post\_json, opts): |
|  |  | # Ensure the body object is read otherwise we'll leak HTTP connections |
|  |  | # as per |
|  |  | # https://twistedmatrix.com/documents/current/web/howto/client.html |
|  |  | yield readBody(response) |
|  |  | try: |
|  |  | # TODO Will this cause the server to think the request was a failure? |
|  |  | yield read\_body\_with\_max\_size(response, 0) |
|  |  | except BodyExceededMaxSize: |
|  |  | pass |
|  |  |  |
|  |  | defer.returnValue(response) |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[sydent/http/servlets/registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34 "sydent/http/servlets/registerservlet.py")

Show comments

[View file](/matrix-org/sydent/blob/f56eee315b6c44fdd9f6aa785cc2ec744a594428/sydent/http/servlets/registerservlet.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,7 @@ def render\_POST(self, request): |
|  |  | "matrix://%s/\_matrix/federation/v1/openid/userinfo?access\_token=%s" % ( |
|  |  | args['matrix\_server\_name'], urllib.parse.quote(args['access\_token']), |
|  |  | ), |
|  |  | 1024 \* 5, |
|  |  | ) |
|  |  | if 'sub' not in result: |
|  |  | raise Exception("Invalid response from homeserver") |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f56eee3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2Ff56eee315b6c44fdd9f6aa785cc2ec744a594428) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


