=== Content from deepsurface.com_66506520_20250114_183722.html ===

[Skip to content](#content)
[![deepsurface logo](https://deepsurface.com/wp-content/uploads/2024/06/logo-primary.svg)](https://deepsurface.com)

* [Product](https://deepsurface.com/product/)
  + [Executive Reporting](https://deepsurface.com/executive-reporting/)+ [Remediation Workflow](https://deepsurface.com/remediation-workflow-manager/)
* [Partners](https://deepsurface.com/partners/)
  + [Integrations](https://deepsurface.com/integrations/)
* [Resources](/resources)
  + [Documentation](https://docs.deepsurface.com/documentation.html#help_page=documentation_index)+ [Blog](/resources)+ [Case Studies](/category/case-study/)+ [News](/category/news/)+ [Self Paced Demo](/category/self-paced-demo/)
* [About](/about/)
  + [Mission](/about/#mission)+ [Diversity & Inclusion](/about/#diversity)+ [Join Our Team](https://deepsurface.com/work-for-us/)+ [Contact](https://deepsurface.com/contact/)

[![]()](https://deepsurface.com)
X

[Try Now](/try-now)

Blog

* DeepSurface Security Advisory: Local Privilege Escalation in Erlang on Windows (CVE-2021-29221)

* [![Picture of DeepSurface Admin](https://secure.gravatar.com/avatar/1385306fc7ba04ebf8a2f73b50021410?s=96&d=mm&r=g)

  DeepSurface Admin](https://deepsurface.com/author/it/)
* [April 4, 2021](https://deepsurface.com/2021/04/04/)

### Overview

[Erlang](http://erlang.org/faq/introduction.html) is a popular general-purpose programming language and runtime environment, with support for concurrency commonly found on many distributed systems. When distributed on Windows machines, the Erlang emulator can also be run as a service with the **erlsrv.exe** command. This seems to be commonly used with popular software, such as CouchDB.

These services, by default, run as Local System, and are thus an interesting target for privilege escalation attacks. Improperly configured services are a common vector for privilege escalation in Windows installations. For instance, if the directory storing a service executable has improperly configured permissions, it’s often possible for an attacker to drop in a malicious DLL in the same directory which will then be loaded by the application. For more information on service permissions, DLL sideloading/hijacking, and related issues see our [previous post](https://deepsurface.com/windows-service-permissions-and-dll-sideloading/) on the topic.

This is a writeup for [CVE-2021-29221](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29221), a DLL hijacking attack against Erlang which allows an unprivileged local attacker to escalate to Local System under certain conditions.  Erlang/OTP prior to version 23.2.3 is affected by this vulnerability.

### Exploitation

First, we downloaded the latest version of Erlang (at the time of discovery) from here: <https://github.com/erlang/otp/releases/tag/OTP-23.1.2>. We tested with the 64 bit installer otp\_win64\_23.1.2.exe but the below steps should be reproducible across any vulnerable version.

![](https://deepsurface.com/wp-content/uploads/2022/06/2-2-1024x553.png)

Throughout the installation process, we use default settings except for the installation directory, which we change to C:\tools to demonstrate the permission misconfiguration.

![](https://deepsurface.com/wp-content/uploads/2022/06/3-1.png)
### Expanded Vulnerability Scanner Support

When DeepSurface launched last year, we could ingest vulnerability data from the Tenable line of vulnerability scanners. Today we’re pleased to announce that we’ve expanded support to include Rapid7’s InsightVM and Qualys VMDR.

Note the improperly configured permissions in the Erlang installation folder, which are inherited from the drive root. This gives any local user the ability to create arbitrary files in the installation directory, which we can then leverage in a DLL hijacking attack.

![](https://deepsurface.com/wp-content/uploads/2022/06/1-2-1024x355.png)

In order to weaponize this vulnerability, we need software to use the erlsrv.exe, or Erlang emulator service. To demonstrate this, we can simply set up a dummy service with .\erlsrv.exe add TestService. This will create a service named “TestService” that calls into erlang, allowing us to then perform a DLL hijacking attack.

![](https://deepsurface.com/wp-content/uploads/2022/06/4-1.png)

We can also easily confirm that the service is registered with the vulnerable Erlang installation.

![](https://deepsurface.com/wp-content/uploads/2022/06/5-1-1024x164.png)

In order to execute a DLL hijacking attack, we need to determine which DLLs the process loads. To do this, we can use [Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon) from Sysinternals.

Note that in this case, the DLL hijacking occurs against the **erl.exe** process, which is spawned from **erlsrv.exe**.

Opening up procmon, we add filters on the process name, result, and path. Note that we also exclude all paths that do not contain “**.dll**” (which is not shown in the screenshot below).

![](https://deepsurface.com/wp-content/uploads/2022/06/6.png)

We note that there are two potential targets for DLL hijacking, VCRUNTIME140.dll and IPHLPAPI.dll. In this case, we performed the attack against IPHLPAPI.dll.

![](https://deepsurface.com/wp-content/uploads/2022/06/7-1024x105.png)

With most DLL hijacking attacks, all that is required is a **DLLMain** function declaration. However, perhaps due to differences in how erl.exe loads libraries, defining **DLLMain** alone was not sufficient. Our tests suggest that the DLL was being searched for certain symbols, which if not present would cause the library load operation to abort.

In order to get around this additional constraint, we constructed a poisoned DLL with all of the symbols in the targeted DLL. While technically exporting all of the symbols is not required, it allows us to avoid seeing exactly what symbols erl.exe imports.

In order to get the list of DLL exports, we use [DLL Export Viewer](https://www.nirsoft.net/utils/dll_export_viewer.html). From here, we pass the exported DLL functions into our [DLL hijacking script](https://github.com/deepsurfacesec/advisories/blob/main/erlang-priv-escalation/build.py).

This will generate an **output.dll** which we can then rename to **IPHLPAPI.dll**, and drop into the current directory of erslrv.exe,**C:\tools\erl-23.1.2\erts-11.1.2\bin**. When executed successfully, the code in this DLL executes the user account that is being hijacked to **C:\pwned**.
To fully demonstrate the implications of this attack, create a new non-admin user account and log into it. Then drop the poisoned **IPHLPAPI.dll** into **C:\tools\erl-23.1.2\erts-11.1.2\bin**.

![](https://deepsurface.com/wp-content/uploads/2022/06/8-1024x369.png)

To trigger the exploit, either restart the computer or restart the “Test” service as an administrative user.
With the provided payload, you should see **C:\pwned** created, with **nt authority\system** logged as the user account. This demonstrates a successful escalation of privilege, from a non-admin user account to **nt authority\system**.

![](https://deepsurface.com/wp-content/uploads/2022/06/9.png)
### The Fix

As shown in the associated [commit](https://github.com/erlang/otp/commit/42eed52a08e2fb0e59a7dafccb752dde6e2f9631), the vendor patch explicitly sets the permissions in the installation directory. In order to address this vulnerability, users should double-check the permissions on existing erlang installation directories.

If the permissions are improperly configured, consider one of the following two solutions.

* Uninstalling the current installation and reinstalling the latest version of Erlang. Note that the patch was made in [version 23.2.3](https://github.com/erlang/otp/releases/tag/OTP-23.2.3).
* Fix the permissions on the existing installation directory, for example, with the script at the bottom of our [previous blog post](https://deepsurface.com/windows-service-permissions-and-dll-sideloading/).

### Vendor Notification

| December 16th, 2020 | Reported to erlang-security@erlang.org |
| --- | --- |
| December 17th, 2020 | Erlang security team response |
| January 5th, 2021 | Continued correspondence with Erlang security team |
| January 20th, 2021 | Erlang version 23.2.3 released with fix OTP-17097 |
| April 5th, 2021 | CVE-2021-29221 issued by DeepSurface Security |
| April 5th, 2021 | DeepSurface Advisory published |

[![](https://deepsurface.com/wp-content/uploads/2020/09/DS-Logo-Final-768x256.png)](https://deepsurface.com)

DeepSurface has invented a cutting-edge security posture management platform that contextualizes vulnerabilities and chains of attack within your unique digital infrastructure, predicting where an attacker could cause the most damage to your business.

[Twitter](https://twitter.com/deepsurfacesec/)

[Linkedin](https://www.linkedin.com/company/deepsurface/)

#### Who We Are

* [About](/about/)
* [Contact us](/contact/)
* [Take A Tour](/take-a-tour/)
* [Blog](/category/blog)

#### Legal

* [Privacy Policy](/privacy-policy/)
* [Terms and Conditions](/terms-and-conditions)
* [End User License Agreement](https://docs.deepsurface.com/eula.html?help_page=eula)

© 2025 All rights reserved

![deepsurface logo](https://deepsurface.com/wp-content/uploads/2024/06/logo-primary.svg)

* [Product](https://deepsurface.com/product/)
  + [Executive Reporting](https://deepsurface.com/executive-reporting/)
  + [Remediation Workflow](https://deepsurface.com/remediation-workflow-manager/)
* [Partners](https://deepsurface.com/partners/)
  + [Integrations](https://deepsurface.com/integrations/)
* [Resources](/resources)
  + [Documentation](https://docs.deepsurface.com/documentation.html#help_page=documentation_index)
  + [Blog](/resources)
  + [Case Studies](/category/case-study/)
  + [News](/category/news/)
  + [Self Paced Demo](/category/self-paced-demo/)
* [About](/about/)
  + [Mission](/about/#mission)
  + [Diversity & Inclusion](/about/#diversity)
  + [Join Our Team](https://deepsurface.com/work-for-us/)
  + [Contact](https://deepsurface.com/contact/)

[Try Now](/try-now)

Search
 Search



=== Content from github.com_3fe26a3c_20250114_183723.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferlang%2Fotp%2Freleases%2Ftag%2FOTP-23.2.3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferlang%2Fotp%2Freleases%2Ftag%2FOTP-23.2.3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=erlang%2Fotp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[erlang](/erlang)
/
**[otp](/erlang/otp)**
Public

* [Notifications](/login?return_to=%2Ferlang%2Fotp) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Ferlang%2Fotp)
* [Star
   11.5k](/login?return_to=%2Ferlang%2Fotp)

* [Code](/erlang/otp/tree/OTP-23.2.3)
* [Issues
  335](/erlang/otp/issues)
* [Pull requests
  136](/erlang/otp/pulls)
* [Actions](/erlang/otp/actions)
* [Projects
  0](/erlang/otp/projects)
* [Wiki](/erlang/otp/wiki)
* [Security](/erlang/otp/security)
* [Insights](/erlang/otp/pulse)

Additional navigation options

* [Code](/erlang/otp/tree/OTP-23.2.3)
* [Issues](/erlang/otp/issues)
* [Pull requests](/erlang/otp/pulls)
* [Actions](/erlang/otp/actions)
* [Projects](/erlang/otp/projects)
* [Wiki](/erlang/otp/wiki)
* [Security](/erlang/otp/security)
* [Insights](/erlang/otp/pulse)

1. [Releases](/erlang/otp/releases)
2. [OTP-23.2.3](/erlang/otp/releases/tag/OTP-23.2.3)

# OTP 23.2.3

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/erlang/otp/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...OTP-23.2.3)

 Loading

[View all tags](/erlang/otp/tags)

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[github-actions](/apps/github-actions)
released this
20 Jan 12:35

·
[18204 commits](/erlang/otp/compare/OTP-23.2.3...master)
to master
since this release

[OTP-23.2.3](/erlang/otp/tree/OTP-23.2.3)

[`050a78f`](/erlang/otp/commit/050a78f8a67ed76a632f0e73b76ceb83e7054e5f)

```
Patch Package:           OTP 23.2.3
Git Tag:                 OTP-23.2.3
Date:                    2021-01-20
Trouble Report Id:       OTP-17097, OTP-17107, OTP-17108, OTP-17110
Seq num:                 ERIERL-586, ERL-1442
System:                  OTP
Release:                 23
Application:             crypto-4.8.3, erts-11.1.7, snmp-5.7.2,
                         ssh-4.10.7
Predecessor:             OTP 23.2.2

 Check out the git tag OTP-23.2.3, and build a full OTP system
 including documentation. Apply one or more applications from this
 build as patches to your installation using the 'otp_patch_apply'
 tool. For information on install requirements, see descriptions for
 each application version below.

 ---------------------------------------------------------------------
 --- crypto-4.8.3 ----------------------------------------------------
 ---------------------------------------------------------------------

 The crypto-4.8.3 application can be applied independently of other
 applications on a full OTP 23 installation.

 --- Fixed Bugs and Malfunctions ---

  OTP-17107    Application(s): crypto

               Adding missing flag in BN-calls in SRP.

 Full runtime dependencies of crypto-4.8.3: erts-9.0, kernel-5.3,
 stdlib-3.4

 ---------------------------------------------------------------------
 --- erts-11.1.7 -----------------------------------------------------
 ---------------------------------------------------------------------

 The erts-11.1.7 application can be applied independently of other
 applications on a full OTP 23 installation.

 --- Improvements and New Features ---

  OTP-17097    Application(s): erts

               Make windows installer remove write access rights for
               non admin users when installing to a non default
               directory. Reduces the risk for DLL sideloading, but
               the user should always be aware of the access rights
               for the installation.

 Full runtime dependencies of erts-11.1.7: kernel-7.0, sasl-3.3,
 stdlib-3.13

 ---------------------------------------------------------------------
 --- snmp-5.7.2 ------------------------------------------------------
 ---------------------------------------------------------------------

 The snmp-5.7.2 application can be applied independently of other
 applications on a full OTP 23 installation.

 --- Fixed Bugs and Malfunctions ---

  OTP-17110    Application(s): snmp
               Related Id(s): ERIERL-586

               [manager] Misspelled priv protocol (atom) made it
               impossible to update usm user 'priv_key' configuration
               for usmAesCfb128Protocol via function calls.

 Full runtime dependencies of snmp-5.7.2: crypto-3.3, erts-6.0,
 kernel-3.0, mnesia-4.12, runtime_tools-1.8.14, stdlib-2.5

 ---------------------------------------------------------------------
 --- ssh-4.10.7 ------------------------------------------------------
 ---------------------------------------------------------------------

 The ssh-4.10.7 application can be applied independently of other
 applications on a full OTP 23 installation.

 --- Fixed Bugs and Malfunctions ---

  OTP-17108    Application(s): ssh
               Related Id(s): ERL-1442

               The SSH daemon erroneously replaced LF with CRLF also
               when there was no pty requested from the server.

 Full runtime dependencies of ssh-4.10.7: crypto-4.6.4, erts-9.0,
 kernel-5.3, public_key-1.6.1, stdlib-3.4.1

 ---------------------------------------------------------------------
 ---------------------------------------------------------------------
 ---------------------------------------------------------------------

```

 Assets
12

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


