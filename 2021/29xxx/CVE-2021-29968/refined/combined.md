=== Content from www.mozilla.org_8991c88c_20250115_092336.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-27

## Security Vulnerabilities fixed in Firefox 89.0.1

Announced
June 16, 2021
Impact
moderate
Products
Firefox
Fixed in

* Firefox 89.0.1

#### [#CVE-2021-29968: Out of bounds read when drawing text characters onto a Canvas](#CVE-2021-29968)

Reporter
Pascal Chevrel
Impact
moderate
##### Description

When drawing text onto a canvas with WebRender disabled, an out of bounds read could occur.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1712047](https://bugzilla.mozilla.org/show_bug.cgi?id=1712047)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_25b996c4_20250115_092335.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1712047)
* [XML](/show_bug.cgi?ctype=xml&id=1712047)

Closed
[Bug 1712047](/show_bug.cgi?id=1712047)
(CVE-2021-29968)

Opened 4 years ago
Closed 4 years ago

# Crash in [@ sse41::lowp::gather\_8888]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in [@ sse41::lowp::gather\_8888]

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Windows 10

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

91 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected) |
| firefox89 | [+](/buglist.cgi?f1=cf_tracking_firefox89&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed) |
| firefox90 | [+](/buglist.cgi?f1=cf_tracking_firefox90&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed) |
| firefox91 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox89 | + | fixed |
| firefox90 | + | fixed |
| firefox91 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: pascalc, Assigned: lsalzman)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5293fe8fb106a442d842757758d07c56?d=mm&size=40)  [pascalc](/user_profile?user_id=24572)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Depends on 1 open bug, Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1715379](/show_bug.cgi?id=1715379 "RESOLVED FIXED - Adding gfx downloadable blocklist entries is broken")

[1715382](/show_bug.cgi?id=1715382 "NEW - Block D2D on gen5")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1714681](/show_bug.cgi?id=1714681 "RESOLVED FIXED - Broken menu popups with gfx.xrender.enabled=true")

Dependency [tree](/showdependencytree.cgi?id=1712047&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1712047)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1699224](/show_bug.cgi?id=1699224 "RESOLVED FIXED - Support remapping shared surfaces when there is virtual memory pressure")

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1715784](/show_bug.cgi?id=1715784 "RESOLVED DUPLICATE - Crash in [@ Sprite_D8_S32::blitRect]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-29968

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [noni](/user_profile?user_id=458186) | [qe-verify](#a3734869_458186 "4 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ Sprite\_D8\_S32::blitRect ]](https://crash-stats.mozilla.org/signature/?signature=Sprite_D8_S32%3A%3AblitRect)

[[@ sse2::lowp::bilerp\_clamp\_8888 ]](https://crash-stats.mozilla.org/signature/?signature=sse2%3A%3Alowp%3A%3Abilerp_clamp_8888)

[[@ sse2::lowp::gather\_8888 ]](https://crash-stats.mozilla.org/signature/?signature=sse2%3A%3Alowp%3A%3Agather_8888)

[[@ sse41::lowp::bilerp\_clamp\_8888 ]](https://crash-stats.mozilla.org/signature/?signature=sse41%3A%3Alowp%3A%3Abilerp_clamp_8888)

[[@ sse41::lowp::gather\_8888 ]](https://crash-stats.mozilla.org/signature/?signature=sse41%3A%3Alowp%3A%3Agather_8888)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel](/attachment.cgi?id=9225645)  [4 years ago](#c7)  [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)   48 bytes, text/x-phabricator-request | jcristau : [approval-mozilla-beta+](#c15 "4 years ago")  pascalc : [approval-mozilla-release+](#c18 "4 years ago") | [Details](/attachment.cgi?id=9225645&action=edit) | [Review](/attachment.cgi?id=9225645) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1712047#c0)• 4 years ago |
|  | |

Crash report: <https://crash-stats.mozilla.org/report/index/68d80abf-0878-437e-bd1e-6e79a0210520>

Reason: `EXCEPTION_ACCESS_VIOLATION_READ`

Top 10 frames of crashing thread:

```
0 xul.dll sse41::lowp::gather_8888 gfx/skia/skia/src/opts/SkRasterPipeline_opts.h:3780
1 xul.dll sse2::lowp::start_pipeline gfx/skia/skia/src/opts/SkRasterPipeline_opts.h:3141
2 xul.dll std::_Func_impl_no_alloc<`lambda at /builds/worker/checkouts/gecko/gfx/skia/skia/src/core/SkRasterPipeline.cpp:355:12', void, unsigned int, unsigned int, unsigned int, unsigned int>::_Do_call
3 xul.dll SkRasterPipelineBlitter::blitRect gfx/skia/skia/src/core/SkRasterPipelineBlitter.cpp:298
4 xul.dll static SkScan::FillIRect gfx/skia/skia/src/core/SkScan.cpp:28
5 xul.dll static SkScan::FillRect gfx/skia/skia/src/core/SkScan.cpp:111
6 xul.dll SkDraw::drawRect const gfx/skia/skia/src/core/SkDraw.cpp:679
7 xul.dll SkBitmapDevice::drawRect gfx/skia/skia/src/core/SkBitmapDevice.cpp:365
8 xul.dll SkBitmapDevice::drawBitmapRect gfx/skia/skia/src/core/SkBitmapDevice.cpp:543
9 xul.dll SkBaseDevice::drawImageRect gfx/skia/skia/src/core/SkDevice.cpp:141

```

This signature started showing up in 89 beta 13

Severity: -- → S2

|  | [Arthur K. (he/him)](/user_profile?user_id=393183) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1712047#c1)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1712047&comment_id=15415432 "1 revision") |
|  | |

Crashing on Windows version is 10.0.18363 (1909) so kinda getting long in the tooth (and is out of support as of May 11th 2021). But also that this crash shows an x86 machine with what seems like only 2GB RAM and an old 8.15.10.2900 driver (Sandy Bridge era or earlier?) and only 492MB free memory. If I had to guess based on that info alone, maybe GPU is sharing already low amount of RAM and the system got starved and did a "fainting goat".

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1712047#c2)• 4 years ago |
|  | |

From what I can see, it's affecting all versions of Win10. New in b13 also makes me wonder if it's tied to the end of the early beta period (b12 was the final early beta build). Also, hiding this bug for now because the crash addresses look wildptr-ish?

Group: gfx-core-security

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a570614_486634)• 4 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a950191_580382)• 4 years ago |

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=%3F)Hardware: x86 → All

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1712047#c3)• 4 years ago |
|  | |

The only thing I see looking at the changelogs was the changeover from early beta. Software WebRender would have been enabled on Windows during the early beta, and then after early beta finished, we would go back to D3D11 Layers. It doesn't look like the crash reporters are qualifying for HW-WR in this case for some reason.

So that points to something in the 89 cycle that adversely affected the stability of the gfxFontMissingGlyphs code in the Layers path, but was otherwise obscured by SW-WR being enabled during the Nightly cycle and during early beta.

There were a couple changes I might suspect initially impacted this, but seem to have been in earlier versions, i.e. [bug 1694248](/show_bug.cgi?id=1694248 "RESOLVED FIXED - Disable OMTP") and [bug 1541472](/show_bug.cgi?id=1541472 "RESOLVED FIXED - Remove advanced layers").

Not quite sure what's going on here yet as such.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1712047#c4)• 4 years ago |
|  | |

I tried reproducing this on a similar configuration (WebRender disabled with D3D11 compositor + D2D) on some of the URLs and couldn't.

There are not going to be very many users in this configuration in 89 so the overall crash volume won't be so high, however for those users with this configuration it could be noticeably bad. That being said, it's planed that those users will be moving to a WebRender configuration in 90 so they won't have to put up with it for long.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1297923_258347)• 4 years ago |

Crash Signature: [@ sse41::lowp::gather\_8888] → [@ sse2::lowp::bilerp\_clamp\_8888 ]
[@ sse2::lowp::gather\_8888]
[@ sse41::lowp::bilerp\_clamp\_8888]
[@ sse41::lowp::gather\_8888]

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1298160_258347)• 4 years ago |

Crash Signature: [@ sse2::lowp::bilerp\_clamp\_8888 ]
[@ sse2::lowp::gather\_8888]
[@ sse41::lowp::bilerp\_clamp\_8888]
[@ sse41::lowp::gather\_8888] → [@ Sprite\_D8\_S32::blitRect]
[@ sse2::lowp::bilerp\_clamp\_8888 ]
[@ sse2::lowp::gather\_8888]
[@ sse41::lowp::bilerp\_clamp\_8888]
[@ sse41::lowp::gather\_8888]

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1556788_580382)• 4 years ago |

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=unaffected)Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1712047#c5)• 4 years ago |
|  | |

Jeff, these new signatures total 3% of our crashes on release, which makes it into out top 5 of crashers for 89. Can we get somebody assigned to this bug so as that we may be able to have a fix we could uplift to a dot release? Thanks

Flags: needinfo?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1712047#c6)• 4 years ago |
|  | |

Lee pointed out <https://phabricator.services.mozilla.com/D109437> which seems like it could be the cause.

Flags: needinfo?(jmuizelaar) → needinfo?(aosmond)

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1712047#c7)• 4 years ago |
|  | |

Attached file
[Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel](attachment.cgi?id=9225645)
— [Details](attachment.cgi?id=9225645&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1585618_600971)• 4 years ago |

Assignee: nobody → lsalzmanStatus: NEW → ASSIGNED

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1712047#c8)• 4 years ago |
|  | |

We believe this might have been regressed by [bug 1699224](/show_bug.cgi?id=1699224 "RESOLVED FIXED - Support remapping shared surfaces when there is virtual memory pressure").

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1712047#c9)• 4 years ago |
|  | |

Landed:

<https://hg.mozilla.org/integration/autoland/rev/9e76c07577b15d9efebc2479e02052ece480cbaeBacked> out for causing bustages in DrawTargetSkia.cpp:

<https://hg.mozilla.org/integration/autoland/rev/b29d87f7f43e29e7c147a8bc65eb2d6a9e9f56e0>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=success%2Ctestfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&searchStr=windows%2Copt&revision=9e76c07577b15d9efebc2479e02052ece480cbae>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=342011618&repo=autoland>

[task 2021-06-07T16:46:49.353Z] 16:46:49 INFO - /builds/worker/checkouts/gecko/gfx/2d/DrawTargetSkia.cpp(276,41): error: no member named 'take' in 'RefPtr<mozilla::gfx::DataSourceSurface>'

[task 2021-06-07T16:46:49.353Z] 16:46:49 INFO - DataSourceSurface\* surf = dataSurface.take();

[task 2021-06-07T16:46:49.353Z] 16:46:49 INFO - ~~~~~~~~~~~ ^

[task 2021-06-07T16:46:49.353Z] 16:46:49 INFO - 1 error generated.

Flags: needinfo?(lsalzman)

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1590332_536714)• 4 years ago |

Flags: needinfo?(lsalzman)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1712047#c10)• 4 years ago |
|  | |

We need forget() instead of take()

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1712047#c11)• 4 years ago |
|  | |

keep Skia temporary data surface alive. r=jrmuizel

<https://hg.mozilla.org/integration/autoland/rev/808da1d9c00b1efe8affbd64702ed6155e612f96>

<https://hg.mozilla.org/mozilla-central/rev/808da1d9c00b>

Status: ASSIGNED → RESOLVEDClosed: 4 years ago
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 91 Branch

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1657387_580382)• 4 years ago |

Group: gfx-core-security → core-security-release
[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected)
[tracking-firefox90](/buglist.cgi?f1=cf_tracking_firefox90&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox90&o1=equals&v1=%2B)

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1712047#c12)• 4 years ago |
|  | |

Comment on [attachment 9225645](/attachment.cgi?id=9225645 "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") [[details]](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel")

[Bug 1712047](/show_bug.cgi?id=1712047 "RESOLVED FIXED - Crash in [@ sse41::lowp::gather_8888]") - keep Skia temporary data surface alive. r?jrmuizel

### Beta/Release Uplift Approval Request

* **User impact if declined**: Potential crashes in non-WebRender configurations.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This fixes what we believe to be an obvious bug in the time range in nearby code. While we are not 100% sure this is the cause of the crashes due to an inability to fully reproduce this locally, but we have a strong suspicion this will fix it. Unfortunately, the only way to know if this actually fixes it will be to deploy the fix.
* **String changes made/needed**:
[Attachment #9225645](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") -
Flags: approval-mozilla-release?
[Attachment #9225645](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") -
Flags: approval-mozilla-beta?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1676013_580382)• 4 years ago |

Regressed by: [1699224](/show_bug.cgi?id=1699224 "RESOLVED FIXED - Support remapping shared surfaces when there is virtual memory pressure")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1676013_546015)• 4 years ago |

Has Regression Range: --- → yes

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1712047#c13)• 4 years ago |
|  | |

Can we turn off WR for the affected population for one beta build in 90, along with the uplift, so we don't have to wait until this goes to late beta or release before we confirm it fixes the issue?

Flags: needinfo?(lsalzman)Flags: needinfo?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1712047#c14)• 4 years ago |
|  | |

I was able to reproduce this when using similar hardware as we were seeing crashes on. I confirmed that the build with the fix doesn't crash anymore. The patch should be quite safe so I'm eager to deploy it ASAP. The fact that it's a top crash while only being used by a small number of users suggests that it's hit quite often. It also probably reliably triggers on some webcontent which will make those sites unusable for those users.

Flags: needinfo?(jmuizelaar)

|  | [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1678755_536714)• 4 years ago |

Flags: needinfo?(lsalzman)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1712047#c15)• 4 years ago |
|  | |

Comment on [attachment 9225645](/attachment.cgi?id=9225645 "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") [[details]](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel")

[Bug 1712047](/show_bug.cgi?id=1712047 "RESOLVED FIXED - Crash in [@ sse41::lowp::gather_8888]") - keep Skia temporary data surface alive. r?jrmuizel

approved for 90.0b5

[Attachment #9225645](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1712047#c16)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/e33597d2ca99>

[status-firefox90](/buglist.cgi?f1=cf_status_firefox90&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox90&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1691500_75935)• 4 years ago |

Depends on: [1715379](/show_bug.cgi?id=1715379 "RESOLVED FIXED - Adding gfx downloadable blocklist entries is broken")

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1704750_309398)• 4 years ago |

Depends on: [1715382](/show_bug.cgi?id=1715382 "NEW - Block D2D on gen5")

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1712047#c17)• 4 years ago |
|  | |

I've added a blocklist entry for D2D on the affected hardware which should reduce this crash.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1791658_75935)• 4 years ago |

Blocks: [1714681](/show_bug.cgi?id=1714681 "RESOLVED FIXED - Broken menu popups with gfx.xrender.enabled=true")

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1712047#c18)• 4 years ago |
|  | |

Comment on [attachment 9225645](/attachment.cgi?id=9225645 "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") [[details]](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel")

[Bug 1712047](/show_bug.cgi?id=1712047 "RESOLVED FIXED - Crash in [@ sse41::lowp::gather_8888]") - keep Skia temporary data surface alive. r?jrmuizel

Approved for an 89 dot release.

[Attachment #9225645](/attachment.cgi?id=9225645&action=edit "Bug 1712047 - keep Skia temporary data surface alive. r?jrmuizel") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1712047#c20)• 4 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/a57984cabd61>

[status-firefox89](/buglist.cgi?f1=cf_status_firefox89&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox89&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a1921322_578488)• 4 years ago |

Alias: CVE-2021-29968

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1712047#c21)• 4 years ago |
|  | |

I wrote the follow advisory if it looks incorrect to anyone please advise.

```
## mfsa2021-27.yml
announced: June 14, 2021
impact: moderate
fixed_in:
- Firefox 89.0.1
title: Security Vulnerabilities fixed in Firefox 89.0.1
advisories:
  CVE-2021-29968:
    title: Out of bounds read when drawing text characters onto a Canvas
    impact: moderate
    reporter: Pascal Chevrel
    description: |
      When drawing text onto a canvas with WebRender disabled, an out of bounds read could occur. <br>*This bug only affects Thunderbird on Windows. Other operating systems are unaffected.*
    bugs:
      - url: 1712047

```

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1712047#c22)• 4 years ago |
|  | |

> This bug only affects Thunderbird on Windows.

Should probably say Firefox, not Thunderbird

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1712047#c23)• 4 years ago |
|  | |

It's also not related to canvas. The problem can occur on regular html content. I would go with something like:

"Use after free when interoperating between Direct2D and Skia when WebRender is disabled"

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a3121127_580382)• 4 years ago |

Flags: needinfo?(aosmond)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a3734869_458186)• 4 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1712047#a16157093_1689)• 3 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1712047&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Lee Salzman [:lsalzman]](/user_profile?user_id=536714)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


