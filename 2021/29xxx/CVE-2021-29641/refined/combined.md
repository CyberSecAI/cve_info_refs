=== Content from sec-consult.com_1f26f019_20250114_221535.html ===

Toggle Navbar

* [Karriere](/de/karriere/)
* [Unternehmen](/de/unternehmen/)
* [Kontakt](/de/kontakt/)

* DE
  + [EN](/vulnerability-lab/advisory/arbitrary-file-upload-and-bypassing-htaccess-rules-in-monospace-directus-headless-cms/ "English")
Suche

* Compliance & Regulations
  + [NIS2](/de/compliance-regulations/nis2/)
  + [Digital Operational Resilience Act (DORA)](/de/compliance-regulations/dora/)
* Sicherheitsüberprüfungen
  + [Sicherheit von Webanwendungen](/de/sicherheitsueberpruefungen/web-application-security/)
  + [Pentest vom zertifizierten Anbieter](/de/sicherheitsueberpruefungen/penetrationstests/)
  + [Mobile Security](/de/sicherheitsueberpruefungen/mobile-security/)
  + [Cloud Security](/de/sicherheitsueberpruefungen/cloud-security/)
  + [IT Infrastruktur Sicherheit](/de/sicherheitsueberpruefungen/it-infrastruktur-sicherheit/)
  + [Sicherheit für SAP(R) Services](/de/sicherheitsueberpruefungen/sicherheit-fuer-sap-services/)
  + [Sicherheit für IoT und Embedded Systems](/de/sicherheitsueberpruefungen/sicherheit-fuer-iot-und-embedded-systems/)
  + [Red Teaming − Cyberangriffssimulation](/de/sicherheitsueberpruefungen/red-teaming/)
* Prozesse & Organisation
  + [Informationssicherheitsmanagement (ISM)](/de/prozesse-organisation/informationssicherheitsmanagement-ism/)
  + [OT Security](/de/prozesse-organisation/ot-security/)
  + [Consulting für Sichere Software-Entwicklung](/de/prozesse-organisation/consulting-fuer-sichere-software-entwicklung/)
  + [Red Teaming - Cyberangriffssimulation](/de/sicherheitsueberpruefungen/red-teaming/)
  + [SEC Trainings](/de/prozesse-organisation/sec-trainings/)
  + [Projekt- und Programmmanagement](/de/prozesse-organisation/projekt-und-programmmanagement/)
* Incident Response
  + [SEC Defence](/de/incident-response/sec-defence/)
* [Vulnerability Lab](/de/vulnerability-lab/)
* [Blog](/de/blog/)
 [Incident?
Angegriffen?
Incident melden](/de/incident-response/sec-defence/)

1. [Home](/de/)
2. [Vulnerability Lab](/de/vulnerability-lab/)
3. Upload beliebiger Dateien und Umgehung von .htaccess Regeln in Monospace Directus Headless CMS
# Upload beliebiger Dateien und Umgehung von .htaccess Regeln in Monospace Directus Headless CMS

Title

Upload beliebiger Dateien und Umgehung von .htaccess Regeln

Product

Monospace Directus Headless CMS

Vulnerable Version

< v8.8.2

Fixed Version

v8.8.2, v9 is not affected because of different architecture

CVE Number

CVE-2021-29641

Impact

high

Homepage

[https://directus.io/](https://directus.io/ "https://directus.io/")

Found

15.12.2020

By

Oliver Boehlk (Atos Germany), Moritz Friedmann (Atos Germany) | SEC Consult Vulnerability Lab

Monospace Directus CMS Docker Images, welche Apache als Webserver mit lokalem Storage nutzen, sind von einer Schwachstelle betroffen, über die jeder authentifizierte Nutzer beliebige Dateien und Ordner hochladen kann. In unveränderter Standard-Konfiguration ist Directus somit anfällig für Remote Code Execution und Veränderung von Webserver .htaccess Regeln.

Zum vollständigen [Security Advisory](https://sec-consult.com/vulnerability-lab/advisory/arbitrary-file-upload-and-bypassing-htaccess-rules-in-monospace-directus-headless-cms/) (Englisch).

EOF O. Boehlk, M. Friedmann / @2021

*Interesse an einer Zusammenarbeit mit den Experten von SEC Consult? Senden Sie uns Ihre****[Bewerbung](https://sec-consult.com/de/kontakt/)****.
 Möchten Sie Ihre eigene Cyber-Sicherheit mit den Experten von SEC Consult verbessern? Kontaktieren Sie unsere **[lokalen Büros](https://sec-consult.com/de/kontakt/)**.*

[Zurück](/de/vulnerability-lab/)

* [Impressum](/de/impressum/)
* [Datenschutzerklärung](/de/datenschutz/)
* [Jobs](/de/karriere/)

SEC Consult ist einer der führenden Berater im Bereich Cyber- und [Applikationssicherheit](/de/sicherheitsueberpruefungen/web-application-security/ "Sicherheit von Webanwendungen"). Das Unternehmen ist Spezialist für die Einführung von [Informationssicherheits-Management](/de/prozesse-organisation/informationssicherheitsmanagement-ism/ "Informationssicherheits-Management"), NIS Sicherheitsaudits, [Penetrationstests](/de/sicherheitsueberpruefungen/penetrationstests/ "Pentesting"), Zertifizierungsbegleitung für ISO 27001, [Cyber Defence](/de/incident-response/sec-defence/ "Cyber Defence") und [sichere Software](/de/prozesse-organisation/consulting-fuer-sichere-software-entwicklung/ "Software Sicherheit"). SEC Consult ist Teil von [Eviden](https://eviden.com/ "Link zur Eviden-Website").

[![bsi ISO/IEC 27001 Information Security Management CERTIFIED](/typo3temp/assets/_processed_/c/2/csm_bsi_9a24e74563.png)](/de/unternehmen/ "Über uns")[![ISO 27001 CREST certified](/typo3temp/assets/_processed_/0/6/csm_crest_0eb9c5864d.png)](/de/unternehmen/ "Über uns")[![Great Place To Work AT certified](/typo3temp/assets/_processed_/0/3/csm_great-place-to-work-at_773b265aa6.png)](/de/unternehmen/ "Über uns")[![Great Place To Work DE certified](/typo3temp/assets/_processed_/d/6/csm_great-place-to-work-de_2fcb537270.png)](/de/unternehmen/ "Über uns")

## Wir nutzen Cookies

Wir verwenden Cookies, um Ihnen ein perfektes Besuchserlebnis zu bieten. Dazu zählen Cookies, die für den Betrieb der Seite und für die Steuerung unserer kommerziellen Unternehmensziele notwendig sind, sowie solche, die lediglich zu anonymen Statistikzwecken, für Komforteinstellungen oder zur Anzeige personalisierter Inhalte genutzt werden. Entscheiden Sie selbst, welche Kategorien Sie zulassen möchten. Bitte beachten Sie, dass auf Basis Ihrer Einstellungen womöglich nicht mehr alle Funktionalitäten der Seite zur Verfügung stehen.

**[Impressum](/de/impressum/)** •  **[Datenschutzerklärung](/de/datenschutz/)**

### Technisch erforderlich

(
0
Service
)

nein

Technisch erforderlich (
0
Service
)

ja

### Analyse / Statistik

(
1
Service
)

Anonyme Auswertung zur Fehlerbehebung und Weiterentwicklung

nein

Analyse / Statistik (
1
Service
)

ja

#### Matomo

nein

Matomo

ja

Matomo.org
Details anzeigen

Details schliessen

**Zweck:** Fehleranalyse, statistische Auswertung unserer Webseitenzugriffe, Kampagnenanalyse, Conversiontracking
 **Verarbeitungsvorgänge:** Erhebung von Zugriffsdaten, Daten ihres Browsers und Daten über die aufgerufenen Inhalte; Ausführung von Analysesoftware und Speicherung von Daten auf ihrem Endgerät, Anonymisierung der erhobenen Daten; Auswertung der anonymen Daten in Form von Statistiken
 **Speicherdauer:** 6 Monate.
 **Gemeinsamer Verantwortlicher:** LimeSoda Interactive Marketing GmbH
 **Rechtsgrundlage für die Datenverarbeitung:** Art. 6 Abs. 1 lit. f der DSGVO
 **Folgen der Nichteinwilligung:** Dieses Basis-Tracking ist für den Betrieb unserer Website unbedingt erforderlich.
 **Datenübermittlung:** Die mit Matomo erhobenen Daten werden werden auf unseren eigenen Servern gespeichert. Eine Weitergabe an Dritte erfolgt nicht.

Auswahl bestätigen

Alle ablehnen

Alle akzeptieren



=== Content from seclists.org_77cfcc56_20250114_221534.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

![](/shared/images/nst-icons.svg#search)

# SEC Consult SA-20210407-0 :: Arbitrary File Upload and Bypassing .htaccess Rules in Monospace Directus Headless CMS

---

*From*: SEC Consult Vulnerability Lab <research () sec-consult com>

*Date*: Wed, 7 Apr 2021 12:12:02 +0200

---

```
SEC Consult Vulnerability Lab Security Advisory < 20210407-0 >
=======================================================================
              title: Arbitrary File Upload and Bypassing .htaccess Rules
            product: Monospace Directus Headless CMS
 vulnerable version: < v8.8.2
      fixed version: v8.8.2, v9 is not affected because of different architecture
         CVE number: CVE-2021-29641
             impact: High
           homepage: <https://directus.io/>
              found: 2020-12-15
                 by: Oliver Boehlk (Atos Germany)
                     Moritz Friedmann (Atos Germany)
                     SEC Consult Vulnerability Lab

                     An integrated part of SEC Consult, an Atos company
                     Europe | Asia | North America

                     <https://www.sec-consult.com>

=======================================================================

Vendor description:
-------------------
"Directus Open-Source, Free & Unlimited. No Strings Attached.
Our premium software is available at no cost for commercial and personal use.
This self-hosted version is full-featured, with no artificial limitations."

Source: <https://directus.io/open-source/>

Business recommendation:
------------------------
The vendor provides an updated version for v8 which fixes the security issue. It should
be installed immediately.

Note: Directus v8 has been deprecated/discontinued and is replaced by version 9,
which currently does not have a final release version yet. Updating to Directus v9
fixes this vulnerability as well because the NodeJS architecture replaces
the PHP API
and hence is not affected.

According to the vendor, the identified security issue only applies to v8
installations
relying on the specific Apache-based config in the Docker image, using the local-storage
driver for uploads. The recommendation from the vendor is to use a connection to S3 for
such installations, install the patch v8.8.2 or upgrade to version 9.

Vulnerability overview/description:
-----------------------------------
1) Arbitrary File Upload and Bypassing .htaccess Rules (CVE-2021-29641)
Any low privileged user with file upload permissions can upload webshells
or
other malicious PHP files which can be found in /uploads/_/originals/.

If the server prevents the execution of PHP files in the upload directory
the
attacker can move the file into a subdirectory where he can upload a custom .htaccess
file to enable PHP execution again.

Server side command execution can be used to retrieve the Directus configuration
and database credentials to escalate in-app privileges, retrieve password
hashes
or move laterally in the network.

Proof of concept:
-----------------
1) Arbitrary File Upload and Bypassing .htaccess Rules (CVE-2021-29641)
A PoC environment can be created using a docker-compose.yml file:

version: "3"

services:
  app:
    image: directus/directus:v8.8.1-apache
    ports:
      - 8080:80
    environment:
      DIRECTUS_INSTALL_TITLE: vulnerable directus server
      DIRECTUS_INSTALL_EMAIL: admin () ha ck
      DIRECTUS_INSTALL_PASSWORD: admin1
      DIRECTUS_AUTH_SECRETKEY: directusprivtest
      DIRECTUS_AUTH_PUBLICKEY: directuspubtest
      DIRECTUS_DATABASE_HOST: db
      DIRECTUS_DATABASE_NAME: directus
      DIRECTUS_DATABASE_USERNAME: directus
      DIRECTUS_DATABASE_PASSWORD: directus

  db:
    image: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: directusroot
      MYSQL_DATABASE: directus
      MYSQL_USER: directus
      MYSQL_PASSWORD: directus

Optionally, Directus data folders can be mounted for persistent storage:
volumes:
- ./data/config:/var/directus/config
- ./data/uploads:/var/directus/public/uploads

An .htaccess file can be placed in the uploads directory to prevent PHP execution:
<IfModule mod_php7.c>
  php_flag engine off
</IfModule>

Initial installation requires "install" to be called:
docker-compose up -d && docker-compose run app install

Login defined in docker-compose:
admin () ha ck:admin1

An attacker can upload a PHP file and open it at uploads/_/originals/[randomid].php.
If a .htaccess file is used, the code does not get executed and gets returned in plain text.

You can edit the item in Directus and change the Filename Disk to "test/file.php" (it doesn't
matter that there is no folder named test yet, Directus/Apache does you a
favor and creates it
for you).

Now you can access the file at /uploads/_/originals/test/file.php.
Even if you delete the file in Directus it remains on the server, and can
be accessed via the
above mentioned URL.

To get code execution the next step is to simply upload an own .htaccess file containing
<IfModule mod_php7.c>
  php_flag engine on
</IfModule>

And again change the Filename Disk to test/.htaccess.

Now calling /uploads/_/originals/test/file.php executes the PHP file.

Vulnerable / tested versions:
-----------------------------
The following versions have been tested and found to be vulnerable. According to the vendor,
only the Apache-based docker image with the local-storage driver is affected and not the
Directus suite as a whole.

* v8.4.0
* v8.8.1 (latest version at the time of the test)

It is assumed that all previous v8 versions are affected as well.

Version 9 uses a different architecture and is not affected by this vulnerability.

Vendor contact timeline:
------------------------
2020-12-16 | Contacting vendor through security () directus io; no reply
2021-03-04 | Contacting vendor again through security () directus io
2021-03-05 | Vendor reply, exchanged S/MIME certificates
2021-03-08 | Sending security advisory to vendor
2021-03-12 | Asking the vendor whether they received the advisory; no reply
2021-03-25 | Asking vendor again for status update
2021-03-25 | Vendor: v8 will be fixed in new version
2021-03-26 | Vendor: the issue has been fixed in v8.8.2 available at dockerhub
2021-04-07 | Coordinated release of security advisory

Solution:
---------
The vendor provides an updated version v8.8.2 at dockerhub which fixes the security
issue:
<https://hub.docker.com/layers/directus/directus/v8.8.2-apache/images/sha256-d9898b6442b0150c3c377b50e706757f35d2d563bd82ddaf97f3ae4ba450a6e6?context=explore>

Alternatively, version 9 can be installed as well, which uses a different
architecture
and is not affected.

Workaround:
-----------
None

Advisory URL:
-------------
<https://sec-consult.com/vulnerability-lab/>

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

SEC Consult Vulnerability Lab

SEC Consult, an Atos company
Europe | Asia | North America

About SEC Consult Vulnerability Lab
The SEC Consult Vulnerability Lab is an integrated part of SEC Consult, an
Atos company. It ensures the continued knowledge gain of SEC Consult in the
field of network and application security to stay ahead of the attacker. The
SEC Consult Vulnerability Lab supports high-quality penetration testing and
the evaluation of new offensive and defensive technologies for our customers.
Hence our customers obtain the most current information about vulnerabilities
and valid recommendation about the risk profile of new technologies.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Interested to work with the experts of SEC Consult?
Send us your application <https://sec-consult.com/career/>

Interested in improving your cyber security with the experts of SEC Consult?
Contact our local offices <https://sec-consult.com/contact/>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Mail: research at sec-consult dot com
Web: <https://www.sec-consult.com>
Blog: <http://blog.sec-consult.com>
Twitter: <https://twitter.com/sec_consult>

EOF O. Boehlk, M. Friedmann / @2021

```

**Attachment:
[smime.p7s](att-14/smime_p7s.bin)**

*Description:* S/MIME Cryptographic Signature

```

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>
```

---

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

### Current thread:

* **SEC Consult SA-20210407-0 :: Arbitrary File Upload and Bypassing .htaccess Rules in Monospace Directus Headless CMS** *SEC Consult Vulnerability Lab (Apr 07)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from packetstormsecurity.com_ce9990b3_20250114_221533.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from sec-consult.com_cf1bbb35_20250114_221535.html ===

Toggle Navbar

* [Career](/career/)
* [About us](/about-us/)
* [Contact](/contact/)

* EN
  + [DE](/de/vulnerability-lab/advisory/arbitrary-file-upload-and-bypassing-htaccess-rules-in-monospace-directus-headless-cms/ "German")
Search

* Compliance & Regulations
  + [NIS2](/compliance-regulations/nis2/)
  + [Digital Operational Resilience Act (DORA)](/compliance-regulations/dora/)
* Security Testing
  + [Web Application Security](/security-testing/web-application-security/)
  + [Penetration Testing](/security-testing/penetration-testing/)
  + [Mobile Security](/security-testing/mobile-security/)
  + [Cloud Security](/security-testing/cloud-security/)
  + [IT Infrastructure Security](/security-testing/it-infrastructure-security/)
  + [Security for SAP Services](/security-testing/security-for-sap-services/)
  + [IoT and Embedded Systems Security](/security-testing/iot-and-embedded-systems-security/)
  + [Red Teaming](/security-testing/red-teaming/)
* Processes & Organisation
  + [Information Security Management (ISM)](/processes-organisation/information-security-management-ism/)
  + [OT Security](/processes-organisation/ot-security/)
  + [Secure Software Development Consulting](/processes-organisation/secure-software-development/)
  + [Red Teaming](/security-testing/red-teaming/)
  + [SEC Trainings](/processes-organisation/sec-trainings/)
  + [Project- und Program Management](/processes-organisation/project-und-program-management/)
* Incident Response
  + [SEC Defence](/incident-response/sec-defence/)
* [Vulnerability Lab](/vulnerability-lab/)
* [Blog](/blog/)
 [Incident?
Breached?
Report an incident](/incident-response/sec-defence/)

1. [Home](/)
2. [Vulnerability Lab](/vulnerability-lab/)
3. Arbitrary File Upload and Bypassing .htaccess Rules in Monospace Directus Headless CMS
# Arbitrary File Upload and Bypassing .htaccess Rules in Monospace Directus Headless CMS

Title

Arbitrary File Upload and Bypassing .htaccess Rules

Product

Monospace Directus Headless CMS

Vulnerable Version

< v8.8.2

Fixed Version

v8.8.2, v9 is not affected because of different architecture

CVE Number

CVE-2021-29641

Impact

high

Homepage

[https://directus.io/](https://directus.io/ "https://directus.io/")

Found

15.12.2020

By

Oliver Boehlk (Atos Germany), Moritz Friedmann (Atos Germany) | SEC Consult Vulnerability Lab

Monospace Directus CMS Docker images using the Apache webserver with local storage suffer from a vulnerability allowing any authenticated user to upload arbitrary files and directories. This leaves Directus vulnerable to remote code execution and manipulation of webserver .htaccess rules in the default configuration.

## Vendor description

*"Directus Open-Source, Free & Unlimited. No Strings Attached. Our premium software is available at no cost for commercial and personal use. This self-hosted version is full-featured, with no artificial limitations."*

Source: <https://directus.io/open-source/>

## Business recommendation

The vendor provides an updated version for v8 which fixes the security issue. It should be installed immediately.

Note: Directus v8 has been deprecated/discontinued and is replaced by version 9, which currently does not have a final release version yet. Updating to Directus v9 fixes this vulnerability as well because the NodeJS architecture replaces the PHP API and hence is not affected.

According to the vendor, the identified security issue only applies to v8 installations relying on the specific Apache-based config in the Docker image, using the local-storage driver for uploads. The recommendation from the vendor is to use a connection to S3 for such installations, install the patch v8.8.2 or upgrade to version 9.

## Vulnerability overview/description

### 1) Arbitrary File Upload and Bypassing .htaccess Rules (CVE-2021-29641)

Any low privileged user with file upload permissions can upload webshells or other malicious PHP files which can be found in */uploads/\_/originals/*. If the server prevents the execution of PHP files in the upload directory the attacker can move the file into a subdirectory where he can upload a custom *.htaccess* file to enable PHP execution again. Server side command execution can be used to retrieve the Directus configuration and database credentials to escalate in-app privileges, retrieve password hashes or move laterally in the network.

## Proof of concept

### 1) Arbitrary File Upload and Bypassing .htaccess Rules (CVE-2021-29641)

A PoC environment can be created using a *docker-compose.yml* file:

```
version: "3"

services:
  app:
    image: directus/directus:v8.8.1-apache
    ports:
      - 8080:80
    environment:
      DIRECTUS_INSTALL_TITLE: vulnerable directus server
      DIRECTUS_INSTALL_EMAIL: admin@ha.ck
      DIRECTUS_INSTALL_PASSWORD: admin1
      DIRECTUS_AUTH_SECRETKEY: directusprivtest
      DIRECTUS_AUTH_PUBLICKEY: directuspubtest
      DIRECTUS_DATABASE_HOST: db
      DIRECTUS_DATABASE_NAME: directus
      DIRECTUS_DATABASE_USERNAME: directus
      DIRECTUS_DATABASE_PASSWORD: directus

  db:
    image: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: directusroot
      MYSQL_DATABASE: directus
      MYSQL_USER: directus
      MYSQL_PASSWORD: directus
```

 Optionally, Directus data folders can be mounted for persistent storage:

```
volumes:
- ./data/config:/var/directus/config
- ./data/uploads:/var/directus/public/uploads
```

An *.htaccess* file can be placed in the uploads directory to prevent PHP execution:

```
<IfModule mod_php7.c>
  php_flag engine off
</IfModule>
```

Initial installation requires "*install*" to be called:

```
docker-compose up -d && docker-compose run app install
```

Login defined in docker-compose:

```
admin@ha.ck:admin1
```

An attacker can upload a PHP file and open it at *uploads/\_/originals/[randomid].php*. If a .htaccess file is used, the code does not get executed and gets returned in plain text. You can edit the item in Directus and change the Filename Disk to "*test/file.php*" (it doesn't matter that there is no folder named test yet, Directus/Apache does you a favor and creates it for you). Now you can access the file at */uploads/\_/originals/test/file.php*. Even if you delete the file in Directus it remains on the server, and can be accessed via the above mentioned URL.

To get code execution the next step is to simply upload an own *.htaccess* file containing

```
<IfModule mod_php7.c>
  php_flag engine on
</IfModule>
```

And again change the Filename Disk to *test/.htaccess*.

Now calling */uploads/\_/originals/test/file.php* executes the PHP file.

## Vulnerable / tested versions

The following versions have been tested and found to be vulnerable. According to the vendor, only the Apache-based docker image with the local-storage driver is affected and not the Directus suite as a whole.

* v8.4.0
* v8.8.1 (latest version at the time of the test)

It is assumed that all previous v8 versions are affected as well.

Version 9 uses a different architecture and is not affected by this vulnerability.

## Vendor contact timeline

| 2020-12-16 | Contacting vendor through security@directus.io; no reply |
| --- | --- |
| 2021-03-04 | Contacting vendor again through security@directus.io |
| 2021-03-05 | Vendor reply, exchanged S/MIME certificates |
| 2021-03-08 | Sending security advisory to vendor |
| 2021-03-12 | Asking the vendor whether they received the advisory; no reply |
| 2021-03-25 | Asking vendor again for status update |
| 2021-03-25 | Vendor: v8 will be fixed in new version |
| 2021-03-26 | Vendor: the issue has been fixed in v8.8.2 available at dockerhub |
| 2021-04-07 | Coordinated release of security advisory |

## Solution

The vendor provides an updated version v8.8.2 at dockerhub which fixes the security issue:
<https://hub.docker.com/layers/directus/directus/v8.8.2-apache/images/sha256-d9898b6442b0150c3c377b50e706757f35d2d563bd82ddaf97f3ae4ba450a6e6?context=explore>

Alternatively, version 9 can be installed as well, which uses a different architecture and is not affected.

## Workaround

None

## Advisory URL

<https://sec-consult.com/vulnerability-lab/>

EOF O. Boehlk, M. Friedmann / @2021

[Back](/vulnerability-lab/)

* [Legal Notice](/legalnotice/)
* [Privacy Statement](/privacy-statement/)
* [Jobs](/career/)

SEC Consult is one of the leading consultancies in the field of cyber and [application security](/security-testing/web-application-security/ "Web Application Security"). The company specializes in [information security management](/processes-organisation/information-security-management-ism/ "Information Security Management (ISM)"), NIS security audits, [penetration testing](/security-testing/penetration-testing/ "Pentesting (Pentest)"), ISO 27001 certification support, [Cyber Defence](/incident-response/sec-defence/ "Cyber Defence") and [secure software certification](/processes-organisation/secure-software-development/ "Secure Software Development Consulting"). SEC Consult is part of [Eviden](https://eviden.com/ "Link to Eviden website").

[![bsi ISO/IEC 27001 Information Security Management CERTIFIED](/typo3temp/assets/_processed_/c/2/csm_bsi_9a24e74563.png)](/about-us/ "About us")[![ISO 27001 CREST certified](/typo3temp/assets/_processed_/0/6/csm_crest_0eb9c5864d.png)](/about-us/ "About us")[![Great Place To Work AT certified](/typo3temp/assets/_processed_/0/3/csm_great-place-to-work-at_773b265aa6.png)](/about-us/ "About us")[![Great Place To Work DE certified](/typo3temp/assets/_processed_/d/6/csm_great-place-to-work-de_2fcb537270.png)](/about-us/ "About us")

## We use Cookies

We use cookies to offer you a perfect visit experience. These include cookies that are necessary for the operation of the site and for the control of our commercial corporate goals, as well as those that are only used for anonymous statistical purposes, for convenience settings or to display personalized content. Decide for yourself which categories you want to allow. Please note that based on your settings, not all functions of the site may be available.

**[Legal Notice](/legalnotice/)** •  **[Privacy Statement](/privacy-statement/)**

### Technically required

(
0
Service
)

no

Technically required (
0
Service
)

yes

### Analysis / statistics

(
1
Service
)

Anonymous evaluation for troubleshooting and further development

no

Analysis / statistics (
1
Service
)

yes

#### Matomo

no

Matomo

yes

Matomo.org
Show details

Hide details

**Purpose**: Error analysis, statistical evaluation of our website accesses, campaign analysis, conversion tracking.
 **Processing operations**: collection of access data, data from your browser and data about the content accessed; execution of analysis software and storage of data on your terminal device, anonymization of the data collected; evaluation of the anonymous data in the form of statistics.
 **Storage period**: 1 year.
 **Joint controller**: LimeSoda Interactive Marketing GmbH.
 **Legal basis for data processing**: Art. 6 para. 1 lit. f of the DSGVO.
 **Consequences of non-consent**: This basic tracking is absolutely necessary for the operation of our website.
 **Data transfer**: The data collected with Matomo is stored on our own servers. It is not passed on to third parties.

Accept selected

Reject all

Accept all


