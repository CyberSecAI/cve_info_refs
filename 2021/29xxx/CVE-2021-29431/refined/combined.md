=== Content from github.com_67a3c66a_20250114_233028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F8936925f561b0c352c2fa922d5097d7245aad00a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F8936925f561b0c352c2fa922d5097d7245aad00a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/8936925f561b0c352c2fa922d5097d7245aad00a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Validate hostname in more places

[Browse files](/matrix-org/sydent/tree/8936925f561b0c352c2fa922d5097d7245aad00a)
Browse the repository at this point in the history

* Loading branch information

Denis Kasak
committed
Mar 31, 2021

1 parent
[9ad5c3d](/matrix-org/sydent/commit/9ad5c3d9207836b45d06ac0fa591af95d2604d22)

commit 8936925

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**33 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent

  + hs\_federation

    - sydent/hs\_federation/verifier.py
      [verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd)
  + http/servlets

    - sydent/http/servlets/threepidunbindservlet.py
      [threepidunbindservlet.py](#diff-ea41f928977038792db255a53a9b9b910b28d4f512773c7764d5be2b97956c71)
  + threepid

    - sydent/threepid/bind.py
      [bind.py](#diff-bc1cf5b2106c23fe2d1c81c598ae2ae545d6627a54e66889d32498a6d770ccf7)

## There are no files selected for viewing

11 changes: 11 additions & 0 deletions

11
[sydent/hs\_federation/verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd "sydent/hs_federation/verifier.py")

Show comments

[View file](/matrix-org/sydent/blob/8936925f561b0c352c2fa922d5097d7245aad00a/sydent/hs_federation/verifier.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,7 @@ |
|  |  | from signedjson.sign import SignatureVerifyException |
|  |  |  |
|  |  | from sydent.http.httpclient import FederationHttpClient |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
| Expand All | | @@ -37,6 +38,13 @@ class NoAuthenticationError(Exception): |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | class InvalidServerName(Exception): |
|  |  | """ |
|  |  | Raised when the provided origin parameter is not a valid hostname (plus optional port). |
|  |  | """ |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | class Verifier(object): |
|  |  | """ |
|  |  | Verifies signed json blobs from Matrix Homeservers by finding the |
| Expand Down  Expand Up | | @@ -197,6 +205,9 @@ def strip\_quotes(value): |
|  |  | if not json\_request["signatures"]: |
|  |  | raise NoAuthenticationError("Missing X-Matrix Authorization header") |
|  |  |  |
|  |  | if not is\_valid\_hostname(json\_request["origin"]): |
|  |  | raise InvalidServerName("X-Matrix header's origin parameter must be a valid hostname") |
|  |  |  |
|  |  | yield self.verifyServerSignedJson(json\_request, [origin]) |
|  |  |  |
|  |  | logger.info("Verified request from HS %s", origin) |
| Expand Down | |  |

13 changes: 9 additions & 4 deletions

13
[sydent/http/servlets/threepidunbindservlet.py](#diff-ea41f928977038792db255a53a9b9b910b28d4f512773c7764d5be2b97956c71 "sydent/http/servlets/threepidunbindservlet.py")

Show comments

[View file](/matrix-org/sydent/blob/8936925f561b0c352c2fa922d5097d7245aad00a/sydent/http/servlets/threepidunbindservlet.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,7 +19,7 @@ |
|  |  | import json |
|  |  | import logging |
|  |  |  |
|  |  | from sydent.hs\_federation.verifier import NoAuthenticationError |
|  |  | from sydent.hs\_federation.verifier import NoAuthenticationError, InvalidServerName |
|  |  | from signedjson.sign import SignatureVerifyException |
|  |  |  |
|  |  | from sydent.http.servlets import dict\_to\_json\_bytes |
| Expand Down  Expand Up | | @@ -81,7 +81,7 @@ def \_async\_render\_POST(self, request): |
|  |  | # and "client\_secret" fields, they are trying to prove that they |
|  |  | # were the original author of the bind. We then check that what |
|  |  | # they supply matches and if it does, allow the unbind. |
|  |  | # |
|  |  | # |
|  |  | # However if these fields are not supplied, we instead check |
|  |  | # whether the request originated from a homeserver, and if so the |
|  |  | # same homeserver that originally created the bind. We do this by |
| Expand Down  Expand Up | | @@ -121,7 +121,7 @@ def \_async\_render\_POST(self, request): |
|  |  | 'error': "This validation session has not yet been completed" |
|  |  | })) |
|  |  | return |
|  |  |  |
|  |  |  |
|  |  | if s.medium != threepid['medium'] or s.address != threepid['address']: |
|  |  | request.setResponseCode(403) |
|  |  | request.write(dict\_to\_json\_bytes({ |
| Expand All | | @@ -143,7 +143,12 @@ def \_async\_render\_POST(self, request): |
|  |  | request.write(dict\_to\_json\_bytes({'errcode': 'M\_FORBIDDEN', 'error': str(ex)})) |
|  |  | request.finish() |
|  |  | return |
|  |  | except: |
|  |  | except InvalidServerName as ex: |
|  |  | request.setResponseCode(400) |
|  |  | request.write(dict\_to\_json\_bytes({'errcode': 'M\_INVALID\_PARAM', 'error': str(ex)})) |
|  |  | request.finish() |
|  |  | return |
|  |  | except Exception: |
|  |  | logger.exception("Exception whilst authenticating unbind request") |
|  |  | request.setResponseCode(500) |
|  |  | request.write(dict\_to\_json\_bytes({'errcode': 'M\_UNKNOWN', 'error': 'Internal Server Error'})) |
| Expand Down | |  |

14 changes: 13 additions & 1 deletion

14
[sydent/threepid/bind.py](#diff-bc1cf5b2106c23fe2d1c81c598ae2ae545d6627a54e66889d32498a6d770ccf7 "sydent/threepid/bind.py")

Show comments

[View file](/matrix-org/sydent/blob/8936925f561b0c352c2fa922d5097d7245aad00a/sydent/threepid/bind.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,8 @@ |
|  |  |  |
|  |  | from sydent.threepid import ThreepidAssociation |
|  |  |  |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  |  |
|  |  | from twisted.internet import defer |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
| Expand Down  Expand Up | | @@ -131,15 +133,25 @@ def \_notify(self, assoc, attempt): |
|  |  | """ |
|  |  | mxid = assoc["mxid"] |
|  |  | mxid\_parts = mxid.split(":", 1) |
|  |  |  |
|  |  | if len(mxid\_parts) != 2: |
|  |  | logger.error( |
|  |  | "Can't notify on bind for unparseable mxid %s. Not retrying.", |
|  |  | assoc["mxid"], |
|  |  | ) |
|  |  | return |
|  |  |  |
|  |  | matrix\_server = mxid\_parts[1] |
|  |  |  |
|  |  | if not is\_valid\_hostname(matrix\_server): |
|  |  | logger.error( |
|  |  | "MXID server part '%s' not a valid hostname. Not retrying.", |
|  |  | matrix\_server, |
|  |  | ) |
|  |  | return |
|  |  |  |
|  |  | post\_url = "matrix://%s/\_matrix/federation/v1/3pid/onbind" % ( |
|  |  | mxid\_parts[1], |
|  |  | matrix\_server, |
|  |  | ) |
|  |  |  |
|  |  | logger.info("Making bind callback to: %s", post\_url) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8936925`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F8936925f561b0c352c2fa922d5097d7245aad00a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0ae54b10_20250114_233033.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Freleases%2Ftag%2Fv2.3.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Freleases%2Ftag%2Fv2.3.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent/tree/v2.3.0)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent/tree/v2.3.0)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

1. [Releases](/matrix-org/sydent/releases)
2. [v2.3.0](/matrix-org/sydent/releases/tag/v2.3.0)

# Sydent 2.3.0 (2021-04-15)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/sydent/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.3.0)

 Loading

[View all tags](/matrix-org/sydent/tags)

![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)
[richvdh](/richvdh)
released this
15 Apr 11:12

[v2.3.0](/matrix-org/sydent/tree/v2.3.0)

This tag was signed with the committer’s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/1389908?s=64&v=4)](/richvdh)
[richvdh](/richvdh)
Richard van der Hoff

GPG key ID: 392A2BD3423D78FF
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`c2ab108`](/matrix-org/sydent/commit/c2ab10897500dbba1c0d4be33f42985d81bbad7d)

**Note**: this will be the last release of Sydent to support Python 3.5 or earlier. Future releases will require at least Python 3.6.

## Security advisory

This release contains fixes to the following security issues:

* Denial of service attack via disk space or memory exhaustion ([CVE-2021-29430](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29430)).
* SSRF due to missing validation of hostnames ([CVE-2021-29431](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29431)).
* Malicious users could control the content of invitation emails ([CVE-2021-29432](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29432)).
* Denial of service (via resource exhaustion) due to improper input validation ([CVE-2021-29433](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-29433)).

Although we are not aware of these vulnerabilities being exploited in the wild, Sydent server administrators are advised to update as soon as possible. Note that as well as changes to the package, there are also changes to the default email templates. If any templates have been updated locally, they must also be updated in line with the changes to the defaults for full protection from [CVE-2021-29432](https://github.com/advisories/GHSA-mh74-4m5g-fcjx "CVE-2021-29432").

## Features

* Accept an optional `web_client_location` argument to the invite endpoint which allows customisation of the email template. ([#326](https://github.com/matrix-org/sydent/issues/326))
* Move templates to a per-brand subdirectory of `/res`. Add `templates.path` and `brand.default` config options. ([#328](https://github.com/matrix-org/sydent/issues/328))

## Bugfixes

* Fix a regression in v2.2.0 where the wrong characters would be obfuscated in a 3pid invite. ([#317](https://github.com/matrix-org/sydent/issues/317))
* Fix a long-standing bug where invalid JSON would be accepted over the HTTP interfaces. ([#337](https://github.com/matrix-org/sydent/issues/337))
* During user registration on the identity server, validate that the MXID returned by the contacted homeserver is valid for that homeserver. ([cc97fff](https://github.com/matrix-org/sydent/commit/cc97fff))
* Ensure that `/v2/` endpoints are correctly authenticated. ([ce04a68](https://github.com/matrix-org/sydent/commit/ce04a68))
* Perform additional validation on the response received when requesting server signing keys. ([07e6da7](https://github.com/matrix-org/sydent/commit/07e6da7))
* Validate the `matrix_server_name` parameter given during user registration. ([9e57334](https://github.com/matrix-org/sydent/commit/9e57334), [8936925](https://github.com/matrix-org/sydent/commit/8936925), [3d531ed](https://github.com/matrix-org/sydent/commit/3d531ed), [0f00412](https://github.com/matrix-org/sydent/commit/0f00412))
* Limit the size of requests received from HTTP clients. ([89071a1](https://github.com/matrix-org/sydent/commit/89071a1), [0523511](https://github.com/matrix-org/sydent/commit/0523511), [f56eee3](https://github.com/matrix-org/sydent/commit/f56eee3))
* Limit the size of responses received from HTTP servers. ([89071a1](https://github.com/matrix-org/sydent/commit/89071a1), [0523511](https://github.com/matrix-org/sydent/commit/0523511), [f56eee3](https://github.com/matrix-org/sydent/commit/f56eee3))
* In invite emails, randomise the multipart boundary, and include MXIDs where available. ([4469d1d](https://github.com/matrix-org/sydent/commit/4469d1d), [6b405a8](https://github.com/matrix-org/sydent/commit/6b405a8), [65a6e91](https://github.com/matrix-org/sydent/commit/65a6e91))
* Perform additional validation on the `client_secret` and `email` parameters to various APIs. ([3175fd3](https://github.com/matrix-org/sydent/commit/3175fd3))

## Updates to the Docker image

* Base docker image on Debian rather than Alpine Linux. ([#335](https://github.com/matrix-org/sydent/issues/335))

## Internal Changes

* Fix test logging to allow braces in log output. ([#318](https://github.com/matrix-org/sydent/issues/318))
* Install prometheus\_client in the Docker image. ([#325](https://github.com/matrix-org/sydent/issues/325))
* Bump the version of signedjson to 1.1.1. ([#334](https://github.com/matrix-org/sydent/issues/334))

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_570fb36b_20250114_233023.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0f00412017f25619bc36c264b29ea96808bf310a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0f00412017f25619bc36c264b29ea96808bf310a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/0f00412017f25619bc36c264b29ea96808bf310a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Allow IPv6 literals as Matrix server names.

[Browse files](/matrix-org/sydent/tree/0f00412017f25619bc36c264b29ea96808bf310a)
Browse the repository at this point in the history

```
According to the spec, Matrix server names are allowed to be IP
addresses, including IPv6 literals.
```

* Loading branch information

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)

[dkasak](/matrix-org/sydent/commits?author=dkasak "View all commits by dkasak")
committed
Apr 6, 2021

1 parent
[29e7f4f](/matrix-org/sydent/commit/29e7f4fed0c59716ebc8cf745f80069ebee9ef74)

commit 0f00412

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**108 additions**
and
**47 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent

  + hs\_federation

    - sydent/hs\_federation/verifier.py
      [verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd)
  + http/servlets

    - sydent/http/servlets/registerservlet.py
      [registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34)
  + threepid

    - sydent/threepid/bind.py
      [bind.py](#diff-bc1cf5b2106c23fe2d1c81c598ae2ae545d6627a54e66889d32498a6d770ccf7)
  + util

    - sydent/util/stringutils.py
      [stringutils.py](#diff-bac2f8a9bfb8dc3444cf91ec5f50266b29e8c419ece8723590f18dc42516e639)
* tests

  + tests/test\_register.py
    [test\_register.py](#diff-4682147ca75340613cbb9d69a15bab4961497d49b9e56be0a456ff30ba33f46b)
  + tests/test\_util.py
    [test\_util.py](#diff-0dcbadaa6c70afb6fea041dec04bb89c3cc7fe201fb7c3185a669efa49769f28)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[sydent/hs\_federation/verifier.py](#diff-25649c1e21f826c17a0dc63df933d7f5903eac83f6420cce063a2193d3173dbd "sydent/hs_federation/verifier.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/sydent/hs_federation/verifier.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,7 +25,7 @@ |
|  |  | from signedjson.sign import SignatureVerifyException |
|  |  |  |
|  |  | from sydent.http.httpclient import FederationHttpClient |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  | from sydent.util.stringutils import is\_valid\_matrix\_server\_name |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
| Expand Down  Expand Up | | @@ -205,8 +205,8 @@ def strip\_quotes(value): |
|  |  | if not json\_request["signatures"]: |
|  |  | raise NoAuthenticationError("Missing X-Matrix Authorization header") |
|  |  |  |
|  |  | if not is\_valid\_hostname(json\_request["origin"]): |
|  |  | raise InvalidServerName("X-Matrix header's origin parameter must be a valid hostname") |
|  |  | if not is\_valid\_matrix\_server\_name(json\_request["origin"]): |
|  |  | raise InvalidServerName("X-Matrix header's origin parameter must be a valid Matrix server name") |
|  |  |  |
|  |  | yield self.verifyServerSignedJson(json\_request, [origin]) |
|  |  |  |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[sydent/http/servlets/registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34 "sydent/http/servlets/registerservlet.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/sydent/http/servlets/registerservlet.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,7 +25,7 @@ |
|  |  | from sydent.http.servlets import get\_args, jsonwrap, deferjsonwrap, send\_cors |
|  |  | from sydent.http.httpclient import FederationHttpClient |
|  |  | from sydent.users.tokens import issueToken |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  | from sydent.util.stringutils import is\_valid\_matrix\_server\_name |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand All | | @@ -49,11 +49,11 @@ def render\_POST(self, request): |
|  |  |  |
|  |  | matrix\_server = args['matrix\_server\_name'].lower() |
|  |  |  |
|  |  | if not is\_valid\_hostname(matrix\_server): |
|  |  | if not is\_valid\_matrix\_server\_name(matrix\_server): |
|  |  | request.setResponseCode(400) |
|  |  | return { |
|  |  | 'errcode': 'M\_INVALID\_PARAM', |
|  |  | 'error': 'matrix\_server\_name must be a valid hostname' |
|  |  | 'error': 'matrix\_server\_name must be a valid Matrix server name (IP address or hostname)' |
|  |  | } |
|  |  |  |
|  |  | result = yield self.client.get\_json( |
| Expand Down  Expand Up | | @@ -89,7 +89,7 @@ def render\_POST(self, request): |
|  |  |  |
|  |  | user\_id\_server = user\_id\_components[1] |
|  |  |  |
|  |  | if not is\_valid\_hostname(user\_id\_server): |
|  |  | if not is\_valid\_matrix\_server\_name(user\_id\_server): |
|  |  | request.setResponseCode(500) |
|  |  | return { |
|  |  | 'errcode': 'M\_UNKNOWN', |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[sydent/threepid/bind.py](#diff-bc1cf5b2106c23fe2d1c81c598ae2ae545d6627a54e66889d32498a6d770ccf7 "sydent/threepid/bind.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/sydent/threepid/bind.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,7 +32,7 @@ |
|  |  |  |
|  |  | from sydent.threepid import ThreepidAssociation |
|  |  |  |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  | from sydent.util.stringutils import is\_valid\_matrix\_server\_name |
|  |  |  |
|  |  | from twisted.internet import defer |
|  |  |  |
| Expand Down  Expand Up | | @@ -143,9 +143,9 @@ def \_notify(self, assoc, attempt): |
|  |  |  |
|  |  | matrix\_server = mxid\_parts[1] |
|  |  |  |
|  |  | if not is\_valid\_hostname(matrix\_server): |
|  |  | if not is\_valid\_matrix\_server\_name(matrix\_server): |
|  |  | logger.error( |
|  |  | "MXID server part '%s' not a valid hostname. Not retrying.", |
|  |  | "MXID server part '%s' not a valid Matrix server name. Not retrying.", |
|  |  | matrix\_server, |
|  |  | ) |
|  |  | return |
| Expand Down  Expand Up | | @@ -184,7 +184,7 @@ def \_notify(self, assoc, attempt): |
|  |  | "Successfully deleted invite for %s from the store", |
|  |  | assoc["address"], |
|  |  | ) |
|  |  | except Exception as e: |
|  |  | except Exception: |
|  |  | logger.exception( |
|  |  | "Couldn't remove invite for %s from the store", |
|  |  | assoc["address"], |
| Expand Down | |  |

85 changes: 67 additions & 18 deletions

85
[sydent/util/stringutils.py](#diff-bac2f8a9bfb8dc3444cf91ec5f50266b29e8c419ece8723590f18dc42516e639 "sydent/util/stringutils.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/sydent/util/stringutils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,11 +13,14 @@ |
|  |  | # See the License for the specific language governing permissions and |
|  |  | # limitations under the License. |
|  |  | import re |
|  |  | from typing import Optional, Tuple |
|  |  |  |
|  |  | from twisted.internet.abstract import isIPAddress, isIPv6Address |
|  |  |  |
|  |  | # https://matrix.org/docs/spec/client\_server/r0.6.0#post-matrix-client-r0-register-email-requesttoken |
|  |  | client\_secret\_regex = re.compile(r"^[0-9a-zA-Z\.\=\\_\-]+$") |
|  |  |  |
|  |  | # hostname/domain name + optional port |
|  |  | # hostname/domain name |
|  |  | # https://regex101.com/r/OyN1lg/2 |
|  |  | hostname\_regex = re.compile( |
|  |  | r"^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)\*$", |
| Expand All | | @@ -37,12 +40,10 @@ def is\_valid\_client\_secret(client\_secret): |
|  |  |  |
|  |  |  |
|  |  | def is\_valid\_hostname(string: str) -> bool: |
|  |  | """Validate that a given string is a valid hostname or domain name, with an |
|  |  | optional port number. |
|  |  | """Validate that a given string is a valid hostname or domain name. |
|  |  |  |
|  |  | For domain names, this only validates that the form is right (for |
|  |  | instance, it doesn't check that the TLD is valid). If a port is |
|  |  | specified, it has to be a valid port number. |
|  |  | instance, it doesn't check that the TLD is valid). |
|  |  |  |
|  |  | :param string: The string to validate |
|  |  | :type string: str |
| Expand All | | @@ -51,20 +52,68 @@ def is\_valid\_hostname(string: str) -> bool: |
|  |  | :rtype: bool |
|  |  | """ |
|  |  |  |
|  |  | host\_parts = string.split(":", 1) |
|  |  | return hostname\_regex.match(string) is not None |
|  |  |  |
|  |  |  |
|  |  | def parse\_server\_name(server\_name: str) -> Tuple[str, Optional[int]]: |
|  |  | """Split a server name into host/port parts. |
|  |  |  |
|  |  | if len(host\_parts) == 1: |
|  |  | return hostname\_regex.match(string) is not None |
|  |  | else: |
|  |  | host, port = host\_parts |
|  |  | valid\_hostname = hostname\_regex.match(host) is not None |
|  |  | No validation is done on the host part. The port part is validated to be |
|  |  | a valid port number. |
|  |  |  |
|  |  | try: |
|  |  | Args: |
|  |  | server\_name: server name to parse |
|  |  |  |
|  |  | Returns: |
|  |  | host/port parts. |
|  |  |  |
|  |  | Raises: |
|  |  | ValueError if the server name could not be parsed. |
|  |  | """ |
|  |  | try: |
|  |  | if server\_name[-1] == "]": |
|  |  | # ipv6 literal, hopefully |
|  |  | return server\_name, None |
|  |  |  |
|  |  | host\_port = server\_name.rsplit(":", 1) |
|  |  | host = host\_port[0] |
|  |  | port = host\_port[1] if host\_port[1:] else None |
|  |  |  |
|  |  | if port: |
|  |  | port\_num = int(port) |
|  |  | valid\_port = ( |
|  |  | port == str(port\_num) # exclude things like '08090' or ' 8090' |
|  |  | and 1 <= port\_num < 65536) |
|  |  | except ValueError: |
|  |  | valid\_port = False |
|  |  |  |
|  |  | return valid\_hostname and valid\_port |
|  |  | # exclude things like '08090' or ' 8090' |
|  |  | if port != str(port\_num) or not (1 <= port\_num < 65536): |
|  |  | raise ValueError("Invalid port") |
|  |  |  |
|  |  | return host, port |
|  |  | except Exception: |
|  |  | raise ValueError("Invalid server name '%s'" % server\_name) |
|  |  |  |
|  |  |  |
|  |  | def is\_valid\_matrix\_server\_name(string: str) -> bool: |
|  |  | """Validate that the given string is a valid Matrix server name. |
|  |  |  |
|  |  | A string is a valid Matrix server name if it is one of the following, plus |
|  |  | an optional port: |
|  |  |  |
|  |  | a. IPv4 address |
|  |  | b. IPv6 literal (`[IPV6\_ADDRESS]`) |
|  |  | c. A valid hostname |
|  |  |  |
|  |  | :param string: The string to validate |
|  |  | :type string: str |
|  |  |  |
|  |  | :return: Whether the input is a valid Matrix server name |
|  |  | :rtype: bool |
|  |  | """ |
|  |  |  |
|  |  | try: |
|  |  | host, port = parse\_server\_name(string) |
|  |  | except ValueError: |
|  |  | return False |
|  |  |  |
|  |  | valid\_ipv4\_addr = isIPAddress(host) |
|  |  | valid\_ipv6\_literal = host[0] == "[" and host[-1] == "]" and isIPv6Address(host[1:-1]) |
|  |  |  |
|  |  | return valid\_ipv4\_addr or valid\_ipv6\_literal or is\_valid\_hostname(host) |

1 change: 1 addition & 0 deletions

1
[tests/test\_register.py](#diff-4682147ca75340613cbb9d69a15bab4961497d49b9e56be0a456ff30ba33f46b "tests/test_register.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/tests/test_register.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  |  |
|  |  | class RegisterTestCase(unittest.TestCase): |
|  |  | """Tests Sydent's register servlet""" |
|  |  |  |
|  |  | def setUp(self): |
|  |  | # Create a new sydent |
|  |  | self.sydent = make\_sydent() |
| Expand Down | |  |

47 changes: 29 additions & 18 deletions

47
[tests/test\_util.py](#diff-0dcbadaa6c70afb6fea041dec04bb89c3cc7fe201fb7c3185a669efa49769f28 "tests/test_util.py")

Show comments

[View file](/matrix-org/sydent/blob/0f00412017f25619bc36c264b29ea96808bf310a/tests/test_util.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,26 +1,37 @@ |
|  |  | from twisted.trial import unittest |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  | from sydent.util.stringutils import is\_valid\_matrix\_server\_name |
|  |  |  |
|  |  |  |
|  |  | class UtilTests(unittest.TestCase): |
|  |  | """Tests Sydent utility functions.""" |
|  |  | def test\_is\_valid\_hostname(self): |
|  |  | """Tests that the is\_valid\_hostname function accepts only valid |
|  |  | hostnames (or domain names), with optional port number. |
|  |  |  |
|  |  | def test\_is\_valid\_matrix\_server\_name(self): |
|  |  | """Tests that the is\_valid\_matrix\_server\_name function accepts only |
|  |  | valid hostnames (or domain names), with optional port number. |
|  |  | """ |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("9.9.9.9")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("9.9.9.9:4242")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("[::]")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("[::]:4242")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("[a:b:c::]:4242")) |
|  |  |  |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("example.com")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("EXAMPLE.COM")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("ExAmPlE.CoM")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("example.com:4242")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("localhost")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("localhost:9000")) |
|  |  | self.assertTrue(is\_valid\_matrix\_server\_name("a.b.c.d:1234")) |
|  |  |  |
|  |  | self.assertTrue(is\_valid\_hostname("example.com")) |
|  |  | self.assertTrue(is\_valid\_hostname("EXAMPLE.COM")) |
|  |  | self.assertTrue(is\_valid\_hostname("ExAmPlE.CoM")) |
|  |  | self.assertTrue(is\_valid\_hostname("example.com:4242")) |
|  |  | self.assertTrue(is\_valid\_hostname("localhost")) |
|  |  | self.assertTrue(is\_valid\_hostname("localhost:9000")) |
|  |  | self.assertTrue(is\_valid\_hostname("a.b:1234")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("[:::]")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("a:b:c::")) |
|  |  |  |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:65536")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:0")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:a")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:04242")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com: 4242")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com/example.com")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com#example.com")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com:65536")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com:0")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com:-1")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com:a")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com: ")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com:04242")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com: 4242")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com/example.com")) |
|  |  | self.assertFalse(is\_valid\_matrix\_server\_name("example.com#example.com")) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0f00412`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F0f00412017f25619bc36c264b29ea96808bf310a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from pypi.org_1168f50a_20250114_233039.html ===

![Error Icon](/_fs-ch-1T1wmsGaOgGaSxcX/assets/errorIcon.svg)
JavaScript is disabled in your browser.
Please enable JavaScript to proceed.

A required part of this site couldn’t load. This may be due to a browser
extension, network issues, or browser settings. Please check your
connection, disable any ad blockers, or try using a different browser.



=== Content from github.com_659a5be7_20250114_233036.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fsecurity%2Fadvisories%2FGHSA-9jhm-8m8c-c3f4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fsecurity%2Fadvisories%2FGHSA-9jhm-8m8c-c3f4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

# SSRF due to missing validation of hostnames

Low

[richvdh](/richvdh)
published
GHSA-9jhm-8m8c-c3f4
Apr 15, 2021

## Package

pip

matrix-sydent
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<= 2.2.0

## Patched versions

2.3.0

## Description

### Impact

Sydent can be induced to send HTTP GET requests to internal systems, due to lack of parameter validation or IP address blacklisting.

It is not possible to exfiltrate data or control request headers, but it might be possible to use the attack to perform an internal port enumeration.

### Patches

Fixed in [9e57334](https://github.com/matrix-org/sydent/commit/9e573348d81df8191bbe8c266c01999c9d57cd5f), [8936925](https://github.com/matrix-org/sydent/commit/8936925f561b0c352c2fa922d5097d7245aad00a), [3d531ed](https://github.com/matrix-org/sydent/commit/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3), [0f00412](https://github.com/matrix-org/sydent/commit/0f00412017f25619bc36c264b29ea96808bf310a)

### Workarounds

A potential workaround would be to use a firewall to ensure that Sydent cannot reach internal HTTP resources.

### References

n/a

### For more information

If you have any questions or comments about this advisory, email us at security@matrix.org.

### Severity

Low

### CVE ID

CVE-2021-29431

### Weaknesses

[CWE-918](/advisories?query=cwe%3A918)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c0ba3499_20250114_233025.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add BlacklistingReactor

[Browse files](/matrix-org/sydent/tree/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3)
Browse the repository at this point in the history

```
This is a port from the Synapse codebase.
```

* Loading branch information

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

[erikjohnston](/matrix-org/sydent/commits?author=erikjohnston "View all commits by erikjohnston")
committed
Apr 6, 2021

1 parent
[29e7f4f](/matrix-org/sydent/commit/29e7f4fed0c59716ebc8cf745f80069ebee9ef74)

commit 3d531ed

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**613 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* matrix\_is\_test

  + matrix\_is\_test/launcher.py
    [launcher.py](#diff-0b98349bac27ab7b15898e21221e98ff6c73a73e144446fefb9c249c95a27170)
* sydent

  + http

    - sydent/http/blacklisting\_reactor.py
      [blacklisting\_reactor.py](#diff-8b276057a16d7338c6eab0c48926ccd4cf5e81baa766933d580bc12a7b8d5a26)
    - sydent/http/httpclient.py
      [httpclient.py](#diff-203d0f99b7ac9eac8535e83cbae93ee7b5a2609803c67775d4d330b316d11620)
  + sydent/sydent.py
    [sydent.py](#diff-97cdbf29ed12611bcd7aec521a011e84d9857a8837fd72f7eb75d36195f18391)
  + util

    - sydent/util/ip\_range.py
      [ip\_range.py](#diff-7ac345f2cd98d7429d41c34902e2076fd43959c8b3a4a5ca477938de9fc1cad9)
* tests

  + tests/test\_blacklisting.py
    [test\_blacklisting.py](#diff-03e9a864a8a6bbfe2b820364390851e89706ec4e481769a452ea2c923b7e0e0a)
  + tests/utils.py
    [utils.py](#diff-9e08e8c7769db7b58089fd7659d75ca96df40bb7b5d50299d3a30abd54da9ad6)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[matrix\_is\_test/launcher.py](#diff-0b98349bac27ab7b15898e21221e98ff6c73a73e144446fefb9c249c95a27170 "matrix_is_test/launcher.py")

Show comments

[View file](/matrix-org/sydent/blob/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3/matrix_is_test/launcher.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,6 +36,9 @@ |
|  |  | templates.path = {testsubject\_path}/res |
|  |  | brand.default = is-test |
|  |  |  |
|  |  |  |
|  |  | ip.whitelist = 127.0.0.1 |
|  |  |  |
|  |  | [email] |
|  |  | email.tlsmode = 0 |
|  |  | email.invite.subject = %(sender\_display\_name)s has invited you to chat |
| Expand Down | |  |

155 changes: 155 additions & 0 deletions

155
[sydent/http/blacklisting\_reactor.py](#diff-8b276057a16d7338c6eab0c48926ccd4cf5e81baa766933d580bc12a7b8d5a26 "sydent/http/blacklisting_reactor.py")

Show comments

[View file](/matrix-org/sydent/blob/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3/sydent/http/blacklisting_reactor.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,155 @@ |
|  |  | # -\*- coding: utf-8 -\*- |
|  |  | # Copyright 2021 The Matrix.org Foundation C.I.C. |
|  |  | # |
|  |  | # Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | # you may not use this file except in compliance with the License. |
|  |  | # You may obtain a copy of the License at |
|  |  | # |
|  |  | # http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | # |
|  |  | # Unless required by applicable law or agreed to in writing, software |
|  |  | # distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | # See the License for the specific language governing permissions and |
|  |  | # limitations under the License. |
|  |  | import logging |
|  |  | from typing import ( |
|  |  | Any, |
|  |  | List, |
|  |  | Optional, |
|  |  | ) |
|  |  |  |
|  |  | from zope.interface import implementer, provider |
|  |  | from netaddr import IPAddress, IPSet |
|  |  |  |
|  |  | from twisted.internet.address import IPv4Address, IPv6Address |
|  |  | from twisted.internet.interfaces import ( |
|  |  | IAddress, |
|  |  | IHostResolution, |
|  |  | IReactorPluggableNameResolver, |
|  |  | IResolutionReceiver, |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
|  |  |  |
|  |  | def check\_against\_blacklist( |
|  |  | ip\_address: IPAddress, ip\_whitelist: Optional[IPSet], ip\_blacklist: IPSet |
|  |  | ) -> bool: |
|  |  | """ |
|  |  | Compares an IP address to allowed and disallowed IP sets. |
|  |  |  |
|  |  | Args: |
|  |  | ip\_address: The IP address to check |
|  |  | ip\_whitelist: Allowed IP addresses. |
|  |  | ip\_blacklist: Disallowed IP addresses. |
|  |  |  |
|  |  | Returns: |
|  |  | True if the IP address is in the blacklist and not in the whitelist. |
|  |  | """ |
|  |  | if ip\_address in ip\_blacklist: |
|  |  | if ip\_whitelist is None or ip\_address not in ip\_whitelist: |
|  |  | return True |
|  |  | return False |
|  |  |  |
|  |  |  |
|  |  | class \_IPBlacklistingResolver: |
|  |  | """ |
|  |  | A proxy for reactor.nameResolver which only produces non-blacklisted IP |
|  |  | addresses, preventing DNS rebinding attacks on URL preview. |
|  |  | """ |
|  |  |  |
|  |  | def \_\_init\_\_( |
|  |  | self, |
|  |  | reactor: IReactorPluggableNameResolver, |
|  |  | ip\_whitelist: Optional[IPSet], |
|  |  | ip\_blacklist: IPSet, |
|  |  | ): |
|  |  | """ |
|  |  | Args: |
|  |  | reactor: The twisted reactor. |
|  |  | ip\_whitelist: IP addresses to allow. |
|  |  | ip\_blacklist: IP addresses to disallow. |
|  |  | """ |
|  |  | self.\_reactor = reactor |
|  |  | self.\_ip\_whitelist = ip\_whitelist |
|  |  | self.\_ip\_blacklist = ip\_blacklist |
|  |  |  |
|  |  | def resolveHostName( |
|  |  | self, recv: IResolutionReceiver, hostname: str, portNumber: int = 0 |
|  |  | ) -> IResolutionReceiver: |
|  |  | addresses = [] # type: List[IAddress] |
|  |  |  |
|  |  | def \_callback() -> None: |
|  |  | has\_bad\_ip = False |
|  |  | for address in addresses: |
|  |  | # We only expect IPv4 and IPv6 addresses since only A/AAAA lookups |
|  |  | # should go through this path. |
|  |  | if not isinstance(address, (IPv4Address, IPv6Address)): |
|  |  | continue |
|  |  |  |
|  |  | ip\_address = IPAddress(address.host) |
|  |  |  |
|  |  | if check\_against\_blacklist( |
|  |  | ip\_address, self.\_ip\_whitelist, self.\_ip\_blacklist |
|  |  | ): |
|  |  | logger.info( |
|  |  | "Dropped %s from DNS resolution to %s due to blacklist" |
|  |  | % (ip\_address, hostname) |
|  |  | ) |
|  |  | has\_bad\_ip = True |
|  |  |  |
|  |  | # if we have a blacklisted IP, we'd like to raise an error to block the |
|  |  | # request, but all we can really do from here is claim that there were no |
|  |  | # valid results. |
|  |  | if not has\_bad\_ip: |
|  |  | for address in addresses: |
|  |  | recv.addressResolved(address) |
|  |  | recv.resolutionComplete() |
|  |  |  |
|  |  | @provider(IResolutionReceiver) |
|  |  | class EndpointReceiver: |
|  |  | @staticmethod |
|  |  | def resolutionBegan(resolutionInProgress: IHostResolution) -> None: |
|  |  | recv.resolutionBegan(resolutionInProgress) |
|  |  |  |
|  |  | @staticmethod |
|  |  | def addressResolved(address: IAddress) -> None: |
|  |  | addresses.append(address) |
|  |  |  |
|  |  | @staticmethod |
|  |  | def resolutionComplete() -> None: |
|  |  | \_callback() |
|  |  |  |
|  |  | self.\_reactor.nameResolver.resolveHostName( |
|  |  | EndpointReceiver, hostname, portNumber=portNumber |
|  |  | ) |
|  |  |  |
|  |  | return recv |
|  |  |  |
|  |  |  |
|  |  | @implementer(IReactorPluggableNameResolver) |
|  |  | class BlacklistingReactorWrapper: |
|  |  | """ |
|  |  | A Reactor wrapper which will prevent DNS resolution to blacklisted IP |
|  |  | addresses, to prevent DNS rebinding. |
|  |  | """ |
|  |  |  |
|  |  | def \_\_init\_\_( |
|  |  | self, |
|  |  | reactor: IReactorPluggableNameResolver, |
|  |  | ip\_whitelist: Optional[IPSet], |
|  |  | ip\_blacklist: IPSet, |
|  |  | ): |
|  |  | self.\_reactor = reactor |
|  |  |  |
|  |  | # We need to use a DNS resolver which filters out blacklisted IP |
|  |  | # addresses, to prevent DNS rebinding. |
|  |  | self.nameResolver = \_IPBlacklistingResolver( |
|  |  | self.\_reactor, ip\_whitelist, ip\_blacklist |
|  |  | ) |
|  |  |  |
|  |  | def \_\_getattr\_\_(self, attr: str) -> Any: |
|  |  | # Passthrough to the real reactor except for the DNS resolver. |
|  |  | return getattr(self.\_reactor, attr) |

17 changes: 13 additions & 4 deletions

17
[sydent/http/httpclient.py](#diff-203d0f99b7ac9eac8535e83cbae93ee7b5a2609803c67775d4d330b316d11620 "sydent/http/httpclient.py")

Show comments

[View file](/matrix-org/sydent/blob/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3/sydent/http/httpclient.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,8 +22,9 @@ |
|  |  | from twisted.internet import defer |
|  |  | from twisted.web.client import FileBodyProducer, Agent, readBody |
|  |  | from twisted.web.http\_headers import Headers |
|  |  | from sydent.http.matrixfederationagent import MatrixFederationAgent |
|  |  |  |
|  |  | from sydent.http.blacklisting\_reactor import BlacklistingReactorWrapper |
|  |  | from sydent.http.matrixfederationagent import MatrixFederationAgent |
|  |  | from sydent.http.federation\_tls\_options import ClientTLSOptionsFactory |
|  |  | from sydent.http.httpcommon import BodyExceededMaxSize, read\_body\_with\_max\_size |
|  |  |  |
| Expand Down  Expand Up | | @@ -116,7 +117,11 @@ def \_\_init\_\_(self, sydent): |
|  |  | # BrowserLikePolicyForHTTPS context factory which will do regular cert validation |
|  |  | # 'like a browser' |
|  |  | self.agent = Agent( |
|  |  | self.sydent.reactor, |
|  |  | BlacklistingReactorWrapper( |
|  |  | reactor=self.sydent.reactor, |
|  |  | ip\_whitelist=sydent.ip\_whitelist, |
|  |  | ip\_blacklist=sydent.ip\_blacklist, |
|  |  | ), |
|  |  | connectTimeout=15, |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -127,6 +132,10 @@ class FederationHttpClient(HTTPClient): |
|  |  | def \_\_init\_\_(self, sydent): |
|  |  | self.sydent = sydent |
|  |  | self.agent = MatrixFederationAgent( |
|  |  | self.sydent.reactor, |
|  |  | ClientTLSOptionsFactory(sydent.cfg), |
|  |  | BlacklistingReactorWrapper( |
|  |  | reactor=self.sydent.reactor, |
|  |  | ip\_whitelist=sydent.ip\_whitelist, |
|  |  | ip\_blacklist=sydent.ip\_blacklist, |
|  |  | ), |
|  |  | ClientTLSOptionsFactory(sydent.cfg) if sydent.use\_tls\_for\_federation else None, |
|  |  | ) |

40 changes: 39 additions & 1 deletion

40
[sydent/sydent.py](#diff-97cdbf29ed12611bcd7aec521a011e84d9857a8837fd72f7eb75d36195f18391 "sydent/sydent.py")

Show comments

[View file](/matrix-org/sydent/blob/3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3/sydent/sydent.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,7 @@ |
|  |  | import logging |
|  |  | import logging.handlers |
|  |  | import os |
|  |  | from typing import Set |
|  |  |  |
|  |  | import twisted.internet.reactor |
|  |  | from twisted.internet import task |
| Expand All | | @@ -46,6 +47,7 @@ |
|  |  |  |
|  |  | from sydent.util.hash import sha256\_and\_url\_safe\_base64 |
|  |  | from sydent.util.tokenutils import generateAlphanumericTokenOfLength |
|  |  | from sydent.util.ip\_range import generate\_ip\_set, DEFAULT\_IP\_RANGE\_BLACKLIST |
|  |  |  |
|  |  | from sydent.sign.ed25519 import SydentEd25519 |
|  |  |  |
| Expand Down  Expand Up | | @@ -107,6 +109,26 @@ |
|  |  | # Whether clients and homeservers can register an association using v1 endpoints. |
|  |  | 'enable\_v1\_associations': 'true', |
|  |  | 'delete\_tokens\_on\_bind': 'true', |
|  |  |  |
|  |  | # Prevent outgoing requests from being sent to the following blacklisted |
|  |  | # IP address CIDR ranges. If this option is not specified or empty then |
|  |  | # it defaults to private IP address ranges. |
|  |  | # |
|  |  | # The blacklist applies to all outbound requests except replication |
|  |  | # requests. |
|  |  | # |
|  |  | # (0.0.0.0 and :: are always blacklisted, whether or not they are |
|  |  | # explicitly listed here, since they correspond to unroutable |
|  |  | # addresses.) |
|  |  | 'ip.blacklist': '', |
|  |  |  |
|  |  | # List of IP address CIDR ranges that should be allowed for outbound |
|  |  | # requests. This is useful for specifying exceptions to wide-ranging |
|  |  | # blacklisted target IP ranges. |
|  |  | # |
|  |  | # This whitelist overrides `ip.blacklist` and defaults to an empty |
|  |  | # list. |
|  |  | 'ip.whitelist': '', |
|  |  | }, |
|  |  | 'db': { |
|  |  | 'db.file': os.environ.get('SYDENT\_DB\_PATH', 'sydent.db'), |
| Expand Down  Expand Up | | @@ -183,9 +205,10 @@ |
|  |  |  |
|  |  |  |
|  |  | class Sydent: |
|  |  | def \_\_init\_\_(self, cfg, reactor=twisted.internet.reactor): |
|  |  | def \_\_init\_\_(self, cfg, reactor=twisted.internet.reactor, use\_tls\_for\_federation=True): |
|  |  | self.reactor = reactor |
|  |  | self.config\_file = get\_config\_file\_path() |
|  |  | self.use\_tls\_for\_federation = use\_tls\_for\_federation |
|  |  |  |
|  |  | self.cfg = cfg |
|  |  |  |
| Expand Down  Expand Up | | @@ -241,6 +264,15 @@ def \_\_init\_\_(self, cfg, reactor=twisted.internet.reactor): |
|  |  | self.cfg.get("general", "delete\_tokens\_on\_bind") |
|  |  | ) |
|  |  |  |
|  |  | ip\_blacklist = set\_from\_comma\_sep\_string(self.cfg.get("general", "ip.blacklist")) |
|  |  | if not ip\_blacklist: |
|  |  | ip\_blacklist = DEFAULT\_IP\_RANGE\_BLACKLIST |
|  |  |  |
|  |  | ip\_whitelist = set\_from\_comma\_sep\_string(self.cfg.get("general", "ip.whitelist")) |
|  |  |  |
|  |  | self.ip\_blacklist = generate\_ip\_set(ip\_blacklist) |
|  |  | self.ip\_whitelist = generate\_ip\_set(ip\_whitelist) |
|  |  |  |
|  |  | self.default\_web\_client\_location = self.cfg.get( |
|  |  | "email", "email.default\_web\_client\_location" |
|  |  | ) |
| Expand Down  Expand Up | | @@ -512,6 +544,12 @@ def parse\_cfg\_bool(value): |
|  |  | return value.lower() == "true" |
|  |  |  |
|  |  |  |
|  |  | def set\_from\_comma\_sep\_string(rawstr: str) -> Set[str]: |
|  |  | if rawstr == '': |
|  |  | return set() |
|  |  | return {x.strip() for x in rawstr.split(',')} |
|  |  |  |
|  |  |  |
|  |  | def run\_gc(): |
|  |  | threshold = gc.get\_threshold() |
|  |  | counts = gc.get\_count() |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3d531ed`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F3d531ed50d2fd41ac387f36d44d3fb2c62dd22d3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7522fe99_20250114_233031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F9e573348d81df8191bbe8c266c01999c9d57cd5f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F9e573348d81df8191bbe8c266c01999c9d57cd5f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fsydent)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[sydent](/matrix-org/sydent)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsydent) You must be signed in to change notification settings
* [Fork
  84](/login?return_to=%2Fmatrix-org%2Fsydent)
* [Star
   308](/login?return_to=%2Fmatrix-org%2Fsydent)

* [Code](/matrix-org/sydent)
* [Issues
  49](/matrix-org/sydent/issues)
* [Pull requests
  5](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects
  0](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

Additional navigation options

* [Code](/matrix-org/sydent)
* [Issues](/matrix-org/sydent/issues)
* [Pull requests](/matrix-org/sydent/pulls)
* [Actions](/matrix-org/sydent/actions)
* [Projects](/matrix-org/sydent/projects)
* [Security](/matrix-org/sydent/security)
* [Insights](/matrix-org/sydent/pulse)

## Commit

[Permalink](/matrix-org/sydent/commit/9e573348d81df8191bbe8c266c01999c9d57cd5f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Rework hostname validation to make port checking stricter.

[Browse files](/matrix-org/sydent/tree/9e573348d81df8191bbe8c266c01999c9d57cd5f)
Browse the repository at this point in the history

```
Instead of using a regex to validate the entire hostname + port
combination, we now split the hostname into components and check each
component separately. This makes the regex a bit simpler and allows us
to validate the port number better, including that it belongs to the
valid range.
```

* Loading branch information

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

Denis Kasak
authored and
[clokep](/matrix-org/sydent/commits?author=clokep "View all commits by clokep")
committed
Mar 24, 2021

1 parent
[809ad96](/matrix-org/sydent/commit/809ad96f183fec960e3239084fd72b5b994853c2)

commit 9e57334

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**128 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* sydent

  + http/servlets

    - sydent/http/servlets/registerservlet.py
      [registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34)
  + util

    - sydent/util/stringutils.py
      [stringutils.py](#diff-bac2f8a9bfb8dc3444cf91ec5f50266b29e8c419ece8723590f18dc42516e639)
* tests

  + tests/test\_auth.py
    [test\_auth.py](#diff-a99307c61c3c55875b5bb65e0b045ccd074e277afe3cca9665e7dbd33023daf9)
  + tests/test\_register.py
    [test\_register.py](#diff-4682147ca75340613cbb9d69a15bab4961497d49b9e56be0a456ff30ba33f46b)
  + tests/test\_util.py
    [test\_util.py](#diff-0dcbadaa6c70afb6fea041dec04bb89c3cc7fe201fb7c3185a669efa49769f28)

## There are no files selected for viewing

17 changes: 14 additions & 3 deletions

17
[sydent/http/servlets/registerservlet.py](#diff-8bda8960de6f410fdd26afd13f0335a05884ab41b041e00b0bbcca690b446f34 "sydent/http/servlets/registerservlet.py")

Show comments

[View file](/matrix-org/sydent/blob/9e573348d81df8191bbe8c266c01999c9d57cd5f/sydent/http/servlets/registerservlet.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,7 +25,7 @@ |
|  |  | from sydent.http.servlets import get\_args, jsonwrap, deferjsonwrap, send\_cors |
|  |  | from sydent.http.httpclient import FederationHttpClient |
|  |  | from sydent.users.tokens import issueToken |
|  |  |  |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand All | | @@ -47,9 +47,20 @@ def render\_POST(self, request): |
|  |  |  |
|  |  | args = get\_args(request, ('matrix\_server\_name', 'access\_token')) |
|  |  |  |
|  |  | hostname = args['matrix\_server\_name'].lower() |
|  |  |  |
|  |  | if not is\_valid\_hostname(hostname): |
|  |  | request.setResponseCode(400) |
|  |  | return { |
|  |  | 'errcode': 'M\_INVALID\_PARAM', |
|  |  | 'error': 'matrix\_server\_name must be a valid hostname' |
|  |  | } |
|  |  |  |
|  |  | result = yield self.client.get\_json( |
|  |  | "matrix://%s/\_matrix/federation/v1/openid/userinfo?access\_token=%s" % ( |
|  |  | args['matrix\_server\_name'], urllib.parse.quote(args['access\_token']), |
|  |  | "matrix://%s/\_matrix/federation/v1/openid/userinfo?access\_token=%s" |
|  |  | % ( |
|  |  | hostname, |
|  |  | urllib.parse.quote(args['access\_token']), |
|  |  | ), |
|  |  | 1024 \* 5, |
|  |  | ) |
| Expand Down | |  |

42 changes: 41 additions & 1 deletion

42
[sydent/util/stringutils.py](#diff-bac2f8a9bfb8dc3444cf91ec5f50266b29e8c419ece8723590f18dc42516e639 "sydent/util/stringutils.py")

Show comments

[View file](/matrix-org/sydent/blob/9e573348d81df8191bbe8c266c01999c9d57cd5f/sydent/util/stringutils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,14 +17,54 @@ |
|  |  | # https://matrix.org/docs/spec/client\_server/r0.6.0#post-matrix-client-r0-register-email-requesttoken |
|  |  | client\_secret\_regex = re.compile(r"^[0-9a-zA-Z\.\=\\_\-]+$") |
|  |  |  |
|  |  | # hostname/domain name + optional port |
|  |  | # https://regex101.com/r/OyN1lg/2 |
|  |  | hostname\_regex = re.compile( |
|  |  | r"^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)\*$", |
|  |  | flags=re.IGNORECASE) |
|  |  |  |
|  |  |  |
|  |  | def is\_valid\_client\_secret(client\_secret): |
|  |  | """Validate that a given string matches the client\_secret regex defined by the spec |
|  |  |  |
|  |  | :param client\_secret: The client\_secret to validate |
|  |  | :type client\_secret: unicode |
|  |  | :type client\_secret: str |
|  |  |  |
|  |  | :return: Whether the client\_secret is valid |
|  |  | :rtype: bool |
|  |  | """ |
|  |  | return client\_secret\_regex.match(client\_secret) is not None |
|  |  |  |
|  |  |  |
|  |  | def is\_valid\_hostname(string: str) -> bool: |
|  |  | """Validate that a given string is a valid hostname or domain name, with an |
|  |  | optional port number. |
|  |  |  |
|  |  | For domain names, this only validates that the form is right (for |
|  |  | instance, it doesn't check that the TLD is valid). If a port is |
|  |  | specified, it has to be a valid port number. |
|  |  |  |
|  |  | :param string: The string to validate |
|  |  | :type string: str |
|  |  |  |
|  |  | :return: Whether the input is a valid hostname |
|  |  | :rtype: bool |
|  |  | """ |
|  |  |  |
|  |  | host\_parts = string.split(":", 1) |
|  |  |  |
|  |  | if len(host\_parts) == 1: |
|  |  | return hostname\_regex.match(string) is not None |
|  |  | else: |
|  |  | host, port = host\_parts |
|  |  | valid\_hostname = hostname\_regex.match(host) is not None |
|  |  |  |
|  |  | try: |
|  |  | port\_num = int(port) |
|  |  | valid\_port = ( |
|  |  | port == str(port\_num) # exclude things like '08090' or ' 8090' |
|  |  | and 1 <= port\_num < 65536 |
|  |  | except ValueError: |
|  |  | valid\_port = False |
|  |  |  |
|  |  | return valid\_hostname and valid\_port |

4 changes: 2 additions & 2 deletions

4
[tests/test\_auth.py](#diff-a99307c61c3c55875b5bb65e0b045ccd074e277afe3cca9665e7dbd33023daf9 "tests/test_auth.py")

Show comments

[View file](/matrix-org/sydent/blob/9e573348d81df8191bbe8c266c01999c9d57cd5f/tests/test_auth.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,7 @@ def setUp(self): |
|  |  | self.sydent.db.commit() |
|  |  |  |
|  |  | def test\_can\_read\_token\_from\_headers(self): |
|  |  | """Tests that Sydent correct extracts an auth token from request headers""" |
|  |  | """Tests that Sydent correctly extracts an auth token from request headers""" |
|  |  | self.sydent.run() |
|  |  |  |
|  |  | request, \_ = make\_request( |
| Expand All | | @@ -59,7 +59,7 @@ def test\_can\_read\_token\_from\_headers(self): |
|  |  | self.assertEqual(token, self.test\_token) |
|  |  |  |
|  |  | def test\_can\_read\_token\_from\_query\_parameters(self): |
|  |  | """Tests that Sydent correct extracts an auth token from query parameters""" |
|  |  | """Tests that Sydent correctly extracts an auth token from query parameters""" |
|  |  | self.sydent.run() |
|  |  |  |
|  |  | request, \_ = make\_request( |
| Expand Down | |  |

45 changes: 45 additions & 0 deletions

45
[tests/test\_register.py](#diff-4682147ca75340613cbb9d69a15bab4961497d49b9e56be0a456ff30ba33f46b "tests/test_register.py")

Show comments

[View file](/matrix-org/sydent/blob/9e573348d81df8191bbe8c266c01999c9d57cd5f/tests/test_register.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,45 @@ |
|  |  | # -\*- coding: utf-8 -\*- |
|  |  |  |
|  |  | # Copyright 2021 The Matrix.org Foundation C.I.C. |
|  |  | # |
|  |  | # Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | # you may not use this file except in compliance with the License. |
|  |  | # You may obtain a copy of the License at |
|  |  | # |
|  |  | # http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | # |
|  |  | # Unless required by applicable law or agreed to in writing, software |
|  |  | # distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | # See the License for the specific language governing permissions and |
|  |  | # limitations under the License. |
|  |  |  |
|  |  | from twisted.trial import unittest |
|  |  |  |
|  |  | from tests.utils import make\_request, make\_sydent |
|  |  |  |
|  |  |  |
|  |  | class RegisterTestCase(unittest.TestCase): |
|  |  | """Tests Sydent's register servlet""" |
|  |  | def setUp(self): |
|  |  | # Create a new sydent |
|  |  | self.sydent = make\_sydent() |
|  |  |  |
|  |  | def test\_sydent\_rejects\_invalid\_hostname(self): |
|  |  | """Tests that the /register endpoint rejects an invalid hostname passed as matrix\_server\_name""" |
|  |  | self.sydent.run() |
|  |  |  |
|  |  | bad\_hostname = "example.com#" |
|  |  |  |
|  |  | request, channel = make\_request( |
|  |  | self.sydent.reactor, |
|  |  | "POST", |
|  |  | "/\_matrix/identity/v2/account/register", |
|  |  | content={ |
|  |  | "matrix\_server\_name": bad\_hostname, |
|  |  | "access\_token": "foo" |
|  |  | }) |
|  |  |  |
|  |  | request.render(self.sydent.servlets.registerServlet) |
|  |  |  |
|  |  | self.assertEqual(channel.code, 400) |

26 changes: 26 additions & 0 deletions

26
[tests/test\_util.py](#diff-0dcbadaa6c70afb6fea041dec04bb89c3cc7fe201fb7c3185a669efa49769f28 "tests/test_util.py")

Show comments

[View file](/matrix-org/sydent/blob/9e573348d81df8191bbe8c266c01999c9d57cd5f/tests/test_util.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,26 @@ |
|  |  | from twisted.trial import unittest |
|  |  | from sydent.util.stringutils import is\_valid\_hostname |
|  |  |  |
|  |  |  |
|  |  | class UtilTests(unittest.TestCase): |
|  |  | """Tests Sydent utility functions.""" |
|  |  | def test\_is\_valid\_hostname(self): |
|  |  | """Tests that the is\_valid\_hostname function accepts only valid |
|  |  | hostnames (or domain names), with optional port number. |
|  |  | """ |
|  |  |  |
|  |  | self.assertTrue(is\_valid\_hostname("example.com")) |
|  |  | self.assertTrue(is\_valid\_hostname("EXAMPLE.COM")) |
|  |  | self.assertTrue(is\_valid\_hostname("ExAmPlE.CoM")) |
|  |  | self.assertTrue(is\_valid\_hostname("example.com:4242")) |
|  |  | self.assertTrue(is\_valid\_hostname("localhost")) |
|  |  | self.assertTrue(is\_valid\_hostname("localhost:9000")) |
|  |  | self.assertTrue(is\_valid\_hostname("a.b:1234")) |
|  |  |  |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:65536")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:0")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:a")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com:04242")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com: 4242")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com/example.com")) |
|  |  | self.assertFalse(is\_valid\_hostname("example.com#example.com")) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9e57334`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsydent%2Fcommit%2F9e573348d81df8191bbe8c266c01999c9d57cd5f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


