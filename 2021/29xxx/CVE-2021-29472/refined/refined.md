```json
{
  "CVE-2021-29472": {
    "description": "URLs for Mercurial repositories in the root composer.json and package source download URLs are not sanitized correctly. Specifically crafted URL values allow commands to be executed in the HgDriver if hg/Mercurial is installed on the system.",
    "affected_versions": "<1.10.22 || >=2.0,<2.0.13",
    "patched_versions": "1.10.22, 2.0.13",
    "root_cause": "The vulnerability stems from the way Composer handles URLs for Mercurial repositories and package source downloads. Specifically, it fails to sanitize these URLs, allowing for the injection of malicious parameters. While the URL is escaped using `escapeshellarg()`, it does not prevent the injection of additional arguments starting with a dash (`-`).",
    "weaknesses": [
      "Parameter or Argument Injection (CWE-141): User-controlled data, while escaped to prevent shell subcommands, is concatenated to system commands without proper isolation, leading to the interpretation of the injected values as options."
    ],
    "impact": "An attacker can achieve arbitrary command execution on systems where the Composer tool is used to process a malicious `composer.json` file, or a malicious source download URL. This can lead to complete system compromise, including stealing of maintainers' credentials, and redirection of package downloads to third-party servers delivering backdoored dependencies. Packagist.org and Private Packagist were vulnerable to remote command injection.",
    "attack_vectors": "An attacker can inject malicious parameters into Mercurial repository URLs within the `composer.json` file or via package source download URLs. This is exploited through the `HgDriver`, which is used by Composer to interact with Mercurial repositories. Specifically, the `--config` option of the hg command is used to alias commands and execute arbitrary code.",
    "attacker_capabilities": "The attacker needs to be able to control either the `composer.json` file (e.g. by creating a malicious package and submitting it to a repository) or to provide the source download URLs to trigger the vulnerability, for example, through a third-party repository. Attackers can target services passing user input to Composer, such as Packagist or Private Packagist.",
      "additional_info": "The vulnerability was found in the `HgDriver` class, where user controlled URLs are passed to the `hg` command without proper sanitization that prevents option injection.  The fix implemented in versions 1.10.22 and 2.0.13 include adding `--` to the command to separate options from positional arguments.  The impact to Composer users directly is limited as the composer.json file is typically under their own control and source download URLs can only be supplied by third party Composer repositories they explicitly trust to download and execute source code from, e.g. Composer plugins."
  }
}
```