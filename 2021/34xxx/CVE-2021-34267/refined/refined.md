The provided content discusses a vulnerability in the STM32CubeH7 USB host library, specifically within the Mass Storage Class (MSC) implementation.

**Root Cause:**
The vulnerability stems from the `USBH_MSC_InterfaceInit` function in `usbh_msc.c` not properly checking if both IN and OUT pipes are constructed for communication. The code initializes endpoints based on the `bEndpointAddress` from the endpoint descriptor, and if both addresses are masked as either IN or OUT, the MSC handler initializes only one direction instead of both, leading to communication failure. The issue arises because the code at `usbh_ctlreq.c` does not ensure that one endpoint is IN and the other is OUT.

**Weaknesses/Vulnerabilities:**
- Lack of validation of endpoint directions (IN/OUT) during MSC interface initialization.
- Assumption that endpoints will always be a pair of IN and OUT, which is not always the case.

**Impact of Exploitation:**
- Denial-of-Service (DoS): The system hangs when attempting to communicate with the USB endpoint due to improper initialization of IN/OUT pipes.
- Inability to communicate with USB Mass Storage devices using MSC protocol.

**Attack Vectors:**
- Crafting a malicious USB device that presents two endpoints with the same direction (either two IN or two OUT endpoints) in its endpoint descriptor.
- Replacing the legitimate USB device packet with a crafted one having the same direction.

**Required Attacker Capabilities/Position:**
- Physical access to the vulnerable device.
- Ability to provide a malicious USB device or manipulate the data packets.
- Basic understanding of the USB protocol and device descriptors.

The issue was reported and assigned to ST internal team with reference number 99173, the fix was released in v1.10.0.