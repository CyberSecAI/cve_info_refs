=== Content from rustsec.org_67d2f11e_20250114_211851.html ===


RUSTSEC-2021-0018: qwutils: insert\_slice\_clone can double drop if Clone panics. › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/qwutils/RUSTSEC-2021-0018.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/qwutils/RUSTSEC-2021-0018.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0018)

# RUSTSEC-2021-0018

insert\_slice\_clone can double drop if Clone panics.

Reported
February 3, 2021

Issued
February 4, 2021

(last modified: June 13, 2023)

Package
[qwutils](/packages/qwutils.html)
([crates.io](https://crates.io/crates/qwutils))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#memory-safety](/keywords/memory-safety.html)
[#double-free](/keywords/double-free.html)

Aliases

* [CVE-2021-26954](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26954)
* [GHSA-68p4-pjpf-xwcq](https://github.com/advisories/GHSA-68p4-pjpf-xwcq)

References

* <https://github.com/qwertz19281/rust_utils/issues/3>

CVSS Score
5.3
MEDIUM

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityNone
IntegrityNone
AvailabilityLow

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L)
Patched

* `>=0.3.1`

Affected Functions
Version
`qwutils::imp::vec::VecExt::insert_slice_clone`

* `<0.3.1`

### Description

Affected versions of this crate used `ptr::copy` when inserting into the middle
of a `Vec`. When ownership was temporarily duplicated during this copy, it calls
the clone method of a user provided element.

This issue can result in an element being double-freed if the clone call panics.

Commit `20cb73d` fixed this issue by adding a `set_len(0)` call before
operating on the vector to avoid dropping the elements during a panic.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


