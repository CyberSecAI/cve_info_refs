=== Content from github.com_66592237_20250114_184057.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fliballeg%2Fallegro5%2Fissues%2F1251)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fliballeg%2Fallegro5%2Fissues%2F1251)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=liballeg%2Fallegro5)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[liballeg](/liballeg)
/
**[allegro5](/liballeg/allegro5)**
Public

* [Notifications](/login?return_to=%2Fliballeg%2Fallegro5) You must be signed in to change notification settings
* [Fork
  290](/login?return_to=%2Fliballeg%2Fallegro5)
* [Star
   1.9k](/login?return_to=%2Fliballeg%2Fallegro5)

* [Code](/liballeg/allegro5)
* [Issues
  367](/liballeg/allegro5/issues)
* [Pull requests
  19](/liballeg/allegro5/pulls)
* [Discussions](/liballeg/allegro5/discussions)
* [Actions](/liballeg/allegro5/actions)
* [Security](/liballeg/allegro5/security)
* [Insights](/liballeg/allegro5/pulse)

Additional navigation options

* [Code](/liballeg/allegro5)
* [Issues](/liballeg/allegro5/issues)
* [Pull requests](/liballeg/allegro5/pulls)
* [Discussions](/liballeg/allegro5/discussions)
* [Actions](/liballeg/allegro5/actions)
* [Security](/liballeg/allegro5/security)
* [Insights](/liballeg/allegro5/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fliballeg%2Fallegro5%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fliballeg%2Fallegro5%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# segmentation fault to al\_load\_bitmap #1251

Closed

[NigelX](/NigelX) opened this issue
Jun 8, 2021
· 10 comments
 · Fixed by [#1253](https://github.com/liballeg/allegro5/pull/1253)

Closed

# [segmentation fault to al\_load\_bitmap](#top) #1251

[NigelX](/NigelX) opened this issue
Jun 8, 2021
· 10 comments
 · Fixed by [#1253](https://github.com/liballeg/allegro5/pull/1253)

## Comments

[![@NigelX](https://avatars.githubusercontent.com/u/25973989?s=80&u=8cb6021908087a7239847331092ee2941f1dd4cb&v=4)](/NigelX)

Copy link

### **[NigelX](/NigelX)** commented [Jun 8, 2021](#issue-914646406) • edited Loading

| Hi , I found an error while learning the exmple example. system info: ubuntu 20.02 TLS clang 11 comit:03ab10df438860c7c17cf427e3282027d913d93f  ``` $ ./ex_bitmap crash ```  [crash.zip](https://github.com/liballeg/allegro5/files/6615102/crash.zip)  gdb info  ``` Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] RAX: 0xff82ff82ff82ff82  RBX: 0x0  RCX: 0x15d5  RDX: 0x1  RSI: 0x7fffffffdc7f --> 0x10ff  RDI: 0x61de50 --> 0xff82ff82ff82ff82  RBP: 0x61ddf0 --> 0xff82ff8200000000  RSP: 0x7fffffffdc70 --> 0x61f8b0 --> 0x0  RIP: 0x7ffff7e70fda (<al_fgetc+170>:	call   QWORD PTR [rax+0x10]) R8 : 0x7d ('}') R9 : 0x61ddf0 --> 0xff82ff8200000000  R10: 0x0  R11: 0x7ffff766cbe0 --> 0x620270 --> 0x0  R12: 0x61de50 --> 0xff82ff82ff82ff82  R13: 0x40a180 --> 0x40a210 --> 0x100000102000100  R14: 0x0  R15: 0x0 EFLAGS: 0x10246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------]    0x7ffff7e70fd0 <al_fgetc+160>:	mov    edx,0x1    0x7ffff7e70fd5 <al_fgetc+165>:	xor    ebx,ebx    0x7ffff7e70fd7 <al_fgetc+167>:	mov    rax,QWORD PTR [rdi] => 0x7ffff7e70fda <al_fgetc+170>:	call   QWORD PTR [rax+0x10]    0x7ffff7e70fdd <al_fgetc+173>:	add    rax,rbx    0x7ffff7e70fe0 <al_fgetc+176>:	cmp    rax,0x1    0x7ffff7e70fe4 <al_fgetc+180>:	movzx  ecx,BYTE PTR [rsp+0xf]    0x7ffff7e70fe9 <al_fgetc+185>:	mov    eax,0xffffffff Guessed arguments: arg[0]: 0x61de50 --> 0xff82ff82ff82ff82  arg[1]: 0x7fffffffdc7f --> 0x10ff  arg[2]: 0x1  arg[3]: 0x15d5  [------------------------------------stack-------------------------------------] 0000| 0x7fffffffdc70 --> 0x61f8b0 --> 0x0  0008| 0x7fffffffdc78 --> 0xff82000000000002  0016| 0x7fffffffdc80 --> 0x10  0024| 0x7fffffffdc88 --> 0x7ffff7fb98e8 (<_al_load_tga_f+3784>:	mov    ebx,eax) 0032| 0x7fffffffdc90 --> 0x7fff00100958  0040| 0x7fffffffdc98 --> 0x61ddf0 --> 0xff82ff8200000000  0048| 0x7fffffffdca0 --> 0xf0040a180  0056| 0x7fffffffdca8 --> 0x10  [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x00007ffff7e70fda in al_fread (f=0x61de50, ptr=0x7fffffffdc7f, size=<optimized out>) at /home/hh/Downloads/allegro5/src/file.c:116 116	      return bytes_ungetc + f->vtable->fi_fread(f, cptr, size); ```  ``` #0  0x00007ffff7e70fda in al_fread (f=0x61de50, ptr=0x7fffffffdc7f, size=<optimized out>) at /home/hh/Downloads/allegro5/src/file.c:116 #1  al_fgetc (f=f@entry=0x61de50) at /home/hh/Downloads/allegro5/src/file.c:229 #2  0x00007ffff7fb98e8 in rle_tga_read16 (b=0x61ddf0, w=<optimized out>, f=<optimized out>) at /home/hh/Downloads/allegro5/addons/image/tga.c:212 #3  _al_load_tga_f (f=f@entry=0x61de50, flags=flags@entry=0x0) at /home/hh/Downloads/allegro5/addons/image/tga.c:467 #4  0x00007ffff7fba51f in _al_load_tga (filename=0x7fffffffe595 "crash",      flags=0x0) at /home/hh/Downloads/allegro5/addons/image/tga.c:565 #5  0x00007ffff7e22753 in al_load_bitmap_flags (     filename=filename@entry=0x7fffffffe595 "crash", flags=0xffffdc7f)     at /home/hh/Downloads/allegro5/src/bitmap_io.c:207 #6  0x00007ffff7e22622 in al_load_bitmap (     filename=filename@entry=0x7fffffffe595 "crash")     at /home/hh/Downloads/allegro5/src/bitmap_io.c:184 #7  0x0000000000403688 in main (argc=argc@entry=0x2, argv=argv@entry=0x7fffffffe2d8) at /home/hh/Downloads/allegro5/examples/ex_bitmap.c:77 #8  0x00007ffff74a80b3 in __libc_start_main (main=0x4035a0 <main>, argc=0x2, argv=0x7fffffffe2d8, init=<optimized out>, fini=<optimized out>,      rtld_fini=<optimized out>, stack_end=0x7fffffffe2c8) at ../csu/libc-start.c:308 #9  0x00000000004032fe in _start () ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 8, 2021](#issuecomment-856610206)

| what is that file `crash`, is it supposed to be an image or is it just random data? (are you expecting allegro to be able to open it?) |
| --- |

All reactions

Sorry, something went wrong.

[![@NigelX](https://avatars.githubusercontent.com/u/25973989?s=80&u=8cb6021908087a7239847331092ee2941f1dd4cb&v=4)](/NigelX)

Copy link

Author

### **[NigelX](/NigelX)** commented [Jun 8, 2021](#issuecomment-856619326)

| Refer to CVSS3.0 Denial of Service |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 8, 2021](#issuecomment-856699268)

| Still, it is useful to include "Expected behavior" in the bug report.  AFAICS the file `crash` is a (corrupt) TGA file, hence we should be looking at the tga loader.  Ran this with `-fsanitize=address`, looks interesting:  ``` ================================================================= ==24770==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6030000176a0 at pc 0x7ffff71cbf9f bp 0x7fffffffd820 sp 0x7fffffffd818 WRITE of size 2 at 0x6030000176a0 thread T0     #0 0x7ffff71cbf9e in raw_tga_read16 /home/peter/Projects/allegro5/addons/image/tga.c:197     #1 0x7ffff71cc088 in rle_tga_read16 /home/peter/Projects/allegro5/addons/image/tga.c:225     #2 0x7ffff71cd846 in _al_load_tga_f /home/peter/Projects/allegro5/addons/image/tga.c:467     #3 0x7ffff71ce4fd in _al_load_tga /home/peter/Projects/allegro5/addons/image/tga.c:565     #4 0x7ffff6e181b7 in al_load_bitmap_flags /home/peter/Projects/allegro5/src/bitmap_io.c:207     #5 0x7ffff6e180bb in al_load_bitmap /home/peter/Projects/allegro5/src/bitmap_io.c:184     #6 0x555555556850 in main /home/peter/Projects/allegro5/examples/ex_bitmap.c:76     #7 0x7ffff581009a in __libc_start_main ../csu/libc-start.c:308     #8 0x5555555562e9 in _start (/home/peter/Projects/allegro5/build/examples/ex_bitmap+0x22e9)  0x6030000176a0 is located 0 bytes to the right of 32-byte region [0x603000017680,0x6030000176a0) allocated by thread T0 here:     #0 0x7ffff72d1330 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.5+0xe9330)     #1 0x7ffff6e7eaf3 in al_malloc_with_context /home/peter/Projects/allegro5/src/memory.c:44     #2 0x7ffff71ccb9a in _al_load_tga_f /home/peter/Projects/allegro5/addons/image/tga.c:377     #3 0x7ffff71ce4fd in _al_load_tga /home/peter/Projects/allegro5/addons/image/tga.c:565     #4 0x7ffff6e181b7 in al_load_bitmap_flags /home/peter/Projects/allegro5/src/bitmap_io.c:207     #5 0x7ffff6e180bb in al_load_bitmap /home/peter/Projects/allegro5/src/bitmap_io.c:184     #6 0x555555556850 in main /home/peter/Projects/allegro5/examples/ex_bitmap.c:76     #7 0x7ffff581009a in __libc_start_main ../csu/libc-start.c:308  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/peter/Projects/allegro5/addons/image/tga.c:197 in raw_tga_read16 Shadow bytes around the buggy address:   0x0c067fffae80: fa fa fd fd fd fa fa fa fd fd fd fd fa fa fd fd   0x0c067fffae90: fd fd fa fa fd fd fd fa fa fa fd fd fd fd fa fa   0x0c067fffaea0: 00 00 00 00 fa fa fd fd fd fd fa fa fd fd fd fd   0x0c067fffaeb0: fa fa 00 00 00 00 fa fa fd fd fd fd fa fa fd fd   0x0c067fffaec0: fd fa fa fa 00 00 00 00 fa fa 00 00 00 fa fa fa =>0x0c067fffaed0: 00 00 00 00[fa]fa fa fa fa fa fa fa fa fa fa fa   0x0c067fffaee0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c067fffaef0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c067fffaf00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c067fffaf10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c067fffaf20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==24770==ABORTING  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=40&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)
[pedro-w](/pedro-w)
mentioned this issue
[Jun 8, 2021](#ref-pullrequest-915409676)

[Prevent RLE data in corrupt .tga from overflowing the buffer
#1253](/liballeg/allegro5/pull/1253)
 Merged

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 9, 2021](#issuecomment-858042988)

| Just to be clear: the PR above will make `al_load_bitmap` return NULL, as it would for any un-loadable bitmap. I assume, unless [@NigelX](https://github.com/NigelX) tells me otherwise, that the provided file `crash` is not a valid bitmap. |
| --- |

All reactions

Sorry, something went wrong.

[![@NigelX](https://avatars.githubusercontent.com/u/25973989?s=80&u=8cb6021908087a7239847331092ee2941f1dd4cb&v=4)](/NigelX)

Copy link

Author

### **[NigelX](/NigelX)** commented [Jun 11, 2021](#issuecomment-859384770)

| Hi,[@pedro-w](https://github.com/pedro-w) I sent other samples via email to allegro-security@lists.liballeg.org, but no response was received. |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 11, 2021](#issuecomment-859405663)

| Alright. I don't have access to that list, so I can't comment. Maybe [@allefant](https://github.com/allefant) does have access? |
| --- |

All reactions

Sorry, something went wrong.

[![@SiegeLord](https://avatars.githubusercontent.com/u/480550?s=80&u=fc17302207213a069a4776b0709c0bc76d4a62d2&v=4)](/SiegeLord)

Copy link

Member

### **[SiegeLord](/SiegeLord)** commented [Jun 11, 2021](#issuecomment-859451389)

| [@pedro-w](https://github.com/pedro-w) If you send me your email (e.g. by sending it to that list), I can add you to the list. Sadly, it doesn't appear to have archives, but we can arrange for something here. |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 11, 2021](#issuecomment-859835320)

| On the case. |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 15, 2021](#issuecomment-861255922)

| Current status: fixes applied, but automated tests are now failing and I need to understand why. |
| --- |

All reactions

Sorry, something went wrong.

[![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=80&u=a846647e8de480c5e068552a24ce67250671c8b5&v=4)](/pedro-w)

Copy link

Contributor

### **[pedro-w](/pedro-w)** commented [Jun 15, 2021](#issuecomment-861356310)

| automated tests are now failing and I need to understand why.  Oops, my fault. Tests now passing. |
| --- |

All reactions

Sorry, something went wrong.

[![@SiegeLord](https://avatars.githubusercontent.com/u/480550?s=40&u=fc17302207213a069a4776b0709c0bc76d4a62d2&v=4)](/SiegeLord)
[SiegeLord](/SiegeLord)
closed this as [completed](/liballeg/allegro5/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#1253](/liballeg/allegro5/pull/1253)
[Jun 27, 2021](#event-4944451086)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fliballeg%2Fallegro5%2Fissues%2F1251)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Prevent RLE data in corrupt .tga from overflowing the buffer](/liballeg/allegro5/pull/1253)
 [pedro-w/allegro5](/pedro-w/allegro5)

3 participants

[![@SiegeLord](https://avatars.githubusercontent.com/u/480550?s=52&v=4)](/SiegeLord) [![@pedro-w](https://avatars.githubusercontent.com/u/22172519?s=52&v=4)](/pedro-w) [![@NigelX](https://avatars.githubusercontent.com/u/25973989?s=52&v=4)](/NigelX)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


