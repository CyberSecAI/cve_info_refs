Based on the provided information, here's an analysis of CVE-2021-36084:

**Root Cause of Vulnerability:**

*   The vulnerability is a heap-use-after-free error in the `__cil_verify_classperms` function within the SELinux CIL (Common Intermediate Language) compiler.

**Weaknesses/Vulnerabilities Present:**

*   **Use-After-Free:** The `classperms` list associated with a `classpermission` rule was being destroyed improperly during a reset operation of the `classpermission` rule. The `classperms` list is populated during the processing of `classpermissionset` rules. When a `classpermission` rule is reset, the code would destroy the `classperms` list, but not clear the reference to it. This left the underlying memory freed and the pointer dangling. Subsequently, when the code attempted to use the `classperms` list again, a use-after-free condition would occur, leading to the crash.

**Impact of Exploitation:**

*   **Crash:** The primary impact is a crash in the CIL compiler, as observed by the AddressSanitizer reports. This could lead to denial of service. The crash occurs when trying to read from the freed memory.

**Attack Vectors:**

*   The vulnerability is triggered during the compilation of a specially crafted CIL policy.
*   The provided CIL policy snippet demonstrates a scenario that leads to the vulnerability. It includes an optional block with a `roletype` that does not exist, and a `classpermissionset` that uses an existing class. This combination causes the code to reset the `classpermission` rule, which is where the use-after-free occurs.

**Required Attacker Capabilities/Position:**

*   An attacker would need to be able to provide a crafted CIL policy to the SELinux policy compiler.
*   No specific elevated privileges are mentioned for the exploitation but the ability to compile policies is usually limited to authorized users.

**Additional Notes:**

*   The provided commit diff shows the fix for this vulnerability:  the `cil_reset_classpermission` function was modified to destroy the classperms list (without destroying the underlying data it references) before destroying the list itself, thus preventing the use-after-free error.
*   The vulnerability was initially reported by Nicolas Iooss and fixed by James Carter.
*   The vulnerability was identified using OSS-Fuzz, a fuzzing platform used to find vulnerabilities.

This analysis provides a more detailed explanation of the vulnerability than the basic CVE description, outlining the root cause, vulnerable code, attack vector, and resolution.