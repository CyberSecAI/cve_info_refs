The provided content relates to CVE-2021-36130.

**Root cause of vulnerability:**
- The vulnerability is a stored cross-site scripting (XSS) issue. It arises due to insufficient sanitization of user-provided input in the `SystemGifts` feature of the MediaWiki SocialProfile extension. Specifically, the title of a created system gift is not properly escaped, allowing for the injection of malicious JavaScript code.

**Weaknesses/vulnerabilities present:**
- Stored XSS vulnerability.
- Inadequate input sanitization on gift titles in `Special:SystemGiftManager`.
- Incorrect usage of `$this->msg( 'some message key' )->plain()`, which was intended to output plain text but did not perform HTML escaping.

**Impact of exploitation:**
- An attacker can inject malicious JavaScript code into the title of a system gift.
- The injected script executes when a user views the gift award, either on the `Special:ViewSystemGifts` page or through the "View all" link on a user's profile page if they have more than 4 awards.
- This allows the attacker to potentially perform actions as the victim user, steal cookies/session data, or redirect the user to malicious sites. The XSS is stored, which means that the attacker's payload can potentially affect many users over an extended period.

**Attack vectors:**
- A privileged user (with the "awardmanage" user right) needs to access `Special:SystemGiftManager`.
- They create a new system gift, crafting a malicious title containing JavaScript code, such as `<script>alert('XSS')</script>`.
- This malicious payload is stored in the database.
- The XSS is triggered when a user views the list of SystemGifts, specifically on the Special:ViewSystemGifts page, or via the "View all" link on a user profile page if the user has more than 4 awards.

**Required attacker capabilities/position:**
- The attacker needs to have a privileged user account with the `awardmanage` user right.
- They need to be able to create a new system gift via the `Special:SystemGiftManager` page.

**Additional details:**
- The vulnerability is present in the `SystemGifts` functionality but not in `UserGifts` functionality.
- The vulnerability was fixed by:
  - Escaping user input by changing `->plain()` to `->escaped()` where necessary.
  - Ensuring that `LinkRenderer` is passed raw text using `->text()` instead of escaped text to avoid double escaping.
  - Removing parsing format from `Message` objects passed to `OutputPage#setPageTitle`.
  - Adding explicit integer casting for `gift_id` parameter.
  - Running the timestamp through `Language#userTimeAndDate` which also performs escaping.