=== Content from github.com_28d2558c_20250114_185308.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femissary-ingress%2Femissary%2Freleases%2Ftag%2Fv2.0.0-ea)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femissary-ingress%2Femissary%2Freleases%2Ftag%2Fv2.0.0-ea)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=emissary-ingress%2Femissary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[emissary-ingress](/emissary-ingress)
/
**[emissary](/emissary-ingress/emissary)**
Public

* [Notifications](/login?return_to=%2Femissary-ingress%2Femissary) You must be signed in to change notification settings
* [Fork
  687](/login?return_to=%2Femissary-ingress%2Femissary)
* [Star
   4.4k](/login?return_to=%2Femissary-ingress%2Femissary)

* [Code](/emissary-ingress/emissary/tree/v2.0.0-ea)
* [Issues
  356](/emissary-ingress/emissary/issues)
* [Pull requests
  138](/emissary-ingress/emissary/pulls)
* [Actions](/emissary-ingress/emissary/actions)
* [Projects
  1](/emissary-ingress/emissary/projects)
* [Wiki](/emissary-ingress/emissary/wiki)
* [Security](/emissary-ingress/emissary/security)
* [Insights](/emissary-ingress/emissary/pulse)

Additional navigation options

* [Code](/emissary-ingress/emissary/tree/v2.0.0-ea)
* [Issues](/emissary-ingress/emissary/issues)
* [Pull requests](/emissary-ingress/emissary/pulls)
* [Actions](/emissary-ingress/emissary/actions)
* [Projects](/emissary-ingress/emissary/projects)
* [Wiki](/emissary-ingress/emissary/wiki)
* [Security](/emissary-ingress/emissary/security)
* [Insights](/emissary-ingress/emissary/pulse)

1. [Releases](/emissary-ingress/emissary/releases)
2. [v2.0.0-ea](/emissary-ingress/emissary/releases/tag/v2.0.0-ea)

# Emissary Ingress 2.0.0-ea

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/emissary-ingress/emissary/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.0.0-ea)

 Loading

[View all tags](/emissary-ingress/emissary/tags)

![@acookin](https://avatars.githubusercontent.com/u/73843761?s=40&v=4)
[acookin](/acookin)
released this
24 Jun 22:33

·
[2583 commits](/emissary-ingress/emissary/compare/v2.0.0-ea...master)
to master
since this release

[v2.0.0-ea](/emissary-ingress/emissary/tree/v2.0.0-ea)

[`00c1c76`](/emissary-ingress/emissary/commit/00c1c766b5725bd64b3c638b84ec3af023b71a61)

## 🎉 Emissary Ingress 2.0.0-ea 🎉

#### Emissary Ingress is an open source, Kubernetes-native microservices API gateway built on the Envoy Proxy.

Upgrade Emissary - <https://www.getambassador.io/reference/upgrading.html>

View changelog - <https://github.com/emissary-ingress/emissary/blob/master/CHANGELOG.md>

Get started with Emissary on Kubernetes - <https://www.getambassador.io/user-guide/getting-started>

We're pleased to introduce Emissary 2.0.0 as a developer preview. The 2.X family introduces a number of changes to allow Emissary to more gracefully handle larger installations, reduce global configuration to better handle multitenant or multiorganizational installations, reduce memory footprint, and improve performance. We welcome feedback!! Join us on [Slack](https://a8r.io/slack) and let us know what you think.

* Feature: The `Listener` CRD allows explicit definition of ports to listen on, the protocols and security model for each port, and which `Host`s should be associated with which `Listener`.
* Bugfix: `requestPolicy.insecure.action` works independently across `Host`s ([#2888](https://github.com/datawire/ambassador/issues/2888))
* Bugfix: Fixed a regression in detecting the Ambassador Kubernetes service that could cause the wrong IP or hostname to be used in Ingress statuses.
* Change: `Host`s and `Mapping`s will not be associated unless a `Host` selector or a `Mapping`'s `host` element explicitly agree.
* Change: `Mapping`'s `host` field is either an exact match or (with `host_regex` set) a regex. `Mapping` now has a new `hostname` element that is functionally the same as `host`, but is always a DNS glob.
* Change: The `tls` field on the Ambassador module is now deprecated. Please use TLSContexts instead <https://www.getambassador.io/docs/edge-stack/latest/topics/running/tls/#tlscontext>.
* Change: Envoy V3 is now the default.
* Change: The `Host` CRD is now required when terminating TLS.
* Change: The AGENT\_SERVICE environment variable has been deprecated.
* Change: `redirect_cleartext_from` in a `TLSContext` is no longer supported -- use an extra 'Listener' instead!
* Change: `prune_unreachable_routes` now defaults to true, which should reduce Envoy memory requirements for installations with many `Host`s
* Change: The edgectl CLI tool has been deprecated, please use the `emissary-ingress` helm chart instead.

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_24bed6ec_20250114_185308.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femissary-ingress%2Femissary%2Fissues%2F3340)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Femissary-ingress%2Femissary%2Fissues%2F3340)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=emissary-ingress%2Femissary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[emissary-ingress](/emissary-ingress)
/
**[emissary](/emissary-ingress/emissary)**
Public

* [Notifications](/login?return_to=%2Femissary-ingress%2Femissary) You must be signed in to change notification settings
* [Fork
  687](/login?return_to=%2Femissary-ingress%2Femissary)
* [Star
   4.4k](/login?return_to=%2Femissary-ingress%2Femissary)

* [Code](/emissary-ingress/emissary)
* [Issues
  356](/emissary-ingress/emissary/issues)
* [Pull requests
  138](/emissary-ingress/emissary/pulls)
* [Actions](/emissary-ingress/emissary/actions)
* [Projects
  1](/emissary-ingress/emissary/projects)
* [Wiki](/emissary-ingress/emissary/wiki)
* [Security](/emissary-ingress/emissary/security)
* [Insights](/emissary-ingress/emissary/pulse)

Additional navigation options

* [Code](/emissary-ingress/emissary)
* [Issues](/emissary-ingress/emissary/issues)
* [Pull requests](/emissary-ingress/emissary/pulls)
* [Actions](/emissary-ingress/emissary/actions)
* [Projects](/emissary-ingress/emissary/projects)
* [Wiki](/emissary-ingress/emissary/wiki)
* [Security](/emissary-ingress/emissary/security)
* [Insights](/emissary-ingress/emissary/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Femissary-ingress%2Femissary%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Femissary-ingress%2Femissary%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Bypass mTLS by mixing SNI and Host headers #3340

Closed

[ropnop](/ropnop) opened this issue
Apr 13, 2021
· 6 comments

Closed

# [Bypass mTLS by mixing SNI and Host headers](#top) #3340

[ropnop](/ropnop) opened this issue
Apr 13, 2021
· 6 comments

Assignees
[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=40&v=4)](/kflynn)

Labels
[t:risk](/emissary-ingress/emissary/labels/t%3Arisk)
Security vulnerability or other threat

Milestone
[2021 Cycle 5](/emissary-ingress/emissary/milestone/51 "2021 Cycle 5")

## Comments

[![@ropnop](https://avatars.githubusercontent.com/u/2555506?s=80&u=b96145e0c4cd942cb2ad5965d901a4ca27edb141&v=4)](/ropnop)

Copy link

### **[ropnop](/ropnop)** commented [Apr 13, 2021](#issue-857337366)

| **Describe the bug** If Ambassador is deployed with multiple hosts/tlscontexts with some using mTLS (`cert_required: true`) and some not, it is possible to bypass the mTLS requirements for the backends that have it configured by sending an SNI for a TLSContext that does not.  I believe this stems from the fact that Ambassador matches TLSContexts based on SNI, but Mappings based on Host header. If `service1.upstream` does not require mTLS but `service2.upstream` does, it looks like its possible to talk directly to `service1.upstream` without a valid client certificate by doing something like:  ``` curl -H "Host: service2.upstream" https://service1.upstream  ```  In some configurations it is also possible to do the same by just talking directly to the Ambassador LoadBalancer IP address (not sending SNI at all). This works if the "default" TLSContext does not require mTLS (I'm not exactly clear what TLSContext Ambassador will fall back on if no SNI is given)  **To Reproduce** I've put together a working minimal example with 2 services and the YAML configurations:  <https://gist.github.com/ropnop/f306a8b46957dbf3a5199899b72be0b5>  ``` $ /usr/bin/curl --cacert certs/ServerTestCA.crt https://echo.test curl: (35) error:1401E410:SSL routines:CONNECT_CR_FINISHED:sslv3 alert handshake failure  $ /usr/bin/curl --cacert certs/ServerTestCA.crt -H "Host: echo.test" https://quote.test CLIENT VALUES: client_address=('10.1.0.8', 49418) (10.1.0.8) command=GET path=/ real path=/ query= request_version=HTTP/1.1  SERVER VALUES: server_version=BaseHTTP/0.6 sys_version=Python/3.5.0 protocol_version=HTTP/1.0  HEADERS RECEIVED: accept=*/* content-length=0 host=echo.test user-agent=curl/7.64.1 x-envoy-expected-rq-timeout-ms=3000 x-envoy-internal=true x-envoy-original-path=/ x-forwarded-for=192.168.65.3 x-forwarded-proto=https x-request-id=846c224a-c63f-444b-b68d-68aee96122ae  ```  **Expected behavior** Ambassador should not apply a Host mapping if the SNI does not match. If this is expected behavior and you can't securely mix mTLS and non-mTLS upstreams this should definitely be called out in the docs for those who need to rely on mTLS authentication.  **Versions (please complete the following information):**   * Ambassador: 1.7.2 * Kubernetes environment: EKS and DockerDesktop * Version: 1.16 and 1.19   **Additional context** It is possible my configuration is bad/wrong, so if I have missed something in the docs please let me know |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@ropnop](https://avatars.githubusercontent.com/u/2555506?s=80&u=b96145e0c4cd942cb2ad5965d901a4ca27edb141&v=4)](/ropnop)

Copy link

Author

### **[ropnop](/ropnop)** commented [Apr 30, 2021](#issuecomment-830117022)

| FWIW i've recreated this behavior on the latest version of the Helm chart, running AES 1.13.2 as well |
| --- |

All reactions

Sorry, something went wrong.

[![@ropnop](https://avatars.githubusercontent.com/u/2555506?s=80&u=b96145e0c4cd942cb2ad5965d901a4ca27edb141&v=4)](/ropnop)

Copy link

Author

### **[ropnop](/ropnop)** commented [Apr 30, 2021](#issuecomment-830135559)

| Looking at the generated Envoy config, i'm guessing the cause is the first entry in the filter\_chain, which matches any TLS traffic:  ``` $ cat envoy.json| jq '.static_resources.listeners[0].filter_chains[0].filter_chain_match' {   "transport_protocol": "tls" }  ```  It looks like Ambassador applies every mapping to this "catch-all" TLS filter (`filter_chains[0]`). It adds a route to my mTLS backend to the default vhost (`"domains: ["*"]`) based on host header:  ``` $ cat envoy.json| jq '.static_resources.listeners[0].filter_chains[0].filters[0].typed_config.route_config.virtual_hosts[0].routes[23].match' {   "case_sensitive": true,   "headers": [     {       "exact_match": "echo.test",       "name": ":authority"     },     {       "exact_match": "https",       "name": "x-forwarded-proto"     }   ],   "prefix": "/",   "runtime_fraction": {     "default_value": {       "denominator": "HUNDRED",       "numerator": 100     },     "runtime_key": "routing.traffic_shift.cluster_echoserver_echoserver_echoserver"   } }  ```  Later in the chain, there is a correct filter for my mTLS backend which accurately matches based on server name:  ``` $ cat envoy.json|jq '.static_resources.listeners[0].filter_chains[2].filter_chain_match' {   "server_names": [     "echo.test"   ],   "transport_protocol": "tls" }  ```  I think this explains the behavior I'm seeing but why does Ambassador do this? It appears to add every route to the default wildcard vhost and filter, which means you can bypass any client TLS requirement by either specifying a bogus SNI (or not including one) and manually supplying a Host header since the upstream route will still be there and match the vhost routes? |
| --- |

All reactions

Sorry, something went wrong.

[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=80&v=4)](/kflynn)

Copy link

Member

### **[kflynn](/kflynn)** commented [Jun 12, 2021](#issuecomment-859981463)

| Thanks for the report on mTLS, and thanks as well for the excellent reproducer!  I have confirmed your research: it is indeed possible to bypass mTLS with your configuration, in 1.7 and subsequent 1.X releases. The catchall behavior you describe is definitely part of it -- I won't bore you to death with the whole story, but the short version is that we sometimes have to infer things in 1.X that require the catchall. Your situation appears to be one where we take that too far.  Although there's no real workaround in 1.X, there are some mitigations. A malicious client doesn't actually get to bypass all of TLS: what they really get to do is switch from the TLS configuration dictated by SNI to the TLS configuration dictated by the `Host` header. That means that you can mitigate this by making sure that none of your `Host`s completely disable mTLS. Likewise, the rest of the authentication system is intact, so enabling external auth can also be a helpful mitigation.  Obviously, though, confusing mTLS in this way shouldn't be possible at all. We're investigating a fix for the 1.X family, and we have confirmed that our upcoming 2.0.0 release is not vulnerable to this issue at all. We'll be sure to keep you in the loop as we have more news. Thanks again for the report! |
| --- |

All reactions

Sorry, something went wrong.

[![@khussey](https://avatars.githubusercontent.com/u/208645?s=40&v=4)](/khussey)
[khussey](/khussey)
assigned [kflynn](/kflynn)
[Jun 15, 2021](#event-4894196835)

[![@khussey](https://avatars.githubusercontent.com/u/208645?s=40&v=4)](/khussey)
[khussey](/khussey)
added this to the [2021 Cycle 4 Cool-down](/emissary-ingress/emissary/milestone/50) milestone
[Jun 15, 2021](#event-4894197245)

[![@khussey](https://avatars.githubusercontent.com/u/208645?s=40&v=4)](/khussey)
[khussey](/khussey)
added
the
[t:risk](/emissary-ingress/emissary/labels/t%3Arisk)
Security vulnerability or other threat
label
[Jun 16, 2021](#event-4898900619)

[![@ropnop](https://avatars.githubusercontent.com/u/2555506?s=80&u=b96145e0c4cd942cb2ad5965d901a4ca27edb141&v=4)](/ropnop)

Copy link

Author

### **[ropnop](/ropnop)** commented [Jun 21, 2021](#issuecomment-865175220)

| Hi [@kflynn](https://github.com/kflynn)  Thank you for the response. I have one clarifying technical question about the proposed mitigation: even if we ensure that none of our Hosts behind Ambassador disable mTLS, it would still be possible to confuse the client ca\_secret for each Host’s TLSContext right? So if Service A and Service B are both using mTLS but with different CAs, a client cert for Service A could be used to establish the connection to Ambassador via sending Service A’s SNI but then talk to Service B via Host header mappings? |
| --- |

All reactions

Sorry, something went wrong.

[![@efunk](https://avatars.githubusercontent.com/u/85175355?s=40&v=4)](/efunk)
[efunk](/efunk)
modified the milestones:
[2021 Cycle 4 Cool-down](/emissary-ingress/emissary/milestone/50),
[2021 Cycle 5](/emissary-ingress/emissary/milestone/51)
[Jun 29, 2021](#event-4956166409)

[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=80&v=4)](/kflynn)

Copy link

Member

### **[kflynn](/kflynn)** commented [Jul 7, 2021](#issuecomment-875907576)

| [@ropnop](https://github.com/ropnop) So first up, the developer preview of 2.0.0 did indeed ship, and it does fix this issue. Investigating a fix for 1.13 mostly turned up roadblocks, so we're not planning to backport to 1.13 at this point – the way it's addressed in 2.0 is really much better than how 1.13 handles things.  In 1.13, I think that you can confuse things as you describe only if you don't explicitly define a wildcard `Host` (where the `hostname` is `*`). 1.13 really wants there to always be a wildcard host, to the extent that if you don't define one, it will promote a `Host` to be the wildcard `Host` for you. If you explicitly define one, though, you can make its TLS config very restrictive, and set `prune_unreachable_hosts: true` in the `ambassador` module. Then:   * If SNI matches one of your `Host`s, that's the one whose TLS config will be used; * If not, the wildcard `Host`'s TLS config will be used; * `prune_unreachable_hosts: true` in the `ambassador` module should prevent non-wildcard `Host` from including routes for any other `Host`; and * the restrictive TLS setup for the wildcard `Host` should prevent skipping in through a permissive setting and using `:authority` to ask for a more-restrictive `Host`. |
| --- |

All reactions

Sorry, something went wrong.

[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=80&v=4)](/kflynn)

Copy link

Member

### **[kflynn](/kflynn)** commented [Jul 7, 2021](#issuecomment-875907918)

| I'm going to go ahead and close this, but feel free to reopen if needed! |
| --- |

All reactions

Sorry, something went wrong.

[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=40&v=4)](/kflynn)
[kflynn](/kflynn)
closed this as [completed](/emissary-ingress/emissary/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jul 7, 2021](#event-4991289242)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Femissary-ingress%2Femissary%2Fissues%2F3340)

Assignees

[![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=40&v=4)](/kflynn) [kflynn](/kflynn)

Labels

[t:risk](/emissary-ingress/emissary/labels/t%3Arisk)
Security vulnerability or other threat

Projects

None yet

Milestone

 [**2021 Cycle 5**](/emissary-ingress/emissary/milestone/51 "2021 Cycle 5")

Development

No branches or pull requests

4 participants

[![@khussey](https://avatars.githubusercontent.com/u/208645?s=52&v=4)](/khussey) [![@kflynn](https://avatars.githubusercontent.com/u/1126180?s=52&v=4)](/kflynn) [![@ropnop](https://avatars.githubusercontent.com/u/2555506?s=52&v=4)](/ropnop) [![@efunk](https://avatars.githubusercontent.com/u/85175355?s=52&v=4)](/efunk)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


