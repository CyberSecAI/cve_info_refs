=== Content from www.rapid7.com_80760dcc_20250115_082809.html ===


[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)
* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg) Sign In](https://insight.rapid7.com/saml/SSO)
[Blog](/blog/ "Blog")

* Select
  + [Vulnerability Management](/blog/tag/vulnerability-management/)
  + [MDR](/blog/tag/mdr-managed-detection-response/)
  + [Detection & Response](/blog/tag/detection-and-response/)
  + [Cloud Security](/blog/tag/cloud-security/)
  + [App Security](/blog/tag/application-security/)
  + [Metasploit](/blog/tag/metasploit/)
  + [All Topics](/blog/tags/)

[Start Trial](/trial/insight/)[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)

* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg)Sign In](https://insight.rapid7.com/saml/SSO)
[![Rapid7 logo](/Areas/Docs/includes/img/r7-nav/Rapid7_logo-short.svg)](https://www.rapid7.com/)

* [Blog](/blog/ "Blog")
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [MDR](/blog/tag/mdr-managed-detection-response/)
* [Detection & Response](/blog/tag/detection-and-response/)
* [Cloud Security](/blog/tag/cloud-security/)
* [App Security](/blog/tag/application-security/)
* [Metasploit](/blog/tag/metasploit/)
* [All Topics](/blog/tags/)
[Start Trial](/trial/insight/)

# Multiple Open Source Web App Vulnerabilities Fixed

* Jul 27, 2021
* 13 min read
* [Tod Beardsley](/blog/author/tod-beardsley/)

*Last updated at Wed, 27 Dec 2023 15:04:09 GMT*

Today, Rapid7 is disclosing 9 vulnerabilities that affect three open-source projects: [EspoCRM](https://github.com/espocrm/espocrm), [Pimcore](https://github.com/pimcore/pimcore), and [Akaunting](https://github.com/akaunting/akaunting/). Right out of the gate, I'd like to give a special thanks to these 3 open-source project maintainers. While it's never great to learn of new vulnerabilities in your own product, all 3 project maintainers accepted, validated, and provided fixes for these vulnerabilities within **one day**, which is amazing when it comes to vulnerability disclosure. EspoCRM was notified on May 4, 2021 and patched source on May 5; Akaunting, on May 13 and turned it around on May 14; and Pimcore validated their vulnerabilities on April 29 after learning about them on April 28, 2021. Nice work, all around.

Now, I'm not sure why open source is just so much faster than the typical proprietary software vuln-patching pipeline, at least for the disclosures I've been involved in. It might be because, in open source, you're almost guaranteed to have your first communication with a hands-on-keyboard software engineer who is personally and emotionally invested in the software; whereas in proprietary land, first contact might be a lightly monitored support alias, staffed by a third-party provider. [Rapid7's vulnerability disclosure process](https://www.rapid7.com/security/disclosure/) assumes a minimum of 60 days for remediation of any vulnerability we report to a vendor, and I'd say about half the time, we're looking at more like 90 to 120 days from report to disclosure — and, sometimes, we are left with the unhappy option of publishing without a fix in hand at all.

Of course, proprietary software occasionally offers fast turnaround times on validation and fixes to source, as well ([SonicWall](https://www.rapid7.com/blog/post/2021/06/23/cve-2021-20025-sonicwall-email-security-appliance-backdoor-credential/) comes to mind), and proprietary vendors often have very good reason to take their time with acknowledging, fixing, testing, and releasing fixes; but the fact remains that what's normal in open source communities — hyperfast turnaround on fixing reported vulnerabilities — is a rarity in proprietary software.

By the way, these aren't one- or two-person passion projects. All 3 of these projects have real users, real customers of their attendant support services and cloud-hosted versions, and are undoubtedly the core applications supporting thousands of small to medium businesses running today. This popularity is the reason why Trevor and Wiktor took a look at them in the first place; they suspected these small-to-medium business applications haven't seen a ton of attention from the eye of a penetration tester, and this blog post is a result of testing that hypothesis.

With that, I'll stop picking on proprietary software vendors in general and switch gears to take a look at the specific vulnerabilities in these specific projects.

## Common Vulnerability Classes

From this completely unscientific and statistically insignificant sampling of vulnerabilities, we can draw the deeply unsurprising conclusion that enterprise web applications tend to suffer from common web-application vulnerabilities. 3 are examples of persistent cross-site scripting (XSS), where a malicious user can plant a bit of browser-executable code in the application, which is designed to lie in wait and trigger when someone else comes along and loads that code, and 2 are SQL injection (SQLi) vulnerabilities, where the attacker uses the web application as a convoluted portal to issue direct commands to the backing database, usually to steal data or create powerful web-app users.

SQL injection used to be a nice way to get a command injection path to the underlying operating system, but that's something of a rarity these days. But, 1 issue disclosed here is a command injection issue, which we rate as the highest critical vulnerability of the bunch, since it can allow the attacker to commandeer the operating system and do things like use it as a beachhead into the rest of the network, install a cryptominer or ransomware, or perform other nefarious lower-level actions.

The remaining vulnerabilities are: a denial-of-service vulnerability, where the attacker can crash the whole application with a naughty HTTP request; an authentication bypass, where the attacker can move from one logical group to another without authorization; and a weak password-reset vulnerability, where the attacker can abuse the "I forgot my password" function to source a phishing email from the application to a registered user.

The table below provides the salient information about the 9 vulnerabilities being disclosed today. Note that every vulnerability listed here was promptly fixed by the vendor in the typical open-source manner. In short: if you use any of these applications in your business and keep up on your updates, you already have the fixes. The rest of this post details the individual findings by [Wiktor Sędkowski](https://www.linkedin.com/in/wiktorsedkowski/) of Nokia and Trevor Christiansen of Rapid7, who worked together on this project and disclosed these issues through Rapid7's vulnerability disclosure process.

We're publishing these details today so other, similar web applications can be made aware of these vulnerability classes and take a look at their own codebases to make sure they're not making the same mistakes. Thanks, Wiktor and Trevor!

| CVE | Affected Project | CWE | Base CVSS | Status |
| --- | --- | --- | --- | --- |
| CVE-2021-3539 | EspoCRM v6.1.6 | CWE-79 (Persistent XSS) | 6.3 (Medium) | Fixed in version 6.1.7 |
| CVE-2021-31867 | Pimcore Customer Data Framework v3.0.0 | CWE-89 (SQL Injection) | 6.5 (Medium) | Fixed in v3.0.2 |
| CVE-2021-31869 | Pimcore AdminBundle v6.8.0 | CWE-89 (SQL Injection) | 6.5 (Medium) | Fixed in v6.9.4 |
| CVE-2021-36800 | Akaunting v2.1.12 | CWE-94 (Code injection) | 8.7 (High) | Fixed in Akaunting v2.1.13 |
| CVE-2021-36801 | Akaunting v2.1.12 | CWE-639 (Auth bypass) | 8.5 (High) | Fixed in Akaunting v2.1.13 |
| CVE-2021-36802 | Akaunting v2.1.12 | CWE-248 (Uncaught Exception DoS) | 6.5 (Medium) | Fixed in Akaunting v2.1.13 |
| CVE-2021-36803 | Akaunting v2.1.12 | CWE-79 (Persistent XSS) | 6.3 (Medium) | Fixed in Akaunting v2.1.13 |
| CVE-2021-36804 | Akaunting v2.1.12 | CWE-640 (Weak Password Reset) | 5.4 (Medium) | Fixed in Akaunting v2.1.13 |
| CVE-2021-36805 | Akaunting v2.1.12 | CWE-79 (Persistent XSS) | 5.2 (Medium) | Fixed in Akaunting v2.1.13 |

# EspoCRM v6.1.6 (1 issue)

EspoCRM is an open-source customer relationship management (CRM) application used in all sorts of industries, although it seems to enjoy special success in the real estate sector. More about EspoCRM can be found at the [vendor's website](https://www.espocrm.com/).

## CVE-2021-3539: EspoCRM Avatar Persistent XSS

Any user with default rights, which allows them to upload their own avatar, can abuse the API for this by providing executable Javascript code instead of an image. An example call to the API is detailed below:

```
PUT /api/v1/User/609108e6b123bb29d HTTP/1.1
Host: 10.0.0.10:8443
{redacted}
Content-Length: 43
Origin: https://10.0.0.10:8443
Connection: close
Referer: https://10.0.0.10:8443/
Cookie: {redacted}

{
"avatarId":"\" onerror=\"alert(0)\" "
}

```

This leads to rendering the avatar as:

![](https://lh4.googleusercontent.com/qtWSE1n5hDAxtoaYcVSG4DVJglzZXi5dzeLJdaLxjPcqH4n7MdpDppGyMsoIN0fLN3LxFUYaLB9FLiNbyxV6E37iA-aBo0ERhk9XgGD66YbKZFSi94DQluMDeIYx23yW1Q2j_mcr)

resulting in triggering the `onerror` event:

![](https://lh3.googleusercontent.com/Br_QcO102fIqXJOegCiQBlvpiNb8y2VrTBIupsk6-cupgpFBsqiSPRbAe0tVrxK9CPblwTYx4fIRWXPnOR1i8Aq57SUnxHfB52r4BlD9DbDUqcET2aLmselRzR6IojJYtopoYXac)

Because EspoCRM allows administrators to install arbitrary, custom extensions, an attacker can leverage this XSS to silently coerce an administrator (who views the attacker's avatar) to install a malicious extension, thus retaining permanent control of the web application, as seen in the screenshot below.

![](https://lh5.googleusercontent.com/wo_N00znwKdVFlzKGtrpQm5FeUD4c0KacOtoXVeDs0nn4KTf48tYoOQpgEb4xAFvos1KXtuqnMzigpldRwlAQHmWFbU0EQ_gswuqox4B1CZDxS-voTVoBeI2zuaOyfbNKKFkC4pX)
# Pimcore Customer Data Framework v3.0.0 (1 issue)

Pimcore CDF is a component of the Pimcore platform and is a CRM enterprise application. More about Pimcore CDF can be found at the [vendor's website](https://pimcore.com/en/customer-data-platform).

## CVE-2021-31867: Pimcore CDF 'SegmentAssignmentController.php' Blind SQL Injection

An SQL injection vulnerability exists in the Customer Management Framework Bundle, specifically in the SegmentAssignmentController.php component. The vulnerable code was introduced in commit 6fc8aff8f95fc168d173ef3b473760dd98d026c4 and is shown below.

```
php
public function inheritableSegments(Request $request)
{
$id = $request->get('id') ?? '';
$type = $request->get('type') ?? '';
/* @var $db Connection */
$db = $this->get(Connection::class);
$parentIdStatement = sprintf('SELECT `%s` FROM `%s` WHERE `%s` = "%s"', $type === 'object' ? 'o_parentId' : 'parentId', $type.'s', $type === 'object' ? 'o_id' : 'id', $id);
$parentId = $db->fetchOne($parentIdStatement);
$segments = $this->get(SegmentManagerInterface::class)->getSegmentsForElementId($parentId, $type);
$data = array_map([$this, 'dehydrateSegment'], array_filter($segments));
return $this->adminJson(['data' => array_values($data)]);
}

```

`$id` is retrieved from the request parameters and then placed directly into the SQL query through the use of `sprintf` and then executed (as long as `$type` is something other than `object`). This allows a malicious actor to inject the SQL query through the use of a single quote `’`.

This vulnerability can be thought of as a Boolean-based Blind SQL Injection, as an exploit is unable to pull out data from the database directly, but has to piece together the information through a series of True/False requests.

This image below shows a request that tests if the integer 1 equals 1:

![](https://lh6.googleusercontent.com/OCrQFVZNaH9N4CcQhd8xAEOiKaXHvo-gYWW2UO8DT6TeAbHlcMOA3XBT8AnntBU6v_BVSUDf4nIMypECUN6y6fACfYQpU4eRXXRs6CDTbmcvt45sfBcUvMuK0aTs7RJD-lAPafwi)

The response returns a `200 OK` along with the data that has an `id` of 137:

![](https://lh4.googleusercontent.com/yf-8MTL7XZ7fFlbNeqoZLk0SmXI_fnF_0a6WtHbGlnRhbznPtBjVZoJxbMVWeCTukTBIvDGQUfGSX3e_ge7vWMrdNoZPxpTD1JnE4XSGSTPy9cTAaFl-sj5Ks9VS65djBbzzjRg8)

This second request tests if the integer 1 is equal to 2:

![](https://lh4.googleusercontent.com/ZUMbm8TN6iLid-We5CsxPxY0CW8xdhDWp794WceFuknT1_8l5KiM6_oDuOGWgiPYwrOc-HfXzv_MbdB9L17yprSgeS0J_EY-LQ1I8d2ij5NM95EnoF4ZpetdA5jgHHNsHFPJNIdl)

This time, the response is a `500 Internal Server Error` along with a stack trace.

![](https://lh3.googleusercontent.com/Xj_MkzAPfSwpae4bskqy5-Mf2y4StjQlcTnr5nmDnPGKL1LUoEv1I_m1QQwZy0g4tRzCnJd89KxPxErUI2dGLWQpBkAblO0dDnVDH1cG0rlx7Zn7YJ2NSCI6hkvCp4ABOoB-NqaL)

Using these 2 queries, a malicious actor can automate the retrieval of information from the database. This last example shows a query to find the first character of the version from the database server.

![](https://lh5.googleusercontent.com/7z3q_gd1iXApNFCkqFZYU9rAB89Hg6wdO0Yq4M23VkJ0VRL3enPdPh_KYtoVP_ojGGWBG1SOP7Zv018w7jygs0RcPVj-JoXLc2ToYrwqiRGTjAF9njNgPyMe20oib7qo-kWPQKsI)
# Pimcore AdminBundle v6.8.0 (1 issue)

Pimcore AdminBundle is part of the core Pimcore platform, a Product Information Management (PIM) platform, which is closely related to the Enterprise Resource Planning (ERP) functions of a business. More about the Pimcore platform can be found at the [vendor's website](https://pimcore.com/en/platform).

## CVE-2021-31869: Pimcore AdminBundle 'specificID' SQL Injection

Requests sent to `/admin/object/grid-proxy` are handled by `Bundles/AdminBundle/Controller/Admin/DataObject/DataObjectController.php` file, starting on line 1568, as shown below:

![](https://lh6.googleusercontent.com/FI7pBVZ6Cm0oMbQr2BcEIhl5eDkJwstZOkHxQh1XWGOGbONbJvdeyqOgo5UVvFAiLMp5xu1P-YkTfv9W5bzA85Y2Metvhols9euMEqijW-V6in6-ckAjXT6c7rmMm3i9OqFMv9v8)

This file collects all the parameters (line 1586), then includes the parameters in a call to `prepareListingForGrid` shown below:

![](https://lh6.googleusercontent.com/BUIVz3yPjIfj5uBd17dLiYmPjG2so-M730lroVXojMkCi0rRDnMFUTAV0WLBz5pj14uLDDOsXjdIdJboqT_TpyDxAFeX6dtARk0lUUGIpDJkikw6Y_yQ0C4w9_cGid7k3Hk4Y0gQ)

`prepareListingForGrid` is found in the previously mentioned `Pimcore/Bundles/AdminBundle/Helper/GridHelperService.php` file and starts on line 489. This function builds the SQL query from the provided parameters. The parameter `specificID` is vulnerable to SQL injection, since the `specificId` parameter data is concatenated directly into the string and then added to the `$conditionFilters` array, as shown below:

![](https://lh4.googleusercontent.com/a9Wfw7bKp-hi2h3SecSqbdsIMsKV9X2TC3AFfBS9Cla8jaJrFwT1lESxrMds0-Rn1ZXHrFDtk0p6RJbvtrEfwwU4ItzuIwZr3tZYFVKcs2QydJg6nTcOO5YKozX6tz67rrmvRW7A)

A request to the `grid-proxy` url is shown below. In this query, the `specificId` field is set to `1+or+’a’=’a’`. The response shows a content-length of 7546.

GET /admin/object/grid-proxy/classId=BS&[other params]&specificId=1+or+'a'='a'&query=[other params] HTTP/1.1

![](https://lh3.googleusercontent.com/EyJwjx9j5DkKlvaVk3i1n0ag9Zg8DaanUg-qSz-9Zi2kR_Ai8voMSUQEl3meJIqPJGQ6T64EGfByq0WuzGUtkOKC3GMjht4Y8xhUK7tgdR1r3bAWC9_V8p9rQ2-jFVCN1zqK7jHy)

This next request sets the `specificId` parameter to `1+or’a’=’b’`. As shown in the following image, the response length is now 47, and no records were returned.

![](https://lh5.googleusercontent.com/-Wk66v8vjqZJEBtLQTJuMdiQU1oNBUtnybrm2Znq_2HAnJBuJKvksYYcCc6f0t4y5yEfo6qutXZsWUeJVgt57-ff7xCpo28tLTVQTIw9iHg_xAlfwhUxNSCJpDCfZqbPpSuzhvpU)

By combining these 2 requests, a malicious actor can programmatically return data from the database by testing each character and monitoring the response. The image below shows an example of this by requesting the database version and checking if the first character of the version is equal to 8.

![](https://lh5.googleusercontent.com/xksl3AvnkztjxufC46UnVZgSv7FhJmAy2GW-wW5_UvY7RDTfupy2gf4Lip-IjG4Y7bgoSDHuHOOB1Xr2K2kHp-JJ5NKPmSUh_Vw5QGew_1Dx6njJLi1nq5VWP6AXu3Ui13G1iuwV)
# Akaunting v2.1.12 (6 issues)

Akaunting is an enterprise accounting system, providing a variety of services related to the normal day-to-day business operations, notably in the retail sector, such as invoicing and expense tracking. More about Akaunting can be found at the [vendor's website](https://akaunting.com/).

## CVE-2021-36800: Akaunting OS Command Injection

The Akaunting application allows for PHP code sent to the application to be executed by the web server. This can lead to a shell directly on the host operating system. The vulnerability was introduced upon the creation of the `Money.php` file in the first commit, 1c01d2120941d99f758cf23be20fe5931bdd4a36. To exploit this vulnerability, the attacker must first be authenticated and already have permissions to add or modify sales invoices.

A POST sent to `/{company\_id}/sales/invoices/{invoice\_id}` with an `items[0][price]` that includes a PHP callable function is executed directly. The image below shows the post body, including a `items[0][price]` set to `phpinfo`. The response on the right shows the response, which includes the results from the application executing `phpinfo()`:

![](https://lh6.googleusercontent.com/erc_ipp3dTXiWCcwG4YcW_8C8ny_S5ASEEfkea2uZ9XjdQg3_hey6uLvlm_PQD3u2eElYDSwPXmIq_zz-CXlmatcWAZCa7DIKQEz2FKG7VpLSVw81IySCCSSjXmwaZ_SPeDfkCO_)

This is due to a lack of input sanitization in the Money.php middleware component. The following is the code responsible for the execution; as shown, it checks to see if what is received is callable and, if so, executes it.

```
protected function parseAmountFromCallable($amount)
{
if (!is_callable($amount)) {
return $amount;
}
return $amount();
}

```
## CVE-2021-36801: Akaunting Authentication Bypass in Company Selection

A user is able to change the company their account is associated with, allowing them to view/modify information from another company. This vulnerability was introduced in the first commit of the application. To exploit this vulnerability, the attacker must first be authenticated as any user.

The first image shows that the user `Test\_company\_1` is associated with the company named `My Company`:

![](https://lh6.googleusercontent.com/QrQfBgLUFxZBOHqM6yINMTJLyVfB02ix3GCKCbDIn6Wko6vXh-Ftvd0xc5iMKVRLa2W8O9q6Y2UmEq_7GDL6__uUHCZ_KE0fUy887tHg-0CREzvHtZs7VZARD_We0EfmHW1sbpE3)

While logged in as the user `Test\_company\_1` we click on `Profile` to change the user settings:

![](https://lh6.googleusercontent.com/tQ-lqyUwlhog8zFhJ_v0rRcEJEFZMkrCSG2UMeO0S-FkXjE3_TYH7T4iBkLLlXhbzIcrjKRZYxr0j9k0HlgJNDraPGShJ_EJvSaAbYnE4G_gx-aVhyA9_x9nqpcMdOHJiALDoYcp)

By clicking on the `Save` button and intercepting the request, we can modify the `companies[0]` field to the `id` of another company. The image below shows changing the company information from 1 to 2 while updating the profile information:

![](https://lh6.googleusercontent.com/7XxKxGynZxdFFlaX8vN4lbnKvPkWpNkHpM3ryWO_0QMkHvw1ggTEgVfgxekVbYIwTqigDHcLuwb8BOt7RxJrhbnnFybxIWAr2WJkvT0gwBnmR8cE5j5xNw6sQ-u93qhv9B0ZVHho)

Once done, viewing the dashboard shows that the associated company has been changed:

![](https://lh6.googleusercontent.com/QDD9Bnlg_wXcQeUQL30B9r9dPVh7PUDQNAWvuJu08WRMMYow1Qaa0MOGu_QULgZ3Rw3vMI5P4C2T4CkUE3y7Bm8KLMW0MzbEWumB_REEf8DxfVXWu3_BPXhmmSCTOxam6pKEILId)

## CVE-2021-36802: Akaunting DoS via User-Controlled 'locale' Variable

Any user can crash the Akaunting platform by supplying an invalid 'locale' variable as part of an otherwise well-formed HTTP POST request. This vulnerability was introduced in the first commit of the application. To exploit this vulnerability, the attacker must first be authenticated as any user.

The image below shows a post to `/2/settings/settings` with an invalid locale that is successfully processed without error:

![](https://lh3.googleusercontent.com/USyNdGYqfT8dMee1993ozzXHQ7V1EUcK_bbpCpXfmVHEPIiRadl2PsF4IpAINqamHZfqSLnj-fO-htOlebNOHe94RT-xzImsVA6zLXZAMAfqd_wUgFcn4LTmJKoRv2sgru2Gnl47)

Visiting any page will result in a 500 response:

![](https://lh4.googleusercontent.com/6EhHkxnsK6gBMQsD7IropQU8Nv3Qbc2a4nXS2EBQcsM1wGVyL57C3TXObqWpuxMVaQ9_d5GJNOX3DbyhMhxXLKUAfNucI11HfuV8nUx5TJ4B_9pgccpd9NYJHwRGE4ZPpvpaxFvU)
## CVE-2021-36803: Akaunting Avatar Persistent XSS

A user can inject HTML into the avatar upload process and trigger an XSS for anyone who views it, including high-privilege administrators of the application. This vulnerability was introduced in the first commit of the application. To exploit this vulnerability, the attacker must first be authenticated as any user.

The image below shows a post to `/{company\_id}/auth/users/{user\_id}` with HTML embedded in the image upload field:

![](https://lh6.googleusercontent.com/zilo7eBiWB-mId-tL_do-GedgGYbPqHrBvVmwNXTOSiVNWgiXusKA1zf8GTi3BEuT5n6yDfEV1w-ZnQ_N3seZa1jWfRWE66C5taxgLXpMnSKq4fOmcG92YrZuIt9Ukf1DqQBXmGT)

Example payload:
```

-----------------------------11088376342107705763341750165

Content-Disposition: form-data; name="picture"; filename="Screenshot\_2021-05-02\_05\_11\_16.png"

Content-Type: image/png

</pre><html><b>test</b><script>alert('xss')</script><pre>

```

The HTML is directly rendered on screen while accessing the avatar URL; e.g /{company\_id}/uploads/{upload\_id}:

![](https://lh5.googleusercontent.com/87ixGq_5DSvCsivAKVfNkM8s4DgttSAw7dNT7DBoYJKEFbVyrvwopvrb4gXZoAvQwsfCuG60ld3gSe515SI0bKrodgfC8mzn5XcB5jPTTOmmZ30mutkT01qquKYPPz_-6ZUdZViT)
## CVE-2021-36804: Akaunting Password Reset Relay

Setting the host header while sending a Post to `/auth/forgot` endpoint changes the link generated by the application. An attacker can send a password-reset request for an existing user and modify the host header to point to a web server they control. If the user clicks on the password reset URL, the attacker will receive the password-reset token and can then set the password to something the attacker knows. This vulnerability was introduced in the first commit of the application. To exploit this vulnerability, the attacker must first know or guess the email address of a valid user.

The image below shows a post to the /auth/forgot endpoint, with the Host set to example.com:

![](https://lh5.googleusercontent.com/s0sP6UNxDnNgpsP5hzYWrBMF997yZ_lu2QT7Wk4pUPEgaXZARnkT4ZrDGK-0MHKbm-8R1sNfEPVF2i55j0GnnOwTSV1YelElvnEtu_O0MMQcdPZ8thU_rTIZGsDcR9kPmrGpcBOp)

The email sent by the application directs the user to the example.com domain with the password reset token.

![](https://lh3.googleusercontent.com/ctsH9U1UEgP-8N6_lyig5RhzuWKyCLSwf8pK9FbtZNbIngnNE4YBzy3_PgjoSRwEC1FmwAV1yOKbVrXHVuEvB1O4B0lXkhxt_92c8cpqFHw83ReQAvJY-RgE7FzVXipZOd9Nb-2s)

Note that the root of this vulnerability is due to a design decision in the Laravel framework and how proxy headers are handled with respect to single instance and multi-tenant implementations. In other words, while CVE-2021-36804 is a (now fixed) vulnerability in Akaunting, other multi-tenant implementations involving Laravel should be aware that the default configuration of that framework is likely vulnerable to a similar issue. For more information on this design issue, please see Enlightn's [Host Injection Analyzer](https://www.laravel-enlightn.com/docs/security/host-injection-analyzer.html), Daniel Coulbourne's [tweet](https://twitter.com/DCoulbourne/status/1331317933675581442), and [PR 5477](https://github.com/laravel/laravel/pull/5477) in the Laravel GitHub repository.

## CVE-2021-36805: Akaunting Invoice Footer Persistent XSS

The Akaunting application allows for HTML to be written to the footer of a sales invoice and relies on its built-in “firewall” to prevent malicious code, such as XSS, from being accepted. The following example shows how specially crafted HTML code can bypass the filtering. This vulnerability was introduced in the first commit of the application. To exploit this vulnerability, the attacker must have the permissions to add or modify sales invoices.

A POST sent to `/{company\_id}/sales/invoices/{invoice\_id}` with a `footer` that includes the following HTML will execute the javascript:

Proof of concept payload:

```
POST /1/sales/invoices/201 HTTP/1.1
...
-----------------------------11766653461285783364827965738
Content-Disposition: form-data; name="footer"
'\"<img class="/>" onerror=alert("Vulnerable+to+XSS") src="b.png"
-----------------------------11766653461285783364827965738
…

```

The results of viewing the sales invoice:

![](https://lh5.googleusercontent.com/hxIIWKwYRBPPbrBZPGTt4DIZC8Rc4tBmQDIzgB_j_WB-MEEbSntFdp3VCmcuHqoEBG0_qjry1WYIiBqGcNQErd1eZLy1lRovuS7ObcIxRNve_cqiHGv9mRjIlDAyzgVXn3kzwn4i)

The payload bypasses the firewall restrictions because of the `>` placed in the class attribute. The image below shows how this string is not matched against the regex designed to prevent XSS:

![](https://lh4.googleusercontent.com/osRAdQXqMSqYVTYkUdCtVBShHaHmT_owJaSoxDpZ-NdENHzaYIWe7IHqK71ww_Lh8jqFCrDLSdmaEZLZmroLgApsrydTtHYYVA4h1D94YF1Ya6tLSJh2eXbs4tuAHE1Rh7VC_Wcj)
# Remediation

For all of these issues, updating to the latest versions of the affected applications will resolve them. If updating is difficult or impossible due to external factors or custom, local changes, users of these applications can limit their exposure by not presenting their production instances to the internet directly — instead, expose them only to trusted internal networks with trusted insiders.

Alternatively, since these applications are open source, users can contact these projects directly for any help needed to backport a fix to their own running version. One way to discover the exact code changes is simply to look at the git diffs between the fixed version and the most immediately prior version, and the fixes should be fairly obvious to anyone familiar with the languages in which these applications are written. In general, fixing bugs is fairly straightforward once you know what the vulnerabilities are. Finding and proving out the bugs is the hard part, so thanks again to Wiktor and Trevor for their work here.

#### POST TAGS

* [Vulnerability Disclosure](/blog/tag/vulnerability-disclosure/ "Vulnerability Disclosure")
* [Open Source](/blog/tag/open-source-news/ "Open Source")

#### SHARING IS CARING

#### AUTHOR

[Tod Beardsley](/blog/author/tod-beardsley/ "Tod Beardsley")

Director of Research at Rapid7, contributing author of several Rapid7 research papers, CVE Board member, and Metasploit collaborator. https://infosec.exchange/@todb

[View Tod's Posts](/blog/author/tod-beardsley/)

![](https://blog.rapid7.com/content/images/2021/07/Data-Vulnerability2.jpg)

## Topics

* [Metasploit
   *(663)*](/blog/tag/metasploit/)
* [Vulnerability Management
   *(367)*](/blog/tag/vulnerability-management/)
* [Research
   *(243)*](/blog/tag/research/)
* [Detection and Response
   *(207)*](/blog/tag/detection-and-response/)
* [Vulnerability Disclosure
   *(150)*](/blog/tag/vulnerability-disclosure/)
* [Emergent Threat Response
   *(145)*](/blog/tag/emergent-threat-response/)
* [Cloud Security
   *(137)*](/blog/tag/cloud-security/)
* [Security Operations
   *(21)*](/blog/tag/secops/)

## Popular Tags

* [Metasploit](/blog/tag/metasploit/)
* [Metasploit Weekly Wrapup](/blog/tag/metasploit-weekly-wrapup/)
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [Research](/blog/tag/research/)
* [Detection and Response](/blog/tag/detection-and-response/)
* [Logentries](/blog/tag/logentries/)

## Related Posts

Lorex 2K Indoor Wi-Fi Security Camera: Multiple Vulnerabilities (FIXED)

[Read More](/blog/post/2024/12/03/lorex-2k-indoor-wi-fi-security-camera-multiple-vulnerabilities-fixed/)

Multiple Vulnerabilities in Wowza Streaming Engine (Fixed)

[Read More](/blog/post/2024/11/20/multiple-vulnerabilities-in-wowza-streaming-engine-fixed/)

CVE-2024-45195: Apache OFBiz Unauthenticated Remote Code Execution (Fixed)

[Read More](/blog/post/2024/09/05/cve-2024-45195-apache-ofbiz-unauthenticated-remote-code-execution-fixed/)

CVE-2024-6922: Automation Anywhere Automation 360 Server-Side Request Forgery

[Read More](/blog/post/2024/07/26/cve-2024-6922-automation-anywhere-automation-360-server-side-request-forgery/)

## Related Posts

[IoT

Lorex 2K Indoor Wi-Fi Security Camera: Multiple Vulnerabilities (FIXED)

Read Full Post](/blog/post/2024/12/03/lorex-2k-indoor-wi-fi-security-camera-multiple-vulnerabilities-fixed/)

[Vulnerability Disclosure

Multiple Vulnerabilities in Wowza Streaming Engine (Fixed)

Read Full Post](/blog/post/2024/11/20/multiple-vulnerabilities-in-wowza-streaming-engine-fixed/)

[Vulnerability Disclosure

CVE-2024-45195: Apache OFBiz Unauthenticated Remote Code Execution (Fixed)

Read Full Post](/blog/post/2024/09/05/cve-2024-45195-apache-ofbiz-unauthenticated-remote-code-execution-fixed/)

[Vulnerability Disclosure

CVE-2024-6922: Automation Anywhere Automation 360 Server-Side Request Forgery

Read Full Post](/blog/post/2024/07/26/cve-2024-6922-automation-anywhere-automation-360-server-side-request-forgery/)

[View All Posts](/blog/posts/)

Search

[BACK TO TOP
![](/includes/img/up-arrow-lightgray.png?width=1200)](#__)

[![Rapid7 logo](/includes/img/Rapid7_logo.svg?width=1200&quality=90)](/)
CUSTOMER SUPPORT
+1-866-390-8113 (Toll Free)
SALES SUPPORT
+1-866-772-7437 (Toll Free)
Need to report an Escalation or a Breach?
[Get Help](/services/incident-response-customer-escalation/)

SOLUTIONS
[The Command Platform](/platform/)
[Exposure Command](/products/command/exposure-management/)
[Managed Threat Complete](/services/managed-detection-and-response-mdr/)

SUPPORT & RESOURCES
[Product Support](https://www.rapid7.com/for-customers/)
[Resource Library](https://www.rapid7.com/resources/)
[Our Customers](https://www.rapid7.com/customers/)
[Events & Webcasts](https://www.rapid7.com/about/events-webcasts/)
[Training & Certification](https://www.rapid7.com/services/training-certification/)
[Cybersecurity Fundamentals](https://www.rapid7.com/fundamentals/)
[Vulnerability & Exploit Database](https://www.rapid7.com/db/)

ABOUT US
[Company](https://www.rapid7.com/about/company/)
[Diversity, Equity, and Inclusion](https://www.rapid7.com/about/diversity-equity-and-inclusion/)
[Leadership](https://www.rapid7.com/about/leadership/)
[News & Press Releases](https://www.rapid7.com/about/news/)
[Public Policy](https://www.rapid7.com/about/public-policy/)
[Open Source](https://www.rapid7.com/open-source/)
[Investors](https://investors.rapid7.com/overview/default.aspx)

CONNECT WITH US
[Contact](https://www.rapid7.com/contact/)
[Blog](https://www.rapid7.com/blog/)
[Support Login](https://insight.rapid7.com/login)
[Careers](https://careers.rapid7.com/careers-home)

© Rapid7
[Legal Terms](/legal/)
  |   [Privacy Policy](/privacy-policy/)
  |   [Export Notice](/export-notice/)
  |   [Trust](/trust/)
  |   Do Not Sell or Share My Personal Information
  |   Cookie Preferences

Contact Us

## Submit your information and we will get in touch with you.

#### Thank you for contacting us.

##### We will be in touch shortly.

![Rapid7 logo](/includes/img/logo-black.png)

### General:

info@rapid7.com

### Sales:

+1-866-772-7437
sales@rapid7.com

### Support:

+1–866–390–8113 (toll free)
support@rapid7.com

### Incident Response:

1-844-727-4347

[More Contact Info](/contact/)

## Never miss a blog

Get the latest stories, expertise, and news about security today.

You’re almost done!
 Check your email to confirm your subscription.


