=== Content from gerrit.wikimedia.org_f8a9db92_20250114_182146.html ===




=== Content from gerrit.wikimedia.org_3e543e8f_20250114_182146.html ===




=== Content from phabricator.wikimedia.org_11517f2a_20250114_182148.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT281972)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T281972
# ActorStore::checkDatabaseDomain: InvalidArgumentException: DB connection domain does not match when suppressing via Special:CentralAuth (CVE-2021-36128)Closed, Resolved[Public](/policy/explain/PHID-TASK-szioatfpagm644lx2qzp/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/281972/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/281972/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-szioatfpagm644lx2qzp/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-szioatfpagm644lx2qzp/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-szioatfpagm644lx2qzp/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-szioatfpagm644lx2qzp/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-szioatfpagm644lx2qzp/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-szioatfpagm644lx2qzp/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-szioatfpagm644lx2qzp/)
* [Protect as security issue](/wmf/escalate-task/281972/)
* [Award Token](/token/give/PHID-TASK-szioatfpagm644lx2qzp/)
* [Flag For Later](/flag/edit/PHID-TASK-szioatfpagm644lx2qzp/)

Assigned To

|  | [• Pchelolo](/p/Pchelolo/) |
| --- | --- |

Authored By

|  | [hoo](/p/hoo/) |
| --- | --- |
| May 5 2021, 11:36 AM2021-05-05 11:36:27 (UTC+0) |

Tags

* [Wikimedia-production-error](/tag/wikimedia-production-error/) [(May 2021)](/project/board/1055/)
* [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/) [(Backlog)](/project/board/167/)
* [MediaWiki-User-management](/tag/mediawiki-user-management/) [(Backlog)](/project/board/198/)
* [Security](/tag/security/)
* [Platform Team Workboards (MW Expedition)](/project/view/5144/) [(UserStore pile)](/project/board/5144/)
* [MW-1.36-release](/tag/mw-1.36-release/) [(Not a blocker)](/project/board/4555/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [MW-1.36-notes](/tag/mw-1.36-notes/) [(Backlog)](/project/board/4479/)
* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Stewards-and-global-tools](/tag/stewards-and-global-tools/) [(Untriaged)](/project/board/1596/)
* [MW-1.38-notes (1.38.0-wmf.9; 2021-11-16)](/project/view/5605/)
* [MW-1.37-notes](/tag/mw-1.37-notes/)
* [Patch-For-Review](/tag/patch-for-review/)
* [Anti-Harassment (AHaT Sprint 10: The Mokorotlo)](/project/view/5985/) [(Code Review 🔍)](/project/board/5985/)
Referenced Files

|  | [F34454933: T281972.patch](/F34454933) |
| --- | --- |
| May 15 2021, 1:18 PM2021-05-15 13:18:17 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [alaa](/p/alaa/) |
| --- | --- |

|  | [AmandaNP](/p/AmandaNP/) |
| --- | --- |

|  | [brennen](/p/brennen/) |
| --- | --- |

|  | [Daimona](/p/Daimona/) |
| --- | --- |

|  | [daniel](/p/daniel/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

[View All 19 Subscribers](/subscriptions/list/PHID-TASK-szioatfpagm644lx2qzp/)
# Description

```
2021-05-05 04:47:56 [a01fcf53-0205-401e-b080-1baf777f439c] mw1272 metawiki 1.37.0-wmf.3 exception ERROR: [a01fcf53-0205-401e-b080-1baf777f439c] /w/index.php?title=Special:CentralAuth&target=…   InvalidArgumentException: DB connection domain 'jawiki' does not match 'metawiki' {"exception_url":"/w/index.php?title=Special:CentralAuth&target=…","caught_by":"entrypoint"}
[Exception InvalidArgumentException] (/srv/mediawiki/php-1.37.0-wmf.3/includes/user/ActorStore.php:672) DB connection domain 'jawiki' does not match 'metawiki'
  #0 /srv/mediawiki/php-1.37.0-wmf.3/includes/user/ActorStore.php(412): MediaWiki\User\ActorStore->checkDatabaseDomain(Wikimedia\Rdbms\DBConnRef)
  #1 /srv/mediawiki/php-1.37.0-wmf.3/includes/block/DatabaseBlockStore.php(357): MediaWiki\User\ActorStore->acquireActorId(MediaWiki\User\UserIdentityValue, Wikimedia\Rdbms\DBConnRef)
  #2 /srv/mediawiki/php-1.37.0-wmf.3/includes/block/DatabaseBlockStore.php(166): MediaWiki\Block\DatabaseBlockStore->getArrayForDatabaseBlock(MediaWiki\Block\DatabaseBlock, Wikimedia\Rdbms\DBConnRef)
  #3 /srv/mediawiki/php-1.37.0-wmf.3/includes/block/DatabaseBlock.php(523): MediaWiki\Block\DatabaseBlockStore->insertBlock(MediaWiki\Block\DatabaseBlock, Wikimedia\Rdbms\DBConnRef)
  #4 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/CentralAuthUser.php(1951): MediaWiki\Block\DatabaseBlock->insert(Wikimedia\Rdbms\DBConnRef)
  #5 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/CentralAuthUser.php(1882): CentralAuthUser->doLocalSuppression(boolean, string, string, string)
  #6 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/CentralAuthUser.php(1860): CentralAuthUser->doCrosswikiSuppression(boolean, string, string)
  #7 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/CentralAuthUser.php(1811): CentralAuthUser->suppress(string, string)
  #8 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/specials/SpecialCentralAuth.php(245): CentralAuthUser->adminLockHide(boolean, string, string, RequestContext)
  #9 /srv/mediawiki/php-1.37.0-wmf.3/extensions/CentralAuth/includes/specials/SpecialCentralAuth.php(143): SpecialCentralAuth->doSubmit()
  #10 /srv/mediawiki/php-1.37.0-wmf.3/includes/specialpage/SpecialPage.php(646): SpecialCentralAuth->execute(NULL)
  #11 /srv/mediawiki/php-1.37.0-wmf.3/includes/specialpage/SpecialPageFactory.php(1397): SpecialPage->run(NULL)
  #12 /srv/mediawiki/php-1.37.0-wmf.3/includes/MediaWiki.php(313): MediaWiki\SpecialPage\SpecialPageFactory->executePath(string, RequestContext)
  #13 /srv/mediawiki/php-1.37.0-wmf.3/includes/MediaWiki.php(916): MediaWiki->performRequest()
  #14 /srv/mediawiki/php-1.37.0-wmf.3/includes/MediaWiki.php(550): MediaWiki->main()
  #15 /srv/mediawiki/php-1.37.0-wmf.3/index.php(53): MediaWiki->run()
  #16 /srv/mediawiki/php-1.37.0-wmf.3/index.php(46): wfIndexMain()
  #17 /srv/mediawiki/w/index.php(3): require(string)
  #18 {main}
```
# Details

Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Reenable autoblocks for CentralAuth-issued suppression blocks](https://gerrit.wikimedia.org/r/c/725894) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/master) | +1 -4 |
|  | [Load potential current ip block from correct wiki](https://gerrit.wikimedia.org/r/c/828126) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +26 -1 |
|  | [block: Create wiki-aware target for autoblocks](https://gerrit.wikimedia.org/r/c/810381) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +2 -1 |
|  | [Respect the wiki when performing autoblocks](https://gerrit.wikimedia.org/r/c/763788) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +3 -2 |
|  | [Respect the wiki when performing autoblocks](https://gerrit.wikimedia.org/r/c/756131) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +12 -8 |
|  | [Follow-Up: I10fbd4b6a: Update @since tags as those were backported](https://gerrit.wikimedia.org/r/c/738549) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +2 -2 |
|  | [Follow-Up: I10fbd4b6a: Update @since tags as those were backported](https://gerrit.wikimedia.org/r/c/738401) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_36) | +2 -2 |
|  | [Follow-Up: I10fbd4b6a: Update @since tags as those were backported](https://gerrit.wikimedia.org/r/c/738400) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_37) | +2 -2 |
|  | [Follow-up bbc75d404: Update @since tag as we're back-porting](https://gerrit.wikimedia.org/r/c/689379) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +1 -1 |
|  | [SECURITY: Disable autoblocks for CentralAuth-issued suppression blocks](https://gerrit.wikimedia.org/r/c/702717) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/REL1_36) | +4 -1 |
|  | [SECURITY: Disable autoblocks for CentralAuth-issued suppression blocks](https://gerrit.wikimedia.org/r/c/702759) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/master) | +4 -1 |
|  | [Cross-wiki block should pass correct wiki blocker](https://gerrit.wikimedia.org/r/c/688289) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/REL1_36) | +3 -1 |
|  | [UserIdentityValue: Introduce convenience static factory methods](https://gerrit.wikimedia.org/r/c/688290) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_36) | +82 -1 |
|  | [DatabaseBlockStore: fetch correct ActorNormalization (part 2/2)](https://gerrit.wikimedia.org/r/c/688201) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [wmf/1.37.0-wmf.4](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/wmf/1.37.0-wmf.4) | +3 -10 |
|  | [DatabaseBlockStore: fetch correct ActorNormalization (part 1/2)](https://gerrit.wikimedia.org/r/c/688200) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [wmf/1.37.0-wmf.4](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/wmf/1.37.0-wmf.4) | +23 -10 |
|  | [DatabaseBlockStore: fetch correct ActorNormalization](https://gerrit.wikimedia.org/r/c/685585) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +16 -11 |
|  | [Cross-wiki block should pass correct wiki blocker](https://gerrit.wikimedia.org/r/c/685590) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [wmf/1.37.0-wmf.4](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/wmf/1.37.0-wmf.4) | +3 -1 |
|  | [Cross-wiki block should pass correct wiki blocker](https://gerrit.wikimedia.org/r/c/685589) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [wmf/1.37.0-wmf.3](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/wmf/1.37.0-wmf.3) | +3 -1 |
|  | [UserIdentityValue: Introduce convenience static factory methods](https://gerrit.wikimedia.org/r/c/685587) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [wmf/1.37.0-wmf.3](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/wmf/1.37.0-wmf.3) | +82 -1 |
|  | [UserIdentityValue: Introduce convenience static factory methods](https://gerrit.wikimedia.org/r/c/685588) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [wmf/1.37.0-wmf.4](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/wmf/1.37.0-wmf.4) | +82 -1 |
|  | [Cross-wiki block should pass correct wiki blocker](https://gerrit.wikimedia.org/r/c/673076) | [mediawiki/extensions/CentralAuth](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CentralAuth/%2B/master) | +3 -1 |
|  | [UserIdentityValue: Introduce convenience static factory methods](https://gerrit.wikimedia.org/r/c/685547) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +82 -1 |

Show related patches [Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T281972)
# Related ObjectsSearch...

* Task Graph
* Mentions
* Duplicates

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved | Security | [• Pchelolo](/p/Pchelolo/) | T281972 [ActorStore::checkDatabaseDomain: InvalidArgumentException: DB connection domain does not match when suppressing via Special:CentralAuth (CVE-2021-36128)](/T281972) |
|  |  | Open |  | *None* | T291994 [Properly support cross-wiki blocking](/T291994) |
|  |  | Resolved |  | [Zabe](/p/Zabe/) | T291983 [Create a BlockRestrictionStoreFactory in order to make BlockRestrictionStore a proper cross-wiki store](/T291983) |
|  |  | Resolved |  | [Zabe](/p/Zabe/) | T291849 [Create a DatabaseBlockStoreFactory in order to make DatabaseBlockStore a proper cross-wiki store](/T291849) |
|  |  | Resolved |  | [Zabe](/p/Zabe/) | T274817 [Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817) |
|  |  | Resolved | Security | [Zabe](/p/Zabe/) | T299655 [[regression] Cannot globally suppress any global account](/T299655) |
|  |  | Open |  | *None* | T292375 [Figure out how to force-logout users cross-wiki](/T292375) |

Mentioned In [T291994: Properly support cross-wiki blocking](/T291994)
[T287630: PHP Deprecated: Deprecated cross-wiki access to MediaWiki\User\UserIdentityValue. Expected: the local wiki, Actual: 'loginwiki'. Pass expected $wikiId. [Called from MediaWiki\User\UserIdentityValue::getId]](/T287630)
[T287625: Deprecated passing invalid cross-wiki user. Expected: 'metawiki', Actual: the local wiki.](/T287625)
[T286490: PHP Deprecated: Deprecated cross-wiki access to MediaWiki\User\UserIdentityValue. Expected: the local wiki, Actual: 'enwiki'. Pass expected $wikiId. [Called from MediaWiki\User\UserIdentityValue::getId]](/T286490)
[T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817)
[T284873: Regression: CentralAuth Lock+Suppress is issuing local blocks without autoblock](/T284873)
[T279733: Write and send supplementary release announcement for extensions and skins with security patches (1.31.15/1.35.3/1.36.1)](/T279733)
[T25310: Global suppression does not work properly when the target has already been locally blocked](/T25310)
[T277687: Deprecated cross-wiki access to User. Expected: 'eswiki', Actual: the local wiki. Pass expected $wikiId. [Called from User::getId]](/T277687) Mentioned Here [T258866: Calling DatabaseBlock::insert with a particular database may perform actions on the wrong database](/T258866)
[T279733: Write and send supplementary release announcement for extensions and skins with security patches (1.31.15/1.35.3/1.36.1)](/T279733)
[T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817) Duplicates Merged Here [T282311: Centralauth-oversight throws InvalidArgumentException on beta](/T282311)
[T277687: Deprecated cross-wiki access to User. Expected: 'eswiki', Actual: the local wiki. Pass expected $wikiId. [Called from User::getId]](/T277687)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-szioatfpagm644lx2qzp/?after=7075404&quoteTargetID=UQ0_5&quoteRef=T281972)[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[May 10 2021, 4:42 PM2021-05-10 16:42:52 (UTC+0)](#7075404)Comment Actions

Change 688290 had a related patch set uploaded (by Urbanecm; author: Ppchelko):

[mediawiki/core@REL1\_36] UserIdentityValue: Introduce convenience static factory methods

<https://gerrit.wikimedia.org/r/688290>

[Urbanecm](/p/Urbanecm/) added a comment.[May 11 2021, 2:56 PM2021-05-11 14:56:00 (UTC+0)](#7078556)Comment Actions
> In [T281972#7075007](/T281972#7075007), [@Reedy](/p/Reedy/) wrote:
>
> Just 1.36 to go?

I think so.

[Urbanecm](/p/Urbanecm/) added a comment.[May 11 2021, 4:10 PM2021-05-11 16:10:12 (UTC+0)](#7078879)This comment was removed by [Legoktm](/p/Legoktm/).[• Pchelolo](/p/Pchelolo/) added a comment.[May 11 2021, 4:17 PM2021-05-11 16:17:33 (UTC+0)](#7078917)Comment Actions
> AFAICS CheckUser was not mentioned in the first stacks, so it is probably something there that causes this error sometimes.

This is definitely a different error, you're right. Will have a look.

[• Pchelolo](/p/Pchelolo/) added a comment.[May 11 2021, 4:29 PM2021-05-11 16:29:26 (UTC+0)](#7078969)Comment Actions

Okey. The problem is pretty clear.

Now that we are ably to correctly insert cross-wiki block with a correct blocker, CheckUser is doing auto blocking of IPs that are associated with the block. But CheckUser is oblivious towards which wiki the block actually belongs to, so it does everything in the context of metawiki.

BTW, none of these errors are regressions. They just indicate before some of these blocks were inserted with invalid blockers..

I guess the best fix is to actually make blocks wiki-aware and support cross-wiki blocking properly. How urgent is this?

[gerritbot](/p/gerritbot/) added a comment.[May 12 2021, 12:53 AM2021-05-12 00:53:44 (UTC+0)](#7080517)Comment Actions

Change 689379 had a related patch set uploaded (by Jforrester; author: Jforrester):

[mediawiki/core@master] Follow-up bbc75d404: Update @since tag as we're back-porting

<https://gerrit.wikimedia.org/r/689379>

[Jdforrester-WMF](/p/Jdforrester-WMF/) closed this task as Resolved.[May 12 2021, 12:57 AM2021-05-12 00:57:23 (UTC+0)](#7080525)[gerritbot](/p/gerritbot/) added a comment.[May 12 2021, 1:05 AM2021-05-12 01:05:11 (UTC+0)](#7080536)Comment Actions

Change 688290 **merged** by jenkins-bot:

[mediawiki/core@REL1\_36] UserIdentityValue: Introduce convenience static factory methods

<https://gerrit.wikimedia.org/r/688290>

[gerritbot](/p/gerritbot/) added a comment.[May 12 2021, 1:19 AM2021-05-12 01:19:16 (UTC+0)](#7080553)Comment Actions

Change 689379 **merged** by jenkins-bot:

[mediawiki/core@master] Follow-up bbc75d404: Update @since tag as we're back-porting

<https://gerrit.wikimedia.org/r/689379>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) edited projects, added [MW-1.37-notes (1.37.0-wmf.6; 2021-05-18)](/project/view/5344/), [MW-1.36-notes](/tag/mw-1.36-notes/); removed [MW-1.37-notes (1.37.0-wmf.4; 2021-05-04)](/project/view/5299/).[May 12 2021, 2:00 AM2021-05-12 02:00:31 (UTC+0)](#7080609)[gerritbot](/p/gerritbot/) added a comment.[May 12 2021, 11:16 AM2021-05-12 11:16:03 (UTC+0)](#7081568)Comment Actions

Change 688289 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@REL1\_36] Cross-wiki block should pass correct wiki blocker

<https://gerrit.wikimedia.org/r/688289>

[AmandaNP](/p/AmandaNP/) reopened this task as Open.[May 14 2021, 7:25 AM2021-05-14 07:25:17 (UTC+0)](#7087384)[AmandaNP](/p/AmandaNP/) subscribed.This comment was removed by [Legoktm](/p/Legoktm/).[taavi](/p/taavi/) set Security to Software security bug.[May 14 2021, 7:31 AM2021-05-14 07:31:06 (UTC+0)](#7087389)[taavi](/p/taavi/) added a project: [Security-Team](/tag/security-team/).[taavi](/p/taavi/) changed the visibility from "Public (No Login Required)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-fsu3pdv3igbmohr/)".[Stryn](/p/Stryn/) subscribed.[May 14 2021, 7:31 AM2021-05-14 07:31:24 (UTC+0)](#7087392)[taavi](/p/taavi/) added a project: [PermanentlyPrivate](/tag/permanentlyprivate/).[May 14 2021, 7:34 AM2021-05-14 07:34:24 (UTC+0)](#7087393)Restricted Application changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-25fgxesilosmedr/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-25fgxesilosmedr/)".  · [View Herald Transcript](/herald/transcript/4258719/)[May 14 2021, 7:34 AM2021-05-14 07:34:26 (UTC+0)](#7087394)Restricted Application changed the edit policy from "All Users" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-3xreciag5zpafoz/)".  · [View Herald Transcript](/herald/transcript/4258719/)[Operator873](/p/Operator873/) subscribed.[May 15 2021, 12:54 AM2021-05-15 00:54:59 (UTC+0)](#7089704)Comment Actions

<https://873gear.com/irc/uploads/1d222380b2567746/image.png>

Account was not locked, attempted to lock/hide

[Aklapper](/p/Aklapper/) added a comment.[May 15 2021, 8:51 AM2021-05-15 08:51:17 (UTC+0)](#7089889)Comment Actions

[@Operator873](/p/Operator873/): Please [provide a stack trace](https://www.mediawiki.org/wiki/Manual%3AHow_to_debug), as text.

[Urbanecm](/p/Urbanecm/) added a comment.[May 15 2021, 1:11 PM2021-05-15 13:11:00 (UTC+0)](#7090229)This comment was removed by [Legoktm](/p/Legoktm/).

[Urbanecm](/p/Urbanecm/) added a comment.[May 15 2021, 1:17 PM2021-05-15 13:17:02 (UTC+0)](#7090250)Comment Actions

Let me try to summarize where are we at right now:

* CentralAuth-issued suppresions don't work, because making xwiki autoblocks is not possible. The proper solution for that would be [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817), which is something the platform team would likely work at one point.
* Simple workaround would be to disable autoblocks. Stewards do not autoblocks to work for locks, because there is currently no such mechanism. In case we need an autoblock-like mechanism, we manually checkuser the user and block the IP manually. So, let's do that for now, and let [T274817](/T274817) be the proper solution. I'll upload a patch momentarily.

[Urbanecm](/p/Urbanecm/) added a comment.[May 15 2021, 1:18 PM2021-05-15 13:18:17 (UTC+0)](#7090252)Comment Actions

T281972.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/tvyn272ikg4nzpcz6j44/PHID-FILE-wje2grz4sq5vhlgzmixe/T281972.patch)

[@Pchelolo](/p/Pchelolo/) Could you please review this one here, and provide a +2 as a Phabricator comment? I can then deploy it (or maybe it can actually go through Gerrit instead?).

[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Security Patch To Deploy](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[May 17 2021, 3:35 PM2021-05-17 15:35:40 (UTC+0)](#7093125)[Krinkle](/p/Krinkle/) moved this task from [Untriaged](/project/board/1055/) to [May 2021](/project/board/1055/) on the [Wikimedia-production-error](/tag/wikimedia-production-error/) board.[May 19 2021, 9:38 PM2021-05-19 21:38:09 (UTC+0)](#7099472)[Jdforrester-WMF](/p/Jdforrester-WMF/) moved this task from [Blocker](/project/board/4555/) to [Not a blocker](/project/board/4555/) on the [MW-1.36-release](/tag/mw-1.36-release/) board.[May 20 2021, 5:39 PM2021-05-20 17:39:07 (UTC+0)](#7101303)[Tks4Fish](/p/Tks4Fish/) added a project: [Stewards-and-global-tools](/tag/stewards-and-global-tools/).[Jun 2 2021, 5:57 PM2021-06-02 17:57:53 (UTC+0)](#7129860)Comment Actions

Is there any plan to review this patch? If an user doxxes someone on the username, or creates an account with a phone number, there is no way to hide that. This is a big security issue that has a patch pending review for 15 days. I understand we are all volunteers, but it'd be really good for this to be reviewed.

[• Pchelolo](/p/Pchelolo/) added a comment.[Jun 2 2021, 6:00 PM2021-06-02 18:00:00 (UTC+0)](#7129868)Comment Actions

[@Urbanecm](/p/Urbanecm/) +2 for the patch.

[Urbanecm](/p/Urbanecm/) added a comment.[Jun 2 2021, 6:15 PM2021-06-02 18:15:33 (UTC+0)](#7129916)Comment Actions
```
20:11 <urbanecm> !log Deployed security patch for T281972
20:11 <stashbot> Logged the message at https://wikitech.wikimedia.org/wiki/Server_Admin_Log
```

Thanks [@Pchelolo](/p/Pchelolo/), appreciated. Deployed. A proper fix can happen later.

[Urbanecm](/p/Urbanecm/) triaged this task as Lowest priority.[Jun 2 2021, 6:27 PM2021-06-02 18:27:16 (UTC+0)](#7129975)[Urbanecm](/p/Urbanecm/) added a subscriber: [sbassett](/p/sbassett/).Comment Actions

[@sbassett](/p/sbassett/) Hi, would you mind doing the final honors (backports here; should need only master)? Thanks!

[sbassett](/p/sbassett/) mentioned this in [T279733: Write and send supplementary release announcement for extensions and skins with security patches (1.31.15/1.35.3/1.36.1)](/T279733).[Jun 2 2021, 10:17 PM2021-06-02 22:17:01 (UTC+0)](#7130722)[sbassett](/p/sbassett/) added a comment.[Jun 2 2021, 10:19 PM2021-06-02 22:19:54 (UTC+0)](#7130744)Comment Actions
> In [T281972#7129975](/T281972#7129975), [@Urbanecm](/p/Urbanecm/) wrote:
>
> [@sbassett](/p/sbassett/) Hi, would you mind doing the final honors (backports here; should need only master)? Thanks!

Sure, tracking at T276237 and [T279733](/T279733) for now. This will definitely get backported before the end of this quarter (2021-06-30) but I can't guarantee when, unless someone else wants to run with it. Though I'd question if we even want this on master since it's kind of a Wikimedia production-specific config change if I'm reading this bug and the patch comment correctly.

[Urbanecm](/p/Urbanecm/) added a comment.[Jun 3 2021, 10:45 AM2021-06-03 10:45:10 (UTC+0)](#7131468)Comment Actions
> In [T281972#7130744](/T281972#7130744), [@sbassett](/p/sbassett/) wrote:
> > In [T281972#7129975](/T281972#7129975), [@Urbanecm](/p/Urbanecm/) wrote:
> >
> > [@sbassett](/p/sbassett/) Hi, would you mind doing the final honors (backports here; should need only master)? Thanks!
>
> Sure, tracking at T276237 and [T279733](/T279733) for now. This will definitely get backported before the end of this quarter (2021-06-30) but I can't guarantee when, unless someone else wants to run with it. Though I'd question if we even want this on master since it's kind of a Wikimedia production-specific config change if I'm reading this bug and the patch comment correctly.

The error would be very likely present on any Wikimedia-like wikifarm. The underlying bug is in MediaWiki core (which doesn't support xwiki blocks [an user from wiki A blocks on wiki B] properly, and while xwiki blocks work somehow, autoblocks sometimes fail with this error message, which is why this task exists]). Fixing that bug properly would be possible, but the platform team asked for time to refactor blocks to support xwiki blocks in the proper way, rather than adding hacks at top of hacks.

You're right that the bug very likely apprears only in Wikimedia production, but that's not because we have a special configuration – it is because non-Wikimedia wikis shouldn't use centralauth because of its complexity (and in parts, Wikimedia-specificness), see the big red warning at [https://www.mediawiki.org/wiki/Extension:CentralAuth](https://www.mediawiki.org/wiki/Extension%3ACentralAuth).

I personally vote for including into master (as that'd avoid conflicts as master progresses), but I defer to your judgement.

[sbassett](/p/sbassett/) added a comment.[Jun 3 2021, 3:14 PM2021-06-03 15:14:20 (UTC+0)](#7132047)Comment Actions
> In [T281972#7131468](/T281972#7131468), [@Urbanecm](/p/Urbanecm/) wrote:
>
> The error would be very likely present on any Wikimedia-like wikifarm. The underlying bug is in MediaWiki core (which doesn't support xwiki blocks [an user from wiki A blocks on wiki B] properly, and while xwiki blocks work somehow, autoblocks sometimes fail with this error message, which is why this task exists]). Fixing that bug properly would be possible, but the platform team asked for time to refactor blocks to support xwiki blocks in the proper way, rather than adding hacks at top of hacks.

Ok, that all makes sense, thanks. We can plan to backport this to master.

[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Jun 3 2021, 9:26 PM2021-06-03 21:26:40 (UTC+0)](#7132996)[sbassett](/p/sbassett/) moved this task from [Security Patch To Deploy](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[daniel](/p/daniel/) moved this task from [Unsorted pile](/project/board/5144/) to [UserStore pile](/project/board/5144/) on the [Platform Team Workboards (MW Expedition)](/project/view/5144/) board.[Jun 8 2021, 11:46 AM2021-06-08 11:46:48 (UTC+0)](#7141895)[Urbanecm](/p/Urbanecm/) mentioned this in [T284873: Regression: CentralAuth Lock+Suppress is issuing local blocks without autoblock](/T284873).[Jun 13 2021, 11:15 AM2021-06-13 11:15:14 (UTC+0)](#7153751)[Urbanecm](/p/Urbanecm/) added a parent task: [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817).[Jun 14 2021, 4:35 PM2021-06-14 16:35:17 (UTC+0)](#7155828)[Urbanecm](/p/Urbanecm/) removed a parent task: [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817).[Urbanecm](/p/Urbanecm/) added a subtask: [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817).[Urbanecm](/p/Urbanecm/) mentioned this in [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817).[Jun 14 2021, 4:37 PM2021-06-14 16:37:45 (UTC+0)](#7155850)[sbassett](/p/sbassett/) changed Author Affiliation from N/A to Wikimedia Communities.[Jul 1 2021, 10:11 PM2021-07-01 22:11:51 (UTC+0)](#7191381)[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-mt6ycyykmvuc443/)" to "Public (No Login Required)".[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-s3zaw4dnae5sd3s/)" to "All Users".Restricted Application changed the visibility from "Public (No Login Required)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-6tujrj775hccext/)".  · [View Herald Transcript](/herald/transcript/4322179/)[Jul 1 2021, 10:11 PM2021-07-01 22:11:52 (UTC+0)](#7191384)Restricted Application changed the edit policy from "All Users" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-gb4fli7c6b73lix/)".  · [View Herald Transcript](/herald/transcript/4322179/)[Zabe](/p/Zabe/) added a subscriber: [gerritbot](/p/gerritbot/).[Jul 2 2021, 4:01 PM2021-07-02 16:01:32 (UTC+0)](#7194331)[gerritbot](/p/gerritbot/) added a comment.[Jul 2 2021, 4:12 PM2021-07-02 16:12:19 (UTC+0)](#7194372)Comment Actions

Change 702717 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@REL1\_36] SECURITY: Disable autoblocks for CentralAuth-issued suppression blocks

<https://gerrit.wikimedia.org/r/702717>

[Legoktm](/p/Legoktm/) subscribed.[Jul 2 2021, 4:51 PM2021-07-02 16:51:40 (UTC+0)](#7194522)Comment Actions

I've deleted comments above that contained private information so this task can be made public. They're quoted below with the private info redacted:

> In [T281972#7087384](/T281972#7087384), @DeltaQuad wrote:
>
> Still currently getting an error.
>
> [8008a778-58be-418c-8be8-72bbc8c57a76] 2021-05-14 07:24:13: Fatal exception of type "InvalidArgumentException"
>
> URL: <https://meta.wikimedia.org/w/index.php?title=Special:CentralAuth&target=<redacted>>

> In [T281972#7090229](/T281972#7090229), [@Urbanecm](/p/Urbanecm/) wrote:
> > In [T281972#7089889](/T281972#7089889), [@Aklapper](/p/Aklapper/) wrote:
> >
> > [@Operator873](/p/Operator873/): Please [provide a stack trace](https://www.mediawiki.org/wiki/Manual%3AHow_to_debug), as text.
>
> Note AFAIK, Operator873 does not have access to logstash, so he cannot see the stack. Here it is through:
>
> Stack trace
> ```
> [urbanecm@mwlog1002 /srv/mw-log]$ grep -A 27 fccd3bd6-2816-44e2-b525-c068ccf3d42d archive/exception.log-20210515
> 2021-05-15 00:51:30 [fccd3bd6-2816-44e2-b525-c068ccf3d42d] mw1373 metawiki 1.37.0-wmf.5 exception ERROR: [fccd3bd6-2816-44e2-b525-c068ccf3d42d] /w/index.php?title=Special:CentralAuth&target=<redacted>   InvalidArgumentException: DB connection domain 'metawiki' does not match 'loginwiki' {"exception_url":"/w/index.php?title=Special:CentralAuth&target=<redacted>","reqId":"fccd3bd6-2816-44e2-b525-c068ccf3d42d","caught_by":"entrypoint"}
> [Exception InvalidArgumentException] (/srv/mediawiki/php-1.37.0-wmf.5/includes/user/ActorStore.php:704) DB connection domain 'metawiki' does not match 'loginwiki'
>   #0 /srv/mediawiki/php-1.37.0-wmf.5/includes/user/ActorStore.php(412): MediaWiki\User\ActorStore->checkDatabaseDomain(Wikimedia\Rdbms\DBConnRef)
>   #1 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlockStore.php(360): MediaWiki\User\ActorStore->acquireActorId(MediaWiki\User\UserIdentityValue, Wikimedia\Rdbms\DBConnRef)
>   #2 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlockStore.php(166): MediaWiki\Block\DatabaseBlockStore->getArrayForDatabaseBlock(MediaWiki\Block\DatabaseBlock, Wikimedia\Rdbms\DBConnRef)
>   #3 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlock.php(690): MediaWiki\Block\DatabaseBlockStore->insertBlock(MediaWiki\Block\DatabaseBlock)
>   #4 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CheckUser/src/Hooks.php(708): MediaWiki\Block\DatabaseBlock->doAutoblock(string)
>   #5 /srv/mediawiki/php-1.37.0-wmf.5/includes/HookContainer/HookContainer.php(330): MediaWiki\CheckUser\Hooks::doRetroactiveAutoblock(MediaWiki\Block\DatabaseBlock, array)
>   #6 /srv/mediawiki/php-1.37.0-wmf.5/includes/HookContainer/HookContainer.php(137): MediaWiki\HookContainer\HookContainer->callLegacyHook(string, array, array, array)
>   #7 /srv/mediawiki/php-1.37.0-wmf.5/includes/HookContainer/HookRunner.php(2981): MediaWiki\HookContainer\HookContainer->run(string, array)
>   #8 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlockStore.php(440): MediaWiki\HookContainer\HookRunner->onPerformRetroactiveAutoblock(MediaWiki\Block\DatabaseBlock, array)
>   #9 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlockStore.php(206): MediaWiki\Block\DatabaseBlockStore->doRetroactiveAutoblock(MediaWiki\Block\DatabaseBlock)
>   #10 /srv/mediawiki/php-1.37.0-wmf.5/includes/block/DatabaseBlock.php(535): MediaWiki\Block\DatabaseBlockStore->insertBlock(MediaWiki\Block\DatabaseBlock, Wikimedia\Rdbms\DBConnRef)
>   #11 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/CentralAuthUser.php(1952): MediaWiki\Block\DatabaseBlock->insert(Wikimedia\Rdbms\DBConnRef)
>   #12 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/CentralAuthUser.php(1881): CentralAuthUser->doLocalSuppression(boolean, string, string, string)
>   #13 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/CentralAuthUser.php(1859): CentralAuthUser->doCrosswikiSuppression(boolean, string, string)
>   #14 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/CentralAuthUser.php(1810): CentralAuthUser->suppress(string, string)
>   #15 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/specials/SpecialCentralAuth.php(245): CentralAuthUser->adminLockHide(boolean, string, string, RequestContext)
>   #16 /srv/mediawiki/php-1.37.0-wmf.5/extensions/CentralAuth/includes/specials/SpecialCentralAuth.php(143): SpecialCentralAuth->doSubmit()
>   #17 /srv/mediawiki/php-1.37.0-wmf.5/includes/specialpage/SpecialPage.php(646): SpecialCentralAuth->execute(NULL)
>   #18 /srv/mediawiki/php-1.37.0-wmf.5/includes/specialpage/SpecialPageFactory.php(1396): SpecialPage->run(NULL)
>   #19 /srv/mediawiki/php-1.37.0-wmf.5/includes/MediaWiki.php(313): MediaWiki\SpecialPage\SpecialPageFactory->executePath(string, RequestContext)
>   #20 /srv/mediawiki/php-1.37.0-wmf.5/includes/MediaWiki.php(916): MediaWiki->performRequest()
>   #21 /srv/mediawiki/php-1.37.0-wmf.5/includes/MediaWiki.php(550): MediaWiki->main()
>   #22 /srv/mediawiki/php-1.37.0-wmf.5/index.php(53): MediaWiki->run()
>   #23 /srv/mediawiki/php-1.37.0-wmf.5/index.php(46): wfIndexMain()
>   #24 /srv/mediawiki/w/index.php(3): require(string)
>   #25 {main}
> [urbanecm@mwlog1002 /srv/mw-log]$
> ```
>
> It looks to match what I offered at [T281972#7078879](/T281972#7078879).

[Legoktm](/p/Legoktm/) removed a project: [PermanentlyPrivate](/tag/permanentlyprivate/).[Jul 2 2021, 4:58 PM2021-07-02 16:58:26 (UTC+0)](#7194566)[Legoktm](/p/Legoktm/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-xoqo4jzzsgzy4ko/)" to "Public (No Login Required)".[Legoktm](/p/Legoktm/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-bbwxastqza7zwju/)" to "All Users".[sbassett](/p/sbassett/) renamed this task from ActorStore::checkDatabaseDomain: InvalidArgumentException: DB connection domain does not match when suppressing via Special:CentralAuth to ActorStore::checkDatabaseDomain: InvalidArgumentException: DB connection domain does not match when suppressing via Special:CentralAuth (CVE-2021-36128).[Jul 2 2021, 8:02 PM2021-07-02 20:02:08 (UTC+0)](#7194929)[sbassett](/p/sbassett/) closed this task as Resolved.[Jul 2 2021, 8:12 PM2021-07-02 20:12:04 (UTC+0)](#7194971)[sbassett](/p/sbassett/) moved this task from [Watching](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jdforrester-WMF](/p/Jdforrester-WMF/) edited projects, added [MW-1.37-notes (1.37.0-wmf.14; 2021-07-12)](/project/view/5404/); removed [MW-1.37-notes (1.37.0-wmf.6; 2021-05-18)](/project/view/5344/).[Jul 3 2021, 7:46 AM2021-07-03 07:46:10 (UTC+0)](#7195512)[Zabe](/p/Zabe/) mentioned this in [T286490: PHP Deprecated: Deprecated cross-wiki access to MediaWiki\User\UserIdentityValue. Expected: the local wiki, Actual: 'enwiki'. Pass expected $wikiId. [Called from MediaWiki\User\UserIdentityValue::getId]](/T286490).[Jul 12 2021, 5:30 PM2021-07-12 17:30:01 (UTC+0)](#7206485)[• mmodell](/p/mmodell/) mentioned this in [T287625: Deprecated passing invalid cross-wiki user. Expected: 'metawiki', Actual: the local wiki.](/T287625).[Jul 28 2021, 7:58 PM2021-07-28 19:58:46 (UTC+0)](#7244434)[• mmodell](/p/mmodell/) mentioned this in [T287630: PHP Deprecated: Deprecated cross-wiki access to MediaWiki\User\UserIdentityValue. Expected: the local wiki, Actual: 'loginwiki'. Pass expected $wikiId. [Called from MediaWiki\User\UserIdentityValue::getId]](/T287630).[Zabe](/p/Zabe/) mentioned this in [T291994: Properly support cross-wiki blocking](/T291994).[Sep 28 2021, 6:27 PM2021-09-28 18:27:20 (UTC+0)](#7385177)[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:02 PM2021-11-13 22:02:42 (UTC+0)](#7501960)Comment Actions

Change 738549 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/core@master] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738549>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Nov 13 2021, 10:02 PM2021-11-13 22:02:45 (UTC+0)](#7501961)[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:05 PM2021-11-13 22:05:52 (UTC+0)](#7501962)Comment Actions

Change 738400 had a related patch set uploaded (by Reedy; author: Zabe):

[mediawiki/core@REL1\_37] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738400>

[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:06 PM2021-11-13 22:06:05 (UTC+0)](#7501963)Comment Actions

Change 738401 had a related patch set uploaded (by Reedy; author: Zabe):

[mediawiki/core@REL1\_36] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738401>

[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:16 PM2021-11-13 22:16:44 (UTC+0)](#7501971)Comment Actions

Change 738400 **merged** by jenkins-bot:

[mediawiki/core@REL1\_37] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738400>

[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:17 PM2021-11-13 22:17:42 (UTC+0)](#7501972)Comment Actions

Change 738401 **merged** by jenkins-bot:

[mediawiki/core@REL1\_36] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738401>

[gerritbot](/p/gerritbot/) added a comment.[Nov 13 2021, 10:29 PM2021-11-13 22:29:02 (UTC+0)](#7501975)Comment Actions

Change 738549 **merged** by jenkins-bot:

[mediawiki/core@master] Follow-Up: I10fbd4b6a: Update @since tags as those were backported

<https://gerrit.wikimedia.org/r/738549>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) edited projects, added [MW-1.38-notes (1.38.0-wmf.9; 2021-11-16)](/project/view/5605/), [MW-1.37-notes](/tag/mw-1.37-notes/); removed [MW-1.37-notes (1.37.0-wmf.14; 2021-07-12)](/project/view/5404/).[Nov 13 2021, 11:00 PM2021-11-13 23:00:28 (UTC+0)](#7501984)[Zabe](/p/Zabe/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Jan 17 2022, 10:43 PM2022-01-17 22:43:35 (UTC+0)](#7626974)[Zabe](/p/Zabe/) removed a subtask: [T274817: Convert DatabaseBlock and AbstractBlock to UserIdentity, and make them cross-wiki aware.](/T274817).[Jan 17 2022, 11:11 PM2022-01-17 23:11:17 (UTC+0)](#7626995)[Zabe](/p/Zabe/) added a subtask: [T291994: Properly support cross-wiki blocking](/T291994).[gerritbot](/p/gerritbot/) added a comment.[Jan 17 2022, 11:21 PM2022-01-17 23:21:33 (UTC+0)](#7627008)Comment Actions

Change 725894 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/CentralAuth@master] Reenable autoblocks for CentralAuth-issued suppression blocks

<https://gerrit.wikimedia.org/r/725894>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Jan 17 2022, 11:21 PM2022-01-17 23:21:34 (UTC+0)](#7627009)[gerritbot](/p/gerritbot/) added a comment.[Jan 23 2022, 12:06 AM2022-01-23 00:06:12 (UTC+0)](#7642736)Comment Actions

Change 756131 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/extensions/CheckUser@master] Respect the wiki when performing autoblocks

<https://gerrit.wikimedia.org/r/756131>

[gerritbot](/p/gerritbot/) added a comment.[Feb 18 2022, 5:16 PM2022-02-18 17:16:15 (UTC+0)](#7721645)Comment Actions

Change 763788 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/core@master] Respect the wiki when performing autoblocks

<https://gerrit.wikimedia.org/r/763788>

[Zabe](/p/Zabe/) added a comment.Edited · [Apr 3 2022, 10:24 PM2022-04-03 22:24:54 (UTC+0)](#7827283)Comment Actions

"Fun" fact: The second part of this was actually predicted almost a year before it showed up.

From the task description of [T258866](/T258866):

> CentralAuthUser::doLocalSuppression is an example that passes the database to insert:
>
> The block is always autoblocking (presumably the autoblocks are not being inserted correctly?)

[gerritbot](/p/gerritbot/) added a comment.[Jun 13 2022, 7:12 PM2022-06-13 19:12:33 (UTC+0)](#8000178)Comment Actions

Change 756131 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] Respect the wiki when performing autoblocks

<https://gerrit.wikimedia.org/r/756131>

[Tchanders](/p/Tchanders/) added a project: [Anti-Harassment (AHaT Sprint 10: The Mokorotlo)](/project/view/5985/).[Jun 15 2022, 4:50 PM2022-06-15 16:50:46 (UTC+0)](#8006665)[Tchanders](/p/Tchanders/) moved this task from [Ready 🎬 (ONLY IF YOU HAVE NO MORE CODE TO REVIEW)](/project/board/5985/) to [Code Review 🔍](/project/board/5985/) on the [Anti-Harassment (AHaT Sprint 10: The Mokorotlo)](/project/view/5985/) board.[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2022, 10:12 PM2022-06-30 22:12:40 (UTC+0)](#8042716)Comment Actions

Change 763788 **merged** by jenkins-bot:

[mediawiki/core@master] Respect the wiki when performing autoblocks

<https://gerrit.wikimedia.org/r/763788>

[gerritbot](/p/gerritbot/) added a comment.[Jul 8 2022, 8:57 PM2022-07-08 20:57:58 (UTC+0)](#8066647)Comment Actions

Change 810381 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/core@master] block: Create wiki-aware target for autoblocks

<https://gerrit.wikimedia.org/r/810381>

[gerritbot](/p/gerritbot/) added a comment.[Jul 9 2022, 8:02 AM2022-07-09 08:02:49 (UTC+0)](#8067077)Comment Actions

Change 810381 **merged** by jenkins-bot:

[mediawiki/core@master] block: Create wiki-aware target for autoblocks

<https://gerrit.wikimedia.org/r/810381>

[gerritbot](/p/gerritbot/) added a comment.[Aug 30 2022, 11:54 PM2022-08-30 23:54:17 (UTC+0)](#8201051)Comment Actions

Change 828126 had a related patch set uploaded (by Zabe; author: Zabe):

[mediawiki/core@master] Load potential current ip block from correct wiki

<https://gerrit.wikimedia.org/r/828126>

[gerritbot](/p/gerritbot/) added a comment.[Jun 14 2023, 6:51 PM2023-06-14 18:51:32 (UTC+0)](#8932759)Comment Actions

Change 828126 **merged** by jenkins-bot:

[mediawiki/core@master] Load potential current ip block from correct wiki

<https://gerrit.wikimedia.org/r/828126>

[gerritbot](/p/gerritbot/) added a comment.[Feb 8 2024, 7:31 PM2024-02-08 19:31:45 (UTC+0)](#9526820)Comment Actions

Change 725894 **merged** by jenkins-bot:

[mediawiki/extensions/CentralAuth@master] Reenable autoblocks for CentralAuth-issued suppression blocks

<https://gerrit.wikimedia.org/r/725894>

Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
