=== Content from github.com_f9529c06_20250115_080116.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjxl%2Flibjxl%2Fissues%2F422)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjxl%2Flibjxl%2Fissues%2F422)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libjxl%2Flibjxl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libjxl](/libjxl)
/
**[libjxl](/libjxl/libjxl)**
Public

* [Notifications](/login?return_to=%2Flibjxl%2Flibjxl) You must be signed in to change notification settings
* [Fork
  269](/login?return_to=%2Flibjxl%2Flibjxl)
* [Star
   2.8k](/login?return_to=%2Flibjxl%2Flibjxl)

* [Code](/libjxl/libjxl)
* [Issues
  345](/libjxl/libjxl/issues)
* [Pull requests
  34](/libjxl/libjxl/pulls)
* [Discussions](/libjxl/libjxl/discussions)
* [Actions](/libjxl/libjxl/actions)
* [Security](/libjxl/libjxl/security)
* [Insights](/libjxl/libjxl/pulse)

Additional navigation options

* [Code](/libjxl/libjxl)
* [Issues](/libjxl/libjxl/issues)
* [Pull requests](/libjxl/libjxl/pulls)
* [Discussions](/libjxl/libjxl/discussions)
* [Actions](/libjxl/libjxl/actions)
* [Security](/libjxl/libjxl/security)
* [Insights](/libjxl/libjxl/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibjxl%2Flibjxl%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibjxl%2Flibjxl%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Assertion failed in lib/jxl/image.cc jxl::PlaneBase::PlaneBase #422

Closed

[aug5t7](/aug5t7) opened this issue
Aug 8, 2021
· 2 comments

Closed

# [Assertion failed in lib/jxl/image.cc jxl::PlaneBase::PlaneBase](#top) #422

[aug5t7](/aug5t7) opened this issue
Aug 8, 2021
· 2 comments

## Comments

[![@aug5t7](https://avatars.githubusercontent.com/u/22651256?s=80&u=5cf02c312b7b0185ef53a54c20df8a42f2b67159&v=4)](/aug5t7)

Copy link

### **[aug5t7](/aug5t7)** commented [Aug 8, 2021](#issue-963389737)

| **Describe the bug** Assertion failed when compressing a gif with cjxl.  ``` $ ./libjxl/build/tools/cjxl ./poc.gif /tmp/jxl.jxl JPEG XL encoder v0.5.0 4122f3e [AVX2,SSE4,Scalar] <path>/libjxl/lib/jxl/image.cc:94: JXL_CHECK: bytes_.get() [1]    1073940 illegal hardware instruction  ./libjxl/build/tools/cjxl ./poc.gif /tmp/jxl.jxl ```  **To Reproduce** Steps to reproduce the behavior:  ``` $ CC=clang CXX=clang++ CFLAGS="-g" CXXFLAGS="-g" cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTING=OFF  .. $ cmake --build . -- -j 8 $ tools/cjxl ./poc.gif /tmp/jxl.jxl ```  [poc.gif](https://user-images.githubusercontent.com/22651256/128626307-99063df8-6710-49f9-9ef7-faafe46ec97c.gif)  **Expected behavior** No assertion failed.  **Environment**   * OS: `5.8.0-59-generic 20.04.1-Ubuntu` * Compiler version: `clang version 7.0.1-12` * CPU type: x86\_64 * cjxl/djxl version string: cjxl v0.5.0 [4122f3e](https://github.com/libjxl/libjxl/commit/4122f3e8e57e2f481060bb01b4afc5a30cd0a88a) [AVX2,SSE4,Scalar]   **Additional context**  It seems that the memory allocation size is too large causing the assertion failed.   [libjxl/lib/jxl/image.cc](https://github.com/libjxl/libjxl/blob/4122f3e8e57e2f481060bb01b4afc5a30cd0a88a/lib/jxl/image.cc#L90-L96)  Lines 90 to 96 in [4122f3e](/libjxl/libjxl/commit/4122f3e8e57e2f481060bb01b4afc5a30cd0a88a)   |  | // if nonzero, because "zero" bytes still have padding/bookkeeping overhead. | | --- | --- | |  | if (xsize != 0 && ysize != 0) { | |  | bytes\_per\_row\_ = BytesPerRow(xsize, sizeof\_t); | |  | bytes\_ = AllocateArray(bytes\_per\_row\_ \* ysize); | |  | JXL\_CHECK(bytes\_.get()); | |  | InitializePadding(sizeof\_t, Padding::kRoundUp); | |  | } |     Some gdb information   ``` gdb-peda$ [----------------------------------registers-----------------------------------] RAX: 0x801 RBX: 0x3fffc RCX: 0x40080 RDX: 0x0 RSI: 0x40080 RDI: 0x80 RBP: 0x7fffffffc490 --> 0x7fffffffc900 --> 0x7fffffffc940 --> 0x7fffffffca30 --> 0x7fffffffd350 --> 0x7fffffffe250 (--> ...) RSP: 0x7fffffffc470 --> 0xffff RIP: 0x55555573b858 (<jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+232>:	imul   r14,rcx) R8 : 0xffffffffffffffe0 R9 : 0x6e4e ('Nn') R10: 0x5555559fa8dc --> 0x0 R11: 0x5555559fa600 --> 0x206c786adc020000 R12: 0x4 R13: 0x5555559de970 --> 0x5555559daf10 --> 0x555555628e80 (<jxl::ColorEncoding::~ColorEncoding()>:	push   rbp) R14: 0xffff R15: 0x7fffffffc7a0 --> 0xffff0000ffff EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------]    0x55555573b84b <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+219>:	test   rdx,rdx    0x55555573b84e <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+222>:     jne    0x55555573b93c <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+460>:	    jne    0x55555573b93c <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+460>    0x55555573b854 <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+228>:	mov    QWORD PTR [r15+0x10],rcx => 0x55555573b858 <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+232>:	imul   r14,rcx    0x55555573b85c <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+236>:	call   0x5555556240b0 <jxl::CacheAligned::NextOffset()>    0x55555573b861 <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+241>:	mov    rdi,r14    0x55555573b864 <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+244>:	mov    rsi,rax    0x55555573b867 <jxl::PlaneBase::PlaneBase(unsigned long, unsigned long, unsigned long)+247>:     call   0x5555556240d0 <jxl::CacheAligned::Allocate(unsigned long, unsigned long)>:	    call   0x5555556240d0 <jxl::CacheAligned::Allocate(unsigned long, unsigned long)> [------------------------------------stack-------------------------------------] 0000| 0x7fffffffc470 --> 0xffff 0008| 0x7fffffffc478 --> 0x5555559f9580 --> 0xffff0000ffff 0016| 0x7fffffffc480 --> 0x7fffffffd368 --> 0xffffffffffffffff 0024| 0x7fffffffc488 --> 0xffff 0032| 0x7fffffffc490 --> 0x7fffffffc900 --> 0x7fffffffc940 --> 0x7fffffffca30 --> 0x7fffffffd350 --> 0x7fffffffe250 (--> ...) 0040| 0x7fffffffc498 --> 0x555555842c07 (<jxl::DecodeImageGIF(jxl::Span<unsigned char const>, jxl::ThreadPool*, jxl::CodecInOut*)+823>:	lea    rdi,[rbp-0x140]) 0048| 0x7fffffffc4a0 --> 0x0 0056| 0x7fffffffc4a8 --> 0x7fffffffc600 --> 0x0 [------------------------------------------------------------------------------] Legend: code, data, rodata, value 93	    bytes_ = AllocateArray(bytes_per_row_ * ysize); gdb-peda$ p ysize $1 = 0xffff gdb-peda$ p bytes_per_row_ $2 = 0x40080 gdb-peda$ p  bytes_per_row_ * ysize $3 = 0x4007bff80 ``` |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@deymo](https://avatars.githubusercontent.com/u/7899716?s=80&u=e5e1ed7725ab341c4491239de1332039047e098a&v=4)](/deymo)

Copy link

Contributor

### **[deymo](/deymo)** commented [Aug 9, 2021](#issuecomment-895387127)

| Hi, on that file I see that `gif->SWidth` and `gif->SHeight` are reported as 65535, and the only frame is reported as 10x10 at position 0,0.  I don't know what are we supposed to do differently. The way I understand this is that the virtual canvas is 65535 x 65535 white in color and there a single frame of 10x10 in the top left corner. `identify -verbose poc.gif` says  `Page geometry: 65535x65535+0+0` but if I try to convert this to png it returns a 10x10 image.  Regarding the crash due to OOM, at the moment we have many places where we would crash if OOM instead of returning a failure. |
| --- |

All reactions

Sorry, something went wrong.

[![@jonsneyers](https://avatars.githubusercontent.com/u/15010068?s=80&u=91ff8b00dfab1fdd5a952bfd22472b0b2524a4d9&v=4)](/jonsneyers)

Copy link

Member

### **[jonsneyers](/jonsneyers)** commented [Nov 19, 2021](#issuecomment-974251975)

| Going to close this one, it's basically a special case of [#762](https://github.com/libjxl/libjxl/issues/762) |
| --- |

All reactions

Sorry, something went wrong.

[![@jonsneyers](https://avatars.githubusercontent.com/u/15010068?s=40&u=91ff8b00dfab1fdd5a952bfd22472b0b2524a4d9&v=4)](/jonsneyers)
[jonsneyers](/jonsneyers)
closed this as [completed](/libjxl/libjxl/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Nov 19, 2021](#event-5646696483)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibjxl%2Flibjxl%2Fissues%2F422)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@deymo](https://avatars.githubusercontent.com/u/7899716?s=52&v=4)](/deymo) [![@jonsneyers](https://avatars.githubusercontent.com/u/15010068?s=52&v=4)](/jonsneyers) [![@aug5t7](https://avatars.githubusercontent.com/u/22651256?s=52&v=4)](/aug5t7)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


