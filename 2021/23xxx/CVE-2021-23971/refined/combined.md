=== Content from bugzilla.mozilla.org_68ba1a3f_20250115_084037.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1678545)
* [XML](/show_bug.cgi?ctype=xml&id=1678545)

Closed
[Bug 1678545](/show_bug.cgi?id=1678545)
(CVE-2021-23971)

Opened 4 years ago
Closed 4 years ago

# Full referrer URL exposed even from websites using strict referrer policies (e.g. "no-referrer" or "strict-origin-when-cross-origin")

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Full referrer URL exposed even from websites using strict referrer policies (e.g. "no-referrer" or "strict-origin-when-cross-origin")

## Categories

### (Core :: DOM: Security, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Security#DOM%3A%20Security)

DOM: Security
▾

Core :: DOM: Security
Native content-based security features including: Content Security Policy (CSP), Mixed Content Blocker (MCB), and Safe Browsing.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

86 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox83 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox83&o1=equals&v1=wontfix) |
| firefox84 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=wontfix) |
| firefox85 | [+](/buglist.cgi?f1=cf_tracking_firefox85&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix) |
| firefox86 | [+](/buglist.cgi?f1=cf_tracking_firefox86&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 | - | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox83 |  | wontfix |
| firefox84 |  | wontfix |
| firefox85 | + | wontfix |
| firefox86 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: l.moretto88, Assigned: dimi)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bd10912fd8637cc64f00edd465ca8b0d?d=mm&size=40)  [dimi](/user_profile?user_id=468232)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/58016afb4af3fdecbe6900ef493b2f82?d=mm&size=40)  [l.moretto88](/user_profile?user_id=674618)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=40)  [freddy](/user_profile?user_id=428608)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][domsecurity-active][post-critsmash-triage][adv-main86+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-23971

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][domsecurity-active][post-critsmash-triage][adv-main86+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c30 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a4079203_553429 "4 years ago") | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [referrer-stealing-poc.tgz](/attachment.cgi?id=9189089)  [4 years ago](#c0)  [Luca Moretto](/user_profile?user_id=674618)   41.25 KB, application/x-compressed-tar |  | [Details](/attachment.cgi?id=9189089&action=edit) |
| --- | --- | --- |
| [README.md from archive](/attachment.cgi?id=9190867)  [4 years ago](#c8)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   9.93 KB, text/plain |  | [Details](/attachment.cgi?id=9190867&action=edit) |
| [Bug 1678545 - P1. Use previously computed referrer as the original referrer in ReferrerInfo::CreateFromOtherAndPolicyOverride r=ckerschb](/attachment.cgi?id=9192404)  [4 years ago](#c17)  [Dimi Lee [:dimi]](/user_profile?user_id=468232)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9192404&action=edit) | [Review](/attachment.cgi?id=9192404) |
| [Bug 1678545 - P2. Add a WPT to verify the referrer header is sent correctly r=ckerschb](/attachment.cgi?id=9192405)  [4 years ago](#c18)  [Dimi Lee [:dimi]](/user_profile?user_id=468232)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9192405&action=edit) | [Review](/attachment.cgi?id=9192405) |
| [Bug 1678545 - P3. Fix test\_referrer\_redirect failures r=ckerschb](/attachment.cgi?id=9193459)  [4 years ago](#c26)  [Dimi Lee [:dimi]](/user_profile?user_id=468232)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9193459&action=edit) | [Review](/attachment.cgi?id=9193459) |
| [advisory.txt](/attachment.cgi?id=9204095)  [4 years ago](#c34)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   405 bytes, text/plain |  | [Details](/attachment.cgi?id=9204095&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1678545#c0)• 4 years ago |
|  | |

Attached file
[referrer-stealing-poc.tgz](attachment.cgi?id=9189089)
— [Details](attachment.cgi?id=9189089&action=edit)

I discovered this issue while studying the Referrer-Policy standard (<https://w3c.github.io/webappsec-referrer-policy/>).

This seems to be caused by a wrong implementation of the standard, more in particular for what concerns the combination of "8.2. Set request’s referrer policy on redirect" and "8.3. Determine request’s Referrer".

If a server (also third-party ones) replies with a redirect response including a referrer-policy response header, it seems that, when computing the new referrer value for the redirected request, Firefox uses the document's URL as referrerSource, instead of the previously computed referrer value for the original request (which may even be "no-referrer"). This is in contrast with what the standard specifies and leads to this vulnerability.

You can find more details in the attached PoC's README.md file.

I verified this issue on both Firefox 78.5.0esr and latest Firefox Nightly 85.0a1.

Flags: sec-bounty?

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a105_674618)• 4 years ago |

Summary: Full referrer URL exposed even from websites using stric referrer policies (e.g. "no-referrer" or "strict-origin-when-cross-origin") → Full referrer URL exposed even from websites using strict referrer policies (e.g. "no-referrer" or "strict-origin-when-cross-origin")

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1678545#c1)• 4 years ago |
|  | |

Not sure off-hand whether this is in DOM Security or Networking. Dragana, can you take a look or forward to someone?

Thanks!

Group: firefox-core-security → core-securityType: task → defectComponent: Security → NetworkingFlags: needinfo?(dd.mozilla)Product: Firefox → Core

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1678545#c2)• 4 years ago |
|  | |

Christoph, is this something you can look at?

Flags: needinfo?(dd.mozilla) → needinfo?(ckerschb)

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1678545#c3)• 4 years ago |
|  | |

Hello,

do you have any update on this?

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1678545#c4)• 4 years ago |
|  | |

Hello,

it's been 11 days since I reported this issue, with no feedback whatsoever until now.

Considering the simplicity of the exploit and the impact on users' security and privacy, I honestly think this does deserve some attention.

I tried my best to provide a clear explanation, root cause analysis and proof of concept code. Nonetheless I am more than willing to provide any further details that might be required.

Please let me know if I can help in any way.

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1678545#c5)• 4 years ago |
|  | |

(In reply to Luca Moretto from [comment #4](/show_bug.cgi?id=1678545#c4 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> Hello,
>
> it's been 11 days since I reported this issue, with no feedback whatsoever until now.
>
> Considering the simplicity of the exploit and the impact on users' security and privacy, I honestly think this does deserve some attention.
>
> I tried my best to provide a clear explanation, root cause analysis and proof of concept code. Nonetheless I am more than willing to provide any further details that might be required.
>
> Please let me know if I can help in any way.

Most people were out last week as there was thanksgiving and some additional time off, I'm sure Christoph has to work through a lot of backlog from that (I do) so I'd ask for a bit more patience :)

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1678545#c6)• 4 years ago |
|  | |

Oh ok sorry, being in Italy I didn't think about thanksgiving, my bad :)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1678545#c7)• 4 years ago |
|  | |

(In reply to Luca Moretto from [comment #6](/show_bug.cgi?id=1678545#c6 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> Oh ok sorry, being in Italy I didn't think about thanksgiving, my bad :)

Hey Luca, thanks for reporting and sorry for the lag of response. Anyway, from a quick glance this looks like a bug to me, though I am surprised there is no web-platform test which would catch that issue, because there are tons of redirect tests within `testing/web-platform/tests/referrer-policy`.

Anway, Dimi offered to take a look at it and will investigate - moving this over to DOM:Security so we have it on our radar.

Component: Networking → DOM: SecurityFlags: needinfo?(ckerschb) → needinfo?(dlee)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a1072280_1689)• 4 years ago |

Group: core-security → dom-core-securityKeywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1678545#c8)• 4 years ago |
|  | |

Attached file
[README.md from archive](attachment.cgi?id=9190867)
— [Details](attachment.cgi?id=9190867&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1678545#c9)• 4 years ago |
|  | |

I'm confused by the spec language -- maybe it's talking about the policy set for the top-level document and not for sub-requests. We definitely don't want a site receiving a stripped referred to redirect to itself with a ReferrerPolicy header in order to expose the referrer.

Keywords: [privacy](/buglist.cgi?keywords=privacy&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1678545#c10)• 4 years ago |
|  | |

Anne: Referrer Policy updating during redirect is called from <https://fetch.spec.whatwg.org/#http-redirect-fetch> which is used for navigation (where this makes perfect sense) but also for everything else, where it allows a recipient to unmask the referrer by using redirects. Am I reading this wrong, or should this be restricted to destination document, frame, and iframe in either the Fetch or Referrer Policy specs?

Dimi: what is Chrome doing for this? Since all the spec editors are Chrome folks maybe that will shed light on what they meant even if it's not what they wrote.

Flags: needinfo?(annevk)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1678545#c11)• 4 years ago |
|  | |

After a redirect you finally get to the non-redirecting resource itself, which can then have its own Referrer Policy (if it's a document). Why does the spec even care what kind of policy a middle-medler wants?

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1678545#c12)• 4 years ago |
|  | |

I am confused too by the fact that the spec would allow third parties to modify a request's associated referrer policy.

Anyway, I still think that the Firefox implementation differs from what the spec mandates. I tried to explain this in the "Vulnerability explanation" section of the attached README file. The key point is what information is used as "referrerSource" when (re)computing the referrer value.

When receiving a redirect response and updating the request for the new location, Firefox should use the request's originally computed referrer (if any). Instead, it seems that Firefox re-uses the document's url, and this is where the problem occurs.

My README file contains an example that strictly follows the algorithm as it is explained in the spec and highlights exactly where Firefox's implementation differs from the spec, and from other browsers like Chrome.

Even though the spec doesn't clearly state this, the only possible effect for a redirect response is to limit the amount of information in the referrer header, not to extend it. This can be verified by running my poc code against a browser like Chrome and using different referrer-policy combinations:

* if the redirect referrer-policy is stricter than the document's one, the referrer will become stricter
* if the redirect referrer-policy is looser than the document's one, the originally computed referrer (if any!) will be sent

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1678545#c13)• 4 years ago |
|  | |

Daniel, I think the bit you are missing is that the referrer is a field on the request. Initially that field has a special "client" value, but that gets overridden in 2.7 of <https://fetch.spec.whatwg.org/#concept-main-fetch> (indeed with the URL of the document in a typical case) after which it is a URL (or "no-referrer") that can stay the same or be reduced in granularity. So a redirect (by design) could not ever end up exposing more since the request does not carry that information.

(I think the reason it cares about policies from redirectors is so they can hide information from their targets. Per the specification this should also work for subresource requests, which is somewhat novel, but I think that is also intentional and therefore by design if I remember correctly. It would be good to double check with web-platform-tests as Christoph mentioned.)

Flags: needinfo?(annevk)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1678545#c14)• 4 years ago |
|  | |

It looks like a bug while handling redirects. This is how we set referrer for redirects; please correct me if I am wrong:

1. When a redirect happens, we compute the new referrer for the redirected channel [by calling CreateFromOtherAndPolicyOverride](https://searchfox.org/mozilla-central/rev/de782976bf97669f1e8edee59e7a2398154efe06/netwerk/protocol/http/HttpBaseChannel.cpp#3856-3858).
2. [In CreateFromOtherAndPolicyOverride](https://searchfox.org/mozilla-central/source/dom/security/ReferrerInfo.cpp#1043-1045), we use `OriginalReferrer` from the old channel's ReferrerInfo and the new policy from the response to compute the new referrer of the redirect request.

Because `OriginalReferrer` is not trimmed, we basically expose the URL of the original document as long as the evil server overwrites the referrer-policy with redirects. I did a quick test that with the `no-referrer` (original referrer policy) -> `unsafe-url` (redirect referrer policy) combination, we still send the full URL in the final request's referrer.

According to [spec](https://w3c.github.io/webappsec-referrer-policy/#determine-requests-referrer), we should use request’s referrer to compute the new referrer. If I understand correctly, that corresponds to `ComputedReferrer` in our [codebase](https://searchfox.org/mozilla-central/rev/de782976bf97669f1e8edee59e7a2398154efe06/dom/security/ReferrerInfo.h#436-437), so we could probably fix this by using `ComputedReferrer` instead of `OriginalReferrer` in step2.

Christoph, does this make sense to you?

Flags: needinfo?(dlee) → needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1678545#c15)• 4 years ago |
|  | |

(In reply to Dimi Lee [:dimi][:dlee] from [comment #14](/show_bug.cgi?id=1678545#c14 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> Christoph, does this make sense to you?

Yes, that seems like the root problem of the bug. I would still be curious why there is no test for that scenario. Could you please work on a fix and run the redirect web-platform tests within `testing/web-platform/tests/referrer-policy`. If there is no test stressing this behavior then I think we should add one. Thanks for looking into this!

Flags: needinfo?(ckerschb)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a1224602_468232)• 4 years ago |

Assignee: nobody → dleeStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a1228610_363267)• 4 years ago |

Severity: -- → S2Priority: -- → P2Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][domsecurity-active]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a1695201_1689)• 4 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1678545#c16)• 4 years ago |
|  | |

Daniel, may I kindly ask why this was only labelled as `sec-moderate`?

Based on the severity ratings criteria (<https://wiki.mozilla.org/Security_Severity_Ratings/Client#Severity_Ratings>) I'd expect this to be at least marked as `sec-high`. In my opinion, this vulnerability:

* can disclose sensitive user data, which may allow to uniquely identify the user (in fact you also marked it as `csectype-disclosure`): this does not only impact privacy, but also security, as stated in the spec (<https://w3c.github.io/webappsec-referrer-policy/#intro-security>) (e.g. URL based session identifiers or capability URLs)
* can disclose the browsing history: consider for instance if a service like fonts.googleapis.com decided to exploit it. Since the service is used by quite a lot of websites, it is easy to imagine how user's browsing history may be exposed
* is exceptionally easy to exploit: it only requires just a simple redirect response with a referrer-policy header. This may even cause it to be marked as `sec-critical`
Flags: needinfo?(dveditz)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1678545#c17)• 4 years ago |
|  | |

Attached file
[Bug 1678545 - P1. Use previously computed referrer as the original referrer in ReferrerInfo::CreateFromOtherAndPolicyOverride r=ckerschb](attachment.cgi?id=9192404)
— [Details](attachment.cgi?id=9192404&action=edit)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1678545#c18)• 4 years ago |
|  | |

Attached file
[Bug 1678545 - P2. Add a WPT to verify the referrer header is sent correctly r=ckerschb](attachment.cgi?id=9192405)
— [Details](attachment.cgi?id=9192405&action=edit)

Depends on D99358

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1678545#c19)• 4 years ago |
|  | |

It's not going to be `sec-critical` -- that's used for attacks the compromise the user's local machine or sometimes data.

`sec-moderate` might be wrong (and there's opportunity for more developers to chime in), but my starting point is that by default the web shares referrers everywhere by default. Referrer-Policy is a relatively new mitigation that sites are mostly using for privacy, not security. It's disclosing the website's data (about the user) rather than information from the user (that is, stored in Firefox) and it's not a Same-Origin-Policy bypass that gets you arbitrary data from the other website. It's a bypass for an opt-in mitigation feature and we typically cap those at `sec-moderate`.

Flags: needinfo?(dveditz)

|  | [Luca Moretto](/user_profile?user_id=674618)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1678545#c20)• 4 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #19](/show_bug.cgi?id=1678545#c19 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> It's not going to be `sec-critical` -- that's used for attacks the compromise the user's local machine or sometimes data.
>
> `sec-moderate` might be wrong (and there's opportunity for more developers to chime in), but my starting point is that by default the web shares referrers everywhere by default. Referrer-Policy is a relatively new mitigation that sites are mostly using for privacy, not security. It's disclosing the website's data (about the user) rather than information from the user (that is, stored in Firefox) and it's not a Same-Origin-Policy bypass that gets you arbitrary data from the other website. It's a bypass for an opt-in mitigation feature and we typically cap those at `sec-moderate`.

I must disagree with the fact that referrers are always shared by default. Being, as you say, a relatively new feature, some/many websites will fallback to using the user agent's default policy. Firefox uses `no-referrer-when-downgrade` by default, which at least prevents referrer sharing when navigating from https to http. This vulnerability also affects the default policy, resulting in the transmission of full https referrers unencrypted, visible not only to the malicious site but to anything/anyone in between.

Also, please note that the spec mandates to use the more secure `strict-origin-when-cross-origin` (<https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-strict-origin-when-cross-origin>) as default policy, and this is another point where Firefox (at least the versions I tried) differs from the spec.

For what concerns privacy vs. security, I think that the spec clearly suggests that website owners can rely on referrer-policy for security reasons (e.g. to include session identifiers in the URL, <https://w3c.github.io/webappsec-referrer-policy/#intro-security> ). As a consequence, I think it's Firefox's responsibility to respect the spec, and that failing to do so is a security vulnerability.

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1678545#c21)• 4 years ago |
|  | |

(The new default is a very recent change to the specification and is being tracked by [bug 1589074](/show_bug.cgi?id=1589074 "RESOLVED FIXED - Set referrer policy default to strict-origin-when-cross-origin").)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1678545#c22)• 4 years ago |
|  | |

Hi Dan,

The patch for the sec-moderate bug is r+ and we would like to land the patch. Do you have any concern, or can I just land the patch? Thanks!

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1678545#c23)• 4 years ago |
|  | |

Dimi: there are no special concerns about landing a patch for a sec-moderate bug in general. If your own gut feeling tells you a particular bug is more sensitive than the typical sec-moderate please do trust that feeling and ask for a 2nd opinion, but I have no concerns here that would require special handling. <https://firefox-source-docs.mozilla.org/bug-mgmt/processes/security-approval.html>

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1678545#c24)• 4 years ago |
|  | |

(In reply to Luca Moretto from [comment #20](/show_bug.cgi?id=1678545#c20 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> I must disagree with the fact that referrers are always shared by default.

Not "always", but "by default" that's what happens most of the time on the web since the 90s.

> This vulnerability also affects the default policy, resulting in the transmission of full https referrers unencrypted, visible not only to the malicious site but to anything/anyone in between.

Yes, no one is saying this is not a security problem.

> Also, please note that the spec mandates to use the more secure strict-origin-when-cross-origin

Browser vendors are cooperating to make the web a safer place than the defaults established in the 90s. We're not there yet, though, so a bug that mostly reverts people to an older state is unfortunate but it's not malware-installing unfortunate. As expectations rise (measured in years) this kind of failure would be likely considered more harshly.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1678545#c25)• 4 years ago |
|  | |

This had landed:

<https://hg.mozilla.org/integration/autoland/rev/2fc34c84a4e0e072842fbfc73ed374fb5caebd59>

<https://hg.mozilla.org/integration/autoland/rev/c3e0e7b4ef43e90d37d11dfd4c6561d648229eb7>

Backed out for mochitest failures at test\_referrer\_redirect.html:

<https://hg.mozilla.org/integration/autoland/rev/42be1816b3857a3962cd0ec4be551830b6639aee>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&selectedTaskRun=W7d57f_HQY6l49ZBSIA62Q.1&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&revision=c3e0e7b4ef43e90d37d11dfd4c6561d648229eb7>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=324659336&repo=autoland>

[task 2020-12-16T08:58:53.643Z] 08:58:53 INFO - TEST-PASS | dom/security/test/referrer-policy/test\_referrer\_redirect.html | no-referrer-with-no-meta-origin-RP-header tests have to be performed.

[task 2020-12-16T08:58:53.644Z] 08:58:53 INFO - Buffered messages finished

[task 2020-12-16T08:58:53.645Z] 08:58:53 INFO - TEST-UNEXPECTED-FAIL | dom/security/test/referrer-policy/test\_referrer\_redirect.html | no-referrer (img/iframe) with no meta, origin Referrer-Policy redirect header --- none () - got "none", expected "origin"

[task 2020-12-16T08:58:53.645Z] 08:58:53 INFO - SimpleTest.is@SimpleTest/SimpleTest.js:500:14

[task 2020-12-16T08:58:53.646Z] 08:58:53 INFO - onload@dom/security/test/referrer-policy/referrer\_helper.js:52:7

[task 2020-12-16T08:58:53.646Z] 08:58:53 INFO - doXHR/xhr.onload@dom/security/test/referrer-policy/referrer\_helper.js:35:14

[task 2020-12-16T08:58:53.888Z] 08:58:53 INFO - {"origin-with-no-meta-no-referrer-RP-header":{"referrer":"","policy":"none","expected":null}}

Flags: needinfo?(dlee)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1678545#c26)• 4 years ago |
|  | |

Attached file
[Bug 1678545 - P3. Fix test\_referrer\_redirect failures r=ckerschb](attachment.cgi?id=9193459)
— [Details](attachment.cgi?id=9193459&action=edit)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1678545#c27)• 4 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/584335a0cc1f5015d26d488938c1c6ef6de4d0a4>

<https://hg.mozilla.org/integration/autoland/rev/2246b7b99f0f334084ae8898d433c75234f23aa5>

<https://hg.mozilla.org/integration/autoland/rev/756db199e7a1d1e8b5a4199ea2f866cf3c579f22>

<https://hg.mozilla.org/mozilla-central/rev/584335a0cc1f>

<https://hg.mozilla.org/mozilla-central/rev/2246b7b99f0f>

<https://hg.mozilla.org/mozilla-central/rev/756db199e7a1>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 4 years ago
[status-firefox86](/buglist.cgi?f1=cf_status_firefox86&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 86 Branch

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a2335242_468232)• 4 years ago |

Flags: needinfo?(dlee)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a2456442_75935)• 4 years ago |

[status-firefox83](/buglist.cgi?f1=cf_status_firefox83&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox83&o1=equals&v1=wontfix)
[status-firefox84](/buglist.cgi?f1=cf_status_firefox84&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=wontfix)
[status-firefox85](/buglist.cgi?f1=cf_status_firefox85&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)
[tracking-firefox85](/buglist.cgi?f1=cf_tracking_firefox85&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox85&o1=equals&v1=%2B)
[tracking-firefox86](/buglist.cgi?f1=cf_tracking_firefox86&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox86&o1=equals&v1=%2B)
[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
--- → [85+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=85%2B)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1678545#c28)• 4 years ago |
|  | |

The patch landed in nightly and beta is affected.

:dimi, is this bug important enough to require an uplift?

If not please set `status_beta` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(dlee)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1678545#c29)• 4 years ago |
|  | |

given that we are still investigating whether [Bug 1678545](/show_bug.cgi?id=1678545 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")") is really a regression of this bug and people will be out next week.

I think we should not uplift the patch at this point.

[status-firefox85](/buglist.cgi?f1=cf_status_firefox85&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix)Flags: needinfo?(dlee)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1678545#c30)• 4 years ago |
|  | |

(In reply to Dimi Lee [:dimi][:dlee] from [comment #29](/show_bug.cgi?id=1678545#c29 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> given that we are still investigating whether [Bug 1678545](/show_bug.cgi?id=1678545 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")") is really a regression of this bug [...]

That's *this* bug -- which bug is the possible regression?

Flags: sec-bounty?Flags: sec-bounty+Flags: needinfo?(dlee)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1678545#c31)• 4 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #30](/show_bug.cgi?id=1678545#c30 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> (In reply to Dimi Lee [:dimi][:dlee] from [comment #29](/show_bug.cgi?id=1678545#c29 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))
>
> > given that we are still investigating whether [Bug 1678545](/show_bug.cgi?id=1678545 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")") is really a regression of this bug [...]
>
> That's *this* bug -- which bug is the possible regression?

ah, it should be [Bug 1683605](/show_bug.cgi?id=1683605 "RESOLVED INVALID - 7.91 - 7.93% tp5o_scroll (windows10-64-shippable-qr) regression on push 756db199e7a1d1e8b5a4199ea2f866cf3c579f22 (Wed December 16 2020)"), which has been confirmed that it is not related to this bug.

Flags: needinfo?(dlee)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a4079203_553429)• 4 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?][domsecurity-active] → [reporter-external] [client-bounty-form] [verif?][domsecurity-active][post-critsmash-triage]

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a4166279_468232)• 4 years ago |

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1678545#c32)• 4 years ago |
|  | |

I tried to reproduce the initial issue using the steps from README.md file in order to verify that this is fixed, but unfortunately I got stuck when accessing secure.com after adding two dummy certificates made and saved in **<project dir>/secure\_privkey.pem | secure\_fullchain.pem | ref-stealing\_privkey.pem and ref-stealing\_fullchain.pem**, I get Unable to connect page.

Is there something I am missing maybe (all other prerequisites were successfully done)?

Does these certificates need to have something special? The certificates were made with: `openssl genrsa -des3 -out myCA.key 2048` and `openssl req -x509 -new -nodes -key myCA.key -sha256 -days 1825 -out myCA.pem`

Flags: needinfo?(dlee)

|  | [Dimi Lee [:dimi]](/user_profile?user_id=468232)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1678545#c33)• 4 years ago |
|  | |

(In reply to Bogdan Maris [:bogdan\_maris], Release Desktop QA from [comment #32](/show_bug.cgi?id=1678545#c32 "RESOLVED FIXED - Full referrer URL exposed even from websites using strict referrer policies (e.g. \"no-referrer\" or \"strict-origin-when-cross-origin\")"))

> Does these certificates need to have something special? The certificates were made with: `openssl genrsa -des3 -out myCA.key 2048` and `openssl req -x509 -new -nodes -key myCA.key -sha256 -days 1825 -out myCA.pem`

Sorry for the late reply.

I think you'll still have do the following after creating the CA certificate

1. Import myCA.pem with Firefox by Preferences->View Certificates->Authorities->Import
2. create certificate and private key for `secure.com` & `ref-stealing.com`

   ex.

   create certificate request for secure.com: `openssl req -new -nodes -newkey rsa:4096 -keyout secure.key -out secure.req -batch -subj "/C=DE/ST=Berlin/L=Berlin/O=Dimi CA/OU=router/CN=secure.com" -reqexts SAN -config <(cat /etc/ssl/openssl.cnf <(printf "[SAN]\nsubjectAltName=DNS:secure.com,IP:127.0.0.1"))`

   create certificate for secure.com: `openssl x509 -req -in secure.req -CA myCA.crt -CAkey myCA.key -CAcreateserial -out secure.crt -days 3650 -sha256 -extfile <(printf "subjectAltName=DNS:secure.com,IP:127.0.0.1")`

if you still have any question, you can send me a mail or find me on slack

Flags: needinfo?(dlee)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a5133619_580382)• 4 years ago |

[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
[85+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=85%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=-)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a7764505_578488)• 4 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][domsecurity-active][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][domsecurity-active][post-critsmash-triage][adv-main86+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1678545#c34)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9204095)
— [Details](attachment.cgi?id=9204095&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a7850001_578488)• 4 years ago |

Alias: CVE-2021-23971

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a31793599_1689)• 3 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1678545#a111230565_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1678545&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Luca Moretto](/user_profile?user_id=674618)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_833258de_20250115_084037.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-07

## Security Vulnerabilities fixed in Firefox 86

Announced
February 23, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 86

#### [#CVE-2021-23969: Content Security Policy violation report could have contained the destination of a redirect](#CVE-2021-23969)

Reporter
Masato Kinugawa
Impact
high
##### Description

As specified in the W3C Content Security Policy draft, when creating a violation report, "User agents need to ensure that the source file is the URL requested by the page, pre-redirects. If that’s not possible, user agents need to strip the URL down to an origin to avoid unintentional leakage." Under certain types of redirects, Firefox incorrectly set the source file to be the destination of the redirects. This was fixed to be the redirect destination's origin.

##### References

* [Bug 1542194](https://bugzilla.mozilla.org/show_bug.cgi?id=1542194)

#### [#CVE-2021-23970: Multithreaded WASM triggered assertions validating separation of script domains](#CVE-2021-23970)

Reporter
J. Ryan Stinnett
Impact
high
##### Description

Context-specific code was included in a shared jump table; resulting in assertions being triggered in multithreaded wasm code.

##### References

* [Bug 1681724](https://bugzilla.mozilla.org/show_bug.cgi?id=1681724)

#### [#CVE-2021-23968: Content Security Policy violation report could have contained the destination of a redirect](#CVE-2021-23968)

Reporter
Ademar Nowasky Junior
Impact
high
##### Description

If Content Security Policy blocked frame navigation, the full destination of a redirect served in the frame was reported in the violation report; as opposed to the original frame URI. This could be used to leak sensitive information contained in such URIs.

##### References

* [Bug 1687342](https://bugzilla.mozilla.org/show_bug.cgi?id=1687342)

#### [#CVE-2021-23974: noscript elements could have led to an HTML Sanitizer bypass](#CVE-2021-23974)

Reporter
Masato Kinugawa and Michał Bentkowski
Impact
moderate
##### Description

The DOMParser API did not properly process `<noscript>` elements for escaping. This could be used as an mXSS vector to bypass an HTML Sanitizer.

##### References

* [Bug 1528997, 1683627](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1528997%2C1683627)

#### [#CVE-2021-23971: A website's Referrer-Policy could have been be overridden, potentially resulting in the full URL being sent as a Referrer](#CVE-2021-23971)

Reporter
Luca Moretto
Impact
moderate
##### Description

When processing a redirect with a conflicting Referrer-Policy, Firefox would have adopted the redirect's Referrer-Policy. This would have potentially resulted in more information than intended by the original origin being provided to the destination of the redirect.

##### References

* [Bug 1678545](https://bugzilla.mozilla.org/show_bug.cgi?id=1678545)

#### [#CVE-2021-23976: Local spoofing of web manifests for arbitrary pages in Firefox for Android](#CVE-2021-23976)

Reporter
Muneaki Nishimura
Impact
moderate
##### Description

When accepting a malicious intent from other installed apps, Firefox for Android accepted manifests from arbitrary file paths and allowed declaring webapp manifests for other origins. This could be used to gain fullscreen access for UI spoofing and could also lead to cross-origin attacks on targeted websites.
*Note: This issue is a different issue from CVE-2020-26954 and only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1684627](https://bugzilla.mozilla.org/show_bug.cgi?id=1684627)

#### [#CVE-2021-23977: Malicious application could read sensitive data from Firefox for Android's application directories](#CVE-2021-23977)

Reporter
fatal0
Impact
moderate
##### Description

Firefox for Android suffered from a time-of-check-time-of-use vulnerability that allowed a malicious application to read sensitive data from application directories.
*Note: This issue is only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1684761](https://bugzilla.mozilla.org/show_bug.cgi?id=1684761)

#### [#CVE-2021-23972: HTTP Auth phishing warning was omitted when a redirect is cached](#CVE-2021-23972)

Reporter
Vijay Tikudave
Impact
low
##### Description

One phishing tactic on the web is to provide a link with HTTP Auth. For example `https://www.phishingtarget.com@evil.com`. To mitigate this type of attack, Firefox will display a warning dialog; however, this warning dialog would not have been displayed if evil.com used a redirect that was cached by the browser.

##### References

* [Bug 1683536](https://bugzilla.mozilla.org/show_bug.cgi?id=1683536)

#### [#CVE-2021-23975: about:memory Measure function caused an incorrect pointer operation](#CVE-2021-23975)

Reporter
Brian Carpenter of Geeknik Labs & Farm
Impact
low
##### Description

The developer page about:memory has a Measure function for exploring what object types the browser has allocated and their sizes. When this function was invoked we incorrectly called the sizeof function, instead of using the API method that checks for invalid pointers.

##### References

* [Bug 1685145](https://bugzilla.mozilla.org/show_bug.cgi?id=1685145)

#### [#CVE-2021-23973: MediaError message property could have leaked information about cross-origin resources](#CVE-2021-23973)

Reporter
Andreas Pehrson
Impact
low
##### Description

When trying to load a cross-origin resource in an audio/video context a decoding error may have resulted, and the content of that error may have revealed information about the resource.

##### References

* [Bug 1690976](https://bugzilla.mozilla.org/show_bug.cgi?id=1690976)

#### [#CVE-2021-23978: Memory safety bugs fixed in Firefox 86 and Firefox ESR 78.8](#CVE-2021-23978)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Alexis Beingessner, Tyson Smith, Nika Layzell, and Mats Palmgren reported memory safety bugs present in Firefox 85 and Firefox ESR 78.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 86 and Firefox ESR 78.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=786797%2C1682928%2C1687391%2C1687597)

#### [#CVE-2021-23979: Memory safety bugs fixed in Firefox 86](#CVE-2021-23979)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Tyson Smith, Lars T Hansen, Valentin Gosu, and Sebastian Hengst reported memory safety bugs present in Firefox 85. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 86](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1663222%2C1666607%2C1672120%2C1678463%2C1678927%2C1679560%2C1681297%2C1681684%2C1683490%2C1684377%2C1684902)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_bed394fc_20250115_084037.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **202104-10**

Multiple vulnerabilities have been found in Mozilla Firefox, the
worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **88.0** |
| Unaffected versions | >= **78.10.0**>= **88.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **88.0** |
| Unaffected versions | >= **78.10.0**>= **88.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla
project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please
review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-78.10.0"

```

All Mozilla Firefox ESR binary users should upgrade to the latest
version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-78.10.0"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-88.0"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-88.0"

```
### References

* [CVE-2021-23961](https://nvd.nist.gov/vuln/detail/CVE-2021-23961)
* [CVE-2021-23968](https://nvd.nist.gov/vuln/detail/CVE-2021-23968)
* [CVE-2021-23969](https://nvd.nist.gov/vuln/detail/CVE-2021-23969)
* [CVE-2021-23970](https://nvd.nist.gov/vuln/detail/CVE-2021-23970)
* [CVE-2021-23971](https://nvd.nist.gov/vuln/detail/CVE-2021-23971)
* [CVE-2021-23972](https://nvd.nist.gov/vuln/detail/CVE-2021-23972)
* [CVE-2021-23973](https://nvd.nist.gov/vuln/detail/CVE-2021-23973)
* [CVE-2021-23974](https://nvd.nist.gov/vuln/detail/CVE-2021-23974)
* [CVE-2021-23975](https://nvd.nist.gov/vuln/detail/CVE-2021-23975)
* [CVE-2021-23976](https://nvd.nist.gov/vuln/detail/CVE-2021-23976)
* [CVE-2021-23977](https://nvd.nist.gov/vuln/detail/CVE-2021-23977)
* [CVE-2021-23978](https://nvd.nist.gov/vuln/detail/CVE-2021-23978)
* [CVE-2021-23981](https://nvd.nist.gov/vuln/detail/CVE-2021-23981)
* [CVE-2021-23982](https://nvd.nist.gov/vuln/detail/CVE-2021-23982)
* [CVE-2021-23983](https://nvd.nist.gov/vuln/detail/CVE-2021-23983)
* [CVE-2021-23984](https://nvd.nist.gov/vuln/detail/CVE-2021-23984)
* [CVE-2021-23985](https://nvd.nist.gov/vuln/detail/CVE-2021-23985)
* [CVE-2021-23986](https://nvd.nist.gov/vuln/detail/CVE-2021-23986)
* [CVE-2021-23987](https://nvd.nist.gov/vuln/detail/CVE-2021-23987)
* [CVE-2021-23988](https://nvd.nist.gov/vuln/detail/CVE-2021-23988)
* [CVE-2021-23994](https://nvd.nist.gov/vuln/detail/CVE-2021-23994)
* [CVE-2021-23995](https://nvd.nist.gov/vuln/detail/CVE-2021-23995)
* [CVE-2021-23998](https://nvd.nist.gov/vuln/detail/CVE-2021-23998)
* [CVE-2021-23999](https://nvd.nist.gov/vuln/detail/CVE-2021-23999)
* [CVE-2021-24002](https://nvd.nist.gov/vuln/detail/CVE-2021-24002)
* [CVE-2021-29945](https://nvd.nist.gov/vuln/detail/CVE-2021-29945)
* [CVE-2021-29946](https://nvd.nist.gov/vuln/detail/CVE-2021-29946)
* [MFSA-2021-08](https://www.mozilla.org/en-US/security/advisories/mfsa2021-08/)
* [MFSA-2021-11](https://www.mozilla.org/en-US/security/advisories/mfsa2021-11/)
* [MFSA-2021-15](https://www.mozilla.org/en-US/security/advisories/mfsa2021-15/)

**Release date**

April 30, 2021

**Latest revision**

April 30, 2021: 1

**Severity**

normal

**Exploitable**

local, remote

**Bugzilla entries**

* [772305](https://bugs.gentoo.org/show_bug.cgi?id=772305)
* [778269](https://bugs.gentoo.org/show_bug.cgi?id=778269)
* [784572](https://bugs.gentoo.org/show_bug.cgi?id=784572)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


