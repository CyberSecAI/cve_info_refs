=== Content from snyk.io_6eded4bd_20250114_213849.html ===
You need to enable JavaScript to run this app.[Skip to main content](#main-content)

* Products

  Products

  + [What is Snyk?

    Developer-first security in action](/product/)
  + [Snyk Code

    Secure your code as it's written](/product/snyk-code/)
  + [Snyk Open Source

    Avoid vulnerable dependencies](/product/open-source-security-management/)
  + [Snyk Container

    Keep your base images secure](/product/container-vulnerability-management/)
  + [Snyk IaC

    Fix IaC misconfigurations in-code](/product/infrastructure-as-code-security/)
  + [Snyk AppRisk

    Reduce risk across your business](/product/snyk-apprisk/)
  + [Pricing](/plans/)

  Solutions

  + [Why Snyk?

    Modern security in a single platform](/platform/)
  + [Application security

    Build secure, stay secure](/solutions/application-security/)
  + [Software supply chain security

    Mitigate supply chain risk](/solutions/software-supply-chain-security/)
  + [Secure-AI-generated code

    AI writes, Snyk secures](/solutions/secure-ai-generated-code/)
  + [Zero-day vulnerabilities

    Fix the first day with Snyk](/solutions/zero-day-vulnerability-security/)
  + [Security Intelligence

    Comprehensive vulnerability data](/platform/security-intelligence/)

  Platform

  + [DeepCode AI

    Purpose-built security AI](/platform/deepcode-ai/)
  + [Integrations

    SDLC-spanning security](/integrations/)
  + [Code Checker

    Write better code for free](/code-checker/)

  Audience

  + [Snyk for devs

    Dev-centric info on demand](https://go.snyk.io/2024-dev-onboarding.html)
  + [Snyk for government

    Mission-informed AppSec](/government-security-solution/)
  + [Leaders handbook

    SAST essentials for genAI](/lp/securing-ai-generated-code/)![default-report.b205b2e0](https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg)

  Secure Adoption in Gen AI Era Report

  [Read report](https://go.snyk.io/secure-adoption-in-genai-era.html "Read report")
* Resources

  Our resources

  + [Resource library

    Browse our extensive database](/resource-library/)
  + [Customer resources

    The one stop shop for customers](/customer-resources/)
  + [Ethical hacking

    How ethical hacking can help you](/ethical-hacking-resources/)
  + [Security leaders

    Insights from industry leaders](/security-leaders/)
  + [Top 10 vulns

    See the most common vuln types](/snyk-top-10/)
  + [Blog Section](/blog/)
  + [Snyk's podcasts](/podcasts/the-secure-developer/)
  + [Snyk’s YouTube](https://www.youtube.com/snyksec)

  Our ecosystem

  + [Snyk Learn

    Security education from Snyk](https://learn.snyk.io)
  + [Snyk user docs

    Get started with Snyk](https://docs.snyk.io/)
  + [Snyk Support

    How can we help?](https://support.snyk.io/hc/en-us)
  + [Snyk Vuln Database

    Find new vulnerabilities](https://security.snyk.io/)
  + [Snyk Updates

    Stay in the loop](https://updates.snyk.io/)

  Our community

  + [Events & webinars](/events/)
  + [Ambassadors](/snyk-ambassadors/)
  + [Discord channel](https://snyk.co/discordcommunity)![feature-snyk-snowflake](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&w=2560&q=75)

  Extend the power of your AppSec data with the new Snyk and Snowflake integration

  [Read blog](/blog/snyk-snowflake-data-share/ "Read blog")
* Company

  Company

  ## The developer security platform

  Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

  [More about us](/about/ "More about us")
  + [Our services

    Maximize your AppSec ROI](/services/)
  + [Our customers

    We help customers save time and money](/customers/)
  + [Our partners

    Bringing business class security with partners](/partners/)
  + [Case studies

    Check out our customer stories and stats](/case-studies/)
  + [Newsroom

    See the latest press releases](/news/)
  + [Contact us

    Get in touch with any feedback or questions](/contact-us/)
  + [Careers

    Join Snyk today](/careers/)![Snyk_Probely](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&w=2560&q=75)

  Snyk Acquires Developer-First DAST Provider Probely

  [Read press release](/news/snyk-acquires-developer-first-dast-provider-probely/ "Read press release")
* [Pricing](/plans/)

ENSelect your languageEnglishDeutschFrançais日本語Português (BR)Login

Free and Team Plan Customers

* [Snyk

  app.snyk.io](https://app.snyk.io)

Enterprise Plan Customers

* [*🇺🇸*

  Snyk US - 1

  app.snyk.io](https://app.snyk.io)
* [*🇺🇸*

  Snyk US - 2

  app.us.snyk.io](https://app.us.snyk.io)
* [*🇪🇺*

  Snyk EU

  app.eu.snyk.io](https://app.eu.snyk.io)
* [*🇦🇺*

  Snyk AU

  app.au.snyk.io](https://app.au.snyk.io)

The region where your data is hosted follows local agreements, and it may not align with your own location. [Find out more](https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency).[Sign up](https://app.snyk.io/signup "Sign up")[Book a live demo](/schedule-a-demo/ "Book a live demo")[Snyk Blog](/blog/)
# JavaScript type confusion: Bypassed input validation (and how to remediate)

Written by: ![Alessio Della Libera](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2Falession-d-l.png&w=48&q=75)

Alessio Della Libera

![wordpress-sync/blog-feature-snyk-open-source-blue](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2Fblog-feature-snyk-open-source-blue.png&w=2560&q=75)

November 3, 2021

 0 mins read

In a previous [blog post,](/blog/type-manipulation/) we showed how type manipulation (or type confusion) can be used to escape template sandboxes, leading to [cross-site scripting](/learn/cross-site-scripting/) (XSS) or code injection vulnerabilities.

One of the main goals for this research was to explore (in the JavaScript ecosystem) how and if it is possible to bypass some security fixes or input validations with a type confusion attack (i.e by providing an unexpected input type).

We started our research by investigating how common security vulnerabilities like prototype pollution and XSS are fixed. For this task, we leveraged the data from our [Snyk Intel Vulnerability Database](https://security.snyk.io/), the largest database of open source vulnerabilities in the industry. Using this information, we were able to identify some patterns that are used by different maintainers to prevent some class of vulnerabilities.

And now it’s time to take a look at type confusion vulnerabilities. In this blog post, we aim to demonstrate common scenarios where input sanitisation and validation can be bypassed by providing an unexpected input type. We’ll also provide remediation examples or suggestions for open source maintainers who are looking to patch these kinds of input validation bypasses.

## JavaScript background

Before discussing how an array value can be used to bypass some input validations and lead to a potential security vulnerability, let's first review some fundamental concepts about how JavaScript works. They will be very helpful later, especially when we’ll discuss the prototype pollution case study.

### Comparing values: `===` and `==`

In JavaScript, there are two different operators that can be used to compare values:

* Strict equality `===`
* Loose equality `==`

One of the main differences between them is that the `===` operator always returns `false` if both the operands have different types (it does not perform any form of coercion). In the case of the `==` operator, if both operands have different types, they are first coerced to a common type and then compared. For more details on how these operators work, please refer to the official documentation of the [strict equality operator](https://tc39.es/ecma262/multipage/abstract-operations.html#sec-isstrictlyequal) and the [loose equality operator](https://tc39.es/ecma262/multipage/abstract-operations.html#sec-islooselyequal).

The following example shows this behavior:

```
1let a = "test"
2console.log(a == "test") // true
3console.log(a === "test") // true
4
5let b = ["test"]
6console.log(b == "test") // true: ["test"] is first converted to "test" and then compared
7console.log(b === "test") // false!
```

In a case where the comparison is between operands with the same value and type, both the `==` and the `===` operators return `true` (lines 2 and 3). However, in a case where we are comparing an array that has the same string representation of the other operand, it will only return `true` if the `==` operator is used. In line 6, we see the value `["test"]` is first coerced to its string representation and then compared with the other operand `"test"`. In a case where the operands have different types, the operator `===` will always return `false` (line 7).

**Note:** The above considerations hold also for the `!==` and `!=` inequality operators.

Possible ways to obtain the string representation of a value are:

* call the [`toString()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString) method (line 2)
* convert to string using the [`String`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/String) function (line 2)
* concatenate the value with an empty string using the `+` operator (line 3)

```
1let arr = ["test"]
2console.log(arr.toString() === "test") // true
3console.log(String(arr) === "test") // true
4console.log(('' + arr) === "test") // true
```

In the case of an array value, its string representation is the concatenation of its element separated by a comma.

### Property accessor

Another important feature of JavaScript is that it's possible to specify values of different types (not only strings) to access object properties when using the [bracket notation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Property_accessors#bracket_notation). If the value is not a string (or `Symbol`), it's first coerced to a string and then used to access the object property.

Let’s consider the following example:

```
1let obj = {}
2
3let prop1 = ["test"]
4obj[prop1] = 1
5console.log(prop1.toString()) // 'test'
6console.log(obj["test"]) // 1
7
8let prop2 = {} // empty object
9obj[prop2] = 2
10console.log(prop2.toString()) // [object Object]
11console.log(obj['[object Object]']) // 2
12
13let prop3 = [] // empty array
14obj[prop3] = 3
15console.log(prop3.toString()) // ''
16console.log(obj['']) // 3
```

As we can see, the key used to access a property could be of different types. On line 4, the property `["test"]` is first converted to a string (i.e `"test"` value) and the result of this operation is used as a key to access the object property. Indeed, if we use the string `"test"` at line 6, we can get the value set on line 4.

In the same way, if we use an empty object `{}` (line 9), whose string representation is `[object Object]`, to write an object value, we can then access the same value by directly using the string `[object Object]` (line 11).

### `String` and `Array` methods

There are some built-in methods that are defined on both `String` and `Array`, that have the same name. Some examples are `includes`, `indexOf`, `lastIndexOf`, etc.

Why is this relevant for this blog post? These methods behave differently, depending on the type of input on which they are called on. If one of these methods is used to validate the user input, the validation could be prone to a potential bypass if an input of different type is provided (for example an array) and no checks are performed.

The following example shows how built-in methods defined on both `String` and `Array` behave differently:

```
1let a = "<script>"
2console.log(a.includes("<script>")) // true
3console.log(a.indexOf("<")) // 0
4
5let b = ["<script>"]
6console.log(b.includes("<script>")) // true
7console.log(b.indexOf("<")) // -1
8
9let c = [["<script>"]]
10console.log(c.includes("<script>")) // false
11console.log(c.indexOf("<")) // -1
12
13console.log(a.toString() === b.toString()) // true
14console.log(b.toString() === c.toString()) // true
```

**Note:** All the values in the example (`"<script>"`, `["<script>"]`, and `[["<script>"]]`) have the same string representation.

For example, at line 3, the method that will be called is [`String.prototype.indexOf()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf). This method will check if the character `<` is in the string and then return the index of its first occurrence, otherwise it returns `-1`.

However, if the input is an array, the method that will be called is [`Array.prototype.indexOf()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf), it will check if the element `<` is in the array. Since the array has only one element (the string `"<script>"`) the function will return `-1`, preventing a possible sanitization for that character.

### JavaScript core concepts summary

Let’s summarise what we have seen that:

* If operands have different types, the `===` operator always returns `false`
* It's possible to use keys of different types to access object properties (when bracket notation is used)
* Some built-in methods defined on both `String` and `Array` types (like `indexOf` or `includes`) could behave differently depending on the type of the input

Before moving on, let's consider the following scenarios where some of the above methods are used to validate the user input.

The following check could be not enough to prevent the key `isAdmin` to be set on the object `obj` (we assume that the `prop` variable is controlled by the user):

```
1let prop = ["isAdmin"] // user controlled
2
3let obj = {}
4
5if(prop === "isAdmin") { // ["isAdmin"] === "isAdmin" -> false
6    throw new Error("Ops!");
7} else {
8    obj[prop] = true; // obj[["isAdmin"]] is equivalent to obj["isAdmin"]
9}
10
11console.log(obj["isAdmin"]) // true
```

If the `prop` value is changed to `"isAdmin"`, the above example will throw an exception.

The following is another example of “weak” check used to prevent a potential XSS by detecting if the input contains some dangerous characters:

```
1let user = ["<img src=x onerror='alert(1)'/>"] // user controlled
2
3if (user.indexOf("<") || user.indexOf(">")){
4    throw new Error("Characters not allowed!");
5}
6
7message = "Hello : " + user
8console.log(message) // Hello : <img src=x onerror='alert(1)'/>
```

It’s important to note that these bypasses are only possible under some conditions. For example, the input should come from specific sources (see next section) and no built-in methods that are defined only on `String` are called on the input, otherwise the application will return an error/exception (because they are not defined on other types).

In the following example, the method `toLowerCase()` is called on the input. Even if we have already seen that it's possible to bypass the comparison `===` with an array value, if an array is provided the application will throw an exception because the method `toLowerCase()` is only defined on strings.

```
1let prop = ["isAdmin"] // user controlled
2
3let obj = {}
4
5prop = prop.toLowerCase() // Uncaught TypeError: toLowerCase is not a function (it's only defined on String)
6
7if(prop === "isAdmin") {
8   throw new Error("Ops!");
9} else {
10   obj[prop] = true;
11 }
12
13console.log(obj["isAdmin"])
```
## How to obtain array values

At this point, you may be wondering, how can we obtain array values from remote data?

There are different ways to obtain array values:

* **Server-side:** If using the popular express framework, values from [`req.query`](https://expressjs.com/en/api.html#req.query) or `req.body` (if [`express.json()`](https://expressjs.com/en/api.html#express.json) middleware is used) can be parsed also as arrays or objects (not only strings).
* **Client-side:** Data coming from [`postMessage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) API.

### Server-side

In case of `GET` requests, if using the popular express framework and if the value is coming from `req.query`, it is possible to obtain array values using the notation `parameter[]=value`. In general, this could hold for any application that uses the [`qs`](https://www.npmjs.com/package/qs) popular library to parse the `querystring`.

In case of `POST` requests, if `express.json()` middleware is used, the request body is parsed as a JSON object.

The following express application demonstrates how it is possible to obtain array values:

```
1const express = require('express')
2const app = express()
3const port = 3000
4
5// curl -i -X GET "https://localhost:3000/test1?path[0][]=foo&path[]=bar&val=test"
6app.get('/test1', (req, res) => {
7    console.log(typeof req.query.path, req.query.path); // object [ [ 'foo' ], 'bar' ]
8    res.send('Hello World!')
9})
10
11app.use(express.json());
12
13// curl -i -H "Content-Type: application/json" -X POST --data '{"path":[["foo"], "bar"], "val":"test"}' "https://localhost:3000/test2"
14app.post('/test2', (req, res) => {
15    console.log(typeof req.body.path, req.body.path); // object [ [ 'foo' ], 'bar' ]
16    res.send('Hello World!')
17})
18
19app.listen(port, () => {
20    console.log(`App listening at https://localhost:${port}`)
21})
```
### Client-side

Data coming from `postMessage`API could also be of different types (not only strings):

```
1<!DOCTYPE html>
2<html>
3<head>
4<meta charset="UTF-8">
5</head>
6<body>
7  postMessage example
8  <script>
9      window.addEventListener('message', function(event) {
10          let name = event.data.name
11          console.log(typeof name, name)
12      });
13  </script>
14</body>
15</html>
```

In order to test the above code, open the browser developer console and run: `window.postMessage({name: ["array"]}, "*")`. You should get the following output:

![wordpress-sync/blog-type-confustion-bypass-validation](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Ff_auto%2Fq_auto%2Fv1646608081%2Fwordpress-sync%2Fblog-type-confustion-bypass-validation.jpg&w=2560&q=75)
## Outcomes

As part of this research, some of the issues that we found and disclosed are:

| **Module** | **Vulnerability** | **Snyk Advisory** | **CVE** |
| --- | --- | --- | --- |
| object-path | Prototype Pollution | [https://snyk.io/vuln/SNYK-JS-OBJECTPATH-1569453](/vuln/SNYK-JS-OBJECTPATH-1569453/) | CVE-2021-23434 |
| immer | Prototype Pollution | [https://snyk.io/vuln/SNYK-JS-IMMER-1540542](/vuln/SNYK-JS-IMMER-1540542/) | CVE-2021-23436 |
| mpath | Prototype Pollution | [https://snyk.io/vuln/SNYK-JS-MPATH-1577289](/vuln/SNYK-JS-MPATH-1577289/) | CVE-2021-23438 |
| set-value | Prototype Pollution | [https://snyk.io/vuln/SNYK-JS-SETVALUE-1540541](/vuln/SNYK-JS-SETVALUE-1540541/) | CVE-2021-23440 |
| edge.js | Cross-site Scripting (XSS) | [https://snyk.io/vuln/SNYK-JS-EDGEJS-1579556](/vuln/SNYK-JS-EDGEJS-1579556/) | CVE-2021-23443 |
| jointjs | Prototype Pollution | [https://snyk.io/vuln/SNYK-JS-JOINTJS-1579578](/vuln/SNYK-JS-JOINTJS-1579578/) | CVE-2021-23444 |
| datatables.net | Cross-site Scripting (XSS) | [https://snyk.io/vuln/SNYK-JS-DATATABLESNET-1540544](/vuln/SNYK-JS-DATATABLESNET-1540544/) | CVE-2021-23445 |
| teddy | Cross-site Scripting (XSS) | [https://snyk.io/vuln/SNYK-JS-TEDDY-1579557](/vuln/SNYK-JS-TEDDY-1579557/) | CVE-2021-23447 |

We responsibly contact several maintainers (privately), following our [Vulnerability Disclosure](https://support.snyk.io/hc/en-us/articles/360005933037-Snyk-open-source-packages-disclosure-policy) (some findings are still under the disclosure process).

Most importantly, we want to thank all the maintainers we contacted for their time.

In the next case studies, we are going to explain how it was possible to bypass a prototype pollution fix and XSS input validation by providing array values.

## Case study: Prototype pollution in `object-path`

[`object-path`](https://www.npmjs.com/package/object-path) is a library used to access deep properties using a path. The library also accepts an array path, which means that it is possible to provide paths in the form of `['part1', 'part2', etc.]`. This library was already vulnerable to a prototype pollution vulnerability ([CVE-2020-15256](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15256)). The [fix](https://github.com/mariocasciaro/object-path/commit/2be3354c6c46215c7635eb1b76d80f1319403c68) introduced is the following:

```
1if (options.includeInheritedProps && (currentPath === '__proto__' ||
2  (currentPath === 'constructor' && typeof currentValue === 'function'))) {
3  throw new Error('For security reasons, object\'s magic properties cannot be set')
4}
```

This fix correctly throws an exception when the path has one of those dangerous components (and they are strings). Indeed, with the following payload, the function will throw an error:

```
1const objectPath = require('object-path');
2
3objectPath.withInheritedProps.set({}, ['__proto__', 'polluted'], 'yes');
4console.log(polluted); // Error: For security reasons, object's magic properties cannot be set
```

However, as we have seen before:

* Any key type can be used when the bracket notation is used to access object properties
* The `===` operator returns `false` if the type of the operands is different. The condition `currentPath === '__proto__'` will return `false` if `currentPath` is `['__proto__']`  (the same holds for `constructor`).

This means that wrapping the dangerous key in an array with just one element (the key itself) will bypass the fix and will still lead to prototype pollution:

```
1const objectPath = require('object-path');
2
3objectPath.withInheritedProps.set({}, [['__proto__'], 'polluted'], 'yes');
4console.log(polluted); // yes
```
### Remediation

Snyk contacted the maintainer privately on the 25th of August 2021 and the issue was promptly fixed on the 27th of August 2021 in `v0.11.6`. The [fix](https://github.com/mariocasciaro/object-path/commit/7bdf4abefd102d16c163d633e8994ef154cab9eb) introduced prevents this scenario by converting the path components to a string (if they are not different from number or string type) before being checked:

```
1var currentPath = path[0];
2if (typeof currentPath !== 'string' && typeof currentPath !== 'number') {
3  currentPath = String(currentPath)
4}
5var currentValue = getShallowProperty(obj, currentPath);
6if (options.includeInheritedProps && (currentPath === '__proto__' ||
7  (currentPath === 'constructor' && typeof currentValue === 'function'))) {
8  throw new Error('For security reasons, object\'s magic properties cannot be set')
9}
```

The previous payload will not work anymore:

```
1const objectPath = require('object-path');
2
3objectPath.withInheritedProps.set({}, [['__proto__'], 'polluted'], 'yes');
4console.log(polluted); // Error: For security reasons, object's magic properties cannot be set
```
## Case Study: Cross-Site Scripting (XSS) in edge.js

[`edge.js`](https://www.npmjs.com/package/edge.js) is a Node.js templating engine. This library has built-in functionalities that can be enabled to prevent security vulnerabilities, like for example XSS. In particular, according to the [documentation](https://docs.adonisjs.com/reference/views/globals/safe#document) ”*the output of interpolation (the code inside the curly braces) is HTML escaped to avoid XSS attacks”*. The original function responsible for escaping HTML dangerous characters to prevent XSS is the following:

```
1// https://github.com/edge-js/edge/blob/1ade7fbb81fbc1b52757650214d6baca140d3eb0/src/Template/index.ts#L183
2public escape<T>(input: T): T extends SafeValue ? T['value'] : T {
3  return typeof input === 'string'
4    ? string.escapeHTML(input)
5    : input instanceof SafeValue
6    ? input.value
7    : input
8}
```

As we can see, the `input` is HTML-escaped only if it is of type `string`. That means, if the user controlled input is of type object (i.e an array) and not a `SafeValue`, even if `{{ }}` are used in the template, it is returned without being escaped (with no error or exceptions returned) and thus leading to a potential XSS vulnerability.

To demonstrate how this can be exploited, let's consider the following web application that uses this library as a template engine to render user-controlled value in a template:

```
1const express = require('express')
2const app = express()
3const port = 3000
4const { join } = require('path')
5const edge = require('edge.js').default
6
7edge.mount(join(__dirname, 'views'))
8
9// curl -i -X GET "https://localhost:3000/test?name[]=%3Cimg%20src=x%20onerror=%27alert(1)%27%20/%3E"
10app.get('/test', (req, res) => {
11    let n = req.query.name
12
13    console.log(typeof n, n);
14
15    edge.render('welcome', {
16      greeting: n
17    }).then(html => res.send(html))
18})
19
20app.listen(port, () => {
21    console.log(`App listening at https://localhost:${port}`)
22})
```

The content of the file `views/welcome.edge` is the following:

```
1<p> {{ greeting }} </p>
```

As we have seen before, data coming from particular sources could also be of different types. By browsing the URL `http://localhost:3000/test?name=%3Cimg%20src=x%20onerror=%27alert(1)%27%20/%3E` the function escapes the input. However, by browsing this other URL (note the parentheses `[]`) `http://localhost:3000/test?name[]=%3Cimg%20src=x%20onerror=%27alert(1)%27%20/%3E`  it is possible to trigger an XSS because the `req.query.name` parameter will be parsed as an array and thus it will be not escaped.

### Remediation

Snyk contacted the maintainer privately on the 1st of September 2021 and the issue was promptly fixed in `v5.3.2`.  The [fix](https://github.com/edge-js/edge/commit/fa2c7fde86327aeae232752e89a6e37e2e469e21) introduced addresses this scenario by escaping all the input that are not of type `SafeValue`:

```
1export function escape(input: any): string {
2  return input instanceof SafeValue ? input.value : string.escapeHTML(String(input))
3}
4
```

Potential alternative ways of preventing such scenarios is to convert the input to a string before the escaping (and thus avoiding checking the type of the input like in the case above) or return an empty string (or an error message) if the type of the input is not a string.

## Takeaways for...

### Developers

When using the `===` operator to perform some sanitization it’s important to make sure that both the operands have the same type. In case of input escaping, it’s also important to make sure to handle the case when the input is not of type string (especially if it is not documented how the function behaves in case of non-string values) .

### Maintainers

If a function/API is responsible for input sanitization and the type of the input is not handled, it is worth documenting this behavior so as to avoid confusing users, as the maintainer may handle some sanitisation issues (like escaping the input if it is a string) but not others (handling the case when the input is not a string).

### Security researchers

We focused our attention on prototype pollution and XSS vulnerabilities, but we do believe there could also be other cases/scenarios where this attack vector can be used to bypass existing sanitizations and lead to potential security issues. If you find similar issues (or any other security vulnerability) in an open source project supported by our programme, feel free to submit to us using the [Snyk Vulnerability Disclosure form](/vulnerability-disclosure/).

## References

* Prototype Pollution: [Arteau, Oliver. “JavaScript prototype pollution attack in NodeJS application.” GitHub, 26 May 2018](https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf)
* [You Don't Know JS: Types & Grammar - Chapter 4: Coercion](https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/types%20%26%20grammar/ch4.md)

## Get started in capture the flag

Learn how to solve capture the flag challenges by watching our virtual 101 workshop on demand.

[Watch now](https://go.snyk.io/240418_ctf-101-workshop.html "Watch now")Posted in:[Vulnerability Insights](/blog/?topic=vulnerability-insights)[Open Source Security](/blog/?topic=open-source-security)[Application Security](/blog/?topic=application-security)![wordpress-sync/blog-feature-snyk-open-source-blue](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1530707820%2Fwordpress-sync%2Fblog-feature-snyk-open-source-blue.png&w=2560&q=75)
### Guide to Choosing a SAST Solution

See the process for assessing, selecting, and implementing a modern SAST solution based on a four phase process and find the best fit for your specific security needs.

[See the guide](https://go.snyk.io/SAST-buyers-guide.html "See the guide")
## Products & Solutions

* [What is Snyk?](/product/)
* [Developer Security Platform](/platform/)
* [Pricing](/plans/)
## Our Resources

* [Resource library](/resource-library/)
* [Blog](/blog/)
* [Snyk’s podcasts](/podcasts/the-secure-developer/)
## Our Ecosystem

* [Snyk Learn](/platform/learn/)
* [Snyk User Docs](https://docs.snyk.io/)
* [Snyk Support](https://support.snyk.io/hc/en-us)
* [Snyk Vuln Database](https://security.snyk.io/)
* [Snyk Updates](https://updates.snyk.io/)
* [Snyk Trust Center](https://trust.snyk.io/home)
## Company & Community

* [About Snyk](/about/)
* [Contact us](/contact-us/)
* [Book a demo](/schedule-a-demo/)
* [Careers](/careers/)
* [Events & webinars](/events/)
* [Ambassadors](/snyk-ambassadors/)
## Why Snyk

* [Snyk With GitHub](/comparison/github-and-snyk/)
* [Snyk vs Veracode](/comparison/snyk-vs-veracode/)
* [Snyk vs Checkmarx](/comparison/snyk-vs-checkmarx/)
* [Snyk vs Synopsys](/comparison/snyk-vs-synopsys/)

## The developer security platform

Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

[More about us](/about/ "More about us")

© 2025 Snyk Limited
Registered in England and Wales

* [Legal terms](/policies/terms-of-service/)
* [Privacy Notice](/policies/privacy/)
* [Terms of use](/policies/website-terms-of-use/)
* [California residents: do not sell my information](https://preferences.snyk.io/dont_sell)


=== Content from github.com_049e72ac_20250114_213847.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstrikeentco%2Fset%2Fcommit%2Fb2f942c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstrikeentco%2Fset%2Fcommit%2Fb2f942c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=strikeentco%2Fset)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[strikeentco](/strikeentco)
/
**[set](/strikeentco/set)**
Public

* [Notifications](/login?return_to=%2Fstrikeentco%2Fset) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2Fstrikeentco%2Fset)
* [Star
   3](/login?return_to=%2Fstrikeentco%2Fset)

* [Code](/strikeentco/set)
* [Issues
  0](/strikeentco/set/issues)
* [Pull requests
  6](/strikeentco/set/pulls)
* [Actions](/strikeentco/set/actions)
* [Projects
  0](/strikeentco/set/projects)
* [Security](/strikeentco/set/security)
* [Insights](/strikeentco/set/pulse)

Additional navigation options

* [Code](/strikeentco/set)
* [Issues](/strikeentco/set/issues)
* [Pull requests](/strikeentco/set/pulls)
* [Actions](/strikeentco/set/actions)
* [Projects](/strikeentco/set/projects)
* [Security](/strikeentco/set/security)
* [Insights](/strikeentco/set/pulse)

## Commit

[Permalink](/strikeentco/set/commit/b2f942c29652066e484436a8cb0032932f085e9a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

1.0.2

[Browse files](/strikeentco/set/tree/b2f942c29652066e484436a8cb0032932f085e9a)
Browse the repository at this point in the history

```
+ Prototype Pollution fix
+ dependencies are up to date
```

* Loading branch information

[![@strikeentco](https://avatars.githubusercontent.com/u/2401029?s=40&v=4)](/strikeentco)

[strikeentco](/strikeentco/set/commits?author=strikeentco "View all commits by strikeentco")
committed
Jan 27, 2022

1 parent
[102cc6b](/strikeentco/set/commit/102cc6b2e1d1e0c928ced87e75df759d5541ff60)

commit b2f942c

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**884 additions**
and
**924 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .travis.yml
  [.travis.yml](#diff-6ac3f79fc25d95cd1e3d51da53a4b21b939437392578a35ae8cd6d5366ca5485)
* main.js
  [main.js](#diff-58417e0f781b6656949d37258c8b9052ed266e2eb7a5163cad7b0863e6b2916a)
* package-lock.json
  [package-lock.json](#diff-053150b640a7ce75eff69d1a22cae7f0f94ad64ce9a855db544dda0929316519)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* test.js
  [test.js](#diff-13876b4beb64b9f156474dc78f9c923952a7ca210d4507b6b3135bbe244f8a60)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[.travis.yml](#diff-6ac3f79fc25d95cd1e3d51da53a4b21b939437392578a35ae8cd6d5366ca5485 ".travis.yml")

Show comments

[View file](/strikeentco/set/blob/b2f942c29652066e484436a8cb0032932f085e9a/.travis.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,7 @@ |
|  |  | language: node\_js |
|  |  | node\_js: |
|  |  | - "16" |
|  |  | - "14" |
|  |  | - "12" |
|  |  | - "10" |
|  |  | before\_script: |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[main.js](#diff-58417e0f781b6656949d37258c8b9052ed266e2eb7a5163cad7b0863e6b2916a "main.js")

Show comments

[View file](/strikeentco/set/blob/b2f942c29652066e484436a8cb0032932f085e9a/main.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,9 +1,9 @@ |
|  |  | 'use strict'; |
|  |  |  |
|  |  | /\* eslint-disable no-continue \*/ |
|  |  | /\* eslint-disable no-continue, eqeqeq \*/ |
|  |  |  |
|  |  | const isObject = (val) => typeof val === 'object' || typeof val === 'function'; |
|  |  | const isProto = (val, obj) => val === '\_\_proto\_\_' || (val === 'constructor' && typeof obj.constructor === 'function'); |
|  |  | const isProto = (val, obj) => val == '\_\_proto\_\_' || (val == 'constructor' && typeof obj.constructor === 'function'); |
|  |  | const set = (obj, parts, length, val) => { |
|  |  | let tmp = obj; |
|  |  | let i = 0; |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b2f942c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstrikeentco%2Fset%2Fcommit%2Fb2f942c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from snyk.io_4fed3a02_20250114_213852.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)

2. [Snyk Vulnerability Database](/vuln)
3. [npm](/vuln/npm)
4. @strikeentco/set
# Prototype Pollution Affecting [@strikeentco/set](/package/npm/%40strikeentco/set) package, versions **<1.0.2**

---

### Severity

 Recommended 0.0high010

CVSS assessment made by Snyk's Security Team. [Learn more](/vuln/SNYK-JS-STRIKEENTCOSET-2385945#cvss)

### Threat Intelligence

Exploit Maturity

Snyk has a proof-of-concept or detailed explanation of how to exploit this vulnerability.

Proof of conceptEPSS

The probability is the direct output of the EPSS model, and conveys an overall sense of the threat of
exploitation in the wild. The percentile measures the EPSS probability relative to all known EPSS scores.
Note: This data is updated daily, relying on the latest available EPSS model version.
Check out the EPSS
[documentation](https://www.first.org/epss/articles/prob_percentile_bins)
for more details.

**4.05% (93rd percentile)**
### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)

* Snyk ID**SNYK-JS-STRIKEENTCOSET-2385945**
* published**31 Jan 2022**
* disclosed**27 Jan 2022**
* credit**P.Adithya Srinivas, Masudul Hasan Masud Bhuiyan, Cristian-Alexandru Staicu**

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
#### Introduced: 27 Jan 2022

[CVE-2021-23497  (opens in a new tab)](https://www.cve.org/CVERecord?id=CVE-2021-23497) Common Vulnerabilities and Exposures (CVE) are common identifiers for publicly known security vulnerabilities[CWE-1321  (opens in a new tab)](https://cwe.mitre.org/data/definitions/1321.html) Common Weakness Enumeration (CWE) is a category system for software weaknesses First added by Snyk
## How to fix?

Upgrade `@strikeentco/set` to version 1.0.2 or higher.

## Overview

Affected versions of this package are vulnerable to Prototype Pollution. It allows an attacker to cause a denial of service and may lead to remote code execution.

**Note:** This vulnerability derives from an incomplete fix in <https://security.snyk.io/vuln/SNYK-JS-STRIKEENTCOSET-1038821>

## PoC:

```
const sset = require('@strikeentco/set');
let obj = {};
sset(obj, [
    ['__proto__'],
    'polluted'
], 'yes');
console.log({}.polluted)

```
## Details

Prototype Pollution is a vulnerability affecting JavaScript. Prototype Pollution refers to the ability to inject properties into existing JavaScript language construct prototypes, such as objects. JavaScript allows all Object attributes to be altered, including their magical attributes such as `__proto__`, `constructor` and `prototype`. An attacker manipulates these attributes to overwrite, or pollute, a JavaScript application object prototype of the base object by injecting other values. Properties on the `Object.prototype` are then inherited by all the JavaScript objects through the prototype chain. When that happens, this leads to either denial of service by triggering JavaScript exceptions, or it tampers with the application source code to force the code path that the attacker injects, thereby leading to remote code execution.

There are two main ways in which the pollution of prototypes occurs:

* Unsafe `Object` recursive merge
* Property definition by path

### Unsafe Object recursive merge

The logic of a vulnerable recursive merge function follows the following high-level model:

```
merge (target, source)

foreach property of source

```
if property exists and is an object on both the target and the source

  merge(target[property], source[property])

else

  target[property] = source[property]

```

```

When the source object contains a property named `__proto__` defined with `Object.defineProperty()` , the condition that checks if the property exists and is an object on both the target and the source passes and the merge recurses with the target, being the prototype of `Object` and the source of `Object` as defined by the attacker. Properties are then copied on the `Object` prototype.

Clone operations are a special sub-class of unsafe recursive merges, which occur when a recursive merge is conducted on an empty object: `merge({},source)`.

`lodash` and `Hoek` are examples of libraries susceptible to recursive merge attacks.

### Property definition by path

There are a few JavaScript libraries that use an API to define property values on an object based on a given path. The function that is generally affected contains this signature: `theFunction(object, path, value)`

If the attacker can control the value of “path”, they can set this value to `__proto__.myValue`. `myValue` is then assigned to the prototype of the class of the object.

## Types of attacks

There are a few methods by which Prototype Pollution can be manipulated:

| Type | Origin | Short description |
| --- | --- | --- |
| **Denial of service (DoS)** | Client | This is the most likely attack. DoS occurs when `Object` holds generic functions that are implicitly called for various operations (for example, `toString` and `valueOf`).  The attacker pollutes `Object.prototype.someattr` and alters its state to an unexpected value such as `Int` or `Object`. In this case, the code fails and is likely to cause a denial of service. **For example:** if an attacker pollutes `Object.prototype.toString` by defining it as an integer, if the codebase at any point was reliant on `someobject.toString()` it would fail. |
| **Remote Code Execution** | Client | Remote code execution is generally only possible in cases where the codebase evaluates a specific attribute of an object, and then executes that evaluation.**For example:** `eval(someobject.someattr)`. In this case, if the attacker pollutes `Object.prototype.someattr` they are likely to be able to leverage this in order to execute code. |
| **Property Injection** | Client | The attacker pollutes properties that the codebase relies on for their informative value, including security properties such as cookies or tokens. **For example:** if a codebase checks privileges for `someuser.isAdmin`, then when the attacker pollutes `Object.prototype.isAdmin` and sets it to equal `true`, they can then achieve admin privileges. |

## Affected environments

The following environments are susceptible to a Prototype Pollution attack:

* Application server
* Web server
* Web browser
## How to prevent

1. Freeze the prototype— use `Object.freeze (Object.prototype)`.
2. Require schema validation of JSON input.
3. Avoid using unsafe recursive merge functions.
4. Consider using objects without prototypes (for example, `Object.create(null)`), breaking the prototype chain and preventing pollution.
5. As a best practice use `Map` instead of `Object`.

### For more information on this vulnerability type:

[Arteau, Oliver. “JavaScript prototype pollution attack in NodeJS application.” GitHub, 26 May 2018](https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf)

## References

* [Github Commit](https://github.com/strikeentco/set/commit/b2f942c)
* [Snyk Blog Post](https://snyk.io/blog/remediate-javascript-type-confusion-bypassed-input-validation/)
### CVSS Scores

version 3.1
### Snyk

7.5 high

* Attack Vector (AV)

  The vulnerable component is bound to the network stack and the set of possible attackers extends beyond the other options listed below, up to and including the entire Internet. Such a vulnerability is often termed “remotely exploitable” and can be thought of as an attack being exploitable *at the protocol level* one or more network hops away (e.g., across one or more routers).

  **Network**
* Attack Complexity (AC)

  Specialized access conditions or extenuating circumstances do not exist. An attacker can expect repeatable success when attacking the vulnerable component.

  **Low**
* Privileges Required (PR)

  The attacker is unauthorized prior to attack, and therefore does not require any access to settings or files of the vulnerable system to carry out an attack.

  **None**
* User Interaction (UI)

  The vulnerable system can be exploited without interaction from any user.

  **None**

* Scope (S)

  An exploited vulnerability can only affect resources managed by the same security authority. In this case, the vulnerable component and the impacted component are either the same, or both are managed by the same security authority.

  **Unchanged**

* Confidentiality (C)

  There is no loss of confidentiality within the impacted component.

  **None**
* Integrity (I)

  There is no loss of integrity within the impacted component.

  **None**
* Availability (A)

  There is a total loss of availability, resulting in the attacker being able to fully deny access to resources in the impacted component; this loss is either sustained (while the attacker continues to deliver the attack) or persistent (the condition persists even after the attack has completed). Alternatively, the attacker has the ability to deny some availability, but the loss of availability presents a direct, serious consequence to the impacted component (e.g., the attacker cannot disrupt existing connections, but can prevent new connections; the attacker can repeatedly exploit a vulnerability that, in each instance of a successful attack, leaks a only small amount of memory, but after repeated exploitation causes a service to become completely unavailable).

  **High**
### NVD

9.8 critical
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.


