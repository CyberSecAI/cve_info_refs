=== Content from www.mozilla.org_3b796b51_20250114_194424.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-10

## Security Vulnerabilities fixed in Firefox 87

Announced
March 23, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 87

**Note**: This advisory was updated May 3, 2021 to include CVE-2021-29951 and again on June 8, 2021 to include CVE-2021-29955 - both were also fixed in this release.

#### [#CVE-2021-29955: Transient Execution Vulnerability allowed leaking arbitrary memory address](#CVE-2021-29955)

Reporter
Hany Ragab, Enrico Barberis, Herbert Bos, and Cristiano Giuffrida from the VUSec group at VU Amsterdam
Impact
high
##### Description

A transient execution vulnerability, named Floating Point Value Injection (FPVI) allowed an attacker to leak arbitrary memory addresses and may have also enabled JIT type confusion attacks. (A related vulnerability, Speculative Code Store Bypass (SCSB), did not affect Firefox.)

##### References

* [Bug 1692972](https://bugzilla.mozilla.org/show_bug.cgi?id=1692972)

#### [#CVE-2021-23981: Texture upload into an unbound backing buffer resulted in an out-of-bound read](#CVE-2021-23981)

Reporter
Abraruddin Khan and Omair
Impact
high
##### Description

A texture upload of a Pixel Buffer Object could have confused the WebGL code to skip binding the buffer used to unpack it, resulting in memory corruption and a potentially exploitable information leak or crash.

##### References

* [Bug 1692832](https://bugzilla.mozilla.org/show_bug.cgi?id=1692832)

#### [#CVE-2021-29951: Mozilla Maintenance Service could have been started or stopped by domain users](#CVE-2021-29951)

Reporter
James Forshaw
Impact
moderate
##### Description

The Mozilla Maintenance Service granted SERVICE\_START access to `BUILTIN|Users` which, in a domain network, grants normal remote users access to start or stop the service. This could be used to prevent the browser update service from operating (if an attacker spammed the 'Stop' command); but also exposed attack surface in the maintenance service.
*Note: This issue only affected Windows operating systems older than Win 10 build 1709. Other operating systems are unaffected.*

##### References

* [Bug 1690062](https://bugzilla.mozilla.org/show_bug.cgi?id=1690062)

#### [#CVE-2021-23982: Internal network hosts could have been probed by a malicious webpage](#CVE-2021-23982)

Reporter
Samy Kamkar, Ben Seri, and Gregory Vishnepolsky
Impact
moderate
##### Description

Using techniques that built on the slipstream research, a malicious webpage could have scanned both an internal network's hosts as well as services running on the user's local machine utilizing WebRTC connections.

##### References

* [Bug 1677046](https://bugzilla.mozilla.org/show_bug.cgi?id=1677046)

#### [#CVE-2021-23983: Transitions for invalid ::marker properties resulted in memory corruption](#CVE-2021-23983)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

By causing a transition on a parent node by removing a CSS rule, an invalid property for a marker could have been applied, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1692684](https://bugzilla.mozilla.org/show_bug.cgi?id=1692684)

#### [#CVE-2021-23984: Malicious extensions could have spoofed popup information](#CVE-2021-23984)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious extension could have opened a popup window lacking an address bar. The title of the popup lacking an address bar should not be fully controllable, but in this situation was. This could have been used to spoof a website and attempt to trick the user into providing credentials.

##### References

* [Bug 1693664](https://bugzilla.mozilla.org/show_bug.cgi?id=1693664)

#### [#CVE-2021-23985: Devtools remote debugging feature could have been enabled without indication to the user](#CVE-2021-23985)

Reporter
Anonymous working with Trend Micro's Zero Day Initiative
Impact
low
##### Description

If an attacker is able to alter specific about:config values (for example malware running on the user's computer), the Devtools remote debugging feature could have been enabled in a way that was unnoticable to the user. This would have allowed a remote attacker (able to make a direct network connection to the victim) to monitor the user's browsing activity and (plaintext) network traffic. This was addressed by providing a visual cue when Devtools has an open network socket.

##### References

* [Bug 1659129](https://bugzilla.mozilla.org/show_bug.cgi?id=1659129)

#### [#CVE-2021-23986: A malicious extension could have performed credential-less same origin policy violations](#CVE-2021-23986)

Reporter
Armin Ebert
Impact
low
##### Description

A malicious extension with the 'search' permission could have installed a new search engine whose favicon referenced a cross-origin URL. The response to this cross-origin request could have been read by the extension, allowing a same-origin policy bypass by the extension, which should not have cross-origin permissions. This cross-origin request was made without cookies, so the sensitive information disclosed by the violation was limited to local-network resources or resources that perform IP-based authentication.

##### References

* [Bug 1692623](https://bugzilla.mozilla.org/show_bug.cgi?id=1692623)

#### [#CVE-2021-23987: Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](#CVE-2021-23987)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Matthew Gregan, Tyson Smith, Julien Wajsberg, and Alexis Beingessner reported memory safety bugs present in Firefox 86 and Firefox ESR 78.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 87 and Firefox ESR 78.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1513519%2C1683439%2C1690169%2C1690718)

#### [#CVE-2021-23988: Memory safety bugs fixed in Firefox 87](#CVE-2021-23988)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Tyson Smith and Christian Holler reported memory safety bugs present in Firefox 86. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 87](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1684994%2C1686653)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_9cbbf91a_20250114_194423.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1692623)
* [XML](/show_bug.cgi?ctype=xml&id=1692623)

Closed
[Bug 1692623](/show_bug.cgi?id=1692623)
(CVE-2021-23986)

Opened 4 years ago
Closed 4 years ago

# Cross-origin read SOP violation by extension via search provider

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Cross-origin read SOP violation by extension via search provider

## Categories

### (Firefox :: Search, defect, P3)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Search#Search)

Search
▾

Firefox :: Search
Web search UI, default search engines and Toolkit's search service. Find-in-page bugs belong in Toolkit::Find Toolbar instead.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Search&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Search&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Search)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

3

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

87 Branch

Iteration:

87.2 - Feb 8 - Feb 21

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox87 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox87 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: arminius, Assigned: standard8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/97526b10278bf7be90be23244678debe?d=mm&size=40)  [standard8](/user_profile?user_id=112088)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/3cca6b6cc3855653ab1b17e9df3aa8e1?d=mm&size=40)  [arminius](/user_profile?user_id=526160)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/97526b10278bf7be90be23244678debe?d=mm&size=40)  [standard8](/user_profile?user_id=112088)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1694183](/show_bug.cgi?id=1694183 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider via redirect")

Dependency [tree](/showdependencytree.cgi?id=1692623&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1692623)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-other, reporter-external, sec-low, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main87+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-23986

[Keywords:](/describekeywords.cgi)

[csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main87+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a933587_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [standard8](/user_profile?user_id=112088) | [qe-verify](#c13 "4 years ago") | + |
| --- | --- | --- |
| [standard8](/user_profile?user_id=112088) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Signed extension which reads https://example.com/](/attachment.cgi?id=9203004)  [4 years ago](#c1)  [Armin Ebert [:arminius]](/user_profile?user_id=526160)   7.84 KB, application/x-xpinstall |  | [Details](/attachment.cgi?id=9203004&action=edit) |
| --- | --- | --- |
| [Bug 1692623 - When loading a search engine icon, if it is not an image/ content type then ignore it. r?mak!](/attachment.cgi?id=9203733)  [4 years ago](#c8)  [Mark Banner (:standard8)](/user_profile?user_id=112088)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9203733&action=edit) | [Review](/attachment.cgi?id=9203733) |
| [Bug 1692623 - Add tests to ensure that search engine icons which are not images are correctly ignored. r?mak!](/attachment.cgi?id=9203734)  [4 years ago](#c9)  [Mark Banner (:standard8)](/user_profile?user_id=112088)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9203734&action=edit) | [Review](/attachment.cgi?id=9203734) |
| [advisory.txt](/attachment.cgi?id=9209773)  [4 years ago](#c14)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   627 bytes, text/plain |  | [Details](/attachment.cgi?id=9209773&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1692623#c0)• 4 years ago |
|  | |

A malicious extension can read cross-origin resources by installing a specially crafted search provider and using the `browser.search` API.

This happens as the search engine manager fetches any absolute favicon URL, and converts the content to a `data:` URI which is made available to extension code, regardless of the resource's actual content type (e.g. text/html).

### Proof of concept

* Create an extension which adds a search engine via the [`chrome_settings_overrides.search_provider`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides) manifest key. Set `favicon_url` to the web resource that should be read cross-origin. The target's content-type is irrelevant.
* Use [`browser.search.get()`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/search/get) to retrieve the installed search engine.
* Base64-decode the engine's `favIconUrl` `data:` URI payload.

### Analysis

The manifest format for the favicon URL, `relativeUrl`, permits absolute URLs. In [`parent/ext-search.js#34-41`](https://searchfox.org/mozilla-central/rev/bf03edd45ee0804f382c1f05ec88a05f5d88833c/browser/components/extensions/parent/ext-search.js#34-41), only extension-relative icons are converted to `data:` URIs (`engine.iconURI.schemeIs("moz-extension") && engine.iconURI.host !== context.extension.uuid`). However, icon conversion is also done earlier in [`SearchEngine.jsm#766-813`](https://searchfox.org/mozilla-central/rev/bf03edd45ee0804f382c1f05ec88a05f5d88833c/toolkit/components/search/SearchEngine.jsm#766-813) without checking origin or content type. Hence, when `ext-search.js` queries the search service, the icons are already converted to `data:` URIs.

### Security impact

The `search` permission does not show up in the addon details ("This extension doesn’t require any permissions.") or during installation, allowing an attack to go unnoticed. But while any http[s] URL can be targeted, cookies aren't transmitted. This makes the attack most useful against e.g. local interfaces/intranet resources, but doesn't allow an attacker to trivially tap the user's current web mail session.

Flags: sec-bounty?

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1692623#c1)• 4 years ago |
|  | |

Attached file
[Signed extension which reads https://example.com/](attachment.cgi?id=9203004)
— [Details](attachment.cgi?id=9203004&action=edit)

This proof-of-concept extension fetches and displays the source of `https://example.com/` in a new tab upon startup. I attached it as a signed XPI.

`manifest.json`:

```
{
  "manifest_version": 2,
  "name": "searchprovider sop leak",
  "version": "2.0",
  "background": { "scripts": [ "background.js" ] },
  "permissions": [ "search" ],
  "chrome_settings_overrides": {
    "search_provider": {
      "name": "mysearch",
      "search_url": "https://example.com/$1",
      "favicon_url": "https://example.com/"
    }
  }
}

```

`background.js`:

```
browser.search.get().then((res) => {
    let provider = res.find(x => x.name === "mysearch")
    let source = atob(provider.favIconUrl.split(',')[1]);
    let url = URL.createObjectURL(new Blob([source], {type : 'text/plain'}));
    browser.tabs.create({url: url})
})

```

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a792_159069)• 4 years ago |

Type: task → defectComponent: Security → Request HandlingProduct: Firefox → WebExtensions

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1692623#c2)• 4 years ago |
|  | |

Thanks for the report and PoC. This bug offers the following capabilities:

* An extension can read the response of one GET request, without control over when the request is sent.
* No control over request headers, no cookies/credentials are sent in particular.
* Response bodies exceeding 20000 (`SearchUtils.MAX_ICON_SIZE`) cannot be read.
* The URL has to be hardcoded in a `manifest.json` file in a signed extension, but as redirects are followed, any http(s) URL can be read.

This is not a bug with the implementation in the extension framework, but with the search engine implementation. The resolved URL should be a valid image URL before it is stored.

Status: UNCONFIRMED → NEWComponent: Request Handling → SearchEver confirmed: trueProduct: WebExtensions → Firefox

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1692623#c3)• 4 years ago |
|  | |

I've been looking into this a bit and discussing with Johann.

We should change the search service to accept content types starting with "image/" only. The fallback would have probably been accounting for images with incorrect content types being served. This seems to be largely unnecessary now, and I just checked what appear to be the most popular servers for OpenSearch and they are either providing data uris, or urls to images which are served correctly.

That doesn't do enough to fix the cross-origin side of the issue. Whilst we can assume websites don't declare sensitive resources as favicons, I think there is still potential for data to be encoded in images for a site controlled by the add-on author.

We think that there's a few choices here:

* Remove the favicon from the `browser.search.get` API (though this may not be popular with extension authors).
* Require some sort of additional permission.
* Have the search service save the original URL as well as the data URL. Presumably the API could do cross-origin checks on the original URL, but still serve the data URL to the add-on. (Note: serving the data url, means we wouldn't be pinging the server, which is better for the user's privacy).

I think these last points really need input from the WebExtensions team. Rob, can you look at this, or redirect to whoever's appropriate?

Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1692623#c4)• 4 years ago |
|  | |

(In reply to Mark Banner (:standard8) from [comment #3](/show_bug.cgi?id=1692623#c3 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider"))

> That doesn't do enough to fix the cross-origin side of the issue. Whilst we can assume websites don't declare sensitive resources as favicons, I think there is still potential for data to be encoded in images for a site controlled by the add-on author.
>
> We think that there's a few choices here:
>
> * Remove the favicon from the `browser.search.get` API (though this may not be popular with extension authors).
> * Require some sort of additional permission.
> * Have the search service save the original URL as well as the data URL. Presumably the API could do cross-origin checks on the original URL, but still serve the data URL to the add-on. (Note: serving the data url, means we wouldn't be pinging the server, which is better for the user's privacy).
>
> I think these last points really need input from the WebExtensions team. Rob, can you look at this, or redirect to whoever's appropriate?

I don't think that further restrictions are needed once the SearchEngine implementation validates/sanitizes the image response.

The fact that the request doesn't include credentials is a mitigating factor; as a result only publicly available images can be read (except possibly for intranet URLs, which can normally not be read, but can be by this bug).

Extensions with the right permissions already have another way to read image URLs, via the `favIconUrl` property of a tab. An extension could create a page with a favicon pointing to a desired location, and the extension would be able to read it. I discussed this with my team, and it's an acceptable feature (especially because the image is already public, and presumably sanitized/shrunk).

Flags: needinfo?(rob)

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1692623#c5)• 4 years ago |
|  | |

> I don't think that further restrictions are needed once the SearchEngine implementation validates/sanitizes the image response.

I second this. Reading intranet images (without sending credentials + sufficiently small/scaled down) seems to be an acceptable risk given the various intranet fingerprinting techniques that exist already.

> Extensions with the right permissions already have another way to read image URLs, via the `favIconUrl` property of a tab.

There isn't even a permission needed. *Any* extension can read *any* (non-credentials-protected, favicon-able) cross-origin image because `moz-extension://{id}/page.html` has an implicit host permission for `{id}`, thus can do `<link rel="icon" href="https://cross-origin.example/image.png">` from `page.html` and access the remote image via its own favicon, without declaring `tabs` or any other permission.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1692623#c6)• 4 years ago |
|  | |

(In reply to Arminius (Armin Razmjou) from [comment #5](/show_bug.cgi?id=1692623#c5 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider"))

> > Extensions with the right permissions already have another way to read image URLs, via the `favIconUrl` property of a tab.
>
> There isn't even a permission needed. *Any* extension can read *any* (non-credentials-protected, favicon-able) cross-origin image because `moz-extension://{id}/page.html` has an implicit host permission for `{id}`, thus can do `<link rel="icon" href="https://cross-origin.example/image.png">` from `page.html` and access the remote image via its own favicon, without declaring `tabs` or any other permission.

This statement is true for Chromium-based browsers, but wasn't true for Firefox until recently. Prior to [bug 1679688](/show_bug.cgi?id=1679688 "RESOLVED FIXED - host permissions or <all_urls> permission should grant access to privileged parts of the tabs API"), only the "tabs" permission would allow an extension to read url/title/favIconUrl; as of Firefox 86, what you're describing is true too. But again, this is an accepted trade-off given that favicons are already presumably sanitized. If you are able to show that this is not the case (i.e. `tabs.Tab.favIconUrl` holds unsanitized & private data), please file a new bug with a test case.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1692623#c7)• 4 years ago |
|  | |

Another option may be to require the search icons to be contained in the extension. That would require some lead time to allow extensions to update, so shouldn't be considered a fix for this.

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1692623#c8)• 4 years ago |
|  | |

Attached file
[Bug 1692623 - When loading a search engine icon, if it is not an image/ content type then ignore it. r?mak!](attachment.cgi?id=9203733)
— [Details](attachment.cgi?id=9203733&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a398825_600971)• 4 years ago |

Assignee: nobody → standard8Status: NEW → ASSIGNED

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1692623#c9)• 4 years ago |
|  | |

Attached file
[Bug 1692623 - Add tests to ensure that search engine icons which are not images are correctly ignored. r?mak!](attachment.cgi?id=9203734)
— [Details](attachment.cgi?id=9203734&action=edit)

Depends on D105483

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a426410_1689)• 4 years ago |

Keywords: [csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1692623#c10)• 4 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/d8bc9d97caead4467b1f8230dbb5df37c7c1699d>

<https://hg.mozilla.org/mozilla-central/rev/d8bc9d97caea>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 4 years ago
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 87 Branch

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a550839_112088)• 4 years ago |

Severity: -- → S3Iteration: --- → 87.2 - Feb 8 - Feb 21Points: --- → 3Priority: -- → P3

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a560641_553429)• 4 years ago |

Flags: qe-verify?Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1692623#c11)• 4 years ago |
|  | |

Sorry, I wasn't in time for the patch review on Phabricator.

The patch is insufficient. The favicon target can send an `image/*` content type header plus a 30x redirect to bypass the check.

I suspect this is because `SearchEngine` holds its own reference to the channel for the favicon request which is later used to check the `contentType`.

<https://searchfox.org/mozilla-central/rev/7bb1cc6abf6634b2a20f71935e1e519e73402b63/toolkit/components/search/SearchEngine.jsm#769,794>

So when `SearchUtils.LoadListener.asyncOnChannelRedirect` follows a redirect and updates to a new channel, `SearchEngine` still checks the initial channel's content type.

<https://searchfox.org/mozilla-central/rev/7bb1cc6abf6634b2a20f71935e1e519e73402b63/toolkit/components/search/SearchUtils.jsm#86-89>

A passing response may look like this:

```
HTTP/1.1 302
Location: http://example.com/
Content-type: image/whatever
Content-length: 0

```

Hope it's fine to reopen based on that.

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a727653_575867)• 4 years ago |

[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected)

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a836060_112088)• 4 years ago |

Blocks: [1694183](/show_bug.cgi?id=1694183 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider via redirect")

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1692623#c12)• 4 years ago |
|  | |

(In reply to Arminius (Armin Razmjou) from [comment #11](/show_bug.cgi?id=1692623#c11 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider"))

> Sorry, I wasn't in time for the patch review on Phabricator.
>
> The patch is insufficient. The favicon target can send an `image/*` content type header plus a 30x redirect to bypass the check.

Thank you for commenting about that case. I've just been verifying it and it is indeed wrong. It'd also be potentially broken for images loaded from redirects regardless of the security issue.

The original fix on this bug is on 87 which has just merged to beta. For me to fix this, I'll need to land for 88 and uplift. As a result, to make it easier on tracking, I've created [bug 1694183](/show_bug.cgi?id=1694183 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider via redirect") for the redirect follow-up.

Status: REOPENED → RESOLVEDClosed: 4 years ago → 4 years ago
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a933587_1689)• 4 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1692623#c13)• 4 years ago |
|  | |

Should be able to test this with the extension and steps from [comment 0](/show_bug.cgi?id=1692623#c0 "RESOLVED FIXED - Cross-origin read SOP violation by extension via search provider").

Flags: qe-verify? → qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a2821682_578488)• 4 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main87+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1692623#c14)• 4 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9209773)
— [Details](attachment.cgi?id=9209773&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a2998710_578488)• 4 years ago |

Alias: CVE-2021-23986

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1692623#c15)• 3 years ago |
|  | |

Add tests to ensure that search engine icons which are not images are correctly ignored. r=mak

<https://hg.mozilla.org/integration/autoland/rev/16cf1f0beed1dc66a5749ad129c1c2cf8e59812d>

<https://hg.mozilla.org/mozilla-central/rev/16cf1f0beed1>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a24477969_1689)• 3 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692623#a103915151_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1692623&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Armin Ebert [:arminius]](/user_profile?user_id=526160)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


