=== Content from control-webpanel.com_e26b0d32_20250115_102831.html ===

![Loading](https://control-webpanel.com/wp-content/uploads/2019/03/cwp_logo.png)
![](https://control-webpanel.com/wp-content/uploads/2018/01/logo.png)

CWP aims at providing the best possible experience to both sys.admins, as well as end users who need an interface to interact with the server.

## Quick Links

* [Demo](https://control-webpanel.com/demo)
* [CWPpro](https://control-webpanel.com/cwppro)
* [Support Services](https://control-webpanel.com/support-services)
* [Wiki](http://wiki.centos-webpanel.com)
* [Forum](http://forum.centos-webpanel.com)
* [Docs](//docs.control-webpanel.com)
* [Contact Us](https://control-webpanel.com/contact)

FREE Download | cPanel to CWP server convert

[![Control-WebPanel [CWP]](https://control-webpanel.com/wp-content/uploads/2020/04/3d_logo_200x55.png)
![Control-WebPanel [CWP]](https://control-webpanel.com/wp-content/uploads/2020/04/3d_logo_200x55.png)](https://control-webpanel.com/)

* [Home](https://control-webpanel.com/)
* Product
  + [Features](https://control-webpanel.com/features)
  + [Demo](https://control-webpanel.com/demo)
  + [Installation Instructions](https://control-webpanel.com/installation-instructions)
  + [CWPpro](https://control-webpanel.com/cwppro)
  + [Licenses for Partners](https://control-webpanel.com/licenses-for-partners)
  + [Migration from cPanel](https://docs.control-webpanel.com/docs/admin-guide/user-accounts/cpanel-server-migration-new)
  + [Convert cPanel to CWP](http://wiki.centos-webpanel.com/cpanel-to-cwp-server-convert)
  + [CWP Secure Kernel](http://wiki.centos-webpanel.com/cwp-secure-centos-kernel)
  + [Changelog](https://control-webpanel.com/changelog)
  + [Newsletter](http://newsletter.control-webpanel.com/lists/5f2727d15a044/sign-up)
* [Support](https://control-webpanel.com/support-services)
* Resources
  + [Forum](//forum.centos-webpanel.com)
  + [Wiki (for SysAdmins)](//wiki.centos-webpanel.com)
  + [Docs (for CWP Users)](//docs.control-webpanel.com)
  + [Security Instructions](http://wiki.centos-webpanel.com/cwp-security-instructions)
  + [FreeDNS](//freedns.centos-webpanel.com)
  + [Bugs](//bugs.control-webpanel.com)
  + [Blog](https://control-webpanel.com/blog)
* [About Us](https://control-webpanel.com/about-us)
  + [Company](https://control-webpanel.com/about-us)
  + [Join Our Team](https://control-webpanel.com/join-us)
  + [Affiliate Program](https://control-webpanel.com/affiliate-program)
  + [NOC Partners](https://control-webpanel.com/noc-partner)
  + [Client Area – Login](https://support.centos-webpanel.com/clientarea.php)
  + [Future is CentOS Stream](http://wiki.centos-webpanel.com/the-future-of-centos-stream-with-cwp)
  + [Contact Us](https://control-webpanel.com/contact)
* Other
  + Billing Automation
    - [Blesta](https://docs.blesta.com/display/user/CentOS%2BWeb%2BPanel)
    - [Clientexec](https://www.clientexec.com/addons/clientexec/server/controlwebpanel)
    - [HostBill](https://hostbillapp.com/products-services/controlwebpanel/)
    - [Whmcs](http://wiki.centos-webpanel.com/whmcs-module-for-cwp-api)
    - [Wisecp](https://www.wisecp.com/en/cwp)
  + Cloud Platforms
    - [Virtualizor](https://www.virtualizor.com/docs/enduser/install-cwp-from-virtualizor/)
  + Script Auto-Installers
    - [Softaculous](https://www.softaculous.com/softaculous/)

# CHANGELOG

Current Versions: CWP6: **0.9.8.985** (EOL) / CWP7: **0.9.8.1190**

CWP for EL9 is in the **Beta stage**

CWP for CentOS 8/Almalinux 8 is the **recommended** version.

CWP7+ compatible with CentOS Stream, Alma Linux , Rocky Linux and Oracle Linux

### CWP7

CentOS 7 / 8 / 9

#### [Version 0.9.8.1188 (released 13/11/2024)](#1653233365160-9848a986-1948)

#### Admin Panel

**– New php version**

**– Fix migrations module**

#### User Panel

**– Fix reseller module**

#### [Version 0.9.8.1185 (released 13/08/2024)](#1731563679429-22b3d720-6463)

#### Admin Panel

**– No changes.**

#### User Panel

**– Fixed minor Reseller side issues.**

#### [Version 0.9.8.1182 (released 13/08/2024)](#1725550464945-5982feb3-99f5)

#### Admin Panel

**– Fix for Mongo Manager module**

**– Fixed Account Transfer Module**

**– Fixed Backup Module**

#### User Panel

**– Fixed Reseller Panel Statistics**

**– Fixed Autoresponder Issue**

**– Fixed For Centos stream 9 login**

**– Fixed Tomcat Module**

**– Fixed and Miscellaneous Security Settings**

#### [Version 0.9.8.1177 (released 11/03/2024)](#1723499673311-1382dffc-fa95)

#### Admin Panel

**– CWP maintenance release**

**– New php versions released**

**– Installer for El9**

#### User Panel

**– Maintenance release for User Account**

#### [Version 0.9.8.1173 (released 19/12/2023)](#1710826426861-d8471f6b-48a6)

#### Admin Panel

– New php versions

– Various fixes to PHP

#### User Panel

–

#### [Version 0.9.8.1172 (released 27/11/2023)](#1702936689959-1b152550-0d49)

#### Admin Panel

– New php versions

#### User Panel

–

#### [Version 0.9.8.1171 (released 16/10/2023)](#1701130805603-99063edd-5c01)

#### Admin Panel

– New php versions

#### User Panel

–

#### [Version 0.9.8.1170 (released 12/09/2023)](#1697459671577-26cdf280-30aa)

#### Admin Panel

– Improvements in the account migration process

– New fields were added to the responses of some endpoints of the APIs

#### User Panel

– Fix 2fA

– Fix in login form language

#### [Version 0.9.8.1169 (released 06/09/2023)](#1694467547847-e50a1bcb-4571)

#### Admin Panel

– Important fixes in the CWP-CWP migration module.

#### User Panel

–

#### [Version 0.9.8.1168 (released 09/08/2023)](#1693977525432-f27b1ad7-65d2)

#### Admin Panel

–

#### User Panel

– Important security fixes

#### [Version 0.9.8.1166 (released 08/08/2023)](#1691577259221-bfab0dd3-307e)

#### Admin Panel

– New PHP Versions

– Improvements in the Features module

#### User Panel

– Fixes in the side menu and dashboard

[Previous ChangelogsPrevious Changelogs](https://control-webpanel.com/previous-changelogs "Old ChangeLog")
### What’s New?

Best Features

– New File Manager Multi Language [[+ info]](https://www.youtube.com/watch?v=SxjeqhjKR4A)

– CWP-Secure Kernel [[+ info]](https://www.youtube.com/watch?v=VhX7nv44etM)

– CWP for CentOS 8 [[+ info]](http://wiki.centos-webpanel.com/the-future-of-centos-stream-with-cwp)

– Advanced IP manger for private / public IP’s

– CWP User Panel: Dark Template [[+ info]](https://www.youtube.com/watch?v=eBVnQjib2LI)

– CWP User Panel: Email Filters [[+ info]](https://www.youtube.com/watch?v=lPoXs6dLS7o)

– CWP Admin: MailServer Stats [[+ info]](https://www.youtube.com/watch?v=n-bzuhn-2n0)

– CWP SysStats SAR [[+ info]](https://www.youtube.com/watch?v=CkcS-A-BwFU)

– CWP Security Center: Mod Security Reports + Malware Scan + PHP Defender [[+ info]](https://www.youtube.com/watch?v=gJeAU7oe2nk)

– User Panel: Antivirus Scan / ClamAV [[+ info]](https://www.youtube.com/watch?v=lBHMHl_hfCY&t=67s)

– CWP Admin: NodeJS Manager [[+ info]](https://www.youtube.com/watch?v=amblG2CPMRM)

– Streaming Manager: Shoutcast + Icecast + AutoDJ

### Security

Important security patches

By Ömer Faruk Öztürk: [veomer.com](http://veomer.com)

By Octagon Networks: [octagon.net](http://octagon.net)

### Coming Soon

The Future of CWP

**– CWP compatible with CentOS 9, AlmaLinux 9 and RockyLinux 9**

– cPanel DNS Cluster Ingration

– Cluster CWP (Multi-Server Manager)

– Multi-Language and Multi-Template support for the CWP Admin panel

– Ipv6 module – full support of Ipv6 for mail server and webserver with IP management

https://control-webpanel.com/wp-content
## CWP

CWP is a modern and advanced Linux control panel for web hosting providers and system admins.

It strives to be the best panel there is in the world, by focusing on the most advanced features and security.

**Working Team**:

Passionate people around the world.

**Company**

LINANTO LLC (Georgia/Tbilisi)

## USEFULL LINKS

* **[Demo](https://control-webpanel.com/demo)**
* **[CWPpro](https://control-webpanel.com/cwppro)**
* **[Support Services](https://control-webpanel.com/support-services)**
* **[Join Our Team](https://control-webpanel.com/join-us)**
* **[Custom Development](https://control-webpanel.com/order-custom-builded-modules-for-cwp)**
* **[Services Monitor](https://control-webpanel.com/services-monitor)**
* **[Website DDOS Protection Proxy](https://control-webpanel.com/website-ddos-protection-proxy)**

## Resources

* [Forums](http://forum.centos-webpanel.com)
* [Wiki (for SysAdmins)](http://wiki.centos-webpanel.com)
* [Docs (for CWP Users)](https://docs.control-webpanel.com)
* [Installation Instructions](https://control-webpanel.com/installation-instructions)
* [Security Instructions](http://wiki.centos-webpanel.com/cwp-security-instructions)
* [CWP Secure Kernel](http://wiki.centos-webpanel.com/cwp-secure-centos-kernel)
* [Convert cPanel to CWP](http://wiki.centos-webpanel.com/cpanel-to-cwp-server-convert)
* [Migration from cPanel](https://docs.control-webpanel.com/docs/admin-guide/user-accounts/cpanel-server-migration-new)
* [CWP-CentOS 8 Stream-Delayed](http://wiki.centos-webpanel.com/the-future-of-centos-stream-with-cwp)
## Languages

![en](//control-webpanel.com/wp-content/plugins/gtranslate/flags/16/en.png)

![ar]()![zh-CN]() Chinese (Simplified)![hr]() Croatian![nl]() Dutch![en]() English![fr]() French![de]() German![it]() Italian![pt]() Portuguese![ru]() Russian![es]() Spanish

![]()

![CWP Logo](/wp-content/uploads/2020/04/3d_logo_200x55.png)

[Terms of Service](https://control-webpanel.com/terms-of-service) | [Privacy Policy](https://control-webpanel.com/privacy-policy) | [Enterprise Linux Security](https://support-site.org/)

Copyrights © 2022. All rights reserved to **CWP - Control Web Panel**

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.Ok[Privacy policy](https://control-webpanel.com/privacy-policy)



=== Content from octagon.net_d4ef149a_20250115_102840.html ===


[![](/imgs/oct.png)](https://octagon.net/blog/)
Menu

* [About](https://www.octagon.net/about)
* [Contact Us](https://www.octagon.net/contact)

# CVE-2021-45467: CWP CentOS Web Panel – preauth RCE

January 22, 2022
  |  [No Comments](https://octagon.net/blog/2022/01/22/cve-2021-45467-cwp-centos-web-panel-preauth-rce/#respond)

CentOS Web Panel or commonly known as CWP is a popular web hosting management software, used by over 200,000 unique servers, that can be found on Shodan or Census. The vulnerability chain that we used to exploit a full preauth remote command execution as root uses file inclusion (CVE-2021-45467) and file write (CVE-2021-45466) vulnerabilities. In this post we hope to cover our vulnerability research journey, and how we approached this particular target.

**Mapping out attack surface**

After hosting CWP on a local environment it quickly became evident that most features require administrative or user accounts to perform. Since we are interested only in vulnerabilities that can be exploited without user authentication or interaction, we will avoid all the restricted sections and focus our research on parts of the panel that are exposed without authentication in the webroot. Turns out, not a lot is exposed.

Some of the interesting pages that can be accessed without authentication are /user/loader.php and /user/index.php: had this interesting file inclusion protection method (/user/loader.php):

```
<?php
if(!empty($_GET["api"])) {
        if (!empty($_GET["scripts"])) {
            $_GET["scripts"] = GETSecurity($_GET["scripts"]);
            include "../../resources/admin/scripts/" . $_GET["scripts"] . ".php";
        }

```

Where GETSecurity() is defined as the following:

```
function GETSecurity($variable)
{
    if (stristr($variable, ".." ) {
        exit("hacking attempt");
    }
 }

```

if the parameter “scripts” contains “..” (two dots) then the application will not process the input and will instead exit with “hacking attempt” displayed to the user.

*stristr()* is basically the same function as strstr() in PHP except it isn’t case sensitive. Few ideas I had after looking at the code:

**Potential methods of bypassing stristr():**

1. Trick CWP to treat other characters as dot (.)

2. Find unique characters the language C processes as a dot (.) when lower cased.

3. Trick CWP into thinking there are no consecutive dots (..)

**1. Trick CWP to treat other characters as a dot:**

For the first method, after fuzzing a basic unicode range, we quickly realized CWP doesn’t have any characters that it normalizes to dots. So this path wasn’t as promising as we thought it would be.

**2. Find unique characters the language C processes as a dot when lower cased.**

The idea behind this came after wondering how stristr() does a case sensitivity check different from strstr(). PHP is written in C, so sometimes it helps to look at how the underlying functions work. And in this case, looking at php-src/ext/standard/string.c in PHP proved that stristr() is basically strstr():

```
PHPAPI char *php_stristr(char *s, char *t, size_t s_len, size_t t_len)
{
    zend_str_tolower(s, s_len);
    zend_str_tolower(t, t_len);
    return (char*)php_memnstr(s, t, t_len, s + s_len);
}
```

After looking at the code, you realize that the function takes any input and converts it to lowercase before it does the comparison. So, immediately we started fuzzing for unique unicode characters that when lowercased, might be converted to a dot. In javascript for example, the character “ſ” gets converted to “S” when capitalized: “ſ”.toUpperCase() => “S”. Unfortunately that didn’t yield any useful results but we did find some weird quirky behaviors worthy of future posts.

**3. Trick CWP into thinking there are no consecutive dots (..)**

This requires straight up fuzzing. After brainstorming a few ideas, we got this code:

![](https://lh3.googleusercontent.com/zFbyB3iYFep6TDW4U-1AnkP0N9Gzv3ufcZ3AHypoaAXkni69SshuqTyYi8QYGXyysNyUL44JJHU6bQ775F3diez7kvK80fr1T-4BDxjm7xS2aZzCY_T5RsBSDMIoaKpdeDWMbfbL)

Running the above fuzzer actually got us a bypass: which is **/.%00./**

**CVE-2021-45467**

During our tests some functions in CWP (including the require() and include() functions) seem to process /**.%00./** as /**../** – Similarly, while their stristr() ignores the null bytes, it still counts its size so it bypasses the check. We aren’t exactly sure why this happens but it could be caused by a regression to their library using something like striptags()

Now using this trick it means we can include any local file on the server. We have a full file inclusion vulnerability, and if we find a way to write to a file, we can get preauth RCE. However, this next step wasn’t as straightforward as we’d like it to be, since CWP ships with interesting unix file r/w locking settings called CWP-Secure-Kernel. The server doesn’t give us easy file write or edit permissions to logs or anywhere obviously useful.

But with our file inclusion bug, it means we can reach the restricted API section, which requires API key to access and is unreachable because it’s not exposed in the webroot. But by using our file inclusion, sending a request like the following will result in the server registering any API key we want.

GET https://CWP/user/loader.php?api=1&scripts= .%00./.%00./api/account\_new\_create&acc=guadaapi&ip=192.168.1.1&keyapi=OCTAGON

Now we have added the api key “OCTAGON” requesting from 192.168.1.1 to have access to the full API like the following:

GET https://CWP/api/?key=OCTAGON&api=add\_server is now a valid API request. When we reported this specific the vulnerability to CWP, their fix was adding the following code:

```
function GETSecurity($variable)
{

if (stristr($variable, "..") || stristr($variable, ".%00.")) {
exit("hacking attempt");
    }
}
```

**Bypass:**

.%00%00%00./.%00%00%00./api/account\_new\_create lets us reach the same file, just add as many nullbytes as you like.

**CVE-2021-45466**

Time to find a basic file write vulnerability. This wasn’t very easy, but we found we can exploit a file write bug in the API section that lets us add to a .TXT file. For example, using our maliciously added key

[https://CWP/api/?key=OCTAGON&api=add\_server&DHCP=<?=phpinfo()?>&fileFinal=/](https://cwp/api/?key=OCTAGON&api=add_server&DHCP=%3C?=phpinfo()?%3E&fileFinal=/) will now write to a file called authorized\_keys located in the /resources/ folder. Next we use our first file inclusion bug to include our malicious authorized\_keys file to get full RCE. *The file inclusion vulnerability was reported via the ZDI program and has been patched* *in CWP, but we saw some managed to reverse the patch and exploit some servers.*

So to reiterate the steps:

1. Send a null byte powered file inclusion payload to add malicious API key
2. Use API key to write to a file (CVE-2021-45466)
3. Use step #1 to include the file we just wrote into (CVE-2021-45467)
4. Woot!

We will release a full PoC for red teams that achieves preauth RCE once enough servers migrate to the latest version.

# Post navigation

[MAMP Server preauth XSS leading to Host Compromise (0day) →](https://octagon.net/blog/2022/01/26/mamp-server-preauth-xss-leading-to-host-compromise-0day/)

SearchSearch
## Recent Posts

* [Juniper SSLVPN / JunOS RCE and Multiple Vulnerabilities](https://octagon.net/blog/2022/10/28/juniper-sslvpn-junos-rce-and-multiple-vulnerabilities/)
* [Bypass CSP Using WordPress By Abusing Same Origin Method Execution](https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/)
* [CVE-2022-24990: TerraMaster TOS unauthenticated remote command execution via PHP Object Instantiation](https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/)
* [CVE-2022-24948: Apache JSPWiki preauth Stored XSS to ATO](https://octagon.net/blog/2022/03/02/apache-jspwiki-preauth-xss-to-ato/)
* [MAMP Server preauth XSS leading to Host Compromise (0day)](https://octagon.net/blog/2022/01/26/mamp-server-preauth-xss-leading-to-host-compromise-0day/)
## Archives

* [October 2022](https://octagon.net/blog/2022/10/)
* [May 2022](https://octagon.net/blog/2022/05/)
* [March 2022](https://octagon.net/blog/2022/03/)
* [January 2022](https://octagon.net/blog/2022/01/)
## Categories

* [bug bounty, rce, preauth rce,](https://octagon.net/blog/category/bug-bounty-rce-preauth-rce/)
* [Uncategorized](https://octagon.net/blog/category/uncategorized/)

[![](/imgs/oct.png)](https://octagon.net)


