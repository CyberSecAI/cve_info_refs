=== Content from community.freepbx.org_ecc58715_20250114_204359.html ===


![FreePBX Community Forums](data:image/svg;base64...)
Loading

[FreePBX Community Forums](/)

# [SECURITY ISSUE - Potential Rest Phone Apps RCE](/t/security-issue-potential-rest-phone-apps-rce/80109)

[FreePBX](/c/freepbx/security/76)

[Security](/c/freepbx/security/76)

[lgaetz](https://community.freepbx.org/u/lgaetz)
(Lorne Gaetz)

December 22, 2021, 4:11pm

1

On the afternoon of December 21, 2021 Sangoma received a report of malicious activity in progress on a fully up to date FreePBX 15 system. Technical details followed very quickly, and engineering was able to act within minutes of the report. Investigation revealed that the vulnerability to be in the FreePBX and PBXact Phone Apps (restapps) module, in published versions 16.0.18.40, 16.0.18.41, 15.0.19.87 and 15.0.19.88. Other major FreePBX or PBXact versions are not affected. The affected module versions were initially published on or about December 11, 2021.

As of this writing, the issue is resolved in Phone Apps (restapps) module versions 16.0.19 and 15.0.20, published early on December 22. They are flagged as a security update, so you will see dashboard notifications after the next update sync, and email notifications if so configured. All are encouraged to update immediately.

Engineering was able to act swiftly in this case due to the very detailed initial report from [@billsimon](/u/billsimon) and the follow up participation by [@tm1000](/u/tm1000). On behalf of the entire FreePBX community, we thank Bill and Andrew for their immediate action in reporting and investigating this issue.

The record of this incident is [in this wiki page](https://wiki.freepbx.org/display/FOP/2021-12-21%2BSECURITY%3A%2BPotential%2BRest%2BPhone%2BApps%2BRCE) which will be updated as additional details emerge.

6 Likes

[Being bombarded by emails from cron jobs](https://community-old.freepbx.org/t/being-bombarded-by-emails-from-cron-jobs/80426/2)

[0 Day FreePBX Exploit?](https://community.freepbx.org/t/0-day-freepbx-exploit/80092/21)

[Crontab entry: has my PBX been hacked?](https://community.freepbx.org/t/crontab-entry-has-my-pbx-been-hacked/80155/2)

[PBX hacked with plenty of foreign numbers outbound calls](https://community.freepbx.org/t/pbx-hacked-with-plenty-of-foreign-numbers-outbound-calls/80286/7)

[SED Command Overloading FreePBX Server](https://community.freepbx.org/t/sed-command-overloading-freepbx-server/80683/4)

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.freepbx.org/policies/)
* [Privacy Policy](https://www.freepbx.org/policies/)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from wiki.freepbx.org_3452f3bd_20250114_204407.html ===


[![Custom logo](/wiki/download/attachments/32967/atl.site.logo?version=1&modificationDate=1697746375069&cacheVersion=1&api=v2)![Custom icon](/wiki/download/attachments/32967/atl.site.logo?version=1&modificationDate=1697746375069&cacheVersion=1&api=v2)](/wiki)Sangoma Documentation[Sangoma Documentation Home](/wiki/spaces/DocHome/overview?mode=global)SpacesTeamsApps[Templates](/wiki/templates)Create[![](/wiki/download/attachments/8454147/FP?version=2&modificationDate=1706705584550&cacheVersion=1&api=v2)
## FreePBX Open Source](/wiki/spaces/FP/overview?homepageId=8454359)

* [All content](/wiki/spaces/FP/pages)
* [Space settings](/wiki/spaces/FP/settings/home)

Shortcuts

* [Sangoma Phone Desktop Client for FreePBX](https://sangomakb.atlassian.net/wiki/spaces/SS1/pages/31129864/Sangoma%2BPhone%2BDesktop%2BClient)[Sangoma Phone Desktop Client for FreePBX](https://sangomakb.atlassian.net/wiki/spaces/SS1/pages/31129864/Sangoma%2BPhone%2BDesktop%2BClient) This trigger is hidden
* [Sangoma Talk Mobile for FreePBX](https://sangomakb.atlassian.net/wiki/spaces/SS1/pages/31130054/Sangoma%2BTalk%2BMobile)[Sangoma Talk Mobile for FreePBX](https://sangomakb.atlassian.net/wiki/spaces/SS1/pages/31130054/Sangoma%2BTalk%2BMobile) This trigger is hidden

ContentResults will update as you type.

* [•FreePBX OpenSource Project](/wiki/spaces/FP/pages/9699329/FreePBX%2BOpenSource%2BProject)
* FreePBX Open Source User Guides
* FreePBX Open Source Release Notes
* FreePBX Open Source Technical Notes & Resources
* FreePBX Open Source Compliance Notes
* FreePBX Open Source Video Guides

# FreePBX Open Source Project

## Welcome to the main repository for the FreePBX Open Source project

Search our help articles

Return to <https://sangomakb.atlassian.net/wiki/spaces/DocHome>

Return to <https://help.sangoma.com/>

### Return to [Documentation Home](/wiki/spaces/DocHome) I Return to [Sangoma Support](https://help.sangoma.com/)

{"serverDuration": 14, "requestCorrelationId": "53e8d0deec1942b390be250a8dfadd0f"}


=== Content from community.freepbx.org_3c244b79_20250114_204359.html ===


![FreePBX Community Forums](data:image/svg;base64...)
Loading

[FreePBX Community Forums](/)

# [0 Day FreePBX Exploit?](/t/0-day-freepbx-exploit/80092)

[FreePBX](/c/freepbx/security/76)

[Security](/c/freepbx/security/76)

[Crosstalk](https://community.freepbx.org/u/Crosstalk)
(Chris Sherwood)

December 22, 2021, 12:55am

1

I was made aware of a new zero-day FreePBX exploit today - apparently it affects Phone Apps, even if you’re not using Phone Apps in a licensed capacity.

Does anyone have any information on this? Apparently, and earlier post on the subject was pulled down? Do we have any sort of statement from Sangoma or an ETA for a security fix? Should we be closing down the public facing Phone Apps port for all customers?

-Chris

2 Likes

[Gui failing to load](https://community.freepbx.org/t/gui-failing-to-load/80202/2)

[Multiple issues with vm and parking apps from digium phones](https://community.freepbx.org/t/multiple-issues-with-vm-and-parking-apps-from-digium-phones/80178/8)

[Crontab entry: has my PBX been hacked?](https://community.freepbx.org/t/crontab-entry-has-my-pbx-been-hacked/80155/2)

[mattf](https://community.freepbx.org/u/mattf)
(Matthew Fredrickson)

December 22, 2021, 1:58am

2

Hey,

We’re working on getting a fix pushed out, hopefully within the next 24 hours or so. It’s a very recently introduced problem so only impacts you if you have the following restapps versions installed:

16.0.18.40

16.0.18.41

15.0.19.87

15.0.19.88

Blocking public traffic to the restapps port on public interfaces is a good mitigation. Or downgrade restapps to anything before those versions is probably a better option.

If you roll back to 15.0.19.86 or 16.0.18.39 you should be ok.

Sorry about the trouble on this, we’re working as quickly as possible to get this resolved.

Matthew Fredrickson

EDIT: [@tm1000](/u/tm1000) thinks that blocking restapps ports is still insufficient from his testing, so downgrading is the best path until the official fix is pushed.

2 Likes

[Crosstalk](https://community.freepbx.org/u/Crosstalk)
(Chris Sherwood)

December 22, 2021, 2:38am

3

Thanks Matt!

Are any of the v14 modules affected as well?

-Chris

[mattf](https://community.freepbx.org/u/mattf)
(Matthew Fredrickson)

December 22, 2021, 2:39am

4

Any earlier versions of FreePBX (v14, v13, etc) are not impacted. It’s only the 15.x and 16.x versions listed above.

EDIT:

We thought edge versions of 14 might have had some problems but it was a false alarm. 14 is good (edge and stable versions).

1 Like

[ngingras](https://community.freepbx.org/u/ngingras)
(Nathan Gingras)

December 22, 2021, 3:10am

5

Matt,

Can the affected versions be pulled from the mirrors? Looks like they can still be downloaded. Not sure how practical/possible this is without breaking other things…

Also just to note I could not find 15.0.19.86 in the repository, however I was able to grab 15.0.19.85.

```
[root@host ~]# fwconsole ma downloadinstall restapps --tag 15.0.19.86
No repos specified, using: [standard] from last GUI settings

Unable to update module restapps - 15.0.19.86, it does not exist:
Updating Hooks...Done
Chowning directories...Done

```

Thanks,

Nate

[mattf](https://community.freepbx.org/u/mattf)
(Matthew Fredrickson)

December 22, 2021, 3:32am

6

15.0.19.85 should work too.

[QM2021](https://community.freepbx.org/u/QM2021)
(Loway QueueMetrics)

December 22, 2021, 6:35am

7

![](https://community.freepbx.org/user_avatar/community.freepbx.org/mattf/48/15924_2.png) mattf:
> Blocking public traffic to the restapps port on public interfaces is a good mitigation.

That is 88 and 96 on a “stock” system, right?

[tm1000](https://community.freepbx.org/u/tm1000)
(Andrew Nagy)

December 22, 2021, 7:05am

8

![](https://community.freepbx.org/user_avatar/community.freepbx.org/mattf/48/15924_2.png) mattf:
> Blocking public traffic to the restapps port on public interfaces is a good mitigation.

![](https://community.freepbx.org/user_avatar/community.freepbx.org/qm2021/48/22746_2.png) QM2021:
> That is 88 and 96 on a “stock” system, right?

You can access restapps through normal http/https ports non specific to the restapps ports themselves (eg port 80 and 443 respectively) because of this blocking traffic to the restapps ports will not protect you unless you block access to all http/https traffic.

Source: I worked with [@billsimon](/u/billsimon) on the original POC (Proof of concept) for this new exploit in the now removed (for security not obscurity) thread. My POC worked against admin http/https (80,443) along with the restapps ports. [@billsimon](/u/billsimon) and I have been working with Sangoma ([@mattf](/u/mattf), [@lgaetz](/u/lgaetz) and [@mbrooks](/u/mbrooks) respectively). The original attack itself centered around exploiting restapps through the admin interface on https.

Tr;dl, You aren’t getting around this by blocking only the restapps ports. Downgrading the modules as suggested is the only way to prevent being hacked.

4 Likes

[MarPeverley](https://community.freepbx.org/u/MarPeverley)
(MPeverley)

December 22, 2021, 12:32pm

9

Can we disable Phone Apps if we’re not using it, or uninstall/Remove?

[PitzKey](https://community.freepbx.org/u/PitzKey)
(Itzik)

December 22, 2021, 12:53pm

10

Yes

```
fwconsole ma delete restapps
fwconsole reload

```

3 Likes

[BlazeStudios](https://community.freepbx.org/u/BlazeStudios)
(Tom Ray)

December 22, 2021, 1:38pm

11

Can we get some clarification on this because Ward is over on the voip-info forums saying that this has to do with the freepbx\_ha module and a license being triggered. Is this the case? Because then if they need to use freepbx\_ha wouldn’t those without that installed (during the OS install) be fine? Or is this a double whammy thing?

As I pointed out last week, the HA module seems to be gone from the mirrors and throws a bunch of errors after I moved systems from 13 to 14. Can’t remove the HA module normally because it can’t be verified since it doesn’t exist in any place the system verifies things.

[BlazeStudios](https://community.freepbx.org/u/BlazeStudios)
(Tom Ray)

December 22, 2021, 1:44pm

12

I do have, what I think, is a serious question. Since the modules being mentioned here are commercial which means only Sangoma developers work on them.

How did a ZERO DAY exploit from almost TWO years ago end up regressed into new updates? This seems like an important thing to pay attention to and not have regression on. Why is QA and testing still a very weak part of this project in 2021 and over a decade into it?

[lgaetz](https://community.freepbx.org/u/lgaetz)
(Lorne Gaetz)

December 22, 2021, 1:44pm

13

Sangoma will comment in full shortly.

[tm1000](https://community.freepbx.org/u/tm1000)
(Andrew Nagy)

December 22, 2021, 2:49pm

14

![](https://community.freepbx.org/letter_avatar_proxy/v4/letter/b/e0b2c6/48.png) BlazeStudios:
> Is this the case?

Originally I thought it was freepbx\_ha but the exploit in question only masks itself using freepbx\_ha after the entry point. So removing ha or disabling it doesn’t really matter because the entry point is the same. Of course Wards comments about this are before the discussion went internal between myself [@billsimon](/u/billsimon) and others at Sangoma so Ward only has a view of the first 20 minutes of discussion on this when in reality the discussion went on for another 3 hours.

What this means is freepbx\_ha is rather irrelevant. The entry point is the same and is not frrepbx\_ha. It would be trivial for another exploit to use the same entry point but mask itself as a completely different module.

In fact according to research [@billsimon](/u/billsimon) did you don’t even need freepbx\_ha on the system at all.

I want to give Sangoma the opportunity to comment in full so I’m trying to not reveal too much information but I think it’s important some questions are answered so that people don’t feel like “well I don’t have freepbx\_ha so I am fine” because that’s a false sense of security. You aren’t fine.

[sorvani](https://community.freepbx.org/u/sorvani)
(Jared Busch)

December 22, 2021, 2:53pm

15

![](https://community.freepbx.org/letter_avatar_proxy/v4/letter/b/e0b2c6/48.png) BlazeStudios:
> How did a ZERO DAY exploit from almost TWO years ago end up regressed into new updates?

The same way that the updateall function keeps getting regressed to install apps that are not installed.

The same way that usermanager was eating processes and instead of fixing it properly they dumped it to a cron.

The same way said cron was implemented bad and filled up everyone’s inbox over the weekend.

![](https://community.freepbx.org/letter_avatar_proxy/v4/letter/b/e0b2c6/48.png) BlazeStudios:
> Why is QA and testing still a very weak part of this project in 2021 and over a decade into it?

Because there is no QA.

2 Likes

[BlazeStudios](https://community.freepbx.org/u/BlazeStudios)
(Tom Ray)

December 22, 2021, 3:12pm

16

![](https://community.freepbx.org/user_avatar/community.freepbx.org/sorvani/48/19434_2.png) sorvani:
> Because there is no QA.

Just like there is no spoon?

1 Like

[mattf](https://community.freepbx.org/u/mattf)
(Matthew Fredrickson)

December 22, 2021, 3:16pm

17

Hey Tom,

The long and the short of it is that there were some changes that were made in the restapps module recently that were trying to fix a few bugs in phoneapps usage with phones in funny network environments - one of the more recent changes caused this regression.

We did not previously have a unit test written around this particular exploit (mostly due to the fact that there were some significant challenges around unit testing the code due to its former architecture). After this though, we’re going to be dumping a bunch of time into refactoring that code to make it more unit testable and so we can include a test case to cover this and any other similar issues that may come up in the future.

Big apologies again for the trouble around this.

1 Like

[BlazeStudios](https://community.freepbx.org/u/BlazeStudios)
(Tom Ray)

December 22, 2021, 3:58pm

18

Matt, I’m just going to be brutally honest here. I will need to look at the v16 code but everything code wise that I have looked at up until 15 is a frigging mess. There is zero consistency in the coding standards so I’m pretty sure that can have an impact on things.

I mean let us take your Asterisk counterpart as an example. If I look at the code for something I cannot tell that 6 developers have touch the code because it is consistently the same through out. Comments, formatting, structure all the same. On the other hand when looking at FreePBX code you can tell multiple people have touched it because there is zero consistency through out the code. Some of it is formatted in actual readable and logic ways, some may have comments and my favorite is the developers that insist on writing PHP code like JQuery/Javascript with all the code minified in to a few lines with no spacing or readable formats.

So talks about unit tests being written or other such things worries me due to the lack of actual coding guidelines and practices that I’ve seen through the project.

1 Like

[jfinstrom](https://community.freepbx.org/u/jfinstrom)
(James Finstrom)

December 22, 2021, 4:06pm

19

Coding and uniformity standards as well as testing info is all documented. They simply aren’t enforced.

At new ventures all of this is enforced with ci. We use static analysis etc and nothing can mainline without passing

[mattf](https://community.freepbx.org/u/mattf)
(Matthew Fredrickson)

December 22, 2021, 4:20pm

20

Thanks for your honest feedback Tom.

I think as a project we’re trying to move things in a direction where we have a bit more consistency as far as code styles and consistent best practices go. As new contributions go through the code review process, we welcome any and all positive participation in helping with those goals.

Separately from that, automated testing is an area that we have reaped great rewards from on the Asterisk side to provide significant comfort and stability to its code base. It is a personal interest of mine to bring those benefits to FreePBX as well.

Best wishes,

Matthew Fredrickosn

**[next page →](/t/0-day-freepbx-exploit/80092?page=2)**

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.freepbx.org/policies/)
* [Privacy Policy](https://www.freepbx.org/policies/)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


