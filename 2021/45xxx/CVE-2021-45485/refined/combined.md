=== Content from arxiv.org_bebae20a_20250114_184753.html ===
2
2
0
2

g
u
A
1
3

]

R
C
.
s
c
[

5
v
4
0
6
9
0
.
2
1
1
2
:
v
i
X
r
a

Subverting Stateful Firewalls with Protocol States
(Extended Version)∗

Amit Klein

Bar Ilan University
aksecurity@gmail.com

Abstract

We analyzed the generation of protocol header ﬁelds
in the implementations of multiple TCP/IP network
stacks and found new ways to leak information about
global protocol states. We then demonstrated new
covert channels by remotely observing and modify-
ing the system’s global state via these protocol ﬁelds.
Unlike earlier works, our research focuses on hosts
that reside in ﬁrewalled networks (including source
address validation – SAV), which is a very com-
mon scenario nowadays. Our attacks are designed
to be non-disruptive – in the exﬁltration scenario,
this makes the attacks stealthier and thus extends
their longevity, and in case of host alias resolution
and similar techniques – this ensures the techniques
are ethical. We focused on ICMP, which is commonly
served by ﬁrewalls, and on UDP, which is forecasted
to take a more prominent share of the Internet traﬃc
with the advent of HTTP/3 and QUIC, though we
report results for TCP as well.

The information leakage scenarios we discovered
enable the construction of practical covert channels
which directly pierce ﬁrewalls, or indirectly establish
communication via hosts in ﬁrewalled networks that
also employ SAV. We describe and test three novel
attacks in this context: exﬁltration via the ﬁrewall
itself, exﬁltration via a DMZ host, and exﬁltration
via co-resident containers. These are three generic,
new use cases for covert channels that work around

∗This is an extended version of a paper that will be pub-

lished in NDSS 2022.

ﬁrewalling and enable devices that are not allowed
direct communication with the Internet, to still ex-
ﬁltrate data out of the network. In other words, we
exﬁltrate data from isolated networks to the Internet.
We also explain how to mount known attacks such as
host alias resolution, de-NATting and container co-
residence detection, using the new information leak-
age techniques.

1

Introduction

Our research focuses on how to exploit global state in
the UDP and ICMP protocol stacks to mount attacks
against ﬁrewalled networks and hosts. The attacks
we are interested in are data exﬁltration, host alias
resolution and de-NATting, and co-residency detec-
tion – see Table 1. In some cases, the same attacks
can be carried out over TCP, in a more eﬃcient man-
ner than existing techniques.

1.1 Motivation

Our motivating example is a highly secured network,
wherein internal machines are not allowed to com-
municate directly with the Internet. This is enforced
by a network ﬁrewall, which prevents the network
hosts from accessing the Internet, but may allow
them to access services on a neighboring internal net-
work and/or management access to the ﬁrewall itself.
Such isolated networks can be found in ﬁnancial insti-
tutions, defense industries, hospitals, sensitive infras-
tructure sites, etc. The attacker’s goal is to exﬁltrate

1

Table 1: Attack Use Cases

1.2 Organization

Use Case

Firewall Piercing
(exﬁltration)
Exﬁltration
(via DMZ)
Co-Resident
Container
Exﬁltration
Alias Detection
and de-NATting

Sender
Location
Isolated
network
Isolated
network

Isolated
network

Internet

Target Host

Firewall

Firewalled
host in DMZ
Two co-resident
containers
(internal+external)
Firewalled/NATted
host

Receiver
Location

Internet

Internet

Internet

Internet
(=Sender)

data out of an isolated network, to the Internet. The
compromised data may consist of small “strategic”
pieces of data, such as cryptographic keys, or com-
pressed text ﬁles.

We assume that an attacker controls a compro-
mised internal machine. For example, the attacker
may have installed malware on that machine, by
means out of scope for this research. The attacker’s
goal is to exﬁltrate data from this machine. It should
be noted that the machine may be part of an attacker
network of compromised machines, such that the at-
tacker funnels the data to be exﬁltrated from other
machines to the machine from which the exﬁtration
is to take place.

Our techniques are able to circumvent the ﬁrewall’s
enforcement, and allow the attacker to exﬁltrate data
from a machine in an isolated network to an Internet
host the attacker controls. The exﬁltration through-
put is hundreds to thousands bits per hour (except
for Windows), which suﬃces to transmit e.g. a 128-
bit key in less than 22 minutes.

It should be stressed that this is an example to
one use case (ﬁrewall circumvention); in the paper
we also outline other attacks, such as host alias res-
olution and de-NATting, and co-residency detection.
The motivation for these use cases is to provide op-
erational intelligence as part of a larger attack eﬀort.
Detecting that two services reside on the same host
may enable an attack against a weaker (vulnerable)
service to take over a host which also runs a more
strategic (but not vulnerable in itself) service.

Next in this section we provide background on terms
and concepts we use throughout the paper (state-
ful ﬁrewalls, host alias resolution, and co-residency),
followed by a summary of our contributions. In Sec-
tion 2 we discuss related work. Section 3 describes the
current algorithms that generate the protocol ﬁelds
of interest. Section 4 outlines our attack concepts,
Section 5 then explains how the concepts are imple-
mented per-OS, and Section 6 describes our exper-
iments. A discussion of remediation options is pro-
vided in Section 7. We draw our conclusions in Sec-
tion 8, and ﬁnally we report on the vendor status in
Section 9.

1.3 Stateful Firewalls and SAV

A stateful ﬁrewall is a “network-based ﬁrewall that
individually tracks sessions of network connections
traversing it” [50]. According to [34], “[a] stateful in-
spection ﬁrewall is the de facto standard for network
protection”. SAV, and some features of stateful ﬁre-
walls can eliminate known data leakage attacks. We
explain this below, and we note that our techniques
are not aﬀected by SAV and by stateful ﬁrewalls.

In response to an incoming invalid packet – a TCP
packet or a UDP packet destined to a closed port,
or a TCP packet (other than SYN-only to an open
port) that does not belong to an already established
TCP session – a ﬁrewall may either silently drop the
packet, or actively reject it. Rejection is carried out
by sending back a TCP RST packet in the TCP case,
or by sending back an ICMP Type 3 Code 3 packet
(“port unreachable”) in the UDP case.

Dropping invalid packets is considered a somewhat
more secure choice (at the expense of a slight overall
performance degradation due to a delay in respon-
siveness at the remote party when no rejection packet
is sent), and is oftentimes set as the default ﬁrewall
behavior.
In Appendix A, we report the results of
an experiment in which we measured and estimated
the portion of widely-used Internet hosts that do not
send any response for UDP and TCP packets arriv-
ing to closed ports. We found that the vast majority
of the Internet hosts silently drop such UDP/TCP

2

packets. Therefore, attacks that assume a response
for an invalid, connecion-less UDP/TCP packet will
fail for most servers. Our attacks, on the other hand,
only use valid and acceptable packets, and are thus
unaﬀected by stateful ﬁrewalls.

A ﬁrewall can also employ Source Address Valida-
tion (SAV), such that it does not allow traﬃc from a
ﬁrst network into a second network with source ad-
dresses outside the ﬁrst network. This security mea-
sure can prevent some trivial information leaking at-
tacks. For example, a host A on an isolated, internal
network which is prevented from sending packets to
the Internet can send a spoofed packet whose source
address C is an Internet address, to host B in the
DMZ network which is allowed to send data to the In-
ternet. Host B will then respond by sending a packet
to C, an Internet address. This can be used as a
covert channel signal. SAV prevents this by drop-
ping A’s spoofed packets since their spoofed source
address C does not match their origin (the internal
network).

Henceforth, we use the term ﬁrewall as a short-
hand for “a stateful ﬁrewall that silently drops invalid
packets, with SAV between all its networks”.

1.4 Host Alias Resolution, De-
Co-Residency
and

NATting
Detection

Note: we use the term host throughout this paper
to denote a single instance of an operating system
kernel. This can be a physical host, or – if virtual
machines are used – a single virtual machine. We use
the term physical host to explicitly exclude the latter
case.

A host alias resolution [46] (also host alias detec-
tion [16]) technique enables a remote party to infer
whether two given IP addresses map to the same host
or to two diﬀerent hosts. We can extend this into in-
ferring whether two services (deﬁned by IP address,
the listening port and the transport protocol – TCP
or UDP) map to the same host or not. For exam-
ple, one can ask whether 1.2.3.4:80 (over TCP) and
5.6.7.8:443 (over UDP) map to the same host.

De-NATting [10] [41] is a use case of host alias de-

tection, wherein the host(s) in questions reside be-
hind a NAT, and thus the two services are mapped
from their external endpoints into internal endpoints
by a NAT device.

In this research, we focus on server de-NATting,
meaning, discerning whether two external endpoints
refer to the same host or to two diﬀerent hosts. This
is in contrast to client de-NATting, which refers to
discerning whether two outbound connections (desig-
nated by their external address endpoints) are made
by a single client or by two diﬀerent clients. The ma-
terial diﬀerence is that a NATted client is likely to use
a single internal IP address, whereas a NATted server
may use two IP addresses for two diﬀerent services.
Some operating systems use the (IP SRC , IP DST ) tu-
ple to generate network ﬁelds, making it trivial to
de-NAT clients, but not servers.

Co-Residency Detection for Containers [45] is a
concept similar to host alias detection, which aims to
detect whether two endpoints on two diﬀerent con-
tainers are hosted by the same physical host. If vir-
tualization is used, then the containers may run on
two diﬀerent virtual machines. We are interested in
a variant of this concept, which is to detect whether
two endpoints on two diﬀerent containers are hosted
by the same operating system kernel.

Container technology (e.g. Docker) is available for
Linux and Windows. Our co-residency detection at-
tacks apply to Linux, but not to Windows.

1.5 Our Contribution

• New information leakage techniques based
on the statefulness of IPv4 ID, TCP ISN (IPv4
and IPv6) and IPv6 ﬂow label in popular server
operating systems: Linux, Windows Server, ma-
cOS Server, OpenBSD and NetBSD. In the IPv4
ID and TCP ISN cases, this is done without ac-
curately predicting the full values of these proto-
col ﬁelds. Our results are summarized in Table 2.
These techniques are non-disruptive, and can be
used even when the target host is ﬁrewalled, in-
cluding SAV. The attacks are algorithmic, and
therefore are not hardware-speciﬁc, nor do they
require ﬁne-grained timing or rely on race con-
ditions. And since they rely on kernel imple-

3

Table 2: Information Leaking Fields and Their Chan-
nel Properties

by Windows to manage (IP SRC , IP DST ) tuples,
including IPv4 ID management.

OS

Protocol

Field

Sender
Capabilities

Channel Bandwidth

2 Related Work

Linux

Windows

UDP/IPv4,
ICMP/IPv4
UDP/IPv4,
TCP/IPv4

IPv4 ID

IP Spooﬁng

IPv4 ID

IP Spooﬁng

macOS

UDP/IPv4

IPv4 ID

macOS

ICMP/IPv4 (rate limit)

OpenBSD

NetBSD

UDP/IPv4,
TCP/IPv4
ICMP/IPv4
TCP/IPv4,
TCP/IPv6

NetBSD

TCP/IPv6

IPv4 ID

TCP ISN

IPv6 Flow
Label

Web Traﬃc
Emission
Web Traﬃc
Emission

Web Traﬃc
Emission

Web Traﬃc
Emission
Web Traﬃc
Emission

400 b/h (UDP),
3000 b/h (ICMP)
47.4 b/h (UDP),
41.4 b/h (TCP)

1800 b/h

1800 b/h (estimated)

720 b/h (UDP, throttled),
360 b/h (TCP, throttled)
4200 b/h (ICMP)

7200 b/h (throttled)

Untested

mentations, they are agnostic to the nature of
applications/services the operating system runs.

• Exﬁltration from a ﬁrewalled network (including
SAV) and exﬁltration between co-resident con-
tainers – a new covert channel use case for
exploitation of stateful IPv4 ID, TCP ISN and
IPv6 ﬂow label. In this use case, an internal de-
vice is prevented from directly connecting to the
Internet, by a ﬁrewall, but is allowed to connect
to the ﬁrewall itself, or to a DMZ host, or to an
internal container co-residing with a 3rd party
container. Our attacks exploit the host’s global
protocol states to exﬁltrate data from the inter-
nal device to the Internet. The covert channels’
bandwidth (in bits/hour) depends on the infor-
mation leakage techniques’ bandwidth listed in
Table 2.

• Constructing a covert channel based on the new
information leakage techniques and exploiting it
for well known attack use cases: server alias res-
olution, de-NATting, container co-residency de-
tection, and idle scanning. Previously, these at-
tacks were inapplicable either due to the under-
lying information leaking technique being mit-
igated, or due to the disruptive nature of the
underlying technique or other limitations.

• A description of the present day algorithm used

2.1 IPv4 Global State and Side Chan-

nels

2.1.1 Prediction of IPv4 ID values

The IPv4 ID ﬁeld is a 16 bit identiﬁer used to re-
assemble IP packets from smaller fragments. This
ﬁeld is populated by the OS regardless of whether
fragmentation is actually needed. If the IPv4 ID ﬁeld
is generated in a predictable manner, e.g.
sequen-
tial increment per packet, then it is possible to sam-
ple the ﬁeld twice and determine whether the target
host sent another packet in between. For this ap-
proach, the IPv4 ID ﬁeld must be highly predictable,
i.e with a near-zero entropy. Note of course that if the
ID is static (e.g. 0), which is legitimate for atomic
(DF=1)1 packets [49, Section 4], then no informa-
tion is leaked. However, some operating systems (e.g.
Linux) do set DF=1 for short packets, yet still pop-
ulate the ID ﬁeld with a non-static value.

The original idle-scan technique [44] exploited se-
quential IP IDs which were very common in the oper-
ating systems of that era (1998). Later in 2008, [29]
cryptanalyzed the IPv4 ID mechanism of OpenBSD
and macOS Server and showed it to be predictable.
In response, OpenBSD and macOS Server changed
their algorithm.
In 2019, [31] attacked the IP ID
generation in Windows TCP/IPv4 and UDP/IPv4,
In response, Windows
and in Linux UDP/IPv4.
and Linux changed their algorithms. Recently, [30]
showed that the Linux TCP/IPv4 ID ﬁeld is also
predictable, and in response Linux changed that al-
gorithm as well.

The only operating systems nowadays that gener-
ate predictable (sequential) IPv4 IDs are FreeBSD
(UDP/IPv4 only) and NetBSD (only for packets
longer than 68 bytes, thus excluding e.g. TCP
RST packets). With the exception of FreeBSD and

1The IPv4 DF (“Don’t Fragment”) header ﬂag controls
fragmentation by routers. Setting DF=1 prohibits routers
from fragmenting the packet.

4

NetBSD, all operating systems we surveyed upgraded
their IPv4 ID generation scheme to a non-predictable
algorithm, hence attacks that rely on IPv4 ID predic-
tion are no longer applicable to them.

Moreover, in general, idle-scanning, which relies on
the pivot server to send an RST packet for “unex-
pected” SYN+ACK packet, does not apply to a ﬁre-
walled pivot server. A ﬁrewall is likely to silently drop
the SYN+ACK packet, or alternatively the ﬁrewall
may respond with an RST packet, without forward-
ing it to the pivot server. We do, however, note that
our NetBSD ﬂow label attack can be used for eﬃ-
cient idle scanning TCP/IPv6 hosts with NetBSD as
a pivot server, when the latter is not ﬁrewalled.

In 2008, Danezis described how to construct covert
channels from incremental IPv4 IDs [17].
But
Danezis’s use case is diﬀerent than ours. Danzeis as-
sumes the monitored party can still connect to the In-
ternet, and as such, he focuses on channel robustness,
rather than on the technicalities of implementing the
technique for ﬁrewalled networks. Additionally, that
work does not describe UDP-based techniques, IPv6-
based techniques and container-based techniques.

In contrast, the global IPv4 ID states we describe
exist in modern IPv4 ID generator implementations.
These global states are typically subtle and not easily
observed.

2.1.2 Attacks on the Linux IPv4 ID Gen-
eration Algorithm for UDP and TCP
Connection-Less Packets

The Linux IPv4 ID generation algorithm for
connection-less packets (ICMP and UDP; until v4.19
also TCP RST packets not in a connection context)
is described in Section 3.1. This construction was at-
tacked in several recent papers. Some attacks against
Linux TCP connections exploited this algorithm, ei-
ther when used for TCP RST packets [52] [3] (note
that since v4.19, the Linux kernel sets IPv4 ID to 0
in RST packets which are not in an existing connec-
tion context), or through a “downgrade attack” from
the more secure TCP IP ID generation scheme [20].
However, these attacks do not aﬀect Linux UDP and
ICMP traﬃc, which is the object of our research.
Additionally, these attacks practically require the at-

tacker to own thousands of IPv4 addresses. In 2019,
[31] exploited the Linux IP ID generation structure
to ﬁnd partial hash collisions and extract the hashing
key. In response, the hash function was modiﬁed to
use a larger key.

A recent DNS cache poisoning attack [53] involv-
ing Linux-based recursive resolvers hinges on the fact
that when two machines are behind the same NAT,
their external IPv4 address is identical, and hence
the packets sent by a Linux host to both machines
share the IPv4 ID counter. But to exploit this for
exﬁltration, the sender and receiver must be on the
same network and behind the same NAT, which is
inapplicable to an exﬁltration scenario.

Similarly to the above attacks, our attacks exploit
the counter array of the Linux IPv4 ID algorithm,
but in contrast to the previous attacks, our attacks
target ICMP and UDP services, and they do not re-
quire ownership of thousands of IPv4 addresses, or
having the sender and the receiver reside on the same
network, and can target any host.

2.1.3 IPv4 De-fragmentation Cache

Another global IPv4 state is the memory limit for
the de-fragmentation cache, a kernel data structure
that maintains the incoming IPv4 fragments. The
limit can be applied per source IP address, or glob-
ally. Overﬂowing the de-fragmentation cache can be
detected remotely, as explained in [22], and can thus
be used as a side channel. This technique requires
IPv4 fragments to traverse the Internet unmodiﬁed.
However, the prevalence of Carrier Grade NATs (CG-
NATs) reduces the attack surface of this technique.
In CGNATs, the attacker cannot space the arrival
time to the target host of fragments that belong to
the same IP packet. Rather, the ﬁrst fragment will
await virtual de-fragmentation on the CGNAT de-
vice, and will only be transmitted when the second
fragment arrives at the CGNAT. In fact, anecdo-
tal evidence from our lab’s ISP indicates that CG-
NATs may employ an even more destructive strategy,
wherein they reassemble the IPv4 packet and forward
the complete packet.

Additionally, since this attack overﬂows the de-
fragmentation cache, it is disruptive, as organic in-

5

bound fragments may be evicted from the cache be-
fore re-assembly, resulting in dropping of organic in-
bound packets.

2.2 UDP Global State and Side Chan-

nels

The UDP protocol does not contain global states per-
se. However, [2] describes a global state based on a
rate limit imposed by some kernels on ICMP proto-
col “port unreachable” messages, sent in response to
incoming UDP packets destined to closed ports. It
should be noted though, that ﬁrewalls handle UDP
packets sent to closed ports themselves (without for-
warding them to the destination host), and are likely
not to send back ICMP messages, due to security
reasons. In Appendix A we report that an estimated
85% of the widely-used Internet hosts/ﬁrewalls do not
send ICMP “port unreachable” messages.

2.3 TCP Global States and Side

Channels

Our attack on NetBSD is TCP-based, and our attacks
on Windows and OpenBSD IPv4 ID can also be used
in TCP protocols. Therefore, we also survey TCP-
based side channels, but only if they are relevant to
any of these operating systems.

In 2005, Kohno et al. [32] demonstrated device
identiﬁcation based on the device clock skew, ob-
served in the TCP timestamp ﬁeld. This work was
later improved in [37]. Windows, OpenBSD and
NetBSD do not implement TCP timestamps useful
for the [32] and [37] attacks (Windows Server does
not send a TCP timestamp at all, and OpenBSD
and NetBSD have TCP timestamp at 0.5s resolu-
tion). In the past, TCP Timestamps could be used as
a “passive” side channel for host alias resolution, as
described in [13] [26], but nowadays this only applies
to macOS.

In 2010, Ensaﬁ et al. [19] used model checking to
discover information leakage due to the rate limit on
a global TCP RST counter. Exploiting this requires
the sender client to send the server either SYN pack-
ets for a closed port, or otherwise packets that pur-
In
portedly belong to a non-existing TCP circuit.

both cases, a stateful ﬁrewall may silently drop the
packets and thwart the attack. In Appendix A, we
report that an estimated 92% of the widely-used In-
ternet hosts/ﬁrewalls drop such packets.

Additional side channels are described by [19], [14]
and [15], which are based e.g. on TCP SYN cookies
and TCP challenge ACKs. But these mechanisms are
not employed (at least not by default) by Windows,
OpenBSD and NetBSD. We see, therefore, that for
ﬁrewalled Windows Server, OpenBSD and NetBSD
hosts, there are no currently known remotely ex-
ploitable TCP global states.

2.4 Host Alias Detection and De-

NATting

Early host alias detection and de-NATting relied on
global states that are trivial to observe and follow,
and compared such global states between two end-
points. Bellovin’s seminal 2002 de-NATting paper
[10] is based on a globally incrementing IPv4 ID as a
global state. This concept was later applied to host
alias resolution, e.g. with IPv6 ID [11]. Client de-
NATting based on the IPv4 ID of outbound DNS
queries over UDP was described in [41]. This attack
relies on the incremental nature of the IP ID for a
ﬁxed (IP SRC , IP DST ) tuple, and thus cannot be ap-
plied to server de-NATting where a single host may
use multiple source IP addresses.

Nowadays, IP IDs are not generated via a global
counter (except for FreeBSD and NetBSD), and TCP
timestamps are usually generated per TCP connec-
tion (except for macOS), thus these techniques are
no longer in eﬀect. Conceptually, it is still possible to
mount host alias detection and de-NATting attacks
using the more sophisticated global states described
in the previous sub-sections, but here too, the se-
vere limitations described above for these techniques
apply. A host alias resolution technique based on
packet delay sequences is described in [47], however
this technique aims at router IP aliasing, which does
not address the question of whether two IP addresses
are served from a single host or from two distinct
hosts on the same network.

6

Table 3: Exﬁltration from Networks

Target
Network

Typical
Throughput

Air-Gapped

8b/h-4Kb/s

Isolated

1b/h-10Kb/h

Regular
(Firewalled)

100Kb/s and
above

Typical
Requirement
Proximity
(0.4m-30m)
IP spooﬁng
(in some cases)

Examples

[24], [25]

This paper, [37]

None

[36], [12], [51], [28]

2.5 Container Co-residency Detection
and Cross Container Information
Leakage

A container co-residency detection technique is de-
scribed in [45], but this attack is local, i.e. the at-
tacker’s container must co-reside with the target con-
tainer. Our attack can remotely detect that two con-
tainers reside on the same host.

Cross-container leaks are reviewed in [21], but the
attacks described there cannot be remotely mounted,
whereas our attack is remote, and does not require
the attacker to control a co-resident container.

2.6 Other Side Channels and Exﬁltra-

tion Techniques

Our exﬁltration attacks are focused on isolated net-
works.
Isolated networks are less secure than air-
gapped (or nearly air-gapped) networks, but are more
secure than ordinary networks. As can be expected,
exﬁltration techniques that work on less secure net-
works generally tend to have better throughput, but
cannot be applied to more secure networks. Specif-
ically, techniques that apply to less secure networks
typically cannot be applied to isolated networks, and
therefore cannot be compared, throughput-wise, to
our techniques, that do work against isolated net-
works. Likewise, our exﬁltration techniques do not
work against air-gapped networks, or nearly air-
gapped networks (networks behind a network pump).
Exﬁltration from air-gapped networks requires
close proximity (0.4m-30m) [23], which is a serious
limitation. The throughput varies drastically among

the techniques, from 8b/h to 4Kb/s [25]. A typ-
ical example is [24] which describes an acoustical
covert channel based on hard drive noise, yielding
3b/s throughput.

Our work is a rare example of exﬁltration from an
isolated network (without the proximity constraint).
Another example is [37], which is eﬀective against
Linux TCP services only, with 2b/h-8b/h through-
put.

Finally there are examples of exﬁltration tech-
niques that do not apply to isolated networks. For
example, [36] uses a web counter as a covert channel,
but this requires the DMZ target host to have (1) a
shared web application between the internal and the
external networks; and (2) to have a web counter in
that application. [12] uses public cloud service as a
covert channel, and [51] uses multiple public services
as a covert channel. All these covert channels are
very unlikely to apply for isolated networks as their
prerequisites are obviously inconsistent with network
isolation. In 2004, [28] demonstrated a covert chan-
nel via DNS queries (“DNS tunneling”). A through-
put analysis can be found in [1]. Though it focuses
on the downlink, it can be inferred that the uplink
throughput is in the hundreds of Kb/s, many or-
ders of magnitude better than our techniques. How-
ever, since DNS tunneling is well-known and well-
understood for almost two decades, it is very unlikely
to ﬁnd isolated networks with unrestricted access to
an Internet-connected DNS resolver.

Table 3 compares exﬁltration techniques for the

three network types.

3 Current Protocol Header
Field Generation Algorithms

3.1 Linux IPv4 ID for Connection-

Less Transport Protocols

Starting with kernel v3.16, the Linux IPv4 ID gen-
eration algorithm for connection-less transport pro-
tocol packets (e.g. UDP, ICMP) uses an array β of
2048 counters, and a corresponding array τ of their
last access times. Algorithm 1 describes how an IPv4
ID is generated. Note that the time is measured in

7

“jiﬃes” (a clock whose frequency is set at kernel com-
pile time: f =250Hz by default, f =1000Hz for some
MIPS platforms), h is a hash function, proto is the
IANA protocol number (1 for ICMP and 17 for UDP)
and net key adds a container-dependent quantity, if
applicable. Also deﬁne random(∅) = 0.

Algorithm 1 Linux IPv4 ID Generation for
Connection-less Transport Protocols
1: procedure Generate-IPID
2:

h(IP DST , IP SRC, proto, net key)

←

i
mod 2048

3:
4:
5:
6:

hop ← 1 + random({0, . . . , tnow − τ [i] − 1})
β[i] ← (β[i] + hop) mod 216
τ [i] ← tnow
return β[i]

dows handles the potentially almost inﬁnite growth
of PathSet. Obviously PathSet cannot be allowed to
grow indeﬁnitely, so PathSet objects must occasion-
ally be purged.
Indeed, Windows removes objects
from the PathSet in batches, which we term purge
sequences. Generally speaking, a purge sequence can
be triggered either by PathSet’s size exceeding some
(pretty high) thresholds, or by a PathSet growth of
5,000 or more new Path objects in 0.5 second (“ﬂood
detection”). In both cases, a purge sequence is ini-
tiated, which goes over all the Path objects in the
PathSet at a rate of 2000/sec and removes “stale”
Path objects – objects that were last accessed over
60 seconds2 ago.

3.3 macOS

Server

(Connection-
Less Transport Protocols) and
OpenBSD IPv4 ID

3.2 Windows Server IPv4 ID

Note: since Windows is closed-source, extracting via
reverse engineering, and documenting the Windows
Server IPv4 ID generation logic is part of our contri-
bution.

As of version 1903, Windows Server generates the
IPv4 ID of outbound IPv4 packets as follows. Win-
dows implements the IPv4 ID as a counter per each
(IPSRC , IP DST ) tuple that corresponds to outbound
traﬃc, where IP SRC is an address on the local ma-
chine, and IP DST is a peer address. Such tuple-
speciﬁc data is kept in an object called Path. The set
of Path objects is maintained in a hash table called
PathSet. Windows keeps a PathSet per compart-
ment, i.e. one IPv4 PathSet instance per container.
A new Path object is created upon the ﬁrst attempt
to send a packet from IP SRC to IP DST , where there
is no existing Path object with these indices. When
a new Path object is created, the IPv4 ID ﬁeld is
initialized with random data. Then, for each packet
sent from IP SRC to IP DST , the IPv4 ID in the cor-
responding Path object is incremented and used as
ID. Na¨ıvely speaking, this setup provides no leak-
age, since each tuple runs its own independent IPv4
ID counter. However, an important aspect of the
PathSet life-cycle was left out so far – how Win-

Both macOS (for connection-less transport protocols
only – e.g. UDP and ICMPv4) and OpenBSD im-
plement their IPv4 ID generation along the concept
of keeping a list of the M recently used IPv4 ID val-
ues, picking a random ID value out of the remaining
65536−M values, and updating the list of used values
accordingly (popping the oldest value and pushing
the freshly generated value). For macOS, M = 4096,
and for OpenBSD, M = 32768. Thus, it is guaran-
teed that the IPv4 ID value is unique in intervals of
length M, at the cost of reducing the entropy from
16 bits to log2(65536 − M) bits.

Note: the IPv4 ID in macOS is generated at the
macOS kernel – XNU. Therefore, the attack tech-
niques we describe are actually inherent to XNU.
However, macOS Server is the only widely-used
server operating system based on the XNU kernel,
therefore we name macOS as the attack target, rather
than XNU.

3.4 NetBSD TCP ISN

A TCP Initial Sequence Number (ISN) is generated
by each TCP connection party at the beginning of

210

seconds

in Windows

10,

determined

by

TcpipIsServerSKU.

8

the connection, as a 32-bit random starting point for
the sequence numbers it generates for the connection.
A TCP client generates and sends ISN with the TCP
SYN packet, and a TCP server generates and sends
ISN with the TCP SYN+ACK packet.

NetBSD generates the most signiﬁcant 8 bits of the
ISN as a sum of a 2Hz timer and a TCP connection
counter, modulo 256.

4 Attacks

4.1 Threat Model

All our attacks are built around the same concept.
In our attacks, there is a sender, a receiver and a
target host (or hosts), identiﬁed by one or more end-
point designations, where an endpoint is deﬁned as
a combination of IP address, protocol – TCP, UDP
or ICMP, and port (for TCP and UDP only). The
attacker controls the sender and the receiver entities,
but has no control whatsoever over the target host(s).
Therefore, one of the main concerns of this research
is to determine what attacks can be mounted in var-
ious implementations (operating systems) and roles
of the target host. Thus, when we refer to an attack
against an operating system, it is a shorthand to an
attack against a target host running that operating
system.

In one use case, the target host is a ﬁrewall pre-
venting the sender and receiver from communicating
directly.
In other use cases, the target host is ﬁre-
walled. The receiver and sender cooperate to fulﬁll
their task, and are furthermore synchronized to a sub-
second accuracy.

We use a covert channel through the target host
wherein its global state can be read and altered by
sending and receiving packets, as described below. In
Section 5 we will see that such a covert channel exists
for many target host operating systems, though the
covert channel details diﬀer between the operating
systems.

The sender entity signals a single bit by sending
packets to one of the target host’s designated end-
points. In most of our attacks, the sender can be an
non-privileged process at the system it runs on, send-

ing conventional packets. In fact, for web protocols,
such traﬃc can be emitted by an HTML page ren-
dered by a browser. However, in the Windows and
Linux attacks, the sender must be able to spoof the
source IP address of its packets, thus the sender must
run as a privileged process on its machine.

The receiver entity reads this bit by sending pack-
ets to one of the target host’s designated endpoints
(not necessarily the one used by the sender), receiving
packets from the target and analyzing them. The re-
ceiver entity typically needs access to the raw packets
at the IP level, and as such may need to run as a priv-
ileged process on its system. This is a reasonable as-
sumption since the receiver is an attacker-controlled
machine on the Internet.

In general, the attack proceeds by having the re-
ceiver send and receive some packets, thus recording
the global state of the target host. Then the sender
either sends packets to the target host (thereby
changing its global state) to signal the bit “1”, or
does nothing (thereby retaining the global state in
the target host) to signal the bit “0”. Finally, the
receiver reads the global state again, and determines
whether it changed or not, thereby reading “1” or “0”
respectively.

Naturally, there are timing constraints involved.
For example, the receiver must conclude its ﬁrst
global state extraction before the sender is allowed
to send its packets, and the sender must conclude
its global state modiﬁcation (if it takes place) before
the receiver is allowed to send packets for its sec-
ond global state extraction. Additional timing con-
straints are required for Windows covert channels.

Our attacks work best against network-wise idle (or
almost idle) target hosts. Organic traﬃc may inter-
fere with our techniques, although a minimal amount
of traﬃc can be easily mitigated by adding some mar-
gins to the threshold parameters. For example, our
Linux technique (Section 5.1) expects an increase of
no more than ∆t · f in some counter when the ma-
chine is idle. When some traﬃc happens to use that
counter, it is incremented further, say by up to n
In such case, we choose
packets per ∆t time slice.
M > n + ∆t · f (instead of M > ∆t · f ). A mild
amount of traﬃc can be mitigated by introducing re-
dundancy (e.g. majority over three same-bit trans-

9

(a)

(b)

(c)

(d)

Figure 1: Network Diagram for (a) Firewall Piercing Exﬁltration; (b) Exﬁltration (via DMZ); (c)
Exﬁltration between Co-Resident Containers; (d) Host Alias Detection and de-NATting

missions) and/or error correction codes (e.g. Reed-
Solomon [42]).

4.2 Source Address Spooﬁng and

Sender Privileges

We demonstrate our UDP attacks using the
Speciﬁcally, the sender sends
HTTP/3 protocol.
QUIC Initial packets [27] to the target host, and the
receiver sends Initial packets and receives QUIC re-
sponse packets. We demonstrate our TCP attacks
In both
using the HTTP/1.1 and SSH protocols.
cases, the attack uses open UDP/TCP port on the
target device. In our ICMP attacks, we use the stan-
dard, built-in ICMP Echo Request-Reply mechanism,
which is commonly open3 to the Internet.
In Ap-
pendix A we report that 89% of the widely-used In-
ternet hosts/ﬁrewalls surveyed responded to ICMP
Echo requests.

In the ﬁrewall bypassing scenarios, we focused on
data exﬁltration attacks, but in general, the opposite
direction – sending data into an internal network – is
also possible. This can facilitate e.g. a Command &
Control channel for the malware. We demonstrated
this direction in one test (LF-1).

3We do not consider opening ICMP to the Internet a secu-
rity vulnerability. The security issue is with the implementa-
tion of the underlying IP layer.

For the Linux and Windows attacks, the sender needs
to be able to spoof the source IP address of its pack-
ets. This requires the sender to have root privileges
on a machine which is on an internal network. With
root privileges, spooﬁng is typically trivial, using e.g.
raw sockets or libpcap. The ﬁrewall’s SAV protec-
tion still allows a device on the internal network (the
sender) to send packets with a source address from
the same (internal) network to the ﬁrewall or to the
DMZ. This suﬃces for our ﬁrewall subversion and
exﬁltration attacks. For the host alias resolution at-
tacks where the sender is on the Internet, SAV em-
ployed by ISPs may prevent address spooﬁng. Ac-
cording to [35, Fig. 4], 11.9%-30.5% of the ASes do
not employ such ﬁltering on their customers (out-
bound ﬁltering), hence can be used by the attacker to
send spoofed packets from. Naturally, the attacker
is free to choose such a network, thus having enough
non-ﬁltering networks guarantees that the attacker
can mount the attack. We conclude therefore that
packet spooﬁng over the Internet is feasible, hence
the Linux and Windows host alias resolution attacks
over the Internet are practical.

10

Firewall + NATInternetReceiverSenderInternal NetworkFirewall + NATInternal NetworkDMZInternetTarget HostSenderReceiverFirewall + NATInternal NetworkInternetSenderReceiver3rdpartyContainerIsolatedContainerHostFirewall / NATInternetSender+ReceiverTarget Host #1Target Host #2?=4.3 Firewall Piercing Exﬁltration

This use case places minimal requirements on the net-
work topology. The attacker’s goal is to exﬁltrate in-
formation from a compromised machine (the sender)
in a well guarded enterprise network. It is assumed
that the sender cannot send packets to the Internet.
Fig. 1a illustrates the network topology (each net-
work has its own background color, blue arrows rep-
resent direct communication, bold black lines deﬁne
network boundaries enforced by the ﬁrewall).

The attacker uses an ICMP-based covert channel
to exﬁltrate one bit at a time from the sender to the
receiver. The only requirement is that the ﬁrewall
responds to ICMP Echo requests both from the In-
ternet and from the internal network.

4.4 Firewall Subversion and Exﬁltra-

tion (via DMZ)

In this use case, the attacker’s goal is to exﬁltrate in-
formation from a compromised machine (the sender)
in a well guarded enterprise network. It is assumed
that the sender cannot send packets to the Internet
directly. Fig. 1b illustrates the network topology.
The sender can send and receive packets to/from a
server host in a DMZ segment of the enterprise net-
work (the target host). This server serves both in-
ternal clients such as the sender, and external Inter-
net clients such as the receiver. The target host is
protected by a stateful ﬁrewall both from the inter-
nal network and from the Internet. The ﬁrewall also
enforces SAV between the three networks (internal
network, DMZ and Internet).

The attack uses the covert channel to exﬁltrate
one bit from the compromised machine (the sender)
through the target host (the DMZ server) to the at-
tacker machine on the Internet (the receiver).

4.5 Exﬁtration via Co-Resident Con-

tainers

A special case of the exﬁltration technique described
in Section 4.4 is exﬁltration between containers.
Fig. 1c illustrates this attack scenario. In this case,
there are two co-resident containers on the same host

(kernel), which are supposedly completely isolated.
The “isolated container” resides in a completely iso-
lated local network, shown as the green network in
Fig. 1c. The other container, depicted as “3rd party
container” can belong to any entity, and is only re-
quired to run an Internet-facing service in the pro-
tocol designated for exﬁltration. None of these con-
tainers is assumed to be controlled by the attacker.

A malicious sender that resides on the local net-
work can exﬁltrate data to an Internet receiver using
the same technique described in Section 4.4, assum-
ing the global state is shared between the containers.
In a variation of this use case (not depicted in
Fig. 1c), the sender may be malware running on the
isolated container, without root privileges. Such a
sender can use 127.x.y.z as local address destinations,
instead of spooﬁng packet source addresses.

4.6 Host Alias Resolution, De-
Co-Residency
and

NATting
Detection

In this use case, the attacker’s goal is to determine
whether two endpoints reside on the same host (even
across containers, if possible) or not. The attacker is
an Internet machine, and the endpoints are located
behind a stateful ﬁrewall. The attacker runs both
the sender logic and the receiver logic, thus there is
no importance in distinguishing between the receiver
and the sender, and we will use the term “attacker”
for both. The attack applies the receiver logic to one
endpoint, and the sender logic, speciﬁcally writing
the bit “1”, to the other endpoint. If both endpoints
reside on the same host, the receiver will read the
bit “1”, but if the two endpoints reside on diﬀerent
hosts, then writing to one host does not aﬀect the
other host, and the receiver will read the bit “0”.
This use case is illustrated in Fig. 1d. If the speciﬁc
covert channel works across containers, then so will
this attack.

Since the attack implementations for host alias res-
olution and de-NATting are identical, we will hence-
forth use the term “host alias resolution” to denote
both, and we will note whether the attack also applies
to container co-residency detection, per case.

11

5

Leakage

Information
Covert Channels:
States in Protocol Fields

and
Global

We now show the existence of information leakage in
the ICMP/IPv4 and UDP/IPv4 implementations of
some popular server operating systems, and in the
TCP implementation of NetBSD. The information
leakage enables the receiver – a client of the server –
to obtain information on the state of the server. We
then show how to exploit this weakness to construct
a covert channel, in which a sender client, typically
running on a diﬀerent machine than the receiver, sig-
nals a bit by forcing the server state to meet a certain
condition or fail to meet the said condition. Thus, the
receiver and sender engage in a covert channel proto-
col in which the sender sends an arbitrary bit to the
receiver. Our attacks share some common principles,
but diﬀer in their technical details between operating
systems. In some cases, our techniques can also be
applied to TCP/IPv4.

5.1 Linux Connection-Less IPv4 ID

The global state that enables a covert channel is the
IP ID counter used by the target host to send pack-
ets to the receiver, i.e. β[R] (deﬁned in Section 3.1)
where

R =

h(IP RCVR, IP TARGET , proto, net key) mod 2048

The sender needs to send packets to the target
rapidly. When the sender can force the target to send
more than f packets per second from β[R], the re-
ceiver will be able to detect this by sampling packets
generated by the target host using the β[R] counter,
and observe that β[R] incremented at a rate > f .
Whereas when the target host does not receive sender
packets, β[R] will increment at a rate ≤ f .

There is a problem with the above approach,
though. The probability of the sender’s IP address
1
hash to collide with R is
2048 . The solution is sim-
ple: note that the sender needs only to force the tar-
get host to send packets whose IP ID is generated
using β[R]. The sender does not need to actually

receive and read those packets. And so, the sender
can simply craft packets that elicit the target host’s
response, spoof the source address of these packets
(to an unused internal network IP address), go over
enough source addresses to practically guarantee that
one of the responses uses β[R] (as explained below),
and thereby fulﬁll the condition for the attack.

We now expand the above technique into a covert
channel. For simplicity, we assume that the receiver
owns a single Internet IP address, however practi-
cally, we expect the attack to be mounted with a re-
ceiver that owns multiple IP addresses. Assume the
receiver can sample the target host at ∆t intervals,
1
∆t . Denote by M an attack
i.e. at a frequency of
parameter (threshold) ∆t · f ≤ M (cid:28) 216. Ideally, M
should be minimal to reduce the required bandwidth
of both parties (and also to avoid wrapping around),
yet should take into consideration possible noise and
jitter, i.e. M should be slightly higher than ∆t · f .
The sender chooses a list of IP addresses that will
be used for spooﬁng. The list length L is a function
of the acceptable probability p of bit read error (for
bit “1”), which happens when all L addresses do not
elicit an answer that uses β[R]. We choose a parame-
ter Λ, such that p = (1− 1
2048 < 0.001, i.e.
Λ ≥ 14148. For a receiver with a single IP address,
we set L = Λ (in our experiments, we rounded this
down to L = 14000). Assume the sender can send B
packets per second. Then transmitting one bit takes
(2M −1)·L
B

seconds. The attack works as follows:

2048 )Λ ≈ e− Λ

B

i.e.

• Receiver: During the transmission time of a
for (2M −1)·L
single bit,
seconds, the re-
ceiver samples the target host at intervals ∆t
and records the IPv4 ID ﬁeld of the server pack-
ets – ID i.
It then checks, for each i > 0, if
(ID i − ID i−1) mod 216 ≥ M + 1. If this is met
for any i > 0, then the bit transmitted is deter-
mined to be “1”. Otherwise the bit is determined
to be “0”. We show below that it is guaranteed
that the sender increments the IP ID counter by
at least M for one interval, and the receiver’s
ﬁrst sample increments it at least by 1, hence a
signalled interval should have an increment of at
least M + 1.

12

• Sender: To send a bit “1”, the sender goes
through the L addresses, and for each, spoofs
2M − 1 packets originating from the address and
whose destination is the target host, during a ∆t
time interval, over ICMP or the UDP protocol
of choice. To send a bit “0”, the sender does
nothing.

∆t

The sender needs to send 2M −1
packets per second
from each spoofed address, since there is no expec-
tation to synchronize the time the sender’s packets
arrive at the target host, with the time the receiver’s
packets arrive at the host. All 2M − 1 packets from
the same spoofed address should be sent in rapid suc-
cession. By sending 2M − 1 packets at an arbitrary
∆t interval, the sender ensures that at least one ∆t
interval sampled by the receiver will have at least M
sender packets in it. In other words, the sender can
send a burst of 2M − 1 packets from one spoofed ad-
dress (assuming this takes less than ∆t) and move on
immediately to the next spoofed address.

Note that for this technique to yield correct re-
sults, no other network traﬃc emitted by the target
host, other than to the sender and to the receiver,
must be using the β[R] counter. This is a reason-
able assumption, since the probability of the host’s
outbound traﬃc to a random address to use β[R] is
1
2048 .

This covert channel works across containers. Even
though the net key introduces dependency in the
container for which the hash is calculated, the β table
itself is shared among all containers. Since the attack
does not rely on having the same hash function for
the receiver and the sender, it follows that the at-
tack covers the case wherein the receiver is served by
one container, and the sender is served by another
container.

The covert channel also works across protocols
(protocol=1 for ICMP, 17 for UDP), by the above
argument.

Ideally, the attack is carried out with a receiver
that owns n (cid:29) 1 IPv4 addresses. In such a case the
sender needs to spoof only L = Λ
n IPv4 addresses
(similar to the birthday paradox), and thus the at-
tack speeds up by a factor of n. This requires the re-
ceiver to send an aggregate of n
∆t packets per second

to the host. The receiver needs to ﬁrst ensure that
each IP address it owns uses an exclusive counter.
For this, the receiver can employ the techniques de-
scribed in [31, Section 6] to detect collisions in pairs of
IP addresses, and remove one address from each such
pair, which results in a collision-free list. Also, once
the receiver knows which IP addresses have counters
that collide with those of the sender’s addresses, the
receiver can send packets only to these IP addresses,
which saves bandwidth. Moreover, for the ﬁrewall
piercing attack, the sender (assuming it is on the in-
ternal network) cannot spoof too many IP addresses,
since the addresses it spoofs are on the ﬁrewall’s local
network4, and thus the ﬁrewall has to have them in
its ARP cache, which is limited in size. As long as
there are less than gc thrash1 (defaults to 128) ARP
entries, garbage collection will not run [33], there-
fore the sender must keep the number of spoofed ad-
dresses below 128 (e.g. L = 127). This is feasible
as explained above when the receiver can listen on
n ≥ (cid:100) Λ

127 (cid:101) IP addresses.

The limiting factors in this attack are the sender’s
bandwidth (vs. M ·L), and the network jitter between
the receiver and the host (vs. ∆t) as a jitter value
close to ∆t may cause the receiver’s probe packets to
arrive at the host out of order.

See Appendix A.1.1 for an improved attack variant
wherein feedback from an opposite direction channel
is used to signiﬁcantly reduce the traﬃc, bandwidth,
and number of addresses required for the channel.

Linux generates the IPv6 Identiﬁcation header ex-
tension ﬁeld in a very similar manner, and using the
same table.
IPv6 fragmentation attacks are out of
scope for this research.

5.2 Windows Server IPv4 ID

5.2.1 Information Leakage

Suppose at time t, a receiver at IPv4 address IP 1
received a packet from a Windows Server target host
at IP 2, with IPv4 identiﬁer ID, and at time t(cid:48)(cid:48) > t,
the receiver received a second packet from the target

4This restriction does not apply to other attack scenarios,
since there, the sender and the target host reside on diﬀerent
networks.

13

host, with IPv4 identiﬁer ID (cid:48)(cid:48). ID originated from
a Path object indexed by (IP 1,IP 2), at time t. ID (cid:48)(cid:48)
originated from a Path object indexed by (IP 1,IP 2),
at time t(cid:48)(cid:48). If the Path object indexed by (IP 1,IP 2)
remained intact in the time window [t, t(cid:48)(cid:48)] then ID (cid:48)(cid:48) =
ID + 1 mod 216. However, if, at some time t(cid:48), t <
t(cid:48) < t(cid:48)(cid:48), this Path object was purged, then the second
packet originated from a freshly created Path object,
whose IPv4 ID is initialized with a random value, i.e.
ID (cid:48)(cid:48) = ID + 1 mod 216 with probability 2−16. The
leakage then is whether a purge occurred at time t(cid:48)
or not.

The purge timing is essential for the leakage to oc-
cur. One restriction is t(cid:48) − t ≥ 60s, as only Path
objects whose last access time is over 60 seconds ago
are purged. Another restriction relates to the ex-
act purge timing of the Path object. As we will see
below, there may be up to 20000 Path objects in the
PathSet (or even a bit higher, if the target host is not
completely idle). Since the purge rate is 2000/sec, it
may take up to 10 seconds for the speciﬁc Path object
to get purged. Therefore, the additional condition is
t(cid:48)(cid:48) − t(cid:48) ≥ 10s.

From the above t(cid:48)(cid:48) − t ≥ 70s, i.e. the minimal time
between receiver samplings is 70 seconds. We also
need take into account the fact that the ﬂood de-
tection triggering consumes another second, i.e. the
probes have to be 71s apart. Practically, we need
to pad this a bit to accommodate for Path objects
that organically get inserted into PathSet during the
normal system run. An additional 1s accommodates
2000 such objects.

Interestingly, due to a bug in Windows, oftentimes
there is an additional purge sequence right after the
ﬁrst purge sequence, taking additional 5 seconds in
our use case. This additional purge sequence does
not interfere with our covert channel, because if it
extends a few seconds beyond the next probe, that
probe will not be aﬀected, as it is not stale.

It should be noted that a leakage does not occur
across containers (compartments), since each com-
partment maintains its own IPv4 PathSet.

5.2.2 Covert Channel

The receiver and the sender have synchronized trans-
mission cycles. The receiver samples the IPv4 ID of
the host at the beginning and at the end of every
transmission cycle, by sending K UDP requests that
elicit UDP answers from the host, and observing the
IPv4 ID of the host packets. Multiple requests are
needed to cater for packet loss. The receiver deter-
mines that the transmitted bit is “0” if the diﬀer-
ence (modulo 65536) between the IDs is less than the
number of packets sent to the host during the cycle –
2K. Otherwise, the bit is determined to be “1”. The
choice of K can be arbitrary, as long as the value is
very small, with very little impact on the channel’s
performance.

The sender signals a bit “0” by not doing anything
during the transmission cycle. This guarantees that
the Path object in the host, that belongs to the re-
ceiver, is not purged, and therefore the IPv4 IDs will
remain sequential for the end-of-cycle probe. On the
other hand, for the bit “1”, the sender needs to force
that Path object to get purged. In the end-of-cycle
probe, the receiver will be assigned a new Path ob-
ject, with a random IPv4 ID base, which is very likely
to fall outside the range for bit “0”.

Thus, to transmit the bit “1”, the sender needs
to inﬂict a purge cycle on the target host. For this,
the sender can trigger the PathSet ﬂood detection,
by forcing the target host to send packets to 10000
diﬀerent IP addresses in a single second. Since the
ﬂood detection is measured in intervals of 0.5 sec-
onds (5000 new Path objects per 0.5 second), this
ensures that ﬂood detection will be triggered. In the
QUIC use case, the sender can achieve this by sending
QUIC Initial packets (1228 bytes at the IP layer) from
spoofed IP addresses to a UDP port on the target
host listening to a protocol that is on top of QUIC,
e.g. HTTP/3. The target host is then obliged to send
a QUIC response to the IP address from which the
packet allegedly originated. The required bandwidth
is therefore 98.24Mb/sec, well below the limit of mod-
ern WiFi and Ethernet networks, and an achievable
upload speed by ﬁber Internet connections.

This attack’s performance is conditional upon the
sender having bandwidth of at least 10000 packets/s

14

in the chosen protocol, and takes at least 71s per bit.
A “1” bit can be interpreted as a “0” when the new
Path object contains an IP ID that accidentally falls
into the range allowed for bit “0”. This happens with
probability 2K/65536, and only for “1” bits. Therefore,
the bit error rate is K/65536.

Note that this attack is not disruptive. Organic
Path objects are indeed removed from the PathSet,
but only if their last access time was over 60 seconds
ago. This means that two IPv4 packets/fragments
generated over 60 seconds apart may have the same
IPv4 ID, with probability 1/65536. This is not an issue
since it is highly unlikely that the ﬁrst fragment will
not be reassembled at the destination for this long.

An Internet attack cannot be mounted over ICMP,
because Windows only responds to ICMP Echo re-
quests from the local network.

collisions is:

Pr{C = 0} =

(cid:89)

0≤i,j<K

(1 − Pr{IDj+M+K = IDi})

≤

(cid:89)

(1 − 1/65536) ≈ e− K2

65536

0≤i,j<K

Since K2

65536 (cid:29) 1 this probability is negligible.

To summarize, we described a covert channel, in
which the receiver forces the target host to send back
K packets, then the sender forces the target host to
send back M packets (or none at all), and ﬁnally the
receiver forces the target host to send back additional
K packets. The receiver looks for collisions in the
IPv4 IDs of the two K packet sets. If collisions are
found, the receiver infers that the sender interacted
with the target host (bit “1”).
If no collisions are
found, the receiver infers the sender did not interact
with the target host (bit “0”).

5.3 macOS

Server

(Connection-
Less Transport Protocols) and
OpenBSD IPv4 ID

For two IPv4 ID values ID 0, ID m sampled m > 0
packets apart, we have (recall that M is the unique-
ness interval):

Pr{ID m = ID 0} =

(cid:40) 0

m ≤ M

1/(65536+m−2M−1) M < m ≤ 2M
≈ 1/65536

2M < m

Thus when we sample two IPv4 ID values, we can
statistically distinguish between a case where m(cid:48) ≥
M packets were generated in between (in such case,
Pr{ID m(cid:48)+1 = ID 0} ≥ 1/65536) and a case where m(cid:48) <
M packets were generated (Pr{ID m(cid:48)+1 = ID 0} = 0).
Practically, the receiver ﬁrst gets K packets from the
target host, as rapidly as possible. Then the sender
forces the target host to send M packets to signal the
bit 1, and no packets to signal the bit 0, and ﬁnally
the receiver gets additional K packets. K should be
picked such that K 2 (cid:29) 65536 and 2K < M (ideally
K (cid:28) M). The receiver now checks whether there
are any collisions between the two sets. When a bit
“0” is transmitted, we clearly have Pr{C = 0} = 1.
When a bit “1” is transmitted, the probability of no

The limiting factors for this attack is the receiver’s
bandwidth (vs. K) and the sender’s bandwidth (vs.
M). The jitter (assuming low values) has almost
no signiﬁcance here, as the order of packet arrival
is unimportant neither for the sender, nor for the re-
ceiver. And since both the sender and the receiver are
required to send thousands of packets, which takes a
lot more time than the typical jitter, the bandwidth
overshadows the jitter as a dominant factor.

See Appendix A.1.2 for a stealthier variant of this

attack.

In macOS 11.3 and above, an ICMP Echo rate limit
is imposed, with a threshold value in the range 251-
500 chosen at random once per boot, and applied to
1-2 second intervals. When the rate limit is exceeded
in an interval, the ICMP Echo response is generated
with probability inversely proportional to the excess
ICMP Echo request packets. That is, if the random
rate limit is R and N > R ICMP Echo requests were
already received in the interval then the next ICMP
1
N −R .
Echo request will be answered with probability
The above attack can be mounted almost as-is by
throttling it to under 125 packets/s. But a more ef-
ﬁcient attack can simply take advantage of the rate
limit to signal bits. To signal “1”, the sender sends a
burst of e.g. 600 ICMP Echo requests (which guaran-
tees an excess of at least 100 requests, thus ensuring

15

that subsequent ICMP Echo requests in that time
period has a probability ≤ 1
100 to be answered by
macOS). The sender does nothing for “0”. The re-
ceiver then sends an ICMP Echo request to the host,
which is always answered if the sender sent nothing
(“0”), but is not answered (with probability > 0.99)
if the sender sent 600 requests. This procedure needs
to be fortiﬁed with some error correction logic (to
take care of the occasional response from the server
even in the case the rate limit was exceeded). Thus
a single bit can theoretically be signalled in two sec-
onds. Due to logistic reasons, we could not test this
attack.

5.4 NetBSD TCP ISN

The TCP ISN -based global state is the number
of TCP connections established since boot (modulo
256).

The covert channel works as follows: the receiver
sends a TCP SYN packet to the NetBSD target host,
and records the most signiﬁcant 8 bits of the ISN
in the target host’s SYN+ACK response – m. The
sender then sends two or more TCP SYN packets
to the host, for bit “1”, or no packets for bit “0”.
Finally, after ∆t time, the receiver sends a TCP SYN
packet to the host, and records m(cid:48) from the host’s
SYN+ACK response. Then if (m(cid:48) − m) mod 256 >
1 + (cid:100)2∆t(cid:101), there was another connection served by
the target host, i.e. the sender signalled the bit “1”,
otherwise the sender signalled “0”.

The attack requires that the jitter be much smaller

than ∆t.

Note that unlike the well known sequential IPv4
ID attack for NetBSD, our attack also works
with TCP/IPv6, and can combine TCP/IPv6 and
TCP/IPv4 senders and receivers.

5.5 Additional Attacks

We also found additional new attacks against some
of the above operating systems, that are disruptive
and/or inferior in performance (packets required) to
the attacks described above. For sake of complete-
ness, we describe these attacks in Appendix A.2.

Note that if/when the attacks described above are ad-
dressed by the respective operating system vendors,
the attacks in Appendix A.2 may take their place as
the most eﬀective attacks (unless they are ﬁxed as
well).

5.6 Practical Considerations

5.6.1 RTT

Our attacks require some synchronization between
the time of arrival of the sender packets and the
receiver packets, at the target host.
Interestingly,
such synchronization is not aﬀected by the RTT it-
self, assuming each party knows its RTT to the tar-
get host beforehand. For simplicity, let us assume a
ﬁxed, symmetric RTT. In order for a packet to ar-
rive at time t to the target host, the sending party
needs to send it at time t− RT T
, assuming the party’s
machine time itself is synchronized. In reality, RTT
is not ﬁxed, and the RTT variance, or jitter, deter-
mines the synchronization granularity. Likewise, in
reality, RT T
is only an approximation to the end-to-
end time between two parties – the actual value may
diﬀer somewhat due to asymmetry in routing paths.
This unknown quantity can also be accumulated into
the synchronization granularity.

2

2

Moreover, in our attacks, each packet sent by the
sender and by the receiver is independent of the
previous packets, i.e.
the attacks are entirely non-
adaptive. This means that neither party needs to
wait for any response (to a previous packet) to arrive
from the target host, before sending the next packet.
Therefore, there is no signiﬁcance to the RTT in tim-
ing the attacks. The only exception is some TCP/IP
attack scenarios wherein one or two parties send an
RST in response to the host’s SYN+ACK answer.
The RST packet contains the host-generated TCP
sequence number from the host’s SYN+ACK, and
thus it relies on a previous packet from the host, i.e.
subject to RTT. However, sending the RST packets
can be done in parallel with the attack’s main packet
stream, and thus the RTT does not aﬀect the overall
attack time in this case as well.

16

5.6.2 Jitter and Bandwidth

The limiting factor for the attack speed is the sender’s
bandwidth (which we throttle for some attacks) and
the jitter, which is typically at milliseconds granu-
larity. In fact, due to its typically low value, jitter
is a limiting factor only in Linux and NetBSD, and
the sender bandwidth is a limiting factor in Linux,
OpenBSD and macOS. In Windows, the attack time
is dominated by the 60s time-to-live limit imposed
on stale Path objects, and is thus unaﬀected by jitter
and bandwidth (except that it requires the sender to
be able to send 10000 packets/s bursts).

traﬃc bandwidth (in terms of packets/s) be lower
than the bandwidth generated by the sender (or more
precisely – lower that the threshold that the reader
interprets as a signalled bit “1”). Raising this thresh-
old can compensate for interference. The Windows
technique can easily compensate several thousands
IP tuples (our experiment setup actually already has
such compensation in place) by allowing a bit more
time for purging them (purging 2000 tuples takes 1s).
The Linux technique is aﬀected by interference only if
the speciﬁc bucket used for the communication hap-
pens to also serve organic traﬃc, which is very un-
likely (probability 1
2048 per destination IP address).

5.6.3 Synchronization between the Sender

and the Receiver

We assume that the sender and receiver machines are
synchronized at 0.1s resolution. This is a fair as-
sumption, given the accuracy of present day hardware
clocks, combined with NTP which keeps the clocks
from drifting [40]. Thus the sender and receiver can
decide on a UTC time (in seconds) when they begin
the exﬁltration session. Since the exﬁltration tech-
niques are based on the receiver polling the state be-
fore and after the sender, the receiver can poll 0.1s
before the bit transmission start time, and poll again
0.1s after the bit transmission end time (all times are
in the target’s time frame, i.e. both sender and re-
ceiver should compensate based on their respective
RTTs, by transmitting at their t − RT T
). This com-
pensates up to 0.1s synchronization oﬀset between
the sender and the receiver. A coarser-grained syn-
chronization (e.g. 0.2s) can be accommodated via
increasing the bit transmission time by 0.2s.

2

5.6.4

Interference (Organic Outbound Traf-
ﬁc from the Target Host)

In the ﬁrewall piercing scenario, using ICMP, the ﬁre-
wall can be considered idle in terms of network traﬃc,
since the vast majority of the traﬃc it handles is as a
router, where the ﬁrewall is not required to generate
e.g. IPv4 IDs.

In general, our techniques are not sensitive to a
mild level of interference. The macOS and OpenBSD
techniques only require that the organic outbound

5.6.5 Packet Loss

Our techniques are not sensitive to a mild level of
packet loss.
In general, the attacks need a certain
number of packets, or a certain rate of packets in
order to succeed. Packet loss can be compensated
by increasing the number/rate of packet sent accord-
ingly.

5.6.6 Stealth vs. Throughput

We throttle the sender’s bandwidth to 100Mb/s-
150Mb/s in order not to disrupt the normal network
usage on a 1Gb/s LAN. Note that in all cases (except
Windows) we could get an almost order of magnitude
improvement in the exﬁltration bit rate by consum-
ing almost all the 1Gb/s LAN bandwidth, though this
can disrupt the network functionality for other LAN
users and end up in exposing the channel. On the
other hand, we could throttle the sender and receiver
much further, reducing the throughput, but also
the probability to get ﬂagged by network IPS/IDS.
Speciﬁcally, the NetBSD TCP ISN technique only re-
quires a few TCP connections per second, and the
Linux technique’s sender bandwidth can be reduced
by a factor of n if the receiver controls n IP addresses.
Additionally, see Appendix A.1.2 for stealthier attack
variants against macOS and OpenBSD.

17

6 Experiments

6.1 A Setup for the Exﬁltration (via
DMZ) and Firewall Piercing Ex-
periments

The exﬁltration experiments have the target host and
the sender on 1Gb/s Ethernet network (the lab net-
work in Israel). This network is connected to
the Internet via a ﬁrewall+NAT device. Where
possible, we ran two tests per attack: one with the
receiver in a transcontinental location A (Azure Am-
sterdam data center), 3300Km from the target host,
and one with the receiver in a transatlantic location
B (Azure US east coast data center), 9600Km from
the target host. We also measured the RTT aver-
age and standard deviation (the latter is indicative
of the network jitter) between the two locations and
the lab network. The average RTT for A is 79.9ms,
with standard deviation 0.3ms, and the average RTT
for B is 146.9ms with standard deviation 1.4ms. This
is slightly better than the results reported in 2014 [43]
which is expected in light of the Internet technology
improvement over the last seven years.

A single exﬁltration test transmits 128 bits from
the sender on the internal network, to the receiver
on the Internet. This message size was chosen as a
benchmark since it demonstrates that AES-128 keys
can be exﬁltrated in a reasonable amount of time.

Where needed, we used libpcap to craft arbitrary
network packets, particularly for spooﬁng the source
IP address of packets, and for accurate timing of
packets and packet bursts.

For HTTP/3 server (over QUIC and UDP), we
used Caddy Server with the experimental http3
directive. For SSH server (over TCP), we used
OpenSSH, and for HTTP/1.1 server (over TCP) we
used Apache Web Server. We used Docker version
19.03.8 for the Linux containers.

services reside on the same host (kernel). To imple-
ment this, the attacker runs a sender logic for bit “1”
against one service, and a receiver logic against the
other service. If the receiver logic reads “1”, then the
two services run on the same host. If the receiver logic
reads “0”, then the services run on diﬀerent hosts.

To demonstrate that our results are not randomly
correct, we conducted a series of 10 bit “1” transfers,
for each of the following conﬁgurations:

• Target addresses on the same host

• (Where applicable) target addresses in diﬀerent

containers on the same host (kernel)

• Target addresses in diﬀerent hosts

The expected result for the ﬁrst two conﬁgura-
tions, where the addresses are served by the same
kernel, is an all-“1” readout. The last conﬁguration
is expected to result in an all-“0” readout, since the
sender changes the state of one kernel, but the re-
ceiver probes another kernel. In other words, assum-
ing correct results in the above tests, we are able
to tell apart a situation in which the two target ad-
dresses are served from the same host (kernel), and a
situation in which they are served from two diﬀerent
hosts. This demonstrates host alias resolution, in-
cluding across containers, as well as de-NATting and
container co-residency detection.

We could only test host alias resolution with Linux,
Windows and OpenBSD, because we only had one in-
stance of macOS and NetBSD in our lab. We tested
Linux and Windows with an attacker in the lab, be-
cause the test involves the attacker spooﬁng packet
source IP addresses, and we categorically do not run
such tests over the Internet. With OpenBSD, there
is no need to spoof packet source IP addresses, and
thus it was tested with an attacker in location A.

Other aspects or the experiment are identical to

the ones described in Section 6.1.

6.2 A Setup for the Host Alias Reso-

lution Experiments

Given two services (designated by IP address and
port), host alias resolution (and de-NATting) pro-
vides a single bit of information – whether the two

6.3 Description of the Hosts and the

Network

The target hosts used in the experiments are listed
in Table 4. All hosts are located in our lab network,

18

Table 4: Hosts

OS
Ubuntu 20.04 Linux
(Linux kernel 5.8.12)
Windows 20H2
build 9042.685
macOS Big Sur 11.1
(xnu-7195.60.75-1)

OpenBSD 6.8

NetBSD 9.1

Hardware
Dell E7450: Intel i7-5600U CPU,
16GB RAM, 1Gb/s Ethernet (USB)

Intel i7-3770 CPU, 16GB RAM, 1Gb/s Ethernet

MacBook Air Model A1466: Intel i5-5250U CPU,
8GB RAM, 1Gb/s Ethernet (Thunderbolt)
Dell E7450: Intel i7-5600U CPU,
16GB RAM, 1Gb/s Ethernet (USB)
Intel NUC7CJYH: Intel Celeron J4005 CPU,
8GB RAM, 1Gb/s Ethernet

Protocol

Service

Server SW

UDP/IPv4 HTTP/3

Caddy 2.2.0

UDP/IPv4 HTTP/3
TCP/IPv4 HTTP/1.x Apache 2.2.25

Caddy 2.2.0

UDP/IPv4 HTTP/3

Caddy 2.2.0

UDP/IPv4 HTTP/3
TCP/IPv4
TCP/IPv4
TCP/IPv6

SSH
SSH
SSH

Caddy 2.2.0
OpenSSH 8.4
OpenSSH 8.0
OpenSSH 8.0

which is a 1Gb/s Ethernet network connected to the
Internet over IPv4, through a ﬁrewall + NAT device.

6.4 Experiment Descriptions

Our results are summarized in Table 5. Only the
sender and receiver locations are listed – the target
host is always on the lab net (except for OF-1). Col-
umn “Section” refers to the below sections for further
information. An empty cell indicates the results are
self explanatory.

6.4.1 Linux Exﬁltration (via DMZ) over

UDP/IPv4

In tests LE-1 and LE-2 (locations A and B, resp.), the
target is an Intel x64 machine, therefore f =250Hz.
The covert channel was deﬁned with ∆t = 10ms
(considerably lower values are not usable due to the
jitter). Theoretically, we could have used M = 3 with
this ∆t, but we set M = 6 to eliminate the occasional
timing deviation in sampling caused by jitter. Due
to logistic and budgetary constraints, the receiver in
our experiments used only a single IP address.

During the preliminary tests, we noticed that the
target machine’s CPU was mildly loaded during the
transmissions of the bit “1”. This is not expected
to happen in a production system, where the server
hardware is typically much more powerful than our
Dell machine. However, given the Dell machine’s
CPU load, one could argue that the eﬀects we observe

have to do with CPU load (either due to application
processing, or due to network processing). Ironically,
this points at another potential covert channel – mea-
suring the eﬀects of CPU load on the network traf-
ﬁc shape. But as we mention above, this is unlikely
to happen in a production network, where the CPU
power is more in balance with the network capacity.

To make sure the eﬀect we measure is only related
to the IPv4 ID information leakage, we altered the
channel deﬁnition for the purpose of the experiment.
Instead of staying idle (not transmitting anything)
for bit “0”, in the experiment, we transmit the same
amount of packets, but using a small subset of 90
spoofed source IP addresses whose counters do not
collide with the receiver’s counter. A-prioi, choosing
90 counters out of 2048 yields a good likelihood of
this condition to be met. A-posteriori, we can verify
this easily. If the receiver’s IP address IP ID counter
does collide with one of the 90 counters, the vector
of bits the receiver reads will be all 1’s. We veriﬁed
this is not the case. This revised experiment ensures
that the host’s CPU load is comparable for both “0”
and “1” bits.

Given the above results, we estimate that the bit
error rate in this channel is below 0.004. In this case,
simple error correction code can be used to correct
any sparse errors.

19

Table 5: Experiments

OS

Linux

Windows

macOS

OpenBSD

NetBSD

Test
LE-1
LE-2
LE-3
LE-4
LF-1
LF-2
LA-1a
LA-1b
LA-1c
WE-1
WE-2
WE-3

WE-4

WA-1a
WA-1b
ME-1
ME-2
OE-1
OE-2
OE-3

OE-4

OF-1
OF-2
OF-3
OA-1a
OA-1b
NE-1
NE-2
NE-3

NE-4

Test Scenario
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (container)
Exﬁltration (container)
Firewall Piercing (IPﬁre, slow)
Firewall Piercing
Alias Resolution (1 host)
Alias Resolution (2 containers)
Alias Resolution (2 hosts)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)

Exﬁltration (via DMZ)

Alias Resolution (1 host)
Alias Resolution (2 hosts)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)

Exﬁltration (via DMZ)

Firewall Piercing (slow)
Firewall Piercing (Esdenera ruleset, slow)
Firewall Piercing
Alias Resolution 1 host
Alias Resolution 2 hosts
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)
Exﬁltration (via DMZ)

Exﬁltration (via DMZ)

Protocol
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
ICMP/IPv4
ICMP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
TCP/IPv4
UDP/IPv4 (Sender),
TCP/IPv4 (Receiver)
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
UDP/IPv4
TCP/IPv4
UDP/IPv4 (Sender),
TCP/IPv4 (Receiver)
ICMP/IPv4
ICMP/IPv4
ICMP/IPv4
UDP/IPv4
UDP/IPv4
TCP/IPv4
TCP/IPv4
TCP/IPv6
TCP/IPv6 (Sender),
TCP/IPv4 (Receiver)

Sender
Lab Net Loc. A
Lab Net Loc. B
Lab Net Loc. A
Lab Net Loc. B
Lab Net Lab Net
Lab Net Lab Net
Lab Net Lab Net
Lab Net Lab Net
Lab Net Lab Net
Lab Net Loc. A
Lab Net Loc. B
Lab Net Loc. A

Receiver Bits/Repetitions
128
128
128
128
128
128
10
10
10
128
128
128

Success
128/128
128/128
128/128
128/128
128/128
128/128
10/10
10/10
10/10
128/128
128/128
128/128

Bit rate
400 b/h
400 b/h
400 b/h
400 b/h
400 b/h
3000 b/h
N/A
N/A
N/A
47.4 b/h
47.4 b/h
41.4 b/h

Lab Net Loc. A

Lab Net Lab Net
Lab Net Lab Net
Lab Net Loc. A
Lab Net Loc. B
Lab Net Loc. A
Lab Net Loc. B
Lab Net Loc. A

Lab Net Loc. A

Loc. B
Lab Net
Lab Net Lab Net
Lab Net Lab Net
Loc. A
Loc. A
Loc. A
Loc. A
Lab Net Loc. A
Lab Net Loc. B
Lab Net Lab Net

Lab Net Loc. A

128

10
10
128
128
128
128
128

128

128
128
128
10
10
128
128
128

128

128/128

47.4 b/h

10/10
10/10
128/128
128/128
128/128
128/128
128/128

N/A
N/A
1800 b/h
1800 b/h
720 b/h
720 b/h
360 b/h

128/128

720 b/h

128/128
128/128
128/128
10/10
10/10
128/128
128/128
128/128

720 b/h
1200 b/h
4200 b/h
N/A
N/A
7200 b/h
7200 b/h
7200 b/h

128/128

7200 b/h

Section
6.4.1
6.4.1
6.4.2
6.4.2
6.4.3
6.4.3

6.4.4
6.4.4
6.4.5

6.4.6
6.4.6
6.4.7
6.4.7
6.4.8

6.4.9
6.4.9
6.4.9

6.4.10
6.4.10
6.4.11

20

6.4.2 Linux Exﬁltration via Containers over

UDP/IPv4

The LE-3 and LE-4 tests (locations A and B resp.)
are very similar to the previous section, with two co-
resident containers running on a single host (kernel).
The sender resides in the internal (isolated) network,
communicating with the internal (isolated) container
over HTTP/3, and the receiver resides on the Inter-
net, communicating with the second container over
HTTP/3. In all other aspects, these tests are identi-
cal to the one in the previous section.

we simulated Windows Server on a Windows 10 plat-
form. This was done by setting TcpipIsServerSKU to
1 and the default compartment’s IPv4 PathSet purge
threshold (32 bit quantity at oﬀset 332 of PathSet)
to 32768. This made the system behave identically to
Windows Server for the purpose of our experiments.
For the channel deﬁnition, we used K = 6. A single
bit transfer took 76s (theoretically this could be done
with 71s per bit, but due to technical issues, and
to make sure the channel can handle some organic
network traﬃc, we padded it by 5s).

6.4.3 Linux

Firewall

Piercing

over

ICMP/IPv4

Due to technical reasons, we could only conduct the
Linux ﬁrewall piercing attacks in the lab. For test LF-
1, we installed a typical Linux-based ﬁrewall image
(IPﬁre 2.25 (x86 64) running Linux kernel 4.14.112)
on a dedicated device, and conﬁgured it to block com-
munications between the internal “green” network
and the external “red” network (an Internet-facing
lab network). We then ran our attack, but for sim-
plicity of testing, we sent data from the red network
to the green network. The data transfer rate was
limited by the sender machine’s eﬀective bandwidth
– we could only send up to ≈14,000 ICMP packets/s.
A stronger sender machine would have achieved a
higher throughput.

In order to compare the speed of ICMP exﬁltration
to that of QUIC/UDP exﬁltration, we conducted an-
other experiment (LF-2), this time using the same
target machine as in 6.4.1. We used a stronger sender
that was able to send ≈130,000 ICMP packets/s, and
the throughput was 1.2 bits/s (3000 b/h), which is
7.5 times faster than the QUIC/UDP variant. Here
too, we could use a stronger sender to get even higher
exﬁltration throughput.

6.4.4 Windows

Server Exﬁltration

(via

DMZ) over UDP/IPv4

We did not have at our disposal a Windows Server
on a network that allows spooﬁng, so instead, for
tests WE-1 and WE-2 (locations A and B, resp.),

6.4.5 Windows Exﬁltration (via DMZ) over

TCP/IPv4

In experiment WE-3, we demonstrated that the
Windows covert channel can be used over TCP. In
essence, this is a very similar experiment to the one
described in Section 6.4.4, but this time we used TCP.
The sender sent SYN packets with spoofed source IP
address to the target host. These packets are short
(40 bytes at the IPv4 level) and can be transmitted
rapidly. Assuming the spoofed IP addresses are not
associated with any machines, there will not be any
transmission from these IP addresses following the
spoofed SYN packets. Windows responds immedi-
ately with a SYN+ACK packet, with additional two
retransmissions (the default “Max SYN Retransmis-
sions” is 2) at exponential backoﬀ, so the ﬁrst retrans-
mission is sent after an “Initial Retransmission Time-
Out” seconds, henceforth IRTO (in Windows Server,
by default IRTO=3s), and the second retransmission
packet is sent 2 · IRTO after the ﬁrst retransmission.
These packets are not answered of course, so ﬁnally
Windows sends an RST packet, 4·IRTO seconds after
the third SYN+ACK packet is sent (7·IRTO seconds
after the SYN packet is received). Therefore, Win-
dows sends the last packet to a spoofed IP address
21s after a SYN is received from it. This overlaps
with the 10 seconds the receiver needs to wait after
the sender’s burst in order for the purge to be con-
cluded, so only 11 seconds are actually added to the
In a lab
time-per-bit compared to the UDP case.
experiment, we found that Windows’ SYN cache is
not exhausted even by 13000 half-open connections,
thus our technique for TCP/IPv4 in Windows is non-

21

disruptive.

6.4.8 OpenBSD Exﬁltration (via DMZ) over

As for the receiver, we implement it to send an
RST packet to the target host as soon as the target
host’s SYN+ACK arrives at the receiver, thus the
Path object’s last access time is only extended by
the RTT between the target host and the receiver,
having a negligible impact on the attack timing.

We carried out the experiment similar to Sec-
tion 6.4.4, with the modiﬁed attack timing. Since we
used Windows 10 as a target host, we had to adjust its
Initial RTO value to 3000ms to simulate Windows
Server (the default Windows 10 value is 300ms).

6.4.6 macOS Exﬁltration (via DMZ) over

UDP/IPv4

In tests ME-1 and ME-2 (locations A and B, resp.),
the channel was deﬁned with K = 700, thus ensuring
that the probability for a sent bit “1” to be received as
“0” is very low (1/1767). The sender transmitted 5000
packets per bit. Theoretically, the sender needed to
send 4096 packets to signal the bit “1”, but in prac-
tice, due to server responsiveness issues, we had the
sender send some extra packets. With throttling, this
took 0.39 seconds. Due to some overheads incurred
by our speciﬁc test implementation, each bit trans-
mission took two seconds.

6.4.7 OpenBSD Exﬁltration (via DMZ) over

UDP/IPv4

In tests OE-1 and OE-2 (locations A and B, resp.),
the channel was deﬁned with K = 700, thus ensuring
that the probability for a sent bit “1” to be received
as “0” is very low (1/1767). The sender transmit-
ted 40000 packets per bit. Theoretically, the sender
needed to send 32768 packets to signal the bit “1”,
but in practice, due to server responsiveness issues
issues, we had the sender send 40000 packets. This
took 3.32 seconds. Due to some overheads incurred
by our speciﬁc test, each bit transmission took 5 sec-
onds.

TCP/IPv4

In test OE-3, the sender sent SYN packets to the
target host. Both the sender and the receiver were
implemented to send an RST packet to the target
host as soon as the target host’s SYN+ACK arrives
at the sender/receiver, to ensure no retransmissions
clutter the network and that the host’s SYN cache
is not overﬂowed, since the pending connection is re-
moved from it once the RST packet for it arrives.

We throttled the sender to about 6000 packets/sec
in order to make sure the host’s TCP SYN cache is
not exhausted (the OpenBSD SYN cache size limit
is 10255 entries). Due to the throttling, the time per
bit was extended to 10s.

6.4.9 OpenBSD Firewall Piercing

Test OF-1 was conducted over the Internet, with a
very weak machine running OpenBSD 6.7 in Location
B. That machine could only handle ≈9,000 ICMP
Echo Requests per second, which set the constraint
on the throughput. We achieved a single bit transfer
in 5s.

We also ran in-the-lab tests with ﬁrewalls (we could
not deploy Internet-facing ﬁrewalls).
In test OF-2,
we simulated an OpenBSD-based ﬁrewall. For this,
we used a PF ruleset we extracted from an Esden-
era Firewall-3 installation [39]. This ruleset explic-
itly allows ICMP traﬃc to and from the ﬁrewall, on
all interfaces. We tested OpenBSD 6.9 in this case.
In test OF-3, we measured the speed of the attack
with a sender capable of sustaining ≈68,000 ICMP
Echo Requests per second, against the usual Dell tar-
get running OpenBSD 6.8, which can serve ≈260,000
Echo Requests per second. We obtained a 0.85s bit
transfer time, but using a stronger sender machine
can signiﬁcantly increase this ﬁgure.

6.4.10 NetBSD Exﬁltration (via DMZ) over

TCP/IPv4

Our covert channel for NetBSD over IPv4 is not
in itself interesting, because NetBSD already has a
TCP/IPv4 covert channel in the form of its global

22

IPv4 ID counter. However, we wanted to empha-
size the applicability of our TCP/IPv4 technique
over the Internet since we cannot demonstrate our
TCP/IPv6 technique over the Internet due to tech-
nical constraints. By demonstrating our TCP/IPv4
covert channel over the Internet, we infer that the
same holds for our TCP/IPv6 channel.

In our NE-1 and NE-2 experiments (with senders at
A and B, resp.), we set ∆t=0.2s, with total time per
bit 0.5s (this is due to some limitations of our testing
code, and we note that theoretically NetBSD’s covert
channel can be run at much higher speeds), thus the-
oretically threshold for m − m(cid:48) should have been 2,
but we set it to 3 to avoid false positives from occa-
sional TCP connections established with the target
host.

6.4.11 NetBSD Exﬁltration (via DMZ) over

TCP/IPv6

In test NE-3 we had to use a local receiver since our
lab does not have IPv6 connectivity to the Internet.

7 Remediation and Suggestions

We begin with the easy parts, in which the attack
can be completely eliminated:

• TCP/IPv4 packets, and IPv4 packets with
DF=1 – these packets can have ID=0 or a com-
pletely random ID. In Linux, all TCP packets,
and UDP packets whose length is below the
PMTU are sent with DF=1.
In Windows and
macOS, all TCP packets are sent with DF=1.
in macOS, the TCP packets have
Moreover,
ID=0, which demonstrates that simply setting
ID=0 suﬃces for these cases. Note that e.g.
QUIC requires setting DF=1 in UDP [27, Sec-
tion 14], but Caddy Server leaves the choice of
DF to the operating system.

• TCP ISN – this ﬁeld should not contain state in-
formation, i.e. should contain random data and
client information only.

• IPv6 Flow label (see Appendix A.2.2 and Ap-
pendix A.2.3) – can be chosen at random (i.e.

using a “regular” PRNG). There is no RFC re-
quirement for the ﬂow label to have a unique
value in any time duration.

In some operating systems, a built-in ﬁltering func-
tionality facilitates overriding a protocol ﬁeld value
with a ﬁxed/random value. See Appendix A.3 for
Linux nftables examples.

The

case

challenging

is UDP/IPv4

(and
ICPMv4/IPv4) ID with DF=0. In this case, there is
a real need for the ID ﬁeld to be non-repeating to
some extent. We can make the following suggestions
to reduce the attack surface and eliminate some
attack variants, but the underlying issue is still in
eﬀect even with our suggestions:

• Maintain a separate IPv4 ID state according to
the destination address: one state for RFC1918
destination addresses (internal networks) and
another state for external destinations. This
eliminates the exﬁltration attacks where the
sender is on an internal network and can only
spoof internal network addresses.

• Maintain an IPv4 ID generator state per service
(i.e. per a listening IP address and port). This
eliminates the host alias resolution attacks. A
weaker version is to maintain a state per listening
IP address.

• Maintain an IPv4 ID generator state per con-
tainer – this eliminates the cross-container at-
tacks.

Another approach is to ensure that connection-less
transport protocols emit IPv4 packets whose length
is below a reasonably chosen minimal PMTU, and
simply set DF=1 and ID=0 for all these packets.
For example, DNS over UDP/IPv4 can function with
message length limit of 512 bytes (540 bytes includ-
ing UDP and IPv4 headers), QUIC over UDP/IPv4
can function with message length limit of 1200 bytes
(1228 bytes including UDP and IPv4 headers), and
ICMP Echo Requests whose size exceeds PMTU can
be discarded.
Finally,

it is possible to simply randomize the
IP ID, which guarantees maximum security, at the
expanse of somewhat increased malformed/dropped

23

packet rate (due to the possible ID collisions and their
eﬀect on fragment reassembly).

Note that ICMP rate limits do not eliminate the
covert channels: even an aggressive per-destination
rate limit is ineﬀective against the attack, as the at-
tacker may use multiple, possible spoofed, source IP
addresses. A global rate limit, on the other hand, fa-
cilitates a covert channel via overﬂowing (or not) the
packet counter.

8 Conclusions

We conclude that global states in network protocols
of server hosts can be exploited in various ways to
weaken the security of networks where such hosts re-
side, and to glean information on the implementation
of services which is otherwise abstracted from their
consumers.

While a global state can be as obvious as an in-
cremental counter, we also demonstrated that it can
take a more subtle form. For example in the case
of OpenBSD and macOS IPv4 ID, the observation
of collisions in IPv4 ID values (or lack thereof) is an
indication of the internal global state, which is not di-
rectly exposed to the attacker. Other such non trivial
examples are the Linux IPv4 ID generation scheme,
and the Windows IPv4 ID generation scheme.

Our work focused on ﬁrewalled hosts, which is a
very common scenario for Internet-facing servers. A
stateful ﬁrewall eliminates many known information
leakage attacks, and therefore poses a serious obsta-
cle for techniques that rely on information leakage
via a global protocol state. We described three new
attack scenarios based on information leakage via a
global protocol state: ﬁrewall piercing, exﬁltration
form a secure network, and exﬁltration across con-
tainers. We demonstrated our three new scenarios,
as well as a host alias resolution scenario and a host
alias resolution across containers scenario. All these
scenarios were demonstrated with the sender (and
the host, where applicable) behind a ﬁrewall, in re-
alistic conditions, and over the Internet where possi-
ble. We also demonstrated some cross protocol at-
tacks, e.g. where the sender uses UDP/IPv4 and
the receiver uses TCP/IPv4, and where the sender

uses TCP/IPv6 and the receiver uses TCP/IPv4. We
measured the exﬁltration bandwidth achieved, and
found it to be suﬃcient for e.g. key material exﬁltra-
tion in hours or minutes.

The problem of secure IPv4 ID generation seems
to be theoretically intractable, due to the conﬂicting
requirements – generating long sequences of unique
values, at least per (IP SRC , IP DST ) and leaking no
information, while maintaining a “reasonably sized”
state, which is much smaller than the number of ex-
pected concurrent tuples. Intuitively, this is due to
the pigeonhole principle, as it is impossible to main-
tain an independent state per tuple with less bits than
the number of concurrent tuples. However, we do
list some recommendations that considerably reduce
the attack surface and speciﬁcally address the attacks
scenarios we described.

It is important to understand that information
leakage from network protocol global states can af-
fect the security of networks and systems in surprising
and unexpected ways. In our research, we highlight
three novel attack scenarios. It is quite possible that
additional attack scenarios exist, and thus there is
room for future research on this topic.

9 Vendor Status

All vendors were notiﬁed on January 27th, 2021.

• Linux issued a patch [18] for kernel version 5.13-
rc1 that signiﬁcantly increases the size of the β
table. This patch was back-ported to versions
5.12.4, 5.11.21, LTS branches 5.10.37, 5.4.119,
4.19.196, 4.14.238, 4.9.274 and 4.4.274. Back-
ports to all 4.x branches were provided by us
based on the back-port to the 5.x versions. This
issue is tracked as CVE-2021-45486.

Linux also issued a patch replacing the exist-
ing IPv6 ID algorithm (similar to the IPv4 ID
algorithm) with a completely randomized IPv6
ID [48] which is included in version 5.14-rc1,
and was back-ported to kernel versions 5.13.3,
5.12.18, 5.10.51, 5.4.133, 4.19.198, 4.14.240,
4.9.276 and 4.4.276. This issue is tracked as
CVE-2021-45485.

24

• Microsoft informed us on March 15th, 2021,
that “[Microsoft] determined your ﬁnding does
not meet our bar for servicing”.

• Apple released a ﬁx for the IPv4 ID issue in ma-
cOS 12.1 [6], macOS 11.6.2 [5], macOS 10.15 [8],
iOS/iPadOS 15.2 [4] tvOS 15.2 [9] and watchOS
8.3 [7].

The ICMP rate limit issue was reported to Ap-
ple separately on June 11th, 2021, and regarding
it, Apple informed us on July 21st, 2021, that
“while we [Apple] do not see any security impli-
cations, we have forwarded it on to the appro-
priate team to investigate for potential future
enhancements”.

• OpenBSD has not responded to multiple re-
quests for status, has not informed us about any
decision/resolution, and has not ﬁxed the issue
in their public source code repository.

• NetBSD produced a patch [38] for NetBSD
9.2 that better randomizes the TCP ISN (CVE-
2021-45488),
(CVE-2021-
IPv6 Flow Label
45489) and IPv6 ID (CVE-2021-45484). This
patch also switches the NetBSD implementation
of the IPv4 ID ﬁeld from a simple counter to a
random number generator (CVE-2021-45487).

Acknowledgment

2019/10/25/udp-idle-scanning/,
2019.

October

[3] Geoﬀrey Alexander, Antonio M. Espinoza, and
Jedidiah R. Crandall. Detecting tcp/ip connec-
tions via ipid hash collisions. Proceedings on Pri-
vacy Enhancing Technologies, 2019(4):311 – 328,
01 Oct. 2019.

[4] Apple. About the security content of ios 15.2
and ipados 15.2. https://support.apple.com/
en-us/HT212976, December 2021.

[5] Apple. About the security content of macos
big sur 11.6.2. https://support.apple.com/
en-us/HT212979, December 2021.

[6] Apple. About the security content of macos
monterey 12.1. https://support.apple.com/
en-us/HT212978, December 2021.

[7] Apple. About the security content of macos
monterey 12.1. https://support.apple.com/
en-us/HT212975, December 2021.

[8] Apple. About the security content of security
update 2021-008 catalina. https://support.
apple.com/en-us/HT212981, December 2021.

[9] Apple. About the security content of tvos
https://support.apple.com/en-us/

15.2.
HT212980, December 2021.

We would like to thank Benny Pinkas, the anonymous
NDSS 2022 reviewers and Haixin Duan (our NDSS
shepherd) for their valuable feedback, and Ehood Po-
rat for his help in reverse engineering some parts of
Windows code.

[10] Steven M. Bellovin. A Technique for Counting
Natted Hosts. In Proceedings of the 2Nd ACM
SIGCOMM Workshop on Internet Measurment,
IMW ’02, pages 267–272, New York, NY, USA,
2002. ACM.

References

[1] Maurizio Aiello, Alessio Merlo, and Gianluca Pa-
paleo. Performance assessment and analysis of
dns tunneling tools. Logic Journal of IGPL, 21,
03 2012.

[2] Martin Albrecht.

Udp

idle

scanning.

https://martinralbrecht.wordpress.com/

[11] Robert Beverly, William Brinkmeyer, Matthew
Ipv6 alias res-
Luckie, and Justin P. Rohrer.
olution via induced fragmentation. In Matthew
Roughan and Rocky Chang, editors, Passive and
Active Measurement, pages 155–165, Berlin, Hei-
delberg, 2013. Springer Berlin Heidelberg.

[12] Chad Brubaker, Amir Houmansadr, and Vi-
taly Shmatikov. Cloudtransport: Using cloud
In
storage for censorship-resistant networking.

25

Emiliano De Cristofaro and Steven J. Murdoch,
editors, Privacy Enhancing Technologies, vol-
ume 8555 of Lecture Notes in Computer Science,
pages 1–20. Springer, 2014.

[13] Elie Bursztein. Time has something to tell us
In ´Ulfar
about network address translation.
Erlingsson and Andrei Sabelfeld, editors, Proc.
12th Nordic Workshop on Secure IT Systems
(NORDSEC 2007), Iceland, October 2007. Uni-
versity of Reykjavik.

[14] Y. Cao, Z. Qian, Z. Wang, T. Dao, S. V.
Krishnamurthy, and L. M. Marvel. Oﬀ-path
tcp exploits of the challenge ack global rate
limit. IEEE/ACM Transactions on Networking,
26(2):765–778, 2018.

[15] Yue Cao, Zhongjie Wang, Zhiyun Qian,
Chengyu Song, Srikanth V. Krishnamurthy, and
Paul Yu. Principled unearthing of tcp side chan-
nel vulnerabilities.
In Proceedings of the 2019
ACM SIGSAC Conference on Computer and
Communications Security, CCS ’19, pages 211–
224, New York, NY, USA, 2019. ACM.

[16] Weifeng Chen, Yong Huang, Bruno F. Ribeiro,
Kyoungwon Suh, Honggang Zhang, Edmundo
de Souza e Silva, Jim Kurose, and Don Towsley.
Exploiting the ipid ﬁeld to infer network path
and end-system characteristics.
In Constanti-
nos Dovrolis, editor, Passive and Active Net-
work Measurement, pages 108–120, Berlin, Hei-
delberg, 2005. Springer Berlin Heidelberg.

[17] George Danezis. Covert communications de-
spite traﬃc data retention. In Bruce Christian-
son, James A. Malcolm, Vashek Matyas, and
Michael Roe, editors, Security Protocols XVI -
16th International Workshop, Cambridge, UK,
April 16-18, 2008. Revised Selected Papers, vol-
ume 6615 of Lecture Notes in Computer Science,
pages 198–214. Springer, 2008.

[18] Eric Dumazet.

inet: use bigger hash table
https://git.kernel.

for IP ID generation.
org/pub/scm/linux/kernel/git/stable/
linux.git/commit/net/ipv4/route.c?id=

aa6dd211e4b1dde9d5dc25d699d35f789ae7eeba,
March 2021.

[19] Roya Ensaﬁ, Jong Chun Park, Deepak Kapur,
Idle port scanning
and Jedidiah R. Crandall.
and non-interference analysis of network proto-
col stacks using model checking.
In Proceed-
ings of the 19th USENIX Conference on Secu-
rity, USENIX Security’10, pages 257–272, USA,
2010. USENIX Association.

[20] Xuewei Feng, Chuanpu Fu, Qi Li, Kun Sun, and
Ke Xu. Oﬀ-path tcp exploits of the mixed ipid
In Proceedings of the 2020 ACM
assignment.
SIGSAC Conference on Computer and Commu-
nications Security, CCS ’20, page 1323–1335,
New York, NY, USA, 2020. Association for Com-
puting Machinery.

[21] X. Gao, Z. Gu, M. Kayaalp, D. Pendarakis,
and H. Wang. Containerleaks: Emerging secu-
rity threats of information leakages in container
clouds. In 2017 47th Annual IEEE/IFIP Inter-
national Conference on Dependable Systems and
Networks (DSN), pages 237–248, USA, 2017.
IEEE Computer Society.

[22] Yossi Gilad and Amir Herzberg. Fragmentation
Considered Vulnerable. ACM Trans. Inf. Syst.
Secur., 15(4):16:1–16:31, April 2013.

[23] Mordechai Guri, Assaf Kachlon, Ofer Hasson,
Gabi Kedma, Yisroel Mirsky, and Yuval Elovici.
Gsmem: Data exﬁltration from air-gapped com-
puters over GSM frequencies. In 24th USENIX
Security Symposium (USENIX Security 15),
pages 849–864, Washington, D.C., August 2015.
USENIX Association.

[24] Mordechai Guri, Yosef Solewicz, Andrey
Daidakulov, and Yuval Elovici. Acoustic data
exﬁltration from speakerless air-gapped com-
puters via covert hard-drive noise (‘diskﬁltra-
In Simon N. Foley, Dieter Gollmann,
tion’).
and Einar Snekkenes, editors, Computer Secu-
rity – ESORICS 2017, pages 98–115, Cham,
2017. Springer International Publishing.

26

[25] Mordechai Guri,

Zadov,

Andrey
Boris
Daidakulov, and Yuval Elovici. xled: Covert
data exﬁltration from air-gapped networks via
switch and router leds.
In 2018 16th Annual
Conference on Privacy, Security and Trust
(PST), pages 1–12, 2018.

[26] Veit Hailperin. Misusing tcp timestamps.
https://www.scip.ch/en/?labs.20150305,
March 2015.

[27] Jana Iyengar and Martin Thomson. QUIC: A
UDP-Based Multiplexed and Secure Transport.
RFC 9000, May 2021.

[28] Dan Kaminsky.

Black ops of dns – the
https://www.

black hat brieﬁngs 2004.
blackhat.com/presentations/bh-usa-04/
bh-us-04-kaminsky/bh-us-04-kaminsky.
ppt, 2004.

[29] Amit Klein. OpenBSD DNS Cache Poisoning
and Multiple O/S Predictable IP ID Vulner-
ability.
https://dl.packetstormsecurity.
net/papers/attack/OpenBSD_DNS_Cache_
Poisoning_and_Multiple_OS_Predictable_
IP_ID_Vulnerability.pdf, February 2008.

[30] Amit Klein. Cross layer attacks and how to use
them (for dns cache poisoning, device tracking
and more). In 2021 2021 IEEE Symposium on
Security and Privacy (SP), pages 927–944, Los
Alamitos, CA, USA, May 2021. IEEE Computer
Society.

[31] Amit Klein and Benny Pinkas. From IP ID
In 28th
to Device ID and KASLR Bypass.
USENIX Security Symposium (USENIX Secu-
rity 19), pages 1063–1080, Santa Clara, CA, Au-
gust 2019. USENIX Association.

[32] T. Kohno, A. Broido, and k. Claﬀy. Remote
physical device ﬁngerprinting.
IEEE Trans-
actions on Dependable and Secure Computing,
2(2):93–108, May 2005.

[33] Linux.

arp(7) — linux manual page.

https://man7.org/linux/man-pages/man7/
arp.7.html.

[34] Mark Lucas, Abhishek Singh, Chris Cantrell,
and Anne Henmi. Firewall Policies and VPN
Conﬁgurations. Syngress Publishing, Rockland,
MA, 2006.

[35] Matthew Luckie, Robert Beverly, Ryan Koga,
Ken Keys, Joshua A. Kroll, and k claﬀy. Net-
work hygiene, incentives, and regulation: De-
ployment of source address validation in the in-
ternet. In Proceedings of the 2019 ACM SIGSAC
Conference on Computer and Communications
Security, CCS ’19, page 465–480, New York, NY,
USA, 2019. Association for Computing Machin-
ery.

[36] Xiapu Luo, Edmond W. W. Chan, and Rocky
Crafting web counters into
K. C. Chang.
In Hein Venter, Mariki Eloﬀ,
covert channels.
Les Labuschagne, Jan Eloﬀ, and Rossouw von
Solms, editors, New Approaches for Security,
Privacy and Trust in Complex Environments,
pages 337–348, Boston, MA, 2007. Springer US.

[37] Steven J. Murdoch. Hot or not: Revealing hid-
den services by their clock skew. In Proceedings
of the 13th ACM Conference on Computer and
Communications Security, CCS ’06, page 27–36,
New York, NY, USA, 2006. Association for Com-
puting Machinery.

[38] NetBSD.

NetBSD Security Advisory 2021-
001: Predictable ID disclosures in IPv4 and
IPv6.
http://ftp.netbsd.org/pub/NetBSD/
security/advisories/NetBSD-SA2021-001.
txt.asc, March 2021.

[39] Esdenera Networks. Esdenera ﬁrewall 3. https:

//www.esdenera.com/firewall-3/.

[40] ntp.org.

Ntp faq – how accurate will my
http://www.ntp.org/ntpfaq/

clock be?
NTP-s-algo.htm#Q-ACCURATE-CLOCK, 2003.

[41] Liran Orevi, Amir Herzberg, Haim Zlatokrilov,
and Dolev Sigron. DNS-DNS: DNS-based De-
NAT Scheme.
https://www.researchgate.
net/publication/320322146_DNS-DNS_
DNS-based_De-NAT_Scheme, January 2017.

27

[42] I. Reed and G. Solomon. Polynomial codes over
certain ﬁnite ﬁelds. Journal of The Society for
Industrial and Applied Mathematics, 8:300–304,
1960.

[43] SamKnows. Quality of broadband services in
the eu. Technical report, European Commision,
October 2014.

[44] Salvatore Sanﬁlippo.

new tcp scan method.
http://seclists.org/bugtraq/1998/Dec/79,
December 1998.

[45] Sushrut Shringarputale, Patrick McDaniel,
Kevin Butler, and Thomas La Porta. Co-
residency attacks on containers are real.
In
Proceedings of the 2020 ACM SIGSAC Confer-
ence on Cloud Computing Security Workshop,
CCSW’20, page 53–66, New York, NY, USA,
2020. Association for Computing Machinery.

[46] Neil Spring, Ratul Mahajan, David Wetherall,
and Thomas Anderson. Measuring isp topolo-
gies with rocketfuel. IEEE/ACM Trans. Netw.,
12(1):2–16, February 2004.

[47] Yang Tao, Gang Hu, Bingnan Hou, Zhiping Cai,
Jing Xia, and Cheang Chak Fong. An alias reso-
lution method based on delay sequence analysis.
Computers, Materials & Continua, 63(3):1433–
1443, 2020.

id

for

use

ipv6:
generation.

[48] Willy Tarreau.
dom u32()
//git.kernel.org/pub/scm/linux/kernel/
git/torvalds/linux.git/commit/?id=
62f20e068ccc50d6ab66fdb72ba90da2b9418c99,
May 2021.

pran-
https:

[49] Dr. Joseph D. Touch. Updated Speciﬁcation of

the IPv4 ID Field. RFC 6864, February 2013.

[50] Wikipedia

contributors.
the

Stateful

ﬁre-
encyclopedia.

wall — Wikipedia,
https://en.wikipedia.org/w/index.php?
title=Stateful_firewall&oldid=987652216,
2020. [Online; accessed 25-November-2020].

free

[51] Apostolis Zarras. Leveraging internet services
to evade censorship. In Proceedings of the 19th
Information Security Conference (ISC), 2016.

[52] Xu Zhang, Jeﬀrey Knockel, and Jedidiah R.
Crandall. ONIS: Inferring TCP/IP-based Trust
Relationships Completely Oﬀ-Path.
In INFO-
COM, pages 2069–2077, Los Alamitos, CA,
USA, 2018. IEEE.

[53] Xiaofeng Zheng, Chaoyi Lu, Jian Peng, Qiushi
Yang, Dongjie Zhou, Baojun Liu, Keyu Man,
Shuang Hao, Haixin Duan, and Zhiyun Qian.
Poison over troubled forwarders: A cache poi-
soning attack targeting DNS forwarding devices.
In 29th USENIX Security Symposium (USENIX
Security 20), pages 577–593. USENIX Associa-
tion, August 2020.

A Experiment: A Survey of
from Widely-
Responses
Used Internet Servers
to
UDP, TCP and ICMP Prob-
ing

We estimate the portion of widely-used Internet hosts
which do not respond to a UDP packet to a closed
i.e. hosts that do not send back an ICMP
port,
message of any type (or any non-ICMP message) for
such invalid packets. We also estimate the portion of
widely-used Internet hosts which silently drop TCP
SYN packets to closed TCP ports. Finally, we esti-
mate the portion of widely-used Internet hosts that
respond to ICMP Echo Request (via the Ping utility).
We use the top 1000 domains in the Alexa top 1M
domain list obtained on December 13th, 2020 as a
starting point. We then query for the DNS NS (name
server) record-set for each domain, take the ﬁrst NS
record from the answer, and resolve its IPv4 address
(by sending a DNS A query and take the ﬁrst record
from the answer). This yields an IP address of an au-
thoritative DNS server for the domain at hand. This
host answers UDP queries to port 53 (DNS). As such,
it serves as a model for a reliable host that runs a

28

UDP-based service, similar to a QUIC server. More-
over, since the host is an authoritative DNS server for
a popular domain, we expect it to be highly available,
i.e. we can assume there are no downtime/service is-
sues for this host. We eliminated the duplicates in the
IP address list, and ended up in a list of 748 unique
IP addresses.

UDP Closed Ports: For each IP address, we sent
a UDP packet for three randomly chosen high ports.
These UDP ports are un-assigned by IANA, and
have no popular service associated with them, hence
are very likely to be closed. We observe whether
we receive any response from the host, either over
UDP or over ICMP. As expected, the only responses
we received were ICMP Type 3 messages (“Destina-
tion Unreachable”), mostly with Code 3 (“Port Un-
reachable”), but in three cases, we received Code 10
(“Communication with Destination Host is Adminis-
tratively Prohibited”) and in two cases we received
Code 13 (“Communication Administratively Prohib-
ited”).

TCP Closed Ports: We sent three TCP SYN
packets to each port used above, and recorded
whether we received any response back. As ex-
pected, most servers that responded, did so with
an RST packet, although one server responded with
SYN+ACK on two ports, which is likely a deceptive
practice. Regardless, we count this server as respon-
sive to TCP probes for closed ports.

ICMP Echo Requests: We sent each server
three ICMP Echo Request messages, and we recorded
whether we received any ICMP Echo Reply messages
back.

The results are as follows: 116 (15.5%) servers re-
sponded to the UDP probing, and 59 (7.9%) servers
responded to the TCP probing. The overlap was
signiﬁcant – 42 servers responded to both UDP
and TCP probing. Overall, 133 (17.8%) servers re-
sponded to either UDP or TCP. 667 (89.2%) servers
replied to ICMP Echo Requests. This set almost
completely covers the set of servers that responded
to either UDP or TCP probing – the overlap was 125
servers. In other words, the ICMP probing is almost
a complete superset of the TCP or UDP probing –
it misses about 1% of the space covered by UDP or
TCP, and contributes additional 72.5% of coverage.

A.1 Improved Attacks

A.1.1

Improved UDP/IPv4 ID Attack for
Linux

B∆t

An improvement to the technique described in Sec-
tion 5.1 is as follows: assume there also exist a one-
way channel from the receiver to the sender (which
can be implemented along the same lines of the
sender-to-receiver channel). In such a case, the im-
proved technique works in two phases.
In the ﬁrst
phase, the sender singles out one spoofed IP address
which hashes to the same counter with the receiver.
For this phase, a feedback is needed from the receiver.
In the second phase, the sender needs to spoof 2M −1
packets from a single address in order to transfer a
single bit (L times more eﬃcient in packets than the
original technique), and the receiver can read one bit
per ∆t time slot, which yields a (2M −1)L
faster trans-
fer rate. In the ﬁrst phase, the sender and receiver
engage in a binary search for a spoofed address that
hashes to the receiver’s counter. This process involves
sending (2M −1)L packets in (cid:100)log2 L(cid:101) iterations. The
sender can assume, by choosing large enough L, that
at least one spoofed address will have a counter colli-
sion in the target host with the receiver’s IP address,
and the ﬁrst phase aims to ﬁnd one such spoofed
In the ﬁrst iteration, the sender picks L
address.
2
spoofed addresses and sends the bit “1”. The receiver
sends back the bit it read. If it is “1”, the sender de-
duces that there is colliding spoofed address in the
sub-list, and proceeds with the binary search on this
list. If the bit is “0”, the sender deduces that there
is a colliding spoofed address in the complementary
sub-list, and proceeds with the binary search on the
complementary sub-list. At the end of this phase,
the sender has one address which hashes to the same
counter used for the receiver’s address. The second
phase can then proceed using a single address. Note
that the second phase does not need the receiver-to-
sender channel.

A.1.2 A Stealthier IPv4 ID Attack for ma-

cOS and OpenBSD

For macOS and OpenBSD, the IPv4 ID attack can
be made stealthier by having the sender and receiver

29

run “native” QUIC sessions with the target host, for
example HTTP/3 resource downloads. For exam-
ple, the sender can request a 4.9152MB (macOS) or
39.3216MB (OpenBSD) ﬁle (or larger) from the tar-
get host. This ensures that at least 4096 (macOS)
or 32768 (OpenBSD) QUIC packets are sent from
the target host to the sender (as each QUIC packet
carries at most 1200 payload bytes). Likewise the re-
ceiver can request a 840KB ﬁle (or larger) ﬁle from
the target host to force the host to send the receiver
at least 700 QUIC packets. Of course, instead of re-
questing one ﬁle (or resource), the sender and the
receiver can request multiple resources so that the
total number of packets sent by the host is above the
respective thresholds.

This can also be applied to OpenBSD with TCP
traﬃc.
In this case, there is an additional beneﬁt,
which is that there is no pressure on the TCP SYN
cache in the target host.

A.2 Additional Information Leakage

Attacks

A.2.1 A Covert Channel via Overﬂowing the
NetBSD and OpenBSD TCP SYN
Cache

NetBSD’s TCP SYN cache is a hash table containing
293 buckets with up to 105 entries each, and with a
global limit of 10255 entries. An inbound SYN packet
is hashed into a bucket based on the source IP ad-
dress, the source port, the destination port and a
secret 64-bit key. Then a SYN+ACK is sent, and the
bucket entry becomes a half-open connection. Statis-
tically, for evenly distributed traﬃc, the global limit
is reached before any bucket becomes full. When
the global limit is reached, the half-open connection’s
bucket5 has its oldest entry removed to keep the hash
table from overﬂowing. NetBSD responds to TCP
SYN packets as follows: a ﬁrst SYN+ACK packet is
sent immediately. A second SYN+ACK is sent af-
ter three seconds and three more SYN+ACK packets

5The bucket from which the entry is removed is the ﬁrst
non-empty bucket in the list of buckets, starting from the
half-open connection’s bucket. When the traﬃc is evenly dis-
tributed, this will be the half-open connection’s bucket.

are sent with exponential backoﬀ factor of 2. This
facilitates a side channel: let us assume that the tar-
get NetBSD host has it SYN cache table relatively
empty. An observer can send K TCP SYN packets
to an open port on a NetBSD host, and then ob-
serve the SYN+ACK packets sent back from the host,
without completing the handshake. If, during the 45
second period after the SYN packets were sent, the
TCP SYN cache becomes full due to another party
sending SYN packets, and some of the old packets’
entries get evicted, the host will not send any further
SYN+ACK packets for these evicted entries. If there
were F SYN packets sent after the SYN cache became
293 )F ≈ Ke− F
full, the observer expects K(1 − 1
293
“surviving” half-open connections for which the host
continues to send SYN+ACK packets.

We now show how to turn this into a covert chan-
nel. The receiver sends K SYN packets from K dif-
ferent TCP source ports. Then the sender can send
(10255 + µ) SYN packets from diﬀerent source ports
to the host to signal the bit “1”. Note that F = K+µ,
so the receiver observes that the host continues to
send SYN+ACK only for Ke− K+µ
293 half-open connec-
tions (in expectation). To send the bit “0”, the sender
does nothing, and the receiver observes that for all
ports (up to packet loss), the host continues sending
SYN+ACK.

For example, setting K = 10, µ = 1000 yields ex-
pected 0.32 open connections (out of 10 established
by the receiver) to continue sending SYN+ACK, with
σ = 0.56 (clearly this is not normally distributed, but
this σ value still indicates that it is extremely unlikely
to get a value above 5, for example). Thus, the re-
ceiver sends 10 SYN packets to the host, the receiver
sends (or does not send) 11225 SYN packets to the
host, and if the number of half-open connections for
which the host continues to send SYN+ACK to the
receiver is less than 5, the receiver deems that the
sender signalled the bit “1”, and otherwise, the re-
ceiver deems that the sender signalled the bit “0”.

This attack is quite expensive in terms of packet
count compared to the NetBSD TCP ISN attack.
Moreover, it is disruptive, since SYN packets from
organic clients of the host may get evicted from the
SYN cache which results in TCP connection failures.
The OpenBSD SYN cache is almost identical to

30

in
the NetBSD one, with the following exception:
OpenBSD, when 100000 insertions are made to the
current TCP SYN cache, it is frozen, and another
SYN cache instance is used as the active SYN cache
for new insertions. The impact on our technique is
that about once in 9 bits, the transmission fails be-
cause the old half-open connections from the receiver
are frozen and will not be removed (until they expire
naturally).

SYN+ACK packet is 0 (however, RST packets always
carry a random ﬂow label generated with Algorithm 2
– and this facilitates idle scanning). Also, while our
interest is in NetBSD as a TCP/IPv6 server, our anal-
ysis also covers the case of ﬂow labels generated by
NetBSD as a TCP/IPv6 client. Finally, note that
our analysis can be applied, with very minor modi-
ﬁcations, to NetBSD’s IPv6 ID generation algorithm
(A2/32).

A.2.2 A Covert Channel

via NetBSD
TCP/IPv6 Flow Label – Cryptanaly-
sis

NetBSD’s TCP/IPv6 ﬂow label ﬁeld (20 bits) is gen-
erated by the A2/20 PRNG (following the naming
convention introduced in [29]). The ﬂow label ﬁeld
comprises a most signiﬁcant bit (MSB) part, and 19
least signiﬁcant bits part. The PRNG is reseeded
every 180 seconds or 200000 internal PRNG steps
(whichever comes ﬁrst). As part of the reseeding pro-
cedure, the parameters for generating the least signif-
icant 19 bits are sampled from a strong kernel PRNG,
and the MSB is ﬂipped. Since the MSB is static be-
tween reseedings, it can be ignored for the remaining
of the discussion. The algorithm is designed to pro-
duce unique outputs during two consecutive reseeding
periods. This is not a required property for IPv6 ﬂow
label, and is probably a by-product of deriving this
algorithm from the A2/16 algorithm used for IPv4
ID generation back in 2003, which does require this
uniqueness property.

The least signiﬁcant 19 bits of the PRNG are gener-
ated using Algorithm 2. Note that in this sub-section,
M denotes a parameter of Algorithm 2, instead of its
role in the main paper.
In a single PRNG invoca-
tion, the PRNG draws a random number 1 ≤ n ≤ 4
and runs n internal steps. NetBSD’s ﬂow label gen-
eration involves two invocations of the PRNG, but
only the output of the latter one is used for the ﬂow
label ﬁeld. Thus overall, ﬂow label generation con-
sumes 2-8 internal PRNG steps (5 internal steps on
average).

Note that the pseudo-random ﬂow label is only
used by a NetBSD server after the TCP connection is
established. The ﬂow label for a NetBSD TCP/IPv6

6:

7:
8:

9:

Algorithm 2 NetBSD IPv6 Flow Label Algorithm
(19 Least Signiﬁcant Bits)

1:
2:

(cid:46) M = 279936 = 27 · 37
(cid:46) N = 524269 (prime),

ϕ(N ) = N − 1 = 22 · 32 · 14563

3: procedure Reseed
4:
5:

x ← random({0, . . . , M − 1})
s1 ← random({0, . . . , 219 − 1})
s2 ← random({0, . . . , N − 2})
a ← 72·random({0,...,219−1}) mod M
b ← random({x|0 < x < M ∧ gcd(x, M ) =

1})

g
mod N

←

2random({x|0<x<N ∧gcd(x,N −1)=1})

10: procedure Generate-FlowLabel
n ← random({1, . . . , 4})
11:
for i = 1 to n do
12:
13:

x ← (ax + b) mod M
return s1 ⊕ (gx+s2 mod N )

14:

i.e.

We now cryptanalyze Algorithm 2. We assume
that an attacker collects consecutive NetBSD ﬂow
ﬂow labels generated for consecutive
labels,
TCP/IPv6 connections. We allow a certain degree
of noise, i.e. out-of-order values, and missing values.
However, we do not allow values not generated by the
algorithm in the input data. Our analysis requires a
large portion of pairs of values to be correct, where
a pair is two consecutive ﬂow label values. We do
not require all pairs to be correct though. Our crypt-
analysis uses many concepts and techniques from the
cryptanalysis of A2/20’s sibling algorithms, A0/16
and X3/16, as reported in [29]. However, applying
the techniques for the 16 bit algorithms to the 20 bit
algorithm results in an unacceptably long (though

31

2

feasible) run time – speciﬁcally, “Phase 2” in [29] in-
volves enumeration over all (N − 1) ϕ(N −1)
combina-
tions of valid s2 and g values, which for A2/20 would
yield 235.41 values, and then going over all pairs (if
some noise is expected). This can take over an hour
when run single-threaded on a modern CPU. Our aim
in the improved cryptanalysis herein is to provide an
algorithm whose speed is 4.5-5 orders of magnitude
higher than the techniques presented in [29]. Indeed,
in our test, the typical attack runtime, when running
single-threaded on a modern CPU, is less than 50ms.
in the
ﬁrst phase, we use consecutive pairs to extract s1
(with enumeration over 219 values). This is very sim-
ilar to [29, Section 3]. In the second phase, we extract
g. In phase 3, we extract s2 in part. In phase 4, we
enumerate over the possible s2 values, and we build
a and b bit by bit (almost literally). In this phase we
also need pairs.

Our cryptanalysis comprises four phases:

We assume the attacker has L individual ﬂow label
values 0 ≤ Fi < 219 (we ignore the most signiﬁcant
bit of the ﬂow label), and among them the attacker
has P pairs of consecutive ﬂow label values (Fi, F (cid:48)
i ).
Clearly, L ≥ P + 1, with equality holds when the
values are consecutive ﬂow labels.

Phase 1 – Extracting s1: Oﬄine, attacker pre-
pares a log2(·) table for {1, . . . , N − 1}, i.e. a table
wherein (2n mod N ) (cid:55)→ (n mod (N − 1)).

Online, the attacker enumerates over all possi-
ble 219 values of s1 and analyzes the pairs (Fi, F (cid:48)
i ).
For the correct guess of s1, the following will hold:
log2(Fi ⊕ s1) = (log2 g)(xi + s2) mod (N − 1), and
likewise for F (cid:48)

i . Subtracting, we get:

log2(F (cid:48)

i ⊕ s1) − log2(Fi ⊕ s1) mod (N − 1) =

(log2 g)(x(cid:48)

i − xi) mod (N − 1)

Taking modulo 12 on both sides, keeping in mind that
12|(N − 1), we get:

log2(F (cid:48)

i ⊕ s1) − log2(Fi ⊕ s1) mod 12 =

(log2 g)(x(cid:48)

i − xi) mod 12

Now, since 12|M , and since a mod 12 = 1 by con-
struction, we have x(cid:48)
i − xi mod 12 = ni · b where
ni is the number of internal steps between xi and

x(cid:48)
i (see lines 10-12 of Algorithm 2), keeping in mind
that the algorithm is executed twice per ﬂow label,
i.e. 2 ≤ ni ≤ 8. Thus:

log2(F (cid:48)

i ⊕ s1) − log2(Fi ⊕ s1) mod 12 =

((log2 g)b)ni mod 12
Note that since g is a generator in the multiplica-
log2 g is invertible modulo
tive group modulo N ,
ϕ(N ) = N − 1, as well as modulo 12. b is invert-
ible modulo M by construction, so (log2 g)b is in-
vertible modulo 12. Therefore, ((log2 g)b mod 12 is
invertible, and so can only take four values: 1, 5, 7
or 11. Each value induces a set of 7 possible values
(only) for log2(F (cid:48)
i ⊕ s1) − log2(Fi ⊕ s1) mod 12, con-
forming to the 7 possible values of ni. If ((log2 g)b
mod 12 = 1, then log2(F (cid:48)
i ⊕ s1) − log2(Fi ⊕ s1)
mod 12 ∈ {2, 3, 4, 5, 6, 7, 8}. If ((log2 g)b mod 12 =
5, then log2(F (cid:48)
i ⊕ s1) − log2(Fi ⊕ s1) mod 12 ∈
{1, 3, 4, 6, 8, 10, 11}, and so forth.

We see, therefore, that for the correct guess of s1,
the P quantities log2(F (cid:48)
i ⊕s1)−log2(Fi ⊕s1) mod 12
all belong to one of four sets of seven values (out of
12 possible values). Denote by Cj = |{i| log2(F (cid:48)
i ⊕
s1) − log2(Fi ⊕ s1) mod 12 = j}| – the number of
times the value j ∈ {0, . . . , 11} appears in the list of
values log2(F (cid:48)
i ⊕ s1) − log2(Fi ⊕ s1) mod 12. Deﬁne:

X1 = C2 + C3 + C4 + C5 + C6 + C7 + C8

X5 = C1 + C3 + C4 + C6 + C8 + C10 + C11

X7 = C1 + C2 + C4 + C6 + C8 + C9 + C11

X11 = C4 + C5 + C6 + C7 + C8 + C9 + C10

If all P pairs are true (i.e. they are indeed pairs of
consecutive outputs from the PRNG), we will have
X1 = P or X5 = P or X7 = P or X11 = P .
If
there are some false pairs among the P pairs, this
will not hold as-is, but we can still use a statistical
approach. For an incorrect s1, a single counter C ∼
N ( P
144 P ), and a sum of 7 counters has distribution
N ( 7
144 P ). Setting a threshold at 5σ yields low
probability for false positives, thus we can posit that
for the correct s1:

12 , 11
12 P, 7· 11

max(X1, X5, X7, X11) ≥

7
12

P + 5

√

√

11
12

√

7

P

32

Since P must be at least as large as this quantity,
we can derive a minimum for P : P ≥ 77, i.e. with
P = 77 true pairs (and no false pairs), the attack can
succeed, and for P > 77 it is guaranteed that if there
√
7
are at least 7
P true pairs, the correct
s1 value will survive the ﬁrst phase.

12 P + 5

11
12

√

√

At the end of phase 1, the attacker obtains s1. Ad-
ditionally, since typically, only one of X1, X5, X7, X11
exceeds the threshold, say XI where I ∈ {1, 5, 7, 11},
the attacker also learns (log2 g)b mod 12 = I, as well
as ni for all pairs:

ni =

i ⊕ s1) − log2(Fi ⊕ s1))((log2 g)b)−1 mod 12
(log2(F (cid:48)
The attacker can also discard many false pairs – pairs
for which ni < 2 or ni > 8 are obviously false. Note
that discarding a false pair does not disqualify the
two individual outputs that form it. These values
may still be useful for the second and third phases,
which do not require pairs.

Phase 2 – Extracting g: We ﬁrst note a prop-
erty of Algorithm 2. The following two seeds yield
the same output sequences, and are thus indistin-
guishable:

• (x, s1, s2, a, b, g)

• (−x mod M, s1, −M − s2 mod (N − 1), a, −b

mod M, g−1 mod N )

To ﬁnd the g used in the PRNG, the attacker needs
to enumerate over all possible ϕ(N − 1) = 174744 =
217.41 values of g. But practically, the attacker is not
interested in the exact g used in the PRNG. From
the attacker’s perspective, it is enough to be able to
predict values, and for this, either the correct seed,
or the negated seed suﬃce. In other words, the at-
tacker can make do with enumerating over half of
the g space, i.e. 216.41 values – there is no need to
cover both g and g−1. With s1 from phase 1 and
with the guess of g, the attacker obtains xi + s2
mod (N − 1) = (log2 g)−1 log2(Fi ⊕ s1) mod (N − 1)
for all L values at the attacker’s disposal (the attacker
does not need pairs in this phase, just individual ﬂow
label values).

Now the attacker can use the fact that 0 ≤
xi < M , and that M is signiﬁcantly lower than

33

N − 1. This means that for the correct g, the set
{(log2 g)−1 log2(Fi ⊕ s1) mod (N − 1)} = {xi + s2
mod (N − 1)} will have a “hole” of size of at least
N − 1 − M in its coverage of [0, N − 1). A-priori, the
attacker does not know where the hole is (because
the attacker does not know s2), but the existence of
a hole whose size is at least E = N − 1 − M = 244332
can be detected even without knowing s2, by splitting
the range of N − 1 numbers into segments whose size
is no larger than E
2 . It is then guaranteed that one
of the segments will be empty. In our case, the maxi-
mal segment size is 122166, and the attacker needs 5
segments. For simplicity, the attacker can use equal-
sized segments with (cid:100) N −1
5 (cid:101) = 104854 elements each.
For each guess of g, the attacker goes over the the list
of (log2 g)−1 log2(Fi ⊕ s1) mod (N − 1) values, and
each value is divided by the segment size to ﬁnd the
corresponding segment. The attacker stops if there
are hits in all 5 segments. In such case, the attacker
discards the guess of g and moves on to the next one.
For the correct guess of g, on the other hand, there
will be at least one segment that is not a hit by all L
values.

Interestingly, due to the algebraic properties of the
series (xi), there may be incorrect g(cid:48) values that cause
clustering in the values

(log2 g(cid:48))−1 log2(Fi ⊕ s1) mod (N − 1) =

(log2 g(cid:48))−1(log2 g)(xi + s2) mod (N − 1)
This can result in “holes” large enough to become
false positives. When the (xi) series is truly random,
this is statistically impossible, given large enough L
values (e.g. L = 100), yet when (xi) is generated via
a linear congruential generator, this does happen.

The following paragraph contains an in-depth ex-
planation of this phenomenon, and the reader can
skip it if these details are not necessary.

To demonstrate such false positive, deﬁne:

γ = (log2 g(cid:48))−1 log2 g mod (N − 1)

Then the values that cluster are (γ · xi mod (N − 1))
(we can drop s2 as it is merely a shift, and so does not
aﬀect clustering). Now consider a situation wherein
γ · b and γ · M are “small” modulo N − 1 (by that

we mean they are close to either 0 or to N − 1).
Additionally, assume that

M
gcd(a − 1, M )

(cid:0)γ · gcd(a − 1, M ) mod (N − 1)(cid:1)

(cid:28) (N − 1)

M

a−1

i.e.

gcd(a−1,M ) gcd(a − 1, M ) mod M .

For simplicity, let us assume that ni = 1 and that
xi+1 =
the series is extracted sequentially,
axi + b mod M .
Now, xi+1 − xi mod M =
(a − 1)xi + b mod M and xi(a − 1) mod M =
xi
There are
gcd(a−1,M ) possible values for this expression:
only
M
{0, gcd(a − 1, M ), 2 · gcd(a − 1, M ), · · · , (
gcd(a−1,M ) −
1) gcd(a − 1, M )}. Deﬁne ∆i = xi+1 − xi (over the
integers). Then ∆i is either ti · gcd(a − 1, M ) + b or
ti ·gcd(a−1, M )+b−M or ti ·gcd(a−1, M )+b−2M ,
M
for some 0 ≤ ti <
gcd(a−1,M ) . Note that these
expressions are over the integers (not modulo M ).
When we multiply this by γ (modulo N − 1), we
get γ · ∆i mod (N − 1) = ti · (γ · gcd(a − 1, M )
mod (N − 1)) + (γ · b mod (N − 1)) − ui · (γ · M
mod (N − 1)) where 0 ≤ ti <
gcd(a−1,M ) and 0 ≤
ui ≤ 2. Each ∆i is therefore “small” (compared to
N − 1), so xi = x0 + (cid:80)i−1
j=0 ∆j mod (N − 1) does not
get too far from x0. This explains why there may be
(few) false positives.

M

At the end of phase 2, the attacker has the cor-
rect g, perhaps along with some false positives. The
attacker also knows which segment is inside the hole
(the empty segment) for each g candidate. There may
be more than one such segment, and in such case the
attacker can choose one segment arbitrarily as the
empty segment.

Phase 3 – Eliminating the g False Posi-
tives, and Finding s2 (Partially): For each g
candidate, the attacker ﬁnds the minimum Smin and
maximum Smax of the set {(log2 g)−1 log2(Fi ⊕ s1)
mod (N −1)} = {xi +s2 mod (N −1)} such that the
range [Smin, Smax] form a continuous segment over
the integers. If the set is entirely below the empty
segment, then the minimum and maximum are taken
from the set as usual. Likewise if the set is entirely
above the empty segment.
If there are elements in
the set both above and below the empty segment,

34

then the set starts above the empty segment, wraps
around (courtesy of the modulo (N − 1)) and ends
below the empty segment. Therefore, the minimum
is taken from the entries above the empty segment,
and the maximum of the set is taken from the entries
below the empty segment, to which we add N − 1 in
order to “undo” the wrap-around.

The attacker can easily eliminate almost all false
positives for g by discarding ranges larger than M ,
i.e. discard g if Smax − Smin + 1 > M . Additionally,
the attacker can apply a heuristic that eliminates ad-
ditional, very rare false positives wherein the cluster
is too “tight”, i.e. form a range which is “too small”.
For example, the attacker can eliminate g values that
suggest Smax−Smin+1 < M
2 . Empirically, this leaves
the attacker with a single (correct) g.

Now clearly, s2 ≤ Smin and Smax ≤ s2 + M − 1.
Put diﬀerently, Smax −M +1 ≤ s2 ≤ Smin (note that
above, we discarded g candidates for which Smax −
Smin + 1 > M i.e. Smax − M + 1 > Smin, therefore
we know that Smax − M + 1 ≤ Smin; also, we allow
negative values for s2 here). We see that there are
M + Smin − Smax possible values for s2. Since Smax
is distributed like a maximum of L random variables
uniformly distributed on [0, M ), E(Smax) = L
L+1 M ,
and similarly E(Smin) = 1
L+1 M . Therefore, E(M +
Smin − Smax) = 2

L+1 M .

At the end of phase 3, the attacker has a correct g
2
L+1 M candidates for s2, which is

and an average of
the range Smax − M + 1 ≤ s2 ≤ Smin.

Phase 4 – Finding a and Possible b and s2
Values: First, we make another observation on Al-
gorithm 2. Concerning the intermediate values gen-
erated in line 13, it is easy to see that the output
sequence induced by (x, a, b) is at oﬀset +k (modulo
M ) from the output sequence induced by ((x − k)
mod M, a, (b + (a − 1)k) mod M ) for any k. Let
us assume that s2 is correct, and so are (x0, a, b).
Let us now look at an incorrect guess s(cid:48)
2 = s2 + k
mod (N − 1). This guess will lead to an (incor-
rect) internal state x(cid:48)
0 = (x0 − k) mod (N − 1).
If ∀0≤i<L(0 ≤ xi − k < M ), then x(cid:48)
i = (xi − k)
0 = x0 − k with a(cid:48) =
mod M , and we can pair x(cid:48)
a, b(cid:48) = (b + (a − 1)k) mod M to form a sequence
such that ∀0≤i<L(xi + s2 mod (N − 1) = x(cid:48)
i + s(cid:48)
2

mod (N − 1)). We see, therefore, that for every k
for which ∀0≤i<L(0 ≤ xi − k < M ), it is impossible
to distinguish the correct sequence (with s2) from a
sequence generated with s2 + k. This gives rise, how-
ever, to an attack optimization. Instead of going over
all Smax − M ≤ s2 ≤ Smin, we can choose one arbi-
trarily, because every value in this range represents a
possible s(cid:48)

2 which keeps all x(cid:48)

i in [0, M ).

There is an important caveat here. While an arbi-
trary Smax − M + 1 ≤ s(cid:48)
2 ≤ Smin is indistinguishable
from the correct s2 for all the ﬂow label values already
observed, it may happen that a future x will fall out-
side the observed cyclic range [Smin − s2, Smax − s2].
In such case, an arbitrarily chosen s(cid:48)
2 may fail to pre-
dict the correct PRNG output for x. One can think of
this “out of bounds” x value as redeﬁning – reducing
– the range of possible s(cid:48)
2. At the extreme, if the at-
tacker has outputs for xi = 0, xj = M − 1, then (and
only then) the attacker will have a singleton “range”
for s(cid:48)

2, and thus s(cid:48)

2 = s2.

in expectancy of

The larger L is, the less likely a random x is to
fall outside the range.
In fact, the number of pos-
sible “out of range” values is identical to the size of
2
L+1 M , there-
the s2 range, i.e.
fore the probability for a random x to fall “out of
range” is ≈ 2
In fact, the attacker can choose
s2 = Smax−M +1+Smin
to further reduce this probabil-
ity. Note that since negative values of s2 are possible
if Smax − M + 1 < 0, we may need to apply modulo
(N − 1) to the chosen s2.

L+1 .

2

i for F (cid:48)

After choosing s2, the attacker uses pairs again, to
ﬁnd a (the correct one) and b (which matches the
chosen s2). Given s2, g, s1 and pairs (Fi, F (cid:48)
i ) of con-
secutive ﬂow label values, the attacker can calculate
xi = (log2 g)−1 log2(Fi ⊕ s1) − s2 mod (N − 1) for
every Fi, and likewise x(cid:48)
i . The attacker also
knows ni for every such pair. The attacker starts
with a mod 12 = 1 and b mod 12 = (log2 g)−1I
mod 12. At each step, the attacker extends a and
b by log2 3 bits each. The attacker does this by
deﬁning ˜a = 12ma + (a mod 12), ˜b = 12mb + (b
mod 12) where ma, mb ∈ {0, 1, 2} and going over all
9 combinations of ma, mb. For each combination of
ma, mb, i.e.
for each candidate of a mod 36 = ˜a, b
mod 36 = ˜b the attacker goes over all P pairs with

ni (cid:54)= 3 ∧ ni (cid:54)= 6 (it is easy to see that for pairs with
ni = 3 or ni = 6, all such ˜a values yield correct
results, hence they add no information), and counts
how many pairs yield a consistent result, i.e.

˜C =

|{i|x(cid:48)

i mod 36 = ˜anixi+(˜ani−1+· · ·+1)˜b mod 36}|
Since the condition holds for all true pairs, if all pairs
are true, we expect ˜C = ˜P where ˜P = |{i|ni
(cid:54)=
3 ∧ ni (cid:54)= 6}|.
If there are false pairs, we must use
a statistical approach instead. For a false pair (and
also, when the guess of ma, mb is wrong), the prob-
ability for the condition to hold, for a single pair, is
(cid:112) ˜P ). We
3 . Hence, for a wrong guess, ˜C ∼ N ( ˜P
1
3 ,
can use a threshold of 5σ again, and determine that
a guess of ma, mb is correct if
√

2
3

√

˜C ≥

+ 5

˜P
3

(cid:112) ˜P

2
3

The attacker applies this technique repeatedly. First,
the attacker calculates a mod 2233 and b mod 2233,
then a mod 2234 and b mod 2234, etc., until the at-
tacker has a mod 2237, b mod 2237. At this point,
the attacker moves to applying the same technique
with powers of two (this time, going over all pairs
(cid:54)= 8), to get a mod 2337, b
with ni
mod 2337, etc., until the attacker gets a mod 2737 =
a mod M = a, and b mod 2737 = b mod M = b.

(cid:54)= 4 ∧ ni

At

the end of

the attacker has
this phase,
s1, g, s2, a, b. With these values, and a recent sample
of the NetBSD ﬂow label, F , the attacker can pre-
dict the next value F (cid:48) of the ﬂow label – actually, the
attacker can provide 7 possible values, one of them
is guaranteed to be correct. For simplicity, we ig-
nore the MSB prediction, which is trivial, and assume
MSB=0. Then the attacker can calculate x which was
used for generating F : x = (log2 g)−1 log2(F ⊕s1)−s2
mod (N − 1). The attacker can then enumerate over
the 7 possible values of n, for each, the attacker cal-
culates x(cid:48) = anx + (an−1 + · · · + 1)b mod M , and
from that, F (cid:48) = s1 ⊕ (gx(cid:48)+s2 mod N ). In general,
given g, s1, s2, a, b and a sample F , the attacker can
roll forward the PRNG indeﬁnitely (up to reseeding,
of course).

35

Covert Channel: This cryptanalytic result can
be employed in order to implement a covert channel
between a sender and a receiver. The receiver ﬁrst
establishes around 100 consecutive TCP connections
with the target host, extracts the IPv6 ﬂow labels,
and obtains the next PRNG internal outputs using
the cryptanalytic techniques. The sender then ei-
ther establishes four TCP connections with the target
host, to signal the bit “1”, or does nothing, to signal
the bit “0”. Finally, the receiver establishes another
TCP connection with the target host, and extracts
the ﬁnal IPv6 ﬂow label. The receiver then matches
this value to the series of eight possible future val-
ues (corresponding to the PRNG internal steps). If
a match is found in positions 2-8 of the list, then the
receiver infers that the sender did not establish four
TCP connections with the target host (because each
TCP connection incurs at least two internal steps,
and the receiver’s ﬁnal connection also consumes at
least two internal steps – altogether 10 internal steps
at the minimum). This is interpreted by the receiver
as bit “0”. Otherwise, the receiver assumes the bit
sent was “1”.

For host alias resolution use case, the attacker can
improve the basic technique a bit, since the attacker
can observe the ﬂow label received from both end-
points, and match them to the same series (for end-
points that are mapped to the same host) or not (for
endpoints that are mapped to diﬀerent hosts).

A.2.3 A Covert Channel

via NetBSD
TCP/IPv6 Flow Label Most Signiﬁ-
cant Bit

We now describe an attack against the NetBSD
TCP/IPv6 ﬂow label generation, which does not
make any use of the speciﬁc algorithm that gener-
ates the least signiﬁcant 19 bits of the ﬂow label
ﬁeld. This is a more generic attack, compared to
Appendix A.2.2, but at the price of being much less
eﬃcient, in terms of number of packets (TCP connec-
tions) required.

The attack is based on the observation that a “pas-
sive” side channel exists in the ﬂow label generator,
in the form of the timing of the MSB ﬂip. When two
TCP/IPv6 services are served from a single NetBSD

host, the MSB in their ﬂow label ﬁelds will ﬂip si-
multaneously. But when the services are served from
diﬀerent NetBSD hosts, this is unlikely to happen.

We now calculate how many TCP connections are
In general, let S be the
needed to force a reseed.
internal steps the ﬂow label PRNG executed while
generating n ﬂow labels, then S is a sum of 2n IIDs
whose distribution is uniform on {1, 2, 3, 4}. There-
), and P rob(S ≥ 200000) =
fore, S ∼ N (5n,
Φ( 5n−200000
). We can thus force an immediate al-
gorithm reseed and MSB ﬂip with probability ≈ 1
by establishing n = 41000 TCP connections with the
target host.

10n
2

10n/2

√

√

This can be turned into an “active” covert channel.
The sender and receiver agree on time t0. Shortly
before t0, the sender establishes 41000 TCP connec-
tions with the target host and forces an algorithm
reseed. Then every ∆t seconds the sender either es-
tablishes 41000 TCP connections with the target host
to send the bit “1”, or does nothing to send the bit
“0”. Every ∆t seconds the receiver establishes a sin-
gle TCP connection with the target host, and ob-
serves whether the MSB bit ﬂipped (signalling the
bit “1”) or not (“0”). ∆t should be chosen such that
the sender can establish 41000 TCP connections with
the target host during this time period. Special care
must be taken if 180 seconds elapse since the last
transmission of the bit “1”, as this will cause the bit
to ﬂip due to a 180s timeout, and may thus result in
a false positive (reading bit “1” by the receiver). To
counteract this, the sender and receiver can decide
to skip the time slice in which 180s elapsed since the
previous bit “1” was transmitted.

A.3 Linux NetFilter/nftables

NetFilter is a network ﬁltering framework which is
built into the Linux kernel. NetFilter is controlled
from user space by the nftables utility (the nft com-
mand line). The NetFilter object hierarchy has tables
that contain chains of rules.

Assuming a table named override-ipid is cre-

ated, e.g. by running:

nft add table override-ipid

36

And assuming an output ﬁlter chain is created
at priority “raw” (i.e. at the IPv4 level, but before
fragmentation) is created, e.g. by running:

nft 'add rule override-ipid output ip
protocol==1 ip id set numgen random mod
65536'

nft 'add chain override-ipid output {type
filter hook output priority raw;}'

Finally, here is a very aggressive conﬁguration,
that unconditionally randomizes IPv4 ID:

Then a safe conﬁguration that only sets IPv4
ID=0 when DF=1 can be implemented by running:

nft 'add rule override-ipid output ip id
set numgen random mod 65536'

nft 'add rule override-ipid output ip
frag-off & 0x4000 != 0 ip id set 0x0000'

A more aggressive conﬁguration randomizes
IP
ID for ICMP packets, regardless of DF. This can be
implemented by running the following (in addition
to the above):

recently,

that until

Note
numgen random was
based on a weak Linux kernel random number
generator (this implementation was attacked in [30]).
A more secure version is available in kernel versions
5.19-rc4 and above, and in LTS branches starting
with versions 5.15.51 and 5.10.127. Using numgen
random in earlier versions is not recommended.

37



=== Content from git.kernel.org_1e6edfa7_20250114_184802.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Willy Tarreau <w@1wt.eu> | 2021-05-29 13:07:46 +0200 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2021-05-31 22:12:08 -0700 |
| commit | [62f20e068ccc50d6ab66fdb72ba90da2b9418c99](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)) | |
| tree | [d73e53946b417d857034396529ae50a25fd66961](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99) | |
| parent | [ad993a95c508417acdeb15244109e009e50d8758](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ad993a95c508417acdeb15244109e009e50d8758) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99&id2=ad993a95c508417acdeb15244109e009e50d8758)) | |
| download | [linux-62f20e068ccc50d6ab66fdb72ba90da2b9418c99.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-62f20e068ccc50d6ab66fdb72ba90da2b9418c99.tar.gz) | |

ipv6: use prandom\_u32() for ID generationThis is a complement to commit aa6dd211e4b1 ("inet: use bigger hash
table for IP ID generation"), but focusing on some specific aspects
of IPv6.
Contary to IPv4, IPv6 only uses packet IDs with fragments, and with a
minimum MTU of 1280, it's much less easy to force a remote peer to
produce many fragments to explore its ID sequence. In addition packet
IDs are 32-bit in IPv6, which further complicates their analysis. On
the other hand, it is often easier to choose among plenty of possible
source addresses and partially work around the bigger hash table the
commit above permits, which leaves IPv6 partially exposed to some
possibilities of remote analysis at the risk of weakening some
protocols like DNS if some IDs can be predicted with a good enough
probability.
Given the wide range of permitted IDs, the risk of collision is extremely
low so there's no need to rely on the positive increment algorithm that
is shared with the IPv4 code via ip\_idents\_reserve(). We have a fast
PRNG, so let's simply call prandom\_u32() and be done with it.
Performance measurements at 10 Gbps couldn't show any difference with
the previous code, even when using a single core, because due to the
large fragments, we're limited to only ~930 kpps at 10 Gbps and the cost
of the random generation is completely offset by other operations and by
the network transfer time. In addition, this change removes the need to
update a shared entry in the idents table so it may even end up being
slightly faster on large scale systems where this matters.
The risk of at least one collision here is about 1/80 million among
10 IDs, 1/850k among 100 IDs, and still only 1/8.5k among 1000 IDs,
which remains very low compared to IPv4 where all IDs are reused
every 4 to 80ms on a 10 Gbps flow depending on packet sizes.
Reported-by: Amit Klein <aksecurity@gmail.com>
Signed-off-by: Willy Tarreau <w@1wt.eu>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Link: [https://lore.kernel.org/r/20210529110746.6796-1-w@1wt.eu](https://lore.kernel.org/r/20210529110746.6796-1-w%401wt.eu)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)

| -rw-r--r-- | [net/ipv6/output\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv6/output_core.c?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99) | 28 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 23 deletions

| diff --git a/net/ipv6/output\_core.c b/net/ipv6/output\_core.cindex af36acc1a64481..2880dc7d9a4916 100644--- a/[net/ipv6/output\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/output_core.c?id=ad993a95c508417acdeb15244109e009e50d8758)+++ b/[net/ipv6/output\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/output_core.c?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99)@@ -15,29 +15,11 @@ static u32 \_\_ipv6\_select\_ident(struct net \*net, const struct in6\_addr \*dst, const struct in6\_addr \*src) {- const struct {- struct in6\_addr dst;- struct in6\_addr src;- } \_\_aligned(SIPHASH\_ALIGNMENT) combined = {- .dst = \*dst,- .src = \*src,- };- u32 hash, id;-- /\* Note the following code is not safe, but this is okay. \*/- if (unlikely(siphash\_key\_is\_zero(&net->ipv4.ip\_id\_key)))- get\_random\_bytes(&net->ipv4.ip\_id\_key,- sizeof(net->ipv4.ip\_id\_key));-- hash = siphash(&combined, sizeof(combined), &net->ipv4.ip\_id\_key);-- /\* Treat id of 0 as unset and if we get 0 back from ip\_idents\_reserve,- \* set the hight order instead thus minimizing possible future- \* collisions.- \*/- id = ip\_idents\_reserve(hash, 1);- if (unlikely(!id))- id = 1 << 31;+ u32 id;++ do {+ id = prandom\_u32();+ } while (!id);  return id; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:46:39 +0000



=== Content from security.netapp.com_d2958098_20250115_113154.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2021-45485 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20220121-0001)

## CVE-2021-45485 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20220121-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20220121-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20220121-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20220121-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20220121-0001
**Version:**
13.0

**Last updated:**
05/22/2023

**Status:**
Interim.

**CVEs:** CVE-2021-45485

Overview
#### Summary

Multiple NetApp products incorporate Linux Kernel. Linux Kernel versions prior to 5.13.3 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information.

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2021-45485](https://nvd.nist.gov/vuln/detail/CVE-2021-45485) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.13.3>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99>

Affected Products
#### Affected Products

* AFF Baseboard Management Controller (BMC) - A700s
* Active IQ Unified Manager for VMware vSphere
* Brocade Fabric Operating System Firmware
* E-Series SANtricity OS Controller Software 11.x
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* BlueXP Classification
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800/C800/A150
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Service Processor - 8080/8060/8040/8020
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM6 SAS Disk Shelf Firmware
* Inventory Collect Tool
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp BlueXP
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SMI-S Provider
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp Virtual Desktop Service (VDS)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere
* OnCommand Insight
* OnCommand Workflow Automation
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024
* StorageGRID Baseboard Management Controller (BMC)
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **Active IQ Unified Manager for VMware vSphere** | <https://mysupport.netapp.com/site/products/all/details/activeiq-unified-manager/downloads-tab/download/62791/9.10> <https://mysupport.netapp.com/site/products/all/details/activeiq_um/downloads-tab/download/62791/9.10/> |
| **AFF Baseboard Management Controller (BMC) - A700s** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1450625. First fixed versions include the following: 1.91 |
| **Brocade Fabric Operating System Firmware** | First Fixed versions of Brocade Fabric OS include: v9.2.0 |
| **E-Series SANtricity OS Controller Software 11.x** | <https://mysupport.netapp.com/site/products/all/details/eseries-santricityos/downloads-tab/download/62735/11.70.3> |
| **FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1450637. First fixed versions include the following: 13.7 |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20220121-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20220121 | Initial Public Release |
| 2.0 | 20220125 | FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800, Service Processor, StorageGRID Baseboard Management Controller (BMC), and StorageGRID (formerly StorageGRID Webscale) moved to Products Not Affected, and FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 moved to Affected Products |
| 3.0 | 20220127 | Brocade Fabric Operating System Firmware moved to Affected Products, and SnapCenter Plug-in for VMware vSphere moved to Products Not Affected |
| 4.0 | 20220128 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S, and NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Won't Fix status |
| 5.0 | 20220131 | AFF Baseboard Management Controller (BMC) - A700s moved to Affected Products |
| 6.0 | 20220215 | ONTAP Tools for VMware vSphere moved to Products Not Affected |
| 7.0 | 20220221 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S, and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Affected Products |
| 8.0 | 20220426 | Active IQ Unified Manager for VMware vSphere moved to Affected Products and added to Software Versions and Fixes |
| 9.0 | 20220520 | Active IQ Unified Manager for VMware vSphere added to Software Versions and Fixes |
| 10.0 | 20220527 | E-Series SANtricity OS Controller Software 11.x 11.70.3 added to Software Versions and Fixes |
| 11.0 | 20220629 | NetApp Converged Systems Advisor Agent moved to Products Not Affected |
| 12.0 | 20221024 | FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 added to Software Versions and Fixes |
| 13.0 | 20230522 | Brocade Fabric Operating System Firmware added to Software Versions and Fixes |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from cdn.kernel.org_5f83862d_20250114_184802.html ===
commit f86aa267e180b23d8d24ee6886bd3bf9a360112e
Author: Greg Kroah-Hartman
Date: Mon Jul 19 10:04:55 2021 +0200
Linux 5.13.3
Link: https://lore.kernel.org/r/20210715182613.933608881@linuxfoundation.org
Tested-by: Florian Fainelli
Tested-by: Jon Hunter
Link: https://lore.kernel.org/r/20210716182150.239646976@linuxfoundation.org
Tested-by: Shuah Khan
Tested-by: Jon Hunter
Tested-by: Fox Chen
Tested-by: Linux Kernel Functional Testing
Tested-by: Guenter Roeck
Tested-by: Florian Fainelli
Signed-off-by: Greg Kroah-Hartman
commit e472b276a0d2180808009be38105e12754432e2a
Author: Chao Yu
Date: Fri May 7 18:10:38 2021 +0800
f2fs: fix to avoid racing on fsync\_entry\_slab by multi filesystem instances
commit cad83c968c2ebe97905f900326988ed37146c347 upstream.
As syzbot reported, there is an use-after-free issue during f2fs recovery:
Use-after-free write at 0xffff88823bc16040 (in kfence-#10):
kmem\_cache\_destroy+0x1f/0x120 mm/slab\_common.c:486
f2fs\_recover\_fsync\_data+0x75b0/0x8380 fs/f2fs/recovery.c:869
f2fs\_fill\_super+0x9393/0xa420 fs/f2fs/super.c:3945
mount\_bdev+0x26c/0x3a0 fs/super.c:1367
legacy\_get\_tree+0xea/0x180 fs/fs\_context.c:592
vfs\_get\_tree+0x86/0x270 fs/super.c:1497
do\_new\_mount fs/namespace.c:2905 [inline]
path\_mount+0x196f/0x2be0 fs/namespace.c:3235
do\_mount fs/namespace.c:3248 [inline]
\_\_do\_sys\_mount fs/namespace.c:3456 [inline]
\_\_se\_sys\_mount+0x2f9/0x3b0 fs/namespace.c:3433
do\_syscall\_64+0x3f/0xb0 arch/x86/entry/common.c:47
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
The root cause is multi f2fs filesystem instances can race on accessing
global fsync\_entry\_slab pointer, result in use-after-free issue of slab
cache, fixes to init/destroy this slab cache only once during module
init/destroy procedure to avoid this issue.
Reported-by: syzbot+9d90dad32dd9727ed084@syzkaller.appspotmail.com
Signed-off-by: Chao Yu
Signed-off-by: Jaegeuk Kim
Signed-off-by: Greg Kroah-Hartman
commit 258fd821f69378453c071b9dd767b298810fc766
Author: Tetsuo Handa
Date: Mon Apr 12 22:45:50 2021 +0900
smackfs: restrict bytes count in smk\_set\_cipso()
commit 49ec114a6e62d8d320037ce71c1aaf9650b3cafd upstream.
Oops, I failed to update subject line.
From 07571157c91b98ce1a4aa70967531e64b78e8346 Mon Sep 17 00:00:00 2001
From: Tetsuo Handa
Date: Mon, 12 Apr 2021 22:25:06 +0900
Subject: smackfs: restrict bytes count in smk\_set\_cipso()
Commit 7ef4c19d245f3dc2 ("smackfs: restrict bytes count in smackfs write
functions") missed that count > SMK\_CIPSOMAX check applies to only
format == SMK\_FIXED24\_FMT case.
Reported-by: syzbot
Signed-off-by: Tetsuo Handa
Signed-off-by: Casey Schaufler
Signed-off-by: Greg Kroah-Hartman
commit bfb48b54db25c3b4ef4bef5e0691464ebc4aa335
Author: Arnd Bergmann
Date: Mon Jun 14 12:34:03 2021 +0200
media: v4l2-core: explicitly clear ioctl input data
commit 7b53cca764f9b291b7907fcd39d9e66ad728ee0b upstream.
As seen from a recent syzbot bug report, mistakes in the compat ioctl
implementation can lead to uninitialized kernel stack data getting used
as input for driver ioctl handlers.
The reported bug is now fixed, but it's possible that other related
bugs are still present or get added in the future. As the drivers need
to check user input already, the possible impact is fairly low, but it
might still cause an information leak.
To be on the safe side, always clear the entire ioctl buffer before
calling the conversion handler functions that are meant to initialize
them.
Signed-off-by: Arnd Bergmann
Reviewed-by: Laurent Pinchart
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 42f102ea1943ecb10a0756bf75424de5d1d5beed
Author: Pavel Skripkin
Date: Sun Jun 6 17:24:05 2021 +0300
jfs: fix GPF in diFree
commit 9d574f985fe33efd6911f4d752de6f485a1ea732 upstream.
Avoid passing inode with
JFS\_SBI(inode->i\_sb)->ipimap == NULL to
diFree()[1]. GFP will appear:
struct inode \*ipimap = JFS\_SBI(ip->i\_sb)->ipimap;
struct inomap \*imap = JFS\_IP(ipimap)->i\_imap;
JFS\_IP() will return invalid pointer when ipimap == NULL
Call Trace:
diFree+0x13d/0x2dc0 fs/jfs/jfs\_imap.c:853 [1]
jfs\_evict\_inode+0x2c9/0x370 fs/jfs/inode.c:154
evict+0x2ed/0x750 fs/inode.c:578
iput\_final fs/inode.c:1654 [inline]
iput.part.0+0x3fe/0x820 fs/inode.c:1680
iput+0x58/0x70 fs/inode.c:1670
Reported-and-tested-by: syzbot+0a89a7b56db04c21a656@syzkaller.appspotmail.com
Signed-off-by: Pavel Skripkin
Signed-off-by: Dave Kleikamp
Signed-off-by: Greg Kroah-Hartman
commit 7ed572cdf11081f8f9e07abd4bea56a3f2c4edbd
Author: Theodore Ts'o
Date: Fri Jul 2 12:45:02 2021 -0400
ext4: fix possible UAF when remounting r/o a mmp-protected file system
commit 61bb4a1c417e5b95d9edb4f887f131de32e419cb upstream.
After commit 618f003199c6 ("ext4: fix memory leak in
ext4\_fill\_super"), after the file system is remounted read-only, there
is a race where the kmmpd thread can exit, causing sbi->s\_mmp\_tsk to
point at freed memory, which the call to ext4\_stop\_mmpd() can trip
over.
Fix this by only allowing kmmpd() to exit when it is stopped via
ext4\_stop\_mmpd().
Link: https://lore.kernel.org/r/20210707002433.3719773-1-tytso@mit.edu
Reported-by: Ye Bin
Bug-Report-Link: <20210629143603.2166962-1-yebin10@huawei.com>
Signed-off-by: Theodore Ts'o
Reviewed-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit e9f6b57ef11459329367edd7c8c58a555886c4c8
Author: Thomas Zimmermann
Date: Thu Apr 29 12:50:57 2021 +0200
drm/ast: Remove reference to struct drm\_device.pdev
commit 0ecb51824e838372e01330752503ddf9c0430ef7 upstream.
Using struct drm\_device.pdev is deprecated. Upcast with to\_pci\_dev()
from struct drm\_device.dev to get the PCI device structure.
v9:
\* fix remaining pdev references
Signed-off-by: Thomas Zimmermann
Reviewed-by: Michael J. Ruhl
Fixes: ba4e0339a6a3 ("drm/ast: Fixed CVE for DP501")
Cc: KuoHsiang Chou
Cc: kernel test robot
Cc: Thomas Zimmermann
Cc: Dave Airlie
Cc: dri-devel@lists.freedesktop.org
Link: https://patchwork.freedesktop.org/patch/msgid/20210429105101.25667-2-tzimmermann@suse.de
Signed-off-by: Greg Kroah-Hartman
commit 7eefc573bcbf4a1b035e43b571923ef570f0361f
Author: Zou Wei
Date: Tue Jun 8 14:34:08 2021 +0800
pinctrl: mcp23s08: Fix missing unlock on error in mcp23s08\_irq()
commit 884af72c90016cfccd5717439c86b48702cbf184 upstream.
Add the missing unlock before return from function mcp23s08\_irq()
in the error handling case.
v1-->v2:
remove the "return IRQ\_HANDLED" line
Fixes: 897120d41e7a ("pinctrl: mcp23s08: fix race condition in irq handler")
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Link: https://lore.kernel.org/r/1623134048-56051-1-git-send-email-zou\_wei@huawei.com
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit e294f97e8af8542cf4e9c58f09de463b7c03e641
Author: Mikulas Patocka
Date: Mon Jun 21 14:48:29 2021 -0400
dm writecache: write at least 4k when committing
commit 867de40c4c23e6d7f89f9ce4272a5d1b1484c122 upstream.
SSDs perform badly with sub-4k writes (because they perfrorm
read-modify-write internally), so make sure writecache writes at least
4k when committing.
Fixes: 991bd8d7bc78 ("dm writecache: commit just one block, not a full page")
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 691e71cf1fd19e645ec632aee6ae5183112dacfa
Author: Benjamin Drung
Date: Sat Jun 5 22:15:36 2021 +0200
media: uvcvideo: Fix pixel format change for Elgato Cam Link 4K
commit 4c6e0976295add7f0ed94d276c04a3d6f1ea8f83 upstream.
The Elgato Cam Link 4K HDMI video capture card reports to support three
different pixel formats, where the first format depends on the connected
HDMI device.
```
$ v4l2-ctl -d /dev/video0 --list-formats-ext
ioctl: VIDIOC\_ENUM\_FMT
Type: Video Capture
[0]: 'NV12' (Y/CbCr 4:2:0)
Size: Discrete 3840x2160
Interval: Discrete 0.033s (29.970 fps)
[1]: 'NV12' (Y/CbCr 4:2:0)
Size: Discrete 3840x2160
Interval: Discrete 0.033s (29.970 fps)
[2]: 'YU12' (Planar YUV 4:2:0)
Size: Discrete 3840x2160
Interval: Discrete 0.033s (29.970 fps)
```
Changing the pixel format to anything besides the first pixel format
does not work:
```
$ v4l2-ctl -d /dev/video0 --try-fmt-video pixelformat=YU12
Format Video Capture:
Width/Height : 3840/2160
Pixel Format : 'NV12' (Y/CbCr 4:2:0)
Field : None
Bytes per Line : 3840
Size Image : 12441600
Colorspace : sRGB
Transfer Function : Rec. 709
YCbCr/HSV Encoding: Rec. 709
Quantization : Default (maps to Limited Range)
Flags :
```
User space applications like VLC might show an error message on the
terminal in that case:
```
libv4l2: error set\_fmt gave us a different result than try\_fmt!
```
Depending on the error handling of the user space applications, they
might display a distorted video, because they use the wrong pixel format
for decoding the stream.
The Elgato Cam Link 4K responds to the USB video probe
VS\_PROBE\_CONTROL/VS\_COMMIT\_CONTROL with a malformed data structure: The
second byte contains bFormatIndex (instead of being the second byte of
bmHint). The first byte is always zero. The third byte is always 1.
The firmware bug was reported to Elgato on 2020-12-01 and it was
forwarded by the support team to the developers as feature request.
There is no firmware update available since then. The latest firmware
for Elgato Cam Link 4K as of 2021-03-23 has MCU 20.02.19 and FPGA 67.
Therefore correct the malformed data structure for this device. The
change was successfully tested with VLC, OBS, and Chromium using
different pixel formats (YUYV, NV12, YU12), resolutions (3840x2160,
1920x1080), and frame rates (29.970 and 59.940 fps).
Cc: stable@vger.kernel.org
Signed-off-by: Benjamin Drung
Signed-off-by: Laurent Pinchart
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 7c148146e07571acc6663aa42e66e24042447936
Author: Johan Hovold
Date: Mon May 24 13:09:19 2021 +0200
media: gspca/sunplus: fix zero-length control requests
commit b4bb4d425b7b02424afea2dfdcd77b3b4794175e upstream.
The direction of the pipe argument must match the request-type direction
bit or control requests may fail depending on the host-controller-driver
implementation.
Control transfers without a data stage are treated as OUT requests by
the USB stack and should be using usb\_sndctrlpipe(). Failing to do so
will now trigger a warning.
Fix the single zero-length control request which was using the
read-register helper, and update the helper so that zero-length reads
fail with an error message instead.
Fixes: 6a7eba24e4f0 ("V4L/DVB (8157): gspca: all subdrivers")
Cc: stable@vger.kernel.org # 2.6.27
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 8f6a609903a04769d352a2e1362d8c85a1c59003
Author: Johan Hovold
Date: Fri May 21 15:28:39 2021 +0200
media: gspca/sq905: fix control-request direction
commit 53ae298fde7adcc4b1432bce2dbdf8dac54dfa72 upstream.
The direction of the pipe argument must match the request-type direction
bit or control requests may fail depending on the host-controller-driver
implementation.
Fix the USB\_REQ\_SYNCH\_FRAME request which erroneously used
usb\_sndctrlpipe().
Fixes: 27d35fc3fb06 ("V4L/DVB (10639): gspca - sq905: New subdriver.")
Cc: stable@vger.kernel.org # 2.6.30
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 90be28e26596327684e19bb35e630646a7d84406
Author: Bernhard Wimmer
Date: Wed Apr 21 23:33:20 2021 +0200
media: ccs: Fix the op\_pll\_multiplier address
commit 0e3e0c9369c822b7f1dd11504eeb98cfd4aabf24 upstream.
According to the CCS spec the op\_pll\_multiplier address is 0x030e,
not 0x031e.
Signed-off-by: Bernhard Wimmer
Signed-off-by: Sakari Ailus
Cc: stable@vger.kernel.org
Fixes: 6493c4b777c2 ("media: smiapp: Import CCS definitions")
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit d69b39d89f362cfeeb54a68690768d0d257b2c8f
Author: Pavel Skripkin
Date: Mon May 17 21:18:14 2021 +0200
media: zr364xx: fix memory leak in zr364xx\_start\_readpipe
commit 0a045eac8d0427b64577a24d74bb8347c905ac65 upstream.
syzbot reported memory leak in zr364xx driver.
The problem was in non-freed urb in case of
usb\_submit\_urb() fail.
backtrace:
[] kmalloc include/linux/slab.h:561 [inline]
[] usb\_alloc\_urb+0x66/0xe0 drivers/usb/core/urb.c:74
[] zr364xx\_start\_readpipe+0x78/0x130 drivers/media/usb/zr364xx/zr364xx.c:1022
[] zr364xx\_board\_init drivers/media/usb/zr364xx/zr364xx.c:1383 [inline]
[] zr364xx\_probe+0x6a3/0x851 drivers/media/usb/zr364xx/zr364xx.c:1516
[] usb\_probe\_interface+0x177/0x370 drivers/usb/core/driver.c:396
[] really\_probe+0x159/0x500 drivers/base/dd.c:576
Fixes: ccbf035ae5de ("V4L/DVB (12278): zr364xx: implement V4L2\_CAP\_STREAMING")
Cc: stable@vger.kernel.org
Reported-by: syzbot+af4fa391ef18efdd5f69@syzkaller.appspotmail.com
Signed-off-by: Pavel Skripkin
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 2f920c1543f7c253a6bfc21d679561be51a959c6
Author: Johan Hovold
Date: Fri May 21 15:28:38 2021 +0200
media: dtv5100: fix control-request directions
commit 8c8b9a9be2afa8bd6a72ad1130532baab9fab89d upstream.
The direction of the pipe argument must match the request-type direction
bit or control requests may fail depending on the host-controller-driver
implementation.
Fix the control requests which erroneously used usb\_rcvctrlpipe().
Fixes: 8466028be792 ("V4L/DVB (8734): Initial support for AME DTV-5100 USB2.0 DVB-T")
Cc: stable@vger.kernel.org # 2.6.28
Signed-off-by: Johan Hovold
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 7be5e037e564bd2479d414fe1198dc3e8652d278
Author: Mauro Carvalho Chehab
Date: Fri Apr 23 17:19:11 2021 +0200
media: i2c: ccs-core: fix pm\_runtime\_get\_sync() usage count
commit da3a1858c3a37c09446e1470c48352897d59d11b upstream.
The pm\_runtime\_get\_sync() internally increments the
dev->power.usage\_count without decrementing it, even on errors.
There is a bug at ccs\_pm\_get\_init(): when this function returns
an error, the stream is not started, and RPM usage\_count
should not be incremented. However, if the calls to
v4l2\_ctrl\_handler\_setup() return errors, it will be kept
incremented.
At ccs\_suspend() the best is to replace it by the new
pm\_runtime\_resume\_and\_get(), introduced by:
commit dd8088d5a896 ("PM: runtime: Add pm\_runtime\_resume\_and\_get to deal with usage counter")
in order to properly decrement the usage counter automatically,
in the case of errors.
Fixes: 96e3a6b92f23 ("media: smiapp: Avoid maintaining power state information")
Cc: stable@vger.kernel.org
Acked-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 8b39b430dc0a16062d2c9a40b7be0da9bfd64edf
Author: Arnd Bergmann
Date: Mon Jun 14 12:34:09 2021 +0200
media: subdev: disallow ioctl for saa6588/davinci
commit 0a7790be182d32b9b332a37cb4206e24fe94b728 upstream.
The saa6588\_ioctl() function expects to get called from other kernel
functions with a 'saa6588\_command' pointer, but I found nothing stops it
from getting called from user space instead, which seems rather dangerous.
The same thing happens in the davinci vpbe driver with its VENC\_GET\_FLD
command.
As a quick fix, add a separate .command() callback pointer for this
driver and change the two callers over to that. This change can easily
get backported to stable kernels if necessary, but since there are only
two drivers, we may want to eventually replace this with a set of more
specialized callbacks in the long run.
Fixes: c3fda7f835b0 ("V4L/DVB (10537): saa6588: convert to v4l2\_subdev.")
Cc: stable@vger.kernel.org
Signed-off-by: Arnd Bergmann
Reviewed-by: Laurent Pinchart
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit eda818ae5d3916a4685998555222fcc0af8020fb
Author: Pali Rohár
Date: Fri Jun 25 00:26:20 2021 +0200
PCI: aardvark: Implement workaround for the readback value of VEND\_ID
commit 7f71a409fe3d9358da07c77f15bb5b7960f12253 upstream.
Marvell Armada 3700 Functional Errata, Guidelines, and Restrictions
document describes in erratum 4.1 PCIe value of vendor ID (Ref #: 243):
The readback value of VEND\_ID (RD0070000h [15:0]) is 1B4Bh, while it
should read 11ABh.
The firmware can write the correct value, 11ABh, through VEND\_ID
(RD0076044h [15:0]).
Implement this workaround in aardvark driver for both PCI vendor id and PCI
subsystem vendor id.
This change affects and fixes PCI vendor id of emulated PCIe root bridge.
After this change emulated PCIe root bridge has correct vendor id.
Link: https://lore.kernel.org/r/20210624222621.4776-5-pali@kernel.org
Fixes: 8a3ebd8de328 ("PCI: aardvark: Implement emulated root PCI bridge config space")
Signed-off-by: Pali Rohár
Signed-off-by: Lorenzo Pieralisi
Reviewed-by: Marek Behún
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 678d93d3d2434fbf585f28f34693957e60519ac1
Author: Pali Rohár
Date: Thu Jun 24 23:33:43 2021 +0200
PCI: aardvark: Fix checking for PIO Non-posted Request
commit 8ceeac307a79f68c0d0c72d6e48b82fa424204ec upstream.
PIO\_NON\_POSTED\_REQ for PIO\_STAT register is incorrectly defined. Bit 10 in
register PIO\_STAT indicates the response is to a non-posted request.
Link: https://lore.kernel.org/r/20210624213345.3617-2-pali@kernel.org
Signed-off-by: Pali Rohár
Signed-off-by: Lorenzo Pieralisi
Reviewed-by: Marek Behún
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 9789b16dc4e337fc8d1fffee25769b44eda6da87
Author: Konstantin Kharlamov
Date: Fri May 21 02:55:01 2021 +0300
PCI: Leave Apple Thunderbolt controllers on for s2idle or standby
commit 4694ae373dc2114f9a82f6ae15737e65af0c6dea upstream.
On Macbook 2013, resuming from suspend-to-idle or standby resulted in the
external monitor no longer being detected, a stacktrace, and errors like
this in dmesg:
pcieport 0000:06:00.0: can't change power state from D3hot to D0 (config space inaccessible)
The reason is that we know how to turn power to the Thunderbolt controller
\*off\* via the SXIO/SXFP/SXLF methods, but we don't know how to turn power
back on. We have to rely on firmware to turn the power back on.
When going to the "suspend-to-idle" or "standby" system sleep states,
firmware is not involved either on the suspend side or the resume side, so
we can't use SXIO/SXFP/SXLF to turn the power off.
Skip SXIO/SXFP/SXLF when firmware isn't involved in suspend, e.g., when
we're going to the "suspend-to-idle" or "standby" system sleep states.
Fixes: 1df5172c5c25 ("PCI: Suspend/resume quirks for Apple thunderbolt")
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=212767
Link: https://lore.kernel.org/r/20210520235501.917397-1-Hi-Angel@yandex.ru
Signed-off-by: Konstantin Kharlamov
Signed-off-by: Bjorn Helgaas
Reviewed-by: Lukas Wunner
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit ad365e9351ac2b450e7e79932ff6abf59342d91a
Author: Hou Tao
Date: Thu Jun 17 15:45:47 2021 +0800
dm btree remove: assign new\_root only when removal succeeds
commit b6e58b5466b2959f83034bead2e2e1395cca8aeb upstream.
remove\_raw() in dm\_btree\_remove() may fail due to IO read error
(e.g. read the content of origin block fails during shadowing),
and the value of shadow\_spine::root is uninitialized, but
the uninitialized value is still assign to new\_root in the
end of dm\_btree\_remove().
For dm-thin, the value of pmd->details\_root or pmd->root will become
an uninitialized value, so if trying to read details\_info tree again
out-of-bound memory may occur as showed below:
general protection fault, probably for non-canonical address 0x3fdcb14c8d7520
CPU: 4 PID: 515 Comm: dmsetup Not tainted 5.13.0-rc6
Hardware name: QEMU Standard PC
RIP: 0010:metadata\_ll\_load\_ie+0x14/0x30
Call Trace:
sm\_metadata\_count\_is\_more\_than\_one+0xb9/0xe0
dm\_tm\_shadow\_block+0x52/0x1c0
shadow\_step+0x59/0xf0
remove\_raw+0xb2/0x170
dm\_btree\_remove+0xf4/0x1c0
dm\_pool\_delete\_thin\_device+0xc3/0x140
pool\_message+0x218/0x2b0
target\_message+0x251/0x290
ctl\_ioctl+0x1c4/0x4d0
dm\_ctl\_ioctl+0xe/0x20
\_\_x64\_sys\_ioctl+0x7b/0xb0
do\_syscall\_64+0x40/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Fixing it by only assign new\_root when removal succeeds
Signed-off-by: Hou Tao
Cc: stable@vger.kernel.org
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 3993b84d44939a0db7c549e8a25c6256420c0f4b
Author: Mikulas Patocka
Date: Tue Jun 15 13:45:55 2021 -0400
dm writecache: flush origin device when writing and cache is full
commit ee55b92a7391bf871939330f662651b54be51b73 upstream.
Commit d53f1fafec9d086f1c5166436abefdaef30e0363 ("dm writecache: do
direct write if the cache is full") changed dm-writecache, so that it
writes directly to the origin device if the cache is full.
Unfortunately, it doesn't forward flush requests to the origin device,
so that there is a bug where flushes are being ignored.
Fix this by adding missing flush forwarding.
For PMEM mode, we fix this bug by disabling direct writes to the origin
device, because it performs better.
Signed-off-by: Mikulas Patocka
Fixes: d53f1fafec9d ("dm writecache: do direct write if the cache is full")
Cc: stable@vger.kernel.org # v5.7+
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 14f19e585018870fd1fa4f237cb130d9a795d3bc
Author: Damien Le Moal
Date: Wed May 19 10:26:16 2021 +0900
dm zoned: check zone capacity
commit bab68499428ed934f0493ac74197ed6f36204260 upstream.
The dm-zoned target cannot support zoned block devices with zones that
have a capacity smaller than the zone size (e.g. NVMe zoned namespaces)
due to the current chunk zone mapping implementation as it is assumed
that zones and chunks have the same size with all blocks usable.
If a zoned drive is found to have zones with a capacity different from
the zone size, fail the target initialization.
Signed-off-by: Damien Le Moal
Cc: stable@vger.kernel.org # v5.9+
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 0115687be7b13993066aef602253a53d55f5b11f
Author: Sai Prakash Ranjan
Date: Mon Jun 14 11:59:00 2021 -0600
coresight: tmc-etf: Fix global-out-of-bounds in tmc\_update\_etf\_buffer()
commit 5fae8a946ac2df879caf3f79a193d4766d00239b upstream.
commit 6f755e85c332 ("coresight: Add helper for inserting synchronization
packets") removed trailing '\0' from barrier\_pkt array and updated the
call sites like etb\_update\_buffer() to have proper checks for barrier\_pkt
size before read but missed updating tmc\_update\_etf\_buffer() which still
reads barrier\_pkt past the array size resulting in KASAN out-of-bounds
bug. Fix this by adding a check for barrier\_pkt size before accessing
like it is done in etb\_update\_buffer().
BUG: KASAN: global-out-of-bounds in tmc\_update\_etf\_buffer+0x4b8/0x698
Read of size 4 at addr ffffffd05b7d1030 by task perf/2629
Call trace:
dump\_backtrace+0x0/0x27c
show\_stack+0x20/0x2c
dump\_stack+0x11c/0x188
print\_address\_description+0x3c/0x4a4
\_\_kasan\_report+0x140/0x164
kasan\_report+0x10/0x18
\_\_asan\_report\_load4\_noabort+0x1c/0x24
tmc\_update\_etf\_buffer+0x4b8/0x698
etm\_event\_stop+0x248/0x2d8
etm\_event\_del+0x20/0x2c
event\_sched\_out+0x214/0x6f0
group\_sched\_out+0xd0/0x270
ctx\_sched\_out+0x2ec/0x518
\_\_perf\_event\_task\_sched\_out+0x4fc/0xe6c
\_\_schedule+0x1094/0x16a0
preempt\_schedule\_irq+0x88/0x170
arm64\_preempt\_schedule\_irq+0xf0/0x18c
el1\_irq+0xe8/0x180
perf\_event\_exec+0x4d8/0x56c
setup\_new\_exec+0x204/0x400
load\_elf\_binary+0x72c/0x18c0
search\_binary\_handler+0x13c/0x420
load\_script+0x500/0x6c4
search\_binary\_handler+0x13c/0x420
exec\_binprm+0x118/0x654
\_\_do\_execve\_file+0x77c/0xba4
\_\_arm64\_compat\_sys\_execve+0x98/0xac
el0\_svc\_common+0x1f8/0x5e0
el0\_svc\_compat\_handler+0x84/0xb0
el0\_svc\_compat+0x10/0x50
The buggy address belongs to the variable:
barrier\_pkt+0x10/0x40
Memory state around the buggy address:
ffffffd05b7d0f00: fa fa fa fa 04 fa fa fa fa fa fa fa 00 00 00 00
ffffffd05b7d0f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
>ffffffd05b7d1000: 00 00 00 00 00 00 fa fa fa fa fa fa 00 00 00 03
^
ffffffd05b7d1080: fa fa fa fa 00 02 fa fa fa fa fa fa 03 fa fa fa
ffffffd05b7d1100: fa fa fa fa 00 00 00 00 05 fa fa fa fa fa fa fa
==================================================================
Link: https://lore.kernel.org/r/20210505093430.18445-1-saiprakash.ranjan@codeaurora.org
Fixes: 0c3fc4d5fa26 ("coresight: Add barrier packet for synchronisation")
Cc: stable@vger.kernel.org
Signed-off-by: Sai Prakash Ranjan
Signed-off-by: Suzuki K Poulose
Signed-off-by: Mathieu Poirier
Link: https://lore.kernel.org/r/20210614175901.532683-6-mathieu.poirier@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit 2ac133f4b299bd5a76cb5be1bc49733b6d45f7a7
Author: Jeremy Linton
Date: Mon Jun 14 11:59:01 2021 -0600
coresight: Propagate symlink failure
commit 51dd19a7e9f8fbbb7cd92b8a357091911eae7f78 upstream.
If the symlink is unable to be created, the driver goes
ahead and continues device creation. Instead lets propagate
the failure, and fail the probe.
Link: https://lore.kernel.org/r/20210526204042.2681700-1-jeremy.linton@arm.com
Fixes: 8a7365c2d418 ("coresight: Expose device connections via sysfs")
Cc: stable@vger.kernel.org
Signed-off-by: Jeremy Linton
Signed-off-by: Mathieu Poirier
Link: https://lore.kernel.org/r/20210614175901.532683-7-mathieu.poirier@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit 5b37fd9da03f2e60fc3f7f8e997d277f71578108
Author: Lv Yunlong
Date: Mon May 24 02:32:05 2021 -0700
ipack/carriers/tpci200: Fix a double free in tpci200\_pci\_probe
commit 9272e5d0028d45a3b45b58c9255e6e0df53f7ad9 upstream.
In the out\_err\_bus\_register error branch of tpci200\_pci\_probe,
tpci200->info->cfg\_regs is freed by tpci200\_uninstall()->
tpci200\_unregister()->pci\_iounmap(..,tpci200->info->cfg\_regs)
in the first time.
But later, iounmap() is called to free tpci200->info->cfg\_regs
again.
My patch sets tpci200->info->cfg\_regs to NULL after tpci200\_uninstall()
to avoid the double free.
Fixes: cea2f7cdff2af ("Staging: ipack/bridges/tpci200: Use the TPCI200 in big endian mode")
Cc: stable
Acked-by: Samuel Iglesias Gonsalvez
Signed-off-by: Lv Yunlong
Link: https://lore.kernel.org/r/20210524093205.8333-1-lyl2019@mail.ustc.edu.cn
Signed-off-by: Greg Kroah-Hartman
commit 1d2865bbd89e4397e91ef01de53da7fca89f7429
Author: Paul Burton
Date: Thu Jul 1 10:24:07 2021 -0700
tracing: Resize tgid\_map to pid\_max, not PID\_MAX\_DEFAULT
commit 4030a6e6a6a4a42ff8c18414c9e0c93e24cc70b8 upstream.
Currently tgid\_map is sized at PID\_MAX\_DEFAULT entries, which means that
on systems where pid\_max is configured higher than PID\_MAX\_DEFAULT the
ftrace record-tgid option doesn't work so well. Any tasks with PIDs
higher than PID\_MAX\_DEFAULT are simply not recorded in tgid\_map, and
don't show up in the saved\_tgids file.
In particular since systemd v243 & above configure pid\_max to its
highest possible 1<<22 value by default on 64 bit systems this renders
the record-tgids option of little use.
Increase the size of tgid\_map to the configured pid\_max instead,
allowing it to cover the full range of PIDs up to the maximum value of
PID\_MAX\_LIMIT if the system is configured that way.
On 64 bit systems with pid\_max == PID\_MAX\_LIMIT this will increase the
size of tgid\_map from 256KiB to 16MiB. Whilst this 64x increase in
memory overhead sounds significant 64 bit systems are presumably best
placed to accommodate it, and since tgid\_map is only allocated when the
record-tgid option is actually used presumably the user would rather it
spends sufficient memory to actually record the tgids they expect.
The size of tgid\_map could also increase for CONFIG\_BASE\_SMALL=y
configurations, but these seem unlikely to be systems upon which people
are both configuring a large pid\_max and running ftrace with record-tgid
anyway.
Of note is that we only allocate tgid\_map once, the first time that the
record-tgid option is enabled. Therefore its size is only set once, to
the value of pid\_max at the time the record-tgid option is first
enabled. If a user increases pid\_max after that point, the saved\_tgids
file will not contain entries for any tasks with pids beyond the earlier
value of pid\_max.
Link: https://lkml.kernel.org/r/20210701172407.889626-2-paulburton@google.com
Fixes: d914ba37d714 ("tracing: Add support for recording tgid of tasks")
Cc: Ingo Molnar
Cc: Joel Fernandes
Cc:
Signed-off-by: Paul Burton
[ Fixed comment coding style ]
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 38164905b1cc30f4099d78a2394115b7046dfb0f
Author: Paul Burton
Date: Tue Jun 29 17:34:05 2021 -0700
tracing: Simplify & fix saved\_tgids logic
commit b81b3e959adb107cd5b36c7dc5ba1364bbd31eb2 upstream.
The tgid\_map array records a mapping from pid to tgid, where the index
of an entry within the array is the pid & the value stored at that index
is the tgid.
The saved\_tgids\_next() function iterates over pointers into the tgid\_map
array & dereferences the pointers which results in the tgid, but then it
passes that dereferenced value to trace\_find\_tgid() which treats it as a
pid & does a further lookup within the tgid\_map array. It seems likely
that the intent here was to skip over entries in tgid\_map for which the
recorded tgid is zero, but instead we end up skipping over entries for
which the thread group leader hasn't yet had its own tgid recorded in
tgid\_map.
A minimal fix would be to remove the call to trace\_find\_tgid, turning:
if (trace\_find\_tgid(\*ptr))
into:
if (\*ptr)
..but it seems like this logic can be much simpler if we simply let
seq\_read() iterate over the whole tgid\_map array & filter out empty
entries by returning SEQ\_SKIP from saved\_tgids\_show(). Here we take that
approach, removing the incorrect logic here entirely.
Link: https://lkml.kernel.org/r/20210630003406.4013668-1-paulburton@google.com
Fixes: d914ba37d714 ("tracing: Add support for recording tgid of tasks")
Cc: Ingo Molnar
Cc: Joel Fernandes
Cc:
Signed-off-by: Paul Burton
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 589f6fac5c926ed3e0093636db44cd5c5942d55f
Author: Jan Kara
Date: Mon Jun 7 13:26:13 2021 +0200
rq-qos: fix missed wake-ups in rq\_qos\_throttle try two
commit 11c7aa0ddea8611007768d3e6b58d45dc60a19e1 upstream.
Commit 545fbd0775ba ("rq-qos: fix missed wake-ups in rq\_qos\_throttle")
tried to fix a problem that a process could be sleeping in rq\_qos\_wait()
without anyone to wake it up. However the fix is not complete and the
following can still happen:
CPU1 (waiter1) CPU2 (waiter2) CPU3 (waker)
rq\_qos\_wait() rq\_qos\_wait()
acquire\_inflight\_cb() -> fails
acquire\_inflight\_cb() -> fails
completes IOs, inflight
decreased
prepare\_to\_wait\_exclusive()
prepare\_to\_wait\_exclusive()
has\_sleeper = !wq\_has\_single\_sleeper() -> true as there are two sleepers
has\_sleeper = !wq\_has\_single\_sleeper() -> true
io\_schedule() io\_schedule()
Deadlock as now there's nobody to wakeup the two waiters. The logic
automatically blocking when there are already sleepers is really subtle
and the only way to make it work reliably is that we check whether there
are some waiters in the queue when adding ourselves there. That way, we
are guaranteed that at least the first process to enter the wait queue
will recheck the waiting condition before going to sleep and thus
guarantee forward progress.
Fixes: 545fbd0775ba ("rq-qos: fix missed wake-ups in rq\_qos\_throttle")
CC: stable@vger.kernel.org
Signed-off-by: Jan Kara
Link: https://lore.kernel.org/r/20210607112613.25344-1-jack@suse.cz
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit d57fcab190b60f43046d5836c3c56114b4f50080
Author: Yun Zhou
Date: Sat Jun 26 11:21:55 2021 +0800
seq\_buf: Fix overflow in seq\_buf\_putmem\_hex()
commit d3b16034a24a112bb83aeb669ac5b9b01f744bb7 upstream.
There's two variables being increased in that loop (i and j), and i
follows the raw data, and j follows what is being written into the buffer.
We should compare 'i' to MAX\_MEMHEX\_BYTES or compare 'j' to HEX\_CHARS.
Otherwise, if 'j' goes bigger than HEX\_CHARS, it will overflow the
destination buffer.
Link: https://lore.kernel.org/lkml/20210625122453.5e2fe304@oasis.local.home/
Link: https://lkml.kernel.org/r/20210626032156.47889-1-yun.zhou@windriver.com
Cc: stable@vger.kernel.org
Fixes: 5e3ca0ec76fce ("ftrace: introduce the "hex" output method")
Signed-off-by: Yun Zhou
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 775ab9f4a4d9027ea55e9cd683e9ff48d09d749a
Author: Kees Cook
Date: Wed Jun 23 13:39:33 2021 -0700
lkdtm: Enable DOUBLE\_FAULT on all architectures
commit f123c42bbeff26bfe8bdb08a01307e92d51eec39 upstream.
Where feasible, I prefer to have all tests visible on all architectures,
but to have them wired to XFAIL. DOUBLE\_FAIL was set up to XFAIL, but
wasn't actually being added to the test list.
Fixes: cea23efb4de2 ("lkdtm/bugs: Make double-fault test always available")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20210623203936.3151093-7-keescook@chromium.org
Signed-off-by: Greg Kroah-Hartman
commit 42e737661a0dfd872c1392a33b20273127a54d27
Author: Ferry Toth
Date: Tue May 18 23:27:09 2021 +0200
extcon: intel-mrfld: Sync hardware and software state on init
commit ecb5bdff901139850fb3ca3ae2d0cccac045bc52 upstream.
extcon driver for Basin Cove PMIC shadows the switch status used for dwc3
DRD to detect a change in the switch position. This change initializes the
status at probe time.
Cc: stable@vger.kernel.org
Fixes: 492929c54791 ("extcon: mrfld: Introduce extcon driver for Basin Cove PMIC")
Reviewed-by: Andy Shevchenko
Signed-off-by: Ferry Toth
Signed-off-by: Chanwoo Choi
Signed-off-by: Greg Kroah-Hartman
commit 6fd650c47411ee353b1efba1500c67b170d7d0c9
Author: Kees Cook
Date: Wed Jun 23 13:39:29 2021 -0700
selftests/lkdtm: Fix expected text for CR4 pinning
commit c2eb472bbe25b3f360990f23b293b3fbadfa4bc0 upstream.
The error text for CR4 pinning changed. Update the test to match.
Fixes: a13b9d0b9721 ("x86/cpu: Use pinning mask for CR4 bits needing to be 0")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20210623203936.3151093-3-keescook@chromium.org
Signed-off-by: Greg Kroah-Hartman
commit 07b761cf78b147b035eb8574cc22bd016e51b307
Author: Kees Cook
Date: Wed Jun 23 13:39:31 2021 -0700
lkdtm/bugs: XFAIL UNALIGNED\_LOAD\_STORE\_WRITE
commit a15676ac8f24a9ac5fd881cf17be4be13fa0910a upstream.
When built under CONFIG\_HAVE\_EFFICIENT\_UNALIGNED\_ACCESS, this test is
expected to fail (i.e. not trip an exception).
Fixes: 46d1a0f03d66 ("selftests/lkdtm: Add tests for LKDTM targets")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20210623203936.3151093-5-keescook@chromium.org
Signed-off-by: Greg Kroah-Hartman
commit 866573b6c9bfc1feb9d8827a64c17ad21845a6b0
Author: Christophe JAILLET
Date: Fri Jun 11 11:23:21 2021 +0100
nvmem: core: add a missing of\_node\_put
commit 63879e2964bceee2aa5bbe8b99ea58bba28bb64f upstream.
'for\_each\_child\_of\_node' performs an of\_node\_get on each iteration, so a
return from the middle of the loop requires an of\_node\_put.
Fixes: e888d445ac33 ("nvmem: resolve cells from DT at registration time")
Cc:
Signed-off-by: Christophe JAILLET
Signed-off-by: Srinivas Kandagatla
Link: https://lore.kernel.org/r/20210611102321.11509-1-srinivas.kandagatla@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit 9c6c73fc99b9943b9420534dc47130c312fc1eaa
Author: Limeng
Date: Wed Apr 7 13:25:25 2021 +0800
mfd: syscon: Free the allocated name field of struct regmap\_config
commit 56a1188159cb2b87fbcb5a7a7afb38a4dd9db0c1 upstream.
The commit 529a1101212a("mfd: syscon: Don't free allocated name
for regmap\_config") doesn't free the allocated name field of struct
regmap\_config, but introduce a memory leak. There is another
commit 94cc89eb8fa5("regmap: debugfs: Fix handling of name string
for debugfs init delays") fixing this debugfs init issue from root
cause. With this fixing, the name field in struct regmap\_debugfs\_node
is removed. When initialize debugfs for syscon driver, the name
field of struct regmap\_config is not used anymore. So, the allocated
name field of struct regmap\_config is need to be freed directly after
regmap initialization to avoid memory leak.
Cc: stable@vger.kernel.org
Fixes: 529a1101212a("mfd: syscon: Don't free allocated name for regmap\_config")
Signed-off-by: Meng Li
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 8451754bca7ba463838627969653e1ea94c26f72
Author: Linus Walleij
Date: Sun Jun 27 01:47:49 2021 +0200
power: supply: ab8500: Fix an old bug
commit f1c74a6c07e76fcb31a4bcc1f437c4361a2674ce upstream.
Trying to get the AB8500 charging driver working I ran into a bit
of bitrot: we haven't used the driver for a while so errors in
refactorings won't be noticed.
This one is pretty self evident: use argument to the macro or we
end up with a random pointer to something else.
Cc: stable@vger.kernel.org
Cc: Krzysztof Kozlowski
Cc: Marcus Cooper
Fixes: 297d716f6260 ("power\_supply: Change ownership from driver to core")
Signed-off-by: Linus Walleij
Signed-off-by: Sebastian Reichel
Signed-off-by: Greg Kroah-Hartman
commit c0756f75c22149d20fcb7d8409827cee905eb386
Author: Zhihao Cheng
Date: Mon May 31 20:52:09 2021 +0800
ubifs: Fix races between xattr\_{set|get} and listxattr operations
commit f4e3634a3b642225a530c292fdb1e8a4007507f5 upstream.
UBIFS may occur some problems with concurrent xattr\_{set|get} and
listxattr operations, such as assertion failure, memory corruption,
stale xattr value[1].
Fix it by importing a new rw-lock in @ubifs\_inode to serilize write
operations on xattr, concurrent read operations are still effective,
just like ext4.
[1] https://lore.kernel.org/linux-mtd/20200630130438.141649-1-houtao1@huawei.com
Fixes: 1e51764a3c2ac05a23 ("UBIFS: add new flash file system")
Cc: stable@vger.kernel.org # v2.6+
Signed-off-by: Zhihao Cheng
Reviewed-by: Sascha Hauer
Signed-off-by: Richard Weinberger
Signed-off-by: Greg Kroah-Hartman
commit ec00b71f402aa4305e8df943869bf2c75adb995a
Author: Srinivas Pandruvada
Date: Mon Jun 28 14:58:03 2021 -0700
thermal/drivers/int340x/processor\_thermal: Fix tcc setting
commit fe6a6de6692e7f7159c1ff42b07ecd737df712b4 upstream.
The following fixes are done for tcc sysfs interface:
- TCC is 6 bits only from bit 29-24
- TCC of 0 is valid
- When BIT(31) is set, this register is read only
- Check for invalid tcc value
- Error for negative values
Fixes: fdf4f2fb8e899 ("drivers: thermal: processor\_thermal\_device: Export sysfs interface for TCC offset")
Signed-off-by: Srinivas Pandruvada
Cc: stable@vger.kernel.org
Acked-by: Zhang Rui
Signed-off-by: Daniel Lezcano
Link: https://lore.kernel.org/r/20210628215803.75038-1-srinivas.pandruvada@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
commit 238a7c0a5c3090b46e68de10003df8aebe5d8935
Author: Petr Pavlu
Date: Thu May 13 14:26:36 2021 +0200
ipmi/watchdog: Stop watchdog timer when the current action is 'none'
commit 2253042d86f57d90a621ac2513a7a7a13afcf809 upstream.
When an IPMI watchdog timer is being stopped in ipmi\_close() or
ipmi\_ioctl(WDIOS\_DISABLECARD), the current watchdog action is updated to
WDOG\_TIMEOUT\_NONE and \_ipmi\_set\_timeout(IPMI\_SET\_TIMEOUT\_NO\_HB) is called
to install this action. The latter function ends up invoking
\_\_ipmi\_set\_timeout() which makes the actual 'Set Watchdog Timer' IPMI
request.
For IPMI 1.0, this operation results in fully stopping the watchdog timer.
For IPMI >= 1.5, function \_\_ipmi\_set\_timeout() always specifies the "don't
stop" flag in the prepared 'Set Watchdog Timer' IPMI request. This causes
that the watchdog timer has its action correctly updated to 'none' but the
timer continues to run. A problem is that IPMI firmware can then still log
an expiration event when the configured timeout is reached, which is
unexpected because the watchdog timer was requested to be stopped.
The patch fixes this problem by not setting the "don't stop" flag in
\_\_ipmi\_set\_timeout() when the current action is WDOG\_TIMEOUT\_NONE which
results in stopping the watchdog timer. This makes the behaviour for
IPMI >= 1.5 consistent with IPMI 1.0. It also matches the logic in
\_\_ipmi\_heartbeat() which does not allow to reset the watchdog if the
current action is WDOG\_TIMEOUT\_NONE as that would start the timer.
Signed-off-by: Petr Pavlu
Message-Id: <10a41bdc-9c99-089c-8d89-fa98ce5ea080@suse.com>
Cc: stable@vger.kernel.org
Signed-off-by: Corey Minyard
Signed-off-by: Greg Kroah-Hartman
commit 13b307880b66ef6e7f4eeee2a26cbbe0f8206863
Author: Nathan Chancellor
Date: Thu Feb 11 12:42:58 2021 -0700
qemu\_fw\_cfg: Make fw\_cfg\_rev\_attr a proper kobj\_attribute
commit fca41af18e10318e4de090db47d9fa7169e1bf2f upstream.
fw\_cfg\_showrev() is called by an indirect call in kobj\_attr\_show(),
which violates clang's CFI checking because fw\_cfg\_showrev()'s second
parameter is 'struct attribute', whereas the ->show() member of 'struct
kobj\_structure' expects the second parameter to be of type 'struct
kobj\_attribute'.
$ cat /sys/firmware/qemu\_fw\_cfg/rev
3
$ dmesg | grep "CFI failure"
[ 26.016832] CFI failure (target: fw\_cfg\_showrev+0x0/0x8):
Fix this by converting fw\_cfg\_rev\_attr to 'struct kobj\_attribute' where
this would have been caught automatically by the incompatible pointer
types compiler warning. Update fw\_cfg\_showrev() accordingly.
Fixes: 75f3e8e47f38 ("firmware: introduce sysfs driver for QEMU's fw\_cfg device")
Link: https://github.com/ClangBuiltLinux/linux/issues/1299
Signed-off-by: Nathan Chancellor
Reviewed-by: Sami Tolvanen
Tested-by: Sedat Dilek
Reviewed-by: Sami Tolvanen
Reviewed-by: Philippe Mathieu-Daudé
Signed-off-by: Kees Cook
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20210211194258.4137998-1-nathan@kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 1e71e1344d61509a5b444b1a4cf0c0ea19fd9dd8
Author: Jesse Brandeburg
Date: Fri May 7 11:56:25 2021 -0700
i40e: fix PTP on 5Gb links
commit 26b0ce8dd3dd704393dbace4dc416adfeffe531f upstream.
As reported by Alex Sergeev, the i40e driver is incrementing the PTP
clock at 40Gb speeds when linked at 5Gb. Fix this bug by making
sure that the right multiplier is selected when linked at 5Gb.
Fixes: 3dbdd6c2f70a ("i40e: Add support for 5Gbps cards")
Cc: stable@vger.kernel.org
Reported-by: Alex Sergeev
Suggested-by: Alex Sergeev
Signed-off-by: Jesse Brandeburg
Tested-by: Tony Brelinski
Signed-off-by: Tony Nguyen
Signed-off-by: Greg Kroah-Hartman
commit 35af69c7c0490fdccfc159c6a87e4d1dc070838a
Author: Brian Norris
Date: Fri May 14 19:42:27 2021 -0700
mwifiex: bring down link before deleting interface
commit 1f9482aa8d412b4ba06ce6ab8e333fb8ca29a06e upstream.
We can deadlock when rmmod'ing the driver or going through firmware
reset, because the cfg80211\_unregister\_wdev() has to bring down the link
for us, ... which then grab the same wiphy lock.
nl80211\_del\_interface() already handles a very similar case, with a nice
description:
/\*
\* We hold RTNL, so this is safe, without RTNL opencount cannot
\* reach 0, and thus the rdev cannot be deleted.
\*
\* We need to do it for the dev\_close(), since that will call
\* the netdev notifiers, and we need to acquire the mutex there
\* but don't know if we get there from here or from some other
\* place (e.g. "ip link set ... down").
\*/
mutex\_unlock(&rdev->wiphy.mtx);
...
Do similarly for mwifiex teardown, by ensuring we bring the link down
first.
Sample deadlock trace:
[ 247.103516] INFO: task rmmod:2119 blocked for more than 123 seconds.
[ 247.110630] Not tainted 5.12.4 #5
[ 247.115796] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 247.124557] task:rmmod state:D stack: 0 pid: 2119 ppid: 2114 flags:0x00400208
[ 247.133905] Call trace:
[ 247.136644] \_\_switch\_to+0x130/0x170
[ 247.140643] \_\_schedule+0x714/0xa0c
[ 247.144548] schedule\_preempt\_disabled+0x88/0xf4
[ 247.149714] \_\_mutex\_lock\_common+0x43c/0x750
[ 247.154496] mutex\_lock\_nested+0x5c/0x68
[ 247.158884] cfg80211\_netdev\_notifier\_call+0x280/0x4e0 [cfg80211]
[ 247.165769] raw\_notifier\_call\_chain+0x4c/0x78
[ 247.170742] call\_netdevice\_notifiers\_info+0x68/0xa4
[ 247.176305] \_\_dev\_close\_many+0x7c/0x138
[ 247.180693] dev\_close\_many+0x7c/0x10c
[ 247.184893] unregister\_netdevice\_many+0xfc/0x654
[ 247.190158] unregister\_netdevice\_queue+0xb4/0xe0
[ 247.195424] \_cfg80211\_unregister\_wdev+0xa4/0x204 [cfg80211]
[ 247.201816] cfg80211\_unregister\_wdev+0x20/0x2c [cfg80211]
[ 247.208016] mwifiex\_del\_virtual\_intf+0xc8/0x188 [mwifiex]
[ 247.214174] mwifiex\_uninit\_sw+0x158/0x1b0 [mwifiex]
[ 247.219747] mwifiex\_remove\_card+0x38/0xa0 [mwifiex]
[ 247.225316] mwifiex\_pcie\_remove+0xd0/0xe0 [mwifiex\_pcie]
[ 247.231451] pci\_device\_remove+0x50/0xe0
[ 247.235849] device\_release\_driver\_internal+0x110/0x1b0
[ 247.241701] driver\_detach+0x5c/0x9c
[ 247.245704] bus\_remove\_driver+0x84/0xb8
[ 247.250095] driver\_unregister+0x3c/0x60
[ 247.254486] pci\_unregister\_driver+0x2c/0x90
[ 247.259267] cleanup\_module+0x18/0xcdc [mwifiex\_pcie]
Fixes: a05829a7222e ("cfg80211: avoid holding the RTNL when calling the driver")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/linux-wireless/98392296-40ee-6300-369c-32e16cff3725@gmail.com/
Link: https://lore.kernel.org/linux-wireless/ab4d00ce52f32bd8e45ad0448a44737e@bewaar.me/
Reported-by: Maximilian Luz
Reported-by: dave@bewaar.me
Cc: Johannes Berg
Signed-off-by: Brian Norris
Tested-by: Maximilian Luz
Tested-by: Dave Olsthoorn
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210515024227.2159311-1-briannorris@chromium.org
Signed-off-by: Greg Kroah-Hartman
commit 5665e64c99e35c203525f2645df08bc5766f7a20
Author: Dmitry Osipenko
Date: Sat May 29 18:46:46 2021 +0300
ASoC: tegra: Set driver\_name=tegra for all machine drivers
commit f6eb84fa596abf28959fc7e0b626f925eb1196c7 upstream.
The driver\_name="tegra" is now required by the newer ALSA UCMs, otherwise
Tegra UCMs don't match by the path/name.
All Tegra machine drivers are specifying the card's name, but it has no
effect if model name is specified in the device-tree since it overrides
the card's name. We need to set the driver\_name to "tegra" in order to
get a usable lookup path for the updated ALSA UCMs. The new UCM lookup
path has a form of driver\_name/card\_name.
The old lookup paths that are based on driver module name continue to
work as before. Note that UCM matching never worked for Tegra ASoC drivers
if they were compiled as built-in, this is fixed by supporting the new
naming scheme.
Cc: stable@vger.kernel.org
Signed-off-by: Dmitry Osipenko
Link: https://lore.kernel.org/r/20210529154649.25936-2-digetx@gmail.com
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 72104552eae2cf6979129e90b2fbb39951e24496
Author: Russ Weight
Date: Mon Jun 14 10:09:03 2021 -0700
fpga: stratix10-soc: Add missing fpga\_mgr\_free() call
commit d9ec9daa20eb8de1efe6abae78c9835ec8ed86f9 upstream.
The stratix10-soc driver uses fpga\_mgr\_create() function and is therefore
responsible to call fpga\_mgr\_free() to release the class driver resources.
Add a missing call to fpga\_mgr\_free in the s10\_remove() function.
Signed-off-by: Russ Weight
Reviewed-by: Xu Yilun
Signed-off-by: Moritz Fischer
Fixes: e7eef1d7633a ("fpga: add intel stratix10 soc fpga manager driver")
Cc: stable
Link: https://lore.kernel.org/r/20210614170909.232415-3-mdf@kernel.org
Signed-off-by: Greg Kroah-Hartman
commit c3f4ad1ba2eb08ef02df8adbe3827d3715003436
Author: Samuel Holland
Date: Fri May 14 21:14:39 2021 -0500
clocksource/arm\_arch\_timer: Improve Allwinner A64 timer workaround
commit 8b33dfe0ba1c84c1aab2456590b38195837f1e6e upstream.
Bad counter reads are experienced sometimes when bit 10 or greater rolls
over. Originally, testing showed that at least 10 lower bits would be
set to the same value during these bad reads. However, some users still
reported time skips.
Wider testing revealed that on some chips, occasionally only the lowest
9 bits would read as the anomalous value. During these reads (which
still happen only when bit 10), bit 9 would read as the correct value.
Reduce the mask by one bit to cover these cases as well.
Cc: stable@vger.kernel.org
Fixes: c950ca8c35ee ("clocksource/drivers/arch\_timer: Workaround for Allwinner A64 timer instability")
Reported-by: Roman Stratiienko
Signed-off-by: Samuel Holland
Signed-off-by: Daniel Lezcano
Link: https://lore.kernel.org/r/20210515021439.55316-1-samuel@sholland.org
Signed-off-by: Greg Kroah-Hartman
commit a34295528a14a733f38b59f6f324d6e34d61d21f
Author: Thomas Gleixner
Date: Sat Mar 27 22:01:36 2021 +0100
cpu/hotplug: Cure the cpusets trainwreck
commit b22afcdf04c96ca58327784e280e10288cfd3303 upstream.
Alexey and Joshua tried to solve a cpusets related hotplug problem which is
user space visible and results in unexpected behaviour for some time after
a CPU has been plugged in and the corresponding uevent was delivered.
cpusets delegate the hotplug work (rebuilding cpumasks etc.) to a
workqueue. This is done because the cpusets code has already a lock
nesting of cgroups\_mutex -> cpu\_hotplug\_lock. A synchronous callback or
waiting for the work to finish with cpu\_hotplug\_lock held can and will
deadlock because that results in the reverse lock order.
As a consequence the uevent can be delivered before cpusets have consistent
state which means that a user space invocation of sched\_setaffinity() to
move a task to the plugged CPU fails up to the point where the scheduled
work has been processed.
The same is true for CPU unplug, but that does not create user observable
failure (yet).
It's still inconsistent to claim that an operation is finished before it
actually is and that's the real issue at hand. uevents just make it
reliably observable.
Obviously the problem should be fixed in cpusets/cgroups, but untangling
that is pretty much impossible because according to the changelog of the
commit which introduced this 8 years ago:
3a5a6d0c2b03("cpuset: don't nest cgroup\_mutex inside get\_online\_cpus()")
the lock order cgroups\_mutex -> cpu\_hotplug\_lock is a design decision and
the whole code is built around that.
So bite the bullet and invoke the relevant cpuset function, which waits for
the work to finish, in \_cpu\_up/down() after dropping cpu\_hotplug\_lock and
only when tasks are not frozen by suspend/hibernate because that would
obviously wait forever.
Waiting there with cpu\_add\_remove\_lock, which is protecting the present
and possible CPU maps, held is not a problem at all because neither work
queues nor cpusets/cgroups have any lockchains related to that lock.
Waiting in the hotplug machinery is not problematic either because there
are already state callbacks which wait for hardware queues to drain. It
makes the operations slightly slower, but hotplug is slow anyway.
This ensures that state is consistent before returning from a hotplug
up/down operation. It's still inconsistent during the operation, but that's
a different story.
Add a large comment which explains why this is done and why this is not a
dump ground for the hack of the day to work around half thought out locking
schemes. Document also the implications vs. hotplug operations and
serialization or the lack of it.
Thanks to Alexy and Joshua for analyzing why this temporary
sched\_setaffinity() failure happened.
Fixes: 3a5a6d0c2b03("cpuset: don't nest cgroup\_mutex inside get\_online\_cpus()")
Reported-by: Alexey Klimov
Reported-by: Joshua Baker
Signed-off-by: Thomas Gleixner
Tested-by: Alexey Klimov
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/87tuowcnv3.ffs@nanos.tec.linutronix.de
Signed-off-by: Greg Kroah-Hartman
commit dcb4b49e3ced01bb3e3ac69cb394accf5615cda1
Author: Zhenyu Ye
Date: Wed Jun 23 15:05:22 2021 +0800
arm64: tlb: fix the TTL value of tlb\_get\_level
commit 52218fcd61cb42bde0d301db4acb3ffdf3463cc7 upstream.
The TTL field indicates the level of page table walk holding the \*leaf\*
entry for the address being invalidated. But currently, the TTL field
may be set to an incorrent value in the following stack:
pte\_free\_tlb
\_\_pte\_free\_tlb
tlb\_remove\_table
tlb\_table\_invalidate
tlb\_flush\_mmu\_tlbonly
tlb\_flush
In this case, we just want to flush a PTE page, but the tlb->cleared\_pmds
is set and we get tlb\_level = 2 in the tlb\_get\_level() function. This may
cause some unexpected problems.
This patch set the TTL field to 0 if tlb->freed\_tables is set. The
tlb->freed\_tables indicates page table pages are freed, not the leaf
entry.
Cc:  # 5.9.x
Fixes: c4ab2cbc1d87 ("arm64: tlb: Set the TTL field in flush\_tlb\_range")
Acked-by: Catalin Marinas
Reported-by: ZhuRui
Signed-off-by: Zhenyu Ye
Link: https://lore.kernel.org/r/b80ead47-1f88-3a00-18e1-cacc22f54cc4@huawei.com
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 31d1d7db49785d74b388c55a5e33bad02061ef35
Author: Timo Sigurdsson
Date: Mon Jun 14 09:25:39 2021 +0200
ata: ahci\_sunxi: Disable DIPM
commit f6bca4d91b2ea052e917cca3f9d866b5cc1d500a upstream.
DIPM is unsupported or broken on sunxi. Trying to enable the power
management policy med\_power\_with\_dipm on an Allwinner A20 SoC based board
leads to immediate I/O errors and the attached SATA disk disappears from
the /dev filesystem. A reset (power cycle) is required to make the SATA
controller or disk work again. The A10 and A20 SoC data sheets and manuals
don't mention DIPM at all [1], so it's fair to assume that it's simply not
supported. But even if it was, it should be considered broken and best be
disabled in the ahci\_sunxi driver.
[1] https://github.com/allwinner-zh/documents/tree/master/
Fixes: c5754b5220f0 ("ARM: sunxi: Add support for Allwinner SUNXi SoCs sata to ahci\_platform")
Cc: stable@vger.kernel.org
Signed-off-by: Timo Sigurdsson
Tested-by: Timo Sigurdsson
Link: https://lore.kernel.org/r/20210614072539.3307-1-public\_timo.s@silentcreek.de
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 3b7c6122f39028cffbd48b67e76ebdc0a12deed4
Author: Kees Cook
Date: Thu Jun 17 15:58:08 2021 -0700
docs: Makefile: Use CONFIG\_SHELL not SHELL
commit 222a28edce38b62074a950fb243df621c602b4d3 upstream.
Fix think-o about which variable to find the Kbuild-configured shell.
This has accidentally worked due to most shells setting $SHELL by
default.
Fixes: 51e46c7a4007 ("docs, parallelism: Rearrange how jobserver reservations are made")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20210617225808.3907377-1-keescook@chromium.org
Signed-off-by: Jonathan Corbet
Signed-off-by: Greg Kroah-Hartman
commit 5c8e4b20e70f948afb618742de76cd93e959458a
Author: Christian Löhle
Date: Wed May 12 16:03:24 2021 +0000
mmc: core: Allow UHS-I voltage switch for SDSC cards if supported
commit 09247e110b2efce3a104e57e887c373e0a57a412 upstream.
While initializing an UHS-I SD card, the mmc core first tries to switch to
1.8V I/O voltage, before it continues to change the settings for the bus
speed mode.
However, the current behaviour in the mmc core is inconsistent and doesn't
conform to the SD spec. More precisely, an SD card that supports UHS-I must
set both the SD\_OCR\_CCS bit and the SD\_OCR\_S18R bit in the OCR register
response. When switching to 1.8V I/O the mmc core correctly checks both of
the bits, but only the SD\_OCR\_S18R bit when changing the settings for bus
speed mode.
Rather than actually fixing the code to confirm to the SD spec, let's
deliberately deviate from it by requiring only the SD\_OCR\_S18R bit for both
parts. This enables us to support UHS-I for SDSC cards (outside spec),
which is actually being supported by some existing SDSC cards. Moreover,
this fixes the inconsistent behaviour.
Signed-off-by: Christian Loehle
Link: https://lore.kernel.org/r/CWXP265MB26803AE79E0AD5ED083BF2A6C4529@CWXP265MB2680.GBRP265.PROD.OUTLOOK.COM
Cc: stable@vger.kernel.org
[Ulf: Rewrote commit message and comments to clarify the changes]
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 3d2e0431e68780cb90996dcedf1c1acc27a87005
Author: Wolfram Sang
Date: Thu Jun 24 17:16:14 2021 +0200
mmc: core: clear flags before allowing to retune
commit 77347eda64ed5c9383961d1de9165f9d0b7d8df6 upstream.
It might be that something goes wrong during tuning so the MMC core will
immediately trigger a retune. In our case it was:
- we sent a tuning block
- there was an error so we need to send an abort cmd to the eMMC
- the abort cmd had a CRC error
- retune was set by the MMC core
This lead to a vicious circle causing a performance regression of 75%.
So, clear retuning flags before we enable retuning to start with a known
cleared state.
Reported-by Yoshihiro Shimoda
Suggested-by: Adrian Hunter
Signed-off-by: Wolfram Sang
Acked-by: Adrian Hunter
Reviewed-by: Yoshihiro Shimoda
Tested-by: Yoshihiro Shimoda
Fixes: bd11e8bd03ca ("mmc: core: Flag re-tuning is needed on CRC errors")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20210624151616.38770-2-wsa+renesas@sang-engineering.com
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit c1b907e43b320c363458ef12efbed1675c2753ea
Author: Al Cooper
Date: Thu Jun 24 12:30:45 2021 -0400
mmc: sdhci: Fix warning message when accessing RPMB in HS400 mode
commit d0244847f9fc5e20df8b7483c8a4717fe0432d38 upstream.
When an eMMC device is being run in HS400 mode, any access to the
RPMB device will cause the error message "mmc1: Invalid UHS-I mode
selected". This happens as a result of tuning being disabled before
RPMB access and then re-enabled after the RPMB access is complete.
When tuning is re-enabled, the system has to switch from HS400
to HS200 to do the tuning and then back to HS400. As part of
sequence to switch from HS400 to HS200 the system is temporarily
put into HS mode. When switching to HS mode, sdhci\_get\_preset\_value()
is called and does not have support for HS mode and prints the warning
message and returns the preset for SDR12. The fix is to add support
for MMC and SD HS modes to sdhci\_get\_preset\_value().
This can be reproduced on any system running eMMC in HS400 mode
(not HS400ES) by using the "mmc" utility to run the following
command: "mmc rpmb read-counter /dev/mmcblk0rpmb".
Signed-off-by: Al Cooper
Acked-by: Adrian Hunter
Fixes: 52983382c74f ("mmc: sdhci: enhance preset value function")
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20210624163045.33651-1-alcooperx@gmail.com
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 7210a1b23c50517031c88bb8dd41bcc3c14b7a47
Author: Hans de Goede
Date: Mon May 3 11:21:57 2021 +0200
mmc: sdhci-acpi: Disable write protect detection on Toshiba Encore 2 WT8-B
commit 94ee6782e045645abd9180ab9369b01293d862bd upstream.
On the Toshiba Encore 2 WT8-B the microSD slot always reports the card
being write-protected even though microSD cards do not have a write-protect
switch at all.
Add a new DMI\_QUIRK\_SD\_NO\_WRITE\_PROTECT quirk entry to sdhci-acpi.c's
DMI quirk table for this.
Signed-off-by: Hans de Goede
Acked-by: Adrian Hunter
Link: https://lore.kernel.org/r/20210503092157.5689-1-hdegoede@redhat.com
Signed-off-by: Ulf Hansson
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 970aa4aefaab2d7fcceeccc3ff6b3f40b66f36e7
Author: Kees Cook
Date: Thu Jun 17 14:33:01 2021 -0700
drm/i915/display: Do not zero past infoframes.vsc
commit 07b72960d2b4a087ff2445e286159e69742069cc upstream.
intel\_dp\_vsc\_sdp\_unpack() was using a memset() size (36, struct dp\_sdp)
larger than the destination (24, struct drm\_dp\_vsc\_sdp), clobbering
fields in struct intel\_crtc\_state after infoframes.vsc. Use the actual
target size for the memset().
Fixes: 1b404b7dbb10 ("drm/i915/dp: Read out DP SDPs")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Reviewed-by: José Roberto de Souza
Signed-off-by: José Roberto de Souza
Link: https://patchwork.freedesktop.org/patch/msgid/20210617213301.1824728-1-keescook@chromium.org
(cherry picked from commit c88e2647c5bb45d04dc4302018ebe6ebbf331823)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit b4772d4e8ec373be3dcc931fa29516cd4c0f451d
Author: Paul Cercueil
Date: Mon Mar 29 18:50:45 2021 +0100
drm/ingenic: Switch IPU plane to type OVERLAY
commit 68b433fe6937cfa3f8975d18643d5956254edd6a upstream.
It should have been an OVERLAY from the beginning. The documentation
stipulates that there should be an unique PRIMARY plane per CRTC.
Fixes: fc1acf317b01 ("drm/ingenic: Add support for the IPU")
Cc:  # 5.8+
Signed-off-by: Paul Cercueil
Acked-by: Simon Ser
Link: https://patchwork.freedesktop.org/patch/msgid/20210329175046.214629-2-paul@crapouillou.net
Signed-off-by: Greg Kroah-Hartman
commit 0256fdf3b07c96a77c701b11663661459f8f1dbb
Author: Daniel Vetter
Date: Tue Apr 27 11:20:16 2021 +0200
drm/nouveau: Don't set allow\_fb\_modifiers explicitly
commit cee93c028288b9af02919f3bd8593ba61d1e610d upstream.
Since
commit 890880ddfdbe256083170866e49c87618b706ac7
Author: Paul Kocialkowski
Date: Fri Jan 4 09:56:10 2019 +0100
drm: Auto-set allow\_fb\_modifiers when given modifiers at plane init
this is done automatically as part of plane init, if drivers set the
modifier list correctly. Which is the case here.
Note that this fixes an inconsistency: We've set the cap everywhere,
but only nv50+ supports modifiers. Hence cc stable, but not further
back then the patch from Paul.
Reviewed-by: Lyude Paul
Cc: stable@vger.kernel.org # v5.1 +
Cc: Pekka Paalanen
Signed-off-by: Daniel Vetter
Cc: Ben Skeggs
Cc: nouveau@lists.freedesktop.org
Link: https://patchwork.freedesktop.org/patch/msgid/20210427092018.832258-6-daniel.vetter@ffwll.ch
Signed-off-by: Greg Kroah-Hartman
commit 8c5960e823bf88beedd24ce4d9781fc1152605d3
Author: Daniel Vetter
Date: Tue Apr 27 11:20:12 2021 +0200
drm/arm/malidp: Always list modifiers
commit 26c3e7fd5a3499e408915dadae5d5360790aae9a upstream.
Even when all we support is linear, make that explicit. Otherwise the
uapi is rather confusing.
Acked-by: Liviu Dudau
Acked-by: Pekka Paalanen
Reviewed-by: Lyude Paul
Cc: stable@vger.kernel.org
Cc: Pekka Paalanen
Cc: Liviu Dudau
Cc: Brian Starkey
Signed-off-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20210427092018.832258-2-daniel.vetter@ffwll.ch
Signed-off-by: Greg Kroah-Hartman
commit a2c67909bb71b41462cb3aa251dc0c3678f27bd6
Author: Daniel Vetter
Date: Tue Apr 27 11:20:15 2021 +0200
drm/msm/mdp4: Fix modifier support enabling
commit 35cbb8c91e9cf310277d3dfb4d046df8edf2df33 upstream.
Setting the cap without the modifier list is very confusing to
userspace. Fix that by listing the ones we support explicitly.
Stable backport so that userspace can rely on this working in a
reasonable way, i.e. that the cap set implies IN\_FORMATS is available.
Acked-by: Pekka Paalanen
Reviewed-by: Lyude Paul
Cc: stable@vger.kernel.org
Cc: Pekka Paalanen
Cc: Rob Clark
Cc: Jordan Crouse
Cc: Emil Velikov
Cc: Sam Ravnborg
Signed-off-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20210427092018.832258-5-daniel.vetter@ffwll.ch
Signed-off-by: Greg Kroah-Hartman
commit 337e397a1e9e7da725505d7b4021b90d10792aaa
Author: Daniel Vetter
Date: Tue Apr 13 11:49:01 2021 +0200
drm/tegra: Don't set allow\_fb\_modifiers explicitly
commit be4306ad928fcf736cbe2616b6dd19d91f1bc083 upstream.
Since
commit 890880ddfdbe256083170866e49c87618b706ac7
Author: Paul Kocialkowski
Date: Fri Jan 4 09:56:10 2019 +0100
drm: Auto-set allow\_fb\_modifiers when given modifiers at plane init
this is done automatically as part of plane init, if drivers set the
modifier list correctly. Which is the case here.
It was slightly inconsistently though, since planes with only linear
modifier support haven't listed that explicitly. Fix that, and cc:
stable to allow userspace to rely on this. Again don't backport
further than where Paul's patch got added.
Cc: stable@vger.kernel.org # v5.1 +
Cc: Pekka Paalanen
Acked-by: Thierry Reding
Signed-off-by: Daniel Vetter
Cc: Thierry Reding
Cc: Jonathan Hunter
Cc: linux-tegra@vger.kernel.org
Link: https://patchwork.freedesktop.org/patch/msgid/20210413094904.3736372-10-daniel.vetter@ffwll.ch
Signed-off-by: Greg Kroah-Hartman
commit 5c2196d8286e1ba3a5c0a0c1466dc672530e7a3f
Author: Paul Cercueil
Date: Tue Mar 23 14:40:08 2021 +0000
drm/ingenic: Fix pixclock rate for 24-bit serial panels
commit 60a6b73dd821e98fe958b2a83393ccd724b306b1 upstream.
When using a 24-bit panel on a 8-bit serial bus, the pixel clock
requested by the panel has to be multiplied by 3, since the subpixels
are shifted sequentially.
The code (in ingenic\_drm\_encoder\_atomic\_check) already computed
crtc\_state->adjusted\_mode->crtc\_clock accordingly, but clk\_set\_rate()
used crtc\_state->adjusted\_mode->clock instead.
Fixes: 28ab7d35b6e0 ("drm/ingenic: Properly compute timings when using a 3x8-bit panel")
Cc: stable@vger.kernel.org # v5.10
Signed-off-by: Paul Cercueil
Tested-by: H. Nikolaus Schaller  # CI20/jz4780 (HDMI) and Alpha400/jz4730 (LCD)
Acked-by: Thomas Zimmermann
Link: https://patchwork.freedesktop.org/patch/msgid/20210323144008.166248-1-paul@crapouillou.net
Signed-off-by: Greg Kroah-Hartman
commit 858d38315fc305a3d2a334d1cc7481cb1bb4a367
Author: Harry Wentland
Date: Thu Apr 22 19:10:52 2021 -0400
drm/amd/display: Reject non-zero src\_y and src\_x for video planes
commit c6c6a712199ab355ce333fa5764a59506bb107c1 upstream.
[Why]
This hasn't been well tested and leads to complete system hangs on DCN1
based systems, possibly others.
The system hang can be reproduced by gesturing the video on the YouTube
Android app on ChromeOS into full screen.
[How]
Reject atomic commits with non-zero drm\_plane\_state.src\_x or src\_y values.
v2:
- Add code comment describing the reason we're rejecting non-zero
src\_x and src\_y
- Drop gerrit Change-Id
- Add stable CC
- Based on amd-staging-drm-next
v3: removed trailing whitespace
Signed-off-by: Harry Wentland
Cc: stable@vger.kernel.org
Cc: nicholas.kazlauskas@amd.com
Cc: amd-gfx@lists.freedesktop.org
Cc: alexander.deucher@amd.com
Cc: Roman.Li@amd.com
Cc: hersenxs.wu@amd.com
Cc: danny.wang@amd.com
Reviewed-by: Nicholas Kazlauskas
Acked-by: Christian König
Reviewed-by: Hersen Wu
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 6683128d7ca548d9138e41381afaca96245805f9
Author: Maximilian Luz
Date: Wed May 12 23:03:16 2021 +0200
pinctrl/amd: Add device HID for new AMD GPIO controller
commit 1ca46d3e43569186bd1decfb02a6b4c4ddb4304b upstream.
Add device HID AMDI0031 to the AMD GPIO controller driver match table.
This controller can be found on Microsoft Surface Laptop 4 devices and
seems similar enough that we can just copy the existing AMDI0030 entry.
Cc:  # 5.10+
Tested-by: Sachi King
Signed-off-by: Maximilian Luz
Link: https://lore.kernel.org/r/20210512210316.1982416-1-luzmaximilian@gmail.com
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit dcb7f78b876c0eedfea68211d6e9472efce95330
Author: Guchun Chen
Date: Mon Jun 28 17:03:48 2021 +0800
drm/amd/display: fix incorrrect valid irq check
commit e38ca7e422791a4d1c01e56dbf7f9982db0ed365 upstream.
valid DAL irq should be < DAL\_IRQ\_SOURCES\_NUMBER.
Signed-off-by: Guchun Chen
Reviewed-and-tested-by: Evan Quan
Reviewed-by: Harry Wentland
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 72cba7be364868aeb0993f82d9209ce3fe4eadec
Author: Thomas Hebb
Date: Sun Apr 18 19:03:04 2021 -0700
drm/rockchip: dsi: remove extra component\_del() call
commit b354498bbe65c917d521b3b56317ddc9ab217425 upstream.
commit cf6d100dd238 ("drm/rockchip: dsi: add dual mipi support") added
this devcnt field and call to component\_del(). However, these both
appear to be erroneous changes left over from an earlier version of the
patch. In the version merged, nothing ever modifies devcnt, meaning
component\_del() runs unconditionally and in addition to the
component\_del() calls in dw\_mipi\_dsi\_rockchip\_host\_detach(). The second
call fails to delete anything and produces a warning in dmesg.
If we look at the previous version of the patch[1], however, we see that
it had logic to calculate devcnt and call component\_add() in certain
situations. This was removed in v6, and the fact that the deletion code
was not appears to have been an oversight.
[1] https://patchwork.kernel.org/project/dri-devel/patch/20180821140515.22246-8-heiko@sntech.de/
Fixes: cf6d100dd238 ("drm/rockchip: dsi: add dual mipi support")
Cc: stable@vger.kernel.org
Signed-off-by: Thomas Hebb
Signed-off-by: Heiko Stuebner
Link: https://patchwork.freedesktop.org/patch/msgid/201385acb0eeb5dfb037afdc6a94bfbcdab97f99.1618797778.git.tommyhebb@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit e7762bc634c8d9b2c1c21e4d39b08a27158aa85b
Author: Lyude Paul
Date: Fri Apr 30 18:34:27 2021 -0400
drm/dp: Handle zeroed port counts in drm\_dp\_read\_downstream\_info()
commit 205bb69a90363541a634a662a599fddb95956524 upstream.
While the DP specification isn't entirely clear on if this should be
allowed or not, some branch devices report having downstream ports present
while also reporting a downstream port count of 0. So to avoid breaking
those devices, we need to handle this in drm\_dp\_read\_downstream\_info().
So, to do this we assume there's no downstream port info when the
downstream port count is 0.
Signed-off-by: Lyude Paul
Tested-by: Jérôme de Bretagne
Bugzilla: https://gitlab.freedesktop.org/drm/intel/-/issues/3416
Fixes: 3d3721ccb18a ("drm/i915/dp: Extract drm\_dp\_read\_downstream\_info()")
Cc:  # v5.10+
Reviewed-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20210430223428.10514-1-lyude@redhat.com
Signed-off-by: Greg Kroah-Hartman
commit bab3618ca92cfd19082e50b3b6ac6dfb973865b1
Author: Maxime Ripard
Date: Fri May 7 17:05:09 2021 +0200
drm/vc4: hdmi: Prevent clock unbalance
commit 5b006000423667ef0f55721fc93e477b31f22d28 upstream.
Since we fixed the hooks to disable the encoder at boot, we now have an
unbalanced clk\_disable call at boot since we never enabled them in the
first place.
Let's mimic the state of the hardware and enable the clocks at boot if
the controller is enabled to get the use-count right.
Cc:  # v5.10+
Fixes: 09c438139b8f ("drm/vc4: hdmi: Implement finer-grained hooks")
Signed-off-by: Maxime Ripard
Reviewed-by: Dave Stevenson
Link: https://patchwork.freedesktop.org/patch/msgid/20210507150515.257424-7-maxime@cerno.tech
Signed-off-by: Greg Kroah-Hartman
commit dee39749424bcab86defbd20470b7149ee4584e8
Author: Maxime Ripard
Date: Fri May 7 17:05:05 2021 +0200
drm/vc4: crtc: Skip the TXP
commit 47a50743031ad4138050ae6d266ddd3dfe845ead upstream.
The vc4\_set\_crtc\_possible\_masks is meant to run over all the encoders
and then set their possible\_crtcs mask to their associated pixelvalve.
However, since the commit 39fcb2808376 ("drm/vc4: txp: Turn the TXP into
a CRTC of its own"), the TXP has been turned to a CRTC and encoder of
its own, and while it does indeed register an encoder, it no longer has
an associated pixelvalve. The code will thus run over the TXP encoder
and set a bogus possible\_crtcs mask, overriding the one set in the TXP
bind function.
In order to fix this, let's skip any virtual encoder.
Cc:  # v5.9+
Fixes: 39fcb2808376 ("drm/vc4: txp: Turn the TXP into a CRTC of its own")
Acked-by: Thomas Zimmermann
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/20210507150515.257424-3-maxime@cerno.tech
Signed-off-by: Greg Kroah-Hartman
commit da442a77dd496e8747ee7457cb70877d66484eba
Author: Maxime Ripard
Date: Fri May 7 17:05:04 2021 +0200
drm/vc4: txp: Properly set the possible\_crtcs mask
commit bf6de8e61509f3c957d7f75f017b18d40a18a950 upstream.
The current code does a binary OR on the possible\_crtcs variable of the
TXP encoder, while we want to set it to that value instead.
Cc:  # v5.9+
Fixes: 39fcb2808376 ("drm/vc4: txp: Turn the TXP into a CRTC of its own")
Acked-by: Thomas Zimmermann
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/20210507150515.257424-2-maxime@cerno.tech
Signed-off-by: Greg Kroah-Hartman
commit e4f2d5c772050a6ec3e08773325798de55438e83
Author: Tiezhu Yang
Date: Mon Jun 28 10:53:06 2021 -0400
drm/radeon: Call radeon\_suspend\_kms() in radeon\_pci\_shutdown() for Loongson64
commit c1bfd74bfef77bcefc88d12eaf8996c0dfd51331 upstream.
On the Loongson64 platform used with Radeon GPU, shutdown or reboot failed
when console=tty is in the boot cmdline.
radeon\_suspend\_kms() puts the hw in the suspend state, especially set fb
state as FBINFO\_STATE\_SUSPENDED:
if (fbcon) {
console\_lock();
radeon\_fbdev\_set\_suspend(rdev, 1);
console\_unlock();
}
Then avoid to do any more fb operations in the related functions:
if (p->state != FBINFO\_STATE\_RUNNING)
return;
So call radeon\_suspend\_kms() in radeon\_pci\_shutdown() for Loongson64 to fix
this issue, it looks like some kind of workaround like powerpc.
Co-developed-by: Jianmin Lv
Signed-off-by: Jianmin Lv
Signed-off-by: Tiezhu Yang
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 63de459218223d59209ddd6a83a9e09490c092ef
Author: Jing Xiangfeng
Date: Tue Jun 29 19:44:55 2021 +0800
drm/radeon: Add the missed drm\_gem\_object\_put() in radeon\_user\_framebuffer\_create()
commit 9ba85914c36c8fed9bf3e8b69c0782908c1247b7 upstream.
radeon\_user\_framebuffer\_create() misses to call drm\_gem\_object\_put() in
an error path. Add the missed function call to fix it.
Reviewed-by: Christian König
Signed-off-by: Jing Xiangfeng
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 7764d2c698d7ab3e38092c808699f05a0e45210d
Author: Evan Quan
Date: Tue May 25 14:36:29 2021 +0800
drm/amdgpu: fix the hang caused by PCIe link width switch
commit adcf949e664a8b04df2fb8aa916892e58561653c upstream.
SMU had set all the necessary fields for a link width switch
but the width switch wasn't occurring because the link was idle
in the L1 state. Setting LC\_L1\_RECONFIG\_EN=0x1 will allow width
switches to also be initiated while in L1 instead of waiting until
the link is back in L0.
Signed-off-by: Evan Quan
Reviewed-by: Lijo Lazar
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 0d3a1e59fd9d13d0d0ad586fb7abf3df20ba417c
Author: Evan Quan
Date: Tue May 25 12:08:53 2021 +0800
drm/amdgpu: fix NAK-G generation during PCI-e link width switch
commit 5a5da8ae9546031e43efd4fa5aa8baa481e83dfb upstream.
A lot of NAK-G being generated when link widht switching is happening.
WA for this issue is to program the SPC to 4 symbols per clock during
bootup when the native PCIE width is x4.
Signed-off-by: Evan Quan
Reviewed-by: Lijo Lazar
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 5af51c7bc675637da0e934d1aefda89a5f8503db
Author: Aaron Liu
Date: Fri Jun 25 13:50:19 2021 +0800
drm/amdgpu: enable sdma0 tmz for Raven/Renoir(V2)
commit e2329e74a615cc58b25c42b7aa1477a5e3f6a435 upstream.
Without driver loaded, SDMA0\_UTCL1\_PAGE.TMZ\_ENABLE is set to 1
by default for all asic. On Raven/Renoir, the sdma goldsetting
changes SDMA0\_UTCL1\_PAGE.TMZ\_ENABLE to 0.
This patch restores SDMA0\_UTCL1\_PAGE.TMZ\_ENABLE to 1.
Signed-off-by: Aaron Liu
Acked-by: Luben Tuikov
Acked-by: Alex Deucher
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit fb5beb2b3f06775e84abed6472ea71efb74a4a8c
Author: Joseph Greathouse
Date: Tue Jun 29 21:08:52 2021 -0500
drm/amdgpu: Update NV SIMD-per-CU to 2
commit aa6158112645aae514982ad8d56df64428fcf203 upstream.
Navi series GPUs have 2 SIMDs per CU (and then 2 CUs per WGP).
The NV enum headers incorrectly listed this as 4, which later meant
we were incorrectly reporting the number of SIMDs in the HSA
topology. This could cause problems down the line for user-space
applications that want to launch a fixed amount of work to each
SIMD.
Signed-off-by: Joseph Greathouse
Reviewed-by: Alex Deucher
Reviewed-by: Felix Kuehling
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 788c261cdb58b220b91b3eb61b230fa7af802d19
Author: Alex Deucher
Date: Mon Jun 28 15:56:01 2021 -0400
drm/amdgpu: add new dimgrey cavefish DID
commit 06ac9b6c736ac9da600b1782d7ac6d6e746286c4 upstream.
Add new PCI device id.
Reviewed-by: Guchun Chen
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 7fad97798d9b27efaf945dfa1fcad113f35943b7
Author: Haren Myneni
Date: Thu Jun 17 13:29:05 2021 -0700
powerpc/powernv/vas: Release reference to tgid during window close
commit 91cdbb955aa94ee0841af4685be40937345d29b8 upstream.
The kernel handles the NX fault by updating CSB or sending
signal to process. In multithread applications, children can
open VAS windows and can exit without closing them. But the
parent can continue to send NX requests with these windows. To
prevent pid reuse, reference will be taken on pid and tgid
when the window is opened and release them during window close.
The current code is not releasing the tgid reference which can
cause pid leak and this patch fixes the issue.
Fixes: db1c08a740635 ("powerpc/vas: Take reference to PID and mm for user space windows")
Cc: stable@vger.kernel.org # 5.8+
Reported-by: Nicholas Piggin
Signed-off-by: Haren Myneni
Reviewed-by: Nicholas Piggin
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/6020fc4d444864fe20f7dcdc5edfe53e67480a1c.camel@linux.ibm.com
Signed-off-by: Greg Kroah-Hartman
commit 30a401a03189dc06665f97fe6dc0540993abe215
Author: Nathan Chancellor
Date: Fri May 28 11:27:52 2021 -0700
powerpc/barrier: Avoid collision with clang's \_\_lwsync macro
commit 015d98149b326e0f1f02e44413112ca8b4330543 upstream.
A change in clang 13 results in the \_\_lwsync macro being defined as
\_\_builtin\_ppc\_lwsync, which emits 'lwsync' or 'msync' depending on what
the target supports. This breaks the build because of -Werror in
arch/powerpc, along with thousands of warnings:
In file included from arch/powerpc/kernel/pmc.c:12:
In file included from include/linux/bug.h:5:
In file included from arch/powerpc/include/asm/bug.h:109:
In file included from include/asm-generic/bug.h:20:
In file included from include/linux/kernel.h:12:
In file included from include/linux/bitops.h:32:
In file included from arch/powerpc/include/asm/bitops.h:62:
arch/powerpc/include/asm/barrier.h:49:9: error: '\_\_lwsync' macro redefined [-Werror,-Wmacro-redefined]
#define \_\_lwsync() \_\_asm\_\_ \_\_volatile\_\_ (stringify\_in\_c(LWSYNC) : : :"memory")
^
:308:9: note: previous definition is here
#define \_\_lwsync \_\_builtin\_ppc\_lwsync
^
1 error generated.
Undefine this macro so that the runtime patching introduced by
commit 2d1b2027626d ("powerpc: Fixup lwsync at runtime") continues to
work properly with clang and the build no longer breaks.
Cc: stable@vger.kernel.org
Signed-off-by: Nathan Chancellor
Reviewed-by: Nick Desaulniers
Signed-off-by: Michael Ellerman
Link: https://github.com/ClangBuiltLinux/linux/issues/1386
Link: https://github.com/llvm/llvm-project/commit/62b5df7fe2b3fda1772befeda15598fbef96a614
Link: https://lore.kernel.org/r/20210528182752.1852002-1-nathan@kernel.org
Signed-off-by: Greg Kroah-Hartman
commit cc7442037062c8201f34459a3d885ee4078e4d38
Author: Cédric Le Goater
Date: Thu Jul 1 17:24:12 2021 +0200
powerpc/xive: Fix error handling when allocating an IPI
commit 3f601608b71c3ca1e199898cd16f09d707fedb56 upstream.
This is a smatch warning:
arch/powerpc/sysdev/xive/common.c:1161 xive\_request\_ipi() warn: unsigned 'xid->irq' is never less than zero.
Fixes: fd6db2892eba ("powerpc/xive: Modernize XIVE-IPI domain with an 'alloc' handler")
Cc: stable@vger.kernel.org # v5.13
Reported-by: kernel test robot
Signed-off-by: Cédric Le Goater
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20210701152412.1507612-1-clg@kaod.org
Signed-off-by: Greg Kroah-Hartman
commit 7feb683793eadb04ef9b233ee771f1dad77a1781
Author: Naveen N. Rao
Date: Thu Jul 1 20:38:59 2021 +0530
powerpc/bpf: Reject atomic ops in ppc32 JIT
commit 307e5042c7bdae15308ef2e9b848833b84122eb0 upstream.
Commit 91c960b0056672 ("bpf: Rename BPF\_XADD and prepare to encode other
atomics in .imm") converted BPF\_XADD to BPF\_ATOMIC and updated all JIT
implementations to reject JIT'ing instructions with an immediate value
different from BPF\_ADD. However, ppc32 BPF JIT was implemented around
the same time and didn't include the same change. Update the ppc32 JIT
accordingly.
Fixes: 51c66ad849a7 ("powerpc/bpf: Implement extended BPF on PPC32")
Cc: stable@vger.kernel.org # v5.13+
Signed-off-by: Naveen N. Rao
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/426699046d89fe50f66ecf74bd31c01eda976ba5.1625145429.git.naveen.n.rao@linux.vnet.ibm.com
Signed-off-by: Greg Kroah-Hartman
commit 8a96ec5ebf96ad8e2ba7b1b34103a0be5140fc70
Author: Christophe Leroy
Date: Thu Jul 1 11:17:08 2021 +0000
powerpc/mm: Fix lockup on kernel exec fault
commit cd5d5e602f502895e47e18cd46804d6d7014e65c upstream.
The powerpc kernel is not prepared to handle exec faults from kernel.
Especially, the function is\_exec\_fault() will return 'false' when an
exec fault is taken by kernel, because the check is based on reading
current->thread.regs->trap which contains the trap from user.
For instance, when provoking a LKDTM EXEC\_USERSPACE test,
current->thread.regs->trap is set to SYSCALL trap (0xc00), and
the fault taken by the kernel is not seen as an exec fault by
set\_access\_flags\_filter().
Commit d7df2443cd5f ("powerpc/mm: Fix spurious segfaults on radix
with autonuma") made it clear and handled it properly. But later on
commit d3ca587404b3 ("powerpc/mm: Fix reporting of kernel execute
faults") removed that handling, introducing test based on error\_code.
And here is the problem, because on the 603 all upper bits of SRR1
get cleared when the TLB instruction miss handler bails out to ISI.
Until commit cbd7e6ca0210 ("powerpc/fault: Avoid heavy
search\_exception\_tables() verification"), an exec fault from kernel
at a userspace address was indirectly caught by the lack of entry for
that address in the exception tables. But after that commit the
kernel mainly relies on KUAP or on core mm handling to catch wrong
user accesses. Here the access is not wrong, so mm handles it.
It is a minor fault because PAGE\_EXEC is not set,
set\_access\_flags\_filter() should set PAGE\_EXEC and voila.
But as is\_exec\_fault() returns false as explained in the beginning,
set\_access\_flags\_filter() bails out without setting PAGE\_EXEC flag,
which leads to a forever minor exec fault.
As the kernel is not prepared to handle such exec faults, the thing to
do is to fire in bad\_kernel\_fault() for any exec fault taken by the
kernel, as it was prior to commit d3ca587404b3.
Fixes: d3ca587404b3 ("powerpc/mm: Fix reporting of kernel execute faults")
Cc: stable@vger.kernel.org # v4.14+
Signed-off-by: Christophe Leroy
Acked-by: Nicholas Piggin
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/024bb05105050f704743a0083fe3548702be5706.1625138205.git.christophe.leroy@csgroup.eu
Signed-off-by: Greg Kroah-Hartman
commit 987a852734e668e0829cf65dd182e44a03064800
Author: Aneesh Kumar K.V
Date: Wed Jul 7 18:10:15 2021 -0700
mm/mremap: hold the rmap lock in write mode when moving page table entries.
commit 97113eb39fa7972722ff490b947d8af023e1f6a2 upstream.
To avoid a race between rmap walk and mremap, mremap does
take\_rmap\_locks(). The lock was taken to ensure that rmap walk don't miss
a page table entry due to PTE moves via move\_pagetables(). The kernel
does further optimization of this lock such that if we are going to find
the newly added vma after the old vma, the rmap lock is not taken. This
is because rmap walk would find the vmas in the same order and if we don't
find the page table attached to older vma we would find it with the new
vma which we would iterate later.
As explained in commit eb66ae030829 ("mremap: properly flush TLB before
releasing the page") mremap is special in that it doesn't take ownership
of the page. The optimized version for PUD/PMD aligned mremap also
doesn't hold the ptl lock. This can result in stale TLB entries as show
below.
This patch updates the rmap locking requirement in mremap to handle the race condition
explained below with optimized mremap::
Optmized PMD move
CPU 1 CPU 2 CPU 3
mremap(old\_addr, new\_addr) page\_shrinker/try\_to\_unmap\_one
mmap\_write\_lock\_killable()
addr = old\_addr
lock(pte\_ptl)
lock(pmd\_ptl)
pmd = \*old\_pmd
pmd\_clear(old\_pmd)
flush\_tlb\_range(old\_addr)
\*new\_pmd = pmd
\*new\_addr = 10; and fills
TLB with new addr
and old pfn
unlock(pmd\_ptl)
ptep\_clear\_flush()
old pfn is free.
Stale TLB entry
Optimized PUD move also suffers from a similar race. Both the above race
condition can be fixed if we force mremap path to take rmap lock.
Link: https://lkml.kernel.org/r/20210616045239.370802-7-aneesh.kumar@linux.ibm.com
Fixes: 2c91bd4a4e2e ("mm: speed up mremap by 20x on large regions")
Fixes: c49dd3401802 ("mm: speedup mremap on 1GB or larger regions")
Link: https://lore.kernel.org/linux-mm/CAHk-=wgXVR04eBNtxQfevontWnP6FDm+oj5vauQXP3S-huwbPw@mail.gmail.com
Signed-off-by: Aneesh Kumar K.V
Acked-by: Hugh Dickins
Acked-by: Kirill A. Shutemov
Cc: Christophe Leroy
Cc: Joel Fernandes
Cc: Kalesh Singh
Cc: Kirill A. Shutemov
Cc: Michael Ellerman
Cc: Nicholas Piggin
Cc: Stephen Rothwell
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f908381a3ec721fb259bfbc6cbe4fdb607e074c2
Author: Paul Cercueil
Date: Fri Jun 25 11:49:29 2021 +0100
MIPS: MT extensions are not available on MIPS32r1
commit cad065ed8d8831df67b9754cc4437ed55d8b48c0 upstream.
MIPS MT extensions were added with the MIPS 34K processor, which was
based on the MIPS32r2 ISA.
This fixes a build error when building a generic kernel for a MIPS32r1
CPU.
Fixes: c434b9f80b09 ("MIPS: Kconfig: add MIPS\_GENERIC\_KERNEL symbol")
Cc: stable@vger.kernel.org # v5.9
Signed-off-by: Paul Cercueil
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Greg Kroah-Hartman
commit eecc96e0458c54809618277f6565b72581541bd4
Author: Vidya Sagar
Date: Tue May 4 22:51:57 2021 +0530
PCI: tegra194: Fix host initialization during resume
commit c4bf1f25c6c187864681d5ad4dd1fa92f62d5d32 upstream.
Commit 275e88b06a27 ("PCI: tegra: Fix host link initialization") broke
host initialization during resume as it misses out calling the API
dw\_pcie\_setup\_rc() which is required for host and MSI initialization.
Link: https://lore.kernel.org/r/20210504172157.29712-1-vidyas@nvidia.com
Fixes: 275e88b06a27 ("PCI: tegra: Fix host link initialization")
Tested-by: Jon Hunter
Signed-off-by: Vidya Sagar
Signed-off-by: Lorenzo Pieralisi
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit b63416bc9d6de0d9a8d0c66c3e816d5a4d5f5d98
Author: 周琰杰 (Zhou Yanjie)
Date: Sat Jun 26 14:18:40 2021 +0800
MIPS: CI20: Reduce clocksource to 750 kHz.
[ Upstream commit 23c64447b3538a6f34cb38aae3bc19dc1ec53436 ]
The original clock (3 MHz) is too fast for the clocksource,
there will be a chance that the system may get stuck.
Reported-by: Nikolaus Schaller
Tested-by: Nikolaus Schaller  # on CI20
Signed-off-by: 周琰杰 (Zhou Yanjie)
Acked-by: Paul Cercueil
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 8e3f6e978e4c69d23693caf4c84beb6ee9a297ba
Author: Nick Desaulniers
Date: Mon Jun 28 14:50:26 2021 -0700
MIPS: set mips32r5 for virt extensions
[ Upstream commit c994a3ec7ecc8bd2a837b2061e8a76eb8efc082b ]
Clang's integrated assembler only accepts these instructions when the
cpu is set to mips32r5. With this change, we can assemble
malta\_defconfig with Clang via `make LLVM\_IAS=1`.
Link: https://github.com/ClangBuiltLinux/linux/issues/763
Reported-by: Dmitry Golovin
Signed-off-by: Nick Desaulniers
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 1930d84a29d41a33c78a29ec0bec3e62cd57f06c
Author: zhanglianjie
Date: Mon Jun 28 17:11:05 2021 +0800
MIPS: loongsoon64: Reserve memory below starting pfn to prevent Oops
[ Upstream commit 6817c944430d00f71ccaa9c99ff5b0096aeb7873 ]
The cause of the problem is as follows:
1. when cat /sys/devices/system/memory/memory0/valid\_zones,
test\_pages\_in\_a\_zone() will be called.
2. test\_pages\_in\_a\_zone() finds the zone according to stat\_pfn = 0.
The smallest pfn of the numa node in the mips architecture is 128,
and the page corresponding to the previous 0~127 pfn is not
initialized (page->flags is 0xFFFFFFFF)
3. The nid and zonenum obtained using page\_zone(pfn\_to\_page(0)) are out
of bounds in the corresponding array,
&NODE\_DATA(page\_to\_nid(page))->node\_zones[page\_zonenum(page)],
access to the out-of-bounds zone member variables appear abnormal,
resulting in Oops.
Therefore, it is necessary to keep the page between 0 and the minimum
pfn to prevent Oops from appearing.
Signed-off-by: zhanglianjie
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 92b74375a1bbf5f7f64f4ea98064a5ba62956bcc
Author: Marcelo Ricardo Leitner
Date: Mon Jun 28 16:13:42 2021 -0300
sctp: add size validation when walking chunks
[ Upstream commit 50619dbf8db77e98d821d615af4f634d08e22698 ]
The first chunk in a packet is ensured to be present at the beginning of
sctp\_rcv(), as a packet needs to have at least 1 chunk. But the second
one, may not be completely available and ch->length can be over
uninitialized memory.
Fix here is by only trying to walk on the next chunk if there is enough to
hold at least the header, and then proceed with the ch->length validation
that is already there.
Reported-by: Ilja Van Sprundel
Signed-off-by: Marcelo Ricardo Leitner
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4ecabee69d190f2bd9bdc5140109a27231428413
Author: Marcelo Ricardo Leitner
Date: Mon Jun 28 16:13:41 2021 -0300
sctp: validate from\_addr\_param return
[ Upstream commit 0c5dc070ff3d6246d22ddd931f23a6266249e3db ]
Ilja reported that, simply putting it, nothing was validating that
from\_addr\_param functions were operating on initialized memory. That is,
the parameter itself was being validated by sctp\_walk\_params, but it
doesn't check for types and their specific sizes and it could be a 0-length
one, causing from\_addr\_param to potentially work over the next parameter or
even uninitialized memory.
The fix here is to, in all calls to from\_addr\_param, check if enough space
is there for the wanted IP address type.
Reported-by: Ilja Van Sprundel
Signed-off-by: Marcelo Ricardo Leitner
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 5f7ca3459118382d2d061dcc09b184ac6ce20ef6
Author: gushengxian
Date: Sat Jun 26 04:56:06 2021 -0700
flow\_offload: action should not be NULL when it is referenced
[ Upstream commit 9ea3e52c5bc8bb4a084938dc1e3160643438927a ]
"action" should not be NULL when it is referenced.
Signed-off-by: gushengxian <13145886936@163.com>
Signed-off-by: gushengxian
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit e9d02dbbab0ad73f5727ebbf050aac27f00ce105
Author: Rustam Kovhaev
Date: Sat Jun 26 11:11:56 2021 -0700
bpf: Fix false positive kmemleak report in bpf\_ringbuf\_area\_alloc()
[ Upstream commit ccff81e1d028bbbf8573d3364a87542386c707bf ]
kmemleak scans struct page, but it does not scan the page content. If we
allocate some memory with kmalloc(), then allocate page with alloc\_page(),
and if we put kmalloc pointer somewhere inside that page, kmemleak will
report kmalloc pointer as a false positive.
We can instruct kmemleak to scan the memory area by calling kmemleak\_alloc()
and kmemleak\_free(), but part of struct bpf\_ringbuf is mmaped to user space,
and if struct bpf\_ringbuf changes we would have to revisit and review size
argument in kmemleak\_alloc(), because we do not want kmemleak to scan the
user space memory. Let's simplify things and use kmemleak\_not\_leak() here.
For posterity, also adding additional prior analysis from Andrii:
I think either kmemleak or syzbot are misreporting this. I've added a
bunch of printks around all allocations performed by BPF ringbuf. [...]
On repro side I get these two warnings:
[vmuser@archvm bpf]$ sudo ./repro
BUG: memory leak
unreferenced object 0xffff88810d538c00 (size 64):
comm "repro", pid 2140, jiffies 4294692933 (age 14.540s)
hex dump (first 32 bytes):
00 af 19 04 00 ea ff ff c0 ae 19 04 00 ea ff ff ................
80 ae 19 04 00 ea ff ff c0 29 2e 04 00 ea ff ff .........)......
backtrace:
[<0000000077bfbfbd>] \_\_bpf\_map\_area\_alloc+0x31/0xc0
[<00000000587fa522>] ringbuf\_map\_alloc.cold.4+0x48/0x218
[<0000000044d49e96>] \_\_do\_sys\_bpf+0x359/0x1d90
[<00000000f601d565>] do\_syscall\_64+0x2d/0x40
[<0000000043d3112a>] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
BUG: memory leak
unreferenced object 0xffff88810d538c80 (size 64):
comm "repro", pid 2143, jiffies 4294699025 (age 8.448s)
hex dump (first 32 bytes):
80 aa 19 04 00 ea ff ff 00 ab 19 04 00 ea ff ff ................
c0 ab 19 04 00 ea ff ff 80 44 28 04 00 ea ff ff .........D(.....
backtrace:
[<0000000077bfbfbd>] \_\_bpf\_map\_area\_alloc+0x31/0xc0
[<00000000587fa522>] ringbuf\_map\_alloc.cold.4+0x48/0x218
[<0000000044d49e96>] \_\_do\_sys\_bpf+0x359/0x1d90
[<00000000f601d565>] do\_syscall\_64+0x2d/0x40
[<0000000043d3112a>] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Note that both reported leaks (ffff88810d538c80 and ffff88810d538c00)
correspond to pages array bpf\_ringbuf is allocating and tracking properly
internally. Note also that syzbot repro doesn't close FD of created BPF
ringbufs, and even when ./repro itself exits with error, there are still
two forked processes hanging around in my system. So clearly ringbuf maps
are alive at that point. So reporting any memory leak looks weird at that
point, because that memory is being used by active referenced BPF ringbuf.
It's also a question why repro doesn't clean up its forks. But if I do a
`pkill repro`, I do see that all the allocated memory is /properly/ cleaned
up [and the] "leaks" are deallocated properly.
BTW, if I add close() right after bpf() syscall in syzbot repro, I see that
everything is immediately deallocated, like designed. And no memory leak
is reported. So I don't think the problem is anywhere in bpf\_ringbuf code,
rather in the leak detection and/or repro itself.
Reported-by: syzbot+5d895828587f49e7fe9b@syzkaller.appspotmail.com
Signed-off-by: Rustam Kovhaev
[ Daniel: also included analysis from Andrii to the commit log ]
Signed-off-by: Daniel Borkmann
Tested-by: syzbot+5d895828587f49e7fe9b@syzkaller.appspotmail.com
Cc: Dmitry Vyukov
Cc: Andrii Nakryiko
Link: https://lore.kernel.org/bpf/CAEf4BzYk+dqs+jwu6VKXP-RttcTEGFe+ySTGWT9CRNkagDiJVA@mail.gmail.com
Link: https://lore.kernel.org/lkml/YNTAqiE7CWJhOK2M@nuc10
Link: https://lore.kernel.org/lkml/20210615101515.GC26027@arm.com
Link: https://syzkaller.appspot.com/bug?extid=5d895828587f49e7fe9b
Link: https://lore.kernel.org/bpf/20210626181156.1873604-1-rkovhaev@gmail.com
Signed-off-by: Sasha Levin
commit 5f2d7f0241e220520318d79d14151fbafa5194db
Author: Odin Ugedal
Date: Thu Jun 24 13:18:15 2021 +0200
sched/fair: Ensure \_sum and \_avg values stay consistent
[ Upstream commit 1c35b07e6d3986474e5635be566e7bc79d97c64d ]
The \_sum and \_avg values are in general sync together with the PELT
divider. They are however not always completely in perfect sync,
resulting in situations where \_sum gets to zero while \_avg stays
positive. Such situations are undesirable.
This comes from the fact that PELT will increase period\_contrib, also
increasing the PELT divider, without updating \_sum and \_avg values to
stay in perfect sync where (\_sum == \_avg \* divider). However, such PELT
change will never lower \_sum, making it impossible to end up in a
situation where \_sum is zero and \_avg is not.
Therefore, we need to ensure that when subtracting load outside PELT,
that when \_sum is zero, \_avg is also set to zero. This occurs when
(\_sum < \_avg \* divider), and the subtracted (\_avg \* divider) is bigger
or equal to the current \_sum, while the subtracted \_avg is smaller than
the current \_avg.
Reported-by: Sachin Sant
Reported-by: Naresh Kamboju
Signed-off-by: Odin Ugedal
Signed-off-by: Peter Zijlstra (Intel)
Reviewed-by: Vincent Guittot
Tested-by: Sachin Sant
Link: https://lore.kernel.org/r/20210624111815.57937-1-odin@uged.al
Signed-off-by: Sasha Levin
commit 377c584c325efe4eca9d7117684a07e82267213d
Author: Tim Jiang
Date: Tue Jun 1 17:57:10 2021 +0800
Bluetooth: btusb: fix bt fiwmare downloading failure issue for qca btsoc.
[ Upstream commit 4f00bfb372674d586c4a261bfc595cbce101fbb6 ]
This is btsoc timing issue, after host start to downloading bt firmware,
ep2 need time to switch from function acl to function dfu, so host add
20ms delay as workaround.
Signed-off-by: Tim Jiang
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 387d99b463afd0f6d6db006b3008eee5c5d68c85
Author: Tim Jiang
Date: Tue Jun 1 17:57:25 2021 +0800
Bluetooth: btusb: use default nvm if boardID is 0 for wcn6855.
[ Upstream commit ca17a5cccf8b6d35dab4729bea8f4350bc0b4caf ]
if boardID is 0, will use the default nvm file without surfix.
Signed-off-by: Tim Jiang
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 8e4a714f451046223331f65b64c718fa393303ab
Author: Tedd Ho-Jeong An
Date: Wed May 26 10:36:22 2021 -0700
Bluetooth: mgmt: Fix the command returns garbage parameter value
[ Upstream commit 02ce2c2c24024aade65a8d91d6a596651eaf2d0a ]
When the Get Device Flags command fails, it returns the error status
with the parameters filled with the garbage values. Although the
parameters are not used, it is better to fill with zero than the random
values.
Signed-off-by: Tedd Ho-Jeong An
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 15407b14e27b93b7589e7b6d22e80a3ef6e39085
Author: Hilda Wu
Date: Fri May 14 11:19:01 2021 +0800
Bluetooth: btusb: Add support USB ALT 3 for WBS
[ Upstream commit e848dbd364aca44c9d23c04bef964fab79e2b34f ]
Because mSBC frames do not need to be aligned to the SCO packet
boundary. Using USB ALT 3 let HCI payload >= 60 bytes, let mSBC
data satisfy 60 Bytes avoid payload unaligned situation and fixed
some headset no voise issue.
USB Alt 3 supported also need HFP support transparent MTU in 72 Bytes.
Signed-off-by: Hilda Wu
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 69ccde876ca58ad7cd4eb7b4de9311a2d645922d
Author: Luiz Augusto von Dentz
Date: Wed May 19 13:41:51 2021 -0700
Bluetooth: L2CAP: Fix invalid access on ECRED Connection response
[ Upstream commit de895b43932cb47e69480540be7eca289af24f23 ]
The use of l2cap\_chan\_del is not safe under a loop using
list\_for\_each\_entry.
Signed-off-by: Luiz Augusto von Dentz
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 840907eecac0e7b5def12130b99aeb0f800c29f6
Author: Luiz Augusto von Dentz
Date: Wed May 19 13:41:50 2021 -0700
Bluetooth: L2CAP: Fix invalid access if ECRED Reconfigure fails
[ Upstream commit 1fa20d7d4aad02206e84b74915819fbe9f81dab3 ]
The use of l2cap\_chan\_del is not safe under a loop using
list\_for\_each\_entry.
Reported-by: Dan Carpenter
Signed-off-by: Luiz Augusto von Dentz
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit efffb7884033b87b8c7ee1e11f7cd73e1c2ffce9
Author: Daniel Lenski
Date: Tue May 18 10:25:46 2021 -0700
Bluetooth: btusb: Add a new QCA\_ROME device (0cf3:e500)
[ Upstream commit 0324d19cb99804d99e42c990b8b1e191575a091b ]
This patch adds the 0cf3:e500 Bluetooth device (from a QCA9377 board) as a
QCA\_ROME device. It appears to be functionally identical to another device
ID, also from a QCA9377 board, which was previously marked as QCA\_ROME in
0a03f98b98c201191e3ba15a0e33f46d8660e1fd
("Bluetooth: Add a new 04ca:3015 QCA\_ROME device").
Without this patch, the WiFi side of the QCA9377 board is slow or unusable
when the Bluetooth side is in use.
See https://askubuntu.com/a/1137852 for another report of QCA\_ROME fixing
this issue for this device ID.
/sys/kernel/debug/usb/devices:
T: Bus=05 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#= 2 Spd=12 MxCh= 0
D: Ver= 2.01 Cls=e0(wlcon) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
P: Vendor=0cf3 ProdID=e500 Rev= 0.01
C:\* #Ifs= 2 Cfg#= 1 Atr=e0 MxPwr=100mA
I:\* If#= 0 Alt= 0 #EPs= 3 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=81(I) Atr=03(Int.) MxPS= 16 Ivl=1ms
E: Ad=82(I) Atr=02(Bulk) MxPS= 64 Ivl=0ms
E: Ad=02(O) Atr=02(Bulk) MxPS= 64 Ivl=0ms
I:\* If#= 1 Alt= 0 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 0 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 0 Ivl=1ms
I: If#= 1 Alt= 1 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 9 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 9 Ivl=1ms
I: If#= 1 Alt= 2 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 17 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 17 Ivl=1ms
I: If#= 1 Alt= 3 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 25 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 25 Ivl=1ms
I: If#= 1 Alt= 4 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 33 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 33 Ivl=1ms
I: If#= 1 Alt= 5 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=83(I) Atr=01(Isoc) MxPS= 49 Ivl=1ms
E: Ad=03(O) Atr=01(Isoc) MxPS= 49 Ivl=1ms
Signed-off-by: Daniel Lenski
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit c19a2820df32b94d1d4fb65e96ae36f97dddda56
Author: Kai-Heng Feng
Date: Fri May 14 15:14:52 2021 +0800
Bluetooth: Shutdown controller after workqueues are flushed or cancelled
[ Upstream commit 0ea9fd001a14ebc294f112b0361a4e601551d508 ]
Rfkill block and unblock Intel USB Bluetooth [8087:0026] may make it
stops working:
[ 509.691509] Bluetooth: hci0: HCI reset during shutdown failed
[ 514.897584] Bluetooth: hci0: MSFT filter\_enable is already on
[ 530.044751] usb 3-10: reset full-speed USB device number 5 using xhci\_hcd
[ 545.660350] usb 3-10: device descriptor read/64, error -110
[ 561.283530] usb 3-10: device descriptor read/64, error -110
[ 561.519682] usb 3-10: reset full-speed USB device number 5 using xhci\_hcd
[ 566.686650] Bluetooth: hci0: unexpected event for opcode 0x0500
[ 568.752452] Bluetooth: hci0: urb 0000000096cd309b failed to resubmit (113)
[ 578.797955] Bluetooth: hci0: Failed to read MSFT supported features (-110)
[ 586.286565] Bluetooth: hci0: urb 00000000c522f633 failed to resubmit (113)
[ 596.215302] Bluetooth: hci0: Failed to read MSFT supported features (-110)
Or kernel panics because other workqueues already freed skb:
[ 2048.663763] BUG: kernel NULL pointer dereference, address: 0000000000000000
[ 2048.663775] #PF: supervisor read access in kernel mode
[ 2048.663779] #PF: error\_code(0x0000) - not-present page
[ 2048.663782] PGD 0 P4D 0
[ 2048.663787] Oops: 0000 [#1] SMP NOPTI
[ 2048.663793] CPU: 3 PID: 4491 Comm: rfkill Tainted: G W 5.13.0-rc1-next-20210510+ #20
[ 2048.663799] Hardware name: HP HP EliteBook 850 G8 Notebook PC/8846, BIOS T76 Ver. 01.01.04 12/02/2020
[ 2048.663801] RIP: 0010:\_\_skb\_ext\_put+0x6/0x50
[ 2048.663814] Code: 8b 1b 48 85 db 75 db 5b 41 5c 5d c3 be 01 00 00 00 e8 de 13 c0 ff eb e7 be 02 00 00 00 e8 d2 13 c0 ff eb db 0f 1f 44 00 00 55 <8b> 07 48 89 e5 83 f8 01 74 14 b8 ff ff ff ff f0 0f c1
07 83 f8 01
[ 2048.663819] RSP: 0018:ffffc1d105b6fd80 EFLAGS: 00010286
[ 2048.663824] RAX: 0000000000000000 RBX: ffff9d9ac5649000 RCX: 0000000000000000
[ 2048.663827] RDX: ffffffffc0d1daf6 RSI: 0000000000000206 RDI: 0000000000000000
[ 2048.663830] RBP: ffffc1d105b6fd98 R08: 0000000000000001 R09: ffff9d9ace8ceac0
[ 2048.663834] R10: ffff9d9ace8ceac0 R11: 0000000000000001 R12: ffff9d9ac5649000
[ 2048.663838] R13: 0000000000000000 R14: 00007ffe0354d650 R15: 0000000000000000
[ 2048.663843] FS: 00007fe02ab19740(0000) GS:ffff9d9e5f8c0000(0000) knlGS:0000000000000000
[ 2048.663849] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 2048.663853] CR2: 0000000000000000 CR3: 0000000111a52004 CR4: 0000000000770ee0
[ 2048.663856] PKRU: 55555554
[ 2048.663859] Call Trace:
[ 2048.663865] ? skb\_release\_head\_state+0x5e/0x80
[ 2048.663873] kfree\_skb+0x2f/0xb0
[ 2048.663881] btusb\_shutdown\_intel\_new+0x36/0x60 [btusb]
[ 2048.663905] hci\_dev\_do\_close+0x48c/0x5e0 [bluetooth]
[ 2048.663954] ? \_\_cond\_resched+0x1a/0x50
[ 2048.663962] hci\_rfkill\_set\_block+0x56/0xa0 [bluetooth]
[ 2048.664007] rfkill\_set\_block+0x98/0x170
[ 2048.664016] rfkill\_fop\_write+0x136/0x1e0
[ 2048.664022] vfs\_write+0xc7/0x260
[ 2048.664030] ksys\_write+0xb1/0xe0
[ 2048.664035] ? exit\_to\_user\_mode\_prepare+0x37/0x1c0
[ 2048.664042] \_\_x64\_sys\_write+0x1a/0x20
[ 2048.664048] do\_syscall\_64+0x40/0xb0
[ 2048.664055] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
[ 2048.664060] RIP: 0033:0x7fe02ac23c27
[ 2048.664066] Code: 0d 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b7 0f 1f 00 f3 0f 1e fa 64 8b 04 25 18 00 00 00 85 c0 75 10 b8 01 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 51 c3 48 83 ec 28 48 89 54 24 18 48 89 74 24
[ 2048.664070] RSP: 002b:00007ffe0354d638 EFLAGS: 00000246 ORIG\_RAX: 0000000000000001
[ 2048.664075] RAX: ffffffffffffffda RBX: 0000000000000001 RCX: 00007fe02ac23c27
[ 2048.664078] RDX: 0000000000000008 RSI: 00007ffe0354d650 RDI: 0000000000000003
[ 2048.664081] RBP: 0000000000000000 R08: 0000559b05998440 R09: 0000559b05998440
[ 2048.664084] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000003
[ 2048.664086] R13: 0000000000000000 R14: ffffffff00000000 R15: 00000000ffffffff
So move the shutdown callback to a place where workqueues are either
flushed or cancelled to resolve the issue.
Signed-off-by: Kai-Heng Feng
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 286bba24e6ce5db00cc7e5f7dce39ec15033667f
Author: Kiran K
Date: Thu Apr 8 22:31:59 2021 +0530
Bluetooth: Fix alt settings for incoming SCO with transparent coding format
[ Upstream commit 06d213d8a89a6f55b708422c3dda2b22add10748 ]
For incoming SCO connection with transparent coding format, alt setting
of CVSD is getting applied instead of Transparent.
Before fix:
< HCI Command: Accept Synchron.. (0x01|0x0029) plen 21 #2196 [hci0] 321.342548
Address: 1C:CC:D6:E2:EA:80 (Xiaomi Communications Co Ltd)
Transmit bandwidth: 8000
Receive bandwidth: 8000
Max latency: 13
Setting: 0x0003
Input Coding: Linear
Input Data Format: 1's complement
Input Sample Size: 8-bit
# of bits padding at MSB: 0
Air Coding Format: Transparent Data
Retransmission effort: Optimize for link quality (0x02)
Packet type: 0x003f
HV1 may be used
HV2 may be used
HV3 may be used
EV3 may be used
EV4 may be used
EV5 may be used
> HCI Event: Command Status (0x0f) plen 4 #2197 [hci0] 321.343585
Accept Synchronous Connection Request (0x01|0x0029) ncmd 1
Status: Success (0x00)
> HCI Event: Synchronous Connect Comp.. (0x2c) plen 17 #2198 [hci0] 321.351666
Status: Success (0x00)
Handle: 257
Address: 1C:CC:D6:E2:EA:80 (Xiaomi Communications Co Ltd)
Link type: eSCO (0x02)
Transmission interval: 0x0c
Retransmission window: 0x04
RX packet length: 60
TX packet length: 60
Air mode: Transparent (0x03)
........
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2336 [hci0] 321.383655
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #2337 [hci0] 321.389558
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2338 [hci0] 321.393615
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2339 [hci0] 321.393618
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2340 [hci0] 321.393618
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #2341 [hci0] 321.397070
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2342 [hci0] 321.403622
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2343 [hci0] 321.403625
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2344 [hci0] 321.403625
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2345 [hci0] 321.403625
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #2346 [hci0] 321.404569
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #2347 [hci0] 321.412091
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2348 [hci0] 321.413626
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2349 [hci0] 321.413630
> SCO Data RX: Handle 257 flags 0x00 dlen 48 #2350 [hci0] 321.413630
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #2351 [hci0] 321.419674
After fix:
< HCI Command: Accept Synchronou.. (0x01|0x0029) plen 21 #309 [hci0] 49.439693
Address: 1C:CC:D6:E2:EA:80 (Xiaomi Communications Co Ltd)
Transmit bandwidth: 8000
Receive bandwidth: 8000
Max latency: 13
Setting: 0x0003
Input Coding: Linear
Input Data Format: 1's complement
Input Sample Size: 8-bit
# of bits padding at MSB: 0
Air Coding Format: Transparent Data
Retransmission effort: Optimize for link quality (0x02)
Packet type: 0x003f
HV1 may be used
HV2 may be used
HV3 may be used
EV3 may be used
EV4 may be used
EV5 may be used
> HCI Event: Command Status (0x0f) plen 4 #310 [hci0] 49.440308
Accept Synchronous Connection Request (0x01|0x0029) ncmd 1
Status: Success (0x00)
> HCI Event: Synchronous Connect Complete (0x2c) plen 17 #311 [hci0] 49.449308
Status: Success (0x00)
Handle: 257
Address: 1C:CC:D6:E2:EA:80 (Xiaomi Communications Co Ltd)
Link type: eSCO (0x02)
Transmission interval: 0x0c
Retransmission window: 0x04
RX packet length: 60
TX packet length: 60
Air mode: Transparent (0x03)
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #312 [hci0] 49.450421
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #313 [hci0] 49.457927
> HCI Event: Max Slots Change (0x1b) plen 3 #314 [hci0] 49.460345
Handle: 256
Max slots: 5
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #315 [hci0] 49.465453
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #316 [hci0] 49.470502
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #317 [hci0] 49.470519
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #318 [hci0] 49.472996
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #319 [hci0] 49.480412
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #320 [hci0] 49.480492
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #321 [hci0] 49.487989
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #322 [hci0] 49.490303
< SCO Data TX: Handle 257 flags 0x00 dlen 60 #323 [hci0] 49.495496
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #324 [hci0] 49.500304
> SCO Data RX: Handle 257 flags 0x00 dlen 60 #325 [hci0] 49.500311
Signed-off-by: Kiran K
Signed-off-by: Lokendra Singh
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit cbb2f564faa4a351740c1f27d0a45dbe0ab5d24c
Author: Yu Liu
Date: Mon Apr 19 16:53:30 2021 -0700
Bluetooth: Fix the HCI to MGMT status conversion table
[ Upstream commit 4ef36a52b0e47c80bbfd69c0cce61c7ae9f541ed ]
0x2B, 0x31 and 0x33 are reserved for future use but were not present in
the HCI to MGMT conversion table, this caused the conversion to be
incorrect for the HCI status code greater than 0x2A.
Reviewed-by: Miao-chen Chou
Signed-off-by: Yu Liu
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 5c73a8008035879a27f4bcf2d87869d039cb98fb
Author: Thadeu Lima de Souza Cascardo
Date: Tue Apr 13 13:21:03 2021 -0300
Bluetooth: cmtp: fix file refcount when cmtp\_attach\_device fails
[ Upstream commit 3cfdf8fcaafa62a4123f92eb0f4a72650da3a479 ]
When cmtp\_attach\_device fails, cmtp\_add\_connection returns the error value
which leads to the caller to doing fput through sockfd\_put. But
cmtp\_session kthread, which is stopped in this path will also call fput,
leading to a potential refcount underflow or a use-after-free.
Add a refcount before we signal the kthread to stop. The kthread will try
to grab the cmtp\_session\_sem mutex before doing the fput, which is held
when get\_file is called, so there should be no races there.
Reported-by: Ryota Shiga
Signed-off-by: Thadeu Lima de Souza Cascardo
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit dc239f449b031e310f2b6aecb6f39e91ed60c67b
Author: mark-yw.chen
Date: Mon Apr 12 23:06:26 2021 +0800
Bluetooth: btusb: Fixed too many in-token issue for Mediatek Chip.
[ Upstream commit 8454ed9ff9647e31e061fb5eb2e39ce79bc5e960 ]
This patch reduce in-token during download patch procedure.
Don't submit urb for polling event before sending hci command.
Signed-off-by: mark-yw.chen
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 07583ba2e2d8947c3d365d97608cb436510885ac
Author: Gerd Rausch
Date: Thu Jun 24 11:55:31 2021 -0700
RDMA/cma: Fix rdma\_resolve\_route() memory leak
[ Upstream commit 74f160ead74bfe5f2b38afb4fcf86189f9ff40c9 ]
Fix a memory leak when "mda\_resolve\_route() is called more than once on
the same "rdma\_cm\_id".
This is possible if cma\_query\_handler() triggers the
RDMA\_CM\_EVENT\_ROUTE\_ERROR flow which puts the state machine back and
allows rdma\_resolve\_route() to be called again.
Link: https://lore.kernel.org/r/f6662b7b-bdb7-2706-1e12-47c61d3474b6@oracle.com
Signed-off-by: Gerd Rausch
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
commit e4d57b37f0340fbe744287ccfbe1c8f5d0538cd1
Author: Jakub Kicinski
Date: Wed Jun 23 14:44:38 2021 -0700
net: ip: avoid OOM kills with large UDP sends over loopback
[ Upstream commit 6d123b81ac615072a8525c13c6c41b695270a15d ]
Dave observed number of machines hitting OOM on the UDP send
path. The workload seems to be sending large UDP packets over
loopback. Since loopback has MTU of 64k kernel will try to
allocate an skb with up to 64k of head space. This has a good
chance of failing under memory pressure. What's worse if
the message length is <32k the allocation may trigger an
OOM killer.
This is entirely avoidable, we can use an skb with page frags.
af\_unix solves a similar problem by limiting the head
length to SKB\_MAX\_ALLOC. This seems like a good and simple
approach. It means that UDP messages > 16kB will now
use fragments if underlying device supports SG, if extra
allocator pressure causes regressions in real workloads
we can switch to trying the large allocation first and
falling back.
v4: pre-calculate all the additions to alloclen so
we can be sure it won't go over order-2
Reported-by: Dave Jones
Signed-off-by: Jakub Kicinski
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 602b0c1dbedc1440575b4dc1867f94d97f8c265a
Author: Martynas Pumputis
Date: Wed Jun 23 15:56:45 2021 +0200
net: retrieve netns cookie via getsocketopt
[ Upstream commit e8b9eab99232c4e62ada9d7976c80fd5e8118289 ]
It's getting more common to run nested container environments for
testing cloud software. One of such examples is Kind [1] which runs a
Kubernetes cluster in Docker containers on a single host. Each container
acts as a Kubernetes node, and thus can run any Pod (aka container)
inside the former. This approach simplifies testing a lot, as it
eliminates complicated VM setups.
Unfortunately, such a setup breaks some functionality when cgroupv2 BPF
programs are used for load-balancing. The load-balancer BPF program
needs to detect whether a request originates from the host netns or a
container netns in order to allow some access, e.g. to a service via a
loopback IP address. Typically, the programs detect this by comparing
netns cookies with the one of the init ns via a call to
bpf\_get\_netns\_cookie(NULL). However, in nested environments the latter
cannot be used given the Kubernetes node's netns is outside the init ns.
To fix this, we need to pass the Kubernetes node netns cookie to the
program in a different way: by extending getsockopt() with a
SO\_NETNS\_COOKIE option, the orchestrator which runs in the Kubernetes
node netns can retrieve the cookie and pass it to the program instead.
Thus, this is following up on Eric's commit 3d368ab87cf6 ("net:
initialize net->net\_cookie at netns setup") to allow retrieval via
SO\_NETNS\_COOKIE. This is also in line in how we retrieve socket cookie
via SO\_COOKIE.
[1] https://kind.sigs.k8s.io/
Signed-off-by: Lorenz Bauer
Signed-off-by: Martynas Pumputis
Cc: Eric Dumazet
Reviewed-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit b01ad7c3b08efc486e3824982858f3b30ba33c02
Author: Sean Young
Date: Wed Jun 23 22:37:54 2021 +0100
media, bpf: Do not copy more entries than user space requested
[ Upstream commit 647d446d66e493d23ca1047fa8492b0269674530 ]
The syscall bpf(BPF\_PROG\_QUERY, &attr) should use the prog\_cnt field to
see how many entries user space provided and return ENOSPC if there are
more programs than that. Before this patch, this is not checked and
ENOSPC is never returned.
Note that one lirc device is limited to 64 bpf programs, and user space
I'm aware of -- ir-keytable -- always gives enough space for 64 entries
already. However, we should not copy program ids than are requested.
Signed-off-by: Sean Young
Signed-off-by: Daniel Borkmann
Link: https://lore.kernel.org/bpf/20210623213754.632-1-sean@mess.org
Signed-off-by: Sasha Levin
commit e6b42db7e571f5a9aa99e9d0650600b39aff9480
Author: Max Gurtovoy
Date: Mon May 24 11:52:15 2021 +0300
IB/isert: Align target max I/O size to initiator size
[ Upstream commit 109d19a5eb3ddbdb87c43bfd4bcf644f4569da64 ]
Since the Linux iser initiator default max I/O size set to 512KB and since
there is no handshake procedure for this size in iser protocol, set the
default max IO size of the target to 512KB as well.
For changing the default values, there is a module parameter for both
drivers.
Link: https://lore.kernel.org/r/20210524085215.29005-1-mgurtovoy@nvidia.com
Reviewed-by: Alaa Hleihel
Reviewed-by: Israel Rukshin
Signed-off-by: Max Gurtovoy
Acked-by: Sagi Grimberg
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
commit b3d56dd75032ea18f0126cbadf8921e6a23675e3
Author: Ilan Peer
Date: Fri Jun 18 13:41:37 2021 +0300
mac80211: Properly WARN on HW scan before restart
[ Upstream commit 45daaa1318410794de956fb8e9d06aed2dbb23d0 ]
The following race was possible:
1. The device driver requests HW restart.
2. A scan is requested from user space and is propagated
to the driver. During this flow HW\_SCANNING flag is set.
3. The thread that handles the HW restart is scheduled,
and before starting the actual reconfiguration it
checks that HW\_SCANNING is not set. The flow does so
without acquiring any lock, and thus the WARN fires.
Fix this by checking that HW\_SCANNING is on only after RTNL is
acquired, i.e., user space scan request handling is no longer
in transit.
Signed-off-by: Ilan Peer
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210618133832.8238ab3e19ab.I2693c581c70251472b4f9089e37e06fb2c18268f@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit e32446de59d2cd10a5bd9d3bb0e7ce5ad107aad8
Author: Weilun Du
Date: Thu May 6 11:05:29 2021 -0700
mac80211\_hwsim: add concurrent channels scanning support over virtio
[ Upstream commit 626c30f9e77354301ff9162c3bdddaf92d9b5cf3 ]
This fixed the crash when setting channels to 2 or more when
communicating over virtio.
Signed-off-by: Weilun Du
Link: https://lore.kernel.org/r/20210506180530.3418576-1-wdu@google.com
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit 6f9ae4a024c57a6b896f91320b8bec59c663d40c
Author: Johannes Berg
Date: Thu Jun 10 22:08:16 2021 +0200
mac80211: consider per-CPU statistics if present
[ Upstream commit d656a4c6ead6c3f252b2f2532bc9735598f7e317 ]
If we have been keeping per-CPU statistics, consider them
regardless of USES\_RSS, because we may not actually fill
those, for example in non-fast-RX cases when the connection
is not compatible with fast-RX. If we didn't fill them, the
additional data will be zero and not affect anything, and
if we did fill them then it's more correct to consider them.
This fixes an issue in mesh mode where some statistics are
not updated due to USES\_RSS being set, but fast-RX isn't
used.
Reported-by: Thiraviyam Mariyappan
Link: https://lore.kernel.org/r/20210610220814.13b35f5797c5.I511e9b33c5694e0d6cef4b6ae755c873d7c22124@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit 5924678a442d0f5ebf33ebb76b470e68414f1318
Author: Ping-Ke Shih
Date: Wed Jun 9 15:59:44 2021 +0800
cfg80211: fix default HE tx bitrate mask in 2G band
[ Upstream commit 9df66d5b9f45c39b3925d16e8947cc10009b186d ]
In 2G band, a HE sta can only supports HT and HE, but not supports VHT.
In this case, default HE tx bitrate mask isn't filled, when we use iw to
set bitrates without any parameter.
Signed-off-by: Ping-Ke Shih
Link: https://lore.kernel.org/r/20210609075944.51130-1-pkshih@realtek.com
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit e1d88925c3b9cbe61276cfc2b1850fd795d2a9a4
Author: Gustavo A. R. Silva
Date: Thu Apr 22 15:00:32 2021 -0500
wireless: wext-spy: Fix out-of-bounds warning
[ Upstream commit e93bdd78406da9ed01554c51e38b2a02c8ef8025 ]
Fix the following out-of-bounds warning:
net/wireless/wext-spy.c:178:2: warning: 'memcpy' offset [25, 28] from the object at 'threshold' is out of the bounds of referenced subobject 'low' with type 'struct iw\_quality' at offset 20 [-Warray-bounds]
The problem is that the original code is trying to copy data into a
couple of struct members adjacent to each other in a single call to
memcpy(). This causes a legitimate compiler warning because memcpy()
overruns the length of &threshold.low and &spydata->spy\_thr\_low. As
these are just a couple of struct members, fix this by using direct
assignments, instead of memcpy().
This helps with the ongoing efforts to globally enable -Warray-bounds
and get us closer to being able to tighten the FORTIFY\_SOURCE routines
on memcpy().
Link: https://github.com/KSPP/linux/issues/109
Reported-by: kernel test robot
Signed-off-by: Gustavo A. R. Silva
Reviewed-by: Kees Cook
Link: https://lore.kernel.org/r/20210422200032.GA168995@embeddedor
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit 649adc384fb3544f178d66e50fc7488e146a4195
Author: Íñigo Huguet
Date: Mon Jun 21 17:32:36 2021 +0200
sfc: error code if SRIOV cannot be disabled
[ Upstream commit 1ebe4feb8b442884f5a28d2437040096723dd1ea ]
If SRIOV cannot be disabled during device removal or module unloading,
return error code so it can be logged properly in the calling function.
Note that this can only happen if any VF is currently attached to a
guest using Xen, but not with vfio/KVM. Despite that in that case the
VFs won't work properly with PF removed and/or the module unloaded, I
have let it as is because I don't know what side effects may have
changing it, and also it seems to be the same that other drivers are
doing in this situation.
In the case of being called during SRIOV reconfiguration, the behavior
hasn't changed because the function is called with force=false.
Signed-off-by: Íñigo Huguet
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 65c8d58a1f7a5574cbf0708694d500afbc845536
Author: Íñigo Huguet
Date: Mon Jun 21 17:32:35 2021 +0200
sfc: avoid double pci\_remove of VFs
[ Upstream commit 45423cff1db66cf0993e8a9bd0ac93e740149e49 ]
If pci\_remove was called for a PF with VFs, the removal of the VFs was
called twice from efx\_ef10\_sriov\_fini: one directly with pci\_driver->remove
and another implicit by calling pci\_disable\_sriov, which also perform
the VFs remove. This was leading to crashing the kernel on the second
attempt.
Given that pci\_disable\_sriov already calls to pci remove function, get
rid of the direct call to pci\_driver->remove from the driver.
2 different ways to trigger the bug:
- Create one or more VFs, then attach the PF to a virtual machine (at
least with qemu/KVM)
- Create one or more VFs, then remove the PF with:
echo 1 > /sys/bus/pci/devices/PF\_PCI\_ID/remove
Removing sfc module does not trigger the error, at least for me, because
it removes the VF first, and then the PF.
Example of a log with the error:
list\_del corruption, ffff967fd20a8ad0->next is LIST\_POISON1 (dead000000000100)
------------[ cut here ]------------
kernel BUG at lib/list\_debug.c:47!
[...trimmed...]
RIP: 0010:\_\_list\_del\_entry\_valid.cold.1+0x12/0x4c
[...trimmed...]
Call Trace:
efx\_dissociate+0x1f/0x140 [sfc]
efx\_pci\_remove+0x27/0x150 [sfc]
pci\_device\_remove+0x3b/0xc0
device\_release\_driver\_internal+0x103/0x1f0
pci\_stop\_bus\_device+0x69/0x90
pci\_stop\_and\_remove\_bus\_device+0xe/0x20
pci\_iov\_remove\_virtfn+0xba/0x120
sriov\_disable+0x2f/0xe0
efx\_ef10\_pci\_sriov\_disable+0x52/0x80 [sfc]
? pcie\_aer\_is\_native+0x12/0x40
efx\_ef10\_sriov\_fini+0x72/0x110 [sfc]
efx\_pci\_remove+0x62/0x150 [sfc]
pci\_device\_remove+0x3b/0xc0
device\_release\_driver\_internal+0x103/0x1f0
unbind\_store+0xf6/0x130
kernfs\_fop\_write+0x116/0x190
vfs\_write+0xa5/0x1a0
ksys\_write+0x4f/0xb0
do\_syscall\_64+0x5b/0x1a0
entry\_SYSCALL\_64\_after\_hwframe+0x65/0xca
Signed-off-by: Íñigo Huguet
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 81772d2c7d043c159e024137768817ae53c8aed3
Author: Ping-Ke Shih
Date: Mon Jun 7 09:22:54 2021 +0800
rtw88: add quirks to disable pci capabilities
[ Upstream commit 956c6d4f20c5446727e0c912dd8f527f2dc7b779 ]
8821CE with ASPM cannot work properly on Protempo Ltd L116HTN6SPW. Add a
quirk to disable the cap.
The reporter describes the symptom is that this module (driver) causes
frequent freezes, randomly but usually within a few minutes of running
(thus very soon after boot): screen display remains frozen, no response
to either keyboard or mouse input. All I can do is to hold the power
button to power off, then reboot.
Reported-by: Paul Szabo
Signed-off-by: Ping-Ke Shih
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210607012254.6306-1-pkshih@realtek.com
Signed-off-by: Sasha Levin
commit 2002b7ae2f00c0918e84a07cc9590a4d466bccf5
Author: Po-Hao Huang
Date: Thu May 6 16:36:43 2021 +0800
rtw88: 8822c: update RF parameter tables to v62
[ Upstream commit 7a1baaaee6c866455c9c77bf9b0405941a3678c7 ]
Update RTL8822C devices' RF tables to v62.
This fixes higher than expected spur in 2400 MHz under CCK mask.
Signed-off-by: Po-Hao Huang
Signed-off-by: Ping-Ke Shih
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210506083643.18317-1-pkshih@realtek.com
Signed-off-by: Sasha Levin
commit 5a7db3036585d0a03bb10c40be066f3468a04c88
Author: Johannes Berg
Date: Fri Jun 18 11:01:17 2021 +0300
iwlwifi: pcie: fix context info freeing
[ Upstream commit 26d18c75a7496c4c52b0b6789e713dc76ebfbc87 ]
After firmware alive, iwl\_trans\_pcie\_gen2\_fw\_alive() is called
to free the context info. However, on gen3 that will then free
the context info with the wrong size.
Since we free this allocation later, let it stick around until
the device is stopped for now, freeing some of it earlier is a
separate change.
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210618105614.afb63fb8cbc1.If4968db8e09f4ce2a1d27a6d750bca3d132d7d70@changeid
Signed-off-by: Luca Coelho
Signed-off-by: Sasha Levin
commit 5b2b879f69b4da25b0097c03fd083a871dd08475
Author: Johannes Berg
Date: Fri Jun 18 11:01:16 2021 +0300
iwlwifi: pcie: free IML DMA memory allocation
[ Upstream commit 310f60f53a86eba680d9bc20a371e13b06a5f903 ]
In the case of gen3 devices with image loader (IML) support,
we were leaking the IML DMA allocation and never freeing it.
Fix that.
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210618105614.07e117dbedb7.I7bb9ebbe0617656986c2a598ea5e827b533bd3b9@changeid
Signed-off-by: Luca Coelho
Signed-off-by: Sasha Levin
commit 44164d5528fb7c92cfbd711f8db6c6845bc42a3a
Author: Shaul Triebitz
Date: Thu Jun 17 10:08:45 2021 +0300
iwlwifi: mvm: fix error print when session protection ends
[ Upstream commit 976ac0af7ba2c5424bc305b926c0807d96fdcc83 ]
When the session protection ends and the Driver is not
associated or a beacon was not heard, the Driver
prints "No beacons heard...".
That's confusing for the case where not associated.
Change the print when not associated to "Not associated...".
Signed-off-by: Shaul Triebitz
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210617100544.41a5a5a894fa.I9eabb76e7a3a7f4abbed8f2ef918f1df8e825726@changeid
Signed-off-by: Luca Coelho
Signed-off-by: Sasha Levin
commit 111fa98f60d205a7a6d5dd613c2c85a18ef2e1db
Author: Johannes Berg
Date: Thu Jun 17 10:08:43 2021 +0300
iwlwifi: mvm: apply RX diversity per PHY context
[ Upstream commit a171399fd687a7d2fa56a10c9a2d7084a647677d ]
SMPS requests may differ per interfaces due to e.g. Bluetooth
only interfering on 2.4 GHz, so if that's the case we should,
in the case of multiple PHY contexts, still allow RX diversity
on PHY context that have no interfaces with SMPS requests.
Fix the code to pass through the PHY context in question and
skip interfaces with non-matching PHY context while iterating.
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210617100544.123c6b05809d.I992e3d1c6a29850d02eeec01712b5b685b963a87@changeid
Signed-off-by: Luca Coelho
Signed-off-by: Sasha Levin
commit 89b944c896f938f5202355e1eca828705b73c363
Author: Johannes Berg
Date: Sat Jun 12 14:32:38 2021 +0300
iwlwifi: mvm: don't change band on bound PHY contexts
[ Upstream commit 8835a64f74c46baebfc946cd5a2c861b866ebcee ]
When we have a P2P Device active, we attempt to only change the
PHY context it uses when we get a new remain-on-channel, if the
P2P Device is the only user of the PHY context.
This is fine if we're switching within a band, but if we're
switching bands then the switch implies a removal and re-add
of the PHY context, which isn't permitted by the firmware while
it's bound to an interface.
Fix the code to skip the unbind/release/... cycle only if the
band doesn't change (or we have old devices that can switch the
band on the fly as well.)
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20210612142637.e9ac313f70f3.I713b9d109957df7e7d9ed0861d5377ce3f8fccd3@changeid
Signed-off-by: Luca Coelho
Signed-off-by: Sasha Levin
commit af1036530646c51c053bfb2be5ae68f32ff1377a
Author: Xiao Yang
Date: Mon Jun 21 15:14:56 2021 +0800
RDMA/rxe: Don't overwrite errno from ib\_umem\_get()
[ Upstream commit 20ec0a6d6016aa28b9b3299be18baef1a0f91cd2 ]
rxe\_mr\_init\_user() always returns the fixed -EINVAL when ib\_umem\_get()
fails so it's hard for user to know which actual error happens in
ib\_umem\_get(). For example, ib\_umem\_get() will return -EOPNOTSUPP when
trying to pin pages on a DAX file.
Return actual error as mlx4/mlx5 does.
Link: https://lore.kernel.org/r/20210621071456.4259-1-ice\_yangxiao@163.com
Signed-off-by: Xiao Yang
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
commit 6e34e09aa418117fca3eb7d14d748e65a59da4ca
Author: Logush Oliver
Date: Tue Jun 8 15:27:24 2021 -0400
drm/amd/display: Fix edp\_bootup\_bl\_level initialization issue
[ Upstream commit eeb90e26ed05dd44553d557057bf35f08f853af8 ]
[why]
Updating the file to fix the missing line
Signed-off-by: Logush Oliver
Reviewed-by: Charlene Liu
Acked-by: Bindu Ramamurthy
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit f033a30e32cefb956cf0a18afca17c8a267aa147
Author: Longpeng(Mike)
Date: Mon Jun 21 14:26:01 2021 +0800
vsock: notify server to shutdown when client has pending signal
[ Upstream commit c7ff9cff70601ea19245d997bb977344663434c7 ]
The client's sk\_state will be set to TCP\_ESTABLISHED if the server
replay the client's connect request.
However, if the client has pending signal, its sk\_state will be set
to TCP\_CLOSE without notify the server, so the server will hold the
corrupt connection.
client server
1. sk\_state=TCP\_SYN\_SENT |
2. call ->connect() |
3. wait reply |
| 4. sk\_state=TCP\_ESTABLISHED
| 5. insert to connected list
| 6. reply to the client
7. sk\_state=TCP\_ESTABLISHED |
8. insert to connected list |
9. \*signal pending\* <--------------------- the user kill client
10. sk\_state=TCP\_CLOSE |
client is exiting... |
11. call ->release() |
virtio\_transport\_close
if (!(sk->sk\_state == TCP\_ESTABLISHED ||
sk->sk\_state == TCP\_CLOSING))
return true; \*return at here, the server cannot notice the connection is corrupt\*
So the client should notify the peer in this case.
Cc: David S. Miller
Cc: Jakub Kicinski
Cc: Jorgen Hansen
Cc: Norbert Slusarek
Cc: Andra Paraschiv
Cc: Colin Ian King
Cc: David Brazdil
Cc: Alexander Popov
Suggested-by: Stefano Garzarella
Link: https://lkml.org/lkml/2021/5/17/418
Signed-off-by: lixianming
Signed-off-by: Longpeng(Mike)
Reviewed-by: Stefano Garzarella
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit ac05406330eb17b2dd70e48011d374831388c0ab
Author: Zheyu Ma
Date: Sun Jun 20 15:24:15 2021 +0000
atm: nicstar: register the interrupt handler in the right place
[ Upstream commit 70b639dc41ad499384e41e106fce72e36805c9f2 ]
Because the error handling is sequential, the application of resources
should be carried out in the order of error handling, so the operation
of registering the interrupt handler should be put in front, so as not
to free the unregistered interrupt handler during error handling.
This log reveals it:
[ 3.438724] Trying to free already-free IRQ 23
[ 3.439060] WARNING: CPU: 5 PID: 1 at kernel/irq/manage.c:1825 free\_irq+0xfb/0x480
[ 3.440039] Modules linked in:
[ 3.440257] CPU: 5 PID: 1 Comm: swapper/0 Not tainted 5.12.4-g70e7f0549188-dirty #142
[ 3.440793] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014
[ 3.441561] RIP: 0010:free\_irq+0xfb/0x480
[ 3.441845] Code: 6e 08 74 6f 4d 89 f4 e8 c3 78 09 00 4d 8b 74 24 18 4d 85 f6 75 e3 e8 b4 78 09 00 8b 75 c8 48 c7 c7 a0 ac d5 85 e8 95 d7 f5 ff <0f> 0b 48 8b 75 c0 4c 89 ff e8 87 c5 90 03 48 8b 43 40 4c 8b a0 80
[ 3.443121] RSP: 0000:ffffc90000017b50 EFLAGS: 00010086
[ 3.443483] RAX: 0000000000000000 RBX: ffff888107c6f000 RCX: 0000000000000000
[ 3.443972] RDX: 0000000000000000 RSI: ffffffff8123f301 RDI: 00000000ffffffff
[ 3.444462] RBP: ffffc90000017b90 R08: 0000000000000001 R09: 0000000000000003
[ 3.444950] R10: 0000000000000000 R11: 0000000000000001 R12: 0000000000000000
[ 3.444994] R13: ffff888107dc0000 R14: ffff888104f6bf00 R15: ffff888107c6f0a8
[ 3.444994] FS: 0000000000000000(0000) GS:ffff88817bd40000(0000) knlGS:0000000000000000
[ 3.444994] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 3.444994] CR2: 0000000000000000 CR3: 000000000642e000 CR4: 00000000000006e0
[ 3.444994] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 3.444994] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 3.444994] Call Trace:
[ 3.444994] ns\_init\_card\_error+0x18e/0x250
[ 3.444994] nicstar\_init\_one+0x10d2/0x1130
[ 3.444994] local\_pci\_probe+0x4a/0xb0
[ 3.444994] pci\_device\_probe+0x126/0x1d0
[ 3.444994] ? pci\_device\_remove+0x100/0x100
[ 3.444994] really\_probe+0x27e/0x650
[ 3.444994] driver\_probe\_device+0x84/0x1d0
[ 3.444994] ? mutex\_lock\_nested+0x16/0x20
[ 3.444994] device\_driver\_attach+0x63/0x70
[ 3.444994] \_\_driver\_attach+0x117/0x1a0
[ 3.444994] ? device\_driver\_attach+0x70/0x70
[ 3.444994] bus\_for\_each\_dev+0xb6/0x110
[ 3.444994] ? rdinit\_setup+0x40/0x40
[ 3.444994] driver\_attach+0x22/0x30
[ 3.444994] bus\_add\_driver+0x1e6/0x2a0
[ 3.444994] driver\_register+0xa4/0x180
[ 3.444994] \_\_pci\_register\_driver+0x77/0x80
[ 3.444994] ? uPD98402\_module\_init+0xd/0xd
[ 3.444994] nicstar\_init+0x1f/0x75
[ 3.444994] do\_one\_initcall+0x7a/0x3d0
[ 3.444994] ? rdinit\_setup+0x40/0x40
[ 3.444994] ? rcu\_read\_lock\_sched\_held+0x4a/0x70
[ 3.444994] kernel\_init\_freeable+0x2a7/0x2f9
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] kernel\_init+0x13/0x180
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] ret\_from\_fork+0x1f/0x30
[ 3.444994] Kernel panic - not syncing: panic\_on\_warn set ...
[ 3.444994] CPU: 5 PID: 1 Comm: swapper/0 Not tainted 5.12.4-g70e7f0549188-dirty #142
[ 3.444994] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014
[ 3.444994] Call Trace:
[ 3.444994] dump\_stack+0xba/0xf5
[ 3.444994] ? free\_irq+0xfb/0x480
[ 3.444994] panic+0x155/0x3ed
[ 3.444994] ? \_\_warn+0xed/0x150
[ 3.444994] ? free\_irq+0xfb/0x480
[ 3.444994] \_\_warn+0x103/0x150
[ 3.444994] ? free\_irq+0xfb/0x480
[ 3.444994] report\_bug+0x119/0x1c0
[ 3.444994] handle\_bug+0x3b/0x80
[ 3.444994] exc\_invalid\_op+0x18/0x70
[ 3.444994] asm\_exc\_invalid\_op+0x12/0x20
[ 3.444994] RIP: 0010:free\_irq+0xfb/0x480
[ 3.444994] Code: 6e 08 74 6f 4d 89 f4 e8 c3 78 09 00 4d 8b 74 24 18 4d 85 f6 75 e3 e8 b4 78 09 00 8b 75 c8 48 c7 c7 a0 ac d5 85 e8 95 d7 f5 ff <0f> 0b 48 8b 75 c0 4c 89 ff e8 87 c5 90 03 48 8b 43 40 4c 8b a0 80
[ 3.444994] RSP: 0000:ffffc90000017b50 EFLAGS: 00010086
[ 3.444994] RAX: 0000000000000000 RBX: ffff888107c6f000 RCX: 0000000000000000
[ 3.444994] RDX: 0000000000000000 RSI: ffffffff8123f301 RDI: 00000000ffffffff
[ 3.444994] RBP: ffffc90000017b90 R08: 0000000000000001 R09: 0000000000000003
[ 3.444994] R10: 0000000000000000 R11: 0000000000000001 R12: 0000000000000000
[ 3.444994] R13: ffff888107dc0000 R14: ffff888104f6bf00 R15: ffff888107c6f0a8
[ 3.444994] ? vprintk\_func+0x71/0x110
[ 3.444994] ns\_init\_card\_error+0x18e/0x250
[ 3.444994] nicstar\_init\_one+0x10d2/0x1130
[ 3.444994] local\_pci\_probe+0x4a/0xb0
[ 3.444994] pci\_device\_probe+0x126/0x1d0
[ 3.444994] ? pci\_device\_remove+0x100/0x100
[ 3.444994] really\_probe+0x27e/0x650
[ 3.444994] driver\_probe\_device+0x84/0x1d0
[ 3.444994] ? mutex\_lock\_nested+0x16/0x20
[ 3.444994] device\_driver\_attach+0x63/0x70
[ 3.444994] \_\_driver\_attach+0x117/0x1a0
[ 3.444994] ? device\_driver\_attach+0x70/0x70
[ 3.444994] bus\_for\_each\_dev+0xb6/0x110
[ 3.444994] ? rdinit\_setup+0x40/0x40
[ 3.444994] driver\_attach+0x22/0x30
[ 3.444994] bus\_add\_driver+0x1e6/0x2a0
[ 3.444994] driver\_register+0xa4/0x180
[ 3.444994] \_\_pci\_register\_driver+0x77/0x80
[ 3.444994] ? uPD98402\_module\_init+0xd/0xd
[ 3.444994] nicstar\_init+0x1f/0x75
[ 3.444994] do\_one\_initcall+0x7a/0x3d0
[ 3.444994] ? rdinit\_setup+0x40/0x40
[ 3.444994] ? rcu\_read\_lock\_sched\_held+0x4a/0x70
[ 3.444994] kernel\_init\_freeable+0x2a7/0x2f9
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] kernel\_init+0x13/0x180
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] ? rest\_init+0x2c0/0x2c0
[ 3.444994] ret\_from\_fork+0x1f/0x30
[ 3.444994] Dumping ftrace buffer:
[ 3.444994] (ftrace buffer empty)
[ 3.444994] Kernel Offset: disabled
[ 3.444994] Rebooting in 1 seconds..
Signed-off-by: Zheyu Ma
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 3c0b0b2533f9fd91aa10dfdd48bc27f3526e585c
Author: Zheyu Ma
Date: Sun Jun 20 15:24:14 2021 +0000
atm: nicstar: use 'dma\_free\_coherent' instead of 'kfree'
[ Upstream commit 6a1e5a4af17e440dd82a58a2c5f40ff17a82b722 ]
When 'nicstar\_init\_one' fails, 'ns\_init\_card\_error' will be executed for
error handling, but the correct memory free function should be used,
otherwise it will cause an error. Since 'card->rsq.org' and
'card->tsq.org' are allocated using 'dma\_alloc\_coherent' function, they
should be freed using 'dma\_free\_coherent'.
Fix this by using 'dma\_free\_coherent' instead of 'kfree'
This log reveals it:
[ 3.440294] kernel BUG at mm/slub.c:4206!
[ 3.441059] invalid opcode: 0000 [#1] PREEMPT SMP PTI
[ 3.441430] CPU: 2 PID: 1 Comm: swapper/0 Not tainted 5.12.4-g70e7f0549188-dirty #141
[ 3.441986] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014
[ 3.442780] RIP: 0010:kfree+0x26a/0x300
[ 3.443065] Code: e8 3a c3 b9 ff e9 d6 fd ff ff 49 8b 45 00 31 db a9 00 00 01 00 75 4d 49 8b 45 00 a9 00 00 01 00 75 0a 49 8b 45 08 a8 01 75 02 <0f> 0b 89 d9 b8 00 10 00 00 be 06 00 00 00 48 d3 e0 f7 d8 48 63 d0
[ 3.443396] RSP: 0000:ffffc90000017b70 EFLAGS: 00010246
[ 3.443396] RAX: dead000000000100 RBX: 0000000000000000 RCX: 0000000000000000
[ 3.443396] RDX: 0000000000000000 RSI: ffffffff85d3df94 RDI: ffffffff85df38e6
[ 3.443396] RBP: ffffc90000017b90 R08: 0000000000000001 R09: 0000000000000001
[ 3.443396] R10: 0000000000000000 R11: 0000000000000001 R12: ffff888107dc0000
[ 3.443396] R13: ffffea00001f0100 R14: ffff888101a8bf00 R15: ffff888107dc0160
[ 3.443396] FS: 0000000000000000(0000) GS:ffff88817bc80000(0000) knlGS:0000000000000000
[ 3.443396] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 3.443396] CR2: 0000000000000000 CR3: 000000000642e000 CR4: 00000000000006e0
[ 3.443396] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 3.443396] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 3.443396] Call Trace:
[ 3.443396] ns\_init\_card\_error+0x12c/0x220
[ 3.443396] nicstar\_init\_one+0x10d2/0x1130
[ 3.443396] local\_pci\_probe+0x4a/0xb0
[ 3.443396] pci\_device\_probe+0x126/0x1d0
[ 3.443396] ? pci\_device\_remove+0x100/0x100
[ 3.443396] really\_probe+0x27e/0x650
[ 3.443396] driver\_probe\_device+0x84/0x1d0
[ 3.443396] ? mutex\_lock\_nested+0x16/0x20
[ 3.443396] device\_driver\_attach+0x63/0x70
[ 3.443396] \_\_driver\_attach+0x117/0x1a0
[ 3.443396] ? device\_driver\_attach+0x70/0x70
[ 3.443396] bus\_for\_each\_dev+0xb6/0x110
[ 3.443396] ? rdinit\_setup+0x40/0x40
[ 3.443396] driver\_attach+0x22/0x30
[ 3.443396] bus\_add\_driver+0x1e6/0x2a0
[ 3.443396] driver\_register+0xa4/0x180
[ 3.443396] \_\_pci\_register\_driver+0x77/0x80
[ 3.443396] ? uPD98402\_module\_init+0xd/0xd
[ 3.443396] nicstar\_init+0x1f/0x75
[ 3.443396] do\_one\_initcall+0x7a/0x3d0
[ 3.443396] ? rdinit\_setup+0x40/0x40
[ 3.443396] ? rcu\_read\_lock\_sched\_held+0x4a/0x70
[ 3.443396] kernel\_init\_freeable+0x2a7/0x2f9
[ 3.443396] ? rest\_init+0x2c0/0x2c0
[ 3.443396] kernel\_init+0x13/0x180
[ 3.443396] ? rest\_init+0x2c0/0x2c0
[ 3.443396] ? rest\_init+0x2c0/0x2c0
[ 3.443396] ret\_from\_fork+0x1f/0x30
[ 3.443396] Modules linked in:
[ 3.443396] Dumping ftrace buffer:
[ 3.443396] (ftrace buffer empty)
[ 3.458593] ---[ end trace 3c6f8f0d8ef59bcd ]---
[ 3.458922] RIP: 0010:kfree+0x26a/0x300
[ 3.459198] Code: e8 3a c3 b9 ff e9 d6 fd ff ff 49 8b 45 00 31 db a9 00 00 01 00 75 4d 49 8b 45 00 a9 00 00 01 00 75 0a 49 8b 45 08 a8 01 75 02 <0f> 0b 89 d9 b8 00 10 00 00 be 06 00 00 00 48 d3 e0 f7 d8 48 63 d0
[ 3.460499] RSP: 0000:ffffc90000017b70 EFLAGS: 00010246
[ 3.460870] RAX: dead000000000100 RBX: 0000000000000000 RCX: 0000000000000000
[ 3.461371] RDX: 0000000000000000 RSI: ffffffff85d3df94 RDI: ffffffff85df38e6
[ 3.461873] RBP: ffffc90000017b90 R08: 0000000000000001 R09: 0000000000000001
[ 3.462372] R10: 0000000000000000 R11: 0000000000000001 R12: ffff888107dc0000
[ 3.462871] R13: ffffea00001f0100 R14: ffff888101a8bf00 R15: ffff888107dc0160
[ 3.463368] FS: 0000000000000000(0000) GS:ffff88817bc80000(0000) knlGS:0000000000000000
[ 3.463949] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 3.464356] CR2: 0000000000000000 CR3: 000000000642e000 CR4: 00000000000006e0
[ 3.464856] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 3.465356] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 3.465860] Kernel panic - not syncing: Fatal exception
[ 3.466370] Dumping ftrace buffer:
[ 3.466616] (ftrace buffer empty)
[ 3.466871] Kernel Offset: disabled
[ 3.467122] Rebooting in 1 seconds..
Signed-off-by: Zheyu Ma
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 5ad7f389f93b5227f2f02e29deb88f2ee53b8561
Author: Fugang Duan
Date: Mon Jun 21 14:27:37 2021 +0800
net: fec: add ndo\_select\_queue to fix TX bandwidth fluctuations
[ Upstream commit 52c4a1a85f4b346c39c896c0168f4a843b3385ff ]
As we know that AVB is enabled by default, and the ENET IP design is
queue 0 for best effort, queue 1&2 for AVB Class A&B. Bandwidth of each
queue 1&2 set in driver is 50%, TX bandwidth fluctuated when selecting
tx queues randomly with FEC\_QUIRK\_HAS\_AVB quirk available.
This patch adds ndo\_select\_queue callback to select queues for
transmitting to fix this issue. It will always return queue 0 if this is
not a vlan packet, and return queue 1 or 2 based on priority of vlan
packet.
You may complain that in fact we only use single queue for trasmitting
if we are not targeted to VLAN. Yes, but seems we have no choice, since
AVB is enabled when the driver probed, we can't switch this feature
dynamicly. After compare multiple queues to single queue, TX throughput
almost no improvement.
One way we can implemet is to configure the driver to multiple queues
with Round-robin scheme by default. Then add ndo\_setup\_tc callback to
enable/disable AVB feature for users. Unfortunately, ENET AVB IP seems
not follow the standard 802.1Qav spec. We only can program
DMAnCFG[IDLE\_SLOPE] field to calculate bandwidth fraction. And idle
slope is restricted to certain valus (a total of 19). It's far away from
CBS QDisc implemented in Linux TC framework. If you strongly suggest to do
this, I think we only can support limited numbers of bandwidth and reject
others, but it's really urgly and wried.
With this patch, VLAN tagged packets route to queue 0/1/2 based on vlan
priority; VLAN untagged packets route to queue 0.
Tested-by: Frieder Schrempf
Reported-by: Frieder Schrempf
Signed-off-by: Fugang Duan
Signed-off-by: Joakim Zhang
Reported-by: kernel test robot
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit df628a2027551dc339b3b001fa47a2cf9c292cf1
Author: Joakim Zhang
Date: Mon Jun 21 14:27:36 2021 +0800
net: fec: add FEC\_QUIRK\_HAS\_MULTI\_QUEUES represents i.MX6SX ENET IP
[ Upstream commit 471ff4455d61c9929ae912328859921708e1eafc ]
Frieder Schrempf reported a TX throuthput issue [1], it happens quite often
that the measured bandwidth in TX direction drops from its expected/nominal
value to something like ~50% (for 100M) or ~67% (for 1G) connections.
[1] https://lore.kernel.org/linux-arm-kernel/421cc86c-b66f-b372-32f7-21e59f9a98bc@kontron.de/
The issue becomes clear after digging into it, Net core would select
queues when transmitting packets. Since FEC have not impletemented
ndo\_select\_queue callback yet, so it will call netdev\_pick\_tx to select
queues randomly.
For i.MX6SX ENET IP with AVB support, driver default enables this
feature. According to the setting of QOS/RCMRn/DMAnCFG registers, AVB
configured to Credit-based scheme, 50% bandwidth of each queue 1&2.
With below tests let me think more:
1) With FEC\_QUIRK\_HAS\_AVB quirk, can reproduce TX bandwidth fluctuations issue.
2) Without FEC\_QUIRK\_HAS\_AVB quirk, can't reproduce TX bandwidth fluctuations issue.
The related difference with or w/o FEC\_QUIRK\_HAS\_AVB quirk is that, whether we
program FTYPE field of TxBD or not. As I describe above, AVB feature is
enabled by default. With FEC\_QUIRK\_HAS\_AVB quirk, frames in queue 0
marked as non-AVB, and frames in queue 1&2 marked as AVB Class A&B. It's
unreasonable if frames in queue 1&2 are not required to be time-sensitive.
So when Net core select tx queues ramdomly, Credit-based scheme would work
and lead to TX bandwidth fluctuated. On the other hand, w/o
FEC\_QUIRK\_HAS\_AVB quirk, frames in queue 1&2 are all marked as non-AVB, so
Credit-based scheme would not work.
Till now, how can we fix this TX throughput issue? Yes, please remove
FEC\_QUIRK\_HAS\_AVB quirk if you suffer it from time-nonsensitive networking.
However, this quirk is used to indicate i.MX6SX, other setting depends
on it. So this patch adds a new quirk FEC\_QUIRK\_HAS\_MULTI\_QUEUES to
represent i.MX6SX, it is safe for us remove FEC\_QUIRK\_HAS\_AVB quirk
now.
FEC\_QUIRK\_HAS\_AVB quirk is set by default in the driver, and users may
not know much about driver details, they would waste effort to find the
root cause, that is not we want. The following patch is a implementation
to fix it and users don't need to modify the driver.
Tested-by: Frieder Schrempf
Reported-by: Frieder Schrempf
Signed-off-by: Joakim Zhang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit b223fca477adfa86db681c9af1f23bfee9f98494
Author: Huang Pei
Date: Fri Jun 11 15:09:46 2021 +0800
MIPS: add PMD table accounting into MIPS'pmd\_alloc\_one
[ Upstream commit ed914d48b6a1040d1039d371b56273d422c0081e ]
This fixes Page Table accounting bug.
MIPS is the ONLY arch just defining \_\_HAVE\_ARCH\_PMD\_ALLOC\_ONE alone.
Since commit b2b29d6d011944 (mm: account PMD tables like PTE tables),
"pmd\_free" in asm-generic with PMD table accounting and "pmd\_alloc\_one"
in MIPS without PMD table accounting causes PageTable accounting number
negative, which read by global\_zone\_page\_state(), always returns 0.
Signed-off-by: Huang Pei
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 59dc71f577eac2e4aa56c809fc3d827539bcc8a8
Author: Pascal Terjan
Date: Sat Apr 24 18:29:59 2021 +0100
rtl8xxxu: Fix device info for RTL8192EU devices
[ Upstream commit c240b044edefa3c3af4014a4030e017dd95b59a1 ]
Based on 2001:3319 and 2357:0109 which I used to test the fix and
0bda:818b and 2357:0108 for which I found efuse dumps online.
== 2357:0109 ==
=== Before ===
Vendor: Realtek
Product: \x03802.11n NI
Serial:
=== After ===
Vendor: Realtek
Product: 802.11n NIC
Serial not available.
== 2001:3319 ==
=== Before ===
Vendor: Realtek
Product: Wireless N
Serial: no USB Adap
=== After ===
Vendor: Realtek
Product: Wireless N Nano USB Adapter
Serial not available.
Signed-off-by: Pascal Terjan
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210424172959.1559890-1-pterjan@google.com
Signed-off-by: Sasha Levin
commit 97e50ed9eae588cb274fa499375a1d49ca24cfa9
Author: Ryder Lee
Date: Thu Jun 17 15:17:49 2021 +0800
mt76: fix iv and CCMP header insertion
[ Upstream commit c368362c36d3d4cedbc9a1c9caa95960912cc429 ]
The iv from RXD is only for TKIP\_RSC/CCMP\_PN/GCMP\_PN, and it needs a
check for CCMP header insertion. Move mt76\_cipher\_type to mt76.h to
reduce duplicated code.
Signed-off-by: Xing Song
Signed-off-by: Ryder Lee
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 65c015b505159e169f81482466b747b306489ade
Author: Ryder Lee
Date: Sat Jun 12 02:04:20 2021 +0800
mt76: mt7915: fix IEEE80211\_HE\_PHY\_CAP7\_MAX\_NC for station mode
[ Upstream commit 2707ff4dd7b1479dbd44ebb3c74788084cc95245 ]
The value of station mode is always 0.
Fixed: 00b2e16e0063 ("mt76: mt7915: add TxBF capabilities")
Signed-off-by: Ryder Lee
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 9b6248b3e6498ce0985b9f9372123de35c362be1
Author: Sean Wang
Date: Wed Jun 9 14:15:32 2021 +0800
mt76: connac: fix the maximum interval schedule scan can support
[ Upstream commit abded041a07467c2f3dfe10afd9ea10572c63cc9 ]
Maximum interval (in seconds) for schedule scan plan supported by
the offload firmware can be U16\_MAX.
Signed-off-by: Sean Wang
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit bbe1d0ada80eeb8ff745c2780b7bbcc0fcb3877f
Author: Lorenzo Bianconi
Date: Wed Jun 2 18:00:14 2021 +0200
mt76: connac: fix UC entry is being overwritten
[ Upstream commit 82453b1cbf9ef166364c12b5464251f16bac5f51 ]
Fix UC entry is being overwritten by BC entry
Tested-by: Deren Wu
Co-developed-by: Deren Wu
Signed-off-by: Deren Wu
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 57602135190b0d9324aa82e3cc01cdbfaf430ffe
Author: Lorenzo Bianconi
Date: Mon May 31 08:33:18 2021 +0200
mt76: mt7921: enable hw offloading for wep keys
[ Upstream commit a60951d4faa0ef2e475797dd217c2eaee32ed1c2 ]
Enable wep key hw offloading for sta mode. This patch fixes
WoW support for wep connections.
Tested-by: Deren.Wu
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 869417fa825c82c21e35742d72d0bbc27525263f
Author: Lorenzo Bianconi
Date: Sun May 23 23:10:12 2021 +0200
mt76: mt7921: reset wfsys during hw probe
[ Upstream commit 01f7da40917923bf9d8fd8d5c9a6ed646004e47c ]
This patch fixes a mcu hang during device probe on
Marvell ESPRESSObin after a hot reboot.
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 6620a41fe435b42e5c869cced265bef6f0ad94d2
Author: Sean Wang
Date: Thu May 20 11:46:37 2021 +0800
mt76: mt7921: fix reset under the deep sleep is enabled
[ Upstream commit 7bf0a71e839822bb6ba04a6e163ad334314e2659 ]
To fix possibly the race to access register between the WiFi reset
and the other context that is caused by explicitly cancelling ps\_work
and wake\_work to break PM\_STATE consistency.
Deep sleep would cause the hardware into the inactive state,
so we forcely put device drv\_own state before we start to reset.
The patch also ignore the reset request when the procedure is in
progress to avoid the consecutive WiFi resets.
localhost ~ # [ 2932.073966] SError Interrupt on CPU7, code 0xbe000011
[ 2932.073967] CPU: 7 PID: 8761 Comm: kworker/u16:2 Not tainted 5.4.112 #30
[ 2932.073968] Hardware name: MediaTek Asurada rev1 board (DT)
[ 2932.073968] Workqueue: phy0 ieee80211\_reconfig\_filter [mac80211]
[ 2932.073969] pstate: 80400089 (Nzcv daIf +PAN -UAO)
[ 2932.073969] pc : el1\_irq+0x78/0x180
[ 2932.073970] lr : mt76\_mmio\_rmw+0x30/0x5c [mt76]
[ 2932.073970] sp : ffffffc01142bad0
[ 2932.073970] x29: ffffffc01142bc00 x28: ffffff8f96fb1e00
[ 2932.073971] x27: ffffffd2cdc12138 x26: ffffffd2cdaeb018
[ 2932.073972] x25: 0000000000000000 x24: ffffff8fa8e14c08
[ 2932.073973] x23: 0000000080c00009 x22: ffffffd2a5603918
[ 2932.073974] x21: ffffffc01142bc10 x20: 0000007fffffffff
[ 2932.073975] x19: 0000000000000000 x18: 0000000000000400
[ 2932.073975] x17: 0000000000000400 x16: ffffffd2cd2b87dc
[ 2932.073976] x15: 0000000000000000 x14: 0000000000000000
[ 2932.073977] x13: 0000000000000001 x12: 0000000000000001
[ 2932.073978] x11: 0000000000000001 x10: 000000000010e000
[ 2932.073978] x9 : 0000000000000000 x8 : ffffffc013921404
[ 2932.073979] x7 : 000000b2b5593519 x6 : 0000000000300000
[ 2932.073980] x5 : 0000000000000000 x4 : ffffffc01142bbc8
[ 2932.073980] x3 : 00000000000001f0 x2 : 0000000000000000
[ 2932.073981] x1 : 0000000000021404 x0 : ffffff8fa8e12300
[ 2932.073982] Kernel panic - not syncing: Asynchronous SError Interrupt
[ 2932.073983] CPU: 7 PID: 8761 Comm: kworker/u16:2 Not tainted 5.4.112 #30
[ 2932.073983] Hardware name: MediaTek Asurada rev1 board (DT)
[ 2932.073984] Workqueue: phy0 ieee80211\_reconfig\_filter [mac80211]
[ 2932.073984] Call trace:
[ 2932.073985] dump\_backtrace+0x0/0x14c
[ 2932.073985] show\_stack+0x20/0x2c
[ 2932.073985] dump\_stack+0xa0/0xf8
[ 2932.073986] panic+0x154/0x360
[ 2932.073986] test\_taint+0x0/0x44
[ 2932.073986] arm64\_serror\_panic+0x78/0x84
[ 2932.073987] do\_serror+0x0/0x118
[ 2932.073987] do\_serror+0xa4/0x118
[ 2932.073987] el1\_error+0x84/0xf8
[ 2932.073988] el1\_irq+0x78/0x180
[ 2932.073988] mt76\_mmio\_rr+0x30/0xf0 [mt76]
[ 2932.073988] mt76\_mmio\_rmw+0x30/0x5c [mt76]
[ 2932.073989] mt7921\_rmw+0x4c/0x5c [mt7921e]
[ 2932.073989] mt7921\_configure\_filter+0x138/0x160 [mt7921e]
[ 2932.073990] ieee80211\_configure\_filter+0x2f0/0x3e0 [mac80211]
[ 2932.073990] ieee80211\_reconfig\_filter+0x1c/0x28 [mac80211]
[ 2932.073990] process\_one\_work+0x208/0x3c8
[ 2932.073991] worker\_thread+0x23c/0x3e8
[ 2932.073991] kthread+0x140/0x17c
[ 2932.073992] ret\_from\_fork+0x10/0x18
[ 2932.074071] SMP: stopping secondary CPUs
[ 2932.074071] Kernel Offset: 0x12bc800000 from 0xffffffc010000000
[ 2932.074072] PHYS\_OFFSET: 0xfffffff180000000
[ 2932.074072] CPU features: 0x080026,2a80aa18
[ 2932.074072] Memory Limit: none
Co-developed-by: Lorenzo Bianconi
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Sean Wang
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 7922a844969d6238e8dadab8608b61b179087483
Author: Evelyn Tsai
Date: Mon May 3 16:04:37 2021 +0800
mt76: mt7915: fix tssi indication field of DBDC NICs
[ Upstream commit 64cf5ad3c2fa841e4b416343a7ea69c63d60fa4e ]
Correct the bitfield which indicates TSSI on/off for MT7915D NIC.
Signed-off-by: Evelyn Tsai
Signed-off-by: Shayne Chen
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 38b73fe18c6b0628bd4156f13775c484f5c650db
Author: xinhui pan
Date: Tue Jun 15 15:11:07 2021 +0800
drm/amdkfd: Walk through list with dqm lock hold
[ Upstream commit 56f221b6389e7ab99c30bbf01c71998ae92fc584 ]
To avoid any list corruption.
Signed-off-by: xinhui pan
Reviewed-by: Felix Kuehling
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit af15052971e17de15f3817b9918e9f46d29c67d5
Author: Stanley.Yang
Date: Wed Jun 16 21:14:01 2021 +0800
drm/amdgpu: fix bad address translation for sienna\_cichlid
[ Upstream commit 6ec598cc9dfbf40433e94a2ed1a622e3ef80268b ]
Signed-off-by: Stanley.Yang
Reviewed-by: Hawking Zhang
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit a8eca6968b1e66785ef142db65afa62c26ec1029
Author: Pavel Begunkov
Date: Thu Jun 17 18:13:59 2021 +0100
io\_uring: fix false WARN\_ONCE
[ Upstream commit e6ab8991c5d0b0deae0961dc22c0edd1dee328f5 ]
WARNING: CPU: 1 PID: 11749 at fs/io-wq.c:244 io\_wqe\_wake\_worker fs/io-wq.c:244 [inline]
WARNING: CPU: 1 PID: 11749 at fs/io-wq.c:244 io\_wqe\_enqueue+0x7f6/0x910 fs/io-wq.c:751
A WARN\_ON\_ONCE() in io\_wqe\_wake\_worker() can be triggered by a valid
userspace setup. Replace it with pr\_warn.
Reported-by: syzbot+ea2f1484cffe5109dc10@syzkaller.appspotmail.com
Signed-off-by: Pavel Begunkov
Link: https://lore.kernel.org/r/f7ede342c3342c4c26668f5168e2993e38bbd99c.1623949695.git.asml.silence@gmail.com
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 9e134247013e29e0a0c13365f47f1394824a522f
Author: Yang Yingliang
Date: Thu Jun 17 16:02:07 2021 +0800
net: sched: fix error return code in tcf\_del\_walker()
[ Upstream commit 55d96f72e8ddc0a294e0b9c94016edbb699537e1 ]
When nla\_put\_u32() fails, 'ret' could be 0, it should
return error code in tcf\_del\_walker().
Reported-by: Hulk Robot
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 06648197e4ae90ef843ad1656ae22108be26a944
Author: Yang Yingliang
Date: Thu Jun 17 13:11:19 2021 +0800
net: ipa: Add missing of\_node\_put() in ipa\_firmware\_load()
[ Upstream commit b244163f2c45c12053cb0291c955f892e79ed8a9 ]
This node pointer is returned by of\_parse\_phandle() with refcount
incremented in this function. of\_node\_put() on it before exiting
this function.
Reported-by: Hulk Robot
Signed-off-by: Yang Yingliang
Acked-by: Alex Elder
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 0147b9c4ebf6259638a3a590a5c1f1919af3ee00
Author: Jian Shen
Date: Thu Jun 17 11:37:11 2021 +0800
net: fix mistake path for netdev\_features\_strings
[ Upstream commit 2d8ea148e553e1dd4e80a87741abdfb229e2b323 ]
Th\_strings arrays netdev\_features\_strings, tunable\_strings, and
phy\_tunable\_strings has been moved to file net/ethtool/common.c.
So fixes the comment.
Signed-off-by: Jian Shen
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4d23e6082729e472b7182ca9ed0ccc6e94863bb9
Author: Felix Fietkau
Date: Sun May 9 20:23:01 2021 +0200
mt76: dma: use ieee80211\_tx\_status\_ext to free packets when tx fails
[ Upstream commit 94e4f5794627a80ce036c35b32a9900daeb31be3 ]
Fixes AQL issues on full queues, especially with 802.3 encap offload
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit 2a64f3732310a16e746650e49f55ba5dc71ca59a
Author: Felix Fietkau
Date: Fri May 7 14:07:53 2021 +0200
mt76: mt7615: fix fixed-rate tx status reporting
[ Upstream commit ec8f1a90d006f7cedcf86ef19fd034a406a213d6 ]
Rely on the txs fixed-rate bit instead of info->control.rates
Signed-off-by: Felix Fietkau
Signed-off-by: Sasha Levin
commit b2b69554431f44dcfa51a57f7dbde3461a435747
Author: Jacob Keller
Date: Thu May 6 08:40:05 2021 -0700
ice: mark PTYPE 2 as reserved
[ Upstream commit 0c526d440f76676733cb470b454db9d5507a3a50 ]
The entry for PTYPE 2 in the ice\_ptype\_lkup table incorrectly states
that this is an L2 packet with no payload. According to the datasheet,
this PTYPE is actually unused and reserved.
Fix the lookup entry to indicate this is an unused entry that is
reserved.
Signed-off-by: Jacob Keller
Tested-by: Tony Brelinski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 008ec090f0d1f3eb8d462723d9be439065f31b4d
Author: Jacob Keller
Date: Thu May 6 08:40:04 2021 -0700
ice: fix incorrect payload indicator on PTYPE
[ Upstream commit 638a0c8c8861cb8a3b54203e632ea5dcc23d8ca5 ]
The entry for PTYPE 90 indicates that the payload is layer 3. This does
not match the specification in the datasheet which indicates the packet
is a MAC, IPv6, UDP packet, with a payload in layer 4.
Fix the lookup table to match the data sheet.
Signed-off-by: Jacob Keller
Tested-by: Tony Brelinski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit eb7b40d9d3785f7a131fb0b1f89bb6efa46c1833
Author: Pavel Skripkin
Date: Fri Apr 30 21:50:46 2021 +0300
ext4: fix memory leak in ext4\_fill\_super
[ Upstream commit 618f003199c6188e01472b03cdbba227f1dc5f24 ]
static int kthread(void \*\_create) will return -ENOMEM
or -EINTR in case of internal failure or
kthread\_stop() call happens before threadfn call.
To prevent fancy error checking and make code
more straightforward we moved all cleanup code out
of kmmpd threadfn.
Also, dropped struct mmpd\_data at all. Now struct super\_block
is a threadfn data and struct buffer\_head embedded into
struct ext4\_sb\_info.
Reported-by: syzbot+d9e482e303930fa4f6ff@syzkaller.appspotmail.com
Signed-off-by: Pavel Skripkin
Link: https://lore.kernel.org/r/20210430185046.15742-1-paskripkin@gmail.com
Signed-off-by: Theodore Ts'o
Signed-off-by: Sasha Levin
commit 4d39b8f57b7dd0f2713df849f5126c165089af8f
Author: Daniel Borkmann
Date: Wed Jun 16 11:25:11 2021 +0200
bpf: Fix up register-based shifts in interpreter to silence KUBSAN
[ Upstream commit 28131e9d933339a92f78e7ab6429f4aaaa07061c ]
syzbot reported a shift-out-of-bounds that KUBSAN observed in the
interpreter:
[...]
UBSAN: shift-out-of-bounds in kernel/bpf/core.c:1420:2
shift exponent 255 is too large for 64-bit type 'long long unsigned int'
CPU: 1 PID: 11097 Comm: syz-executor.4 Not tainted 5.12.0-rc2-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:79 [inline]
dump\_stack+0x141/0x1d7 lib/dump\_stack.c:120
ubsan\_epilogue+0xb/0x5a lib/ubsan.c:148
\_\_ubsan\_handle\_shift\_out\_of\_bounds.cold+0xb1/0x181 lib/ubsan.c:327
\_\_\_bpf\_prog\_run.cold+0x19/0x56c kernel/bpf/core.c:1420
\_\_bpf\_prog\_run32+0x8f/0xd0 kernel/bpf/core.c:1735
bpf\_dispatcher\_nop\_func include/linux/bpf.h:644 [inline]
bpf\_prog\_run\_pin\_on\_cpu include/linux/filter.h:624 [inline]
bpf\_prog\_run\_clear\_cb include/linux/filter.h:755 [inline]
run\_filter+0x1a1/0x470 net/packet/af\_packet.c:2031
packet\_rcv+0x313/0x13e0 net/packet/af\_packet.c:2104
dev\_queue\_xmit\_nit+0x7c2/0xa90 net/core/dev.c:2387
xmit\_one net/core/dev.c:3588 [inline]
dev\_hard\_start\_xmit+0xad/0x920 net/core/dev.c:3609
\_\_dev\_queue\_xmit+0x2121/0x2e00 net/core/dev.c:4182
\_\_bpf\_tx\_skb net/core/filter.c:2116 [inline]
\_\_bpf\_redirect\_no\_mac net/core/filter.c:2141 [inline]
\_\_bpf\_redirect+0x548/0xc80 net/core/filter.c:2164
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2448 [inline]
bpf\_clone\_redirect+0x2ae/0x420 net/core/filter.c:2420
\_\_\_bpf\_prog\_run+0x34e1/0x77d0 kernel/bpf/core.c:1523
\_\_bpf\_prog\_run512+0x99/0xe0 kernel/bpf/core.c:1737
bpf\_dispatcher\_nop\_func include/linux/bpf.h:644 [inline]
bpf\_test\_run+0x3ed/0xc50 net/bpf/test\_run.c:50
bpf\_prog\_test\_run\_skb+0xabc/0x1c50 net/bpf/test\_run.c:582
bpf\_prog\_test\_run kernel/bpf/syscall.c:3127 [inline]
\_\_do\_sys\_bpf+0x1ea9/0x4f00 kernel/bpf/syscall.c:4406
do\_syscall\_64+0x2d/0x70 arch/x86/entry/common.c:46
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
[...]
Generally speaking, KUBSAN reports from the kernel should be fixed.
However, in case of BPF, this particular report caused concerns since
the large shift is not wrong from BPF point of view, just undefined.
In the verifier, K-based shifts that are >= {64,32} (depending on the
bitwidth of the instruction) are already rejected. The register-based
cases were not given their content might not be known at verification
time. Ideas such as verifier instruction rewrite with an additional
AND instruction for the source register were brought up, but regularly
rejected due to the additional runtime overhead they incur.
As Edward Cree rightly put it:
Shifts by more than insn bitness are legal in the BPF ISA; they are
implementation-defined behaviour [of the underlying architecture],
rather than UB, and have been made legal for performance reasons.
Each of the JIT backends compiles the BPF shift operations to machine
instructions which produce implementation-defined results in such a
case; the resulting contents of the register may be arbitrary but
program behaviour as a whole remains defined.
Guard checks in the fast path (i.e. affecting JITted code) will thus
not be accepted.
The case of division by zero is not truly analogous here, as division
instructions on many of the JIT-targeted architectures will raise a
machine exception / fault on division by zero, whereas (to the best
of my knowledge) none will do so on an out-of-bounds shift.
Given the KUBSAN report only affects the BPF interpreter, but not JITs,
one solution is to add the ANDs with 63 or 31 into \_\_\_bpf\_prog\_run().
That would make the shifts defined, and thus shuts up KUBSAN, and the
compiler would optimize out the AND on any CPU that interprets the shift
amounts modulo the width anyway (e.g., confirmed from disassembly that
on x86-64 and arm64 the generated interpreter code is the same before
and after this fix).
The BPF interpreter is slow path, and most likely compiled out anyway
as distros select BPF\_JIT\_ALWAYS\_ON to avoid speculative execution of
BPF instructions by the interpreter. Given the main argument was to
avoid sacrificing performance, the fact that the AND is optimized away
from compiler for mainstream archs helps as well as a solution moving
forward. Also add a comment on LSH/RSH/ARSH translation for JIT authors
to provide guidance when they see the \_\_\_bpf\_prog\_run() interpreter
code and use it as a model for a new JIT backend.
Reported-by: syzbot+bed360704c521841c85d@syzkaller.appspotmail.com
Reported-by: Kurt Manucredo
Signed-off-by: Eric Biggers
Co-developed-by: Eric Biggers
Signed-off-by: Daniel Borkmann
Acked-by: Alexei Starovoitov
Acked-by: Andrii Nakryiko
Tested-by: syzbot+bed360704c521841c85d@syzkaller.appspotmail.com
Cc: Edward Cree
Link: https://lore.kernel.org/bpf/0000000000008f912605bd30d5d7@google.com
Link: https://lore.kernel.org/bpf/bac16d8d-c174-bdc4-91bd-bfa62b410190@gmail.com
Signed-off-by: Sasha Levin
commit 2cb85397c30f5152ad7d8f1414f9635a0e23bc2f
Author: George McCollister
Date: Tue Jun 15 12:50:37 2021 -0500
net: hsr: don't check sequence number if tag removal is offloaded
[ Upstream commit c2ae34a7deaff463ecafb7db627b77faaca8e159 ]
Don't check the sequence number when deciding when to update time\_in in
the node table if tag removal is offloaded since the sequence number is
part of the tag. This fixes a problem where the times in the node table
wouldn't update when 0 appeared to be before or equal to seq\_out when
tag removal was offloaded.
Signed-off-by: George McCollister
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 3382ec34a4d56c02a2c146e9c6c73bfe8d6e2604
Author: Amber Lin
Date: Mon Jun 7 14:46:21 2021 -0400
drm/amdkfd: Fix circular lock in nocpsch path
[ Upstream commit a7b2451d31cfa2e8aeccf3b35612ce33f02371fc ]
Calling free\_mqd inside of destroy\_queue\_nocpsch\_locked can cause a
circular lock. destroy\_queue\_nocpsch\_locked is called under a DQM lock,
which is taken in MMU notifiers, potentially in FS reclaim context.
Taking another lock, which is BO reservation lock from free\_mqd, while
causing an FS reclaim inside the DQM lock creates a problematic circular
lock dependency. Therefore move free\_mqd out of
destroy\_queue\_nocpsch\_locked and call it after unlocking DQM.
Signed-off-by: Amber Lin
Reviewed-by: Felix Kuehling
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 161c4c2a19f494cb2aceeaa315b442abab649f7a
Author: Jonathan Kim
Date: Fri Jun 11 13:36:34 2021 -0400
drm/amdkfd: fix circular locking on get\_wave\_state
[ Upstream commit 63f6e01237257e7226efc5087f3f0b525d320f54 ]
get\_wave\_state acquires the mmap\_lock on copy\_to\_user but so do
mmu\_notifiers. mmu\_notifiers allows dqm locking so do get\_wave\_state
outside the dqm\_lock to prevent circular locking.
v2: squash in unused variable removal.
Signed-off-by: Jonathan Kim
Reviewed-by: Felix Kuehling
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 118e6aea7ae7c92ac85ec37dc4d0a6111c0e2a37
Author: Zou Wei
Date: Wed May 12 11:05:14 2021 +0800
cw1200: add missing MODULE\_DEVICE\_TABLE
[ Upstream commit dd778f89225cd258e8f0fed2b7256124982c8bb5 ]
This patch adds missing MODULE\_DEVICE\_TABLE definition which generates
correct modalias for automatic loading of this driver when it is built
as an external module.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/1620788714-14300-1-git-send-email-zou\_wei@huawei.com
Signed-off-by: Sasha Levin
commit 40af3960a15339e8bbd3be50c3bc7b35e1a0b6ea
Author: Lee Gibson
Date: Wed Apr 28 12:55:08 2021 +0100
wl1251: Fix possible buffer overflow in wl1251\_cmd\_scan
[ Upstream commit d10a87a3535cce2b890897914f5d0d83df669c63 ]
Function wl1251\_cmd\_scan calls memcpy without checking the length.
Harden by checking the length is within the maximum allowed size.
Signed-off-by: Lee Gibson
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210428115508.25624-1-leegib@gmail.com
Signed-off-by: Sasha Levin
commit 36409fe65122a51ea0a9f14e6a9b4206eba707b6
Author: Vladimir Oltean
Date: Mon Jun 14 16:44:41 2021 +0300
net: phy: nxp-c45-tja11xx: enable MDIO write access to the master/slave registers
[ Upstream commit 0b5f0f29b118910c89fe249cdfbc11b400a86a18 ]
The SJA1110 switch integrates TJA1103 PHYs, but in SJA1110 switch rev B
silicon, there is a bug in that the registers for selecting the 100base-T1
autoneg master/slave roles are not writable.
To enable write access to the master/slave registers, these additional
PHY writes are necessary during initialization.
The issue has been corrected in later SJA1110 silicon versions and is
not present in the standalone PHY variants, but applying the workaround
unconditionally in the driver should not do any harm.
Suggested-by: Radu Pirea (NXP OSS)
Signed-off-by: Vladimir Oltean
Reviewed-by: Russell King (Oracle)
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 84bb21d9886c70b466b919c454c6bbd52e6b5e41
Author: Tony Lindgren
Date: Thu Jun 3 09:28:14 2021 +0300
wlcore/wl12xx: Fix wl12xx get\_mac error if device is in ELP
[ Upstream commit 11ef6bc846dcdce838f0b00c5f6a562c57e5d43b ]
At least on wl12xx, reading the MAC after boot can fail with a warning
at drivers/net/wireless/ti/wlcore/sdio.c:78 wl12xx\_sdio\_raw\_read.
The failed call comes from wl12xx\_get\_mac() that wlcore\_nvs\_cb() calls
after request\_firmware\_work\_func().
After the error, no wireless interface is created. Reloading the wl12xx
module makes the interface work.
Turns out the wlan controller can be in a low-power ELP state after the
boot from the bootloader or kexec, and needs to be woken up first.
Let's wake the hardware and add a sleep after that similar to
wl12xx\_pre\_boot() is already doing.
Note that a similar issue could exist for wl18xx, but I have not seen it
so far. And a search for wl18xx\_get\_mac and wl12xx\_sdio\_raw\_read did not
produce similar errors.
Cc: Carl Philipp Klemm
Signed-off-by: Tony Lindgren
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20210603062814.19464-1-tony@atomide.com
Signed-off-by: Sasha Levin
commit ce6dc850612a6cb8d2980222804cf8839dc7758a
Author: Mikulas Patocka
Date: Sun Jun 6 16:13:16 2021 -0400
dm writecache: commit just one block, not a full page
[ Upstream commit 991bd8d7bc78966b4dc427b53a144f276bffcd52 ]
Some architectures have pages larger than 4k and committing a full
page causes needless overhead.
Fix this by writing a single block when committing the superblock.
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Sasha Levin
commit 7cc35bd4355b5953c6faa9c067ebbc8ef9c84aa7
Author: Steffen Klassert
Date: Mon Jun 7 15:21:49 2021 +0200
xfrm: Fix error reporting in xfrm\_state\_construct.
[ Upstream commit 6fd06963fa74197103cdbb4b494763127b3f2f34 ]
When memory allocation for XFRMA\_ENCAP or XFRMA\_COADDR fails,
the error will not be reported because the -ENOMEM assignment
to the err variable is overwritten before. Fix this by moving
these two in front of the function so that memory allocation
failures will be reported.
Reported-by: Tobias Brunner
Signed-off-by: Steffen Klassert
Signed-off-by: Sasha Levin
commit 62adf2af9f09e235dfb5621a8858b7d22f105a41
Author: Lijun Pan
Date: Fri Jun 11 10:43:39 2021 -0500
ibmvnic: fix kernel build warnings in build\_hdr\_descs\_arr
[ Upstream commit 73214a690c50a134bd364e1a4430e0e7ac81a8d8 ]
Fix the following kernel build warnings:
drivers/net/ethernet/ibm/ibmvnic.c:1516: warning: Function parameter or member 'skb' not described in 'build\_hdr\_descs\_arr'
drivers/net/ethernet/ibm/ibmvnic.c:1516: warning: Function parameter or member 'indir\_arr' not described in 'build\_hdr\_descs\_arr'
drivers/net/ethernet/ibm/ibmvnic.c:1516: warning: Excess function parameter 'txbuff' description in 'build\_hdr\_descs\_arr'
Signed-off-by: Lijun Pan
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 20102b0f678493b95ea1f142246fff726ac7cc4c
Author: Mark Yacoub
Date: Fri Jun 4 13:01:07 2021 -0400
drm/amd/display: Verify Gamma & Degamma LUT sizes in amdgpu\_dm\_atomic\_check
[ Upstream commit 03fc4cf45d30533d54f0f4ebc02aacfa12f52ce2 ]
For each CRTC state, check the size of Gamma and Degamma LUTs so
unexpected and larger sizes wouldn't slip through.
TEST: IGT:kms\_color::pipe-invalid-gamma-lut-sizes
v2: fix assignments in if clauses, Mark's email.
Reviewed-by: Harry Wentland
Signed-off-by: Mark Yacoub
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 66fc2862a252f7356e7aa5eeb44519ee005fd066
Author: Heiner Kallweit
Date: Thu Jun 10 22:56:59 2021 +0200
r8169: avoid link-up interrupt issue on RTL8106e if user enables ASPM
[ Upstream commit 1ee8856de82faec9bc8bd0f2308a7f27e30ba207 ]
It has been reported that on RTL8106e the link-up interrupt may be
significantly delayed if the user enables ASPM L1. Per default ASPM
is disabled. The change leaves L1 enabled on the PCIe link (thus still
allowing to reach higher package power saving states), but the
NIC won't actively trigger it.
Reported-by: Koba Ko
Tested-by: Koba Ko
Signed-off-by: Heiner Kallweit
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4b58c2891d09b07225cb8c4199de62dbb6a1b441
Author: Minchan Kim
Date: Wed Jun 9 09:37:17 2021 -0700
selinux: use \_\_GFP\_NOWARN with GFP\_NOWAIT in the AVC
[ Upstream commit 648f2c6100cfa18e7dfe43bc0b9c3b73560d623c ]
In the field, we have seen lots of allocation failure from the call
path below.
06-03 13:29:12.999 1010315 31557 31557 W Binder : 31542\_2: page allocation failure: order:0, mode:0x800(GFP\_NOWAIT), nodemask=(null),cpuset=background,mems\_allowed=0
...
...
06-03 13:29:12.999 1010315 31557 31557 W Call trace:
06-03 13:29:12.999 1010315 31557 31557 W : dump\_backtrace.cfi\_jt+0x0/0x8
06-03 13:29:12.999 1010315 31557 31557 W : dump\_stack+0xc8/0x14c
06-03 13:29:12.999 1010315 31557 31557 W : warn\_alloc+0x158/0x1c8
06-03 13:29:12.999 1010315 31557 31557 W : \_\_alloc\_pages\_slowpath+0x9d8/0xb80
06-03 13:29:12.999 1010315 31557 31557 W : \_\_alloc\_pages\_nodemask+0x1c4/0x430
06-03 13:29:12.999 1010315 31557 31557 W : allocate\_slab+0xb4/0x390
06-03 13:29:12.999 1010315 31557 31557 W : \_\_\_slab\_alloc+0x12c/0x3a4
06-03 13:29:12.999 1010315 31557 31557 W : kmem\_cache\_alloc+0x358/0x5e4
06-03 13:29:12.999 1010315 31557 31557 W : avc\_alloc\_node+0x30/0x184
06-03 13:29:12.999 1010315 31557 31557 W : avc\_update\_node+0x54/0x4f0
06-03 13:29:12.999 1010315 31557 31557 W : avc\_has\_extended\_perms+0x1a4/0x460
06-03 13:29:12.999 1010315 31557 31557 W : selinux\_file\_ioctl+0x320/0x3d0
06-03 13:29:12.999 1010315 31557 31557 W : \_\_arm64\_sys\_ioctl+0xec/0x1fc
06-03 13:29:12.999 1010315 31557 31557 W : el0\_svc\_common+0xc0/0x24c
06-03 13:29:12.999 1010315 31557 31557 W : el0\_svc+0x28/0x88
06-03 13:29:12.999 1010315 31557 31557 W : el0\_sync\_handler+0x8c/0xf0
06-03 13:29:12.999 1010315 31557 31557 W : el0\_sync+0x1a4/0x1c0
..
..
06-03 13:29:12.999 1010315 31557 31557 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:12.999 1010315 31557 31557 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:12.999 1010315 31557 31557 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:12.999 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:12.999 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:12.999 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:12.999 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:12.999 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:12.999 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:12.999 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:12.999 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:12.999 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:13.000 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:13.000 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:13.000 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:13.000 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:13.000 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:13.000 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:13.000 1010161 10686 10686 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:13.000 1010161 10686 10686 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:13.000 1010161 10686 10686 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:13.000 10230 30892 30892 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:13.000 10230 30892 30892 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
06-03 13:29:13.000 10230 30892 30892 W node 0 : slabs: 57, objs: 2907, free: 0
06-03 13:29:13.000 10230 30892 30892 W SLUB : Unable to allocate memory on node -1, gfp=0x900(GFP\_NOWAIT|\_\_GFP\_ZERO)
06-03 13:29:13.000 10230 30892 30892 W cache : avc\_node, object size: 72, buffer size: 80, default order: 0, min order: 0
Based on [1], selinux is tolerate for failure of memory allocation.
Then, use \_\_GFP\_NOWARN together.
[1] 476accbe2f6e ("selinux: use GFP\_NOWAIT in the AVC kmem\_caches")
Signed-off-by: Minchan Kim
[PM: subj fix, line wraps, normalized commit refs]
Signed-off-by: Paul Moore
Signed-off-by: Sasha Levin
commit dd18ad96a9ea267152eec034e24efbdc7eb7df2f
Author: Yang Yingliang
Date: Thu Jun 10 17:17:12 2021 +0800
net: mido: mdio-mux-bcm-iproc: Use devm\_platform\_get\_and\_ioremap\_resource()
[ Upstream commit 8a55a73433e763c8aec4a3e8df5c28c821fc44b9 ]
Use devm\_platform\_get\_and\_ioremap\_resource() to simplify
code and avoid a null-ptr-deref by checking 'res' in it.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 7ca7d4404b959a4642908bbb227de480aa57ba29
Author: Yang Yingliang
Date: Thu Jun 10 16:02:43 2021 +0800
fjes: check return value after calling platform\_get\_resource()
[ Upstream commit f18c11812c949553d2b2481ecaa274dd51bed1e7 ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 61e364fafec1d31b68c61653e81c577f471ee780
Author: Nirmoy Das
Date: Tue Jun 8 13:23:44 2021 +0200
drm/amdkfd: use allowed domain for vmbo validation
[ Upstream commit bc05716d4fdd065013633602c5960a2bf1511b9c ]
Fixes handling when page tables are in system memory.
v3: remove struct amdgpu\_vm\_parser.
v2: remove unwanted variable.
change amdgpu\_amdkfd\_validate instead of amdgpu\_amdkfd\_bo\_validate.
Signed-off-by: Nirmoy Das
Reviewed-by: Christian König
Reviewed-by: Felix Kuehling
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3b5c55df50679c7fde8eb424afe2925eaf38e7aa
Author: Yang Yingliang
Date: Wed Jun 9 21:25:15 2021 +0800
net: sgi: ioc3-eth: check return value after calling platform\_get\_resource()
[ Upstream commit db8f7be1e1d64fbf113a456ef94534fbf5e9a9af ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 42b8412dc12309c3050b38818e478e24e186c647
Author: Amit Cohen
Date: Tue Jun 8 15:44:09 2021 +0300
selftests: Clean forgotten resources as part of cleanup()
[ Upstream commit e67dfb8d15deb33c425d0b0ee22f2e5eef54c162 ]
Several tests do not set some ports down as part of their cleanup(),
resulting in IPv6 link-local addresses and associated routes not being
deleted.
These leaks were found using a BPF tool that monitors ASIC resources.
Solve this by setting the ports down at the end of the tests.
Signed-off-by: Amit Cohen
Reviewed-by: Petr Machata
Signed-off-by: Ido Schimmel
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 32438665ba6634ff7b19bad3305934096cc0acee
Author: Joakim Zhang
Date: Tue Jun 8 11:15:35 2021 +0800
net: phy: realtek: add delay to fix RXC generation issue
[ Upstream commit 6813cc8cfdaf401476e1a007cec8ae338cefa573 ]
PHY will delay about 11.5ms to generate RXC clock when switching from
power down to normal operation. Read/write registers would also cause RXC
become unstable and stop for a while during this process. Realtek engineer
suggests 15ms or more delay can workaround this issue.
Signed-off-by: Joakim Zhang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 3df8a157824b91b4a1ed793cd942d6df038a7b72
Author: Aric Cyr
Date: Tue May 25 15:33:51 2021 -0400
drm/amd/display: Fix crash during MPO + ODM combine mode recalculation
[ Upstream commit 665f28507a2a3d8d72ed9afa9a2b9b17fd43add1 ]
[Why]
When calculating recout width for an MPO plane on a mode that's using
ODM combine, driver can calculate a negative value, resulting in a
crash.
[How]
For negative widths, use zero such that validation will prune the
configuration correctly and disallow MPO.
Signed-off-by: Aric Cyr
Reviewed-by: Krunoslav Kovac
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit caef3b95ce82616b168c9ab287bce4bb6a7aa2f1
Author: Wesley Chalmers
Date: Wed Apr 28 18:38:54 2021 -0400
drm/amd/display: Fix off-by-one error in DML
[ Upstream commit e4e3678260e9734f6f41b4325aac0b171833a618 ]
[WHY]
For DCN30 and later, there is no data in DML arrays indexed by state at
index num\_states.
Signed-off-by: Wesley Chalmers
Reviewed-by: Dmytro Laktyushkin
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 6f88bc77bbc75b25df55d1da744812b018f6830a
Author: Wesley Chalmers
Date: Thu May 20 12:12:48 2021 -0400
drm/amd/display: Set DISPCLK\_MAX\_ERRDET\_CYCLES to 7
[ Upstream commit 3577e1678772ce3ede92af3a75b44a4b76f9b4ad ]
[WHY]
DISPCLK\_MAX\_ERRDET\_CYCLES must be 7 to prevent connection loss when
changing DENTIST\_DISPCLK\_WDIVIDER from 126 to 127 and back.
Signed-off-by: Wesley Chalmers
Reviewed-by: Dmytro Laktyushkin
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit db1ca5441e33273d37a2e3b9d90e7dc871447e83
Author: Vladimir Stempen
Date: Wed May 19 13:55:46 2021 -0400
drm/amd/display: Release MST resources on switch from MST to SST
[ Upstream commit 3f8518b60c10aa96f3efa38a967a0b4eb9211ac0 ]
[why]
When OS overrides training link training parameters
for MST device to SST mode, MST resources are not
released and leak of the resource may result crash and
incorrect MST discovery during following hot plugs.
[how]
Retaining sink object to be reused by SST link and
releasing MST resources.
Signed-off-by: Vladimir Stempen
Reviewed-by: Wenjing Liu
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 71e0e437e97b3312b6377d6079667586f51afaf8
Author: Roman Li
Date: Fri May 21 10:20:25 2021 -0400
drm/amd/display: Update scaling settings on modeset
[ Upstream commit c521fc316d12fb9ea7b7680e301d673bceda922e ]
[Why]
We update scaling settings when scaling mode has been changed.
However when changing mode from native resolution the scaling mode previously
set gets ignored.
[How]
Perform scaling settings update on modeset.
Signed-off-by: Roman Li
Reviewed-by: Nicholas Kazlauskas
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit dc9e10ea5bdd56bdb0631031adca5846ed6103d7
Author: Ilya Bakoulin
Date: Tue May 18 17:55:17 2021 -0400
drm/amd/display: Revert "Fix clock table filling logic"
[ Upstream commit ae88357c7966ec2a52cb1e70fd42f74a40c9dfcb ]
[Why]
This change was found to break some high-refresh modes. Reverting
to unblock mainline.
Signed-off-by: Ilya Bakoulin
Reviewed-by: Sung Lee
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit ef485944e718088f99fdc2a791efd4c88dd0ac9a
Author: Nikola Cornij
Date: Tue May 18 12:33:12 2021 -0400
drm/amd/display: Fix DCN 3.01 DSCCLK validation
[ Upstream commit 346cf627fb27c0fea63a041cedbaa4f31784e504 ]
[why]
DSCCLK validation is not necessary because DSCCLK is derrived from
DISPCLK, therefore if DISPCLK validation passes, DSCCLK is valid, too.
Doing DSCLK validation in addition to DISPCLK leads to modes being
wrongly rejected when DSCCLK was incorrectly set outside of DML.
[how]
Remove DSCCLK validation because it's implicitly validated under DISPCLK
Signed-off-by: Nikola Cornij
Reviewed-by: Dmytro Laktyushkin
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 18aa107512275a7bc467fb3229193d866653a772
Author: Yang Yingliang
Date: Mon Jun 7 23:02:59 2021 +0800
net: moxa: Use devm\_platform\_get\_and\_ioremap\_resource()
[ Upstream commit 35cba15a504bf4f585bb9d78f47b22b28a1a06b2 ]
Use devm\_platform\_get\_and\_ioremap\_resource() to simplify
code and avoid a null-ptr-deref by checking 'res' in it.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit c01540159ead3be3bbf0edbe23db0de04453b481
Author: Yang Yingliang
Date: Mon Jun 7 22:55:21 2021 +0800
net: micrel: check return value after calling platform\_get\_resource()
[ Upstream commit 20f1932e2282c58cb5ac59517585206cf5b385ae ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 373db5a9c8c4a934e89f077f1077bb74c37c1bd6
Author: Yang Yingliang
Date: Mon Jun 7 22:36:02 2021 +0800
net: mvpp2: check return value after calling platform\_get\_resource()
[ Upstream commit 0bb51a3a385790a4be20085494cf78f70dadf646 ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit cd9575caf7bdf5631328c082bba0c734cf9f87cf
Author: Yang Yingliang
Date: Mon Jun 7 21:38:37 2021 +0800
net: bcmgenet: check return value after calling platform\_get\_resource()
[ Upstream commit 74325bf0104573c6dfce42837139aeef3f34be76 ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Acked-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 43630cbcd7de3345d32fbe5bac1063e484a95286
Author: Yang Yingliang
Date: Sat Jun 5 10:31:48 2021 +0800
net: mscc: ocelot: check return value after calling platform\_get\_resource()
[ Upstream commit f1fe19c2cb3fdc92a614cf330ced1613f8f1a681 ]
It will cause null-ptr-deref if platform\_get\_resource() returns NULL,
we need check the return value.
Signed-off-by: Yang Yingliang
Reviewed-by: Vladimir Oltean
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit e8f03933f5a7a5dfcbaeb113e6fe530b4e3a4763
Author: Xianting Tian
Date: Sat Jun 5 11:31:00 2021 -0400
virtio\_net: Remove BUG() to avoid machine dead
[ Upstream commit 85eb1389458d134bdb75dad502cc026c3753a619 ]
We should not directly BUG() when there is hdr error, it is
better to output a print when such error happens. Currently,
the caller of xmit\_skb() already did it.
Signed-off-by: Xianting Tian
Reviewed-by: Leon Romanovsky
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 47cafc568c31e3d3179cc51cd2ca4a696adaddd3
Author: Paul M Stillwell Jr
Date: Wed Mar 31 14:17:06 2021 -0700
ice: fix clang warning regarding deadcode.DeadStores
[ Upstream commit 7e94090ae13e1ae5fe8bd3a9cd08136260bb7039 ]
clang generates deadcode.DeadStores warnings when a variable
is used to read a value, but then that value isn't used later
in the code. Fix this warning.
Signed-off-by: Paul M Stillwell Jr
Tested-by: Tony Brelinski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 63efeeb1274d44e3c490be3b68cc74de5d63ac79
Author: Liwei Song
Date: Mon Apr 19 17:31:06 2021 +0800
ice: set the value of global config lock timeout longer
[ Upstream commit fb3612840d4f587a0af9511a11d7989d1fa48206 ]
It may need hold Global Config Lock a longer time when download DDP
package file, extend the timeout value to 5000ms to ensure that
download can be finished before other AQ command got time to run,
this will fix the issue below when probe the device, 5000ms is a test
value that work with both Backplane and BreakoutCable NVM image:
ice 0000:f4:00.0: VSI 12 failed lan queue config, error ICE\_ERR\_CFG
ice 0000:f4:00.0: Failed to delete VSI 12 in FW - error: ICE\_ERR\_AQ\_TIMEOUT
ice 0000:f4:00.0: probe failed due to setup PF switch: -12
ice: probe of 0000:f4:00.0 failed with error -12
Signed-off-by: Liwei Song
Tested-by: Tony Brelinski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 22f5c64be9c790968d4f87a0c801fe8124fc1141
Author: Radim Pavlik
Date: Tue Jun 1 10:48:18 2021 +0000
pinctrl: mcp23s08: fix race condition in irq handler
[ Upstream commit 897120d41e7afd9da435cb00041a142aeeb53c07 ]
Checking value of MCP\_INTF in mcp23s08\_irq suggests that the handler may be
called even when there is no interrupt pending.
But the actual interrupt could happened between reading MCP\_INTF and MCP\_GPIO.
In this situation we got nothing from MCP\_INTF, but the event gets acknowledged
on the expander by reading MCP\_GPIO. This leads to losing events.
Fix the problem by not reading any register until we see something in MCP\_INTF.
The error was reproduced and fix tested on MCP23017.
Signed-off-by: Radim Pavlik
Link: https://lore.kernel.org/r/AM7PR06MB6769E1183F68DEBB252F665ABA3E9@AM7PR06MB6769.eurprd06.prod.outlook.com
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
commit 88e1357e4d0504c2e8159daeb5b205e8ca52120f
Author: Horatiu Vultur
Date: Fri Jun 4 12:37:47 2021 +0200
net: bridge: mrp: Update ring transitions.
[ Upstream commit fcb34635854a5a5814227628867ea914a9805384 ]
According to the standard IEC 62439-2, the number of transitions needs
to be counted for each transition 'between' ring state open and ring
state closed and not from open state to closed state.
Therefore fix this for both ring and interconnect ring.
Signed-off-by: Horatiu Vultur
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 03de5ab1dc405d53dca149427fa4eaaaea7ac783
Author: Damien Le Moal
Date: Wed May 26 06:24:53 2021 +0900
block: introduce BIO\_ZONE\_WRITE\_LOCKED bio flag
[ Upstream commit 9ffbbb435d8f566a0924ce4b5dc7fc1bceb6dbf8 ]
Introduce the BIO flag BIO\_ZONE\_WRITE\_LOCKED to indicate that a BIO owns
the write lock of the zone it is targeting. This is the counterpart of
the struct request flag RQF\_ZONE\_WRITE\_LOCKED.
This new BIO flag is reserved for now for zone write locking control
for device mapper targets exposing a zoned block device. Since in this
case, the lock flag must not be propagated to the struct request that
will be used to process the BIO, a BIO private flag is used rather than
changing the RQF\_ZONE\_WRITE\_LOCKED request flag into a common REQ\_XXX
flag that could be used for both BIO and request. This avoids conflicts
down the stack with the block IO scheduler zone write locking
(in mq-deadline).
Signed-off-by: Damien Le Moal
Reviewed-by: Christoph Hellwig
Reviewed-by: Hannes Reinecke
Reviewed-by: Chaitanya Kulkarni
Reviewed-by: Himanshu Madhani
Acked-by: Jens Axboe
Signed-off-by: Mike Snitzer
Signed-off-by: Sasha Levin
commit 4068cb7e11131009527f6f134df098b1357d8748
Author: Damien Le Moal
Date: Wed May 26 06:24:54 2021 +0900
dm: Fix dm\_accept\_partial\_bio() relative to zone management commands
[ Upstream commit 6842d264aa5205da338b6dcc6acfa2a6732558f1 ]
Fix dm\_accept\_partial\_bio() to actually check that zone management
commands are not passed as explained in the function documentation
comment. Also, since a zone append operation cannot be split, add
REQ\_OP\_ZONE\_APPEND as a forbidden command.
White lines are added around the group of BUG\_ON() calls to make the
code more legible.
Signed-off-by: Damien Le Moal
Signed-off-by: Mike Snitzer
Signed-off-by: Sasha Levin
commit 0a8a10887b6537e1c6b534a310888fb1213a0708
Author: Mikulas Patocka
Date: Wed May 26 10:29:45 2021 -0400
dm writecache: don't split bios when overwriting contiguous cache content
[ Upstream commit ee50cc19d80e9b9a8283d1fb517a778faf2f6899 ]
If dm-writecache overwrites existing cached data, it splits the
incoming bio into many block-sized bios. The I/O scheduler does merge
these bios into one large request but this needless splitting and
merging causes performance degradation.
Fix this by avoiding bio splitting if the cache target area that is
being overwritten is contiguous.
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Sasha Levin
commit 3c8afdbb62ee7b490b711d62215e1892933e13e1
Author: Joe Thornber
Date: Tue Apr 13 09:03:49 2021 +0100
dm space maps: don't reset space map allocation cursor when committing
[ Upstream commit 5faafc77f7de69147d1e818026b9a0cbf036a7b2 ]
Current commit code resets the place where the search for free blocks
will begin back to the start of the metadata device. There are a couple
of repercussions to this:
- The first allocation after the commit is likely to take longer than
normal as it searches for a free block in an area that is likely to
have very few free blocks (if any).
- Any free blocks it finds will have been recently freed. Reusing them
means we have fewer old copies of the metadata to aid recovery from
hardware error.
Fix these issues by leaving the cursor alone, only resetting when the
search hits the end of the metadata device.
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Sasha Levin
commit c5cc91094e6a4a5363339e0a038e0038e711420f
Author: Jiapeng Chong
Date: Tue Jun 1 19:07:49 2021 +0800
RDMA/cxgb4: Fix missing error code in create\_qp()
[ Upstream commit aeb27bb76ad8197eb47890b1ff470d5faf8ec9a5 ]
The error code is missing in this code scenario so 0 will be returned. Add
the error code '-EINVAL' to the return value 'ret'.
Eliminates the follow smatch warning:
drivers/infiniband/hw/cxgb4/qp.c:298 create\_qp() warn: missing error code 'ret'.
Link: https://lore.kernel.org/r/1622545669-20625-1-git-send-email-jiapeng.chong@linux.alibaba.com
Reported-by: Abaci Robot
Signed-off-by: Jiapeng Chong
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
commit 957d6d796e73d2667741a3180741256e60b83d00
Author: Andreas Roeseler
Date: Thu Jun 3 16:22:11 2021 -0500
icmp: fix lib conflict with trinity
[ Upstream commit e32ea44c7ae476f4c90e35ab0a29dc8ff082bc11 ]
Including  and  in the dependencies breaks
compilation of trinity due to multiple definitions.  is only
used in  to provide the definition of the struct in\_addr,
but this can be substituted out by using the datatype \_\_be32.
Signed-off-by: Andreas Roeseler
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit e0b8274cda127b1f61f80ea5f7c22b698c49d043
Author: Yuchung Cheng
Date: Wed Jun 2 17:51:21 2021 -0700
net: tcp better handling of reordering then loss cases
[ Upstream commit a29cb6914681a55667436a9eb7a42e28da8cf387 ]
This patch aims to improve the situation when reordering and loss are
ocurring in the same flight of packets.
Previously the reordering would first induce a spurious recovery, then
the subsequent ACK may undo the cwnd (based on the timestamps e.g.).
However the current loss recovery does not proceed to invoke
RACK to install a reordering timer. If some packets are also lost, this
may lead to a long RTO-based recovery. An example is
https://groups.google.com/g/bbr-dev/c/OFHADvJbTEI
The solution is to after reverting the recovery, always invoke RACK
to either mount the RACK timer to fast retransmit after the reordering
window, or restarts the recovery if new loss is identified. Hence
it is possible the sender may go from Recovery to Disorder/Open to
Recovery again in one ACK.
Reported-by: mingkun bian
Signed-off-by: Yuchung Cheng
Signed-off-by: Neal Cardwell
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit b01c274e3a3ab423bcff87f872371715adf22ebd
Author: Yang Yingliang
Date: Tue May 18 12:42:47 2021 +0800
clk: tegra: tegra124-emc: Fix clock imbalance in emc\_set\_timing()
[ Upstream commit f13570e7e830ca4fbf4869015af8492b8918445e ]
After calling clk\_prepare\_enable(), clk\_disable\_unprepare() needs
be called when prepare\_timing\_change() failed.
Reported-by: Hulk Robot
Signed-off-by: Yang Yingliang
Signed-off-by: Thierry Reding
Signed-off-by: Sasha Levin
commit 3da33bf6aaffdc48d3fd725fcf4ca19e289083df
Author: Jiansong Chen
Date: Thu May 13 10:56:50 2021 +0800
drm/amdgpu: remove unsafe optimization to drop preamble ib
[ Upstream commit 7d9c70d23550eb86a1bec1954ccaa8d6ec3a3328 ]
Take the situation with gfxoff, the optimization may cause
corrupt CE ram contents. In addition emit\_cntxcntl callback
has similar optimization which firmware can handle properly
even for power feature.
Signed-off-by: Jiansong Chen
Reviewed-by: Hawking Zhang
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3b2b93a485fb7a970bc8b5daef16f4cf579d172f
Author: Kees Cook
Date: Fri May 28 10:53:54 2021 -0700
drm/amd/display: Avoid HDCP over-read and corruption
[ Upstream commit 06888d571b513cbfc0b41949948def6cb81021b2 ]
Instead of reading the desired 5 bytes of the actual target field,
the code was reading 8. This could result in a corrupted value if the
trailing 3 bytes were non-zero, so instead use an appropriately sized
and zero-initialized bounce buffer, and read only 5 bytes before casting
to u64.
Signed-off-by: Kees Cook
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 060a3b127d9ed104a0f3e20255926af9ff8370fa
Author: Kevin Wang
Date: Mon May 31 17:29:11 2021 +0800
drm/amdgpu: fix sdma firmware version error in sriov
[ Upstream commit 2b8f731849800e3948763ccaff31cceac526789b ]
Re-adjust the function return order to avoid empty sdma version in the
sriov environment. (read amdgpu\_firmware\_info)
Signed-off-by: Kevin Wang
Reviewed-by: Stanley.Yang
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3e7b75192e1500215726a2ab35f1b578b1c19840
Author: Shiwu Zhang
Date: Mon May 24 14:30:21 2021 +0800
drm/amdgpu: fix metadata\_size for ubo ioctl queries
[ Upstream commit eba98523724be7ad3539f2c975de1527e0c99dd6 ]
Although the kfd\_ioctl\_get\_dmabuf\_info() still fail it will indicate
the caller right metadat\_size useful for the same kfd ioctl next time.
Signed-off-by: Shiwu Zhang
Reviewed-by: Nirmoy Das
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 7c77db5a26db6b6399cdefe34ba4bffddeeda244
Author: Paul Cercueil
Date: Sun May 30 18:17:59 2021 +0100
MIPS: ingenic: Select CPU\_SUPPORTS\_CPUFREQ && MIPS\_EXTERNAL\_TIMER
[ Upstream commit eb3849370ae32b571e1f9a63ba52c61adeaf88f7 ]
The clock driving the XBurst CPUs in Ingenic SoCs is integer divided
from the main PLL. As such, it is possible to control the frequency of
the CPU, either by changing the divider, or by changing the rate of the
main PLL.
The XBurst CPUs also lack the CP0 timer; the TCU, a separate piece of
hardware in the SoC, provides this functionality.
Signed-off-by: Paul Cercueil
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 181bc6b98b109cacd11f9970fef0668532889877
Author: Paul Cercueil
Date: Sun May 30 18:17:57 2021 +0100
MIPS: cpu-probe: Fix FPU detection on Ingenic JZ4760(B)
[ Upstream commit fc52f92a653215fbd6bc522ac5311857b335e589 ]
Ingenic JZ4760 and JZ4760B do have a FPU, but the config registers don't
report it. Force the FPU detection in case the processor ID match the
JZ4760(B) one.
Signed-off-by: Paul Cercueil
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 8853d2ce4e9e96c7b2a9908f752ab2253c99c6ab
Author: Willy Tarreau
Date: Sat May 29 13:07:46 2021 +0200
ipv6: use prandom\_u32() for ID generation
[ Upstream commit 62f20e068ccc50d6ab66fdb72ba90da2b9418c99 ]
This is a complement to commit aa6dd211e4b1 ("inet: use bigger hash
table for IP ID generation"), but focusing on some specific aspects
of IPv6.
Contary to IPv4, IPv6 only uses packet IDs with fragments, and with a
minimum MTU of 1280, it's much less easy to force a remote peer to
produce many fragments to explore its ID sequence. In addition packet
IDs are 32-bit in IPv6, which further complicates their analysis. On
the other hand, it is often easier to choose among plenty of possible
source addresses and partially work around the bigger hash table the
commit above permits, which leaves IPv6 partially exposed to some
possibilities of remote analysis at the risk of weakening some
protocols like DNS if some IDs can be predicted with a good enough
probability.
Given the wide range of permitted IDs, the risk of collision is extremely
low so there's no need to rely on the positive increment algorithm that
is shared with the IPv4 code via ip\_idents\_reserve(). We have a fast
PRNG, so let's simply call prandom\_u32() and be done with it.
Performance measurements at 10 Gbps couldn't show any difference with
the previous code, even when using a single core, because due to the
large fragments, we're limited to only ~930 kpps at 10 Gbps and the cost
of the random generation is completely offset by other operations and by
the network transfer time. In addition, this change removes the need to
update a shared entry in the idents table so it may even end up being
slightly faster on large scale systems where this matters.
The risk of at least one collision here is about 1/80 million among
10 IDs, 1/850k among 100 IDs, and still only 1/8.5k among 1000 IDs,
which remains very low compared to IPv4 where all IDs are reused
every 4 to 80ms on a 10 Gbps flow depending on packet sizes.
Reported-by: Amit Klein
Signed-off-by: Willy Tarreau
Reviewed-by: Eric Dumazet
Link: https://lore.kernel.org/r/20210529110746.6796-1-w@1wt.eu
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit ba710baa1cc1b17a0483f7befe03e696efd17292
Author: Xie Yongji
Date: Mon May 31 21:58:52 2021 +0800
virtio-net: Add validation for used length
[ Upstream commit ad993a95c508417acdeb15244109e009e50d8758 ]
This adds validation for used length (might come
from an untrusted device) to avoid data corruption
or loss.
Signed-off-by: Xie Yongji
Acked-by: Jason Wang
Link: https://lore.kernel.org/r/20210531135852.113-1-xieyongji@bytedance.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 8d7221a987416e619af636e32fef946681cf1f02
Author: Yu Kuai
Date: Mon May 31 21:56:22 2021 +0800
drm: bridge: cdns-mhdp8546: Fix PM reference leak in
[ Upstream commit f674555ee5444c8987dfea0922f1cf6bf0c12847 ]
pm\_runtime\_get\_sync will increment pm usage counter even it failed.
Forgetting to putting operation will result in reference leak here.
Fix it by replacing it with pm\_runtime\_resume\_and\_get to keep usage
counter balanced.
Reported-by: Hulk Robot
Signed-off-by: Yu Kuai
Reviewed-by: Robert Foss
Signed-off-by: Robert Foss
Link: https://patchwork.freedesktop.org/patch/msgid/20210531135622.3348252-1-yukuai3@huawei.com
Signed-off-by: Sasha Levin
commit 4dbd10b868b69e300e203513c2f57591f26e6551
Author: Dmitry Osipenko
Date: Sun May 16 19:30:35 2021 +0300
clk: tegra: Ensure that PLLU configuration is applied properly
[ Upstream commit a7196048cd5168096c2c4f44a3939d7a6dcd06b9 ]
The PLLU (USB) consists of the PLL configuration itself and configuration
of the PLLU outputs. The PLLU programming is inconsistent on T30 vs T114,
where T114 immediately bails out if PLLU is enabled and T30 re-enables
a potentially already enabled PLL (left after bootloader) and then fully
reprograms it, which could be unsafe to do. The correct way should be to
skip enabling of the PLL if it's already enabled and then apply
configuration to the outputs. This patch doesn't fix any known problems,
it's a minor improvement.
Acked-by: Thierry Reding
Signed-off-by: Dmitry Osipenko
Signed-off-by: Thierry Reding
Signed-off-by: Sasha Levin
commit 91789532c24cf7ebc3b2a154ced44e8d2ca85b9b
Author: Dmitry Osipenko
Date: Sun May 16 19:30:34 2021 +0300
clk: tegra: Fix refcounting of gate clocks
[ Upstream commit c592c8a28f5821e880ac6675781cd8a151b0737c ]
The refcounting of the gate clocks has a bug causing the enable\_refcnt
to underflow when unused clocks are disabled. This happens because clk
provider erroneously bumps the refcount if clock is enabled at a boot
time, which it shouldn't be doing, and it does this only for the gate
clocks, while peripheral clocks are using the same gate ops and the
peripheral clocks are missing the initial bump. Hence the refcount of
the peripheral clocks is 0 when unused clocks are disabled and then the
counter is decremented further by the gate ops, causing the integer
underflow.
Fix this problem by removing the erroneous bump and by implementing the
disable\_unused() callback, which disables the unused gates properly.
The visible effect of the bug is such that the unused clocks are never
gated if a loaded kernel module grabs the unused clocks and starts to use
them. In practice this shouldn't cause any real problems for the drivers
and boards supported by the kernel today.
Acked-by: Thierry Reding
Signed-off-by: Dmitry Osipenko
Signed-off-by: Thierry Reding
Signed-off-by: Sasha Levin
commit 9bce65a588d9d3b5fe40db4f415c6afdc0568e0f
Author: Thierry Reding
Date: Thu May 27 20:15:46 2021 +0200
drm/tegra: hub: Fix YUV support
[ Upstream commit e16efff4e5f490ce34a8c60d9ae7297dca5eb616 ]
The driver currently exposes several YUV formats but fails to properly
program all the registers needed to display such formats. Add the right
programming sequences so that overlay windows can be used to accelerate
color format conversions in multimedia playback use-cases.
Signed-off-by: Thierry Reding
Signed-off-by: Sasha Levin
commit 86e0ca4c6aee48ac7854affa258592b304461d9d
Author: Gioh Kim
Date: Fri May 28 13:30:03 2021 +0200
RDMA/rtrs: Change MAX\_SESS\_QUEUE\_DEPTH
[ Upstream commit 3a98ea7041b7d18ac356da64823c2ba2f8391b3e ]
Max IB immediate data size is 2^28 (MAX\_IMM\_PAYL\_BITS)
and the minimum chunk size is 4096 (2^12).
Therefore the maximum sess\_queue\_depth is 65536 (2^16).
Link: https://lore.kernel.org/r/20210528113018.52290-6-jinpu.wang@ionos.com
Signed-off-by: Gioh Kim
Signed-off-by: Jack Wang
Reported-by: kernel test robot
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
commit f2aad1098936c4abd5a68f7839d57020563d886e
Author: Vladimir Oltean
Date: Thu May 27 18:59:59 2021 +0300
net: stmmac: the XPCS obscures a potential "PHY not found" error
[ Upstream commit 4751d2aa321f2828d8c5d2f7ce4ed18a01e47f46 ]
stmmac\_mdio\_register() has logic to search for PHYs on the MDIO bus and
assign them IRQ lines, as well as to set priv->plat->phy\_addr.
If no PHY is found, the "found" variable remains set to 0 and the
function errors out.
After the introduction of commit f213bbe8a9d6 ("net: stmmac: Integrate
it with DesignWare XPCS"), the "found" variable was immediately reused
for searching for a PCS on the same MDIO bus.
This can result in 2 types of potential problems (none of them seems to
be seen on the only Intel system that sets has\_xpcs = true, otherwise it
would have been reported):
1. If a PCS is found but a PHY is not, then the code happily exits with
no error. One might say "yes, but this is not possible, because
of\_mdiobus\_register will probe a PHY for all MDIO addresses,
including for the XPCS, so if an XPCS exists, then a PHY certainly
exists too". Well, that is not true, see intel\_mgbe\_common\_data():
/\* Ensure mdio bus scan skips intel serdes and pcs-xpcs \*/
plat->mdio\_bus\_data->phy\_mask = 1 << INTEL\_MGBE\_ADHOC\_ADDR;
plat->mdio\_bus\_data->phy\_mask |= 1 << INTEL\_MGBE\_XPCS\_ADDR;
2. A PHY is found but an MDIO device with the XPCS PHY ID isn't, and in
that case, the error message will be "No PHY found". Confusing.
Signed-off-by: Vladimir Oltean
Link: https://lore.kernel.org/r/20210527155959.3270478-1-olteanv@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 7366ccbd327cc2030b8957df5c4b8a1ac0e1542f
Author: Alex Bee
Date: Fri May 28 15:05:52 2021 +0200
drm: rockchip: add missing registers for RK3066
[ Upstream commit 742203cd56d150eb7884eb45abb7d9dbc2bdbf04 ]
Add dither\_up, dsp\_lut\_en and data\_blank registers to enable their
respective functionality for RK3066's VOP.
While at that also fix .rb\_swap and .format registers for all windows,
which have to be set though RK3066\_SYS\_CTRL1 register.
Also remove .scl from win1: Scaling is only supported on the primary
plane.
Signed-off-by: Alex Bee
Signed-off-by: Heiko Stuebner
Link: https://patchwork.freedesktop.org/patch/msgid/20210528130554.72191-4-knaerzche@gmail.com
Signed-off-by: Sasha Levin
commit 20f88209526edf0de3fd9a47bdab0a2c2cb0a57a
Author: Alex Bee
Date: Fri May 28 15:05:51 2021 +0200
drm: rockchip: add missing registers for RK3188
[ Upstream commit ab64b448a175b8a5a4bd323b8f74758c2574482c ]
Add dither\_up, dsp\_lut\_en and data\_blank registers to enable their
respective functionality for RK3188's VOP.
While at that also fix .dsp\_blank register which is (only) set with
BIT24 (same as RK3066)
Signed-off-by: Alex Bee
Signed-off-by: Heiko Stuebner
Link: https://patchwork.freedesktop.org/patch/msgid/20210528130554.72191-3-knaerzche@gmail.com
Signed-off-by: Sasha Levin
commit c77ad9cbf0c70d182d22c26c481958f98dc717b4
Author: Eli Cohen
Date: Mon May 3 14:39:58 2021 +0300
net/mlx5: Fix lag port remapping logic
[ Upstream commit 8613641063617c1dfc731b403b3ee4935ef15f87 ]
Fix the logic so that if both ports netdevices are enabled or disabled,
use the trivial mapping without swapping.
If only one of the netdevice's tx is enabled, use it to remap traffic to
that port.
Signed-off-by: Eli Cohen
Signed-off-by: Saeed Mahameed
Signed-off-by: Sasha Levin
commit f39de3cc0ff799038aef2987fc70207eccb95289
Author: Huy Nguyen
Date: Tue Dec 15 10:58:54 2020 -0600
net/mlx5e: IPsec/rep\_tc: Fix rep\_tc\_update\_skb drops IPsec packet
[ Upstream commit c07274ab1ab2c38fb128e32643c22c89cb319384 ]
rep\_tc copy REG\_C1 to REG\_B. IPsec crypto utilizes the whole REG\_B
register with BIT31 as IPsec marker. rep\_tc\_update\_skb drops
IPsec because it thought REG\_B contains bad value.
In previous patch, BIT 31 of REG\_C1 is reserved for IPsec.
Skip the rep\_tc\_update\_skb if BIT31 of REG\_B is set.
Signed-off-by: Huy Nguyen
Signed-off-by: Raed Salem
Signed-off-by: Saeed Mahameed
Signed-off-by: Sasha Levin
commit ba2d94789a1f2ee146276dc3dd00f36d348387ad
Author: Alex Deucher
Date: Wed May 26 23:47:02 2021 -0400
drm/amdgpu/swsmu/aldebaran: fix check in is\_dpm\_running
[ Upstream commit dd1d82c04e111b5a864638ede8965db2fe6d8653 ]
If smu\_cmn\_get\_enabled\_mask() fails, return false to be
consistent with other asics.
Reviewed-by: Lijo Lazar
Signed-off-by: Alex Deucher
Cc: Lee Jones
Reviewed-by: Lee Jones
Signed-off-by: Sasha Levin
commit 93ed1b0210ea130d61d13b0b95297a7d53e08110
Author: Dmytro Laktyushkin
Date: Mon May 10 10:19:18 2021 -0400
drm/amd/display: fix odm scaling
[ Upstream commit 6566cae7aef30da8833f1fa0eb854baf33b96676 ]
There are two issues with scaling calculations, odm recout
calculation and matching viewport to actual recout.
This change fixes both issues. Odm recout calculation via
special casing and viewport matching issue by reworking
the viewport calcualtion to use scaling ratios and recout
to derrive the required offset and size.
Signed-off-by: Dmytro Laktyushkin
Reviewed-by: Jun Lei
Acked-by: Qingqing Zhuo
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 669f0f6f83d53fedfe1ad35c571e183a3a8a8416
Author: Kuninori Morimoto
Date: Thu May 27 13:36:38 2021 +0900
clk: renesas: r8a77995: Add ZA2 clock
[ Upstream commit 790c06cc5df263cdaff748670cc65958c81b0951 ]
R-Car D3 ZA2 clock is from PLL0D3 or S0,
and it can be controlled by ZA2CKCR.
It is needed for R-Car Sound, but is not used so far.
Using default settings is very enough at this point.
This patch adds it by DEF\_FIXED().
Signed-off-by: Kuninori Morimoto
Link: https://lore.kernel.org/r/87pmxclrmy.wl-kuninori.morimoto.gx@renesas.com
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Sasha Levin
commit 3831144772502d86d8c22b3f1390a19bb462c0e0
Author: Zou Wei
Date: Mon May 24 15:21:02 2021 +0800
drm/bridge: cdns: Fix PM reference leak in cdns\_dsi\_transfer()
[ Upstream commit 33f90f27e1c5ccd648d3e78a1c28be9ee8791cf1 ]
pm\_runtime\_get\_sync will increment pm usage counter even it failed.
Forgetting to putting operation will result in reference leak here.
Fix it by replacing it with pm\_runtime\_resume\_and\_get to keep usage
counter balanced.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Reviewed-by: Robert Foss
Signed-off-by: Robert Foss
Link: https://patchwork.freedesktop.org/patch/msgid/1621840862-106024-1-git-send-email-zou\_wei@huawei.com
Signed-off-by: Sasha Levin
commit 4432f3694ee53a8091467d7949ca96eb9a51267a
Author: Jesse Brandeburg
Date: Thu Mar 25 17:38:29 2021 -0700
igb: fix assignment on big endian machines
[ Upstream commit b514958dd1a3bd57638b0e63b8e5152b1960e6aa ]
The igb driver was trying hard to be sparse correct, but somehow
ended up converting a variable into little endian order and then
tries to OR something with it.
A much plainer way of doing things is to leave all variables and
OR operations in CPU (non-endian) mode, and then convert to
little endian only once, which is what this change does.
This probably fixes a bug that might have been seen only on
big endian systems.
Signed-off-by: Jesse Brandeburg
Tested-by: Dave Switzer
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 003d37fa8c70d8067d73ccad86241e839919fd9b
Author: Jesse Brandeburg
Date: Thu Mar 25 17:38:28 2021 -0700
igb: handle vlan types with checker enabled
[ Upstream commit c7cbfb028b95360403d579c47aaaeef1ff140964 ]
The sparse build (C=2) finds some issues with how the driver
dealt with the (very difficult) hardware that in some generations
uses little-endian, and in others uses big endian, for the VLAN
field. The code as written picks \_\_le16 as a type and for some
hardware revisions we override it to \_\_be16 as done in this
patch. This impacted the VF driver as well so fix it there too.
Also change the vlan\_tci assignment to override the sparse
warning without changing functionality.
Signed-off-by: Jesse Brandeburg
Tested-by: Dave Switzer
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit dd658e324c34a5c760a75b52f02181318003c18b
Author: Jesse Brandeburg
Date: Thu Mar 25 17:38:24 2021 -0700
e100: handle eeprom as little endian
[ Upstream commit d4ef55288aa2e1b76033717242728ac98ddc4721 ]
Sparse tool was warning on some implicit conversions from
little endian data read from the EEPROM on the e100 cards.
Fix these by being explicit about the conversions using
le16\_to\_cpu().
Signed-off-by: Jesse Brandeburg
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 38d70d239c7c9a51f0bde26608ac77ff0356d6df
Author: Zou Wei
Date: Mon May 24 15:20:54 2021 +0800
drm/vc4: hdmi: Fix PM reference leak in vc4\_hdmi\_encoder\_pre\_crtc\_co()
[ Upstream commit 5e4322a8b266bc9f5ee7ea4895f661c01dbd7cb3 ]
pm\_runtime\_get\_sync will increment pm usage counter even it failed.
Forgetting to putting operation will result in reference leak here.
Fix it by replacing it with pm\_runtime\_resume\_and\_get to keep usage
counter balanced.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/1621840854-105978-1-git-send-email-zou\_wei@huawei.com
Signed-off-by: Sasha Levin
commit 62f616078e9f6338a8fb08c4f8f3c48609a12da8
Author: Mateusz Kwiatkowski
Date: Thu May 20 17:03:41 2021 +0200
drm/vc4: Fix clock source for VEC PixelValve on BCM2711
[ Upstream commit fc7a8abcee2225d6279ff785d33e24d70c738c6e ]
On the BCM2711 (Raspberry Pi 4), the VEC is actually connected to
output 2 of pixelvalve3.
NOTE: This contradicts the Broadcom docs, but has been empirically
tested and confirmed by Raspberry Pi firmware devs.
Signed-off-by: Mateusz Kwiatkowski
Signed-off-by: Maxime Ripard
Reviewed-by: Dave Stevenson
Link: https://patchwork.freedesktop.org/patch/msgid/20210520150344.273900-2-maxime@cerno.tech
Signed-off-by: Sasha Levin
commit 6d0f4887e7429ac4a56dfa2844d72b67fe9a70c8
Author: Feifei Xu
Date: Thu May 20 17:46:03 2021 +0800
drm/amd/pm: fix return value in aldebaran\_set\_mp1\_state()
[ Upstream commit 5051cb794ac5d92154e186d87cdc12cba613f4f6 ]
For default cases,we should return 0. Otherwise resume will
abort because of the wrong return value.
Signed-off-by: Feifei Xu
Reviewed-by: Lijo Lazar
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 8722275b41d5127048e1422a8a1b6370b4878533
Author: YueHaibing
Date: Wed May 19 10:47:04 2021 +0800
net: xilinx\_emaclite: Do not print real IOMEM pointer
[ Upstream commit d0d62baa7f505bd4c59cd169692ff07ec49dde37 ]
Printing kernel pointers is discouraged because they might leak kernel
memory layout. This fixes smatch warning:
drivers/net/ethernet/xilinx/xilinx\_emaclite.c:1191 xemaclite\_of\_probe() warn:
argument 4 to %08lX specifier is cast from pointer
Signed-off-by: YueHaibing
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 5150877e4d99f85057a458daac7cd7c01005d5c6
Author: Arturo Giusti
Date: Tue May 18 12:34:57 2021 +0200
udf: Fix NULL pointer dereference in udf\_symlink function
[ Upstream commit fa236c2b2d4436d9f19ee4e5d5924e90ffd7bb43 ]
In function udf\_symlink, epos.bh is assigned with the value returned
by udf\_tgetblk. The function udf\_tgetblk is defined in udf/misc.c
and returns the value of sb\_getblk function that could be NULL.
Then, epos.bh is used without any check, causing a possible
NULL pointer dereference when sb\_getblk fails.
This fix adds a check to validate the value of epos.bh.
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=213083
Signed-off-by: Arturo Giusti
Signed-off-by: Jan Kara
Signed-off-by: Sasha Levin
commit 50d7e03ad487cc45fc85164a299b945a41756ac0
Author: Andrey Grodzovsky
Date: Wed May 19 10:14:07 2021 -0400
drm/sched: Avoid data corruptions
[ Upstream commit 0b10ab80695d61422337ede6ff496552d8ace99d ]
Wait for all dependencies of a job to complete before
killing it to avoid data corruptions.
Signed-off-by: Andrey Grodzovsky
Reviewed-by: Christian König
Link: https://patchwork.freedesktop.org/patch/msgid/20210519141407.88444-1-andrey.grodzovsky@amd.com
Signed-off-by: Sasha Levin
commit baf802cd27cd95fb027511b8bf5d1fd6fdf80907
Author: Andrey Grodzovsky
Date: Wed May 12 10:26:45 2021 -0400
drm/scheduler: Fix hang when sched\_entity released
[ Upstream commit c61cdbdbffc169dc7f1e6fe94dfffaf574fe672a ]
Problem: If scheduler is already stopped by the time sched\_entity
is released and entity's job\_queue not empty I encountred
a hang in drm\_sched\_entity\_flush. This is because drm\_sched\_entity\_is\_idle
never becomes false.
Fix: In drm\_sched\_fini detach all sched\_entities from the
scheduler's run queues. This will satisfy drm\_sched\_entity\_is\_idle.
Also wakeup all those processes stuck in sched\_entity flushing
as the scheduler main thread which wakes them up is stopped by now.
v2:
Reverse order of drm\_sched\_rq\_remove\_entity and marking
s\_entity as stopped to prevent reinserion back to rq due
to race.
v3:
Drop drm\_sched\_rq\_remove\_entity, only modify entity->stopped
and check for it in drm\_sched\_entity\_is\_idle
Signed-off-by: Andrey Grodzovsky
Reviewed-by: Christian König
Link: https://patchwork.freedesktop.org/patch/msgid/20210512142648.666476-14-andrey.grodzovsky@amd.com
Signed-off-by: Sasha Levin
commit cef0b8eab2310b51589b41ea839245dce6c95ca7
Author: Bixuan Cui
Date: Sat May 8 11:15:02 2021 +0800
pinctrl: equilibrium: Add missing MODULE\_DEVICE\_TABLE
[ Upstream commit d7f444499d6faf9a6ae3b27ec094109528d2b9a7 ]
This patch adds missing MODULE\_DEVICE\_TABLE definition which generates
correct modalias for automatic loading of this driver when it is built
as an external module.
Reported-by: Hulk Robot
Signed-off-by: Bixuan Cui
Link: https://lore.kernel.org/r/20210508031502.53637-1-cuibixuan@huawei.com
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
commit 248fc2633293a9eb9c1686222170b52e76c80baa
Author: Wei Yongjun
Date: Wed May 19 14:16:27 2021 +0000
net: ethernet: ixp4xx: Fix return value check in ixp4xx\_eth\_probe()
[ Upstream commit 20e76d3d044d936998617f8acd7e77bebd9ca703 ]
In case of error, the function mdiobus\_get\_phy() returns NULL
pointer not ERR\_PTR(). The IS\_ERR() test in the return value
check should be replaced with NULL test.
Reported-by: Hulk Robot
Signed-off-by: Wei Yongjun
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 7b777772879c88fe27984d3677c90a25feb3a2f2
Author: Davide Caratti
Date: Wed May 19 15:17:21 2021 +0200
net/sched: cls\_api: increase max\_reclassify\_loop
[ Upstream commit 05ff8435e50569a0a6b95e5ceaea43696e8827ab ]
modern userspace applications, like OVN, can configure the TC datapath to
"recirculate" packets several times. If more than 4 "recirculation" rules
are configured, packets can be dropped by \_\_tcf\_classify().
Changing the maximum number of reclassifications (from 4 to 16) should be
sufficient to prevent drops in most use cases, and guard against loops at
the same time.
Signed-off-by: Davide Caratti
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 0f20ce74aff8de015608cb867aa06367315ae8d4
Author: Vladimir Oltean
Date: Tue May 18 20:49:24 2021 +0300
net: mdio: provide shim implementation of devm\_of\_mdiobus\_register
[ Upstream commit 86544c3de6a2185409c5a3d02f674ea223a14217 ]
Similar to the way in which of\_mdiobus\_register() has a fallback to the
non-DT based mdiobus\_register() when CONFIG\_OF is not set, we can create
a shim for the device-managed devm\_of\_mdiobus\_register() which calls
devm\_mdiobus\_register() and discards the struct device\_node \*.
In particular, this solves a build issue with the qca8k DSA driver which
uses devm\_of\_mdiobus\_register and can be compiled without CONFIG\_OF.
Reported-by: Randy Dunlap
Signed-off-by: Vladimir Oltean
Acked-by: Randy Dunlap  # build-tested
Reviewed-by: Andrew Lunn
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 5cb3b25c7f5318199767f071b780ca56a8a4141e
Author: Xie Yongji
Date: Mon May 17 16:49:12 2021 +0800
drm/virtio: Fix double free on probe failure
[ Upstream commit cec7f1774605a5ef47c134af62afe7c75c30b0ee ]
The virtio\_gpu\_init() will free vgdev and vgdev->vbufs on failure.
But such failure will be caught by virtio\_gpu\_probe() and then
virtio\_gpu\_release() will be called to do some cleanup which
will free vgdev and vgdev->vbufs again. So let's set dev->dev\_private
to NULL to avoid double free.
Signed-off-by: Xie Yongji
Link: http://patchwork.freedesktop.org/patch/msgid/20210517084913.403-2-xieyongji@bytedance.com
Signed-off-by: Gerd Hoffmann
Signed-off-by: Sasha Levin
commit 5ac1c5fcffd0cf61718cfa4459847b948f9c6978
Author: Pavel Skripkin
Date: Mon May 17 15:15:45 2021 +0300
reiserfs: add check for invalid 1st journal block
[ Upstream commit a149127be52fa7eaf5b3681a0317a2bbb772d5a9 ]
syzbot reported divide error in reiserfs.
The problem was in incorrect journal 1st block.
Syzbot's reproducer manualy generated wrong superblock
with incorrect 1st block. In journal\_init() wasn't
any checks about this particular case.
For example, if 1st journal block is before superblock
1st block, it can cause zeroing important superblock members
in do\_journal\_end().
Link: https://lore.kernel.org/r/20210517121545.29645-1-paskripkin@gmail.com
Reported-by: syzbot+0ba9909df31c6a36974d@syzkaller.appspotmail.com
Signed-off-by: Pavel Skripkin
Signed-off-by: Jan Kara
Signed-off-by: Sasha Levin
commit b8f63c943700e2f77909fe628b83583f99d9e9d2
Author: Zou Wei
Date: Wed May 12 14:45:55 2021 +0800
drm/bridge: lt9611: Add missing MODULE\_DEVICE\_TABLE
[ Upstream commit 8d0b1fe81e18eb66a2d4406386760795fe0d77d9 ]
This patch adds missing MODULE\_DEVICE\_TABLE definition which generates
correct modalias for automatic loading of this driver when it is built
as an external module.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Reviewed-by: Robert Foss
Signed-off-by: Robert Foss
Link: https://patchwork.freedesktop.org/patch/msgid/1620801955-19188-1-git-send-email-zou\_wei@huawei.com
Signed-off-by: Sasha Levin
commit 3828625dd18d1fb2fba62015791ad0c6ddb9b402
Author: Ansuel Smith
Date: Fri May 14 23:03:50 2021 +0200
net: mdio: ipq8064: add regmap config to disable REGCACHE
[ Upstream commit b097bea10215315e8ee17f88b4c1bbb521b1878c ]
mdio drivers should not use REGCHACHE. Also disable locking since it's
handled by the mdio users and regmap is always accessed atomically.
Signed-off-by: Ansuel Smith
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 8f5cc4dc1e2a2f9e77bd8bee66e7940c2222adae
Author: Nicolas Boichat
Date: Wed Apr 21 13:28:54 2021 +0800
drm/panfrost: devfreq: Disable devfreq when num\_supplies > 1
[ Upstream commit 09da3191827f2fd326205fb58881838e6ea36fb7 ]
GPUs with more than a single regulator (e.g. G72 on MT8183) will
require platform-specific handling for devfreq, for 2 reasons:
1. The opp core (drivers/opp/core.c:\_generic\_set\_opp\_regulator)
does not support multiple regulators, so we'll need custom
handlers.
2. Generally, platforms with 2 regulators have platform-specific
constraints on how the voltages should be set (e.g.
minimum/maximum voltage difference between them), so we
should not just create generic handlers that simply
change the voltages without taking care of those constraints.
Disable devfreq for now on those GPUs.
Signed-off-by: Nicolas Boichat
Reviewed-by: Tomeu Vizoso
Reviewed-by: Steven Price
Signed-off-by: Steven Price
Link: https://patchwork.freedesktop.org/patch/msgid/20210421132841.v13.3.I3af068abe30c9c85cabc4486385c52e56527a509@changeid
Signed-off-by: Sasha Levin
commit e049b85f7dcc666921e7513bf22b70d9462e624d
Author: Wang Li
Date: Sat Apr 10 03:48:41 2021 +0000
drm/mediatek: Fix PM reference leak in mtk\_crtc\_ddp\_hw\_init()
[ Upstream commit 69777e6ca396f0a7e1baff40fcad4a9d3d445b7a ]
pm\_runtime\_get\_sync will increment pm usage counter even it failed.
Forgetting to putting operation will result in reference leak here.
Fix it by replacing it with pm\_runtime\_resume\_and\_get to keep usage
counter balanced.
Reported-by: Hulk Robot
Signed-off-by: Wang Li
Signed-off-by: Chun-Kuang Hu
Signed-off-by: Sasha Levin
commit 609ee98affb06f1013331a57efc281372609fa0f
Author: Sebastian Andrzej Siewior
Date: Wed May 12 23:43:24 2021 +0200
net: Treat \_\_napi\_schedule\_irqoff() as \_\_napi\_schedule() on PREEMPT\_RT
[ Upstream commit 8380c81d5c4fced6f4397795a5ae65758272bbfd ]
\_\_napi\_schedule\_irqoff() is an optimized version of \_\_napi\_schedule()
which can be used where it is known that interrupts are disabled,
e.g. in interrupt-handlers, spin\_lock\_irq() sections or hrtimer
callbacks.
On PREEMPT\_RT enabled kernels this assumptions is not true. Force-
threaded interrupt handlers and spinlocks are not disabling interrupts
and the NAPI hrtimer callback is forced into softirq context which runs
with interrupts enabled as well.
Chasing all usage sites of \_\_napi\_schedule\_irqoff() is a whack-a-mole
game so make \_\_napi\_schedule\_irqoff() invoke \_\_napi\_schedule() for
PREEMPT\_RT kernels.
The callers of \_\_\_\_napi\_schedule() in the networking core have been
audited and are correct on PREEMPT\_RT kernels as well.
Reported-by: Juri Lelli
Signed-off-by: Sebastian Andrzej Siewior
Reviewed-by: Thomas Gleixner
Reviewed-by: Juri Lelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 5b991df8881088448cb223e769e37cab8dd40706
Author: Zou Wei
Date: Wed May 12 15:00:24 2021 +0800
atm: nicstar: Fix possible use-after-free in nicstar\_cleanup()
[ Upstream commit 34e7434ba4e97f4b85c1423a59b2922ba7dff2ea ]
This module's remove path calls del\_timer(). However, that function
does not wait until the timer handler finishes. This means that the
timer handler may still be running after the driver's remove function
has finished, which would result in a use-after-free.
Fix by calling del\_timer\_sync(), which makes sure the timer handler
has finished, and unable to re-schedule itself.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit ed7c3739d0a07e2ec3ccbffe7e93cea01c438cda
Author: Zou Wei
Date: Tue May 11 14:58:53 2021 +0800
mISDN: fix possible use-after-free in HFC\_cleanup()
[ Upstream commit 009fc857c5f6fda81f2f7dd851b2d54193a8e733 ]
This module's remove path calls del\_timer(). However, that function
does not wait until the timer handler finishes. This means that the
timer handler may still be running after the driver's remove function
has finished, which would result in a use-after-free.
Fix by calling del\_timer\_sync(), which makes sure the timer handler
has finished, and unable to re-schedule itself.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit d1fb12412874c94ad037e11d0ecdd1140a439297
Author: Zou Wei
Date: Tue May 11 14:53:36 2021 +0800
atm: iphase: fix possible use-after-free in ia\_module\_exit()
[ Upstream commit 1c72e6ab66b9598cac741ed397438a52065a8f1f ]
This module's remove path calls del\_timer(). However, that function
does not wait until the timer handler finishes. This means that the
timer handler may still be running after the driver's remove function
has finished, which would result in a use-after-free.
Fix by calling del\_timer\_sync(), which makes sure the timer handler
has finished, and unable to re-schedule itself.
Reported-by: Hulk Robot
Signed-off-by: Zou Wei
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 72bdf3c6b059b2bab3974dea9882cf381f12d7a0
Author: Bibo Mao
Date: Mon Jun 29 21:15:32 2020 +0800
hugetlb: clear huge pte during flush function on mips platform
[ Upstream commit 33ae8f801ad8bec48e886d368739feb2816478f2 ]
If multiple threads are accessing the same huge page at the same
time, hugetlb\_cow will be called if one thread write the COW huge
page. And function huge\_ptep\_clear\_flush is called to notify other
threads to clear the huge pte tlb entry. The other threads clear
the huge pte tlb entry and reload it from page table, the reload
huge pte entry may be old.
This patch fixes this issue on mips platform, and it clears huge
pte entry before notifying other threads to flush current huge
page entry, it is similar with other architectures.
Signed-off-by: Bibo Mao
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit d2958a2e6d9246a41e649bafd786018add603c2f
Author: Youling Tang
Date: Thu May 6 10:02:50 2021 +0800
MIPS: Loongson64: Fix build error 'secondary\_kexec\_args' undeclared under !SMP
[ Upstream commit 6a73022ee3fdf7e60f2ba0a3a835dd421c05b5b5 ]
On the Loongson64 platform, if CONFIG\_SMP is not set, the following build
error will occur:
arch/mips/loongson64/reset.c:133:2: error:'secondary\_kexec\_args' undeclared
Because the definition and declaration of secondary\_kexec\_args are in the
CONFIG\_SMP, the secondary\_kexec\_args variable should be used in CONFIG\_SMP.
Reported-by: kernel test robot
Signed-off-by: Youling Tang
Acked-by: Randy Dunlap
Signed-off-by: Thomas Bogendoerfer
Signed-off-by: Sasha Levin
commit 6102f34e462285174b590c50a37443070dfda42e
Author: Dinghao Liu
Date: Thu Apr 15 15:33:38 2021 +0800
clk: renesas: rcar-usb2-clock-sel: Fix error handling in .probe()
[ Upstream commit a20a40a8bbc2cf4b29d7248ea31e974e9103dd7f ]
The error handling paths after pm\_runtime\_get\_sync() have no refcount
decrement, which leads to refcount leak.
Signed-off-by: Dinghao Liu
Link: https://lore.kernel.org/r/20210415073338.22287-1-dinghao.liu@zju.edu.cn
[geert: Remove now unused variable priv]
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Sasha Levin
commit 5ec05aa8160bc59df13e4aa4c758b49aa035be0e
Author: Dmytro Laktyushkin
Date: Mon Apr 19 17:50:53 2021 -0400
drm/amd/display: fix use\_max\_lb flag for 420 pixel formats
[ Upstream commit 8809a7a4afe90ad9ffb42f72154d27e7c47551ae ]
Right now the flag simply selects memory config 0 when flag is true
however 420 modes benefit more from memory config 3.
Signed-off-by: Dmytro Laktyushkin
Reviewed-by: Aric Cyr
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 57092f4f803b31cb1fddfec2bb33196967c6e946
Author: Ilya Bakoulin
Date: Mon Apr 26 14:27:38 2021 -0400
drm/amd/display: Fix clock table filling logic
[ Upstream commit c31bef1cb1203b26f901a511a3246204cfaf8a57 ]
[Why]
Currently, the code that fills the clock table can miss filling
information about some of the higher voltage states advertised
by the SMU. This, in turn, may cause some of the higher pixel clock
modes (e.g. 8k60) to fail validation.
[How]
Fill the table with one entry per DCFCLK level instead of one entry
per FCLK level. This is needed because the maximum FCLK does not
necessarily need maximum voltage, whereas DCFCLK values from SMU
cover the full voltage range.
Signed-off-by: Ilya Bakoulin
Reviewed-by: Dmytro Laktyushkin
Acked-by: Stylon Wang
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3eb50ab2c5ac3e25c4ea056491474baac78a4fb3
Author: Alex Deucher
Date: Tue May 4 11:00:42 2021 -0400
drm/amdgpu: change the default timeout for kernel compute queues
[ Upstream commit 67387dfe0f6630f2d4f412ce77debec23a49db7a ]
Change to 60s. This matches what we already do in virtualization.
Infinite timeout can lead to deadlocks in the kernel.
Reviewed-by: Christian König
Acked-by: Daniel Vetter
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit c9c00298cf07e6628f8fb7b6a33e473bb05ae45c
Author: Andy Shevchenko
Date: Mon May 10 19:39:30 2021 +0300
net: pch\_gbe: Use proper accessors to BE data in pch\_ptp\_match()
[ Upstream commit 443ef39b499cc9c6635f83238101f1bb923e9326 ]
Sparse is not happy about handling of strict types in pch\_ptp\_match():
.../pch\_gbe\_main.c:158:33: warning: incorrect type in argument 2 (different base types)
.../pch\_gbe\_main.c:158:33: expected unsigned short [usertype] uid\_hi
.../pch\_gbe\_main.c:158:33: got restricted \_\_be16 [usertype]
.../pch\_gbe\_main.c:158:45: warning: incorrect type in argument 3 (different base types)
.../pch\_gbe\_main.c:158:45: expected unsigned int [usertype] uid\_lo
.../pch\_gbe\_main.c:158:45: got restricted \_\_be32 [usertype]
.../pch\_gbe\_main.c:158:56: warning: incorrect type in argument 4 (different base types)
.../pch\_gbe\_main.c:158:56: expected unsigned short [usertype] seqid
.../pch\_gbe\_main.c:158:56: got restricted \_\_be16 [usertype]
Fix that by switching to use proper accessors to BE data.
Reported-by: kernel test robot
Signed-off-by: Andy Shevchenko
Tested-by: Flavio Suligoi
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit ae1864f13cce523b1e7811f3ec4ff931abcd965c
Author: Sebastian Reichel
Date: Thu Apr 29 00:29:50 2021 +0200
drm/imx: Add 8 pixel alignment fix
[ Upstream commit 94dfec48fca756cef90263a03e81f24dae24a5c6 ]
Some standard resolutions like 1366x768 do not work properly with
i.MX6 SoCs, since the horizontal resolution needs to be aligned
to 8 pixels (so 1360x768 or 1368x768 would work).
This patch allocates framebuffers allocated to 8 pixels. The extra
time required to send the extra pixels are removed from the blank
time. In order to expose the correct display size to userspace,
the stride is increased without increasing the width.
Without this patch systems with this display resolution hang
indefinitely during boot up.
Suggested-by: Boris Brezillon
Signed-off-by: Sebastian Reichel
Link: https://lore.kernel.org/r/20210428222953.235280-3-sebastian.reichel@collabora.com
Signed-off-by: Philipp Zabel
Signed-off-by: Sasha Levin
commit 925a6b206bde1df6f7bba951b0d006c921c36c8f
Author: Liu Ying
Date: Fri Apr 23 17:26:41 2021 +0800
drm/bridge: nwl-dsi: Force a full modeset when crtc\_state->active is changed to be true
[ Upstream commit 3afb2a28fa2404d11cce1956a003f2aaca4da421 ]
This patch replaces ->mode\_fixup() with ->atomic\_check() so that
a full modeset can be requested from there when crtc\_state->active
is changed to be true(which implies only connector's DPMS is brought
out of "Off" status, though not necessarily). Bridge functions are
added or changed to accommodate the ->atomic\_check() callback. That
full modeset is needed by the up-coming patch which gets MIPI DSI
controller and PHY ready in ->mode\_set(), because it makes sure
->mode\_set() and ->atomic\_disable() are called in pairs.
Cc: Andrzej Hajda
Cc: Neil Armstrong
Cc: Robert Foss
Cc: Laurent Pinchart
Cc: Jonas Karlman
Cc: Jernej Skrabec
Cc: David Airlie
Cc: Daniel Vetter
Cc: Guido Günther
Cc: Robert Chiras
Cc: NXP Linux Team
Signed-off-by: Liu Ying
Reviewed-by: Neil Armstrong
Signed-off-by: Neil Armstrong
Link: https://patchwork.freedesktop.org/patch/msgid/1619170003-4817-2-git-send-email-victor.liu@nxp.com
Signed-off-by: Sasha Levin
commit 0cf0cb019cd5ea9a09b23816b8d2b1707b813f88
Author: Dan Carpenter
Date: Wed Apr 21 13:18:03 2021 +0300
drm/vc4: fix argument ordering in vc4\_crtc\_get\_margins()
[ Upstream commit e590c2b03a6143ba93ddad306bc9eaafa838c020 ]
Cppcheck complains that the declaration doesn't match the function
definition. Obviously "left" should come before "right". The caller
and the function implementation are done this way, it's just the
declaration which is wrong so this doesn't affect runtime.
Reported-by: kernel test robot
Signed-off-by: Dan Carpenter
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/YH/720FD978TPhHp@mwanda
Signed-off-by: Sasha Levin
commit e684e0ee1153f40509926ead0da8007e8061d9ce
Author: Jack Zhang
Date: Tue Apr 27 17:08:47 2021 +0800
drm/amd/amdgpu/sriov disable all ip hw status by default
[ Upstream commit 95ea3dbc4e9548d35ab6fbf67675cef8c293e2f5 ]
Disable all ip's hw status to false before any hw\_init.
Only set it to true until its hw\_init is executed.
The old 5.9 branch has this change but somehow the 5.11 kernrel does
not have this fix.
Without this change, sriov tdr have gfx IB test fail.
Signed-off-by: Jack Zhang
Review-by: Emily Deng
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit eeb44b638475bcccd9b8da6a4a2274181431453e
Author: Chris Park
Date: Tue Apr 13 22:25:23 2021 -0400
drm/amd/display: Fix BSOD with NULL check
[ Upstream commit b2d4b9f72fb14c1e6e4f0128964a84539a72d831 ]
[Why]
CLK mgr is null for server settings.
[How]
Guard the function with NULL check.
Signed-off-by: Chris Park
Reviewed-by: Nicholas Kazlauskas
Acked-by: Wayne Lin
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3728601cd68e3a43ecb49a394cd0056b0ecfba7c
Author: Lewis Huang
Date: Tue Apr 13 07:02:28 2021 +0800
drm/amd/display: Revert wait vblank on update dpp clock
[ Upstream commit d5433a9f692f57c814286f8af2746c567ef79fc8 ]
[Why]
This change only fix dpp clock switch to lower case.
New solution later can fix both case, which is "dc: skip
program clock when allow seamless boot"
[How]
This reverts commit "dc: wait vblank when stream enabled
and update dpp clock"
Signed-off-by: Lewis Huang
Reviewed-by: Eric Yang
Acked-by: Wayne Lin
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 73893fe5217804bd151ecd346fece25807bb20da
Author: Brandon Syu
Date: Fri Apr 9 14:47:46 2021 +0800
drm/amd/display: fix HDCP reset sequence on reinitialize
[ Upstream commit 99c248c41c2199bd34232ce8e729d18c4b343b64 ]
[why]
When setup is called after hdcp has already setup,
it would cause to disable HDCP flow won’t execute.
[how]
Don't clean up hdcp content to be 0.
Signed-off-by: Brandon Syu
Reviewed-by: Wenjing Liu
Acked-by: Wayne Lin
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit fc2e7aeedba2b7293ba04a24e6edaf57cbd1b422
Author: KuoHsiang Chou
Date: Wed Apr 21 16:58:59 2021 +0800
drm/ast: Fixed CVE for DP501
[ Upstream commit ba4e0339a6a33e2ba341703ce14ae8ca203cb2f1 ]
[Bug][DP501]
If ASPEED P2A (PCI to AHB) bridge is disabled and disallowed for
CVE\_2019\_6260 item3, and then the monitor's EDID is unable read through
Parade DP501.
The reason is the DP501's FW is mapped to BMC addressing space rather
than Host addressing space.
The resolution is that using "pci\_iomap\_range()" maps to DP501's FW that
stored on the end of FB (Frame Buffer).
In this case, FrameBuffer reserves the last 2MB used for the image of
DP501.
Signed-off-by: KuoHsiang Chou
Reported-by: kernel test robot
Signed-off-by: Thomas Zimmermann
Link: https://patchwork.freedesktop.org/patch/msgid/20210421085859.17761-1-kuohsiang\_chou@aspeedtech.com
Signed-off-by: Sasha Levin
commit d5d89dd11f6fe8e97e3028fddc3b4a14f8d93892
Author: Thomas Zimmermann
Date: Thu Apr 15 13:00:39 2021 +0200
drm/zte: Don't select DRM\_KMS\_FB\_HELPER
[ Upstream commit a50e74bec1d17e95275909660c6b43ffe11ebcf0 ]
Selecting DRM\_FBDEV\_EMULATION will include the correct settings for
fbdev emulation. Drivers should not override this.
Signed-off-by: Thomas Zimmermann
Acked-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20210415110040.23525-4-tzimmermann@suse.de
Signed-off-by: Sasha Levin
commit 992b191b179c49250e64f6ec4472abad50a21742
Author: Thomas Zimmermann
Date: Thu Apr 15 13:00:38 2021 +0200
drm/mxsfb: Don't select DRM\_KMS\_FB\_HELPER
[ Upstream commit 13b29cc3a722c2c0bc9ab9f72f9047d55d08a2f9 ]
Selecting DRM\_FBDEV\_EMULATION will include the correct settings for
fbdev emulation. Drivers should not override this.
Signed-off-by: Thomas Zimmermann
Acked-by: Stefan Agner
Acked-by: Daniel Vetter
Link: https://patchwork.freedesktop.org/patch/msgid/20210415110040.23525-3-tzimmermann@suse.de
Signed-off-by: Sasha Levin


=== Content from security.netapp.com_9f7d7c1f_20250114_184803.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2021-45485 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20220121-0001)

## CVE-2021-45485 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20220121-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20220121-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20220121-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20220121-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20220121-0001
**Version:**
13.0

**Last updated:**
05/22/2023

**Status:**
Interim.

**CVEs:** CVE-2021-45485

Overview
#### Summary

Multiple NetApp products incorporate Linux Kernel. Linux Kernel versions prior to 5.13.3 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information.

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2021-45485](https://nvd.nist.gov/vuln/detail/CVE-2021-45485) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.13.3>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=62f20e068ccc50d6ab66fdb72ba90da2b9418c99>

Affected Products
#### Affected Products

* AFF Baseboard Management Controller (BMC) - A700s
* Active IQ Unified Manager for VMware vSphere
* Brocade Fabric Operating System Firmware
* E-Series SANtricity OS Controller Software 11.x
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* BlueXP Classification
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800/C800/A150
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Service Processor - 8080/8060/8040/8020
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM6 SAS Disk Shelf Firmware
* Inventory Collect Tool
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp BlueXP
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SMI-S Provider
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp Virtual Desktop Service (VDS)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere
* OnCommand Insight
* OnCommand Workflow Automation
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024
* StorageGRID Baseboard Management Controller (BMC)
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **Active IQ Unified Manager for VMware vSphere** | <https://mysupport.netapp.com/site/products/all/details/activeiq-unified-manager/downloads-tab/download/62791/9.10> <https://mysupport.netapp.com/site/products/all/details/activeiq_um/downloads-tab/download/62791/9.10/> |
| **AFF Baseboard Management Controller (BMC) - A700s** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1450625. First fixed versions include the following: 1.91 |
| **Brocade Fabric Operating System Firmware** | First Fixed versions of Brocade Fabric OS include: v9.2.0 |
| **E-Series SANtricity OS Controller Software 11.x** | <https://mysupport.netapp.com/site/products/all/details/eseries-santricityos/downloads-tab/download/62735/11.70.3> |
| **FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1450637. First fixed versions include the following: 13.7 |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20220121-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20220121 | Initial Public Release |
| 2.0 | 20220125 | FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800, Service Processor, StorageGRID Baseboard Management Controller (BMC), and StorageGRID (formerly StorageGRID Webscale) moved to Products Not Affected, and FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 moved to Affected Products |
| 3.0 | 20220127 | Brocade Fabric Operating System Firmware moved to Affected Products, and SnapCenter Plug-in for VMware vSphere moved to Products Not Affected |
| 4.0 | 20220128 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S, and NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Won't Fix status |
| 5.0 | 20220131 | AFF Baseboard Management Controller (BMC) - A700s moved to Affected Products |
| 6.0 | 20220215 | ONTAP Tools for VMware vSphere moved to Products Not Affected |
| 7.0 | 20220221 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S, and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Affected Products |
| 8.0 | 20220426 | Active IQ Unified Manager for VMware vSphere moved to Affected Products and added to Software Versions and Fixes |
| 9.0 | 20220520 | Active IQ Unified Manager for VMware vSphere added to Software Versions and Fixes |
| 10.0 | 20220527 | E-Series SANtricity OS Controller Software 11.x 11.70.3 added to Software Versions and Fixes |
| 11.0 | 20220629 | NetApp Converged Systems Advisor Agent moved to Products Not Affected |
| 12.0 | 20221024 | FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 added to Software Versions and Fixes |
| 13.0 | 20230522 | Brocade Fabric Operating System Firmware added to Software Versions and Fixes |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.oracle.com_2ed21adf_20250114_184804.html ===


* [Skip to content](#maincontent)
* [Accessibility Policy](https://www.oracle.com/corporate/accessibility/)

Products
Industries
Resources
Customers
Partners
Developers
Company

Close Search

Search Oracle.com

* QUICK LINKS
* [Oracle Cloud Infrastructure](/cloud/)
* [Oracle Fusion Cloud Applications](/applications/)
* [Oracle Database](/database/technologies/)
* [Download Java](/java/technologies/downloads/)
* [Careers at Oracle](/careers/)

Search

[Country
![]()](/countries-list.html#countries)

View Accounts

Back
Cloud Account
[Sign in to Cloud](/cloud/sign-in.html)
[Sign Up for Free Cloud Tier](/cloud/free/)

Oracle Account

* [Sign-In](https://www.oracle.com/webapps/redirect/signon?nexturl=)
* [Create an Account](https://profile.oracle.com/myprofile/account/create-account.jspx)

* [Help](/corporate/contact/help.html)
* Sign Out

[Contact Sales](/corporate/contact/ "Contact Sales")

[Menu

Menu](/global-menu-v2/)

## Oracle Critical Patch Update Advisory - July 2022

### Description

A Critical Patch Update is a collection of patches for multiple security vulnerabilities.  These patches address vulnerabilities in Oracle code and in third-party components included in Oracle products.  These patches are usually cumulative, but each advisory describes only the security patches added since the previous Critical Patch Update Advisory. Thus, prior Critical Patch Update advisories should be reviewed for information regarding earlier published security patches.  Refer to [“Critical Patch Updates, Security Alerts and Bulletins”](https://www.oracle.com/security-alerts/) for information about Oracle Security advisories.

**Oracle continues to periodically receive reports of attempts to maliciously exploit vulnerabilities for which Oracle has already released security patches. In some instances, it has been reported that attackers have been successful because targeted customers had failed to apply available Oracle patches. Oracle therefore strongly recommends that customers remain on actively-supported versions and apply Critical Patch Update security patches without delay.**

This Critical Patch Update contains 349 new security patches across the product families listed below. Please note that an MOS note summarizing the content of this Critical Patch Update and other Oracle Software Security Assurance activities is located at  [July 2022 Critical Patch Update: Executive Summary and Analysis](https://support.oracle.com/rs?type=doc&id=2880220.1).

**Please note that since the release of the April 2022 Critical Patch Update, Oracle has released a Security Alert for Oracle E-Business Suite [CVE-2022-21500 (May 19, 2022)](https://www.oracle.com/security-alerts/alert-cve-2022-21500.html). Customers are strongly advised to apply the July 2022 Critical Patch Update for Oracle E-Business Suite, which includes patches for this Alert as well as additional patches.**

### Affected Products and Patch Information

Security vulnerabilities addressed by this Critical Patch Update affect the products listed below. The product area is shown in the Patch Availability Document column.

**Please click on the links in the Patch Availability Document column below to access the documentation for patch availability information and installation instructions.**

| Affected Products and Versions | Patch Availability Document |
| --- | --- |
| [Autonomous Health Framework](#AppendixAHTF) | [Oracle Autonomous Health Framework](https://support.oracle.com/rs?type=doc&id=2815521.1) |
| [Big Data Spatial and Graph, versions prior to 23.1](#AppendixBGDG) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Enterprise Manager Base Platform, versions 13.4.0.0, 13.5.0.0](#AppendixEM) | [Enterprise Manager](https://support.oracle.com/rs?type=doc&id=2867874.1) |
| [Enterprise Manager for MySQL Database](#AppendixEM) | [Enterprise Manager](https://support.oracle.com/rs?type=doc&id=2867874.1) |
| [Enterprise Manager Ops Center, version 12.4.0.0](#AppendixEM) | [Enterprise Manager](https://support.oracle.com/rs?type=doc&id=2867874.1) |
| [JD Edwards EnterpriseOne Orchestrator, versions 9.2.6.3 and prior](#AppendixJDE) | [JD Edwards](https://support.oracle.com/rs?type=doc&id=2880760.1) |
| [JD Edwards EnterpriseOne Tools, versions 9.2.6.3 and prior](#AppendixJDE) | [JD Edwards](https://support.oracle.com/rs?type=doc&id=2880760.1) |
| [MySQL Cluster, versions 7.4.36 and prior, 7.5.26 and prior, 7.6.22 and prior, 8.0.29 and prior, and8.0.29 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [MySQL Enterprise Monitor, versions 8.0.30 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [MySQL Server, versions 5.7.38 and prior, 8.0.29 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [MySQL Shell, versions 8.0.28 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [MySQL Shell for VS Code, versions 1.1.8 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [MySQL Workbench, versions 8.0.29 and prior](#AppendixMSQL) | [MySQL](https://support.oracle.com/rs?type=doc&id=2880175.1) |
| [Oracle Agile Engineering Data Management, version 6.2.1.0](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle Agile PLM, version 9.3.6](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle Agile Product Lifecycle Management for Process, versions 6.2.2, 6.2.3](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle Application Express, versions prior to 22.1.1](#AppendixDB) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Application Testing Suite, version 13.3.0.1](#AppendixEM) | [Enterprise Manager](https://support.oracle.com/rs?type=doc&id=2867874.1) |
| [Oracle Autovue for Agile Product Lifecycle Management, version 21.0.2](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle Banking Branch, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Cash Management, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Corporate Lending Process Management, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Credit Facilities Process Management, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Deposits and Lines of Credit Servicing, version 2.7](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Electronic Data Exchange for Corporates, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Liquidity Management, versions 14.2, 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Origination, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Party Management, version 2.7](#AppendixIFLX) | [Oracle Banking Platform](https://support.oracle.com/rs?type=doc&id=2880601.1) |
| [Oracle Banking Platform, versions 2.6.2, 2.9, 2.12](#AppendixIFLX) | [Oracle Banking Platform](https://support.oracle.com/rs?type=doc&id=2880601.1) |
| [Oracle Banking Supply Chain Finance, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Trade Finance, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Trade Finance Process Management, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Banking Virtual Account Management, version 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Berkeley DB](#AppendixBDB) | [Berkeley DB](https://support.oracle.com/rs?type=doc&id=2881355.1) |
| [Oracle BI Publisher, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Oracle Analytics](https://support.oracle.com/rs?type=doc&id=2880164.2) |
| [Oracle Blockchain Platform](#AppendixBP) | [Oracle Blockchain Platform](https://support.oracle.com/rs?type=doc&id=2815521.1) |
| [Oracle Business Intelligence Enterprise Edition, version 5.9.0.0.0](#AppendixFMW) | [Oracle Analytics](https://support.oracle.com/rs?type=doc&id=2880164.2) |
| [Oracle Coherence, versions 3.7.1.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Commerce Guided Search, version 11.3.2](#AppendixOCOM) | [Oracle Commerce](https://support.oracle.com/rs?type=doc&id=2881330.1) |
| [Oracle Commerce Merchandising, version 11.3.2](#AppendixOCOM) | [Oracle Commerce](https://support.oracle.com/rs?type=doc&id=2881330.1) |
| [Oracle Commerce Platform, versions 11.3.0, 11.3.1, 11.3.2](#AppendixOCOM) | [Oracle Commerce](https://support.oracle.com/rs?type=doc&id=2881330.1) |
| [Oracle Communications ASAP, version 7.3](#AppendixCAGBU) | [Oracle Communications ASAP](https://support.oracle.com/rs?type=doc&id=2880117.1) |
| [Oracle Communications Billing and Revenue Management, versions 12.0.0.4.0-12.0.0.6.0](#AppendixCAGBU) | [Oracle Communications Billing and Revenue Management](https://support.oracle.com/rs?type=doc&id=2880120.1) |
| [Oracle Communications BRM - Elastic Charging Engine, versions prior to 12.0.0.4.6, prior to 12.0.0.5.1](#AppendixCAGBU) | [Oracle Communications BRM - Elastic Charging Engine](https://support.oracle.com/rs?type=doc&id=2880120.1) |
| [Oracle Communications Cloud Native Core Binding Support Function, versions 22.1.3, 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Binding Support Function](https://support.oracle.com/rs?type=doc&id=2881121.1                ) |
| [Oracle Communications Cloud Native Core Console, versions 22.1.2, 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Console](https://support.oracle.com/rs?type=doc&id=2881127.1) |
| [Oracle Communications Cloud Native Core Network Exposure Function, version 22.1.1](#AppendixCGBU) | [Oracle Communications Cloud Native Core Network Exposure Function](https://support.oracle.com/rs?type=doc&id=2881146.1) |
| [Oracle Communications Cloud Native Core Network Function Cloud Native Environment, versions 22.1.0, 22.1.2, 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Network Function Cloud Native Environment](https://support.oracle.com/rs?type=doc&id=2881128.1) |
| [Oracle Communications Cloud Native Core Network Repository Function, versions 22.1.2, 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Network Repository Function](https://support.oracle.com/rs?type=doc&id=2881129.1) |
| [Oracle Communications Cloud Native Core Network Slice Selection Function, version 22.1.1](#AppendixCGBU) | [Oracle Communications Cloud Native Core Network Slice Selection Function](https://support.oracle.com/rs?type=doc&id=2881130.1) |
| [Oracle Communications Cloud Native Core Policy, versions 22.1.3, 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Policy](https://support.oracle.com/rs?type=doc&id=2881131.1                                    ) |
| [Oracle Communications Cloud Native Core Security Edge Protection Proxy, version 22.1.1](#AppendixCGBU) | [Oracle Communications Cloud Native Core Security Edge Protection Proxy](https://support.oracle.com/rs?type=doc&id=2881132.1           ) |
| [Oracle Communications Cloud Native Core Service Communication Proxy, version 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Service Communication Proxy](https://support.oracle.com/rs?type=doc&id=2881112.1               ) |
| [Oracle Communications Cloud Native Core Unified Data Repository, version 22.2.0](#AppendixCGBU) | [Oracle Communications Cloud Native Core Unified Data Repository](https://support.oracle.com/rs?type=doc&id=2881143.1                   ) |
| [Oracle Communications Core Session Manager, versions 8.2.5, 8.4.5](#AppendixCGBU) | [Oracle Communications Core Session Manager](https://support.oracle.com/rs?type=doc&id=2881373.1) |
| [Oracle Communications Design Studio, version 7.4.2](#AppendixCAGBU) | [Oracle Communications Design Studio](https://support.oracle.com/rs?type=doc&id=2881549.1) |
| [Oracle Communications Instant Messaging Server, version 10.0.1.5.0](#AppendixCAGBU) | [Oracle Communications Instant Messaging Server](https://support.oracle.com/rs?type=doc&id=2881276.1) |
| [Oracle Communications IP Service Activator](#AppendixCAGBU) | [Oracle Communications IP Service Activator](https://support.oracle.com/rs?type=doc&id=2880138.1) |
| [Oracle Communications Offline Mediation Controller, versions prior to 12.0.0.4.4, prior to 12.0.0.5.1](#AppendixCAGBU) | [Oracle Communications Offline Mediation Controller](https://support.oracle.com/rs?type=doc&id=2880136.1) |
| [Oracle Communications Operations Monitor, versions 4.3, 4.4, 5.0](#AppendixCGBU) | [Oracle Communications Operations Monitor](https://support.oracle.com/rs?type=doc&id=2881145.1) |
| [Oracle Communications Session Border Controller, versions 8.4, 9.0, 9.1](#AppendixCGBU) | [Oracle Communications Session Border Controller](https://support.oracle.com/rs?type=doc&id=2881322.1) |
| [Oracle Communications Unified Inventory Management, versions 7.4.1, 7.4.2, 7.5.0](#AppendixCAGBU) | [Oracle Communications Unified Inventory Management](https://support.oracle.com/rs?type=doc&id=2880135.1) |
| [Oracle Communications Unified Session Manager, version 8.2.5](#AppendixCGBU) | [Oracle Communications Unified Session Manager](https://support.oracle.com/rs?type=doc&id=2881373.1) |
| [Oracle Crystal Ball, versions 11.1.2.0.0-11.1.2.4.900](#AppendixPVA) | [Oracle Construction and Engineering Suite](https://support.oracle.com/rs?type=doc&id=2879713.1) |
| [Oracle Data Integrator](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Database Server, versions 12.1.0.2, 19c, 21c](#AppendixDB) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle E-Business Suite, versions 12.2.3-12.2.11](#AppendixEBS) | [Oracle E-Business Suite](https://support.oracle.com/rs?type=doc&id=2484000.1) |
| [Oracle Enterprise Communications Broker, version 3.3](#AppendixCGBU) | [Oracle Enterprise Communications Broker](https://support.oracle.com/rs?type=doc&id=2881359.1) |
| [Oracle Enterprise Operations Monitor, versions 4.3, 4.4, 5.0](#AppendixCGBU) | [Oracle Enterprise Operations Monitor](https://support.oracle.com/rs?type=doc&id=2883136.1) |
| [Oracle Enterprise Session Border Controller, versions 8.4, 9.0, 9.1](#AppendixCGBU) | [Oracle Enterprise Session Border Controller](https://support.oracle.com/rs?type=doc&id=2881322.1) |
| [Oracle Essbase, version 21.3](#AppendixESSB) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Financial Services Analytical Applications Infrastructure, versions 8.0.7.0-8.1.0.0, 8.1.1.0, 8.1.2.0, 8.1.2.1](#AppendixIFLX) | [Oracle Financial Services Analytical Applications Infrastructure](https://support.oracle.com/rs?type=doc&id=2881546.1) |
| [Oracle Financial Services Behavior Detection Platform, versions 8.0.7.0, 8.0.8.0, 8.1.1.0-8.1.2.1](#AppendixIFLX) | [Oracle Financial Services Behavior Detection Platform](https://support.oracle.com/rs?type=doc&id=2879993.1) |
| [Oracle Financial Services Crime and Compliance Management Studio, versions 8.0.8.2.0, 8.0.8.3.0](#AppendixIFLX) | [Oracle Financial Services Crime and Compliance Management Studio](https://support.oracle.com/rs?type=doc&id=2879958.1) |
| [Oracle Financial Services Enterprise Case Management, versions 8.0.7.1, 8.0.7.2, 8.0.8.0, 8.0.8.1, 8.1.1.0-8.1.2.1](#AppendixIFLX) | [Oracle Financial Services Enterprise Case Management](https://support.oracle.com/rs?type=doc&id=2879962.1) |
| [Oracle Financial Services Revenue Management and Billing, versions 2.9.0.0.0, 2.9.0.1.0, 3.0.0.0.0-3.2.0.0.0, 4.0.0.0.0](#AppendixIFLX) | [Oracle Financial Services Revenue Management and Billing](https://support.oracle.com/rs?type=doc&id=2881994.1) |
| [Oracle Financial Services Trade-Based Anti Money Laundering Enterprise Edition, versions 8.0.7.0, 8.0.8.0](#AppendixIFLX) | [Oracle Financial Services Trade-Based Anti Money Laundering Enterprise Edition](https://support.oracle.com/rs?type=doc&id=2879961.1) |
| [Oracle FLEXCUBE Core Banking, versions 5.2, 11.6-11.8, 11.10](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle FLEXCUBE Private Banking, version 12.1](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle FLEXCUBE Universal Banking, versions 12.1-12.4, 14.0-14.3, 14.5](#AppendixIFLX) | [Contact Support](https://support.oracle.com) |
| [Oracle Global Lifecycle Management NextGen OUI Framework, versions prior to 13.9.4.2.10](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Global Lifecycle Management OPatch, versions prior to 12.2.0.1.30](#AppendixGLM) | [Global Lifecycle Management](https://support.oracle.com/rs?type=doc&id=2815521.1) |
| [Oracle GoldenGate, versions [19c] prior to 19.1.0.0.220719, [21c] prior to 21.7.0.0.0](#AppendixGG) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle GraalVM Enterprise Edition, versions 20.3.6, 21.3.2, 22.1.0](#AppendixJAVA) | [Java SE](https://support.oracle.com/rs?type=doc&id=2879978.1) |
| [Oracle Graph Server and Client, versions prior to 22.2.0](#AppendixGSC) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Health Sciences Data Management Workbench, versions 2.4.8.7, 2.5.2.1, 3.0.0.0, 3.1.0.3](#AppendixHCAR) | [Health Sciences](https://support.oracle.com/rs?type=doc&id=2870068.1) |
| [Oracle Health Sciences Empirica Signal, versions 9.1.0.52, 9.2.0.52](#AppendixHCAR) | [Health Sciences](https://support.oracle.com/rs?type=doc&id=2870068.1) |
| [Oracle Health Sciences Information Manager, versions 3.0.0.1, 3.0.1.0-3.0.5.0](#AppendixHC) | [HealthCare Applications](https://support.oracle.com/rs?type=doc&id=2879761.1) |
| [Oracle Healthcare Foundation, versions 8.1.0, 8.2.0, 8.2.1](#AppendixHC) | [HealthCare Applications](https://support.oracle.com/rs?type=doc&id=2879761.1) |
| [Oracle Hospitality Cruise Shipboard Property Management System, version 20.2.1](#AppendixHOSP) | [Oracle Hospitality Cruise Shipboard Property Management System](https://support.oracle.com/rs?type=doc&id=2873392.1) |
| [Oracle Hospitality Inventory Management, version 9.1](#AppendixFBBU) | [Oracle Hospitality Inventory Management](https://support.oracle.com/rs?type=doc&id=2871970.1) |
| [Oracle Hospitality Materials Control, version 18.1](#AppendixFBBU) | [Oracle Hospitality Materials Control](https://support.oracle.com/rs?type=doc&id=2871960.1) |
| [Oracle Hospitality OPERA 5, version 5.6](#AppendixHOSP) | [Oracle Hospitality OPERA 5 Property Services](https://support.oracle.com/rs?type=doc&id=2872807.1) |
| [Oracle HTTP Server, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Identity Management Suite](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Identity Manager Connector](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Java SE, versions 7u343, 8u333, 11.0.15.1, 17.0.3.1, 18.0.1.1](#AppendixJAVA) | [Java SE](https://support.oracle.com/rs?type=doc&id=2879978.1) |
| [Oracle Managed File Transfer, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Middleware Common Libraries and Tools, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle NoSQL Database](#AppendixNSQL) | [NoSQL Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Policy Automation, versions 12.2.0-12.2.25](#AppendixPOLI) | [Oracle Policy Automation](https://support.oracle.com/rs?type=doc&id=2876163.1) |
| [Oracle Policy Automation for Mobile Devices, versions 12.2.0-12.2.24](#AppendixPOLI) | [Oracle Policy Automation](https://support.oracle.com/rs?type=doc&id=2876163.1) |
| [Oracle Product Lifecycle Analytics, version 3.6.1](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle REST Data Services, versions prior to 22.1.1](#AppendixREST) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Retail Allocation, versions 15.0.3.1, 16.0.3](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Bulk Data Integration, version 16.0.3](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Customer Insights, versions 15.0.2, 16.0.2](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Customer Management and Segmentation Foundation, versions 17.0, 18.0, 19.0](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Extract Transform and Load, version 13.2.5](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Financial Integration, versions 14.1.3.2, 15.0.3.1, 16.0.3, 19.0.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Integration Bus, versions 14.1.3.2, 15.0.3.1, 16.0.3, 19.0.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Merchandising System, versions 16.0.3, 19.0.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Order Broker, versions 18.0, 19.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Pricing, version 19.0.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Sales Audit, versions 15.0.3.1, 16.0.3](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle Retail Xstore Point of Service, versions 17.0.4, 18.0.3, 19.0.2, 20.0.1, 21.0.1](#AppendixRAPP) | [Retail Applications](https://support.oracle.com/rs?type=doc&id=2875760.1) |
| [Oracle SD-WAN Edge, versions 9.0, 9.1](#AppendixCGBU) | [Oracle SD-WAN Edge](https://support.oracle.com/rs?type=doc&id=2881968.1) |
| [Oracle Security Service, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle SOA Suite, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Solaris, versions 10, 11](#AppendixSUNS) | [Systems](https://support.oracle.com/rs?type=doc&id=2880043.1) |
| [Oracle Spatial Studio, versions prior to 22.1.0](#AppendixSPS) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle SQL Developer](#AppendixSQLD) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Stream Analytics, versions [19c] prior to 19.1.0.0.6.4](#AppendixGG) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle TimesTen In-Memory Database, versions prior to 22.1.1.1.0](#AppendixXTEN) | [Database](https://support.oracle.com/rs?type=doc&id=2867871.1) |
| [Oracle Transportation Management, version 1.4.4](#AppendixSCP) | [Oracle Supply Chain Products](https://support.oracle.com/rs?type=doc&id=2880762.1) |
| [Oracle Utilities Framework, versions 4.3.0.5.0, 4.3.0.6.0, 4.4.0.0.0, 4.4.0.2.0, 4.4.0.3.0, 4.5.0.0.0](#AppendixUTIL) | [Oracle Utilities Applications](https://support.oracle.com/rs?type=doc&id=2877520.1) |
| [Oracle VM VirtualBox, versions prior to 6.1.36](#AppendixOVIR) | [Virtualization](https://support.oracle.com/rs?type=doc&id=2879930.1) |
| [Oracle WebCenter Content, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle WebCenter Portal, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle WebCenter Sites Support Tools, versions 4.4.2 and prior](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle WebLogic Server, versions 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle Weblogic Server Proxy Plug-in, versions 12.2.1.3.0, 12.2.1.4.0](#AppendixFMW) | [Fusion Middleware](https://support.oracle.com/rs?type=doc&id=2880163.2) |
| [Oracle ZFS Storage Appliance Kit, version 8.8](#AppendixSUNS) | [Systems](https://support.oracle.com/rs?type=doc&id=2880043.1) |
| [PeopleSoft Enterprise PeopleTools, versions 8.58, 8.59](#AppendixPS) | [PeopleSoft](https://support.oracle.com/rs?type=doc&id=2880759.1) |
| [Primavera Gateway, versions 17.12.0-17.12.11, 18.8.0-18.8.14, 19.12.0-19.12.13, 20.12.0-20.12.8, 21.12.0-21.12.1](#AppendixPVA) | [Oracle Construction and Engineering Suite](https://support.oracle.com/rs?type=doc&id=2879713.1) |
| [Primavera P6 Enterprise Project Portfolio Management, versions 17.12.0.0-17.12.20.4, 18.8.0.0-18.8.25.4, 19.12.0.0-19.12.19.0, 20.12.0.0-20.12.14.0, 21.12.0.0-21.12.4.0](#AppendixPVA) | [Oracle Construction and Engineering Suite](https://support.oracle.com/rs?type=doc&id=2879713.1) |
| [Primavera Unifier, versions 17.7-17.12, 18.8, 19.12, 20.12, 21.12](#AppendixPVA) | [Oracle Construction and Engineering Suite](https://support.oracle.com/rs?type=doc&id=2879713.1) |
| [Siebel Applications, versions 22.6 and prior](#AppendixSECR) | [Siebel](https://support.oracle.com/rs?type=doc&id=2880773.1) |

#### Note:

* Vulnerabilities affecting Oracle Solaris may affect Oracle ZFSSA so Oracle customers should refer to the Oracle and Sun Systems Product Suite Critical Patch Update Knowledge Document, [My Oracle Support Note 2160904.1](https://support.oracle.com/rs?type=doc&id=2160904.1) for information on minimum revisions of security patches required to resolve ZFSSA issues published in Critical Patch Updates and Solaris Third Party bulletins.
* Solaris Third Party Bulletins are used to announce security patches for third party software distributed with Oracle Solaris. Solaris 10 customers should refer to the latest patch-sets which contain critical security patches detailed in Systems Patch Availability Document. Please see Reference Index of CVE IDs and Solaris Patches ([My Oracle Support Note 1448883.1](https://support.oracle.com/rs?type=doc&id=1448883.1)) for more information.
* Users running Java SE with a browser can download the latest release from <https://java.com>. Users on the Windows and Mac OS X platforms can also use [automatic updates](https://www.java.com/en/download/help/java_update.xml) to get the latest release.

### Risk Matrix Content

Risk matrices list only security vulnerabilities that are newly addressed by the patches associated with this advisory. Risk matrices for previous security patches can be found in [previous Critical Patch Update advisories and Alerts](https://www.oracle.com/security-alerts). An English text version of the risk matrices provided in this document is  [here](/security-alerts/cpujul2022verbose.html).

Several vulnerabilities addressed in this Critical Patch Update affect multiple products. Each vulnerability is identified by a [CVE#](https://cve.mitre.org/) which is its unique identifier. A vulnerability that affects multiple products will appear with the same CVE# in all risk matrices. A CVE# shown in *italics* indicates that this vulnerability impacts a different product, but also has impact on the product where the italicized CVE# is listed.

Security vulnerabilities are scored using CVSS version 3.1 (see [Oracle CVSS Scoring](/security-alerts/cvssscoringsystem.html) for an explanation of how Oracle applies CVSS version 3.1).

Oracle conducts an analysis of each security vulnerability addressed by a Critical Patch Update. Oracle does not disclose detailed information about this security analysis to customers, but the resulting Risk Matrix and associated documentation provide information about the type of vulnerability, the conditions required to exploit it, and the potential impact of a successful exploit. Oracle provides this information, in part, so that customers may conduct their own risk analysis based on the particulars of their product usage. For more information, see [Oracle vulnerability disclosure policies](https://www.oracle.com/us/support/assurance/disclosure-policies/index.html).

Oracle lists updates that address vulnerabilities in third-party components that are not exploitable in the context of their inclusion in their respective Oracle product beneath the product's risk matrix.

The protocol in the risk matrix implies that all of its secure variants (if applicable) are affected as well. For example, if HTTP is listed as an affected protocol, it implies that HTTPS (if applicable) is also affected. The secure variant of a protocol is listed in the risk matrix only if it is the *only* variant affected, e.g. HTTPS will typically be listed for vulnerabilities in SSL and TLS.

### Workarounds

**Due to the threat posed by a successful attack, Oracle strongly recommends that customers apply Critical Patch Update security patches as soon as possible**. Until you apply the Critical Patch Update patches, it may be possible to reduce the risk of successful attack by blocking network protocols required by an attack. For attacks that require certain privileges or access to certain packages, removing the privileges or the ability to access the packages from users that do not need the privileges may help reduce the risk of successful attack. Both approaches may break application functionality, so Oracle strongly recommends that customers test changes on non-production systems. Neither approach should be considered a long-term solution as neither corrects the underlying problem.

### Skipped Critical Patch Updates

Oracle strongly recommends that customers apply security patches as soon as possible. For customers that have skipped one or more Critical Patch Updates and are concerned about products that do not have security patches announced in this Critical Patch Update, please review [previous Critical Patch Update advisories](https://www.oracle.com/security-alerts) to determine appropriate actions.

### Critical Patch Update Supported Products and Versions

Patches released through the Critical Patch Update program are provided only for product versions that are covered under the Premier Support or Extended Support phases of the  [Lifetime Support Policy](https://www.oracle.com/us/support/lifetime-support/index.html?ssSourceSiteId=otnen). Oracle recommends that customers plan product upgrades to ensure that patches released through the Critical Patch Update program are available for the versions they are currently running.

Product releases that are not under Premier Support or Extended Support are not tested for the presence of vulnerabilities addressed by this Critical Patch Update. However, it is likely that earlier versions of affected releases are also affected by these vulnerabilities. As a result, Oracle recommends that customers upgrade to supported versions.

Database, Fusion Middleware, and Oracle Enterprise Manager products are patched in accordance with the Software Error Correction Support Policy explained in [My Oracle Support Note 209768.1](https://support.oracle.com/rs?type=doc&id=209768.1). Please review the [Technical Support Policies](https://www.oracle.com/us/support/policies/index.html?ssSourceSiteId=otnen) for further guidelines regarding support policies and phases of support.

### Credit Statement

The following people or organizations reported security vulnerabilities addressed by this Critical Patch Update to Oracle:

* 4ra1n: CVE-2022-21557, CVE-2022-21560, CVE-2022-21562, CVE-2022-21564
* Ahmed Alwardani: CVE-2022-21568
* Ahmed Shah of Red Canari: CVE-2022-21543
* Alexander Kornbrust of Red Database Security: CVE-2022-21510
* Anonymous researcher working with Trend Micro's Zero Day Initiative: CVE-2022-21550
* Eddie Zhu of Beijing DBSEC Technology Co., Ltd: CVE-2022-21511
* Emad Al-Mousa of Saudi Aramco: CVE-2022-21432
* Felix Wilhelm of Google: CVE-2022-34169
* Hugo Santiago dos Santos: CVE-2022-21575
* korean\_buljumuk: CVE-2022-21571
* Kun Yang of Chaitin Security Research Lab: CVE-2022-21554
* Liboheng of Tophant Starlight laboratory: CVE-2022-21548
* Lidor Ben Shitrit from Orca Security: CVE-2022-21551
* Lu Yu of Chaitin Security Research Lab: CVE-2022-21554
* M Talha Shafique: CVE-2022-21545
* Matthias Kaiser of Apple Information Security: CVE-2022-21516, CVE-2022-21536
* Nadeem Douba of Red Canari: CVE-2022-21543
* Orwa Atyat: CVE-2022-21567
* r00t4dm: CVE-2022-21523
* Ronnie Salomonsen of Mandiant Services: CVE-2022-21558
* Sanehdeep Singh: CVE-2022-21544
* thiscodecc of MoyunSec V-Lab: CVE-2022-21570
* Turki Al-harthi: CVE-2022-21567
* y4tacker: CVE-2022-21557
* Zacharias Pigadas of Foregenix: CVE-2022-21552
* Zu-Ming Jiang: CVE-2022-21556
* 潘宏弢: CVE-2022-21549

#### Security-In-Depth Contributors

Oracle acknowledges people who have contributed to our Security-In-Depth program (see [FAQ](/security-alerts/cpufaq.html)). People are acknowledged for Security-In-Depth contributions if they provide information, observations or suggestions pertaining to security vulnerability issues that result in significant modification of Oracle code or documentation in future releases, but are not of such a critical nature that they are distributed in Critical Patch Updates.

In this Critical Patch Update, Oracle recognizes the following for contributions to Oracle's Security-In-Depth program:

* Cheng Xu
* Dennis Katz
* Emad Al-Mousa of Saudi Aramco
* John Jackson
* Kelly Kaoudis
* Markus Loewe
* Nick Sahler
* Rizal Muhammed
* Sick Codes
* Stuart Monteith of Arm
* Victor Viale

#### On-Line Presence Security Contributors

Oracle acknowledges people who have contributed to our On-Line Presence Security program (see [FAQ](/security-alerts/cpufaq.html)). People are acknowledged for contributions relating to Oracle's on-line presence if they provide information, observations or suggestions pertaining to security-related issues that result in significant modification to Oracle's on-line external-facing systems.

For this quarter, Oracle recognizes the following for contributions to Oracle's On-Line Presence Security program:

* Ahmed Hassan
* Ekin Şiar Bayer
* Elad Gabay of Wiz.io
* Gabriel
* Hamoud Al-Helmani
* Hannu Forsten [3 reports]
* Heitor Gouvêa
* ilyas ORAK
* k0xx
* Lawrence See Yon Hoe
* Nikesh Gogia
* Paul Wise
* Semih Comak
* Shuvam Adhikari [2 reports]
* Siddhesh Parab
* tayyab sial
* wardi abdi
* Yassine Triki
* Zach Edwards of victorymedium.com

### Critical Patch Update Schedule

Critical Patch Updates are released on the third Tuesday of January, April, July, and October. The next four dates are:

* 18 October 2022
* 17 January 2023
* 18 April 2023
* 18 July 2023

### References

* [Oracle Critical Patch Updates, Security Alerts and Bulletins](https://www.oracle.com/security-alerts)
* [Critical Patch Update - July 2022 Documentation Map](https://support.oracle.com/rs?type=doc&id=2815521.1)
* [Oracle Critical Patch Updates and Security Alerts - Frequently Asked Questions](/security-alerts/cpufaq.html)
* [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)
* [Use of Common Vulnerability Scoring System (CVSS) by Oracle](/security-alerts/cvssscoringsystem.html)
* [English text version of the risk matrices](/security-alerts/cpujul2022verbose.html)
* [CVRF XML version of the risk matrices](https://www.oracle.com/docs/tech/security-alerts/cpujul2022cvrf.xml)
* [CSAF JSON version of the risk matrices](https://www.oracle.com/docs/tech/security-alerts/cpujul2022csaf.json)
* [Map of CVE to Advisory/Alert](/security-alerts/public-vuln-to-advisory-mapping.html)
* [Oracle Lifetime support Policy](https://www.oracle.com/support/lifetime-support/resources.html)
* [JEP 290 Reference Blocklist Filter](https://support.oracle.com/rs?type=doc&id=2591118.1)

### Modification History

| Date | Note |
| --- | --- |
| 2022-October-31 | Rev 4. Updated Credit section |
| 2022-July-28 | Rev 3. Updated the affected versions WebLogic CVE-2021-40690 |
| 2022-July-25 | Rev 2. Updated the version details for WebCenter Sites Support Tools and Credit added for CVE-2022-21551 |
| 2022-July-19 | Rev 1. Initial Release. |

#### Oracle Database Products Risk Matrices

This Critical Patch Update contains 23 new security patches for Oracle Database Products divided as follows:

* 9 new security patches for Oracle Database Products
* No new security patches for Oracle Autonomous Health Framework, but third party patches are provided
* No new security patches for Oracle Berkeley DB, but third party patches are provided
* 3 new security patches for Oracle Big Data Graph
* No new security patches for Oracle Blockchain Platform, but third party patches are provided
* 1 new security patch for Oracle Essbase
* 1 new security patch for Oracle Global Lifecycle Management
* 4 new security patches for Oracle GoldenGate
* 1 new security patch for Oracle Graph Server and Client
* No new security patches for Oracle NoSQL Database, but third party patches are provided
* 2 new security patches for Oracle REST Data Services
* 1 new security patch for Oracle Spatial Studio
* No new security patches for Oracle SQL Developer, but third party patches are provided
* 1 new security patch for Oracle TimesTen In-Memory Database

#### Oracle Database Server Risk Matrix

This Critical Patch Update contains 9 new security patches plus additional third party patches noted below for Oracle Database Products.  1 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  1 of these patches is applicable to client-only installations, i.e., installations that do not have the Oracle Database Server installed. The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#DB)

| CVE# | Component | Package and/or Privilege Required | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-35169 | Oracle Database - Enterprise Edition | None | TCPS | Yes | 9.1 | Network | Low | None | None | Un- changed | High | High | None | 12.1.0.2, 19c, 21c |  |
| CVE-2022-21510 | Oracle Database - Enterprise Edition Sharding | Local Logon | None | No | 8.8 | Local | Low | Low | None | Changed | High | High | High | None | See Note 1 |
| CVE-2022-21511 | Oracle Database - Enterprise Edition Recovery | EXECUTE ON DBMS\_IR.EXECUTESQLSCRIPT | Oracle Net | No | 7.2 | Network | Low | High | None | Un- changed | High | High | High | None | See Note 1 |
| CVE-2022-21565 | Java VM | Create Procedure | Oracle Net | No | 6.5 | Network | Low | Low | None | Un- changed | None | High | None | 12.1.0.2, 19c, 21c |  |
| CVE-2022-24729 | Oracle Application Express (CKEditor) | User Account | HTTP | No | 5.7 | Network | Low | Low | Required | Un- changed | None | None | High | Prior to 22.1.1 |  |
| CVE-2021-41184 | Oracle Application Express (jQueryUI) | User Account | HTTP | No | 5.4 | Network | Low | Low | Required | Changed | Low | Low | None | Prior to 22.1.1 |  |
| CVE-2022-0839 | Oracle SQLcl (Liquibase) | Local Logon | None | No | 5.0 | Local | Low | Low | Required | Un- changed | High | None | None | 19c |  |
| CVE-2021-45943 | Oracle Spatial and Graph (GDAL) | Create Session | Oracle Net | No | 4.3 | Network | Low | Low | None | Un- changed | None | None | Low | 19c, 21c |  |
| CVE-2022-21432 | Oracle Database - Enterprise Edition RDBMS Security | DBA role | Oracle Net | No | 2.7 | Network | Low | High | None | Un- changed | None | None | Low | 12.1.0.2, 19c, 21c |  |

#### Notes:

1. None of the supported versions are affected.

#### Additional CVEs addressed are:

* The patch for CVE-2020-35169 also addresses CVE-2020-26185, CVE-2020-29505, CVE-2020-29506, CVE-2020-29507, CVE-2020-29508, CVE-2020-35163, CVE-2020-35164, CVE-2020-35166, CVE-2020-35167, and CVE-2020-35168.
* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.
* The patch for CVE-2022-24729 also addresses CVE-2022-24728.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Database Enterprise Edition (Apache Tomcat): CVE-2022-29885.
* Oracle Universal Installer (jackson-databind): CVE-2020-36518.

#### Oracle Database Server Client-Only Installations

* The following Oracle Database Server vulnerability included in this Critical Patch Update affects client-only installations: CVE-2020-35169.

#### Oracle Autonomous Health Framework Risk Matrix

This Critical Patch Update contains no new security patches but does include third party patches noted below for Oracle Autonomous Health Framework.  Please refer to previous Critical Patch Update Advisories if the last Critical Patch Update was not applied for Oracle Autonomous Health Framework.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#AHTF)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| There are no exploitable vulnerabilities for these products. Third party patches for non-exploitable CVEs are noted below. | | | | | | | | | | | | | | | |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Autonomous Health Framework
  + Autonomous Health Framework (NumPy): CVE-2021-41496 and CVE-2021-41495.
  + Autonomous Health Framework (Python): CVE-2021-29921 and CVE-2020-29396.
  + Trace File Analyzer (jackson-databind): CVE-2020-36518.

#### Oracle Berkeley DB Risk Matrix

This Critical Patch Update contains no new security patches but does include third party patches noted below for Oracle Berkeley DB.  Please refer to previous Critical Patch Update Advisories if the last Critical Patch Update was not applied for Oracle Berkeley DB.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#BDB)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| There are no exploitable vulnerabilities for these products. Third party patches for non-exploitable CVEs are noted below. | | | | | | | | | | | | | | | |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Berkeley DB Data Store
  + Data Store (Apache Log4j): CVE-2022-23305, CVE-2021-4104, CVE-2022-23302 and CVE-2022-23307.

#### Oracle Big Data Graph Risk Matrix

This Critical Patch Update contains 3 new security patches for Oracle Big Data Graph.  All of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#BGDG)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-42340 | Big Data Spatial and Graph | Big Data Graph (Apache Tomcat) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | Prior to 23.1 |  |
| CVE-2020-36518 | Big Data Spatial and Graph | Big Data Graph (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | Prior to 23.1 |  |
| CVE-2021-41184 | Big Data Spatial and Graph | Big Data Graph (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | Prior to 23.1 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.

#### Oracle Blockchain Platform Risk Matrix

This Critical Patch Update contains no new security patches but does include third party patches noted below for Oracle Blockchain Platform.  Please refer to previous Critical Patch Update Advisories if the last Critical Patch Update was not applied for Oracle Blockchain Platform.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#BP)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| There are no exploitable vulnerabilities for these products. Third party patches for non-exploitable CVEs are noted below. | | | | | | | | | | | | | | | |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Blockchain Platform
  + Blockchain Cloud Service Console (OpenSSH): CVE-2021-41617.

#### Oracle Essbase Risk Matrix

This Critical Patch Update contains 1 new security patch for Oracle Essbase.  This vulnerability is not remotely exploitable without authentication, i.e., may not be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#ESSB)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-21508 | Oracle Essbase | Security and Provisioning | None | No | 5.8 | Local | Low | High | Required | Un- changed | High | High | None | 21.3 |  |

#### Oracle Global Lifecycle Management Risk Matrix

This Critical Patch Update contains 1 new security patch plus additional third party patches noted below for Oracle Global Lifecycle Management.  This vulnerability is not remotely exploitable without authentication, i.e., may not be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#GLM)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-23437 | Oracle Global Lifecycle Management OPatch | Patch Installer (Apache Xerces-J) | Local Logon | No | 4.2 | Local | Low | High | Required | Un- changed | None | None | High | Prior to 12.2.0.1.30 |  |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Global Lifecycle Management OPatch
  + Patch Installer (jackson-databind): CVE-2020-36518.

#### Oracle GoldenGate Risk Matrix

This Critical Patch Update contains 4 new security patches plus additional third party patches noted below for Oracle GoldenGate.  2 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#GG)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-3749 | Oracle GoldenGate | Oracle GoldenGate (axios) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 21c: prior to 21.7.0.0.0 |  |
| CVE-2022-21551 | Oracle GoldenGate | Oracle GoldenGate | HTTP | No | 6.8 | Network | Low | High | Required | Un- changed | High | High | High | 21c: prior to 21.7.0.0.0; 19c: prior to 19.1.0.0.220719 |  |
| CVE-2021-34429 | Oracle Stream Analytics | Oracle Stream Analytics (Eclipse Jetty) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | 19c: prior to 19.1.0.0.6.4 |  |
| CVE-2021-37714 | Oracle Stream Analytics | Oracle Stream Analytics (jsoup) | HTTP | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 19c: prior to 19.1.0.0.6.4 |  |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle GoldenGate
  + General (Apache Log4j): CVE-2022-23307, CVE-2019-17571, CVE-2021-4104, CVE-2022-23302 and CVE-2022-23305.
  + Oracle GoldenGate (zlib): CVE-2018-25032.
* Oracle Stream Analytics
  + Install (Apache Log4j): CVE-2022-23305, CVE-2019-17571, CVE-2021-4104, CVE-2022-23302 and CVE-2022-23307.

#### Oracle Graph Server and Client Risk Matrix

This Critical Patch Update contains 1 new security patch plus additional third party patches noted below for Oracle Graph Server and Client.  This vulnerability is not remotely exploitable without authentication, i.e., may not be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#GSC)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-36518 | Oracle Graph Server and Client | Oracle Graph Server (jackson-databind) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | Prior to 22.2.0 |  |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Graph Server and Client
  + Install (Apache Tomcat): CVE-2022-23181 and CVE-2020-9484.

#### Oracle NoSQL Database Risk Matrix

This Critical Patch Update contains no new security patches but does include third party patches noted below for Oracle NoSQL Database.  Please refer to previous Critical Patch Update Advisories if the last Critical Patch Update was not applied for Oracle NoSQL Database.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#NSQL)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| There are no exploitable vulnerabilities for these products. Third party patches for non-exploitable CVEs are noted below. | | | | | | | | | | | | | | | |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle NoSQL Database
  + Administration (Netty): CVE-2021-43797.

#### Oracle REST Data Services Risk Matrix

This Critical Patch Update contains 2 new security patches for Oracle REST Data Services.  Both of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#REST)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-41184 | Oracle REST Data Services | Oracle REST Data Services (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | Prior to 22.1.1 |  |
| CVE-2021-34429 | Oracle REST Data Services | Oracle REST Data Services (Eclipse Jetty) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | Prior to 22.1.1 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.

#### Oracle Spatial Studio Risk Matrix

This Critical Patch Update contains 1 new security patch for Oracle Spatial Studio.  This vulnerability is not remotely exploitable without authentication, i.e., may not be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#SPS)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-36518 | Oracle Spatial Studio | Oracle Spatial Studio (jackson-databind) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | Prior to 22.1.0 |  |

#### Oracle SQL Developer Risk Matrix

This Critical Patch Update contains no new security patches but does include third party patches noted below for Oracle SQL Developer.  Please refer to previous Critical Patch Update Advisories if the last Critical Patch Update was not applied for Oracle SQL Developer.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#SQLD)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| There are no exploitable vulnerabilities for these products. Third party patches for non-exploitable CVEs are noted below. | | | | | | | | | | | | | | | |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle SQL Developer
  + Oracle SQL Developer (Apache PDFBox): CVE-2021-31812 and CVE-2021-31811.

#### Oracle TimesTen In-Memory Database Risk Matrix

This Critical Patch Update contains 1 new security patch plus additional third party patches noted below for Oracle TimesTen In-Memory Database.  This vulnerability is remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#XTEN)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-2351 | Oracle TimesTen In-Memory Database | Oracle TimesTen In-Memory Database Cache | Oracle Net | Yes | 8.3 | Network | High | None | Required | Changed | High | High | High | Prior to 22.1.1.1.0 |  |

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle TimesTen In-Memory Database
  + Kubernetes Operator (Go): CVE-2022-23806, CVE-2021-41771, CVE-2021-41772, CVE-2022-23772 and CVE-2022-23773.
  + TimesTen Grid (Apache Log4j): CVE-2022-23305, CVE-2021-4104, CVE-2022-23302 and CVE-2022-23307.

#### Oracle Commerce Risk Matrix

This Critical Patch Update contains 12 new security patches for Oracle Commerce.  10 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#OCOM)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-10683 | Oracle Commerce Guided Search | Content Acquisition System (dom4j) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 11.3.2 |  |
| CVE-2019-17495 | Oracle Commerce Guided Search | Framework, Experience Manager (Swagger UI) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 11.3.2 |  |
| CVE-2022-22965 | Oracle Commerce Platform | Endeca Integration (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 11.3.2 |  |
| CVE-2020-28052 | Oracle Commerce Guided Search | Framework, Experience Manager (Bouncy Castle Java Library) | HTTPS | Yes | 8.1 | Network | High | None | None | Un- changed | High | High | High | 11.3.2 |  |
| CVE-2021-40690 | Oracle Commerce Guided Search | Content Acquisition System (Apache CXF) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 11.3.2 |  |
| CVE-2021-22946 | Oracle Commerce Guided Search | Framework, Experience Manager (cURL) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 11.3.2 |  |
| CVE-2022-24729 | Oracle Commerce Merchandising | Core (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 11.3.2 |  |
| CVE-2020-36518 | Oracle Commerce Platform | Dynamo Application Framework (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 11.3.0, 11.3.1, 11.3.2 |  |
| CVE-2021-40690 | Oracle Commerce Platform | Endeca Integration (Apache CXF) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 11.3.2 |  |
| CVE-2021-3450 | Oracle Commerce Guided Search | Framework, Experience Manager (OpenSSL) | TLS | Yes | 7.4 | Network | High | None | None | Un- changed | High | High | None | 11.3.2 |  |
| CVE-2020-7712 | Oracle Commerce Guided Search | Framework, Experience Manager (Apache ZooKeeper) | HTTP | No | 7.2 | Network | Low | High | None | Un- changed | High | High | High | 11.3.2 |  |
| CVE-2022-21559 | Oracle Commerce Platform | Dynamo Application Framework | None | No | 5.5 | Local | Low | Low | None | Un- changed | High | None | None | 11.3.0, 11.3.1, 11.3.2 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-22946 also addresses CVE-2021-22947.
* The patch for CVE-2021-3450 also addresses CVE-2021-3449.
* The patch for CVE-2022-24729 also addresses CVE-2022-24728.

#### Oracle Communications Applications Risk Matrix

This Critical Patch Update contains 17 new security patches plus additional third party patches noted below for Oracle Communications Applications.  12 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#CAGBU)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-23305 | Oracle Communications Instant Messaging Server | XMPP Server (Apache Log4j) | XMPP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 10.0.1.5.0 |  |
| CVE-2022-23305 | Oracle Communications Offline Mediation Controller | Charging Server (Apache Log4j) | LDAP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | Prior to 12.0.0.4.4, Prior to 12.0.0.5.1 |  |
| CVE-2022-23632 | Oracle Communications Unified Inventory Management | Cloud Native (Traefik) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 7.5.0 |  |
| CVE-2022-22965 | Oracle Communications Unified Inventory Management | TMF APIs (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 7.4.1, 7.4.2, 7.5.0 |  |
| CVE-2022-21429 | Oracle Communications Billing and Revenue Management | Billing Care | HTTP | Yes | 8.1 | Network | High | None | None | Un- changed | High | High | High | 12.0.0.4.0-12.0.0.6.0 |  |
| CVE-2020-36518 | Oracle Communications Billing and Revenue Management | Billing Care, BOC, DM Kafka, REST API (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.0.0.4.0-12.0.0.6.0 |  |
| CVE-2021-37137 | Oracle Communications BRM - Elastic Charging Engine | 5G gateway (Google Snappy) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | Prior to 12.0.0.4.6, Prior to 12.0.0.5.1 |  |
| CVE-2021-43859 | Oracle Communications BRM - Elastic Charging Engine | EM Gateway (XStream) | TCP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | Prior to 12.0.0.4.6, Prior to 12.0.0.5.1 |  |
| CVE-2021-44832 | Oracle Communications BRM - Elastic Charging Engine | Charging Server (Apache Log4j) | TCP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | Prior to 12.0.0.4.6, Prior to 12.0.0.5.1 |  |
| CVE-2021-44832 | Oracle Communications Offline Mediation Controller | Admin Server and Node Manager (Apache Log4j) | LDAP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | Prior to 12.0.0.4.4, Prior to 12.0.0.5.1 |  |
| CVE-2022-23437 | Oracle Communications ASAP | SRT (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 7.3 |  |
| CVE-2022-21573 | Oracle Communications Billing and Revenue Management | Billing Care | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 12.0.0.4.0-12.0.0.6.0 |  |
| CVE-2021-43797 | Oracle Communications Design Studio | PSR Designer (Netty) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | High | None | 7.4.2 |  |
| CVE-2022-22969 | Oracle Communications Design Studio | Patch Request (Spring Security OAuth) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 7.4.2 |  |
| CVE-2021-38153 | Oracle Communications BRM - Elastic Charging Engine | Notifications (Apache Kafka) | TCP | Yes | 5.9 | Network | High | None | None | Un- changed | High | None | None | Prior to 12.0.0.4.6, Prior to 12.0.0.5.1 |  |
| CVE-2022-21572 | Oracle Communications Billing and Revenue Management | Billing Care | HTTP | No | 5.4 | Network | Low | Low | Required | Changed | Low | Low | None | 12.0.0.4.0-12.0.0.6.0 |  |
| CVE-2022-21574 | Oracle Communications Billing and Revenue Management | Connection Manager | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | None | None | Low | 12.0.0.4.0-12.0.0.6.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-37137 also addresses CVE-2021-37136.
* The patch for CVE-2021-38153 also addresses CVE-2021-26291.
* The patch for CVE-2022-23305 also addresses CVE-2021-4104, CVE-2022-23302, and CVE-2022-23307.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Communications BRM - Elastic Charging Engine
  + Charging Server (Spring Framework): CVE-2022-22965.
* Oracle Communications IP Service Activator
  + Network Processor (Apache Xerces-J): CVE-2022-23437.

#### Oracle Communications Risk Matrix

This Critical Patch Update contains 56 new security patches plus additional third party patches noted below for Oracle Communications.  45 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#CGBU)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-22947 | Oracle Communications Cloud Native Core Binding Support Function | BSF (Spring Cloud Gateway) | HTTP | Yes | 10.0 | Network | Low | None | None | Changed | High | High | High | 22.1.3 |  |
| CVE-2022-22947 | Oracle Communications Cloud Native Core Console | CNC Console (Spring Cloud Gateway) | HTTP | Yes | 10.0 | Network | Low | None | None | Changed | High | High | High | 22.2.0 |  |
| CVE-2022-22947 | Oracle Communications Cloud Native Core Network Repository Function | NRF (Spring Cloud Gateway) | HTTP | Yes | 10.0 | Network | Low | None | None | Changed | High | High | High | 22.1.2, 22.2.0 |  |
| CVE-2022-22947 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (Spring Cloud Gateway) | HTTP | Yes | 10.0 | Network | Low | None | None | Changed | High | High | High | 22.1.1 |  |
| CVE-2022-22965 | Oracle Communications Cloud Native Core Binding Support Function | BSF (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.3 |  |
| CVE-2022-23219 | Oracle Communications Cloud Native Core Binding Support Function | BSF (glibc) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.3 |  |
| CVE-2022-1154 | Oracle Communications Cloud Native Core Network Exposure Function | NEF (vim) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.1 |  |
| CVE-2020-14343 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (PyYAML) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.0 |  |
| CVE-2021-3177 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (Python) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-23219 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (glibc) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.0 |  |
| CVE-2022-22963 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | DBTier (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.2 |  |
| CVE-2022-23219 | Oracle Communications Cloud Native Core Network Repository Function | NRF (glibc) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.2, 22.2.0 |  |
| CVE-2022-22963 | Oracle Communications Cloud Native Core Policy | Policy (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.3 |  |
| CVE-2022-23219 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (glibc) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.1.1 |  |
| CVE-2022-25845 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (fastjson) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-23219 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (glibc) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-23219 | Oracle Enterprise Operations Monitor | Mediation Engine (glibc) | TCP/IP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 4.3, 4.4, 5.0 |  |
| CVE-2022-24407 | Oracle Communications Cloud Native Core Console | CNC Console (Cyrus SASL) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-24407 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (Cyrus SASL) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-24407 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (Cyrus SASL) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 22.1.1 |  |
| CVE-2022-25636 | Oracle Communications Cloud Native Core Binding Support Function | Oracle Linux | None | No | 7.8 | Local | Low | Low | None | Un- changed | High | High | High | 22.1.3 |  |
| CVE-2022-25636 | Oracle Communications Cloud Native Core Network Exposure Function | Oracle Linux | None | No | 7.8 | Local | Low | Low | None | Un- changed | High | High | High | 22.1.1 |  |
| CVE-2022-25636 | Oracle Communications Cloud Native Core Policy | Oracle Linux | None | No | 7.8 | Local | Low | Low | None | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2022-24735 | Oracle Communications Operations Monitor | Fraud Detection Monitor (Redis) | None | No | 7.8 | Local | Low | None | Required | Un- changed | High | High | High | 4.3, 4.4, 5.0 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Binding Support Function | BSF (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.3 |  |
| CVE-2022-23308 | Oracle Communications Cloud Native Core Binding Support Function | BSF (libxml2) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2018-25032 | Oracle Communications Cloud Native Core Console | CNC Console (zlib) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.2 |  |
| CVE-2018-25032 | Oracle Communications Cloud Native Core Network Exposure Function | NEF (zlib) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2019-20916 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (Package Installer for Python) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | High | None | 22.1.0 |  |
| CVE-2022-23308 | Oracle Communications Cloud Native Core Network Function Cloud Native Environment | CNE (libxml2) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.0 |  |
| CVE-2021-22119 | Oracle Communications Cloud Native Core Network Repository Function | NRF (Spring Security) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.2, 22.2.0 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Network Repository Function | NRF (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.2, 22.2.0 |  |
| CVE-2022-23308 | Oracle Communications Cloud Native Core Network Repository Function | NRF (libxml2) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.2, 22.2.0 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Network Slice Selection Function | NSSF (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2022-23308 | Oracle Communications Cloud Native Core Network Slice Selection Function | NSSF (libxml2) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2018-25032 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (zlib) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2022-0778 | Oracle Communications Cloud Native Core Security Edge Protection Proxy | SEPP (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Service Communication Proxy | SCP (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2020-36518 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2022-23308 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (libxml2) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2018-25032 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (zlib) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2022-0778 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 22.2.0 |  |
| CVE-2022-0778 | Oracle Communications Core Session Manager | Security (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.2.5, 8.4.5 |  |
| CVE-2022-0778 | Oracle Communications Operations Monitor | Mediation Engine (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 4.3, 4.4, 5.0 |  |
| CVE-2022-0778 | Oracle Communications Session Border Controller | Security (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.4, 9.0, 9.1 |  |
| CVE-2022-0778 | Oracle Communications Unified Session Manager | Security (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.2.5 |  |
| CVE-2022-0778 | Oracle Enterprise Communications Broker | Security (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 3.3 |  |
| CVE-2022-0778 | Oracle Enterprise Session Border Controller | Security (OpenSSL) | TLS | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.4, 9.0, 9.1 |  |
| CVE-2020-36518 | Oracle SD-WAN Edge | MGMT (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 9.0, 9.1 |  |
| CVE-2022-1271 | Oracle Communications Cloud Native Core Console | CNC Console (GNU Gzip) | HTTP | No | 7.1 | Network | High | Low | Required | Un- changed | High | High | High | 22.1.2 |  |
| CVE-2022-1271 | Oracle Communications Cloud Native Core Unified Data Repository | UDR (GNU Gzip) | HTTP | No | 7.1 | Network | High | Low | Required | Un- changed | High | High | High | 22.2.0 |  |
| CVE-2021-37750 | Oracle Communications Cloud Native Core Network Slice Selection Function | NSSF (MIT Kerberos) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 22.1.1 |  |
| CVE-2021-3572 | Oracle Communications Cloud Native Core Policy | Policy (Package Installer for Python) | HTTP | No | 5.7 | Network | Low | Low | Required | Un- changed | None | High | None | 22.1.3 |  |
| CVE-2022-24329 | Oracle Communications Cloud Native Core Binding Support Function | BSF (JetBrains Kotlin) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | None | Low | None | 22.1.3 |  |
| CVE-2021-34141 | Oracle Communications Cloud Native Core Policy | Policy (NumPy) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | None | None | Low | 22.1.3 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2019-20916 also addresses CVE-2021-3572.
* The patch for CVE-2020-14343 also addresses CVE-2020-1747.
* The patch for CVE-2021-3177 also addresses CVE-2018-18074, CVE-2019-20916, CVE-2019-9636, CVE-2019-9740, CVE-2020-26137, and CVE-2020-27619.
* The patch for CVE-2022-22947 also addresses CVE-2022-22946, and CVE-2022-22965.
* The patch for CVE-2022-22963 also addresses CVE-2022-22965.
* The patch for CVE-2022-23219 also addresses CVE-2021-38604, CVE-2021-43396, and CVE-2022-23218.
* The patch for CVE-2022-24735 also addresses CVE-2022-24736.
* The patch for CVE-2022-25636 also addresses CVE-2018-25032, CVE-2020-0404, CVE-2020-13974, CVE-2020-27820, CVE-2020-4788, CVE-2021-20322, CVE-2021-21781, CVE-2021-29154, CVE-2021-3612, CVE-2021-3672, CVE-2021-37159, CVE-2021-3737, CVE-2021-3743, CVE-2021-3744, CVE-2021-3752, CVE-2021-3772, CVE-2021-3773, CVE-2021-4002, CVE-2021-4083, CVE-2021-4157, CVE-2021-4197, CVE-2021-4203, CVE-2021-42739, CVE-2021-43389, CVE-2021-43818, CVE-2021-43976, CVE-2021-45485, CVE-2021-45486, CVE-2022-0001, CVE-2022-0002, CVE-2022-0286, CVE-2022-0322, and CVE-2022-1011.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle Communications Cloud Native Core Network Slice Selection Function
  + NSSF (glibc): CVE-2022-23219, CVE-2021-38604, CVE-2021-43396 and CVE-2022-23218.
* Oracle Communications Cloud Native Core Security Edge Protection Proxy
  + SEPP (Spring Framework): CVE-2022-22968 and CVE-2022-22965.
* Oracle Communications Cloud Native Core Service Communication Proxy
  + SCP (Spring Boot): CVE-2022-22968 and CVE-2022-22965.
* Oracle Communications Cloud Native Core Unified Data Repository
  + UDR (Libgcrypt): CVE-2021-33560.

#### Oracle Construction and Engineering Risk Matrix

This Critical Patch Update contains 7 new security patches plus additional third party patches noted below for Oracle Construction and Engineering.  4 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#PVA)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-21558 | Oracle Crystal Ball | Installation | None | No | 7.8 | Local | High | Low | None | Changed | High | High | High | 11.1.2.0.000-11.1.2.4.900 |  |
| CVE-2020-36518 | Primavera Gateway | Admin (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 17.12.0-17.12.11, 18.8.0-18.8.14, 19.12.0-19.12.13, 20.12.0-20.12.8, 21.12.0-21.12.1 |  |
| CVE-2020-36518 | Primavera Unifier | Document Management (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 17.7-17.12, 18.8, 19.12, 20.12, 21.12 |  |
| CVE-2022-23437 | Primavera Gateway | Admin (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 17.12.0-17.12.11, 18.8.0-18.8.14, 19.12.0-19.12.13, 20.12.0-20.12.8 |  |
| CVE-2020-36518 | Primavera P6 Enterprise Project Portfolio Management | Web Access (jackson-databind) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 17.12.0.0-17.12.20.4, 18.8.0.0-18.8.25.4, 19.12.0.0-19.12.19.0, 20.12.0.0-20.12.14.0, 21.12.0.0-21.12.4.0 |  |
| CVE-2022-23437 | Primavera Unifier | Platform, User Interface (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 17.7-17.12, 18.8, 19.12, 20.12, 21.12 |  |
| CVE-2022-30126 | Primavera Unifier | Document Management (Apache Tika) | None | No | 5.5 | Local | Low | None | Required | Un- changed | None | None | High | 17.7-17.12, 18.8, 19.12, 20.12, 21.12 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2022-30126 also addresses CVE-2021-33813, and CVE-2022-25169.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Primavera Gateway
  + Admin (Spring Framework): CVE-2022-22965.

#### Oracle E-Business Suite Risk Matrix

This Critical Patch Update contains 6 new security patches for Oracle E-Business Suite.  5 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#EBS)

Oracle E-Business Suite products include Oracle Database and Oracle Fusion Middleware components that are affected by the vulnerabilities listed in the Oracle Database and Oracle Fusion Middleware sections. The exposure of Oracle E-Business Suite products is dependent on the Oracle Database and Oracle Fusion Middleware versions being used. Oracle Database and Oracle Fusion Middleware security updates are not listed in the Oracle E-Business Suite risk matrix. However, since vulnerabilities affecting Oracle Database and Oracle Fusion Middleware versions may affect Oracle E-Business Suite products, Oracle recommends that customers apply the July 2022 Critical Patch Update to the Oracle Database and Oracle Fusion Middleware components of Oracle E-Business Suite. For information on what patches need to be applied to your environments, refer to Oracle E-Business Suite Release 12 Critical Patch Update Knowledge Document (July 2022), [My Oracle Support Note 2484000.1](https://support.oracle.com/rs?type=doc&id=2484000.1).

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-23305 | Oracle E-Business Suite Information Discovery | Packaging issues (Apache Log4j) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.2.3-12.2.11 |  |
| CVE-2022-21566 | Oracle Applications Framework | Diagnostics | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 12.2.9-12.2.11 |  |
| CVE-2022-21500 | Oracle User Management | Proxy User Delegation | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 12.2.4-12.2.11 |  |
| CVE-2022-21567 | Oracle Workflow | Worklist | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 12.2.3-12.2.11 |  |
| CVE-2022-21568 | Oracle iReceivables | Access Request | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | High | None | None | 12.2.3-12.2.11 |  |
| CVE-2022-21545 | Oracle iRecruitment | Candidate Self Service Registration | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | 12.2.3-12.2.11 |  |

#### Oracle Enterprise Manager Risk Matrix

This Critical Patch Update contains 6 new security patches plus additional third party patches noted below for Oracle Enterprise Manager.  All of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  None of these patches are applicable to client-only installations, i.e., installations that do not have Oracle Enterprise Manager installed. The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#EM)

Oracle Enterprise Manager products include Oracle Database and Oracle Fusion Middleware components that are affected by the vulnerabilities listed in the Oracle Database and Oracle Fusion Middleware sections. The exposure of Oracle Enterprise Manager products is dependent on the Oracle Database and Oracle Fusion Middleware versions being used. Oracle Database and Oracle Fusion Middleware security updates are not listed in the Oracle Enterprise Manager risk matrix. However, since vulnerabilities affecting Oracle Database and Oracle Fusion Middleware versions may affect Oracle Enterprise Manager products, Oracle recommends that customers apply the July 2022 Critical Patch Update to the Oracle Database and Oracle Fusion Middleware components of Enterprise Manager. For information on what patches need to be applied to your environments, refer to Critical Patch Update July 2022 Patch Availability Document for Oracle Products, [My Oracle Support Note 2867874.1](https://support.oracle.com/rs?type=doc&id=2867874.1).

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-22721 | Enterprise Manager Ops Center | Networking (Apache HTTP Server) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.4.0.0 |  |
| CVE-2022-1292 | Enterprise Manager Ops Center | Networking (OpenSSL) | HTTPS | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.4.0.0 |  |
| CVE-2022-21536 | Enterprise Manager Base Platform | Policy Framework | HTTP | Yes | 8.1 | Network | High | None | None | Un- changed | High | High | High | 13.4.0.0, 13.5.0.0 |  |
| CVE-2020-5258 | Oracle Application Testing Suite | Load Testing for Web Apps (Dojo) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | High | None | 13.3.0.1 |  |
| CVE-2022-21516 | Enterprise Manager Base Platform | Enterprise Manager Install | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 13.4.0.0, 13.5.0.0 |  |
| CVE-2022-29577 | Enterprise Manager Base Platform | Enterprise Manager Install (AntiSamy) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 13.4.0.0, 13.5.0.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2022-1292 also addresses CVE-2021-4160, and CVE-2022-0778.
* The patch for CVE-2022-22721 also addresses CVE-2022-22720.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Enterprise Manager for MySQL Database
  + EM Plugin: General (Spring Framework): CVE-2022-22965.

#### Oracle Financial Services Applications Risk Matrix

This Critical Patch Update contains 59 new security patches for Oracle Financial Services Applications.  38 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#IFLX)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-22963 | Oracle Banking Branch | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Cash Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Corporate Lending Process Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Credit Facilities Process Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Electronic Data Exchange for Corporates | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Liquidity Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.2, 14.5 |  |
| CVE-2022-22963 | Oracle Banking Origination | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Supply Chain Finance | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Trade Finance Process Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2022-22963 | Oracle Banking Virtual Account Management | Common (Spring Cloud Function) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.5 |  |
| CVE-2021-41303 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Shiro) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2018-1273 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Spring Data Commons) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-22978 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Spring Security) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2020-9492 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Hadoop) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2020-9492 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Solr) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-24729 | Oracle Financial Services Analytical Applications Infrastructure | Others (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0-8.1.0.0, 8.1.1.0, 8.1.2.0, 8.1.2.1 |  |
| CVE-2020-36518 | Oracle Financial Services Analytical Applications Infrastructure | Others (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0-8.1.0.0, 8.1.1.0, 8.1.2.0, 8.1.2.1 |  |
| CVE-2022-24729 | Oracle Financial Services Behavior Detection Platform | Third Party (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0, 8.0.8.0, 8.1.1.0-8.1.2.1 |  |
| CVE-2020-36518 | Oracle Financial Services Behavior Detection Platform | Web UI (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0, 8.0.8.0, 8.1.1.0-8.1.2.1 |  |
| CVE-2021-36090 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Commons Compress) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2021-38296 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Spark) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-25647 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Google GSON) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2020-36518 | Oracle Financial Services Crime and Compliance Management Studio | Studio (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2021-37714 | Oracle Financial Services Crime and Compliance Management Studio | Studio (jsoup) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-24729 | Oracle Financial Services Enterprise Case Management | Installers (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.1, 8.0.7.2, 8.0.8.0, 8.0.8.1, 8.1.1.0-8.1.2.1 |  |
| CVE-2020-36518 | Oracle Financial Services Enterprise Case Management | Installers (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.1, 8.0.7.2, 8.0.8.0, 8.0.8.1, 8.1.1.0-8.1.2.1 |  |
| CVE-2022-24729 | Oracle Financial Services Trade-Based Anti Money Laundering Enterprise Edition | User Interface (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0, 8.0.8.0 |  |
| CVE-2020-36518 | Oracle Financial Services Trade-Based Anti Money Laundering Enterprise Edition | User Interface (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.7.0, 8.0.8.0 |  |
| CVE-2021-40690 | Oracle FLEXCUBE Private Banking | Infrastructure (Apache Santuario XML Security For Java) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 12.1 |  |
| CVE-2021-43859 | Oracle FLEXCUBE Private Banking | Infrastructure (XStream) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.1 |  |
| CVE-2020-7712 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache ZooKeeper) | HTTP | No | 7.2 | Network | Low | High | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2021-23337 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Lodash) | HTTP | No | 7.2 | Network | Low | High | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-21544 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 7.1 | Network | High | Low | Required | Un- changed | High | High | High | 12.1-12.4, 14.0-14.3, 14.5 |  |
| CVE-2022-23181 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Tomcat) | None | No | 7.0 | Local | High | Low | None | Un- changed | High | High | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-21582 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 6.7 | Network | High | Low | Required | Un- changed | High | High | Low | 14.5 |  |
| CVE-2022-21585 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 6.7 | Network | High | Low | Required | Un- changed | High | High | Low | 14.5 |  |
| CVE-2022-21428 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 6.7 | Network | High | Low | Required | Un- changed | High | High | Low | 12.1-12.4, 14.0-14.3, 14.5 |  |
| CVE-2022-21578 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 6.7 | Network | High | Low | Required | Un- changed | High | High | Low | 12.1-12.4, 14.0-14.3, 14.5 |  |
| CVE-2021-44832 | Oracle FLEXCUBE Private Banking | Infrastructure (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 12.1 |  |
| CVE-2022-23437 | Oracle Banking Deposits and Lines of Credit Servicing | Web UI (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 2.7 |  |
| CVE-2021-43797 | Oracle Banking Deposits and Lines of Credit Servicing | Web UI (Netty) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | High | None | 2.7 |  |
| CVE-2022-23437 | Oracle Banking Party Management | Web UI (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 2.7 |  |
| CVE-2021-43797 | Oracle Banking Party Management | Web UI (Netty) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | High | None | 2.7 |  |
| CVE-2021-43797 | Oracle Banking Platform | SECURITY (Netty) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | High | None | 2.6.2 |  |
| CVE-2022-23437 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-22971 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Spring Framework) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2022-23437 | Oracle FLEXCUBE Universal Banking | Infrastructure (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 12.4 |  |
| CVE-2022-21583 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 6.4 | Network | High | Low | None | Un- changed | High | Low | Low | 14.5 |  |
| CVE-2022-21584 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 6.4 | Network | High | Low | Required | Un- changed | High | High | None | 14.5 |  |
| CVE-2022-21586 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 6.4 | Network | High | Low | Required | Un- changed | High | High | None | 14.5 |  |
| CVE-2022-21576 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 6.4 | Network | High | Low | None | Un- changed | High | Low | Low | 12.3, 12.4, 14.0-14.3, 14.5 |  |
| CVE-2022-21577 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 6.4 | Network | High | Low | Required | Un- changed | High | High | None | 12.1-12.4, 14.0-14.3, 14.5 |  |
| CVE-2022-21579 | Oracle FLEXCUBE Universal Banking | Infrastructure | HTTP | No | 6.4 | Network | High | Low | Required | Un- changed | High | High | None | 12.1-12.4, 14.0-14.3, 14.5 |  |
| CVE-2021-41184 | Oracle Banking Platform | SECURITY (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 2.9, 2.12 |  |
| CVE-2022-21581 | Oracle Banking Trade Finance | Infrastructure | HTTP | No | 5.9 | Network | High | Low | Required | Un- changed | Low | High | Low | 14.5 |  |
| CVE-2022-21580 | Oracle Financial Services Revenue Management and Billing | Infrastructure | HTTP | No | 5.9 | Network | High | Low | Required | Un- changed | High | Low | Low | 2.9.0.0.0, 2.9.0.1.0, 3.0.0.0.0-3.2.0.0.0, 4.0.0.0.0 |  |
| CVE-2022-24823 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Netty) | None | No | 5.5 | Local | Low | Low | None | Un- changed | High | None | None | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2021-34429 | Oracle Financial Services Crime and Compliance Management Studio | Studio (Eclipse Jetty) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | 8.0.8.2.0, 8.0.8.3.0 |  |
| CVE-2021-29425 | Oracle FLEXCUBE Core Banking | Securities (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 5.2, 11.6-11.8, 11.10 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2018-1273 also addresses CVE-2018-1259, and CVE-2018-1274.
* The patch for CVE-2021-23337 also addresses CVE-2020-28500.
* The patch for CVE-2021-36090 also addresses CVE-2021-35515, CVE-2021-35516, and CVE-2021-35517.
* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.
* The patch for CVE-2022-22971 also addresses CVE-2022-22970.
* The patch for CVE-2022-22978 also addresses CVE-2022-22976.
* The patch for CVE-2022-24729 also addresses CVE-2022-24728.

#### Oracle Food and Beverage Applications Risk Matrix

This Critical Patch Update contains 3 new security patches for Oracle Food and Beverage Applications.  All of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#FBBU)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-2351 | Oracle Hospitality Inventory Management | Installation (ODP for .NET) | Oracle Net | Yes | 7.5 | Network | High | None | Required | Un- changed | High | High | High | 9.1 |  |
| CVE-2021-41184 | Oracle Hospitality Inventory Management | Receipt (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 9.1 |  |
| CVE-2021-41184 | Oracle Hospitality Materials Control | Receipt (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 18.1 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.

#### Oracle Fusion Middleware Risk Matrix

This Critical Patch Update contains 38 new security patches plus additional third party patches noted below for Oracle Fusion Middleware.  32 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#FMW)

Oracle Fusion Middleware products include Oracle Database components that are affected by the vulnerabilities listed in the Oracle Database section. The exposure of Oracle Fusion Middleware products is dependent on the Oracle Database version being used. Oracle Database security updates are not listed in the Oracle Fusion Middleware risk matrix. However, since vulnerabilities affecting Oracle Database versions may affect Oracle Fusion Middleware products, Oracle recommends that customers apply the Critical Patch Update July 2022 to the Oracle Database components of Oracle Fusion Middleware products. For information on what patches need to be applied to your environments, refer to Critical Patch Update July 2022 Patch Availability Document for Oracle Products, [My Oracle Support Note 2880163.2](https://support.oracle.com/rs?type=doc&id=2880163.2).

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-42575 | Oracle Middleware Common Libraries and Tools | Third Party Patch (AntiSamy) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2022-23457 | Oracle WebLogic Server | Centralized Third Party Jars (OWASP Enterprise Security API) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2021-23450 | Oracle WebLogic Server | Sample apps (Dojo) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-22965 | Oracle WebLogic Server | Third Party Tools, Samples (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2019-10082 | Oracle HTTP Server | SSL Module (Apache HTTP Server) | HTTP | Yes | 9.1 | Network | Low | None | None | Un- changed | High | None | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2020-35169 | Oracle HTTP Server | SSL Module (Dell BSAFE Micro Edition Suite) | HTTPS | Yes | 9.1 | Network | Low | None | None | Un- changed | High | High | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-23926 | Oracle Middleware Common Libraries and Tools | Thirdparty Patch (Apache XMLBeans) | HTTP | Yes | 9.1 | Network | Low | None | None | Un- changed | High | None | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2020-35169 | Oracle Security Service | C Oracle SSL API (Dell BSAFE Micro Edition Suite) | HTTPS | Yes | 9.1 | Network | Low | None | None | Un- changed | High | High | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-26291 | Oracle WebLogic Server | Centralized Third Party Jars (Apache Maven) | HTTP | Yes | 9.1 | Network | Low | None | None | Un- changed | High | High | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2020-35169 | Oracle Weblogic Server Proxy Plug-in | SSL Module (Dell BSAFE Micro Edition Suite) | HTTPS | Yes | 9.1 | Network | Low | None | None | Un- changed | High | High | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-39139 | Oracle WebCenter Portal | Security Framework (XStream) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-2351 | Oracle WebLogic Server | Installer (OCCI) | Oracle Net | Yes | 8.3 | Network | High | None | Required | Changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2020-11987 | Oracle WebLogic Server | Centralized Third Party Jars (Apache Batik) | HTTP | Yes | 8.2 | Network | Low | None | None | Un- changed | High | Low | None | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2019-0227 | Oracle BI Publisher | BI Publisher Security (Apache Axis) | HTTP | Yes | 7.5 | Adjacent Network | High | None | None | Un- changed | High | High | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2020-36518 | Oracle Coherence | Centralized Thirdparty Jars (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 14.1.1.0.0 |  |
| CVE-2022-21570 | Oracle Coherence | Core | T3, IIOP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 3.7.1.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2020-36518 | Oracle Global Lifecycle Management NextGen OUI Framework | NextGen Installer issues (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | Prior to 13.9.4.2.10 |  |
| CVE-2021-42340 | Oracle Managed File Transfer | MFT Runtime Server (Apache Tomcat) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-37714 | Oracle Middleware Common Libraries and Tools | Thirdparty Patch (jsoup) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2022-21562 | Oracle SOA Suite | Fabric Layer | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | High | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2020-36518 | Oracle WebLogic Server | Centralized Third Party Jars (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-24839 | Oracle WebLogic Server | Centralized Third Party Jars (NekoHTML) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2020-28491 | Oracle WebLogic Server | Centralized Third Party Jars (jackson-dataformats-binary) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2021-40690 | Oracle WebLogic Server | Centralized Thirdparty Jars (Apache Santuario XML Security For Java) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-21552 | Oracle WebCenter Content | Search | HTTP | Yes | 7.2 | Network | Low | None | None | Changed | Low | Low | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-35940 | Oracle HTTP Server | SSL Module (Apache Portable Runtime) | None | No | 7.1 | Local | Low | Low | None | Un- changed | High | None | High | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2021-30129 | Oracle Global Lifecycle Management NextGen OUI Framework | NextGen Installer issues (Apache MINA SSHD) | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | Prior to 13.9.4.2.10 |  |
| CVE-2022-23437 | Oracle Global Lifecycle Management NextGen OUI Framework | NextGen Installer issues (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | Prior to 13.9.4.2.10 |  |
| CVE-2022-21548 | Oracle WebLogic Server | Core | T3, IIOP | Yes | 6.5 | Network | Low | None | None | Un- changed | None | Low | Low | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2020-11023 | Oracle Business Intelligence Enterprise Edition | Service Administration UI (JQuery) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 5.9.0.0.0 |  |
| CVE-2020-1927 | Oracle HTTP Server | SSL Module (Apache HTTP Server) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 12.2.1.3.0, 12.2.1.4.0 |  |
| CVE-2022-29577 | Oracle WebLogic Server | Centralized Third Party Jars (AntiSamy) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-21575 | Oracle WebCenter Sites Support Tools | User Interface | HTTP | No | 6.0 | Network | Low | High | None | Un- changed | High | Low | Low | 4.4.2 and Prior |  |
| CVE-2022-21557 | Oracle WebLogic Server | Web Container | None | No | 5.7 | Local | High | High | None | Un- changed | High | High | None | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2019-0220 | Oracle HTTP Server | Web Listener (Apache HTTP Server) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | 12.2.1.3.0 |  |
| CVE-2022-21560 | Oracle WebLogic Server | Core | T3, IIOP | Yes | 5.3 | Network | Low | None | None | Un- changed | None | None | Low | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-21564 | Oracle WebLogic Server | Web Services | T3, IIOP | Yes | 5.3 | Network | Low | None | None | Un- changed | None | None | Low | 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0 |  |
| CVE-2022-21523 | Oracle BI Publisher | BI Publisher Security | HTTP | No | 4.3 | Network | Low | Low | None | Un- changed | Low | None | None | 12.2.1.3.0, 12.2.1.4.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2019-0227 also addresses CVE-2018-8032.
* The patch for CVE-2020-11023 also addresses CVE-2020-11022.
* The patch for CVE-2020-35169 also addresses CVE-2020-26184, CVE-2020-26185, and CVE-2020-29507.
* The patch for CVE-2021-39139 also addresses CVE-2021-39140, CVE-2021-39141, CVE-2021-39144, CVE-2021-39145, CVE-2021-39146, CVE-2021-39147, CVE-2021-39148, CVE-2021-39149, CVE-2021-39150, CVE-2021-39151, CVE-2021-39152, CVE-2021-39153, and CVE-2021-39154.
* The patch for CVE-2021-42340 also addresses CVE-2020-9484, and CVE-2022-23181.
* The patch for CVE-2021-42575 also addresses CVE-2021-35043.
* The patch for CVE-2022-23457 also addresses CVE-2022-24891.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* Oracle BI Publisher
  + Web Service API (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.
* Oracle Business Intelligence Enterprise Edition
  + Analytics Server (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.
* Oracle Data Integrator
  + Runtime Java agent for ODI (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.
* Oracle Identity Management Suite
  + Installer (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.
* Oracle Identity Manager Connector
  + General and Misc (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.
* Oracle Middleware Common Libraries and Tools
  + Third Party Patch (Spring Framework): CVE-2022-22965, CVE-2020-5397 and CVE-2020-5398.

#### Oracle Health Sciences Applications Risk Matrix

This Critical Patch Update contains 6 new security patches for Oracle Health Sciences Applications.  3 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#HCAR)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-36518 | Oracle Health Sciences Empirica Signal | Web Services (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 9.1.0.52, 9.2.0.52 |  |
| CVE-2019-10086 | Oracle Health Sciences Data Management Workbench | User Interface (Apache Commons BeanUtils) | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 2.5.2.1, 3.0.0.0 |  |
| CVE-2021-23337 | Oracle Health Sciences Data Management Workbench | User Interface (Lodash) | HTTP | No | 7.2 | Network | Low | High | None | Un- changed | High | High | High | 2.5.2.1, 3.0.0.0 |  |
| CVE-2021-44832 | Oracle Health Sciences Data Management Workbench | User Interface (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 2.5.2.1, 3.0.0.0, 3.1.0.3 |  |
| CVE-2022-21518 | Oracle Health Sciences Data Management Workbench | User Interface | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | High | None | None | 2.4.8.7, 2.5.2.1 |  |
| CVE-2021-29425 | Oracle Health Sciences Data Management Workbench | User Interface (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 2.5.2.1, 3.0.0.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-23337 also addresses CVE-2020-28500.

#### Oracle HealthCare Applications Risk Matrix

This Critical Patch Update contains 3 new security patches for Oracle HealthCare Applications.  2 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#HC)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-33813 | Oracle Healthcare Foundation | Upload Service (Apache Tika) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.1.0, 8.2.0, 8.2.1 |  |
| CVE-2022-23437 | Oracle Health Sciences Information Manager | Health Policy Engine (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 3.0.0.1, 3.0.1.0-3.0.5.0 |  |
| CVE-2021-36374 | Oracle Health Sciences Information Manager | Health Policy Engine (Apache Ant) | None | No | 5.5 | Local | Low | None | Required | Un- changed | None | None | High | 3.0.0.1, 3.0.1.0-3.0.5.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-36374 also addresses CVE-2021-36373.

#### Oracle Hospitality Applications Risk Matrix

This Critical Patch Update contains 2 new security patches for Oracle Hospitality Applications.  Both of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#HOSP)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-31805 | Oracle Hospitality OPERA 5 | Login (Apache Struts) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 5.6 |  |
| CVE-2022-29885 | Oracle Hospitality Cruise Shipboard Property Management System | Next-Gen SPMS (Apache Tomcat) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 20.2.1 |  |

#### Oracle Java SE Risk Matrix

This Critical Patch Update contains 5 new security patches for Oracle Java SE.  4 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#JAVA)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-34169 | Oracle Java SE, Oracle GraalVM Enterprise Edition | JAXP (Xalan-J) | Multiple | Yes | 7.5 | Network | Low | None | None | Un- changed | None | High | None | Oracle Java SE: 7u343, 8u333, 11.0.15.1, 17.0.3.1, 18.0.1.1; Oracle GraalVM Enterprise Edition: 20.3.6, 21.3.2, 22.1.0 | See Note 1 |
| CVE-2022-25647 | Oracle GraalVM Enterprise Edition | Native Image (Gson) | None | No | 6.2 | Local | Low | None | None | Un- changed | None | None | High | Oracle GraalVM Enterprise Edition: 20.3.6, 21.3.2, 22.1.0 |  |
| CVE-2022-21541 | Oracle Java SE, Oracle GraalVM Enterprise Edition | Hotspot | Multiple | Yes | 5.9 | Network | High | None | None | Un- changed | None | High | None | Oracle Java SE: 7u343, 8u333, 11.0.15.1, 17.0.3.1, 18.0.1.1; Oracle GraalVM Enterprise Edition: 20.3.6, 21.3.2, 22.1.0 | See Note 1 |
| CVE-2022-21540 | Oracle Java SE, Oracle GraalVM Enterprise Edition | Hotspot | Multiple | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | Oracle Java SE: 7u343, 8u333, 11.0.15.1, 17.0.3.1, 18.0.1.1; Oracle GraalVM Enterprise Edition: 20.3.6, 21.3.2, 22.1.0 | See Note 1 |
| CVE-2022-21549 | Oracle Java SE, Oracle GraalVM Enterprise Edition | Libraries | Multiple | Yes | 5.3 | Network | Low | None | None | Un- changed | None | Low | None | Oracle Java SE: 17.0.3.1; Oracle GraalVM Enterprise Edition: 21.3.2, 22.1.0 | See Note 1 |

#### Notes:

1. This vulnerability applies to Java deployments, typically in clients running sandboxed Java Web Start applications or sandboxed Java applets, that load and run untrusted code (e.g., code that comes from the internet) and rely on the Java sandbox for security. This vulnerability can also be exploited by using APIs in the specified Component, e.g., through a web service which supplies data to the APIs.

#### Oracle JD Edwards Risk Matrix

This Critical Patch Update contains 6 new security patches for Oracle JD Edwards.  3 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#JDE)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-22931 | JD Edwards EnterpriseOne Tools | E1 Dev Platform Tech - Cloud (Node.js) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 9.2.6.1 and prior |  |
| CVE-2021-31684 | JD Edwards EnterpriseOne Orchestrator | E1 IOT Orchestrator (JSON Smart) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 9.2.6.3 and prior |  |
| CVE-2022-21542 | JD Edwards EnterpriseOne Tools | Web Runtime | HTTP | No | 7.4 | Network | Low | Low | None | Changed | Low | Low | Low | 9.2.6.3 and prior |  |
| CVE-2022-21561 | JD Edwards EnterpriseOne Tools | Web Runtime | HTTP | No | 6.5 | Network | Low | Low | None | Un- changed | High | None | None | 9.2.6.3 and prior |  |
| CVE-2021-41184 | JD Edwards EnterpriseOne Tools | Web Runtime (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 9.2.6.3 and prior |  |
| CVE-2022-21532 | JD Edwards EnterpriseOne Orchestrator | E1 IOT Orchestrator | HTTP | No | 4.3 | Network | Low | Low | None | Un- changed | Low | None | None | 9.2.6.3 and prior |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-22931 also addresses CVE-2021-22939, and CVE-2021-22940.
* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.

#### Oracle MySQL Risk Matrix

This Critical Patch Update contains 34 new security patches plus additional third party patches noted below for Oracle MySQL.  10 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#MSQL)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-31805 | MySQL Enterprise Monitor | Monitoring: General (Apache Struts) | Multiple | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.0.30 and prior |  |
| CVE-2022-1292 | MySQL Server | Server: Packaging (OpenSSL) | MySQL Protocol | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 5.7.38 and prior, 8.0.29 and prior |  |
| CVE-2022-1292 | MySQL Workbench | Workbench (OpenSSL) | MySQL Workbench | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.0.29 and prior |  |
| CVE-2022-21824 | MySQL Cluster | Cluster: General (Node.js) | Multiple | Yes | 8.2 | Network | Low | None | None | Un- changed | None | Low | High | 8.0.29 and prior |  |
| CVE-2022-27778 | MySQL Server | Server: Packaging (cURL) | MySQL Protocol | Yes | 8.1 | Network | Low | None | Required | Un- changed | None | High | High | 5.7.38 and prior, 8.0.29 and prior |  |
| CVE-2021-22119 | MySQL Enterprise Monitor | Monitoring: General (Spring Security) | Multiple | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.25 and prior |  |
| CVE-2018-25032 | MySQL Server | Server: Compiling (zlib) | MySQL Protocol | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 5.7.38 and prior, 8.0.29 and prior |  |
| CVE-2022-23308 | MySQL Workbench | Workbench (libxml2) | MySQL Workbench | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2020-26237 | MySQL Enterprise Monitor | Monitoring: General (highlight.js) | Multiple | No | 6.8 | Network | Low | Low | Required | Changed | None | High | None | 8.0.30 and prior |  |
| CVE-2022-21556 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 6.5 | Network | Low | High | None | Un- changed | None | High | High | 8.0.28 and prior |  |
| CVE-2022-21569 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 6.5 | Network | Low | Low | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21550 | MySQL Cluster | Cluster: General | Multiple | No | 6.3 | Adjacent Network | High | High | Required | Un- changed | High | High | High | 7.4.36 and prior,7.5.26 and prior, 7.6.22 and prior, and 8.0.29 and prior |  |
| CVE-2022-21519 | MySQL Cluster | Cluster: General | Multiple | Yes | 5.9 | Network | High | None | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21527 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 5.5 | Network | Low | High | None | Un- changed | None | Low | High | 8.0.29 and prior |  |
| CVE-2022-21528 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 5.5 | Network | Low | High | None | Un- changed | None | Low | High | 8.0.29 and prior |  |
| CVE-2022-21509 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 5.5 | Network | Low | High | None | Un- changed | None | Low | High | 8.0.29 and prior |  |
| CVE-2022-22968 | MySQL Enterprise Monitor | Service Manager (Spring Framework) | Multiple | Yes | 5.3 | Network | Low | None | None | Un- changed | None | Low | None | 8.0.29 and prior |  |
| CVE-2022-21539 | MySQL Server | InnoDB | MySQL Protocol | No | 5.0 | Network | High | Low | None | Un- changed | Low | Low | Low | 8.0.29 and prior |  |
| CVE-2022-21517 | MySQL Server | InnoDB | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21537 | MySQL Server | InnoDB | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21547 | MySQL Server | Server: Federated | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21525 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21526 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21529 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21530 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21531 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21553 | MySQL Server | Server: Optimizer | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21515 | MySQL Server | Server: Options | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 5.7.38 and prior, 8.0.29 and prior |  |
| CVE-2022-21455 | MySQL Server | Server: PAM Auth Plugin | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | High | None | 8.0.28 and prior |  |
| CVE-2022-21534 | MySQL Server | Server: Stored Procedure | MySQL Protocol | No | 4.9 | Network | Low | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21522 | MySQL Server | Server: Stored Procedure | MySQL Protocol | No | 4.4 | Network | High | High | None | Un- changed | None | None | High | 8.0.29 and prior |  |
| CVE-2022-21555 | MySQL Shell for VS Code | Shell: GUI | None | No | 4.2 | Local | Low | High | Required | Changed | Low | Low | None | 1.1.8 and prior |  |
| CVE-2022-21538 | MySQL Server | Server: Security: Encryption | MySQL Protocol | No | 3.1 | Network | High | Low | None | Un- changed | None | None | Low | 8.0.29 and prior |  |
| CVE-2022-21535 | MySQL Shell | Shell: General/Core Client | None | No | 2.5 | Local | High | None | Required | Un- changed | None | None | Low | 8.0.28 and prior |  |

#### Additional CVEs addressed are:

* The patch for CVE-2022-21824 also addresses CVE-2021-44531, CVE-2021-44532, and CVE-2021-44533.

#### Additional patches are included in this Critical Patch Update for the following non-exploitable CVEs in this Oracle product family:

* MySQL Enterprise Monitor
  + Service Manager (OpenSSL): CVE-2022-1292.

#### Oracle PeopleSoft Risk Matrix

This Critical Patch Update contains 11 new security patches for Oracle PeopleSoft.  9 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#PS)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-21543 | PeopleSoft Enterprise PeopleTools | Updates Environment Mgmt | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 8.58, 8.59 |  |
| CVE-2020-36518 | PeopleSoft Enterprise PeopleTools | Elastic Search (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.58, 8.59 |  |
| CVE-2018-25032 | PeopleSoft Enterprise PeopleTools | PeopleSoft CDA (zlib) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.58, 8.59 |  |
| CVE-2022-24729 | PeopleSoft Enterprise PeopleTools | Rich Text Editor (CKEditor) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.58, 8.59 |  |
| CVE-2021-31684 | PeopleSoft Enterprise PeopleTools | Security (JSON Smart) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 8.58, 8.59 |  |
| CVE-2022-23437 | PeopleSoft Enterprise PeopleTools | Security (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 8.58, 8.59 |  |
| CVE-2022-21520 | PeopleSoft Enterprise PeopleTools | Fluid Core | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 8.58, 8.59 |  |
| CVE-2020-7656 | PeopleSoft Enterprise PeopleTools | PeopleSoft CDA (jQuery) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 8.58 |  |
| CVE-2021-41182 | PeopleSoft Enterprise PeopleTools | XML Publisher (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 8.58, 8.59 |  |
| CVE-2022-21521 | PeopleSoft Enterprise PeopleTools | XML Publisher | HTTP | No | 4.9 | Network | Low | High | None | Un- changed | High | None | None | 8.58, 8.59 |  |
| CVE-2022-21512 | PeopleSoft Enterprise PeopleTools | Integration Broker | None | No | 4.4 | Local | Low | High | None | Un- changed | High | None | None | 8.58, 8.59 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-41182 also addresses CVE-2021-41183, and CVE-2021-41184.
* The patch for CVE-2022-24729 also addresses CVE-2022-24728.

#### Oracle Policy Automation Risk Matrix

This Critical Patch Update contains 3 new security patches for Oracle Policy Automation.  1 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#POLI)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-44832 | Oracle Policy Automation | Determinations Engine (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 12.2.0-12.2.24 |  |
| CVE-2021-44832 | Oracle Policy Automation for Mobile Devices | Core Functionality (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 12.2.0-12.2.24 |  |
| CVE-2021-41184 | Oracle Policy Automation | Determinations Engine (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 12.2.0-12.2.25 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.

#### Oracle Retail Applications Risk Matrix

This Critical Patch Update contains 17 new security patches for Oracle Retail Applications.  13 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#RAPP)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-22965 | Oracle Retail Bulk Data Integration | BDI Job Scheduler (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 16.0.3 |  |
| CVE-2022-22965 | Oracle Retail Customer Management and Segmentation Foundation | Security (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 17.0, 18.0, 19.0 |  |
| CVE-2022-23305 | Oracle Retail Extract Transform and Load | Mathematical Operators (Apache Log4j) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 13.2.5 |  |
| CVE-2022-22965 | Oracle Retail Financial Integration | PeopleSoft Integration Bugs (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.1.3.2, 15.0.3.1, 16.0.3, 19.0.1 |  |
| CVE-2022-22965 | Oracle Retail Integration Bus | RIB Kernal (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 14.1.3.2, 15.0.3.1, 16.0.3, 19.0.1 |  |
| CVE-2022-22965 | Oracle Retail Merchandising System | Foundation (Spring Framework) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 16.0.3, 19.0.1 |  |
| CVE-2021-29505 | Oracle Retail Customer Insights | Other (XStream) | HTTP | No | 8.8 | Network | Low | Low | None | Un- changed | High | High | High | 15.0.2, 16.0.2 |  |
| CVE-2021-22118 | Oracle Retail Customer Insights | Other (Spring Framework) | None | No | 7.8 | Local | Low | Low | None | Un- changed | High | High | High | 16.0.2 |  |
| CVE-2022-25647 | Oracle Retail Order Broker | System Administration (Google GSON) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 18.0, 19.1 |  |
| CVE-2020-36518 | Oracle Retail Sales Audit | others (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 15.0.3.1 |  |
| CVE-2019-10086 | Oracle Retail Allocation | General (Apache Commons BeanUtils) | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 15.0.3.1, 16.0.3 |  |
| CVE-2019-10086 | Oracle Retail Sales Audit | others (Apache Commons BeanUtils) | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 16.0.3 |  |
| CVE-2021-44832 | Oracle Retail Order Broker | Internal Operations (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 18.0, 19.1 |  |
| CVE-2021-44832 | Oracle Retail Xstore Point of Service | Xenvironment (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 17.0.4, 18.0.3, 19.0.2, 20.0.1, 21.0.1 |  |
| CVE-2021-29425 | Oracle Retail Merchandising System | Foundation (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 16.0.3, 19.0.1 |  |
| CVE-2021-29425 | Oracle Retail Pricing | Pricing - Security (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 19.0.1 |  |
| CVE-2021-29425 | Oracle Retail Xstore Point of Service | Xenvironment (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 17.0.4, 18.0.3, 19.0.2, 20.0.1 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2022-23305 also addresses CVE-2021-4104, CVE-2022-23302, and CVE-2022-23307.

#### Oracle Siebel CRM Risk Matrix

This Critical Patch Update contains 1 new security patch for Oracle Siebel CRM.  This vulnerability is not remotely exploitable without authentication, i.e., may not be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#SECR)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2021-31812 | Siebel Apps - Field Service | Smart Answer (Apache PDFBox) | None | No | 5.5 | Local | Low | None | Required | Un- changed | None | None | High | 22.6 and prior |  |

#### Additional CVEs addressed are:

* The patch for CVE-2021-31812 also addresses CVE-2021-31811.

#### Oracle Supply Chain Risk Matrix

This Critical Patch Update contains 24 new security patches for Oracle Supply Chain.  19 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#SCP)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-10683 | Oracle Agile Engineering Data Management | Installation Issues (dom4j) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 6.2.1.0 |  |
| CVE-2019-0219 | Oracle Transportation Management | Mobile Applications (Apache cordova-plugin-inappbrowser) | HTTP | Yes | 9.8 | Network | Low | None | None | Un- changed | High | High | High | 1.4.4 |  |
| CVE-2022-25762 | Oracle Agile PLM | Security (Apache Tomcat) | HTTP | Yes | 8.6 | Network | Low | None | None | Un- changed | High | Low | Low | 9.3.6 |  |
| CVE-2021-2351 | Oracle Agile Product Lifecycle Management for Process | Reporting (ODP for .NET) | Oracle Net | Yes | 8.3 | Network | High | None | Required | Changed | High | High | High | 6.2.2, 6.2.3 |  |
| CVE-2020-11987 | Oracle Agile Engineering Data Management | Installation Issues (Apache Batik) | HTTP | Yes | 8.2 | Network | Low | None | None | Un- changed | High | Low | None | 6.2.1.0 |  |
| CVE-2020-11987 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Batik) | HTTP | Yes | 8.2 | Network | Low | None | None | Un- changed | High | Low | None | 3.6.1 |  |
| CVE-2021-22118 | Oracle Product Lifecycle Analytics | Installation Issues (Spring Framework) | None | No | 7.8 | Local | Low | Low | None | Un- changed | High | High | High | 3.6.1 |  |
| CVE-2021-42340 | Oracle Agile Engineering Data Management | Installation Issues (Apache Tomcat) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 6.2.1.0 |  |
| CVE-2021-40690 | Oracle Agile PLM | Security (Apache Santuario XML Security For Java) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | High | None | None | 9.3.6 |  |
| CVE-2020-25649 | Oracle Agile PLM | Security (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | High | None | 9.3.6 |  |
| CVE-2019-0227 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Axis) | HTTP | Yes | 7.5 | Adjacent Network | High | None | None | Un- changed | High | High | High | 3.6.1 |  |
| CVE-2019-10086 | Oracle Agile Engineering Data Management | Installation Issues (Apache Commons BeanUtils) | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 6.2.1.0 |  |
| CVE-2019-10086 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Commons BeanUtils) | HTTP | Yes | 7.3 | Network | Low | None | None | Un- changed | Low | Low | Low | 3.6.1 |  |
| CVE-2021-44832 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Log4j) | HTTP | No | 6.6 | Network | High | High | None | Un- changed | High | High | High | 3.6.1 |  |
| CVE-2022-23437 | Oracle Agile Engineering Data Management | Installation Issues (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 6.2.1.0 |  |
| CVE-2022-23437 | Oracle Agile PLM | Security (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 9.3.6 |  |
| CVE-2022-23437 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Xerces-J) | HTTP | Yes | 6.5 | Network | Low | None | Required | Un- changed | None | None | High | 3.6.1 |  |
| CVE-2020-11022 | Oracle Agile PLM | Security (jQuery) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 9.3.6 |  |
| CVE-2021-41184 | Oracle Agile PLM | Security (jQueryUI) | HTTP | Yes | 6.1 | Network | Low | None | Required | Changed | Low | Low | None | 9.3.6 |  |
| CVE-2021-36374 | Oracle Agile Engineering Data Management | Installation Issues (Apache Ant) | None | No | 5.5 | Local | Low | None | Required | Un- changed | None | None | High | 6.2.1.0 |  |
| CVE-2020-17521 | Oracle Agile Engineering Data Management | Installation Issues (Apache Groovy) | None | No | 5.5 | Local | Low | Low | None | Un- changed | High | None | None | 6.2.1.0 |  |
| CVE-2021-36374 | Oracle Product Lifecycle Analytics | Installation Issues (Apache Ant) | None | No | 5.5 | Local | Low | None | Required | Un- changed | None | None | High | 3.6.1 |  |
| CVE-2021-34429 | Oracle Autovue for Agile Product Lifecycle Management | Internal Operations (Eclipse Jetty) | HTTP | Yes | 5.3 | Network | Low | None | None | Un- changed | Low | None | None | 21.0.2 |  |
| CVE-2021-29425 | Oracle Agile Engineering Data Management | Installation Issues (Apache Commons IO) | HTTP | Yes | 4.8 | Network | High | None | None | Un- changed | Low | Low | None | 6.2.1.0 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2019-0227 also addresses CVE-2018-8032.
* The patch for CVE-2020-25649 also addresses CVE-2020-35490, CVE-2020-35491, CVE-2020-35728, CVE-2020-36179, CVE-2020-36180, CVE-2020-36181, CVE-2020-36182, CVE-2020-36183, CVE-2020-36184, CVE-2020-36185, CVE-2020-36186, CVE-2020-36187, CVE-2020-36188, and CVE-2020-36189.
* The patch for CVE-2021-36374 also addresses CVE-2021-36373.
* The patch for CVE-2021-41184 also addresses CVE-2021-41182, and CVE-2021-41183.
* The patch for CVE-2021-42340 also addresses CVE-2022-23181.

#### Oracle Systems Risk Matrix

This Critical Patch Update contains 7 new security patches for Oracle Systems.  2 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#SUNS)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-21513 | Oracle ZFS Storage Appliance Kit | Core | None | No | 8.2 | Local | Low | High | None | Changed | High | High | High | 8.8 |  |
| CVE-2022-24801 | Oracle ZFS Storage Appliance Kit | Operating System Image | Multiple | Yes | 8.1 | Network | High | None | None | Un- changed | High | High | High | 8.8 |  |
| CVE-2022-21524 | Oracle Solaris | Filesystem | SMB | No | 7.6 | Network | Low | Low | None | Un- changed | Low | Low | High | 11 |  |
| CVE-2022-21514 | Oracle Solaris | Remote Administration Daemon | Multiple | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 11 |  |
| CVE-2022-21533 | Oracle Solaris | SMB Server | None | No | 5.5 | Local | Low | Low | None | Un- changed | None | None | High | 11 |  |
| CVE-2022-21439 | Oracle Solaris | Kernel | None | No | 4.2 | Local | Low | High | Required | Un- changed | None | None | High | 10, 11 |  |
| CVE-2022-21563 | Oracle ZFS Storage Appliance Kit | Core | None | No | 3.4 | Local | Low | High | None | Un- changed | None | Low | Low | 8.8 |  |

#### Additional CVEs addressed are:

* The patch for CVE-2022-24801 also addresses CVE-2018-25032, CVE-2020-29651, CVE-2021-4115, CVE-2022-23308, and CVE-2022-29824.

#### Oracle Utilities Applications Risk Matrix

This Critical Patch Update contains 1 new security patch for Oracle Utilities Applications.  This vulnerability is remotely exploitable without authentication, i.e., may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#UTIL)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2020-36518 | Oracle Utilities Framework | General (jackson-databind) | HTTP | Yes | 7.5 | Network | Low | None | None | Un- changed | None | None | High | 4.3.0.5.0, 4.3.0.6.0, 4.4.0.0.0, 4.4.0.2.0, 4.4.0.3.0, 4.5.0.0.0 |  |

#### Oracle Virtualization Risk Matrix

This Critical Patch Update contains 2 new security patches for Oracle Virtualization.  Neither of these vulnerabilities may be remotely exploitable without authentication, i.e., neither may be exploited over a network without requiring user credentials.  The English text form of this Risk Matrix can be found [here.](/security-alerts/cpujul2022verbose.html#OVIR)

| CVE# | Product | Component | Protocol | Remote Exploit without Auth.? | CVSS VERSION 3.1 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Attack Vector | Attack Complex | Privs Req'd | User Interact | Scope | Confid- entiality | Inte- grity | Avail- ability |
| CVE-2022-21571 | Oracle VM VirtualBox | Core | None | No | 8.2 | Local | Low | High | None | Changed | High | High | High | Prior to 6.1.36 |  |
| CVE-2022-21554 | Oracle VM VirtualBox | Core | None | No | 4.4 | Local | Low | High | None | Un- changed | None | None | High | Prior to 6.1.36 |  |

Resources for

* [Careers](/careers/)
* [Developers](/developer/)
* [Investors](https://investor.oracle.com/home/default.aspx)
* [Partners](/partner/)
* [Researchers](/research/)
* [Students and Educators](https://academy.oracle.com/en/oa-web-overview.html)

Why Oracle

* [Analyst Reports](/corporate/analyst-reports/)
* [Best cloud-based
  ERP](/erp/what-is-erp/best-erp/)
* [Cloud Economics](/cloud/economics/)
* [Social Impact](/social-impact/)
* [Culture and Inclusion](/careers/diversity-inclusion/)
* [Security Practices](/corporate/security-practices/)

Learn

* [What is cloud
  computing?](/cloud/what-is-cloud-computing/)
* [What is CRM?](/cx/what-is-crm/)
* [What is
  Docker?](/cloud/cloud-native/container-registry/what-is-docker/)
* [What is
  Kubernetes?](/cloud/cloud-native/kubernetes-engine/what-is-kubernetes/)
* [What is
  Python?](/developer/what-is-python-for-developers/)
* [What is SaaS?](/applications/what-is-saas/)

News and Events

* [News](/news/)
* [Oracle CloudWorld](/cloudworld/)
* [Oracle CloudWorld Tour](/cloudworld-tour/)
* [Oracle Health Summit](/health/health-summit/)
* [Oracle Dev Tour](/developer/dev-tour/)
* [Search all events](https://search.oracle.com/events?q=&lang=english)

Contact Us

* US Sales: +1.800.633.0738
* [How can we help?](/corporate/contact/)
* [Subscribe to emails](https://go.oracle.com/subscribe/?l_code=en&src1=OW:O:FO)
* [Integrity Helpline](https://secure.ethicspoint.com/domain/media/en/gui/31053/index.html)
* [Accessibility](/corporate/accessibility/)

---

* [Country/Region](/universal-menu/#u10countrymenu)

* [© 2025 Oracle](/legal/copyright/)
* [Privacy](/legal/privacy/)/[Do Not Sell My
  Info](/legal/privacy/privacy-choices/)
* [Ad
  Choices](/legal/privacy/privacy-policy/#adchoices)
* [Careers](/corporate/careers/)


