=== Content from lists.debian.org_1447e1a3_20250114_204805.html ===


---

[[Date Prev](msg00011.html)][[Date Next](msg00013.html)]
[[Thread Prev](msg00011.html)][[Thread Next](msg00013.html)]
[[Date Index](maillist.html#00012)]
[[Thread Index](threads.html#00012)]

# [SECURITY] [DLA 2941-1] linux-4.19 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2941-1] linux-4.19 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 9 Mar 2022 13:40:55 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YiigV99QQ%2BwYNpB3%40decadent.org.uk)Â [YiigV99QQ+wYNpB3@decadent.org.uk](msg00012.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2941-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
March 09, 2022                                <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.232-1~deb9u1
CVE ID         : CVE-2020-29374 CVE-2020-36322 CVE-2021-3640 CVE-2021-3744
                 CVE-2021-3752 CVE-2021-3760 CVE-2021-3764 CVE-2021-3772
                 CVE-2021-4002 CVE-2021-4083 CVE-2021-4135 CVE-2021-4155
                 CVE-2021-4203 CVE-2021-20317 CVE-2021-20321 CVE-2021-20322
                 CVE-2021-22600 CVE-2021-28711 CVE-2021-28712 CVE-2021-28713
                 CVE-2021-28714 CVE-2021-28715 CVE-2021-28950 CVE-2021-38300
                 CVE-2021-39685 CVE-2021-39686 CVE-2021-39698 CVE-2021-39713
                 CVE-2021-41864 CVE-2021-42739 CVE-2021-43389 CVE-2021-43975
                 CVE-2021-43976 CVE-2021-44733 CVE-2021-45095 CVE-2021-45469
                 CVE-2021-45480 CVE-2022-0001 CVE-2022-0002 CVE-2022-0322
                 CVE-2022-0330 CVE-2022-0435 CVE-2022-0487 CVE-2022-0492
                 CVE-2022-0617 CVE-2022-0644 CVE-2022-22942 CVE-2022-24448
                 CVE-2022-24959 CVE-2022-25258 CVE-2022-25375
Debian Bug     : 988044 989285 990411 994050

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

    This issue was already fixed for most architectures, but not on
    MIPS and System z.  This update corrects that.

CVE-2020-36322, CVE-2021-28950

    The syzbot tool found that the FUSE (filesystem-in-user-space)
    implementation did not correctly handle a FUSE server returning
    invalid attributes for a file.  A local user permitted to run a
    FUSE server could use this to cause a denial of service (crash).

    The original fix for this introduced a different potential denial
    of service (infinite loop in kernel space), which has also been
    fixed.

CVE-2021-3640

    Lin Ma discovered a race condiiton in the Bluetooth protocol
    implementation that can lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2021-3744, CVE-2021-3764

    minihanshen reported bugs in the ccp driver for AMD
    Cryptographic Coprocessors that could lead to a resource leak.
    On systems using this driver, a local user could exploit this to
    cause a denial of service.

CVE-2021-3752

    Likang Luo of NSFOCUS Security Team discovered a flaw in the
    Bluetooth L2CAP implementation that can lead to a user-after-free.
    A local user could exploit this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2021-3760, CVE-2021-4202

    Lin Ma discovered race conditions in the NCI (NFC Controller
    Interface) driver, which could lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-3772

    A flaw was found in the SCTP protocol implementation, which would
    allow a networked attacker to break an SCTP association.  The
    attacker would only need to know or guess the IP addresses and
    ports for the association.

CVE-2021-4002

    It was discovered that hugetlbfs, the virtual filesystem used by
    applications to allocate huge pages in RAM, did not flush the
    CPU's TLB in one case where it was necessary.  In some
    circumstances a local user would be able to read and write huge
    pages after they are freed and reallocated to a different process.
    This could lead to privilege escalation, denial of service or
    information leaks.

CVE-2021-4083

    Jann Horn reported a race condition in the local (Unix) sockets
    garbage collector, that can lead to use-after-free.  A local user
    could exploit this to cause a denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-4135

    A flaw was found in the netdevsim driver which would lead to an
    information leak.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-4203

    Jann Horn reported a race condition in the local (Unix) sockets
    implementation that can lead to a use-after-free.  A local user
    could exploit this to leak sensitive information from the kernel.

CVE-2021-20317

    It was discovered that the timer queue structure could become
    corrupt, leading to waiting tasks never being woken up.  A local
    user with certain privileges could exploit this to cause a denial
    of service (system hang).

CVE-2021-20321

    A race condition was discovered in the overlayfs filesystem
    driver.  A local user with access to an overlayfs mount and to its
    underlying upper directory could exploit this for privilege
    escalation.

CVE-2021-20322

    An information leak was discovered in the IPv4 implementation.  A
    remote attacker could exploit this to quickly discover which UDP
    ports a system is using, making it easier for them to carry out a
    DNS poisoning attack against that system.

CVE-2021-22600

    The syzbot tool found a flaw in the packet socket (AF_PACKET)
    implementation which could lead to incorrectly freeing memory.  A
    local user with CAP_NET_RAW capability (in any user namespace)
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-38300

    Piotr Krysiuk discovered a flaw in the classic BPF (cBPF) JIT
    compiler for MIPS architectures.  A local user could exploit
    this to excute arbitrary code in the kernel.

    This issue is mitigated by setting sysctl
    net.core.bpf_jit_enable=0, which is the default.  It is *not*
    mitigated by disabling unprivileged use of eBPF.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-39686

    A race condition was discovered in the Android binder driver, that
    could lead to incorrect security checks.  On systems where the
    binder driver is loaded, a local user could exploit this for
    privilege escalation.

CVE-2021-39698

    Linus Torvalds reported a flaw in the file polling implementation,
    which could lead to a use-after-free.  A local user could exploit
    this for denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2021-39713

    The syzbot tool found a race condition in the network scheduling
    subsystem which could lead to a use-after-free.  A local user
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-41864

    An integer overflow was discovered in the Extended BPF (eBPF)
    subsystem.  A local user could exploit this for denial of service
    (memory corruption or crash), or possibly for privilege
    escalation.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-42739

    A heap buffer overflow was discovered in the firedtv driver for
    FireWire-connected DVB receivers.  A local user with access to a
    firedtv device could exploit this for denial of service (memory
    corruption or crash), or possibly for privilege escalation.

CVE-2021-43389

    The Active Defense Lab of Venustech discovered a flaw in the CMTP
    subsystem as used by Bluetooth, which could lead to an
    out-of-bounds read and object type confusion.  A local user with
    CAP_NET_ADMIN capability in the initial user namespace could
    exploit this for denial of service (memory corruption or crash),
    or possibly for privilege escalation.

CVE-2021-43975

    Brendan Dolan-Gavitt reported a flaw in the
    hw_atl_utils_fw_rpc_wait() function in the aQuantia AQtion ethernet
    device driver which can result in denial of service or the execution
    of arbitrary code.

CVE-2021-43976

    Zekun Shen and Brendan Dolan-Gavitt discovered a flaw in the
    mwifiex_usb_recv() function of the Marvell WiFi-Ex USB Driver. An
    attacker able to connect a crafted USB device can take advantage of
    this flaw to cause a denial of service.

CVE-2021-44733

    A race condition was discovered in the Trusted Execution
    Environment (TEE) subsystem for Arm processors, which could lead
    to a use-after-free.  A local user permitted to access a TEE
    device could exploit this for denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2021-45469

    Wenqing Liu reported an out-of-bounds memory access in the f2fs
    implementation if an inode has an invalid last xattr entry. An
    attacker able to mount a specially crafted image can take advantage
    of this flaw for denial of service.

CVE-2021-45480

    A memory leak flaw was discovered in the __rds_conn_create()
    function in the RDS (Reliable Datagram Sockets) protocol subsystem.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This can be partly mitigated by disabling eBPF for unprivileged
    users with the sysctl: kernel.unprivileged_bpf_disabled=2.  This
    update does that by default.

CVE-2022-0322

    Eiichi Tsukata discovered a flaw in the sctp_make_strreset_req()
    function in the SCTP network protocol implementation which can
    result in denial of service.

CVE-2022-0330

    Sushma Venkatesh Reddy discovered a missing GPU TLB flush in the
    i915 driver, resulting in denial of service or privilege escalation.

CVE-2022-0435

    Samuel Page and Eric Dumazet reported a stack overflow in the
    networking module for the Transparent Inter-Process Communication
    (TIPC) protocol, resulting in denial of service or potentially the
    execution of arbitrary code.

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-0644

    Hao Sun reported a missing check for file read permission in the
    finit_module() and kexec_file_load() system calls.  The security
    impact of this is unclear, since these system calls are usually
    only available to the root user.

CVE-2022-22942

    It was discovered that wrong file file descriptor handling in the
    VMware Virtual GPU driver (vmwgfx) could result in information leak
    or privilege escalation.

CVE-2022-24448

    Lyu Tao reported a flaw in the NFS implementation in the Linux
    kernel when handling requests to open a directory on a regular file,
    which could result in a information leak.

CVE-2022-24959

    A memory leak was discovered in the yam_siocdevprivate() function of
    the YAM driver for AX.25, which could result in denial of service.

CVE-2022-25258

    Szymon Heidrich reported the USB Gadget subsystem lacks certain
    validation of interface OS descriptor requests, resulting in memory
    corruption.

CVE-2022-25375

    Szymon Heidrich reported that the RNDIS USB gadget lacks validation
    of the size of the RNDIS_MSG_SET command, resulting in information
    leak from kernel memory.

For Debian 9 stretch, these problems have been fixed in version
4.19.232-1~deb9u1.  This update additionally includes many more bug
fixes from stable updates 4.19.209-4.19.232 inclusive.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-4.19>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpTZkVodrlDJ.pgp)**

*Description:* PGP signature

---



=== Content from cdn.kernel.org_b0ed8a90_20250114_204803.html ===
commit fb6ad5cb3b6745e7bffc5fe19b130f3594375634
Author: Greg Kroah-Hartman
Date: Wed Dec 22 09:32:52 2021 +0100
Linux 5.15.11
Link: https://lore.kernel.org/r/20211220143040.058287525@linuxfoundation.org
Tested-by: Jon Hunter
Tested-by: Shuah Khan
Tested-by: Ronald Warsow
Tested-by: Salvatore Bonaccorso
Tested-by: Linux Kernel Functional Testing
Tested-by: Rudi Heitbaum
Tested-by: Florian Fainelli
Tested-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit bd926d189210cd1d5b4e618e45898053be6b4b3b
Author: Juergen Gross
Date: Tue Nov 30 08:36:12 2021 +0100
xen/netback: don't queue unlimited number of packages
commit be81992f9086b230623ae3ebbc85ecee4d00a3d3 upstream.
In case a guest isn't consuming incoming network traffic as fast as it
is coming in, xen-netback is buffering network packages in unlimited
numbers today. This can result in host OOM situations.
Commit f48da8b14d04ca8 ("xen-netback: fix unlimited guest Rx internal
queue and carrier flapping") meant to introduce a mechanism to limit
the amount of buffered data by stopping the Tx queue when reaching the
data limit, but this doesn't work for cases like UDP.
When hitting the limit don't queue further SKBs, but drop them instead.
In order to be able to tell Rx packages have been dropped increment the
rx\_dropped statistics counter in this case.
It should be noted that the old solution to continue queueing SKBs had
the additional problem of an overflow of the 32-bit rx\_queue\_len value
would result in intermittent Tx queue enabling.
This is part of XSA-392
Fixes: f48da8b14d04ca8 ("xen-netback: fix unlimited guest Rx internal queue and carrier flapping")
Signed-off-by: Juergen Gross
Reviewed-by: Jan Beulich
Signed-off-by: Greg Kroah-Hartman
commit 88449dbe6203c3a91cf1c39ea3032ad61a297bd7
Author: Juergen Gross
Date: Thu Dec 16 08:25:12 2021 +0100
xen/netback: fix rx queue stall detection
commit 6032046ec4b70176d247a71836186d47b25d1684 upstream.
Commit 1d5d48523900a4b ("xen-netback: require fewer guest Rx slots when
not using GSO") introduced a security problem in netback, as an
interface would only be regarded to be stalled if no slot is available
in the rx queue ring page. In case the SKB at the head of the queued
requests will need more than one rx slot and only one slot is free the
stall detection logic will never trigger, as the test for that is only
looking for at least one slot to be free.
Fix that by testing for the needed number of slots instead of only one
slot being available.
In order to not have to take the rx queue lock that often, store the
number of needed slots in the queue data. As all SKB dequeue operations
happen in the rx queue kernel thread this is safe, as long as the
number of needed slots is accessed via READ/WRITE\_ONCE() only and
updates are always done with the rx queue lock held.
Add a small helper for obtaining the number of free slots.
This is part of XSA-392
Fixes: 1d5d48523900a4b ("xen-netback: require fewer guest Rx slots when not using GSO")
Signed-off-by: Juergen Gross
Reviewed-by: Jan Beulich
Signed-off-by: Greg Kroah-Hartman
commit 153d1ea3272209fc970116f09051002d14422cde
Author: Juergen Gross
Date: Thu Dec 16 08:24:08 2021 +0100
xen/console: harden hvc\_xen against event channel storms
commit fe415186b43df0db1f17fa3a46275fd92107fe71 upstream.
The Xen console driver is still vulnerable for an attack via excessive
number of events sent by the backend. Fix that by using a lateeoi event
channel.
For the normal domU initial console this requires the introduction of
bind\_evtchn\_to\_irq\_lateeoi() as there is no xenbus device available
at the time the event channel is bound to the irq.
As the decision whether an interrupt was spurious or not requires to
test for bytes having been read from the backend, move sending the
event into the if statement, as sending an event without having found
any bytes to be read is making no sense at all.
This is part of XSA-391
Signed-off-by: Juergen Gross
Reviewed-by: Jan Beulich
Signed-off-by: Greg Kroah-Hartman
commit a29c8b5226eda52e6d6ff151d9343558ea3ad451
Author: Juergen Gross
Date: Thu Dec 16 08:24:08 2021 +0100
xen/netfront: harden netfront against event channel storms
commit b27d47950e481f292c0a5ad57357edb9d95d03ba upstream.
The Xen netfront driver is still vulnerable for an attack via excessive
number of events sent by the backend. Fix that by using lateeoi event
channels.
For being able to detect the case of no rx responses being added while
the carrier is down a new lock is needed in order to update and test
rsp\_cons and the number of seen unconsumed responses atomically.
This is part of XSA-391
Signed-off-by: Juergen Gross
Reviewed-by: Jan Beulich
Signed-off-by: Greg Kroah-Hartman
commit caf9b51829a50590b84daea924a0fd62d32bc952
Author: Juergen Gross
Date: Thu Dec 16 08:24:08 2021 +0100
xen/blkfront: harden blkfront against event channel storms
commit 0fd08a34e8e3b67ec9bd8287ac0facf8374b844a upstream.
The Xen blkfront driver is still vulnerable for an attack via excessive
number of events sent by the backend. Fix that by using lateeoi event
channels.
This is part of XSA-391
Signed-off-by: Juergen Gross
Reviewed-by: Jan Beulich
Signed-off-by: Greg Kroah-Hartman
commit ffbd663ebac9d32bac215bdd927268b22753a21e
Author: Magnus Karlsson
Date: Fri Dec 17 15:56:46 2021 +0100
Revert "xsk: Do not sleep in poll() when need\_wakeup set"
commit 0706a78f31c4217ca144f630063ec9561a21548d upstream.
This reverts commit bd0687c18e635b63233dc87f38058cd728802ab4.
This patch causes a Tx only workload to go to sleep even when it does
not have to, leading to misserable performance in skb mode. It fixed
one rare problem but created a much worse one, so this need to be
reverted while I try to craft a proper solution to the original
problem.
Fixes: bd0687c18e63 ("xsk: Do not sleep in poll() when need\_wakeup set")
Signed-off-by: Magnus Karlsson
Signed-off-by: Daniel Borkmann
Link: https://lore.kernel.org/bpf/20211217145646.26449-1-magnus.karlsson@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 581b097951991e58ee3219987646ffaeee78eec3
Author: SeongJae Park
Date: Fri Dec 10 14:46:55 2021 -0800
selftests/damon: test debugfs file reads/writes with huge count
commit b4a002889d24979295ed3c2bf1d5fcfb3901026a upstream.
DAMON debugfs interface users were able to trigger warning by writing
some files with arbitrarily large 'count' parameter. The issue is fixed
with commit db7a347b26fe ("mm/damon/dbgfs: use '\_\_GFP\_NOWARN' for
user-specified size buffer allocation"). This commit adds a test case
for the issue in DAMON selftests to avoid future regressions.
Link: https://lkml.kernel.org/r/20211201150440.1088-11-sj@kernel.org
Signed-off-by: SeongJae Park
Cc: Brendan Higgins
Cc: Shuah Khan
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit a272f990cb266c7c31e5a687bd6838aed68322b6
Author: Tony Lindgren
Date: Wed Oct 6 08:38:09 2021 +0300
bus: ti-sysc: Fix variable set but not used warning for reinit\_modules
commit 1b1da99b845337362a3dafe0f7b49927ab4ae041 upstream.
Fix drivers/bus/ti-sysc.c:2494:13: error: variable 'error' set but not
used introduced by commit 9d881361206e ("bus: ti-sysc: Add quirk handling
for reinit on context lost").
Reported-by: kernel test robot
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit 11053a021937aa403c883d3e8ef78d8c5308f583
Author: Jens Axboe
Date: Mon Dec 13 09:04:01 2021 -0700
io-wq: drop wqe lock before creating new worker
commit d800c65c2d4eccebb27ffb7808e842d5b533823c upstream.
We have two io-wq creation paths:
- On queue enqueue
- When a worker goes to sleep
The latter invokes worker creation with the wqe->lock held, but that can
run into problems if we end up exiting and need to cancel the queued work.
syzbot caught this:
============================================
WARNING: possible recursive locking detected
5.16.0-rc4-syzkaller #0 Not tainted
--------------------------------------------
iou-wrk-6468/6471 is trying to acquire lock:
ffff88801aa98018 (&wqe->lock){+.+.}-{2:2}, at: io\_worker\_cancel\_cb+0xb7/0x210 fs/io-wq.c:187
but task is already holding lock:
ffff88801aa98018 (&wqe->lock){+.+.}-{2:2}, at: io\_wq\_worker\_sleeping+0xb6/0x140 fs/io-wq.c:700
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0
----
lock(&wqe->lock);
lock(&wqe->lock);
\*\*\* DEADLOCK \*\*\*
May be due to missing lock nesting notation
1 lock held by iou-wrk-6468/6471:
#0: ffff88801aa98018 (&wqe->lock){+.+.}-{2:2}, at: io\_wq\_worker\_sleeping+0xb6/0x140 fs/io-wq.c:700
stack backtrace:
CPU: 1 PID: 6471 Comm: iou-wrk-6468 Not tainted 5.16.0-rc4-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x1dc/0x2d8 lib/dump\_stack.c:106
print\_deadlock\_bug kernel/locking/lockdep.c:2956 [inline]
check\_deadlock kernel/locking/lockdep.c:2999 [inline]
validate\_chain+0x5984/0x8240 kernel/locking/lockdep.c:3788
\_\_lock\_acquire+0x1382/0x2b00 kernel/locking/lockdep.c:5027
lock\_acquire+0x19f/0x4d0 kernel/locking/lockdep.c:5637
\_\_raw\_spin\_lock include/linux/spinlock\_api\_smp.h:133 [inline]
\_raw\_spin\_lock+0x2a/0x40 kernel/locking/spinlock.c:154
io\_worker\_cancel\_cb+0xb7/0x210 fs/io-wq.c:187
io\_wq\_cancel\_tw\_create fs/io-wq.c:1220 [inline]
io\_queue\_worker\_create+0x3cf/0x4c0 fs/io-wq.c:372
io\_wq\_worker\_sleeping+0xbe/0x140 fs/io-wq.c:701
sched\_submit\_work kernel/sched/core.c:6295 [inline]
schedule+0x67/0x1f0 kernel/sched/core.c:6323
schedule\_timeout+0xac/0x300 kernel/time/timer.c:1857
wait\_woken+0xca/0x1b0 kernel/sched/wait.c:460
unix\_msg\_wait\_data net/unix/unix\_bpf.c:32 [inline]
unix\_bpf\_recvmsg+0x7f9/0xe20 net/unix/unix\_bpf.c:77
unix\_stream\_recvmsg+0x214/0x2c0 net/unix/af\_unix.c:2832
sock\_recvmsg\_nosec net/socket.c:944 [inline]
sock\_recvmsg net/socket.c:962 [inline]
sock\_read\_iter+0x3a7/0x4d0 net/socket.c:1035
call\_read\_iter include/linux/fs.h:2156 [inline]
io\_iter\_do\_read fs/io\_uring.c:3501 [inline]
io\_read fs/io\_uring.c:3558 [inline]
io\_issue\_sqe+0x144c/0x9590 fs/io\_uring.c:6671
io\_wq\_submit\_work+0x2d8/0x790 fs/io\_uring.c:6836
io\_worker\_handle\_work+0x808/0xdd0 fs/io-wq.c:574
io\_wqe\_worker+0x395/0x870 fs/io-wq.c:630
ret\_from\_fork+0x1f/0x30
We can safely drop the lock before doing work creation, making the two
contexts the same in that regard.
Reported-by: syzbot+b18b8be69df33a3918e9@syzkaller.appspotmail.com
Fixes: 71a85387546e ("io-wq: check for wq exit after adding new worker task\_work")
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit a96ac0688acb40035ba5c0612b52f379a863d1cd
Author: Paul E. McKenney
Date: Tue Jul 20 06:16:27 2021 -0700
rcu: Mark accesses to rcu\_state.n\_force\_qs
commit 2431774f04d1050292054c763070021bade7b151 upstream.
This commit marks accesses to the rcu\_state.n\_force\_qs. These data
races are hard to make happen, but syzkaller was equal to the task.
Reported-by: syzbot+e08a83a1940ec3846cd5@syzkaller.appspotmail.com
Acked-by: Marco Elver
Signed-off-by: Paul E. McKenney
Signed-off-by: Greg Kroah-Hartman
commit 4b4e5bbf9386d4ec21d91c0cb0fd60b9bba778ec
Author: Jens Axboe
Date: Fri Dec 10 08:29:30 2021 -0700
io-wq: check for wq exit after adding new worker task\_work
commit 71a85387546e50b1a37b0fa45dadcae3bfb35cf6 upstream.
We check IO\_WQ\_BIT\_EXIT before attempting to create a new worker, and
wq exit cancels pending work if we have any. But it's possible to have
a race between the two, where creation checks exit finding it not set,
but we're in the process of exiting. The exit side will cancel pending
creation task\_work, but there's a gap where we add task\_work after we've
canceled existing creations at exit time.
Fix this by checking the EXIT bit post adding the creation task\_work.
If it's set, run the same cancelation that exit does.
Reported-and-tested-by: syzbot+b60c982cb0efc5e05a47@syzkaller.appspotmail.com
Reviewed-by: Hao Xu
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 024f9c7cd3d8d9cb0e499b949c7e209b47287cf2
Author: Jens Axboe
Date: Mon Dec 6 10:49:04 2021 -0700
io-wq: remove spurious bit clear on task\_work addition
commit e47498afeca9a0c6d07eeeacc46d563555a3f677 upstream.
There's a small race here where the task\_work could finish and drop
the worker itself, so that by the time that task\_work\_add() returns
with a successful addition we've already put the worker.
The worker callbacks clear this bit themselves, so we don't actually
need to manually clear it in the caller. Get rid of it.
Reported-by: syzbot+b60c982cb0efc5e05a47@syzkaller.appspotmail.com
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit dfc3fff63793c571147930b13c0f8c689c4281ac
Author: George Kennedy
Date: Thu Nov 18 14:03:28 2021 -0500
scsi: scsi\_debug: Sanity check block descriptor length in resp\_mode\_select()
commit e0a2c28da11e2c2b963fc01d50acbf03045ac732 upstream.
In resp\_mode\_select() sanity check the block descriptor len to avoid UAF.
BUG: KASAN: use-after-free in resp\_mode\_select+0xa4c/0xb40 drivers/scsi/scsi\_debug.c:2509
Read of size 1 at addr ffff888026670f50 by task scsicmd/15032
CPU: 1 PID: 15032 Comm: scsicmd Not tainted 5.15.0-01d0625 #15
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS
Call Trace:
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:107
print\_address\_description.constprop.9+0x28/0x160 mm/kasan/report.c:257
kasan\_report.cold.14+0x7d/0x117 mm/kasan/report.c:443
\_\_asan\_report\_load1\_noabort+0x14/0x20 mm/kasan/report\_generic.c:306
resp\_mode\_select+0xa4c/0xb40 drivers/scsi/scsi\_debug.c:2509
schedule\_resp+0x4af/0x1a10 drivers/scsi/scsi\_debug.c:5483
scsi\_debug\_queuecommand+0x8c9/0x1e70 drivers/scsi/scsi\_debug.c:7537
scsi\_queue\_rq+0x16b4/0x2d10 drivers/scsi/scsi\_lib.c:1521
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1640
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1762
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1839
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:63
sg\_common\_write.isra.18+0xeb3/0x2000 drivers/scsi/sg.c:837
sg\_new\_write.isra.19+0x570/0x8c0 drivers/scsi/sg.c:775
sg\_ioctl\_common+0x14d6/0x2710 drivers/scsi/sg.c:941
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1166
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:52
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:50
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae arch/x86/entry/entry\_64.S:113
Link: https://lore.kernel.org/r/1637262208-28850-1-git-send-email-george.kennedy@oracle.com
Reported-by: syzkaller
Acked-by: Douglas Gilbert
Signed-off-by: George Kennedy
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 3085147645938eb41f0bc0e25ef9791e71f5ee4b
Author: George Kennedy
Date: Tue Nov 9 13:57:27 2021 -0500
scsi: scsi\_debug: Fix type in min\_t to avoid stack OOB
commit 36e07d7ede88a1f1ef8f0f209af5b7612324ac2c upstream.
Change min\_t() to use type "u32" instead of type "int" to avoid stack out
of bounds. With min\_t() type "int" the values get sign extended and the
larger value gets used causing stack out of bounds.
BUG: KASAN: stack-out-of-bounds in memcpy include/linux/fortify-string.h:191 [inline]
BUG: KASAN: stack-out-of-bounds in sg\_copy\_buffer+0x1de/0x240 lib/scatterlist.c:976
Read of size 127 at addr ffff888072607128 by task syz-executor.7/18707
CPU: 1 PID: 18707 Comm: syz-executor.7 Not tainted 5.15.0-syzk #1
Hardware name: Red Hat KVM, BIOS 1.13.0-2
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:106
print\_address\_description.constprop.9+0x28/0x160 mm/kasan/report.c:256
\_\_kasan\_report mm/kasan/report.c:442 [inline]
kasan\_report.cold.14+0x7d/0x117 mm/kasan/report.c:459
check\_region\_inline mm/kasan/generic.c:183 [inline]
kasan\_check\_range+0x1a3/0x210 mm/kasan/generic.c:189
memcpy+0x23/0x60 mm/kasan/shadow.c:65
memcpy include/linux/fortify-string.h:191 [inline]
sg\_copy\_buffer+0x1de/0x240 lib/scatterlist.c:976
sg\_copy\_from\_buffer+0x33/0x40 lib/scatterlist.c:1000
fill\_from\_dev\_buffer.part.34+0x82/0x130 drivers/scsi/scsi\_debug.c:1162
fill\_from\_dev\_buffer drivers/scsi/scsi\_debug.c:1888 [inline]
resp\_readcap16+0x365/0x3b0 drivers/scsi/scsi\_debug.c:1887
schedule\_resp+0x4d8/0x1a70 drivers/scsi/scsi\_debug.c:5478
scsi\_debug\_queuecommand+0x8c9/0x1ec0 drivers/scsi/scsi\_debug.c:7533
scsi\_dispatch\_cmd drivers/scsi/scsi\_lib.c:1520 [inline]
scsi\_queue\_rq+0x16b0/0x2d40 drivers/scsi/scsi\_lib.c:1699
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1639
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1761
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1838
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:62
sg\_common\_write.isra.18+0xeb3/0x2000 drivers/scsi/sg.c:836
sg\_new\_write.isra.19+0x570/0x8c0 drivers/scsi/sg.c:774
sg\_ioctl\_common+0x14d6/0x2710 drivers/scsi/sg.c:939
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1165
vfs\_ioctl fs/ioctl.c:51 [inline]
\_\_do\_sys\_ioctl fs/ioctl.c:874 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:860 [inline]
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:860
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: https://lore.kernel.org/r/1636484247-21254-1-git-send-email-george.kennedy@oracle.com
Reported-by: syzkaller
Acked-by: Douglas Gilbert
Signed-off-by: George Kennedy
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 47d11d35203b0aa13533634e270fe2c3610e531b
Author: George Kennedy
Date: Thu Nov 4 15:06:37 2021 -0500
scsi: scsi\_debug: Don't call kcalloc() if size arg is zero
commit 3344b58b53a76199dae48faa396e9fc37bf86992 upstream.
If the size arg to kcalloc() is zero, it returns ZERO\_SIZE\_PTR. Because of
that, for a following NULL pointer check to work on the returned pointer,
kcalloc() must not be called with the size arg equal to zero. Return early
without error before the kcalloc() call if size arg is zero.
BUG: KASAN: null-ptr-deref in memcpy include/linux/fortify-string.h:191 [inline]
BUG: KASAN: null-ptr-deref in sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
Write of size 4 at addr 0000000000000010 by task syz-executor.1/22789
CPU: 1 PID: 22789 Comm: syz-executor.1 Not tainted 5.15.0-syzk #1
Hardware name: Red Hat KVM, BIOS 1.13.0-2
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:106
\_\_kasan\_report mm/kasan/report.c:446 [inline]
kasan\_report.cold.14+0x112/0x117 mm/kasan/report.c:459
check\_region\_inline mm/kasan/generic.c:183 [inline]
kasan\_check\_range+0x1a3/0x210 mm/kasan/generic.c:189
memcpy+0x3b/0x60 mm/kasan/shadow.c:66
memcpy include/linux/fortify-string.h:191 [inline]
sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2954 [inline]
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2946 [inline]
resp\_verify+0x49e/0x930 drivers/scsi/scsi\_debug.c:4276
schedule\_resp+0x4d8/0x1a70 drivers/scsi/scsi\_debug.c:5478
scsi\_debug\_queuecommand+0x8c9/0x1ec0 drivers/scsi/scsi\_debug.c:7533
scsi\_dispatch\_cmd drivers/scsi/scsi\_lib.c:1520 [inline]
scsi\_queue\_rq+0x16b0/0x2d40 drivers/scsi/scsi\_lib.c:1699
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1639
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1761
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1838
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:62
blk\_execute\_rq+0xdb/0x360 block/blk-exec.c:102
sg\_scsi\_ioctl drivers/scsi/scsi\_ioctl.c:621 [inline]
scsi\_ioctl+0x8bb/0x15c0 drivers/scsi/scsi\_ioctl.c:930
sg\_ioctl\_common+0x172d/0x2710 drivers/scsi/sg.c:1112
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1165
vfs\_ioctl fs/ioctl.c:51 [inline]
\_\_do\_sys\_ioctl fs/ioctl.c:874 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:860 [inline]
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:860
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy@oracle.com
Reported-by: syzkaller
Acked-by: Douglas Gilbert
Signed-off-by: George Kennedy
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit d2ccdd4e4efab06178608a34d7bfb20a54104c02
Author: Miklos Szeredi
Date: Thu Nov 4 10:55:34 2021 +0100
ovl: fix warning in ovl\_create\_real()
commit 1f5573cfe7a7056e80a92c7a037a3e69f3a13d1c upstream.
Syzbot triggered the following warning in ovl\_workdir\_create() ->
ovl\_create\_real():
if (!err && WARN\_ON(!newdentry->d\_inode)) {
The reason is that the cgroup2 filesystem returns from mkdir without
instantiating the new dentry.
Weird filesystems such as this will be rejected by overlayfs at a later
stage during setup, but to prevent such a warning, call ovl\_mkdir\_real()
directly from ovl\_workdir\_create() and reject this case early.
Reported-and-tested-by: syzbot+75eab84fd0af9e8bf66b@syzkaller.appspotmail.com
Signed-off-by: Miklos Szeredi
Signed-off-by: Greg Kroah-Hartman
commit 4658f2a9b3364fd32b5d4d1ff7437c5a8ec6d4da
Author: Miklos Szeredi
Date: Fri Oct 22 17:03:01 2021 +0200
fuse: annotate lock in fuse\_reverse\_inval\_entry()
commit bda9a71980e083699a0360963c0135657b73f47a upstream.
Add missing inode lock annotatation; found by syzbot.
Reported-and-tested-by: syzbot+9f747458f5990eaa8d43@syzkaller.appspotmail.com
Signed-off-by: Miklos Szeredi
Signed-off-by: Greg Kroah-Hartman
commit 8c6fdf62bfe1bc72bfceeaf832ef7499c7ed09ba
Author: Pavel Skripkin
Date: Thu Aug 19 12:42:21 2021 +0200
media: mxl111sf: change mutex\_init() location
commit 44870a9e7a3c24acbb3f888b2a7cc22c9bdf7e7f upstream.
Syzbot reported, that mxl111sf\_ctrl\_msg() uses uninitialized
mutex. The problem was in wrong mutex\_init() location.
Previous mutex\_init(&state->msg\_lock) call was in ->init() function, but
dvb\_usbv2\_init() has this order of calls:
dvb\_usbv2\_init()
dvb\_usbv2\_adapter\_init()
dvb\_usbv2\_adapter\_frontend\_init()
props->frontend\_attach()
props->init()
Since mxl111sf\_\* devices call mxl111sf\_ctrl\_msg() in ->frontend\_attach()
internally we need to initialize state->msg\_lock before
frontend\_attach(). To achieve it, ->probe() call added to all mxl111sf\_\*
devices, which will simply initiaize mutex.
Reported-and-tested-by: syzbot+5ca0bf339f13c4243001@syzkaller.appspotmail.com
Fixes: 8572211842af ("[media] mxl111sf: convert to new DVB USB")
Signed-off-by: Pavel Skripkin
Signed-off-by: Sean Young
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 403716741c6c2c510dce44e88f085a740f535de6
Author: Alan Stern
Date: Fri Sep 3 13:53:12 2021 -0400
USB: core: Make do\_proc\_control() and do\_proc\_bulk() killable
commit ae8709b296d80c7f45aa1f35c0e7659ad69edce1 upstream.
The USBDEVFS\_CONTROL and USBDEVFS\_BULK ioctls invoke
usb\_start\_wait\_urb(), which contains an uninterruptible wait with a
user-specified timeout value. If timeout value is very large and the
device being accessed does not respond in a reasonable amount of time,
the kernel will complain about "Task X blocked for more than N
seconds", as found in testing by syzbot:
INFO: task syz-executor.0:8700 blocked for more than 143 seconds.
Not tainted 5.14.0-rc7-syzkaller #0
"echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
task:syz-executor.0 state:D stack:23192 pid: 8700 ppid: 8455 flags:0x00004004
Call Trace:
context\_switch kernel/sched/core.c:4681 [inline]
\_\_schedule+0xc07/0x11f0 kernel/sched/core.c:5938
schedule+0x14b/0x210 kernel/sched/core.c:6017
schedule\_timeout+0x98/0x2f0 kernel/time/timer.c:1857
do\_wait\_for\_common+0x2da/0x480 kernel/sched/completion.c:85
\_\_wait\_for\_common kernel/sched/completion.c:106 [inline]
wait\_for\_common kernel/sched/completion.c:117 [inline]
wait\_for\_completion\_timeout+0x46/0x60 kernel/sched/completion.c:157
usb\_start\_wait\_urb+0x167/0x550 drivers/usb/core/message.c:63
do\_proc\_bulk+0x978/0x1080 drivers/usb/core/devio.c:1236
proc\_bulk drivers/usb/core/devio.c:1273 [inline]
usbdev\_do\_ioctl drivers/usb/core/devio.c:2547 [inline]
usbdev\_ioctl+0x3441/0x6b10 drivers/usb/core/devio.c:2713
...
To fix this problem, this patch replaces usbfs's calls to
usb\_control\_msg() and usb\_bulk\_msg() with special-purpose code that
does essentially the same thing (as recommended in the comment for
usb\_start\_wait\_urb()), except that it always uses a killable wait and
it uses GFP\_KERNEL rather than GFP\_NOIO.
Reported-and-tested-by: syzbot+ada0f7d3d9fd2016d927@syzkaller.appspotmail.com
Suggested-by: Oliver Neukum
Signed-off-by: Alan Stern
Link: https://lore.kernel.org/r/20210903175312.GA468440@rowland.harvard.edu
Signed-off-by: Greg Kroah-Hartman
commit 303644fe7e0c30df6925ede3dd35b3a5b2c454b8
Author: Alexei Starovoitov
Date: Tue Dec 14 19:25:13 2021 -0800
bpf: Fix extable address check.
commit 588a25e92458c6efeb7a261d5ca5726f5de89184 upstream.
The verifier checks that PTR\_TO\_BTF\_ID pointer is either valid or NULL,
but it cannot distinguish IS\_ERR pointer from valid one.
When offset is added to IS\_ERR pointer it may become small positive
value which is a user address that is not handled by extable logic
and has to be checked for at the runtime.
Tighten BPF\_PROBE\_MEM pointer check code to prevent this case.
Fixes: 4c5de127598e ("bpf: Emit explicit NULL pointer checks for PROBE\_LDX instructions.")
Reported-by: Lorenzo Fontana
Signed-off-by: Alexei Starovoitov
Acked-by: Daniel Borkmann
Signed-off-by: Daniel Borkmann
Signed-off-by: Greg Kroah-Hartman
commit eea5a58d86a4cc19660bc8e03be926c928cf4db0
Author: Jie Meng
Date: Wed Oct 6 12:41:35 2021 -0700
bpf, x64: Factor out emission of REX byte in more cases
commit 6364d7d75a0e015a405d1f8a07f267f076c36ca6 upstream.
Introduce a single reg version of maybe\_emit\_mod() and factor out
common code in more cases.
Signed-off-by: Jie Meng
Signed-off-by: Daniel Borkmann
Acked-by: Song Liu
Link: https://lore.kernel.org/bpf/20211006194135.608932-1-jmeng@fb.com
Signed-off-by: Greg Kroah-Hartman
commit 7e83a6577d5c7a5d6049fa062e51dd5d4170a2f4
Author: Matthieu Baerts
Date: Tue Dec 14 15:16:04 2021 -0800
mptcp: add missing documented NL params
commit 6813b1928758ce64fabbb8ef157f994b7c2235fa upstream.
'loc\_id' and 'rem\_id' are set in all events linked to subflows but those
were missing in the events description in the comments.
Fixes: b911c97c7dc7 ("mptcp: add netlink event support")
Signed-off-by: Matthieu Baerts
Signed-off-by: Mat Martineau
Signed-off-by: Jakub Kicinski
Signed-off-by: Greg Kroah-Hartman
commit e8d38fcd0a1ca4abd4b132d098c32bc13d6f54f0
Author: Magnus Karlsson
Date: Tue Dec 14 11:26:07 2021 +0100
xsk: Do not sleep in poll() when need\_wakeup set
commit bd0687c18e635b63233dc87f38058cd728802ab4 upstream.
Do not sleep in poll() when the need\_wakeup flag is set. When this
flag is set, the application needs to explicitly wake up the driver
with a syscall (poll, recvmsg, sendmsg, etc.) to guarantee that Rx
and/or Tx processing will be processed promptly. But the current code
in poll(), sleeps first then wakes up the driver. This means that no
driver processing will occur (baring any interrupts) until the timeout
has expired.
Fix this by checking the need\_wakeup flag first and if set, wake the
driver and return to the application. Only if need\_wakeup is not set
should the process sleep if there is a timeout set in the poll() call.
Fixes: 77cd0d7b3f25 ("xsk: add support for need\_wakeup flag in AF\_XDP rings")
Reported-by: Keith Wiles
Signed-off-by: Magnus Karlsson
Signed-off-by: Daniel Borkmann
Acked-by: Maciej Fijalkowski
Link: https://lore.kernel.org/bpf/20211214102607.7677-1-magnus.karlsson@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 6b2ee1002c6b96ce06a6f6bf9c23d08aa47190f8
Author: Fabio Estevam
Date: Wed Nov 24 15:45:41 2021 -0300
ARM: dts: imx6ull-pinfunc: Fix CSI\_DATA07\_\_ESAI\_TX0 pad name
commit 737e65c7956795b3553781fb7bc82fce1c39503f upstream.
According to the i.MX6ULL Reference Manual, pad CSI\_DATA07 may
have the ESAI\_TX0 functionality, not ESAI\_T0.
Also, NXP's i.MX Config Tools 10.0 generates dtsi with the
MX6ULL\_PAD\_CSI\_DATA07\_\_ESAI\_TX0 naming, so fix it accordingly.
There are no devicetree users in mainline that use the old name,
so just remove the old entry.
Fixes: c201369d4aa5 ("ARM: dts: imx6ull: add imx6ull support")
Reported-by: George Makarov
Signed-off-by: Fabio Estevam
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit 0e8ffdf3b86dfd44b651f91b12fcae76c25c453b
Author: Matthias Schiffer
Date: Mon Nov 15 10:18:52 2021 +0100
can: m\_can: pci: use custom bit timings for Elkhart Lake
commit ea4c1787685dbf9842046f05b6390b6901ee6ba2 upstream.
The relevant datasheet [1] specifies nonstandard limits for the bit timing
parameters. While it is unclear what the exact effect of violating these
limits is, it seems like a good idea to adhere to the documentation.
[1] Intel AtomÂ® x6000E Series, and IntelÂ® PentiumÂ® and CeleronÂ® N and J
Series Processors for IoT Applications Datasheet,
Volume 2 (Book 3 of 3), July 2021, Revision 001
Fixes: cab7ffc0324f ("can: m\_can: add PCI glue driver for Intel Elkhart Lake")
Link: https://lore.kernel.org/all/9eba5d7c05a48ead4024ffa6e5926f191d8c6b38.1636967198.git.matthias.schiffer@ew.tq-group.com
Signed-off-by: Matthias Schiffer
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 274f4b342ba98432d58ec384a648872abc2fc2aa
Author: Matthias Schiffer
Date: Mon Nov 15 10:18:51 2021 +0100
can: m\_can: make custom bittiming fields const
commit ea22ba40debee29ee7257c42002409899e9311c1 upstream.
The assigned timing structs will be defined a const anyway, so we can
avoid a few casts by declaring the struct fields as const as well.
Link: https://lore.kernel.org/all/4508fa4e639164b2584c49a065d90c78a91fa568.1636967198.git.matthias.schiffer@ew.tq-group.com
Signed-off-by: Matthias Schiffer
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 5b4641e9c06c0abc153476b3898cf1bbe43cd7fc
Author: Matthias Schiffer
Date: Mon Nov 15 10:18:50 2021 +0100
Revert "can: m\_can: remove support for custom bit timing"
commit ea768b2ffec6cc9c3e17c37ef75d0539b8f89ff5 upstream.
The timing limits specified by the Elkhart Lake CPU datasheets do not
match the defaults. Let's reintroduce the support for custom bit timings.
This reverts commit 0ddd83fbebbc5537f9d180d31f659db3564be708.
Link: https://lore.kernel.org/all/00c9e2596b1a548906921a574d4ef7a03c0dace0.1636967198.git.matthias.schiffer@ew.tq-group.com
Signed-off-by: Matthias Schiffer
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit e3a01c14e806f10e2427d067814db7af1cc85952
Author: Mario Limonciello
Date: Thu Dec 9 12:13:53 2021 -0600
drm/amd/pm: fix reading SMU FW version from amdgpu\_firmware\_info on YC
commit dcd10d879a9d1d4e929d374c2f24aba8fac3252b upstream.
This value does not get cached into adev->pm.fw\_version during
startup for smu13 like it does for other SMU like smu12.
Signed-off-by: Mario Limonciello
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit a386ae526866cd6893616e4f51d8040f19fb5193
Author: Hawking Zhang
Date: Sat Dec 4 19:22:12 2021 +0800
drm/amdgpu: don't override default ECO\_BITs setting
commit 841933d5b8aa853abe68e63827f68f50fab37226 upstream.
Leave this bit as hardware default setting
Signed-off-by: Hawking Zhang
Reviewed-by: Alex Deucher
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit f2e600f6572bd6fe5d7f1b461703c819e7374f63
Author: Le Ma
Date: Sat Dec 4 18:59:08 2021 +0800
drm/amdgpu: correct register access for RLC\_JUMP\_TABLE\_RESTORE
commit f3a8076eb28cae1553958c629aecec479394bbe2 upstream.
should count on GC IP base address
Signed-off-by: Le Ma
Signed-off-by: Hawking Zhang
Reviewed-by: Hawking Zhang
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 9b9f2567145b34538d2e5eaeccb5ee8ac282a87c
Author: Russell Currey
Date: Tue Nov 23 18:15:20 2021 +1000
powerpc/module\_64: Fix livepatching for RO modules
commit 8734b41b3efe0fc6082c1937b0e88556c396dc96 upstream.
Livepatching a loaded module involves applying relocations through
apply\_relocate\_add(), which attempts to write to read-only memory when
CONFIG\_STRICT\_MODULE\_RWX=y. Work around this by performing these
writes through the text poke area by using patch\_instruction().
R\_PPC\_REL24 is the only relocation type generated by the kpatch-build
userspace tool or klp-convert kernel tree that I observed applying a
relocation to a post-init module.
A more comprehensive solution is planned, but using patch\_instruction()
for R\_PPC\_REL24 on should serve as a sufficient fix.
This does have a performance impact, I observed ~15% overhead in
module\_load() on POWER8 bare metal with checksum verification off.
Fixes: c35717c71e98 ("powerpc: Set ARCH\_HAS\_STRICT\_MODULE\_RWX")
Cc: stable@vger.kernel.org # v5.14+
Reported-by: Joe Lawrence
Signed-off-by: Russell Currey
Tested-by: Joe Lawrence
[mpe: Check return codes from patch\_instruction()]
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20211214121248.777249-1-mpe@ellerman.id.au
Signed-off-by: Greg Kroah-Hartman
commit 78f27c43eb166c931b0919fa7784734573d3f502
Author: George Kennedy
Date: Tue Dec 14 09:45:10 2021 -0500
libata: if T\_LENGTH is zero, dma direction should be DMA\_NONE
commit 5da5231bb47864e5dd6c6731151e98b6ee498827 upstream.
Avoid data corruption by rejecting pass-through commands where
T\_LENGTH is zero (No data is transferred) and the dma direction
is not DMA\_NONE.
Cc:
Reported-by: syzkaller
Signed-off-by: George Kennedy
Signed-off-by: Damien Le Moal
Signed-off-by: Greg Kroah-Hartman
commit f67c85a557c8291441cc9071ff590c319fe46c74
Author: Adrian Hunter
Date: Mon Dec 13 10:48:29 2021 +0200
perf inject: Fix segfault due to perf\_data\_\_fd() without open
commit c271a55b0c6029fed0cac909fa57999a11467132 upstream.
The fixed commit attempts to get the output file descriptor even if the
file was never opened e.g.
$ perf record uname
Linux
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.002 MB perf.data (7 samples) ]
$ perf inject -i perf.data --vm-time-correlation=dry-run
Segmentation fault (core dumped)
$ gdb --quiet perf
Reading symbols from perf...
(gdb) r inject -i perf.data --vm-time-correlation=dry-run
Starting program: /home/ahunter/bin/perf inject -i perf.data --vm-time-correlation=dry-run
[Thread debugging using libthread\_db enabled]
Using host libthread\_db library "/lib/x86\_64-linux-gnu/libthread\_db.so.1".
Program received signal SIGSEGV, Segmentation fault.
\_\_GI\_\_\_fileno (fp=0x0) at fileno.c:35
35 fileno.c: No such file or directory.
(gdb) bt
#0 \_\_GI\_\_\_fileno (fp=0x0) at fileno.c:35
#1 0x00005621e48dd987 in perf\_data\_\_fd (data=0x7fff4c68bd08) at util/data.h:72
#2 perf\_data\_\_fd (data=0x7fff4c68bd08) at util/data.h:69
#3 cmd\_inject (argc=, argv=0x7fff4c69c1f0) at builtin-inject.c:1017
#4 0x00005621e4936783 in run\_builtin (p=0x5621e4ee6878 , argc=4, argv=0x7fff4c69c1f0) at perf.c:313
#5 0x00005621e4897d5c in handle\_internal\_command (argv=, argc=) at perf.c:365
#6 run\_argv (argcp=, argv=) at perf.c:409
#7 main (argc=4, argv=0x7fff4c69c1f0) at perf.c:539
(gdb)
Fixes: 0ae03893623dd1dd ("perf tools: Pass a fd to perf\_file\_header\_\_read\_pipe()")
Signed-off-by: Adrian Hunter
Tested-by: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Namhyung Kim
Cc: Riccardo Mancini
Cc: stable@vger.kernel.org
Link: http://lore.kernel.org/lkml/20211213084829.114772-3-adrian.hunter@intel.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit a7c0e6aa63c832dffb500e9619f1624c60e1b435
Author: Adrian Hunter
Date: Mon Dec 13 10:48:28 2021 +0200
perf inject: Fix segfault due to close without open
commit 0c8e32fe48f549eef27c8c6b0a63530f83c3a643 upstream.
The fixed commit attempts to close inject.output even if it was never
opened e.g.
$ perf record uname
Linux
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.002 MB perf.data (7 samples) ]
$ perf inject -i perf.data --vm-time-correlation=dry-run
Segmentation fault (core dumped)
$ gdb --quiet perf
Reading symbols from perf...
(gdb) r inject -i perf.data --vm-time-correlation=dry-run
Starting program: /home/ahunter/bin/perf inject -i perf.data --vm-time-correlation=dry-run
[Thread debugging using libthread\_db enabled]
Using host libthread\_db library "/lib/x86\_64-linux-gnu/libthread\_db.so.1".
Program received signal SIGSEGV, Segmentation fault.
0x00007eff8afeef5b in \_IO\_new\_fclose (fp=0x0) at iofclose.c:48
48 iofclose.c: No such file or directory.
(gdb) bt
#0 0x00007eff8afeef5b in \_IO\_new\_fclose (fp=0x0) at iofclose.c:48
#1 0x0000557fc7b74f92 in perf\_data\_\_close (data=data@entry=0x7ffcdafa6578) at util/data.c:376
#2 0x0000557fc7a6b807 in cmd\_inject (argc=, argv=) at builtin-inject.c:1085
#3 0x0000557fc7ac4783 in run\_builtin (p=0x557fc8074878 , argc=4, argv=0x7ffcdafb6a60) at perf.c:313
#4 0x0000557fc7a25d5c in handle\_internal\_command (argv=, argc=) at perf.c:365
#5 run\_argv (argcp=, argv=) at perf.c:409
#6 main (argc=4, argv=0x7ffcdafb6a60) at perf.c:539
(gdb)
Fixes: 02e6246f5364d526 ("perf inject: Close inject.output on exit")
Signed-off-by: Adrian Hunter
Tested-by: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Namhyung Kim
Cc: Riccardo Mancini
Cc: stable@vger.kernel.org
Link: http://lore.kernel.org/lkml/20211213084829.114772-2-adrian.hunter@intel.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit 4a74df7707b5a483952e0b6c714afa734035871d
Author: Bin Meng
Date: Wed Jun 16 15:46:45 2021 +0800
riscv: dts: unmatched: Add gpio card detect to mmc-spi-slot
commit 298d03c2d7f1b5daacb6d4f4053fd3d677d67087 upstream.
Per HiFive Unmatched schematics, the card detect signal of the
micro SD card is connected to gpio pin #15, which should be
reflected in the DT via the  property, as described in
Documentation/devicetree/bindings/mmc/mmc-spi-slot.txt.
[1] https://sifive.cdn.prismic.io/sifive/6a06d6c0-6e66-49b5-8e9e-e68ce76f4192\_hifive-unmatched-schematics-v3.pdf
Signed-off-by: Bin Meng
Fixes: d573b5558abb ("riscv: dts: add initial board data for the SiFive HiFive Unmatched")
Cc: stable@vger.kernel.org
Signed-off-by: Palmer Dabbelt
Signed-off-by: Greg Kroah-Hartman
commit 7fe286afbd90940cf5b03e9a3d93fa098792125f
Author: Bin Meng
Date: Wed Jun 16 15:46:44 2021 +0800
riscv: dts: unleashed: Add gpio card detect to mmc-spi-slot
commit 6331b8765cd0634a4e4cdcc1a6f1a74196616b94 upstream.
Per HiFive Unleashed schematics, the card detect signal of the
micro SD card is connected to gpio pin #11, which should be
reflected in the DT via the  property, as described in
Documentation/devicetree/bindings/mmc/mmc-spi-slot.txt.
[1] https://sifive.cdn.prismic.io/sifive/c52a8e32-05ce-4aaf-95c8-7bf8453f8698\_hifive-unleashed-a00-schematics-1.pdf
Signed-off-by: Bin Meng
Fixes: d573b5558abb ("riscv: dts: add initial board data for the SiFive HiFive Unmatched")
Cc: stable@vger.kernel.org
Signed-off-by: Palmer Dabbelt
Signed-off-by: Greg Kroah-Hartman
commit 5e14b8b2680a409165a1a94013961c998c5c61cb
Author: Zqiang
Date: Fri Dec 17 15:42:07 2021 +0800
locking/rtmutex: Fix incorrect condition in rtmutex\_spin\_on\_owner()
commit 8f556a326c93213927e683fc32bbf5be1b62540a upstream.
Optimistic spinning needs to be terminated when the spinning waiter is not
longer the top waiter on the lock, but the condition is negated. It
terminates if the waiter is the top waiter, which is defeating the whole
purpose.
Fixes: c3123c431447 ("locking/rtmutex: Dont dereference waiter lockless")
Signed-off-by: Zqiang
Signed-off-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20211217074207.77425-1-qiang1.zhang@intel.com
Signed-off-by: Greg Kroah-Hartman
commit c63433a09d6ae4c226fcbc66da4c58fc189fd746
Author: Thiago Rafael Becker
Date: Fri Dec 17 15:20:22 2021 -0300
cifs: sanitize multiple delimiters in prepath
commit a31080899d5fdafcccf7f39dd214a814a2c82626 upstream.
mount.cifs can pass a device with multiple delimiters in it. This will
cause rename(2) to fail with ENOENT.
V2:
- Make sanitize\_path more readable.
- Fix multiple delimiters between UNC and prepath.
- Avoid a memory leak if a bad user starts putting a lot of delimiters
in the path on purpose.
BugLink: https://bugzilla.redhat.com/show\_bug.cgi?id=2031200
Fixes: 24e0a1eff9e2 ("cifs: switch to new mount api")
Cc: stable@vger.kernel.org # 5.11+
Acked-by: Ronnie Sahlberg
Signed-off-by: Thiago Rafael Becker
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit c5664d508674c77a52d311af8b1e11d08ac0cf4b
Author: Yu Liao
Date: Mon Dec 13 21:57:27 2021 +0800
timekeeping: Really make sure wall\_to\_monotonic isn't positive
commit 4e8c11b6b3f0b6a283e898344f154641eda94266 upstream.
Even after commit e1d7ba873555 ("time: Always make sure wall\_to\_monotonic
isn't positive") it is still possible to make wall\_to\_monotonic positive
by running the following code:
int main(void)
{
struct timespec time;
clock\_gettime(CLOCK\_MONOTONIC, &time);
time.tv\_nsec = 0;
clock\_settime(CLOCK\_REALTIME, &time);
return 0;
}
The reason is that the second parameter of timespec64\_compare(), ts\_delta,
may be unnormalized because the delta is calculated with an open coded
substraction which causes the comparison of tv\_sec to yield the wrong
result:
wall\_to\_monotonic = { .tv\_sec = -10, .tv\_nsec = 900000000 }
ts\_delta = { .tv\_sec = -9, .tv\_nsec = -900000000 }
That makes timespec64\_compare() claim that wall\_to\_monotonic < ts\_delta,
but actually the result should be wall\_to\_monotonic > ts\_delta.
After normalization, the result of timespec64\_compare() is correct because
the tv\_sec comparison is not longer misleading:
wall\_to\_monotonic = { .tv\_sec = -10, .tv\_nsec = 900000000 }
ts\_delta = { .tv\_sec = -10, .tv\_nsec = 100000000 }
Use timespec64\_sub() to ensure that ts\_delta is normalized, which fixes the
issue.
Fixes: e1d7ba873555 ("time: Always make sure wall\_to\_monotonic isn't positive")
Signed-off-by: Yu Liao
Signed-off-by: Thomas Gleixner
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20211213135727.1656662-1-liaoyu15@huawei.com
Signed-off-by: Greg Kroah-Hartman
commit 89362ec97ac018814bd21fe467a4166dc524e42d
Author: Ji-Ze Hong (Peter Hong)
Date: Wed Dec 15 15:58:35 2021 +0800
serial: 8250\_fintek: Fix garbled text for console
commit 6c33ff728812aa18792afffaf2c9873b898e7512 upstream.
Commit fab8a02b73eb ("serial: 8250\_fintek: Enable high speed mode on Fintek F81866")
introduced support to use high baudrate with Fintek SuperIO UARTs. It'll
change clocksources when the UART probed.
But when user add kernel parameter "console=ttyS0,115200 console=tty0" to make
the UART as console output, the console will output garbled text after the
following kernel message.
[ 3.681188] Serial: 8250/16550 driver, 32 ports, IRQ sharing enabled
The issue is occurs in following step:
probe\_setup\_port() -> fintek\_8250\_goto\_highspeed()
It change clocksource from 115200 to 921600 with wrong time, it should change
clocksource in set\_termios() not in probed. The following 3 patches are
implemented change clocksource in fintek\_8250\_set\_termios().
Commit 58178914ae5b ("serial: 8250\_fintek: UART dynamic clocksource on Fintek F81216H")
Commit 195638b6d44f ("serial: 8250\_fintek: UART dynamic clocksource on Fintek F81866")
Commit 423d9118c624 ("serial: 8250\_fintek: Add F81966 Support")
Due to the high baud rate had implemented above 3 patches and the patch
Commit fab8a02b73eb ("serial: 8250\_fintek: Enable high speed mode on Fintek F81866")
is bugged, So this patch will remove it.
Fixes: fab8a02b73eb ("serial: 8250\_fintek: Enable high speed mode on Fintek F81866")
Signed-off-by: Ji-Ze Hong (Peter Hong)
Link: https://lore.kernel.org/r/20211215075835.2072-1-hpeter+linux\_kernel@gmail.com
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 3a1a4eb574178c21241a6200f4785572e661c472
Author: Tejun Heo
Date: Mon Dec 13 14:14:43 2021 -1000
iocost: Fix divide-by-zero on donation from low hweight cgroup
commit edaa26334c117a584add6053f48d63a988d25a6e upstream.
The donation calculation logic assumes that the donor has non-zero
after-donation hweight, so the lowest active hweight a donating cgroup can
have is 2 so that it can donate 1 while keeping the other 1 for itself.
Earlier, we only donated from cgroups with sizable surpluses so this
condition was always true. However, with the precise donation algorithm
implemented, f1de2439ec43 ("blk-iocost: revamp donation amount
determination") made the donation amount calculation exact enabling even low
hweight cgroups to donate.
This means that in rare occasions, a cgroup with active hweight of 1 can
enter donation calculation triggering the following warning and then a
divide-by-zero oops.
WARNING: CPU: 4 PID: 0 at block/blk-iocost.c:1928 transfer\_surpluses.cold+0x0/0x53 [884/94867]
...
RIP: 0010:transfer\_surpluses.cold+0x0/0x53
Code: 92 ff 48 c7 c7 28 d1 ab b5 65 48 8b 34 25 00 ae 01 00 48 81 c6 90 06 00 00 e8 8b 3f fe ff 48 c7 c0 ea ff ff ff e9 95 ff 92 ff <0f> 0b 48 c7 c7 30 da ab b5 e8 71 3f fe ff 4c 89 e8 4d 85 ed 74 0
4
...
Call Trace:
ioc\_timer\_fn+0x1043/0x1390
call\_timer\_fn+0xa1/0x2c0
\_\_run\_timers.part.0+0x1ec/0x2e0
run\_timer\_softirq+0x35/0x70
...
iocg: invalid donation weights in /a/b: active=1 donating=1 after=0
Fix it by excluding cgroups w/ active hweight < 2 from donating. Excluding
these extreme low hweight donations shouldn't affect work conservation in
any meaningful way.
Signed-off-by: Tejun Heo
Fixes: f1de2439ec43 ("blk-iocost: revamp donation amount determination")
Cc: stable@vger.kernel.org # v5.10+
Link: https://lore.kernel.org/r/Ybfh86iSvpWKxhVM@slm.duckdns.org
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit d153ff65a9779bf4088e0451e18f16ac54f1de44
Author: Naohiro Aota
Date: Fri Dec 17 15:15:45 2021 +0900
zonefs: add MODULE\_ALIAS\_FS
commit 8ffea2599f63fdbee968b894eab78170abf3ec2c upstream.
Add MODULE\_ALIAS\_FS() to load the module automatically when you do "mount
-t zonefs".
Fixes: 8dcc1a9d90c1 ("fs: New zonefs file system")
Cc: stable  # 5.6+
Signed-off-by: Naohiro Aota
Reviewed-by: Johannes Thumshirn
Signed-off-by: Damien Le Moal
Signed-off-by: Greg Kroah-Hartman
commit 210ab4e3c03255d9f2ea06707fdd493f7562945c
Author: Shin'ichiro Kawasaki
Date: Wed Dec 15 19:38:43 2021 +0900
btrfs: fix missing blkdev\_put() call in btrfs\_scan\_one\_device()
commit 4989d4a0aed3fb30f5b48787a689d7090de6f86d upstream.
The function btrfs\_scan\_one\_device() calls blkdev\_get\_by\_path() and
blkdev\_put() to get and release its target block device. However, when
btrfs\_sb\_log\_location\_bdev() fails, blkdev\_put() is not called and the
block device is left without clean up. This triggered failure of fstests
generic/085. Fix the failure path of btrfs\_sb\_log\_location\_bdev() to
call blkdev\_put().
Fixes: 12659251ca5df ("btrfs: implement log-structured superblock for ZONED mode")
CC: stable@vger.kernel.org # 5.15+
Reviewed-by: Nikolay Borisov
Signed-off-by: Shin'ichiro Kawasaki
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 8848395975bdd15572a042566aff2ac78a6895ee
Author: Josef Bacik
Date: Mon Dec 13 14:22:33 2021 -0500
btrfs: check WRITE\_ERR when trying to read an extent buffer
commit 651740a502411793327e2f0741104749c4eedcd1 upstream.
Filipe reported a hang when we have errors on btrfs. This turned out to
be a side-effect of my fix c2e39305299f01 ("btrfs: clear extent buffer
uptodate when we fail to write it") which made it so we clear
EXTENT\_BUFFER\_UPTODATE on an eb when we fail to write it out.
Below is a paste of Filipe's analysis he got from using drgn to debug
the hang
"""
btree readahead code calls read\_extent\_buffer\_pages(), sets ->io\_pages to
a value while writeback of all pages has not yet completed:
--> writeback for the first 3 pages finishes, we clear
EXTENT\_BUFFER\_UPTODATE from eb on the first page when we get an
error.
--> at this point eb->io\_pages is 1 and we cleared Uptodate bit from the
first 3 pages
--> read\_extent\_buffer\_pages() does not see EXTENT\_BUFFER\_UPTODATE() so
it continues, it's able to lock the pages since we obviously don't
hold the pages locked during writeback
--> read\_extent\_buffer\_pages() then computes 'num\_reads' as 3, and sets
eb->io\_pages to 3, since only the first page does not have Uptodate
bit set at this point
--> writeback for the remaining page completes, we ended decrementing
eb->io\_pages by 1, resulting in eb->io\_pages == 2, and therefore
never calling end\_extent\_buffer\_writeback(), so
EXTENT\_BUFFER\_WRITEBACK remains in the eb's flags
--> of course, when the read bio completes, it doesn't and shouldn't
call end\_extent\_buffer\_writeback()
--> we should clear EXTENT\_BUFFER\_UPTODATE only after all pages of
the eb finished writeback? or maybe make the read pages code
wait for writeback of all pages of the eb to complete before
checking which pages need to be read, touch ->io\_pages, submit
read bio, etc
writeback bit never cleared means we can hang when aborting a
transaction, at:
btrfs\_cleanup\_one\_transaction()
btrfs\_destroy\_marked\_extents()
wait\_on\_extent\_buffer\_writeback()
"""
This is a problem because our writes are not synchronized with reads in
any way. We clear the UPTODATE flag and then we can easily come in and
try to read the EB while we're still waiting on other bio's to
complete.
We have two options here, we could lock all the pages, and then check to
see if eb->io\_pages != 0 to know if we've already got an outstanding
write on the eb.
Or we can simply check to see if we have WRITE\_ERR set on this extent
buffer. We set this bit \_before\_ we clear UPTODATE, so if the read gets
triggered because we aren't UPTODATE because of a write error we're
guaranteed to have WRITE\_ERR set, and in this case we can simply return
-EIO. This will fix the reported hang.
Reported-by: Filipe Manana
Fixes: c2e39305299f01 ("btrfs: clear extent buffer uptodate when we fail to write it")
CC: stable@vger.kernel.org # 5.4+
Reviewed-by: Filipe Manana
Signed-off-by: Josef Bacik
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit bbdaa7a48f465a2ee76d65839caeda08af1ef3b2
Author: Filipe Manana
Date: Fri Dec 10 19:02:18 2021 +0000
btrfs: fix double free of anon\_dev after failure to create subvolume
commit 33fab972497ae66822c0b6846d4f9382938575b6 upstream.
When creating a subvolume, at create\_subvol(), we allocate an anonymous
device and later call btrfs\_get\_new\_fs\_root(), which in turn just calls
btrfs\_get\_root\_ref(). There we call btrfs\_init\_fs\_root() which assigns
the anonymous device to the root, but if after that call there's an error,
when we jump to 'fail' label, we call btrfs\_put\_root(), which frees the
anonymous device and then returns an error that is propagated back to
create\_subvol(). Than create\_subvol() frees the anonymous device again.
When this happens, if the anonymous device was not reallocated after
the first time it was freed with btrfs\_put\_root(), we get a kernel
message like the following:
(...)
[13950.282466] BTRFS: error (device dm-0) in create\_subvol:663: errno=-5 IO failure
[13950.283027] ida\_free called for id=65 which is not allocated.
[13950.285974] BTRFS info (device dm-0): forced readonly
(...)
If the anonymous device gets reallocated by another btrfs filesystem
or any other kernel subsystem, then bad things can happen.
So fix this by setting the root's anonymous device to 0 at
btrfs\_get\_root\_ref(), before we call btrfs\_put\_root(), if an error
happened.
Fixes: 2dfb1e43f57dd3 ("btrfs: preallocate anon block device at first phase of snapshot creation")
CC: stable@vger.kernel.org # 5.10+
Reviewed-by: Qu Wenruo
Signed-off-by: Filipe Manana
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 493ff661d434d6bdf02e3a21adae04d7a0b4265d
Author: Jianglei Nie
Date: Thu Dec 9 14:56:31 2021 +0800
btrfs: fix memory leak in \_\_add\_inode\_ref()
commit f35838a6930296fc1988764cfa54cb3f705c0665 upstream.
Line 1169 (#3) allocates a memory chunk for victim\_name by kmalloc(),
but when the function returns in line 1184 (#4) victim\_name allocated
by line 1169 (#3) is not freed, which will lead to a memory leak.
There is a similar snippet of code in this function as allocating a memory
chunk for victim\_name in line 1104 (#1) as well as releasing the memory
in line 1116 (#2).
We should kfree() victim\_name when the return value of backref\_in\_log()
is less than zero and before the function returns in line 1184 (#4).
1057 static inline int \_\_add\_inode\_ref(struct btrfs\_trans\_handle \*trans,
1058 struct btrfs\_root \*root,
1059 struct btrfs\_path \*path,
1060 struct btrfs\_root \*log\_root,
1061 struct btrfs\_inode \*dir,
1062 struct btrfs\_inode \*inode,
1063 u64 inode\_objectid, u64 parent\_objectid,
1064 u64 ref\_index, char \*name, int namelen,
1065 int \*search\_done)
1066 {
1104 victim\_name = kmalloc(victim\_name\_len, GFP\_NOFS);
// #1: kmalloc (victim\_name-1)
1105 if (!victim\_name)
1106 return -ENOMEM;
1112 ret = backref\_in\_log(log\_root, &search\_key,
1113 parent\_objectid, victim\_name,
1114 victim\_name\_len);
1115 if (ret < 0) {
1116 kfree(victim\_name); // #2: kfree (victim\_name-1)
1117 return ret;
1118 } else if (!ret) {
1169 victim\_name = kmalloc(victim\_name\_len, GFP\_NOFS);
// #3: kmalloc (victim\_name-2)
1170 if (!victim\_name)
1171 return -ENOMEM;
1180 ret = backref\_in\_log(log\_root, &search\_key,
1181 parent\_objectid, victim\_name,
1182 victim\_name\_len);
1183 if (ret < 0) {
1184 return ret; // #4: missing kfree (victim\_name-2)
1185 } else if (!ret) {
1241 return 0;
1242 }
Fixes: d3316c8233bb ("btrfs: Properly handle backref\_in\_log retval")
CC: stable@vger.kernel.org # 5.10+
Reviewed-by: Qu Wenruo
Reviewed-by: Filipe Manana
Signed-off-by: Jianglei Nie
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit d1bac0d97bc9b18b7c077a66375cc4282d01c367
Author: Scott Mayhew
Date: Wed Dec 15 16:28:40 2021 -0500
selinux: fix sleeping function called from invalid context
commit cc274ae7763d9700a56659f3228641d7069e7a3f upstream.
selinux\_sb\_mnt\_opts\_compat() is called via sget\_fc() under the sb\_lock
spinlock, so it can't use GFP\_KERNEL allocations:
[ 868.565200] BUG: sleeping function called from invalid context at
include/linux/sched/mm.h:230
[ 868.568246] in\_atomic(): 1, irqs\_disabled(): 0,
non\_block: 0, pid: 4914, name: mount.nfs
[ 868.569626] preempt\_count: 1, expected: 0
[ 868.570215] RCU nest depth: 0, expected: 0
[ 868.570809] Preemption disabled at:
[ 868.570810] [<0000000000000000>] 0x0
[ 868.571848] CPU: 1 PID: 4914 Comm: mount.nfs Kdump: loaded
Tainted: G W 5.16.0-rc5.2585cf9dfa #1
[ 868.573273] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009),
BIOS 1.14.0-4.fc34 04/01/2014
[ 868.574478] Call Trace:
[ 868.574844]
[ 868.575156] dump\_stack\_lvl+0x34/0x44
[ 868.575692] \_\_might\_resched.cold+0xd6/0x10f
[ 868.576308] slab\_pre\_alloc\_hook.constprop.0+0x89/0xf0
[ 868.577046] \_\_kmalloc\_track\_caller+0x72/0x420
[ 868.577684] ? security\_context\_to\_sid\_core+0x48/0x2b0
[ 868.578569] kmemdup\_nul+0x22/0x50
[ 868.579108] security\_context\_to\_sid\_core+0x48/0x2b0
[ 868.579854] ? \_nfs4\_proc\_pathconf+0xff/0x110 [nfsv4]
[ 868.580742] ? nfs\_reconfigure+0x80/0x80 [nfs]
[ 868.581355] security\_context\_str\_to\_sid+0x36/0x40
[ 868.581960] selinux\_sb\_mnt\_opts\_compat+0xb5/0x1e0
[ 868.582550] ? nfs\_reconfigure+0x80/0x80 [nfs]
[ 868.583098] security\_sb\_mnt\_opts\_compat+0x2a/0x40
[ 868.583676] nfs\_compare\_super+0x113/0x220 [nfs]
[ 868.584249] ? nfs\_try\_mount\_request+0x210/0x210 [nfs]
[ 868.584879] sget\_fc+0xb5/0x2f0
[ 868.585267] nfs\_get\_tree\_common+0x91/0x4a0 [nfs]
[ 868.585834] vfs\_get\_tree+0x25/0xb0
[ 868.586241] fc\_mount+0xe/0x30
[ 868.586605] do\_nfs4\_mount+0x130/0x380 [nfsv4]
[ 868.587160] nfs4\_try\_get\_tree+0x47/0xb0 [nfsv4]
[ 868.587724] vfs\_get\_tree+0x25/0xb0
[ 868.588193] do\_new\_mount+0x176/0x310
[ 868.588782] \_\_x64\_sys\_mount+0x103/0x140
[ 868.589388] do\_syscall\_64+0x3b/0x90
[ 868.589935] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
[ 868.590699] RIP: 0033:0x7f2b371c6c4e
[ 868.591239] Code: 48 8b 0d dd 71 0e 00 f7 d8 64 89 01 48 83 c8 ff c3 66 2e
0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 49 89 ca b8 a5 00
00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d aa 71
0e 00 f7 d8 64 89 01 48
[ 868.593810] RSP: 002b:00007ffc83775d88 EFLAGS: 00000246
ORIG\_RAX: 00000000000000a5
[ 868.594691] RAX: ffffffffffffffda RBX: 00007ffc83775f10 RCX: 00007f2b371c6c4e
[ 868.595504] RDX: 0000555d517247a0 RSI: 0000555d51724700 RDI: 0000555d51724540
[ 868.596317] RBP: 00007ffc83775f10 R08: 0000555d51726890 R09: 0000555d51726890
[ 868.597162] R10: 0000000000000000 R11: 0000000000000246 R12: 0000555d51726890
[ 868.598005] R13: 0000000000000003 R14: 0000555d517246e0 R15: 0000555d511ac925
[ 868.598826]
Cc: stable@vger.kernel.org
Fixes: 69c4a42d72eb ("lsm,selinux: add new hook to compare new mount to an existing mount")
Signed-off-by: Scott Mayhew
[PM: cleanup/line-wrap the backtrace]
Signed-off-by: Paul Moore
Signed-off-by: Greg Kroah-Hartman
commit 252f245ff4a139ea648599236c461b1cc00e1612
Author: Daniele Palmas
Date: Fri Dec 10 11:07:14 2021 +0100
USB: serial: option: add Telit FN990 compositions
commit 2b503c8598d1b232e7fc7526bce9326d92331541 upstream.
Add the following Telit FN990 compositions:
0x1070: tty, adb, rmnet, tty, tty, tty, tty
0x1071: tty, adb, mbim, tty, tty, tty, tty
0x1072: rndis, tty, adb, tty, tty, tty, tty
0x1073: tty, adb, ecm, tty, tty, tty, tty
Signed-off-by: Daniele Palmas
Link: https://lore.kernel.org/r/20211210100714.22587-1-dnlplm@gmail.com
Cc: stable@vger.kernel.org
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit db83bbfe1bec4f224d01141a652d486c7ba9ae14
Author: Johan Hovold
Date: Fri Nov 26 10:43:48 2021 +0100
USB: serial: cp210x: fix CP2105 GPIO registration
commit 83b67041f3eaf33f98a075249aa7f4c7617c2f85 upstream.
When generalising GPIO support and adding support for CP2102N, the GPIO
registration for some CP2105 devices accidentally broke. Specifically,
when all the pins of a port are in "modem" mode, and thus unavailable
for GPIO use, the GPIO chip would now be registered without having
initialised the number of GPIO lines. This would in turn be rejected by
gpiolib and some errors messages would be printed (but importantly probe
would still succeed).
Fix this by initialising the number of GPIO lines before registering the
GPIO chip.
Note that as for the other device types, and as when all CP2105 pins are
muxed for LED function, the GPIO chip is registered also when no pins
are available for GPIO use.
Reported-by: Maarten Brock
Link: https://lore.kernel.org/r/5eb560c81d2ea1a2b4602a92d9f48a89@vanmierlo.com
Fixes: c8acfe0aadbe ("USB: serial: cp210x: implement GPIO support for CP2102N")
Cc: stable@vger.kernel.org # 4.19
Cc: Karoly Pados
Link: https://lore.kernel.org/r/20211126094348.31698-1-johan@kernel.org
Reviewed-by: Greg Kroah-Hartman
Tested-by: Maarten Brock
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 5154bc1c16c939b71d6c6f4ac30e393661f8540c
Author: Marian Postevca
Date: Sat Dec 4 23:49:12 2021 +0200
usb: gadget: u\_ether: fix race in setting MAC address in setup phase
commit 890d5b40908bfd1a79be018d2d297cf9df60f4ee upstream.
When listening for notifications through netlink of a new interface being
registered, sporadically, it is possible for the MAC to be read as zero.
The zero MAC address lasts a short period of time and then switches to a
valid random MAC address.
This causes problems for netd in Android, which assumes that the interface
is malfunctioning and will not use it.
In the good case we get this log:
InterfaceController::getCfg() ifName usb0
hwAddr 92:a8:f0:73:79:5b ipv4Addr 0.0.0.0 flags 0x1002
In the error case we get these logs:
InterfaceController::getCfg() ifName usb0
hwAddr 00:00:00:00:00:00 ipv4Addr 0.0.0.0 flags 0x1002
netd : interfaceGetCfg("usb0")
netd : interfaceSetCfg() -> ServiceSpecificException
(99, "[Cannot assign requested address] : ioctl() failed")
The reason for the issue is the order in which the interface is setup,
it is first registered through register\_netdev() and after the MAC
address is set.
Fixed by first setting the MAC address of the net\_device and after that
calling register\_netdev().
Fixes: bcd4a1c40bee885e ("usb: gadget: u\_ether: construct with default values and add setters/getters")
Cc: stable@vger.kernel.org
Signed-off-by: Marian Postevca
Link: https://lore.kernel.org/r/20211204214912.17627-1-posteuca@mutex.one
Signed-off-by: Greg Kroah-Hartman
commit 428ad19f98bbfeb9ade66f2d3f9e97ecf1ec7a8c
Author: Xu Yang
Date: Thu Dec 9 18:15:07 2021 +0800
usb: typec: tcpm: fix tcpm unregister port but leave a pending timer
commit ca4d8344a72b91fb9d4c8bfbc22204b4c09c5d8f upstream.
In current design, when the tcpm port is unregisterd, the kthread\_worker
will be destroyed in the last step. Inside the kthread\_destroy\_worker(),
the worker will flush all the works and wait for them to end. However, if
one of the works calls hrtimer\_start(), this hrtimer will be pending until
timeout even though tcpm port is removed. Once the hrtimer timeout, many
strange kernel dumps appear.
Thus, we can first complete kthread\_destroy\_worker(), then cancel all the
hrtimers. This will guarantee that no hrtimer is pending at the end.
Fixes: 3ed8e1c2ac99 ("usb: typec: tcpm: Migrate workqueue to RT priority for processing events")
cc:
Reviewed-by: Guenter Roeck
Acked-by: Heikki Krogerus
Signed-off-by: Xu Yang
Link: https://lore.kernel.org/r/20211209101507.499096-1-xu.yang\_2@nxp.com
Signed-off-by: Greg Kroah-Hartman
commit ffe642edb4e2302e8a8fa356aef9d055765d3af2
Author: Pawel Laszczak
Date: Tue Dec 14 05:55:27 2021 +0100
usb: cdnsp: Fix lack of spin\_lock\_irqsave/spin\_lock\_restore
commit 4c4e162d9cf38528c4f13df09d5755cbc06f6c77 upstream.
Patch puts content of cdnsp\_gadget\_pullup function inside
spin\_lock\_irqsave and spin\_lock\_restore section.
This construction is required here to keep the data consistency,
otherwise some data can be changed e.g. from interrupt context.
Fixes: 3d82904559f4 ("usb: cdnsp: cdns3 Add main part of Cadence USBSSP DRD Driver")
Reported-by: Ken (Jian) He
cc:
Signed-off-by: Pawel Laszczak
Reviewed-by: Peter Chen
Link: https://lore.kernel.org/r/20211214045527.26823-1-pawell@gli-login.cadence.com
Signed-off-by: Greg Kroah-Hartman
commit 368bfabceb111c4dbe1db049dcc2a7b8edc455f5
Author: Pawel Laszczak
Date: Mon Dec 13 06:06:09 2021 +0100
usb: cdnsp: Fix issue in cdnsp\_log\_ep trace event
commit 50931ba27d1665c8b038cd1d16c5869301f32fd6 upstream.
Patch fixes incorrect order of \_\_entry->stream\_id and \_\_entry->state
parameters in TP\_printk macro.
Fixes: 3d82904559f4 ("usb: cdnsp: cdns3 Add main part of Cadence USBSSP DRD Driver")
cc:
Reviewed-by: Peter Chen
Signed-off-by: Pawel Laszczak
Link: https://lore.kernel.org/r/20211213050609.22640-1-pawell@gli-login.cadence.com
Signed-off-by: Greg Kroah-Hartman
commit ec83d6e57a624673b233b02e5b594ac0fcb474b0
Author: Pawel Laszczak
Date: Fri Dec 10 12:29:45 2021 +0100
usb: cdnsp: Fix incorrect calling of cdnsp\_died function
commit 16f00d969afe60e233c1a91af7ac840df60d3536 upstream.
Patch restrict calling of cdnsp\_died function during removing modules
or software disconnect.
This function was called because after transition controller to HALT
state the driver starts handling the deferred interrupt.
In this case such interrupt can be simple ignored.
Fixes: 3d82904559f4 ("usb: cdnsp: cdns3 Add main part of Cadence USBSSP DRD Driver")
cc:
Reviewed-by: Peter Chen
Signed-off-by: Pawel Laszczak
Link: https://lore.kernel.org/r/20211210112945.660-1-pawell@gli-login.cadence.com
Signed-off-by: Greg Kroah-Hartman
commit ed89521e2dcb59344810b1d26344e9212d80a69e
Author: Pawel Laszczak
Date: Tue Dec 7 10:18:38 2021 +0100
usb: cdnsp: Fix incorrect status for control request
commit 99ea221f2e2f2743314e348b25c1e2574b467528 upstream.
Patch fixes incorrect status for control request.
Without this fix all usb\_request objects were returned to upper drivers
with usb\_reqest->status field set to -EINPROGRESS.
Fixes: 3d82904559f4 ("usb: cdnsp: cdns3 Add main part of Cadence USBSSP DRD Driver")
cc:
Reported-by: Ken (Jian) He
Reviewed-by: Peter Chen
Signed-off-by: Pawel Laszczak
Link: https://lore.kernel.org/r/20211207091838.39572-1-pawell@gli-login.cadence.com
Signed-off-by: Greg Kroah-Hartman
commit 5cb5c3e1b184da9f49e46119a0e506519fc58185
Author: Nehal Bakulchandra Shah
Date: Wed Dec 15 15:02:16 2021 +0530
usb: xhci: Extend support for runtime power management for AMD's Yellow carp.
commit f886d4fbb7c97b8f5f447c92d2dab99c841803c0 upstream.
AMD's Yellow Carp platform has few more XHCI controllers,
enable the runtime power management support for the same.
Signed-off-by: Nehal Bakulchandra Shah
Cc: stable
Link: https://lore.kernel.org/r/20211215093216.1839065-1-Nehal-Bakulchandra.shah@amd.com
Signed-off-by: Greg Kroah-Hartman
commit 67cbcd3fb8e6412cc5220315c7266e52c2b66268
Author: Chunfeng Yun
Date: Thu Dec 9 10:54:22 2021 +0800
usb: xhci-mtk: fix list\_del warning when enable list debug
commit ccc14c6cfd346e85c3ecb970975afd5132763437 upstream.
There is warning of 'list\_del corruption' when enable list debug
(CONFIG\_DEBUG\_LIST=y), fix it by using list\_del\_init()
Fixes: 4ce186665e7c ("usb: xhci-mtk: Do not use xhci's virt\_dev in drop\_endpoint")
Cc: stable
Signed-off-by: Chunfeng Yun
Link: https://lore.kernel.org/r/20211209025422.17108-1-chunfeng.yun@mediatek.com
Signed-off-by: Greg Kroah-Hartman
commit d8888cdabedf353ab9b5a6af75f70bf341a3e7df
Author: Stefan Roese
Date: Tue Dec 14 12:49:32 2021 +0100
PCI/MSI: Mask MSI-X vectors only on success
commit 83dbf898a2d45289be875deb580e93050ba67529 upstream.
Masking all unused MSI-X entries is done to ensure that a crash kernel
starts from a clean slate, which correponds to the reset state of the
device as defined in the PCI-E specificion 3.0 and later:
Vector Control for MSI-X Table Entries
--------------------------------------
"00: Mask bit: When this bit is set, the function is prohibited from
sending a message using this MSI-X Table entry.
...
This bitâ€™s state after reset is 1 (entry is masked)."
A Marvell NVME device fails to deliver MSI interrupts after trying to
enable MSI-X interrupts due to that masking. It seems to take the MSI-X
mask bits into account even when MSI-X is disabled.
While not specification compliant, this can be cured by moving the masking
into the success path, so that the MSI-X table entries stay in device reset
state when the MSI-X setup fails.
[ tglx: Move it into the success path, add comment and amend changelog ]
Fixes: aa8092c1d1f1 ("PCI/MSI: Mask all unused MSI-X entries")
Signed-off-by: Stefan Roese
Signed-off-by: Thomas Gleixner
Cc: linux-pci@vger.kernel.org
Cc: Bjorn Helgaas
Cc: Michal Simek
Cc: Marek Vasut
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20211210161025.3287927-1-sr@denx.de
Signed-off-by: Greg Kroah-Hartman
commit 4df1af29930b03d61fb774bfaa5100dbdb964628
Author: Thomas Gleixner
Date: Tue Dec 14 12:42:14 2021 +0100
PCI/MSI: Clear PCI\_MSIX\_FLAGS\_MASKALL on error
commit 94185adbfad56815c2c8401e16d81bdb74a79201 upstream.
PCI\_MSIX\_FLAGS\_MASKALL is set in the MSI-X control register at MSI-X
interrupt setup time. It's cleared on success, but the error handling path
only clears the PCI\_MSIX\_FLAGS\_ENABLE bit.
That's incorrect as the reset state of the PCI\_MSIX\_FLAGS\_MASKALL bit is
zero. That can be observed via lspci:
Capabilities: [b0] MSI-X: Enable- Count=67 Masked+
Clear the bit in the error path to restore the reset state.
Fixes: 438553958ba1 ("PCI/MSI: Enable and mask MSI-X early")
Reported-by: Stefan Roese
Signed-off-by: Thomas Gleixner
Tested-by: Stefan Roese
Cc: linux-pci@vger.kernel.org
Cc: Bjorn Helgaas
Cc: Michal Simek
Cc: Marek Vasut
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/87tufevoqx.ffs@tglx
Signed-off-by: Greg Kroah-Hartman
commit 3901c7784ad7fe290e1ac48f924b276114290cf9
Author: Amelie Delaunay
Date: Tue Dec 7 13:45:10 2021 +0100
usb: dwc2: fix STM ID/VBUS detection startup delay in dwc2\_driver\_probe
commit fac6bf87c55f7f0733efb0375565fb6a50cf2caf upstream.
When activate\_stm\_id\_vb\_detection is enabled, ID and Vbus detection relies
on sensing comparators. This detection needs time to stabilize.
A delay was already applied in dwc2\_resume() when reactivating the
detection, but it wasn't done in dwc2\_probe().
This patch adds delay after enabling STM ID/VBUS detection. Then, ID state
is good when initializing gadget and host, and avoid to get a wrong
Connector ID Status Change interrupt.
Fixes: a415083a11cc ("usb: dwc2: add support for STM32MP15 SoCs USB OTG HS and FS")
Cc: stable
Acked-by: Minas Harutyunyan
Signed-off-by: Amelie Delaunay
Link: https://lore.kernel.org/r/20211207124510.268841-1-amelie.delaunay@foss.st.com
Signed-off-by: Greg Kroah-Hartman
commit af00fb78428664996c9fb19e587e28ff5089b4d2
Author: Jimmy Wang
Date: Tue Dec 14 09:26:50 2021 +0800
USB: NO\_LPM quirk Lenovo USB-C to Ethernet Adapher(RTL8153-04)
commit 0ad3bd562bb91853b9f42bda145b5db6255aee90 upstream.
This device doesn't work well with LPM, losing connectivity intermittently.
Disable LPM to resolve the issue.
Reviewed-by:
Signed-off-by: Jimmy Wang
Cc: stable
Link: https://lore.kernel.org/r/20211214012652.4898-1-wangjm221@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit e7a8a261bab07ec1ed5f5bb990aacc4de9c08eb4
Author: Tetsuo Handa
Date: Wed Dec 15 20:52:40 2021 +0900
tty: n\_hdlc: make n\_hdlc\_tty\_wakeup() asynchronous
commit 1ee33b1ca2b8dabfcc17198ffd049a6b55674a86 upstream.
syzbot is reporting that an unprivileged user who logged in from tty
console can crash the system using a reproducer shown below [1], for
n\_hdlc\_tty\_wakeup() is synchronously calling n\_hdlc\_send\_frames().
----------
#include
#include
int main(int argc, char \*argv[])
{
const int disc = 0xd;
ioctl(1, TIOCSETD, &disc);
while (1) {
ioctl(1, TCXONC, 0);
write(1, "", 1);
ioctl(1, TCXONC, 1); /\* Kernel panic - not syncing: scheduling while atomic \*/
}
}
----------
Linus suspected that "struct tty\_ldisc"->ops->write\_wakeup() must not
sleep, and Jiri confirmed it from include/linux/tty\_ldisc.h. Thus, defer
n\_hdlc\_send\_frames() from n\_hdlc\_tty\_wakeup() to a WQ context like
net/nfc/nci/uart.c does.
Link: https://syzkaller.appspot.com/bug?extid=5f47a8cea6a12b77a876 [1]
Reported-by: syzbot
Cc: stable
Analyzed-by: Fabio M. De Francesco
Suggested-by: Linus Torvalds
Confirmed-by: Jiri Slaby
Reviewed-by: Fabio M. De Francesco
Signed-off-by: Tetsuo Handa
Link: https://lore.kernel.org/r/40de8b7e-a3be-4486-4e33-1b1d1da452f8@i-love.sakura.ne.jp
Signed-off-by: Greg Kroah-Hartman
commit 5fc3cfa62b85fb60d2383229791f755f333963ed
Author: Vitaly Kuznetsov
Date: Thu Dec 16 17:52:13 2021 +0100
KVM: x86: Drop guest CPUID check for host initiated writes to MSR\_IA32\_PERF\_CAPABILITIES
[ Upstream commit 1aa2abb33a419090c7c87d4ae842a6347078ee12 ]
The ability to write to MSR\_IA32\_PERF\_CAPABILITIES from the host should
not depend on guest visible CPUID entries, even if just to allow
creating/restoring guest MSRs and CPUIDs in any sequence.
Fixes: 27461da31089 ("KVM: x86/pmu: Support full width counting")
Suggested-by: Sean Christopherson
Signed-off-by: Vitaly Kuznetsov
Message-Id: <20211216165213.338923-3-vkuznets@redhat.com>
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 9f8b3f238530b168d4e9a5024a5d21fc966248dd
Author: Greg Kroah-Hartman
Date: Fri Dec 17 16:24:30 2021 +0100
Revert "usb: early: convert to readl\_poll\_timeout\_atomic()"
[ Upstream commit c4d936efa46d8ea183df16c0f3fa4423327da51d ]
This reverts commit 796eed4b2342c9d6b26c958e92af91253a2390e1.
This change causes boot lockups when using "arlyprintk=xdbc" because
ktime can not be used at this point in time in the boot process. Also,
it is not needed for very small delays like this.
Reported-by: Mathias Nyman
Reported-by: Peter Zijlstra
Cc: Jann Horn
Cc: Chunfeng Yun
Fixes: 796eed4b2342 ("usb: early: convert to readl\_poll\_timeout\_atomic()")
Link: https://lore.kernel.org/r/c2b5c9bb-1b75-bf56-3754-b5b18812d65e@linux.intel.com
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit abd3a33b3f2bff26fa531da668b041bef980f238
Author: Greg Kroah-Hartman
Date: Tue Dec 14 19:46:21 2021 +0100
USB: gadget: bRequestType is a bitfield, not a enum
[ Upstream commit f08adf5add9a071160c68bb2a61d697f39ab0758 ]
Szymon rightly pointed out that the previous check for the endpoint
direction in bRequestType was not looking at only the bit involved, but
rather the whole value. Normally this is ok, but for some request
types, bits other than bit 8 could be set and the check for the endpoint
length could not stall correctly.
Fix that up by only checking the single bit.
Fixes: 153a2d7e3350 ("USB: gadget: detect too-big endpoint 0 requests")
Cc: Felipe Balbi
Reported-by: Szymon Heidrich
Link: https://lore.kernel.org/r/20211214184621.385828-1-gregkh@linuxfoundation.org
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit d0ac17b9bac53e37c111c135a9e1a1ae18dcab88
Author: Xiaoming Ni
Date: Fri Nov 26 12:11:53 2021 +0800
powerpc/85xx: Fix oops when CONFIG\_FSL\_PMC=n
[ Upstream commit 3dc709e518b47386e6af937eaec37bb36539edfd ]
When CONFIG\_FSL\_PMC is set to n, no value is assigned to cpu\_up\_prepare
in the mpc85xx\_pm\_ops structure. As a result, oops is triggered in
smp\_85xx\_start\_cpu().
smp: Bringing up secondary CPUs ...
kernel tried to execute user page (0) - exploit attempt? (uid: 0)
BUG: Unable to handle kernel instruction fetch (NULL pointer?)
Faulting instruction address: 0x00000000
Oops: Kernel access of bad area, sig: 11 [#1]
...
NIP [00000000] 0x0
LR [c0021d2c] smp\_85xx\_kick\_cpu+0xe8/0x568
Call Trace:
[c1051da8] [c0021cb8] smp\_85xx\_kick\_cpu+0x74/0x568 (unreliable)
[c1051de8] [c0011460] \_\_cpu\_up+0xc0/0x228
[c1051e18] [c0031bbc] bringup\_cpu+0x30/0x224
[c1051e48] [c0031f3c] cpu\_up.constprop.0+0x180/0x33c
[c1051e88] [c00322e8] bringup\_nonboot\_cpus+0x88/0xc8
[c1051eb8] [c07e67bc] smp\_init+0x30/0x78
[c1051ed8] [c07d9e28] kernel\_init\_freeable+0x118/0x2a8
[c1051f18] [c00032d8] kernel\_init+0x14/0x124
[c1051f38] [c0010278] ret\_from\_kernel\_thread+0x14/0x1c
Fixes: c45361abb918 ("powerpc/85xx: fix timebase sync issue when CONFIG\_HOTPLUG\_CPU=n")
Reported-by: Martin Kennedy
Signed-off-by: Xiaoming Ni
Tested-by: Martin Kennedy
Signed-off-by: Michael Ellerman
Link: https://lore.kernel.org/r/20211126041153.16926-1-nixiaoming@huawei.com
Signed-off-by: Sasha Levin
commit c8e8e6f4108e4c133b09f31f6cc7557ee6df3bb6
Author: Martin KaFai Lau
Date: Thu Dec 16 11:16:30 2021 -0800
bpf, selftests: Fix racing issue in btf\_skc\_cls\_ingress test
[ Upstream commit c2fcbf81c332b42382a0c439bfe2414a241e4f5b ]
The libbpf CI reported occasional failure in btf\_skc\_cls\_ingress:
test\_syncookie:FAIL:Unexpected syncookie states gen\_cookie:80326634 recv\_cookie:0
bpf prog error at line 97
"error at line 97" means the bpf prog cannot find the listening socket
when the final ack is received. It then skipped processing
the syncookie in the final ack which then led to "recv\_cookie:0".
The problem is the userspace program did not do accept() and went
ahead to close(listen\_fd) before the kernel (and the bpf prog) had
a chance to process the final ack.
The fix is to add accept() call so that the userspace will wait for
the kernel to finish processing the final ack first before close()-ing
everything.
Fixes: 9a856cae2217 ("bpf: selftest: Add test\_btf\_skc\_cls\_ingress")
Reported-by: Andrii Nakryiko
Signed-off-by: Martin KaFai Lau
Signed-off-by: Daniel Borkmann
Link: https://lore.kernel.org/bpf/20211216191630.466151-1-kafai@fb.com
Signed-off-by: Sasha Levin
commit 9f55f2913ebda52c3d39222b1bd8597930726b15
Author: Alexei Starovoitov
Date: Wed Dec 15 18:38:30 2021 -0800
bpf: Fix extable fixup offset.
[ Upstream commit 433956e91200734d09958673a56df02d00a917c2 ]
The prog - start\_of\_ldx is the offset before the faulting ldx to the location
after it, so this will be used to adjust pt\_regs->ip for jumping over it and
continuing, and with old temp it would have been fixed up to the wrong offset,
causing crash.
Fixes: 4c5de127598e ("bpf: Emit explicit NULL pointer checks for PROBE\_LDX instructions.")
Signed-off-by: Alexei Starovoitov
Reviewed-by: Daniel Borkmann
Signed-off-by: Daniel Borkmann
Signed-off-by: Sasha Levin
commit ecd8ad3af6d5f5bbbde97370ae4f885ab7ac47e3
Author: Lakshmi Ramasubramanian
Date: Thu Dec 9 17:01:21 2021 -0800
arm64: kexec: Fix missing error code 'ret' warning in load\_other\_segments()
[ Upstream commit 9c5d89bc10551f1aecd768b00fca3339a7b8c8ee ]
Since commit ac10be5cdbfa ("arm64: Use common
of\_kexec\_alloc\_and\_setup\_fdt()"), smatch reports the following warning:
arch/arm64/kernel/machine\_kexec\_file.c:152 load\_other\_segments()
warn: missing error code 'ret'
Return code is not set to an error code in load\_other\_segments() when
of\_kexec\_alloc\_and\_setup\_fdt() call returns a NULL dtb. This results
in status success (return code set to 0) being returned from
load\_other\_segments().
Set return code to -EINVAL if of\_kexec\_alloc\_and\_setup\_fdt() returns
NULL dtb.
Signed-off-by: Lakshmi Ramasubramanian
Reported-by: kernel test robot
Reported-by: Dan Carpenter
Fixes: ac10be5cdbfa ("arm64: Use common of\_kexec\_alloc\_and\_setup\_fdt()")
Link: https://lore.kernel.org/r/20211210010121.101823-1-nramas@linux.microsoft.com
Signed-off-by: Will Deacon
Signed-off-by: Catalin Marinas
Signed-off-by: Sasha Levin
commit 5473fe0c484a1a360d0f270a9faabfd4652f3fd5
Author: David Howells
Date: Tue Dec 14 09:22:12 2021 +0000
afs: Fix mmap
[ Upstream commit 1744a22ae948799da7927b53ec97ccc877ff9d61 ]
Fix afs\_add\_open\_map() to check that the vnode isn't already on the list
when it adds it. It's possible that afs\_drop\_open\_mmap() decremented
the cb\_nr\_mmap counter, but hadn't yet got into the locked section to
remove it.
Also vnode->cb\_mmap\_link should be initialised, so fix that too.
Fixes: 6e0e99d58a65 ("afs: Fix mmap coherency vs 3rd-party changes")
Reported-by: kafs-testing+fedora34\_64checkkafs-build-300@auristor.com
Suggested-by: Marc Dionne
Signed-off-by: David Howells
Tested-by: kafs-testing+fedora34\_64checkkafs-build-300@auristor.com
cc: linux-afs@lists.infradead.org
Link: https://lore.kernel.org/r/686465.1639435380@warthog.procyon.org.uk/ # v1
Signed-off-by: Linus Torvalds
Signed-off-by: Sasha Levin
commit 44a6c846bc3a7efe7d394bab8b2ae3b7f580e190
Author: Eric Dumazet
Date: Thu Dec 16 03:17:41 2021 -0800
sit: do not call ipip6\_dev\_free() from sit\_init\_net()
[ Upstream commit e28587cc491ef0f3c51258fdc87fbc386b1d4c59 ]
ipip6\_dev\_free is sit dev->priv\_destructor, already called
by register\_netdevice() if something goes wrong.
Alternative would be to make ipip6\_dev\_free() robust against
multiple invocations, but other drivers do not implement this
strategy.
syzbot reported:
dst\_release underflow
WARNING: CPU: 0 PID: 5059 at net/core/dst.c:173 dst\_release+0xd8/0xe0 net/core/dst.c:173
Modules linked in:
CPU: 1 PID: 5059 Comm: syz-executor.4 Not tainted 5.16.0-rc5-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
RIP: 0010:dst\_release+0xd8/0xe0 net/core/dst.c:173
Code: 4c 89 f2 89 d9 31 c0 5b 41 5e 5d e9 da d5 44 f9 e8 1d 90 5f f9 c6 05 87 48 c6 05 01 48 c7 c7 80 44 99 8b 31 c0 e8 e8 67 29 f9 <0f> 0b eb 85 0f 1f 40 00 53 48 89 fb e8 f7 8f 5f f9 48 83 c3 a8 48
RSP: 0018:ffffc9000aa5faa0 EFLAGS: 00010246
RAX: d6894a925dd15a00 RBX: 00000000ffffffff RCX: 0000000000040000
RDX: ffffc90005e19000 RSI: 000000000003ffff RDI: 0000000000040000
RBP: 0000000000000000 R08: ffffffff816a1f42 R09: ffffed1017344f2c
R10: ffffed1017344f2c R11: 0000000000000000 R12: 0000607f462b1358
R13: 1ffffffff1bfd305 R14: ffffe8ffffcb1358 R15: dffffc0000000000
FS: 00007f66c71a2700(0000) GS:ffff8880b9a00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f88aaed5058 CR3: 0000000023e0f000 CR4: 00000000003506f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
dst\_cache\_destroy+0x107/0x1e0 net/core/dst\_cache.c:160
ipip6\_dev\_free net/ipv6/sit.c:1414 [inline]
sit\_init\_net+0x229/0x550 net/ipv6/sit.c:1936
ops\_init+0x313/0x430 net/core/net\_namespace.c:140
setup\_net+0x35b/0x9d0 net/core/net\_namespace.c:326
copy\_net\_ns+0x359/0x5c0 net/core/net\_namespace.c:470
create\_new\_namespaces+0x4ce/0xa00 kernel/nsproxy.c:110
unshare\_nsproxy\_namespaces+0x11e/0x180 kernel/nsproxy.c:226
ksys\_unshare+0x57d/0xb50 kernel/fork.c:3075
\_\_do\_sys\_unshare kernel/fork.c:3146 [inline]
\_\_se\_sys\_unshare kernel/fork.c:3144 [inline]
\_\_x64\_sys\_unshare+0x34/0x40 kernel/fork.c:3144
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x44/0xd0 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f66c882ce99
Code: ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48
RSP: 002b:00007f66c71a2168 EFLAGS: 00000246 ORIG\_RAX: 0000000000000110
RAX: ffffffffffffffda RBX: 00007f66c893ff60 RCX: 00007f66c882ce99
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000048040200
RBP: 00007f66c8886ff1 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
R13: 00007fff6634832f R14: 00007f66c71a2300 R15: 0000000000022000

Fixes: cf124db566e6 ("net: Fix inconsistent teardown and release of private netdev state.")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Link: https://lore.kernel.org/r/20211216111741.1387540-1-eric.dumazet@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit eb4687c7442942e115420a30185f8d83faf37696
Author: Florian Fainelli
Date: Wed Dec 15 12:24:49 2021 -0800
net: systemport: Add global locking for descriptor lifecycle
[ Upstream commit 8b8e6e782456f1ce02a7ae914bbd5b1053f0b034 ]
The descriptor list is a shared resource across all of the transmit queues, and
the locking mechanism used today only protects concurrency across a given
transmit queue between the transmit and reclaiming. This creates an opportunity
for the SYSTEMPORT hardware to work on corrupted descriptors if we have
multiple producers at once which is the case when using multiple transmit
queues.
This was particularly noticeable when using multiple flows/transmit queues and
it showed up in interesting ways in that UDP packets would get a correct UDP
header checksum being calculated over an incorrect packet length. Similarly TCP
packets would get an equally correct checksum computed by the hardware over an
incorrect packet length.
The SYSTEMPORT hardware maintains an internal descriptor list that it re-arranges
when the driver produces a new descriptor anytime it writes to the
WRITE\_PORT\_{HI,LO} registers, there is however some delay in the hardware to
re-organize its descriptors and it is possible that concurrent TX queues
eventually break this internal allocation scheme to the point where the
length/status part of the descriptor gets used for an incorrect data buffer.
The fix is to impose a global serialization for all TX queues in the short
section where we are writing to the WRITE\_PORT\_{HI,LO} registers which solves
the corruption even with multiple concurrent TX queues being used.
Fixes: 80105befdb4b ("net: systemport: add Broadcom SYSTEMPORT Ethernet MAC driver")
Signed-off-by: Florian Fainelli
Link: https://lore.kernel.org/r/20211215202450.4086240-1-f.fainelli@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit e99fe4137b6d65685508acfeb7d2c571613dc102
Author: D. Wythe
Date: Wed Dec 15 20:29:21 2021 +0800
net/smc: Prevent smc\_release() from long blocking
[ Upstream commit 5c15b3123f65f8fbb1b445d9a7e8812e0e435df2 ]
In nginx/wrk benchmark, there's a hung problem with high probability
on case likes that: (client will last several minutes to exit)
server: smc\_run nginx
client: smc\_run wrk -c 10000 -t 1 http://server
Client hangs with the following backtrace:
0 [ffffa7ce8Of3bbf8] \_\_schedule at ffffffff9f9eOd5f
1 [ffffa7ce8Of3bc88] schedule at ffffffff9f9elÃ¸e6
2 [ffffa7ce8Of3bcaO] schedule\_timeout at ffffffff9f9e3f3c
3 [ffffa7ce8Of3bd2O] wait\_for\_common at ffffffff9f9el9de
4 [ffffa7ce8Of3bd8O] \_\_flush\_work at ffffffff9fOfeOl3
5 [ffffa7ce8Ã¸f3bdfO] smc\_release at ffffffffcO697d24 [smc]
6 [ffffa7ce8Of3be2O] \_\_sock\_release at ffffffff9f8O2e2d
7 [ffffa7ce8Of3be4Ã¸] sock\_close at ffffffff9f8Ã¸2ebl
8 [ffffa7ce8Ã¸f3be48] \_\_fput at ffffffff9f334f93
9 [ffffa7ce8Of3be78] task\_work\_run at ffffffff9flOlff5
10 [ffffa7ce8Of3beaO] do\_exit at ffffffff9fOe5Ol2
11 [ffffa7ce8Of3bflO] do\_group\_exit at ffffffff9fOe592a
12 [ffffa7ce8Of3bf38] \_\_x64\_sys\_exit\_group at ffffffff9fOe5994
13 [ffffa7ce8Of3bf4O] do\_syscall\_64 at ffffffff9f9d4373
14 [ffffa7ce8Of3bfsO] entry\_SYSCALL\_64\_after\_hwframe at ffffffff9fa0007c
This issue dues to flush\_work(), which is used to wait for
smc\_connect\_work() to finish in smc\_release(). Once lots of
smc\_connect\_work() was pending or all executing work dangling,
smc\_release() has to block until one worker comes to free, which
is equivalent to wait another smc\_connnect\_work() to finish.
In order to fix this, There are two changes:
1. For those idle smc\_connect\_work(), cancel it from the workqueue; for
executing smc\_connect\_work(), waiting for it to finish. For that
purpose, replace flush\_work() with cancel\_work\_sync().
2. Since smc\_connect() hold a reference for passive closing, if
smc\_connect\_work() has been cancelled, release the reference.
Fixes: 24ac3a08e658 ("net/smc: rebuild nonblocking connect")
Reported-by: Tony Lu
Tested-by: Dust Li
Reviewed-by: Dust Li
Reviewed-by: Tony Lu
Signed-off-by: D. Wythe
Acked-by: Karsten Graul
Link: https://lore.kernel.org/r/1639571361-101128-1-git-send-email-alibuda@linux.alibaba.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit ff3d58592be4863b4fa2efa02637c2fbac047499
Author: Gal Pressman
Date: Thu Dec 16 11:28:25 2021 +0200
net: Fix double 0x prefix print in SKB dump
[ Upstream commit 8a03ef676ade55182f9b05115763aeda6dc08159 ]
When printing netdev features %pNF already takes care of the 0x prefix,
remove the explicit one.
Fixes: 6413139dfc64 ("skbuff: increase verbosity when dumping skb data")
Signed-off-by: Gal Pressman
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 987e1a4682e55527afa403e2497cef627ca0848e
Author: Andrey Eremeev
Date: Wed Dec 15 20:30:32 2021 +0300
dsa: mv88e6xxx: fix debug print for SPEED\_UNFORCED
[ Upstream commit e08cdf63049b711099efff0811273449083bb958 ]
Debug print uses invalid check to detect if speed is unforced:
(speed != SPEED\_UNFORCED) should be used instead of (!speed).
Found by Linux Verification Center (linuxtesting.org) with SVACE.
Signed-off-by: Andrey Eremeev
Fixes: 96a2b40c7bd3 ("net: dsa: mv88e6xxx: add port's MAC speed setter")
Reviewed-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 9a77c02d1d2147a76bd187af1bf5a34242662d12
Author: Jiasheng Jiang
Date: Wed Dec 15 22:37:31 2021 +0800
sfc\_ef100: potential dereference of null pointer
[ Upstream commit 407ecd1bd726f240123f704620d46e285ff30dd9 ]
The return value of kmalloc() needs to be checked.
To avoid use in efx\_nic\_update\_stats() in case of the failure of alloc.
Fixes: b593b6f1b492 ("sfc\_ef100: statistics gathering")
Signed-off-by: Jiasheng Jiang
Reported-by: kernel test robot
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 0b4a5d1e15ce72f69be48f38dc0401dab890ae0f
Author: John Keeping
Date: Tue Dec 14 19:10:09 2021 +0000
net: stmmac: dwmac-rk: fix oob read in rk\_gmac\_setup
[ Upstream commit 0546b224cc7717cc8a2db076b0bb069a9c430794 ]
KASAN reports an out-of-bounds read in rk\_gmac\_setup on the line:
while (ops->regs[i]) {
This happens for most platforms since the regs flexible array member is
empty, so the memory after the ops structure is being read here. It
seems that mostly this happens to contain zero anyway, so we get lucky
and everything still works.
To avoid adding redundant data to nearly all the ops structures, add a
new flag to indicate whether the regs field is valid and avoid this loop
when it is not.
Fixes: 3bb3d6b1c195 ("net: stmmac: Add RK3566/RK3568 SoC support")
Signed-off-by: John Keeping
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit feb116a0ecc5625d6532c616d9a10ef4ef81514b
Author: Willem de Bruijn
Date: Wed Dec 15 09:39:37 2021 -0500
net/packet: rx\_owner\_map depends on pg\_vec
[ Upstream commit ec6af094ea28f0f2dda1a6a33b14cd57e36a9755 ]
Packet sockets may switch ring versions. Avoid misinterpreting state
between versions, whose fields share a union. rx\_owner\_map is only
allocated with a packet ring (pg\_vec) and both are swapped together.
If pg\_vec is NULL, meaning no packet ring was allocated, then neither
was rx\_owner\_map. And the field may be old state from a tpacket\_v3.
Fixes: 61fad6816fc1 ("net/packet: tpacket\_rcv: avoid a producer race condition")
Reported-by: Syzbot
Signed-off-by: Willem de Bruijn
Reviewed-by: Eric Dumazet
Link: https://lore.kernel.org/r/20211215143937.106178-1-willemdebruijn.kernel@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 27358aa81a7d60e6bd36f0bb1db65cd084c2cad0
Author: Haimin Zhang
Date: Wed Dec 15 19:15:30 2021 +0800
netdevsim: Zero-initialize memory for new map's value in function nsim\_bpf\_map\_alloc
[ Upstream commit 481221775d53d6215a6e5e9ce1cce6d2b4ab9a46 ]
Zero-initialize memory for new map's value in function nsim\_bpf\_map\_alloc
since it may cause a potential kernel information leak issue, as follows:
1. nsim\_bpf\_map\_alloc calls nsim\_map\_alloc\_elem to allocate elements for
a new map.
2. nsim\_map\_alloc\_elem uses kmalloc to allocate map's value, but doesn't
zero it.
3. A user application can use IOCTL BPF\_MAP\_LOOKUP\_ELEM to get specific
element's information in the map.
4. The kernel function map\_lookup\_elem will call bpf\_map\_copy\_value to get
the information allocated at step-2, then use copy\_to\_user to copy to the
user buffer.
This can only leak information for an array map.
Fixes: 395cacb5f1a0 ("netdevsim: bpf: support fake map offload")
Suggested-by: Jakub Kicinski
Acked-by: Jakub Kicinski
Signed-off-by: Haimin Zhang
Link: https://lore.kernel.org/r/20211215111530.72103-1-tcs.kernel@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 288b0c511c11f5a1724d4c300257114a4772bcb2
Author: Cyril Novikov
Date: Mon Nov 1 18:39:36 2021 -0700
ixgbe: set X550 MDIO speed before talking to PHY
[ Upstream commit bf0a375055bd1afbbf02a0ef45f7655da7b71317 ]
The MDIO bus speed must be initialized before talking to the PHY the first
time in order to avoid talking to it using a speed that the PHY doesn't
support.
This fixes HW initialization error -17 (IXGBE\_ERR\_PHY\_ADDR\_INVALID) on
Denverton CPUs (a.k.a. the Atom C3000 family) on ports with a 10Gb network
plugged in. On those devices, HLREG0[MDCSPD] resets to 1, which combined
with the 10Gb network results in a 24MHz MDIO speed, which is apparently
too fast for the connected PHY. PHY register reads over MDIO bus return
garbage, leading to initialization failure.
Reproduced with Linux kernel 4.19 and 5.15-rc7. Can be reproduced using
the following setup:
\* Use an Atom C3000 family system with at least one X552 LAN on the SoC
\* Disable PXE or other BIOS network initialization if possible
(the interface must not be initialized before Linux boots)
\* Connect a live 10Gb Ethernet cable to an X550 port
\* Power cycle (not reset, doesn't always work) the system and boot Linux
\* Observe: ixgbe interfaces w/ 10GbE cables plugged in fail with error -17
Fixes: e84db7272798 ("ixgbe: Introduce function to control MDIO speed")
Signed-off-by: Cyril Novikov
Reviewed-by: Andrew Lunn
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 2f2ebb7d43243d6697ca9dfac59d0c6b099ad423
Author: Robert Schlabbach
Date: Tue Oct 26 02:24:48 2021 +0200
ixgbe: Document how to enable NBASE-T support
[ Upstream commit 271225fd57c2f1e0b3f8826df51be6c634affefe ]
Commit a296d665eae1 ("ixgbe: Add ethtool support to enable 2.5 and 5.0
Gbps support") introduced suppression of the advertisement of NBASE-T
speeds by default, according to Todd Fujinaka to accommodate customers
with network switches which could not cope with advertised NBASE-T
speeds, as posted in the E1000-devel mailing list:
https://sourceforge.net/p/e1000/mailman/message/37106269/
However, the suppression was not documented at all, nor was how to
enable NBASE-T support.
Properly document the NBASE-T suppression and how to enable NBASE-T
support.
Fixes: a296d665eae1 ("ixgbe: Add ethtool support to enable 2.5 and 5.0 Gbps support")
Reported-by: Robert Schlabbach
Signed-off-by: Robert Schlabbach
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 33c1707a8ea4b70187230202de4a51d756602a80
Author: Sasha Neftin
Date: Tue Nov 2 09:20:06 2021 +0200
igc: Fix typo in i225 LTR functions
[ Upstream commit 0182d1f3fa640888a2ed7e3f6df2fdb10adee7c8 ]
The LTR maximum value was incorrectly written using the scale from
the LTR minimum value. This would cause incorrect values to be sent,
in cases where the initial calculation lead to different min/max scales.
Fixes: 707abf069548 ("igc: Add initial LTR support")
Suggested-by: Dima Ruinskiy
Signed-off-by: Sasha Neftin
Tested-by: Nechama Kraus
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 944b8be08131f5faf2cd2440aa1c24a39a163a54
Author: Letu Ren
Date: Sat Nov 13 11:42:34 2021 +0800
igbvf: fix double free in `igbvf\_probe`
[ Upstream commit b6d335a60dc624c0d279333b22c737faa765b028 ]
In `igbvf\_probe`, if register\_netdev() fails, the program will go to
label err\_hw\_init, and then to label err\_ioremap. In free\_netdev() which
is just below label err\_ioremap, there is `list\_for\_each\_entry\_safe` and
`netif\_napi\_del` which aims to delete all entries in `dev->napi\_list`.
The program has added an entry `adapter->rx\_ring->napi` which is added by
`netif\_napi\_add` in igbvf\_alloc\_queues(). However, adapter->rx\_ring has
been freed below label err\_hw\_init. So this a UAF.
In terms of how to patch the problem, we can refer to igbvf\_remove() and
delete the entry before `adapter->rx\_ring`.
The KASAN logs are as follows:
[ 35.126075] BUG: KASAN: use-after-free in free\_netdev+0x1fd/0x450
[ 35.127170] Read of size 8 at addr ffff88810126d990 by task modprobe/366
[ 35.128360]
[ 35.128643] CPU: 1 PID: 366 Comm: modprobe Not tainted 5.15.0-rc2+ #14
[ 35.129789] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014
[ 35.131749] Call Trace:
[ 35.132199] dump\_stack\_lvl+0x59/0x7b
[ 35.132865] print\_address\_description+0x7c/0x3b0
[ 35.133707] ? free\_netdev+0x1fd/0x450
[ 35.134378] \_\_kasan\_report+0x160/0x1c0
[ 35.135063] ? free\_netdev+0x1fd/0x450
[ 35.135738] kasan\_report+0x4b/0x70
[ 35.136367] free\_netdev+0x1fd/0x450
[ 35.137006] igbvf\_probe+0x121d/0x1a10 [igbvf]
[ 35.137808] ? igbvf\_vlan\_rx\_add\_vid+0x100/0x100 [igbvf]
[ 35.138751] local\_pci\_probe+0x13c/0x1f0
[ 35.139461] pci\_device\_probe+0x37e/0x6c0
[ 35.165526]
[ 35.165806] Allocated by task 366:
[ 35.166414] \_\_\_\_kasan\_kmalloc+0xc4/0xf0
[ 35.167117] foo\_kmem\_cache\_alloc\_trace+0x3c/0x50 [igbvf]
[ 35.168078] igbvf\_probe+0x9c5/0x1a10 [igbvf]
[ 35.168866] local\_pci\_probe+0x13c/0x1f0
[ 35.169565] pci\_device\_probe+0x37e/0x6c0
[ 35.179713]
[ 35.179993] Freed by task 366:
[ 35.180539] kasan\_set\_track+0x4c/0x80
[ 35.181211] kasan\_set\_free\_info+0x1f/0x40
[ 35.181942] \_\_\_\_kasan\_slab\_free+0x103/0x140
[ 35.182703] kfree+0xe3/0x250
[ 35.183239] igbvf\_probe+0x1173/0x1a10 [igbvf]
[ 35.184040] local\_pci\_probe+0x13c/0x1f0
Fixes: d4e0fe01a38a0 (igbvf: add new driver to support 82576 virtual functions)
Reported-by: Zheyu Ma
Signed-off-by: Letu Ren
Tested-by: Konrad Jankowski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 81ffe207ae1b5d4305540ded2d2d1dc8c99663a0
Author: Karen Sornek
Date: Tue Aug 31 13:16:35 2021 +0200
igb: Fix removal of unicast MAC filters of VFs
[ Upstream commit 584af82154f56e6b2740160fcc84a2966d969e15 ]
Move checking condition of VF MAC filter before clearing
or adding MAC filter to VF to prevent potential blackout caused
by removal of necessary and working VF's MAC filter.
Fixes: 1b8b062a99dc ("igb: add VF trust infrastructure")
Signed-off-by: Karen Sornek
Tested-by: Konrad Jankowski
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 12dc89ccaf2024d953235ca2defc40840c27965d
Author: Nathan Chancellor
Date: Fri Dec 10 09:55:29 2021 -0700
soc/tegra: fuse: Fix bitwise vs. logical OR warning
[ Upstream commit a7083763619f7485ccdade160deb81737cf2732f ]
A new warning in clang points out two instances where boolean
expressions are being used with a bitwise OR instead of logical OR:
drivers/soc/tegra/fuse/speedo-tegra20.c:72:9: warning: use of bitwise '|' with boolean operands [-Wbitwise-instead-of-logical]
reg = tegra\_fuse\_read\_spare(i) |
^~~~~~~~~~~~~~~~~~~~~~~~~~
||
drivers/soc/tegra/fuse/speedo-tegra20.c:72:9: note: cast one or both operands to int to silence this warning
drivers/soc/tegra/fuse/speedo-tegra20.c:87:9: warning: use of bitwise '|' with boolean operands [-Wbitwise-instead-of-logical]
reg = tegra\_fuse\_read\_spare(i) |
^~~~~~~~~~~~~~~~~~~~~~~~~~
||
drivers/soc/tegra/fuse/speedo-tegra20.c:87:9: note: cast one or both operands to int to silence this warning
2 warnings generated.
The motivation for the warning is that logical operations short circuit
while bitwise operations do not.
In this instance, tegra\_fuse\_read\_spare() is not semantically returning
a boolean, it is returning a bit value. Use u32 for its return type so
that it can be used with either bitwise or boolean operators without any
warnings.
Fixes: 25cd5a391478 ("ARM: tegra: Add speedo-based process identification")
Link: https://github.com/ClangBuiltLinux/linux/issues/1488
Suggested-by: MichaÅ‚ MirosÅ‚aw
Signed-off-by: Nathan Chancellor
Reviewed-by: Nick Desaulniers
Signed-off-by: Thierry Reding
Signed-off-by: Sasha Levin
commit 23311b92755ffa9087332d1bb8c71c0f6a10cc08
Author: Maxim Galaganov
Date: Tue Dec 14 15:16:03 2021 -0800
mptcp: fix deadlock in \_\_mptcp\_push\_pending()
[ Upstream commit 3d79e3756ca90f7a6087b77b62c1d9c0801e0820 ]
\_\_mptcp\_push\_pending() may call mptcp\_flush\_join\_list() with subflow
socket lock held. If such call hits mptcp\_sockopt\_sync\_all() then
subsequently \_\_mptcp\_sockopt\_sync() could try to lock the subflow
socket for itself, causing a deadlock.
sysrq: Show Blocked State
task:ss-server state:D stack: 0 pid: 938 ppid: 1 flags:0x00000000
Call Trace:
\_\_schedule+0x2d6/0x10c0
? \_\_mod\_memcg\_state+0x4d/0x70
? csum\_partial+0xd/0x20
? \_raw\_spin\_lock\_irqsave+0x26/0x50
schedule+0x4e/0xc0
\_\_lock\_sock+0x69/0x90
? do\_wait\_intr\_irq+0xa0/0xa0
\_\_lock\_sock\_fast+0x35/0x50
mptcp\_sockopt\_sync\_all+0x38/0xc0
\_\_mptcp\_push\_pending+0x105/0x200
mptcp\_sendmsg+0x466/0x490
sock\_sendmsg+0x57/0x60
\_\_sys\_sendto+0xf0/0x160
? do\_wait\_intr\_irq+0xa0/0xa0
? fpregs\_restore\_userregs+0x12/0xd0
\_\_x64\_sys\_sendto+0x20/0x30
do\_syscall\_64+0x38/0x90
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f9ba546c2d0
RSP: 002b:00007ffdc3b762d8 EFLAGS: 00000246 ORIG\_RAX: 000000000000002c
RAX: ffffffffffffffda RBX: 00007f9ba56c8060 RCX: 00007f9ba546c2d0
RDX: 000000000000077a RSI: 0000000000e5e180 RDI: 0000000000000234
RBP: 0000000000cc57f0 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 00007f9ba56c8060
R13: 0000000000b6ba60 R14: 0000000000cc7840 R15: 41d8685b1d7901b8

Fix the issue by using \_\_mptcp\_flush\_join\_list() instead of plain
mptcp\_flush\_join\_list() inside \_\_mptcp\_push\_pending(), as suggested by
Florian. The sockopt sync will be deferred to the workqueue.
Fixes: 1b3e7ede1365 ("mptcp: setsockopt: handle SO\_KEEPALIVE and SO\_PRIORITY")
Closes: https://github.com/multipath-tcp/mptcp\_net-next/issues/244
Suggested-by: Florian Westphal
Reviewed-by: Florian Westphal
Signed-off-by: Maxim Galaganov
Signed-off-by: Mat Martineau
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit c26ac0ea3a91c210cf90452e625dc441adf3e549
Author: Florian Westphal
Date: Tue Dec 14 15:16:02 2021 -0800
mptcp: clear 'kern' flag from fallback sockets
[ Upstream commit d6692b3b97bdc165d150f4c1505751a323a80717 ]
The mptcp ULP extension relies on sk->sk\_sock\_kern being set correctly:
It prevents setsockopt(fd, IPPROTO\_TCP, TCP\_ULP, "mptcp", 6); from
working for plain tcp sockets (any userspace-exposed socket).
But in case of fallback, accept() can return a plain tcp sk.
In such case, sk is still tagged as 'kernel' and setsockopt will work.
This will crash the kernel, The subflow extension has a NULL ctx->conn
mptcp socket:
BUG: KASAN: null-ptr-deref in subflow\_data\_ready+0x181/0x2b0
Call Trace:
tcp\_data\_ready+0xf8/0x370
[..]
Fixes: cf7da0d66cc1 ("mptcp: Create SUBFLOW socket for incoming connections")
Signed-off-by: Florian Westphal
Signed-off-by: Mat Martineau
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 3de0c86d42f841d1d64f316cd949e65c566f0734
Author: Florian Westphal
Date: Tue Dec 14 15:16:01 2021 -0800
mptcp: remove tcp ulp setsockopt support
[ Upstream commit 404cd9a22150f24acf23a8df2ad0c094ba379f57 ]
TCP\_ULP setsockopt cannot be used for mptcp because its already
used internally to plumb subflow (tcp) sockets to the mptcp layer.
syzbot managed to trigger a crash for mptcp connections that are
in fallback mode:
KASAN: null-ptr-deref in range [0x0000000000000020-0x0000000000000027]
CPU: 1 PID: 1083 Comm: syz-executor.3 Not tainted 5.16.0-rc2-syzkaller #0
RIP: 0010:tls\_build\_proto net/tls/tls\_main.c:776 [inline]
[..]
\_\_tcp\_set\_ulp net/ipv4/tcp\_ulp.c:139 [inline]
tcp\_set\_ulp+0x428/0x4c0 net/ipv4/tcp\_ulp.c:160
do\_tcp\_setsockopt+0x455/0x37c0 net/ipv4/tcp.c:3391
mptcp\_setsockopt+0x1b47/0x2400 net/mptcp/sockopt.c:638
Remove support for TCP\_ULP setsockopt.
Fixes: d9e4c1291810 ("mptcp: only admit explicitly supported sockopt")
Reported-by: syzbot+1fd9b69cde42967d1add@syzkaller.appspotmail.com
Signed-off-by: Florian Westphal
Signed-off-by: Mat Martineau
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 257b3bb16634fd936129fe2f57a91594a75b8751
Author: Lang Yu
Date: Tue Dec 14 15:25:54 2021 +0800
drm/amd/pm: fix a potential gpu\_metrics\_table memory leak
[ Upstream commit aa464957f7e660abd554f2546a588f6533720e21 ]
Memory is allocated for gpu\_metrics\_table in renoir\_init\_smc\_tables(),
but not freed in int smu\_v12\_0\_fini\_smc\_tables(). Free it!
Fixes: 95868b85764a ("drm/amd/powerplay: add Renoir support for gpu metrics export")
Signed-off-by: Lang Yu
Reviewed-by: Lijo Lazar
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit cc98ef784152d078b4610f2ea2eb83134108252c
Author: Nicholas Kazlauskas
Date: Fri Dec 10 15:03:59 2021 -0800
drm/amd/display: Set exit\_optimized\_pwr\_state for DCN31
[ Upstream commit 7e4d2f30df3fb48f75ce9e96867d42bdddab83ac ]
[Why]
SMU now respects the PHY refclk disable request from driver.
This causes a hang during hotplug when PHY refclk was disabled
because it's not being re-enabled and the transmitter control
starts on dc\_link\_detect.
[How]
We normally would re-enable the clk with exit\_optimized\_pwr\_state
but this is only set on DCN21 and DCN301. Set it for dcn31 as well.
This fixes DMCUB timeouts in the PHY.
Fixes: 64b1d0e8d500 ("drm/amd/display: Add DCN3.1 HWSEQ")
Reviewed-by: Eric Yang
Acked-by: Pavle Kotarac
Tested-by: Daniel Wheeler
Signed-off-by: Nicholas Kazlauskas
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit a0dacf4bc3c58a441b2759e6b949173b7a042c09
Author: Karol Kolacinski
Date: Tue Nov 16 13:07:14 2021 +0100
ice: Don't put stale timestamps in the skb
[ Upstream commit 37e738b6fdb14529534dca441e0222313688fde3 ]
The driver has to check if it does not accidentally put the timestamp in
the SKB before previous timestamp gets overwritten.
Timestamp values in the PHY are read only and do not get cleared except
at hardware reset or when a new timestamp value is captured.
The cached\_tstamp field is used to detect the case where a new timestamp
has not yet been captured, ensuring that we avoid sending stale
timestamp data to the stack.
Fixes: ea9b847cda64 ("ice: enable transmit timestamps for E810 devices")
Signed-off-by: Karol Kolacinski
Tested-by: Gurucharan G
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 89f9c880141eef84ee9001dd6969067be72145d0
Author: Karol Kolacinski
Date: Thu Nov 4 14:52:11 2021 +0100
ice: Use div64\_u64 instead of div\_u64 in adjfine
[ Upstream commit 0013881c1145d36bf26165bb70fdd7560a5507a3 ]
Change the division in ice\_ptp\_adjfine from div\_u64 to div64\_u64.
div\_u64 is used when the divisor is 32 bit but in this case incval is
64 bit and it caused incorrect calculations and incval adjustments.
Fixes: 06c16d89d2cb ("ice: register 1588 PTP clock device object for E810 devices")
Signed-off-by: Karol Kolacinski
Tested-by: Gurucharan G
Signed-off-by: Tony Nguyen
Signed-off-by: Sasha Levin
commit 68014890e4382ff9192e1357be39b7d0455665fa
Author: Hangyu Hua
Date: Tue Dec 14 18:46:59 2021 +0800
rds: memory leak in \_\_rds\_conn\_create()
[ Upstream commit 5f9562ebe710c307adc5f666bf1a2162ee7977c0 ]
\_\_rds\_conn\_create() did not release conn->c\_path when loop\_trans != 0 and
trans->t\_prefer\_loopback != 0 and is\_outgoing == 0.
Fixes: aced3ce57cd3 ("RDS tcp loopback connection can hang")
Signed-off-by: Hangyu Hua
Reviewed-by: Sharath Srinivasan
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit d92781bf78db171c8a4fb7648307b846721cf70a
Author: Baowen Zheng
Date: Mon Dec 13 15:46:04 2021 +0100
flow\_offload: return EOPNOTSUPP for the unsupported mpls action type
[ Upstream commit 166b6a46b78bf8b9559a6620c3032f9fe492e082 ]
We need to return EOPNOTSUPP for the unsupported mpls action type when
setup the flow action.
In the original implement, we will return 0 for the unsupported mpls
action type, actually we do not setup it and the following actions
to the flow action entry.
Fixes: 9838b20a7fb2 ("net: sched: take rtnl lock in tc\_setup\_flow\_action()")
Signed-off-by: Baowen Zheng
Signed-off-by: Simon Horman
Acked-by: Jamal Hadi Salim
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 97cb5c82aa1dd85a39b1bd021c8b5f18af623779
Author: Ong Boon Leong
Date: Sat Dec 11 22:51:34 2021 +0800
net: stmmac: fix tc flower deletion for VLAN priority Rx steering
[ Upstream commit aeb7c75cb77478fdbf821628e9c95c4baa9adc63 ]
To replicate the issue:-
1) Add 1 flower filter for VLAN Priority based frame steering:-
$ IFDEVNAME=eth0
$ tc qdisc add dev $IFDEVNAME ingress
$ tc qdisc add dev $IFDEVNAME root mqprio num\_tc 8 \
map 0 1 2 3 4 5 6 7 0 0 0 0 0 0 0 0 \
queues 1@0 1@1 1@2 1@3 1@4 1@5 1@6 1@7 hw 0
$ tc filter add dev $IFDEVNAME parent ffff: protocol 802.1Q \
flower vlan\_prio 0 hw\_tc 0
2) Get the 'pref' id
$ tc filter show dev $IFDEVNAME ingress
3) Delete a specific tc flower record (say pref 49151)
$ tc filter del dev $IFDEVNAME parent ffff: pref 49151
From dmesg, we will observe kernel NULL pointer ooops
[ 197.170464] BUG: kernel NULL pointer dereference, address: 0000000000000000
[ 197.171367] #PF: supervisor read access in kernel mode
[ 197.171367] #PF: error\_code(0x0000) - not-present page
[ 197.171367] PGD 0 P4D 0
[ 197.171367] Oops: 0000 [#1] PREEMPT SMP NOPTI
[ 197.171367] RIP: 0010:tc\_setup\_cls+0x20b/0x4a0 [stmmac]
[ 197.171367] Call Trace:
[ 197.171367]
[ 197.171367] ? \_\_stmmac\_disable\_all\_queues+0xa8/0xe0 [stmmac]
[ 197.171367] stmmac\_setup\_tc\_block\_cb+0x70/0x110 [stmmac]
[ 197.171367] tc\_setup\_cb\_destroy+0xb3/0x180
[ 197.171367] fl\_hw\_destroy\_filter+0x94/0xc0 [cls\_flower]
The above issue is due to previous incorrect implementation of
tc\_del\_vlan\_flow(), shown below, that uses flow\_cls\_offload\_flow\_rule()
to get struct flow\_rule \*rule which is no longer valid for tc filter
delete operation.
struct flow\_rule \*rule = flow\_cls\_offload\_flow\_rule(cls);
struct flow\_dissector \*dissector = rule->match.dissector;
So, to ensure tc\_del\_vlan\_flow() deletes the right VLAN cls record for
earlier configured RX queue (configured by hw\_tc) in tc\_add\_vlan\_flow(),
this patch introduces stmmac\_rfs\_entry as driver-side flow\_cls\_offload
record for 'RX frame steering' tc flower, currently used for VLAN
priority. The implementation has taken consideration for future extension
to include other type RX frame steering such as EtherType based.
v2:
- Clean up overly extensive backtrace and rewrite git message to better
explain the kernel NULL pointer issue.
Fixes: 0e039f5cf86c ("net: stmmac: add RX frame steering based on VLAN priority in tc flower")
Tested-by: Kurt Kanzenbach
Signed-off-by: Ong Boon Leong
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 1571ff2d199e320f837f40cd5ed36c091373d3ef
Author: Johannes Berg
Date: Mon Nov 29 15:32:46 2021 +0200
mac80211: fix lookup when adding AddBA extension element
[ Upstream commit 511ab0c1dfb260a6b17b8771109e8d63474473a7 ]
We should be doing the HE capabilities lookup based on the full
interface type so if P2P doesn't have HE but client has it doesn't
get confused. Fix that.
Fixes: 2ab45876756f ("mac80211: add support for the ADDBA extension element")
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20211129152938.010fc1d61137.If3a468145f29d670cb00a693bed559d8290ba693@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit 0783716ba2bd7f01ce7304668f7492e13a1d92bc
Author: Ilan Peer
Date: Thu Dec 2 15:28:54 2021 +0200
cfg80211: Acquire wiphy mutex on regulatory work
[ Upstream commit e08ebd6d7b90ae81f21425ca39136f5b2272580f ]
The function cfg80211\_reg\_can\_beacon\_relax() expects wiphy
mutex to be held when it is being called. However, when
reg\_leave\_invalid\_chans() is called the mutex is not held.
Fix it by acquiring the lock before calling the function.
Fixes: a05829a7222e ("cfg80211: avoid holding the RTNL when calling the driver")
Signed-off-by: Ilan Peer
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20211202152831.527686cda037.I40ad9372a47cbad53b4aae7b5a6ccc0dc3fddf8b@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit e0984a4d414b7ba34774832ce01bf1555ea41c7b
Author: Johannes Berg
Date: Thu Dec 2 15:26:25 2021 +0200
mac80211: agg-tx: don't schedule\_and\_wake\_txq() under sta->lock
[ Upstream commit 06c41bda0ea14aa7fba932a9613c4ee239682cf0 ]
When we call ieee80211\_agg\_start\_txq(), that will in turn call
schedule\_and\_wake\_txq(). Called from ieee80211\_stop\_tx\_ba\_cb()
this is done under sta->lock, which leads to certain circular
lock dependencies, as reported by Chris Murphy:
https://lore.kernel.org/r/CAJCQCtSXJ5qA4bqSPY=oLRMbv-irihVvP7A2uGutEbXQVkoNaw@mail.gmail.com
In general, ieee80211\_agg\_start\_txq() is usually not called
with sta->lock held, only in this one place. But it's always
called with sta->ampdu\_mlme.mtx held, and that's therefore
clearly sufficient.
Change ieee80211\_stop\_tx\_ba\_cb() to also call it without the
sta->lock held, by factoring it out of ieee80211\_remove\_tid\_tx()
(which is only called in this one place).
This breaks the locking chain and makes it less likely that
we'll have similar locking chain problems in the future.
Fixes: ba8c3d6f16a1 ("mac80211: add an intermediate software queue implementation")
Reported-by: Chris Murphy
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20211202152554.f519884c8784.I555fef8e67d93fff3d9a304886c4a9f8b322e591@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit 95053f4477c97c3e4ffc66aa09d233e14e4e881c
Author: Harshit Mogalapalli
Date: Thu Dec 9 20:41:24 2021 -0800
drm/i915/display: Fix an unsigned subtraction which can never be negative.
[ Upstream commit 53b3495273282aa844c4613d19c3b30558c70c84 ]
smatch warning:
drivers/gpu/drm/i915/display/intel\_dmc.c:601 parse\_dmc\_fw() warn:
unsigned 'fw->size - offset' is never less than zero
Firmware size is size\_t and offset is u32. So the subtraction is
unsigned which can never be less than zero.
Fixes: 3d5928a168a9 ("drm/i915/xelpd: Pipe A DMC plugging")
Signed-off-by: Harshit Mogalapalli
Reviewed-by: Lucas De Marchi
Signed-off-by: Lucas De Marchi
Link: https://patchwork.freedesktop.org/patch/msgid/20211210044129.12422-1-harshit.m.mogalapalli@oracle.com
(cherry picked from commit 87bb2a410dcfb617b88e4695edf4beb6336dc314)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Sasha Levin
commit fb5099ad02dcdccbab725756d83a4b55805a9b25
Author: Jiasheng Jiang
Date: Tue Dec 14 09:41:26 2021 +0800
drm/ast: potential dereference of null pointer
[ Upstream commit fea3fdf975dd9f3e5248afaab8fe023db313f005 ]
The return value of kzalloc() needs to be checked.
To avoid use of null pointer '\*\_state->base' in case of the
failure of alloc.
Fixes: f0adbc382b8b ("drm/ast: Allocate initial CRTC state of the correct size")
Signed-off-by: Jiasheng Jiang
Signed-off-by: Thomas Zimmermann
Link: https://patchwork.freedesktop.org/patch/msgid/20211214014126.2211535-1-jiasheng@iscas.ac.cn
Signed-off-by: Sasha Levin
commit 1456a0004cc54c58adb2501cb0c95dc8b3c83e9e
Author: Paolo Abeni
Date: Sat Dec 11 17:11:12 2021 +0100
mptcp: never allow the PM to close a listener subflow
[ Upstream commit b0cdc5dbcf2ba0d99785da5aabf1b17943805b8a ]
Currently, when deleting an endpoint the netlink PM treverses
all the local MPTCP sockets, regardless of their status.
If an MPTCP listener socket is bound to the IP matching the
delete endpoint, the listener TCP socket will be closed.
That is unexpected, the PM should only affect data subflows.
Additionally, syzbot was able to trigger a NULL ptr dereference
due to the above:
general protection fault, probably for non-canonical address 0xdffffc0000000003: 0000 [#1] PREEMPT SMP KASAN
KASAN: null-ptr-deref in range [0x0000000000000018-0x000000000000001f]
CPU: 1 PID: 6550 Comm: syz-executor122 Not tainted 5.16.0-rc4-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
RIP: 0010:\_\_lock\_acquire+0xd7d/0x54a0 kernel/locking/lockdep.c:4897
Code: 0f 0e 41 be 01 00 00 00 0f 86 c8 00 00 00 89 05 69 cc 0f 0e e9 bd 00 00 00 48 b8 00 00 00 00 00 fc ff df 48 89 da 48 c1 ea 03 <80> 3c 02 00 0f 85 f3 2f 00 00 48 81 3b 20 75 17 8f 0f 84 52 f3 ff
RSP: 0018:ffffc90001f2f818 EFLAGS: 00010016
RAX: dffffc0000000000 RBX: 0000000000000018 RCX: 0000000000000000
RDX: 0000000000000003 RSI: 0000000000000000 RDI: 0000000000000001
RBP: 0000000000000000 R08: 0000000000000001 R09: 0000000000000001
R10: 0000000000000000 R11: 000000000000000a R12: 0000000000000000
R13: ffff88801b98d700 R14: 0000000000000000 R15: 0000000000000001
FS: 00007f177cd3d700(0000) GS:ffff8880b9d00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f177cd1b268 CR3: 000000001dd55000 CR4: 0000000000350ee0
Call Trace:
lock\_acquire kernel/locking/lockdep.c:5637 [inline]
lock\_acquire+0x1ab/0x510 kernel/locking/lockdep.c:5602
\_\_raw\_spin\_lock\_irqsave include/linux/spinlock\_api\_smp.h:110 [inline]
\_raw\_spin\_lock\_irqsave+0x39/0x50 kernel/locking/spinlock.c:162
finish\_wait+0xc0/0x270 kernel/sched/wait.c:400
inet\_csk\_wait\_for\_connect net/ipv4/inet\_connection\_sock.c:464 [inline]
inet\_csk\_accept+0x7de/0x9d0 net/ipv4/inet\_connection\_sock.c:497
mptcp\_accept+0xe5/0x500 net/mptcp/protocol.c:2865
inet\_accept+0xe4/0x7b0 net/ipv4/af\_inet.c:739
mptcp\_stream\_accept+0x2e7/0x10e0 net/mptcp/protocol.c:3345
do\_accept+0x382/0x510 net/socket.c:1773
\_\_sys\_accept4\_file+0x7e/0xe0 net/socket.c:1816
\_\_sys\_accept4+0xb0/0x100 net/socket.c:1846
\_\_do\_sys\_accept net/socket.c:1864 [inline]
\_\_se\_sys\_accept net/socket.c:1861 [inline]
\_\_x64\_sys\_accept+0x71/0xb0 net/socket.c:1861
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x35/0xb0 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f177cd8b8e9
Code: 28 00 00 00 75 05 48 83 c4 28 c3 e8 b1 14 00 00 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 b8 ff ff ff f7 d8 64 89 01 48
RSP: 002b:00007f177cd3d308 EFLAGS: 00000246 ORIG\_RAX: 000000000000002b
RAX: ffffffffffffffda RBX: 00007f177ce13408 RCX: 00007f177cd8b8e9
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000003
RBP: 00007f177ce13400 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 00007f177ce1340c
R13: 00007f177cde1004 R14: 6d705f706374706d R15: 0000000000022000

Fix the issue explicitly skipping MPTCP socket in TCP\_LISTEN
status.
Reported-and-tested-by: syzbot+e4d843bb96a9431e6331@syzkaller.appspotmail.com
Reviewed-by: Mat Martineau
Fixes: 740d798e8767 ("mptcp: remove id 0 address")
Signed-off-by: Paolo Abeni
Link: https://lore.kernel.org/r/ebc7594cdd420d241fb2172ddb8542ba64717657.1639238695.git.pabeni@redhat.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 1752132eba0852e2d26852b433e926a43ade2715
Author: Hangbin Liu
Date: Mon Dec 13 16:36:00 2021 +0800
selftest/net/forwarding: declare NETIFS p9 p10
[ Upstream commit 71da1aec215290e249d09c44c768df859f3a3bba ]
The recent GRE selftests defined NUM\_NETIFS=10. If the users copy
forwarding.config.sample to forwarding.config directly, they will get
error "Command line is not complete" when run the GRE tests, because
create\_netif\_veth() failed with no interface name defined.
Fix it by extending the NETIFS with p9 and p10.
Fixes: 2800f2485417 ("selftests: forwarding: Test multipath hashing on inner IP pkts for GRE tunnel")
Signed-off-by: Hangbin Liu
Reviewed-by: Ido Schimmel
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 7c23a5d90733857837520cadb285b0aa9f8f8903
Author: Marek BehÃºn
Date: Sat Dec 11 23:51:41 2021 +0100
net: dsa: mv88e6xxx: Unforce speed & duplex in mac\_link\_down()
[ Upstream commit 9d591fc028b6bddb38c6585874f331267cbdadae ]
Commit 64d47d50be7a ("net: dsa: mv88e6xxx: configure interface settings
in mac\_config") removed forcing of speed and duplex from
mv88e6xxx\_mac\_config(), where the link is forced down, and left it only
in mv88e6xxx\_mac\_link\_up(), by which time link is unforced.
It seems that (at least on 88E6190) when changing cmode to 2500base-x,
if the link is not forced down, but the speed or duplex are still
forced, the forcing of new settings for speed & duplex doesn't take in
mv88e6xxx\_mac\_link\_up().
Fix this by unforcing speed & duplex in mv88e6xxx\_mac\_link\_down().
Fixes: 64d47d50be7a ("net: dsa: mv88e6xxx: configure interface settings in mac\_config")
Signed-off-by: Marek BehÃºn
Reviewed-by: Russell King (Oracle)
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4985d3b53c4de1a343b3994be27bad631f23b9c1
Author: Willem de Bruijn
Date: Sat Dec 11 14:30:31 2021 -0500
selftests/net: toeplitz: fix udp option
[ Upstream commit a8d13611b4a7b1b20d17bf2b9a89a3efcabde56c ]
Tiny fix. Option -u ("use udp") does not take an argument.
It can cause the next argument to silently be ignored.
Fixes: 5ebfb4cc3048 ("selftests/net: toeplitz test")
Signed-off-by: Willem de Bruijn
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 491c1253441e2fdc8f6a6f4976e3f13440419b7a
Author: Davide Caratti
Date: Fri Dec 10 17:42:47 2021 +0100
net/sched: sch\_ets: don't remove idle classes from the round-robin list
[ Upstream commit c062f2a0b04d86c5b8c9d973bea43493eaca3d32 ]
Shuang reported that the following script:
1) tc qdisc add dev ddd0 handle 10: parent 1: ets bands 8 strict 4 priomap 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
2) mausezahn ddd0 -A 10.10.10.1 -B 10.10.10.2 -c 0 -a own -b 00:c1:a0:c1:a0:00 -t udp &
3) tc qdisc change dev ddd0 handle 10: ets bands 4 strict 2 quanta 2500 2500 priomap 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
crashes systematically when line 2) is commented:
list\_del corruption, ffff8e028404bd30->next is LIST\_POISON1 (dead000000000100)
------------[ cut here ]------------
kernel BUG at lib/list\_debug.c:47!
invalid opcode: 0000 [#1] PREEMPT SMP NOPTI
CPU: 0 PID: 954 Comm: tc Not tainted 5.16.0-rc4+ #478
Hardware name: Red Hat KVM, BIOS 1.11.1-4.module+el8.1.0+4066+0f1aadab 04/01/2014
RIP: 0010:\_\_list\_del\_entry\_valid.cold.1+0x12/0x47
Code: fe ff 0f 0b 48 89 c1 4c 89 c6 48 c7 c7 08 42 1b 87 e8 1d c5 fe ff 0f 0b 48 89 fe 48 89 c2 48 c7 c7 98 42 1b 87 e8 09 c5 fe ff <0f> 0b 48 c7 c7 48 43 1b 87 e8 fb c4 fe ff 0f 0b 48 89 f2 48 89 fe
RSP: 0018:ffffae46807a3888 EFLAGS: 00010246
RAX: 000000000000004e RBX: 0000000000000007 RCX: 0000000000000202
RDX: 0000000000000000 RSI: ffffffff871ac536 RDI: 00000000ffffffff
RBP: ffffae46807a3a10 R08: 0000000000000000 R09: c0000000ffff7fff
R10: 0000000000000001 R11: ffffae46807a36a8 R12: ffff8e028404b800
R13: ffff8e028404bd30 R14: dead000000000100 R15: ffff8e02fafa2400
FS: 00007efdc92e4480(0000) GS:ffff8e02fb600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000682f48 CR3: 00000001058be000 CR4: 0000000000350ef0
Call Trace:
ets\_qdisc\_change+0x58b/0xa70 [sch\_ets]
tc\_modify\_qdisc+0x323/0x880
rtnetlink\_rcv\_msg+0x169/0x4a0
netlink\_rcv\_skb+0x50/0x100
netlink\_unicast+0x1a5/0x280
netlink\_sendmsg+0x257/0x4d0
sock\_sendmsg+0x5b/0x60
\_\_\_\_sys\_sendmsg+0x1f2/0x260
\_\_\_sys\_sendmsg+0x7c/0xc0
\_\_sys\_sendmsg+0x57/0xa0
do\_syscall\_64+0x3a/0x80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7efdc8031338
Code: 89 02 48 c7 c0 ff ff ff ff eb b5 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 8d 05 25 43 2c 00 8b 00 85 c0 75 17 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 58 c3 0f 1f 80 00 00 00 00 41 54 41 89 d4 55
RSP: 002b:00007ffdf1ce9828 EFLAGS: 00000246 ORIG\_RAX: 000000000000002e
RAX: ffffffffffffffda RBX: 0000000061b37a97 RCX: 00007efdc8031338
RDX: 0000000000000000 RSI: 00007ffdf1ce9890 RDI: 0000000000000003
RBP: 0000000000000000 R08: 0000000000000001 R09: 000000000078a940
R10: 000000000000000c R11: 0000000000000246 R12: 0000000000000001
R13: 0000000000688880 R14: 0000000000000000 R15: 0000000000000000

Modules linked in: sch\_ets sch\_tbf dummy rfkill iTCO\_wdt iTCO\_vendor\_support intel\_rapl\_msr intel\_rapl\_common joydev pcspkr i2c\_i801 virtio\_balloon i2c\_smbus lpc\_ich ip\_tables xfs libcrc32c crct10dif\_pclmul crc32\_pclmul crc32c\_intel serio\_raw ghash\_clmulni\_intel ahci libahci libata virtio\_blk virtio\_console virtio\_net net\_failover failover sunrpc dm\_mirror dm\_region\_hash dm\_log dm\_mod [last unloaded: sch\_ets]
---[ end trace f35878d1912655c2 ]---
RIP: 0010:\_\_list\_del\_entry\_valid.cold.1+0x12/0x47
Code: fe ff 0f 0b 48 89 c1 4c 89 c6 48 c7 c7 08 42 1b 87 e8 1d c5 fe ff 0f 0b 48 89 fe 48 89 c2 48 c7 c7 98 42 1b 87 e8 09 c5 fe ff <0f> 0b 48 c7 c7 48 43 1b 87 e8 fb c4 fe ff 0f 0b 48 89 f2 48 89 fe
RSP: 0018:ffffae46807a3888 EFLAGS: 00010246
RAX: 000000000000004e RBX: 0000000000000007 RCX: 0000000000000202
RDX: 0000000000000000 RSI: ffffffff871ac536 RDI: 00000000ffffffff
RBP: ffffae46807a3a10 R08: 0000000000000000 R09: c0000000ffff7fff
R10: 0000000000000001 R11: ffffae46807a36a8 R12: ffff8e028404b800
R13: ffff8e028404bd30 R14: dead000000000100 R15: ffff8e02fafa2400
FS: 00007efdc92e4480(0000) GS:ffff8e02fb600000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000682f48 CR3: 00000001058be000 CR4: 0000000000350ef0
Kernel panic - not syncing: Fatal exception in interrupt
Kernel Offset: 0x4e00000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
we can remove 'q->classes[i].alist' only if DRR class 'i' was part of the
active list. In the ETS scheduler DRR classes belong to that list only if
the queue length is greater than zero: we need to test for non-zero value
of 'q->classes[i].qdisc->q.qlen' before removing from the list, similarly
to what has been done elsewhere in the ETS code.
Fixes: de6d25924c2a ("net/sched: sch\_ets: don't peek at classes beyond 'nbands'")
Reported-by: Shuang Li
Signed-off-by: Davide Caratti
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 215b5046b11e4ce9688e562fe437e2e3376f76dc
Author: Alejandro Concepcion-Rodriguez
Date: Sun Dec 12 16:06:02 2021 +0000
drm: simpledrm: fix wrong unit with pixel clock
[ Upstream commit 5cf06065bd1f7b94fbb80e7eeb033899f77ab5ba ]
Pixel clock has to be set in kHz.
Signed-off-by: Alejandro Concepcion-Rodriguez
Fixes: 11e8f5fd223b ("drm: Add simpledrm driver")
Signed-off-by: Thomas Zimmermann
Link: https://patchwork.freedesktop.org/patch/msgid/6f8554ef-1305-0dda-821c-f7d2e5644a48@acoro.eu
Signed-off-by: Sasha Levin
commit 00b072a55ffc85793927701003f4c2207ffb521c
Author: Alyssa Ross
Date: Thu Nov 25 15:44:38 2021 +0000
dmaengine: st\_fdma: fix MODULE\_ALIAS
[ Upstream commit 822c9f2b833c53fc67e8adf6f63ecc3ea24d502c ]
modprobe can't handle spaces in aliases.
Fixes: 6b4cd727eaf1 ("dmaengine: st\_fdma: Add STMicroelectronics FDMA engine driver support")
Signed-off-by: Alyssa Ross
Link: https://lore.kernel.org/r/20211125154441.2626214-1-hi@alyssa.is
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit ee3701c4d9758e0d344ba859cf7459400a6d5625
Author: Dave Jiang
Date: Wed Dec 8 10:01:27 2021 -0700
dmaengine: idxd: fix missed completion on abort path
[ Upstream commit 8affd8a4b5ce356c8900cfb037674f3a4a11fbdb ]
Ming reported that with the abort path of the descriptor submission, there
can be a window where a completed descriptor can be missed to be completed
by the irq completion thread:
CPU A CPU B
Submit (successful)
Submit (fail)
irq\_process\_work\_list() // empty
llist\_abort\_desc()
// remove all descs from pending list
irq\_process\_pending\_llist() // empty
exit idxd\_wq\_thread() with no processing
Add opportunistic descriptor completion in the abort path in order to
remove the missed completion.
Fixes: 6b4b87f2c31a ("dmaengine: idxd: fix submission race window")
Reported-by: Ming Li
Signed-off-by: Dave Jiang
Link: https://lore.kernel.org/r/163898288714.443911.16084982766671976640.stgit@djiang5-desk3.ch.intel.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit 088e4d7dba27e89584962aa2394988f115ef45e5
Author: David Ahern
Date: Sat Dec 11 11:26:16 2021 -0700
selftests: Fix IPv6 address bind tests
[ Upstream commit 28a2686c185e84b6aa6a4d9c9a972360eb7ca266 ]
IPv6 allows binding a socket to a device then binding to an address
not on the device (\_\_inet6\_bind -> ipv6\_chk\_addr with strict flag
not set). Update the bind tests to reflect legacy behavior.
Fixes: 34d0302ab861 ("selftests: Add ipv6 address bind tests to fcnal-test")
Reported-by: Li Zhijian
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 28c73d856b71d79b919391e2f58a253a8e9a4a67
Author: David Ahern
Date: Sat Dec 11 10:21:08 2021 -0700
selftests: Fix raw socket bind tests with VRF
[ Upstream commit 0f108ae4452025fef529671998f6c7f1c4526790 ]
Commit referenced below added negative socket bind tests for VRF. The
socket binds should fail since the address to bind to is in a VRF yet
the socket is not bound to the VRF or a device within it. Update the
expected return code to check for 1 (bind failure) so the test passes
when the bind fails as expected. Add a 'show\_hint' comment to explain
why the bind is expected to fail.
Fixes: 75b2b2b3db4c ("selftests: Add ipv4 address bind tests to fcnal-test")
Reported-by: Li Zhijian
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 013ed7533966ffb31a234be3b2b402c2c78a024c
Author: David Ahern
Date: Sat Dec 11 10:11:30 2021 -0700
selftests: Add duplicate config only for MD5 VRF tests
[ Upstream commit 7e0147592b5c4f9e2eb8c54a7857a56d4863f74e ]
Commit referenced below added configuration in the default VRF that
duplicates a VRF to check MD5 passwords are properly used and fail
when expected. That config should not be added all the time as it
can cause tests to pass that should not (by matching on default VRF
setup when it should not). Move the duplicate setup to a function
that is only called for the MD5 tests and add a cleanup function
to remove it after the MD5 tests.
Fixes: 5cad8bce26e0 ("fcnal-test: Add TCP MD5 tests for VRF")
Signed-off-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 769f38809709e8aea0b6959589faf9191f984ec6
Author: Yufeng Mo
Date: Fri Dec 10 21:09:34 2021 +0800
net: hns3: fix race condition in debugfs
[ Upstream commit 6dde452bceca3f2ed2b33bc46a16ff5682a03a2e ]
When multiple threads concurrently access the debugfs content, data
and pointer exceptions may occur. Therefore, mutex lock protection is
added for debugfs.
Fixes: 5e69ea7ee2a6 ("net: hns3: refactor the debugfs process")
Signed-off-by: Yufeng Mo
Signed-off-by: Guangbin Huang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4f4a353f6fe033807cd026a5de81c67469ff19b0
Author: Jie Wang
Date: Fri Dec 10 21:09:33 2021 +0800
net: hns3: fix use-after-free bug in hclgevf\_send\_mbx\_msg
[ Upstream commit 27cbf64a766e86f068ce6214f04c00ceb4db1af4 ]
Currently, the hns3\_remove function firstly uninstall client instance,
and then uninstall acceletion engine device. The netdevice is freed in
client instance uninstall process, but acceletion engine device uninstall
process still use it to trace runtime information. This causes a use after
free problem.
So fixes it by check the instance register state to avoid use after free.
Fixes: d8355240cf8f ("net: hns3: add trace event support for PF/VF mailbox")
Signed-off-by: Jie Wang
Signed-off-by: Guangbin Huang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit a4377575d2e9017abf393bdfb3ef8d19071fabcc
Author: Po-Hsu Lin
Date: Fri Dec 10 15:25:23 2021 +0800
selftests: icmp\_redirect: pass xfail=0 to log\_test()
[ Upstream commit 3748939bce3fc7a15ef07161826507fbe410bb7a ]
If any sub-test in this icmp\_redirect.sh is failing but not expected
to fail. The script will complain:
./icmp\_redirect.sh: line 72: [: 1: unary operator expected
This is because when the sub-test is not expected to fail, we won't
pass any value for the xfail local variable in log\_test() and thus
it's empty. Fix this by passing 0 as the 4th variable to log\_test()
for non-xfail cases.
v2: added fixes tag
Fixes: 0a36a75c6818 ("selftests: icmp\_redirect: support expected failures")
Signed-off-by: Po-Hsu Lin
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4cd2d21bbe580fb7539a87c574671e4196d82353
Author: Filip Pokryvka
Date: Fri Dec 10 18:50:32 2021 +0100
netdevsim: don't overwrite read only ethtool parms
[ Upstream commit ee60e626d536da4c710b3634afe68fe7c6d69b59 ]
Ethtool ring feature has \_max\_pending attributes read-only.
Set only read-write attributes in nsim\_set\_ringparam.
This patch is useful, if netdevsim device is set-up using NetworkManager,
because NetworkManager sends 0 as MAX values, as it is pointless to
retrieve them in extra call, because they should be read-only. Then,
the device is left in incosistent state (value > MAX).
Fixes: a7fc6db099b5 ("netdevsim: support ethtool ring and coalesce settings")
Signed-off-by: Filip Pokryvka
Link: https://lore.kernel.org/r/20211210175032.411872-1-fpokryvk@redhat.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit e5d28205bf1de7082d904ed277ceb2db2879e302
Author: Eric Dumazet
Date: Thu Dec 9 10:50:58 2021 -0800
inet\_diag: fix kernel-infoleak for UDP sockets
[ Upstream commit 71ddeac8cd1d217744a0e060ff520e147c9328d1 ]
KMSAN reported a kernel-infoleak [1], that can exploited
by unpriv users.
After analysis it turned out UDP was not initializing
r->idiag\_expires. Other users of inet\_sk\_diag\_fill()
might make the same mistake in the future, so fix this
in inet\_sk\_diag\_fill().
[1]
BUG: KMSAN: kernel-infoleak in instrument\_copy\_to\_user include/linux/instrumented.h:121 [inline]
BUG: KMSAN: kernel-infoleak in copyout lib/iov\_iter.c:156 [inline]
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x69d/0x25c0 lib/iov\_iter.c:670
instrument\_copy\_to\_user include/linux/instrumented.h:121 [inline]
copyout lib/iov\_iter.c:156 [inline]
\_copy\_to\_iter+0x69d/0x25c0 lib/iov\_iter.c:670
copy\_to\_iter include/linux/uio.h:155 [inline]
simple\_copy\_to\_iter+0xf3/0x140 net/core/datagram.c:519
\_\_skb\_datagram\_iter+0x2cb/0x1280 net/core/datagram.c:425
skb\_copy\_datagram\_iter+0xdc/0x270 net/core/datagram.c:533
skb\_copy\_datagram\_msg include/linux/skbuff.h:3657 [inline]
netlink\_recvmsg+0x660/0x1c60 net/netlink/af\_netlink.c:1974
sock\_recvmsg\_nosec net/socket.c:944 [inline]
sock\_recvmsg net/socket.c:962 [inline]
sock\_read\_iter+0x5a9/0x630 net/socket.c:1035
call\_read\_iter include/linux/fs.h:2156 [inline]
new\_sync\_read fs/read\_write.c:400 [inline]
vfs\_read+0x1631/0x1980 fs/read\_write.c:481
ksys\_read+0x28c/0x520 fs/read\_write.c:619
\_\_do\_sys\_read fs/read\_write.c:629 [inline]
\_\_se\_sys\_read fs/read\_write.c:627 [inline]
\_\_x64\_sys\_read+0xdb/0x120 fs/read\_write.c:627
do\_syscall\_x64 arch/x86/entry/common.c:51 [inline]
do\_syscall\_64+0x54/0xd0 arch/x86/entry/common.c:82
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Uninit was created at:
slab\_post\_alloc\_hook mm/slab.h:524 [inline]
slab\_alloc\_node mm/slub.c:3251 [inline]
\_\_kmalloc\_node\_track\_caller+0xe0c/0x1510 mm/slub.c:4974
kmalloc\_reserve net/core/skbuff.c:354 [inline]
\_\_alloc\_skb+0x545/0xf90 net/core/skbuff.c:426
alloc\_skb include/linux/skbuff.h:1126 [inline]
netlink\_dump+0x3d5/0x16a0 net/netlink/af\_netlink.c:2245
\_\_netlink\_dump\_start+0xd1c/0xee0 net/netlink/af\_netlink.c:2370
netlink\_dump\_start include/linux/netlink.h:254 [inline]
inet\_diag\_handler\_cmd+0x2e7/0x400 net/ipv4/inet\_diag.c:1343
sock\_diag\_rcv\_msg+0x24a/0x620
netlink\_rcv\_skb+0x447/0x800 net/netlink/af\_netlink.c:2491
sock\_diag\_rcv+0x63/0x80 net/core/sock\_diag.c:276
netlink\_unicast\_kernel net/netlink/af\_netlink.c:1319 [inline]
netlink\_unicast+0x1095/0x1360 net/netlink/af\_netlink.c:1345
netlink\_sendmsg+0x16f3/0x1870 net/netlink/af\_netlink.c:1916
sock\_sendmsg\_nosec net/socket.c:704 [inline]
sock\_sendmsg net/socket.c:724 [inline]
sock\_write\_iter+0x594/0x690 net/socket.c:1057
do\_iter\_readv\_writev+0xa7f/0xc70
do\_iter\_write+0x52c/0x1500 fs/read\_write.c:851
vfs\_writev fs/read\_write.c:924 [inline]
do\_writev+0x63f/0xe30 fs/read\_write.c:967
\_\_do\_sys\_writev fs/read\_write.c:1040 [inline]
\_\_se\_sys\_writev fs/read\_write.c:1037 [inline]
\_\_x64\_sys\_writev+0xe5/0x120 fs/read\_write.c:1037
do\_syscall\_x64 arch/x86/entry/common.c:51 [inline]
do\_syscall\_64+0x54/0xd0 arch/x86/entry/common.c:82
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Bytes 68-71 of 312 are uninitialized
Memory access of size 312 starts at ffff88812ab54000
Data copied to user address 0000000020001440
CPU: 1 PID: 6365 Comm: syz-executor801 Not tainted 5.16.0-rc3-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Fixes: 3c4d05c80567 ("inet\_diag: Introduce the inet socket dumping routine")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Link: https://lore.kernel.org/r/20211209185058.53917-1-eric.dumazet@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit f6deae2e2d83bd267e1986f5d71d8c458e18fd99
Author: Eric Dumazet
Date: Fri Dec 10 06:20:46 2021 -0800
sch\_cake: do not call cake\_destroy() from cake\_init()
[ Upstream commit ab443c53916730862cec202078d36fd4008bea79 ]
qdiscs are not supposed to call their own destroy() method
from init(), because core stack already does that.
syzbot was able to trigger use after free:
DEBUG\_LOCKS\_WARN\_ON(lock->magic != lock)
WARNING: CPU: 0 PID: 21902 at kernel/locking/mutex.c:586 \_\_mutex\_lock\_common kernel/locking/mutex.c:586 [inline]
WARNING: CPU: 0 PID: 21902 at kernel/locking/mutex.c:586 \_\_mutex\_lock+0x9ec/0x12f0 kernel/locking/mutex.c:740
Modules linked in:
CPU: 0 PID: 21902 Comm: syz-executor189 Not tainted 5.16.0-rc4-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
RIP: 0010:\_\_mutex\_lock\_common kernel/locking/mutex.c:586 [inline]
RIP: 0010:\_\_mutex\_lock+0x9ec/0x12f0 kernel/locking/mutex.c:740
Code: 08 84 d2 0f 85 19 08 00 00 8b 05 97 38 4b 04 85 c0 0f 85 27 f7 ff ff 48 c7 c6 20 00 ac 89 48 c7 c7 a0 fe ab 89 e8 bf 76 ba ff <0f> 0b e9 0d f7 ff ff 48 8b 44 24 40 48 8d b8 c8 08 00 00 48 89 f8
RSP: 0018:ffffc9000627f290 EFLAGS: 00010282
RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000
RDX: ffff88802315d700 RSI: ffffffff815f1db8 RDI: fffff52000c4fe44
RBP: ffff88818f28e000 R08: 0000000000000000 R09: 0000000000000000
R10: ffffffff815ebb5e R11: 0000000000000000 R12: 0000000000000000
R13: dffffc0000000000 R14: ffffc9000627f458 R15: 0000000093c30000
FS: 0000555556abc400(0000) GS:ffff8880b9c00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007fda689c3303 CR3: 000000001cfbb000 CR4: 0000000000350ef0
Call Trace:
tcf\_chain0\_head\_change\_cb\_del+0x2e/0x3d0 net/sched/cls\_api.c:810
tcf\_block\_put\_ext net/sched/cls\_api.c:1381 [inline]
tcf\_block\_put\_ext net/sched/cls\_api.c:1376 [inline]
tcf\_block\_put+0xbc/0x130 net/sched/cls\_api.c:1394
cake\_destroy+0x3f/0x80 net/sched/sch\_cake.c:2695
qdisc\_create.constprop.0+0x9da/0x10f0 net/sched/sch\_api.c:1293
tc\_modify\_qdisc+0x4c5/0x1980 net/sched/sch\_api.c:1660
rtnetlink\_rcv\_msg+0x413/0xb80 net/core/rtnetlink.c:5571
netlink\_rcv\_skb+0x153/0x420 net/netlink/af\_netlink.c:2496
netlink\_unicast\_kernel net/netlink/af\_netlink.c:1319 [inline]
netlink\_unicast+0x533/0x7d0 net/netlink/af\_netlink.c:1345
netlink\_sendmsg+0x904/0xdf0 net/netlink/af\_netlink.c:1921
sock\_sendmsg\_nosec net/socket.c:704 [inline]
sock\_sendmsg+0xcf/0x120 net/socket.c:724
\_\_\_\_sys\_sendmsg+0x6e8/0x810 net/socket.c:2409
\_\_\_sys\_sendmsg+0xf3/0x170 net/socket.c:2463
\_\_sys\_sendmsg+0xe5/0x1b0 net/socket.c:2492
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x35/0xb0 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f1bb06badb9
Code: Unable to access opcode bytes at RIP 0x7f1bb06bad8f.
RSP: 002b:00007fff3012a658 EFLAGS: 00000246 ORIG\_RAX: 000000000000002e
RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 00007f1bb06badb9
RDX: 0000000000000000 RSI: 00000000200007c0 RDI: 0000000000000003
RBP: 0000000000000000 R08: 0000000000000003 R09: 0000000000000003
R10: 0000000000000003 R11: 0000000000000246 R12: 00007fff3012a688
R13: 00007fff3012a6a0 R14: 00007fff3012a6e0 R15: 00000000000013c2

Fixes: 046f6fd5daef ("sched: Add Common Applications Kept Enhanced (cake) qdisc")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Acked-by: Toke HÃ¸iland-JÃ¸rgensen
Link: https://lore.kernel.org/r/20211210142046.698336-1-eric.dumazet@gmail.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit cc851898751d518322e3768ddb741b8fc7bdc76b
Author: Philipp Rudo
Date: Wed Dec 8 14:07:41 2021 +0100
s390/kexec\_file: fix error handling when applying relocations
[ Upstream commit 41967a37b8eedfee15b81406a9f3015be90d3980 ]
arch\_kexec\_apply\_relocations\_add currently ignores all errors returned
by arch\_kexec\_do\_relocs. This means that every unknown relocation is
silently skipped causing unpredictable behavior while the relocated code
runs. Fix this by checking for errors and fail kexec\_file\_load if an
unknown relocation type is encountered.
The problem was found after gcc changed its behavior and used
R\_390\_PLT32DBL relocations for brasl instruction and relied on ld to
resolve the relocations in the final link in case direct calls are
possible. As the purgatory code is only linked partially (option -r)
ld didn't resolve the relocations leaving them for arch\_kexec\_do\_relocs.
But arch\_kexec\_do\_relocs doesn't know how to handle R\_390\_PLT32DBL
relocations so they were silently skipped. This ultimately caused an
endless loop in the purgatory as the brasl instructions kept branching
to itself.
Fixes: 71406883fd35 ("s390/kexec\_file: Add kexec\_file\_load system call")
Reported-by: Tao Liu
Signed-off-by: Philipp Rudo
Link: https://lore.kernel.org/r/20211208130741.5821-3-prudo@redhat.com
Signed-off-by: Heiko Carstens
Signed-off-by: Sasha Levin
commit b0eb9ac9ddc37d1332fb78e4e43e2466c0c69b66
Author: Jie2x Zhou
Date: Thu Dec 9 10:02:30 2021 +0800
selftests: net: Correct ping6 expected rc from 2 to 1
[ Upstream commit 92816e2629808726af015c7f5b14adc8e4f8b147 ]
./fcnal-test.sh -v -t ipv6\_ping
TEST: ping out, VRF bind - ns-B IPv6 LLA [FAIL]
TEST: ping out, VRF bind - multicast IP [FAIL]
ping6 is failing as it should.
COMMAND: ip netns exec ns-A /bin/ping6 -c1 -w1 fe80::7c4c:bcff:fe66:a63a%red
strace of ping6 shows it is failing with '1',
so change the expected rc from 2 to 1.
Fixes: c0644e71df33 ("selftests: Add ipv6 ping tests to fcnal-test")
Reported-by: kernel test robot
Suggested-by: David Ahern
Signed-off-by: Jie2x Zhou
Link: https://lore.kernel.org/r/20211209020230.37270-1-jie2x.zhou@intel.com
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit 9ff66e9ceefcc8e626eb64b03b7b7f60043bf09e
Author: Javier Martinez Canillas
Date: Wed Oct 20 18:57:40 2021 +0200
Revert "drm/fb-helper: improve DRM fbdev emulation device names"
[ Upstream commit 842470c4e211f284a224842849b1fa81b130c154 ]
This reverts commit b3484d2b03e4c940a9598aa841a52d69729c582a.
That change attempted to improve the DRM drivers fbdev emulation device
names to avoid having confusing names like "simpledrmdrmfb" in /proc/fb.
But unfortunately, there are user-space programs such as pm-utils that
match against the fbdev names and so broke after the mentioned commit.
Since the names in /proc/fb are used by tools that consider it an uAPI,
let's restore the old names even when this lead to silly names like the
one mentioned above.
Fixes: b3484d2b03e4 ("drm/fb-helper: improve DRM fbdev emulation device names")
Reported-by: Johannes Stezenbach
Signed-off-by: Javier Martinez Canillas
Reviewed-by: Ville SyrjÃ¤lÃ¤
Link: https://patchwork.freedesktop.org/patch/msgid/20211020165740.3011927-1-javierm@redhat.com
Signed-off-by: Sasha Levin
commit 03b5d9d618a6a64c1794bc0e9674c246f635631a
Author: Parav Pandit
Date: Tue Nov 30 06:29:49 2021 +0200
vdpa: Consider device id larger than 31
[ Upstream commit bb47620be322c5e9e372536cb6b54e17b3a00258 ]
virtio device id value can be more than 31. Hence, use BIT\_ULL in
assignment.
Fixes: 33b347503f01 ("vdpa: Define vdpa mgmt device, ops and a netlink interface")
Reported-by: kernel test robot
Reported-by: Dan Carpenter
Signed-off-by: Parav Pandit
Acked-by: Jason Wang
Link: https://lore.kernel.org/r/20211130042949.88958-1-parav@nvidia.com
Signed-off-by: Michael S. Tsirkin
Signed-off-by: Sasha Levin
commit 091b84437a82bd3c5260d47612849bf22440232e
Author: Wei Wang
Date: Thu Nov 25 20:18:23 2021 -0500
virtio/vsock: fix the transport to work with VMADDR\_CID\_ANY
[ Upstream commit 1db8f5fc2e5c66a5c51e1f6488e0ba7d45c29ae4 ]
The VMADDR\_CID\_ANY flag used by a socket means that the socket isn't bound
to any specific CID. For example, a host vsock server may want to be bound
with VMADDR\_CID\_ANY, so that a guest vsock client can connect to the host
server with CID=VMADDR\_CID\_HOST (i.e. 2), and meanwhile, a host vsock
client can connect to the same local server with CID=VMADDR\_CID\_LOCAL
(i.e. 1).
The current implementation sets the destination socket's svm\_cid to a
fixed CID value after the first client's connection, which isn't an
expected operation. For example, if the guest client first connects to the
host server, the server's svm\_cid gets set to VMADDR\_CID\_HOST, then other
host clients won't be able to connect to the server anymore.
Reproduce steps:
1. Run the host server:
socat VSOCK-LISTEN:1234,fork -
2. Run a guest client to connect to the host server:
socat - VSOCK-CONNECT:2:1234
3. Run a host client to connect to the host server:
socat - VSOCK-CONNECT:1:1234
Without this patch, step 3. above fails to connect, and socat complains
"socat[1720] E connect(5, AF=40 cid:1 port:1234, 16): Connection
reset by peer".
With this patch, the above works well.
Fixes: c0cfa2d8a788 ("vsock: add multi-transports support")
Signed-off-by: Wei Wang
Link: https://lore.kernel.org/r/20211126011823.1760-1-wei.w.wang@intel.com
Signed-off-by: Michael S. Tsirkin
Reviewed-by: Stefano Garzarella
Signed-off-by: Sasha Levin
commit 149a4d12c44bec3bfff2d6d7bc7d752b2f61cbd9
Author: Arnd Bergmann
Date: Mon Dec 6 09:50:18 2021 +0100
virtio: always enter drivers/virtio/
[ Upstream commit 27d9839f17940e8edc475df616bbd9cf7ede8d05 ]
When neither VIRTIO\_PCI\_LIB nor VIRTIO are enabled, but the alibaba
vdpa driver is, the kernel runs into a link error because the legacy
virtio module never gets built:
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_set\_features':
eni\_vdpa.c:(.text+0x23f): undefined reference to `vp\_legacy\_set\_features'
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_set\_vq\_state':
eni\_vdpa.c:(.text+0x2fe): undefined reference to `vp\_legacy\_get\_queue\_enable'
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_set\_vq\_address':
eni\_vdpa.c:(.text+0x376): undefined reference to `vp\_legacy\_set\_queue\_address'
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_set\_vq\_ready':
eni\_vdpa.c:(.text+0x3b4): undefined reference to `vp\_legacy\_set\_queue\_address'
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_free\_irq':
eni\_vdpa.c:(.text+0x460): undefined reference to `vp\_legacy\_queue\_vector'
x86\_64-linux-ld: eni\_vdpa.c:(.text+0x4b7): undefined reference to `vp\_legacy\_config\_vector'
x86\_64-linux-ld: drivers/vdpa/alibaba/eni\_vdpa.o: in function `eni\_vdpa\_reset':
When VIRTIO\_PCI\_LIB was added, it was correctly added to drivers/Makefile
as well, but for the legacy module, this is missing. Solve this by always
entering drivers/virtio during the build and letting its Makefile take
care of the individual options, rather than having a separate line for
each sub-option.
Fixes: 64b9f64f80a6 ("vdpa: introduce virtio pci driver")
Fixes: e85087beedca ("eni\_vdpa: add vDPA driver for Alibaba ENI")
Fixes: d89c8169bd70 ("virtio-pci: introduce legacy device module")
Signed-off-by: Arnd Bergmann
Link: https://lore.kernel.org/r/20211206085034.2836099-1-arnd@kernel.org
Signed-off-by: Michael S. Tsirkin
Signed-off-by: Sasha Levin
commit fac85fe13547ebc77168f15a15bc49cd3ec01fe4
Author: Johannes Berg
Date: Fri Dec 3 14:04:24 2021 +0200
iwlwifi: mvm: don't crash on invalid rate w/o STA
[ Upstream commit d599f714b73e4177dfdfe64fce09175568288ee9 ]
If we get to the WARN\_ONCE(..., "Got a HT rate (...)", ...)
here with a NULL sta, then we crash because mvmsta is bad
and we try to dereference it. Fix that by printing -1 as the
state if no station was given.
Signed-off-by: Johannes Berg
Fixes: 6761a718263a ("iwlwifi: mvm: add explicit check for non-data frames in get Tx rate")
Signed-off-by: Luca Coelho
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/iwlwifi.20211203140410.1a1541d7dcb5.I606c746e11447fe168cf046376b70b04e278c3b4@changeid
Signed-off-by: Sasha Levin
commit f295986e5b6deaeac7a240f92e4bb6ec5576ce33
Author: Stephan Gerhold
Date: Mon Dec 6 12:38:28 2021 +0100
soc: imx: Register SoC device only on i.MX boards
[ Upstream commit 4ebd29f91629e69da7d57390cdc953772eee03ab ]
At the moment, using the ARM32 multi\_v7\_defconfig always results in two
SoCs being exposed in sysfs. This is wrong, as far as I'm aware the
Qualcomm DragonBoard 410c does not actually make use of a i.MX SoC. :)
qcom-db410c:/sys/devices/soc0$ grep . \*
family:Freescale i.MX
machine:Qualcomm Technologies, Inc. APQ 8016 SBC
revision:0.0
serial\_number:0000000000000000
soc\_id:Unknown
qcom-db410c:/sys/devices/soc1$ grep . \*
family:Snapdragon
machine:APQ8016
...
This happens because imx\_soc\_device\_init() registers the soc device
unconditionally, even when running on devices that do not make use of i.MX.
Arnd already reported this more than a year ago and even suggested a fix
similar to this commit, but for some reason it was never submitted.
Fix it by checking if the "\_\_mxc\_cpu\_type" variable was actually
initialized by earlier platform code. On devices without i.MX it will
simply stay 0.
Cc: Peng Fan
Fixes: d2199b34871b ("ARM: imx: use device\_initcall for imx\_soc\_device\_init")
Reported-by: Arnd Bergmann
Link: https://lore.kernel.org/r/CAK8P3a0hxO1TmK6oOMQ70AHSWJnP\_CAq57YMOutrxkSYNjFeuw@mail.gmail.com/
Signed-off-by: Stephan Gerhold
Reviewed-by: Fabio Estevam
Reviewed-by: Peng Fan
Signed-off-by: Shawn Guo
Signed-off-by: Sasha Levin
commit ad4adbbf666e8f7f7c636f0fdf50f8ab06cef4a1
Author: Mike Tipton
Date: Mon Nov 8 20:34:38 2021 -0800
clk: Don't parent clks until the parent is fully registered
[ Upstream commit 54baf56eaa40aa5cdcd02b3c20d593e4e1211220 ]
Before commit fc0c209c147f ("clk: Allow parents to be specified without
string names") child clks couldn't find their parent until the parent
clk was added to a list in \_\_clk\_core\_init(). After that commit, child
clks can reference their parent clks directly via a clk\_hw pointer, or
they can lookup that clk\_hw pointer via DT if the parent clk is
registered with an OF clk provider.
The common clk framework treats hw->core being non-NULL as "the clk is
registered" per the logic within clk\_core\_fill\_parent\_index():
parent = entry->hw->core;
/\*
\* We have a direct reference but it isn't registered yet?
\* Orphan it and let clk\_reparent() update the orphan status
\* when the parent is registered.
\*/
if (!parent)
Therefore we need to be extra careful to not set hw->core until the clk
is fully registered with the clk framework. Otherwise we can get into a
situation where a child finds a parent clk and we move the child clk off
the orphan list when the parent isn't actually registered, wrecking our
enable accounting and breaking critical clks.
Consider the following scenario:
CPU0 CPU1
---- ----
struct clk\_hw clkBad;
struct clk\_hw clkA;
clkA.init.parent\_hws = { &clkBad };
clk\_hw\_register(&clkA) clk\_hw\_register(&clkBad)
... \_\_clk\_register()
hw->core = core
...
\_\_clk\_register()
\_\_clk\_core\_init()
clk\_prepare\_lock()
\_\_clk\_init\_parent()
clk\_core\_get\_parent\_by\_index()
clk\_core\_fill\_parent\_index()
if (entry->hw) {
parent = entry->hw->core;
At this point, 'parent' points to clkBad even though clkBad hasn't been
fully registered yet. Ouch! A similar problem can happen if a clk
controller registers orphan clks that are referenced in the DT node of
another clk controller.
Let's fix all this by only setting the hw->core pointer underneath the
clk prepare lock in \_\_clk\_core\_init(). This way we know that
clk\_core\_fill\_parent\_index() can't see hw->core be non-NULL until the
clk is fully registered.
Fixes: fc0c209c147f ("clk: Allow parents to be specified without string names")
Signed-off-by: Mike Tipton
Link: https://lore.kernel.org/r/20211109043438.4639-1-quic\_mdtipton@quicinc.com
[sboyd@kernel.org: Reword commit text, update comment]
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit d058c136fe3d5bc0ae797531b8d788d3a0184664
Author: Martin Kepplinger
Date: Wed Nov 24 09:37:03 2021 +0100
arm64: dts: imx8mq: remove interconnect property from lcdif
[ Upstream commit e5e6268f77badf18bd6ab435364cfe21c7396c31 ]
The mxsfb driver handling imx8mq lcdif doesn't yet request the
interconnect bandwidth that's needed at runtime when the description is
present in the DT node.
So remove that description and bring it back when it's supported.
Fixes: ad1abc8a03fd ("arm64: dts: imx8mq: Add interconnect for lcdif")
Signed-off-by: Martin Kepplinger
Signed-off-by: Shawn Guo
Signed-off-by: Sasha Levin
commit f580a4315062870dd1ad9676f3bada01db0536af
Author: Dinh Nguyen
Date: Mon Nov 1 19:36:30 2021 -0500
ARM: socfpga: dts: fix qspi node compatible
[ Upstream commit cb25b11943cbcc5a34531129952870420f8be858 ]
The QSPI flash node needs to have the required "jedec,spi-nor" in the
compatible string.
Fixes: 1df99da8953 ("ARM: dts: socfpga: Enable QSPI in Arria10 devkit")
Signed-off-by: Dinh Nguyen
Signed-off-by: Sasha Levin
commit e7506c76b7ef072df9d42df77fe73deb4b85ec26
Author: Xiubo Li
Date: Tue Nov 30 19:20:34 2021 +0800
ceph: initialize pathlen variable in reconnect\_caps\_cb
[ Upstream commit ee2a095d3b24f300a5e11944d208801e928f108c ]
The smatch static checker warned about an uninitialized symbol usage in
this function, in the case where ceph\_mdsc\_build\_path returns an error.
It turns out that that case is harmless, but it just looks sketchy.
Initialize the variable at declaration time, and remove the unneeded
setting of it later.
Fixes: a33f6432b3a6 ("ceph: encode inodes' parent/d\_name in cap reconnect message")
Reported-by: Dan Carpenter
Signed-off-by: Xiubo Li
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit 24a19e6d6518e15c4e0cb97c32dd7c568c0f5564
Author: Hu Weiwen
Date: Mon Nov 22 22:22:12 2021 +0800
ceph: fix duplicate increment of opened\_inodes metric
[ Upstream commit 973e5245637accc4002843f6b888495a6a7762bc ]
opened\_inodes is incremented twice when the same inode is opened twice
with O\_RDONLY and O\_WRONLY respectively.
To reproduce, run this python script, then check the metrics:
import os
for \_ in range(10000):
fd\_r = os.open('a', os.O\_RDONLY)
fd\_w = os.open('a', os.O\_WRONLY)
os.close(fd\_r)
os.close(fd\_w)
Fixes: 1dd8d4708136 ("ceph: metrics for opened files, pinned caps and opened inodes")
Signed-off-by: Hu Weiwen
Reviewed-by: Xiubo Li
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit 832f3655c6138c23576ed268e31cc76e0f05f2b1
Author: Dan Carpenter
Date: Wed Nov 24 17:54:04 2021 +0300
tee: amdtee: fix an IS\_ERR() vs NULL bug
[ Upstream commit 9d7482771fac8d8e38e763263f2ca0ca12dd22c6 ]
The \_\_get\_free\_pages() function does not return error pointers it returns
NULL so fix this condition to avoid a NULL dereference.
Fixes: 757cc3e9ff1d ("tee: add AMD-TEE driver")
Signed-off-by: Dan Carpenter
Acked-by: Rijo Thomas
Signed-off-by: Jens Wiklander
Signed-off-by: Sasha Levin
commit 42d08e97b196479f593499e887a9ab81446a34b9
Author: Johannes Berg
Date: Mon Nov 22 12:47:40 2021 +0100
mac80211: track only QoS data frames for admission control
[ Upstream commit d5e568c3a4ec2ddd23e7dc5ad5b0c64e4f22981a ]
For admission control, obviously all of that only works for
QoS data frames, otherwise we cannot even access the QoS
field in the header.
Syzbot reported (see below) an uninitialized value here due
to a status of a non-QoS nullfunc packet, which isn't even
long enough to contain the QoS header.
Fix this to only do anything for QoS data packets.
Reported-by: syzbot+614e82b88a1a4973e534@syzkaller.appspotmail.com
Fixes: 02219b3abca5 ("mac80211: add WMM admission control support")
Link: https://lore.kernel.org/r/20211122124737.dad29e65902a.Ieb04587afacb27c14e0de93ec1bfbefb238cc2a0@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Sasha Levin
commit b08767936841fc1737a59a02e667b5b90d8155ee
Author: Dave Jiang
Date: Wed Nov 17 10:03:51 2021 -0700
dmaengine: idxd: fix calling wq quiesce inside spinlock
[ Upstream commit fa51b16d05583c7aebbc06330afb50276243d198 ]
Dan reports that smatch has found idxd\_wq\_quiesce() is being called inside
the idxd->dev\_lock. idxd\_wq\_quiesce() calls wait\_for\_completion() and
therefore it can sleep. Move the call outside of the spinlock as it does
not need device lock.
Fixes: 5b0c68c473a1 ("dmaengine: idxd: support reporting of halt interrupt")
Reported-by: Dan Carpenter
Signed-off-by: Dave Jiang
Link: https://lore.kernel.org/r/163716858508.1721911.15051495873516709923.stgit@djiang5-desk3.ch.intel.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit 05d2cc973cf5225fe542494ef4ac1bc2537a1eef
Author: Dave Jiang
Date: Wed Sep 8 16:04:03 2021 -0700
dmaengine: idxd: add halt interrupt support
[ Upstream commit 88d97ea82cbe352851a8654ee952d3a694c8c2c6 ]
Add halt interrupt support. Given that the misc interrupt handler already
check halt state, the driver just need to run the halt handling code when
receiving the halt interrupt.
Signed-off-by: Dave Jiang
Link: https://lore.kernel.org/r/163114224352.846654.14334468363464318828.stgit@djiang5-desk3.ch.intel.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit f2aebdaa3d3caf2f0bc4991188128cb017fb473a
Author: Florian Klink
Date: Wed Oct 20 11:59:23 2021 +0200
arm64: dts: rockchip: fix poweroff on helios64
[ Upstream commit aef4b9a89a376a9cabe5e744729914e7766c59bb ]
Adding the rockchip,system-power-controller property here will use the
rk808 to power off the system.
Fixes: 09e006cfb43e ("arm64: dts: rockchip: Add basic support for Kobol's Helios64")
Signed-off-by: Florian Klink
Tested-by: Dennis Gilmore
Link: https://lore.kernel.org/r/20211020095926.735938-2-flokli@flokli.de
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit d4218b2803dea0bbd304ae8043954ac361fa2a10
Author: Alex Bee
Date: Wed Oct 27 16:37:25 2021 +0200
arm64: dts: rockchip: fix audio-supply for Rock Pi 4
[ Upstream commit 8240e87f16d17a9592c9d67857a3dcdbcb98f10d ]
As stated in the schematics [1] and [2] P5 the APIO5 domain is supplied
by RK808-D Buck4, which in our case vcc1v8\_codec - i.e. a 1.8 V regulator.
Currently only white noise comes from the ES8316's output, which - for
whatever reason - came up only after the the correct switch from i2s0\_8ch\_bus
to i2s0\_2ch\_bus for i2s0's pinctrl was done.
Fix this by setting the correct regulator for audio-supply.
[1] https://dl.radxa.com/rockpi4/docs/hw/rockpi4/rockpi4\_v13\_sch\_20181112.pdf
[2] https://dl.radxa.com/rockpi4/docs/hw/rockpi4/rockpi\_4c\_v12\_sch\_20200620.pdf
Fixes: 1b5715c602fd ("arm64: dts: rockchip: add ROCK Pi 4 DTS support")
Signed-off-by: Alex Bee
Link: https://lore.kernel.org/r/20211027143726.165809-1-knaerzche@gmail.com
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit 77eb455febc5e9b56e75d21f0ee88d9c3cfbb49e
Author: John Keeping
Date: Tue Nov 2 18:29:08 2021 +0000
arm64: dts: rockchip: fix rk3399-leez-p710 vcc3v3-lan supply
[ Upstream commit 2b454a90e2ccdd6e03f88f930036da4df577be76 ]
Correct a typo in the vin-supply property. The input supply is
always-on, so this mistake doesn't affect whether the supply is actually
enabled correctly.
Fixes: fc702ed49a86 ("arm64: dts: rockchip: Add dts for Leez RK3399 P710 SBC")
Signed-off-by: John Keeping
Link: https://lore.kernel.org/r/20211102182908.3409670-3-john@metanate.com
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit e2daa0c9e898c4a07436c6e9a910f1148c143207
Author: John Keeping
Date: Tue Nov 2 18:29:07 2021 +0000
arm64: dts: rockchip: fix rk3308-roc-cc vcc-sd supply
[ Upstream commit 772fb46109f635dd75db20c86b7eaf48efa46cef ]
Correct a typo in the vin-supply property. The input supply is
always-on, so this mistake doesn't affect whether the supply is actually
enabled correctly.
Fixes: 4403e1237be3 ("arm64: dts: rockchip: Add devicetree for board roc-rk3308-cc")
Signed-off-by: John Keeping
Link: https://lore.kernel.org/r/20211102182908.3409670-2-john@metanate.com
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit c2ff001288dd97d6a997cac6b72febdf6e1610fc
Author: Artem Lapkin
Date: Mon Nov 15 16:33:21 2021 +0800
arm64: dts: rockchip: remove mmc-hs400-enhanced-strobe from rk3399-khadas-edge
[ Upstream commit 6dd0053683804427529ef3523f7872f473440a19 ]
Remove mmc-hs400-enhanced-strobe from the rk3399-khadas-edge dts to
improve compatibility with a wider range of eMMC chips.
Before (BJTD4R 29.1 GiB):
[ 7.001493] mmc2: CQHCI version 5.10
[ 7.027971] mmc2: SDHCI controller on fe330000.mmc [fe330000.mmc] using ADMA
.......
[ 7.207086] mmc2: mmc\_select\_hs400es failed, error -110
[ 7.207129] mmc2: error -110 whilst initialising MMC card
[ 7.308893] mmc2: mmc\_select\_hs400es failed, error -110
[ 7.308921] mmc2: error -110 whilst initialising MMC card
[ 7.427524] mmc2: mmc\_select\_hs400es failed, error -110
[ 7.427546] mmc2: error -110 whilst initialising MMC card
[ 7.590993] mmc2: mmc\_select\_hs400es failed, error -110
[ 7.591012] mmc2: error -110 whilst initialising MMC card
After:
[ 6.960785] mmc2: CQHCI version 5.10
[ 6.984672] mmc2: SDHCI controller on fe330000.mmc [fe330000.mmc] using ADMA
[ 7.175021] mmc2: Command Queue Engine enabled
[ 7.175053] mmc2: new HS400 MMC card at address 0001
[ 7.175808] mmcblk2: mmc2:0001 BJTD4R 29.1 GiB
[ 7.176033] mmcblk2boot0: mmc2:0001 BJTD4R 4.00 MiB
[ 7.176245] mmcblk2boot1: mmc2:0001 BJTD4R 4.00 MiB
[ 7.176495] mmcblk2rpmb: mmc2:0001 BJTD4R 4.00 MiB, chardev (242:0)
Fixes: c2aacceedc86 ("arm64: dts: rockchip: Add support for Khadas Edge/Edge-V/Captain boards")
Signed-off-by: Artem Lapkin
Link: https://lore.kernel.org/r/20211115083321.2627461-1-art@khadas.com
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit 8e72fcf9aa9a0bec7f2a394e871be87a97d31aec
Author: Mario Limonciello
Date: Sun Oct 31 20:48:53 2021 -0500
pinctrl: amd: Fix wakeups when IRQ is shared with SCI
commit 2d54067fcd23aae61e23508425ae5b29e973573d upstream.
On some Lenovo AMD Gen2 platforms the IRQ for the SCI and pinctrl drivers
are shared. Due to how the s2idle loop handling works, this case needs
an extra explicit check whether the interrupt was caused by SCI or by
the GPIO controller.
To fix this rework the existing IRQ handler function to function as a
checker and an IRQ handler depending on the calling arguments.
BugLink: https://gitlab.freedesktop.org/drm/amd/-/issues/1738
Reported-by: Joerie de Gram
Signed-off-by: Mario Limonciello
Acked-by: Basavaraj Natikar
Link: https://lore.kernel.org/r/20211101014853.6177-2-mario.limonciello@amd.com
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 78ae328fb170a6fe4eb7206dce8bbfcc8e630053
Author: Ville SyrjÃ¤lÃ¤
Date: Fri Oct 29 22:18:02 2021 +0300
drm/i915/hdmi: Turn DP++ TMDS output buffers back on in encoder->shutdown()
commit cecbc0c7eba7983965cac94f88d2db00b913253b upstream.
Looks like our VBIOS/GOP generally fail to turn the DP dual mode adater
TMDS output buffers back on after a reboot. This leads to a black screen
after reboot if we turned the TMDS output buffers off prior to reboot.
And if i915 decides to do a fastboot the black screen will persist even
after i915 takes over.
Apparently this has been a problem ever since commit b2ccb822d376 ("drm/i915:
Enable/disable TMDS output buffers in DP++ adaptor as needed") if one
rebooted while the display was turned off. And things became worse with
commit fe0f1e3bfdfe ("drm/i915: Shut down displays gracefully on reboot")
since now we always turn the display off before a reboot.
This was reported on a RKL, but I confirmed the same behaviour on my
SNB as well. So looks pretty universal.
Let's fix this by explicitly turning the TMDS output buffers back on
in the encoder->shutdown() hook. Note that this gets called after irqs
have been disabled, so the i2c communication with the DP dual mode
adapter has to be performed via polling (which the gmbus code is
perfectly happy to do for us).
We also need a bit of care in handling DDI encoders which may or may
not be set up for HDMI output. Specifically ddc\_pin will not be
populated for a DP only DDI encoder, in which case we don't want to
call intel\_gmbus\_get\_adapter(). We can handle that by simply doing
the dual mode adapter type check before calling
intel\_gmbus\_get\_adapter().
Cc:  # v5.11+
Fixes: fe0f1e3bfdfe ("drm/i915: Shut down displays gracefully on reboot")
Closes: https://gitlab.freedesktop.org/drm/intel/-/issues/4371
Signed-off-by: Ville SyrjÃ¤lÃ¤
Link: https://patchwork.freedesktop.org/patch/msgid/20211029191802.18448-2-ville.syrjala@linux.intel.com
Reviewed-by: Stanislav Lisovskiy
(cherry picked from commit 49c55f7b035b87371a6d3c53d9af9f92ddc962db)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit 8f50c26fdf6500fad4275fe90bffa46781400315
Author: Jani Nikula
Date: Tue Sep 21 14:02:44 2021 +0300
drm/i915/hdmi: convert intel\_hdmi\_to\_dev to intel\_hdmi\_to\_i915
commit 7ceb751b615900086eed1d65955933923f127d99 upstream.
Prefer i915 over drm pointer.
Reviewed-by: Ville SyrjÃ¤lÃ¤
Signed-off-by: Jani Nikula
Link: https://patchwork.freedesktop.org/patch/msgid/20210921110244.8666-1-jani.nikula@intel.com
Signed-off-by: Greg Kroah-Hartman
commit 4999509a9184f2e34d83e445ee792bb4b46f3a30
Author: Jaegeuk Kim
Date: Fri Oct 1 11:20:14 2021 -0700
scsi: ufs: core: Retry START\_STOP on UNIT\_ATTENTION
commit af21c3fd5b3ec540a97b367a70b26616ff7e0c55 upstream.
Commit 57d104c153d3 ("ufs: add UFS power management support") made the UFS
driver submit a REQUEST SENSE command before submitting a power management
command to a WLUN to clear the POWER ON unit attention. Instead of
submitting a REQUEST SENSE command before submitting a power management
command, retry the power management command until it succeeds.
This is the preparation to get rid of all UNIT ATTENTION code which should
be handled by users.
Link: https://lore.kernel.org/r/20211001182015.1347587-2-jaegeuk@kernel.org
Cc: Adrian Hunter
Reviewed-by: Bart Van Assche
Signed-off-by: Jaegeuk Kim
Signed-off-by: Martin K. Petersen
Signed-off-by: Adrian Hunter
Signed-off-by: Greg Kroah-Hartman
commit af9b9c8bfeee83823852817724b4664254749180
Author: Anand Jain
Date: Thu Dec 16 21:04:13 2021 +0800
btrfs: remove stale comment about the btrfs\_show\_devname
Commit cdccc03a8a369b59cff5e7ea3292511cfa551120 upstream.
There were few lockdep warnings because btrfs\_show\_devname() was using
device\_list\_mutex as recorded in the commits:
0ccd05285e7f ("btrfs: fix a possible umount deadlock")
779bf3fefa83 ("btrfs: fix lock dep warning, move scratch dev out of device\_list\_mutex and uuid\_mutex")
And finally, commit 88c14590cdd6 ("btrfs: use RCU in btrfs\_show\_devname
for device list traversal") removed the device\_list\_mutex from
btrfs\_show\_devname for performance reasons.
This patch removes a stale comment about the function
btrfs\_show\_devname and device\_list\_mutex.
Signed-off-by: Anand Jain
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Anand Jain
Signed-off-by: Greg Kroah-Hartman
commit a6e7e218a4d6488d56727a7d9aee1b7e78c0c485
Author: Anand Jain
Date: Thu Dec 16 21:04:12 2021 +0800
btrfs: update latest\_dev when we create a sprout device
Commit b7cb29e666fe79dda5dbe5f57fb7c92413bf161c upstream.
When we add a device to the seed filesystem (sprouting) it is a new
filesystem (and fsid) on the device added. Update the latest\_dev so
that /proc/self/mounts shows the correct device.
Example:
$ btrfstune -S1 /dev/vg/seed
$ mount /dev/vg/seed /btrfs
mount: /btrfs: WARNING: device write-protected, mounted read-only.
$ cat /proc/self/mounts | grep btrfs
/dev/mapper/vg-seed /btrfs btrfs ro,relatime,space\_cache,subvolid=5,subvol=/ 0 0
$ btrfs dev add -f /dev/vg/new /btrfs
Before:
$ cat /proc/self/mounts | grep btrfs
/dev/mapper/vg-seed /btrfs btrfs ro,relatime,space\_cache,subvolid=5,subvol=/ 0 0
After:
$ cat /proc/self/mounts | grep btrfs
/dev/mapper/vg-new /btrfs btrfs ro,relatime,space\_cache,subvolid=5,subvol=/ 0 0
Tested-by: Su Yue
Signed-off-by: Anand Jain
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Anand Jain
Signed-off-by: Greg Kroah-Hartman
commit e342c2558016ead462f376b6c6c2ac5efc17f3b1
Author: Anand Jain
Date: Thu Dec 16 21:04:11 2021 +0800
btrfs: use latest\_dev in btrfs\_show\_devname
Commit 6605fd2f394bba0a0059df2b6cfc87b0b6d393a2 upstream.
The test case btrfs/238 reports the warning below:
WARNING: CPU: 3 PID: 481 at fs/btrfs/super.c:2509 btrfs\_show\_devname+0x104/0x1e8 [btrfs]
CPU: 2 PID: 1 Comm: systemd Tainted: G W O 5.14.0-rc1-custom #72
Hardware name: QEMU QEMU Virtual Machine, BIOS 0.0.0 02/06/2015
Call trace:
btrfs\_show\_devname+0x108/0x1b4 [btrfs]
show\_mountinfo+0x234/0x2c4
m\_show+0x28/0x34
seq\_read\_iter+0x12c/0x3c4
vfs\_read+0x29c/0x2c8
ksys\_read+0x80/0xec
\_\_arm64\_sys\_read+0x28/0x34
invoke\_syscall+0x50/0xf8
do\_el0\_svc+0x88/0x138
el0\_svc+0x2c/0x8c
el0t\_64\_sync\_handler+0x84/0xe4
el0t\_64\_sync+0x198/0x19c
Reason:
While btrfs\_prepare\_sprout() moves the fs\_devices::devices into
fs\_devices::seed\_list, the btrfs\_show\_devname() searches for the devices
and found none, leading to the warning as in above.
Fix:
latest\_dev is updated according to the changes to the device list.
That means we could use the latest\_dev->name to show the device name in
/proc/self/mounts, the pointer will be always valid as it's assigned
before the device is deleted from the list in remove or replace.
The RCU protection is sufficient as the device structure is freed after
synchronization.
Reported-by: Su Yue
Tested-by: Su Yue
Signed-off-by: Anand Jain
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Anand Jain
Signed-off-by: Greg Kroah-Hartman
commit 5c460192c2fa44787d2f9dd81fcdd64c0a39de18
Author: Anand Jain
Date: Thu Dec 16 21:04:10 2021 +0800
btrfs: convert latest\_bdev type to btrfs\_device and rename
Commit d24fa5c1da08026be9959baca309fa0adf8708bf upstream.
In preparation to fix a bug in btrfs\_show\_devname().
Convert fs\_devices::latest\_bdev type from struct block\_device to struct
btrfs\_device and, rename the member to fs\_devices::latest\_dev.
So that btrfs\_show\_devname() can use fs\_devices::latest\_dev::name.
Tested-by: Su Yue
Signed-off-by: Anand Jain
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Anand Jain
Signed-off-by: Greg Kroah-Hartman
commit a5f4d17daf2e6cd7c1d9676b476147f6b4ac53f2
Author: Paul Moore
Date: Thu Dec 9 11:46:07 2021 -0500
audit: improve robustness of the audit queue handling
commit f4b3ee3c85551d2d343a3ba159304066523f730f upstream.
If the audit daemon were ever to get stuck in a stopped state the
kernel's kauditd\_thread() could get blocked attempting to send audit
records to the userspace audit daemon. With the kernel thread
blocked it is possible that the audit queue could grow unbounded as
certain audit record generating events must be exempt from the queue
limits else the system enter a deadlock state.
This patch resolves this problem by lowering the kernel thread's
socket sending timeout from MAX\_SCHEDULE\_TIMEOUT to HZ/10 and tweaks
the kauditd\_send\_queue() function to better manage the various audit
queues when connection problems occur between the kernel and the
audit daemon. With this patch, the backlog may temporarily grow
beyond the defined limits when the audit daemon is stopped and the
system is under heavy audit pressure, but kauditd\_thread() will
continue to make progress and drain the queues as it would for other
connection problems. For example, with the audit daemon put into a
stopped state and the system configured to audit every syscall it
was still possible to shutdown the system without a kernel panic,
deadlock, etc.; granted, the system was slow to shutdown but that is
to be expected given the extreme pressure of recording every syscall.
The timeout value of HZ/10 was chosen primarily through
experimentation and this developer's "gut feeling". There is likely
no one perfect value, but as this scenario is limited in scope (root
privileges would be needed to send SIGSTOP to the audit daemon), it
is likely not worth exposing this as a tunable at present. This can
always be done at a later date if it proves necessary.
Cc: stable@vger.kernel.org
Fixes: 5b52330bbfe63 ("audit: fix auditd/kernel connection state tracking")
Reported-by: Gaosheng Cui
Tested-by: Gaosheng Cui
Reviewed-by: Richard Guy Briggs
Signed-off-by: Paul Moore
Signed-off-by: Greg Kroah-Hartman
commit 607beb420b3fe23b948a9bf447d993521a02fbbb
Author: Joe Thornber
Date: Wed Nov 24 12:07:39 2021 -0500
dm btree remove: fix use after free in rebalance\_children()
commit 1b8d2789dad0005fd5e7d35dab26a8e1203fb6da upstream.
Move dm\_tm\_unlock() after dm\_tm\_dec().
Cc: stable@vger.kernel.org
Signed-off-by: Joe Thornber
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 09cdb8aa590473672ccd404c16ed4e388b3227d5
Author: Christian Brauner
Date: Mon Nov 29 12:16:39 2021 +0100
ceph: fix up non-directory creation in SGID directories
commit fd84bfdddd169c219c3a637889a8b87f70a072c2 upstream.
Ceph always inherits the SGID bit if it is set on the parent inode,
while the generic inode\_init\_owner does not do this in a few cases where
it can create a possible security problem (cf. [1]).
Update ceph to strip the SGID bit just as inode\_init\_owner would.
This bug was detected by the mapped mount testsuite in [3]. The
testsuite tests all core VFS functionality and semantics with and
without mapped mounts. That is to say it functions as a generic VFS
testsuite in addition to a mapped mount testsuite. While working on
mapped mount support for ceph, SIGD inheritance was the only failing
test for ceph after the port.
The same bug was detected by the mapped mount testsuite in XFS in
January 2021 (cf. [2]).
[1]: commit 0fa3ecd87848 ("Fix up non-directory creation in SGID directories")
[2]: commit 01ea173e103e ("xfs: fix up non-directory creation in SGID directories")
[3]: https://git.kernel.org/fs/xfs/xfstests-dev.git
Cc: stable@vger.kernel.org
Signed-off-by: Christian Brauner
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Greg Kroah-Hartman
commit 2c7a616145aaa81aac4bc9d85c9e9a8318ccc03d
Author: Mathew McBride
Date: Mon Nov 22 02:55:54 2021 +0000
arm64: dts: ten64: remove redundant interrupt declaration for gpio-keys
commit c88c5e461939a06ae769a01649d5c6b5a156f883 upstream.
gpio-keys already 'inherits' the interrupts from the controller
of the specified GPIO, so having another declaration is redundant.
On >=v5.15 this started causing an oops under gpio\_keys\_probe as
the IRQ was already claimed.
Signed-off-by: Mathew McBride
Fixes: 418962eea358 ("arm64: dts: add device tree for Traverse Ten64 (LS1088A)")
Cc: stable@vger.kernel.org
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit ab2ba2dd711fc61b9176a7d34bac2f2ed13b11ca
Author: Jerome Marchand
Date: Fri Dec 10 10:38:27 2021 +0100
recordmcount.pl: look for jgnop instruction as well as bcrl on s390
commit 85bf17b28f97ca2749968d8786dc423db320d9c2 upstream.
On s390, recordmcount.pl is looking for "bcrl 0," instructions in
the objdump -d outpout. However since binutils 2.37, objdump -d
display "jgnop " for the same instruction. Update the
mcount\_regex so that it accepts both.
Signed-off-by: Jerome Marchand
Reviewed-by: Miroslav Benes
Acked-by: Steven Rostedt (VMware)
Cc:
Link: https://lore.kernel.org/r/20211210093827.1623286-1-jmarchan@redhat.com
Signed-off-by: Heiko Carstens
Signed-off-by: Greg Kroah-Hartman
commit 2eeff00926e572e4ddb7f40f2fc452abb1a4c7d4
Author: Sven Schnelle
Date: Mon Dec 6 11:50:16 2021 +0100
s390/entry: fix duplicate tracking of irq nesting level
commit c9b12b59e2ea4c3c7cedec7efb071b649652f3a9 upstream.
In the current code, when exiting from idle, rcu\_irq\_enter() is
called twice during irq entry:
irq\_entry\_enter()-> rcu\_irq\_enter()
irq\_enter() -> rcu\_irq\_enter()
This may lead to wrong results from rcu\_is\_cpu\_rrupt\_from\_idle()
because of a wrong dynticks nmi nesting count. Fix this by only
calling irq\_enter\_rcu().
Cc:  # 5.12+
Reported-by: Mark Rutland
Fixes: 56e62a737028 ("s390: convert to generic entry")
Signed-off-by: Sven Schnelle
Signed-off-by: Heiko Carstens
Signed-off-by: Greg Kroah-Hartman
commit b08b3bfcc720686cd73888ab20111acd9cbfcb19
Author: Dan Carpenter
Date: Wed Dec 8 13:33:37 2021 +0300
vdpa: check that offsets are within bounds
commit 3ed21c1451a14d139e1ceb18f2fa70865ce3195a upstream.
In this function "c->off" is a u32 and "size" is a long. On 64bit systems
if "c->off" is greater than "size" then "size - c->off" is a negative and
we always return -E2BIG. But on 32bit systems the subtraction is type
promoted to a high positive u32 value and basically any "c->len" is
accepted.
Fixes: 4c8cf31885f6 ("vhost: introduce vDPA-based backend")
Reported-by: Xie Yongji
Signed-off-by: Dan Carpenter
Link: https://lore.kernel.org/r/20211208103337.GA4047@kili
Signed-off-by: Michael S. Tsirkin
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 0c51663c77d21f78866cb36abccb59419c32e102
Author: Will Deacon
Date: Wed Dec 1 11:20:18 2021 +0000
virtio\_ring: Fix querying of maximum DMA mapping size for virtio device
commit 817fc978b5a29b039db0418a91072b31c9aab152 upstream.
virtio\_max\_dma\_size() returns the maximum DMA mapping size of the virtio
device by querying dma\_max\_mapping\_size() for the device when the DMA
API is in use for the vring. Unfortunately, the device passed is
initialised by register\_virtio\_device() and does not inherit the DMA
configuration from its parent, resulting in SWIOTLB errors when bouncing
is enabled and the default 256K mapping limit (IO\_TLB\_SEGSIZE) is not
respected:
| virtio-pci 0000:00:01.0: swiotlb buffer is full (sz: 294912 bytes), total 1024 (slots), used 725 (slots)
Follow the pattern used elsewhere in the virtio\_ring code when calling
into the DMA layer and pass the parent device to dma\_max\_mapping\_size()
instead.
Cc: Marc Zyngier
Cc: Quentin Perret
Cc: "Michael S. Tsirkin"
Cc: Jason Wang
Signed-off-by: Will Deacon
Link: https://lore.kernel.org/r/20211201112018.25276-1-will@kernel.org
Acked-by: Jason Wang
Tested-by: Suzuki K Poulose
Fixes: e6d6dd6c875e ("virtio: Introduce virtio\_max\_dma\_size()")
Cc: Joerg Roedel
Cc: Konrad Rzeszutek Wilk
Cc: Christoph Hellwig
Cc: Robin Murphy
Signed-off-by: Steven Price
Signed-off-by: Suzuki K Poulose
Cc: stable@vger.kernel.org
Signed-off-by: Michael S. Tsirkin
Signed-off-by: Greg Kroah-Hartman
commit ebbbc5fea3f648175df1aa3f127c78eb0252cc2a
Author: Dan Carpenter
Date: Wed Dec 8 18:09:56 2021 +0300
vduse: check that offset is within bounds in get\_config()
commit dc1db0060c02d119fd4196924eff2d1129e9a442 upstream.
This condition checks "len" but it does not check "offset" and that
could result in an out of bounds read if "offset > dev->config\_size".
The problem is that since both variables are unsigned the
"dev->config\_size - offset" subtraction would result in a very high
unsigned value.
I think these checks might not be necessary because "len" and "offset"
are supposed to already have been validated using the
vhost\_vdpa\_config\_validate() function. But I do not know the code
perfectly, and I like to be safe.
Fixes: c8a6153b6c59 ("vduse: Introduce VDUSE - vDPA Device in Userspace")
Signed-off-by: Dan Carpenter
Link: https://lore.kernel.org/r/20211208150956.GA29160@kili
Signed-off-by: Michael S. Tsirkin
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit e6c67560b4341914bec32ec536e931c22062af65
Author: Dan Carpenter
Date: Wed Dec 8 13:33:07 2021 +0300
vduse: fix memory corruption in vduse\_dev\_ioctl()
commit ff9f9c6e74848170fcb45c8403c80d661484c8c9 upstream.
The "config.offset" comes from the user. There needs to a check to
prevent it being out of bounds. The "config.offset" and
"dev->config\_size" variables are both type u32. So if the offset if
out of bounds then the "dev->config\_size - config.offset" subtraction
results in a very high u32 value. The out of bounds offset can result
in memory corruption.
Fixes: c8a6153b6c59 ("vduse: Introduce VDUSE - vDPA Device in Userspace")
Signed-off-by: Dan Carpenter
Link: https://lore.kernel.org/r/20211208103307.GA3778@kili
Signed-off-by: Michael S. Tsirkin
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 2746d3face6532d3d6839ca5a05bb2d10988db72
Author: Daniel Borkmann
Date: Mon Dec 13 22:25:23 2021 +0000
bpf, selftests: Update test case for atomic cmpxchg on r0 with pointer
commit e523102cb719cbad1673b6aa2a4d5c1fa6f13799 upstream.
Fix up unprivileged test case results for 'Dest pointer in r0' verifier tests
given they now need to reject R0 containing a pointer value, and add a couple
of new related ones with 32bit cmpxchg as well.
root@foo:~/bpf/tools/testing/selftests/bpf# ./test\_verifier
#0/u invalid and of negative number OK
#0/p invalid and of negative number OK
[...]
#1268/p XDP pkt read, pkt\_meta' <= pkt\_data, bad access 1 OK
#1269/p XDP pkt read, pkt\_meta' <= pkt\_data, bad access 2 OK
#1270/p XDP pkt read, pkt\_data <= pkt\_meta', good access OK
#1271/p XDP pkt read, pkt\_data <= pkt\_meta', bad access 1 OK
#1272/p XDP pkt read, pkt\_data <= pkt\_meta', bad access 2 OK
Summary: 1900 PASSED, 0 SKIPPED, 0 FAILED
Acked-by: Brendan Jackman
Signed-off-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit f87a6c160ecc8c7b417d25f508d3f076fe346136
Author: Daniel Borkmann
Date: Tue Dec 7 11:02:02 2021 +0000
bpf: Fix kernel address leakage in atomic cmpxchg's r0 aux reg
commit a82fe085f344ef20b452cd5f481010ff96b5c4cd upstream.
The implementation of BPF\_CMPXCHG on a high level has the following parameters:
.-[old-val] .-[new-val]
BPF\_R0 = cmpxchg{32,64}(DST\_REG + insn->off, BPF\_R0, SRC\_REG)
`-[mem-loc] `-[old-val]
Given a BPF insn can only have two registers (dst, src), the R0 is fixed and
used as an auxilliary register for input (old value) as well as output (returning
old value from memory location). While the verifier performs a number of safety
checks, it misses to reject unprivileged programs where R0 contains a pointer as
old value.
Through brute-forcing it takes about ~16sec on my machine to leak a kernel pointer
with BPF\_CMPXCHG. The PoC is basically probing for kernel addresses by storing the
guessed address into the map slot as a scalar, and using the map value pointer as
R0 while SRC\_REG has a canary value to detect a matching address.
Fix it by checking R0 for pointers, and reject if that's the case for unprivileged
programs.
Fixes: 5ffa25502b5a ("bpf: Add instructions for atomic\_[cmp]xchg")
Reported-by: Ryota Shiga (Flatt Security)
Acked-by: Brendan Jackman
Signed-off-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit d0d68083f273525ebae48996d196a706232b2d84
Author: Daniel Borkmann
Date: Wed Dec 15 23:48:54 2021 +0000
bpf, selftests: Add test case trying to taint map value pointer
commit b1a7288dedc6caf9023f2676b4f5ed34cf0d4029 upstream.
Add a test case which tries to taint map value pointer arithmetic into a
unknown scalar with subsequent export through the map.
Before fix:
# ./test\_verifier 1186
#1186/u map access: trying to leak tained dst reg FAIL
Unexpected success to load!
verification time 24 usec
stack depth 8
processed 15 insns (limit 1000000) max\_states\_per\_insn 0 total\_states 1 peak\_states 1 mark\_read 1
#1186/p map access: trying to leak tained dst reg FAIL
Unexpected success to load!
verification time 8 usec
stack depth 8
processed 15 insns (limit 1000000) max\_states\_per\_insn 0 total\_states 1 peak\_states 1 mark\_read 1
Summary: 0 PASSED, 0 SKIPPED, 2 FAILED
After fix:
# ./test\_verifier 1186
#1186/u map access: trying to leak tained dst reg OK
#1186/p map access: trying to leak tained dst reg OK
Summary: 2 PASSED, 0 SKIPPED, 0 FAILED
Signed-off-by: Daniel Borkmann
Reviewed-by: John Fastabend
Acked-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit dbda060d50abbe91ca76010078742ca53264bfa6
Author: Daniel Borkmann
Date: Wed Dec 15 22:28:48 2021 +0000
bpf: Make 32->64 bounds propagation slightly more robust
commit e572ff80f05c33cd0cb4860f864f5c9c044280b6 upstream.
Make the bounds propagation in \_\_reg\_assign\_32\_into\_64() slightly more
robust and readable by aligning it similarly as we did back in the
\_\_reg\_combine\_64\_into\_32() counterpart. Meaning, only propagate or
pessimize them as a smin/smax pair.
Signed-off-by: Daniel Borkmann
Reviewed-by: John Fastabend
Acked-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit f77d7a35d4913e4ab27abb36016fbfc1e882a654
Author: Daniel Borkmann
Date: Wed Dec 15 22:02:19 2021 +0000
bpf: Fix signed bounds propagation after mov32
commit 3cf2b61eb06765e27fec6799292d9fb46d0b7e60 upstream.
For the case where both s32\_{min,max}\_value bounds are positive, the
\_\_reg\_assign\_32\_into\_64() directly propagates them to their 64 bit
counterparts, otherwise it pessimises them into [0,u32\_max] universe and
tries to refine them later on by learning through the tnum as per comment
in mentioned function. However, that does not always happen, for example,
in mov32 operation we call zext\_32\_to\_64(dst\_reg) which invokes the
\_\_reg\_assign\_32\_into\_64() as is without subsequent bounds update as
elsewhere thus no refinement based on tnum takes place.
Thus, not calling into the \_\_update\_reg\_bounds() / \_\_reg\_deduce\_bounds() /
\_\_reg\_bound\_offset() triplet as we do, for example, in case of ALU ops via
adjust\_scalar\_min\_max\_vals(), will lead to more pessimistic bounds when
dumping the full register state:
Before fix:
0: (b4) w0 = -1
1: R0\_w=invP4294967295
(id=0,imm=ffffffff,
smin\_value=4294967295,smax\_value=4294967295,
umin\_value=4294967295,umax\_value=4294967295,
var\_off=(0xffffffff; 0x0),
s32\_min\_value=-1,s32\_max\_value=-1,
u32\_min\_value=-1,u32\_max\_value=-1)
1: (bc) w0 = w0
2: R0\_w=invP4294967295
(id=0,imm=ffffffff,
smin\_value=0,smax\_value=4294967295,
umin\_value=4294967295,umax\_value=4294967295,
var\_off=(0xffffffff; 0x0),
s32\_min\_value=-1,s32\_max\_value=-1,
u32\_min\_value=-1,u32\_max\_value=-1)
Technically, the smin\_value=0 and smax\_value=4294967295 bounds are not
incorrect, but given the register is still a constant, they break assumptions
about const scalars that smin\_value == smax\_value and umin\_value == umax\_value.
After fix:
0: (b4) w0 = -1
1: R0\_w=invP4294967295
(id=0,imm=ffffffff,
smin\_value=4294967295,smax\_value=4294967295,
umin\_value=4294967295,umax\_value=4294967295,
var\_off=(0xffffffff; 0x0),
s32\_min\_value=-1,s32\_max\_value=-1,
u32\_min\_value=-1,u32\_max\_value=-1)
1: (bc) w0 = w0
2: R0\_w=invP4294967295
(id=0,imm=ffffffff,
smin\_value=4294967295,smax\_value=4294967295,
umin\_value=4294967295,umax\_value=4294967295,
var\_off=(0xffffffff; 0x0),
s32\_min\_value=-1,s32\_max\_value=-1,
u32\_min\_value=-1,u32\_max\_value=-1)
Without the smin\_value == smax\_value and umin\_value == umax\_value invariant
being intact for const scalars, it is possible to leak out kernel pointers
from unprivileged user space if the latter is enabled. For example, when such
registers are involved in pointer arithmtics, then adjust\_ptr\_min\_max\_vals()
will taint the destination register into an unknown scalar, and the latter
can be exported and stored e.g. into a BPF map value.
Fixes: 3f50f132d840 ("bpf: Verifier, do explicit ALU32 bounds tracking")
Reported-by: Kuee K1r0a
Signed-off-by: Daniel Borkmann
Reviewed-by: John Fastabend
Acked-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit efcad725feb44d6cfcd9742b6a354002bf09c9da
Author: Daniel Borkmann
Date: Tue Dec 7 10:07:04 2021 +0000
bpf, selftests: Add test case for atomic fetch on spilled pointer
commit 180486b430f4e22cc00a478163d942804baae4b5 upstream.
Test whether unprivileged would be able to leak the spilled pointer either
by exporting the returned value from the atomic{32,64} operation or by reading
and exporting the value from the stack after the atomic operation took place.
Note that for unprivileged, the below atomic cmpxchg test case named "Dest
pointer in r0 - succeed" is failing. The reason is that in the dst memory
location (r10 -8) there is the spilled register r10:
0: R1=ctx(id=0,off=0,imm=0) R10=fp0
0: (bf) r0 = r10
1: R0\_w=fp0 R1=ctx(id=0,off=0,imm=0) R10=fp0
1: (7b) \*(u64 \*)(r10 -8) = r0
2: R0\_w=fp0 R1=ctx(id=0,off=0,imm=0) R10=fp0 fp-8\_w=fp
2: (b7) r1 = 0
3: R0\_w=fp0 R1\_w=invP0 R10=fp0 fp-8\_w=fp
3: (db) r0 = atomic64\_cmpxchg((u64 \*)(r10 -8), r0, r1)
4: R0\_w=fp0 R1\_w=invP0 R10=fp0 fp-8\_w=mmmmmmmm
4: (79) r1 = \*(u64 \*)(r0 -8)
5: R0\_w=fp0 R1\_w=invP(id=0) R10=fp0 fp-8\_w=mmmmmmmm
5: (b7) r0 = 0
6: R0\_w=invP0 R1\_w=invP(id=0) R10=fp0 fp-8\_w=mmmmmmmm
6: (95) exit
However, allowing this case for unprivileged is a bit useless given an
update with a new pointer will fail anyway:
0: R1=ctx(id=0,off=0,imm=0) R10=fp0
0: (bf) r0 = r10
1: R0\_w=fp0 R1=ctx(id=0,off=0,imm=0) R10=fp0
1: (7b) \*(u64 \*)(r10 -8) = r0
2: R0\_w=fp0 R1=ctx(id=0,off=0,imm=0) R10=fp0 fp-8\_w=fp
2: (db) r0 = atomic64\_cmpxchg((u64 \*)(r10 -8), r0, r10)
R10 leaks addr into mem
Acked-by: Brendan Jackman
Signed-off-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
[only backport one test for 5.15.y - gregkh]
Signed-off-by: Greg Kroah-Hartman
commit 423628125a484538111c2c6d9bb1588eb086053b
Author: Daniel Borkmann
Date: Tue Dec 7 12:51:56 2021 +0000
bpf: Fix kernel address leakage in atomic fetch
commit 7d3baf0afa3aa9102d6a521a8e4c41888bb79882 upstream.
The change in commit 37086bfdc737 ("bpf: Propagate stack bounds to registers
in atomics w/ BPF\_FETCH") around check\_mem\_access() handling is buggy since
this would allow for unprivileged users to leak kernel pointers. For example,
an atomic fetch/and with -1 on a stack destination which holds a spilled
pointer will migrate the spilled register type into a scalar, which can then
be exported out of the program (since scalar != pointer) by dumping it into
a map value.
The original implementation of XADD was preventing this situation by using
a double call to check\_mem\_access() one with BPF\_READ and a subsequent one
with BPF\_WRITE, in both cases passing -1 as a placeholder value instead of
register as per XADD semantics since it didn't contain a value fetch. The
BPF\_READ also included a check in check\_stack\_read\_fixed\_off() which rejects
the program if the stack slot is of \_\_is\_pointer\_value() if dst\_regno < 0.
The latter is to distinguish whether we're dealing with a regular stack spill/
fill or some arithmetical operation which is disallowed on non-scalars, see
also 6e7e63cbb023 ("bpf: Forbid XADD on spilled pointers for unprivileged
users") for more context on check\_mem\_access() and its handling of placeholder
value -1.
One minimally intrusive option to fix the leak is for the BPF\_FETCH case to
initially check the BPF\_READ case via check\_mem\_access() with -1 as register,
followed by the actual load case with non-negative load\_reg to propagate
stack bounds to registers.
Fixes: 37086bfdc737 ("bpf: Propagate stack bounds to registers in atomics w/ BPF\_FETCH")
Reported-by:
Acked-by: Brendan Jackman
Signed-off-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit 976389cbb16cee46847e5d06250a3a0b5506781e
Author: Sudeep Holla
Date: Thu Dec 9 12:04:56 2021 +0000
firmware: arm\_scpi: Fix string overflow in SCPI genpd driver
commit 865ed67ab955428b9aa771d8b4f1e4fb7fd08945 upstream.
Without the bound checks for scpi\_pd->name, it could result in the buffer
overflow when copying the SCPI device name from the corresponding device
tree node as the name string is set at maximum size of 30.
Let us fix it by using devm\_kasprintf so that the string buffer is
allocated dynamically.
Fixes: 8bec4337ad40 ("firmware: scpi: add device power domain support using genpd")
Reported-by: Pedro Batista
Signed-off-by: Sudeep Holla
Cc: stable@vger.kernel.org
Cc: Cristian Marussi
Link: https://lore.kernel.org/r/20211209120456.696879-1-sudeep.holla@arm.com'
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit c62b16f98688ae7bc0ab23a6490481f4ce9b3a49
Author: Johannes Berg
Date: Sat Dec 11 20:10:24 2021 +0100
mac80211: validate extended element ID is present
commit 768c0b19b50665e337c96858aa2b7928d6dcf756 upstream.
Before attempting to parse an extended element, verify that
the extended element ID is present.
Fixes: 41cbb0f5a295 ("mac80211: add support for HE")
Reported-by: syzbot+59bdff68edce82e393b6@syzkaller.appspotmail.com
Link: https://lore.kernel.org/r/20211211201023.f30a1b128c07.I5cacc176da94ba316877c6e10fe3ceec8b4dbd7d@changeid
Cc: stable@vger.kernel.org
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit e606db721de5e6bb7fc12f22ba09b6d013930fa7
Author: Felix Fietkau
Date: Thu Dec 2 13:45:33 2021 +0100
mac80211: send ADDBA requests using the tid/queue of the aggregation session
commit 1fe98f5690c4219d419ea9cc190f94b3401cf324 upstream.
Sending them out on a different queue can cause a race condition where a
number of packets in the queue may be discarded by the receiver, because
the ADDBA request is sent too early.
This affects any driver with software A-MPDU setup which does not allocate
packet seqno in hardware on tx, regardless of whether iTXQ is used or not.
The only driver I've seen that explicitly deals with this issue internally
is mwl8k.
Cc: stable@vger.kernel.org
Signed-off-by: Felix Fietkau
Link: https://lore.kernel.org/r/20211202124533.80388-1-nbd@nbd.name
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 815ee27cfbf8184f6e30c30a0bd7055e1ece05dd
Author: Johannes Berg
Date: Mon Nov 29 15:32:39 2021 +0200
mac80211: mark TX-during-stop for TX in in\_reconfig
commit db7205af049d230e7e0abf61c1e74c1aab40f390 upstream.
Mark TXQs as having seen transmit while they were stopped if
we bail out of drv\_wake\_tx\_queue() due to reconfig, so that
the queue wake after this will make them catch up. This is
particularly necessary for when TXQs are used for management
packets since those TXQs won't see a lot of traffic that'd
make them catch up later.
Cc: stable@vger.kernel.org
Fixes: 4856bfd23098 ("mac80211: do not call driver wake\_tx\_queue op during reconfig")
Signed-off-by: Johannes Berg
Signed-off-by: Luca Coelho
Link: https://lore.kernel.org/r/iwlwifi.20211129152938.4573a221c0e1.I0d1d5daea3089be3fc0dccc92991b0f8c5677f0c@changeid
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit a7aed5c87d74b36dbbb2556a4d2f3120df33046b
Author: Felix Fietkau
Date: Wed Nov 24 10:40:24 2021 +0100
mac80211: fix regression in SSN handling of addba tx
commit 73111efacd3c6d9e644acca1d132566932be8af0 upstream.
Some drivers that do their own sequence number allocation (e.g. ath9k) rely
on being able to modify params->ssn on starting tx ampdu sessions.
This was broken by a change that modified it to use sta->tid\_seq[tid] instead.
Cc: stable@vger.kernel.org
Fixes: 31d8bb4e07f8 ("mac80211: agg-tx: refactor sending addba")
Reported-by: Eneas U de Queiroz
Signed-off-by: Felix Fietkau
Link: https://lore.kernel.org/r/20211124094024.43222-1-nbd@nbd.name
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 237ee0f24bc455c46e867e0cc866f3a16fa41796
Author: Felix Fietkau
Date: Mon Nov 22 21:43:23 2021 +0100
mac80211: fix rate control for retransmitted frames
commit 18688c80ad8a8dd50523dc9276e929932cac86d4 upstream.
Since retransmission clears info->control, rate control needs to be called
again, otherwise the driver might crash due to invalid rates.
Cc: stable@vger.kernel.org # 5.14+
Reported-by: Aaro Koskinen
Reported-by: Robert W
Fixes: 03c3911d2d67 ("mac80211: call ieee80211\_tx\_h\_rate\_ctrl() when dequeue")
Signed-off-by: Felix Fietkau
Tested-by: Aaro Koskinen
Link: https://lore.kernel.org/r/20211122204323.9787-1-nbd@nbd.name
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 6bd55427e266de8bb46781732a0786d6ed8aec48
Author: Lai Jiangshan
Date: Tue Oct 19 19:01:51 2021 +0800
KVM: X86: Fix tlb flush for tdp in kvm\_invalidate\_pcid()
[ Upstream commit e45e9e3998f0001079b09555db5bb3b4257f6746 ]
The KVM doesn't know whether any TLB for a specific pcid is cached in
the CPU when tdp is enabled. So it is better to flush all the guest
TLB when invalidating any single PCID context.
The case is very rare or even impossible since KVM generally doesn't
intercept CR3 write or INVPCID instructions when tdp is enabled, so the
fix is mostly for the sake of overall robustness.
Signed-off-by: Lai Jiangshan
Message-Id: <20211019110154.4091-2-jiangshanlai@gmail.com>
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit bf4367c02c8cc4d910157dfd1d34a89daea44d65
Author: Juergen Gross
Date: Wed Nov 17 08:16:17 2021 +0100
x86/kvm: remove unused ack\_notifier callbacks
[ Upstream commit 9dba4d24cbb5524dd39ab1e08886373b17f07ff2 ]
Commit f52447261bc8c2 ("KVM: irq ack notification") introduced an
ack\_notifier() callback in struct kvm\_pic and in struct kvm\_ioapic
without using them anywhere. Remove those callbacks again.
Signed-off-by: Juergen Gross
Message-Id: <20211117071617.19504-1-jgross@suse.com>
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 54bf0b0d3536bf1651c66f60f621532e8d6c50af
Author: Paolo Bonzini
Date: Mon Nov 22 18:24:01 2021 -0500
KVM: downgrade two BUG\_ONs to WARN\_ON\_ONCE
[ Upstream commit 5f25e71e311478f9bb0a8ef49e7d8b95316491d7 ]
This is not an unrecoverable situation. Users of kvm\_read\_guest\_offset\_cached
and kvm\_write\_guest\_offset\_cached must expect the read/write to fail, and
therefore it is possible to just return early with an error value.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 4b65555a501e9fcaaeb302af1ebba279ed3bf653
Author: Vitaly Kuznetsov
Date: Tue Nov 23 14:59:53 2021 +0100
KVM: selftests: Make sure kvm\_create\_max\_vcpus test won't hit RLIMIT\_NOFILE
[ Upstream commit 908fa88e420f30dde6d80f092795a18ec72ca6d3 ]
With the elevated 'KVM\_CAP\_MAX\_VCPUS' value kvm\_create\_max\_vcpus test
may hit RLIMIT\_NOFILE limits:
# ./kvm\_create\_max\_vcpus
KVM\_CAP\_MAX\_VCPU\_ID: 4096
KVM\_CAP\_MAX\_VCPUS: 1024
Testing creating 1024 vCPUs, with IDs 0...1023.
/dev/kvm not available (errno: 24), skipping test
Adjust RLIMIT\_NOFILE limits to make sure KVM\_CAP\_MAX\_VCPUS fds can be
opened. Note, raising hard limit ('rlim\_max') requires CAP\_SYS\_RESOURCE
capability which is generally not needed to run kvm selftests (but without
raising the limit the test is doomed to fail anyway).
Signed-off-by: Vitaly Kuznetsov
Message-Id: <20211123135953.667434-1-vkuznets@redhat.com>
[Skip the test if the hard limit can be raised. - Paolo]
Reviewed-by: Sean Christopherson
Tested-by: Sean Christopherson
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 6890c75c14b3d5dc8a1a355428457388cd830b82
Author: Paolo Bonzini
Date: Tue Nov 30 07:36:41 2021 -0500
KVM: VMX: clear vmx\_x86\_ops.sync\_pir\_to\_irr if APICv is disabled
[ Upstream commit e90e51d5f01d2baae5dcce280866bbb96816e978 ]
There is nothing to synchronize if APICv is disabled, since neither
other vCPUs nor assigned devices can set PIR.ON.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit efccff32defce4b7e30c2cebb3b14df38e74ed85
Author: Jon Hunter
Date: Fri Nov 12 11:27:12 2021 +0000
reset: tegra-bpmp: Revert Handle errors in BPMP response
commit 69125b4b9440be015783312e1b8753ec96febde0 upstream.
Commit c045ceb5a145 ("reset: tegra-bpmp: Handle errors in BPMP
response") fixed an issue in the Tegra BPMP error handling but has
exposed an issue in the Tegra194 HDA driver and now resetting the
Tegra194 HDA controller is failing. For now revert the commit
c045ceb5a145 ("reset: tegra-bpmp: Handle errors in BPMP response")
while a fix for the Tegra HDA driver is created.
Fixes: c045ceb5a145 ("reset: tegra-bpmp: Handle errors in BPMP response")
Signed-off-by: Jon Hunter
Link: https://lore.kernel.org/r/20211112112712.21587-1-jonathanh@nvidia.com
Signed-off-by: Philipp Zabel
Signed-off-by: Greg Kroah-Hartman


=== Content from www.debian.org_bb1e3d5e_20250114_204806.html ===


---

[[Date Prev](msg00015.html)][[Date Next](msg00017.html)]
[[Thread Prev](msg00015.html)][[Thread Next](msg00017.html)]
[[Date Index](maillist.html#00016)]
[[Thread Index](threads.html#00016)]

# [SECURITY] [DSA 5050-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5050-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Thu, 20 Jan 2022 16:46:05 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nAaZZ-0003hV-Ec%40seger.debian.org)Â [E1nAaZZ-0003hV-Ec@seger.debian.org](msg00016.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5050-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
January 20, 2022                      <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2021-4155 CVE-2021-28711 CVE-2021-28712 CVE-2021-28713
                 CVE-2021-28714 CVE-2021-28715 CVE-2021-39685 CVE-2021-45095
                 CVE-2021-45469 CVE-2021-45480 CVE-2022-0185 CVE-2022-23222
Debian Bug     : 988044 996974

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2021-45469

    Wenqing Liu reported an out-of-bounds memory access in the f2fs
    implementation if an inode has an invalid last xattr entry. An
    attacker able to mount a specially crafted image can take advantage
    of this flaw for denial of service.

CVE-2021-45480

    A memory leak flaw was discovered in the __rds_conn_create()
    function in the RDS (Reliable Datagram Sockets) protocol subsystem.

CVE-2022-0185

    William Liu, Jamie Hill-Daniel, Isaac Badipe, Alec Petridis, Hrvoje
    Misetic and Philip Papurt discovered a heap-based buffer overflow
    flaw in the legacy_parse_param function in the Filesystem Context
    functionality, allowing an local user (with CAP_SYS_ADMIN capability
    in the current namespace) to escalate privileges.

CVE-2022-23222

    'tr3e' discovered that the BPF verifier does not properly restrict
    several *_OR_NULL pointer types allowing these types to do pointer
    arithmetic. A local user with the ability to call bpf(), can take
    advantage of this flaw to excalate privileges. Unprivileged calls to
    bpf() are disabled by default in Debian, mitigating this flaw.

For the stable distribution (bullseye), these problems have been fixed in
version 5.10.92-1. This version includes changes which were aimed to
land in the next Debian bullseye point release.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to its security
tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmHpj+RfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0T3pg/+O3hQq7q+8FQ70/0kCWXk1tfmjkBJHVQENcy3qLjaQEL6bFX/mCh799QL
G+NtbCiA1+x/eVbXpzqhZeVXrf+5mn6hqKAfQJ9C74XYfEMt5KQiwZ4yMJrTOZkx
xXObcech/KORcUAUAjhKW/3bOS/n5gkTxi2Z1mJtVwgU1OdRkeQV/mB6V2nGWO4V
yg4tAfDUjgUIEl2w1qT4s4SaaoAMNcLJmjPUXwiLyhHNT6zGSWcKhd2U80avcdMx
9YMmOH8EfA7htOA2SJRUNfFUyRQAKJO3GUdBNAEwFzbswG/oohgcCjC6jaEVKBge
Ygzyvyx7m5eL3giJnTtR8A79bINXgT/KA6wDtQzZeQUFxUsOl3efEG3I8yFz57aL
ZHjYm/aklhrb2e+66HHLznwa7dg9Sc2bZ3NvYVrhX8bxMSq4q2RLzxg0FPoz7fas
f9YiZkn2hefilw+n8Of6zT7Ui9dXaR1o2JZaFDmUwvZN6MKnlySHu6AWUgjeT6T1
L2IZbuzmT4fquP0LiaKUd3fr9i4fF1fBNp7Kdv383wfNRJO/wP4cKTgv5WeDuEXy
rp9k5XR4Q6F9aU4InMq0KeqpZ1rWW5gBOJ3htFmNbzEebM3AQRM1MXd/1FLk8EzI
+MDOP6xf+fVMiW6dsx+4QpvG7yEIzmnbraNKFfzp8VxofW0SZGk=
=SlPI
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_47c92b1e_20250114_204804.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F5f9562ebe710c307adc5f666bf1a2162ee7977c0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F5f9562ebe710c307adc5f666bf1a2162ee7977c0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.8k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  434](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/5f9562ebe710c307adc5f666bf1a2162ee7977c0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

rds: memory leak in \_\_rds\_conn\_create()

[Browse files](/torvalds/linux/tree/5f9562ebe710c307adc5f666bf1a2162ee7977c0)
Browse the repository at this point in the history

```
__rds_conn_create() did not release conn->c_path when loop_trans != 0 and
trans->t_prefer_loopback != 0 and is_outgoing == 0.

Fixes: [aced3ce](https://github.com/torvalds/linux/commit/aced3ce57cd37b5ca332bcacd370d01f5a8c5371) ("RDS tcp loopback connection can hang")
Signed-off-by: Hangyu Hua <hbh25y@gmail.com>
Reviewed-by: Sharath Srinivasan <sharath.srinivasan@oracle.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@HBh25Y](https://avatars.githubusercontent.com/u/39452870?s=40&v=4)](/HBh25Y) [![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

[HBh25Y](/torvalds/linux/commits?author=HBh25Y "View all commits by HBh25Y")
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Dec 14, 2021

1 parent
[d971650](/torvalds/linux/commit/d971650e17a985a0275b20f04fa67b62b4944897)

commit 5f9562e

Showing
**1 changed file**
with
**1 addition**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[net/rds/connection.c](#diff-3199de7c79ecda4c717aa42d9189272ca468b0f9521091745b0019bdf37ed73e "net/rds/connection.c")

Show comments

[View file](/torvalds/linux/blob/5f9562ebe710c307adc5f666bf1a2162ee7977c0/net/rds/connection.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -253,6 +253,7 @@ static struct rds\_connection \*\_\_rds\_conn\_create(struct net \*net, |
|  |  | \* should end up here, but if it |
|  |  | \* does, reset/destroy the connection. |
|  |  | \*/ |
|  |  | kfree(conn->c\_path); |
|  |  | kmem\_cache\_free(rds\_conn\_slab, conn); |
|  |  | conn = ERR\_PTR(-EOPNOTSUPP); |
|  |  | goto out; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5f9562e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F5f9562ebe710c307adc5f666bf1a2162ee7977c0) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.debian.org_9dfdb833_20250114_204806.html ===


---

[[Date Prev](msg00062.html)][[Date Next](msg00064.html)]
[[Thread Prev](msg00062.html)][[Thread Next](msg00064.html)]
[[Date Index](maillist.html#00063)]
[[Thread Index](threads.html#00063)]

# [SECURITY] [DSA 5096-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5096-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Wed, 09 Mar 2022 15:30:58 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nRyHC-0004Le-Lx%40seger.debian.org)Â [E1nRyHC-0004Le-Lx@seger.debian.org](msg00063.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5096-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
March 09, 2022                        <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2020-29374 CVE-2020-36322 CVE-2021-3640 CVE-2021-3744
                 CVE-2021-3752 CVE-2021-3760 CVE-2021-3764 CVE-2021-3772
                 CVE-2021-4002 CVE-2021-4083 CVE-2021-4135 CVE-2021-4155
                 CVE-2021-4203 CVE-2021-20317 CVE-2021-20321 CVE-2021-20322
                 CVE-2021-22600 CVE-2021-28711 CVE-2021-28712 CVE-2021-28713
                 CVE-2021-28714 CVE-2021-28715 CVE-2021-28950 CVE-2021-38300
                 CVE-2021-39685 CVE-2021-39686 CVE-2021-39698 CVE-2021-39713
                 CVE-2021-41864 CVE-2021-42739 CVE-2021-43389 CVE-2021-43975
                 CVE-2021-43976 CVE-2021-44733 CVE-2021-45095 CVE-2021-45469
                 CVE-2021-45480 CVE-2022-0001 CVE-2022-0002 CVE-2022-0322
                 CVE-2022-0330 CVE-2022-0435 CVE-2022-0487 CVE-2022-0492
                 CVE-2022-0617 CVE-2022-0644 CVE-2022-22942 CVE-2022-24448
                 CVE-2022-24959 CVE-2022-25258 CVE-2022-25375
Debian Bug     : 988044 989285 990411 994050

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

    This issue was already fixed for most architectures, but not on
    MIPS and System z.  This update corrects that.

CVE-2020-36322, CVE-2021-28950

    The syzbot tool found that the FUSE (filesystem-in-user-space)
    implementation did not correctly handle a FUSE server returning
    invalid attributes for a file.  A local user permitted to run a
    FUSE server could use this to cause a denial of service (crash).

    The original fix for this introduced a different potential denial
    of service (infinite loop in kernel space), which has also been
    fixed.

CVE-2021-3640

    Lin Ma discovered a race condiiton in the Bluetooth protocol
    implementation that can lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2021-3744, CVE-2021-3764

    minihanshen reported bugs in the ccp driver for AMD
    Cryptographic Coprocessors that could lead to a resource leak.
    On systems using this driver, a local user could exploit this to
    cause a denial of service.

CVE-2021-3752

    Likang Luo of NSFOCUS Security Team discovered a flaw in the
    Bluetooth L2CAP implementation that can lead to a user-after-free.
    A local user could exploit this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2021-3760, CVE-2021-4202

    Lin Ma discovered race conditions in the NCI (NFC Controller
    Interface) driver, which could lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-3772

    A flaw was found in the SCTP protocol implementation, which would
    allow a networked attacker to break an SCTP association.  The
    attacker would only need to know or guess the IP addresses and
    ports for the association.

CVE-2021-4002

    It was discovered that hugetlbfs, the virtual filesystem used by
    applications to allocate huge pages in RAM, did not flush the
    CPU's TLB in one case where it was necessary.  In some
    circumstances a local user would be able to read and write huge
    pages after they are freed and reallocated to a different process.
    This could lead to privilege escalation, denial of service or
    information leaks.

CVE-2021-4083

    Jann Horn reported a race condition in the local (Unix) sockets
    garbage collector, that can lead to use-after-free.  A local user
    could exploit this to cause a denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-4135

    A flaw was found in the netdevsim driver which would lead to an
    information leak.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-4203

    Jann Horn reported a race condition in the local (Unix) sockets
    implementation that can lead to a use-after-free.  A local user
    could exploit this to leak sensitive information from the kernel.

CVE-2021-20317

    It was discovered that the timer queue structure could become
    corrupt, leading to waiting tasks never being woken up.  A local
    user with certain privileges could exploit this to cause a denial
    of service (system hang).

CVE-2021-20321

    A race condition was discovered in the overlayfs filesystem
    driver.  A local user with access to an overlayfs mount and to its
    underlying upper directory could exploit this for privilege
    escalation.

CVE-2021-20322

    An information leak was discovered in the IPv4 implementation.  A
    remote attacker could exploit this to quickly discover which UDP
    ports a system is using, making it easier for them to carry out a
    DNS poisoning attack against that system.

CVE-2021-22600

    The syzbot tool found a flaw in the packet socket (AF_PACKET)
    implementation which could lead to incorrectly freeing memory.  A
    local user with CAP_NET_RAW capability (in any user namespace)
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-38300

    Piotr Krysiuk discovered a flaw in the classic BPF (cBPF) JIT
    compiler for MIPS architectures.  A local user could exploit
    this to excute arbitrary code in the kernel.

    This issue is mitigated by setting sysctl
    net.core.bpf_jit_enable=0, which is the default.  It is *not*
    mitigated by disabling unprivileged use of eBPF.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-39686

    A race condition was discovered in the Android binder driver, that
    could lead to incorrect security checks.  On systems where the
    binder driver is loaded, a local user could exploit this for
    privilege escalation.

CVE-2021-39698

    Linus Torvalds reported a flaw in the file polling implementation,
    which could lead to a use-after-free.  A local user could exploit
    this for denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2021-39713

    The syzbot tool found a race condition in the network scheduling
    subsystem which could lead to a use-after-free.  A local user
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-41864

    An integer overflow was discovered in the Extended BPF (eBPF)
    subsystem.  A local user could exploit this for denial of service
    (memory corruption or crash), or possibly for privilege
    escalation.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-42739

    A heap buffer overflow was discovered in the firedtv driver for
    FireWire-connected DVB receivers.  A local user with access to a
    firedtv device could exploit this for denial of service (memory
    corruption or crash), or possibly for privilege escalation.

CVE-2021-43389

    The Active Defense Lab of Venustech discovered a flaw in the CMTP
    subsystem as used by Bluetooth, which could lead to an
    out-of-bounds read and object type confusion.  A local user with
    CAP_NET_ADMIN capability in the initial user namespace could
    exploit this for denial of service (memory corruption or crash),
    or possibly for privilege escalation.

CVE-2021-43975

    Brendan Dolan-Gavitt reported a flaw in the
    hw_atl_utils_fw_rpc_wait() function in the aQuantia AQtion ethernet
    device driver which can result in denial of service or the execution
    of arbitrary code.

CVE-2021-43976

    Zekun Shen and Brendan Dolan-Gavitt discovered a flaw in the
    mwifiex_usb_recv() function of the Marvell WiFi-Ex USB Driver. An
    attacker able to connect a crafted USB device can take advantage of
    this flaw to cause a denial of service.

CVE-2021-44733

    A race condition was discovered in the Trusted Execution
    Environment (TEE) subsystem for Arm processors, which could lead
    to a use-after-free.  A local user permitted to access a TEE
    device could exploit this for denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2021-45469

    Wenqing Liu reported an out-of-bounds memory access in the f2fs
    implementation if an inode has an invalid last xattr entry. An
    attacker able to mount a specially crafted image can take advantage
    of this flaw for denial of service.

CVE-2021-45480

    A memory leak flaw was discovered in the __rds_conn_create()
    function in the RDS (Reliable Datagram Sockets) protocol subsystem.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This can be partly mitigated by disabling eBPF for unprivileged
    users with the sysctl: kernel.unprivileged_bpf_disabled=2.  This
    update does that by default.

CVE-2022-0322

    Eiichi Tsukata discovered a flaw in the sctp_make_strreset_req()
    function in the SCTP network protocol implementation which can
    result in denial of service.

CVE-2022-0330

    Sushma Venkatesh Reddy discovered a missing GPU TLB flush in the
    i915 driver, resulting in denial of service or privilege escalation.

CVE-2022-0435

    Samuel Page and Eric Dumazet reported a stack overflow in the
    networking module for the Transparent Inter-Process Communication
    (TIPC) protocol, resulting in denial of service or potentially the
    execution of arbitrary code.

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-0644

    Hao Sun reported a missing check for file read permission in the
    finit_module() and kexec_file_load() system calls.  The security
    impact of this is unclear, since these system calls are usually
    only available to the root user.

CVE-2022-22942

    It was discovered that wrong file file descriptor handling in the
    VMware Virtual GPU driver (vmwgfx) could result in information leak
    or privilege escalation.

CVE-2022-24448

    Lyu Tao reported a flaw in the NFS implementation in the Linux
    kernel when handling requests to open a directory on a regular file,
    which could result in a information leak.

CVE-2022-24959

    A memory leak was discovered in the yam_siocdevprivate() function of
    the YAM driver for AX.25, which could result in denial of service.

CVE-2022-25258

    Szymon Heidrich reported the USB Gadget subsystem lacks certain
    validation of interface OS descriptor requests, resulting in memory
    corruption.

CVE-2022-25375

    Szymon Heidrich reported that the RNDIS USB gadget lacks validation
    of the size of the RNDIS_MSG_SET command, resulting in information
    leak from kernel memory.

For the oldstable distribution (buster), these problems have been
fixed in version 4.19.232-1.  This update additionally includes many
more bug fixes from stable updates 4.19.209-4.19.232 inclusive.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmIotm1fFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0RcGg//QBgf4RfElxd+11a+BZ9HWJFBjA5Wp2VStf1+inoZ7X/En7W9QBpVvmks
Jum5QFpvA1waEP0zk0/O5MKXHtMbRMFdj0UUYQM7Vi3/vfeP73C10YmXv2yfG2Fw
dTGnVHpvvdJSbNzxMG4jruNY5b0Bf/WEQSqtuOM6V2aBiI7Y2pSI6Ak/dvexiu+0
ycz6PTDkX66e/p7NONw+B33L8yTMj9yu1cCdoYdrDihVlrESgbMLHUWO9JKRQykk
tsI2a79OIEkaj+yQwfkJu9njoPUTn6OZYUYxD8XaN8XtkDpwx1oVsiyqpslJEmgR
vaS1DOEnIZXsq2pscSPeKfFM30uFgqAxkQm/zUpjGGSXib58xaaf/c61LCQoMU2g
cSc+8+N1S2Lbcscdxd9TumvrOGJVuP/q/FqcOl4npcz1WLZRmc9f9IprdqUEy2iJ
+YLSrFFOfhgMMP0El6KJvG/8Jz60UEAiWuYutT508w1jIRrvMRLW4i6V3NXHrNkx
GDofOfPF8jNdt2Www+2sqEY51f+w2kffOSAnHGGPCASvWpuXFOw9ZyxnuyRRKKBE
no9PH0X71a636sZGh8bIU25PSKQlhtlAfCP+0Fef7PeEKTz1MJf8Nvo+vgCIsani
eGWa9jzdkVxHDEjxplX0stsByglCYyud7JSI1ZE9oLtJU1/xDBc=
=5fQT
-----END PGP SIGNATURE-----

```

---


