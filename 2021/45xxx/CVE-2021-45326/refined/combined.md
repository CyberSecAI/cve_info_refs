=== Content from github.com_6e99eebc_20250115_094917.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fpull%2F4840)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fpull%2F4840)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=go-gitea%2Fgitea)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[go-gitea](/go-gitea)
/
**[gitea](/go-gitea/gitea)**
Public

* [Notifications](/login?return_to=%2Fgo-gitea%2Fgitea) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fgo-gitea%2Fgitea)
* [Star
   46.6k](/login?return_to=%2Fgo-gitea%2Fgitea)

* [Code](/go-gitea/gitea)
* [Issues
  2.5k](/go-gitea/gitea/issues)
* [Pull requests
  215](/go-gitea/gitea/pulls)
* [Actions](/go-gitea/gitea/actions)
* [Projects
  0](/go-gitea/gitea/projects)
* [Wiki](/go-gitea/gitea/wiki)
* [Security](/go-gitea/gitea/security)
* [Insights](/go-gitea/gitea/pulse)

Additional navigation options

* [Code](/go-gitea/gitea)
* [Issues](/go-gitea/gitea/issues)
* [Pull requests](/go-gitea/gitea/pulls)
* [Actions](/go-gitea/gitea/actions)
* [Projects](/go-gitea/gitea/projects)
* [Wiki](/go-gitea/gitea/wiki)
* [Security](/go-gitea/gitea/security)
* [Insights](/go-gitea/gitea/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgo-gitea%2Fgitea%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgo-gitea%2Fgitea%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Enforce token on api routes [fixed critical security issue #4357] #4840

 Merged

[techknowlogick](/techknowlogick)
merged 45 commits into
[go-gitea:master](/go-gitea/gitea/tree/master "go-gitea/gitea:master")
from
[beeonthego:api-routes-enforce-token](/beeonthego/gitea/tree/api-routes-enforce-token "beeonthego/gitea:api-routes-enforce-token")

Sep 10, 2018

 Merged

# [Enforce token on api routes [fixed critical security issue #4357]](#top) #4840

[techknowlogick](/techknowlogick)
merged 45 commits into
[go-gitea:master](/go-gitea/gitea/tree/master "go-gitea/gitea:master")
from
[beeonthego:api-routes-enforce-token](/beeonthego/gitea/tree/api-routes-enforce-token "beeonthego/gitea:api-routes-enforce-token")

Sep 10, 2018

[Conversation
20](/go-gitea/gitea/pull/4840)
[Commits
45](/go-gitea/gitea/pull/4840/commits)
[Checks
0](/go-gitea/gitea/pull/4840/checks)
[Files changed](/go-gitea/gitea/pull/4840/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![beeonthego](https://avatars.githubusercontent.com/u/42626718?s=60&v=4)](/beeonthego)

Copy link

Contributor

### @beeonthego **[beeonthego](/beeonthego)** commented [Sep 1, 2018](#issue-356174841)

Check and make sure an authentication has been made using token or basic auth in reqToken handler.

When a user logs into Drone using gitea password, the current integration with Drone depends on basic auth to authenticate a Gitea user and fetches/creates an access token with the name drone. So this PR treats a valid basic auth header as the equivalent of api token, in order for Drone integration continue to work.

The user dashboard uses a few API routes for searching user/repo. All these requests use GET methods, and return results depending on whether the user has signed in, including token and other methods. These routes do not use reqToken handler, and will continue to work as they are now.

Please review and comment if changes are required. It is highly appreciated if it can be merged soon to have API routes covered.

Sorry, something went wrong.

All reactions

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)

`[enforce token on api routes](/go-gitea/gitea/pull/4840/commits/c53ef4060eec422828e467d8cd30651e3fee2885 "enforce token on api routes")`

`[c53ef40](/go-gitea/gitea/pull/4840/commits/c53ef4060eec422828e467d8cd30651e3fee2885)`

[![lunny](https://avatars.githubusercontent.com/u/81045?s=60&v=4)](/lunny)

**[lunny](/lunny)**
requested changes
[Sep 1, 2018](#pullrequestreview-151584991)

 [View reviewed changes](/go-gitea/gitea/pull/4840/files/c53ef4060eec422828e467d8cd30651e3fee2885)

Copy link

Member

### @lunny **[lunny](/lunny)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I don't think it's necessary.

Sorry, something went wrong.

All reactions

[![@bkcsoft](https://avatars.githubusercontent.com/u/4726179?s=40&v=4)](/bkcsoft)
[bkcsoft](/bkcsoft)
added
the
[lgtm/need 2](/go-gitea/gitea/labels/lgtm/need%202)
This PR needs two approvals by maintainers to be considered for merging.
label
[Sep 1, 2018](#event-1821773450)

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)
[beeonthego](/beeonthego)
mentioned this pull request
[Sep 1, 2018](#ref-issue-354089390)

[Proposal: limit api routes to access by token/basic auth only
#4794](/go-gitea/gitea/issues/4794)

Closed

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 1, 2018](#issuecomment-417837629) • edited Loading

| [@lunny](https://github.com/lunny) yes I agree the first expression can be removed. the result is the same.  the logic in the current test suites needs review and change, otherwise this pr won't pass all tests.  In fact when token is enforced, some tests should be added to make sure cookie can not access protected api routes. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)

`[remove redundant check on signin](/go-gitea/gitea/pull/4840/commits/94c170875188140e71feebb9ab6f3e395f8b5526 "remove redundant check on signin")`

`[94c1708](/go-gitea/gitea/pull/4840/commits/94c170875188140e71feebb9ab6f3e395f8b5526)`

[![@lunny](https://avatars.githubusercontent.com/u/81045?s=40&u=99b64f0ca6ef63643c7583ab87dd31c52d28e673&v=4)](/lunny)
[lunny](/lunny)
added
the
[type/enhancement](/go-gitea/gitea/labels/type/enhancement)
An improvement of existing functionality
label
[Sep 3, 2018](#event-1822482735)

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Merge branch 'master' into api-routes-enforce-token](/go-gitea/gitea/pull/4840/commits/5840433d821e1b826829bebe6e03d7e0b910a84c "Merge branch 'master' into api-routes-enforce-token")`

`[5840433](/go-gitea/gitea/pull/4840/commits/5840433d821e1b826829bebe6e03d7e0b910a84c)`

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)
[beeonthego](/beeonthego)
mentioned this pull request
[Sep 3, 2018](#ref-issue-356154901)

[[Proposal] CSRF checks on GET routes
#4838](/go-gitea/gitea/issues/4838)

Closed

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)
[beeonthego](/beeonthego)
changed the title
~~Enforce token on api routes [fixed issue #4357]~~
Enforce token on api routes [fixed critical security issue #4357]
[Sep 3, 2018](#event-1824079711)

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 3, 2018](#issuecomment-418199925)

| I assume the maintainers will review the access policy and modify test suites if agreeing to the policy of enforcing token in reqToken handler. I will not do anything about the test suites.  Please let me know if there is any other action required from me. This PR is about fixing critical security issues, and is easy to review. It is highly appreciated if it can be given some priority. |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 3, 2018](#issuecomment-418206529) • edited Loading

| From a preliminary review this looks good, however now a lot of the tests fail, and the GPG test has a panic  Edit: From posting this, I now see the post above mine. Sadly this won't be merged unless the tests pass (as the GitHub policies that are set up disable the button) |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)
[techknowlogick](/techknowlogick)
added
the
[topic/security](/go-gitea/gitea/labels/topic/security)
Something leaks user information or is otherwise vulnerable. Should be fixed!
label
[Sep 3, 2018](#event-1824116981)

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 4, 2018](#issuecomment-418209857)

| Can someone review the access policy and test suite, prepare and merge a PR so a token is enforced in API routes? This issue has been around for a long time now, and the fix is easy. I don't want to waste time on test suites, if the maintainers eventually decide "no, we will keep things as they are now". |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 4, 2018](#issuecomment-418407385)

| I'm a maintainer and can promise you that Cezar97's reports will always be something that I listen to.  Speaking of being a maintainer, I have the ability to push to your branch, I can work on the tests, however I like to ask permission before I make changes to someones branch, so is it ok if I work on your branch to resolve these failing tests? |
| --- |

 👍
1
 adelowo reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 5, 2018](#issuecomment-418594731) • edited Loading

| [@techknowlogick](https://github.com/techknowlogick) yes please do so and enforce token policy on API routes asap. If you need to, I can add your public ssh key to my repo so you have full access to that branch.  I have done internal tests and confirmed that browsers automatically send cookie along with cross site requests (GET and POST). Modern browsers have built-in same origin security policy and do not expose responses of certain content type to JavaScript. However such protection may not cover json/jsonp response. API routes accept cookie alone, skip csrf token check, and respond with json, and thus are not covered by browsers' same origin policy protection. API Routes are vulnerable to malicious scripts on another site, no XSS required. This may lead to theft/deletion of private code. Please do act quickly. Malicious scripts do not have direct access to victim's cookie, but can take advantage of browsers' behaviour and perform GET/POST actions from another site, using victim's cookie indirectly. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 5, 2018](#issuecomment-418598161)

| [@techknowlogick](https://github.com/techknowlogick) I think all maintainers can already make changes to the forked branch as I have enabled "Allow edits from maintainers". Please let me know if any action is required from me. thank you. |
| --- |

All reactions

Sorry, something went wrong.

 [techknowlogick](/techknowlogick)
added 13 commits
[September 5, 2018 15:10](#commits-pushed-26eb5da)

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[add function to get a new token for logged in user](/go-gitea/gitea/pull/4840/commits/26eb5da6271eefbd6f477f1398a9be124b391f62 "add function to get a new token for logged in user")`

`[26eb5da](/go-gitea/gitea/pull/4840/commits/26eb5da6271eefbd6f477f1398a9be124b391f62)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[test api create with token](/go-gitea/gitea/pull/4840/commits/5a3e4c8a416b243e5e3f6d46543be8a3f42b9c57 "test api create with token")`

`[5a3e4c8](/go-gitea/gitea/pull/4840/commits/5a3e4c8a416b243e5e3f6d46543be8a3f42b9c57)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[make fmt fix](/go-gitea/gitea/pull/4840/commits/14cc933f99132a61f5af0ab78de87bcf8e74e02b "make fmt fix")`

`[14cc933](/go-gitea/gitea/pull/4840/commits/14cc933f99132a61f5af0ab78de87bcf8e74e02b)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[update function](/go-gitea/gitea/pull/4840/commits/fe457315b0dea7d854a87d9ea5cb34c9e1c529f0 "update function")`

`[fe45731](/go-gitea/gitea/pull/4840/commits/fe457315b0dea7d854a87d9ea5cb34c9e1c529f0)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update api_comment_test.go](/go-gitea/gitea/pull/4840/commits/1c7615a8a897388adb3ce84f59505396e5385aac "Update api_comment_test.go")`

`[1c7615a](/go-gitea/gitea/pull/4840/commits/1c7615a8a897388adb3ce84f59505396e5385aac)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[make fmt fix](/go-gitea/gitea/pull/4840/commits/3c381279840c03c9c35c3b952182adecf71989ba "make fmt fix")`

`[3c38127](/go-gitea/gitea/pull/4840/commits/3c381279840c03c9c35c3b952182adecf71989ba)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[fix build errors](/go-gitea/gitea/pull/4840/commits/83f01a8c631e9327c1d62b82582f16269219755f "fix build errors")`

`[83f01a8](/go-gitea/gitea/pull/4840/commits/83f01a8c631e9327c1d62b82582f16269219755f)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Merge branch 'master' into api-routes-enforce-token](/go-gitea/gitea/pull/4840/commits/7ab90a5fa5fa1acce04ae8ca23316595fa5034d3 "Merge branch 'master' into api-routes-enforce-token")`

`[7ab90a5](/go-gitea/gitea/pull/4840/commits/7ab90a5fa5fa1acce04ae8ca23316595fa5034d3)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update integration_test.go](/go-gitea/gitea/pull/4840/commits/9afd9227c79d434eca5263d46093e40c8397ce8a "Update integration_test.go")`

`[9afd922](/go-gitea/gitea/pull/4840/commits/9afd9227c79d434eca5263d46093e40c8397ce8a)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update integration_test.go](/go-gitea/gitea/pull/4840/commits/6420202ee39caf2c4c9654d414472685dae0d517 "Update integration_test.go")`

`[6420202](/go-gitea/gitea/pull/4840/commits/6420202ee39caf2c4c9654d414472685dae0d517)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[add an extra doc](/go-gitea/gitea/pull/4840/commits/dbf3b33d6891e3e755482fdc541439bb260429e4 "add an extra doc")`

`[dbf3b33](/go-gitea/gitea/pull/4840/commits/dbf3b33d6891e3e755482fdc541439bb260429e4)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update integration_test.go](/go-gitea/gitea/pull/4840/commits/5dbef59d07b3d74e339ba08a488e881e5ce3f564 "Update integration_test.go")`

`[5dbef59](/go-gitea/gitea/pull/4840/commits/5dbef59d07b3d74e339ba08a488e881e5ce3f564)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update integration_test.go](/go-gitea/gitea/pull/4840/commits/5787fd2b14f26cc083cb590a825ace8bb5c61549 "Update integration_test.go")`

`[5787fd2](/go-gitea/gitea/pull/4840/commits/5787fd2b14f26cc083cb590a825ace8bb5c61549)`

26 hidden items

Load more…

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 6, 2018](#issuecomment-418927676)

| 🎉 Woooo! Tests now pass!  (again, I'm so sorry for all of the commits, I'm still on mobile and am using the web editor which is extra difficult because it doesn't exist in mobile version of GitHub) |
| --- |

 ❤️
1
 aunger reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 6, 2018](#issuecomment-418933990)

| [@techknowlogick](https://github.com/techknowlogick) Thank you for the hard work! I don't mind the commit emails at all. These serve as time sheets to show you have spent 6 hours debugging and fixing the tests. Well done. Highly appreciated. |
| --- |

 👍
1
 aunger reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=80&u=4694f03b321aa2287d9fe05155adcddb23272e81&v=4)](/codecov-io)

Copy link

### **[codecov-io](/codecov-io)** commented [Sep 6, 2018](#issuecomment-418934537) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=h1) Report Merging [#4840](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=desc) into [master](https://codecov.io/gh/go-gitea/gitea/commit/387a4b09c1b62a2a5eb70b89559d5ae53032c989?src=pr&el=desc) will **increase** coverage by `0.06%`. The diff coverage is `100%`.  [Impacted file tree graph](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=tree)  ``` @@            Coverage Diff             @@ ##           master    #4840      +/-   ## ========================================== + Coverage   37.32%   37.38%   +0.06%      ==========================================   Files         305      305                 Lines       45219    45221       +2      ========================================== + Hits        16876    16907      +31      + Misses      25905    25873      -32      - Partials     2438     2441       +3 ```  | [Impacted Files](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=tree) | Coverage Δ |  | | --- | --- | --- | | [modules/auth/auth.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-bW9kdWxlcy9hdXRoL2F1dGguZ28=) | `55.24% <100%> (+2.73%)` | ⬆️ | | [routers/api/v1/api.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-cm91dGVycy9hcGkvdjEvYXBpLmdv) | `75.37% <100%> (ø)` | ⬆️ | | [models/repo\_list.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-bW9kZWxzL3JlcG9fbGlzdC5nbw==) | `56.37% <0%> (-1.35%)` | ⬇️ | | [modules/process/manager.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-bW9kdWxlcy9wcm9jZXNzL21hbmFnZXIuZ28=) | `81.15% <0%> (+4.34%)` | ⬆️ | | [modules/auth/user\_form.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-bW9kdWxlcy9hdXRoL3VzZXJfZm9ybS5nbw==) | `28.57% <0%> (+7.14%)` | ⬆️ | | [routers/user/setting/applications.go](https://codecov.io/gh/go-gitea/gitea/pull/4840/diff?src=pr&el=tree#diff-cm91dGVycy91c2VyL3NldHRpbmcvYXBwbGljYXRpb25zLmdv) | `48.88% <0%> (+48.88%)` | ⬆️ |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=continue).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=footer). Last update [387a4b0...40a2419](https://codecov.io/gh/go-gitea/gitea/pull/4840?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments). |

All reactions

Sorry, something went wrong.

[![lunny](https://avatars.githubusercontent.com/u/81045?s=60&v=4)](/lunny)

**[lunny](/lunny)**
requested changes
[Sep 6, 2018](#pullrequestreview-152747639)

 [View reviewed changes](/go-gitea/gitea/pull/4840/files/8646332be37cfedd9e930460e9ed521b174fbd15)

Copy link

Member

### @lunny **[lunny](/lunny)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Some ajax requests on the UI used `/api/v1/**`, some page and feature will be broken if this PR merged. refs:

<https://github.com/go-gitea/gitea/blob/master/public/js/index.js#L1459>

<https://github.com/go-gitea/gitea/blob/master/public/js/index.js#L1486>

<https://github.com/go-gitea/gitea/blob/master/public/js/index.js#L2087>

<https://github.com/go-gitea/gitea/blob/master/public/js/index.js#L2507>

<https://github.com/go-gitea/gitea/blob/master/public/js/index.js#L2630>

That routes have to be replaced before this PR merged.

Sorry, something went wrong.

All reactions

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 6, 2018](#issuecomment-418942104)

| [@lunny](https://github.com/lunny) As I wrote in the comment when submitting the PR, API routes used by front end ajax requests do not have reqToken middleware, and are not affected. These routes will continue to work, are all GET requests performing no action to change state or modify data. These routes and handler functions can be addressed with another PR. what do you think? |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 6, 2018](#issuecomment-418946066)

| [@beeonthego](https://github.com/beeonthego) oh my, I didn't even realize that was the amount of time I spent 😬 I would've been faster if only I wasn't on mobile. |
| --- |

All reactions

Sorry, something went wrong.

[![lunny](https://avatars.githubusercontent.com/u/81045?s=60&v=4)](/lunny)

**[lunny](/lunny)**
approved these changes
[Sep 6, 2018](#pullrequestreview-152755694)

 [View reviewed changes](/go-gitea/gitea/pull/4840/files/8646332be37cfedd9e930460e9ed521b174fbd15)

Copy link

Member

### @lunny **[lunny](/lunny)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@beeonthego](https://github.com/beeonthego) that makes sense.

Sorry, something went wrong.

All reactions

[![@bkcsoft](https://avatars.githubusercontent.com/u/4726179?s=40&v=4)](/bkcsoft)
[bkcsoft](/bkcsoft)
added
[lgtm/need 1](/go-gitea/gitea/labels/lgtm/need%201)
This PR needs approval from one additional maintainer to be merged.
and removed
[lgtm/need 2](/go-gitea/gitea/labels/lgtm/need%202)
This PR needs two approvals by maintainers to be considered for merging.
labels
[Sep 6, 2018](#event-1829346860)

[![@lunny](https://avatars.githubusercontent.com/u/81045?s=40&u=99b64f0ca6ef63643c7583ab87dd31c52d28e673&v=4)](/lunny)
[lunny](/lunny)
added this to the [1.6.0](/go-gitea/gitea/milestone/24) milestone
[Sep 6, 2018](#event-1829347661)

[![@lunny](https://avatars.githubusercontent.com/u/81045?s=40&u=99b64f0ca6ef63643c7583ab87dd31c52d28e673&v=4)](/lunny)
[lunny](/lunny)
added
the
[backport/v1.5](/go-gitea/gitea/labels/backport/v1.5)
label
[Sep 6, 2018](#event-1829347800)

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 6, 2018](#issuecomment-418953881)

| [@techknowlogick](https://github.com/techknowlogick) It took me hours to trace functions in different modules, search the JavaScript to see the potential impact, and finally come up with 3 lines of code. Time goes by faster in front of screens, big or small. Thank you for the hard work on the tests. We now have one less thing to worry about. Cheers! |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Merge branch 'master' into api-routes-enforce-token](/go-gitea/gitea/pull/4840/commits/4093d15d5f9268b356e03b5ae6b54e8cf0f6e517 "Merge branch 'master' into api-routes-enforce-token")`

`[4093d15](/go-gitea/gitea/pull/4840/commits/4093d15d5f9268b356e03b5ae6b54e8cf0f6e517)`

[![ghost](https://avatars.githubusercontent.com/u/10137?s=60&v=4)](/ghost)

**[ghost](/ghost)**
approved these changes
[Sep 9, 2018](#pullrequestreview-153595788)

 [View reviewed changes](/go-gitea/gitea/pull/4840/files/4093d15d5f9268b356e03b5ae6b54e8cf0f6e517)

[![@bkcsoft](https://avatars.githubusercontent.com/u/4726179?s=40&v=4)](/bkcsoft)
[bkcsoft](/bkcsoft)
added
[lgtm/done](/go-gitea/gitea/labels/lgtm/done)
This PR has enough approvals to get merged. There are no important open reservations anymore.
and removed
[lgtm/need 1](/go-gitea/gitea/labels/lgtm/need%201)
This PR needs approval from one additional maintainer to be merged.
labels
[Sep 9, 2018](#event-1834780768)

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

### **[ghost](/ghost)** commented [Sep 9, 2018](#issuecomment-419750881)

| [@techknowlogick](https://github.com/techknowlogick) [@beeonthego](https://github.com/beeonthego) new test needs to get updated too, is good otherwise |
| --- |

All reactions

Sorry, something went wrong.

 [techknowlogick](/techknowlogick)
added 3 commits
[September 10, 2018 11:23](#commits-pushed-a74435b)

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update api_admin_test.go](/go-gitea/gitea/pull/4840/commits/a74435b40ad17294470faaef0591d43ff73d2c90 "Update api_admin_test.go")`

`[a74435b](/go-gitea/gitea/pull/4840/commits/a74435b40ad17294470faaef0591d43ff73d2c90)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Update api_admin_test.go](/go-gitea/gitea/pull/4840/commits/3d73f40d7310d31d00c5fbe4b36bc8cde7a6dce3 "Update api_admin_test.go")`

`[3d73f40](/go-gitea/gitea/pull/4840/commits/3d73f40d7310d31d00c5fbe4b36bc8cde7a6dce3)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&v=4)](/techknowlogick)

`[Merge branch 'master' into api-routes-enforce-token](/go-gitea/gitea/pull/4840/commits/40a2419640625bfd31c0e4e24977ee3f56ad6baa "Merge branch 'master' into api-routes-enforce-token")`

`[40a2419](/go-gitea/gitea/pull/4840/commits/40a2419640625bfd31c0e4e24977ee3f56ad6baa)`

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)
[techknowlogick](/techknowlogick)
merged commit [`e47df0b`](/go-gitea/gitea/commit/e47df0b301510a49b49fc43266f436b7d58a02b1)
into
go-gitea:master

[Sep 10, 2018](https://github.com/go-gitea/gitea/pull/4840#event-1836437603)

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 10, 2018](#issuecomment-419974016)

| [@beeonthego](https://github.com/beeonthego) would you be able to backport this to the `release/v1.5` branch? If not let me know and I'll do it. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 10, 2018](#issuecomment-420062356)

| [@techknowlogick](https://github.com/techknowlogick) could you backport it to release/v1.5? thank you. |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)
[techknowlogick](/techknowlogick)
mentioned this pull request
[Sep 10, 2018](#ref-pullrequest-358820739)

[backport "Enforce token on api routes (#4840)"
#4905](/go-gitea/gitea/pull/4905)
 Merged

[techknowlogick](/techknowlogick)
added a commit
that referenced
this pull request
[Sep 11, 2018](#ref-commit-1a68b39)
[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

`[backport "Enforce token on api routes (](/go-gitea/gitea/commit/1a68b3962f085e66ae5974aae5cfcb4c99e94c1c "backport \"Enforce token on api routes (#4840)\" (#4905)")[#4840](https://github.com/go-gitea/gitea/pull/4840)[)" (](/go-gitea/gitea/commit/1a68b3962f085e66ae5974aae5cfcb4c99e94c1c "backport \"Enforce token on api routes (#4840)\" (#4905)")[#4905](https://github.com/go-gitea/gitea/pull/4905)[)](/go-gitea/gitea/commit/1a68b3962f085e66ae5974aae5cfcb4c99e94c1c "backport \"Enforce token on api routes (#4840)\" (#4905)")`

`[1a68b39](/go-gitea/gitea/commit/1a68b3962f085e66ae5974aae5cfcb4c99e94c1c)`

[aswild](/aswild)
added a commit
to aswild/gitea
that referenced
this pull request
[Oct 24, 2018](#ref-commit-6ebfa9c)
[![@aswild](https://avatars.githubusercontent.com/u/11742669?s=40&v=4)](/aswild)

`[Merge tag 'v1.6.0-rc1'](/aswild/gitea/commit/6ebfa9cb1deaab64814898aa78a6f0ae7854d5f4 "Merge tag 'v1.6.0-rc1'

Prepare for wild/v1.6 branch

* BREAKING
  * Respect email privacy option in user search via API (#4512)
  * Simply remove tidb and deps (#3993)
  * Swagger.v1.json template (#3572)
* FEATURE
  * Pull request review/approval and comment on code (#3748)
  * Added dependencies for issues (#2196) (#2531)
  * Add the ability to have built in themes in Gitea and provide dark theme arc-green (#4198)
  * Add sudo functionality to the API (#4809)
  * Add oauth providers via cli (#4591)
  * Disable merging a WIP Pull request (#4529)
  * Force user to change password (#4489)
  * Add letsencrypt to Gitea (#4189)
  * Add push webhook support for mirrored repositories (#4127)
  * Add csv file render support defaultly (#4105)
  * Add Recaptcha functionality to Gitea (#4044)
* BUGFIXES
  * Fix release creation via API (#5076)
  * Remove links from topics in edit mode  (#5026)
  * Fix missing AppSubUrl in few more templates (fixup) (#5021)
  * Fix missing AppSubUrl in some templates (#5020)
  * Hide outdated comments in file view (#5017)
  * Upgrade gopkg.in/testfixtures.v2 (#4999)
  * Disable debug routes unless PPROF is enabled in configuration (#4995)
  * Fix user menu item styling (#4985)
  * Fix layout of the topics editing form (#4971)
  * Fix null pointer dereference in ParseCommitWithSignature (#4962)
  * Fix url in discord webhook (#4953)
  * Detect charset and convert non UTF-8 files for display (#4950)
  * Make sure to catch the right error so it is displayed on the UI (#4945)
  * Fix(topics): don't redirect to explore page. (#4938)
  * Fix bug forget to remove Stopwatch when remove repository (#4928)
  * Fix bug when repo remained bare if multiple branches pushed in single push (#4923)
  * Fix: Let's Encrypt configuration settings (#4911)
  * Fix: Crippled diff (#4726) (#4900)
  * Fix trimming of markup section names (#4863)
  * Issues api allow pulls and fix #4832 (#4852)
  * Do not autocreate directory for new users/orgs (#4828) (#4849)
  * Fix redirect with non-ascii branch names (#4764) (#4810)
  * Fix missing release title in webhook (#4783) (#4796)
  * User shouldn't be able to approve or reject his/her own PR (#4729)
  * Make sure to reset commit count in the cache on mirror syncing (#4720)
  * Fixed bug where team with admin privelege type doesn't get any unit  (#4719)
  * Fix incorrect caption of webhook setting (#4701) (#4717)
  * Allow WIP marker to contains < or > (#4709)
  * Hide org/create menu item in Dashboard if user has no rights (#4678) (#4680)
  * Site admin could create repos even MAX_CREATION_LIMIT=0 (#4645)
  * Fix custom templates being ignored (#4638)
  * Fix starring icon after semantic ui update (#4628)
  * Fix Split-View line adjustment (#4622)
  * Fix integer constant overflows in tests (#4616)
  * Push whitelist now doesn't apply to branch deletion (#4601) (#4607)
  * Fix bugs when too many IN variables (#4594)
  * Fix failure on creating pull request with assignees (#4419) (#4583)
  * Fix panic issue on update avatar email (#4580) (#4581)
  * Fix status code label for a successful webhook (#4540)
  * An inactive user shouldn't be able to be added as a collaborator (#4535)
  * Don't fail silently if trying to add a collaborator twice (#4533)
  * Fix incorrect MergeWhitelistTeamIDs check in CanUserMerge function (#4519) (#4525)
  * Fix out-of-transaction query in removeOrgUser (#4521) (#4522)
  * Fix migration from older releases (#4495)
  * Accept 'Data:' in commit graph (#4487)
  * Update xorm to latest version and fix correct `user` table referencing in sql (#4473)
  * Relative URLs for LibreJS page (#4460)
  * Redirect to correct page after using scratch token (#4458)
  * Fix column droping for MSSQL that need new transaction for that (#4440)
  * Replace src with raw to fix image paths (#4377)
  * Add default merge options when creating new repository (#4369)
  * Fix docker build (#4358)
  * Fixes repo membership check in API (#4341)
  * Dep upgrade mysql lib (#4161)
  * Fix some issues with special chars in branch names (#3767)
  * Responsive design fixes (#4508)
* ENHANCEMENT
  * Fix milestones sorted wrongly (#4987)
  * Allow api to create tags for releases if they don't exist (#4890)
  * Fix #4877 to follow the OpenID Connect Audiences spec (#4878)
  * Enforce token on api routes [fixed critical security issue #4357] (#4840)
  * Update legacy branch and tag URLs in dashboard to new format (#4812)
  * Slack webhook channel name cannot be empty or just contain an hashtag (#4786)
  * Add whitespace handling to PR-comparsion (#4683)
  * Make reverse proxy auth optional (#4643)
  * MySQL TLS (#4642)
  * Make sure to set PR split view when creating/previewing a pull request  (#4617)
  * Log user in after a successful sign up (#4615)
  * Fix typo IsPullReuqestBroken -> IsPullRequestBroken (#4578)
  * Allow admin toggle forcing a password change for newly created users (#4563)
  * Update jQuery to v1.12.4 (#4551)
  * Env var GITEA_PUSHER_EMAIL (#4516)
  * Feat(repo): support search repository by topic name (#4505)
  * Small improvements to dependency UI (#4503)
  * Make max commits in graph configurable (#4498)
  * Add valid for lfs oid (#4461)
  * Add shortcut to save wiki page (#4452)
  * Allow administrator to create repository for any organization (#4368)
  * Fix repository last updated time update when delete a user who watched the repo (#4363)
  * Switch plaintext scratch tokens to use hash instead (#4331)
  * Increase default TOTP secret size to 320 bits (#4287)
  * Keep preseeded database password (#4284)
  * Implemented hover text showing user FullName (#4261)
  * Add ability to delete a token (#4235)
  * Fix typos in i18n variable names. (#4080)
  * Api: repos/search: add parameters to control the sort order (#3964)
  * Add missing path in the Docker app.ini template (#2181)
  * Add file name and branch to page title (#4902)
  * Offline use of google fonts (#4872)
  * Add missing History link to directory listings v2 (#4829)
  * Locale for Edit and Remove due date issue (#4802)
  * Disable 'May Import Local Repository' when is disabled by setting (Is… (#4780)
  * API /admin/users/{username} missing parameter (#4775)
  * Display error when adding a user to a team twice (#4746)
  * Remove UsePrivilegeSeparation from the Docker sshd_config, see #2876 (#4722)
  * Focus title input when clicking helper link (#4696)
  * Add vendor to user reserved words and format words list according alphabet (#4685)
  * Add gitea/issues link to 500 page (#4654)
  * Hide home button when landing page is not set to home (#4651)
  * Remove link to GitHub issues in 404 template (#4639)
  * Cmd/serve: pprof cpu and memory profile dumps to disk (#4560)
  * Add flash message after an account has been successfully activated (#4510)
  * Prevent html entity escaping on delete branch (#4471)
  * Locale for button Edit on protected branch (#4442)
  * Update notification icon (#4343)
  * Added front-end topics validation (#4316)
  * Don't display buttons if there are no system notifications (#4280)
  * Issue due date api (#3890)
* SECURITY
  * Improve URL validation for external wiki  and external issues (#4710)
  * Make cookies HttpOnly and obey COOKIE_SECURE flag (#4706)
  * Don't disclose emails of all users when sending out emails (#4664)
  * Check that repositories can only be migrated to own user or organizations (#4366)
* TRANSLATION
  * Fix punctuation in English translation (#4958)
  * Fix translation (#4355)")`
…

`[6ebfa9c](/aswild/gitea/commit/6ebfa9cb1deaab64814898aa78a6f0ae7854d5f4)`

```
Prepare for wild/v1.6 branch

* BREAKING
  * Respect email privacy option in user search via API ([go-gitea#4512](https://github.com/go-gitea/gitea/pull/4512))
  * Simply remove tidb and deps ([go-gitea#3993](https://github.com/go-gitea/gitea/pull/3993))
  * Swagger.v1.json template ([go-gitea#3572](https://github.com/go-gitea/gitea/pull/3572))
* FEATURE
  * Pull request review/approval and comment on code ([go-gitea#3748](https://github.com/go-gitea/gitea/pull/3748))
  * Added dependencies for issues ([go-gitea#2196](https://github.com/go-gitea/gitea/issues/2196)) ([go-gitea#2531](https://github.com/go-gitea/gitea/pull/2531))
  * Add the ability to have built in themes in Gitea and provide dark theme arc-green ([go-gitea#4198](https://github.com/go-gitea/gitea/pull/4198))
  * Add sudo functionality to the API ([go-gitea#4809](https://github.com/go-gitea/gitea/pull/4809))
  * Add oauth providers via cli ([go-gitea#4591](https://github.com/go-gitea/gitea/pull/4591))
  * Disable merging a WIP Pull request ([go-gitea#4529](https://github.com/go-gitea/gitea/pull/4529))
  * Force user to change password ([go-gitea#4489](https://github.com/go-gitea/gitea/pull/4489))
  * Add letsencrypt to Gitea ([go-gitea#4189](https://github.com/go-gitea/gitea/pull/4189))
  * Add push webhook support for mirrored repositories ([go-gitea#4127](https://github.com/go-gitea/gitea/pull/4127))
  * Add csv file render support defaultly ([go-gitea#4105](https://github.com/go-gitea/gitea/pull/4105))
  * Add Recaptcha functionality to Gitea ([go-gitea#4044](https://github.com/go-gitea/gitea/pull/4044))
* BUGFIXES
  * Fix release creation via API ([go-gitea#5076](https://github.com/go-gitea/gitea/pull/5076))
  * Remove links from topics in edit mode  ([go-gitea#5026](https://github.com/go-gitea/gitea/pull/5026))
  * Fix missing AppSubUrl in few more templates (fixup) ([go-gitea#5021](https://github.com/go-gitea/gitea/pull/5021))
  * Fix missing AppSubUrl in some templates ([go-gitea#5020](https://github.com/go-gitea/gitea/pull/5020))
  * Hide outdated comments in file view ([go-gitea#5017](https://github.com/go-gitea/gitea/pull/5017))
  * Upgrade gopkg.in/testfixtures.v2 ([go-gitea#4999](https://github.com/go-gitea/gitea/pull/4999))
  * Disable debug routes unless PPROF is enabled in configuration ([go-gitea#4995](https://github.com/go-gitea/gitea/pull/4995))
  * Fix user menu item styling ([go-gitea#4985](https://github.com/go-gitea/gitea/pull/4985))
  * Fix layout of the topics editing form ([go-gitea#4971](https://github.com/go-gitea/gitea/pull/4971))
  * Fix null pointer dereference in ParseCommitWithSignature ([go-gitea#4962](https://github.com/go-gitea/gitea/pull/4962))
  * Fix url in discord webhook ([go-gitea#4953](https://github.com/go-gitea/gitea/pull/4953))
  * Detect charset and convert non UTF-8 files for display ([go-gitea#4950](https://github.com/go-gitea/gitea/pull/4950))
  * Make sure to catch the right error so it is displayed on the UI ([go-gitea#4945](https://github.com/go-gitea/gitea/pull/4945))
  * Fix(topics): don't redirect to explore page. ([go-gitea#4938](https://github.com/go-gitea/gitea/pull/4938))
  * Fix bug forget to remove Stopwatch when remove repository ([go-gitea#4928](https://github.com/go-gitea/gitea/pull/4928))
  * Fix bug when repo remained bare if multiple branches pushed in single push ([go-gitea#4923](https://github.com/go-gitea/gitea/pull/4923))
  * Fix: Let's Encrypt configuration settings ([go-gitea#4911](https://github.com/go-gitea/gitea/pull/4911))
  * Fix: Crippled diff ([go-gitea#4726](https://github.com/go-gitea/gitea/issues/4726)) ([go-gitea#4900](https://github.com/go-gitea/gitea/pull/4900))
  * Fix trimming of markup section names ([go-gitea#4863](https://github.com/go-gitea/gitea/pull/4863))
  * Issues api allow pulls and fix [go-gitea#4832](https://github.com/go-gitea/gitea/issues/4832) ([go-gitea#4852](https://github.com/go-gitea/gitea/pull/4852))
  * Do not autocreate directory for new users/orgs ([go-gitea#4828](https://github.com/go-gitea/gitea/issues/4828)) ([go-gitea#4849](https://github.com/go-gitea/gitea/pull/4849))
  * Fix redirect with non-ascii branch names ([go-gitea#4764](https://github.com/go-gitea/gitea/issues/4764)) ([go-gitea#4810](https://github.com/go-gitea/gitea/pull/4810))
  * Fix missing release title in webhook ([go-gitea#4783](https://github.com/go-gitea/gitea/issues/4783)) ([go-gitea#4796](https://github.com/go-gitea/gitea/pull/4796))
  * User shouldn't be able to approve or reject his/her own PR ([go-gitea#4729](https://github.com/go-gitea/gitea/pull/4729))
  * Make sure to reset commit count in the cache on mirror syncing ([go-gitea#4720](https://github.com/go-gitea/gitea/pull/4720))
  * Fixed bug where team with admin privelege type doesn't get any unit  ([go-gitea#4719](https://github.com/go-gitea/gitea/pull/4719))
  * Fix incorrect caption of webhook setting ([go-gitea#4701](https://github.com/go-gitea/gitea/issues/4701)) ([go-gitea#4717](https://github.com/go-gitea/gitea/pull/4717))
  * Allow WIP marker to contains < or > ([go-gitea#4709](https://github.com/go-gitea/gitea/pull/4709))
  * Hide org/create menu item in Dashboard if user has no rights ([go-gitea#4678](https://github.com/go-gitea/gitea/issues/4678)) ([go-gitea#4680](https://github.com/go-gitea/gitea/pull/4680))
  * Site admin could create repos even MAX_CREATION_LIMIT=0 ([go-gitea#4645](https://github.com/go-gitea/gitea/pull/4645))
  * Fix custom templates being ignored ([go-gitea#4638](https://github.com/go-gitea/gitea/pull/4638))
  * Fix starring icon after semantic ui update ([go-gitea#4628](https://github.com/go-gitea/gitea/pull/4628))
  * Fix Split-View line adjustment ([go-gitea#4622](https://github.com/go-gitea/gitea/pull/4622))
  * Fix integer constant overflows in tests ([go-gitea#4616](https://github.com/go-gitea/gitea/pull/4616))
  * Push whitelist now doesn't apply to branch deletion ([go-gitea#4601](https://github.com/go-gitea/gitea/issues/4601)) ([go-gitea#4607](https://github.com/go-gitea/gitea/pull/4607))
  * Fix bugs when too many IN variables ([go-gitea#4594](https://github.com/go-gitea/gitea/pull/4594))
  * Fix failure on creating pull request with assignees ([go-gitea#4419](https://github.com/go-gitea/gitea/issues/4419)) ([go-gitea#4583](https://github.com/go-gitea/gitea/pull/4583))
  * Fix panic issue on update avatar email ([go-gitea#4580](https://github.com/go-gitea/gitea/issues/4580)) ([go-gitea#4581](https://github.com/go-gitea/gitea/pull/4581))
  * Fix status code label for a successful webhook ([go-gitea#4540](https://github.com/go-gitea/gitea/pull/4540))
  * An inactive user shouldn't be able to be added as a collaborator ([go-gitea#4535](https://github.com/go-gitea/gitea/pull/4535))
  * Don't fail silently if trying to add a collaborator twice ([go-gitea#4533](https://github.com/go-gitea/gitea/pull/4533))
  * Fix incorrect MergeWhitelistTeamIDs check in CanUserMerge function ([go-gitea#4519](https://github.com/go-gitea/gitea/issues/4519)) ([go-gitea#4525](https://github.com/go-gitea/gitea/pull/4525))
  * Fix out-of-transaction query in removeOrgUser ([go-gitea#4521](https://github.com/go-gitea/gitea/issues/4521)) ([go-gitea#4522](https://github.com/go-gitea/gitea/pull/4522))
  * Fix migration from older releases ([go-gitea#4495](https://github.com/go-gitea/gitea/pull/4495))
  * Accept 'Data:' in commit graph ([go-gitea#4487](https://github.com/go-gitea/gitea/pull/4487))
  * Update xorm to latest version and fix correct `user` table referencing in sql ([go-gitea#4473](https://github.com/go-gitea/gitea/pull/4473))
  * Relative URLs for LibreJS page ([go-gitea#4460](https://github.com/go-gitea/gitea/pull/4460))
  * Redirect to correct page after using scratch token ([go-gitea#4458](https://github.com/go-gitea/gitea/pull/4458))
  * Fix column droping for MSSQL that need new transaction for that ([go-gitea#4440](https://github.com/go-gitea/gitea/pull/4440))
  * Replace src with raw to fix image paths ([go-gitea#4377](https://github.com/go-gitea/gitea/pull/4377))
  * Add default merge options when creating new repository ([go-gitea#4369](https://github.com/go-gitea/gitea/pull/4369))
  * Fix docker build ([go-gitea#4358](https://github.com/go-gitea/gitea/pull/4358))
  * Fixes repo membership check in API ([go-gitea#4341](https://github.com/go-gitea/gitea/pull/4341))
  * Dep upgrade mysql lib ([go-gitea#4161](https://github.com/go-gitea/gitea/pull/4161))
  * Fix some issues with special chars in branch names ([go-gitea#3767](https://github.com/go-gitea/gitea/pull/3767))
  * Responsive design fixes ([go-gitea#4508](https://github.com/go-gitea/gitea/pull/4508))
* ENHANCEMENT
  * Fix milestones sorted wrongly ([go-gitea#4987](https://github.com/go-gitea/gitea/pull/4987))
  * Allow api to create tags for releases if they don't exist ([go-gitea#4890](https://github.com/go-gitea/gitea/pull/4890))
  * Fix [go-gitea#4877](https://github.com/go-gitea/gitea/issues/4877) to follow the OpenID Connect Audiences spec ([go-gitea#4878](https://github.com/go-gitea/gitea/pull/4878))
  * Enforce token on api routes [fixed critical security issue [go-gitea#4357](https://github.com/go-gitea/gitea/issues/4357)] ([go-gitea#4840](https://github.com/go-gitea/gitea/pull/4840))
  * Update legacy branch and tag URLs in dashboard to new format ([go-gitea#4812](https://github.com/go-gitea/gitea/pull/4812))
  * Slack webhook channel name cannot be empty or just contain an hashtag ([go-gitea#4786](https://github.com/go-gitea/gitea/pull/4786))
  * Add whitespace handling to PR-comparsion ([go-gitea#4683](https://github.com/go-gitea/gitea/pull/4683))
  * Make reverse proxy auth optional ([go-gitea#4643](https://github.com/go-gitea/gitea/pull/4643))
  * MySQL TLS ([go-gitea#4642](https://github.com/go-gitea/gitea/pull/4642))
  * Make sure to set PR split view when creating/previewing a pull request  ([go-gitea#4617](https://github.com/go-gitea/gitea/pull/4617))
  * Log user in after a successful sign up ([go-gitea#4615](https://github.com/go-gitea/gitea/pull/4615))
  * Fix typo IsPullReuqestBroken -> IsPullRequestBroken ([go-gitea#4578](https://github.com/go-gitea/gitea/pull/4578))
  * Allow admin toggle forcing a password change for newly created users ([go-gitea#4563](https://github.com/go-gitea/gitea/pull/4563))
  * Update jQuery to v1.12.4 ([go-gitea#4551](https://github.com/go-gitea/gitea/pull/4551))
  * Env var GITEA_PUSHER_EMAIL ([go-gitea#4516](https://github.com/go-gitea/gitea/pull/4516))
  * Feat(repo): support search repository by topic name ([go-gitea#4505](https://github.com/go-gitea/gitea/pull/4505))
  * Small improvements to dependency UI ([go-gitea#4503](https://github.com/go-gitea/gitea/pull/4503))
  * Make max commits in graph configurable ([go-gitea#4498](https://github.com/go-gitea/gitea/pull/4498))
  * Add valid for lfs oid ([go-gitea#4461](https://github.com/go-gitea/gitea/pull/4461))
  * Add shortcut to save wiki page ([go-gitea#4452](https://github.com/go-gitea/gitea/pull/4452))
  * Allow administrator to create repository for any organization ([go-gitea#4368](https://github.com/go-gitea/gitea/pull/4368))
  * Fix repository last updated time update when delete a user who watched the repo ([go-gitea#4363](https://github.com/go-gitea/gitea/pull/4363))
  * Switch plaintext scratch tokens to use hash instead ([go-gitea#4331](https://github.com/go-gitea/gitea/pull/4331))
  * Increase default TOTP secret size to 320 bits ([go-gitea#4287](https://github.com/go-gitea/gitea/pull/4287))
  * Keep preseeded database password ([go-gitea#4284](https://github.com/go-gitea/gitea/pull/4284))
  * Implemented hover text showing user FullName ([go-gitea#4261](https://github.com/go-gitea/gitea/pull/4261))
  * Add ability to delete a token ([go-gitea#4235](https://github.com/go-gitea/gitea/pull/4235))
  * Fix typos in i18n variable names. ([go-gitea#4080](https://github.com/go-gitea/gitea/pull/4080))
  * Api: repos/search: add parameters to control the sort order ([go-gitea#3964](https://github.com/go-gitea/gitea/pull/3964))
  * Add missing path in the Docker app.ini template ([go-gitea#2181](https://github.com/go-gitea/gitea/pull/2181))
  * Add file name and branch to page title ([go-gitea#4902](https://github.com/go-gitea/gitea/pull/4902))
  * Offline use of google fonts ([go-gitea#4872](https://github.com/go-gitea/gitea/pull/4872))
  * Add missing History link to directory listings v2 ([go-gitea#4829](https://github.com/go-gitea/gitea/pull/4829))
  * Locale for Edit and Remove due date issue ([go-gitea#4802](https://github.com/go-gitea/gitea/pull/4802))
  * Disable 'May Import Local Repository' when is disabled by setting (Is… ([go-gitea#4780](https://github.com/go-gitea/gitea/pull/4780))
  * API /admin/users/{username} missing parameter ([go-gitea#4775](https://github.com/go-gitea/gitea/pull/4775))
  * Display error when adding a user to a team twice ([go-gitea#4746](https://github.com/go-gitea/gitea/pull/4746))
  * Remove UsePrivilegeSeparation from the Docker sshd_config, see [go-gitea#2876](https://github.com/go-gitea/gitea/issues/2876) ([go-gitea#4722](https://github.com/go-gitea/gitea/pull/4722))
  * Focus title input when clicking helper link ([go-gitea#4696](https://github.com/go-gitea/gitea/pull/4696))
  * Add vendor to user reserved words and format words list according alphabet ([go-gitea#4685](https://github.com/go-gitea/gitea/pull/4685))
  * Add gitea/issues link to 500 page ([go-gitea#4654](https://github.com/go-gitea/gitea/pull/4654))
  * Hide home button when landing page is not set to home ([go-gitea#4651](https://github.com/go-gitea/gitea/pull/4651))
  * Remove link to GitHub issues in 404 template ([go-gitea#4639](https://github.com/go-gitea/gitea/pull/4639))
  * Cmd/serve: pprof cpu and memory profile dumps to disk ([go-gitea#4560](https://github.com/go-gitea/gitea/pull/4560))
  * Add flash message after an account has been successfully activated ([go-gitea#4510](https://github.com/go-gitea/gitea/pull/4510))
  * Prevent html entity escaping on delete branch ([go-gitea#4471](https://github.com/go-gitea/gitea/pull/4471))
  * Locale for button Edit on protected branch ([go-gitea#4442](https://github.com/go-gitea/gitea/pull/4442))
  * Update notification icon ([go-gitea#4343](https://github.com/go-gitea/gitea/pull/4343))
  * Added front-end topics validation ([go-gitea#4316](https://github.com/go-gitea/gitea/pull/4316))
  * Don't display buttons if there are no system notifications ([go-gitea#4280](https://github.com/go-gitea/gitea/pull/4280))
  * Issue due date api ([go-gitea#3890](https://github.com/go-gitea/gitea/pull/3890))
* SECURITY
  * Improve URL validation for external wiki  and external issues ([go-gitea#4710](https://github.com/go-gitea/gitea/pull/4710))
  * Make cookies HttpOnly and obey COOKIE_SECURE flag ([go-gitea#4706](https://github.com/go-gitea/gitea/pull/4706))
  * Don't disclose emails of all users when sending out emails ([go-gitea#4664](https://github.com/go-gitea/gitea/pull/4664))
  * Check that repositories can only be migrated to own user or organizations ([go-gitea#4366](https://github.com/go-gitea/gitea/pull/4366))
* TRANSLATION
  * Fix punctuation in English translation ([go-gitea#4958](https://github.com/go-gitea/gitea/pull/4958))
  * Fix translation ([go-gitea#4355](https://github.com/go-gitea/gitea/pull/4355))
```

This was referenced Nov 1, 2018

[[BUG] Due date format issue
#5226](/go-gitea/gitea/issues/5226)

Closed

[Fix api uses in the web ui
#5249](/go-gitea/gitea/issues/5249)

Closed

[![@zeripath](https://avatars.githubusercontent.com/u/1824502?s=40&v=4)](/zeripath)
[zeripath](/zeripath)
mentioned this pull request
[Nov 1, 2018](#ref-pullrequest-376584953)

[Fix #5226 by adding CSRF checking to api reqToken and add CSRF to the POST header for deadline
#5250](/go-gitea/gitea/pull/5250)
 Merged

[![@go-gitea](https://avatars.githubusercontent.com/u/12724356?s=40&v=4)](/go-gitea)
[go-gitea](/go-gitea)
locked and limited conversation to collaborators
[Nov 24, 2020](#event-4030162660)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fpull%2F4840).

Reviewers

[![@lunny](https://avatars.githubusercontent.com/u/81045?s=40&v=4)](/lunny) [lunny](/lunny)

lunny approved these changes

Assignees

No one assigned

Labels

[lgtm/done](/go-gitea/gitea/labels/lgtm/done)
This PR has enough approvals to get merged. There are no important open reservations anymore.
[topic/security](/go-gitea/gitea/labels/topic/security)
Something leaks user information or is otherwise vulnerable. Should be fixed!
[type/enhancement](/go-gitea/gitea/labels/type/enhancement)
An improvement of existing functionality

Projects

None yet

Milestone

 [**1.6.0**](/go-gitea/gitea/milestone/24 "1.6.0")

Development

Successfully merging this pull request may close these issues.

5 participants

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=52&v=4)](/beeonthego) [![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=52&v=4)](/techknowlogick) [![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=52&v=4)](/codecov-io) [![@lunny](https://avatars.githubusercontent.com/u/81045?s=52&v=4)](/lunny) [![@bkcsoft](https://avatars.githubusercontent.com/u/4726179?s=52&v=4)](/bkcsoft)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_84a6a802_20250115_094912.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fissues%2F4838)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fissues%2F4838)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=go-gitea%2Fgitea)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[go-gitea](/go-gitea)
/
**[gitea](/go-gitea/gitea)**
Public

* [Notifications](/login?return_to=%2Fgo-gitea%2Fgitea) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fgo-gitea%2Fgitea)
* [Star
   46.6k](/login?return_to=%2Fgo-gitea%2Fgitea)

* [Code](/go-gitea/gitea)
* [Issues
  2.5k](/go-gitea/gitea/issues)
* [Pull requests
  215](/go-gitea/gitea/pulls)
* [Actions](/go-gitea/gitea/actions)
* [Projects
  0](/go-gitea/gitea/projects)
* [Wiki](/go-gitea/gitea/wiki)
* [Security](/go-gitea/gitea/security)
* [Insights](/go-gitea/gitea/pulse)

Additional navigation options

* [Code](/go-gitea/gitea)
* [Issues](/go-gitea/gitea/issues)
* [Pull requests](/go-gitea/gitea/pulls)
* [Actions](/go-gitea/gitea/actions)
* [Projects](/go-gitea/gitea/projects)
* [Wiki](/go-gitea/gitea/wiki)
* [Security](/go-gitea/gitea/security)
* [Insights](/go-gitea/gitea/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgo-gitea%2Fgitea%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgo-gitea%2Fgitea%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Proposal] CSRF checks on GET routes #4838

Closed

[beeonthego](/beeonthego) opened this issue
Sep 1, 2018
· 24 comments

Closed

# [[Proposal] CSRF checks on GET routes](#top) #4838

[beeonthego](/beeonthego) opened this issue
Sep 1, 2018
· 24 comments

## Comments

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

### **[beeonthego](/beeonthego)** commented [Sep 1, 2018](#issue-356154901) • edited Loading

| The Vulnerabilities on GET Routes For historical reasons some GET routes in Gitea do more than getting info and actually change state, for example /user/logout, and GET routes with action/:action in it. Current CSRF handler only checks POST routes, and thus leaves those GET routes vulnerable.  One particular route admin/notices/empty should probably be a POST i/o GET route. Strategies We are working on a PR to address these vulnerabilities, and would like the community feedback on the best strategy. Option 1: reuse existing CSRF token + referrer-policy header (WARNING! BAD IDEA, Don't do this. See comments below for reason.) In this option we will append the existing CSRF token to vulnerable GET routes as a query string, validate the token. A referrer-policy header can be set to same origin to prevent abuse of the token.  This option has less changes to existing code. Option 2: generate a new JWT token with a key exclusive for this purpose In this option we will generate a new JWT token and send to the browser via a new cookie. This will have more changes to the code. Questionssecurity concerns on reusing csrf token on URL We are thinking to implement option 1, and have code already done. It has less code changes and hopefully can be merged soon. Are there any concerns on this option 1? response code or redirect What should we do if the required token is missing or invalid? Should we redirect to home page, or return 403? Browsers treat 403 error code differently, for example Chrome on Mac displays the following message which may not be what you want.  ``` This site can’t be reached The web page at https://gitea.on-my-super-domain.dummy/user/logout might be temporarily down or it may have moved permanently to a new web address. ERR_INVALID_RESPONSE  ``` Potential Impact Both options require an extra handler on vulnerable routes to check the token in query string, and minor changes in URL in templates. While the PR can include the new token in default templates, this is potentially a breaking change to people using custom templates. The custom templates need to be updated to include the token in generated URL. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=40&v=4)](/beeonthego)
[beeonthego](/beeonthego)
mentioned this issue
[Sep 1, 2018](#ref-issue-356157543)

[[Proposal] CSRF Checks on GET Routes
gogs/gogs#5394](/gogs/gogs/issues/5394)

Closed

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 1, 2018](#issuecomment-417821089)

| This is a dupe ticket. I'm on mobile right now so I can get to it, but it was decided to ensure CSRF on those routes.  When I get to a computer I'll link ticket. |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=40&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)
[techknowlogick](/techknowlogick)
closed this as [completed](/go-gitea/gitea/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Sep 1, 2018](#event-1821688526)

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 1, 2018](#issuecomment-417823954)

| Hello,  appreciate the quick response. Before creating this issue, I have searched and read all open and closed issues with the keyword csrf, and haven't found anything similar. (maybe it has been deleted?) This is about CSRF checks AFTER users log in, not on login route. The mischief can be done with a link to the unprotected route, on issue/profile pages on the same domain.  If someone is already working on it, could you share the link to the issue and discussions?  If it is not the same issue, do you mind re-opening the issue?  Gitea (and gogs) has some unconventional use of http verbs, such as performing delete action on GET requests. |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 1, 2018](#issuecomment-417825268)

| It's hard to search for because the security researcher who reported it deleted their account, and because it included some sensitive details removed the details from the ticket. However the it's also been reported through the security@gitea.io email so the owners (and a couple maintainers) have the vulnerability details, and the ticket is kept open as a placeholder until it can be resolved.  I'm back at a computer now and the ticket is [#4357](https://github.com/go-gitea/gitea/issues/4357) |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 1, 2018](#issuecomment-417826505)

| I actually have read that issue, which is about unprotected post routes in API. This issue is about the unprotected GET routes of UI in the browser. So I thought these are totally different issues. Do you mind reopening it for community comments so a fix can be decided and submitted soon?  The researcher (cezar??) brought my attention to those CSRF issues. I am especially concerned about them because our application is multi user environment. Not sure why the account has been deleted. I hope the researcher can test and verify the fixes if the researcher is still hanging around.  I have done something about token check in api routes, and have proposed to limit API access to token only in reqToken handler. I will prepare a pull request on that since it is a separate issue. One of the maintainers mentioned that a few API GET routes are used in the user/repo search in dashboard. these routes do not have reqToken handler, and will continue to work without token. But in the long run I think it is a good practice to always supply a token when making requests to api routes. People make less mistakes when the logic is simple.  I have a small team and limited resources, and prefer not to maintain a separate repo, or manually resolve the merge conflicts. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 3, 2018](#issuecomment-417999617) • edited Loading

| Just in case someone will be reading this issue in the future, we have opted for rewriting the code and using a separate key and token exclusively for vulnerable GET routes. it is cheap and fast to generate and verify a token stored in another cookie. The consequences of losing CSRF token for POST requests are huge. It is a risk not worth taking. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 3, 2018](#issuecomment-418199093)

| [@cezar97](https://github.com/cezar97) Thanks for the insight, and welcome back! I am glad you are still here. If you can create a new account using the username of deleted account, you should keep this one. Otherwise another person might use it and pretend to be you.  I have read issue [#4337](https://github.com/go-gitea/gitea/issues/4337) but couldn't find it when I created this issue to prepare a PR. The content has been deleted and it does not contain csrf or xsrf keyword now. The credit goes to you for reporting the csrf vulnerabilities on GET routes.  Thank you for being patient and persistent. I think Gitea as a community should have responded faster to address the security issues (I am one of the users and I am guilty of this too). Some fixes are easy, for example my PR [#4840](https://github.com/go-gitea/gitea/pull/4840) only has 3 lines of code. It will probably only take a few minutes for someone already familiar with the history and the code of this project.  PR [#4840](https://github.com/go-gitea/gitea/pull/4840) needs a change in access policy and test suites. It has failed some of the tests because the tests assume access to API routes with cookie. The same vulnerability exists in Gogs API routes. I have submitted the same PR to Gogs (matching gogs var and file name) and the PR has passed all tests there. I will see which team of maintainers respond to the PR faster. Gitea maintainers may have forgotten the pain of waiting for PR to be merged, the same reason they have forked Gitea from Gogs. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 3, 2018](#issuecomment-418200589)

| [@techknowlogick](https://github.com/techknowlogick) Is someone else already working on these GET routes or changing them to POST routes? If someone is already working on it, I will focus on something else. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 4, 2018](#issuecomment-418240912)

| [@cezar97](https://github.com/cezar97) In one of your issues deleted, you mentioned about the possibility of theft in CSRF tokens designed for POST routes. Developers have to send the tokens to the browser as page content in one way or another ( in http head or body content, or inject into javascript code). When a victim visits a malicious external link, the attacker can use a script to send a GET request to the server, parse the response and obtain the token. Browsers will send the victim's cookie automatically, even if the attacker can not access the cookie. So these tokens are no secrets anyway. It is the browser's same origin policy that prevents the attacker from sending POST requests using stolen csrf token and cookie. What do you think?  For this reason, a CSRF token on GET routes has to be different one, if the page contains important information and can not change to a POST route.  Appreciate your wisdom in this area. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 4, 2018](#issuecomment-418267769) • edited Loading

| Below are my notes on this issue. Hopefully it is helpful to someone reading this issue.  Upon careful examination of the issue, for a CSRF token to work effectively on GET routes, all GET routes of the member area must have a CSRF token. The reason is that if any route is not covered, an attacker can send a GET request to this route using victim's cookie, parse the response, and get all the tokens for GET routes and POST routes.  The current implementation of CSRF token is useless and gives false sense of security, [edit: if Access-Control-Allow-Origin has been set up incorrectly. ]. The real defense is in correct CORS header setting, browser's same origin security policy, and http-only cookie setting.  POST route tokens should work together with GET route tokens to guard against XSS. If there is a POST route token on the page, the page must be protected with a token in the query string.  The routes will have to be POST if they perform some actions and change state. This is the best strategy even if it means breaking changes.  For the same reason, member areas should not display application tokens or other critical information after creating the token. Malicious scripts have unrestricted access to GET routes in members area, using victim's cookie, [edit: if Access-Control-Allow-Origin has been set up incorrectly. ]  Some routes have to be GET routes, for example the redirect URL after successful authentication. If there is important information on this page, append a token to this url before redirect, then verify this token on the server before rendering this page. The token must appear only once. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 4, 2018](#issuecomment-418555091) • edited Loading

| [@cezar97](https://github.com/cezar97) Thank you for the insight. You have been extremely helpful. The discussion is getting deep now. I hope this thread will help someone to understand and implement CSRF properly in their own app in the future.  Regarding cross site GET requests, browsers actually DO SEND the cookie along with the request even if the resource is on another host. I have tested this on Chrome for Mac Version 68.0.3440.106. The developer console displays a warning icon and message "Provisional headers are shown", and it DOES NOT show all the request headers. This is the same whether browser caching is on or off. However when I examine the request headers on nginx proxy, the cookies ARE clearly there in the cross site GET request! Other browsers are probably doing the same. If you are curious, you can test different browsers, check the request headers on server, and share the results.  It seems that browsers do not distinguish whether a GET request is made by entering a link in address bar, clicking on browse history/bookmark, or is initiated from a page on another site. A browser checks CORS policy, and if the request is allowed, it sends cookie along with the request to fetch resources. This is for a better UX.  The implication is that when a victim visits a malicious external site, the site have full access to all the resources available on GET routes. Browsers send the cookie automatically. The malicious site does not have direct access to cookie, but it can take advantage of browsers' behaviour, and steal information or valuable/private code. [edit: modern browsers do not expose the response of certain content type to JavaScript, but json /jsonp may not be covered, and old browsers may not implement this. The api routes accept cookie and returns JSON response, are vulnerable to abuse, and thus need priority fix.]  The only defense is to have a token on all GET routes too, no matter whether the routes perform action or not. [edit: make sure Access-Control-Allow-Origin header is set up properly and restricts access from trusted host only. It is dangerous to set it to a wildcard \* and allow access from any hosts. ]  That is why most internet banking sites have ugly URL with long query strings.  Thank you for the comments on browse history and bookmarks. These are good points and I will think about how to handle the response when a token is missing or expired. |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 6, 2018](#issuecomment-418927343)

| [@cezar97](https://github.com/cezar97) Thank you very much for the patience and detailed explanations. I do have a better understanding now.  HTML tags of embedded resources (such as img, style, script etc) are not covered by same origin policy. For these tags, browsers send cookies along with cross site GET request without asking. These are the GET routes I referred to before.  You are right, GET routes should not perform action or change state. Changing the routes to POST involves a lot of changes in the front end JavaScript, the templates, and test suites.  Internally we have modified go-macaron/csrf module in the vendor folder and context module, and added an extra token on these GET routes in templates for a quick fix. I will upload the go-macaron/csrf module to my repo, just in case someone will be interested in fixing their app too.  There won't be a PR as eventually the routes should be changed to POST. Changes in vendor folder may never get merged in upstream repo, and thus a PR will never pass the dependency tests. |
| --- |

All reactions

Sorry, something went wrong.

[![@Siesh1oo](https://avatars.githubusercontent.com/u/6906374?s=80&v=4)](/Siesh1oo)

Copy link

### **[Siesh1oo](/Siesh1oo)** commented [Sep 11, 2018](#issuecomment-420206539)

| [@beeonthego](https://github.com/beeonthego) : not sure if you have seen my comment in the other issue, but you can do minimally intrusive fixes using jQuery by replacing the GET url with for example  ``` ## /action/logout endpoint changed to POST in router, now replace in HTML template: <a href="action/logout">Logout</a> ## with: <a href="javascript:$.post('action/logout', { _csrf : '{{.CsrfToken}}' })">Logout</a> ## (assuming the template processor is replacing the CsrfToken variable with the actual token)  ```  This way, a PR would only need to touch router definitions and the HTML render template files. |
| --- |

All reactions

Sorry, something went wrong.

[![@lafriks](https://avatars.githubusercontent.com/u/165205?s=80&u=efe2335d2197f524c25caa7abdfcb90b77eb8d98&v=4)](/lafriks)

Copy link

Member

### **[lafriks](/lafriks)** commented [Sep 11, 2018](#issuecomment-420275945)

| [@beeonthego](https://github.com/beeonthego) but than on the other hand logout will not work without javascript (some people do use gitea without js) |
| --- |

All reactions

Sorry, something went wrong.

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=80&u=7c3342cf6315694c2248b233571856dc67e7c078&v=4)](/techknowlogick)

Copy link

Member

### **[techknowlogick](/techknowlogick)** commented [Sep 11, 2018](#issuecomment-420288641)

| or you could do `/logout?csrf=123213123131` and on the logout route if the csrf is not present then present a page that has the logout link with the csrf |
| --- |

All reactions

Sorry, something went wrong.

[![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=80&v=4)](/beeonthego)

Copy link

Contributor

Author

### **[beeonthego](/beeonthego)** commented [Sep 12, 2018](#issuecomment-420472736)

| [@Siesh1oo](https://github.com/Siesh1oo) Thanks for sharing the trick. I have read about it in your comments in another issue.  No matter how to implement it, people using custom templates will have to update templates manually. It is a breaking change.  In our app we have custom oAuth2 redirect routes (GET) and have to protect with a token in query string. To reduce the risk of exposing the token by referrer, we use a separate short-life token for such GET requests only, and render a normal page without protected content if the token is missing or expired.  I have uploaded the modification to go-macaron/csrf module under this branch <https://github.com/beeonthego/csrf/tree/extra-token-on-get-action-routes>  I am not sure how to proceed. Changes in vendor folder may never be merged in upstream repo. |
| --- |

All reactions

Sorry, something went wrong.

[![@Siesh1oo](https://avatars.githubusercontent.com/u/6906374?s=80&v=4)](/Siesh1oo)

Copy link

### **[Siesh1oo](/Siesh1oo)** commented [Sep 12, 2018](#issuecomment-420614675)

| [@techknowlogick](https://github.com/techknowlogick) : Technically possible, but be sure to understand the caveats [https://www.owasp.org/index.php/Cross-Site\_Request\_Forgery\_(CSRF)\_Prevention\_Cheat\_Sheet#Disclosure\_of\_Token\_in\_URL](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet#Disclosure_of_Token_in_URL) |
| --- |

All reactions

Sorry, something went wrong.

[![@Siesh1oo](https://avatars.githubusercontent.com/u/6906374?s=80&v=4)](/Siesh1oo)

Copy link

### **[Siesh1oo](/Siesh1oo)** commented [Sep 12, 2018](#issuecomment-420616376) • edited Loading

| [@lafriks](https://github.com/lafriks) wrote:  [@beeonthego](https://github.com/beeonthego) but than on the other hand logout will not work without javascript (some people do use gitea without js)  When Javascript is disabled, gitea does not even show the logout button (nor any other functional button) -- is gitea supposed to be functional without javascript? |
| --- |

All reactions

Sorry, something went wrong.

[![@lafriks](https://avatars.githubusercontent.com/u/165205?s=80&u=efe2335d2197f524c25caa7abdfcb90b77eb8d98&v=4)](/lafriks)

Copy link

Member

### **[lafriks](/lafriks)** commented [Sep 12, 2018](#issuecomment-420654732)

| Oh, you are right logout is not visible :) Than yeah we can do that with JavaScript. I would prefer form with post tho |
| --- |

 👍
1
 Siesh1oo reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@go-gitea](https://avatars.githubusercontent.com/u/12724356?s=40&v=4)](/go-gitea)
[go-gitea](/go-gitea)
locked and limited conversation to collaborators
[Nov 24, 2020](#event-4030163354)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-gitea%2Fgitea%2Fissues%2F4838).

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@techknowlogick](https://avatars.githubusercontent.com/u/164197?s=52&v=4)](/techknowlogick) [![@lafriks](https://avatars.githubusercontent.com/u/165205?s=52&v=4)](/lafriks) [![@Siesh1oo](https://avatars.githubusercontent.com/u/6906374?s=52&v=4)](/Siesh1oo) [![@beeonthego](https://avatars.githubusercontent.com/u/42626718?s=52&v=4)](/beeonthego) and others

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blog.gitea.io_0edc8808_20250115_094910.html ===



