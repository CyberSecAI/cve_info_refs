=== Content from gitlab.com_c876b377_20250114_200412.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
0f5d1f1d**

authored
Jan 30, 2021
by
**![François Jacquet's avatar](https://secure.gravatar.com/avatar/7fa9636c4dbc74f01a91731d70fc4b1bb33800783b7667e2f7edb411311bc4f3?s=48&d=identicon "François Jacquet")
François Jacquet**

[Browse files](/francoisjacquet/rosariosis/-/tree/0f5d1f1d193bc6b711d1644f172579d498ec1636)

### Fix [#307](/francoisjacquet/rosariosis/-/issues/307 "XSS Filter Bypass in MarkDown and Other Fields Due to Usage of Outdated Filter") XSS update CodeIgniter Security class

parent
[2943b631](/francoisjacquet/rosariosis/-/commit/2943b6315cecd357ffa2a59a313a573141ab587e)

Loading

Loading

Loading

* [Changes
  2](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636)

[Expand all](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636?expanded=1)
[Hide whitespace changes](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636?action=show&controller=projects%2Fcommit&id=0f5d1f1d193bc6b711d1644f172579d498ec1636&namespace_id=francoisjacquet&project_id=rosariosis&w=1)
[Inline](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636?view=inline)
[Side-by-side](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_b03f25f1_20250114_200413.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# XSS Filter Bypass in MarkDown and Other Fields Due to Usage of Outdated Filter

Hi [@francoisjacquet](/francoisjacquet "François Jacquet"),

I found a way to bypass the XSS sanitization that appears to be used for MarkDown and some other fields in RosarioSIS. The vulnerability is present in the latest version. Details are described below.

# XSS Filter Bypass in MarkDown and Other Fields Due to Usage of Outdated Filter

To prevent Cross-Site Scripting (XSS) attacks, user input from MarkDown and other input fields is filtered via the function `xss_clean(...)` as defined in the file [`classes/Security.php`](https://gitlab.com/francoisjacquet/rosariosis/-/blob/mobile/classes/Security.php#L59). As stated in the function's documentation:

> This function and other functions that it uses are taken from Codeigniter 2.1.3 and modified them to our needs. In turn, I have taken this from JasonMortonNZ.

Consequently, any vulnerabilities contained in `xss_clean(...)` from CodeIgniter 2.1.3 and potentially later versions likely also affect the `xss_clean(...)` function as implemented in RosarioSIS. As an example, the vulnerability described at <https://nealpoole.com/blog/2013/07/codeigniter-21-xss-clean-filter-bypass/> also affects RosarioSIS, meaning XSS is possible. To get an indication of the affected code, the command line tool `grep` can be used in the root directory of RosarioSIS like so:

```
grep -R "SanitizeHTML\|SanitizeMarkDown\|MarkDownToHTML\s*(.*)" --include="*.php" .
```

## Proof of Concept

In this PoC, an admin user is used for simplicity. Note however, that because the vulnerable code is used at multiple locations throughout RosarioSIS' code, students or teachers may also be capable of exploiting this vulnerability within some other functionality. The exploitation steps are as follows:

1. Log in as admin
2. Go to `http://rosariosis.local/Modules.php?modname=School_Setup/PortalNotes.php`. Note that the domain name may have to be adapted to your setup.
3. Create a new note with some title like "My XSS" and enter into the MarkDown input field for the note:
   ```
   <img src="a" onerror="eval(atob('cHJvbXB0KDEpOw=='));"
   ```

   The Base64 string simply encodes the payload `prompt(1);`
4. Save the note
5. The page refreshes automatically and the XSS payload is executed:
   [![rosariosis_xss](data:image/gif;base64...)](/-/project/7292712/uploads/716172083c38cb957c50ee82415ea644/rosariosis_xss.png)
   Note that the XSS payload is stored persistently in this case.

## Remediation

To fix the explicitly shown vulnerability and others inherited from the outdated CodeIgniter code, RosarioSIS' `xss_clean(...)` function should be updated to match CodeIgniter's latest implementation of the respective function. Further, plainly copying security-related code should be avoided as such code can become outdated and susceptible to known vulnerabilities already discovered in the original code. Rather, a mechanism to keep the "copied" code up to date and match the latest version of the orignal code should be used.

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_dc4bc3b7_20250114_200411.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [rosariosis](/francoisjacquet/rosariosis/-/tree/mobile)
* [**CHANGES.md**](/francoisjacquet/rosariosis/-/blob/mobile/CHANGES.md)

Find file

[Blame](/francoisjacquet/rosariosis/-/blame/mobile/CHANGES.md)
[Permalink](/francoisjacquet/rosariosis/-/blob/e1d4a5fd971b0c103f5b5dbf9d67544aec464227/CHANGES.md "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* ![François Jacquet's avatar](https://secure.gravatar.com/avatar/7fa9636c4dbc74f01a91731d70fc4b1bb33800783b7667e2f7edb411311bc4f3?s=64&d=identicon "François Jacquet")

  Jan 13, 2025

  [e1d4a5fd](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  [Allow creating historical marking periods up to 10 years in the past](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  ·
  e1d4a5fd

  François Jacquet authored Jan 13, 2025

  e1d4a5fd

  [Allow creating historical marking periods up to 10 years in the past](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  François Jacquet authored Jan 13, 2025

To find the state of this project's repository at the time of any of these versions, check out [the tags](/francoisjacquet/rosariosis/-/tags).

Loading


