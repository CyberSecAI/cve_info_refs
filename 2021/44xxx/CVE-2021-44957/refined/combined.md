=== Content from github.com_31fe6e7b_20250114_195838.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frockcarry%2Fffjpeg%2Fissues%2F44)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frockcarry%2Fffjpeg%2Fissues%2F44)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=rockcarry%2Fffjpeg)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rockcarry](/rockcarry)
/
**[ffjpeg](/rockcarry/ffjpeg)**
Public

* [Notifications](/login?return_to=%2Frockcarry%2Fffjpeg) You must be signed in to change notification settings
* [Fork
  46](/login?return_to=%2Frockcarry%2Fffjpeg)
* [Star
   108](/login?return_to=%2Frockcarry%2Fffjpeg)

* [Code](/rockcarry/ffjpeg)
* [Issues
  19](/rockcarry/ffjpeg/issues)
* [Pull requests
  1](/rockcarry/ffjpeg/pulls)
* [Actions](/rockcarry/ffjpeg/actions)
* [Projects
  0](/rockcarry/ffjpeg/projects)
* [Wiki](/rockcarry/ffjpeg/wiki)
* [Security](/rockcarry/ffjpeg/security)
* [Insights](/rockcarry/ffjpeg/pulse)

Additional navigation options

* [Code](/rockcarry/ffjpeg)
* [Issues](/rockcarry/ffjpeg/issues)
* [Pull requests](/rockcarry/ffjpeg/pulls)
* [Actions](/rockcarry/ffjpeg/actions)
* [Projects](/rockcarry/ffjpeg/projects)
* [Wiki](/rockcarry/ffjpeg/wiki)
* [Security](/rockcarry/ffjpeg/security)
* [Insights](/rockcarry/ffjpeg/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frockcarry%2Fffjpeg%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frockcarry%2Fffjpeg%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# global-buffer-overflow in function jfif\_encode at jfif.c:708 #44

Closed

[cemonatk](/cemonatk) opened this issue
Jun 23, 2021
· 4 comments

Closed

# [global-buffer-overflow in function jfif\_encode at jfif.c:708](#top) #44

[cemonatk](/cemonatk) opened this issue
Jun 23, 2021
· 4 comments

## Comments

[![@cemonatk](https://avatars.githubusercontent.com/u/6966924?s=80&u=bffbc8a942b9f23bdb0fc785ba2ebc111d67fb30&v=4)](/cemonatk)

Copy link

### **[cemonatk](/cemonatk)** commented [Jun 23, 2021](#issue-928587983)

| **Describe** A global-buffer-overflow was discovered in ffjpeg. The issue is being triggered in function jfif\_encode at jfif.c:708.  Found by **Cem Onat Karagun of Diesec**  **System info** OS version : Ubuntu 21.04 ffjpeg Version : master([0fa4cf8a86](https://github.com/rockcarry/ffjpeg/commit/0fa4cf8a86d7f23))  **Reproduce**  Compile ffjpeg with address sanitizer.  ``` CCFLAGS = -Wall -g -fsanitize=address   ```  PoC file: [encode\_poc1.zip](https://github.com/rockcarry/ffjpeg/files/6704528/encode_poc1.zip)  Run with the following command.  ``` $ ffjpeg -e encode_poc1  ```  **Asan output:**  ``` ================================================================= ==3406031==ERROR: AddressSanitizer: global-buffer-overflow on address 0x000000231972 at pc 0x0000002cbc07 bp 0x7ffcef6304f0 sp 0x7ffcef62fcb8 READ of size 272 at 0x000000231972 thread T0     #0 0x2cbc06 in __asan_memcpy (/REDACTED/ffjpeg/src/ffjpeg+0x2cbc06)     #1 0x30f33b in jfif_encode /src/src/jfif.c:708:5     #2 0x3029f2 in main /src/src/ffjpeg.c:30:16     #3 0x7fdfb0d3b564 in __libc_start_main csu/../csu/libc-start.c:332:16     #4 0x2515fd in _start (/REDACTED/ffjpeg/src/ffjpeg+0x2515fd)  0x000000231972 is located 46 bytes to the left of global variable 'STD_HUFTAB_LUMIN_DC' defined in 'huffman.c:398:12' (0x2319a0) of size 28 0x000000231972 is located 0 bytes to the right of global variable 'STD_HUFTAB_LUMIN_AC' defined in 'huffman.c:382:12' (0x2318c0) of size 178 SUMMARY: AddressSanitizer: global-buffer-overflow (/REDACTED/ffjpeg/src/ffjpeg+0x2cbc06) in __asan_memcpy Shadow bytes around the buggy address:   0x00008003e2d0: f9 f9 f9 f9 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9   0x00008003e2e0: 00 03 f9 f9 f9 f9 f9 f9 00 00 00 00 00 01 f9 f9   0x00008003e2f0: f9 f9 f9 f9 00 00 07 f9 f9 f9 f9 f9 00 00 00 00   0x00008003e300: 00 00 00 00 00 00 00 00 00 00 00 00 04 f9 f9 f9   0x00008003e310: f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 =>0x00008003e320: 00 00 00 00 00 00 00 00 00 00 00 00 00 00[02]f9   0x00008003e330: f9 f9 f9 f9 00 00 00 04 f9 f9 f9 f9 00 00 00 00   0x00008003e340: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x00008003e350: 00 00 02 f9 f9 f9 f9 f9 00 00 00 04 f9 f9 f9 f9   0x00008003e360: 00 00 00 00 05 f9 f9 f9 f9 f9 f9 f9 00 00 00 00   0x00008003e370: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==3406031==ABORTING  ```  ``` memcpy(jfif->phcac[0]->huftab, STD_HUFTAB_LUMIN_AC, MAX_HUFFMAN_CODE_LEN + 256);  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@albertofwb](https://avatars.githubusercontent.com/u/5900716?s=80&u=75c7095f9d14297f113f688aae47b5500fcee8cf&v=4)](/albertofwb)

Copy link

### **[albertofwb](/albertofwb)** commented [Sep 6, 2021](#issuecomment-913821277)

| I reproduced your situation on my ubuntu 20.04 machine.  albert @ albert-TM1701 in ~/GitRepos/c/ffjpeg on git:0fa4cf8 x [3:17:07] $ ./src/ffjpeg -e encode\_poc1 ================================================================= ==263835==ERROR: AddressSanitizer: requested allocation size 0xeb06213d11f6dbc0 (0xeb06213d11f6ebc0 after adjustments for alignment, red zones etc.) exceeds maximum supported size of 0x10000000000 (thread T0) #0 0x7fb35c91dbc8 in malloc (/lib/x86\_64-linux-gnu/libasan.so.5+0x10dbc8) [#1](https://github.com/rockcarry/ffjpeg/issues/1) 0x5620722fbbf4 in bmp\_load /home/albert/GitRepos/c/ffjpeg/src/bmp.c:48 [#2](https://github.com/rockcarry/ffjpeg/issues/2) 0x5620722fb733 in main (/home/albert/GitRepos/c/ffjpeg/src/ffjpeg+0x2733) [#3](https://github.com/rockcarry/ffjpeg/issues/3) 0x7fb35c6450b2 in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x270b2)  ==263835==HINT: if you don't care about these errors you may set allocator\_may\_return\_null=1 SUMMARY: AddressSanitizer: allocation-size-too-big (/lib/x86\_64-linux-gnu/libasan.so.5+0x10dbc8) in malloc ==263835==ABORTING  downlowded and extracted encode\_poc1 the `file` command shows it is a jpeg file. After `ln -s encode_poc1 encode_poc1.jpg` xdg-open can not load the image and "Eye of MATE 1.24.0" shows  Error interpreting JPEGimage File (Unsupported marker type 0x30)  I guess your poc file is not encode with jpeg correctly. |
| --- |

All reactions

Sorry, something went wrong.

[![@rockcarry](https://avatars.githubusercontent.com/u/1675029?s=80&v=4)](/rockcarry)

Copy link

Owner

### **[rockcarry](/rockcarry)** commented [Sep 7, 2021](#issuecomment-913929389)

| I reproduced your situation on my ubuntu 20.04 machine.  albert @ albert-TM1701 in ~/GitRepos/c/ffjpeg on git:0fa4cf8 x [3:17:07] $ ./src/ffjpeg -e encode\_poc1 ==263835==ERROR: AddressSanitizer: requested allocation size 0xeb06213d11f6dbc0 (0xeb06213d11f6ebc0 after adjustments for alignment, red zones etc.) exceeds maximum supported size of 0x10000000000 (thread T0) #0 0x7fb35c91dbc8 in malloc (/lib/x86\_64-linux-gnu/libasan.so.5+0x10dbc8) [#1](https://github.com/rockcarry/ffjpeg/issues/1) 0x5620722fbbf4 in bmp\_load /home/albert/GitRepos/c/ffjpeg/src/bmp.c:48 [#2](https://github.com/rockcarry/ffjpeg/issues/2) 0x5620722fb733 in main (/home/albert/GitRepos/c/ffjpeg/src/ffjpeg+0x2733) [#3](https://github.com/rockcarry/ffjpeg/issues/3) 0x7fb35c6450b2 in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x270b2)  ==263835==HINT: if you don't care about these errors you may set allocator\_may\_return\_null=1 SUMMARY: AddressSanitizer: allocation-size-too-big (/lib/x86\_64-linux-gnu/libasan.so.5+0x10dbc8) in malloc ==263835==ABORTING  downlowded and extracted encode\_poc1 the `file` command shows it is a jpeg file. After `ln -s encode_poc1 encode_poc1.jpg` xdg-open can not load the image and "Eye of MATE 1.24.0" shows  Error interpreting JPEGimage File (Unsupported marker type 0x30)  I guess your poc file is not encode with jpeg correctly.  It's not his poc file's problem. He is using some test case poc files to test and find if there are some bug in ffjpeg. so we need fix the issue no matter what the poc file is. |
| --- |

All reactions

Sorry, something went wrong.

[![@cemonatk](https://avatars.githubusercontent.com/u/6966924?s=80&u=bffbc8a942b9f23bdb0fc785ba2ebc111d67fb30&v=4)](/cemonatk)

Copy link

Author

### **[cemonatk](/cemonatk)** commented [Nov 12, 2021](#issuecomment-967641147)

| Hello, yes [@rockcarry](https://github.com/rockcarry) is right. Is there any updates on this one and the issue [#43](https://github.com/rockcarry/ffjpeg/issues/43) ? |
| --- |

All reactions

Sorry, something went wrong.

[![@Marsman1996](https://avatars.githubusercontent.com/u/22045841?s=80&u=ad0b1a56d1b2b8cd1883c9662b9b0f1786475c2f&v=4)](/Marsman1996)

Copy link

Contributor

### **[Marsman1996](/Marsman1996)** commented [Dec 1, 2021](#issuecomment-983231075) • edited Loading

| The reproduce command should be `ASAN_OPTIONS="allocator_may_return_null=1" ./src/ffjpeg -e encode_poc1` otherwise we will get the `allocation-size-too-big` error.  This issue is same as the [#25](https://github.com/rockcarry/ffjpeg/issues/25) (assigned with [CVE-2020-23705](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-23705)), they are both caused by the oversized `memcpy`. (i.e. the length of STD\_HUFTAB\_LUMIN\_AC is 178, and the length of STD\_HUFTAB\_LUMIN\_DC is 28, but ffjpeg copies 272 from them).  And I create a PR [#45](https://github.com/rockcarry/ffjpeg/pull/45) to fix them. |
| --- |

All reactions

Sorry, something went wrong.

[rockcarry](/rockcarry)
added a commit
that referenced
this issue
[Dec 1, 2021](#ref-commit-23dffdf)
[![@rockcarry](https://avatars.githubusercontent.com/u/1675029?s=40&v=4)](/rockcarry)

`[Merge pull request](/rockcarry/ffjpeg/commit/23dffdfd2507b4de7b9f292ac1a791d68f4fd9a3 "Merge pull request #45 from Marsman1996/master

fix issue #44 and #25") [#45](https://github.com/rockcarry/ffjpeg/pull/45) [from Marsman1996/master](/rockcarry/ffjpeg/commit/23dffdfd2507b4de7b9f292ac1a791d68f4fd9a3 "Merge pull request #45 from Marsman1996/master

fix issue #44 and #25")`
…

`[23dffdf](/rockcarry/ffjpeg/commit/23dffdfd2507b4de7b9f292ac1a791d68f4fd9a3)`

```
fix issue [#44](https://github.com/rockcarry/ffjpeg/issues/44) and [#25](https://github.com/rockcarry/ffjpeg/issues/25)
```

[![@cemonatk](https://avatars.githubusercontent.com/u/6966924?s=40&u=bffbc8a942b9f23bdb0fc785ba2ebc111d67fb30&v=4)](/cemonatk)
[cemonatk](/cemonatk)
closed this as [completed](/rockcarry/ffjpeg/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Dec 7, 2021](#event-5729764526)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frockcarry%2Fffjpeg%2Fissues%2F44)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@rockcarry](https://avatars.githubusercontent.com/u/1675029?s=52&v=4)](/rockcarry) [![@albertofwb](https://avatars.githubusercontent.com/u/5900716?s=52&v=4)](/albertofwb) [![@cemonatk](https://avatars.githubusercontent.com/u/6966924?s=52&v=4)](/cemonatk) [![@Marsman1996](https://avatars.githubusercontent.com/u/22045841?s=52&v=4)](/Marsman1996)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


