=== Content from electronics.com_0484bce2_20250114_181200.html ===


[Buy this domain.](https://www.mydomaincontact.com/?domain_name=electronics.com)

# electronics.com

2025 Copyright. All Rights Reserved.

Privacy Policy



=== Content from shieldstore.com_03d846be_20250114_181203.html ===

[Shieldstore.com](http://www.Shieldstore.com)

[![networksolutions](http://i2.cdn-image.com/__media__/pics/10667/netsol-logos-2020-165-50.jpg)](//www.networksolutions.com/)
This Page Is Under Construction - Coming Soon!

 [Why am I seeing this 'Under Construction' page?](http://shieldstore.com/__media__/design/underconstructionnotice.php?d=shieldstore.com)

Related Searches:

* [Black Dots On Car Windshield](http://digi-searches.com/Black_Dots_On_Car_Windshield.cfm?fp=TfzNxdMqQCfCZ7fTTuP%2BP6k22vbxyE3bF410PXtblvfNea6cEKLLIklP%2Bnl8VwevKvxrkyqIm2IKTVuDQbpfaNIJJwFGByrDX7k%2B%2BdyK4UOdiPg7WQByuXfjr6MT%2FJG7IvcyK5BfIl4NIxwV9emvdJHAWTVFduvPtSfF1soOuDR1TmWHlTcU3zizmmDl1JG6xErgJINVXdWcm3Ywj19qXg%2BeqFpWo3dGdbj1ndFl%2Fkow4%2BM3q4qk29olja%2F12v5WOna6CH5BBCZQby8XMnulyOlVkh1dGQizxoG0AQU0vqbtmfAKDDRb4cdjK6GfH3wI&kbetu=1&maxads=0&kld=1061&_opnslfp=1&bkt=14907&d_bkt=14907&skpc=1&&&kt=339&&kbc=car+windshield&ki=505295070&ktd=1280&kld=1061&kp=1 "Black Dots On Car Windshield")
* [Best Car Windshield Snow Cover](http://digi-searches.com/Best_Car_Windshield_Snow_Cover.cfm?fp=TfzNxdMqQCfCZ7fTTuP%2BP6k22vbxyE3bF410PXtblvfNea6cEKLLIklP%2Bnl8VwevKvxrkyqIm2IKTVuDQbpfaNIJJwFGByrDX7k%2B%2BdyK4UOdiPg7WQByuXfjr6MT%2FJG7IvcyK5BfIl4NIxwV9emvdJHAWTVFduvPtSfF1soOuDR1TmWHlTcU3zizmmDl1JG6xErgJINVXdWcm3Ywj19qXg%2BeqFpWo3dGdbj1ndFl%2Fkow4%2BM3q4qk29olja%2F12v5WOna6CH5BBCZQby8XMnulyOlVkh1dGQizxoG0AQU0vqbtmfAKDDRb4cdjK6GfH3wI&kbetu=1&maxads=0&kld=1061&_opnslfp=1&bkt=14907&d_bkt=14907&skpc=1&&&kt=339&&kbc=car+windshield&ki=370523964&ktd=256&kld=1061&kp=2 "Best Car Windshield Snow Cover")
* [Car Windshield Water Repellent](http://digi-searches.com/Car_Windshield_Water_Repellent.cfm?fp=TfzNxdMqQCfCZ7fTTuP%2BP6k22vbxyE3bF410PXtblvfNea6cEKLLIklP%2Bnl8VwevKvxrkyqIm2IKTVuDQbpfaNIJJwFGByrDX7k%2B%2BdyK4UOdiPg7WQByuXfjr6MT%2FJG7IvcyK5BfIl4NIxwV9emvdJHAWTVFduvPtSfF1soOuDR1TmWHlTcU3zizmmDl1JG6xErgJINVXdWcm3Ywj19qXg%2BeqFpWo3dGdbj1ndFl%2Fkow4%2BM3q4qk29olja%2F12v5WOna6CH5BBCZQby8XMnulyOlVkh1dGQizxoG0AQU0vqbtmfAKDDRb4cdjK6GfH3wI&kbetu=1&maxads=0&kld=1061&_opnslfp=1&bkt=14907&d_bkt=14907&skpc=1&&&kt=339&&kbc=car+windshield&ki=860610176&ktd=256&kld=1061&kp=3 "Car Windshield Water Repellent")
* [Car Care Windshield Cleaning](http://digi-searches.com/Car_Care_Windshield_Cleaning.cfm?fp=TfzNxdMqQCfCZ7fTTuP%2BP6k22vbxyE3bF410PXtblvfNea6cEKLLIklP%2Bnl8VwevKvxrkyqIm2IKTVuDQbpfaNIJJwFGByrDX7k%2B%2BdyK4UOdiPg7WQByuXfjr6MT%2FJG7IvcyK5BfIl4NIxwV9emvdJHAWTVFduvPtSfF1soOuDR1TmWHlTcU3zizmmDl1JG6xErgJINVXdWcm3Ywj19qXg%2BeqFpWo3dGdbj1ndFl%2Fkow4%2BM3q4qk29olja%2F12v5WOna6CH5BBCZQby8XMnulyOlVkh1dGQizxoG0AQU0vqbtmfAKDDRb4cdjK6GfH3wI&kbetu=1&maxads=0&kld=1061&_opnslfp=1&bkt=14907&d_bkt=14907&skpc=1&&&kt=339&&kbc=car+windshield&ki=1056975316&ktd=256&kld=1061&kp=4 "Car Care Windshield Cleaning")
* [Car Windshield De Fogger Tools](http://digi-searches.com/Car_Windshield_De_Fogger_Tools.cfm?fp=TfzNxdMqQCfCZ7fTTuP%2BP6k22vbxyE3bF410PXtblvfNea6cEKLLIklP%2Bnl8VwevKvxrkyqIm2IKTVuDQbpfaNIJJwFGByrDX7k%2B%2BdyK4UOdiPg7WQByuXfjr6MT%2FJG7IvcyK5BfIl4NIxwV9emvdJHAWTVFduvPtSfF1soOuDR1TmWHlTcU3zizmmDl1JG6xErgJINVXdWcm3Ywj19qXg%2BeqFpWo3dGdbj1ndFl%2Fkow4%2BM3q4qk29olja%2F12v5WOna6CH5BBCZQby8XMnulyOlVkh1dGQizxoG0AQU0vqbtmfAKDDRb4cdjK6GfH3wI&kbetu=1&maxads=0&kld=1061&_opnslfp=1&bkt=14907&d_bkt=14907&skpc=1&&&kt=339&&kbc=car+windshield&ki=1080403520&ktd=256&kld=1061&kp=5 "Car Windshield De Fogger Tools")

Trademark Free Notice
[Review our Privacy Policy](//customersupport.networksolutions.com/article.php?id=306)
[Service Agreement](//www.networksolutions.com/legal/static-service-agreement.jsp)

[Legal Notice](//www.networksolutions.com/legal/legal-notice.jsp)

  [Privacy Policy](//skenzo.com/sk-privacy.php?sk_ref=6kctu5z9mJecorYhhud%2BYGaagmDproybfC4f%2B98uAIC%2F0aN%2Bps52HPC4XM45sa8s)|Do Not Sell or Share My Personal Information



=== Content from github.com_ad7c37f8_20250114_181206.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcocoppang%2FShieldStore%2Fissues%2F19)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcocoppang%2FShieldStore%2Fissues%2F19)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=cocoppang%2FShieldStore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cocoppang](/cocoppang)
/
**[ShieldStore](/cocoppang/ShieldStore)**
Public

* [Notifications](/login?return_to=%2Fcocoppang%2FShieldStore) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2Fcocoppang%2FShieldStore)
* [Star
   37](/login?return_to=%2Fcocoppang%2FShieldStore)

* [Code](/cocoppang/ShieldStore)
* [Issues
  1](/cocoppang/ShieldStore/issues)
* [Pull requests
  13](/cocoppang/ShieldStore/pulls)
* [Actions](/cocoppang/ShieldStore/actions)
* [Projects
  0](/cocoppang/ShieldStore/projects)
* [Security](/cocoppang/ShieldStore/security)
* [Insights](/cocoppang/ShieldStore/pulse)

Additional navigation options

* [Code](/cocoppang/ShieldStore)
* [Issues](/cocoppang/ShieldStore/issues)
* [Pull requests](/cocoppang/ShieldStore/pulls)
* [Actions](/cocoppang/ShieldStore/actions)
* [Projects](/cocoppang/ShieldStore/projects)
* [Security](/cocoppang/ShieldStore/security)
* [Insights](/cocoppang/ShieldStore/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fcocoppang%2FShieldStore%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fcocoppang%2FShieldStore%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Security issue #19

Open

[yudhui](/yudhui) opened this issue
Nov 23, 2021
· 2 comments

Open

# [Security issue](#top) #19

[yudhui](/yudhui) opened this issue
Nov 23, 2021
· 2 comments

## Comments

[![@yudhui](https://avatars.githubusercontent.com/u/23469352?s=80&u=8171d4804573505a3487969459e738d7383966ef&v=4)](/yudhui)

Copy link

### **[yudhui](/yudhui)** commented [Nov 23, 2021](#issue-1060974558) • edited Loading

| Hi, We found a buffer overflow and a infomation leak in Enclave/Enclave.cpp. There is a global variable "Arg arg\_enclave;" in enclave and it is initialized in ecall "enclave\_init\_values". However it value is copyed from "arg" which is untrusted.  [image](https://user-images.githubusercontent.com/23469352/142981763-99ef45ea-efbb-4231-ba13-43f0aaa19c2e.png)  We found a member variable in structure "Arg" called "int max\_buf\_size;". Then we search the code to find where "max\_buf\_size" is used. We found two patterns: First is like this "memset(cipher, 0, arg\_enclave.max\_buf\_size);". For example it is used in "enclave\_get", while the parametre "cipher" refers to the buf in "enclave\_process", and its size is a constant(4125). So, arg\_enclave.max\_buf\_size can be larger than the buffer size. Second pattern is "message\_return(cipher, arg\_enclave.max\_buf\_size, client\_sock);". Function "message\_return" is an ocall which writes cipher to client\_sock.  [image](https://user-images.githubusercontent.com/23469352/142984233-0e200859-7f74-489f-8fee-ad08f761ea6d.png)  In function "enclave\_message\_pass" cipher is introduced from data which is original from "HotCall\* hotEcall". While "hotEcall" is transferd from untrusted part.  [image](https://user-images.githubusercontent.com/23469352/142984645-46b065b7-ab94-4c8b-af3d-289285965c06.png)  So, attacker can set cipher points to arbitrary address in encalve and set client\_sock to sdtout that will leak information in encalve.  Thanks, yudhui |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@cocoppang](https://avatars.githubusercontent.com/u/9690519?s=80&u=7e4245965b0dfc030971c7126ec464bded9583af&v=4)](/cocoppang)

Copy link

Owner

### **[cocoppang](/cocoppang)** commented [Jan 19, 2022](#issuecomment-1016198819)

| Hi yudhui,  As I understand, you pointed out 3 issues.   1. untrusted configurations passed to enclave  * Definitely yes, to implement a fully trusted key-value store, it requires elaborate handling for the configurations. Since ShieldStore is a prototype of trusted key-value store, we implemented it as simply passing the untrusted arguments.  2. buffer overflow due to the mismatch of buffer size  * The mismatch of the buffer size can cause buffer overflow as you mentioned. I think our experimental code contains the constant size of buffer (BUF\_SIZE), but there’s no use of BUF\_SIZE in the main code.  3. A vulnerable point for an untrusted buffer  * Since the “cipher” is the part of untrusted memory address, an attacker can freely manipulate the contents or address of the buffer. As you described, if the attack arbitrary points the “cipher” to an enclave address, the information leakage can be occurred. One of the simple solutions is to allocate a new buffer for the response in order to decouple the buffers.   Thank you for the consideration what we didn’t catch.  Taehoon |
| --- |

All reactions

Sorry, something went wrong.

[![@yudhui](https://avatars.githubusercontent.com/u/23469352?s=80&u=8171d4804573505a3487969459e738d7383966ef&v=4)](/yudhui)

Copy link

Author

### **[yudhui](/yudhui)** commented [Jan 20, 2022](#issuecomment-1017116831)

| Hi, Taehoon,  Thank you for your reply. I think the solutions you mentioned can fix the security issues. Do you have any patching schedule?  Thanks, yudhui |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fcocoppang%2FShieldStore%2Fissues%2F19)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@cocoppang](https://avatars.githubusercontent.com/u/9690519?s=52&v=4)](/cocoppang) [![@yudhui](https://avatars.githubusercontent.com/u/23469352?s=52&v=4)](/yudhui)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f975aa62_20250114_181206.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcocoppang%2FShieldStore%2Fblob%2Fmaster%2FEnclave%2FEnclave.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcocoppang%2FShieldStore%2Fblob%2Fmaster%2FEnclave%2FEnclave.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=cocoppang%2FShieldStore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cocoppang](/cocoppang)
/
**[ShieldStore](/cocoppang/ShieldStore)**
Public

* [Notifications](/login?return_to=%2Fcocoppang%2FShieldStore) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2Fcocoppang%2FShieldStore)
* [Star
   37](/login?return_to=%2Fcocoppang%2FShieldStore)

* [Code](/cocoppang/ShieldStore)
* [Issues
  1](/cocoppang/ShieldStore/issues)
* [Pull requests
  13](/cocoppang/ShieldStore/pulls)
* [Actions](/cocoppang/ShieldStore/actions)
* [Projects
  0](/cocoppang/ShieldStore/projects)
* [Security](/cocoppang/ShieldStore/security)
* [Insights](/cocoppang/ShieldStore/pulse)

Additional navigation options

* [Code](/cocoppang/ShieldStore)
* [Issues](/cocoppang/ShieldStore/issues)
* [Pull requests](/cocoppang/ShieldStore/pulls)
* [Actions](/cocoppang/ShieldStore/actions)
* [Projects](/cocoppang/ShieldStore/projects)
* [Security](/cocoppang/ShieldStore/security)
* [Insights](/cocoppang/ShieldStore/pulse)

## Files

 master
## Breadcrumbs

1. [ShieldStore](/cocoppang/ShieldStore/tree/master)
2. /[Enclave](/cocoppang/ShieldStore/tree/master/Enclave)
/
# Enclave.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/cocoppang/ShieldStore/commits/master/Enclave/Enclave.cpp)452 lines (344 loc) · 10.3 KB master
## Breadcrumbs

1. [ShieldStore](/cocoppang/ShieldStore/tree/master)
2. /[Enclave](/cocoppang/ShieldStore/tree/master/Enclave)
/
# Enclave.cpp

Top
## File metadata and controls

* Code
* Blame

452 lines (344 loc) · 10.3 KB[Raw](https://github.com/cocoppang/ShieldStore/raw/refs/heads/master/Enclave/Enclave.cpp)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452#include "Enclave.h"#include <queue>#include <vector>
int num = 0;int exit\_count = 0;
hashtable\* ht\_enclave = NULL;MACbuffer\* MACbuf\_enclave = NULL;BucketMAC\* MACTable = NULL;Arg arg\_enclave;int ratio\_root\_per\_buckets = 0;
sgx\_thread\_mutex\_t global\_mutex;sgx\_thread\_mutex\_t\* queue\_mutex;sgx\_thread\_cond\_t\* job\_cond;std::vector<std::queue<job \*> > queue;
/\*\* \* init enclave values  \*\*/void enclave\_init\_values(hashtable\* ht\_, MACbuffer\* MACbuf\_, Arg arg) {
 ht\_enclave = ht\_;  MACbuf\_enclave = MACbuf\_;
 arg\_enclave = arg;
 //set the ratio of subtree root node inside the enclave memory  //over total hash value of buckets ratio\_root\_per\_buckets = ht\_enclave->size/arg\_enclave.tree\_root\_size;
 MACTable = (BucketMAC\*)malloc(sizeof(BucketMAC)\* arg\_enclave.tree\_root\_size); for(int i = 0; i < arg\_enclave.tree\_root\_size; i++) { memset(MACTable[i].mac ,0 ,MAC\_SIZE); }
 //Initialize mutex variables sgx\_thread\_mutex\_init(&global\_mutex, NULL);
 queue\_mutex = (sgx\_thread\_mutex\_t\*)malloc(sizeof(sgx\_thread\_mutex\_t)\*arg\_enclave.num\_threads); job\_cond = (sgx\_thread\_cond\_t\*)malloc(sizeof(sgx\_thread\_cond\_t)\*arg\_enclave.num\_threads); for(int i = 0 ; i < arg\_enclave.num\_threads; i++) { queue.push\_back(std::queue<job\*>());  } }
/\*\*  \* processing set operation  \*\*/void enclave\_set(char \*cipher) {
 char\* key; char\* val; char\* key\_val; char\* plain\_key\_val = NULL; uint8\_t nac[NAC\_SIZE]; uint8\_t mac[MAC\_SIZE]; uint8\_t prev\_mac[MAC\_SIZE]; uint8\_t updated\_nac[NAC\_SIZE];
 uint32\_t key\_size; uint32\_t val\_size;
 uint8\_t key\_idx;
 char \*tok; char \*temp\_; entry \* ret\_entry;
 bool is\_insert = false;
 tok = strtok\_r(cipher+4," ",&temp\_); key\_size = strlen(tok)+1; key = (char\*)malloc(sizeof(char)\*key\_size); memset(key, 0, key\_size); memcpy(key, tok, key\_size-1);
 val\_size = strlen(temp\_)+1; val = (char\*)malloc(sizeof(char)\*val\_size); memset(val, 0, val\_size); memcpy(val, temp\_, val\_size-1);
 int kv\_pos = -1;
 ret\_entry = ht\_get\_o(key, key\_size, &plain\_key\_val, &kv\_pos, updated\_nac);  int hash\_val = ht\_hash(key); key\_idx = key\_hash\_func(key);
 sgx\_status\_t ret = SGX\_SUCCESS;
 /\* verifying integrity of data \*/ //update if(ret\_entry != NULL) { ret = enclave\_verification(ret\_entry->key\_val, ret\_entry->key\_hash, ret\_entry->key\_size, ret\_entry->val\_size, ret\_entry->nac, ret\_entry->mac);
 if(ret != SGX\_SUCCESS) { print("MAC verification failed"); }
 memcpy(nac, updated\_nac, NAC\_SIZE); free(plain\_key\_val);
 is\_insert = false; memcpy(prev\_mac, ret\_entry->mac, MAC\_SIZE); } //insert else { /\* Make initial nac \*/ sgx\_read\_rand(nac, NAC\_SIZE); assert(plain\_key\_val == NULL); is\_insert = true; }
 /\* We have to encrypt key and value together, so make con field \*/ key\_val = (char\*)malloc(sizeof(char)\*(key\_size+val\_size)); memcpy(key\_val, key, key\_size); memcpy(key\_val + key\_size, val, val\_size);
 enclave\_encrypt(key\_val, key\_val, key\_idx, key\_size, val\_size, nac, mac);
 ht\_set\_o(ret\_entry, key, key\_val, nac, mac, key\_size, val\_size, kv\_pos);
 ret = enclave\_rebuild\_tree\_root(hash\_val, kv\_pos, is\_insert, prev\_mac);
 if(ret != SGX\_SUCCESS) { print("Tree verification failed"); }
 memset(cipher, 0, arg\_enclave.max\_buf\_size); memcpy(cipher, key, key\_size);
 free(key); free(val); free(key\_val);}
/\*\*  \* processing get operation  \*\*/void enclave\_get(char \*cipher){
 char\* key; char\* plain\_key\_val = NULL; uint32\_t key\_size;
 char \*tok; char \*temp\_; entry \* ret\_entry;
 uint8\_t updated\_nac[NAC\_SIZE];
 tok = strtok\_r(cipher+4," ",&temp\_); key\_size = strlen(tok)+1; key = (char\*)malloc(sizeof(char)\*key\_size); memset(key, 0, key\_size); memcpy(key, tok, key\_size-1);
 int kv\_pos = -1; ret\_entry = ht\_get\_o(key, key\_size, &plain\_key\_val, &kv\_pos, updated\_nac);
 if(ret\_entry == NULL){ print("GET FAILED: No data in database"); return; }
 int hash\_val = ht\_hash(key);  sgx\_status\_t ret = SGX\_SUCCESS;
 /\* verifying integrity of data \*/ ret = enclave\_verification(ret\_entry->key\_val, ret\_entry->key\_hash, ret\_entry->key\_size, ret\_entry->val\_size, ret\_entry->nac, ret\_entry->mac);
 if(ret != SGX\_SUCCESS) { print("MAC verification failed"); }
 ret = enclave\_verify\_tree\_root(hash\_val);
 if(ret != SGX\_SUCCESS) { print("Tree verification failed"); }
 memset(cipher, 0, arg\_enclave.max\_buf\_size); memcpy(cipher, plain\_key\_val+ret\_entry->key\_size, ret\_entry->val\_size);
 free(key); free(plain\_key\_val);
}
/\*\* \* processing append operation  \*\*/void enclave\_append(char \*cipher){
 char\* key; char\* val; char\* key\_val; char\* plain\_key\_val; uint8\_t nac[NAC\_SIZE]; uint8\_t mac[MAC\_SIZE]; uint8\_t prev\_mac[MAC\_SIZE]; uint8\_t updated\_nac[NAC\_SIZE];
 uint32\_t key\_size; uint32\_t val\_size;
 uint8\_t key\_idx;
 char \*tok; char \*temp\_; entry \* ret\_entry;
 tok = strtok\_r(cipher+4," ",&temp\_); key\_size = strlen(tok)+1; key = (char\*)malloc(sizeof(char)\*key\_size); memset(key, 0, key\_size); memcpy(key, tok, key\_size-1);
 val\_size = strlen(temp\_)+1; val = (char\*)malloc(sizeof(char)\*val\_size); memset(val, 0, val\_size); memcpy(val, temp\_, val\_size-1);
 int kv\_pos = -1;
 ret\_entry = ht\_get\_o(key, key\_size, &plain\_key\_val, &kv\_pos, updated\_nac);
 int hash\_val = ht\_hash(key); key\_idx = key\_hash\_func(key);
 sgx\_status\_t ret = SGX\_SUCCESS;
 /\* verifying integrity of data \*/ //update if(ret\_entry != NULL) {  ret = enclave\_verification(ret\_entry->key\_val, ret\_entry->key\_hash, ret\_entry->key\_size, ret\_entry->val\_size, ret\_entry->nac, ret\_entry->mac);
 if(ret != SGX\_SUCCESS) { print("MAC verification failed"); }
 memcpy(nac, updated\_nac, NAC\_SIZE); memcpy(prev\_mac, ret\_entry->mac, MAC\_SIZE); } //insert else { print("There's no data in the database"); return; }
 /\* Make appended key-value \*/ key\_val = (char\*)malloc(sizeof(char)\*(ret\_entry->key\_size + ret\_entry->val\_size + val\_size - 1)); memcpy(key\_val, plain\_key\_val, ret\_entry->key\_size + ret\_entry->val\_size); memcpy(key\_val + ret\_entry->key\_size + ret\_entry->val\_size - 1, val, val\_size);
 enclave\_encrypt(key\_val, key\_val, key\_idx, key\_size, ret\_entry->val\_size + val\_size - 1, nac, mac);
 ht\_append\_o(ret\_entry, key, key\_val, nac, mac, key\_size, ret\_entry->val\_size + val\_size - 1, kv\_pos);
 ret = enclave\_rebuild\_tree\_root(hash\_val, kv\_pos, false, prev\_mac);
 if(ret != SGX\_SUCCESS) { print("Tree verification failed"); }
 memset(cipher, 0, arg\_enclave.max\_buf\_size); memcpy(cipher, key, key\_size);
 free(key); free(val); free(plain\_key\_val); free(key\_val);}
/\*\* \* processing server working threads \*\*/void enclave\_worker\_thread(hashtable \*ht\_, MACbuffer \*MACbuf\_) {
 int thread\_id; job \*cur\_job = NULL; char \*cipher = NULL;
 ht\_enclave = ht\_; MACbuf\_enclave = MACbuf\_;
 sgx\_thread\_mutex\_lock(&global\_mutex);
 thread\_id = num; num+=1;
 sgx\_thread\_mutex\_init(&queue\_mutex[thread\_id], NULL); sgx\_thread\_cond\_init(&job\_cond[thread\_id], NULL);
 sgx\_thread\_mutex\_unlock(&global\_mutex);
 sgx\_thread\_mutex\_lock(&queue\_mutex[thread\_id]);  while(1) {
 if(queue[thread\_id].size() == 0) { sgx\_thread\_cond\_wait(&job\_cond[thread\_id], &queue\_mutex[thread\_id]); continue; }
 cur\_job = queue[thread\_id].front(); cipher = cur\_job->buf;
 sgx\_thread\_mutex\_unlock(&queue\_mutex[thread\_id]);
 if(strncmp(cipher, "GET", 3) == 0 || strncmp(cipher, "get", 3) == 0) {  enclave\_get(cipher); } else if(strncmp(cipher, "SET", 3) == 0 || strncmp(cipher, "set", 3) == 0) { enclave\_set(cipher); } else if(strncmp(cipher, "APP", 3) == 0 || strncmp(cipher, "app", 3) == 0) { enclave\_append(cipher); } else if(strncmp(cipher, "quit", 4) == 0 ) { sgx\_thread\_mutex\_lock(&queue\_mutex[thread\_id]); queue[thread\_id].pop(); free(cipher); free(cur\_job); sgx\_thread\_mutex\_unlock(&queue\_mutex[thread\_id]);
 sgx\_thread\_mutex\_destroy(&queue\_mutex[thread\_id]); sgx\_thread\_cond\_destroy(&job\_cond[thread\_id]); return; } else{ print("Untyped request"); break; }
 message\_return(cipher, arg\_enclave.max\_buf\_size, cur\_job->client\_sock);
 sgx\_thread\_mutex\_lock(&queue\_mutex[thread\_id]); queue[thread\_id].pop(); free(cipher); free(cur\_job); }
 return;
}
/\*\* \* Bring the resquest to enclave \* parsing the key and send the requests to specific thread \*\*/void enclave\_message\_pass(void\* data) {
 EcallParams \*ecallParams = (EcallParams \*)data;
 char\* cipher = ecallParams->buf; int client\_sock = ecallParams->client\_sock\_; int num\_clients = ecallParams->num\_clients\_;
 char\* key; uint32\_t key\_size; char \*tok; char \*temp\_; int thread\_id = 0;
 job\* new\_job = NULL;
 if(strncmp(cipher, "EXIT", 4) == 0 || strncmp(cipher, "exit", 4) == 0 ){ message\_return(cipher, arg\_enclave.max\_buf\_size, client\_sock); exit\_count++;
 if(exit\_count == num\_clients) { print("All threads are finished"); //Send exit message to all of the worker threads for(int i = 0 ; i < arg\_enclave.num\_threads; i++) { new\_job = (job\*)malloc(sizeof(job)); new\_job->buf = (char\*)malloc(sizeof(char)\*arg\_enclave.max\_buf\_size); memset(new\_job->buf, 0, arg\_enclave.max\_buf\_size); memcpy(new\_job->buf, "quit" , 4); new\_job->client\_sock = -1;
 sgx\_thread\_mutex\_lock(&queue\_mutex[i]); queue[i].push(new\_job); sgx\_thread\_cond\_signal(&job\_cond[i]); sgx\_thread\_mutex\_unlock(&queue\_mutex[i]); } } } else if(strncmp(cipher, "LOADDONE", 8) == 0) { print("Load process is done"); message\_return(cipher, arg\_enclave.max\_buf\_size, client\_sock); } else {
 new\_job = (job\*)malloc(sizeof(job)); new\_job->buf = (char\*)malloc(sizeof(char)\*arg\_enclave.max\_buf\_size); memcpy(new\_job->buf, cipher, arg\_enclave.max\_buf\_size); new\_job->client\_sock = client\_sock;
 //parsing key tok = strtok\_r(cipher+4," ",&temp\_); key\_size = strlen(tok)+1; key = (char\*)malloc(sizeof(char)\*key\_size); memset(key, 0, key\_size); memcpy(key, tok, key\_size-1);
 //send the requests to specific worker thread thread\_id = (int)(ht\_hash(key)/(ht\_enclave->size/arg\_enclave.num\_threads)); free(key); sgx\_thread\_mutex\_lock(&queue\_mutex[thread\_id]); queue[thread\_id].push(new\_job); sgx\_thread\_cond\_signal(&job\_cond[thread\_id]); sgx\_thread\_mutex\_unlock(&queue\_mutex[thread\_id]); }
 return;}
/\*\* \* Hotcalls responder \*\*/void EcallStartResponder( HotCall\* hotEcall ){ void (\*callbacks[1])(void\*); callbacks[0] = enclave\_message\_pass;
 HotCallTable callTable; callTable.numEntries = 1; callTable.callbacks = callbacks;
 HotCall\_waitForCall( hotEcall, &callTable );}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


