=== Content from www.mediawiki.org_9157a445_20250114_232956.html ===
[Jump to content](#bodyContent)

Main menu

Main menu
move to sidebar
hide

Navigation

* [Main page](/wiki/MediaWiki "Visit the main page [z]")
* [Get MediaWiki](/wiki/Download)
* [Get extensions](/wiki/Special%3AMyLanguage/Category%3AExtensions)
* [Tech blog](https://techblog.wikimedia.org/)
* [Contribute](/wiki/Special%3AMyLanguage/How_to_contribute)

Support

* [User help](/wiki/Special%3AMyLanguage/Help%3AContents "The place to find out")
* [FAQ](/wiki/Special%3AMyLanguage/Manual%3AFAQ)
* [Technical manual](/wiki/Special%3AMyLanguage/Manual%3AContents)
* [Support desk](/wiki/Project%3ASupport_desk)
* [Communication](/wiki/Special%3AMyLanguage/Communication)

Development

* [Developer portal](https://developer.wikimedia.org/)
* [Code statistics](/wiki/Development_statistics)

mediawiki.org

* [Community portal](/wiki/Project%3AHelp "About the project, what you can do, where to find things")
* [Recent changes](/wiki/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Translate content](/wiki/Special%3ALanguageStats)
* [Random page](/wiki/Special%3ARandom "Load a random page [x]")
* [Village pump](/wiki/Project%3AVillage_Pump)
* [Sandbox](/wiki/Project%3ASandbox)

In other languages

[Add links](https://www.wikidata.org/wiki/Special%3ANewItem?site=mediawikiwiki&page=2021-12+security+release%2FFAQ "Add interlanguage links")

[![](/static/images/icons/mediawikiwiki.svg)
![MediaWiki](/static/images/mobile/copyright/mediawikiwiki-wordmark.svg)](/wiki/MediaWiki)

[Search](/wiki/Special%3ASearch "Search MediaWiki [f]")

Search

* English

Appearance

* [Donate](https://donate.wikimedia.org/?wmf_source=donate&wmf_medium=sidebar&wmf_campaign=www.mediawiki.org&uselang=en)
* [Create account](/w/index.php?title=Special:CreateAccount&returnto=2021-12+security+release%2FFAQ "You are encouraged to create an account and log in; however, it is not mandatory")
* [Log in](/w/index.php?title=Special:UserLogin&returnto=2021-12+security+release%2FFAQ "You are encouraged to log in; however, it is not mandatory [o]")

Personal tools

* [Donate](https://donate.wikimedia.org/?wmf_source=donate&wmf_medium=sidebar&wmf_campaign=www.mediawiki.org&uselang=en)
* [Create account](/w/index.php?title=Special:CreateAccount&returnto=2021-12+security+release%2FFAQ "You are encouraged to create an account and log in; however, it is not mandatory")
* [Log in](/w/index.php?title=Special:UserLogin&returnto=2021-12+security+release%2FFAQ "You are encouraged to log in; however, it is not mandatory [o]")

Pages for logged out editors [learn more](/wiki/Help%3AIntroduction)

* [Contributions](/wiki/Special%3AMyContributions "A list of edits made from this IP address [y]")
* [Talk](/wiki/Special%3AMyTalk "Discussion about edits from this IP address [n]")

## Contents

move to sidebar
hide

* Beginning
* [1
  What are the issues?](#What_are_the_issues?)
* [2
  I don't have time to patch, how do I disable this?](#I_don't_have_time_to_patch,_how_do_I_disable_this?)
* [3
  Was I affected?](#Was_I_affected?)
* [4
  What versions are vulnerable?](#What_versions_are_vulnerable?)
* [5
  How is this being fixed long-term?](#How_is_this_being_fixed_long-term?)
* [6
  How can I see if someone exploited it on my wiki?](#How_can_I_see_if_someone_exploited_it_on_my_wiki?)
* [7
  Credit](#Credit)

Toggle the table of contents

# 2021-12 security release/FAQ

* [Page](/wiki/2021-12_security_release/FAQ "View the content page [c]")
* [Discussion](/w/index.php?title=Talk:2021-12_security_release/FAQ&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

* [Read](/wiki/2021-12_security_release/FAQ)
* [View source](/w/index.php?title=2021-12_security_release/FAQ&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/w/index.php?title=2021-12_security_release/FAQ&action=history "Past revisions of this page [h]")

Tools

Tools
move to sidebar
hide

Actions

* [Read](/wiki/2021-12_security_release/FAQ)
* [View source](/w/index.php?title=2021-12_security_release/FAQ&action=edit)
* [View history](/w/index.php?title=2021-12_security_release/FAQ&action=history)

General

* [What links here](/wiki/Special%3AWhatLinksHere/2021-12_security_release/FAQ "A list of all wiki pages that link here [j]")
* [Related changes](/wiki/Special%3ARecentChangesLinked/2021-12_security_release/FAQ "Recent changes in pages linked from this page [k]")
* [Upload file](//commons.wikimedia.org/wiki/Special%3AUploadWizard "Upload files [u]")
* [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
* [Permanent link](/w/index.php?title=2021-12_security_release/FAQ&oldid=5793766 "Permanent link to this revision of this page")
* [Page information](/w/index.php?title=2021-12_security_release/FAQ&action=info "More information about this page")
* [Cite this page](/w/index.php?title=Special:CiteThisPage&page=2021-12_security_release%2FFAQ&id=5793766&wpFormIdentifier=titleform "Information on how to cite this page")
* [Get shortened URL](/w/index.php?title=Special:UrlShortener&url=https%3A%2F%2Fwww.mediawiki.org%2Fwiki%2F2021-12_security_release%2FFAQ)
* [Download QR code](/w/index.php?title=Special:QrCode&url=https%3A%2F%2Fwww.mediawiki.org%2Fwiki%2F2021-12_security_release%2FFAQ)

Print/export

* [Create a book](/w/index.php?title=Special:Book&bookcmd=book_creator&referer=2021-12+security+release%2FFAQ)
* [Download as PDF](/w/index.php?title=Special:DownloadAsPdf&page=2021-12_security_release%2FFAQ&action=show-download-screen)
* [Printable version](/w/index.php?title=2021-12_security_release/FAQ&printable=yes "Printable version of this page [p]")

In other projects

Appearance
move to sidebar
hide

From mediawiki.org

[Translate this page](/w/index.php?title=Special:Translate&group=page-2021-12+security+release%2FFAQ&action=page&filter=&action_source=translate_page "Special:Translate")Languages:

* [Bahasa Indonesia](/wiki/2021-12_security_release/FAQ/id "Rilis keamanan Desember 2021/Pertanyaan umum (100% translated)")
* [Deutsch](/wiki/2021-12_security_release/FAQ/de "Sicherheitsveröffentlichung Dezember 2021 – Häufige Fragen (100% translated)")
* English
* [Nederlands](/wiki/2021-12_security_release/FAQ/nl "2021-12 veiligheid release/FAQ (100% translated)")
* [Sunda](/wiki/2021-12_security_release/FAQ/su "2021-12 security release/FAQ/su (0% translated)")
* [Tiếng Việt](/wiki/2021-12_security_release/FAQ/vi "Bản phát hành bảo mật 2021-12/Câu hỏi thường gặp (16% translated)")
* [Zazaki](/wiki/2021-12_security_release/FAQ/diq "2021-12 security release/FAQ/diq (6% translated)")
* [español](/wiki/2021-12_security_release/FAQ/es "2021-12 liberación de seguridad/FAQ (100% translated)")
* [español (formal)](/wiki/2021-12_security_release/FAQ/es-formal "2021-12 security release/FAQ/es-formal (3% translated)")
* [français](/wiki/2021-12_security_release/FAQ/fr "Version de sécurité 2021-12/FAQ (100% translated)")
* [français cadien](/wiki/2021-12_security_release/FAQ/frc "2021-12 security release/FAQ/frc (3% translated)")
* [italiano](/wiki/2021-12_security_release/FAQ/it "2021-12 security release/FAQ/it (16% translated)")
* [magyar](/wiki/2021-12_security_release/FAQ/hu "2021-12 biztonsági kiadás/GYIK (39% translated)")
* [polski](/wiki/2021-12_security_release/FAQ/pl "2021-12 zwolnienie bezpieczeństwa/FAQ (6% translated)")
* [português do Brasil](/wiki/2021-12_security_release/FAQ/pt-br "Lançamento de segurança de dezembro de 2021 / Perguntas frequentes (100% translated)")
* [čeština](/wiki/2021-12_security_release/FAQ/cs "2021-12 security release/FAQ/cs (0% translated)")
* [аԥсшәа](/wiki/2021-12_security_release/FAQ/ab "Версия безопасности 2021-12/часто задаваемые вопросы (3% translated)")
* [русский](/wiki/2021-12_security_release/FAQ/ru "Версия безопасности декабрь 2021 года/ЧЗВ (23% translated)")
* [অসমীয়া](/wiki/2021-12_security_release/FAQ/as "2021-12 security release/FAQ/as (0% translated)")
* [বাংলা](/wiki/2021-12_security_release/FAQ/bn "২০২১-২২ নিরাপত্তাসংক্রান্ত প্রকাশনা/প্রাজিপ্র (19% translated)")
* [中文](/wiki/2021-12_security_release/FAQ/zh "2021-12安全发布/常见问题解答 (100% translated)")
* [日本語](/wiki/2021-12_security_release/FAQ/ja "2021-12 セキュリティについて/FAQ (81% translated)")
* [閩南語 / Bân-lâm-gú](/wiki/2021-12_security_release/FAQ/nan "2021-12 an-tsuân huat-pòo/TMB (Tsiap-Mn̄g ê Būn-tê) (29% translated)")

A series of vulnerabilities have been found in MediaWiki that allow an attacker to leak page contents from private wikis and bypass edit permissions.
The main vector for this wiki-leak is using vulnerable actions on pages that are listed in `[$wgWhitelistRead](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistRead "Special:MyLanguage/Manual:$wgWhitelistRead")` and therefore publicly accessible.
MediaWiki now only makes the "view" action publicly accessible on pages in `[$wgWhitelistRead](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistRead "Special:MyLanguage/Manual:$wgWhitelistRead")` by default.
These issues are fixed in 1.35.5, 1.36.3, and 1.37.1, see the [announcement](https://lists.wikimedia.org/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/QEN3EK4JXAVJMJ5GF3GYOAKNJPEKFQYA/) for links to tarballs and patches.

## What are the issues?

* CVE-2021-44858: The "undo" feature (`action=edit&undo=##&undoafter=###`) allowed an attacker to view the contents of arbitrary revisions, regardless of whether they had permissions to do so. This was also found in the "mcrundo" and "mcrrestore" actions (`action=mcrundo` and `action=mcrrestore`).
* CVE-2021-45038: The "rollback" feature (`action=rollback`) could be passed a specially crafted parameter that allowed an attacker to view the contents of arbitrary pages, regardless of whether they had permissions to do so.
* CVE-2021-44857: The "mcrundo" and "mcrrestore" actions (`action=mcrundo` and `action=mcrrestore`) did not properly check for editing permissions, and allowed an attacker to take the content of any arbitrary revision and save it on any page of their choosing. This affects both public wikis and public pages on private wikis.

## I don't have time to patch, how do I disable this?

Add the following to your LocalSettings.php:

```
$wgActions['mcrundo'] = false;
$wgActions['mcrrestore'] = false;

```

If your wiki is private (requires login to view pages) you will **also** need to set:

```
$wgWhitelistRead = [];
$wgWhitelistReadRegexp = [];

```

It should fully disable the vulnerable code. These changes will also work for vulnerable end-of-life MediaWiki versions that do not have a patch available.

If you used `[$wgWhitelistRead](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistRead "Special:MyLanguage/Manual:$wgWhitelistRead")` to allow logged-out users to see the main page with help text, you should instead move that help text to the [MediaWiki:Loginreqpagetext](/wiki/MediaWiki%3ALoginreqpagetext "MediaWiki:Loginreqpagetext") message, which is shown on the "login required" error.

## Was I affected?

* If your wiki is public (anyone can read pages): yes
* If your wiki is private, and `[$wgWhitelistRead](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistRead "Special:MyLanguage/Manual:$wgWhitelistRead")` or `[$wgWhitelistReadRegexp](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistReadRegexp "Special:MyLanguage/Manual:$wgWhitelistReadRegexp")` has at least one page: yes

If you use an extension like [Lockdown](/wiki/Special%3AMyLanguage/Extension%3ALockdown "Special:MyLanguage/Extension:Lockdown") or [Whitelist Pages](/wiki/Special%3AMyLanguage/Extension%3AWhitelist_Pages "Special:MyLanguage/Extension:Whitelist Pages") to make some pages unreadable to some users, you are also likely affected.

## What versions are vulnerable?

All MediaWiki versions since 1.23.0 until 1.34.x, and 1.35.x, 1.36.x, 1.37.x before the fixes (see [the top section](#contentSub)), are vulnerable to the private wiki read permissions bypasses (CVE-2021-44858, CVE-2021-45038).

All MediaWiki versions since 1.32.0 until 1.34.x, and 1.35.x, 1.36.x, 1.37.x before the fixes (see [the top section](#contentSub)), are vulnerable to the editing permissions bypass (CVE-2021-44857).

## How is this being fixed long-term?

All actions except "view" now require an explicit "read" user right. This is similar to permission checks used in the Action and REST APIs. If further vulnerabilities are found in actions, they will at least not be exploitable by logged-out users on private wikis.

Actions that need to be usable on `[$wgWhitelistRead](/wiki/Special%3AMyLanguage/Manual%3A%24wgWhitelistRead "Special:MyLanguage/Manual:$wgWhitelistRead")` pages can override the new `Action::needsReadRight()` function.

## How can I see if someone exploited it on my wiki?

Look for `action=mcrundo` or `action=mcrrestore` in your access logs. Unless you specifically enabled an extension that uses [multi-content revisions](/wiki/Special%3AMyLanguage/Multi-Content_Revisions "Special:MyLanguage/Multi-Content Revisions"), there is no legitimate use for these actions.

In addition, look for `action=edit&undo=###&undoafter=###` requests and check whether the revision IDs belong to a different title than the page being edited.

For the rollback bug, look for `action=rollback&from=...` where the "from" parameter is a template transclusion (for example, `from={{:private page}}`).

This bug does not cause any data loss, so any write actions an attacker could have taken will be recorded in page history like all other edits.

## Credit

The issue was discovered by [Dylsss](https://phabricator.wikimedia.org/p/Dylsss/ "phab:p/Dylsss/"), many thanks to them for identifying and reporting the issue.
If you find a bug in MediaWiki, please see the process for [reporting security bugs](/wiki/Special%3AMyLanguage/reporting_security_bugs "Special:MyLanguage/reporting security bugs").

![](https://login.wikimedia.org/wiki/Special:CentralAutoLogin/start?useformat=desktop&type=1x1&usesul3=0)
Retrieved from "<https://www.mediawiki.org/w/index.php?title=2021-12_security_release/FAQ&oldid=5793766>"

* This page was last edited on 25 February 2023, at 00:16.
* Text is available under the [Creative Commons Attribution-ShareAlike License](https://creativecommons.org/licenses/by-sa/4.0/deed.en); additional terms may apply. Text in [the Help: namespace](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Help%3AContents) is available under the [Creative Commons CC0 License](https://creativecommons.org/publicdomain/zero/1.0/).
  By using this site, you agree to the [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use) and [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3APrivacy_policy).

* [Privacy policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3APrivacy_policy)
* [About mediawiki.org](/wiki/Project%3AAbout)
* [Disclaimers](/wiki/Project%3AGeneral_disclaimer)
* [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct)
* [Developers](https://developer.wikimedia.org)
* [Statistics](https://stats.wikimedia.org/#/www.mediawiki.org)
* [Cookie statement](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ACookie_statement)
* [Mobile view](//m.mediawiki.org/w/index.php?title=2021-12_security_release/FAQ&mobileaction=toggle_view_mobile)

* [![Wikimedia Foundation](/static/images/footer/wikimedia-button.svg)](https://wikimediafoundation.org/)
* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki.svg)](https://www.mediawiki.org/)



=== Content from security.gentoo.org_ae3e6eb7_20250114_232954.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# MediaWiki: Multiple Vulnerabilities — GLSA **202305-24**

Multiple vulnerabilities have been found in MediaWiki, the worst of which could result in denial of service.

### Affected packages

| Package | **www-apps/mediawiki** on all architectures |
| --- | --- |
| Affected versions | < **1.38.5** |
| Unaffected versions | >= **1.38.5** |

### Background

MediaWiki is a collaborative editing software, used by big projects like Wikipedia.

### Description

Multiple vulnerabilities have been discovered in MediaWiki. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All MediaWiki users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apps/mediawiki-1.38.5"

```
### References

* [CVE-2021-41798](https://nvd.nist.gov/vuln/detail/CVE-2021-41798)
* [CVE-2021-41799](https://nvd.nist.gov/vuln/detail/CVE-2021-41799)
* [CVE-2021-41800](https://nvd.nist.gov/vuln/detail/CVE-2021-41800)
* [CVE-2021-44854](https://nvd.nist.gov/vuln/detail/CVE-2021-44854)
* [CVE-2021-44855](https://nvd.nist.gov/vuln/detail/CVE-2021-44855)
* [CVE-2021-44856](https://nvd.nist.gov/vuln/detail/CVE-2021-44856)
* [CVE-2021-44857](https://nvd.nist.gov/vuln/detail/CVE-2021-44857)
* [CVE-2021-44858](https://nvd.nist.gov/vuln/detail/CVE-2021-44858)
* [CVE-2021-45038](https://nvd.nist.gov/vuln/detail/CVE-2021-45038)
* [CVE-2022-28202](https://nvd.nist.gov/vuln/detail/CVE-2022-28202)
* [CVE-2022-28205](https://nvd.nist.gov/vuln/detail/CVE-2022-28205)
* [CVE-2022-28206](https://nvd.nist.gov/vuln/detail/CVE-2022-28206)
* [CVE-2022-28209](https://nvd.nist.gov/vuln/detail/CVE-2022-28209)
* [CVE-2022-31090](https://nvd.nist.gov/vuln/detail/CVE-2022-31090)
* [CVE-2022-31091](https://nvd.nist.gov/vuln/detail/CVE-2022-31091)
* [CVE-2022-34911](https://nvd.nist.gov/vuln/detail/CVE-2022-34911)
* [CVE-2022-34912](https://nvd.nist.gov/vuln/detail/CVE-2022-34912)
* [CVE-2022-41765](https://nvd.nist.gov/vuln/detail/CVE-2022-41765)
* [CVE-2022-41766](https://nvd.nist.gov/vuln/detail/CVE-2022-41766)
* [CVE-2022-41767](https://nvd.nist.gov/vuln/detail/CVE-2022-41767)
* [CVE-2022-47927](https://nvd.nist.gov/vuln/detail/CVE-2022-47927)

**Release date**

May 21, 2023

**Latest revision**

May 21, 2023: 1

**Severity**

low

**Exploitable**

remote

**Bugzilla entries**

* [815376](https://bugs.gentoo.org/show_bug.cgi?id=815376)
* [829302](https://bugs.gentoo.org/show_bug.cgi?id=829302)
* [836430](https://bugs.gentoo.org/show_bug.cgi?id=836430)
* [855965](https://bugs.gentoo.org/show_bug.cgi?id=855965)
* [873385](https://bugs.gentoo.org/show_bug.cgi?id=873385)
* [888041](https://bugs.gentoo.org/show_bug.cgi?id=888041)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from phabricator.wikimedia.org_54339857_20250114_232953.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT297322)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T297322
# CVE-2021-44857, CVE-2021-44858: Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo Closed, Resolved[Public](/policy/explain/PHID-TASK-xlpxs26wfan4pdtz7lst/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/297322/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/297322/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Protect as security issue](/wmf/escalate-task/297322/)
* [Award Token](/token/give/PHID-TASK-xlpxs26wfan4pdtz7lst/)
* [Flag For Later](/flag/edit/PHID-TASK-xlpxs26wfan4pdtz7lst/)

Assigned To

|  | [Legoktm](/p/Legoktm/) |
| --- | --- |

Authored By

|  | [Dylsss](/p/Dylsss/) |
| --- | --- |
| Dec 8 2021, 9:22 PM2021-12-08 21:22:20 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Incoming)](/project/board/1179/)
* [Security](/tag/security/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [Wikimedia-Incident](/tag/wikimedia-incident/) [(Active investigation)](/project/board/2143/)
* [Core Platform Team Initiatives (MCR)](/project/view/4200/)
* [MediaWiki-General](/tag/mediawiki-general/)
* [MW-1.35-notes](/tag/mw-1.35-notes/)
* [MW-1.36-notes](/tag/mw-1.36-notes/) [(Backlog)](/project/board/4479/)
* [MW-1.37-notes](/tag/mw-1.37-notes/)
* [MW-1.38-notes (1.38.0-wmf.18; 2022-01-17)](/project/view/5681/)
Referenced Files

|  | [F34884225: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_36.patch](/F34884225) |
| --- | --- |
| Dec 15 2021, 12:59 AM2021-12-15 00:59:59 (UTC+0) |

|  | [F34884223: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch](/F34884223) |
| --- | --- |
| Dec 15 2021, 12:59 AM2021-12-15 00:59:59 (UTC+0) |

|  | [F34884224: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_37.patch](/F34884224) |
| --- | --- |
| Dec 15 2021, 12:59 AM2021-12-15 00:59:59 (UTC+0) |

|  | [F34884227: 0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1\_31.patch](/F34884227) |
| --- | --- |
| Dec 15 2021, 12:59 AM2021-12-15 00:59:59 (UTC+0) |

|  | [F34883073: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch](/F34883073) |
| --- | --- |
| Dec 14 2021, 6:19 AM2021-12-14 06:19:38 (UTC+0) |

|  | [F34883075: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_36.patch](/F34883075) |
| --- | --- |
| Dec 14 2021, 6:19 AM2021-12-14 06:19:38 (UTC+0) |

|  | [F34883074: 0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_37.patch](/F34883074) |
| --- | --- |
| Dec 14 2021, 6:19 AM2021-12-14 06:19:38 (UTC+0) |

|  | [F34883076: 0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1\_31.patch](/F34883076) |
| --- | --- |
| Dec 14 2021, 6:19 AM2021-12-14 06:19:38 (UTC+0) |

[View All 22 Files](/file/ui/curtain/list/PHID-TASK-xlpxs26wfan4pdtz7lst/)Subscribers

|  | [Addshore](/p/Addshore/) |
| --- | --- |

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [brennen](/p/brennen/) |
| --- | --- |

|  | [CCicalese\_WMF](/p/CCicalese_WMF/) |
| --- | --- |

|  | [Daimona](/p/Daimona/) |
| --- | --- |

|  | [daniel](/p/daniel/) |
| --- | --- |

[View All 31 Subscribers](/subscriptions/list/PHID-TASK-xlpxs26wfan4pdtz7lst/)
# Description

The mcrundo action seems to do no checks at all for if users have permission to perform edits on that page. This means any user can undo edits on any protected page, such as the main page. E.g. this URL: <https://commons.wikimedia.org/w/index.php?title=Main_Page&action=mcrundo&undo=603639572&undoafter=600544238> will allow you to undo an edit on the main page.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [McrUndoAction: use authorizeWrite for permission checks.](https://gerrit.wikimedia.org/r/c/748706) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +5 -6 |
|  | [SECURITY: Fix permissions checks in undo actions](https://gerrit.wikimedia.org/r/c/747596) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +49 -4 |
|  | [SECURITY: Fix permissions checks in undo actions](https://gerrit.wikimedia.org/r/c/747578) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_36](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_36) | +49 -4 |
|  | [SECURITY: Fix permissions checks in undo actions](https://gerrit.wikimedia.org/r/c/747585) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_37) | +50 -4 |
|  | [SECURITY: Fix permissions checks in undo actions](https://gerrit.wikimedia.org/r/c/747571) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_35) | +49 -4 |
|  | [trafficserver: Temporarily disable mwdebug on kubernetes](https://gerrit.wikimedia.org/r/c/745963) | [operations/puppet](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/puppet) | [production](https://gerrit.wikimedia.org/r/plugins/gitiles/operations/puppet/%2B/production) | +8 -2 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T297322)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T292226 [Release MediaWiki 1.35.5/1.36.3/1.37.1](/T292226) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T292227 [Tracking bug for MediaWiki 1.35.5/1.36.3/1.37.1](/T292227) |
|  |  | Resolved | Security | [Legoktm](/p/Legoktm/) | T297322 [CVE-2021-44857, CVE-2021-44858: Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo](/T297322) |

Mentioned In [T277748: undoafter from different page should not be marked with undo and reverted tags](/T277748)
[T307322: Allow 3-way merge from arbitrary revisions after T297322](/T307322)
[T297896: Apply changes from 1.35.5 to unsupported legacy branch `REL1\_31`](/T297896)
[T297574: CVE-2021-45038: Unauthorized users can access private wiki contents using rollback action](/T297574)
[T297541: Publish FAQ for undo security bug](/T297541)
[T297517: wtp\* hosts: Out of memory (allocated 39845888) (tried to allocate 131072 bytes) in OutputHandler.php](/T297517)
[T292227: Tracking bug for MediaWiki 1.35.5/1.36.3/1.37.1](/T292227)
[T297423: Lockdown's partial page restrictions can be bypassed via undo](/T297423)
[T297416: Restrict access to most actions on $wgWhitelistRead pages on private wikis](/T297416) Mentioned Here [T292227: Tracking bug for MediaWiki 1.35.5/1.36.3/1.37.1](/T292227)
[T297574: CVE-2021-45038: Unauthorized users can access private wiki contents using rollback action](/T297574)
[T297541: Publish FAQ for undo security bug](/T297541)
[T271037: CVE-2021-44856: Title blocked in AbuseFilter can be created via Special:ChangeContentModel due to the mishandling of EditFilterMergedContent hook return value](/T271037)
[T297416: Restrict access to most actions on $wgWhitelistRead pages on private wikis](/T297416)
[T34716: $wgWhitelistRead leaks username data (Because it allows viewing old revisions and diffs)](/T34716)
[T292229: Write and send pre-release announcements for MediaWiki 1.35.5/1.36.3/1.37.1](/T292229)
[T292230: Write and send release announcements for MediaWiki 1.35.5/1.36.3/1.37.1](/T292230)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-xlpxs26wfan4pdtz7lst/?after=7560545&quoteTargetID=UQ0_1&quoteRef=T297322)

[Ladsgroup](/p/Ladsgroup/) added a subscriber: [Grunny](/p/Grunny/).[Dec 9 2021, 5:22 PM2021-12-09 17:22:35 (UTC+0)](#7560545)Comment Actions

Pinging [@Grunny](/p/Grunny/) who has access to this ticket already but for the sake of visibility

[Grunny](/p/Grunny/) added a comment.[Dec 9 2021, 5:31 PM2021-12-09 17:31:25 (UTC+0)](#7560571)Comment Actions

Thanks [@Ladsgroup](/p/Ladsgroup/)! We'll patch it on our side privately.

[taavi](/p/taavi/) mentioned this in [T297416: Restrict access to most actions on $wgWhitelistRead pages on private wikis](/T297416).[Dec 9 2021, 5:46 PM2021-12-09 17:46:42 (UTC+0)](#7560629)Comment Actions
> In [T297322#7560492](/T297322#7560492), [@Legoktm](/p/Legoktm/) wrote:
> > In [T297322#7559979](/T297322#7559979), [@sbassett](/p/sbassett/) wrote:
> >
> > Wanted to capture @Majavah's suggestion in \_security here, just so it wasn't lost:
> >
> > ```
> > majavah> about the mcr incident: what if we removed the ability to read the main page and common.css/js and instead encouraged people to override MediaWiki:Loginreqpagetext to explain the wiki as well
> > ```
>
> This is a great idea. It would also fix [T34716: $wgWhitelistRead leaks username data (Because it allows viewing old revisions and diffs)](/T34716).

Filed this separately ([T297416: Restrict access to most actions on $wgWhitelistRead pages on private wikis](/T297416)).

[Legoktm](/p/Legoktm/) mentioned this in [T297423: Lockdown's partial page restrictions can be bypassed via undo](/T297423).[Dec 9 2021, 6:21 PM2021-12-09 18:21:04 (UTC+0)](#7560852)

[Legoktm](/p/Legoktm/) raised the priority of this task from High to Unbreak Now!.[Dec 9 2021, 6:29 PM2021-12-09 18:29:14 (UTC+0)](#7560874)Comment Actions
> In [T297322#7557949](/T297322#7557949), [@Legoktm](/p/Legoktm/) wrote:
>
> In the short term to re-enable the actions I think we need to add:
>
> * A check that the revids belong to the given title (shuts down infoleak)

Normal action=edit&undo= is also lacking this check, which allows for the same private wiki read exploit. <https://checkuser.wikimedia.org/w/index.php?title=Main_Page&action=edit&undo=39108&undoafter=32677>

[Legoktm](/p/Legoktm/) added a comment.[Dec 9 2021, 7:12 PM2021-12-09 19:12:46 (UTC+0)](#7560977)Comment Actions

0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/k3sdodsmxenwui3j6skf/PHID-FILE-d6goula2c4doiddysmnp/0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch)

[sbassett](/p/sbassett/) added a comment.[Dec 9 2021, 7:19 PM2021-12-09 19:19:39 (UTC+0)](#7560995)Comment Actions
> In [T297322#7560977](/T297322#7560977), [@Legoktm](/p/Legoktm/) wrote:
>
> 0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/k3sdodsmxenwui3j6skf/PHID-FILE-d6goula2c4doiddysmnp/0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch)

+2, same logic as what was used for the mcrundo/mcrrestore actions, and that's working fine. Can you deploy or should [@Reedy](/p/Reedy/) or I?

[taavi](/p/taavi/) added a comment.[Dec 9 2021, 7:19 PM2021-12-09 19:19:56 (UTC+0)](#7561008)Comment Actions
> In [T297322#7560977](/T297322#7560977), [@Legoktm](/p/Legoktm/) wrote:
>
> 0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/k3sdodsmxenwui3j6skf/PHID-FILE-d6goula2c4doiddysmnp/0001-SECURITY-Restore-check-that-undo-revisions-are-on-th.patch)

CR+2, with the note that this will likely break some workflows and possibly be noticed.

[Legoktm](/p/Legoktm/) added a comment.[Dec 9 2021, 8:09 PM2021-12-09 20:09:10 (UTC+0)](#7561213)Comment Actions

[T297322#7560977](/T297322#7560977) is now deployed (required -3 on wmf.9), though it wasn't exploitable since @majavah disabled $wgWhitelistRead a few minutes earlier.

[Legoktm](/p/Legoktm/) added a comment.[Dec 9 2021, 9:45 PM2021-12-09 21:45:48 (UTC+0)](#7561433)Comment Actions
> In [F34871493#2767](/F34871493#2767), [@daniel](/p/daniel/) wrote:
>
> The downcast should not be necessary, you should be able to do:
>
> ```
> $this->mTitle->isSamePageAs( $undorev->getPage() ) && $this->mTitle->isSamePageAs( $oldrev->getPage() )
> ```

isSamePageAs() is marked as @since 1.36, and we need to backport this to at least 1.35, which has castFromLinkTarget.

(also please keep the code review on the task instead of the file, just so it stays centralized)

[Legoktm](/p/Legoktm/) added a comment.[Dec 10 2021, 2:17 AM2021-12-10 02:17:26 (UTC+0)](#7561914)Comment Actions
> In [T297322#7561433](/T297322#7561433), [@Legoktm](/p/Legoktm/) wrote:
> > In [F34871493#2767](/F34871493#2767), [@daniel](/p/daniel/) wrote:
> >
> > The downcast should not be necessary, you should be able to do:
> >
> > ```
> > $this->mTitle->isSamePageAs( $undorev->getPage() ) && $this->mTitle->isSamePageAs( $oldrev->getPage() )
> > ```
>
> isSamePageAs() is marked as @since 1.36, and we need to backport this to at least 1.35, which has castFromLinkTarget.

I just discovered RevisionLookup::getRevisionByTitle() which does the correct check at the database layer \o/ - I'll post some updated patches later today or tomorrow.

[Grunny](/p/Grunny/) added a subscriber: [TK-999](/p/TK-999/).[Dec 10 2021, 1:13 PM2021-12-10 13:13:50 (UTC+0)](#7562779)

[taavi](/p/taavi/) added a comment.[Dec 10 2021, 7:15 PM2021-12-10 19:15:16 (UTC+0)](#7563704)Comment Actions
> In [T297322#7560492](/T297322#7560492), [@Legoktm](/p/Legoktm/) wrote:
>
> * Bypassing EditFilterMergedContent, as quoted above

0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/zwwh5qh3to6yksuelyaq/PHID-FILE-hbmdbwx4afqvsrjtk3cc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)

[Reedy](/p/Reedy/) added a comment.Edited · [Dec 10 2021, 7:34 PM2021-12-10 19:34:07 (UTC+0)](#7563756)Comment Actions

Going to request 2 different CVE's for this issue, as there are two different issues underneath, even though they both happen via action=mcrundo

CVE 1:

It is possible to use action=mcrundo to view hidden pages on private wiki that have page titles set in $wgWhitelistRead.

CVE 2:

It is possible to use action=mcrundo to replace the content of any arbitary page (that the user doesn't have edit rights for) on a wiki. This affects all wikis.

[taavi](/p/taavi/) added a comment.Edited · [Dec 10 2021, 7:34 PM2021-12-10 19:34:40 (UTC+0)](#7563757)Comment Actions
> In [T297322#7563704](/T297322#7563704), @Majavah wrote:
> > In [T297322#7560492](/T297322#7560492), [@Legoktm](/p/Legoktm/) wrote:
> >
> > * Bypassing EditFilterMergedContent, as quoted above
>
> 0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/zwwh5qh3to6yksuelyaq/PHID-FILE-hbmdbwx4afqvsrjtk3cc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)

Updated patch:

0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/s4dop6df76eghd4de4ul/PHID-FILE-3pqx6337bxit6p5itnzc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)

[Ladsgroup](/p/Ladsgroup/) added a comment.[Dec 10 2021, 7:36 PM2021-12-10 19:36:30 (UTC+0)](#7563758)Comment Actions
> In [T297322#7563756](/T297322#7563756), [@Reedy](/p/Reedy/) wrote:
>
> Going to request 2 different CVE's for this issue, as there are two different issues underneath, even though they both happen via action=mcrundo
>
> CVE 1:
>
> It is possible to use action=mcrundo to view hidden pages on private wiki that have page titles set in $wgWhitelistRead.

I think this one also happens on action=undo as well, Correct?

[Legoktm](/p/Legoktm/) added a comment.[Dec 10 2021, 7:38 PM2021-12-10 19:38:29 (UTC+0)](#7563759)Comment Actions
> In [T297322#7563756](/T297322#7563756), [@Reedy](/p/Reedy/) wrote:
>
> Going to request 2 different CVE's for this issue, as there are two different issues underneath, even though they both happen via action=mcrundo

Tweaked:

> CVE 1:

It is possible to use action=edit&undo=, action=mcrundo, action=mcrrestore to view private pages on a private wiki that has at least one page set in $wgWhitelistRead. MediaWiki 1.23+

> CVE 2:

It is possible to use action=mcrundo, action=mcrrestore to replace the content of any arbitrary page (that the user doesn't have edit rights for) on a wiki if it is public, or is private and has at least one page set in $wgWhitelistRead. MediaWiki 1.32+

[taavi](/p/taavi/) added a comment.[Dec 10 2021, 7:40 PM2021-12-10 19:40:41 (UTC+0)](#7563766)Comment Actions
> In [T297322#7563759](/T297322#7563759), [@Legoktm](/p/Legoktm/) wrote:
>
> It is possible to use action=mcrundo, action=mcrrestore to replace the content of any arbitrary page (that the user doesn't have edit rights for) on a wiki if it is public, or is private and has at least one page set in $wgWhitelistRead. MediaWiki 1.32+

I think this only applies to pages which the user can see, so for private wikis only the pages in $wgWhitelistRead are affected for logged-out users.

[taavi](/p/taavi/) added a comment.[Dec 10 2021, 7:41 PM2021-12-10 19:41:35 (UTC+0)](#7563767)Comment Actions
> In [T297322#7563756](/T297322#7563756), [@Reedy](/p/Reedy/) wrote:
>
> Going to request 2 different CVE's for this issue, as there are two different issues underneath, even though they both happen via action=mcrundo

Does the EditFilterMergedContent issue need its own CVE too or is it covered by CVE 2?

[Legoktm](/p/Legoktm/) added a comment.[Dec 10 2021, 7:44 PM2021-12-10 19:44:12 (UTC+0)](#7563774)Comment Actions
> In [T297322#7563757](/T297322#7563757), @Majavah wrote:
>
> Updated patch:
>
> 0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/k6slndocsjgvbm74hb2x/PHID-FILE-j2jsfvqyk6sqzqss3erc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)

You're awesome. Code-Review +1 just because I'm a bit tired right now. Would be nice if someone more familiar with modern AbuseFilter could also look, but logic seems in line with [T271037#7178772](/T271037#7178772), which is also coming out with this release.

If you could double check that all the classes/functions referenced are available in 1.35 that would be appreciated too.

[Legoktm](/p/Legoktm/) added a comment.[Dec 10 2021, 7:45 PM2021-12-10 19:45:18 (UTC+0)](#7563786)Comment Actions
> In [T297322#7563767](/T297322#7563767), @Majavah wrote:
>
> Does the EditFilterMergedContent issue need its own CVE too or is it covered by CVE 2?

I think it's covered by CVE 2, which is generally about not checking editing permissions.

[Reedy](/p/Reedy/) added a subscriber: [Daimona](/p/Daimona/).[Dec 10 2021, 7:45 PM2021-12-10 19:45:52 (UTC+0)](#7563787)Comment Actions
> In [T297322#7563774](/T297322#7563774), [@Legoktm](/p/Legoktm/) wrote:
> > In [T297322#7563757](/T297322#7563757), @Majavah wrote:
> >
> > Updated patch:
> >
> > 0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/k6slndocsjgvbm74hb2x/PHID-FILE-j2jsfvqyk6sqzqss3erc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)
>
> You're awesome. Code-Review +1 just because I'm a bit tired right now. Would be nice if someone more familiar with modern AbuseFilter could also look, but logic seems in line with [T271037#7178772](/T271037#7178772), which is also coming out with this release.
>
> If you could double check that all the classes/functions referenced are available in 1.35 that would be appreciated too.

Ping [@Daimona](/p/Daimona/) :)

[taavi](/p/taavi/) added a comment.Edited · [Dec 10 2021, 7:53 PM2021-12-10 19:53:14 (UTC+0)](#7563804)Comment Actions
> In [T297322#7563774](/T297322#7563774), [@Legoktm](/p/Legoktm/) wrote:
> > In [T297322#7563757](/T297322#7563757), @Majavah wrote:
> >
> > Updated patch:
> >
> > 0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/k6slndocsjgvbm74hb2x/PHID-FILE-j2jsfvqyk6sqzqss3erc/0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)
>
> You're awesome. Code-Review +1 just because I'm a bit tired right now. Would be nice if someone more familiar with modern AbuseFilter could also look, but logic seems in line with [T271037#7178772](/T271037#7178772), which is also coming out with this release.
>
> If you could double check that all the classes/functions referenced are available in 1.35 that would be appreciated too.

I can't test that it works properly since I don't have a 1.35 database handy, but all relevant classes and method seem to be present. First two patches applied to REL1\_35 (with -3), but the EditFilterMergedContent one needed a little adjustment:

REL1\_35--0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/f62fphteca3dqo2ltwlc/PHID-FILE-c3duxwj7aak6fr24mxsy/REL1_35--0001-SECURITY-Call-EditFilterMergedContent-in-McrUndo.patch)

[Reedy](/p/Reedy/) mentioned this in [T292227: Tracking bug for MediaWiki 1.35.5/1.36.3/1.37.1](/T292227).[Dec 10 2021, 7:55 PM2021-12-10 19:55:41 (UTC+0)](#7563814)[Dylsss](/p/Dylsss/) added a comment.[Dec 10 2021, 8:06 PM2021-12-10 20:06:58 (UTC+0)](#7563863)Comment Actions
> In [T297322#7563759](/T297322#7563759), [@Legoktm](/p/Legoktm/) wrote:
> > In [T297322#7563756](/T297322#7563756), [@Reedy](/p/Reedy/) wrote:
> >
> > Going to request 2 different CVE's for this issue, as there are two different issues underneath, even though they both happen via action=mcrundo
>
> Tweaked:
>
> > CVE 1:
>
> It is possible to use action=edit&undo=, action=mcrundo, action=mcrrestore to view private pages on a private wiki that has at least one page set in $wgWhitelistRead. MediaWiki 1.23+
>
> > CVE 2:
>
> It is possible to use action=mcrundo, action=mcrrestore to replace the content of any arbitrary page (that the user doesn't have edit rights for) on a wiki if it is public, or is private and has at least one page set in $wgWhitelistRead. MediaWiki 1.32+

In CVE 1, I would change "view private pages" to "view private revisions" to be more specific, although the exploit will not work when the revision is part of a deleted page or revision deleted as far as I can tell, not sure if that needs to be emphasized. In CVE 2 you need to gain edit rights in some form to replace pages with arbitrary content, without edit rights you can't replace Common.js with malicious JS for example, without first creating a revision to restore (which you can't do without edit rights). Thus without already having edit rights on the wiki, the risk of CVE 2 is decreased (eliminates arbitrary JavaScript execution) and the exploit is limited to replacing page content with revisions that already exist.

[Reedy](/p/Reedy/) added a comment.[Dec 10 2021, 8:08 PM2021-12-10 20:08:03 (UTC+0)](#7563865)Comment Actions

CVE request has gone in ;). It can be updated at a later date :)

[Reedy](/p/Reedy/) added projects: [Core Platform Team Initiatives (MCR)](/project/view/4200/), [MediaWiki-General](/tag/mediawiki-general/).[Dec 10 2021, 8:25 PM2021-12-10 20:25:42 (UTC+0)](#7563925)[Dylsss](/p/Dylsss/) added a comment.[Dec 10 2021, 10:55 PM2021-12-10 22:55:13 (UTC+0)](#7564208)This comment was removed by [Dylsss](/p/Dylsss/).

[RLazarus](/p/RLazarus/) subscribed.Edited · [Dec 10 2021, 11:34 PM2021-12-10 23:34:35 (UTC+0)](#7564232)Comment Actions

@Majavah noted that this was still exploitable via the k8s-experimental setting on the X-Wikimedia-Debug header/browser extension. It seems the k8s deployment may not be getting security patches reliably; we're investigating, but in the meantime [https://gerrit.wikimedia.org/r/c/operations/puppet/+/745963](https://gerrit.wikimedia.org/r/c/operations/puppet/%2B/745963) fully disabled the k8s-experimental option, so that issue is remediated.

Once we get the k8s build issues sorted out, we should revert that patch (e.g. [@Ladsgroup](/p/Ladsgroup/)'s <https://gerrit.wikimedia.org/r/745873>) so as not to inconvenience MW-on-k8s development unnecessarily.

[Legoktm](/p/Legoktm/) added a comment.[Dec 11 2021, 12:16 AM2021-12-11 00:16:39 (UTC+0)](#7564250)Comment Actions
> In [T297322#7564232](/T297322#7564232), [@RLazarus](/p/RLazarus/) wrote:
>
> @Majavah noted that this was still exploitable via the k8s-experimental setting on the X-Wikimedia-Debug header/browser extension. It seems the k8s deployment may not be getting security patches reliably; we're investigating, but in the meantime [https://gerrit.wikimedia.org/r/c/operations/puppet/+/745963](https://gerrit.wikimedia.org/r/c/operations/puppet/%2B/745963) fully disabled the k8s-experimental option, so that issue is remediated.
>
> Once we get the k8s build issues sorted out, we should revert that patch (e.g. [@Ladsgroup](/p/Ladsgroup/)'s <https://gerrit.wikimedia.org/r/745873>) so as not to inconvenience MW-on-k8s development unnecessarily.

This was my bad, I didn't commit the patches to /srv/patches. Did that and kicked off a new build. Verified that k8s-experimental is fixed now with curl -k -H 'Host: checkuser.wikimedia.org' 'https://mwdebug.discovery.wmnet:4444/w/index.php?title=Main\_Page&action=mcrundo&undo=39108&undoafter=32678' | less.

[RLazarus](/p/RLazarus/) added a comment.[Dec 11 2021, 12:17 AM2021-12-11 00:17:37 (UTC+0)](#7564251)Comment Actions

The k8s install is now patched and the Varnish revert is merged, to be rolled out everywhere over the next 30 minutes.

[RLazarus](/p/RLazarus/) mentioned this in [T297517: wtp\* hosts: Out of memory (allocated 39845888) (tried to allocate 131072 bytes) in OutputHandler.php](/T297517).[Dec 11 2021, 4:32 AM2021-12-11 04:32:11 (UTC+0)](#7564399)[Legoktm](/p/Legoktm/) mentioned this in [T297541: Publish FAQ for undo security bug](/T297541).[Dec 11 2021, 5:21 AM2021-12-11 05:21:19 (UTC+0)](#7564439)

[Legoktm](/p/Legoktm/) added a comment.[Dec 11 2021, 5:24 AM2021-12-11 05:24:44 (UTC+0)](#7564446)Comment Actions
> In [T297322#7563863](/T297322#7563863), [@Dylsss](/p/Dylsss/) wrote:
>
> In CVE 1, I would change "view private pages" to "view private revisions" to be more specific, although the exploit will not work when the revision is part of a deleted page or revision deleted as far as I can tell, not sure if that needs to be emphasized. In CVE 2 you need to gain edit rights in some form to replace pages with arbitrary content, without edit rights you can't replace Common.js with malicious JS for example, without first creating a revision to restore (which you can't do without edit rights). Thus without already having edit rights on the wiki, the risk of CVE 2 is decreased (eliminates arbitrary JavaScript execution) and the exploit is limited to replacing page content with revisions that already exist.

[@Dylsss](/p/Dylsss/), I cc'd you on [T297541](/T297541) where we have a draft FAQ for this bug, please feel free to edit it with what you describe here. CVE descriptions are usually short summaries, the nuance you are suggesting would fit better in the FAQ.

[Legoktm](/p/Legoktm/) added a comment.[Dec 11 2021, 6:31 AM2021-12-11 06:31:33 (UTC+0)](#7564452)Comment Actions

I squashed the two patches together, and switched to the much simpler getRevisionByTitle() approach.

master/REL1\_37 (needs -3): 0001-SECURITY-Fix-permissions-checks-in-undo-actions.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/ck7w5vnj4kikjkrn4irs/PHID-FILE-4xqhscely7rt7q23nbe5/0001-SECURITY-Fix-permissions-checks-in-undo-actions.patch)

REL1\_36/REL1\_35:

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_36.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/mugbjzbsic6kprdke3iw/PHID-FILE-5mbfrhuiy6n67gr2lypn/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_36.patch)

And for Debian only, REL1\_31/REL1\_27 (needs -3):

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_31.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/sq3jypp5y4riz53br6ld/PHID-FILE-prqg6yt4rp4vzxdbf7yc/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_31.patch)

[taavi](/p/taavi/) added a comment.[Dec 11 2021, 7:30 AM2021-12-11 07:30:05 (UTC+0)](#7564459)Comment Actions
> In [T297322#7564452](/T297322#7564452), [@Legoktm](/p/Legoktm/) wrote:
>
> I squashed the two patches together, and switched to the much simpler getRevisionByTitle() approach.

Thank you! Thoughts on the third patch (EditFilterMergedContent)? I fear that mentioning that in this task will block making this one public in time if we don't get it reviewed / deployed in time :-/

[Legoktm](/p/Legoktm/) added a comment.[Dec 11 2021, 7:41 AM2021-12-11 07:41:03 (UTC+0)](#7564460)Comment Actions
> In [T297322#7564459](/T297322#7564459), @Majavah wrote:
>
> Thank you! Thoughts on the third patch (EditFilterMergedContent)? I fear that mentioning that in this task will block making this one public in time if we don't get it reviewed / deployed in time :-/

It looks good to me, Code-Review +2, though a review from Daimona would still be appreciated if he has time. And then let's plan to deploy it Monday morning, along with the updated patches.

[Ladsgroup](/p/Ladsgroup/) added a comment.[Dec 11 2021, 7:22 PM2021-12-11 19:22:24 (UTC+0)](#7564744)Comment Actions

I hereby suggest as a follow up, we fully and irreversibly deprecate $wgWhitelistRead and whole concept of "partially private wiki" (I know it's being done in [T297416: Restrict access to most actions on $wgWhitelistRead pages on private wikis](/T297416) but I want to emphasize this shouldn't be temporary)

[daniel](/p/daniel/) added a comment.[Dec 12 2021, 9:29 PM2021-12-12 21:29:03 (UTC+0)](#7565234)Comment Actions

I want to thank everyone here very much for finding and fixing this. The bit where users can use mcrundo to change pages they don't have edit rights for is very likely my fault. I'll investigate in Monday how that happened. Getting permission checks right was definitely a consideration at the time, but we obviously messed it up...

[Dylsss](/p/Dylsss/) mentioned this in [T297574: CVE-2021-45038: Unauthorized users can access private wiki contents using rollback action](/T297574).[Dec 13 2021, 12:01 AM2021-12-13 00:01:29 (UTC+0)](#7565275)[Reedy](/p/Reedy/) changed the task status from Open to In Progress.[Dec 13 2021, 3:00 AM2021-12-13 03:00:07 (UTC+0)](#7565334)[Reedy](/p/Reedy/) renamed this task from Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo  to CVE-2021-44857, CVE-2021-44858:Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo .[Dec 13 2021, 3:05 AM2021-12-13 03:05:15 (UTC+0)](#7565345)[Reedy](/p/Reedy/) renamed this task from CVE-2021-44857, CVE-2021-44858:Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo  to CVE-2021-44857, CVE-2021-44858: Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo .[Dec 13 2021, 3:17 AM2021-12-13 03:17:39 (UTC+0)](#7565356)

[taavi](/p/taavi/) added a comment.[Dec 13 2021, 11:43 AM2021-12-13 11:43:26 (UTC+0)](#7565912)Comment Actions
> In [T297322#7564460](/T297322#7564460), [@Legoktm](/p/Legoktm/) wrote:
> > In [T297322#7564459](/T297322#7564459), @Majavah wrote:
> >
> > Thank you! Thoughts on the third patch (EditFilterMergedContent)? I fear that mentioning that in this task will block making this one public in time if we don't get it reviewed / deployed in time :-/
>
> It looks good to me, Code-Review +2, though a review from Daimona would still be appreciated if he has time. And then let's plan to deploy it Monday morning, along with the updated patches.

I just tried to deploy this (deploy1002:/home/taavi/T297322-EditFilterMergedContent.patch), it did not work while testing on mwdebug1001. Not sure what's going on as it worked fine locally.

[taavi](/p/taavi/) added a comment.[Dec 13 2021, 8:22 PM2021-12-13 20:22:24 (UTC+0)](#7567524)Comment Actions
> In [T297322#7565912](/T297322#7565912), @Majavah wrote:
> > In [T297322#7564460](/T297322#7564460), [@Legoktm](/p/Legoktm/) wrote:
> > > In [T297322#7564459](/T297322#7564459), @Majavah wrote:
> > >
> > > Thank you! Thoughts on the third patch (EditFilterMergedContent)? I fear that mentioning that in this task will block making this one public in time if we don't get it reviewed / deployed in time :-/
> >
> > It looks good to me, Code-Review +2, though a review from Daimona would still be appreciated if he has time. And then let's plan to deploy it Monday morning, along with the updated patches.
>
> I just tried to deploy this (deploy1002:/home/taavi/T297322-EditFilterMergedContent.patch), it did not work while testing on mwdebug1001. Not sure what's going on as it worked fine locally.

Deployed the following patch:

T297322-EditFilterMergedContent-rev3.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/avo65web6atybhpnkqi5/PHID-FILE-teiublpzjcwnepsafg4y/T297322-EditFilterMergedContent-rev3.patch)

[Urbanecm](/p/Urbanecm/) subscribed.[Dec 13 2021, 9:16 PM2021-12-13 21:16:19 (UTC+0)](#7567735)[sbassett](/p/sbassett/) added a comment.[Dec 13 2021, 9:35 PM2021-12-13 21:35:26 (UTC+0)](#7567779)Comment Actions

Thanks for the deploy, @Majavah. [SAL](https://sal.toolforge.org/log/caV2tX0B8Fs0LHO5P1OC). Also updated T276237 with the three patches from this bug and the one related patch from [T297574](/T297574).

[Reedy](/p/Reedy/) added a subscriber: [gerritbot](/p/gerritbot/).[Dec 13 2021, 9:39 PM2021-12-13 21:39:57 (UTC+0)](#7567786)

[Legoktm](/p/Legoktm/) added a comment.[Dec 14 2021, 5:53 AM2021-12-14 05:53:52 (UTC+0)](#7568447)Comment Actions
> In [T297322#7567524](/T297322#7567524), @Majavah wrote:
>
> Deployed the following patch:
>
> T297322-EditFilterMergedContent-rev3.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/avo65web6atybhpnkqi5/PHID-FILE-teiublpzjcwnepsafg4y/T297322-EditFilterMergedContent-rev3.patch)

Having double checked, I don't think we got the hook return value right. The issue outlined in [T271037](/T271037) is that if the hook does not abort so $hookResult is true, we still need to check whether the status has an error. So it should look like:

```
				if ( !$hookResult ) {
					if ( $status->isGood() ) {
						$status->error( 'hookaborted' );
					}

					return $status;
				} elseif ( !$status->isOK() ) {
					if ( !$status->getErrors() ) {
						$status->error( 'hookaborted' );
					}
					return $status;
				}
```

I think that should match EditFilterMergedContentHookConstraint. I'll post a new set of squashed patches.

[Legoktm](/p/Legoktm/) added a comment.[Dec 14 2021, 6:19 AM2021-12-14 06:19:38 (UTC+0)](#7568466)Comment Actions

Squashed my patches from [T297322#7564452](/T297322#7564452) and @Majavah's EditFilterMergedContent one with the fix I suggested above.

0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/3b4jg27zqxy2jf6diijc/PHID-FILE-qnt5lcj2qcsjgluz25ye/0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch)

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_37.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/qnydp3vzbv5laidztlce/PHID-FILE-3mpj3biy5vfvkzhnw5ka/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_37.patch)

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_36.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/dl3hm5jokz2zizk5q5pq/PHID-FILE-7ni3p64vapa7xlsjbvo6/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_36.patch)

The REL1\_36 patch applies to REL1\_35 too.

And for Debian only:

0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1\_31.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/ezfkpocjbvoipnlqxxul/PHID-FILE-psvtizkfxxselbtstjf6/0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1_31.patch)

[taavi](/p/taavi/) added a comment.[Dec 14 2021, 9:22 AM2021-12-14 09:22:50 (UTC+0)](#7568700)Comment Actions
> In [T297322#7568466](/T297322#7568466), [@Legoktm](/p/Legoktm/) wrote:
>
> Squashed my patches from [T297322#7564452](/T297322#7564452) and @Majavah's EditFilterMergedContent one with the fix I suggested above.

The EditFilterMergedContent fix looks good, thank you!

[taavi](/p/taavi/) added a comment.[Dec 14 2021, 6:36 PM2021-12-14 18:36:19 (UTC+0)](#7570660)Comment Actions

I replaced the currently deployed patches with the squashed ones from [T297322#7568466](/T297322#7568466).

[Legoktm](/p/Legoktm/) added a comment.[Dec 15 2021, 12:59 AM2021-12-15 00:59:59 (UTC+0)](#7571389)Comment Actions

The CVEs were flipped in the above set of squashed patches. Here is hopefully the final set of patches:

0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/sgm677wvf3u6zixpb7bl/PHID-FILE-qkxmzjzc7a5s6jmsmioz/0001-SECURITY-Fix-permissions-checks-in-undo-actions-master.patch)

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_37.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/s26jsvhp54g47rbyaszz/PHID-FILE-mm6drhdpdlkgitdxfrhg/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_37.patch)

0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1\_36.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/chf6eolo3bgypuja35gg/PHID-FILE-ox4ruh6awqdwpjtuqyi3/0001-SECURITY-Fix-permissions-checks-in-undo-actions-REL1_36.patch)

0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1\_31.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/nc34wlm357qxhrq7aiid/PHID-FILE-hwvaissm3gxe4j7yh74k/0001-SECURITY-Fix-permissions-checks-in-undo-action-CVE-2-REL1_31.patch)

[Reedy](/p/Reedy/) added a comment.[Dec 15 2021, 1:21 AM2021-12-15 01:21:50 (UTC+0)](#7571409)Comment Actions

REL1\_31? :)

[Legoktm](/p/Legoktm/) added a comment.[Dec 15 2021, 1:27 AM2021-12-15 01:27:55 (UTC+0)](#7571410)Comment Actions

Just for Debian! and worried that if I don't upload it here I'm going to lose it in this mess of patches...

[Reedy](/p/Reedy/) added a comment.[Dec 15 2021, 1:41 AM2021-12-15 01:41:46 (UTC+0)](#7571412)Comment Actions

I was more wondering where the REL1\_35 one was ;)

[Legoktm](/p/Legoktm/) added a comment.[Dec 15 2021, 3:19 AM2021-12-15 03:19:42 (UTC+0)](#7571462)Comment Actions
> In [T297322#7571412](/T297322#7571412), [@Reedy](/p/Reedy/) wrote:
>
> I was more wondering where the REL1\_35 one was ;)

Oh oops. The REL1\_36 one directly applies to REL1\_35 as well. It all should be correct in the table on [T292227](/T292227).

[Tgr](/p/Tgr/) subscribed.[Dec 15 2021, 5:15 AM2021-12-15 05:15:14 (UTC+0)](#7571490)Comment Actions

Thanks all for discovering and fixing these issues! I am very sorry to have caused some of them.

Given the severity of these issues (I don't think there was a comparable vulnerability in MediaWiki before), and that most wikis probably aren't equipped to patch things quickly, would it make sense to share a LocalSettings snippet and wait a bit with sharing the patches (and thus the exact vulnerabilities)? For the write permission issues I don't think that's possible without making the bug easy to guess, but for the read issues just asking people to disable $wgWhitelistRead wouldn't give away much.

> In [T297322#7565234](/T297322#7565234), [@daniel](/p/daniel/) wrote:
>
> The bit where users can use mcrundo to change pages they don't have edit rights for is very likely my fault.

It isn't; it was introduced in [https://gerrit.wikimedia.org/r/c/mediawiki/core/+/447099](https://gerrit.wikimedia.org/r/c/mediawiki/core/%2B/447099).

[Reedy](/p/Reedy/) assigned this task to [Legoktm](/p/Legoktm/).[Dec 15 2021, 12:06 PM2021-12-15 12:06:35 (UTC+0)](#7572024)[sbassett](/p/sbassett/) added a comment.[Dec 15 2021, 3:23 PM2021-12-15 15:23:44 (UTC+0)](#7572646)Comment Actions
> In [T297322#7571490](/T297322#7571490), [@Tgr](/p/Tgr/) wrote:
>
> Given the severity of these issues (I don't think there was a comparable vulnerability in MediaWiki before), and that most wikis probably aren't equipped to patch things quickly, would it make sense to share a LocalSettings snippet and wait a bit with sharing the patches (and thus the exact vulnerabilities)? For the write permission issues I don't think that's possible without making the bug easy to guess, but for the read issues just asking people to disable $wgWhitelistRead wouldn't give away much.

I think this was discussed but was decided against in that even this solution was considered too risky to divulge within any kind of pre-release announcement, hence [the pre-release announcement that was sent](https://lists.wikimedia.org/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/MPXIF3VNAZL7JHKFAMW2JSEI7EL65X3D/). The full announcement does offer a "I don't have time to patch, how do I disable this?" LocalSettings.php solution as seen in the draft at [T297541](/T297541).

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 7:30 PM2021-12-15 19:30:14 (UTC+0)](#7573373)Comment Actions

Change 747571 had a related patch set uploaded (by Reedy; author: Legoktm):

[mediawiki/core@REL1\_35] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747571>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Dec 15 2021, 7:30 PM2021-12-15 19:30:17 (UTC+0)](#7573374)Comment Actions

Change 747578 had a related patch set uploaded (by Reedy; author: Legoktm):

[mediawiki/core@REL1\_36] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747578>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 7:32 PM2021-12-15 19:32:30 (UTC+0)](#7573387)Comment Actions

Change 747585 had a related patch set uploaded (by Reedy; author: Legoktm):

[mediawiki/core@REL1\_37] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747585>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 7:46 PM2021-12-15 19:46:24 (UTC+0)](#7573462)Comment Actions

Change 747596 had a related patch set uploaded (by Reedy; author: Legoktm):

[mediawiki/core@master] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747596>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 7:47 PM2021-12-15 19:47:32 (UTC+0)](#7573474)Comment Actions

Change 747571 **merged** by jenkins-bot:

[mediawiki/core@REL1\_35] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747571>

[Reedy](/p/Reedy/) closed this task as Resolved.[Dec 15 2021, 7:53 PM2021-12-15 19:53:57 (UTC+0)](#7573494)[Reedy](/p/Reedy/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-tucsxwbtdfwo6k6/)" to "Public (No Login Required)".[Reedy](/p/Reedy/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-i2cbtjmycjupw4k/)" to "All Users".[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.35-notes](/tag/mw-1.35-notes/).[Dec 15 2021, 8:00 PM2021-12-15 20:00:28 (UTC+0)](#7573533)[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 8:01 PM2021-12-15 20:01:15 (UTC+0)](#7573537)Comment Actions

Change 747585 **merged** by jenkins-bot:

[mediawiki/core@REL1\_37] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747585>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 8:14 PM2021-12-15 20:14:23 (UTC+0)](#7573587)Comment Actions

Change 747578 **merged** by jenkins-bot:

[mediawiki/core@REL1\_36] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747578>

[gerritbot](/p/gerritbot/) added a comment.[Dec 15 2021, 8:21 PM2021-12-15 20:21:57 (UTC+0)](#7573636)Comment Actions

Change 747596 **merged** by jenkins-bot:

[mediawiki/core@master] SECURITY: Fix permissions checks in undo actions

<https://gerrit.wikimedia.org/r/747596>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added projects: [MW-1.38-notes (1.38.0-wmf.16; 2022-01-03)](/project/view/5648/), [MW-1.36-notes](/tag/mw-1.36-notes/), [MW-1.37-notes](/tag/mw-1.37-notes/).[Dec 15 2021, 9:00 PM2021-12-15 21:00:29 (UTC+0)](#7573814)[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Dec 15 2021, 9:10 PM2021-12-15 21:10:37 (UTC+0)](#7573857)[• toan](/p/toan/) added a subscriber: [Tarrow](/p/Tarrow/).[Dec 16 2021, 11:40 AM2021-12-16 11:40:16 (UTC+0)](#7574932)[Osnard](/p/Osnard/) mentioned this in [T297896: Apply changes from 1.35.5 to unsupported legacy branch `REL1\_31`](/T297896).[Dec 16 2021, 4:31 PM2021-12-16 16:31:26 (UTC+0)](#7575649)[gerritbot](/p/gerritbot/) added a comment.[Dec 20 2021, 12:11 PM2021-12-20 12:11:41 (UTC+0)](#7580214)Comment Actions

Change 748706 had a related patch set uploaded (by Daniel Kinzler; author: Daniel Kinzler):

[mediawiki/core@master] McrUndoAction: use authorizeWrite for permission checks.

<https://gerrit.wikimedia.org/r/748706>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Dec 20 2021, 12:11 PM2021-12-20 12:11:42 (UTC+0)](#7580215)[Zabe](/p/Zabe/) subscribed.[Dec 20 2021, 12:14 PM2021-12-20 12:14:00 (UTC+0)](#7580217)[gerritbot](/p/gerritbot/) added a comment.[Jan 12 2022, 6:02 PM2022-01-12 18:02:46 (UTC+0)](#7617338)Comment Actions

Change 748706 **merged** by jenkins-bot:

[mediawiki/core@master] McrUndoAction: use authorizeWrite for permission checks.

<https://gerrit.wikimedia.org/r/748706>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) edited projects, added [MW-1.38-notes (1.38.0-wmf.18; 2022-01-17)](/project/view/5681/); removed [MW-1.38-notes (1.38.0-wmf.16; 2022-01-03)](/project/view/5648/).[Jan 12 2022, 7:00 PM2022-01-12 19:00:29 (UTC+0)](#7617462)[Zabe](/p/Zabe/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Apr 11 2022, 10:12 AM2022-04-11 10:12:14 (UTC+0)](#7844291)[Xiplus](/p/Xiplus/) mentioned this in [T307322: Allow 3-way merge from arbitrary revisions after T297322](/T307322).[May 2 2022, 1:36 AM2022-05-02 01:36:24 (UTC+0)](#7894608)[Xiplus](/p/Xiplus/) mentioned this in [T277748: undoafter from different page should not be marked with undo and reverted tags](/T277748).[May 26 2022, 8:46 AM2022-05-26 08:46:47 (UTC+0)](#7959491)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
