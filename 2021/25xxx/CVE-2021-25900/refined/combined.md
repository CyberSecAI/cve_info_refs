=== Content from rustsec.org_d8f5af0a_20250114_192452.html ===


RUSTSEC-2021-0003: smallvec: Buffer overflow in SmallVec::insert\_many › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/smallvec/RUSTSEC-2021-0003.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/smallvec/RUSTSEC-2021-0003.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0003)

# RUSTSEC-2021-0003

Buffer overflow in SmallVec::insert\_many

Reported
January 8, 2021

Issued
January 8, 2021

(last modified: June 13, 2023)

Package
[smallvec](/packages/smallvec.html)
([crates.io](https://crates.io/crates/smallvec))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#buffer-overflow](/keywords/buffer-overflow.html)
[#heap-overflow](/keywords/heap-overflow.html)
[#unsound](/keywords/unsound.html)

Aliases

* [CVE-2021-25900](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25900)
* [GHSA-43w2-9j62-hq99](https://github.com/advisories/GHSA-43w2-9j62-hq99)

References

* <https://github.com/servo/rust-smallvec/issues/252>

CVSS Score
9.8
CRITICAL

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityHigh
IntegrityHigh
AvailabilityHigh

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
Patched

* `>=0.6.14, <1.0.0`
* `>=1.6.1`

Unaffected

* `<0.6.3`

Affected Functions
Version
`smallvec::SmallVec::insert_many`

* `>=0.6.3, <0.6.14`
* `>=1.0.0, <1.6.1`

### Description

A bug in the `SmallVec::insert_many` method caused it to allocate a buffer that was smaller than needed. It then wrote past the end of the buffer, causing a buffer overflow and memory corruption on the heap.

This bug was only triggered if the iterator passed to `insert_many` yielded more items than the lower bound returned from its `size_hint` method.

The flaw was corrected in smallvec 0.6.14 and 1.6.1, by ensuring that additional space is always reserved for each item inserted. The fix also simplified the implementation of `insert_many` to use less unsafe code, so it is easier to verify its correctness.

Thank you to Yechan Bae (@Qwaz) and the Rust group at Georgia Tech’s SSLab for finding and reporting this bug.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


