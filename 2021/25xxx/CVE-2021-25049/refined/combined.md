=== Content from plugins.trac.wordpress.org_7200b7e6_20250114_191305.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2647987)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/2647986 "Changeset 2647986")
* [Next Changeset](/changeset/2647988 "Changeset 2647988") →

---

# Changeset 2647987

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/22/2021 04:56:45 PM
([3 years](/timeline?from=2021-12-22T16%3A56%3A45Z&precision=second "See timeline at 12/22/2021 04:56:45 PM") ago)

Author:
jackjpdiscos
Message:

Upgrade to 1.4.4

Location:
[mobile-events-manager/trunk](/browser/mobile-events-manager/trunk?rev=2647987)
Files:

93 edited

* [assets/js/admin-scripts.js](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987 "Show entry in browser")
  (modified)
  ([83 diffs](#file0 "Show differences"))
* [assets/js/admin-scripts.min.js](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.min.js?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [includes/EDD\_SL\_Plugin\_Updater.php](/browser/mobile-events-manager/trunk/includes/EDD_SL_Plugin_Updater.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [includes/actions.php](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([5 diffs](#file3 "Show differences"))
* [includes/admin/admin-actions.php](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([5 diffs](#file4 "Show differences"))
* [includes/admin/admin-notices.php](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987 "Show entry in browser")
  (modified)
  ([52 diffs](#file5 "Show differences"))
* [includes/admin/availability/availability-actions.php](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [includes/admin/availability/availability-page.php](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987 "Show entry in browser")
  (modified)
  ([19 diffs](#file7 "Show differences"))
* [includes/admin/class-tmem-api-keys-table.php](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([15 diffs](#file8 "Show differences"))
* [includes/admin/communications/comms-functions.php](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([11 diffs](#file9 "Show differences"))
* [includes/admin/communications/comms.php](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987 "Show entry in browser")
  (modified)
  ([11 diffs](#file10 "Show differences"))
* [includes/admin/communications/contextual-help.php](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987 "Show entry in browser")
  (modified)
  ([5 diffs](#file11 "Show differences"))
* [includes/admin/communications/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([12 diffs](#file12 "Show differences"))
* [includes/admin/communications/tmem-communications.php](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987 "Show entry in browser")
  (modified)
  ([9 diffs](#file13 "Show differences"))
* [includes/admin/dashboard-widgets.php](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987 "Show entry in browser")
  (modified)
  ([17 diffs](#file14 "Show differences"))
* [includes/admin/equipment/equipment.php](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987 "Show entry in browser")
  (modified)
  ([46 diffs](#file15 "Show differences"))
* [includes/admin/equipment/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([37 diffs](#file16 "Show differences"))
* [includes/admin/events/class-tmem-playlist-table.php](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([24 diffs](#file17 "Show differences"))
* [includes/admin/events/contextual-help.php](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987 "Show entry in browser")
  (modified)
  ([15 diffs](#file18 "Show differences"))
* [includes/admin/events/event-actions.php](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([8 diffs](#file19 "Show differences"))
* [includes/admin/events/events.php](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987 "Show entry in browser")
  (modified)
  ([94 diffs](#file20 "Show differences"))
* [includes/admin/events/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([96 diffs](#file21 "Show differences"))
* [includes/admin/events/playlist-page.php](/browser/mobile-events-manager/trunk/includes/admin/events/playlist-page.php?rev=2647987 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [includes/admin/extensions.php](/browser/mobile-events-manager/trunk/includes/admin/extensions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file23 "Show differences"))
* [includes/admin/menu.php](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2647987 "Show entry in browser")
  (modified)
  ([4 diffs](#file24 "Show differences"))
* [includes/admin/pages/client-fields.php](/browser/mobile-events-manager/trunk/includes/admin/pages/client-fields.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [includes/admin/reporting/class-tmem-addons-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [includes/admin/reporting/class-tmem-clients-export.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [includes/admin/reporting/class-tmem-conversions-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [includes/admin/reporting/class-tmem-employees-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file29 "Show differences"))
* [includes/admin/reporting/class-tmem-export-earnings.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file30 "Show differences"))
* [includes/admin/reporting/class-tmem-export.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file31 "Show differences"))
* [includes/admin/reporting/class-tmem-graph.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file32 "Show differences"))
* [includes/admin/reporting/class-tmem-packages-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file33 "Show differences"))
* [includes/admin/reporting/class-tmem-pie-graph.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [includes/admin/reporting/class-tmem-transaction-types-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [includes/admin/reporting/class-tmem-types-reports-table.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file36 "Show differences"))
* [includes/admin/reporting/export/class-batch-export-clients.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [includes/admin/reporting/export/class-batch-export-employees.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file38 "Show differences"))
* [includes/admin/reporting/export/class-batch-export-events.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file39 "Show differences"))
* [includes/admin/reporting/export/class-batch-export-txns.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file40 "Show differences"))
* [includes/admin/reporting/export/class-batch-export.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file41 "Show differences"))
* [includes/admin/reporting/export/export-functions.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file42 "Show differences"))
* [includes/admin/reporting/graphing-functions.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([4 diffs](#file43 "Show differences"))
* [includes/admin/reporting/reporting-functions.php](/browser/mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file44 "Show differences"))
* [includes/admin/roles/roles-functions.php](/browser/mobile-events-manager/trunk/includes/admin/roles/roles-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file45 "Show differences"))
* [includes/admin/settings/contextual-help.php](/browser/mobile-events-manager/trunk/includes/admin/settings/contextual-help.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file46 "Show differences"))
* [includes/admin/settings/display-settings.php](/browser/mobile-events-manager/trunk/includes/admin/settings/display-settings.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file47 "Show differences"))
* [includes/admin/settings/register-settings.php](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987 "Show entry in browser")
  (modified)
  ([5 diffs](#file48 "Show differences"))
* [includes/admin/tasks/class-tmem-tasks-table.php](/browser/mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [includes/admin/tasks/task-actions.php](/browser/mobile-events-manager/trunk/includes/admin/tasks/task-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file50 "Show differences"))
* [includes/admin/tasks/tasks-page.php](/browser/mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file51 "Show differences"))
* [includes/admin/templates/contextual-help.php](/browser/mobile-events-manager/trunk/includes/admin/templates/contextual-help.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file52 "Show differences"))
* [includes/admin/templates/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/templates/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file53 "Show differences"))
* [includes/admin/tools.php](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2647987 "Show entry in browser")
  (modified)
  ([3 diffs](#file54 "Show differences"))
* [includes/admin/transactions/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [includes/admin/upgrades/upgrade-functions.php](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file56 "Show differences"))
* [includes/admin/upgrades/upgrades.php](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file57 "Show differences"))
* [includes/admin/users/employee-actions.php](/browser/mobile-events-manager/trunk/includes/admin/users/employee-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file58 "Show differences"))
* [includes/admin/venues/metaboxes.php](/browser/mobile-events-manager/trunk/includes/admin/venues/metaboxes.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file59 "Show differences"))
* [includes/admin/welcome.php](/browser/mobile-events-manager/trunk/includes/admin/welcome.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [includes/ajax-functions.php](/browser/mobile-events-manager/trunk/includes/ajax-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file61 "Show differences"))
* [includes/api/class-tmem-api.php](/browser/mobile-events-manager/trunk/includes/api/class-tmem-api.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file62 "Show differences"))
* [includes/availability/availability-actions.php](/browser/mobile-events-manager/trunk/includes/availability/availability-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file63 "Show differences"))
* [includes/availability/availability-functions.php](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([4 diffs](#file64 "Show differences"))
* [includes/availability/class-tmem-availability-checker.php](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987 "Show entry in browser")
  (modified)
  ([6 diffs](#file65 "Show differences"))
* [includes/availability/class-tmem-db-availability-meta.php](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file66 "Show differences"))
* [includes/availability/class-tmem-db-availability.php](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file67 "Show differences"))
* [includes/class-tmem-cache-helper.php](/browser/mobile-events-manager/trunk/includes/class-tmem-cache-helper.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file68 "Show differences"))
* [includes/class-tmem-license-handler.php](/browser/mobile-events-manager/trunk/includes/class-tmem-license-handler.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file69 "Show differences"))
* [includes/clients/client-functions.php](/browser/mobile-events-manager/trunk/includes/clients/client-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file70 "Show differences"))
* [includes/clientzone-functions.php](/browser/mobile-events-manager/trunk/includes/clientzone-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file71 "Show differences"))
* [includes/contract/contract-actions.php](/browser/mobile-events-manager/trunk/includes/contract/contract-actions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file72 "Show differences"))
* [includes/contract/contract-functions.php](/browser/mobile-events-manager/trunk/includes/contract/contract-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file73 "Show differences"))
* [includes/deprecated-functions.php](/browser/mobile-events-manager/trunk/includes/deprecated-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file74 "Show differences"))
* [includes/emails/class-tmem-emails.php](/browser/mobile-events-manager/trunk/includes/emails/class-tmem-emails.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file75 "Show differences"))
* [includes/emails/email-functions.php](/browser/mobile-events-manager/trunk/includes/emails/email-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file76 "Show differences"))
* [includes/employee-functions.php](/browser/mobile-events-manager/trunk/includes/employee-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file77 "Show differences"))
* [includes/events/event-functions.php](/browser/mobile-events-manager/trunk/includes/events/event-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file78 "Show differences"))
* [includes/formatting.php](/browser/mobile-events-manager/trunk/includes/formatting.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file79 "Show differences"))
* [includes/install.php](/browser/mobile-events-manager/trunk/includes/install.php?rev=2647987 "Show entry in browser")
  (modified)
  ([3 diffs](#file80 "Show differences"))
* [includes/journal-functions.php](/browser/mobile-events-manager/trunk/includes/journal-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file81 "Show differences"))
* [includes/misc-functions.php](/browser/mobile-events-manager/trunk/includes/misc-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([2 diffs](#file82 "Show differences"))
* [includes/payments/payments.php](/browser/mobile-events-manager/trunk/includes/payments/payments.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file83 "Show differences"))
* [includes/payments/process-payments.php](/browser/mobile-events-manager/trunk/includes/payments/process-payments.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file84 "Show differences"))
* [includes/payments/template.php](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987 "Show entry in browser")
  (modified)
  ([6 diffs](#file85 "Show differences"))
* [includes/privacy-functions.php](/browser/mobile-events-manager/trunk/includes/privacy-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file86 "Show differences"))
* [includes/scripts.php](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2647987 "Show entry in browser")
  (modified)
  ([3 diffs](#file87 "Show differences"))
* [includes/travel-functions.php](/browser/mobile-events-manager/trunk/includes/travel-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file88 "Show differences"))
* [includes/venue-functions.php](/browser/mobile-events-manager/trunk/includes/venue-functions.php?rev=2647987 "Show entry in browser")
  (modified)
  ([2 diffs](#file89 "Show differences"))
* [includes/widgets.php](/browser/mobile-events-manager/trunk/includes/widgets.php?rev=2647987 "Show entry in browser")
  (modified)
  ([1 diff](#file90 "Show differences"))
* [mobile-events-manager.php](/browser/mobile-events-manager/trunk/mobile-events-manager.php?rev=2647987 "Show entry in browser")
  (modified)
  ([2 diffs](#file91 "Show differences"))
* [readme.txt](/browser/mobile-events-manager/trunk/readme.txt?rev=2647987 "Show entry in browser")
  (modified)
  ([2 diffs](#file92 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [mobile-events-manager/trunk/assets/js/admin-scripts.js](/changeset/2647987/mobile-events-manager/trunk/assets/js/admin-scripts.js "Show the changeset 2647987 restricted to mobile-events-manager/trunk/assets/js/admin-scripts.js")

  | [r2455787](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L9 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L9 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | \*/ |
  | 10 | 10 |  |
  | 11 |  | var tmem\_admin\_vars; |
  | 12 |  | jQuery( document ).ready( |
  | 13 |  | function ($) { |
  |  | 11 | var tmem\_admin\_vars; |
  |  | 12 | jQuery( document ).ready( |
  |  | 13 | function ($) { |
  | 14 | 14 |  |
  | 15 | 15 | // Setup Chosen menus |
  | 16 | 16 | $( '.tmem-select-chosen' ).chosen( |
  | 17 |  | { |
  | 18 |  | inherit\_select\_classes: true, |
  | 19 |  | placeholder\_text\_single: tmem\_admin\_vars.one\_option, |
  | 20 |  | placeholder\_text\_multiple: tmem\_admin\_vars.one\_or\_more\_option |
  | 21 |  | } |
  |  | 17 | { |
  |  | 18 | inherit\_select\_classes: true, |
  |  | 19 | placeholder\_text\_single: tmem\_admin\_vars.one\_option, |
  |  | 20 | placeholder\_text\_multiple: tmem\_admin\_vars.one\_or\_more\_option |
  |  | 21 | } |
  | 22 | 22 | ); |
  | 23 | 23 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L28) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L28) |  |
  | 28 | 28 | $( this ).attr( 'placeholder', placeholder ); |
  | 29 | 29 | } |
  | 30 |  | ); |
  |  | 30 | ); |
  | 31 | 31 |  |
  | 32 | 32 | // Add placeholders for Chosen input fields |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L40) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L40) |  |
  | 40 | 40 | $( this ).children( 'li' ).children( 'input' ).attr( 'placeholder', placeholder ); |
  | 41 | 41 | } |
  | 42 |  | ); |
  |  | 42 | ); |
  | 43 | 43 |  |
  | 44 | 44 | // Dismiss admin notices |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L55) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L55) |  |
  | 55 | 55 |  |
  | 56 | 56 | $.ajax( |
  | 57 |  | { |
  | 58 |  | type: 'POST', |
  | 59 |  | dataType: 'json', |
  | 60 |  | data: postData, |
  | 61 |  | url: ajaxurl |
  | 62 |  | } |
  |  | 57 | { |
  |  | 58 | type: 'POST', |
  |  | 59 | dataType: 'json', |
  |  | 60 | data: postData, |
  |  | 61 | url: ajaxurl |
  |  | 62 | } |
  | 63 | 63 | ); |
  | 64 | 64 | } |
  | 65 |  | ); |
  |  | 65 | ); |
  | 66 | 66 |  |
  | 67 | 67 | // Set the deposit value for the event |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L74) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L74) |  |
  | 74 | 74 |  |
  | 75 | 75 | $.ajax( |
  | 76 |  | { |
  | 77 |  | type       : 'POST', |
  | 78 |  | dataType   : 'json', |
  | 79 |  | data       : postData, |
  | 80 |  | url        : ajaxurl, |
  | 81 |  | beforeSend : function() { |
  | 82 |  | $( '#\_tmem\_event\_deposit' ).attr( 'readonly', true ); |
  | 83 |  | $( '#tmem-event-pricing-detail' ).addClass( 'tmem-mute' ); |
  | 84 |  | }, |
  | 85 |  | success: function (response) { |
  | 86 |  | if (response.type === 'success') { |
  | 87 |  | $( '#\_tmem\_event\_deposit' ).val( response.deposit ); |
  | 88 |  | } else { |
  | 89 |  | alert( response.msg ); |
  | 90 |  | $( '#\_tmem\_event\_deposit' ).val( current\_deposit ); |
  | 91 |  | } |
  | 92 |  | $( '#tmem-event-pricing-detail' ).removeClass( 'tmem-mute' ); |
  | 93 |  | $( '#\_tmem\_event\_deposit' ).attr( 'readonly', false ); |
  | 94 |  | } |
  |  | 76 | { |
  |  | 77 | type       : 'POST', |
  |  | 78 | dataType   : 'json', |
  |  | 79 | data       : postData, |
  |  | 80 | url        : ajaxurl, |
  |  | 81 | beforeSend : function() { |
  |  | 82 | $( '#\_tmem\_event\_deposit' ).attr( 'readonly', true ); |
  |  | 83 | $( '#tmem-event-pricing-detail' ).addClass( 'tmem-mute' ); |
  |  | 84 | }, |
  |  | 85 | success: function (response) { |
  |  | 86 | if (response.type === 'success') { |
  |  | 87 | $( '#\_tmem\_event\_deposit' ).val( response.deposit ); |
  |  | 88 | } else { |
  |  | 89 | alert( response.msg ); |
  |  | 90 | $( '#\_tmem\_event\_deposit' ).val( current\_deposit ); |
  |  | 91 | } |
  |  | 92 | $( '#tmem-event-pricing-detail' ).removeClass( 'tmem-mute' ); |
  |  | 93 | $( '#\_tmem\_event\_deposit' ).attr( 'readonly', false ); |
  | 95 | 94 | } |
  |  | 95 | } |
  | 96 | 96 | ).fail( |
  | 97 |  | function (data) { |
  | 98 |  | if ( window.console && window.console.log ) { |
  | 99 |  | console.log( data ); |
  | 100 |  | } |
  | 101 |  | $( '#\_tmem\_event\_deposit' ).val( current\_deposit ); |
  |  | 97 | function (data) { |
  |  | 98 | if ( window.console && window.console.log ) { |
  |  | 99 | console.log( data ); |
  | 102 | 100 | } |
  |  | 101 | $( '#\_tmem\_event\_deposit' ).val( current\_deposit ); |
  |  | 102 | } |
  | 103 | 103 | ); |
  | 104 | 104 | }; |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L136) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L136) |  |
  | 136 | 136 |  |
  | 137 | 137 | $.ajax( |
  | 138 |  | { |
  | 139 |  | type       : 'POST', |
  | 140 |  | dataType   : 'json', |
  | 141 |  | data       : postData, |
  | 142 |  | url        : ajaxurl, |
  | 143 |  | beforeSend : function() { |
  | 144 |  | $( '#tmem-event-pricing-detail' ).addClass( 'tmem-mute' ); |
  | 145 |  | }, |
  | 146 |  | success: function (response) { |
  | 147 |  | if (response.type === 'success') { |
  | 148 |  | $( '#\_tmem\_event\_package\_cost' ).val( response.package\_cost ); |
  | 149 |  | $( '#\_tmem\_event\_addons\_cost' ).val( response.addons\_cost ); |
  | 150 |  | $( '#\_tmem\_event\_travel\_cost' ).val( response.travel\_cost ); |
  | 151 |  | $( '#\_tmem\_event\_additional\_cost' ).val( response.additional\_cost ); |
  | 152 |  | $( '#\_tmem\_event\_discount' ).val( response.discount ); |
  | 153 |  |  |
  | 154 |  | var value = Number( response.package\_cost ) + Number( response.addons\_cost ) + Number( response.travel\_cost ) + Number( response.additional\_cost ); |
  | 155 |  | value     = Number( value ) - Number( response.discount ); |
  | 156 |  | value     = value.toFixed( 2 ); |
  | 157 |  |  |
  | 158 |  | $( '#\_tmem\_event\_cost' ).val( value ); |
  | 159 |  |  |
  | 160 |  | if ( tmem\_admin\_vars.update\_deposit ) { |
  | 161 |  | setDeposit(); |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | } else { |
  | 165 |  | $( '#\_tmem\_event\_cost' ).val( current\_cost ); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | $( '#tmem-event-pricing-detail' ).removeClass( 'tmem-mute' ); |
  | 169 |  | } |
  |  | 138 | { |
  |  | 139 | type       : 'POST', |
  |  | 140 | dataType   : 'json', |
  |  | 141 | data       : postData, |
  |  | 142 | url        : ajaxurl, |
  |  | 143 | beforeSend : function() { |
  |  | 144 | $( '#tmem-event-pricing-detail' ).addClass( 'tmem-mute' ); |
  |  | 145 | }, |
  |  | 146 | success: function (response) { |
  |  | 147 | if (response.type === 'success') { |
  |  | 148 | $( '#\_tmem\_event\_package\_cost' ).val( response.package\_cost ); |
  |  | 149 | $( '#\_tmem\_event\_addons\_cost' ).val( response.addons\_cost ); |
  |  | 150 | $( '#\_tmem\_event\_travel\_cost' ).val( response.travel\_cost ); |
  |  | 151 | $( '#\_tmem\_event\_additional\_cost' ).val( response.additional\_cost ); |
  |  | 152 | $( '#\_tmem\_event\_discount' ).val( response.discount ); |
  |  | 153 |  |
  |  | 154 | var value = Number( response.package\_cost ) + Number( response.addons\_cost ) + Number( response.travel\_cost ) + Number( response.additional\_cost ); |
  |  | 155 | value     = Number( value ) - Number( response.discount ); |
  |  | 156 | value     = value.toFixed( 2 ); |
  |  | 157 |  |
  |  | 158 | $( '#\_tmem\_event\_cost' ).val( value ); |
  |  | 159 |  |
  |  | 160 | if ( tmem\_admin\_vars.update\_deposit ) { |
  |  | 161 | setDeposit(); |
  |  | 162 | } |
  |  | 163 |  |
  |  | 164 | } else { |
  |  | 165 | $( '#\_tmem\_event\_cost' ).val( current\_cost ); |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | $( '#tmem-event-pricing-detail' ).removeClass( 'tmem-mute' ); |
  | 170 | 169 | } |
  |  | 170 | } |
  | 171 | 171 | ).fail( |
  | 172 |  | function (data) { |
  | 173 |  | if ( window.console && window.console.log ) { |
  | 174 |  | console.log( data ); |
  | 175 |  | } |
  |  | 172 | function (data) { |
  |  | 173 | if ( window.console && window.console.log ) { |
  |  | 174 | console.log( data ); |
  | 176 | 175 | } |
  |  | 176 | } |
  | 177 | 177 | ); |
  | 178 | 178 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L200) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L200) |  |
  | 200 | 200 |  |
  | 201 | 201 | $.ajax( |
  | 202 |  | { |
  | 203 |  | type       : 'POST', |
  | 204 |  | dataType   : 'json', |
  | 205 |  | data       : postData, |
  | 206 |  | url        : ajaxurl, |
  | 207 |  | success: function (response) { |
  | 208 |  | if (response.type === 'success') { |
  | 209 |  | $( '.tmem-travel-distance' ).parents( 'tr' ).show(); |
  | 210 |  | $( '.tmem-travel-directions' ).parents( 'tr' ).show(); |
  | 211 |  | $( '.tmem-travel-distance' ).html( response.distance ); |
  | 212 |  | $( '.tmem-travel-time' ).html( response.time ); |
  | 213 |  | $( '.tmem-travel-cost' ).html( response.cost ); |
  | 214 |  | $( '#travel\_directions' ).attr( 'href', response.directions\_url ); |
  | 215 |  | $( '#tmem\_travel\_distance' ).val( response.distance ); |
  | 216 |  | $( '#tmem\_travel\_time' ).val( response.time ); |
  | 217 |  | $( '#tmem\_travel\_cost' ).val( response.raw\_cost ); |
  | 218 |  | $( '#tmem\_travel\_directions\_url' ).val( response.directions\_url ); |
  | 219 |  | } else { |
  | 220 |  | $( '.tmem-travel-distance' ).parents( 'tr' ).hide(); |
  | 221 |  | $( '#travel-directions' ).attr( 'href', '' ); |
  | 222 |  | $( '.tmem-travel-directions' ).parents( 'tr' ).hide(); |
  | 223 |  | $( '#tmem\_travel\_distance' ).val( '' ); |
  | 224 |  | $( '#tmem\_travel\_time' ).val( '' ); |
  | 225 |  | $( '#tmem\_travel\_cost' ).val( '' ); |
  | 226 |  | $( '#tmem\_travel\_directions\_url' ).val( '' ); |
  | 227 |  | } |
  |  | 202 | { |
  |  | 203 | type       : 'POST', |
  |  | 204 | dataType   : 'json', |
  |  | 205 | data       : postData, |
  |  | 206 | url        : ajaxurl, |
  |  | 207 | success: function (response) { |
  |  | 208 | if (response.type === 'success') { |
  |  | 209 | $( '.tmem-travel-distance' ).parents( 'tr' ).show(); |
  |  | 210 | $( '.tmem-travel-directions' ).parents( 'tr' ).show(); |
  |  | 211 | $( '.tmem-travel-distance' ).html( response.distance ); |
  |  | 212 | $( '.tmem-travel-time' ).html( response.time ); |
  |  | 213 | $( '.tmem-travel-cost' ).html( response.cost ); |
  |  | 214 | $( '#travel\_directions' ).attr( 'href', response.directions\_url ); |
  |  | 215 | $( '#tmem\_travel\_distance' ).val( response.distance ); |
  |  | 216 | $( '#tmem\_travel\_time' ).val( response.time ); |
  |  | 217 | $( '#tmem\_travel\_cost' ).val( response.raw\_cost ); |
  |  | 218 | $( '#tmem\_travel\_directions\_url' ).val( response.directions\_url ); |
  |  | 219 | } else { |
  |  | 220 | $( '.tmem-travel-distance' ).parents( 'tr' ).hide(); |
  |  | 221 | $( '#travel-directions' ).attr( 'href', '' ); |
  |  | 222 | $( '.tmem-travel-directions' ).parents( 'tr' ).hide(); |
  |  | 223 | $( '#tmem\_travel\_distance' ).val( '' ); |
  |  | 224 | $( '#tmem\_travel\_time' ).val( '' ); |
  |  | 225 | $( '#tmem\_travel\_cost' ).val( '' ); |
  |  | 226 | $( '#tmem\_travel\_directions\_url' ).val( '' ); |
  | 228 | 227 | } |
  | 229 | 228 | } |
  |  | 229 | } |
  | 230 | 230 | ).fail( |
  | 231 |  | function (data) { |
  | 232 |  | if ( window.console && window.console.log ) { |
  | 233 |  | console.log( data ); |
  | 234 |  | } |
  |  | 231 | function (data) { |
  |  | 232 | if ( window.console && window.console.log ) { |
  |  | 233 | console.log( data ); |
  | 235 | 234 | } |
  |  | 235 | } |
  | 236 | 236 | ); |
  | 237 | 237 | }; |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L240) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L240) |  |
  | 240 | 240 | \* General Settings Screens JS |
  | 241 | 241 | \*/ |
  | 242 |  | var TMEM\_Settings = { |
  | 243 |  | init : function()   { |
  | 244 |  | this.general(); |
  | 245 |  | if ( 'admin\_page\_tmem-custom-event-fields' === tmem\_admin\_vars.current\_page || 'admin\_page\_tmem-custom-client-fields' === tmem\_admin\_vars.current\_page ) { |
  | 246 |  | this.custom\_fields(); |
  | 247 |  | } |
  | 248 |  | }, |
  | 249 |  |  |
  | 250 |  | general : function()    { |
  | 251 |  | var tmem\_color\_picker = $( '.tmem-color-picker' ); |
  | 252 |  |  |
  | 253 |  | if ( tmem\_color\_picker.length ) { |
  | 254 |  | tmem\_color\_picker.wpColorPicker(); |
  | 255 |  | } |
  | 256 |  | }, |
  | 257 |  |  |
  | 258 |  | custom\_fields : function()  { |
  |  | 242 | var TMEM\_Settings = { |
  |  | 243 | init : function()   { |
  |  | 244 | this.general(); |
  |  | 245 | if ( 'admin\_page\_tmem-custom-event-fields' === tmem\_admin\_vars.current\_page || 'admin\_page\_tmem-custom-client-fields' === tmem\_admin\_vars.current\_page ) { |
  |  | 246 | this.custom\_fields(); |
  |  | 247 | } |
  |  | 248 | }, |
  |  | 249 |  |
  |  | 250 | general : function()    { |
  |  | 251 | var tmem\_color\_picker = $( '.tmem-color-picker' ); |
  |  | 252 |  |
  |  | 253 | if ( tmem\_color\_picker.length ) { |
  |  | 254 | tmem\_color\_picker.wpColorPicker(); |
  |  | 255 | } |
  |  | 256 | }, |
  |  | 257 |  |
  |  | 258 | custom\_fields : function()  { |
  | 259 | 259 | // Sortable Client Fields |
  | 260 | 260 | jQuery( document ).ready( |
  | 261 | 261 | function($)     { |
  | 262 | 262 | $( '.tmem-client-list-item' ).sortable( |
  | 263 |  | { |
  | 264 |  | handle: '.tmem\_draghandle', |
  | 265 |  | items: '.tmem\_sortable\_row', |
  | 266 |  | opacity: 0.6, |
  | 267 |  | cursor: 'move', |
  | 268 |  | axis: 'y', |
  | 269 |  | update: function()  { |
  | 270 |  | var order = $( this ).sortable( 'serialize', { expression: / (.+) = (.+) / } ) + '&action=tmem\_update\_client\_field\_order'; |
  | 271 |  | $.post( |
  | 272 |  | ajaxurl, |
  | 273 |  | order, |
  | 274 |  | function()  { |
  |  | 263 | { |
  |  | 264 | handle: '.tmem\_draghandle', |
  |  | 265 | items: '.tmem\_sortable\_row', |
  |  | 266 | opacity: 0.6, |
  |  | 267 | cursor: 'move', |
  |  | 268 | axis: 'y', |
  |  | 269 | update: function()  { |
  |  | 270 | var order = $( this ).sortable( 'serialize', { expression: / (.+) = (.+) / } ) + '&action=tmem\_update\_client\_field\_order'; |
  |  | 271 | $.post( |
  |  | 272 | ajaxurl, |
  |  | 273 | order, |
  |  | 274 | function()  { |
  | 275 | 275 | // Success |
  | 276 | 276 | } |
  | 277 |  | ); |
  | 278 |  | } |
  | 279 |  | } |
  |  | 277 | ); |
  |  | 278 | } |
  |  | 279 | } |
  | 280 | 280 | ); |
  | 281 | 281 | } |
  | 282 |  | ); |
  |  | 282 | ); |
  | 283 | 283 |  |
  | 284 | 284 | // Sortable Custom Event Fields |
  | 285 | 285 | $( '.tmem-custom-client-list-item,.tmem-custom-event-list-item,.tmem-custom-venue-list-item' ).sortable( |
  | 286 |  | { |
  | 287 |  |  |
  | 288 |  | handle: '.tmem\_draghandle', |
  | 289 |  | items: '.tmem\_sortable\_row', |
  | 290 |  | opacity: 0.6, |
  | 291 |  | cursor: 'move', |
  | 292 |  | axis: 'y', |
  | 293 |  | update: function()  { |
  | 294 |  | var order = $( this ).sortable( 'serialize' ) + '&action=order\_custom\_event\_fields'; |
  | 295 |  | $.post( |
  | 296 |  | ajaxurl, |
  | 297 |  | order, |
  | 298 |  | function()  { |
  |  | 286 | { |
  |  | 287 |  |
  |  | 288 | handle: '.tmem\_draghandle', |
  |  | 289 | items: '.tmem\_sortable\_row', |
  |  | 290 | opacity: 0.6, |
  |  | 291 | cursor: 'move', |
  |  | 292 | axis: 'y', |
  |  | 293 | update: function()  { |
  |  | 294 | var order = $( this ).sortable( 'serialize' ) + '&action=order\_custom\_event\_fields'; |
  |  | 295 | $.post( |
  |  | 296 | ajaxurl, |
  |  | 297 | order, |
  |  | 298 | function()  { |
  | 299 | 299 | // Success |
  | 300 | 300 | } |
  | 301 |  | ); |
  | 302 |  | } |
  | 303 |  | } |
  |  | 301 | ); |
  |  | 302 | } |
  |  | 303 | } |
  | 304 | 304 | ); |
  | 305 | 305 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L310) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L310) |  |
  | 310 | 310 | \* Availability screen JS |
  | 311 | 311 | \*/ |
  | 312 |  | var TMEM\_Availability = { |
  | 313 |  | init : function()   { |
  | 314 |  | this.options(); |
  | 315 |  | this.absence(); |
  | 316 |  | this.checker(); |
  | 317 |  | }, |
  | 318 |  |  |
  | 319 |  | options : function()    { |
  |  | 312 | var TMEM\_Availability = { |
  |  | 313 | init : function()   { |
  |  | 314 | this.options(); |
  |  | 315 | this.absence(); |
  |  | 316 | this.checker(); |
  |  | 317 | }, |
  |  | 318 |  |
  |  | 319 | options : function()    { |
  | 320 | 320 | // Toggle display of availability checker |
  | 321 | 321 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L334) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L334) |  |
  | 334 | 334 | $( '.tmem-availability-checker-fields' ).slideToggle(); |
  | 335 | 335 | } |
  | 336 |  | ); |
  |  | 336 | ); |
  | 337 | 337 |  |
  | 338 | 338 | // Toggle display of absence form section |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L366) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L366) |  |
  | 366 | 366 | first\_input.focus(); |
  | 367 | 367 | } |
  | 368 |  | ); |
  |  | 368 | ); |
  | 369 | 369 |  |
  | 370 | 370 | // Toggle display of absence time fields |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L376) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L376) |  |
  | 376 | 376 | $( '.tmem-absence-end-time-option' ).slideToggle(); |
  | 377 | 377 | } |
  | 378 |  | ); |
  |  | 378 | ); |
  | 379 | 379 |  |
  | 380 | 380 | }, |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L430) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L430) |  |
  | 430 | 430 |  |
  | 431 | 431 | $.ajax( |
  |  | 432 | { |
  |  | 433 | type       : 'POST', |
  |  | 434 | dataType   : 'json', |
  |  | 435 | data       : postData, |
  |  | 436 | url        : ajaxurl, |
  |  | 437 | beforeSend : function() { |
  |  | 438 | $( '#tmem-add-absence-fields' ).addClass( 'tmem-mute' ); |
  |  | 439 | }, |
  |  | 440 | success: function (response) { |
  |  | 441 | if ( true === response.success ) { |
  |  | 442 | $( '#tmem-calendar' ).fullCalendar( 'refetchEvents' ); |
  |  | 443 | $( '#tmem-calendar' ).fullCalendar( 'gotoDate', response.date ); |
  |  | 444 | } |
  |  | 445 | $( '#display\_absence\_start' ).val( '' ); |
  |  | 446 | $( '#absence\_start' ).val( '' ); |
  |  | 447 | $( '#display\_absence\_end' ).val( '' ); |
  |  | 448 | $( '#absence\_end' ).val( '' ); |
  |  | 449 | $( '#absence\_all\_day' ).prop( 'checked, true' ); |
  |  | 450 | $( '#absence\_start\_time\_hr' ).val( '00' ); |
  |  | 451 | $( '#absence\_start\_time\_min' ).val( '00' ); |
  |  | 452 | $( '#absence\_end\_time\_hr' ).val( '00' ); |
  |  | 453 | $( '#absence\_end\_time\_min' ).val( '00' ); |
  |  | 454 | $( '#absence\_notes' ).val( '' ); |
  |  | 455 |  |
  |  | 456 | if ( 'H:i' !== tmem\_admin\_vars.time\_format ) { |
  |  | 457 | $( '#absence\_start\_time\_period' ).val( 'am' ); |
  |  | 458 | $( '#absence\_end\_time\_period' ).val( 'am' ); |
  |  | 459 | } |
  |  | 460 |  |
  |  | 461 | $( '#tmem-calendar' ).removeClass( 'tmem-mute' ); |
  |  | 462 | $( '#tmem-add-absence-fields' ).removeClass( 'tmem-mute' ); |
  |  | 463 | $( 'html, body' ).animate( |
  |  | 464 | { |
  |  | 465 | scrollTop: $( '.toggle-add-absence-section' ).offset().top |
  |  | 466 | }, |
  |  | 467 | 500 |
  |  | 468 | ); |
  |  | 469 | $( '.toggle-add-absence-section' ).trigger( 'click' ); |
  |  | 470 | } |
  |  | 471 | } |
  |  | 472 | ).fail( |
  |  | 473 | function (data) { |
  |  | 474 | if ( window.console && window.console.log ) { |
  |  | 475 | console.log( data ); |
  |  | 476 | } |
  |  | 477 | } |
  |  | 478 | ); |
  |  | 479 |  |
  |  | 480 | } |
  |  | 481 | ); |
  |  | 482 |  |
  |  | 483 | // Delete an entry from the calendar screen |
  |  | 484 | $( document.body ).on( |
  |  | 485 | 'click', |
  |  | 486 | '.delete-absence', |
  |  | 487 | function(e)  { |
  |  | 488 | e.preventDefault(); |
  |  | 489 |  |
  |  | 490 | $( '#tmem-calendar' ).addClass( 'tmem-mute' ); |
  |  | 491 | var postData = { |
  |  | 492 | id     : $( this ).data( 'entry' ), |
  |  | 493 | action : 'tmem\_delete\_employee\_absence' |
  |  | 494 | }; |
  |  | 495 |  |
  |  | 496 | $.ajax( |
  |  | 497 | { |
  |  | 498 | type: 'POST', |
  |  | 499 | url: ajaxurl, |
  |  | 500 | dataType: 'json', |
  |  | 501 | data: postData, |
  |  | 502 | success: function(response) { |
  |  | 503 | if ( true === response.success ) { |
  |  | 504 | $( '#tmem-calendar' ).fullCalendar( 'refetchEvents' ); |
  |  | 505 | $( '.popover' ).hide( 'fast' ); |
  |  | 506 | } |
  |  | 507 | $( '#tmem-calendar' ).removeClass( 'tmem-mute' ); |
  |  | 508 | } |
  |  | 509 | } |
  |  | 510 | ).fail( |
  |  | 511 | function (data) { |
  |  | 512 | if ( window.console && window.console.log ) { |
  |  | 513 | console.log( data ); |
  |  | 514 | } |
  |  | 515 | } |
  |  | 516 | ); |
  |  | 517 | } |
  |  | 518 | ); |
  |  | 519 | }, |
  |  | 520 |  |
  |  | 521 | checker : function()    { |
  |  | 522 | $( document.body ).on( |
  |  | 523 | 'click', |
  |  | 524 | '#check-availability', |
  |  | 525 | function()  { |
  |  | 526 | var date     = $( '#check\_date' ), |
  |  | 527 | display\_date = $( '#display\_date' ), |
  |  | 528 | employees    = $( '#display\_date' ), |
  |  | 529 | roles        = $( '#check\_roles' ); |
  |  | 530 |  |
  |  | 531 | if ( ! date.val() || ! display\_date.val() ) { |
  |  | 532 | display\_date.addClass( 'tmem-form-error' ); |
  |  | 533 | return; |
  |  | 534 | } |
  |  | 535 |  |
  |  | 536 | var postData = { |
  |  | 537 | date     : date, |
  |  | 538 | employees : employees, |
  |  | 539 | roles     : roles, |
  |  | 540 | action : 'do\_availability\_check\_ajax' |
  |  | 541 | }; |
  |  | 542 |  |
  |  | 543 | $.ajax( |
  |  | 544 | { |
  |  | 545 | type       : 'POST', |
  |  | 546 | dataType   : 'json', |
  |  | 547 | data       : postData, |
  |  | 548 | url        : ajaxurl, |
  |  | 549 | beforeSend : function() { |
  |  | 550 | $( '#tmem\_availability\_fields' ).addClass( 'tmem-mute' ); |
  |  | 551 | }, |
  |  | 552 | success: function () { |
  |  | 553 | $( '#tmem\_availability\_fields' ).removeClass( 'tmem-mute' ); |
  |  | 554 | } |
  |  | 555 | } |
  |  | 556 | ).fail( |
  |  | 557 | function (data) { |
  |  | 558 | if ( window.console && window.console.log ) { |
  |  | 559 | console.log( data ); |
  |  | 560 | } |
  |  | 561 | } |
  |  | 562 | ); |
  |  | 563 |  |
  |  | 564 | } |
  |  | 565 | ); |
  |  | 566 | } |
  |  | 567 | }; |
  |  | 568 | TMEM\_Availability.init(); |
  |  | 569 |  |
  |  | 570 | /\*\* |
  |  | 571 | \* Events screen JS |
  |  | 572 | \*/ |
  |  | 573 | var TMEM\_Events = { |
  |  | 574 |  |
  |  | 575 | init : function()   { |
  |  | 576 | this.options(); |
  |  | 577 | this.client(); |
  |  | 578 | this.employee(); |
  |  | 579 | this.equipment(); |
  |  | 580 | this.playlist(); |
  |  | 581 | this.tasks(); |
  |  | 582 | this.time(); |
  |  | 583 | this.travel(); |
  |  | 584 | this.type(); |
  |  | 585 | this.txns(); |
  |  | 586 | this.venue(); |
  |  | 587 | }, |
  |  | 588 |  |
  |  | 589 | options : function()    { |
  |  | 590 | // Toggle display of event options |
  |  | 591 | $( document.body ).on( |
  |  | 592 | 'click', |
  |  | 593 | '.toggle-event-options-section', |
  |  | 594 | function(e) { |
  |  | 595 | e.preventDefault(); |
  |  | 596 | var show = $( this ).html() === tmem\_admin\_vars.show\_event\_options ? true : false; |
  |  | 597 |  |
  |  | 598 | if ( show ) { |
  |  | 599 | $( this ).html( tmem\_admin\_vars.hide\_event\_options ); |
  |  | 600 | } else { |
  |  | 601 | $( this ).html( tmem\_admin\_vars.show\_event\_options ); |
  |  | 602 | } |
  |  | 603 |  |
  |  | 604 | $( '.tmem-event-options-sections-wrap' ).slideToggle(); |
  |  | 605 | } |
  |  | 606 | ); |
  |  | 607 | }, |
  |  | 608 |  |
  |  | 609 | client : function() { |
  |  | 610 | // Toggle display of new client fields section for an event |
  |  | 611 | $( document.body ).on( |
  |  | 612 | 'click', |
  |  | 613 | '.toggle-client-add-option-section', |
  |  | 614 | function(e) { |
  |  | 615 | e.preventDefault(); |
  |  | 616 | var show = $( this ).html() === tmem\_admin\_vars.show\_client\_form ? true : false; |
  |  | 617 |  |
  |  | 618 | if ( show ) { |
  |  | 619 | $( this ).html( tmem\_admin\_vars.hide\_client\_form ); |
  |  | 620 | } else { |
  |  | 621 | $( this ).html( tmem\_admin\_vars.show\_client\_form ); |
  |  | 622 | } |
  |  | 623 |  |
  |  | 624 | var header = $( this ).parents( '.tmem-client-row-header' ); |
  |  | 625 | header.siblings( '.tmem-client-add-event-sections-wrap' ).slideToggle(); |
  |  | 626 |  |
  |  | 627 | var first\_input; |
  |  | 628 | if ( show ) { |
  |  | 629 | first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-client-add-event-sections-wrap' ) ); |
  |  | 630 | } else { |
  |  | 631 | first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-repeatable-row-standard-fields' ) ); |
  |  | 632 | } |
  |  | 633 | first\_input.focus(); |
  |  | 634 | } |
  |  | 635 | ); |
  |  | 636 |  |
  |  | 637 | // Toggle display of client details section for an event |
  |  | 638 | $( document.body ).on( |
  |  | 639 | 'click', |
  |  | 640 | '.toggle-client-details-option-section', |
  |  | 641 | function(e) { |
  |  | 642 | e.preventDefault(); |
  |  | 643 | var show = $( this ).html() === tmem\_admin\_vars.show\_client\_details ? true : false; |
  |  | 644 |  |
  |  | 645 | if ( show ) { |
  |  | 646 | $( this ).html( tmem\_admin\_vars.hide\_client\_details ); |
  |  | 647 | } else { |
  |  | 648 | $( this ).html( tmem\_admin\_vars.show\_client\_details ); |
  |  | 649 | } |
  |  | 650 |  |
  |  | 651 | var header = $( this ).parents( '.tmem-client-row-header' ); |
  |  | 652 | header.siblings( '.tmem-client-details-event-sections-wrap' ).slideToggle(); |
  |  | 653 |  |
  |  | 654 | var first\_input; |
  |  | 655 | if ( ! show ) { |
  |  | 656 | first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-repeatable-row-standard-fields' ) ); |
  |  | 657 | first\_input.focus(); |
  |  | 658 | } |
  |  | 659 | } |
  |  | 660 | ); |
  |  | 661 |  |
  |  | 662 | // Display client details |
  |  | 663 | $( document.body ).on( |
  |  | 664 | 'click', |
  |  | 665 | '#toggle\_client\_details', |
  |  | 666 | function() { |
  |  | 667 | $( '#tmem-event-client-details' ).toggle( 'slow' ); |
  |  | 668 | } |
  |  | 669 | ); |
  |  | 670 |  |
  |  | 671 | // Update the client details when the client selection changes |
  |  | 672 | $( document.body ).on( |
  |  | 673 | 'change', |
  |  | 674 | '#client\_name', |
  |  | 675 | function(event) { |
  |  | 676 |  |
  |  | 677 | event.preventDefault(); |
  |  | 678 |  |
  |  | 679 | if ( '' === $( '#client\_name' ).val() ) { |
  |  | 680 | $( '#tmem-event-add-new-client-fields' ).hide( 'slow' ); |
  |  | 681 | return; |
  |  | 682 | } else if ( 'tmem\_add\_client' === $( '#client\_name' ).val() ) { |
  |  | 683 | $( '#tmem-event-add-new-client-fields' ).show( 'slow' ); |
  |  | 684 | } else { |
  |  | 685 |  |
  |  | 686 | $( '#tmem-event-add-new-client-fields' ).hide( 'slow' ); |
  |  | 687 |  |
  |  | 688 | var postData = { |
  |  | 689 | client\_id  : $( '#client\_name' ).val(), |
  |  | 690 | event\_id   : $( '#post\_ID' ).val(), |
  |  | 691 | action     : 'tmem\_refresh\_client\_details' |
  |  | 692 | }; |
  |  | 693 |  |
  |  | 694 | $.ajax( |
  | 432 | 695 | { |
  | 433 | 696 | type       : 'POST', |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L436) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L699) |  |
  | 436 | 699 | url        : ajaxurl, |
  | 437 | 700 | beforeSend : function() { |
  | 438 |  | $( '#tmem-~~add-absence-fields' ).addClass( 'tmem-mute~~' ); |
  |  | 701 | $( '#tmem-event-client-details' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' ); |
  | 439 | 702 | }, |
  | 440 | 703 | success: function (response) { |
  | 441 |  | if ( true === response.success ) { |
  | 442 |  | $( '#tmem-calendar' ).fullCalendar( 'refetchEvents' ); |
  | 443 |  | $( '#tmem-calendar' ).fullCalendar( 'gotoDate', response.date ); |
  | 444 |  | } |
  | 445 |  | $( '#display\_absence\_start' ).val( '' ); |
  | 446 |  | $( '#absence\_start' ).val( '' ); |
  | 447 |  | $( '#display\_absence\_end' ).val( '' ); |
  | 448 |  | $( '#absence\_end' ).val( '' ); |
  | 449 |  | $( '#absence\_all\_day' ).prop( 'checked, true' ); |
  | 450 |  | $( '#absence\_start\_time\_hr' ).val( '00' ); |
  | 451 |  | $( '#absence\_start\_time\_min' ).val( '00' ); |
  | 452 |  | $( '#absence\_end\_time\_hr' ).val( '00' ); |
  | 453 |  | $( '#absence\_end\_time\_min' ).val( '00' ); |
  | 454 |  | $( '#absence\_notes' ).val( '' ); |
  | 455 |  |  |
  | 456 |  | if ( 'H:i' !== tmem\_admin\_vars.time\_format ) { |
  | 457 |  | $( '#absence\_start\_time\_period' ).val( 'am' ); |
  | 458 |  | $( '#absence\_end\_time\_period' ).val( 'am' ); |
  | 459 |  | } |
  | 460 |  |  |
  | 461 |  | $( '#tmem-calendar' ).removeClass( 'tmem-mute' ); |
  | 462 |  | $( '#tmem-add-absence-fields' ).removeClass( 'tmem-mute' ); |
  | 463 |  | $( 'html, body' ).animate( |
  | 464 |  | { |
  | 465 |  | scrollTop: $( '.toggle-add-absence-section' ).offset().top |
  | 466 |  | }, |
  | 467 |  | 500 |
  | 468 |  | ); |
  | 469 |  | $( '.toggle-add-absence-section' ).trigger( 'click' ); |
  | 470 |  | } |
  | 471 |  | } |
  | 472 |  | ).fail( |
  |  | 704 | $( '#tmem-loading' ).replaceWith( response.client\_details ); |
  |  | 705 |  |
  |  | 706 | } |
  |  | 707 | } |
  |  | 708 | ).fail( |
  | 473 | 709 | function (data) { |
  |  | 710 | $( '#tmem-event-client-details' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' ); |
  |  | 711 |  |
  | 474 | 712 | if ( window.console && window.console.log ) { |
  | 475 | 713 | console.log( data ); |
  | 476 | 714 | } |
  | 477 | 715 | } |
  | 478 |  | ~~);~~ |
  | 479 |  |  |
  | 480 |  | ~~}~~ |
  | 481 |  | ~~);~~ |
  | 482 |  |  |
  | 483 |  | ~~// Delete an entry from the calendar screen~~ |
  | 484 |  | ~~$( document.body ).on(~~ |
  | 485 |  | ~~'click',~~ |
  | 486 |  | ~~'.delete-absence',~~ |
  | 487 |  | ~~function(e)  {~~ |
  | 488 |  | ~~e.preventDefault();~~ |
  | 489 |  |  |
  | 490 |  | ~~$( '#tmem-calendar' ).addClass( 'tmem-mute' );~~ |
  | 491 |  | ~~var postData = {~~ |
  | 492 |  | ~~id     : $( this ).data( 'entry' ),~~ |
  | 493 |  | ~~action : 'tmem\_delete\_employee\_absence'~~ |
  | 494 |  | ~~};~~ |
  | 495 |  |  |
  | 496 |  | ~~$.ajax(~~ |
  | 497 |  | ~~{~~ |
  | 498 |  | ~~type: 'POST',~~ |
  | 499 |  | ~~url: ajaxurl,~~ |
  | 500 |  | ~~dataType: 'json',~~ |
  | 501 |  | ~~data: postData,~~ |
  | 502 |  | ~~success: function(response) {~~ |
  | 503 |  | ~~if ( true === response.success ) {~~ |
  | 504 |  | ~~$( '#tmem-calendar' ).fullCalendar( 'refetchEvents' );~~ |
  | 505 |  | ~~$( '.popover' ).hide( 'fast' );~~ |
  | 506 |  | ~~}~~ |
  | 507 |  | ~~$( '#tmem-calendar' ).removeClass( 'tmem-mute' );~~ |
  | 508 |  | ~~}~~ |
  | 509 |  | ~~}~~ |
  | 510 |  | ~~).fail(~~ |
  | 511 |  | ~~function (data) {~~ |
  | 512 |  | ~~if ( window.console && window.console.log ) {~~ |
  | 513 |  | ~~console.log( data );~~ |
  | 514 |  | ~~}~~ |
  | 515 |  | ~~}~~ |
  | 516 |  | ~~);~~ |
  | 517 |  | ~~}~~ |
  | 518 |  | ~~);~~ |
  | 519 |  | ~~},~~ |
  | 520 |  |  |
  | 521 |  | ~~checker : function()    {~~ |
  | 522 |  | ~~$( document.body ).on(~~ |
  | 523 |  | ~~'click',~~ |
  | 524 |  | ~~'#check-availability',~~ |
  | 525 |  | ~~function()  {~~ |
  | 526 |  | ~~var date     = $( '#check\_date' ),~~ |
  | 527 |  | ~~display\_date = $( '#display\_date' ),~~ |
  | 528 |  | ~~employees    = $( '#display\_date' ),~~ |
  | 529 |  | ~~roles        = $( '#check\_roles' );~~ |
  | 530 |  |  |
  | 531 |  | ~~if ( ! date.val() || ! display\_date.val() ) {~~ |
  | 532 |  | ~~display\_date.addClass( 'tmem-form-error' );~~ |
  | 533 |  | ~~return;~~ |
  | 534 |  | ~~}~~ |
  | 535 |  |  |
  | 536 |  | ~~var postData = {~~ |
  | 537 |  | ~~date     : date,~~ |
  | 538 |  | ~~employees : employees,~~ |
  | 539 |  | ~~roles     : roles,~~ |
  | 540 |  | ~~action : 'do\_availability\_check\_ajax'~~ |
  | 541 |  | ~~};~~ |
  | 542 |  |  |
  | 543 |  | ~~$.ajax(~~ |
  | 544 |  | ~~{~~ |
  | 545 |  | ~~type       : 'POST',~~ |
  | 546 |  | ~~dataType   : 'json',~~ |
  | 547 |  | ~~data       : postData,~~ |
  | 548 |  | ~~url        : ajaxurl,~~ |
  | 549 |  | ~~beforeSend : function() {~~ |
  | 550 |  | ~~$( '#tmem\_availability\_fields' ).addClass( 'tmem-mute' );~~ |
  | 551 |  | ~~},~~ |
  | 552 |  | ~~success: function () {~~ |
  | 553 |  | ~~$( '#tmem\_availability\_fields' ).removeClass( 'tmem-mute' );~~ |
  | 554 |  | ~~}~~ |
  | 555 |  | ~~}~~ |
  | 556 |  | ~~).fail(~~ |
  | 557 |  | ~~function (data) {~~ |
  | 558 |  | ~~if ( window.console && window.console.log ) {~~ |
  | 559 |  | ~~console.log( data );~~ |
  | 560 |  | ~~}~~ |
  | 561 |  | ~~}~~ |
  | 562 |  | ~~);~~ |
  | 563 |  |  |
  | 564 |  | ~~}~~ |
  | 565 |  | ~~);~~ |
  | 566 |  | ~~}~~ |
  | 567 |  | ~~};~~ |
  | 568 |  | ~~TMEM\_Availability.init();~~ |
  | 569 |  |  |
  | 570 |  | ~~/\*\*~~ |
  | 571 |  | ~~\* Events screen JS~~ |
  | 572 |  | ~~\*/~~ |
  | 573 |  | ~~var TMEM\_Events = {~~ |
  | 574 |  |  |
  | 575 |  | ~~init : function()   {~~ |
  | 576 |  | ~~this.options();~~ |
  | 577 |  | ~~this.client();~~ |
  | 578 |  | ~~this.employee();~~ |
  | 579 |  | ~~this.equipment();~~ |
  | 580 |  | ~~this.playlist();~~ |
  | 581 |  | ~~this.tasks();~~ |
  | 582 |  | ~~this.time();~~ |
  | 583 |  | ~~this.travel();~~ |
  | 584 |  | ~~this.type();~~ |
  | 585 |  | ~~this.txns();~~ |
  | 586 |  | ~~this.venue();~~ |
  | 587 |  | ~~},~~ |
  | 588 |  |  |
  | 589 |  | ~~options : function()    {~~ |
  | 590 |  | ~~// Toggle display of event options~~ |
  | 591 |  | ~~$( document.body ).on(~~ |
  | 592 |  | ~~'click',~~ |
  | 593 |  | ~~'.toggle-event-options-section',~~ |
  | 594 |  | ~~function(e) {~~ |
  | 595 |  | ~~e.preventDefault();~~ |
  | 596 |  | ~~var show = $( this ).html() === tmem\_admin\_vars.show\_event\_options ? true : false;~~ |
  | 597 |  |  |
  | 598 |  | ~~if ( show ) {~~ |
  | 599 |  | ~~$( this ).html( tmem\_admin\_vars.hide\_event\_options );~~ |
  | 600 |  | ~~} else {~~ |
  | 601 |  | ~~$( this ).html( tmem\_admin\_vars.show\_event\_options );~~ |
  | 602 |  | ~~}~~ |
  | 603 |  |  |
  | 604 |  | ~~$( '.tmem-event-options-sections-wrap' ).slideToggle();~~ |
  | 605 |  | ~~}~~ |
  | 606 |  | ~~);~~ |
  | 607 |  | ~~},~~ |
  | 608 |  |  |
  | 609 |  | ~~client : function() {~~ |
  | 610 |  | ~~// Toggle display of new client fields section for an event~~ |
  | 611 |  | ~~$( document.body ).on(~~ |
  | 612 |  | ~~'click',~~ |
  | 613 |  | ~~'.toggle-client-add-option-section',~~ |
  | 614 |  | ~~function(e) {~~ |
  | 615 |  | ~~e.preventDefault();~~ |
  | 616 |  | ~~var show = $( this ).html() === tmem\_admin\_vars.show\_client\_form ? true : false;~~ |
  | 617 |  |  |
  | 618 |  | ~~if ( show ) {~~ |
  | 619 |  | ~~$( this ).html( tmem\_admin\_vars.hide\_client\_form );~~ |
  | 620 |  | ~~} else {~~ |
  | 621 |  | ~~$( this ).html( tmem\_admin\_vars.show\_client\_form );~~ |
  | 622 |  | ~~}~~ |
  | 623 |  |  |
  | 624 |  | ~~var header = $( this ).parents( '.tmem-client-row-header' );~~ |
  | 625 |  | ~~header.siblings( '.tmem-client-add-event-sections-wrap' ).slideToggle();~~ |
  | 626 |  |  |
  | 627 |  | ~~var first\_input;~~ |
  | 628 |  | ~~if ( show ) {~~ |
  | 629 |  | ~~first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-client-add-event-sections-wrap' ) );~~ |
  | 630 |  | ~~} else {~~ |
  | 631 |  | ~~first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-repeatable-row-standard-fields' ) );~~ |
  | 632 |  | ~~}~~ |
  | 633 |  | ~~first\_input.focus();~~ |
  | 634 |  | ~~}~~ |
  | 635 |  | ~~);~~ |
  | 636 |  |  |
  | 637 |  | ~~// Toggle display of client details section for an event~~ |
  | 638 |  | ~~$( document.body ).on(~~ |
  | 639 |  | ~~'click',~~ |
  | 640 |  | ~~'.toggle-client-details-option-section',~~ |
  | 641 |  | ~~function(e) {~~ |
  | 642 |  | ~~e.preventDefault();~~ |
  | 643 |  | ~~var show = $( this ).html() === tmem\_admin\_vars.show\_client\_details ? true : false;~~ |
  | 644 |  |  |
  | 645 |  | ~~if ( show ) {~~ |
  | 646 |  | ~~$( this ).html( tmem\_admin\_vars.hide\_client\_details );~~ |
  | 647 |  | ~~} else {~~ |
  | 648 |  | ~~$( this ).html( tmem\_admin\_vars.show\_client\_details );~~ |
  | 649 |  | ~~}~~ |
  | 650 |  |  |
  | 651 |  | ~~var header = $( this ).parents( '.tmem-client-row-header' );~~ |
  | 652 |  | ~~header.siblings( '.tmem-client-details-event-sections-wrap' ).slideToggle();~~ |
  | 653 |  |  |
  | 654 |  | ~~var first\_input;~~ |
  | 655 |  | ~~if ( ! show ) {~~ |
  | 656 |  | ~~first\_input = $( ':input:not(input[type=button],input[type=submit],button):visible:first', header.siblings( '.tmem-repeatable-row-standard-fields' ) );~~ |
  | 657 |  | ~~first\_input.focus();~~ |
  | 658 |  | ~~}~~ |
  | 659 |  | ~~}~~ |
  | 660 |  | ~~);~~ |
  | 661 |  |  |
  | 662 |  | ~~// Display client details~~ |
  | 663 |  | ~~$( document.body ).on(~~ |
  | 664 |  | ~~'click',~~ |
  | 665 |  | ~~'#toggle\_client\_details',~~ |
  | 666 |  | ~~function() {~~ |
  | 667 |  | ~~$( '#tmem-event-client-details' ).toggle( 'slow' );~~ |
  | 668 |  | ~~}~~ |
  | 669 |  | ~~);~~ |
  | 670 |  |  |
  | 671 |  | ~~// Update the client details when the client selection changes~~ |
  | 672 |  | ~~$( document.body ).on(~~ |
  | 673 |  | ~~'change',~~ |
  | 674 |  | ~~'#client\_name',~~ |
  | 675 |  | ~~function(event) {~~ |
  | 676 |  |  |
  | 677 |  | ~~event.preventDefault();~~ |
  | 678 |  |  |
  | 679 |  | ~~if ( '' === $( '#client\_name' ).val() ) {~~ |
  | 680 |  | ~~$( '#tmem-event-add-new-client-fields' ).hide( 'slow' );~~ |
  | 681 |  | ~~return;~~ |
  | 682 |  | ~~} else if ( 'tmem\_add\_client' === $( '#client\_name' ).val() ) {~~ |
  | 683 |  | ~~$( '#tmem-event-add-new-client-fields' ).show( 'slow' );~~ |
  | 684 |  | ~~} else {~~ |
  | 685 |  |  |
  | 686 |  | ~~$( '#tmem-event-add-new-client-fields' ).hide( 'slow' );~~ |
  | 687 |  |  |
  | 688 |  | ~~var postData = {~~ |
  | 689 |  | ~~client\_id  : $( '#client\_name' ).val(),~~ |
  | 690 |  | ~~event\_id   : $( '#post\_ID' ).val(),~~ |
  | 691 |  | ~~action     : 'tmem\_refresh\_client\_details'~~ |
  | 692 |  | ~~};~~ |
  | 693 |  |  |
  | 694 |  | ~~$.ajax(~~ |
  | 695 |  | ~~{~~ |
  | 696 |  | ~~type       : 'POST',~~ |
  | 697 |  | ~~dataType   : 'json',~~ |
  | 698 |  | ~~data       : postData,~~ |
  | 699 |  | ~~url        : ajaxurl,~~ |
  | 700 |  | ~~beforeSend : function() {~~ |
  | 701 |  | ~~$( '#tmem-event-client-details' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' );~~ |
  | 702 |  | ~~},~~ |
  | 703 |  | ~~success: function (response) {~~ |
  | 704 |  | ~~$( '#tmem-loading' ).replaceWith( response.client\_details );~~ |
  | 705 |  |  |
  | 706 |  | ~~}~~ |
  | 707 |  | ~~}~~ |
  | 708 |  | ~~).fail(~~ |
  | 709 |  | ~~function (data) {~~ |
  | 710 |  | ~~$( '#tmem-event-client-details' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' );~~ |
  | 711 |  |  |
  | 712 |  | ~~if ( window.console && window.console.log ) {~~ |
  | 713 |  | ~~console.log( data );~~ |
  | 714 |  | ~~}~~ |
  | 715 |  | ~~}~~ |
  | 716 | 716 | ); |
  | 717 | 717 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L719) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L719) |  |
  | 719 | 719 |  |
  | 720 | 720 | } |
  | 721 |  | ); |
  |  | 721 | ); |
  | 722 | 722 |  |
  | 723 | 723 | // Add a new client from the event screen |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L753) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L753) |  |
  | 753 | 753 |  |
  | 754 | 754 | $.ajax( |
  | 755 |  | { |
  | 756 |  | type       : 'POST', |
  | 757 |  | dataType   : 'json', |
  | 758 |  | data       : postData, |
  | 759 |  | url        : ajaxurl, |
  | 760 |  | beforeSend : function() { |
  | 761 |  | $( '.tmem-client-option-fields' ).addClass( 'tmem-mute' ); |
  | 762 |  | $( '#tmem-add-client' ).hide( 'fast' ); |
  | 763 |  | }, |
  | 764 |  | success: function (response) { |
  | 765 |  | $( '#tmem-add-client-fields' ).slideToggle(); |
  | 766 |  | $( '#add-client-action' ).html( tmem\_admin\_vars.show\_client\_form ); |
  | 767 |  | $( '#client\_name' ).empty(); |
  | 768 |  | $( '#client\_firstname' ).val( '' ); |
  | 769 |  | $( '#client\_lastname' ).val( '' ); |
  | 770 |  | $( '#client\_email' ).val( '' ); |
  | 771 |  | $( '#client\_address1' ).val( '' ); |
  | 772 |  | $( '#client\_address2' ).val( '' ); |
  | 773 |  | $( '#client\_town' ).val( '' ); |
  | 774 |  | $( '#client\_county' ).val( '' ); |
  | 775 |  | $( '#client\_postcode' ).val( '' ); |
  | 776 |  | $( '#client\_phone' ).val( '' ); |
  | 777 |  | $( '#client\_phone2' ).val( '' ); |
  | 778 |  | $( '#client\_name' ).append( response.client\_list ); |
  | 779 |  | $( '#tmem-add-client' ).show( 'fast' ); |
  | 780 |  | $( '#\_tmem\_event\_block\_emails' ).prop( 'checked', false ); |
  | 781 |  | $( '#tmem\_reset\_pw' ).prop( 'checked', true ); |
  | 782 |  | $( '#client\_name' ).trigger( 'chosen:updated' ); |
  | 783 |  |  |
  | 784 |  | $( '.tmem-client-option-fields' ).removeClass( 'tmem-mute' ); |
  | 785 |  |  |
  | 786 |  | if ( response.type === 'error' ) { |
  | 787 |  | alert( response.message ); |
  | 788 |  | } |
  | 789 |  |  |
  | 790 |  | } |
  | 791 |  | } |
  |  | 755 | { |
  |  | 756 | type       : 'POST', |
  |  | 757 | dataType   : 'json', |
  |  | 758 | data       : postData, |
  |  | 759 | url        : ajaxurl, |
  |  | 760 | beforeSend : function() { |
  |  | 761 | $( '.tmem-client-option-fields' ).addClass( 'tmem-mute' ); |
  |  | 762 | $( '#tmem-add-client' ).hide( 'fast' ); |
  |  | 763 | }, |
  |  | 764 | success: function (response) { |
  |  | 765 | $( '#tmem-add-client-fields' ).slideToggle(); |
  |  | 766 | $( '#add-client-action' ).html( tmem\_admin\_vars.show\_client\_form ); |
  |  | 767 | $( '#client\_name' ).empty(); |
  |  | 768 | $( '#client\_firstname' ).val( '' ); |
  |  | 769 | $( '#client\_lastname' ).val( '' ); |
  |  | 770 | $( '#client\_email' ).val( '' ); |
  |  | 771 | $( '#client\_address1' ).val( '' ); |
  |  | 772 | $( '#client\_address2' ).val( '' ); |
  |  | 773 | $( '#client\_town' ).val( '' ); |
  |  | 774 | $( '#client\_county' ).val( '' ); |
  |  | 775 | $( '#client\_postcode' ).val( '' ); |
  |  | 776 | $( '#client\_phone' ).val( '' ); |
  |  | 777 | $( '#client\_phone2' ).val( '' ); |
  |  | 778 | $( '#client\_name' ).append( response.client\_list ); |
  |  | 779 | $( '#tmem-add-client' ).show( 'fast' ); |
  |  | 780 | $( '#\_tmem\_event\_block\_emails' ).prop( 'checked', false ); |
  |  | 781 | $( '#tmem\_reset\_pw' ).prop( 'checked', true ); |
  |  | 782 | $( '#client\_name' ).trigger( 'chosen:updated' ); |
  |  | 783 |  |
  |  | 784 | $( '.tmem-client-option-fields' ).removeClass( 'tmem-mute' ); |
  |  | 785 |  |
  |  | 786 | if ( response.type === 'error' ) { |
  |  | 787 | alert( response.message ); |
  |  | 788 | } |
  |  | 789 |  |
  |  | 790 | } |
  |  | 791 | } |
  | 792 | 792 | ).fail( |
  | 793 |  | function (data) { |
  | 794 |  | if ( window.console && window.console.log ) { |
  | 795 |  | console.log( data ); |
  | 796 |  | } |
  | 797 |  | } |
  |  | 793 | function (data) { |
  |  | 794 | if ( window.console && window.console.log ) { |
  |  | 795 | console.log( data ); |
  |  | 796 | } |
  |  | 797 | } |
  | 798 | 798 | ); |
  | 799 | 799 |  |
  | 800 | 800 | } |
  | 801 |  | ); |
  |  | 801 | ); |
  | 802 | 802 |  |
  | 803 | 803 | // Display custom client fields |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L808) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L808) |  |
  | 808 | 808 | $( '#tmem\_event\_custom\_client\_fields' ).toggle( 'fast' ); |
  | 809 | 809 | } |
  | 810 |  | ); |
  |  | 810 | ); |
  | 811 | 811 | // Display custom event fields |
  | 812 | 812 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L816) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L816) |  |
  | 816 | 816 | $( '#tmem\_event\_custom\_event\_fields' ).toggle( 'fast' ); |
  | 817 | 817 | } |
  | 818 |  | ); |
  |  | 818 | ); |
  | 819 | 819 | // Display custom venue fields |
  | 820 | 820 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L824) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L824) |  |
  | 824 | 824 | $( '#tmem\_event\_custom\_venue\_fields' ).toggle( 'fast' ); |
  | 825 | 825 | } |
  | 826 |  | ); |
  |  | 826 | ); |
  | 827 | 827 |  |
  | 828 | 828 | }, |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L852) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L852) |  |
  | 852 | 852 |  |
  | 853 | 853 | $.ajax( |
  | 854 |  | { |
  | 855 |  | type: 'POST', |
  | 856 |  | dataType: 'json', |
  | 857 |  | data: postData, |
  | 858 |  | url: ajaxurl, |
  | 859 |  | beforeSend: function()  { |
  | 860 |  | $( 'input[type="submit"]' ).prop( 'disabled', true ); |
  | 861 |  | $( '#new\_tmem\_role' ).hide(); |
  | 862 |  | $( '#pleasewait' ).show(); |
  | 863 |  | $( '#all\_roles' ).addClass( 'tmem-mute' ); |
  | 864 |  | $( '#employee\_role' ).addClass( 'tmem-mute' ); |
  | 865 |  | $( '#all\_roles' ).fadeTo( 'slow', 0.5 ); |
  | 866 |  | $( '#employee\_role' ).fadeTo( 'slow', 0.5 ); |
  | 867 |  | }, |
  | 868 |  | success: function(response) { |
  | 869 |  | if (response.type === 'success') { |
  |  | 854 | { |
  |  | 855 | type: 'POST', |
  |  | 856 | dataType: 'json', |
  |  | 857 | data: postData, |
  |  | 858 | url: ajaxurl, |
  |  | 859 | beforeSend: function()  { |
  |  | 860 | $( 'input[type="submit"]' ).prop( 'disabled', true ); |
  |  | 861 | $( '#new\_tmem\_role' ).hide(); |
  |  | 862 | $( '#pleasewait' ).show(); |
  |  | 863 | $( '#all\_roles' ).addClass( 'tmem-mute' ); |
  |  | 864 | $( '#employee\_role' ).addClass( 'tmem-mute' ); |
  |  | 865 | $( '#all\_roles' ).fadeTo( 'slow', 0.5 ); |
  |  | 866 | $( '#employee\_role' ).fadeTo( 'slow', 0.5 ); |
  |  | 867 | }, |
  |  | 868 | success: function(response) { |
  |  | 869 | if (response.type === 'success') { |
  | 870 | 870 | $( '#all\_roles' ).empty(); // Remove existing options |
  | 871 | 871 | $( '#employee\_role' ).empty(); |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L892) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L892) |  |
  | 892 | 892 | } |
  | 893 | 893 | } |
  | 894 |  | ); |
  | 895 |  | } |
  | 896 |  | ); |
  |  | 894 | ); |
  |  | 895 | } |
  |  | 896 | ); |
  | 897 | 897 |  |
  | 898 | 898 | // Reveal the input field to add a new event worker |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L916) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L916) |  |
  | 916 | 916 | } |
  | 917 | 917 | } |
  | 918 |  | ); |
  |  | 918 | ); |
  | 919 | 919 |  |
  | 920 | 920 | // Currency format for new employee wage |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L929) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L929) |  |
  | 929 | 929 | } |
  | 930 | 930 | } |
  | 931 |  | ); |
  |  | 931 | ); |
  | 932 | 932 |  |
  | 933 | 933 | // Add an employee to the event |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L948) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L948) |  |
  | 948 | 948 |  |
  | 949 | 949 | $.ajax( |
  | 950 |  | { |
  | 951 |  | type       : 'POST', |
  | 952 |  | dataType   : 'json', |
  | 953 |  | data       : postData, |
  | 954 |  | url        : ajaxurl, |
  | 955 |  | beforeSend : function() { |
  | 956 |  | $( '.tmem-event-workers-sections-wrap' ).addClass( 'tmem-mute' ); |
  | 957 |  | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 958 |  | }, |
  | 959 |  | success: function (response) { |
  | 960 |  | if (response.type !== 'success') { |
  | 961 |  | alert( response.msg ); |
  | 962 |  | } |
  | 963 |  | $( '#tmem-event-employee-list' ).html( response.employees ); |
  | 964 |  | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 965 |  | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  | 966 |  | $( '#event\_new\_employee\_role' ).val( '' ).trigger( 'chosen:updated' ); |
  | 967 |  | $( '#event\_new\_employee' ).val( '' ).trigger( 'chosen:updated' ); |
  | 968 |  | $( '#event\_new\_employee\_wage' ).val( '' ); |
  | 969 |  |  |
  | 970 |  | } |
  | 971 |  | } |
  | 972 |  | ).fail( |
  | 973 |  | function (data) { |
  |  | 950 | { |
  |  | 951 | type       : 'POST', |
  |  | 952 | dataType   : 'json', |
  |  | 953 | data       : postData, |
  |  | 954 | url        : ajaxurl, |
  |  | 955 | beforeSend : function() { |
  |  | 956 | $( '.tmem-event-workers-sections-wrap' ).addClass( 'tmem-mute' ); |
  |  | 957 | $( '#tmem-event-employee-list' ).slideToggle(); |
  |  | 958 | }, |
  |  | 959 | success: function (response) { |
  |  | 960 | if (response.type !== 'success') { |
  |  | 961 | alert( response.msg ); |
  |  | 962 | } |
  |  | 963 | $( '#tmem-event-employee-list' ).html( response.employees ); |
  | 974 | 964 | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 975 | 965 | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  | 976 |  |  |
  | 977 |  | if ( window.console && window.console.log ) { |
  | 978 |  | console.log( data ); |
  | 979 |  | } |
  | 980 |  | } |
  |  | 966 | $( '#event\_new\_employee\_role' ).val( '' ).trigger( 'chosen:updated' ); |
  |  | 967 | $( '#event\_new\_employee' ).val( '' ).trigger( 'chosen:updated' ); |
  |  | 968 | $( '#event\_new\_employee\_wage' ).val( '' ); |
  |  | 969 |  |
  |  | 970 | } |
  |  | 971 | } |
  |  | 972 | ).fail( |
  |  | 973 | function (data) { |
  |  | 974 | $( '#tmem-event-employee-list' ).slideToggle(); |
  |  | 975 | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  |  | 976 |  |
  |  | 977 | if ( window.console && window.console.log ) { |
  |  | 978 | console.log( data ); |
  |  | 979 | } |
  |  | 980 | } |
  | 981 | 981 | ); |
  | 982 | 982 |  |
  | 983 | 983 | } |
  | 984 |  | ); |
  |  | 984 | ); |
  | 985 | 985 |  |
  | 986 | 986 | // Remove an employee from the event |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L999) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L999) |  |
  | 999 | 999 |  |
  | 1000 | 1000 | $.ajax( |
  | 1001 |  | { |
  | 1002 |  | type       : 'POST', |
  | 1003 |  | dataType   : 'json', |
  | 1004 |  | data       : postData, |
  | 1005 |  | url        : ajaxurl, |
  | 1006 |  | beforeSend : function() { |
  | 1007 |  | $( '.tmem-event-workers-sections-wrap' ).addClass( 'tmem-mute' ); |
  | 1008 |  | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 1009 |  | }, |
  | 1010 |  | success: function(response) { |
  | 1011 |  | if (response.type !== 'success') { |
  | 1012 |  | alert( 'Error' ); |
  | 1013 |  | } |
  | 1014 |  | $( '#tmem-event-employee-list' ).html( response.employees ); |
  | 1015 |  | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 1016 |  | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  | 1017 |  |  |
  | 1018 |  | } |
  | 1019 |  | } |
  | 1020 |  | ).fail( |
  | 1021 |  | function (data) { |
  |  | 1001 | { |
  |  | 1002 | type       : 'POST', |
  |  | 1003 | dataType   : 'json', |
  |  | 1004 | data       : postData, |
  |  | 1005 | url        : ajaxurl, |
  |  | 1006 | beforeSend : function() { |
  |  | 1007 | $( '.tmem-event-workers-sections-wrap' ).addClass( 'tmem-mute' ); |
  |  | 1008 | $( '#tmem-event-employee-list' ).slideToggle(); |
  |  | 1009 | }, |
  |  | 1010 | success: function(response) { |
  |  | 1011 | if (response.type !== 'success') { |
  |  | 1012 | alert( 'Error' ); |
  |  | 1013 | } |
  |  | 1014 | $( '#tmem-event-employee-list' ).html( response.employees ); |
  | 1022 | 1015 | $( '#tmem-event-employee-list' ).slideToggle(); |
  | 1023 | 1016 | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  | 1024 | 1017 |  |
  | 1025 |  | if ( window.console && window.console.log ) { |
  | 1026 |  | console.log( data ); |
  | 1027 |  | } |
  | 1028 |  | } |
  |  | 1018 | } |
  |  | 1019 | } |
  |  | 1020 | ).fail( |
  |  | 1021 | function (data) { |
  |  | 1022 | $( '#tmem-event-employee-list' ).slideToggle(); |
  |  | 1023 | $( '.tmem-event-workers-sections-wrap' ).removeClass( 'tmem-mute' ); |
  |  | 1024 |  |
  |  | 1025 | if ( window.console && window.console.log ) { |
  |  | 1026 | console.log( data ); |
  |  | 1027 | } |
  |  | 1028 | } |
  | 1029 | 1029 | ); |
  | 1030 | 1030 |  |
  | 1031 | 1031 | } |
  | 1032 |  | ); |
  |  | 1032 | ); |
  | 1033 | 1033 | }, |
  | 1034 | 1034 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1041) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1041) |  |
  | 1041 | 1041 | setCost(); |
  | 1042 | 1042 | } |
  | 1043 |  | ); |
  |  | 1043 | ); |
  | 1044 | 1044 |  |
  | 1045 | 1045 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1051) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1051) |  |
  | 1051 | 1051 | } |
  | 1052 | 1052 | } |
  | 1053 |  | ); |
  |  | 1053 | ); |
  | 1054 | 1054 |  |
  | 1055 | 1055 | // Update package and add-on options when the event type, date or primary employee are updated. |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1070) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1070) |  |
  | 1070 | 1070 |  |
  | 1071 | 1071 | $.ajax( |
  | 1072 |  | { |
  | 1073 |  | type       : 'POST', |
  | 1074 |  | dataType   : 'json', |
  | 1075 |  | data       : postData, |
  | 1076 |  | url        : ajaxurl, |
  | 1077 |  | beforeSend : function() { |
  | 1078 |  | $( '#tmem-event-equipment-row' ).hide(); |
  | 1079 |  | $( '#tmem-equipment-loader' ).show(); |
  | 1080 |  | }, |
  | 1081 |  | success: function (response) { |
  | 1082 |  | if (response.type === 'success') { |
  |  | 1072 | { |
  |  | 1073 | type       : 'POST', |
  |  | 1074 | dataType   : 'json', |
  |  | 1075 | data       : postData, |
  |  | 1076 | url        : ajaxurl, |
  |  | 1077 | beforeSend : function() { |
  |  | 1078 | $( '#tmem-event-equipment-row' ).hide(); |
  |  | 1079 | $( '#tmem-equipment-loader' ).show(); |
  |  | 1080 | }, |
  |  | 1081 | success: function (response) { |
  |  | 1082 | if (response.type === 'success') { |
  | 1083 | 1083 | $( '#\_tmem\_event\_package' ).empty(); // Remove existing package options |
  | 1084 | 1084 | $( '#\_tmem\_event\_package' ).append( response.packages ); |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1102) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1102) |  |
  | 1102 | 1102 | } |
  | 1103 | 1103 | } |
  | 1104 |  | ).fail( |
  |  | 1104 | ).fail( |
  | 1105 | 1105 | function (data) { |
  | 1106 | 1106 | if ( window.console && window.console.log ) { |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1109) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1109) |  |
  | 1109 | 1109 | $( '#\_tmem\_event\_deposit' ).val( current\_deposit ); |
  | 1110 | 1110 | } |
  |  | 1111 | ); |
  |  | 1112 |  |
  |  | 1113 | } |
  | 1111 | 1114 | ); |
  | 1112 |  |  |
  | 1113 |  | ~~}~~ |
  | 1114 |  | ~~);~~ |
  | 1115 | 1115 |  |
  | 1116 | 1116 | // Refresh the add-ons when the package is updated |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1132) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1132) |  |
  | 1132 | 1132 |  |
  | 1133 | 1133 | $.ajax( |
  | 1134 |  | { |
  | 1135 |  | type       : 'POST', |
  | 1136 |  | dataType   : 'json', |
  | 1137 |  | data       : postData, |
  | 1138 |  | url        : ajaxurl, |
  | 1139 |  | beforeSend : function() { |
  | 1140 |  | $( '#tmem-event-equipment-row' ).hide(); |
  | 1141 |  | $( '#tmem-equipment-loader' ).show(); |
  | 1142 |  | }, |
  | 1143 |  | success: function (response) { |
  | 1144 |  | if (response.type === 'success') { |
  | 1145 |  | $( '#event\_addons' ).empty(); |
  | 1146 |  | $( '#event\_addons' ).append( response.addons ); |
  | 1147 |  | $( '#event\_addons' ).trigger( 'chosen:updated' ); |
  | 1148 |  | setCost(); |
  | 1149 |  |  |
  | 1150 |  | $( '#tmem-equipment-loader' ).hide(); |
  | 1151 |  | $( '#tmem-event-equipment-row' ).show(); |
  | 1152 |  | } else { |
  | 1153 |  | alert( response.msg ); |
  | 1154 |  | } |
  |  | 1134 | { |
  |  | 1135 | type       : 'POST', |
  |  | 1136 | dataType   : 'json', |
  |  | 1137 | data       : postData, |
  |  | 1138 | url        : ajaxurl, |
  |  | 1139 | beforeSend : function() { |
  |  | 1140 | $( '#tmem-event-equipment-row' ).hide(); |
  |  | 1141 | $( '#tmem-equipment-loader' ).show(); |
  |  | 1142 | }, |
  |  | 1143 | success: function (response) { |
  |  | 1144 | if (response.type === 'success') { |
  |  | 1145 | $( '#event\_addons' ).empty(); |
  |  | 1146 | $( '#event\_addons' ).append( response.addons ); |
  |  | 1147 | $( '#event\_addons' ).trigger( 'chosen:updated' ); |
  |  | 1148 | setCost(); |
  | 1155 | 1149 |  |
  | 1156 | 1150 | $( '#tmem-equipment-loader' ).hide(); |
  | 1157 | 1151 | $( '#tmem-event-equipment-row' ).show(); |
  | 1158 |  | } |
  | 1159 |  | } |
  |  | 1152 | } else { |
  |  | 1153 | alert( response.msg ); |
  |  | 1154 | } |
  |  | 1155 |  |
  |  | 1156 | $( '#tmem-equipment-loader' ).hide(); |
  |  | 1157 | $( '#tmem-event-equipment-row' ).show(); |
  |  | 1158 | } |
  |  | 1159 | } |
  | 1160 | 1160 | ).fail( |
  | 1161 |  | function (data) { |
  | 1162 |  | if ( window.console && window.console.log ) { |
  | 1163 |  | console.log( data ); |
  | 1164 |  | } |
  | 1165 |  | } |
  |  | 1161 | function (data) { |
  |  | 1162 | if ( window.console && window.console.log ) { |
  |  | 1163 | console.log( data ); |
  |  | 1164 | } |
  |  | 1165 | } |
  | 1166 | 1166 | ); |
  | 1167 | 1167 |  |
  | 1168 | 1168 | } |
  | 1169 |  | ); |
  |  | 1169 | ); |
  | 1170 | 1170 |  |
  | 1171 | 1171 | }, |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1178) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1178) |  |
  | 1178 | 1178 | $( '#tmem-playlist-limit' ).toggle( 'fast' ); |
  | 1179 | 1179 | } |
  | 1180 |  | ); |
  |  | 1180 | ); |
  | 1181 | 1181 | }, |
  | 1182 | 1182 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1195) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1195) |  |
  | 1195 | 1195 | } |
  | 1196 | 1196 | } |
  | 1197 |  | ); |
  |  | 1197 | ); |
  | 1198 | 1198 |  |
  | 1199 | 1199 | // Execute the selected event task |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1224) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1224) |  |
  | 1224 | 1224 | }; |
  | 1225 | 1225 | $.ajax( |
  | 1226 |  | { |
  | 1227 |  | type       : 'POST', |
  | 1228 |  | dataType   : 'json', |
  | 1229 |  | data       : postData, |
  | 1230 |  | url        : ajaxurl, |
  | 1231 |  | beforeSend : function() { |
  | 1232 |  | $( '#tmem-run-task' ).addClass( 'tmem-hidden' ); |
  | 1233 |  | $( '#tmem-spinner' ).css( 'visibility', 'visible' ); |
  | 1234 |  | }, |
  | 1235 |  | complete : function()   { |
  | 1236 |  | $( '#tmem-event-tasks' ).removeClass( 'tmem-mute' ); |
  | 1237 |  | }, |
  | 1238 |  | success: function (response) { |
  | 1239 |  | if ( response.success ) { |
  | 1240 |  | $( '#tmem-event-task-run' ).addClass( 'tmem-hidden' ); |
  | 1241 |  | $( '#tmem\_event\_status' ).val( response.data.status ); |
  | 1242 |  | $( '#tmem\_event\_status' ).trigger( 'chosen:updated' ); |
  | 1243 |  | $( '.task-history-items' ).html( response.data.history ); |
  | 1244 |  | $( '.task-history-items' ).removeClass( 'description' ); |
  | 1245 |  | $( '#tmem-run-task' ).removeClass( 'tmem-hidden' ); |
  | 1246 |  | $( '#tmem\_event\_task' ).val( '0' ); |
  | 1247 |  | $( '#tmem\_event\_task' ).trigger( 'chosen:updated' ); |
  | 1248 |  | $( '#tmem-spinner' ).css( 'visibility', 'hidden' ); |
  | 1249 |  | } else { |
  | 1250 |  | alert( 'Error' ); |
  | 1251 |  | } |
  | 1252 |  | } |
  | 1253 |  | } |
  |  | 1226 | { |
  |  | 1227 | type       : 'POST', |
  |  | 1228 | dataType   : 'json', |
  |  | 1229 | data       : postData, |
  |  | 1230 | url        : ajaxurl, |
  |  | 1231 | beforeSend : function() { |
  |  | 1232 | $( '#tmem-run-task' ).addClass( 'tmem-hidden' ); |
  |  | 1233 | $( '#tmem-spinner' ).css( 'visibility', 'visible' ); |
  |  | 1234 | }, |
  |  | 1235 | complete : function()   { |
  |  | 1236 | $( '#tmem-event-tasks' ).removeClass( 'tmem-mute' ); |
  |  | 1237 | }, |
  |  | 1238 | success: function (response) { |
  |  | 1239 | if ( response.success ) { |
  |  | 1240 | $( '#tmem-event-task-run' ).addClass( 'tmem-hidden' ); |
  |  | 1241 | $( '#tmem\_event\_status' ).val( response.data.status ); |
  |  | 1242 | $( '#tmem\_event\_status' ).trigger( 'chosen:updated' ); |
  |  | 1243 | $( '.task-history-items' ).html( response.data.history ); |
  |  | 1244 | $( '.task-history-items' ).removeClass( 'description' ); |
  |  | 1245 | $( '#tmem-run-task' ).removeClass( 'tmem-hidden' ); |
  |  | 1246 | $( '#tmem\_event\_task' ).val( '0' ); |
  |  | 1247 | $( '#tmem\_event\_task' ).trigger( 'chosen:updated' ); |
  |  | 1248 | $( '#tmem-spinner' ).css( 'visibility', 'hidden' ); |
  |  | 1249 | } else { |
  |  | 1250 | alert( 'Error' ); |
  |  | 1251 | } |
  |  | 1252 | } |
  |  | 1253 | } |
  | 1254 | 1254 | ).fail( |
  | 1255 |  | function (data) { |
  | 1256 |  | if ( window.console && window.console.log ) { |
  | 1257 |  | console.log( data ); |
  | 1258 |  | } |
  | 1259 |  | } |
  |  | 1255 | function (data) { |
  |  | 1256 | if ( window.console && window.console.log ) { |
  |  | 1257 | console.log( data ); |
  |  | 1258 | } |
  |  | 1259 | } |
  | 1260 | 1260 | ); |
  | 1261 | 1261 | } |
  | 1262 |  | ); |
  |  | 1262 | ); |
  | 1263 | 1263 | }, |
  | 1264 | 1264 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1273) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1273) |  |
  | 1273 | 1273 | } |
  | 1274 | 1274 | } |
  | 1275 |  | ); |
  |  | 1275 | ); |
  | 1276 | 1276 |  |
  | 1277 | 1277 | // Set the setup time |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1281) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1281) |  |
  | 1281 | 1281 | '#event\_start\_hr, #event\_start\_min, #event\_start\_period', |
  | 1282 | 1282 | function() { |
  |  | 1283 |  |
  | 1283 | 1284 | var hour     = $( '#event\_start\_hr' ).val(); |
  | 1284 | 1285 | var minute   = $( '#event\_start\_min' ).val(); |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1298) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1299) |  |
  | 1298 | 1299 | }; |
  | 1299 | 1300 | $.ajax( |
  | 1300 |  | { |
  | 1301 |  | type       : 'POST', |
  | 1302 |  | dataType   : 'json', |
  | 1303 |  | data       : postData, |
  | 1304 |  | url        : ajaxurl, |
  | 1305 |  | success: function (response) { |
  | 1306 |  | $( '#dj\_setup\_hr' ).val( response.data.hour ); |
  | 1307 |  | $( '#dj\_setup\_min' ).val( response.data.minute ); |
  | 1308 |  | if ( 'H:i' !== tmem\_admin\_vars.time\_format ) { |
  | 1309 |  | $( '#dj\_setup\_period' ).val( response.data.meridiem ); |
  | 1310 |  | } |
  | 1311 |  | if ( $( '#dj\_setup\_date' ).val().length < 1 || $( '#dj\_setup\_date' ).val() !== response.data.date ) { |
  | 1312 |  | $( '#dj\_setup\_date' ).val( response.data.date ); |
  | 1313 |  | $( '#\_tmem\_event\_djsetup' ).val( response.data.datepicker ); |
  | 1314 |  | } |
  |  | 1301 | { |
  |  | 1302 | type       : 'POST', |
  |  | 1303 | dataType   : 'json', |
  |  | 1304 | data       : postData, |
  |  | 1305 | url        : ajaxurl, |
  |  | 1306 | success: function (response) { |
  |  | 1307 | $( '#dj\_setup\_hr' ).val( response.data.hour ); |
  |  | 1308 | $( '#dj\_setup\_min' ).val( response.data.minute ); |
  |  | 1309 | if ( 'H:i' !== tmem\_admin\_vars.time\_format ) { |
  |  | 1310 | $( '#dj\_setup\_period' ).val( response.data.meridiem ); |
  | 1315 | 1311 | } |
  | 1316 |  | } |
  |  | 1312 | if ( $( '#dj\_setup\_date' ).val().length < 1 || $( '#dj\_setup\_date' ).val() !== response.data.date ) { |
  |  | 1313 | $( '#dj\_setup\_date' ).val( response.data.date ); |
  |  | 1314 | $( '#\_tmem\_event\_djsetup' ).val( response.data.datepicker ); |
  |  | 1315 | } |
  |  | 1316 | } |
  |  | 1317 | } |
  | 1317 | 1318 | ).fail( |
  | 1318 |  | function (data) { |
  | 1319 |  | if ( window.console && window.console.log ) { |
  | 1320 |  | console.log( data ); |
  | 1321 |  | } |
  | 1322 |  | } |
  |  | 1319 | function (data) { |
  |  | 1320 | if ( window.console && window.console.log ) { |
  |  | 1321 | console.log( data ); |
  |  | 1322 | } |
  |  | 1323 | } |
  | 1323 | 1324 | ); |
  | 1324 | 1325 | } |
  | 1325 |  | ); |
  |  | 1326 | ); |
  | 1326 | 1327 | } |
  |  | 1328 | // Set the setup date |
  |  | 1329 | $( document.body ).on( |
  |  | 1330 | 'change', |
  |  | 1331 | '#display\_event\_date', |
  |  | 1332 | function() { |
  |  | 1333 | if ( $( '#dj\_setup\_date' ).val().length < 1 ) { |
  |  | 1334 | $( '#dj\_setup\_date' ).val( $( '#display\_event\_date' ).val() ); |
  |  | 1335 | } |
  |  | 1336 | } |
  |  | 1337 | ); |
  |  | 1338 |  |
  |  | 1339 | // Check the end date or time isnt before start |
  |  | 1340 |  |
  |  | 1341 | $( document.body ).on( |
  |  | 1342 | 'change', |
  |  | 1343 | '#event\_finish\_hr, #event\_finish\_min, #event\_finish\_period, #display\_event\_finish\_date', |
  |  | 1344 | function() { |
  |  | 1345 | var start\_hr     = $( '#event\_start\_hr' ).val(); |
  |  | 1346 | var start\_min   = $( '#event\_start\_min' ).val(); |
  |  | 1347 | var start\_date\_     = $( '#\_tmem\_event\_date' ).val().split("-"); |
  |  | 1348 | var start\_date = new Date(start\_date\_[0], start\_date\_[1] - 1, start\_date\_[2]); |
  |  | 1349 | start\_date.setHours(start\_hr); |
  |  | 1350 | start\_date.setMinutes(start\_min); |
  |  | 1351 | var event\_start = start\_date; |
  |  | 1352 |  |
  |  | 1353 | var finish\_hr     = $( '#event\_finish\_hr' ).val(); |
  |  | 1354 | var finish\_min   = $( '#event\_finish\_min' ).val(); |
  |  | 1355 | var finish\_date\_     = $( '#\_tmem\_event\_end\_date' ).val().split("-"); |
  |  | 1356 | var finish\_date = new Date(finish\_date\_[0], finish\_date\_[1] - 1, finish\_date\_[2]); |
  |  | 1357 | finish\_date.setHours(finish\_hr); |
  |  | 1358 | finish\_date.setMinutes(finish\_min); |
  |  | 1359 | var event\_end = finish\_date; |
  |  | 1360 |  |
  |  | 1361 | if(event\_end < event\_start){ |
  |  | 1362 | alert('Your event end date is before your start date. If the event finishes at midnight or later, please change the date to the next day first.'); |
  |  | 1363 | } |
  |  | 1364 |  |
  |  | 1365 | } |
  |  | 1366 | ); |
  |  | 1367 |  |
  | 1327 | 1368 | }, |
  | 1328 |  |  |
  | 1329 | 1369 | travel : function() { |
  | 1330 | 1370 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1336) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1376) |  |
  | 1336 | 1376 | } |
  | 1337 | 1377 | } |
  | 1338 |  | ); |
  |  | 1378 | ); |
  | 1339 | 1379 | // Update the travel data when the primary employee or venue fields are updated |
  | 1340 | 1380 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1345) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1385) |  |
  | 1345 | 1385 | $( '#\_tmem\_event\_package' ).trigger( 'change' ); |
  | 1346 | 1386 | } |
  | 1347 |  | ); |
  |  | 1387 | ); |
  | 1348 | 1388 |  |
  | 1349 | 1389 | var setClientAddress = function(){ |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1355) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1395) |  |
  | 1355 | 1395 | }; |
  | 1356 | 1396 | $.ajax( |
  | 1357 |  | { |
  | 1358 |  | type       : 'POST', |
  | 1359 |  | dataType   : 'json', |
  | 1360 |  | data       : postData, |
  | 1361 |  | url        : ajaxurl, |
  | 1362 |  | success: function (response) { |
  | 1363 |  | if (response.address1) { |
  | 1364 |  | $( '#venue\_address1' ).val( response.address1 ); |
  | 1365 |  | } |
  | 1366 |  | if (response.address2) { |
  | 1367 |  | $( '#venue\_address2' ).val( response.address2 ); |
  | 1368 |  | } |
  | 1369 |  | if (response.town) { |
  | 1370 |  | $( '#venue\_town' ).val( response.town ); |
  | 1371 |  | } |
  | 1372 |  | if (response.county) { |
  | 1373 |  | $( '#venue\_county' ).val( response.county ); |
  | 1374 |  | } |
  | 1375 |  | if (response.postcode) { |
  | 1376 |  | $( '#venue\_postcode' ).val( response.postcode ); |
  | 1377 |  | } |
  | 1378 |  | setTimeout( |
  | 1379 |  | function(){ |
  | 1380 |  | setTravelData(); |
  | 1381 |  | }, |
  | 1382 |  | 1000 |
  |  | 1397 | { |
  |  | 1398 | type       : 'POST', |
  |  | 1399 | dataType   : 'json', |
  |  | 1400 | data       : postData, |
  |  | 1401 | url        : ajaxurl, |
  |  | 1402 | success: function (response) { |
  |  | 1403 | if (response.address1) { |
  |  | 1404 | $( '#venue\_address1' ).val( response.address1 ); |
  |  | 1405 | } |
  |  | 1406 | if (response.address2) { |
  |  | 1407 | $( '#venue\_address2' ).val( response.address2 ); |
  |  | 1408 | } |
  |  | 1409 | if (response.town) { |
  |  | 1410 | $( '#venue\_town' ).val( response.town ); |
  |  | 1411 | } |
  |  | 1412 | if (response.county) { |
  |  | 1413 | $( '#venue\_county' ).val( response.county ); |
  |  | 1414 | } |
  |  | 1415 | if (response.postcode) { |
  |  | 1416 | $( '#venue\_postcode' ).val( response.postcode ); |
  |  | 1417 | } |
  |  | 1418 | setTimeout( |
  |  | 1419 | function(){ |
  |  | 1420 | setTravelData(); |
  |  | 1421 | }, |
  |  | 1422 | 1000 |
  | 1383 | 1423 | ); |
  | 1384 |  | setTimeout( |
  | 1385 |  | function(){ |
  | 1386 |  | setCost(); |
  | 1387 |  | }, |
  | 1388 |  | 1750 |
  |  | 1424 | setTimeout( |
  |  | 1425 | function(){ |
  |  | 1426 | setCost(); |
  |  | 1427 | }, |
  |  | 1428 | 1750 |
  | 1389 | 1429 | ); |
  | 1390 |  | } |
  | 1391 |  | } |
  |  | 1430 | } |
  |  | 1431 | } |
  | 1392 | 1432 | ).fail( |
  | 1393 |  | function (data) { |
  | 1394 |  | if ( window.console && window.console.log ) { |
  | 1395 |  | console.log( data ); |
  | 1396 |  | } |
  | 1397 |  | } |
  |  | 1433 | function (data) { |
  |  | 1434 | if ( window.console && window.console.log ) { |
  |  | 1435 | console.log( data ); |
  |  | 1436 | } |
  |  | 1437 | } |
  | 1398 | 1438 | ); |
  | 1399 | 1439 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1415) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1455) |  |
  | 1415 | 1455 | } |
  | 1416 | 1456 | } |
  | 1417 |  | ); |
  |  | 1457 | ); |
  | 1418 | 1458 |  |
  | 1419 | 1459 | // Save a new event type |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1432) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1472) |  |
  | 1432 | 1472 |  |
  | 1433 | 1473 | $.ajax( |
  | 1434 |  | { |
  | 1435 |  | type       : 'POST', |
  | 1436 |  | dataType   : 'json', |
  | 1437 |  | data       : postData, |
  | 1438 |  | url        : ajaxurl, |
  | 1439 |  | beforeSend : function() { |
  | 1440 |  | $( '.tmem-event-option-fields' ).addClass( 'tmem-mute' ); |
  | 1441 |  | $( '#tmem-add-event-type' ).hide( 'fast' ); |
  | 1442 |  | }, |
  | 1443 |  | success: function (response) { |
  | 1444 |  | if (response) { |
  | 1445 |  | if ( 'success' !== response.data.msg ) { |
  | 1446 |  | $( '#event\_type\_name' ).addClass( 'tmem-form-error' ); |
  | 1447 |  | $( '#tmem-add-event-type' ).show( 'fast' ); |
  | 1448 |  | return; |
  | 1449 |  | } |
  | 1450 |  | $( '#event\_type\_name' ).val( '' ); |
  | 1451 |  | $( '.tmem-add-event-type-sections-wrap' ).slideToggle(); |
  | 1452 |  | $( '#tmem\_event\_type' ).empty(); |
  | 1453 |  | $( '#tmem\_event\_type' ).append( response.data.event\_types ); |
  | 1454 |  | $( '#tmem\_event\_type' ).trigger( 'chosen:updated' ); |
  |  | 1474 | { |
  |  | 1475 | type       : 'POST', |
  |  | 1476 | dataType   : 'json', |
  |  | 1477 | data       : postData, |
  |  | 1478 | url        : ajaxurl, |
  |  | 1479 | beforeSend : function() { |
  |  | 1480 | $( '.tmem-event-option-fields' ).addClass( 'tmem-mute' ); |
  |  | 1481 | $( '#tmem-add-event-type' ).hide( 'fast' ); |
  |  | 1482 | }, |
  |  | 1483 | success: function (response) { |
  |  | 1484 | if (response) { |
  |  | 1485 | if ( 'success' !== response.data.msg ) { |
  |  | 1486 | $( '#event\_type\_name' ).addClass( 'tmem-form-error' ); |
  | 1455 | 1487 | $( '#tmem-add-event-type' ).show( 'fast' ); |
  | 1456 |  |  |
  | 1457 |  | $( '.tmem-event-option-fields' ).removeClass( 'tmem-mute' ); |
  | 1458 |  | } else { |
  | 1459 |  | alert( response.data.msg ); |
  | 1460 |  | $( '#tmem-add-event-type' ).show( 'fast' ); |
  |  | 1488 | return; |
  | 1461 | 1489 | } |
  | 1462 |  | } |
  | 1463 |  | } |
  |  | 1490 | $( '#event\_type\_name' ).val( '' ); |
  |  | 1491 | $( '.tmem-add-event-type-sections-wrap' ).slideToggle(); |
  |  | 1492 | $( '#tmem\_event\_type' ).empty(); |
  |  | 1493 | $( '#tmem\_event\_type' ).append( response.data.event\_types ); |
  |  | 1494 | $( '#tmem\_event\_type' ).trigger( 'chosen:updated' ); |
  |  | 1495 | $( '#tmem-add-event-type' ).show( 'fast' ); |
  |  | 1496 |  |
  |  | 1497 | $( '.tmem-event-option-fields' ).removeClass( 'tmem-mute' ); |
  |  | 1498 | } else { |
  |  | 1499 | alert( response.data.msg ); |
  |  | 1500 | $( '#tmem-add-event-type' ).show( 'fast' ); |
  |  | 1501 | } |
  |  | 1502 | } |
  |  | 1503 | } |
  | 1464 | 1504 | ).fail( |
  | 1465 |  | function (data) { |
  | 1466 |  | if ( window.console && window.console.log ) { |
  | 1467 |  | console.log( data ); |
  | 1468 |  | } |
  | 1469 |  | } |
  |  | 1505 | function (data) { |
  |  | 1506 | if ( window.console && window.console.log ) { |
  |  | 1507 | console.log( data ); |
  |  | 1508 | } |
  |  | 1509 | } |
  | 1470 | 1510 | ); |
  | 1471 | 1511 |  |
  | 1472 | 1512 | } |
  | 1473 |  | ); |
  |  | 1513 | ); |
  | 1474 | 1514 |  |
  | 1475 | 1515 | // Show/Hide the email templates when the disable emails checkbox is toggled |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1480) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1520) |  |
  | 1480 | 1520 | $( '.tmem-quote-template' ).toggle( 'fast' ); |
  | 1481 | 1521 | } |
  | 1482 |  | ); |
  |  | 1522 | ); |
  | 1483 | 1523 |  |
  | 1484 | 1524 | }, |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1493) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1533) |  |
  | 1493 | 1533 | $( '#tmem\_event\_txn\_table' ).toggle( 'slow' ); |
  | 1494 | 1534 | } |
  | 1495 |  | ); |
  |  | 1535 | ); |
  | 1496 | 1536 |  |
  | 1497 | 1537 | // Show/Hide transaction table |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1508) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1548) |  |
  | 1508 | 1548 | } |
  | 1509 | 1549 | } |
  | 1510 |  | ); |
  |  | 1550 | ); |
  | 1511 | 1551 |  |
  | 1512 | 1552 | // Transaction direction |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1526) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1566) |  |
  | 1526 | 1566 | } |
  | 1527 | 1567 | } |
  | 1528 |  | ); |
  |  | 1568 | ); |
  | 1529 | 1569 |  |
  | 1530 | 1570 | // Save an event transation |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1561) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1601) |  |
  | 1561 | 1601 | from            : $( '#tmem\_txn\_from' ).val(), |
  | 1562 | 1602 | to              : $( '#tmem\_txn\_to' ).val(), |
  | 1563 |  | for : $( '#tmem\_txn\_for' ) { |
  | 1564 |  | .val(), |
  | 1565 |  | src             : $( '#tmem\_txn\_src' ).val(), |
  | 1566 |  | send\_notice     : $( '#tmem\_manual\_txn\_email' ).is( ':checked' ) ? 1 : 0, |
  | 1567 |  | action          : 'add\_event\_transaction' |
  | 1568 |  | }; |
  | 1569 |  | } |
  |  | 1603 | for             : $( '#tmem\_txn\_for' ).val(), |
  |  | 1604 | src             : $( '#tmem\_txn\_src' ).val(), |
  |  | 1605 | send\_notice     : $( '#tmem\_manual\_txn\_email' ).is( ':checked' ) ? 1 : 0, |
  |  | 1606 | action          : 'add\_event\_transaction' |
  |  | 1607 | }; |
  | 1570 | 1608 |  |
  | 1571 | 1609 | $.ajax( |
  | 1572 |  | { |
  | 1573 |  | type       : 'POST', |
  | 1574 |  | dataType   : 'json', |
  | 1575 |  | data       : postData, |
  | 1576 |  | url        : ajaxurl, |
  | 1577 |  | beforeSend : function() { |
  | 1578 |  | $( '#tmem\_event\_txn\_table' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' ); |
  | 1579 |  | }, |
  | 1580 |  | success: function (response) { |
  | 1581 |  | if (response.type === 'success') { |
  | 1582 |  | if (response.deposit\_paid === 'Y') { |
  | 1583 |  | $( '#deposit\_paid' ).prop( 'checked', true ); |
  | 1584 |  | } |
  | 1585 |  | if (response.balance\_paid === 'Y') { |
  | 1586 |  | $( '#balance\_paid' ).prop( 'checked', true ); |
  | 1587 |  | } |
  | 1588 |  | if ( response.event\_status !== $( '#tmem\_event\_status' ).val() ) { |
  | 1589 |  | $( '#tmem\_event\_status' ).val( response.event\_status ); |
  | 1590 |  | } |
  | 1591 |  | } else { |
  | 1592 |  | alert( response.msg ); |
  |  | 1610 | { |
  |  | 1611 | type       : 'POST', |
  |  | 1612 | dataType   : 'json', |
  |  | 1613 | data       : postData, |
  |  | 1614 | url        : ajaxurl, |
  |  | 1615 | beforeSend : function() { |
  |  | 1616 | $( '#tmem\_event\_txn\_table' ).replaceWith( '<div id="tmem-loading" class="tmem-loader"><img src="' + tmem\_admin\_vars.ajax\_loader + '" /></div>' ); |
  |  | 1617 | }, |
  |  | 1618 | success: function (response) { |
  |  | 1619 | if (response.type === 'success') { |
  |  | 1620 | if (response.deposit\_paid === 'Y') { |
  |  | 1621 | $( '#deposit\_paid' ).prop( 'checked', true ); |
  | 1593 | 1622 | } |
  | 1594 |  | $( '#tmem-loading' ).replaceWith( '<div id="tmem\_event\_txn\_table">' + response.transactions + '</div>' ); |
  | 1595 |  | } |
  | 1596 |  | } |
  |  | 1623 | if (response.balance\_paid === 'Y') { |
  |  | 1624 | $( '#balance\_paid' ).prop( 'checked', true ); |
  |  | 1625 | } |
  |  | 1626 | if ( response.event\_status !== $( '#tmem\_event\_status' ).val() ) { |
  |  | 1627 | $( '#tmem\_event\_status' ).val( response.event\_status ); |
  |  | 1628 | } |
  |  | 1629 | } else { |
  |  | 1630 | alert( response.msg ); |
  |  | 1631 | } |
  |  | 1632 | $( '#tmem-loading' ).replaceWith( '<div id="tmem\_event\_txn\_table">' + response.transactions + '</div>' ); |
  |  | 1633 | } |
  |  | 1634 | } |
  | 1597 | 1635 | ).fail( |
  | 1598 |  | function (data) { |
  | 1599 |  | $( '#tmem-loading' ).replaceWith( '<div id="tmem\_event\_txn\_table">' + response.transactions + '</div>' ); |
  | 1600 |  | if ( window.console && window.console.log ) { |
  | 1601 |  | console.log( data ); |
  | 1602 |  | } |
  | 1603 |  | } |
  |  | 1636 | function (data) { |
  |  | 1637 | $( '#tmem-loading' ).replaceWith( '<div id="tmem\_event\_txn\_table">' + response.transactions + '</div>' ); |
  |  | 1638 | if ( window.console && window.console.log ) { |
  |  | 1639 | console.log( data ); |
  |  | 1640 | } |
  |  | 1641 | } |
  | 1604 | 1642 | ); |
  | 1605 | 1643 | } |
  | 1606 |  | ); |
  |  | 1644 | ); |
  | 1607 | 1645 |  |
  | 1608 | 1646 | }, |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1633) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1671) |  |
  | 1633 | 1671 | $( '.tmem-event-venue-details-sections-wrap' ).slideToggle(); |
  | 1634 | 1672 | } |
  | 1635 |  | ); |
  |  | 1673 | ); |
  | 1636 | 1674 |  |
  | 1637 | 1675 | // Reveal the input field to add a new venue from events screen |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1647) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1685) |  |
  | 1647 | 1685 | } |
  | 1648 | 1686 | } |
  | 1649 |  | ); |
  |  | 1687 | ); |
  | 1650 | 1688 |  |
  | 1651 | 1689 | // Update the venue details when the venue selection changes |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1659) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1697) |  |
  | 1659 | 1697 | refreshEventVenueDetails(); |
  | 1660 | 1698 | } |
  | 1661 |  | ); |
  |  | 1699 | ); |
  | 1662 | 1700 |  |
  | 1663 | 1701 | // Add a new venue from the event screen |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1688) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1726) |  |
  | 1688 | 1726 |  |
  | 1689 | 1727 | $.ajax( |
  | 1690 |  | { |
  | 1691 |  | type       : 'POST', |
  | 1692 |  | dataType   : 'json', |
  | 1693 |  | data       : postData, |
  | 1694 |  | url        : ajaxurl, |
  | 1695 |  | beforeSend : function() { |
  | 1696 |  | $( '.tmem-event-option-fields' ).addClass( 'tmem-mute' ); |
  | 1697 |  | $( '#tmem-add-venue' ).hide( 'fast' ); |
  | 1698 |  | }, |
  | 1699 |  | success: function (response) { |
  | 1700 |  | $( '.tmem-add-event-venue-sections-wrap' ).slideToggle(); |
  | 1701 |  | $( '#venue\_id' ).empty(); |
  | 1702 |  | $( '#venue\_id' ).append( response.venue\_list ); |
  | 1703 |  | $( '#tmem-add-venue' ).show(); |
  | 1704 |  | $( '#venue\_id' ).trigger( 'chosen:updated' ); |
  | 1705 |  | refreshEventVenueDetails(); |
  | 1706 |  |  |
  | 1707 |  | $( '.tmem-event-option-fields' ).removeClass( 'tmem-mute' ); |
  | 1708 |  |  |
  | 1709 |  | if ( response.type === 'error' ) { |
  | 1710 |  | alert( response.message ); |
  | 1711 |  | $( '#tmem-add-venue' ).show( 'fast' ); |
  | 1712 |  | } |
  | 1713 |  |  |
  | 1714 |  | } |
  | 1715 |  | } |
  |  | 1728 | { |
  |  | 1729 | type       : 'POST', |
  |  | 1730 | dataType   : 'json', |
  |  | 1731 | data       : postData, |
  |  | 1732 | url        : ajaxurl, |
  |  | 1733 | beforeSend : function() { |
  |  | 1734 | $( '.tmem-event-option-fields' ).addClass( 'tmem-mute' ); |
  |  | 1735 | $( '#tmem-add-venue' ).hide( 'fast' ); |
  |  | 1736 | }, |
  |  | 1737 | success: function (response) { |
  |  | 1738 | $( '.tmem-add-event-venue-sections-wrap' ).slideToggle(); |
  |  | 1739 | $( '#venue\_id' ).empty(); |
  |  | 1740 | $( '#venue\_id' ).append( response.venue\_list ); |
  |  | 1741 | $( '#tmem-add-venue' ).show(); |
  |  | 1742 | $( '#venue\_id' ).trigger( 'chosen:updated' ); |
  |  | 1743 | refreshEventVenueDetails(); |
  |  | 1744 |  |
  |  | 1745 | $( '.tmem-event-option-fields' ).removeClass( 'tmem-mute' ); |
  |  | 1746 |  |
  |  | 1747 | if ( response.type === 'error' ) { |
  |  | 1748 | alert( response.message ); |
  |  | 1749 | $( '#tmem-add-venue' ).show( 'fast' ); |
  |  | 1750 | } |
  |  | 1751 |  |
  |  | 1752 | } |
  |  | 1753 | } |
  | 1716 | 1754 | ).fail( |
  | 1717 |  | function (data) { |
  | 1718 |  | $( '#tmem-add-venue' ).show( 'fast' ); |
  | 1719 |  |  |
  | 1720 |  | if ( window.console && window.console.log ) { |
  | 1721 |  | console.log( data ); |
  | 1722 |  | } |
  | 1723 |  | } |
  |  | 1755 | function (data) { |
  |  | 1756 | $( '#tmem-add-venue' ).show( 'fast' ); |
  |  | 1757 |  |
  |  | 1758 | if ( window.console && window.console.log ) { |
  |  | 1759 | console.log( data ); |
  |  | 1760 | } |
  |  | 1761 | } |
  | 1724 | 1762 | ); |
  | 1725 | 1763 | } |
  | 1726 |  | ); |
  |  | 1764 | ); |
  | 1727 | 1765 |  |
  | 1728 | 1766 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1734) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1772) |  |
  | 1734 | 1772 | \* Packages & Addons screen JS |
  | 1735 | 1773 | \*/ |
  | 1736 |  | var TMEM\_Equipment = { |
  | 1737 |  |  |
  | 1738 |  | init : function()   { |
  | 1739 |  | this.add(); |
  | 1740 |  | this.remove(); |
  | 1741 |  | this.price(); |
  | 1742 |  | }, |
  | 1743 |  |  |
  | 1744 |  | clone\_repeatable : function(row) { |
  |  | 1774 | var TMEM\_Equipment = { |
  |  | 1775 |  |
  |  | 1776 | init : function()   { |
  |  | 1777 | this.add(); |
  |  | 1778 | this.remove(); |
  |  | 1779 | this.price(); |
  |  | 1780 | }, |
  |  | 1781 |  |
  |  | 1782 | clone\_repeatable : function(row) { |
  | 1745 | 1783 |  |
  | 1746 | 1784 | // Retrieve the highest current key |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1754) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1792) |  |
  | 1754 | 1792 | } |
  | 1755 | 1793 | } |
  | 1756 |  | ); |
  |  | 1794 | ); |
  | 1757 | 1795 | key = highest += 1; |
  | 1758 | 1796 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1764) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1802) |  |
  | 1764 | 1802 | $( this ).val( row.find( 'select[name="' + $( this ).attr( 'name' ) + '"]' ).val() ); |
  | 1765 | 1803 | } |
  | 1766 |  | ); |
  |  | 1804 | ); |
  | 1767 | 1805 |  |
  | 1768 | 1806 | clone.removeClass( 'tmem\_add\_blank' ); |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1790) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1828) |  |
  | 1790 | 1828 |  |
  | 1791 | 1829 | } |
  | 1792 |  | ); |
  |  | 1830 | ); |
  | 1793 | 1831 |  |
  | 1794 | 1832 | clone.find( 'span.tmem\_price\_id' ).each( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1796) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1834) |  |
  | 1796 | 1834 | $( this ).text( parseInt( key ) ); |
  | 1797 | 1835 | } |
  | 1798 |  | ); |
  |  | 1836 | ); |
  | 1799 | 1837 |  |
  | 1800 | 1838 | clone.find( 'span.tmem\_file\_id' ).each( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1802) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1840) |  |
  | 1802 | 1840 | $( this ).text( parseInt( key ) ); |
  | 1803 | 1841 | } |
  | 1804 |  | ); |
  |  | 1842 | ); |
  | 1805 | 1843 |  |
  | 1806 | 1844 | clone.find( '.tmem\_repeatable\_default\_input' ).each( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1808) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1846) |  |
  | 1808 | 1846 | $( this ).val( parseInt( key ) ).removeAttr( 'checked' ); |
  | 1809 | 1847 | } |
  | 1810 |  | ); |
  |  | 1848 | ); |
  | 1811 | 1849 |  |
  | 1812 | 1850 | // Remove Chosen elements |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1831) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1869) |  |
  | 1831 | 1869 | // Setup chosen fields again if they exist |
  | 1832 | 1870 | clone.find( '.tmem-select-chosen' ).chosen( |
  | 1833 |  | { |
  | 1834 |  | inherit\_select\_classes: true, |
  | 1835 |  | placeholder\_text\_multiple: tmem\_admin\_vars.select\_months |
  | 1836 |  | } |
  |  | 1871 | { |
  |  | 1872 | inherit\_select\_classes: true, |
  |  | 1873 | placeholder\_text\_multiple: tmem\_admin\_vars.select\_months |
  |  | 1874 | } |
  | 1837 | 1875 | ); |
  | 1838 | 1876 | clone.find( '.package-items' ).css( 'width', '100%' ); |
  | 1839 | 1877 | } |
  | 1840 |  | ); |
  |  | 1878 | ); |
  | 1841 | 1879 | }, |
  | 1842 | 1880 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1844) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1882) |  |
  | 1844 | 1882 |  |
  | 1845 | 1883 | $( '.tmem\_repeatable\_table tbody' ).sortable( |
  | 1846 |  | { |
  | 1847 |  | handle: '.tmem\_draghandle', items: '.tmem\_repeatable\_row', opacity: 0.6, cursor: 'move', axis: 'y', update: function() { |
  | 1848 |  | var count = 0; |
  | 1849 |  | $( this ).find( 'tr' ).each( |
  | 1850 |  | function() { |
  | 1851 |  | $( this ).find( 'input.tmem\_repeatable\_index' ).each( |
  | 1852 |  | function() { |
  | 1853 |  | $( this ).val( count ); |
  | 1854 |  | } |
  |  | 1884 | { |
  |  | 1885 | handle: '.tmem\_draghandle', items: '.tmem\_repeatable\_row', opacity: 0.6, cursor: 'move', axis: 'y', update: function() { |
  |  | 1886 | var count = 0; |
  |  | 1887 | $( this ).find( 'tr' ).each( |
  |  | 1888 | function() { |
  |  | 1889 | $( this ).find( 'input.tmem\_repeatable\_index' ).each( |
  |  | 1890 | function() { |
  |  | 1891 | $( this ).val( count ); |
  |  | 1892 | } |
  | 1855 | 1893 | ); |
  | 1856 |  | count++; |
  | 1857 |  | } |
  |  | 1894 | count++; |
  |  | 1895 | } |
  | 1858 | 1896 | ); |
  | 1859 |  | } |
  | 1860 |  | } |
  |  | 1897 | } |
  |  | 1898 | } |
  | 1861 | 1899 | ); |
  | 1862 | 1900 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1887) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1925) |  |
  | 1887 | 1925 | switch ( type ) { |
  | 1888 | 1926 | case 'price': |
  | 1889 |  | alert( tmem\_admin\_vars.one\_month\_min ); |
  | 1890 |  | break; |
  |  | 1927 | alert( tmem\_admin\_vars.one\_month\_min ); |
  |  | 1928 | break; |
  | 1891 | 1929 | case 'item': |
  | 1892 |  | alert( tmem\_admin\_vars.one\_item\_min ); |
  | 1893 |  | break; |
  |  | 1930 | alert( tmem\_admin\_vars.one\_item\_min ); |
  |  | 1931 | break; |
  | 1894 | 1932 | default: |
  | 1895 |  | alert( tmem\_admin\_vars.one\_month\_min ); |
  | 1896 |  | break; |
  |  | 1933 | alert( tmem\_admin\_vars.one\_month\_min ); |
  |  | 1934 | break; |
  | 1897 | 1935 | } |
  | 1898 | 1936 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1907) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1945) |  |
  | 1907 | 1945 | $( this ).attr( 'name', name ).attr( 'id', name ); |
  | 1908 | 1946 | } |
  | 1909 |  | ); |
  | 1910 |  | } |
  | 1911 |  | ); |
  | 1912 |  | } |
  | 1913 |  | ); |
  |  | 1947 | ); |
  |  | 1948 | } |
  |  | 1949 | ); |
  |  | 1950 | } |
  |  | 1951 | ); |
  | 1914 | 1952 | }, |
  | 1915 | 1953 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1921) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1959) |  |
  | 1921 | 1959 | $( '#tmem-package-month-selection' ).toggle( 'fast' ); |
  | 1922 | 1960 | } |
  | 1923 |  | ); |
  |  | 1961 | ); |
  | 1924 | 1962 |  |
  | 1925 | 1963 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1929) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1967) |  |
  | 1929 | 1967 | $( '#tmem-addon-month-selection' ).toggle( 'fast' ); |
  | 1930 | 1968 | } |
  | 1931 |  | ); |
  |  | 1969 | ); |
  | 1932 | 1970 |  |
  | 1933 | 1971 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1937) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1975) |  |
  | 1937 | 1975 | $( '#tmem-package-variable-price-fields' ).toggle( 'fast' ); |
  | 1938 | 1976 | } |
  | 1939 |  | ); |
  |  | 1977 | ); |
  | 1940 | 1978 |  |
  | 1941 | 1979 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1945) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1983) |  |
  | 1945 | 1983 | $( '#tmem-addon-variable-price-fields' ).toggle( 'fast' ); |
  | 1946 | 1984 | } |
  | 1947 |  | ); |
  |  | 1985 | ); |
  | 1948 | 1986 |  |
  | 1949 | 1987 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1954) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L1992) |  |
  | 1954 | 1992 | \* Communications screen JS |
  | 1955 | 1993 | \*/ |
  | 1956 |  | var TMEM\_Comms = { |
  | 1957 |  |  |
  | 1958 |  | init : function()   { |
  | 1959 |  | this.content(); |
  | 1960 |  | }, |
  | 1961 |  |  |
  | 1962 |  | content: function() { |
  |  | 1994 | var TMEM\_Comms = { |
  |  | 1995 |  |
  |  | 1996 | init : function()   { |
  |  | 1997 | this.content(); |
  |  | 1998 | }, |
  |  | 1999 |  |
  |  | 2000 | content: function() { |
  | 1963 | 2001 |  |
  | 1964 | 2002 | // Refresh the events list for the current recipient |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1970) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2008) |  |
  | 1970 | 2008 |  |
  | 1971 | 2009 | $.ajax( |
  |  | 2010 | { |
  |  | 2011 | type       : 'POST', |
  |  | 2012 | dataType   : 'json', |
  |  | 2013 | data       : postData, |
  |  | 2014 | url        : ajaxurl, |
  |  | 2015 | beforeSend : function() { |
  |  | 2016 | $( '#tmem\_email\_event' ).addClass( 'tmem-updating' ); |
  |  | 2017 | $( '#tmem\_email\_event' ).fadeTo( 'slow', 0.5 ); |
  |  | 2018 | }, |
  |  | 2019 | success: function (response) { |
  |  | 2020 | $( '#tmem\_email\_event' ).empty(); |
  |  | 2021 | $( '#tmem\_email\_event' ).append( response.event\_list ); |
  |  | 2022 | $( '#tmem\_email\_event' ).fadeTo( 'slow', 1 ); |
  |  | 2023 | $( '#tmem\_email\_event' ).removeClass( 'tmem-updating' ); |
  |  | 2024 | } |
  |  | 2025 | } |
  |  | 2026 | ).fail( |
  |  | 2027 | function (data) { |
  |  | 2028 | if ( window.console && window.console.log ) { |
  |  | 2029 | console.log( data ); |
  |  | 2030 | } |
  |  | 2031 | } |
  |  | 2032 | ); |
  |  | 2033 |  |
  |  | 2034 | }; |
  |  | 2035 |  |
  |  | 2036 | // Set initial event list when page loads |
  |  | 2037 | if ( tmem\_admin\_vars.load\_recipient ) { |
  |  | 2038 | $( '#tmem\_email\_to' ).val( tmem\_admin\_vars.load\_recipient ); |
  |  | 2039 | loadEvents( tmem\_admin\_vars.load\_recipient ); |
  |  | 2040 | } |
  |  | 2041 |  |
  |  | 2042 | // Update event list when recipient changes |
  |  | 2043 | $( document.body ).on( |
  |  | 2044 | 'change', |
  |  | 2045 | '#tmem\_email\_to', |
  |  | 2046 | function(event) { |
  |  | 2047 |  |
  |  | 2048 | event.preventDefault(); |
  |  | 2049 |  |
  |  | 2050 | var recipient = $( '#tmem\_email\_to' ).val(); |
  |  | 2051 | loadEvents( recipient ); |
  |  | 2052 |  |
  |  | 2053 | } |
  |  | 2054 | ); |
  |  | 2055 |  |
  |  | 2056 | // Update event list when recipient changes |
  |  | 2057 | $( document.body ).on( |
  |  | 2058 | 'change', |
  |  | 2059 | '#tmem\_email\_template', |
  |  | 2060 | function(event) { |
  |  | 2061 |  |
  |  | 2062 | event.preventDefault(); |
  |  | 2063 |  |
  |  | 2064 | var postData = { |
  |  | 2065 | template : $( '#tmem\_email\_template' ).val(), |
  |  | 2066 | action   : 'tmem\_set\_email\_content' |
  |  | 2067 | }; |
  |  | 2068 |  |
  |  | 2069 | $.ajax( |
  | 1972 | 2070 | { |
  | 1973 | 2071 | type       : 'POST', |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1976) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2074) |  |
  | 1976 | 2074 | url        : ajaxurl, |
  | 1977 | 2075 | beforeSend : function() { |
  | 1978 |  | $( '#tmem\_email\_event' ).addClass( 'tmem-updating' ); |
  | 1979 |  | $( '#tmem\_email\_event' ).fadeTo( 'slow', 0.5 ); |
  |  | 2076 | $( '#tmem\_email\_subject' ).addClass( 'tmem-updating' ); |
  |  | 2077 | $( '#tmem\_email\_subject' ).fadeTo( 'slow', 0.5 ); |
  |  | 2078 | $( '#tmem\_email\_content' ).addClass( 'tmem-updating' ); |
  |  | 2079 | $( '#tmem\_email\_content' ).fadeTo( 'slow', 0.5 ); |
  |  | 2080 | $( '#tmem\_email\_template' ).addClass( 'tmem-updating' ); |
  |  | 2081 | $( '#tmem\_email\_template' ).fadeTo( 'slow', 0.5 ); |
  |  | 2082 | tinymce.execCommand( 'mceToggleEditor',false,'tmem\_email\_content' ); |
  | 1980 | 2083 | }, |
  | 1981 | 2084 | success: function (response) { |
  | 1982 |  | $( '#tmem\_email\_event' ).empty(); |
  | 1983 |  | $( '#tmem\_email\_event' ).append( response.event\_list ); |
  | 1984 |  | $( '#tmem\_email\_event' ).fadeTo( 'slow', 1 ); |
  | 1985 |  | $( '#tmem\_email\_event' ).removeClass( 'tmem-updating' ); |
  | 1986 |  | } |
  | 1987 |  | } |
  | 1988 |  | ).fail( |
  |  | 2085 | if (response.type === 'success') { |
  |  | 2086 | $( '#tmem\_email\_content' ).empty(); |
  |  | 2087 | tinyMCE.activeEditor.setContent( '' ); |
  |  | 2088 | $( '#tmem\_email\_subject' ).val( response.updated\_subject ); |
  |  | 2089 | tinyMCE.activeEditor.setContent( response.updated\_content ); |
  |  | 2090 | $( '#tmem\_email\_content' ).val( response.updated\_content ); |
  |  | 2091 | } else { |
  |  | 2092 | alert( response.msg ); |
  |  | 2093 | } |
  |  | 2094 | $( '#tmem\_email\_subject' ).fadeTo( 'slow', 1 ); |
  |  | 2095 | $( '#tmem\_email\_subject' ).removeClass( 'tmem-updating' ); |
  |  | 2096 | $( '#tmem\_email\_content' ).fadeTo( 'slow', 1 ); |
  |  | 2097 | $( '#tmem\_email\_content' ).removeClass( 'tmem-updating' ); |
  |  | 2098 | $( '#tmem\_email\_template' ).removeClass( 'tmem-updating' ); |
  |  | 2099 | $( '#tmem\_email\_template' ).fadeTo( 'slow', 1 ); |
  |  | 2100 | tinymce.execCommand( 'mceToggleEditor',false,'tmem\_email\_content' ); |
  |  | 2101 | } |
  |  | 2102 | } |
  |  | 2103 | ).fail( |
  | 1989 | 2104 | function (data) { |
  | 1990 | 2105 | if ( window.console && window.console.log ) { |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L1992) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2107) |  |
  | 1992 | 2107 | } |
  | 1993 | 2108 | } |
  | 1994 |  | ~~);~~ |
  | 1995 |  |  |
  | 1996 |  | ~~};~~ |
  | 1997 |  |  |
  | 1998 |  | ~~// Set initial event list when page loads~~ |
  | 1999 |  | ~~if ( tmem\_admin\_vars.load\_recipient ) {~~ |
  | 2000 |  | ~~$( '#tmem\_email\_to' ).val( tmem\_admin\_vars.load\_recipient );~~ |
  | 2001 |  | ~~loadEvents( tmem\_admin\_vars.load\_recipient );~~ |
  | 2002 |  | ~~}~~ |
  | 2003 |  |  |
  | 2004 |  | ~~// Update event list when recipient changes~~ |
  | 2005 |  | ~~$( document.body ).on(~~ |
  | 2006 |  | ~~'change',~~ |
  | 2007 |  | ~~'#tmem\_email\_to',~~ |
  | 2008 |  | ~~function(event) {~~ |
  | 2009 |  |  |
  | 2010 |  | ~~event.preventDefault();~~ |
  | 2011 |  |  |
  | 2012 |  | ~~var recipient = $( '#tmem\_email\_to' ).val();~~ |
  | 2013 |  | ~~loadEvents( recipient );~~ |
  | 2014 |  |  |
  | 2015 |  | ~~}~~ |
  | 2016 |  | ~~);~~ |
  | 2017 |  |  |
  | 2018 |  | ~~// Update event list when recipient changes~~ |
  | 2019 |  | ~~$( document.body ).on(~~ |
  | 2020 |  | ~~'change',~~ |
  | 2021 |  | ~~'#tmem\_email\_template',~~ |
  | 2022 |  | ~~function(event) {~~ |
  | 2023 |  |  |
  | 2024 |  | ~~event.preventDefault();~~ |
  | 2025 |  |  |
  | 2026 |  | ~~var postData = {~~ |
  | 2027 |  | ~~template : $( '#tmem\_email\_template' ).val(),~~ |
  | 2028 |  | ~~action   : 'tmem\_set\_email\_content'~~ |
  | 2029 |  | ~~};~~ |
  | 2030 |  |  |
  | 2031 |  | ~~$.ajax(~~ |
  | 2032 |  | ~~{~~ |
  | 2033 |  | ~~type       : 'POST',~~ |
  | 2034 |  | ~~dataType   : 'json',~~ |
  | 2035 |  | ~~data       : postData,~~ |
  | 2036 |  | ~~url        : ajaxurl,~~ |
  | 2037 |  | ~~beforeSend : function() {~~ |
  | 2038 |  | ~~$( '#tmem\_email\_subject' ).addClass( 'tmem-updating' );~~ |
  | 2039 |  | ~~$( '#tmem\_email\_subject' ).fadeTo( 'slow', 0.5 );~~ |
  | 2040 |  | ~~$( '#tmem\_email\_content' ).addClass( 'tmem-updating' );~~ |
  | 2041 |  | ~~$( '#tmem\_email\_content' ).fadeTo( 'slow', 0.5 );~~ |
  | 2042 |  | ~~$( '#tmem\_email\_template' ).addClass( 'tmem-updating' );~~ |
  | 2043 |  | ~~$( '#tmem\_email\_template' ).fadeTo( 'slow', 0.5 );~~ |
  | 2044 |  | ~~tinymce.execCommand( 'mceToggleEditor',false,'tmem\_email\_content' );~~ |
  | 2045 |  | ~~},~~ |
  | 2046 |  | ~~success: function (response) {~~ |
  | 2047 |  | ~~if (response.type === 'success') {~~ |
  | 2048 |  | ~~$( '#tmem\_email\_content' ).empty();~~ |
  | 2049 |  | ~~tinyMCE.activeEditor.setContent( '' );~~ |
  | 2050 |  | ~~$( '#tmem\_email\_subject' ).val( response.updated\_subject );~~ |
  | 2051 |  | ~~tinyMCE.activeEditor.setContent( response.updated\_content );~~ |
  | 2052 |  | ~~$( '#tmem\_email\_content' ).val( response.updated\_content );~~ |
  | 2053 |  | ~~} else {~~ |
  | 2054 |  | ~~alert( response.msg );~~ |
  | 2055 |  | ~~}~~ |
  | 2056 |  | ~~$( '#tmem\_email\_subject' ).fadeTo( 'slow', 1 );~~ |
  | 2057 |  | ~~$( '#tmem\_email\_subject' ).removeClass( 'tmem-updating' );~~ |
  | 2058 |  | ~~$( '#tmem\_email\_content' ).fadeTo( 'slow', 1 );~~ |
  | 2059 |  | ~~$( '#tmem\_email\_content' ).removeClass( 'tmem-updating' );~~ |
  | 2060 |  | ~~$( '#tmem\_email\_template' ).removeClass( 'tmem-updating' );~~ |
  | 2061 |  | ~~$( '#tmem\_email\_template' ).fadeTo( 'slow', 1 );~~ |
  | 2062 |  | ~~tinymce.execCommand( 'mceToggleEditor',false,'tmem\_email\_content' );~~ |
  | 2063 |  | ~~}~~ |
  | 2064 |  | ~~}~~ |
  | 2065 |  | ~~).fail(~~ |
  | 2066 |  | ~~function (data) {~~ |
  | 2067 |  | ~~if ( window.console && window.console.log ) {~~ |
  | 2068 |  | ~~console.log( data );~~ |
  | 2069 |  | ~~}~~ |
  | 2070 |  | ~~}~~ |
  | 2071 | 2109 | ); |
  | 2072 | 2110 |  |
  | 2073 | 2111 | } |
  | 2074 |  | ); |
  |  | 2112 | ); |
  | 2075 | 2113 |  |
  | 2076 | 2114 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2082) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2120) |  |
  | 2082 | 2120 | \* Tasks screen JS |
  | 2083 | 2121 | \*/ |
  | 2084 |  | var TMEM\_Tasks = { |
  | 2085 |  |  |
  | 2086 |  | init : function()   { |
  | 2087 |  | this.template\_select(); |
  | 2088 |  | }, |
  | 2089 |  |  |
  | 2090 |  | template\_select: function() { |
  |  | 2122 | var TMEM\_Tasks = { |
  |  | 2123 |  |
  |  | 2124 | init : function()   { |
  |  | 2125 | this.template\_select(); |
  |  | 2126 | }, |
  |  | 2127 |  |
  |  | 2128 | template\_select: function() { |
  | 2091 | 2129 | // Update event list when recipient changes |
  | 2092 | 2130 | $( document.body ).on( |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2102) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2140) |  |
  | 2102 | 2140 |  |
  | 2103 | 2141 | $.ajax( |
  | 2104 |  | { |
  | 2105 |  | type       : 'POST', |
  | 2106 |  | dataType   : 'json', |
  | 2107 |  | data       : postData, |
  | 2108 |  | url        : ajaxurl, |
  | 2109 |  | beforeSend : function() { |
  | 2110 |  | $( '#tmem-task-email-subject' ).addClass( 'tmem-updating' ); |
  | 2111 |  | $( '#tmem-task-email-subject' ).fadeTo( 'slow', 0.5 ); |
  | 2112 |  | }, |
  | 2113 |  | success: function (response) { |
  | 2114 |  | if (response.title) { |
  | 2115 |  | $( '#tmem-task-email-subject' ).val( response.title ); |
  | 2116 |  | } |
  | 2117 |  | $( '#tmem-task-email-subject' ).fadeTo( 'slow', 1 ); |
  | 2118 |  | $( '#tmem-task-email-subject' ).removeClass( 'tmem-updating' ); |
  | 2119 |  | } |
  | 2120 |  | } |
  |  | 2142 | { |
  |  | 2143 | type       : 'POST', |
  |  | 2144 | dataType   : 'json', |
  |  | 2145 | data       : postData, |
  |  | 2146 | url        : ajaxurl, |
  |  | 2147 | beforeSend : function() { |
  |  | 2148 | $( '#tmem-task-email-subject' ).addClass( 'tmem-updating' ); |
  |  | 2149 | $( '#tmem-task-email-subject' ).fadeTo( 'slow', 0.5 ); |
  |  | 2150 | }, |
  |  | 2151 | success: function (response) { |
  |  | 2152 | if (response.title) { |
  |  | 2153 | $( '#tmem-task-email-subject' ).val( response.title ); |
  |  | 2154 | } |
  |  | 2155 | $( '#tmem-task-email-subject' ).fadeTo( 'slow', 1 ); |
  |  | 2156 | $( '#tmem-task-email-subject' ).removeClass( 'tmem-updating' ); |
  |  | 2157 | } |
  |  | 2158 | } |
  | 2121 | 2159 | ).fail( |
  | 2122 |  | function (data) { |
  | 2123 |  | if ( window.console && window.console.log ) { |
  | 2124 |  | console.log( data ); |
  | 2125 |  | } |
  | 2126 |  | } |
  |  | 2160 | function (data) { |
  |  | 2161 | if ( window.console && window.console.log ) { |
  |  | 2162 | console.log( data ); |
  |  | 2163 | } |
  |  | 2164 | } |
  | 2127 | 2165 | ); |
  | 2128 | 2166 |  |
  | 2129 | 2167 | } |
  | 2130 |  | ); |
  |  | 2168 | ); |
  | 2131 | 2169 | } |
  | 2132 | 2170 | }; |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2136) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2174) |  |
  | 2136 | 2174 | \* Reports / Exports screen JS |
  | 2137 | 2175 | \*/ |
  | 2138 |  | var TMEM\_Reports = { |
  | 2139 |  |  |
  | 2140 |  | init : function() { |
  | 2141 |  | this.date\_options(); |
  | 2142 |  | }, |
  | 2143 |  |  |
  | 2144 |  | date\_options : function() { |
  |  | 2176 | var TMEM\_Reports = { |
  |  | 2177 |  |
  |  | 2178 | init : function() { |
  |  | 2179 | this.date\_options(); |
  |  | 2180 | }, |
  |  | 2181 |  |
  |  | 2182 | date\_options : function() { |
  | 2145 | 2183 |  |
  | 2146 | 2184 | // Show hide extended date options |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2151) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2189) |  |
  | 2151 | 2189 |  |
  | 2152 | 2190 | if ( 'other' === $this.val() ) { |
  | 2153 |  | date\_range\_options.show(); |
  |  | 2191 | date\_range\_options.show(); |
  | 2154 | 2192 | } else { |
  | 2155 | 2193 | date\_range\_options.hide(); |
  | 2156 | 2194 | } |
  | 2157 | 2195 | } |
  | 2158 |  | ); |
  |  | 2196 | ); |
  | 2159 | 2197 |  |
  | 2160 | 2198 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2166) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2204) |  |
  | 2166 | 2204 | \* Export screen JS |
  | 2167 | 2205 | \*/ |
  | 2168 |  | var TMEM\_Export = { |
  | 2169 |  |  |
  | 2170 |  | init : function() { |
  | 2171 |  | this.submit(); |
  | 2172 |  | this.dismiss\_message(); |
  | 2173 |  | }, |
  | 2174 |  |  |
  | 2175 |  | submit : function() { |
  | 2176 |  |  |
  | 2177 |  | var self = this; |
  | 2178 |  |  |
  | 2179 |  | $( document.body ).on( |
  | 2180 |  | 'submit', |
  | 2181 |  | '.tmem-export-form', |
  | 2182 |  | function(e) { |
  | 2183 |  | e.preventDefault(); |
  | 2184 |  |  |
  | 2185 |  | var submitButton = $( this ).find( 'input[type="submit"]' ); |
  | 2186 |  |  |
  | 2187 |  | if ( ! submitButton.hasClass( 'button-disabled' ) ) { |
  | 2188 |  |  |
  | 2189 |  | var data = $( this ).serialize(); |
  | 2190 |  |  |
  | 2191 |  | submitButton.addClass( 'button-disabled' ); |
  | 2192 |  | $( this ).find( '.notice-wrap' ).remove(); |
  | 2193 |  | $( this ).append( '<div class="notice-wrap"><span class="spinner is-active"></span><div class="tmem-progress"><div></div></div></div>' ); |
  |  | 2206 | var TMEM\_Export = { |
  |  | 2207 |  |
  |  | 2208 | init : function() { |
  |  | 2209 | this.submit(); |
  |  | 2210 | this.dismiss\_message(); |
  |  | 2211 | }, |
  |  | 2212 |  |
  |  | 2213 | submit : function() { |
  |  | 2214 |  |
  |  | 2215 | var self = this; |
  |  | 2216 |  |
  |  | 2217 | $( document.body ).on( |
  |  | 2218 | 'submit', |
  |  | 2219 | '.tmem-export-form', |
  |  | 2220 | function(e) { |
  |  | 2221 | e.preventDefault(); |
  |  | 2222 |  |
  |  | 2223 | var submitButton = $( this ).find( 'input[type="submit"]' ); |
  |  | 2224 |  |
  |  | 2225 | if ( ! submitButton.hasClass( 'button-disabled' ) ) { |
  |  | 2226 |  |
  |  | 2227 | var data = $( this ).serialize(); |
  |  | 2228 |  |
  |  | 2229 | submitButton.addClass( 'button-disabled' ); |
  |  | 2230 | $( this ).find( '.notice-wrap' ).remove(); |
  |  | 2231 | $( this ).append( '<div class="notice-wrap"><span class="spinner is-active"></span><div class="tmem-progress"><div></div></div></div>' ); |
  | 2194 | 2232 |  |
  | 2195 | 2233 | // start the process |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2199) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2237) |  |
  | 2199 | 2237 |  |
  | 2200 | 2238 | } |
  | 2201 |  | ); |
  | 2202 |  | }, |
  | 2203 |  |  |
  | 2204 |  | process\_step : function( step, data, self ) { |
  | 2205 |  |  |
  | 2206 |  | $.ajax( |
  | 2207 |  | { |
  | 2208 |  | type: 'POST', |
  | 2209 |  | url: ajaxurl, |
  | 2210 |  | data: { |
  | 2211 |  | form: data, |
  | 2212 |  | action: 'tmem\_do\_ajax\_export', |
  | 2213 |  | step: step, |
  | 2214 |  | }, |
  | 2215 |  | dataType: 'json', |
  | 2216 |  | success: function( response ) { |
  | 2217 |  | if ( 'done' === response.step || response.error || response.success ) { |
  |  | 2239 | ); |
  |  | 2240 | }, |
  |  | 2241 |  |
  |  | 2242 | process\_step : function( step, data, self ) { |
  |  | 2243 |  |
  |  | 2244 | $.ajax( |
  |  | 2245 | { |
  |  | 2246 | type: 'POST', |
  |  | 2247 | url: ajaxurl, |
  |  | 2248 | data: { |
  |  | 2249 | form: data, |
  |  | 2250 | action: 'tmem\_do\_ajax\_export', |
  |  | 2251 | step: step, |
  |  | 2252 | }, |
  |  | 2253 | dataType: 'json', |
  |  | 2254 | success: function( response ) { |
  |  | 2255 | if ( 'done' === response.step || response.error || response.success ) { |
  | 2218 | 2256 |  |
  | 2219 | 2257 | // We need to get the actual in progress form, not all forms on the page |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2242) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2280) |  |
  | 2242 | 2280 | } else { |
  | 2243 | 2281 | $( '.tmem-progress div' ).animate( |
  | 2244 |  | { |
  | 2245 |  | width: response.percentage + '%', |
  | 2246 |  | }, |
  | 2247 |  | 50, |
  | 2248 |  | function() { |
  |  | 2282 | { |
  |  | 2283 | width: response.percentage + '%', |
  |  | 2284 | }, |
  |  | 2285 | 50, |
  |  | 2286 | function() { |
  | 2249 | 2287 | // Animation complete. |
  | 2250 | 2288 | } |
  | 2251 |  | ); |
  |  | 2289 | ); |
  | 2252 | 2290 | self.process\_step( parseInt( response.step ), data, self ); |
  | 2253 | 2291 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2255) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2293) |  |
  | 2255 | 2293 | } |
  | 2256 | 2294 | } |
  | 2257 |  | ).fail( |
  |  | 2295 | ).fail( |
  | 2258 | 2296 | function (response) { |
  | 2259 | 2297 | if ( window.console && window.console.log ) { |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2261) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2299) |  |
  | 2261 | 2299 | } |
  | 2262 | 2300 | } |
  | 2263 |  | ); |
  | 2264 |  |  |
  | 2265 |  | }, |
  | 2266 |  |  |
  | 2267 |  | dismiss\_message : function() { |
  | 2268 |  | $( 'body' ).on( |
  | 2269 |  | 'click', |
  | 2270 |  | '#tmem-batch-success .notice-dismiss', |
  | 2271 |  | function() { |
  | 2272 |  | $( '#tmem-batch-success' ).parent().slideUp( 'fast' ); |
  | 2273 |  | } |
  | 2274 |  | ); |
  | 2275 |  | } |
  | 2276 |  |  |
  | 2277 |  | }; |
  | 2278 |  | TMEM\_Export.init(); |
  | 2279 |  |  |
  | 2280 |  | function refreshEventVenueDetails() { |
  |  | 2301 | ); |
  |  | 2302 |  |
  |  | 2303 | }, |
  |  | 2304 |  |
  |  | 2305 | dismiss\_message : function() { |
  |  | 2306 | $( 'body' ).on( |
  |  | 2307 | 'click', |
  |  | 2308 | '#tmem-batch-success .notice-dismiss', |
  |  | 2309 | function() { |
  |  | 2310 | $( '#tmem-batch-success' ).parent().slideUp( 'fast' ); |
  |  | 2311 | } |
  |  | 2312 | ); |
  |  | 2313 | } |
  |  | 2314 |  |
  |  | 2315 | }; |
  |  | 2316 | TMEM\_Export.init(); |
  |  | 2317 |  |
  |  | 2318 | function refreshEventVenueDetails() { |
  | 2281 | 2319 | // Update the venue details when the venue selection changes |
  | 2282 | 2320 | if ( 'manual' === $( '#venue\_id' ).val() || 'client' === $( '#venue\_id' ).val() ) { |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2294) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2332) |  |
  | 2294 | 2332 |  |
  | 2295 | 2333 | $.ajax( |
  | 2296 |  | { |
  | 2297 |  | type       : 'POST', |
  | 2298 |  | dataType   : 'json', |
  | 2299 |  | data       : postData, |
  | 2300 |  | url        : ajaxurl, |
  | 2301 |  | success: function (response) { |
  | 2302 |  | $( '#tmem-venue-details-fields' ).html( response.data.venue ); |
  | 2303 |  | $( '.tmem-event-venue-details-sections-wrap' ).show( 'fast' ); |
  | 2304 |  |  |
  | 2305 |  | var show = $( '.toggle-event-view-venue-option-section' ).html() === tmem\_admin\_vars.show\_venue\_details ? true : false; |
  | 2306 |  |  |
  | 2307 |  | if ( show ) { |
  | 2308 |  | $( '.toggle-event-view-venue-option-section' ).html( tmem\_admin\_vars.hide\_venue\_details ); |
  | 2309 |  | } |
  | 2310 |  |  |
  | 2311 |  | } |
  | 2312 |  | } |
  |  | 2334 | { |
  |  | 2335 | type       : 'POST', |
  |  | 2336 | dataType   : 'json', |
  |  | 2337 | data       : postData, |
  |  | 2338 | url        : ajaxurl, |
  |  | 2339 | success: function (response) { |
  |  | 2340 | $( '#tmem-venue-details-fields' ).html( response.data.venue ); |
  |  | 2341 | $( '.tmem-event-venue-details-sections-wrap' ).show( 'fast' ); |
  |  | 2342 |  |
  |  | 2343 | var show = $( '.toggle-event-view-venue-option-section' ).html() === tmem\_admin\_vars.show\_venue\_details ? true : false; |
  |  | 2344 |  |
  |  | 2345 | if ( show ) { |
  |  | 2346 | $( '.toggle-event-view-venue-option-section' ).html( tmem\_admin\_vars.hide\_venue\_details ); |
  |  | 2347 | } |
  |  | 2348 |  |
  |  | 2349 | } |
  |  | 2350 | } |
  | 2313 | 2351 | ).fail( |
  | 2314 |  | function (data) { |
  | 2315 |  | if ( window.console && window.console.log ) { |
  | 2316 |  | console.log( data ); |
  | 2317 |  | } |
  | 2318 |  | } |
  |  | 2352 | function (data) { |
  |  | 2353 | if ( window.console && window.console.log ) { |
  |  | 2354 | console.log( data ); |
  |  | 2355 | } |
  |  | 2356 | } |
  | 2319 | 2357 | ); |
  | 2320 | 2358 | setTravelData(); |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2329) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2367) |  |
  | 2329 | 2367 | if ( 'tmem-event\_page\_tmem-comms' === tmem\_admin\_vars.current\_page ) { |
  | 2330 | 2368 | $( '#tmem\_form\_send\_comms' ).validate( |
  | 2331 |  | { |
  | 2332 |  | errorClass: 'tmem-form-error', |
  | 2333 |  | validClass: 'tmem-form-valid', |
  | 2334 |  | focusInvalid: false, |
  | 2335 |  |  |
  | 2336 |  | rules:  { |
  | 2337 |  | }, |
  | 2338 |  |  |
  | 2339 |  | messages:   { |
  | 2340 |  | tmem\_email\_to      : null, |
  | 2341 |  | tmem\_email\_subject : null, |
  | 2342 |  | tmem\_email\_content : null |
  | 2343 |  | } |
  |  | 2369 | { |
  |  | 2370 | errorClass: 'tmem-form-error', |
  |  | 2371 | validClass: 'tmem-form-valid', |
  |  | 2372 | focusInvalid: false, |
  |  | 2373 |  |
  |  | 2374 | rules:  { |
  |  | 2375 | }, |
  |  | 2376 |  |
  |  | 2377 | messages:   { |
  |  | 2378 | tmem\_email\_to      : null, |
  |  | 2379 | tmem\_email\_subject : null, |
  |  | 2380 | tmem\_email\_content : null |
  | 2344 | 2381 | } |
  |  | 2382 | } |
  | 2345 | 2383 | ); |
  | 2346 | 2384 | } |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2349) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2387) |  |
  | 2349 | 2387 | if ( tmem\_admin\_vars.editing\_event ) { |
  | 2350 | 2388 | $( '#post' ).validate( |
  | 2351 |  | { |
  | 2352 |  | errorClass: 'tmem-form-error', |
  | 2353 |  | validClass: 'tmem-form-valid', |
  | 2354 |  | focusInvalid: false, |
  | 2355 |  |  |
  | 2356 |  | rules:  { |
  | 2357 |  | client\_name : { required: true, minlength : 1 }, |
  | 2358 |  | display\_event\_date : { required: true }, |
  | 2359 |  | \_tmem\_event\_cost   : { |
  | 2360 |  | number: true |
  | 2361 |  | }, |
  | 2362 |  | \_tmem\_event\_deposit : { number: true } |
  |  | 2389 | { |
  |  | 2390 | errorClass: 'tmem-form-error', |
  |  | 2391 | validClass: 'tmem-form-valid', |
  |  | 2392 | focusInvalid: false, |
  |  | 2393 |  |
  |  | 2394 | rules:  { |
  |  | 2395 | client\_name : { required: true, minlength : 1 }, |
  |  | 2396 | display\_event\_date : { required: true }, |
  |  | 2397 | \_tmem\_event\_cost   : { |
  |  | 2398 | number: true |
  | 2363 | 2399 | }, |
  | 2364 |  |  |
  | 2365 |  | messages:   { |
  | 2366 |  | client\_name      : null, |
  | 2367 |  | display\_event\_date : null, |
  | 2368 |  | \_tmem\_event\_cost : null, |
  | 2369 |  | \_tmem\_event\_deposit : null |
  | 2370 |  | } |
  |  | 2400 | \_tmem\_event\_deposit : { number: true } |
  |  | 2401 | }, |
  |  | 2402 |  |
  |  | 2403 | messages:   { |
  |  | 2404 | client\_name      : null, |
  |  | 2405 | display\_event\_date : null, |
  |  | 2406 | \_tmem\_event\_cost : null, |
  |  | 2407 | \_tmem\_event\_deposit : null |
  | 2371 | 2408 | } |
  |  | 2409 | } |
  | 2372 | 2410 | ); |
  | 2373 | 2411 |  |
  | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2455787#L2380) | […](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.js?rev=2647987#L2418) |  |
  | 2380 | 2418 | } |
  | 2381 | 2419 | } |
  | 2382 |  | ); |
  |  | 2420 | ); |
  | 2383 | 2421 | } |
  | 2384 | 2422 |  |
  | 2385 | 2423 | } |
  | 2386 |  | ); |
  |  | 2424 | ); |
  | 2387 | 2425 |  |
  | 2388 | 2426 | var tmemFormatCurrency = function (value) { |
* ## [mobile-events-manager/trunk/assets/js/admin-scripts.min.js](/changeset/2647987/mobile-events-manager/trunk/assets/js/admin-scripts.min.js "Show the changeset 2647987 restricted to mobile-events-manager/trunk/assets/js/admin-scripts.min.js")

  | [r2625441](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.min.js?rev=2625441#L1 "Show revision 2625441 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/assets/js/admin-scripts.min.js?rev=2647987#L1 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | var tmem\_admin\_vars;jQuery(document).ready(function(a){function b(){if("manual"===a("#venue\_id").val()||"client"===a("#venue\_id").val())a(".tmem-event-venue-details-sections-wrap").hide("fast"),a(".tmem-add-event-venue-sections-wrap").show("fast");else{a(".tmem-add-event-venue-sections-wrap").hide("fast");var b={venue\_id:a("#venue\_id").val(),event\_id:a("#post\_ID").val(),action:"tmem\_refresh\_venue\_details"};a.ajax({type:"POST",dataType:"json",data:b,url:ajaxurl,success:function(b){a("#tmem-venue-details-fields").html(b.data.venue),a(".tmem-event-venue-details-sections-wrap").show("fast");var c=a(".toggle-event-view-venue-option-section").html()===tmem\_admin\_vars.show\_venue\_details;c&&a(".toggle-event-view-venue-option-section").html(tmem\_admin\_vars.hide\_venue\_details)}}).fail(function(a){window.console&&window.console.log&&console.log(a)}),e()}a("#\_tmem\_event\_package").trigger("change")}a(".tmem-select-chosen").chosen({inherit\_select\_classes:!0,placeholder\_text\_single:tmem\_admin\_vars.one\_option,placeholder\_text\_multiple:tmem\_admin\_vars.one\_or\_more\_option}),a(".tmem-select-chosen .chosen-search input").each(function(){var b=a(this).parent().parent().parent().prev("select.tmem-select-chosen"),c=b.data("search-placeholder");a(this).attr("placeholder",c)}),a(".chosen-choices").on("click",function(){var b=a(this).parent().prev().data("search-placeholder");"undefined"==typeof b&&(b=tmem\_admin\_vars.type\_to\_search),a(this).children("li").children("input").attr("placeholder",b)}),a(document).on("click",".notice-tmem-dismiss .notice-dismiss",function(){var b=a(this).closest(".notice-tmem-dismiss").data("notice"),c={notice:b,action:"tmem\_dismiss\_notice"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl})});var c=function(){var b=a("#\_tmem\_event\_deposit").val(),c={current\_cost:a("#\_tmem\_event\_cost").val(),action:"update\_event\_deposit"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#\_tmem\_event\_deposit").attr("readonly",!0),a("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(c){"success"===c.type?a("#\_tmem\_event\_deposit").val(c.deposit):(alert(c.msg),a("#\_tmem\_event\_deposit").val(b)),a("#tmem-event-pricing-detail").removeClass("tmem-mute"),a("#\_tmem\_event\_deposit").attr("readonly",!1)}}).fail(function(c){window.console&&window.console.log&&console.log(c),a("#\_tmem\_event\_deposit").val(b)})},d=function(){var b,d=a("#\_tmem\_event\_cost").val();b="manual"===a("#venue\_id").val()||"client"===a("#venue\_id").val()?[a("#venue\_address1").val(),a("#venue\_address2").val(),a("#venue\_town").val(),a("#venue\_county").val(),a("#venue\_postcode").val()]:a("#venue\_id").val();var e={addons:a("#event\_addons").val()||[],package:a("#\_tmem\_event\_package option:selected").val(),event\_id:a("#post\_ID").val(),current\_cost:a("#\_tmem\_event\_cost").val(),event\_date:a("#\_tmem\_event\_date").val(),venue:b,employee\_id:a("#\_tmem\_event\_dj").val(),additional:a("#\_tmem\_event\_additional\_cost").val(),discount:a("#\_tmem\_event\_discount").val(),action:"tmem\_update\_event\_cost"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(b){if("success"===b.type){a("#\_tmem\_event\_package\_cost").val(b.package\_cost),a("#\_tmem\_event\_addons\_cost").val(b.addons\_cost),a("#\_tmem\_event\_travel\_cost").val(b.travel\_cost),a("#\_tmem\_event\_additional\_cost").val(b.additional\_cost),a("#\_tmem\_event\_discount").val(b.discount);var e=Number(b.package\_cost)+Number(b.addons\_cost)+Number(b.travel\_cost)+Number(b.additional\_cost);e=Number(e)-Number(b.discount),e=e.toFixed(2),a("#\_tmem\_event\_cost").val(e),tmem\_admin\_vars.update\_deposit&&c()}else a("#\_tmem\_event\_cost").val(d);a("#tmem-event-pricing-detail").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},e=function(){var b;b="manual"===a("#venue\_id").val()||"client"===a("#venue\_id").val()?[a("#venue\_address1").val(),a("#venue\_address2").val(),a("#venue\_town").val(),a("#venue\_county").val(),a("#venue\_postcode").val()]:a("#venue\_id").val();var c={employee\_id:a("#\_tmem\_event\_dj").val(),venue:b,action:"tmem\_update\_travel\_data"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){"success"===b.type?(a(".tmem-travel-distance").parents("tr").show(),a(".tmem-travel-directions").parents("tr").show(),a(".tmem-travel-distance").html(b.distance),a(".tmem-travel-time").html(b.time),a(".tmem-travel-cost").html(b.cost),a("#travel\_directions").attr("href",b.directions\_url),a("#tmem\_travel\_distance").val(b.distance),a("#tmem\_travel\_time").val(b.time),a("#tmem\_travel\_cost").val(b.raw\_cost),a("#tmem\_travel\_directions\_url").val(b.directions\_url)):(a(".tmem-travel-distance").parents("tr").hide(),a("#travel-directions").attr("href",""),a(".tmem-travel-directions").parents("tr").hide(),a("#tmem\_travel\_distance").val(""),a("#tmem\_travel\_time").val(""),a("#tmem\_travel\_cost").val(""),a("#tmem\_travel\_directions\_url").val(""))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},f={init:function(){this.general(),"admin\_page\_tmem-custom-event-fields"!==tmem\_admin\_vars.current\_page&&"admin\_page\_tmem-custom-client-fields"!==tmem\_admin\_vars.current\_page||this.custom\_fields()},general:function(){var b=a(".tmem-color-picker");b.length&&b.wpColorPicker()},custom\_fields:function(){jQuery(document).ready(function(a){a(".tmem-client-list-item").sortable({handle:".tmem\_draghandle",items:".tmem\_sortable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize",{expression:/(.+)=(.+)/})+"&action=tmem\_update\_client\_field\_order";a.post(ajaxurl,b,function(){})}})}),a(".tmem-custom-client-list-item,.tmem-custom-event-list-item,.tmem-custom-venue-list-item").sortable({handle:".tmem\_draghandle",items:".tmem\_sortable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize")+"&action=order\_custom\_event\_fields";a.post(ajaxurl,b,function(){})}})}};f.init();var g={init:function(){this.options(),this.absence(),this.checker()},options:function(){a(document.body).on("click",".toggle-availability-checker-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_avail\_form;c?a(this).html(tmem\_admin\_vars.hide\_avail\_form):a(this).html(tmem\_admin\_vars.show\_avail\_form),a(".tmem-availability-checker-fields").slideToggle()}),a(document.body).on("click",".toggle-add-absence-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_absence\_form;c?a(this).html(tmem\_admin\_vars.hide\_absence\_form):a(this).html(tmem\_admin\_vars.show\_absence\_form);var d=a(this).parents(".tmem-availability-row-header");d.siblings(".tmem-availability-add-absence-sections-wrap").slideToggle(),a("#absence\_all\_day").is(":checked")&&(a(".tmem-absence-start-time-option").hide("fast"),a(".tmem-absence-end-time-option").hide("fast"));var e;e=c?a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-availability-add-absence-sections-wrap")):a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus()}),a(document.body).on("change","#absence\_all\_day",function(){a(".tmem-absence-start-time-option").slideToggle(),a(".tmem-absence-end-time-option").slideToggle()})},absence:function(){a(document.body).on("click","#add-absence",function(b){b.preventDefault();var c=a("#absence\_employee\_id").val(),d=a("#absence\_start").val(),e=a("#absence\_end").val(),f=a("#absence\_all\_day").is(":checked")?1:0,g=a("#absence\_start\_time\_hr").val(),h=a("#absence\_start\_time\_min").val(),i=0,j=a("#absence\_end\_time\_hr").val(),k=a("#absence\_end\_time\_min").val(),l=0,m=a("#absence\_notes").val();if("H:i"!==tmem\_admin\_vars.time\_format&&(i=a("#absence\_start\_time\_period").val(),l=a("#absence\_end\_time\_period").val()),!d)return void a("#display\_absence\_start").addClass("tmem-form-error");if(!e)return void a("#display\_absence\_end").addClass("tmem-form-error");var n={employee\_id:c,start\_date:d,end\_date:e,all\_day:f,start\_time\_hr:g,start\_time\_min:h,start\_time\_period:i,end\_time\_hr:j,end\_time\_min:k,end\_time\_period:l,notes:m,action:"tmem\_add\_employee\_absence"};a.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){a("#tmem-add-absence-fields").addClass("tmem-mute")},success:function(b){!0===b.success&&(a("#tmem-calendar").fullCalendar("refetchEvents"),a("#tmem-calendar").fullCalendar("gotoDate",b.date)),a("#display\_absence\_start").val(""),a("#absence\_start").val(""),a("#display\_absence\_end").val(""),a("#absence\_end").val(""),a("#absence\_all\_day").prop("checked, true"),a("#absence\_start\_time\_hr").val("00"),a("#absence\_start\_time\_min").val("00"),a("#absence\_end\_time\_hr").val("00"),a("#absence\_end\_time\_min").val("00"),a("#absence\_notes").val(""),"H:i"!==tmem\_admin\_vars.time\_format&&(a("#absence\_start\_time\_period").val("am"),a("#absence\_end\_time\_period").val("am")),a("#tmem-calendar").removeClass("tmem-mute"),a("#tmem-add-absence-fields").removeClass("tmem-mute"),a("html, body").animate({scrollTop:a(".toggle-add-absence-section").offset().top},500),a(".toggle-add-absence-section").trigger("click")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click",".delete-absence",function(b){b.preventDefault(),a("#tmem-calendar").addClass("tmem-mute");var c={id:a(this).attr("id"),action:"tmem\_delete\_employee\_absence"};console.log(c);a.ajax({type:"POST",url:ajaxurl,dataType:"json",data:c,success:function(b){!0===b.success&&(a("#tmem-calendar").fullCalendar("refetchEvents"),a(".popover").hide("fast")),a("#tmem-calendar").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},checker:function(){a(document.body).on("click","#check-availability",function(){var b=a("#check\_date"),c=a("#display\_date"),d=a("#display\_date"),e=a("#check\_roles");if(!b.val()||!c.val())return void c.addClass("tmem-form-error");var f={date:b,employees:d,roles:e,action:"do\_availability\_check\_ajax"};a.ajax({type:"POST",dataType:"json",data:f,url:ajaxurl,beforeSend:function(){a("#tmem\_availability\_fields").addClass("tmem-mute")},success:function(){a("#tmem\_availability\_fields").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};g.init();var h={init:function(){this.options(),this.client(),this.employee(),this.equipment(),this.playlist(),this.tasks(),this.time(),this.travel(),this.type(),this.txns(),this.venue()},options:function(){a(document.body).on("click",".toggle-event-options-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_event\_options;c?a(this).html(tmem\_admin\_vars.hide\_event\_options):a(this).html(tmem\_admin\_vars.show\_event\_options),a(".tmem-event-options-sections-wrap").slideToggle()})},client:function(){a(document.body).on("click",".toggle-client-add-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_client\_form;c?a(this).html(tmem\_admin\_vars.hide\_client\_form):a(this).html(tmem\_admin\_vars.show\_client\_form);var d=a(this).parents(".tmem-client-row-header");d.siblings(".tmem-client-add-event-sections-wrap").slideToggle();var e;e=c?a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-client-add-event-sections-wrap")):a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus()}),a(document.body).on("click",".toggle-client-details-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_client\_details;c?a(this).html(tmem\_admin\_vars.hide\_client\_details):a(this).html(tmem\_admin\_vars.show\_client\_details);var d=a(this).parents(".tmem-client-row-header");d.siblings(".tmem-client-details-event-sections-wrap").slideToggle();var e;c||(e=a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus())}),a(document.body).on("click","#toggle\_client\_details",function(){a("#tmem-event-client-details").toggle("slow")}),a(document.body).on("change","#client\_name",function(b){if(b.preventDefault(),""===a("#client\_name").val())return void a("#tmem-event-add-new-client-fields").hide("slow");if("tmem\_add\_client"===a("#client\_name").val())a("#tmem-event-add-new-client-fields").show("slow");else{a("#tmem-event-add-new-client-fields").hide("slow");var c={client\_id:a("#client\_name").val(),event\_id:a("#post\_ID").val(),action:"tmem\_refresh\_client\_details"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>')},success:function(b){a("#tmem-loading").replaceWith(b.client\_details)}}).fail(function(b){a("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>'),window.console&&window.console.log&&console.log(b)})}}),a(document.body).on("click","#tmem-add-client",function(b){if(b.preventDefault(),a("#client\_firstname").val().length<1)return void a("#client\_firstname").addClass("tmem-form-error");if(a("#client\_email").val().length<1)return void a("#client\_email").addClass("tmem-form-error");var c={client\_firstname:a("#client\_firstname").val(),client\_lastname:a("#client\_lastname").val(),client\_email:a("#client\_email").val(),client\_address1:a("#client\_address1").val(),client\_address2:a("#client\_address2").val(),client\_town:a("#client\_town").val(),client\_county:a("#client\_county").val(),client\_postcode:a("#client\_postcode").val(),client\_phone:a("#client\_phone").val(),client\_phone2:a("#client\_phone2").val(),action:"tmem\_event\_add\_client"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-client-option-fields").addClass("tmem-mute"),a("#tmem-add-client").hide("fast")},success:function(b){a("#tmem-add-client-fields").slideToggle(),a("#add-client-action").html(tmem\_admin\_vars.show\_client\_form),a("#client\_name").empty(),a("#client\_firstname").val(""),a("#client\_lastname").val(""),a("#client\_email").val(""),a("#client\_address1").val(""),a("#client\_address2").val(""),a("#client\_town").val(""),a("#client\_county").val(""),a("#client\_postcode").val(""),a("#client\_phone").val(""),a("#client\_phone2").val(""),a("#client\_name").append(b.client\_list),a("#tmem-add-client").show("fast"),a("#\_tmem\_event\_block\_emails").prop("checked",!1),a("#tmem\_reset\_pw").prop("checked",!0),a("#client\_name").trigger("chosen:updated"),a(".tmem-client-option-fields").removeClass("tmem-mute"),"error"===b.type&&alert(b.message)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#toggle\_custom\_client\_fields",function(){a("#tmem\_event\_custom\_client\_fields").toggle("fast")}),a(document.body).on("click","#toggle\_custom\_event\_fields",function(){a("#tmem\_event\_custom\_event\_fields").toggle("fast")}),a(document.body).on("click","#toggle\_custom\_venue\_fields",function(){a("#tmem\_event\_custom\_venue\_fields").toggle("fast")})},employee:function(){a(document.body).on("click","#new\_tmem\_role",function(b){if(b.preventDefault(),a("#add\_tmem\_role").hasClass("tmem-form-error")&&a("#add\_tmem\_role").removeClass("tmem-form-error"),a("#add\_tmem\_role").val().length<1)return void a("#add\_tmem\_role").addClass("tmem-form-error");var c={role\_name:a("#add\_tmem\_role").val(),action:"tmem\_add\_role"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a('input[type="submit"]').prop("disabled",!0),a("#new\_tmem\_role").hide(),a("#pleasewait").show(),a("#all\_roles").addClass("tmem-mute"),a("#employee\_role").addClass("tmem-mute"),a("#all\_roles").fadeTo("slow",.5),a("#employee\_role").fadeTo("slow",.5)},success:function(b){"success"===b.type?(a("#all\_roles").empty(),a("#employee\_role").empty(),a("#all\_roles").append(b.options),a("#employee\_role").append(b.options),a("#add\_tmem\_role").val(""),a("#all\_roles").fadeTo("slow",1),a("#all\_roles").removeClass("tmem-mute"),a("#employee\_role").fadeTo("slow",1),a("#employee\_role").removeClass("tmem-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new\_tmem\_role").show()):(alert(b.msg),a("#all\_roles").fadeTo("slow",1),a("#all\_roles").removeClass("tmem-mute"),a("#employee\_role").fadeTo("slow",1),a("#employee\_role").removeClass("tmem-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new\_tmem\_role").show())}})}),a(document.body).on("click",".toggle-add-worker-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_workers;c?a(this).html(tmem\_admin\_vars.hide\_workers):a(this).html(tmem\_admin\_vars.show\_workers),a(".tmem-event-workers-sections-wrap").slideToggle(),a(".tmem-event-workers-sections-wrap").is(":visible")&&a("#event\_new\_employee\_role").focus()}),a(document.body).on("change","#event\_new\_employee\_wage",function(){var b=a(this).val();b.length>0&&a(this).val(b.toFixed(2))}),a(document.body).on("click","#add\_event\_employee",function(b){b.preventDefault();var c={event\_id:a("#post\_ID").val(),employee\_id:a("#event\_new\_employee").val(),employee\_role:a("#event\_new\_employee\_role").val(),employee\_wage:a("#event\_new\_employee\_wage").val(),action:"add\_employee\_to\_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),a("#tmem-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert(b.msg),a("#tmem-event-employee-list").html(b.employees),a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),a("#event\_new\_employee\_role").val("").trigger("chosen:updated"),a("#event\_new\_employee").val("").trigger("chosen:updated"),a("#event\_new\_employee\_wage").val("")}}).fail(function(b){a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(b)})}),a(document.body).on("click",".remove\_event\_employee",function(b){b.preventDefault();var c={event\_id:a("#post\_ID").val(),employee\_id:a(this).data("employee\_id"),action:"remove\_employee\_from\_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),a("#tmem-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert("Error"),a("#tmem-event-employee-list").html(b.employees),a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute")}}).fail(function(b){a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(b)})})},equipment:function(){a(document.body).on("change","#\_tmem\_event\_package,#event\_addons,#\_tmem\_event\_additional\_cost,#\_tmem\_event\_discount",function(){d()}),a(document.body).on("focusout","#\_tmem\_event\_cost",function(){tmem\_admin\_vars.deposit\_is\_pct&&c()}),a(document.body).on("change","#\_tmem\_event\_dj,#tmem\_event\_type,#display\_event\_date",function(b){b.preventDefault();var c=a("#\_tmem\_event\_deposit").val(),e={package:a("#\_tmem\_event\_package option:selected").val(),addons:a("#event\_addons").val()||[],employee:a("#\_tmem\_event\_dj").val(),event\_type:a("#tmem\_event\_type").val(),event\_date:a("#\_tmem\_event\_date").val(),action:"refresh\_event\_package\_options"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#tmem-event-equipment-row").hide(),a("#tmem-equipment-loader").show()},success:function(b){"success"===b.type?(a("#\_tmem\_event\_package").empty(),a("#\_tmem\_event\_package").append(b.packages),a("#\_tmem\_event\_package").trigger("chosen:updated"),a("#event\_addons").empty(),a("#event\_addons").append(b.addons),a("#event\_addons").trigger("chosen:updated"),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show(),d()):alert(b.msg),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()}}).fail(function(b){window.console&&window.console.log&&console.log(b),a("#\_tmem\_event\_deposit").val(c)})}),a(document.body).on("change","#\_tmem\_event\_package",function(b){b.preventDefault();var c={package:a("#\_tmem\_event\_package option:selected").val(),employee:a("#\_tmem\_event\_dj").val(),event\_type:a("#tmem\_event\_type").val(),event\_date:a("#\_tmem\_event\_date").val(),selected:a("#event\_addons").val()||[],action:"refresh\_event\_addon\_options"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-event-equipment-row").hide(),a("#tmem-equipment-loader").show()},success:function(b){"success"===b.type?(a("#event\_addons").empty(),a("#event\_addons").append(b.addons),a("#event\_addons").trigger("chosen:updated"),d(),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()):alert(b.msg),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},playlist:function(){a(document.body).on("change","#\_tmem\_event\_playlist",function(){a("#tmem-playlist-limit").toggle("fast")})},tasks:function(){a(document.body).on("change","#tmem\_event\_task",function(){var b=a(this).val();"0"===b?a("#tmem-event-task-run").addClass("tmem-hidden"):a("#tmem-event-task-run").removeClass("tmem-hidden")}),a(document.body).on("click","#tmem-run-task",function(b){b.preventDefault(),a("#tmem-event-tasks").addClass("tmem-mute");var c=a("#tmem\_event\_task").val(),d=a("#post\_ID").val();if("reject-enquiry"===c){var e=a("#client\_name").val(),f={page:"tmem-comms",recipient:e,template:tmem\_admin\_vars.unavailable\_template,event\_id:d,"tmem-action":"respond\_unavailable"},g=tmem\_admin\_vars.admin\_url+"admin.php?";return void(window.location.href=g+a.param(f))}var h={event\_id:d,task:c,action:"tmem\_execute\_event\_task"};a.ajax({type:"POST",dataType:"json",data:h,url:ajaxurl,beforeSend:function(){a("#tmem-run-task").addClass("tmem-hidden"),a("#tmem-spinner").css("visibility","visible")},complete:function(){a("#tmem-event-tasks").removeClass("tmem-mute")},success:function(b){b.success?(a("#tmem-event-task-run").addClass("tmem-hidden"),a("#tmem\_event\_status").val(b.data.status),a("#tmem\_event\_status").trigger("chosen:updated"),a(".task-history-items").html(b.data.history),a(".task-history-items").removeClass("description"),a("#tmem-run-task").removeClass("tmem-hidden"),a("#tmem\_event\_task").val("0"),a("#tmem\_event\_task").trigger("chosen:updated"),a("#tmem-spinner").css("visibility","hidden")):alert("Error")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},time:function(){a(document.body).on("change","#display\_event\_date",function(){a("#dj\_setup\_date").val().length<1&&a("#dj\_setup\_date").val(a("#display\_event\_date").val())}),tmem\_admin\_vars.setup\_time\_interval&&a(document.body).on("change","#event\_start\_hr, #event\_start\_min, #event\_start\_period",function(){var b=a("#event\_start\_hr").val(),c=a("#event\_start\_min").val(),d="",e=a("#\_tmem\_event\_date").val();"H:i"!==tmem\_admin\_vars.time\_format&&(d=" "+a("#event\_start\_period").val());var f=b+":"+c+d,g={time:f,date:e,action:"tmem\_event\_setup\_time"};a.ajax({type:"POST",dataType:"json",data:g,url:ajaxurl,success:function(b){a("#dj\_setup\_hr").val(b.data.hour),a("#dj\_setup\_min").val(b.data.minute),"H:i"!==tmem\_admin\_vars.time\_format&&a("#dj\_setup\_period").val(b.data.meridiem),(a("#dj\_setup\_date").val().length<1||a("#dj\_setup\_date").val()!==b.data.date)&&(a("#dj\_setup\_date").val(b.data.date),a("#\_tmem\_event\_djsetup").val(b.data.datepicker))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},travel:function(){a(document.body).on("change","#venue\_id",function(){"client"===a("#venue\_id").val()&&b()}),a(document.body).on("change","#\_tmem\_event\_dj,#venue\_address1,#venue\_address2,#venue\_town,#venue\_county,#venue\_postcode",function(){e(),a("#\_tmem\_event\_package").trigger("change")});var b=function(){if(a("#client\_name").length){var b=a("#client\_name").val(),c={client\_id:b,action:"tmem\_set\_client\_venue"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){b.address1&&a("#venue\_address1").val(b.address1),b.address2&&a("#venue\_address2").val(b.address2),b.town&&a("#venue\_town").val(b.town),b.county&&a("#venue\_county").val(b.county),b.postcode&&a("#venue\_postcode").val(b.postcode),setTimeout(function(){e()},1e3),setTimeout(function(){d()},1750)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}}},type:function(){a(document.body).on("click",".toggle-event-type-option-section",function(b){b.preventDefault(),a(".tmem-add-event-type-sections-wrap").slideToggle(),a(".tmem-add-event-type-sections-wrap").is(":visible")&&a("#event\_type\_name").focus()}),a(document.body).on("click","#tmem-add-event-type",function(b){b.preventDefault();var c={type:a("#event\_type\_name").val(),current:a("#tmem\_event\_type").val(),action:"add\_event\_type"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-option-fields").addClass("tmem-mute"),a("#tmem-add-event-type").hide("fast")},success:function(b){if(b){if("success"!==b.data.msg)return a("#event\_type\_name").addClass("tmem-form-error"),void a("#tmem-add-event-type").show("fast");a("#event\_type\_name").val(""),a(".tmem-add-event-type-sections-wrap").slideToggle(),a("#tmem\_event\_type").empty(),a("#tmem\_event\_type").append(b.data.event\_types),a("#tmem\_event\_type").trigger("chosen:updated"),a("#tmem-add-event-type").show("fast"),a(".tmem-event-option-fields").removeClass("tmem-mute")}else alert(b.data.msg),a("#tmem-add-event-type").show("fast")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#tmem\_block\_emails",function(){a(".tmem-quote-template").toggle("fast")})},txns:function(){a(document.body).on("click","#tmem\_txn\_toggle",function(){a("#tmem\_event\_txn\_table").toggle("slow")}),a(document.body).on("click","#toggle\_add\_txn\_fields",function(){a("#tmem\_event\_add\_txn\_table tbody").toggle("slow"),a("#save-event-txn").toggle("fast"),"show form"===a("#toggle\_add\_txn\_fields").text()?a("#toggle\_add\_txn\_fields").text("hide form"):a("#toggle\_add\_txn\_fields").text("show form")}),a(document.body).on("change","#tmem\_txn\_direction",function(){"In"===a("#tmem\_txn\_direction").val()&&(a("#tmem\_txn\_from\_container").removeClass("tmem-hidden"),a("#tmem\_txn\_to\_container").addClass("tmem-hidden"),a("#tmem-txn-email").removeClass("tmem-hidden")),"Out"!==a("#tmem\_txn\_direction").val()&&""!==a("#tmem\_txn\_direction").val()||(a("#tmem\_txn\_to\_container").removeClass("tmem-hidden"),a("#tmem\_txn\_from\_container").addClass("tmem-hidden"),a("#tmem-txn-email").addClass("tmem-hidden"))}),a(document.body).on("click","#save\_transaction",function(b){if(b.preventDefault(),a("#tmem\_txn\_amount").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_amount),!1;if(a("#tmem\_txn\_date").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_date),!1;if(a("#tmem\_txn\_for").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_for),!1;if(a("#tmem\_txn\_src").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_src),!1;var c={event\_id:a("#post\_ID").val(),client:a("#client\_name").val(),amount:a("#tmem\_txn\_amount").val(),date:a("#tmem\_txn\_date").val(),direction:a("#tmem\_txn\_direction").val(),from:a("#tmem\_txn\_from").val(),to:a("#tmem\_txn\_to").val(),for:a("#tmem\_txn\_for").val(),src:a("#tmem\_txn\_src").val(),send\_notice:a("#tmem\_manual\_txn\_email").is(":checked")?1:0,action:"add\_event\_transaction"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem\_event\_txn\_table").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>')},success:function(b){"success"===b.type?("Y"===b.deposit\_paid&&a("#deposit\_paid").prop("checked",!0),"Y"===b.balance\_paid&&a("#balance\_paid").prop("checked",!0),b.event\_status!==a("#tmem\_event\_status").val()&&a("#tmem\_event\_status").val(b.event\_status)):alert(b.msg),a("#tmem-loading").replaceWith('<div id="tmem\_event\_txn\_table">'+b.transactions+"</div>")}}).fail(function(b){a("#tmem-loading").replaceWith('<div id="tmem\_event\_txn\_table">'+response.transactions+"</div>"),window.console&&window.console.log&&console.log(b)})})},venue:function(){"post.php"===tmem\_admin\_vars.current\_page&&"manual"===a("#venue\_id").val()&&a(".tmem-add-event-venue-sections-wrap").show(),a(document.body).on("click",".toggle-event-view-venue-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem\_admin\_vars.show\_venue\_details;c?a(this).html(tmem\_admin\_vars.hide\_venue\_details):a(this).html(tmem\_admin\_vars.show\_venue\_details),a(".tmem-event-venue-details-sections-wrap").slideToggle()}),a(document.body).on("click",".toggle-event-add-venue-option-section",function(b){b.preventDefault(),a(".tmem-add-event-venue-sections-wrap").slideToggle(),a(".tmem-add-event-venue-sections-wrap").is(":visible")&&a("#venue\_name").focus()}),a(document.body).on("change","#venue\_id",function(a){a.preventDefault(),b()}),a(document.body).on("click","#tmem-add-venue",function(c){if(c.preventDefault(),a("#venue\_name").val().length<1)return void a("#venue\_name").addClass("tmem-form-error");var d={venue\_name:a("#venue\_name").val(),venue\_contact:a("#venue\_contact").val(),venue\_email:a("#venue\_email").val(),venue\_address1:a("#venue\_address1").val(),venue\_address2:a("#venue\_address2").val(),venue\_town:a("#venue\_town").val(),venue\_county:a("#venue\_county").val(),venue\_postcode:a("#venue\_postcode").val(),venue\_phone:a("#venue\_phone").val(),action:"tmem\_add\_venue"};a.ajax({type:"POST",dataType:"json",data:d,url:ajaxurl,beforeSend:function(){a(".tmem-event-option-fields").addClass("tmem-mute"),a("#tmem-add-venue").hide("fast")},success:function(c){a(".tmem-add-event-venue-sections-wrap").slideToggle(),a("#venue\_id").empty(),a("#venue\_id").append(c.venue\_list),a("#tmem-add-venue").show(),a("#venue\_id").trigger("chosen:updated"),b(),a(".tmem-event-option-fields").removeClass("tmem-mute"),"error"===c.type&&(alert(c.message),a("#tmem-add-venue").show("fast"))}}).fail(function(b){a("#tmem-add-venue").show("fast"),window.console&&window.console.log&&console.log(b)})})}};h.init();var i={init:function(){this.add(),this.remove(),this.price()},clone\_repeatable:function(b){var c=1,d=c;return b.parent().find("tr.tmem\_repeatable\_row").each(function(){var b=a(this).data("key");parseInt(b)>c&&(c=b)}),d=c+=1,clone=b.clone(),clone.find("select").each(function(){a(this).val(b.find('select[name="'+a(this).attr("name")+'"]').val())}),clone.removeClass("tmem\_add\_blank"),clone.attr("data-key",d),clone.find("td input, td select, textarea").val(""),clone.find("input, select, textarea").each(function(){var b=a(this).attr("name"),c=a(this).attr("id");b&&(b=b.replace(/\[(\d+)\]/,"["+parseInt(d)+"]"),a(this).attr("name",b)),"undefined"!=typeof c&&(c=c.replace(/(\d+)/,parseInt(d)),a(this).attr("id",c))}),clone.find("span.tmem\_price\_id").each(function(){a(this).text(parseInt(d))}),clone.find("span.tmem\_file\_id").each(function(){a(this).text(parseInt(d))}),clone.find(".tmem\_repeatable\_default\_input").each(function(){a(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){a(document.body).on("click",".submit .tmem\_add\_repeatable",function(b){b.preventDefault();var c=a(this),d=c.parent().parent().prev("tr"),e=i.clone\_repeatable(d);e.insertAfter(d).find("input, textarea, select").filter(":visible").eq(0).focus(),e.find(".tmem-select-chosen").chosen({inherit\_select\_classes:!0,placeholder\_text\_multiple:tmem\_admin\_vars.select\_months}),e.find(".package-items").css("width","100%")})},move:function(){a(".tmem\_repeatable\_table tbody").sortable({handle:".tmem\_draghandle",items:".tmem\_repeatable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=0;a(this).find("tr").each(function(){a(this).find("input.tmem\_repeatable\_index").each(function(){ |
  | 2 |  | a(this).val(b)}),b++})}})},remove:function(){a(document.body).on("click",".tmem\_remove\_repeatable",function(b){b.preventDefault();var c=a(this).parent().parent("tr"),d=c.parent().find("tr").length-1,e=a(this).data("type"),f="tr.tmem\_repeatable\_"+e+"s";if("price"===e){var g=c.data("key");a('.tmem\_repeatable\_condition\_field option[value="'+g+'"]').remove()}if(d>1)a("input, select",c).val(""),c.fadeOut("fast").remove();else switch(e){case"price":alert(tmem\_admin\_vars.one\_month\_min);break;case"item":alert(tmem\_admin\_vars.one\_item\_min);break;default:alert(tmem\_admin\_vars.one\_month\_min)}a(f).each(function(b){a(this).find("input, select").each(function(){var c=a(this).attr("name");c=c.replace(/\[(\d+)\]/,"["+b+"]"),a(this).attr("name",c).attr("id",c)})})})},price:function(){a(document.body).on("click","#\_package\_restrict\_date",function(){a("#tmem-package-month-selection").toggle("fast")}),a(document.body).on("click","#\_addon\_restrict\_date",function(){a("#tmem-addon-month-selection").toggle("fast")}),a(document.body).on("click","#\_package\_variable\_pricing",function(){a("#tmem-package-variable-price-fields").toggle("fast")}),a(document.body).on("click","#\_addon\_variable\_pricing",function(){a("#tmem-addon-variable-price-fields").toggle("fast")})}};i.init();var j={init:function(){this.content()},content:function(){var b=function(b){var c={recipient:b,action:"tmem\_user\_events\_dropdown"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem\_email\_event").addClass("tmem-updating"),a("#tmem\_email\_event").fadeTo("slow",.5)},success:function(b){a("#tmem\_email\_event").empty(),a("#tmem\_email\_event").append(b.event\_list),a("#tmem\_email\_event").fadeTo("slow",1),a("#tmem\_email\_event").removeClass("tmem-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})};tmem\_admin\_vars.load\_recipient&&(a("#tmem\_email\_to").val(tmem\_admin\_vars.load\_recipient),b(tmem\_admin\_vars.load\_recipient)),a(document.body).on("change","#tmem\_email\_to",function(c){c.preventDefault();var d=a("#tmem\_email\_to").val();b(d)}),a(document.body).on("change","#tmem\_email\_template",function(b){b.preventDefault();var c={template:a("#tmem\_email\_template").val(),action:"tmem\_set\_email\_content"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem\_email\_subject").addClass("tmem-updating"),a("#tmem\_email\_subject").fadeTo("slow",.5),a("#tmem\_email\_content").addClass("tmem-updating"),a("#tmem\_email\_content").fadeTo("slow",.5),a("#tmem\_email\_template").addClass("tmem-updating"),a("#tmem\_email\_template").fadeTo("slow",.5),tinymce.execCommand("mceToggleEditor",!1,"tmem\_email\_content")},success:function(b){"success"===b.type?(a("#tmem\_email\_content").empty(),tinyMCE.activeEditor.setContent(""),a("#tmem\_email\_subject").val(b.updated\_subject),tinyMCE.activeEditor.setContent(b.updated\_content),a("#tmem\_email\_content").val(b.updated\_content)):alert(b.msg),a("#tmem\_email\_subject").fadeTo("slow",1),a("#tmem\_email\_subject").removeClass("tmem-updating"),a("#tmem\_email\_content").fadeTo("slow",1),a("#tmem\_email\_content").removeClass("tmem-updating"),a("#tmem\_email\_template").removeClass("tmem-updating"),a("#tmem\_email\_template").fadeTo("slow",1),tinymce.execCommand("mceToggleEditor",!1,"tmem\_email\_content")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};j.init();var k={init:function(){this.template\_select()},template\_select:function(){a(document.body).on("change","#tmem\_task\_email\_template",function(b){b.preventDefault();var c={template:a("#tmem\_task\_email\_template").val(),action:"tmem\_get\_template\_title"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-task-email-subject").addClass("tmem-updating"),a("#tmem-task-email-subject").fadeTo("slow",.5)},success:function(b){b.title&&a("#tmem-task-email-subject").val(b.title),a("#tmem-task-email-subject").fadeTo("slow",1),a("#tmem-task-email-subject").removeClass("tmem-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};k.init();var l={init:function(){this.date\_options()},date\_options:function(){a("#tmem-graphs-date-options").change(function(){var b=a(this),c=a("#tmem-date-range-options");"other"===b.val()?c.show():c.hide()})}};l.init();var m={init:function(){this.submit(),this.dismiss\_message()},submit:function(){var b=this;a(document.body).on("submit",".tmem-export-form",function(c){c.preventDefault();var d=a(this).find('input[type="submit"]');if(!d.hasClass("button-disabled")){var e=a(this).serialize();d.addClass("button-disabled"),a(this).find(".notice-wrap").remove(),a(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="tmem-progress"><div></div></div></div>'),b.process\_step(1,e,b)}})},process\_step:function(b,c,d){a.ajax({type:"POST",url:ajaxurl,data:{form:c,action:"tmem\_do\_ajax\_export",step:b},dataType:"json",success:function(b){if("done"===b.step||b.error||b.success){var e=a(".tmem-export-form").find(".tmem-progress").parent().parent(),f=e.find(".notice-wrap");if(e.find(".button-disabled").removeClass("button-disabled"),b.error){var g=b.message;f.html('<div class="updated error"><p>'+g+"</p></div>")}else if(b.success){var h=b.message;f.html('<div id="tmem-batch-success" class="updated notice is-dismissible"><p>'+h+'<span class="notice-dismiss"></span></p></div>')}else f.remove(),window.location=b.url}else a(".tmem-progress div").animate({width:b.percentage+"%"},50,function(){}),d.process\_step(parseInt(b.step),c,d)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},dismiss\_message:function(){a("body").on("click","#tmem-batch-success .notice-dismiss",function(){a("#tmem-batch-success").parent().slideUp("fast")})}};m.init(),"tmem-event\_page\_tmem-comms"===tmem\_admin\_vars.current\_page&&a("#tmem\_form\_send\_comms").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{},messages:{tmem\_email\_to:null,tmem\_email\_subject:null,tmem\_email\_content:null}}),tmem\_admin\_vars.editing\_event&&(a("#post").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{client\_name:{required:!0,minlength:1},display\_event\_date:{required:!0},\_tmem\_event\_cost:{number:!0},\_tmem\_event\_deposit:{number:!0}},messages:{client\_name:null,display\_event\_date:null,\_tmem\_event\_cost:null,\_tmem\_event\_deposit:null}}),a(document.body).on("click","#save-post",function(){if(a("#\_tmem\_event\_cost").val()<"0.01")return confirm(tmem\_admin\_vars.zero\_cost)}))});var tmemFormatCurrency=function(a){var b=parseFloat(a),c=tmem\_admin\_vars.currency,d=tmem\_admin\_vars.currency\_decimals;return b.toLocaleString(c,{style:"currency",currency:c,minimumFractionDigits:d,maximumFractionDigits:d})},tmemFormatNumber=function(a){var b=parseFloat(a),c=tmem\_admin\_vars.currency;return b.toLocaleString(c,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},tmemLabelFormatter=function(a){return'<div style="font-size:12px; text-align:center; padding:2px">'+a+"</div>"},tmemLegendFormatterSources=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="tmem-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="tmem-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+tmemFormatNumber(b.data[0][1])+")</div>",f='<div id="'+b.tmem\_vars.id+c+'" class="tmem-legend-item-wrapper">'+d+e+"</div>";return jQuery("#tmem-pie-legend-"+b.tmem\_vars.id).append(f),f},tmemLegendFormatterEarnings=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="tmem-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="tmem-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+tmemFormatCurrency(b.data[0][1])+")</div>",f='<div id="'+b.tmem\_vars.id+c+'" class="tmem-legend-item-wrapper">'+d+e+"</div>";return jQuery("#tmem-pie-legend-"+b.tmem\_vars.id).append(f),f}; |
  |  | 1 | var tmem\_admin\_vars;jQuery(document).ready(function(e){e(".tmem-select-chosen").chosen({inherit\_select\_classes:!0,placeholder\_text\_single:tmem\_admin\_vars.one\_option,placeholder\_text\_multiple:tmem\_admin\_vars.one\_or\_more\_option}),e(".tmem-select-chosen .chosen-search input").each(function(){var t=e(this).parent().parent().parent().prev("select.tmem-select-chosen").data("search-placeholder");e(this).attr("placeholder",t)}),e(".chosen-choices").on("click",function(){var t=e(this).parent().prev().data("search-placeholder");void 0===t&&(t=tmem\_admin\_vars.type\_to\_search),e(this).children("li").children("input").attr("placeholder",t)}),e(document).on("click",".notice-tmem-dismiss .notice-dismiss",function(){var t={notice:e(this).closest(".notice-tmem-dismiss").data("notice"),action:"tmem\_dismiss\_notice"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl})});var t=function(){var t=e("#\_tmem\_event\_deposit").val(),n={current\_cost:e("#\_tmem\_event\_cost").val(),action:"update\_event\_deposit"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#\_tmem\_event\_deposit").attr("readonly",!0),e("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(n){"success"===n.type?e("#\_tmem\_event\_deposit").val(n.deposit):(alert(n.msg),e("#\_tmem\_event\_deposit").val(t)),e("#tmem-event-pricing-detail").removeClass("tmem-mute"),e("#\_tmem\_event\_deposit").attr("readonly",!1)}}).fail(function(n){window.console&&window.console.log&&console.log(n),e("#\_tmem\_event\_deposit").val(t)})},n=function(){var n,a=e("#\_tmem\_event\_cost").val();n="manual"===e("#venue\_id").val()||"client"===e("#venue\_id").val()?[e("#venue\_address1").val(),e("#venue\_address2").val(),e("#venue\_town").val(),e("#venue\_county").val(),e("#venue\_postcode").val()]:e("#venue\_id").val();var m={addons:e("#event\_addons").val()||[],package:e("#\_tmem\_event\_package option:selected").val(),event\_id:e("#post\_ID").val(),current\_cost:e("#\_tmem\_event\_cost").val(),event\_date:e("#\_tmem\_event\_date").val(),venue:n,employee\_id:e("#\_tmem\_event\_dj").val(),additional:e("#\_tmem\_event\_additional\_cost").val(),discount:e("#\_tmem\_event\_discount").val(),action:"tmem\_update\_event\_cost"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(n){if("success"===n.type){e("#\_tmem\_event\_package\_cost").val(n.package\_cost),e("#\_tmem\_event\_addons\_cost").val(n.addons\_cost),e("#\_tmem\_event\_travel\_cost").val(n.travel\_cost),e("#\_tmem\_event\_additional\_cost").val(n.additional\_cost),e("#\_tmem\_event\_discount").val(n.discount);var m=Number(n.package\_cost)+Number(n.addons\_cost)+Number(n.travel\_cost)+Number(n.additional\_cost);m=(m=Number(m)-Number(n.discount)).toFixed(2),e("#\_tmem\_event\_cost").val(m),tmem\_admin\_vars.update\_deposit&&t()}else e("#\_tmem\_event\_cost").val(a);e("#tmem-event-pricing-detail").removeClass("tmem-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},a=function(){var t;t="manual"===e("#venue\_id").val()||"client"===e("#venue\_id").val()?[e("#venue\_address1").val(),e("#venue\_address2").val(),e("#venue\_town").val(),e("#venue\_county").val(),e("#venue\_postcode").val()]:e("#venue\_id").val();var n={employee\_id:e("#\_tmem\_event\_dj").val(),venue:t,action:"tmem\_update\_travel\_data"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,success:function(t){"success"===t.type?(e(".tmem-travel-distance").parents("tr").show(),e(".tmem-travel-directions").parents("tr").show(),e(".tmem-travel-distance").html(t.distance),e(".tmem-travel-time").html(t.time),e(".tmem-travel-cost").html(t.cost),e("#travel\_directions").attr("href",t.directions\_url),e("#tmem\_travel\_distance").val(t.distance),e("#tmem\_travel\_time").val(t.time),e("#tmem\_travel\_cost").val(t.raw\_cost),e("#tmem\_travel\_directions\_url").val(t.directions\_url)):(e(".tmem-travel-distance").parents("tr").hide(),e("#travel-directions").attr("href",""),e(".tmem-travel-directions").parents("tr").hide(),e("#tmem\_travel\_distance").val(""),e("#tmem\_travel\_time").val(""),e("#tmem\_travel\_cost").val(""),e("#tmem\_travel\_directions\_url").val(""))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})};({init:function(){this.general(),"admin\_page\_tmem-custom-event-fields"!==tmem\_admin\_vars.current\_page&&"admin\_page\_tmem-custom-client-fields"!==tmem\_admin\_vars.current\_page||this.custom\_fields()},general:function(){var t=e(".tmem-color-picker");t.length&&t.wpColorPicker()},custom\_fields:function(){jQuery(document).ready(function(e){e(".tmem-client-list-item").sortable({handle:".tmem\_draghandle",items:".tmem\_sortable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=e(this).sortable("serialize",{expression:/ (.+) = (.+) /})+"&action=tmem\_update\_client\_field\_order";e.post(ajaxurl,t,function(){})}})}),e(".tmem-custom-client-list-item,.tmem-custom-event-list-item,.tmem-custom-venue-list-item").sortable({handle:".tmem\_draghandle",items:".tmem\_sortable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=e(this).sortable("serialize")+"&action=order\_custom\_event\_fields";e.post(ajaxurl,t,function(){})}})}}).init(),{init:function(){this.options(),this.absence(),this.checker()},options:function(){e(document.body).on("click",".toggle-availability-checker-section",function(t){t.preventDefault(),e(this).html()===tmem\_admin\_vars.show\_avail\_form?e(this).html(tmem\_admin\_vars.hide\_avail\_form):e(this).html(tmem\_admin\_vars.show\_avail\_form),e(".tmem-availability-checker-fields").slideToggle()}),e(document.body).on("click",".toggle-add-absence-section",function(t){t.preventDefault();var n=e(this).html()===tmem\_admin\_vars.show\_absence\_form;n?e(this).html(tmem\_admin\_vars.hide\_absence\_form):e(this).html(tmem\_admin\_vars.show\_absence\_form);var a=e(this).parents(".tmem-availability-row-header");a.siblings(".tmem-availability-add-absence-sections-wrap").slideToggle(),e("#absence\_all\_day").is(":checked")&&(e(".tmem-absence-start-time-option").hide("fast"),e(".tmem-absence-end-time-option").hide("fast")),e(":input:not(input[type=button],input[type=submit],button):visible:first",n?a.siblings(".tmem-availability-add-absence-sections-wrap"):a.siblings(".tmem-repeatable-row-standard-fields")).focus()}),e(document.body).on("change","#absence\_all\_day",function(){e(".tmem-absence-start-time-option").slideToggle(),e(".tmem-absence-end-time-option").slideToggle()})},absence:function(){e(document.body).on("click","#add-absence",function(t){t.preventDefault();var n=e("#absence\_employee\_id").val(),a=e("#absence\_start").val(),m=e("#absence\_end").val(),o=e("#absence\_all\_day").is(":checked")?1:0,i=e("#absence\_start\_time\_hr").val(),s=e("#absence\_start\_time\_min").val(),l=0,d=e("#absence\_end\_time\_hr").val(),c=e("#absence\_end\_time\_min").val(),\_=0,r=e("#absence\_notes").val();if("H:i"!==tmem\_admin\_vars.time\_format&&(l=e("#absence\_start\_time\_period").val(),\_=e("#absence\_end\_time\_period").val()),a)if(m){var v={employee\_id:n,start\_date:a,end\_date:m,all\_day:o,start\_time\_hr:i,start\_time\_min:s,start\_time\_period:l,end\_time\_hr:d,end\_time\_min:c,end\_time\_period:\_,notes:r,action:"tmem\_add\_employee\_absence"};e.ajax({type:"POST",dataType:"json",data:v,url:ajaxurl,beforeSend:function(){e("#tmem-add-absence-fields").addClass("tmem-mute")},success:function(t){!0===t.success&&(e("#tmem-calendar").fullCalendar("refetchEvents"),e("#tmem-calendar").fullCalendar("gotoDate",t.date)),e("#display\_absence\_start").val(""),e("#absence\_start").val(""),e("#display\_absence\_end").val(""),e("#absence\_end").val(""),e("#absence\_all\_day").prop("checked, true"),e("#absence\_start\_time\_hr").val("00"),e("#absence\_start\_time\_min").val("00"),e("#absence\_end\_time\_hr").val("00"),e("#absence\_end\_time\_min").val("00"),e("#absence\_notes").val(""),"H:i"!==tmem\_admin\_vars.time\_format&&(e("#absence\_start\_time\_period").val("am"),e("#absence\_end\_time\_period").val("am")),e("#tmem-calendar").removeClass("tmem-mute"),e("#tmem-add-absence-fields").removeClass("tmem-mute"),e("html, body").animate({scrollTop:e(".toggle-add-absence-section").offset().top},500),e(".toggle-add-absence-section").trigger("click")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else e("#display\_absence\_end").addClass("tmem-form-error");else e("#display\_absence\_start").addClass("tmem-form-error")}),e(document.body).on("click",".delete-absence",function(t){t.preventDefault(),e("#tmem-calendar").addClass("tmem-mute");var n={id:e(this).data("entry"),action:"tmem\_delete\_employee\_absence"};e.ajax({type:"POST",url:ajaxurl,dataType:"json",data:n,success:function(t){!0===t.success&&(e("#tmem-calendar").fullCalendar("refetchEvents"),e(".popover").hide("fast")),e("#tmem-calendar").removeClass("tmem-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},checker:function(){e(document.body).on("click","#check-availability",function(){var t=e("#check\_date"),n=e("#display\_date"),a=e("#display\_date"),m=e("#check\_roles");if(t.val()&&n.val()){var o={date:t,employees:a,roles:m,action:"do\_availability\_check\_ajax"};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl,beforeSend:function(){e("#tmem\_availability\_fields").addClass("tmem-mute")},success:function(){e("#tmem\_availability\_fields").removeClass("tmem-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else n.addClass("tmem-form-error")})}}.init(),{init:function(){this.options(),this.client(),this.employee(),this.equipment(),this.playlist(),this.tasks(),this.time(),this.travel(),this.type(),this.txns(),this.venue()},options:function(){e(document.body).on("click",".toggle-event-options-section",function(t){t.preventDefault(),e(this).html()===tmem\_admin\_vars.show\_event\_options?e(this).html(tmem\_admin\_vars.hide\_event\_options):e(this).html(tmem\_admin\_vars.show\_event\_options),e(".tmem-event-options-sections-wrap").slideToggle()})},client:function(){e(document.body).on("click",".toggle-client-add-option-section",function(t){t.preventDefault();var n=e(this).html()===tmem\_admin\_vars.show\_client\_form;n?e(this).html(tmem\_admin\_vars.hide\_client\_form):e(this).html(tmem\_admin\_vars.show\_client\_form);var a=e(this).parents(".tmem-client-row-header");a.siblings(".tmem-client-add-event-sections-wrap").slideToggle(),e(":input:not(input[type=button],input[type=submit],button):visible:first",n?a.siblings(".tmem-client-add-event-sections-wrap"):a.siblings(".tmem-repeatable-row-standard-fields")).focus()}),e(document.body).on("click",".toggle-client-details-option-section",function(t){t.preventDefault();var n=e(this).html()===tmem\_admin\_vars.show\_client\_details;n?e(this).html(tmem\_admin\_vars.hide\_client\_details):e(this).html(tmem\_admin\_vars.show\_client\_details);var a=e(this).parents(".tmem-client-row-header");a.siblings(".tmem-client-details-event-sections-wrap").slideToggle(),n||e(":input:not(input[type=button],input[type=submit],button):visible:first",a.siblings(".tmem-repeatable-row-standard-fields")).focus()}),e(document.body).on("click","#toggle\_client\_details",function(){e("#tmem-event-client-details").toggle("slow")}),e(document.body).on("change","#client\_name",function(t){if(t.preventDefault(),""!==e("#client\_name").val())if("tmem\_add\_client"===e("#client\_name").val())e("#tmem-event-add-new-client-fields").show("slow");else{e("#tmem-event-add-new-client-fields").hide("slow");var n={client\_id:e("#client\_name").val(),event\_id:e("#post\_ID").val(),action:"tmem\_refresh\_client\_details"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>')},success:function(t){e("#tmem-loading").replaceWith(t.client\_details)}}).fail(function(t){e("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>'),window.console&&window.console.log&&console.log(t)})}else e("#tmem-event-add-new-client-fields").hide("slow")}),e(document.body).on("click","#tmem-add-client",function(t){if(t.preventDefault(),e("#client\_firstname").val().length<1)e("#client\_firstname").addClass("tmem-form-error");else if(e("#client\_email").val().length<1)e("#client\_email").addClass("tmem-form-error");else{var n={client\_firstname:e("#client\_firstname").val(),client\_lastname:e("#client\_lastname").val(),client\_email:e("#client\_email").val(),client\_address1:e("#client\_address1").val(),client\_address2:e("#client\_address2").val(),client\_town:e("#client\_town").val(),client\_county:e("#client\_county").val(),client\_postcode:e("#client\_postcode").val(),client\_phone:e("#client\_phone").val(),client\_phone2:e("#client\_phone2").val(),action:"tmem\_event\_add\_client"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".tmem-client-option-fields").addClass("tmem-mute"),e("#tmem-add-client").hide("fast")},success:function(t){e("#tmem-add-client-fields").slideToggle(),e("#add-client-action").html(tmem\_admin\_vars.show\_client\_form),e("#client\_name").empty(),e("#client\_firstname").val(""),e("#client\_lastname").val(""),e("#client\_email").val(""),e("#client\_address1").val(""),e("#client\_address2").val(""),e("#client\_town").val(""),e("#client\_county").val(""),e("#client\_postcode").val(""),e("#client\_phone").val(""),e("#client\_phone2").val(""),e("#client\_name").append(t.client\_list),e("#tmem-add-client").show("fast"),e("#\_tmem\_event\_block\_emails").prop("checked",!1),e("#tmem\_reset\_pw").prop("checked",!0),e("#client\_name").trigger("chosen:updated"),e(".tmem-client-option-fields").removeClass("tmem-mute"),"error"===t.type&&alert(t.message)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}),e(document.body).on("click","#toggle\_custom\_client\_fields",function(){e("#tmem\_event\_custom\_client\_fields").toggle("fast")}),e(document.body).on("click","#toggle\_custom\_event\_fields",function(){e("#tmem\_event\_custom\_event\_fields").toggle("fast")}),e(document.body).on("click","#toggle\_custom\_venue\_fields",function(){e("#tmem\_event\_custom\_venue\_fields").toggle("fast")})},employee:function(){e(document.body).on("click","#new\_tmem\_role",function(t){if(t.preventDefault(),e("#add\_tmem\_role").hasClass("tmem-form-error")&&e("#add\_tmem\_role").removeClass("tmem-form-error"),e("#add\_tmem\_role").val().length<1)e("#add\_tmem\_role").addClass("tmem-form-error");else{var n={role\_name:e("#add\_tmem\_role").val(),action:"tmem\_add\_role"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e('input[type="submit"]').prop("disabled",!0),e("#new\_tmem\_role").hide(),e("#pleasewait").show(),e("#all\_roles").addClass("tmem-mute"),e("#employee\_role").addClass("tmem-mute"),e("#all\_roles").fadeTo("slow",.5),e("#employee\_role").fadeTo("slow",.5)},success:function(t){"success"===t.type?(e("#all\_roles").empty(),e("#employee\_role").empty(),e("#all\_roles").append(t.options),e("#employee\_role").append(t.options),e("#add\_tmem\_role").val(""),e("#all\_roles").fadeTo("slow",1),e("#all\_roles").removeClass("tmem-mute"),e("#employee\_role").fadeTo("slow",1),e("#employee\_role").removeClass("tmem-mute"),e('input[type="submit"]').prop("disabled",!1),e("#pleasewait").hide(),e("#new\_tmem\_role").show()):(alert(t.msg),e("#all\_roles").fadeTo("slow",1),e("#all\_roles").removeClass("tmem-mute"),e("#employee\_role").fadeTo("slow",1),e("#employee\_role").removeClass("tmem-mute"),e('input[type="submit"]').prop("disabled",!1),e("#pleasewait").hide(),e("#new\_tmem\_role").show())}})}}),e(document.body).on("click",".toggle-add-worker-section",function(t){t.preventDefault(),e(this).html()===tmem\_admin\_vars.show\_workers?e(this).html(tmem\_admin\_vars.hide\_workers):e(this).html(tmem\_admin\_vars.show\_workers),e(".tmem-event-workers-sections-wrap").slideToggle(),e(".tmem-event-workers-sections-wrap").is(":visible")&&e("#event\_new\_employee\_role").focus()}),e(document.body).on("change","#event\_new\_employee\_wage",function(){var t=e(this).val();t.length>0&&e(this).val(t.toFixed(2))}),e(document.body).on("click","#add\_event\_employee",function(t){t.preventDefault();var n={event\_id:e("#post\_ID").val(),employee\_id:e("#event\_new\_employee").val(),employee\_role:e("#event\_new\_employee\_role").val(),employee\_wage:e("#event\_new\_employee\_wage").val(),action:"add\_employee\_to\_event"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),e("#tmem-event-employee-list").slideToggle()},success:function(t){"success"!==t.type&&alert(t.msg),e("#tmem-event-employee-list").html(t.employees),e("#tmem-event-employee-list").slideToggle(),e(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),e("#event\_new\_employee\_role").val("").trigger("chosen:updated"),e("#event\_new\_employee").val("").trigger("chosen:updated"),e("#event\_new\_employee\_wage").val("")}}).fail(function(t){e("#tmem-event-employee-list").slideToggle(),e(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(t)})}),e(document.body).on("click",".remove\_event\_employee",function(t){t.preventDefault();var n={event\_id:e("#post\_ID").val(),employee\_id:e(this).data("employee\_id"),action:"remove\_employee\_from\_event"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),e("#tmem-event-employee-list").slideToggle()},success:function(t){"success"!==t.type&&alert("Error"),e("#tmem-event-employee-list").html(t.employees),e("#tmem-event-employee-list").slideToggle(),e(".tmem-event-workers-sections-wrap").removeClass("tmem-mute")}}).fail(function(t){e("#tmem-event-employee-list").slideToggle(),e(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(t)})})},equipment:function(){e(document.body).on("change","#\_tmem\_event\_package,#event\_addons,#\_tmem\_event\_additional\_cost,#\_tmem\_event\_discount",function(){n()}),e(document.body).on("focusout","#\_tmem\_event\_cost",function(){tmem\_admin\_vars.deposit\_is\_pct&&t()}),e(document.body).on("change","#\_tmem\_event\_dj,#tmem\_event\_type,#display\_event\_date",function(t){t.preventDefault();var a=e("#\_tmem\_event\_deposit").val(),m={package:e("#\_tmem\_event\_package option:selected").val(),addons:e("#event\_addons").val()||[],employee:e("#\_tmem\_event\_dj").val(),event\_type:e("#tmem\_event\_type").val(),event\_date:e("#\_tmem\_event\_date").val(),action:"refresh\_event\_package\_options"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#tmem-event-equipment-row").hide(),e("#tmem-equipment-loader").show()},success:function(t){"success"===t.type?(e("#\_tmem\_event\_package").empty(),e("#\_tmem\_event\_package").append(t.packages),e("#\_tmem\_event\_package").trigger("chosen:updated"),e("#event\_addons").empty(),e("#event\_addons").append(t.addons),e("#event\_addons").trigger("chosen:updated"),e("#tmem-equipment-loader").hide(),e("#tmem-event-equipment-row").show(),n()):alert(t.msg),e("#tmem-equipment-loader").hide(),e("#tmem-event-equipment-row").show()}}).fail(function(t){window.console&&window.console.log&&console.log(t),e("#\_tmem\_event\_deposit").val(a)})}),e(document.body).on("change","#\_tmem\_event\_package",function(t){t.preventDefault();var a={package:e("#\_tmem\_event\_package option:selected").val(),employee:e("#\_tmem\_event\_dj").val(),event\_type:e("#tmem\_event\_type").val(),event\_date:e("#\_tmem\_event\_date").val(),selected:e("#event\_addons").val()||[],action:"refresh\_event\_addon\_options"};e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(){e("#tmem-event-equipment-row").hide(),e("#tmem-equipment-loader").show()},success:function(t){"success"===t.type?(e("#event\_addons").empty(),e("#event\_addons").append(t.addons),e("#event\_addons").trigger("chosen:updated"),n(),e("#tmem-equipment-loader").hide(),e("#tmem-event-equipment-row").show()):alert(t.msg),e("#tmem-equipment-loader").hide(),e("#tmem-event-equipment-row").show()}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},playlist:function(){e(document.body).on("change","#\_tmem\_event\_playlist",function(){e("#tmem-playlist-limit").toggle("fast")})},tasks:function(){e(document.body).on("change","#tmem\_event\_task",function(){"0"===e(this).val()?e("#tmem-event-task-run").addClass("tmem-hidden"):e("#tmem-event-task-run").removeClass("tmem-hidden")}),e(document.body).on("click","#tmem-run-task",function(t){t.preventDefault(),e("#tmem-event-tasks").addClass("tmem-mute");var n=e("#tmem\_event\_task").val(),a=e("#post\_ID").val();if("reject-enquiry"!==n){var m={event\_id:a,task:n,action:"tmem\_execute\_event\_task"};e.ajax({type:"POST",dataType:"json",data:m,url:ajaxurl,beforeSend:function(){e("#tmem-run-task").addClass("tmem-hidden"),e("#tmem-spinner").css("visibility","visible")},complete:function(){e("#tmem-event-tasks").removeClass("tmem-mute")},success:function(t){t.success?(e("#tmem-event-task-run").addClass("tmem-hidden"),e("#tmem\_event\_status").val(t.data.status),e("#tmem\_event\_status").trigger("chosen:updated"),e(".task-history-items").html(t.data.history),e(".task-history-items").removeClass("description"),e("#tmem-run-task").removeClass("tmem-hidden"),e("#tmem\_event\_task").val("0"),e("#tmem\_event\_task").trigger("chosen:updated"),e("#tmem-spinner").css("visibility","hidden")):alert("Error")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}else{var o={page:"tmem-comms",recipient:e("#client\_name").val(),template:tmem\_admin\_vars.unavailable\_template,event\_id:a,"tmem-action":"respond\_unavailable"},i=tmem\_admin\_vars.admin\_url+"admin.php?";window.location.href=i+e.param(o)}})},time:function(){e(document.body).on("change","#display\_event\_date",function(){e("#dj\_setup\_date").val().length<1&&e("#dj\_setup\_date").val(e("#display\_event\_date").val())}),tmem\_admin\_vars.setup\_time\_interval&&e(document.body).on("change","#event\_start\_hr, #event\_start\_min, #event\_start\_period",function(){var t=e("#event\_start\_hr").val(),n=e("#event\_start\_min").val(),a="",m=e("#\_tmem\_event\_date").val();"H:i"!==tmem\_admin\_vars.time\_format&&(a=" "+e("#event\_start\_period").val());var o={time:t+":"+n+a,date:m,action:"tmem\_event\_setup\_time"};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl,success:function(t){e("#dj\_setup\_hr").val(t.data.hour),e("#dj\_setup\_min").val(t.data.minute),"H:i"!==tmem\_admin\_vars.time\_format&&e("#dj\_setup\_period").val(t.data.meridiem),(e("#dj\_setup\_date").val().length<1||e("#dj\_setup\_date").val()!==t.data.date)&&(e("#dj\_setup\_date").val(t.data.date),e("#\_tmem\_event\_djsetup").val(t.data.datepicker))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document.body).on("change","#display\_event\_date",function(){e("#dj\_setup\_date").val().length<1&&e("#dj\_setup\_date").val(e("#display\_event\_date").val())}),e(document.body).on("change","#event\_finish\_hr, #event\_finish\_min, #event\_finish\_period, #display\_event\_finish\_date",function(){var t=e("#event\_start\_hr").val(),n=e("#event\_start\_min").val(),a=e("#\_tmem\_event\_date").val().split("-"),m=new Date(a[0],a[1]-1,a[2]);m.setHours(t),m.setMinutes(n);var o=m,i=e("#event\_finish\_hr").val(),s=e("#event\_finish\_min").val(),l=e("#\_tmem\_event\_end\_date").val().split("-"),d=new Date(l[0],l[1]-1,l[2]);d.setHours(i),d.setMinutes(s),d<o&&alert("Your event end date is before your start date. If the event finishes at midnight or later, please change the date to the next day first.")})},travel:function(){e(document.body).on("change","#venue\_id",function(){"client"===e("#venue\_id").val()&&t()}),e(document.body).on("change","#\_tmem\_event\_dj,#venue\_address1,#venue\_address2,#venue\_town,#venue\_county,#venue\_postcode",function(){a(),e("#\_tmem\_event\_package").trigger("change")});var t=function(){if(e("#client\_name").length){var t={client\_id:e("#client\_name").val(),action:"tmem\_set\_client\_venue"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,success:function(t){t.address1&&e("#venue\_address1").val(t.address1),t.address2&&e("#venue\_address2").val(t.address2),t.town&&e("#venue\_town").val(t.town),t.county&&e("#venue\_county").val(t.county),t.postcode&&e("#venue\_postcode").val(t.postcode),setTimeout(function(){a()},1e3),setTimeout(function(){n()},1750)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}},type:function(){e(document.body).on("click",".toggle-event-type-option-section",function(t){t.preventDefault(),e(".tmem-add-event-type-sections-wrap").slideToggle(),e(".tmem-add-event-type-sections-wrap").is(":visible")&&e("#event\_type\_name").focus()}),e(document.body).on("click","#tmem-add-event-type",function(t){t.preventDefault();var n={type:e("#event\_type\_name").val(),current:e("#tmem\_event\_type").val(),action:"add\_event\_type"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".tmem-event-option-fields").addClass("tmem-mute"),e("#tmem-add-event-type").hide("fast")},success:function(t){if(t){if("success"!==t.data.msg)return e("#event\_type\_name").addClass("tmem-form-error"),void e("#tmem-add-event-type").show("fast");e("#event\_type\_name").val(""),e(".tmem-add-event-type-sections-wrap").slideToggle(),e("#tmem\_event\_type").empty(),e("#tmem\_event\_type").append(t.data.event\_types),e("#tmem\_event\_type").trigger("chosen:updated"),e("#tmem-add-event-type").show("fast"),e(".tmem-event-option-fields").removeClass("tmem-mute")}else alert(t.data.msg),e("#tmem-add-event-type").show("fast")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document.body).on("click","#tmem\_block\_emails",function(){e(".tmem-quote-template").toggle("fast")})},txns:function(){e(document.body).on("click","#tmem\_txn\_toggle",function(){e("#tmem\_event\_txn\_table").toggle("slow")}),e(document.body).on("click","#toggle\_add\_txn\_fields",function(){e("#tmem\_event\_add\_txn\_table tbody").toggle("slow"),e("#save-event-txn").toggle("fast"),"show form"===e("#toggle\_add\_txn\_fields").text()?e("#toggle\_add\_txn\_fields").text("hide form"):e("#toggle\_add\_txn\_fields").text("show form")}),e(document.body).on("change","#tmem\_txn\_direction",function(){"In"===e("#tmem\_txn\_direction").val()&&(e("#tmem\_txn\_from\_container").removeClass("tmem-hidden"),e("#tmem\_txn\_to\_container").addClass("tmem-hidden"),e("#tmem-txn-email").removeClass("tmem-hidden")),"Out"!==e("#tmem\_txn\_direction").val()&&""!==e("#tmem\_txn\_direction").val()||(e("#tmem\_txn\_to\_container").removeClass("tmem-hidden"),e("#tmem\_txn\_from\_container").addClass("tmem-hidden"),e("#tmem-txn-email").addClass("tmem-hidden"))}),e(document.body).on("click","#save\_transaction",function(t){if(t.preventDefault(),e("#tmem\_txn\_amount").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_amount),!1;if(e("#tmem\_txn\_date").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_date),!1;if(e("#tmem\_txn\_for").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_for),!1;if(e("#tmem\_txn\_src").val().length<1)return alert(tmem\_admin\_vars.no\_txn\_src),!1;var n={event\_id:e("#post\_ID").val(),client:e("#client\_name").val(),amount:e("#tmem\_txn\_amount").val(),date:e("#tmem\_txn\_date").val(),direction:e("#tmem\_txn\_direction").val(),from:e("#tmem\_txn\_from").val(),to:e("#tmem\_txn\_to").val(),for:e("#tmem\_txn\_for").val(),src:e("#tmem\_txn\_src").val(),send\_notice:e("#tmem\_manual\_txn\_email").is(":checked")?1:0,action:"add\_event\_transaction"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#tmem\_event\_txn\_table").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem\_admin\_vars.ajax\_loader+'" /></div>')},success:function(t){"success"===t.type?("Y"===t.deposit\_paid&&e("#deposit\_paid").prop("checked",!0),"Y"===t.balance\_paid&&e("#balance\_paid").prop("checked",!0),t.event\_status!==e("#tmem\_event\_status").val()&&e("#tmem\_event\_status").val(t.event\_status)):alert(t.msg),e("#tmem-loading").replaceWith('<div id="tmem\_event\_txn\_table">'+t.transactions+"</div>")}}).fail(function(t){e("#tmem-loading").replaceWith('<div id="tmem\_event\_txn\_table">'+response.transactions+"</div>"),window.console&&window.console.log&&console.log(t)})})},venue:function(){"post.php"===tmem\_admin\_vars.current\_page&&"manual"===e("#venue\_id").val()&&e(".tmem-add-event-venue-sections-wrap").show(),e(document.body).on("click",".toggle-event-view-venue-option-section",function(t){t.preventDefault(),e(this).html()===tmem\_admin\_vars.show\_venue\_details?e(this).html(tmem\_admin\_vars.hide\_venue\_details):e(this).html(tmem\_admin\_vars.show\_venue\_details),e(".tmem-event-venue-details-sections-wrap").slideToggle()}),e(document.body).on("click",".toggle-event-add-venue-option-section",function(t){t.preventDefault(),e(".tmem-add-event-venue-sections-wrap").slideToggle(),e(".tmem-add-event-venue-sections-wrap").is(":visible")&&e("#venue\_name").focus()}),e(document.body).on("change","#venue\_id",function(e){e.preventDefault(),o()}),e(document.body).on("click","#tmem-add-venue",function(t){if(t.preventDefault(),e("#venue\_name").val().length<1)e("#venue\_name").addClass("tmem-form-error");else{var n={venue\_name:e("#venue\_name").val(),venue\_contact:e("#venue\_contact").val(),venue\_email:e("#venue\_email").val(),venue\_address1:e("#venue\_address1").val(),venue\_address2:e("#venue\_address2").val(),venue\_town:e("#venue\_town").val(),venue\_county:e("#venue\_county").val(),venue\_postcode:e("#venue\_postcode").val(),venue\_phone:e("#venue\_phone").val(),action:"tmem\_add\_venue"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e(".tmem-event-option-fields").addClass("tmem-mute"),e("#tmem-add-venue").hide("fast")},success:function(t){e(".tmem-add-event-venue-sections-wrap").slideToggle(),e("#venue\_id").empty(),e("#venue\_id").append(t.venue\_list),e("#tmem-add-venue").show(),e("#venue\_id").trigger("chosen:updated"),o(),e(".tmem-event-option-fields").removeClass("tmem-mute"),"error"===t.type&&(alert(t.message),e("#tmem-add-venue").show("fast"))}}).fail(function(t){e("#tmem-add-venue").show("fast"),window.console&&window.console.log&&console.log(t)})}})}}.init();var m={init:function(){this.add(),this.remove(),this.price()},clone\_repeatable:function(t){var n,a=1;return t.parent().find("tr.tmem\_repeatable\_row").each(function(){var t=e(this).data("key");parseInt(t)>a&&(a=t)}),n=a+=1,clone=t.clone(),clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("tmem\_add\_blank"),clone.attr("data-key",n),clone.find("td input, td select, textarea").val(""),clone.find("input, select, textarea").each(function(){var t=e(this).attr("name"),a=e(this).attr("id");t&&(t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]"),e(this).attr("name",t)),void 0!==a&&(a=a.replace(/(\d+)/,parseInt(n)),e(this).attr("id",a))}),clone.find("span.tmem\_price\_id").each(function(){e(this).text(parseInt(n))}),clone.find("span.tmem\_file\_id").each(function(){e(this).text(parseInt(n))}),clone.find(".tmem\_repeatable\_default\_input").each(function(){e(this).val(parseInt(n)).removeAttr("checked")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .tmem\_add\_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent().prev("tr"),a=m.clone\_repeatable(n);a.insertAfter(n).find("input, textarea, select").filter(":visible").eq(0).focus(),a.find(".tmem-select-chosen").chosen({inherit\_select\_classes:!0,placeholder\_text\_multiple:tmem\_admin\_vars.select\_months}),a.find(".package-items").css("width","100%")})},move:function(){e(".tmem\_repeatable\_table tbody").sortable({handle:".tmem\_draghandle",items:".tmem\_repeatable\_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;e(this).find("tr").each(function(){e(this).find("input.tmem\_repeatable\_index").each(function(){e(this).val(t)}),t++})}})},remove:function(){e(document.body).on("click",".tmem\_remove\_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent("tr"),a=n.parent().find("tr").length-1,m=e(this).data("type"),o="tr.tmem\_repeatable\_"+m+"s";if("price"===m){var i=n.data("key");e('.tmem\_repeatable\_condition\_field option[value="'+i+'"]').remove()}if(a>1)e("input, select",n).val(""),n.fadeOut("fast").remove();else switch(m){case"price":alert(tmem\_admin\_vars.one\_month\_min);break;case"item":alert(tmem\_admin\_vars.one\_item\_min);break;default:alert(tmem\_admin\_vars.one\_month\_min)}e(o).each(function(t){e(this).find("input, select").each(function(){var n=e(this).attr("name");n=n.replace(/\[(\d+)\]/,"["+t+"]"),e(this).attr("name",n).attr("id",n)})})})},price:function(){e(document.body).on("click","#\_package\_restrict\_date",function(){e("#tmem-package-month-selection").toggle("fast")}),e(document.body).on("click","#\_addon\_restrict\_date",function(){e("#tmem-addon-month-selection").toggle("fast")}),e(document.body).on("click","#\_package\_variable\_pricing",function(){e("#tmem-package-variable-price-fields").toggle("fast")}),e(document.body).on("click","#\_addon\_variable\_pricing",function(){e("#tmem-addon-variable-price-fields").toggle("fast")})}};function o(){if("manual"===e("#venue\_id").val()||"client"===e("#venue\_id").val())e(".tmem-event-venue-details-sections-wrap").hide("fast"),e(".tmem-add-event-venue-sections-wrap").show("fast");else{e(".tmem-add-event-venue-sections-wrap").hide("fast");var t={venue\_id:e("#venue\_id").val(),event\_id:e("#post\_ID").val(),action:"tmem\_refresh\_venue\_details"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,success:function(t){e("#tmem-venue-details-fields").html(t.data.venue),e(".tmem-event-venue-details-sections-wrap").show("fast"),e(".toggle-event-view-venue-option-section").html()===tmem\_admin\_vars.show\_venue\_details&&e(".toggle-event-view-venue-option-section").html(tmem\_admin\_vars.hide\_venue\_details)}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),a()}e("#\_tmem\_event\_package").trigger("change")}m.init(),{init:function(){this.content()},content:function(){var t=function(t){var n={recipient:t,action:"tmem\_user\_events\_dropdown"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#tmem\_email\_event").addClass("tmem-updating"),e("#tmem\_email\_event").fadeTo("slow",.5)},success:function(t){e("#tmem\_email\_event").empty(),e("#tmem\_email\_event").append(t.event\_list),e("#tmem\_email\_event").fadeTo("slow",1),e("#tmem\_email\_event").removeClass("tmem-updating")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})};tmem\_admin\_vars.load\_recipient&&(e("#tmem\_email\_to").val(tmem\_admin\_vars.load\_recipient),t(tmem\_admin\_vars.load\_recipient)),e(document.body).on("change","#tmem\_email\_to",function(n){n.preventDefault();var a=e("#tmem\_email\_to").val();t(a)}),e(document.body).on("change","#tmem\_email\_template",function(t){t.preventDefault();var n={template:e("#tmem\_email\_template").val(),action:"tmem\_set\_email\_content"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#tmem\_email\_subject").addClass("tmem-updating"),e("#tmem\_email\_subject").fadeTo("slow",.5),e("#tmem\_email\_content").addClass("tmem-updating"),e("#tmem\_email\_content").fadeTo("slow",.5),e("#tmem\_email\_template").addClass("tmem-updating"),e("#tmem\_email\_template").fadeTo("slow",.5),tinymce.execCommand("mceToggleEditor",!1,"tmem\_email\_content")},success:function(t){"success"===t.type?(e("#tmem\_email\_content").empty(),tinyMCE.activeEditor.setContent(""),e("#tmem\_email\_subject").val(t.updated\_subject),tinyMCE.activeEditor.setContent(t.updated\_content),e("#tmem\_email\_content").val(t.updated\_content)):alert(t.msg),e("#tmem\_email\_subject").fadeTo("slow",1),e("#tmem\_email\_subject").removeClass("tmem-updating"),e("#tmem\_email\_content").fadeTo("slow",1),e("#tmem\_email\_content").removeClass("tmem-updating"),e("#tmem\_email\_template").removeClass("tmem-updating"),e("#tmem\_email\_template").fadeTo("slow",1),tinymce.execCommand("mceToggleEditor",!1,"tmem\_email\_content")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})}}.init(),{init:function(){this.template\_select()},template\_select:function(){e(document.body).on("change","#tmem\_task\_email\_template",function(t){t.preventDefault();var n={template:e("#tmem\_task\_email\_template").val(),action:"tmem\_get\_template\_title"};e.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){e("#tmem-task-email-subject").addClass("tmem-updating"),e("#tmem-task-email-subject").fadeTo("slow",.5)},success:function(t){t.title&&e("#tmem-task-email-subject").val(t.title),e("#tmem-task-email-subject").fadeTo("slow",1),e("#tmem-task-email-subject").removeClass("tmem-updating")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})}}.init(),{init:function(){this.date\_options()},date\_options:function(){e("#tmem-graphs-date-options").change(function(){var t=e(this),n=e("#tmem-date-range-options");"other"===t.val()?n.show():n.hide()})}}.init(),{init:function(){this.submit(),this.dismiss\_message()},submit:function(){var t=this;e(document.body).on("submit",".tmem-export-form",function(n){n.preventDefault();var a=e(this).find('input[type="submit"]');if(!a.hasClass("button-disabled")){var m=e(this).serialize();a.addClass("button-disabled"),e(this).find(".notice-wrap").remove(),e(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="tmem-progress"><div></div></div></div>'),t.process\_step(1,m,t)}})},process\_step:function(t,n,a){e.ajax({type:"POST",url:ajaxurl,data:{form:n,action:"tmem\_do\_ajax\_export",step:t},dataType:"json",success:function(t){if("done"===t.step||t.error||t.success){var m=e(".tmem-export-form").find(".tmem-progress").parent().parent(),o=m.find(".notice-wrap");if(m.find(".button-disabled").removeClass("button-disabled"),t.error){var i=t.message;o.html('<div class="updated error"><p>'+i+"</p></div>")}else if(t.success){var s=t.message;o.html('<div id="tmem-batch-success" class="updated notice is-dismissible"><p>'+s+'<span class="notice-dismiss"></span></p></div>')}else o.remove(),window.location=t.url}else e(".tmem-progress div").animate({width:t.percentage+"%"},50,function(){}),a.process\_step(parseInt(t.step),n,a)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},dismiss\_message:function(){e("body").on("click","#tmem-batch-success .notice-dismiss",function(){e("#tmem-batch-success").parent().slideUp("fast")})}}.init(),"tmem-event\_page\_tmem-comms"===tmem\_admin\_vars.current\_page&&e("#tmem\_form\_send\_comms").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{},messages:{tmem\_email\_to:null,tmem\_email\_subject:null,tmem\_email\_content:null}}),tmem\_admin\_vars.editing\_event&&(e("#post").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{client\_name:{required:!0,minlength:1},display\_event\_date:{required:!0},\_tmem\_event\_cost:{number:!0},\_tmem\_event\_deposit:{number:!0}},messages:{client\_name:null,display\_event\_date:null,\_tmem\_event\_cost:null,\_tmem\_event\_deposit:null}}),e(document.body).on("click","#save-post",function(){if(e("#\_tmem\_event\_cost").val()<"0.01")return confirm(tmem\_admin\_vars.zero\_cost)}))});var tmemFormatCurrency=function(e){var t=parseFloat(e),n=tmem\_admin\_vars.currency,a=tmem\_admin\_vars.currency\_decimals;return t.toLocaleString(n,{style:"currency",currency:n,minimumFractionDigits:a,maximumFractionDigits:a})},tmemFormatNumber=function(e){var t=parseFloat(e),n=tmem\_admin\_vars.currency;return t.toLocaleString(n,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},tmemLabelFormatter=function(e){return'<div style="font-size:12px; text-align:center; padding:2px">'+e+"</div>"},tmemLegendFormatterSources=function(e,t){var n=e.toLowerCase().replace(/\s/g,"-"),a='<div class="tmem-legend-color" style="background-color: '+t.color+'"></div>',m='<div class="tmem-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+tmemFormatNumber(t.data[0][1])+")</div>",o='<div id="'+t.tmem\_vars.id+n+'" class="tmem-legend-item-wrapper">'+a+m+"</div>";return jQuery("#tmem-pie-legend-"+t.tmem\_vars.id).append(o),o},tmemLegendFormatterEarnings=function(e,t){var n=e.toLowerCase().replace(/\s/g,"-"),a='<div class="tmem-legend-color" style="background-color: '+t.color+'"></div>',m='<div class="tmem-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+tmemFormatCurrency(t.data[0][1])+")</div>",o='<div id="'+t.tmem\_vars.id+n+'" class="tmem-legend-item-wrapper">'+a+m+"</div>";return jQuery("#tmem-pie-legend-"+t.tmem\_vars.id).append(o),o}; |
* ## [mobile-events-manager/trunk/includes/EDD\_SL\_Plugin\_Updater.php](/changeset/2647987/mobile-events-manager/trunk/includes/EDD_SL_Plugin_Updater.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/EDD_SL_Plugin_Updater.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/EDD_SL_Plugin_Updater.php?rev=2455787#L10 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/EDD_SL_Plugin_Updater.php?rev=2647987#L10 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | \*/ |
  | 11 | 11 |  |
  | 12 |  | // Exit if accessed directly |
  |  | 12 | // Exit if accessed directly. |
  | 13 | 13 | if ( ! defined( 'ABSPATH' ) ) { |
  | 14 | 14 | exit; |
* ## [mobile-events-manager/trunk/includes/actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/actions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2455787#L8 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987#L8 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* |
  | 9 | 9 | \* @author  Mike Howard, Jack Mawhinney, Dan Porter |
  |  | 10 | \* @package TMEM |
  | 10 | 11 | \*/ |
  | 11 | 12 |  |
  | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2455787#L19) | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987#L20) |  |
  | 19 | 20 | \*/ |
  | 20 | 21 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 22 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 24 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2455787#L34) | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987#L35) |  |
  | 34 | 35 | \*/ |
  | 35 | 36 | function tmem\_get\_actions() { |
  | 36 |  | if ( isset( $\_GET['tmem\_action'] ) ) { |
  | 37 |  | do\_action( 'tmem\_' . sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_action'] ) ), $\_GET ); |
  |  | 37 | if ( isset( $\_GET['tmem\_action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 38 | do\_action( 'tmem\_' . sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_action'] ) ), $\_GET ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 38 | 39 | } |
  | 39 | 40 | } // tmem\_get\_actions |
  | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2455787#L49) | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987#L50) |  |
  | 49 | 50 | \*/ |
  | 50 | 51 | function tmem\_post\_actions() { |
  | 51 |  | if ( isset( $\_POST['tmem\_action'] ) ) { |
  | 52 |  | do\_action( 'tmem\_' . sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_action'] ) ), $\_POST ); |
  |  | 52 | if ( isset( $\_POST['tmem\_action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 53 | do\_action( 'tmem\_' . sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_action'] ) ), $\_POST ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 53 | 54 | } |
  | 54 | 55 | } // tmem\_post\_actions |
  | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2455787#L61) | […](/browser/mobile-events-manager/trunk/includes/actions.php?rev=2647987#L62) |  |
  | 61 | 62 | \* |
  | 62 | 63 | \* @since   1.3 |
  | 63 |  | \* @param   str  $action     The action identifier |
  | 64 |  | \* @param   bool $echo       True echo's the input field, false to return as a string |
  |  | 64 | \* @param   str  $action     The action identifier. |
  |  | 65 | \* @param   bool $echo       True echo's the input field, false to return as a string. |
  | 65 | 66 | \* @return  str     $input      Hidden form field string |
  | 66 | 67 | \*/ |
* ## [mobile-events-manager/trunk/includes/admin/admin-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/admin-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/admin-actions.php")

  | [r2455800](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2455800#L18 "Show revision 2455800 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2455800#L31) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987#L31) |  |
  | 31 | 31 | \*/ |
  | 32 | 32 | function tmem\_process\_actions() { |
  | 33 |  | if ( isset( $\_POST['tmem-action'] ) ) { |
  |  | 33 | if ( isset( $\_POST['tmem-action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 34 | 34 |  |
  | 35 | 35 | if ( isset( $\_FILES ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2455800#L37) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987#L37) |  |
  | 37 | 37 | } |
  | 38 | 38 |  |
  | 39 |  | do\_action( 'tmem-' . sanitize\_text\_field( wp\_unslash( $\_POST['tmem-action'] ) ), $\_POST ); |
  |  | 39 | do\_action( 'tmem-' . sanitize\_text\_field( wp\_unslash( $\_POST['tmem-action'] ) ), $\_POST ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 40 | 40 |  |
  | 41 | 41 | } |
  | 42 | 42 |  |
  | 43 |  | if ( isset( $\_GET['tmem-action'] ) ) { |
  |  | 43 | if ( isset( $\_GET['tmem-action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 44 | 44 |  |
  | 45 | 45 | if ( isset( $\_FILES ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2455800#L47) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987#L47) |  |
  | 47 | 47 | } |
  | 48 | 48 |  |
  | 49 |  | do\_action( 'tmem-' . sanitize\_text\_field( wp\_unslash( $\_GET['tmem-action'] ) ), $\_GET ); |
  |  | 49 | do\_action( 'tmem-' . sanitize\_text\_field( wp\_unslash( $\_GET['tmem-action'] ) ), $\_GET ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 50 | 50 |  |
  | 51 | 51 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2455800#L60) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-actions.php?rev=2647987#L60) |  |
  | 60 | 60 | \* |
  | 61 | 61 | \* @since   1.3 |
  | 62 |  | \* @param   str  $action     The action identifier |
  | 63 |  | \* @param   bool $echo       True echo's the input field, false to return as a string |
  |  | 62 | \* @param   str  $action     The action identifier. |
  |  | 63 | \* @param   bool $echo       True echo's the input field, false to return as a string. |
  | 64 | 64 | \* @return  str     $input      Hidden form field string |
  | 65 | 65 | \*/ |
* ## [mobile-events-manager/trunk/includes/admin/admin-notices.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/admin-notices.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/admin-notices.php")

  | [r2539213](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L18 "Show revision 2539213 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L43) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L43) |  |
  | 43 | 43 | \* |
  | 44 | 44 | \* @since   1.5 |
  | 45 |  | \* @param   string $notice Notice to check |
  |  | 45 | \* @param   string $notice Notice to check. |
  | 46 | 46 | \* @return  bool    Whether or not the notice has been dismissed |
  | 47 | 47 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L62) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L62) |  |
  | 62 | 62 | \* |
  | 63 | 63 | \* @since   1.5 |
  | 64 |  | \* @param   string $notice Notice to dismiss |
  |  | 64 | \* @param   string $notice Notice to dismiss. |
  | 65 | 65 | \* @return  bool|int    True on success, false on failure, meta ID if it didn't exist yet |
  | 66 | 66 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L69) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L69) |  |
  | 69 | 69 | global $current\_user; |
  | 70 | 70 |  |
  | 71 |  | $dismissed\_notices = $new = (array) tmem\_dismissed\_notices(); |
  |  | 71 | $new = (array) tmem\_dismissed\_notices(); |
  |  | 72 | $dismissed\_notices = $new; |
  | 72 | 73 |  |
  | 73 | 74 | if ( ! array\_key\_exists( $notice, $dismissed\_notices ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L85) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L86) |  |
  | 85 | 86 | \* |
  | 86 | 87 | \* @since   1.5 |
  | 87 |  | \* @param   string $notice Notice to restore |
  |  | 88 | \* @param   string $notice Notice to restore. |
  | 88 | 89 | \* @return  bool|int    True on success, false on failure, meta ID if it didn't exist yet |
  | 89 | 90 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L114) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L115) |  |
  | 114 | 115 | global $tmem\_options; |
  | 115 | 116 |  |
  | 116 |  | // Unattended events |
  |  | 117 | // Unattended events. |
  | 117 | 118 | if ( tmem\_employee\_can( 'manage\_all\_events' ) && ( tmem\_get\_option( 'warn\_unattended' ) ) ) { |
  | 118 | 119 | $unattended = tmem\_event\_count( 'tmem-unattended' ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L122) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L123) |  |
  | 122 | 123 | echo '<p>' . |
  | 123 | 124 | sprintf( |
  |  | 125 | /\* translators: %s is the link to the Unattended Enquiries area. \*/ |
  | 124 | 126 | \_\_( 'You have unattended enquiries. <a href="%s">Click here</a> to manage.', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 125 | 127 | admin\_url( 'edit.php?post\_type=tmem-event&post\_status=tmem-unattended' ) // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L129) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L131) |  |
  | 129 | 131 | } |
  | 130 | 132 |  |
  | 131 |  | // Settings |
  | 132 |  | if ( isset( $\_GET['tmem-message'] ) && 'upgrade-completed' == $\_GET['tmem-message'] ) { |
  |  | 133 | // Settings. |
  |  | 134 | if ( isset( $\_GET['tmem-message'] ) && 'upgrade-completed' === $\_GET['tmem-message'] ) { |
  | 133 | 135 | add\_settings\_error( |
  | 134 | 136 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L139) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L141) |  |
  | 139 | 141 | } |
  | 140 | 142 |  |
  | 141 |  | // Availability |
  | 142 |  | if ( isset( $\_GET['tmem-message'] ) && 'absence-added' == $\_GET['tmem-message'] ) { |
  |  | 143 | // Availability. |
  |  | 144 | if ( isset( $\_GET['tmem-message'] ) && 'absence-added' === $\_GET['tmem-message'] ) { |
  | 143 | 145 | add\_settings\_error( |
  | 144 | 146 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L149) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L151) |  |
  | 149 | 151 | } |
  | 150 | 152 |  |
  | 151 |  | if ( isset( $\_GET['tmem-message'] ) && 'absence-fail' == $\_GET['tmem-message'] ) { |
  |  | 153 | if ( isset( $\_GET['tmem-message'] ) && 'absence-fail' === $\_GET['tmem-message'] ) { |
  | 152 | 154 | add\_settings\_error( |
  | 153 | 155 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L158) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L160) |  |
  | 158 | 160 | } |
  | 159 | 161 |  |
  | 160 |  | if ( isset( $\_GET['tmem-message'] ) && 'absence-removed' == $\_GET['tmem-message'] ) { |
  |  | 162 | if ( isset( $\_GET['tmem-message'] ) && 'absence-removed' === $\_GET['tmem-message'] ) { |
  | 161 | 163 | add\_settings\_error( |
  | 162 | 164 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L167) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L169) |  |
  | 167 | 169 | } |
  | 168 | 170 |  |
  | 169 |  | if ( isset( $\_GET['tmem-message'] ) && 'absence-delete-fail' == $\_GET['tmem-message'] ) { |
  |  | 171 | if ( isset( $\_GET['tmem-message'] ) && 'absence-delete-fail' === $\_GET['tmem-message'] ) { |
  | 170 | 172 | add\_settings\_error( |
  | 171 | 173 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L176) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L178) |  |
  | 176 | 178 | } |
  | 177 | 179 |  |
  | 178 |  | if ( isset( $\_GET['tmem-message'] ) && 'song\_added' == $\_GET['tmem-message'] ) { |
  |  | 180 | if ( isset( $\_GET['tmem-message'] ) && 'song\_added' === $\_GET['tmem-message'] ) { |
  | 179 | 181 | add\_settings\_error( |
  | 180 | 182 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L185) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L187) |  |
  | 185 | 187 | } |
  | 186 | 188 |  |
  | 187 |  | if ( isset( $\_GET['tmem-message'] ) && 'adding\_song\_failed' == $\_GET['tmem-message'] ) { |
  |  | 189 | if ( isset( $\_GET['tmem-message'] ) && 'adding\_song\_failed' === $\_GET['tmem-message'] ) { |
  | 188 | 190 | add\_settings\_error( |
  | 189 | 191 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L194) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L196) |  |
  | 194 | 196 | } |
  | 195 | 197 |  |
  | 196 |  | if ( isset( $\_GET['tmem-message'] ) && 'song\_removed' == $\_GET['tmem-message'] ) { |
  |  | 198 | if ( isset( $\_GET['tmem-message'] ) && 'song\_removed' === $\_GET['tmem-message'] ) { |
  | 197 | 199 | add\_settings\_error( |
  | 198 | 200 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L203) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L205) |  |
  | 203 | 205 | } |
  | 204 | 206 |  |
  | 205 |  | if ( isset( $\_GET['tmem-message'] ) && 'song\_remove\_failed' == $\_GET['tmem-message'] ) { |
  |  | 207 | if ( isset( $\_GET['tmem-message'] ) && 'song\_remove\_failed' === $\_GET['tmem-message'] ) { |
  | 206 | 208 | add\_settings\_error( |
  | 207 | 209 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L212) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L214) |  |
  | 212 | 214 | } |
  | 213 | 215 |  |
  | 214 |  | if ( isset( $\_GET['tmem-message'] ) && 'security\_failed' == $\_GET['tmem-message'] ) { |
  |  | 216 | if ( isset( $\_GET['tmem-message'] ) && 'security\_failed' === $\_GET['tmem-message'] ) { |
  | 215 | 217 | add\_settings\_error( |
  | 216 | 218 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L221) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L223) |  |
  | 221 | 223 | } |
  | 222 | 224 |  |
  | 223 |  | if ( isset( $\_GET['tmem-message'] ) && 'playlist\_emailed' == $\_GET['tmem-message'] ) { |
  |  | 225 | if ( isset( $\_GET['tmem-message'] ) && 'playlist\_emailed' === $\_GET['tmem-message'] ) { |
  | 224 | 226 | add\_settings\_error( |
  | 225 | 227 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L230) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L232) |  |
  | 230 | 232 | } |
  | 231 | 233 |  |
  | 232 |  | if ( isset( $\_GET['tmem-message'] ) && 'playlist\_email\_failed' == $\_GET['tmem-message'] ) { |
  |  | 234 | if ( isset( $\_GET['tmem-message'] ) && 'playlist\_email\_failed' === $\_GET['tmem-message'] ) { |
  | 233 | 235 | add\_settings\_error( |
  | 234 | 236 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L239) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L241) |  |
  | 239 | 241 | } |
  | 240 | 242 |  |
  | 241 |  | if ( isset( $\_GET['tmem-message'] ) && 'employee\_added' == $\_GET['tmem-message'] ) { |
  |  | 243 | if ( isset( $\_GET['tmem-message'] ) && 'employee\_added' === $\_GET['tmem-message'] ) { |
  | 242 | 244 | add\_settings\_error( |
  | 243 | 245 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L247) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L249) |  |
  | 247 | 249 | ); |
  | 248 | 250 | } |
  | 249 |  | if ( isset( $\_GET['tmem-message'] ) && 'employee\_add\_failed' == $\_GET['tmem-message'] ) { |
  |  | 251 | if ( isset( $\_GET['tmem-message'] ) && 'employee\_add\_failed' === $\_GET['tmem-message'] ) { |
  | 250 | 252 | add\_settings\_error( |
  | 251 | 253 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L255) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L257) |  |
  | 255 | 257 | ); |
  | 256 | 258 | } |
  | 257 |  | if ( isset( $\_GET['tmem-message'] ) && 'employee\_info\_missing' == $\_GET['tmem-message'] ) { |
  |  | 259 | if ( isset( $\_GET['tmem-message'] ) && 'employee\_info\_missing' === $\_GET['tmem-message'] ) { |
  | 258 | 260 | add\_settings\_error( |
  | 259 | 261 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L263) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L265) |  |
  | 263 | 265 | ); |
  | 264 | 266 | } |
  | 265 |  | if ( isset( $\_GET['tmem-message'] ) && 'comm\_missing\_content' == $\_GET['tmem-message'] ) { |
  |  | 267 | if ( isset( $\_GET['tmem-message'] ) && 'comm\_missing\_content' === $\_GET['tmem-message'] ) { |
  | 266 | 268 | add\_settings\_error( |
  | 267 | 269 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L271) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L273) |  |
  | 271 | 273 | ); |
  | 272 | 274 | } |
  | 273 |  | if ( isset( $\_GET['tmem-message'] ) && 'comm\_sent' == $\_GET['tmem-message'] ) { |
  |  | 275 | if ( isset( $\_GET['tmem-message'] ) && 'comm\_sent' === $\_GET['tmem-message'] ) { |
  | 274 | 276 | add\_settings\_error( |
  | 275 | 277 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L279) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L281) |  |
  | 279 | 281 | ); |
  | 280 | 282 | } |
  | 281 |  | if ( isset( $\_GET['tmem-message'] ) && 'comm\_not\_sent' == $\_GET['tmem-message'] ) { |
  |  | 283 | if ( isset( $\_GET['tmem-message'] ) && 'comm\_not\_sent' === $\_GET['tmem-message'] ) { |
  | 282 | 284 | add\_settings\_error( |
  | 283 | 285 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L287) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L289) |  |
  | 287 | 289 | ); |
  | 288 | 290 | } |
  | 289 |  | if ( isset( $\_GET['tmem-action'] ) && 'get\_event\_availability' == $\_GET['tmem-action'] ) { |
  |  | 291 | if ( isset( $\_GET['tmem-action'] ) && 'get\_event\_availability' === $\_GET['tmem-action'] ) { |
  | 290 | 292 |  |
  | 291 | 293 | if ( ! isset( $\_GET['tmem\_nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_nonce'], 'get\_event\_availability' ) ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L306) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L308) |  |
  | 306 | 308 | echo '<li>'; |
  | 307 | 309 | printf( |
  |  | 310 | /\* translators: %2 employee %s plural \*/ |
  | 308 | 311 | \_\_( '<a href="%1$s" title="Assign &amp; Respond to Enquiry">Assign %2$s &amp; respond to enquiry</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 309 | 312 | add\_query\_arg( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L322) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L325) |  |
  | 322 | 325 | echo '<p>'; |
  | 323 | 326 | printf( |
  |  | 327 | /\* translators: %1: number of employees $s plural %2: contract ID %3: date $d %4 \*/ |
  | 324 | 328 | esc\_html\_\_( 'You have %1$d employees available to work %2$s %3$s on %4$s.', 'mobile-events-manager' ), |
  | 325 | 329 | count( $result['available'] ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L336) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L340) |  |
  | 336 | 340 | echo '<p>'; |
  | 337 | 341 | printf( |
  |  | 342 | /\* translators: %1 event type %2 contract ID %3 long date $s plural \*/ |
  | 338 | 343 | esc\_html\_\_( 'There are no employees available to work %1$s %2$s on %3$s', 'mobile-events-manager' ), |
  | 339 | 344 | esc\_html( tmem\_get\_label\_singular( true ) ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L347) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L352) |  |
  | 347 | 352 | } |
  | 348 | 353 | } |
  | 349 |  | if ( isset( $\_GET['tmem-message'] ) && 'payment\_event\_missing' == $\_GET['tmem-message'] ) { |
  |  | 354 | if ( isset( $\_GET['tmem-message'] ) && 'payment\_event\_missing' === $\_GET['tmem-message'] ) { |
  | 350 | 355 | add\_settings\_error( |
  | 351 | 356 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L355) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L360) |  |
  | 355 | 360 | ); |
  | 356 | 361 | } |
  | 357 |  | if ( isset( $\_GET['tmem-message'] ) && 'pay\_employee\_failed' == $\_GET['tmem-message'] ) { |
  |  | 362 | if ( isset( $\_GET['tmem-message'] ) && 'pay\_employee\_failed' === $\_GET['tmem-message'] ) { |
  | 358 | 363 | add\_settings\_error( |
  | 359 | 364 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L363) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L368) |  |
  | 363 | 368 | ); |
  | 364 | 369 | } |
  | 365 |  | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_failed' == $\_GET['tmem-message'] ) { |
  |  | 370 | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_failed' === $\_GET['tmem-message'] ) { |
  | 366 | 371 | add\_settings\_error( |
  | 367 | 372 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L371) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L376) |  |
  | 371 | 376 | ); |
  | 372 | 377 | } |
  | 373 |  | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_some\_success' == $\_GET['tmem-message'] ) { |
  |  | 378 | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_some\_success' === $\_GET['tmem-message'] ) { |
  | 374 | 379 | add\_settings\_error( |
  | 375 | 380 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L379) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L384) |  |
  | 379 | 384 | ); |
  | 380 | 385 | } |
  | 381 |  | if ( isset( $\_GET['tmem-message'] ) && 'pay\_employee\_success' == $\_GET['tmem-message'] ) { |
  |  | 386 | if ( isset( $\_GET['tmem-message'] ) && 'pay\_employee\_success' === $\_GET['tmem-message'] ) { |
  | 382 | 387 | add\_settings\_error( |
  | 383 | 388 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L387) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L392) |  |
  | 387 | 392 | ); |
  | 388 | 393 | } |
  | 389 |  | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_success' == $\_GET['tmem-message'] ) { |
  |  | 394 | if ( isset( $\_GET['tmem-message'] ) && 'pay\_all\_employees\_success' === $\_GET['tmem-message'] ) { |
  | 390 | 395 | add\_settings\_error( |
  | 391 | 396 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L395) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L400) |  |
  | 395 | 400 | ); |
  | 396 | 401 | } |
  | 397 |  | if ( isset( $\_GET['tmem-message'] ) && 'unattended\_enquiries\_rejected\_success' == $\_GET['tmem-message'] ) { |
  |  | 402 | if ( isset( $\_GET['tmem-message'] ) && 'unattended\_enquiries\_rejected\_success' === $\_GET['tmem-message'] ) { |
  | 398 | 403 | add\_settings\_error( |
  | 399 | 404 | 'tmem-notices', |
  | 400 | 405 | 'tmem-unattended\_enquiries\_rejected\_success', |
  | 401 | 406 | sprintf( |
  |  | 407 | /\* translators: %1 event type %2 contract id %3 event id $s plural \*/ |
  | 402 | 408 | \_n( '%1$s %2$s successfully rejected.', '%1$s %3$s successfully rejected.', isset( $\_GET['tmem-count'] ) ? absint( wp\_unslash( $\_GET['tmem-count'] ) ) : 0, 'mobile-events-manager' ), |
  | 403 | 409 | isset( $\_GET['tmem-count'] ) ? absint( wp\_unslash( $\_GET['tmem-count'] ) ) : 0, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L408) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L414) |  |
  | 408 | 414 | ); |
  | 409 | 415 | } |
  | 410 |  | if ( isset( $\_GET['tmem-message'] ) && 'unattended\_enquiries\_rejected\_failed' == $\_GET['tmem-message'] ) { |
  |  | 416 | if ( isset( $\_GET['tmem-message'] ) && 'unattended\_enquiries\_rejected\_failed' === $\_GET['tmem-message'] ) { |
  | 411 | 417 | add\_settings\_error( |
  | 412 | 418 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L416) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L422) |  |
  | 416 | 422 | ); |
  | 417 | 423 | } |
  | 418 |  | if ( isset( $\_GET['tmem-message'] ) && 'api-key-generated' == $\_GET['tmem-message'] ) { |
  |  | 424 | if ( isset( $\_GET['tmem-message'] ) && 'api-key-generated' === $\_GET['tmem-message'] ) { |
  | 419 | 425 | add\_settings\_error( |
  | 420 | 426 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L424) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L430) |  |
  | 424 | 430 | ); |
  | 425 | 431 | } |
  | 426 |  | if ( isset( $\_GET['tmem-message'] ) && 'api-key-regenerated' == $\_GET['tmem-message'] ) { |
  |  | 432 | if ( isset( $\_GET['tmem-message'] ) && 'api-key-regenerated' === $\_GET['tmem-message'] ) { |
  | 427 | 433 | add\_settings\_error( |
  | 428 | 434 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L432) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L438) |  |
  | 432 | 438 | ); |
  | 433 | 439 | } |
  | 434 |  | if ( isset( $\_GET['tmem-message'] ) && 'api-key-revoked' == $\_GET['tmem-message'] ) { |
  |  | 440 | if ( isset( $\_GET['tmem-message'] ) && 'api-key-revoked' === $\_GET['tmem-message'] ) { |
  | 435 | 441 | add\_settings\_error( |
  | 436 | 442 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L440) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L446) |  |
  | 440 | 446 | ); |
  | 441 | 447 | } |
  | 442 |  | if ( isset( $\_GET['tmem-message'] ) && 'api-key-failed' == $\_GET['tmem-message'] ) { |
  |  | 448 | if ( isset( $\_GET['tmem-message'] ) && 'api-key-failed' === $\_GET['tmem-message'] ) { |
  | 443 | 449 | add\_settings\_error( |
  | 444 | 450 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L448) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L454) |  |
  | 448 | 454 | ); |
  | 449 | 455 | } |
  | 450 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-status-updated' == $\_GET['tmem-message'] ) { |
  |  | 456 | if ( isset( $\_GET['tmem-message'] ) && 'task-status-updated' === $\_GET['tmem-message'] ) { |
  | 451 | 457 | add\_settings\_error( |
  | 452 | 458 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L456) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L462) |  |
  | 456 | 462 | ); |
  | 457 | 463 | } |
  | 458 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-status-update-failed' == $\_GET['tmem-message'] ) { |
  |  | 464 | if ( isset( $\_GET['tmem-message'] ) && 'task-status-update-failed' === $\_GET['tmem-message'] ) { |
  | 459 | 465 | add\_settings\_error( |
  | 460 | 466 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L464) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L470) |  |
  | 464 | 470 | ); |
  | 465 | 471 | } |
  | 466 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-run' == $\_GET['tmem-message'] ) { |
  |  | 472 | if ( isset( $\_GET['tmem-message'] ) && 'task-run' === $\_GET['tmem-message'] ) { |
  | 467 | 473 | add\_settings\_error( |
  | 468 | 474 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L472) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L478) |  |
  | 472 | 478 | ); |
  | 473 | 479 | } |
  | 474 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-run-failed' == $\_GET['tmem-message'] ) { |
  |  | 480 | if ( isset( $\_GET['tmem-message'] ) && 'task-run-failed' === $\_GET['tmem-message'] ) { |
  | 475 | 481 | add\_settings\_error( |
  | 476 | 482 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L480) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L486) |  |
  | 480 | 486 | ); |
  | 481 | 487 | } |
  | 482 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-updated' == $\_GET['tmem-message'] ) { |
  |  | 488 | if ( isset( $\_GET['tmem-message'] ) && 'task-updated' === $\_GET['tmem-message'] ) { |
  | 483 | 489 | add\_settings\_error( |
  | 484 | 490 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L488) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L494) |  |
  | 488 | 494 | ); |
  | 489 | 495 | } |
  | 490 |  | if ( isset( $\_GET['tmem-message'] ) && 'task-update-failed' == $\_GET['tmem-message'] ) { |
  |  | 496 | if ( isset( $\_GET['tmem-message'] ) && 'task-update-failed' === $\_GET['tmem-message'] ) { |
  | 491 | 497 | add\_settings\_error( |
  | 492 | 498 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L496) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L502) |  |
  | 496 | 502 | ); |
  | 497 | 503 | } |
  | 498 |  | if ( isset( $\_GET['tmem-message'] ) && 'settings-imported' == $\_GET['tmem-message'] ) { |
  |  | 504 | if ( isset( $\_GET['tmem-message'] ) && 'settings-imported' === $\_GET['tmem-message'] ) { |
  | 499 | 505 | add\_settings\_error( |
  | 500 | 506 | 'tmem-notices', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L526) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L532) |  |
  | 526 | 532 | <?php |
  | 527 | 533 | printf( |
  |  | 534 | /\* translators: $1 WordPress link  $s plural \*/ |
  | 528 | 535 | \_\_( 'Would you <strong>please</strong> do us a favour and leave a 5 star rating on WordPress.org? It only takes a minute and it <strong>really helps</strong> our developers to continue to work on great new features and functionality. <a href="%1$s" target="\_blank">Yes, most definitely!</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 529 | 536 | 'https://wordpress.org/support/plugin/mobile-events-manager/reviews/' |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L611) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L618) |  |
  | 611 | 618 |  |
  | 612 | 619 |  |
  | 613 |  |  |
  |  | 620 | /\*\* |
  |  | 621 | \* Implements tmem\_admin\_wp\_addons(). |
  |  | 622 | \* |
  |  | 623 | \* Description Invites user to look at additional addons. |
  |  | 624 | \*/ |
  | 614 | 625 | function tmem\_admin\_wp\_addons() { |
  | 615 |  | ob\_start(); ?> |
  |  | 626 | ob\_start(); |
  |  | 627 | ?> |
  | 616 | 628 |  |
  | 617 | 629 | <div class="updated notice notice-tmem-dismiss is-dismissible" data-notice="tmem\_request\_wp\_addons"> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L624) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L636) |  |
  | 624 | 636 | \_\_( 'Did you know we have a few addons to further enhance your Mobile Events Manager Plugin? <a href="https://www.mobileeventsmanager.co.uk/downloads/stripe-payments/">Stripe Payments</a> and <a href="https://www.mobileeventsmanager.co.uk/downloads/enquiry-forms/">Enquiry Forms</a>.', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 625 | 637 | '' |
  | 626 |  | ); |
  |  | 638 | ); // invite to download new addons. |
  | 627 | 639 | ?> |
  | 628 | 640 | </p> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2539213#L642) | […](/browser/mobile-events-manager/trunk/includes/admin/admin-notices.php?rev=2647987#L654) |  |
  | 642 | 654 | /\*\* |
  | 643 | 655 | \* Link to visit Addons pages. |
  | 644 |  | ~~\*~~ |
  | 645 | 656 | \* |
  | 646 | 657 | \* @since   1.3 |
* ## [mobile-events-manager/trunk/includes/admin/availability/availability-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/availability/availability-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/availability/availability-actions.php")

  | [r2514025](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-actions.php?rev=2514025#L1 "Show revision 2514025 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-actions.php?rev=2647987#L1 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | /\*\* |
  | 3 |  | \* This plugin utilizes Open Source code. Details of these open source projects along with their licenses can be found below. |
  | 4 |  | \* We acknowledge and are grateful to these developers for their contributions to open source. |
  | 5 |  | \* |
  | 6 |  | \* Project: mobile-dj-manager https://github.com/deckbooks/mobile-dj-manager |
  | 7 |  | \* License: (GNU General Public License v2.0) https://github.com/deckbooks/mobile-dj-manager/blob/master/license.txt |
  | 8 |  | \* |
  | 9 |  | \* @author: Mike Howard, Jack Mawhinney, Dan Porter |
  | 10 |  | \* |
  | 11 |  | \* Contains all admin availability related functions |
  | 12 |  | \* |
  | 13 |  | \* @package     TMEM |
  | 14 |  | \* @subpackage  Availability |
  | 15 |  | \*/ |
  |  | 2 | /\*\* |
  |  | 3 | \* This plugin utilizes Open Source code. Details of these open source projects along with their licenses can be found below. |
  |  | 4 | \* We acknowledge and are grateful to these developers for their contributions to open source. |
  |  | 5 | \* |
  |  | 6 | \* Project: mobile-dj-manager https://github.com/deckbooks/mobile-dj-manager |
  |  | 7 | \* License: (GNU General Public License v2.0) https://github.com/deckbooks/mobile-dj-manager/blob/master/license.txt |
  |  | 8 | \* |
  |  | 9 | \* @author: Mike Howard, Jack Mawhinney, Dan Porter |
  |  | 10 | \* |
  |  | 11 | \* Contains all admin availability related functions |
  |  | 12 | \* |
  |  | 13 | \* @package     TMEM |
  |  | 14 | \* @subpackage  Availability |
  |  | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/availability/availability-page.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/availability/availability-page.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/availability/availability-page.php")

  | [r2625441](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L18 "Show revision 2625441 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L46) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L46) |  |
  | 46 | 46 | \* |
  | 47 | 47 | \* @since   1.5.6 |
  | 48 |  | ~~\* @return  string~~ |
  | 49 | 48 | \*/ |
  | 50 | 49 | function tmem\_availability\_page() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L91) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L90) |  |
  | 91 | 90 | \* |
  | 92 | 91 | \* @since   1.5.6 |
  | 93 |  | ~~\* @return  string~~ |
  | 94 | 92 | \*/ |
  | 95 | 93 | function tmem\_render\_availability\_page\_checker() { |
  | 96 | 94 | $employee\_id = get\_current\_user\_id(); |
  | 97 |  | $artist      = esc\_attr( tmem\_get\_option( 'artist' ) ); |
  |  | 95 | $artist      = esc\_attr( tmem\_get\_option( 'artist' ) ); |
  | 98 | 96 |  |
  | 99 | 97 | tmem\_insert\_datepicker( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L109) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L107) |  |
  | 109 | 107 | <div class="tmem-availability-check-date"> |
  | 110 | 108 | <span class="tmem-repeatable-row-setting-label"> |
  | 111 |  | <?php ~~\_e( 'Date', 'mobile-events-manager' ); ?>~~ |
  |  | 109 | <?php esc\_html\_e( 'Date', 'mobile-events-manager' ); ?> |
  | 112 | 110 | </span> |
  | 113 | 111 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L134) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L132) |  |
  | 134 | 132 | <div class="tmem-event-primary-employee"> |
  | 135 | 133 | <span class="tmem-repeatable-row-setting-label"> |
  | 136 |  | <?php printf( '%s', $artist ); ?> |
  | 137 |  | </span> |
  | 138 |  |  |
  |  | 134 | <?php printf( '%s', $artist ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  |  | 135 | </span> |
  | 139 | 136 | <?php |
  | 140 | 137 | echo TMEM()->html->employee\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L153) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L150) |  |
  | 153 | 150 | <div class="tmem-event-primary-employee"> |
  | 154 | 151 | <span class="tmem-repeatable-row-setting-label"> |
  | 155 |  | <?php \_e( 'Roles', 'mobile-events-manager' ); ?> |
  |  | 152 | <?php esc\_html\_e( 'Roles', 'mobile-events-manager' ); ?> |
  | 156 | 153 | </span> |
  | 157 | 154 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L181) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L178) |  |
  | 181 | 178 | <p><span class="tmem-event-worker-add"> |
  | 182 | 179 | <a id="check-availability" class="button button-secondary"> |
  | 183 |  | <?php \_e( 'Check Availability', 'mobile-events-manager' ); ?> |
  |  | 180 | <?php esc\_html\_e( 'Check Availability', 'mobile-events-manager' ); ?> |
  | 184 | 181 | </a> |
  | 185 | 182 | </span></p> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L193) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L190) |  |
  | 193 | 190 | \* |
  | 194 | 191 | \* @since   1.5.6 |
  | 195 |  | ~~\* @return  string~~ |
  | 196 | 192 | \*/ |
  | 197 | 193 | function tmem\_render\_availability\_page\_calendar() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L206) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L202) |  |
  | 206 | 202 | \* |
  | 207 | 203 | \* @since   1.5.6 |
  | 208 |  | ~~\* @return  string~~ |
  | 209 | 204 | \*/ |
  | 210 | 205 | function tmem\_render\_availability\_absence\_form() { |
  | 211 | 206 | $employee\_id = get\_current\_user\_id(); |
  | 212 |  | $ampm        = 'H:i' != tmem\_get\_option( 'time\_format', 'H:i' ) ? true : false; |
  |  | 207 | $ampm        = 'H:i' !== tmem\_get\_option( 'time\_format', 'H:i' ) ? true : false; |
  | 213 | 208 |  |
  | 214 | 209 | tmem\_insert\_datepicker( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L229) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L224) |  |
  | 229 | 224 | <div class="tmem-custom-event-sections"> |
  | 230 | 225 | <div class="tmem-custom-event-section"> |
  | 231 |  | <span class="tmem-custom-event-section-title"><?php \_e( 'Add Employee Absence', 'mobile-events-manager' ); ?></span> |
  |  | 226 | <span class="tmem-custom-event-section-title"><?php esc\_html\_e( 'Add Employee Absence', 'mobile-events-manager' ); ?></span> |
  | 232 | 227 | <?php if ( tmem\_employee\_can( 'manage\_employees' ) ) : ?> |
  | 233 | 228 | <span class="tmem-employee-option"> |
  | 234 | 229 | <label class="tmem-employee-id"> |
  | 235 |  | <?php \_e( 'Employee', 'mobile-events-manager' ); ?> |
  |  | 230 | <?php esc\_html\_e( 'Employee', 'mobile-events-manager' ); ?> |
  | 236 | 231 | </label> |
  | 237 | 232 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L239) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L234) |  |
  | 239 | 234 | array( |
  | 240 | 235 | 'name'     => 'absence\_employee\_id', |
  | 241 |  | 'selected' => ~~$employee\_id,~~ |
  |  | 236 | 'selected' => $employee\_id, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 242 | 237 | 'group'    => tmem\_is\_employer(), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 243 | 238 | 'chosen'       => true, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L251) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L246) |  |
  | 251 | 246 | array( |
  | 252 | 247 | 'name'  => 'absence\_employee\_id', |
  | 253 |  | 'value' => $employee\_id |
  |  | 248 | 'value' => $employee\_id, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 254 | 249 | ) |
  | 255 | 250 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L259) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L254) |  |
  | 259 | 254 | <span class="tmem-absence-start-option"> |
  | 260 | 255 | <label class="tmem-absence-start"> |
  | 261 |  | <?php \_e( 'From', 'mobile-events-manager' ); ?> |
  |  | 256 | <?php esc\_html\_e( 'From', 'mobile-events-manager' ); ?> |
  | 262 | 257 | </label> |
  | 263 | 258 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L282) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L277) |  |
  | 282 | 277 | <span class="tmem-absence-end-option"> |
  | 283 | 278 | <label class="tmem-absence-end"> |
  | 284 |  | <?php \_e( 'To', 'mobile-events-manager' ); ?> |
  |  | 279 | <?php esc\_html\_e( 'To', 'mobile-events-manager' ); ?> |
  | 285 | 280 | </label> |
  | 286 | 281 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L306) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L301) |  |
  | 306 | 301 | <span class="tmem-absence-allday-option"> |
  | 307 | 302 | <label class="tmem-absence-all-day"> |
  | 308 |  | <?php \_e( 'All day?', 'mobile-events-manager' ); ?> |
  |  | 303 | <?php esc\_html\_e( 'All day?', 'mobile-events-manager' ); ?> |
  | 309 | 304 | </label> |
  | 310 | 305 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L321) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L316) |  |
  | 321 | 316 | <span class="tmem-absence-start-time-option tmem-hidden"> |
  | 322 | 317 | <label class="tmem-absence-start-hour"> |
  | 323 |  | <?php \_e( 'Start time', 'mobile-events-manager' ); ?> |
  |  | 318 | <?php esc\_html\_e( 'Start time', 'mobile-events-manager' ); ?> |
  | 324 | 319 | </label> |
  | 325 | 320 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L350) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L345) |  |
  | 350 | 345 | <span class="tmem-absence-end-time-option"> |
  | 351 | 346 | <label class="tmem-absence-end-hour"> |
  | 352 |  | <?php \_e( 'End time', 'mobile-events-manager' ); ?> |
  |  | 347 | <?php esc\_html\_e( 'End time', 'mobile-events-manager' ); ?> |
  | 353 | 348 | </label> |
  | 354 | 349 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L380) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L375) |  |
  | 380 | 375 | <span class="tmem-absence-notes-option"> |
  | 381 | 376 | <label class="tmem-absence-notes"> |
  | 382 |  | <?php \_e( 'Notes', 'mobile-events-manager' ); ?> |
  |  | 377 | <?php esc\_html\_e( 'Notes', 'mobile-events-manager' ); ?> |
  | 383 | 378 | </label> |
  | 384 | 379 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2625441#L396) | […](/browser/mobile-events-manager/trunk/includes/admin/availability/availability-page.php?rev=2647987#L391) |  |
  | 396 | 391 | <span class="tmem-absence-submit-option"> |
  | 397 | 392 | <button id="add-absence" class="button button-secondary"> |
  | 398 |  | <?php \_e( 'Add Absence', 'mobile-events-manager' ); ?> |
  |  | 393 | <?php esc\_html\_e( 'Add Absence', 'mobile-events-manager' ); ?> |
  | 399 | 394 | </button> |
  | 400 | 395 | </span> |
* ## [mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | 23 | 23 | } |
  | 24 | 24 |  |
  | 25 |  | // Load WP\_List\_Table if not loaded |
  |  | 25 | // Load WP\_List\_Table if not loaded. |
  | 26 | 26 | if ( ! class\_exists( 'WP\_List\_Table' ) ) { |
  | 27 | 27 | require\_once ABSPATH . 'wp-admin/includes/class-wp-list-table.php'; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L38) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L38) |  |
  | 38 | 38 |  |
  | 39 | 39 | /\*\* |
  |  | 40 | \* Show the amount of items. |
  |  | 41 | \* |
  | 40 | 42 | \* @var     int     Number of items per page |
  | 41 | 43 | \* @since   1.4 |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L44) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L46) |  |
  | 44 | 46 |  |
  | 45 | 47 | /\*\* |
  |  | 48 | \* Keys |
  |  | 49 | \* |
  | 46 | 50 | \* @var     obj     Query results |
  | 47 | 51 | \* @since   1.4 |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L59) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L63) |  |
  | 59 | 63 | global $status, $page; |
  | 60 | 64 |  |
  | 61 |  | // Set parent defaults |
  |  | 65 | // Set parent defaults. |
  | 62 | 66 | parent::\_\_construct( |
  | 63 | 67 | array( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L90) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L94) |  |
  | 90 | 94 | \* @since   1.4 |
  | 91 | 95 | \* |
  | 92 |  | \* @param   arr $item           Contains all the data of the keys |
  | 93 |  | \* @param   str $column\_name    The name of the column |
  |  | 96 | \* @param   arr $item           Contains all the data of the keys. |
  |  | 97 | \* @param   str $column\_name    The name of the column. |
  | 94 | 98 | \* |
  | 95 | 99 | \* @return  str     Column Name |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L100) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L104) |  |
  | 100 | 104 |  |
  | 101 | 105 | /\*\* |
  | 102 |  | \* Displays the public key rows |
  | 103 |  | \* |
  | 104 |  | \* @access  public |
  | 105 |  | \* @since   1.4 |
  | 106 |  | \* |
  | 107 |  | \* @param   arr $item           Contains all the data of the keys |
  | 108 |  | \* @param   str $column\_name    The name of the column |
  |  | 106 | \* Displays the public key rows. |
  |  | 107 | \* |
  |  | 108 | \* @access  public |
  |  | 109 | \* @since   1.4 |
  |  | 110 | \* |
  |  | 111 | \* @param   arr $item           Contains all the data of the keys. str $column\_name    The name of the column. |
  | 109 | 112 | \* |
  | 110 | 113 | \* @return string Column Name |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L120) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L123) |  |
  | 120 | 123 | \* @since   1.4 |
  | 121 | 124 | \* |
  | 122 |  | \* @param   arr $item           Contains all the data of the keys |
  | 123 |  | \* @param   str $column\_name    The name of the column |
  |  | 125 | \* @param   arr $item           Contains all the data of the keys. str $column\_name    The name of the column. |
  | 124 | 126 | \* |
  | 125 | 127 | \* @return string Column Name |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L135) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L137) |  |
  | 135 | 137 | \* @since   1.4 |
  | 136 | 138 | \* |
  | 137 |  | \* @param   arr $item           Contains all the data of the keys |
  | 138 |  | \* @param   str $column\_name    The name of the column |
  |  | 139 | \* @param   arr $item Contains all the data of the keys. str $column\_name    The name of the column. |
  | 139 | 140 | \* |
  | 140 | 141 | \* @return string Column Name |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L145) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L146) |  |
  | 145 | 146 |  |
  | 146 | 147 | /\*\* |
  | 147 |  | \* Renders the column for the user field |
  | 148 |  | \* |
  | 149 |  | \* @access  public |
  | 150 |  | \* @since   1.4 |
  | 151 |  | \* @return  void |
  |  | 148 | \* Renders the column for the user field. |
  |  | 149 | \* |
  |  | 150 | \* @access  public |
  |  | 151 | \* @since   1.4 |
  |  | 152 | \* |
  |  | 153 | \* @param   arr $item $which Contains all the data of the keys. |
  | 152 | 154 | \*/ |
  | 153 | 155 | public function column\_user( $item ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L202) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L204) |  |
  | 202 | 204 | \* @access  public |
  | 203 | 205 | \* @since   1.4 |
  | 204 |  | \* @return  arr     $columns    Array of all the list table columns |
  |  | 206 | \* @return  arr     $columns    Array of all the list table columns. |
  | 205 | 207 | \*/ |
  | 206 | 208 | public function get\_columns() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L221) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L223) |  |
  | 221 | 223 | \* @since   1.4 |
  | 222 | 224 | \* @return  void |
  |  | 225 | \* @param str $which Display key gen form. |
  | 223 | 226 | \*/ |
  | 224 | 227 | public function extra\_tablenav( $which = '' ) { |
  | 225 | 228 |  |
  | 226 |  | if ( 'top' != $which ) { |
  |  | 229 | if ( 'top' !== $which ) { |
  | 227 | 230 | return; |
  | 228 | 231 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L250) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L253) |  |
  | 250 | 253 |  |
  | 251 | 254 | /\*\* |
  | 252 |  | \* Generate the table navigation above or below the table |
  |  | 255 | \* Generate the table navigation above or below the table. |
  | 253 | 256 | \* |
  | 254 | 257 | \* @since   1.4 |
  | 255 | 258 | \* @access  protected |
  | 256 |  | \* @param   str $which |
  |  | 259 | \* @param   str $which which. |
  | 257 | 260 | \*/ |
  | 258 | 261 | protected function display\_tablenav( $which ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L282) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L285) |  |
  | 282 | 285 | \* @access  public |
  | 283 | 286 | \* @since   1.4 |
  | 284 |  | \* @return  int     Current page number |
  |  | 287 | \* @return  int     Current page number. |
  | 285 | 288 | \*/ |
  | 286 | 289 | public function get\_paged() { |
  | 287 |  | return isset( $\_GET['paged'] ) ? absint( $\_GET['paged'] ) : 1; |
  |  | 290 | return isset( $\_GET['paged'] ) ? absint( $\_GET['paged'] ) : 1; // phpcs:ignore WordPress.Security.NonceVerification |
  | 288 | 291 | } // get\_paged |
  | 289 | 292 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L293) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L296) |  |
  | 293 | 296 | \* @access  public |
  | 294 | 297 | \* @since   1.4 |
  | 295 |  | ~~\* @return  void~~ |
  | 296 | 298 | \*/ |
  | 297 | 299 | public function query() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2455787#L347) | […](/browser/mobile-events-manager/trunk/includes/admin/class-tmem-api-keys-table.php?rev=2647987#L349) |  |
  | 347 | 349 | \* @access  public |
  | 348 | 350 | \* @since   1.4 |
  | 349 |  | \* @return  str |
  | 350 |  | \*/ |
  | 351 |  | function no\_items() { |
  |  | 351 | \*/ |
  |  | 352 | public function no\_items() { |
  | 352 | 353 | esc\_html\_e( 'No API keys have been generated.', 'mobile-events-manager' ); |
  | 353 | 354 | } // no\_items |
  | 354 | 355 |  |
  | 355 | 356 | /\*\* |
  | 356 |  | \* Setup the final data for the table |
  |  | 357 | \* Setup the final data for the table. |
  | 357 | 358 | \* |
  | 358 | 359 | \* @access  public |
* ## [mobile-events-manager/trunk/includes/admin/communications/comms-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/communications/comms-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L25) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L25) |  |
  | 25 | 25 | \* |
  | 26 | 26 | \* @since   1.3 |
  | 27 |  | ~~\* @param~~ |
  | 28 |  | ~~\* @return  Outputs the page content~~ |
  | 29 | 27 | \*/ |
  | 30 | 28 | function tmem\_comms\_page() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L95) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L93) |  |
  | 95 | 93 | <tr> |
  | 96 | 94 | <th scope="row"><label for="tmem\_email\_subject"><?php esc\_html\_e( 'Subject', 'mobile-events-manager' ); ?></label></th> |
  | 97 |  | <td><input type="text" name="tmem\_email\_subject" id="tmem\_email\_subject" class="regular-text" value="<?php echo isset( $\_GET['template'] ) ? esc\_attr( get\_the\_title( sanitize\_text\_field( wp\_unslash( $\_GET['template'] ) ) ) ) : ''; ?>" /></td> |
  |  | 95 | <td><input type="text" name="tmem\_email\_subject" id="tmem\_email\_subject" class="regular-text" value="<?php echo isset( $\_GET['template'] ) ? esc\_attr( get\_the\_title( sanitize\_text\_field( wp\_unslash( $\_GET['template'] ) ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification ?>" /></td> |
  | 98 | 96 | </tr> |
  | 99 | 97 | <tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L107) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L105) |  |
  | 107 | 105 | <select name="tmem\_email\_template" id="tmem\_email\_template"> |
  | 108 | 106 | <option value="0"><?php esc\_html\_e( 'No Template', 'mobile-events-manager' ); ?></option> |
  | 109 |  | <?php $template = isset( $\_GET['template'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['template'] ) ) : 0; ?> |
  |  | 107 | <?php $template = isset( $\_GET['template'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['template'] ) ) : 0; // phpcs:ignore WordPress.Security.NonceVerification ?> |
  | 110 | 108 | <?php echo tmem\_comms\_template\_options( $template ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 111 | 109 | </select> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L114) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L112) |  |
  | 114 | 112 | <?php do\_action( 'tmem\_add\_comms\_fields\_before\_event' ); ?> |
  | 115 | 113 | <tr> |
  |  | 114 | <?php /\* translators: %s = Staff type \*/ ?> |
  | 116 | 115 | <th scope="row"><label for="tmem\_email\_event"><?php printf( esc\_html\_\_( 'Associated %s', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></label></th> |
  | 117 | 116 | <td> |
  | 118 |  | <?php if ( isset( $\_GET['event\_id'] ) || ( isset( $\_GET['tmem-action'] ) && ~~$\_GET['tmem-action'] == 'respond\_unavailable' ) ) :~~ ?> |
  |  | 117 | <?php if ( isset( $\_GET['event\_id'] ) || ( isset( $\_GET['tmem-action'] ) && 'respond\_unavailable' === $\_GET['tmem-action'] ) ) : // phpcs:ignore WordPress.Security.NonceVerification ?> |
  | 119 | 118 | <?php |
  | 120 |  | $value  = tmem\_get\_event\_date( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ' '; |
  | 121 |  | $value .= esc\_html\_\_( 'from', 'mobile-events-manager' ) . ' '; |
  | 122 |  | $value .= tmem\_get\_event\_start( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ' '; |
  | 123 |  | $value .= '(' . tmem\_get\_event\_status( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ')'; |
  |  | 119 | $value  = tmem\_get\_event\_date( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ' '; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 120 | $value .= esc\_html\_\_( 'from', 'mobile-events-manager' ) . ' '; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 121 | $value .= tmem\_get\_event\_start( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ' '; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 122 | $value .= '(' . tmem\_get\_event\_status( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . ')'; // phpcs:ignore WordPress.Security.NonceVerification |
  | 124 | 123 | ?> |
  | 125 | 124 | <input type="text" name="tmem\_email\_event\_show" id="tmem\_email\_event\_show" value="<?php echo esc\_attr( $value ); ?>" readonly size="50" /> |
  | 126 |  | <input type="hidden" name="tmem\_email\_event" id="tmem\_email\_event" value="<?php echo absint( wp\_unslash( $\_GET['event\_id'] ) ); ?>" /> |
  |  | 125 | <input type="hidden" name="tmem\_email\_event" id="tmem\_email\_event" value="<?php echo absint( wp\_unslash( $\_GET['event\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification ?>" /> |
  | 127 | 126 | <?php else : ?> |
  | 128 | 127 | <select name="tmem\_email\_event" id="tmem\_email\_event"> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L130) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L129) |  |
  | 130 | 129 | </select> |
  | 131 | 130 | <?php endif; ?> |
  |  | 131 | <?php /\* translators: %s placeholder is Event or Events if Plural \*/ ?> |
  | 132 | 132 | <p class="description"><?php printf( \_\_( 'If no %s is selected <code>{event\_\*}</code> content tags may not be used', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?></p> |
  | 133 | 133 | </td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L137) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L137) |  |
  | 137 | 137 | <th scope="row"><label for="tmem\_email\_upload\_file"><?php esc\_html\_e( 'Attach a File', 'mobile-events-manager' ); ?></label></th> |
  | 138 | 138 | <td><input type="file" name="tmem\_email\_upload\_file" id="tmem\_email\_upload\_file" class="regular-text" value="" /> |
  |  | 139 | <?php /\* translators: %d WordPress max file size\*/ ?> |
  | 139 | 140 | <p class="description"><?php printf( \_\_( 'Max file size %dMB. Change php.ini <code>post\_max\_size</code> to increase', 'mobile-events-manager' ), ini\_get( 'post\_max\_size' ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?></p> |
  | 140 | 141 | </td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L144) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L145) |  |
  | 144 | 145 | <td colspan="2"> |
  | 145 | 146 | <?php |
  | 146 |  | $content = isset( $\_GET['template'] ) ? tmem\_get\_email\_template\_content( absint( wp\_unslash( $\_GET['template'] ) ) ) : ''; |
  |  | 147 | $content = isset( $\_GET['template'] ) ? tmem\_get\_email\_template\_content( absint( wp\_unslash( $\_GET['template'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  | 147 | 148 |  |
  | 148 | 149 | wp\_editor( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L171) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L172) |  |
  | 171 | 172 | \* |
  | 172 | 173 | \* @since   1.3 |
  | 173 |  | \* @param   str|arr $type   The type of template to retrieve |
  |  | 174 | \* @param   str|arr $type   The type of template to retrieve. |
  | 174 | 175 | \* @return  obj|bool    WP\_Query object or false if none found |
  | 175 | 176 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L231) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L232) |  |
  | 231 | 232 | \* |
  | 232 | 233 | \* @since   1.3 |
  | 233 |  | \* @param   arr $data   Super global $\_POST array |
  |  | 234 | \* @param   arr $data   Super global $\_POST array. |
  | 234 | 235 | \* @return  void |
  | 235 | 236 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2455787#L309) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms-functions.php?rev=2647987#L310) |  |
  | 309 | 310 | \* |
  | 310 | 311 | \* @since   1.3.3 |
  | 311 |  | ~~\* @param~~ |
  | 312 |  | ~~\* @return~~ |
  | 313 | 312 | \*/ |
  | 314 | 313 | function tmem\_add\_reject\_reason\_field() { |
  | 315 | 314 |  |
  | 316 |  | if ( ! isset( $\_GET['tmem-action'] ) || ~~$\_GET['tmem-action'] != 'respond\_unavailable' ) {~~ |
  | 317 |  | return; |
  |  | 315 | if ( ! isset( $\_GET['tmem-action'] ) || 'respond\_unavailable' !== $\_GET['tmem-action'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 316 | return; |
  | 318 | 317 | } |
  | 319 | 318 |  |
* ## [mobile-events-manager/trunk/includes/admin/communications/comms.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/communications/comms.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/communications/comms.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L8 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L8 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* |
  | 9 | 9 | \* @author: Mike Howard, Jack Mawhinney, Dan Porter |
  |  | 10 | \* @package TMEM |
  | 10 | 11 | \*/ |
  | 11 |  | defined( 'ABSPATH' ) or die( 'Direct access to this page is disabled!!!' ); |
  |  | 12 |  |
  |  | 13 | defined( 'ABSPATH' ) || die( 'Direct access to this page is disabled!!!' ); |
  | 12 | 14 |  |
  | 13 | 15 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L19) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L21) |  |
  | 19 | 21 | \* |
  | 20 | 22 | \* @since   0.5 |
  | 21 |  | \* @param   arr $columns    Array of column names |
  |  | 23 | \* @param   arr $columns    Array of column names. |
  | 22 | 24 | \* @return  arr     $columns    Filtered array of column names |
  | 23 | 25 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L30) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L32) |  |
  | 30 | 32 | 'from'           => \_\_( 'From', 'mobile-events-manager' ), |
  | 31 | 33 | 'recipient'      => \_\_( 'Recipient', 'mobile-events-manager' ), |
  |  | 34 | /\* translators: %s Event/Events placeholder \*/ |
  | 32 | 35 | 'event'          => sprintf( \_\_( '%s', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 33 | 36 | 'current\_status' => \_\_( 'Status', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L47) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L50) |  |
  | 47 | 50 | \* |
  | 48 | 51 | \* @since   0.9 |
  | 49 |  | \* @param   str $column\_name    The name of the column to display |
  | 50 |  | \* @param   int $post\_id        The current post ID |
  | 51 |  | \* @return |
  |  | 52 | \* @param   str $column\_name    The name of the column to display. |
  |  | 53 | \* @param   int $post\_id        The current post ID. |
  | 52 | 54 | \*/ |
  | 53 | 55 | function tmem\_communication\_posts\_custom\_column( $column\_name, $post\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L56) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L58) |  |
  | 56 | 58 |  |
  | 57 | 59 | switch ( $column\_name ) { |
  | 58 |  | // Date Sent |
  |  | 60 | // Date Sent. |
  | 59 | 61 | case 'date\_sent': |
  | 60 |  | echo esc\_html( date( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), get\_post\_meta( $post\_id, '\_date\_sent', true ) ) ); |
  |  | 62 | echo esc\_html( gmdate( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), get\_post\_meta( $post\_id, '\_date\_sent', true ) ) ); |
  | 61 | 63 |  |
  | 62 | 64 | break; |
  | 63 | 65 |  |
  | 64 |  | // From |
  |  | 66 | // From. |
  | 65 | 67 | case 'from': |
  | 66 | 68 | $author = get\_userdata( $post->post\_author ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L74) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L76) |  |
  | 74 | 76 | break; |
  | 75 | 77 |  |
  | 76 |  | // Recipient |
  |  | 78 | // Recipient. |
  | 77 | 79 | case 'recipient': |
  | 78 | 80 | $client = get\_userdata( get\_post\_meta( $post\_id, '\_recipient', true ) ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L100) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L102) |  |
  | 100 | 102 | break; |
  | 101 | 103 |  |
  | 102 |  | // Associated Event |
  |  | 104 | // Associated Event. |
  | 103 | 105 | case 'event': |
  | 104 | 106 | $event\_id = get\_post\_meta( $post\_id, '\_event', true ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L112) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L114) |  |
  | 112 | 114 | break; |
  | 113 | 115 |  |
  | 114 |  | // Status |
  |  | 116 | // Status. |
  | 115 | 117 | case 'current\_status': |
  | 116 | 118 | echo esc\_html( get\_post\_status\_object( $post->post\_status )->label ); |
  | 117 | 119 |  |
  | 118 |  | if ( ! empty( $post->post\_modified ) && 'opened' == $post->post\_status ) { |
  |  | 120 | if ( ! empty( $post->post\_modified ) && 'opened' === $post->post\_status ) { |
  | 119 | 121 | echo '<br />'; |
  | 120 |  | echo '<em>' . esc\_html( date( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $post->post\_modified ) ) ) . '</em>'; |
  |  | 122 | echo '<em>' . esc\_html( gmdate( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $post->post\_modified ) ) ) . '</em>'; |
  | 121 | 123 | } |
  | 122 | 124 |  |
  | 123 | 125 | break; |
  | 124 | 126 |  |
  | 125 |  | // Source |
  |  | 127 | // Source. |
  | 126 | 128 | case 'source': |
  | 127 | 129 | echo esc\_html( wp\_unslash( get\_post\_meta( $post\_id, '\_source', true ) ) ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L137) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L139) |  |
  | 137 | 139 | \* |
  | 138 | 140 | \* @since   1.3 |
  | 139 |  | \* @param   arr $actions    Array of actions |
  |  | 141 | \* @param   arr $actions    Array of actions. |
  | 140 | 142 | \* @return  arr     $actions    Filtered Array of actions |
  | 141 | 143 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L153) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L155) |  |
  | 153 | 155 | \* |
  | 154 | 156 | \* @since   1.0 |
  | 155 |  | \* @param   arr $actions    Current post row actions |
  | 156 |  | \* @param   obj $post       The WP\_Post post object |
  |  | 157 | \* @param   arr $actions    Current post row actions. |
  |  | 158 | \* @param   obj $post       The WP\_Post post object. |
  | 157 | 159 | \*/ |
  | 158 | 160 | function tmem\_communication\_post\_row\_actions( $actions, $post ) { |
  | 159 | 161 |  |
  | 160 |  | if ( ~~$post->post\_type != 'tmem\_communication'~~ ) { |
  |  | 162 | if ( 'tmem\_communication' !== $post->post\_type ) { |
  | 161 | 163 | return $actions; |
  | 162 | 164 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2455787#L171) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/comms.php?rev=2647987#L173) |  |
  | 171 | 173 | \* |
  | 172 | 174 | \* @since   1.3 |
  | 173 |  | ~~\* @param~~ |
  | 174 |  | ~~\* @param~~ |
  | 175 | 175 | \*/ |
  | 176 | 176 | function tmem\_communication\_remove\_add\_new() { |
  | 177 | 177 |  |
  | 178 |  | if ( ! isset( $\_GET['post\_type'] ) || ~~$\_GET['post\_type'] != 'tmem\_communication' ) {~~ |
  |  | 178 | if ( ! isset( $\_GET['post\_type'] ) || 'tmem\_communication' !== $\_GET['post\_type'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 179 | 179 | return; |
  | 180 | 180 | } |
* ## [mobile-events-manager/trunk/includes/admin/communications/contextual-help.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/communications/contextual-help.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2455787#L33) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987#L33) |  |
  | 33 | 33 | $screen = get\_current\_screen(); |
  | 34 | 34 |  |
  | 35 |  | if ( ~~$screen->id != 'tmem-event\_page\_tmem-comms'~~ ) { |
  |  | 35 | if ( 'tmem-event\_page\_tmem-comms' !== $screen->id ) { |
  | 36 | 36 | return; |
  | 37 | 37 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2455787#L39) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987#L39) |  |
  | 39 | 39 | $screen->set\_help\_sidebar( |
  | 40 | 40 | '<p><strong>' . \_\_( 'For more information:', 'mobile-events-manager' ) . '</strong></p>' . |
  | 41 |  | '<p>' . sprintf( |
  |  | 41 | '<p>' . sprintf( /\* translators: %s external link \*/ |
  | 42 | 42 | \_\_( 'Visit the <a href="%s">documentation</a> on the Mobile Events Manager website.', 'mobile-events-manager' ), |
  | 43 | 43 | esc\_url( 'http://mobileeventsmanager.co.uk/support/' ) |
  | 44 | 44 | ) . '</p>' . |
  | 45 |  | '<p>' . sprintf( |
  |  | 45 | '<p>' . sprintf( /\* translators: %s external link \*/ |
  | 46 | 46 | \_\_( 'Join our <a href="%s">Facebook Group</a>.', 'mobile-events-manager' ), |
  | 47 | 47 | esc\_url( 'https://www.facebook.com/groups/mobileeventsmanager/' ) |
  | 48 | 48 | ) . '</p>' . |
  | 49 |  | '<p>' . sprintf( |
  |  | 49 | '<p>' . sprintf( /\* translators: %s external link \*/ |
  | 50 | 50 | \_\_( '<a href="%1$s">Post an issue</a> on <a href="%2$s">GitHub</a>.', 'mobile-events-manager' ), |
  | 51 | 51 | esc\_url( 'https://github.com/tmem/mobile-events-manager/issues' ), |
  | 52 | 52 | esc\_url( 'https://github.com/tmem/mobile-events-manager/' ) |
  | 53 | 53 | ) . '</p>' . |
  | 54 |  | '<p>' . sprintf( |
  |  | 54 | '<p>' . sprintf( /\* translators: %s external link \*/ |
  | 55 | 55 | \_\_( 'View <a href="%s">add-ons</a>.', 'mobile-events-manager' ), |
  | 56 | 56 | esc\_url( 'http://mobileeventsmanager.co.uk/add-ons/' ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2455787#L65) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987#L65) |  |
  | 65 | 65 | 'title'   => \_\_( 'Communications', 'mobile-events-manager' ), |
  | 66 | 66 | 'content' => |
  | 67 |  | '<p>' . sprintf( |
  |  | 67 | '<p>' . sprintf( /\* translators: %1$s Staff Type \*/ |
  | 68 | 68 | \_\_( '<strong>Select a Recipient</strong> - Choose from the dropdown list who your email is to. Users are grouped into Clients and Employees. Once you have selected a recipient the Associated %1$s list will be updated with their active %2$s. This is a required field.', 'mobile-events-manager' ), |
  | 69 | 69 | tmem\_get\_label\_plural(), |
  | 70 | 70 | tmem\_get\_label\_plural( true ) |
  | 71 | 71 | ) . '</p>' . |
  | 72 |  | '<p>' . \_\_( '<strong>Subject</strong> - Enter the subject of your email. If you select a template the subject will be updated to the title of the template. This is a required field.', 'mobile-events-manager' ) . '</p>' . |
  | 73 |  | '<p>' . \_\_( '<strong>Copy Yourself?</strong> - Select this option if you wish to receive a copy of the email. If the settings options have been enabled to copy Admin and/or Employee into Client emails, you may receive a copy regardless of whether or not this option is selected.', 'mobile-events-manager' ) . '</p>' . |
  | 74 |  | '<p>' . \_\_( '<strong>Select a Template</strong> - Choose a pre-defined email or contract template to populate the content field. Anything you have already entered into the content field will be overwritten. If you do not select a template, you will need to manually enter content into the content field.', 'mobile-events-manager' ) . '</p>' . |
  | 75 |  | '<p>' . sprintf( |
  |  | 72 | '<p>' . \_\_( '<strong>Subject</strong> - Enter the subject of your email. If you select a template the subject will be updated to the title of the template. This is a required field.', 'mobile-events-manager' ) . '</p>' . |
  |  | 73 | '<p>' . \_\_( '<strong>Copy Yourself?</strong> - Select this option if you wish to receive a copy of the email. If the settings options have been enabled to copy Admin and/or Employee into Client emails, you may receive a copy regardless of whether or not this option is selected.', 'mobile-events-manager' ) . '</p>' . |
  |  | 74 | '<p>' . \_\_( '<strong>Select a Template</strong> - Choose a pre-defined email or contract template to populate the content field. Anything you have already entered into the content field will be overwritten. If you do not select a template, you will need to manually enter content into the content field.', 'mobile-events-manager' ) . '</p>' . |
  |  | 75 | '<p>' . sprintf( /\* translators: %s Event Staff type %1 Staff $s plural\*/ |
  | 76 | 76 | \_\_( '<strong>Associated %s</strong> - If the Client or Employee you have selected within the <strong>Select a Recipient</strong> field has active %s it is displayed here. Select it to tell TMEM that the email you are sending is associated to this %s and %1$s content tags can be used within the email content.', 'mobile-events-manager' ), |
  | 77 | 77 | tmem\_get\_label\_singular(), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2455787#L79) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/contextual-help.php?rev=2647987#L79) |  |
  | 79 | 79 | tmem\_get\_label\_singular( true ) |
  | 80 | 80 | ) . '</p>' . |
  | 81 |  | '<p>' . \_\_( '<strong>Attach a File</strong> - Enables you to select a file from your computer to the email.', 'mobile-events-manager' ) . '</p>' . |
  | 82 |  | '<p>' . \_\_( '<strong>Content</strong> - If you have selected a template within the <strong>Select a Template</strong> field, this field will be populated with that templates content. You can adjust this content as required. Alternatively, if no template is selected, use this as a free text field for your email content. Content tags are supported and can be entered via the <strong>TMEM</strong> button on the text editor toolbar. Remember this field is resizeable. Drag from the bottom right hand corner to make bigger if necessary. This is a required field.', 'mobile-events-manager' ) . '</p>', |
  |  | 81 | '<p>' . \_\_( '<strong>Attach a File</strong> - Enables you to select a file from your computer to the email.', 'mobile-events-manager' ) . '</p>' . |
  |  | 82 | '<p>' . \_\_( '<strong>Content</strong> - If you have selected a template within the <strong>Select a Template</strong> field, this field will be populated with that templates content. You can adjust this content as required. Alternatively, if no template is selected, use this as a free text field for your email content. Content tags are supported and can be entered via the <strong>TMEM</strong> button on the text editor toolbar. Remember this field is resizeable. Drag from the bottom right hand corner to make bigger if necessary. This is a required field.', 'mobile-events-manager' ) . '</p>', |
  | 83 | 83 | ) |
  | 84 | 84 | ); |
* ## [mobile-events-manager/trunk/includes/admin/communications/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/communications/metaboxes.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L26) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L26) |  |
  | 26 | 26 | \* |
  | 27 | 27 | \* @since   1.3 |
  | 28 |  | ~~\* @param~~ |
  | 29 |  | ~~\* @return~~ |
  | 30 | 28 | \*/ |
  | 31 | 29 | function tmem\_remove\_communication\_meta\_boxes() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L49) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L47) |  |
  | 49 | 47 | \* |
  | 50 | 48 | \* @since   1.3 |
  | 51 |  | \* @param |
  | 52 |  | \* @return |
  |  | 49 | \* @param str $post Venue Add Details. |
  | 53 | 50 | \*/ |
  | 54 | 51 | function tmem\_add\_communication\_meta\_boxes( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L78) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L75) |  |
  | 78 | 75 | ) |
  | 79 | 76 | ); |
  | 80 |  | // Runs before metabox output |
  |  | 77 | // Runs before metabox output. |
  | 81 | 78 | do\_action( 'tmem\_communication\_before\_metaboxes' ); |
  | 82 | 79 |  |
  | 83 |  | // Begin metaboxes |
  |  | 80 | // Begin metaboxes. |
  | 84 | 81 | foreach ( $metaboxes as $metabox ) { |
  | 85 |  | // Dependancy check |
  | 86 |  | if ( ! empty( $metabox['dependancy'] ) && ~~$metabox['dependancy'] === false~~ ) { |
  |  | 82 | // Dependancy check. |
  |  | 83 | if ( ! empty( $metabox['dependancy'] ) && false === $metabox['dependancy'] ) { |
  | 87 | 84 | continue; |
  | 88 | 85 | } |
  | 89 | 86 |  |
  | 90 |  | // Permission check |
  |  | 87 | // Permission check. |
  | 91 | 88 | if ( ! empty( $metabox['permission'] ) && ! tmem\_employee\_can( $metabox['permission'] ) ) { |
  | 92 | 89 | continue; |
  | 93 | 90 | } |
  | 94 | 91 |  |
  | 95 |  | // Callback check |
  |  | 92 | // Callback check. |
  | 96 | 93 | if ( ! is\_callable( $metabox['callback'] ) ) { |
  | 97 | 94 | continue; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L109) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L106) |  |
  | 109 | 106 | } |
  | 110 | 107 |  |
  | 111 |  | // Runs after metabox output |
  |  | 108 | // Runs after metabox output. |
  | 112 | 109 | do\_action( 'tmem\_communication\_after\_metaboxes' ); |
  | 113 | 110 |  |
  | 114 |  | } // tmem\_add\_communication\_meta\_boxes |
  |  | 111 | } // tmem\_add\_communication\_meta\_boxes. |
  | 115 | 112 | add\_action( 'add\_meta\_boxes\_tmem\_communication', 'tmem\_add\_communication\_meta\_boxes' ); |
  | 116 | 113 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L120) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L117) |  |
  | 120 | 117 | \* @since   1.3 |
  | 121 | 118 | \* @param   obj $post       The post object (WP\_Post). |
  | 122 |  | ~~\* @return~~ |
  | 123 | 119 | \*/ |
  | 124 | 120 | function tmem\_communication\_details\_metabox( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L126) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L122) |  |
  | 126 | 122 | do\_action( 'tmem\_pre\_communication\_details\_metabox', $post ); |
  | 127 | 123 |  |
  | 128 |  | wp\_nonce\_field( basename( \_\_FILE\_\_ ), 'tmem\_communication~~' . '~~\_nonce' ); |
  |  | 124 | wp\_nonce\_field( basename( \_\_FILE\_\_ ), 'tmem\_communication\_nonce' ); |
  | 129 | 125 |  |
  | 130 | 126 | $from      = get\_userdata( $post->post\_author ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L144) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L140) |  |
  | 144 | 140 | <?php |
  | 145 | 141 | printf( |
  |  | 142 | /\* translators: %s Date \*/ |
  | 146 | 143 | \_\_( '<strong>Date Sent</strong>: %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 147 | 144 | gmdate( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), get\_post\_meta( $post->ID, '\_date\_sent', true ) ) // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L153) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L150) |  |
  | 153 | 150 | <?php |
  | 154 | 151 | printf( |
  |  | 152 | /\* translators: %1 mailto link %2 email address \*/ |
  | 155 | 153 | \_\_( '<strong>From</strong>: <a href="%1$s">%2$s</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 156 | 154 | esc\_url( admin\_url( "/user-edit.php?user\_id={$from->ID}" ) ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L163) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L161) |  |
  | 163 | 161 | <?php |
  | 164 | 162 | printf( |
  |  | 163 | /\* translators: %1 mailto link %2 email address \*/ |
  | 165 | 164 | \_\_( '<strong>Recipient</strong>: <a href="%1$s">%2$s</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 166 | 165 | esc\_url( admin\_url( "/user-edit.php?user\_id={$recipient->ID}" ) ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L208) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L207) |  |
  | 208 | 207 | echo esc\_html( get\_post\_status\_object( $post->post\_status )->label ); |
  | 209 | 208 |  |
  | 210 |  | if ( ~~$post->post\_status == 'opened'~~ ) { |
  | 211 |  | echo ' ' . esc\_html( date( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $post->post\_modified ) ) ); |
  |  | 209 | if ( 'opened' === $post->post\_status ) { |
  |  | 210 | echo ' ' . esc\_html( gmdate( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $post->post\_modified ) ) ); |
  | 212 | 211 | } |
  | 213 | 212 | ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2455787#L250) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/metaboxes.php?rev=2647987#L249) |  |
  | 250 | 249 | \* @since   1.3 |
  | 251 | 250 | \* @param   obj $post       The post object (WP\_Post). |
  | 252 |  | ~~\* @return~~ |
  | 253 | 251 | \*/ |
  | 254 | 252 | function tmem\_communication\_content\_metabox( $post ) { |
* ## [mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L8 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L8 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* |
  | 9 | 9 | \* @author: Mike Howard, Jack Mawhinney, Dan Porter |
  |  | 10 | \* @package TMEM |
  | 10 | 11 | \*/ |
  | 11 |  | defined( 'ABSPATH' ) or die( 'Direct access to this page is disabled!!!' ); |
  |  | 12 |  |
  |  | 13 | defined( 'ABSPATH' ) || die( 'Direct access to this page is disabled!!!' ); |
  | 12 | 14 |  |
  | 13 | 15 | /\*\* |
  |  | 16 | \* |
  | 14 | 17 | \* Class Name: TMEM\_Communication |
  | 15 | 18 | \* Manages TMEM email communications |
  | 16 | 19 | \*/ |
  | 17 |  |  |
  | 18 | 20 | class TMEM\_Communication { |
  | 19 |  | function \_\_construct() { |
  |  | 21 | public function \_\_construct() { |
  | 20 | 22 |  |
  | 21 | 23 | } // \_\_construct |
  | 22 | 24 |  |
  | 23 |  | /\* |
  | 24 |  | \* ~~i~~nsert\_comm |
  |  | 25 | /\*\* |
  |  | 26 | \* Insert\_comm |
  | 25 | 27 | \* 12/03/2015 |
  |  | 28 | \* |
  | 26 | 29 | \* @since 1.1.2 |
  | 27 | 30 | \* Adds the communication data into the post table |
  | 28 | 31 | \* |
  | 29 |  | \* @param~~: $args => array~~ |
  | 30 |  | \*          required: subject, content, recipient, source, event |
  | 31 |  | \*          optional: status, author, attachments |
  |  | 32 | \* @param array $args Adds the communication data. |
  |  | 33 | \*          required: subject, content, recipient, source, event. |
  |  | 34 | \*          optional: status, author, attachments. |
  | 32 | 35 | \* @return: the post id |
  | 33 | 36 | \*/ |
  | 34 |  | function insert\_comm( $args ) { |
  |  | 37 | private function insert\_comm( $args ) { |
  | 35 | 38 | global $tmem; |
  | 36 | 39 |  |
  | 37 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 40 | if ( TMEM\_DEBUG === true ) { |
  | 38 | 41 | TMEM()->debug->log\_it( 'Starting ' . \_\_METHOD\_\_, true ); |
  | 39 | 42 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L70) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L73) |  |
  | 70 | 73 | $post\_args['comment\_status'] = 'closed'; |
  | 71 | 74 |  |
  | 72 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 75 | if ( TMEM\_DEBUG === true ) { |
  | 73 | 76 | TMEM()->debug->log\_it( '    -- Inserting COMM Post' ); |
  | 74 | 77 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L77) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L80) |  |
  | 77 | 80 |  |
  | 78 | 81 | if ( $comm\_post\_id ) { |
  | 79 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 82 | if ( TMEM\_DEBUG === true ) { |
  | 80 | 83 | TMEM()->debug->log\_it( '    -- COMM post created ' . $comm\_post\_id ); |
  | 81 | 84 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L85) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L88) |  |
  | 85 | 88 | } |
  | 86 | 89 |  |
  | 87 |  | // Process attachments |
  |  | 90 | // Process attachments. |
  | 88 | 91 | if ( ! empty( $args['attachments'] ) && is\_array( $args['attachments'] ) ) { |
  | 89 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 92 | if ( TMEM\_DEBUG === true ) { |
  | 90 | 93 | TMEM()->debug->log\_it( '    -- This email has attachments' ); |
  | 91 | 94 | } |
  | 92 | 95 |  |
  | 93 | 96 | foreach ( $args['attachments'] as $file ) { |
  | 94 |  | // Make sure the file exists |
  |  | 97 | // Make sure the file exists. |
  | 95 | 98 | if ( ! file\_exists( $file ) ) { |
  | 96 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 99 | if ( TMEM\_DEBUG === true ) { |
  | 97 | 100 | TMEM()->debug->log\_it( '    -- ERROR: Attachment not found, will not process' ); |
  | 98 | 101 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L118) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L121) |  |
  | 118 | 121 |  |
  | 119 | 122 | if ( $attach\_id ) { |
  | 120 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 123 | if ( TMEM\_DEBUG === true ) { |
  | 121 | 124 | TMEM()->debug->log\_it( '    -- Attachment post inserted successfully. ID ' . $attach\_id ); |
  | 122 | 125 | } |
  | 123 | 126 | } else { |
  | 124 |  | if ( TMEM\_DEBUG == true ) { |
  |  | 127 | if ( TMEM\_DEBUG === true ) { |
  | 125 | 128 | TMEM()->debug->log\_it( '    -- Attachment post could not be inserted' ); |
  | 126 | 129 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L134) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L137) |  |
  | 134 | 137 | wp\_update\_attachment\_metadata( $attach\_id, $attach\_data ); |
  | 135 | 138 |  |
  | 136 |  | } // End foreach~~( $args['attachments'] as $file )~~ |
  |  | 139 | } // End foreach |
  | 137 | 140 | } // Attachments |
  | 138 | 141 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L140) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L143) |  |
  | 140 | 143 | } // insert\_comm |
  | 141 | 144 |  |
  | 142 |  | /\* |
  | 143 |  | ~~i~~nsert\_stat\_image |
  |  | 145 | /\*\* |
  |  | 146 | \* Insert\_stat\_image |
  | 144 | 147 | \* 13/03/2015 |
  |  | 148 | \* |
  | 145 | 149 | \* @since 1.1.2 |
  | 146 | 150 | \* Inserts the stat tracker image |
  | 147 |  | \* @param~~: $p => the post ID~~ |
  | 148 |  | \*/ |
  | 149 |  | function insert\_stat\_image( $p ) { |
  | 150 |  | if ( empty( $p ) || tmem\_get\_option( 'track\_client\_emails' ) != true ) { |
  |  | 151 | \* @param str $p The Post ID. |
  |  | 152 | \*/ |
  |  | 153 | private function insert\_stat\_image( $p ) { |
  |  | 154 | if ( empty( $p ) || tmem\_get\_option( 'track\_client\_emails' ) !== true ) { |
  | 151 | 155 | return; |
  | 152 | 156 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L158) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L162) |  |
  | 158 | 162 | } // insert\_stat\_image |
  | 159 | 163 |  |
  | 160 |  | /\* |
  | 161 |  | ~~t~~rack\_email\_open |
  |  | 164 | /\*\* |
  |  | 165 | \* Track\_email\_open |
  | 162 | 166 | \* 13/03/2015 |
  |  | 167 | \* |
  | 163 | 168 | \* @since 1.1.2 |
  | 164 | 169 | \* Records the opening of an email |
  | 165 |  | \* @param~~: $p => the post ID~~ |
  | 166 |  | \*/ |
  | 167 |  | function track\_email\_open( $p ) { |
  | 168 |  | if ( empty( $p ) || get\_post\_status( $p ) == 'opened' ) { |
  |  | 170 | \* @param str $p The post ID. |
  |  | 171 | \*/ |
  |  | 172 | private function track\_email\_open( $p ) { |
  |  | 173 | if ( empty( $p ) || get\_post\_status( $p ) === 'opened' ) { |
  | 169 | 174 | return; |
  | 170 | 175 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2455787#L200) | […](/browser/mobile-events-manager/trunk/includes/admin/communications/tmem-communications.php?rev=2647987#L205) |  |
  | 200 | 205 | } // track\_email\_open |
  | 201 | 206 |  |
  | 202 |  | /\* |
  | 203 |  | ~~c~~hange\_email\_status |
  |  | 207 | /\*\* |
  |  | 208 | \* Change\_email\_status |
  | 204 | 209 | \* 13/03/2015 |
  |  | 210 | \* |
  | 205 | 211 | \* @since 1.1.2 |
  | 206 | 212 | \* Changes the current status of an email |
  | 207 |  | \* @param: $p => the post ID |
  | 208 |  | \*/ |
  | 209 |  | function change\_email\_status( $p, $status ) { |
  |  | 213 | \* @param str $p The post ID. |
  |  | 214 | \* @param str $status Status of the Email. |
  |  | 215 | \*/ |
  |  | 216 | private function change\_email\_status( $p, $status ) { |
  | 210 | 217 |  |
  | 211 | 218 | if ( empty( $p ) || empty( $status ) ) { |
* ## [mobile-events-manager/trunk/includes/admin/dashboard-widgets.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/dashboard-widgets.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L26) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L26) |  |
  | 26 | 26 | \* |
  | 27 | 27 | \* @since   1.3 |
  | 28 |  | ~~\* @param~~ |
  | 29 |  | ~~\* @return~~ |
  | 30 | 28 | \*/ |
  | 31 | 29 | function tmem\_add\_wp\_dashboard\_widgets() { |
  | 32 |  |  |
  |  | 30 | /\* translators: %s Event/Events \*/ |
  | 33 | 31 | wp\_add\_dashboard\_widget( 'tmem-widget-overview', sprintf( \_\_( '%s Overview', 'mobile-events-manager' ), tmem\_get\_option( 'company\_name', 'TMEM' ) ), 'tmem\_widget\_events\_overview' ); |
  | 34 | 32 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L40) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L38) |  |
  | 40 | 38 | \* |
  | 41 | 39 | \* @since   1.3 |
  | 42 |  | ~~\* @param~~ |
  | 43 |  | ~~\* @return~~ |
  | 44 | 40 | \*/ |
  | 45 | 41 | function tmem\_widget\_events\_overview() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L62) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L58) |  |
  | 62 | 58 | ); |
  | 63 | 59 | $enquiry\_periods   = array( |
  | 64 |  | 'month'     => date( 'Y-m-01' ), |
  | 65 |  | 'this\_year' => date( 'Y-01-01' ), |
  | 66 |  | 'last\_year' => date( 'Y-01-01', strtotime( '-1 year' ) ), |
  |  | 60 | 'month'     => gmdate( 'Y-m-01' ), |
  |  | 61 | 'this\_year' => gmdate( 'Y-01-01' ), |
  |  | 62 | 'last\_year' => gmdate( 'Y-01-01', strtotime( '-1 year' ) ), |
  | 67 | 63 | ); |
  | 68 | 64 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L71) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L67) |  |
  | 71 | 67 | array( |
  | 72 | 68 | 'start-date' => $date, |
  | 73 |  | 'end-date'   => ~~$period != 'last\_year' ? date( 'Y-m-d' ) :~~ date( 'Y-12-31', strtotime( '-1 year' ) ), |
  |  | 69 | 'end-date'   => 'last\_year' !== $period ? gmdate( 'Y-m-d' ) : gmdate( 'Y-12-31', strtotime( '-1 year' ) ), |
  | 74 | 70 | ) |
  | 75 | 71 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L90) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L86) |  |
  | 90 | 86 | ); |
  | 91 | 87 | $event\_periods    = array( |
  | 92 |  | 'month'     => array( ~~date( 'Y-m-01' ),~~ date( 'Y-m-d' ) ), |
  | 93 |  | 'this\_year' => array( ~~date( 'Y-01-01' ),~~ date( 'Y-m-d' ) ), |
  | 94 |  | 'last\_year' => array( ~~date( 'Y-m-01', strtotime( '-1 year' ) ),~~ date( 'Y-12-31', strtotime( '-1 year' ) ) ), |
  |  | 88 | 'month'     => array( gmdate( 'Y-m-01' ), gmdate( 'Y-m-d' ) ), |
  |  | 89 | 'this\_year' => array( gmdate( 'Y-01-01' ), gmdate( 'Y-m-d' ) ), |
  |  | 90 | 'last\_year' => array( gmdate( 'Y-m-01', strtotime( '-1 year' ) ), gmdate( 'Y-12-31', strtotime( '-1 year' ) ) ), |
  | 95 | 91 | ); |
  | 96 | 92 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L108) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L104) |  |
  | 108 | 104 | } |
  | 109 | 105 |  |
  | 110 |  | $income\_month  = $stats->get\_income\_by\_date( null, ~~date( 'n' ),~~ date( 'Y' ) ); |
  | 111 |  | $income\_year   = $stats->get\_income\_by\_date( null, '', date( 'Y' ) ); |
  | 112 |  | $income\_last   = $stats->get\_income\_by\_date( null, '', date( 'Y' ) - 1 ); |
  | 113 |  | $expense\_month = $stats->get\_expenses\_by\_date( null, ~~date( 'n' ),~~ date( 'Y' ) ); |
  | 114 |  | $expense\_year  = $stats->get\_expenses\_by\_date( null, '', date( 'Y' ) ); |
  | 115 |  | $expense\_last  = $stats->get\_expenses\_by\_date( null, '', date( 'Y' ) - 1 ); |
  |  | 106 | $income\_month  = $stats->get\_income\_by\_date( null, gmdate( 'n' ), gmdate( 'Y' ) ); |
  |  | 107 | $income\_year   = $stats->get\_income\_by\_date( null, '', gmdate( 'Y' ) ); |
  |  | 108 | $income\_last   = $stats->get\_income\_by\_date( null, '', gmdate( 'Y' ) - 1 ); |
  |  | 109 | $expense\_month = $stats->get\_expenses\_by\_date( null, gmdate( 'n' ), gmdate( 'Y' ) ); |
  |  | 110 | $expense\_year  = $stats->get\_expenses\_by\_date( null, '', gmdate( 'Y' ) ); |
  |  | 111 | $expense\_last  = $stats->get\_expenses\_by\_date( null, '', gmdate( 'Y' ) - 1 ); |
  | 116 | 112 |  |
  | 117 | 113 | $earnings\_month = $income\_month - $expense\_month; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L128) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L124) |  |
  | 128 | 124 | <th><?php esc\_html\_e( 'MTD', 'mobile-events-manager' ); ?></th> |
  | 129 | 125 | <th><?php esc\_html\_e( 'YTD', 'mobile-events-manager' ); ?></th> |
  | 130 |  | <th><?php echo esc\_html( date( 'Y', strtotime( '-1 year' ) ) ); ?></th> |
  |  | 126 | <th><?php echo esc\_html( gmdate( 'Y', strtotime( '-1 year' ) ) ); ?></th> |
  | 131 | 127 | </tr> |
  | 132 | 128 | </thead> |
  | 133 | 129 | <tbody> |
  | 134 | 130 | <tr> |
  |  | 131 | <?php /\* translators: % Enquiry or Enquiries \*/ ?> |
  | 135 | 132 | <th><?php printf( esc\_html\_\_( '%s Received', 'mobile-events-manager' ), esc\_html( get\_post\_status\_object( 'tmem-enquiry' )->plural ) ); ?></th> |
  | 136 | 133 | <td><?php echo esc\_html( $enquiry\_counts['month'] ); ?></td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L139) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L136) |  |
  | 139 | 136 | </tr> |
  | 140 | 137 | <tr> |
  |  | 138 | <?php /\* translators: % Enquiry or Enquiries \*/ ?> |
  | 141 | 139 | <th><?php printf( esc\_html\_\_( '%s Converted', 'mobile-events-manager' ), esc\_html( get\_post\_status\_object( 'tmem-enquiry' )->plural ) ); ?></th> |
  | 142 | 140 | <td><?php echo esc\_html( $conversion\_counts['month'] ); ?></td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L145) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L143) |  |
  | 145 | 143 | </tr> |
  | 146 | 144 | <tr> |
  |  | 145 | <?php /\* translators: % Enquiry or Enquiries \*/ ?> |
  | 147 | 146 | <th><?php printf( esc\_html\_\_( '%s Completed', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_plural() ) ); ?></th> |
  | 148 | 147 | <td><?php echo esc\_html( $completed\_counts['month'] ); ?></td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L174) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L173) |  |
  | 174 | 173 | <?php |
  | 175 | 174 | printf( |
  |  | 175 | /\* translators: %1 HTML ling $2 Create Event $s Plural handler \*/ |
  | 176 | 176 | \_\_( '<a href="%1$s">Create %2$s</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 177 | 177 | admin\_url( 'post-new.php?post\_type=tmem-event' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L182) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L182) |  |
  | 182 | 182 | <?php |
  | 183 | 183 | printf( |
  |  | 184 | /\* translators: %1 HTML ling $2 Manage Event $s Plural handler \*/ |
  | 184 | 185 | \_\_( '<a href="%1$s">Manage %2$s</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 185 | 186 | admin\_url( 'edit.php?post\_type=tmem-event' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L190) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L191) |  |
  | 190 | 191 | <?php |
  | 191 | 192 | printf( |
  |  | 193 | /\* translators: %s HTML \*/ |
  | 192 | 194 | \_\_( '<a href="%s">Transactions</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 193 | 195 | admin\_url( 'edit.php?post\_type=tmem-transaction' ) // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L197) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L199) |  |
  | 197 | 199 | <?php |
  | 198 | 200 | printf( |
  |  | 201 | /\* translators: %s HTML \*/ |
  | 199 | 202 | \_\_( '<a href="%s">Settings</a>', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 200 | 203 | admin\_url( 'admin.php?page=tmem-settings' ) // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L209) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L212) |  |
  | 209 | 212 | <?php foreach ( $sources as $count => $source ) : ?> |
  | 210 | 213 | <p> |
  | 211 |  | <?php printf( \_\_( '<p>Most enquiries have been received via <strong>%1$s (%2$d)</strong> so far this month.', 'mobile-events-manager' ), esc\_html( $source ), (int) $count ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  |  | 214 | <?php /\* translators: %1 Enquiry Source %2 Amount \*/ ?> |
  |  | 215 | <?php printf( \_\_( '<p>Most enquiries have been received via <strong>%1$s (%2$d)</strong> so far this month.', 'mobile-events-manager' ), esc\_html( $source ), (int) $count ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 212 | 216 | </p> |
  | 213 | 217 | <?php endforeach; ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L230) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L234) |  |
  | 230 | 234 | \* |
  | 231 | 235 | \* @since   1.4 |
  | 232 |  | \* @~~return  void~~ |
  |  | 236 | \* @param str $items Number of Event Items. |
  | 233 | 237 | \*/ |
  | 234 | 238 | function tmem\_dashboard\_at\_a\_glance\_widget( $items ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2455787#L244) | […](/browser/mobile-events-manager/trunk/includes/admin/dashboard-widgets.php?rev=2647987#L248) |  |
  | 244 | 248 |  |
  | 245 | 249 | if ( $num\_posts && $count > 0 ) { |
  |  | 250 | /\* translators: %s Event count \*/ |
  | 246 | 251 | $text = \_n( '%s ' . tmem\_get\_label\_singular(), '%s ' . tmem\_get\_label\_plural(), $count, 'mobile-events-manager' ); |
  | 247 | 252 |  |
* ## [mobile-events-manager/trunk/includes/admin/equipment/equipment.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/equipment/equipment.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/equipment/equipment.php")

  | [r2579516](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L17 "Show revision 2579516 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L26) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L26) |  |
  | 26 | 26 | \* |
  | 27 | 27 | \* @since   1.4 |
  | 28 |  | \* @param   arr $columns    Array of column names |
  |  | 28 | \* @param   arr $columns    Array of column names. |
  | 29 | 29 | \* @return  arr     $columns    Filtered array of column names |
  | 30 | 30 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L39) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L39) |  |
  | 39 | 39 | 'package\_category' => $category\_labels['column\_name'], |
  | 40 | 40 | 'availability'     => \_\_( 'Availability', 'mobile-events-manager' ), |
  |  | 41 | /\* translators: %s Event Events Types \*/ |
  | 41 | 42 | 'event\_types'      => sprintf( \_\_( '%s Types', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 42 | 43 | 'employees'        => \_\_( 'Employees', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L57) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L58) |  |
  | 57 | 58 | \* |
  | 58 | 59 | \* @since   1.4 |
  | 59 |  | \* @param   arr $sortable\_columns   Array of package post sortable columns |
  |  | 60 | \* @param   arr $sortable\_columns   Array of package post sortable columns. |
  | 60 | 61 | \* @return  arr     $sortable\_columns   Filtered Array of package post sortable columns |
  | 61 | 62 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L71) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L72) |  |
  | 71 | 72 | \* |
  | 72 | 73 | \* @since   1.4 |
  | 73 |  | \* @param   str $column\_name    The name of the column to display |
  | 74 |  | \* @param   int $post\_id        The current post ID |
  | 75 |  | \* @return |
  |  | 74 | \* @param   str $column\_name    The name of the column to display. |
  |  | 75 | \* @param   int $post\_id        The current post ID. |
  | 76 | 76 | \*/ |
  | 77 | 77 | function tmem\_package\_posts\_custom\_column( $column\_name, $post\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L79) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L79) |  |
  | 79 | 79 |  |
  | 80 | 80 | switch ( $column\_name ) { |
  | 81 |  | // Items |
  |  | 81 | // Items. |
  | 82 | 82 | case 'items': |
  | 83 | 83 | $items = tmem\_get\_package\_addons( $post\_id ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L96) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L96) |  |
  | 96 | 96 | break; |
  | 97 | 97 |  |
  | 98 |  | // Category |
  |  | 98 | // Category. |
  | 99 | 99 | case 'package\_category': |
  | 100 | 100 | echo get\_the\_term\_list( $post\_id, 'package-category', '', ', ', '' ); |
  | 101 | 101 | break; |
  | 102 | 102 |  |
  | 103 |  | // Availability |
  |  | 103 | // Availability. |
  | 104 | 104 | case 'availability': |
  | 105 | 105 | $output = array(); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L122) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L122) |  |
  | 122 | 122 | } |
  | 123 | 123 |  |
  | 124 |  | echo implode( ', '~~, $output );~~ |
  | 125 |  |  |
  | 126 |  | break; |
  | 127 |  |  |
  | 128 |  | // Event Types |
  |  | 124 | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 125 |  |
  |  | 126 | break; |
  |  | 127 |  |
  |  | 128 | // Event Types. |
  | 129 | 129 | case 'event\_types': |
  | 130 | 130 | $output      = array(); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L137) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L137) |  |
  | 137 | 137 |  |
  | 138 | 138 | if ( in\_array( 'all', $event\_types ) ) { |
  |  | 139 | /\* translators: %s Event or Events \*/ |
  | 139 | 140 | $output[] = sprintf( \_\_( 'All %s Types', 'mobile-events-manager' ), $event\_label ); |
  | 140 | 141 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L148) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L149) |  |
  | 148 | 149 | } |
  | 149 | 150 |  |
  | 150 |  | echo implode( ', ', ~~esc\_html( $output )~~ ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 151 |  |  |
  | 152 |  | break; |
  | 153 |  |  |
  | 154 |  | // Employees |
  |  | 151 | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 152 |  |
  |  | 153 | break; |
  |  | 154 |  |
  |  | 155 | // Employees. |
  | 155 | 156 | case 'employees': |
  | 156 | 157 | $employees = tmem\_get\_employees\_with\_package( $post\_id ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L161) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L162) |  |
  | 161 | 162 | } else { |
  | 162 | 163 | foreach ( $employees as $employee ) { |
  | 163 |  | if ( 'all' == $employee ) { |
  |  | 164 | if ( 'all' === $employee ) { |
  | 164 | 165 | continue; |
  | 165 | 166 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L171) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L172) |  |
  | 171 | 172 | break; |
  | 172 | 173 |  |
  | 173 |  | // Price |
  |  | 174 | // Price. |
  | 174 | 175 | case 'price': |
  | 175 | 176 | if ( tmem\_package\_has\_variable\_prices( $post\_id ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L200) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L201) |  |
  | 200 | 201 | \* |
  | 201 | 202 | \* @since   1.4 |
  | 202 |  | \* @param   str $title  Current post placeholder title |
  |  | 203 | \* @param   str $title  Current post placeholder title. |
  | 203 | 204 | \* @return  str     $title  Post placeholder title |
  | 204 | 205 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L207) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L208) |  |
  | 207 | 208 | $screen = get\_current\_screen(); |
  | 208 | 209 |  |
  | 209 |  | if ( 'tmem-package' == $screen->post\_type ) { |
  |  | 210 | if ( 'tmem-package' === $screen->post\_type ) { |
  | 210 | 211 | $title = \_\_( 'Enter a name for this package', 'mobile-events-manager' ); |
  | 211 | 212 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L220) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L221) |  |
  | 220 | 221 | \* |
  | 221 | 222 | \* @since   1.4 |
  | 222 |  | \* @param   obj $query      The WP\_Query object |
  |  | 223 | \* @param   obj $query      The WP\_Query object. |
  | 223 | 224 | \* @return  void |
  | 224 | 225 | \*/ |
  | 225 | 226 | function tmem\_package\_post\_order( $query ) { |
  | 226 | 227 |  |
  | 227 |  | if ( ! is\_admin() || 'tmem-package' != $query->get( 'post\_type' ) ) { |
  |  | 228 | if ( ! is\_admin() || 'tmem-package' !== $query->get( 'post\_type' ) ) { |
  | 228 | 229 | return; |
  | 229 | 230 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L252) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L253) |  |
  | 252 | 253 | \* |
  | 253 | 254 | \* @since   1.4 |
  | 254 |  | \* @param   arr $query      The WP\_Query |
  |  | 255 | \* @param   arr $query      The WP\_Query. |
  | 255 | 256 | \* @return  void |
  | 256 | 257 | \*/ |
  | 257 | 258 | function tmem\_limit\_results\_to\_employee\_packages( $query ) { |
  | 258 | 259 |  |
  | 259 |  | if ( ! is\_admin() || 'tmem-package' != $query->get( 'post\_type' ) || tmem\_employee\_can( 'tmem\_package\_edit' ) ) { |
  |  | 260 | if ( ! is\_admin() || 'tmem-package' !== $query->get( 'post\_type' ) || tmem\_employee\_can( 'tmem\_package\_edit' ) ) { |
  | 260 | 261 | return; |
  | 261 | 262 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L288) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L289) |  |
  | 288 | 289 | function tmem\_save\_package\_post( $post\_id, $post ) { |
  | 289 | 290 |  |
  | 290 |  | if ( ! isset( $\_POST['tmem\_package\_meta\_box\_nonce'] ) || ! wp\_verify\_nonce( $\_POST['tmem\_package\_meta\_box\_nonce'], 'tmem-package' ) ) { |
  |  | 291 | if ( ! isset( $\_POST['tmem\_package\_meta\_box\_nonce'] ) || ! wp\_verify\_nonce( $\_POST['tmem\_package\_meta\_box\_nonce'], 'tmem-package' ) ) { // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 291 | 292 | return; |
  | 292 | 293 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L296) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L297) |  |
  | 296 | 297 | } |
  | 297 | 298 |  |
  | 298 |  | if ( isset( $post->post\_type ) && 'revision' == $post->post\_type ) { |
  | 299 |  | return; |
  | 300 |  | } |
  | 301 |  |  |
  | 302 |  | // The default fields that get saved |
  |  | 299 | if ( isset( $post->post\_type ) && 'revision' === $post->post\_type ) { |
  |  | 300 | return; |
  |  | 301 | } |
  |  | 302 |  |
  |  | 303 | // The default fields that get saved. |
  | 303 | 304 | $fields = tmem\_packages\_metabox\_fields(); |
  | 304 | 305 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L332) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L333) |  |
  | 332 | 333 | function tmem\_deleting\_package( $post\_id ) { |
  | 333 | 334 |  |
  | 334 |  | if ( 'tmem-package' != get\_post\_type( $post\_id ) ) { |
  |  | 335 | if ( 'tmem-package' !== get\_post\_type( $post\_id ) ) { |
  | 335 | 336 | return; |
  | 336 | 337 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L350) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L351) |  |
  | 350 | 351 | \* |
  | 351 | 352 | \* @since   1.4 |
  | 352 |  | \* @param   arr $columns    Array of column names |
  |  | 353 | \* @param   arr $columns    Array of column names. |
  | 353 | 354 | \* @return  arr     $columns    Filtered array of column names |
  | 354 | 355 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L362) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L363) |  |
  | 362 | 363 | 'addon\_category' => $category\_labels['column\_name'], |
  | 363 | 364 | 'availability'   => \_\_( 'Availability', 'mobile-events-manager' ), |
  |  | 365 | /\* translators: %s Event Types \*/ |
  | 364 | 366 | 'event\_types'    => sprintf( \_\_( '%s Types', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 365 | 367 | 'employees'      => \_\_( 'Employees', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L380) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L382) |  |
  | 380 | 382 | \* |
  | 381 | 383 | \* @since   1.4 |
  | 382 |  | \* @param   arr $sortable\_columns   Array of addon post sortable columns |
  |  | 384 | \* @param   arr $sortable\_columns   Array of addon post sortable columns. |
  | 383 | 385 | \* @return  arr     $sortable\_columns   Filtered Array of addon post sortable columns |
  | 384 | 386 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L391) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L393) |  |
  | 391 | 393 |  |
  | 392 | 394 | /\*\* |
  | 393 |  | \* Define the data to be displayed in each of the custom columns for the Addon post types |
  | 394 |  | \* |
  | 395 |  | \* @since   1.4 |
  | 396 |  | \* @param   str $column\_name    The name of the column to display |
  | 397 |  | \* @param   int $post\_id        The current post ID |
  | 398 |  | \* @return |
  |  | 395 | \* Define the data to be displayed in each of the custom columns for the Addon post types. |
  |  | 396 | \* |
  |  | 397 | \* @since   1.4 |
  |  | 398 | \* @param   str $column\_name    The name of the column to display. |
  |  | 399 | \* @param   int $post\_id        The current post ID. |
  | 399 | 400 | \*/ |
  | 400 | 401 | function tmem\_addon\_posts\_custom\_column( $column\_name, $post\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L402) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L403) |  |
  | 402 | 403 |  |
  | 403 | 404 | switch ( $column\_name ) { |
  | 404 |  | // Category |
  |  | 405 | // Category. |
  | 405 | 406 | case 'addon\_category': |
  | 406 | 407 | echo get\_the\_term\_list( $post\_id, 'addon-category', '', ', ', '' ); |
  | 407 | 408 | break; |
  | 408 | 409 |  |
  | 409 |  | // Availability |
  |  | 410 | // Availability. |
  | 410 | 411 | case 'availability': |
  | 411 | 412 | $output = array(); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L428) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L429) |  |
  | 428 | 429 | } |
  | 429 | 430 |  |
  | 430 |  | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 431 |  |  |
  | 432 |  | break; |
  | 433 |  |  |
  | 434 |  | // Event Types |
  |  | 431 | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 432 |  |
  |  | 433 | break; |
  |  | 434 |  |
  |  | 435 | // Event Types. |
  | 435 | 436 | case 'event\_types': |
  | 436 | 437 | $output      = array(); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L439) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L440) |  |
  | 439 | 440 |  |
  | 440 | 441 | if ( in\_array( 'all', $event\_types ) ) { |
  |  | 442 | /\* translators: %s Event or Events \*/ |
  | 441 | 443 | $output[] = sprintf( \_\_( 'All %s Types', 'mobile-events-manager' ), $event\_label ); |
  | 442 | 444 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L450) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L452) |  |
  | 450 | 452 | } |
  | 451 | 453 |  |
  | 452 |  | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 453 |  |  |
  | 454 |  | break; |
  | 455 |  |  |
  | 456 |  | // Employees |
  |  | 454 | echo implode( ', ', $output ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 455 |  |
  |  | 456 | break; |
  |  | 457 |  |
  |  | 458 | // Employees. |
  | 457 | 459 | case 'employees': |
  | 458 | 460 | $employees = tmem\_get\_employees\_with\_addon( $post\_id ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L463) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L465) |  |
  | 463 | 465 | } else { |
  | 464 | 466 | foreach ( $employees as $employee ) { |
  | 465 |  | if ( 'all' == $employee ) { |
  |  | 467 | if ( 'all' === $employee ) { |
  | 466 | 468 | continue; |
  | 467 | 469 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L473) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L475) |  |
  | 473 | 475 | break; |
  | 474 | 476 |  |
  | 475 |  | // Price |
  |  | 477 | // Price. |
  | 476 | 478 | case 'price': |
  | 477 | 479 | if ( tmem\_addon\_has\_variable\_prices( $post\_id ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L488) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L490) |  |
  | 488 | 490 | break; |
  | 489 | 491 |  |
  | 490 |  | // Usage |
  |  | 492 | // Usage. |
  | 491 | 493 | case 'usage': |
  | 492 | 494 | $packages = tmem\_count\_packages\_with\_addon( $post\_id ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L507) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L509) |  |
  | 507 | 509 | \* |
  | 508 | 510 | \* @since   1.4 |
  | 509 |  | \* @param   str $title  Current post placeholder title |
  |  | 511 | \* @param   str $title  Current post placeholder title. |
  | 510 | 512 | \* @return  str     $title  Post placeholder title |
  | 511 | 513 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L514) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L516) |  |
  | 514 | 516 | $screen = get\_current\_screen(); |
  | 515 | 517 |  |
  | 516 |  | if ( 'tmem-addon' == $screen->post\_type ) { |
  |  | 518 | if ( 'tmem-addon' === $screen->post\_type ) { |
  | 517 | 519 | $title = \_\_( 'Enter a name for this add-on', 'mobile-events-manager' ); |
  | 518 | 520 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L527) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L529) |  |
  | 527 | 529 | \* |
  | 528 | 530 | \* @since   1.4 |
  | 529 |  | \* @param   obj $query      The WP\_Query object |
  |  | 531 | \* @param   obj $query      The WP\_Query object. |
  | 530 | 532 | \* @return  void |
  | 531 | 533 | \*/ |
  | 532 | 534 | function tmem\_addon\_post\_order( $query ) { |
  | 533 | 535 |  |
  | 534 |  | if ( ! is\_admin() || 'tmem-addon' != $query->get( 'post\_type' ) ) { |
  |  | 536 | if ( ! is\_admin() || 'tmem-addon' !== $query->get( 'post\_type' ) ) { |
  | 535 | 537 | return; |
  | 536 | 538 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L559) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L561) |  |
  | 559 | 561 | \* |
  | 560 | 562 | \* @since   1.4 |
  | 561 |  | \* @param   arr $query      The WP\_Query |
  |  | 563 | \* @param   arr $query      The WP\_Query. |
  | 562 | 564 | \* @return  void |
  | 563 | 565 | \*/ |
  | 564 | 566 | function tmem\_limit\_results\_to\_employee\_addons( $query ) { |
  | 565 | 567 |  |
  | 566 |  | if ( ! is\_admin() || 'tmem-addon' != $query->get( 'post\_type' ) || tmem\_employee\_can( 'tmem\_package\_edit' ) ) { |
  |  | 568 | if ( ! is\_admin() || 'tmem-addon' !== $query->get( 'post\_type' ) || tmem\_employee\_can( 'tmem\_package\_edit' ) ) { |
  | 567 | 569 | return; |
  | 568 | 570 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L588) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L590) |  |
  | 588 | 590 | \* |
  | 589 | 591 | \* @since   1.3 |
  | 590 |  | \* @param   arr $caps       The users actual capabilities |
  | 591 |  | \* @param   str $cap        The capability name |
  | 592 |  | \* @param   int $user\_id    The user ID |
  |  | 592 | \* @param   arr $caps       The users actual capabilities. |
  |  | 593 | \* @param   str $cap        The capability name. |
  |  | 594 | \* @param   int $user\_id    The user ID. |
  | 593 | 595 | \* @param   arr $args       Adds the context to the cap. Typically the object ID. |
  | 594 | 596 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L596) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L598) |  |
  | 596 | 598 |  |
  | 597 | 599 | // If editing, deleting, or reading a package or addon, get the post and post type object. |
  | 598 |  | if ( 'edit\_tmem\_package' ==~~$cap || 'delete\_tmem\_package' == $cap || 'read\_tmem\_package' == $cap || 'publish\_tmem\_package'~~ == $cap ) { |
  |  | 600 | if ( 'edit\_tmem\_package' === $cap || 'delete\_tmem\_package' === $cap || 'read\_tmem\_package' === $cap || 'publish\_tmem\_package' === $cap ) { |
  | 599 | 601 |  |
  | 600 | 602 | $post = get\_post( $args[0] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L611) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L613) |  |
  | 611 | 613 | } |
  | 612 | 614 |  |
  | 613 |  | // If editing a package or an addon, assign the required capability.~~\*/~~ |
  | 614 |  | if ( 'read\_tmem\_package' == $cap ) { |
  |  | 615 | // If editing a package or an addon, assign the required capability. |
  |  | 616 | if ( 'read\_tmem\_package' === $cap ) { |
  | 615 | 617 |  |
  | 616 | 618 | if ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L619) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L621) |  |
  | 619 | 621 | $caps[] = $post\_type->cap->edit\_others\_posts; |
  | 620 | 622 | } |
  | 621 |  | } |
  | 622 |  |  |
  | 623 |  | // If deleting a package or an addon, assign the required capability. |
  | 624 |  | elseif ( 'delete\_tmem\_package' == $cap ) { |
  |  | 623 | } // If deleting a package or an addon, assign the required capability. |
  |  | 624 | elseif ( 'delete\_tmem\_package' === $cap ) { |
  | 625 | 625 |  |
  | 626 | 626 | if ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L632) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L632) |  |
  | 632 | 632 |  |
  | 633 | 633 | // If reading a private package or addon, assign the required capability. |
  | 634 |  | elseif ( 'read\_tmem\_package' == $cap ) { |
  | 635 |  |  |
  | 636 |  | if ( 'private' != $post->post\_status ) { |
  |  | 634 | elseif ( 'read\_tmem\_package' === $cap ) { |
  |  | 635 |  |
  |  | 636 | if ( 'private' !== $post->post\_status ) { |
  | 637 | 637 | $caps[] = 'read'; |
  | 638 | 638 | } elseif ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L647) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L647) |  |
  | 647 | 647 |  |
  | 648 | 648 | } // tmem\_addon\_map\_meta\_cap |
  | 649 |  | ~~// add\_filter( 'map\_meta\_cap', 'tmem\_addon\_map\_meta\_cap', 10, 4 );~~ |
  | 650 | 649 |  |
  | 651 | 650 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L668) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L667) |  |
  | 668 | 667 | } |
  | 669 | 668 |  |
  | 670 |  | if ( isset( $post->post\_type ) && 'revision' == $post->post\_type ) { |
  | 671 |  | return; |
  | 672 |  | } |
  | 673 |  |  |
  | 674 |  | // The default fields that get saved |
  |  | 669 | if ( isset( $post->post\_type ) && 'revision' === $post->post\_type ) { |
  |  | 670 | return; |
  |  | 671 | } |
  |  | 672 |  |
  |  | 673 | // The default fields that get saved. |
  | 675 | 674 | $fields = tmem\_addons\_metabox\_fields(); |
  | 676 | 675 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L678) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L677) |  |
  | 678 | 677 |  |
  | 679 | 678 | if ( ! empty( $\_POST[ $field ] ) ) { |
  | 680 |  | if ( '\_addon\_employees' == $field && ! is\_array( $\_POST[ $field ] ) ) { |
  |  | 679 | if ( '\_addon\_employees' === $field && ! is\_array( $\_POST[ $field ] ) ) { |
  | 681 | 680 | $\_POST[ $field ] = array( 'all' ); |
  | 682 | 681 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L703) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L702) |  |
  | 703 | 702 | function tmem\_deleting\_addon( $post\_id ) { |
  | 704 | 703 |  |
  | 705 |  | if ( 'tmem-addon' != get\_post\_type( $post\_id ) ) { |
  |  | 704 | if ( 'tmem-addon' !== get\_post\_type( $post\_id ) ) { |
  | 706 | 705 | return; |
  | 707 | 706 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L717) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L716) |  |
  | 717 | 716 | \* |
  | 718 | 717 | \* @since   1.4 |
  | 719 |  | \* @param   arr $messages   The current messages |
  |  | 718 | \* @param   arr $messages   The current messages. |
  | 720 | 719 | \* @return  arr     $messages   Filtered messages |
  | 721 | 720 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L724) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L723) |  |
  | 724 | 723 | global $post; |
  | 725 | 724 |  |
  | 726 |  | if ( 'tmem-addon' != $post->post\_type ) { |
  |  | 725 | if ( 'tmem-addon' !== $post->post\_type ) { |
  | 727 | 726 | return $messages; |
  | 728 | 727 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2579516#L735) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/equipment.php?rev=2647987#L734) |  |
  | 735 | 734 | $messages['tmem-addon'] = array( |
  | 736 | 735 | 0 => '', // Unused. Messages start at index 1. |
  |  | 736 | /\* translators: all are URL codes \*/ |
  | 737 | 737 | 1 => sprintf( \_\_( '%2$s updated. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 738 | /\* translators: all are URL codes \*/ |
  | 738 | 739 | 4 => sprintf( \_\_( '%2$s updated. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 740 | /\* translators: all are URL codes \*/ |
  | 739 | 741 | 6 => sprintf( \_\_( '%2$s created. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 742 | /\* translators: all are URL codes \*/ |
  | 740 | 743 | 7 => sprintf( \_\_( '%2$s saved. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 744 | /\* translators: all are URL codes \*/ |
  | 741 | 745 | 8 => sprintf( \_\_( '%2$s submitted. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  | 742 | 746 | ); |
* ## [mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L28) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L28) |  |
  | 28 | 28 | \* @since   1.4 |
  | 29 | 29 | \* @global  $post   WP\_Post object. |
  |  | 30 | \* @param str $post Post ID of event. |
  | 30 | 31 | \* @return  void |
  | 31 | 32 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L66) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L67) |  |
  | 66 | 67 | ) |
  | 67 | 68 | ); |
  | 68 |  | // Runs before metabox output |
  |  | 69 | // Runs before metabox output. |
  | 69 | 70 | do\_action( 'tmem\_package\_before\_metaboxes' ); |
  | 70 | 71 |  |
  | 71 |  | // Begin metaboxes |
  |  | 72 | // Begin metaboxes. |
  | 72 | 73 | foreach ( $metaboxes as $metabox ) { |
  | 73 |  | // Dependancy check |
  | 74 |  | if ( ! empty( $metabox['dependancy'] ) && ~~$metabox['dependancy'] === false~~ ) { |
  |  | 74 | // Dependancy check. |
  |  | 75 | if ( ! empty( $metabox['dependancy'] ) && false === $metabox['dependancy'] ) { |
  | 75 | 76 | continue; |
  | 76 | 77 | } |
  | 77 | 78 |  |
  | 78 |  | // Permission check |
  |  | 79 | // Permission check. |
  | 79 | 80 | if ( ! empty( $metabox['permission'] ) && ! tmem\_employee\_can( $metabox['permission'] ) ) { |
  | 80 | 81 | continue; |
  | 81 | 82 | } |
  | 82 | 83 |  |
  | 83 |  | // Callback check |
  |  | 84 | // Callback check. |
  | 84 | 85 | if ( ! is\_callable( $metabox['callback'] ) ) { |
  | 85 | 86 | continue; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L97) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L98) |  |
  | 97 | 98 | } |
  | 98 | 99 |  |
  | 99 |  | // Runs after metabox output |
  |  | 100 | // Runs after metabox output. |
  | 100 | 101 | do\_action( 'tmem\_package\_after\_metaboxes' ); |
  | 101 |  | } // tmem\_register\_package\_meta\_boxes |
  |  | 102 | } // tmem\_register\_package\_meta\_boxes. |
  | 102 | 103 | add\_action( 'add\_meta\_boxes\_tmem-package', 'tmem\_register\_package\_meta\_boxes' ); |
  | 103 | 104 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L129) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L130) |  |
  | 129 | 130 | \* @since   1.4 |
  | 130 | 131 | \* @param   obj $post   The post object (WP\_Post). |
  | 131 |  | ~~\* @return~~ |
  | 132 | 132 | \*/ |
  | 133 | 133 | function tmem\_package\_metabox\_availability\_callback( $post ) { |
  | 134 |  |  |
  | 135 | 134 | /\* |
  | 136 | 135 | \* Output the items for the package availability metabox |
  |  | 136 | \* |
  | 137 | 137 | \* @since   1.4 |
  | 138 | 138 | \* @param   int $post   The post object (WP\_Post). |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L147) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L147) |  |
  | 147 | 147 | \* @since   1.4 |
  | 148 | 148 | \* @param   obj $post   The post object (WP\_Post). |
  | 149 |  | ~~\* @return~~ |
  | 150 | 149 | \*/ |
  | 151 | 150 | function tmem\_package\_metabox\_items\_callback( $post ) { |
  | 152 |  |  |
  | 153 | 151 | /\* |
  | 154 | 152 | \* Output the items for the package items metabox |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L165) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L163) |  |
  | 165 | 163 | \* @since   1.4 |
  | 166 | 164 | \* @param   obj $post   The post object (WP\_Post). |
  | 167 |  | ~~\* @return~~ |
  | 168 | 165 | \*/ |
  | 169 | 166 | function tmem\_package\_metabox\_pricing\_callback( $post ) { |
  | 170 |  |  |
  | 171 | 167 | /\* |
  | 172 | 168 | \* Output the items for the package pricing metabox |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L185) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L181) |  |
  | 185 | 181 | \* @since   1.4 |
  | 186 | 182 | \* @param   int $post       The WP\_Post object. |
  | 187 |  | ~~\* @return  str~~ |
  | 188 | 183 | \*/ |
  | 189 | 184 | function tmem\_package\_metabox\_availability\_employee\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L199) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L194) |  |
  | 199 | 194 | <p><label for="\_package\_employees"><?php esc\_html\_e( 'Employees with this package', 'mobile-events-manager' ); ?></label><br /> |
  | 200 | 195 | <?php |
  | 201 |  | echo TMEM()->html->employee\_dropdown( |
  | 202 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 203 |  | ~~'name'~~          => '\_package\_employees', |
  | 204 |  | ~~'selected'~~      => ! empty( $employees\_with ) ? $employees\_with : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 196 | echo TMEM()->html->employee\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 197 | array( |
  |  | 198 | 'name'         => '\_package\_employees', |
  |  | 199 | 'selected'     => ! empty( $employees\_with ) ? $employees\_with : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 205 | 200 | 'show\_option\_none' => false, |
  | 206 | 201 | 'show\_option\_all'  => esc\_html\_\_( 'All Employees', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L219) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L214) |  |
  | 219 | 214 |  |
  | 220 | 215 | <div id="package-event-type" class="tmem\_col col2"> |
  |  | 216 | <?php /\* translators: %s Types of Events \*/ ?> |
  | 221 | 217 | <p><label for="\_package\_event\_types"><?php printf( esc\_html\_\_( 'Available for %s types', 'mobile-events-manager' ), esc\_html( $event\_label ) ); ?></label><br /> |
  | 222 | 218 | <?php |
  | 223 |  | echo TMEM()->html->event\_type\_dropdown( |
  | 224 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 225 |  | ~~'name'~~          => '\_package\_event\_types', |
  | 226 |  | ~~'selected'~~      => ! empty( $event\_types ) ? $event\_types : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 219 | echo TMEM()->html->event\_type\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 220 | array( |
  |  | 221 | 'name'         => '\_package\_event\_types', |
  |  | 222 | 'selected'     => ! empty( $event\_types ) ? $event\_types : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 227 | 223 | 'show\_option\_none' => false, |
  |  | 224 | /\* translators: %s Event Types \*/ |
  | 228 | 225 | 'show\_option\_all'  => sprintf( esc\_html\_\_( 'All %s Types', 'mobile-events-manager' ), esc\_html( ucfirst( $event\_label ) ) ), |
  | 229 | 226 | 'multiple'         => true, |
  | 230 | 227 | 'chosen'           => true, |
  |  | 228 | /\* translators: %s Event Types \*/ |
  | 231 | 229 | 'placeholder'      => sprintf( esc\_html\_\_( 'Click to select %s types', 'mobile-events-manager' ), esc\_html( $event\_label ) ), |
  | 232 | 230 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L246) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L244) |  |
  | 246 | 244 | \* @since   1.4 |
  | 247 | 245 | \* @param   int $post       The WP\_Post object. |
  | 248 |  | ~~\* @return  str~~ |
  | 249 | 246 | \*/ |
  | 250 | 247 | function tmem\_package\_metabox\_availability\_period\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L256) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L253) |  |
  | 256 | 253 | <div class="tmem\_field\_wrap tmem\_form\_fields"> |
  | 257 | 254 | <div id="package-date-restrict"> |
  | 258 |  | <p> |
  | 259 |  | <?php |
  | 260 |  | echo TMEM()->html->checkbox( |
  | 261 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 262 |  | 'name'    => '\_package\_restrict\_date', |
  | 263 |  | 'current' => $restricted, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 255 | <p> |
  |  | 256 | <?php |
  |  | 257 | echo TMEM()->html->checkbox( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 258 | array( |
  |  | 259 | 'name'    => '\_package\_restrict\_date', |
  |  | 260 | 'current' => $restricted, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 264 | 261 | ) |
  | 265 | 262 | ); |
  | 266 |  | ?> |
  |  | 263 | ?> |
  | 267 | 264 | <label for="\_package\_restrict\_date"><?php esc\_html\_e( 'Select if this package is only available during certain months of the year', 'mobile-events-manager' ); ?></label></p> |
  | 268 | 265 | </div> |
  | 269 | 266 |  |
  | 270 | 267 | <div id="tmem-package-month-selection"<?php echo $class; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>> |
  | 271 |  | <p><label for="\_package\_months"><?php esc\_html\_e( 'Select the months this package is available', 'mobile-events-manager' ); ?></label><br /> |
  |  | 268 | <p><label for="\_package\_months"><?php esc\_html\_e( 'Select the months this package is available', 'mobile-events-manager' ); ?></label><br /> |
  | 272 | 269 | <?php |
  | 273 |  | echo TMEM()->html->month\_dropdown( |
  | 274 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 275 |  | ~~'name'~~     => '\_package\_months', |
  | 276 |  | ~~'selected'~~ => tmem\_get\_package\_months\_available( $post->ID ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 277 |  | 'fullname'    => true, |
  | 278 |  | 'multiple'    => true, |
  | 279 |  | 'chosen'      => true, |
  | 280 |  | 'placeholder' => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  |  | 270 | echo TMEM()->html->month\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 271 | array( |
  |  | 272 | 'name'     => '\_package\_months', |
  |  | 273 | 'selected' => tmem\_get\_package\_months\_available( $post->ID ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 274 | 'fullname'     => true, |
  |  | 275 | 'multiple'     => true, |
  |  | 276 | 'chosen'       => true, |
  |  | 277 | 'placeholder'  => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  | 281 | 278 | ) |
  | 282 | 279 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L296) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L293) |  |
  | 296 | 293 | \* @since   1.4 |
  | 297 | 294 | \* @param   int $post       The WP\_Post object. |
  | 298 |  | ~~\* @return  str~~ |
  | 299 | 295 | \*/ |
  | 300 | 296 | function tmem\_package\_metabox\_items\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L351) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L347) |  |
  | 351 | 347 | \* @since 1.3.9 |
  | 352 | 348 | \* |
  | 353 |  | \* @param   str $item |
  | 354 |  | \* @param   int $post\_id |
  |  | 349 | \* @param   str $item    Item. |
  |  | 350 | \* @param   int $post\_id Post ID. |
  | 355 | 351 | \*/ |
  | 356 | 352 | function tmem\_package\_metabox\_item\_row( $item, $post\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L361) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L357) |  |
  | 361 | 357 | <td> |
  | 362 | 358 | <?php |
  | 363 |  | echo TMEM()->html->addons\_dropdown( |
  | 364 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 365 |  | ~~'name'~~          => '\_package\_items[]', |
  | 366 |  | ~~'selected'~~      => ! empty( $item ) ? $item : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 359 | echo TMEM()->html->addons\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 360 | array( |
  |  | 361 | 'name'         => '\_package\_items[]', |
  |  | 362 | 'selected'     => ! empty( $item ) ? $item : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 367 | 363 | 'show\_option\_none' => false, |
  | 368 | 364 | 'show\_option\_all'  => false, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L394) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L390) |  |
  | 394 | 390 | \* @since   1.4 |
  | 395 | 391 | \* @param   int $post       The WP\_Post object. |
  | 396 |  | ~~\* @return  str~~ |
  | 397 | 392 | \*/ |
  | 398 | 393 | function tmem\_package\_metabox\_pricing\_options\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L418) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L413) |  |
  | 418 | 413 | ?> |
  | 419 | 414 | <p><label for="<?php echo esc\_attr( $price\_args['name'] ); ?>"><?php esc\_html\_e( 'Standard Price', 'mobile-events-manager' ); ?></label><br /> |
  | 420 |  | <?php if ( ~~$currency\_position == 'before'~~ ) : ?> |
  |  | 415 | <?php if ( 'before' === $currency\_position ) : ?> |
  | 421 | 416 | <?php echo esc\_html( tmem\_currency\_filter( '' ) ); ?> |
  | 422 | 417 | <?php echo TMEM()->html->text( $price\_args ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L432) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L427) |  |
  | 432 | 427 | <p> |
  | 433 | 428 | <?php |
  | 434 |  | echo TMEM()->html->checkbox( |
  | 435 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 436 |  | 'name'    => '\_package\_variable\_pricing', |
  | 437 |  | 'current' => $variable, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 429 | echo TMEM()->html->checkbox( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 430 | array( |
  |  | 431 | 'name'    => '\_package\_variable\_pricing', |
  |  | 432 | 'current' => $variable, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 438 | 433 | ) |
  | 439 | 434 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L501) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L496) |  |
  | 501 | 496 | \* @since 1.3.9 |
  | 502 | 497 | \* |
  | 503 |  | \* @param   int $key |
  | 504 |  | \* @param   arr $args |
  | 505 |  | \* @param   int $post\_id |
  | 506 |  | \* @param   int $index |
  |  | 498 | \* @param   int $key        Key. |
  |  | 499 | \* @param   arr $args       Args. |
  |  | 500 | \* @param   int $post\_id    Post. |
  |  | 501 | \* @param   int $index      Index. |
  | 507 | 502 | \*/ |
  | 508 | 503 | function tmem\_package\_metabox\_price\_row( $key, $args, $post\_id, $index ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L520) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L515) |  |
  | 520 | 515 | <td> |
  | 521 | 516 | <?php |
  | 522 |  | echo TMEM()->html->month\_dropdown( |
  | 523 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 524 |  | ~~'name'~~     => '\_package\_variable\_prices[' . esc\_attr( $key ) . '][months]', |
  | 525 |  | ~~'selected'~~ => ! empty( $args['months'] ) ? $args['months'] : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 526 |  | 'fullname'    => true, |
  | 527 |  | 'multiple'    => true, |
  | 528 |  | 'chosen'      => true, |
  | 529 |  | 'placeholder' => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  |  | 517 | echo TMEM()->html->month\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 518 | array( |
  |  | 519 | 'name'     => '\_package\_variable\_prices[' . esc\_attr( $key ) . '][months]', |
  |  | 520 | 'selected' => ! empty( $args['months'] ) ? $args['months'] : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 521 | 'fullname'     => true, |
  |  | 522 | 'multiple'     => true, |
  |  | 523 | 'chosen'       => true, |
  |  | 524 | 'placeholder'  => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  | 530 | 525 | ) |
  | 531 | 526 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L543) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L538) |  |
  | 543 | 538 | ?> |
  | 544 | 539 |  |
  | 545 |  | <?php if ( ~~$currency\_position == 'before'~~ ) : ?> |
  |  | 540 | <?php if ( 'before' === $currency\_position ) : ?> |
  | 546 | 541 | <span><?php echo esc\_html( tmem\_currency\_filter( '' ) ); ?></span> |
  | 547 | 542 | <?php echo TMEM()->html->text( $price\_args ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L572) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L567) |  |
  | 572 | 567 | \* @since   1.4 |
  | 573 | 568 | \* @global  $post   WP\_Post object. |
  |  | 569 | \* @param str $post Post. |
  | 574 | 570 | \* @return  void |
  | 575 | 571 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L601) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L597) |  |
  | 601 | 597 | ) |
  | 602 | 598 | ); |
  | 603 |  | // Runs before metabox output |
  |  | 599 | // Runs before metabox output. |
  | 604 | 600 | do\_action( 'tmem\_addon\_before\_metaboxes' ); |
  | 605 | 601 |  |
  | 606 |  | // Begin metaboxes |
  |  | 602 | // Begin metaboxes. |
  | 607 | 603 | foreach ( $metaboxes as $metabox ) { |
  | 608 |  | // Dependancy check |
  | 609 |  | if ( ! empty( $metabox['dependancy'] ) && ~~$metabox['dependancy'] === false~~ ) { |
  |  | 604 | // Dependancy check. |
  |  | 605 | if ( ! empty( $metabox['dependancy'] ) && false === $metabox['dependancy'] ) { |
  | 610 | 606 | continue; |
  | 611 | 607 | } |
  | 612 | 608 |  |
  | 613 |  | // Permission check |
  |  | 609 | // Permission check. |
  | 614 | 610 | if ( ! empty( $metabox['permission'] ) && ! tmem\_employee\_can( $metabox['permission'] ) ) { |
  | 615 | 611 | continue; |
  | 616 | 612 | } |
  | 617 | 613 |  |
  | 618 |  | // Callback check |
  |  | 614 | // Callback check. |
  | 619 | 615 | if ( ! is\_callable( $metabox['callback'] ) ) { |
  | 620 | 616 | continue; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L632) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L628) |  |
  | 632 | 628 | } |
  | 633 | 629 |  |
  | 634 |  | // Runs after metabox output |
  |  | 630 | // Runs after metabox output. |
  | 635 | 631 | do\_action( 'tmem\_addon\_after\_metaboxes' ); |
  | 636 | 632 | } // tmem\_register\_addon\_meta\_boxes |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L663) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L659) |  |
  | 663 | 659 | \* @since   1.4 |
  | 664 | 660 | \* @param   obj $post   The post object (WP\_Post). |
  | 665 |  | ~~\* @return~~ |
  | 666 | 661 | \*/ |
  | 667 | 662 | function tmem\_addon\_metabox\_availability\_callback( $post ) { |
  | 668 |  |  |
  | 669 | 663 | /\* |
  | 670 |  | \* Output the items for the addon availability metabox |
  |  | 664 | \* Output the items for the addon availability metabox. |
  | 671 | 665 | \* @since   1.4 |
  | 672 | 666 | \* @param   int $post\_id    The addon post ID |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L681) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L675) |  |
  | 681 | 675 | \* @since   1.4 |
  | 682 | 676 | \* @param   obj $post   The post object (WP\_Post). |
  | 683 |  | ~~\* @return~~ |
  | 684 | 677 | \*/ |
  | 685 | 678 | function tmem\_addon\_metabox\_pricing\_callback( $post ) { |
  | 686 |  |  |
  | 687 | 679 | /\* |
  | 688 | 680 | \* Output the items for the addon pricing metabox |
  | 689 | 681 | \* @since   1.4 |
  | 690 |  | \* @param   int $post\_id    The addon post ID |
  |  | 682 | \* @param   int $post\_id    The addon post ID. |
  | 691 | 683 | \*/ |
  | 692 | 684 | do\_action( 'tmem\_addon\_price\_fields', $post ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L697) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L689) |  |
  | 697 | 689 |  |
  | 698 | 690 | /\*\* |
  | 699 |  | \* Output the addon availability employee\_row |
  |  | 691 | \* Output the addon availability employee\_row. |
  | 700 | 692 | \* |
  | 701 | 693 | \* @since   1.4 |
  | 702 | 694 | \* @param   int $post       The WP\_Post object. |
  | 703 |  | ~~\* @return  str~~ |
  | 704 | 695 | \*/ |
  | 705 | 696 | function tmem\_addon\_metabox\_availability\_employee\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L715) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L706) |  |
  | 715 | 706 | <p><label for="\_addon\_employees"><?php esc\_html\_e( 'Employees with this package', 'mobile-events-manager' ); ?></label><br /> |
  | 716 | 707 | <?php |
  | 717 |  | echo TMEM()->html->employee\_dropdown( |
  | 718 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 719 |  | ~~'name'~~          => '\_addon\_employees', |
  | 720 |  | ~~'selected'~~      => ! empty( $employees\_with ) ? $employees\_with : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 708 | echo TMEM()->html->employee\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 709 | array( |
  |  | 710 | 'name'         => '\_addon\_employees', |
  |  | 711 | 'selected'     => ! empty( $employees\_with ) ? $employees\_with : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 721 | 712 | 'show\_option\_none' => false, |
  | 722 | 713 | 'show\_option\_all'  => esc\_html\_\_( 'All Employees', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L735) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L726) |  |
  | 735 | 726 |  |
  | 736 | 727 | <div id="addon-event-type" class="tmem\_col col2"> |
  |  | 728 | <?php /\* translators: $s Event Events \*/ ?> |
  | 737 | 729 | <p><label for="\_addon\_event\_types"><?php printf( esc\_html\_\_( 'Available for %s types', 'mobile-events-manager' ), esc\_html( $event\_label ) ); ?></label><br /> |
  | 738 | 730 | <?php |
  | 739 |  | echo TMEM()->html->event\_type\_dropdown( |
  | 740 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 741 |  | ~~'name'~~          => '\_addon\_event\_types', |
  | 742 |  | ~~'selected'~~      => ! empty( $event\_types ) ? $event\_types : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 731 | echo TMEM()->html->event\_type\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 732 | array( |
  |  | 733 | 'name'         => '\_addon\_event\_types', |
  |  | 734 | 'selected'     => ! empty( $event\_types ) ? $event\_types : array( 'all' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 743 | 735 | 'show\_option\_none' => false, |
  |  | 736 | /\* translators: $s Event Events \*/ |
  | 744 | 737 | 'show\_option\_all'  => sprintf( esc\_html\_\_( 'All %s Types', 'mobile-events-manager' ), esc\_html( ucfirst( $event\_label ) ) ), |
  | 745 | 738 | 'multiple'         => true, |
  | 746 | 739 | 'chosen'           => true, |
  |  | 740 | /\* translators: $s Event Events \*/ |
  | 747 | 741 | 'placeholder'      => sprintf( esc\_html\_\_( 'Click to select %s types', 'mobile-events-manager' ), esc\_html( $event\_label ) ), |
  | 748 | 742 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L762) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L756) |  |
  | 762 | 756 | \* @since   1.4 |
  | 763 | 757 | \* @param   int $post       The WP\_Post object. |
  | 764 |  | ~~\* @return  str~~ |
  | 765 | 758 | \*/ |
  | 766 | 759 | function tmem\_addon\_metabox\_availability\_period\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L772) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L765) |  |
  | 772 | 765 | <div class="tmem\_field\_wrap tmem\_form\_fields"> |
  | 773 | 766 | <div id="addon-date-restrict"> |
  | 774 |  | <p> |
  | 775 |  | <?php |
  | 776 |  | echo TMEM()->html->checkbox( |
  | 777 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 778 |  | 'name'    => '\_addon\_restrict\_date', |
  | 779 |  | 'current' => $restricted, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 767 | <p> |
  |  | 768 | <?php |
  |  | 769 | echo TMEM()->html->checkbox( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 770 | array( |
  |  | 771 | 'name'    => '\_addon\_restrict\_date', |
  |  | 772 | 'current' => $restricted, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 780 | 773 | ) |
  | 781 | 774 | ); |
  | 782 |  | ?> |
  |  | 775 | ?> |
  | 783 | 776 | <label for="\_addon\_restrict\_date"><?php esc\_html\_e( 'Select if this add-on is only available during certain months of the year', 'mobile-events-manager' ); ?></label></p> |
  | 784 | 777 | </div> |
  | 785 | 778 |  |
  | 786 | 779 | <div id="tmem-addon-month-selection"<?php echo $class; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>> |
  | 787 |  | <p><label for="\_addon\_months"><?php esc\_html\_e( 'Select the months this add-on is available', 'mobile-events-manager' ); ?></label><br /> |
  |  | 780 | <p><label for="\_addon\_months"><?php esc\_html\_e( 'Select the months this add-on is available', 'mobile-events-manager' ); ?></label><br /> |
  | 788 | 781 | <?php |
  | 789 |  | echo TMEM()->html->month\_dropdown( |
  | 790 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 791 |  | ~~'name'~~     => '\_addon\_months', |
  | 792 |  | ~~'selected'~~ => tmem\_get\_addon\_months\_available( $post->ID ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 793 |  | 'fullname'    => true, |
  | 794 |  | 'multiple'    => true, |
  | 795 |  | 'chosen'      => true, |
  | 796 |  | 'placeholder' => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  |  | 782 | echo TMEM()->html->month\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 783 | array( |
  |  | 784 | 'name'     => '\_addon\_months', |
  |  | 785 | 'selected' => tmem\_get\_addon\_months\_available( $post->ID ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 786 | 'fullname'     => true, |
  |  | 787 | 'multiple'     => true, |
  |  | 788 | 'chosen'       => true, |
  |  | 789 | 'placeholder'  => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  | 797 | 790 | ) |
  | 798 | 791 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L812) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L805) |  |
  | 812 | 805 | \* @since   1.4 |
  | 813 | 806 | \* @param   int $post       The WP\_Post object. |
  | 814 |  | ~~\* @return  str~~ |
  | 815 | 807 | \*/ |
  | 816 | 808 | function tmem\_addon\_metabox\_pricing\_options\_row( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L836) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L828) |  |
  | 836 | 828 | ?> |
  | 837 | 829 | <p><label for="<?php echo esc\_attr( $price\_args['name'] ); ?>"><?php esc\_html\_e( 'Standard Price', 'mobile-events-manager' ); ?></label><br /> |
  | 838 |  | <?php if ( ~~$currency\_position == 'before'~~ ) : ?> |
  |  | 830 | <?php if ( 'before' === $currency\_position ) : ?> |
  | 839 | 831 | <?php echo esc\_html( tmem\_currency\_filter( '' ) ); ?> |
  | 840 | 832 | <?php echo TMEM()->html->text( $price\_args ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L850) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L842) |  |
  | 850 | 842 | <p> |
  | 851 | 843 | <?php |
  | 852 |  | echo TMEM()->html->checkbox( |
  | 853 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 854 |  | 'name'    => '\_addon\_variable\_pricing', |
  | 855 |  | 'current' => $variable, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 844 | echo TMEM()->html->checkbox( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 845 | array( |
  |  | 846 | 'name'    => '\_addon\_variable\_pricing', |
  |  | 847 | 'current' => $variable, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 856 | 848 | ) |
  | 857 | 849 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L919) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L911) |  |
  | 919 | 911 | \* @since 1.3.9 |
  | 920 | 912 | \* |
  | 921 |  | \* @param   int $key |
  | 922 |  | \* @param   arr $args |
  | 923 |  | \* @param   int $post\_id |
  | 924 |  | \* @param   int $index |
  |  | 913 | \* @param   int $key        Key. |
  |  | 914 | \* @param   arr $args       Args. |
  |  | 915 | \* @param   int $post\_id    Post ID. |
  |  | 916 | \* @param   int $index      Index. |
  | 925 | 917 | \*/ |
  | 926 | 918 | function tmem\_addon\_metabox\_price\_row( $key, $args, $post\_id, $index ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L938) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L930) |  |
  | 938 | 930 | <td> |
  | 939 | 931 | <?php |
  | 940 |  | echo TMEM()->html->month\_dropdown( |
  | 941 |  | array(~~// phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped~~ |
  | 942 |  | ~~'name'~~     => '\_addon\_variable\_prices[' . esc\_attr( $key ) . '][months]', |
  | 943 |  | ~~'selected'~~ => ! empty( $args['months'] ) ? $args['months'] : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 944 |  | 'fullname'    => true, |
  | 945 |  | 'multiple'    => true, |
  | 946 |  | 'chosen'      => true, |
  | 947 |  | 'placeholder' => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  |  | 932 | echo TMEM()->html->month\_dropdown( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 933 | array( |
  |  | 934 | 'name'     => '\_addon\_variable\_prices[' . esc\_attr( $key ) . '][months]', |
  |  | 935 | 'selected' => ! empty( $args['months'] ) ? $args['months'] : '', // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 936 | 'fullname'     => true, |
  |  | 937 | 'multiple'     => true, |
  |  | 938 | 'chosen'       => true, |
  |  | 939 | 'placeholder'  => esc\_html\_\_( 'Select Months', 'mobile-events-manager' ), |
  | 948 | 940 | ) |
  | 949 | 941 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2455787#L961) | […](/browser/mobile-events-manager/trunk/includes/admin/equipment/metaboxes.php?rev=2647987#L953) |  |
  | 961 | 953 | ?> |
  | 962 | 954 |  |
  | 963 |  | <?php if ( ~~$currency\_position == 'before'~~ ) : ?> |
  |  | 955 | <?php if ( 'before' === $currency\_position ) : ?> |
  | 964 | 956 | <span><?php echo esc\_html( tmem\_currency\_filter( '' ) ); ?></span> |
  | 965 | 957 | <?php echo TMEM()->html->text( $price\_args ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
* ## [mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L40 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L40 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 40 | 40 | parent::\_\_construct( |
  | 41 | 41 | array( |
  | 42 |  | 'singular' => 'tmem\_playlist\_entry', // Singular label |
  | 43 |  | 'plural'   => 'tmem\_playlist\_entries', // Plural label, also this well be one of the table css class |
  | 44 |  | 'ajax'     => false, // We won't support Ajax for this table |
  |  | 42 | 'singular' => 'tmem\_playlist\_entry', // Singular label. |
  |  | 43 | 'plural'   => 'tmem\_playlist\_entries', // Plural label, also this well be one of the table css class. |
  |  | 44 | 'ajax'     => false, // We won't support Ajax for this table. |
  | 45 | 45 | ) |
  | 46 | 46 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L52) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L52) |  |
  | 52 | 52 | \* |
  | 53 | 53 | \* @since   1.3 |
  | 54 |  | \* @param   int $per\_page       The number of items to display per page |
  | 55 |  | \* @param   int $page\_num       The current page number |
  |  | 54 | \* @param   int $per\_page       The number of items to display per page. |
  |  | 55 | \* @param   int $page\_num       The current page number. |
  | 56 | 56 | \* @return  arr     The array of data to display within the table. |
  | 57 | 57 | \*/ |
  | 58 | 58 | private function get\_entries( $per\_page = -1, $page\_num = 1 ) { |
  | 59 | 59 |  |
  | 60 |  | if ( ! isset( $\_GET['event\_id'] ) ) { |
  |  | 60 | if ( ! isset( $\_GET['event\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 61 | 61 | return false; |
  | 62 | 62 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L64) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L64) |  |
  | 64 | 64 | $result = array(); |
  | 65 | 65 |  |
  | 66 |  | $tmem\_event = new TMEM\_Event( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); |
  | 67 |  |  |
  | 68 |  | $orderby = isset( $\_GET['orderby'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['orderby'] ) ) : 'category'; |
  | 69 |  | $order   = isset( $\_GET['order'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['order'] ) ) : 'ASC'; |
  | 70 |  |  |
  | 71 |  | if ( ~~$orderby == 'category' ) {~~ |
  |  | 66 | $tmem\_event = new TMEM\_Event( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 67 |  |
  |  | 68 | $orderby = isset( $\_GET['orderby'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['orderby'] ) ) : 'category'; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 69 | $order   = isset( $\_GET['order'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['order'] ) ) : 'ASC'; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 70 |  |
  |  | 71 | if ( 'category' === $orderby ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 72 | 72 |  |
  | 73 | 73 | $args = array( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L103) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L103) |  |
  | 103 | 103 | } else { |
  | 104 | 104 | $args = array( |
  | 105 |  | 'orderby'  => ~~$orderby == 'date'~~ ? 'post\_date' : 'meta\_value', |
  |  | 105 | 'orderby'  => 'date' === $orderby ? 'post\_date' : 'meta\_value', |
  | 106 | 106 | 'order'    => $order, |
  | 107 |  | 'meta\_key' => ~~$orderby == 'date'~~ ? '' : '\_tmem\_playlist\_entry\_' . $orderby, |
  |  | 107 | 'meta\_key' => 'date' === $orderby ? '' : '\_tmem\_playlist\_entry\_' . $orderby, |
  | 108 | 108 | ); |
  | 109 | 109 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L142) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L142) |  |
  | 142 | 142 | \* |
  | 143 | 143 | \* @since   1.3 |
  | 144 |  | \* @param   int $id     The playlist entry ID |
  | 145 |  | \* @return |
  |  | 144 | \* @param   int $id     The playlist entry ID. |
  | 146 | 145 | \*/ |
  | 147 | 146 | public function delete\_entry( $id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L153) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L152) |  |
  | 153 | 152 | \* |
  | 154 | 153 | \* @since   1.3 |
  | 155 |  | \* @param   int $event\_id   The event ID |
  | 156 |  | \* @return |
  |  | 154 | \* @param   int $event\_id   The event ID. |
  | 157 | 155 | \*/ |
  | 158 | 156 | public function count\_entries( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L164) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L162) |  |
  | 164 | 162 | \* |
  | 165 | 163 | \* @since   1.3 |
  | 166 |  | ~~\* @param~~ |
  | 167 |  | ~~\* @return~~ |
  | 168 | 164 | \*/ |
  | 169 | 165 | public function no\_items() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L175) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L171) |  |
  | 175 | 171 | \* |
  | 176 | 172 | \* @since   1.3 |
  | 177 |  | \* @param   str $item           The playlist data |
  | 178 |  | \* @param   str $column\_name    The table column name |
  | 179 |  | \* @return  str |
  |  | 173 | \* @param   str $item           The playlist data. |
  |  | 174 | \* @param   str $column\_name    The table column name. |
  | 180 | 175 | \*/ |
  | 181 | 176 | public function column\_default( $item, $column\_name ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L192) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L187) |  |
  | 192 | 187 |  |
  | 193 | 188 | default: |
  | 194 |  | return print\_r( $item, true ); // Show the whole array for troubleshooting purposes |
  |  | 189 | return print\_r( $item, true ); // Show the whole array for troubleshooting purposes. |
  | 195 | 190 | } |
  | 196 | 191 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L201) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L196) |  |
  | 201 | 196 | \* |
  | 202 | 197 | \* @since   1.3 |
  | 203 |  | \* @param   arr $item       The current item |
  | 204 |  | \* @return  str |
  |  | 198 | \* @param   arr $item       The current item. |
  | 205 | 199 | \*/ |
  | 206 | 200 | public function column\_song( $item ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L208) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L202) |  |
  | 208 | 202 | $title = '<strong>' . $item['song'] . '</strong>'; |
  | 209 | 203 |  |
  | 210 |  | $url = add\_query\_arg( |
  |  | 204 | $url = add\_query\_arg( |
  | 211 | 205 | array( |
  | 212 | 206 | 'tmem-action' => 'delete\_song', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L215) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L209) |  |
  | 215 | 209 | ) |
  | 216 | 210 | ); |
  |  | 211 | /\* translators: %s URL Code \*/ |
  | 217 | 212 | $actions['delete'] = tmem\_employee\_can( 'manage\_events' ) ? sprintf( \_\_( '<a href="%s">Delete</a>', 'mobile-events-manager' ), $url ) : ''; |
  | 218 | 213 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L225) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L220) |  |
  | 225 | 220 | \* |
  | 226 | 221 | \* @since   1.3 |
  | 227 |  | \* @param   arr $item       The current item |
  |  | 222 | \* @param   arr $item       The current item. |
  | 228 | 223 | \* @return  str |
  | 229 | 224 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L246) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L241) |  |
  | 246 | 241 | \* |
  | 247 | 242 | \* @since   1.3 |
  | 248 |  | \* @param   arr $item       The current item |
  |  | 243 | \* @param   arr $item       The current item. |
  | 249 | 244 | \* @return  str |
  | 250 | 245 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L257) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L252) |  |
  | 257 | 252 | \* |
  | 258 | 253 | \* @since   1.3 |
  | 259 |  | \* @param |
  | 260 |  | \* @return  arr     $columns    Array of columns |
  |  | 254 | \* @return  arr     $columns    Array of columns. |
  | 261 | 255 | \*/ |
  | 262 | 256 | public function get\_columns() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L284) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L278) |  |
  | 284 | 278 | \* |
  | 285 | 279 | \* @since   1.3 |
  | 286 |  | \* @param |
  | 287 |  | \* @return  arr     $sortable\_columns   Array of sortable columns |
  |  | 280 | \* @return  arr     $sortable\_columns   Array of sortable columns. |
  | 288 | 281 | \*/ |
  | 289 | 282 | public function get\_sortable\_columns() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L305) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L298) |  |
  | 305 | 298 | \* |
  | 306 | 299 | \* @since   1.3 |
  | 307 |  | \* @param |
  | 308 |  | \* @return  arr     $actions    Array of bulk actions |
  |  | 300 | \* @return  arr     $actions    Array of bulk actions. |
  | 309 | 301 | \*/ |
  | 310 | 302 | public function get\_bulk\_actions() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L324) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L316) |  |
  | 324 | 316 | \* |
  | 325 | 317 | \* @since   1.3 |
  | 326 |  | \* @param |
  | 327 |  | \* @return  arr     $views      Category views |
  |  | 318 | \* @return  arr     $views      Category views. |
  | 328 | 319 | \*/ |
  | 329 | 320 | public function get\_views() { |
  | 330 | 321 |  |
  | 331 |  | if ( ! isset( $\_GET['event\_id'] ) ) { |
  |  | 322 | if ( ! isset( $\_GET['event\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 332 | 323 | return array(); |
  | 333 | 324 | } |
  | 334 | 325 |  |
  | 335 | 326 | $views   = array(); |
  | 336 |  | $current = ( ! empty( $\_GET['view\_cat'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['view\_cat'] ) ) : 'all' ); |
  | 337 |  |  |
  | 338 |  | $categories = tmem\_get\_playlist\_categories( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); |
  |  | 327 | $current = ( ! empty( $\_GET['view\_cat'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['view\_cat'] ) ) : 'all' ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 328 |  |
  |  | 329 | $categories = tmem\_get\_playlist\_categories( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 339 | 330 |  |
  | 340 | 331 | if ( $categories ) { |
  | 341 |  | $class   = ( ~~$current == 'all'~~ ? ' class="current"' : '' ); |
  |  | 332 | $class   = ( 'all' === $current ? ' class="current"' : '' ); |
  | 342 | 333 | $all\_url = remove\_query\_arg( 'view\_cat' ); |
  | 343 | 334 |  |
  | 344 | 335 | $views['all'] = sprintf( |
  |  | 336 | /\* translators: %1 URL \*/ |
  | 345 | 337 | \_\_( '<a href="%1$s" %2$s >All</a>', 'mobile-events-manager' ), |
  | 346 | 338 | $all\_url, |
  | 347 | 339 | $class |
  | 348 | 340 | ) . |
  | 349 |  | '<span class="count">' . tmem\_count\_playlist\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . '</span>'; |
  |  | 341 | '<span class="count">' . tmem\_count\_playlist\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) . '</span>'; // phpcs:ignore WordPress.Security.NonceVerification |
  | 350 | 342 |  |
  | 351 | 343 | foreach ( $categories as $category ) { |
  | 352 | 344 |  |
  | 353 |  | $count = tmem\_count\_playlist\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ), $category->name ); |
  |  | 345 | $count = tmem\_count\_playlist\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ), $category->name ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 354 | 346 |  |
  | 355 | 347 | if ( $count > 0 ) { |
  | 356 | 348 |  |
  | 357 | 349 | $view\_url = add\_query\_arg( 'view\_cat', $category->name ); |
  | 358 |  | $class    = ( $c~~urrent == $category->name~~ ? ' class="current"' : '' ); |
  |  | 350 | $class    = ( $category->name === $current ? ' class="current"' : '' ); |
  | 359 | 351 |  |
  | 360 | 352 | $views[ $category->name ] = '<a href="' . $view\_url . '" ' . $class . ' >' . $category->name . '</a>' . |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L373) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L365) |  |
  | 373 | 365 | \* |
  | 374 | 366 | \* @since   1.3 |
  | 375 |  | \* |
  | 376 |  | \* @return  str |
  | 377 |  | \*/ |
  | 378 |  | function display\_header() { |
  | 379 |  |  |
  | 380 |  | if ( ! isset( $\_GET['event\_id'] ) ) { |
  |  | 367 | \*/ |
  |  | 368 | public function display\_header() { |
  |  | 369 |  |
  |  | 370 | if ( ! isset( $\_GET['event\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 381 | 371 | exit; |
  | 382 | 372 | } |
  | 383 | 373 |  |
  | 384 | 374 | ?> |
  | 385 |  | <p><?php printf( \_\_( '<strong><u>Client</strong>:</u> %s', 'mobile-events-manager' ), tmem\_get\_client\_display\_name( tmem\_get\_event\_client\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 386 |  | <br /> |
  | 387 |  | <?php printf( \_\_( '<strong><u>Client Phone Number</strong>:</u> %s', 'mobile-events-manager'), tmem\_get\_client\_phone( tmem\_get\_event\_client\_id ( absint( wp\_unslash ( $\_GET['event\_id'] ) ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 388 |  | <br /> |
  | 389 |  | <?php printf( \_\_( '<strong><u>Date</strong>:</u> %s', 'mobile-events-manager' ), tmem\_get\_event\_long\_date( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 390 |  | <br /> |
  | 391 |  | <?php printf( \_\_( '<strong><u>Start Time</strong>:</u> %s', 'mobile-events-manager' ), tmem\_get\_event\_start( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 392 |  | <br /> |
  | 393 |  | <?php printf( \_\_( '<strong><u>Type</strong>:</u> %s', 'mobile-events-manager' ), tmem\_get\_event\_type( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 394 |  | <br /> |
  | 395 |  | <?php printf( \_\_( '<strong><u>Venue</strong>:</u> %s', 'mobile-events-manager' ), tmem\_content\_tag\_venue( absint( wp\_unslash( $\_GET['event\_id']) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 396 |  | <br /> |
  | 397 |  | <?php printf( \_\_( '<strong><u>Primary Employee</strong>:</u> %s', 'mobile-events-manager' ), tmem\_get\_employee\_display\_name( tmem\_get\_event\_primary\_employee\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  |  | 375 | <p> |
  |  | 376 | <?php |
  |  | 377 | printf( /\* translators: %s Client details \*/ |
  |  | 378 | \_\_( '<strong><u>Client</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 379 | esc\_html( tmem\_get\_client\_display\_name( tmem\_get\_event\_client\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 380 | ); |
  |  | 381 | ?> |
  |  | 382 | <br /> |
  |  | 383 | <?php |
  |  | 384 | printf( /\* translators: %s Client details \*/ |
  |  | 385 | \_\_( '<strong><u>Client Phone Number</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 386 | esc\_html( tmem\_get\_client\_phone( tmem\_get\_event\_client\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 387 | ); |
  |  | 388 | ?> |
  |  | 389 | <br /> |
  |  | 390 | <?php |
  |  | 391 | printf(  /\* translators: %s Event Date \*/ |
  |  | 392 | \_\_( '<strong><u>Date</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 393 | esc\_html( tmem\_get\_event\_long\_date( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 394 | ); |
  |  | 395 | ?> |
  |  | 396 | <br /> |
  |  | 397 | <?php |
  |  | 398 | printf( /\* translators: %s Event Start time \*/ |
  |  | 399 | \_\_( '<strong><u>Start Time</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 400 | esc\_html( tmem\_get\_event\_start( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 401 | ); |
  |  | 402 | ?> |
  |  | 403 | <br /> |
  |  | 404 | <?php |
  |  | 405 | printf( /\* translators: %s Event type \*/ |
  |  | 406 | \_\_( '<strong><u>Type</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 407 | esc\_html( tmem\_get\_event\_type( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 408 | ); |
  |  | 409 | ?> |
  |  | 410 | <br /> |
  |  | 411 | <?php |
  |  | 412 | printf( /\* translators: %s Venue \*/ |
  |  | 413 | \_\_( '<strong><u>Venue</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 414 | esc\_html( tmem\_content\_tag\_venue( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) //  phpcs:ignore WordPress.Security.NonceVerification |
  |  | 415 | ); |
  |  | 416 | ?> |
  |  | 417 | <br /> |
  |  | 418 | <?php |
  |  | 419 | printf( /\* translators: %s Employee \*/ |
  |  | 420 | \_\_( '<strong><u>Primary Employee</strong>:</u> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 421 | esc\_html( tmem\_get\_employee\_display\_name( tmem\_get\_event\_primary\_employee\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 422 | ); |
  |  | 423 | ?> |
  | 398 | 424 | <br /></p> |
  | 399 |  | <p><?php printf( \_\_( '<strong><u>Package</strong>:</u><br/> %s', 'mobile-events-manager' ), tmem\_get\_package\_name( tmem\_get\_event\_package ( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 400 |  | <br /> |
  | 401 |  | <?php printf( \_\_( '<strong><u>Addons Selected</strong>:</u><br /> %s', 'mobile-events-manager' ), tmem\_content\_tag\_event\_addons( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  |  | 425 | <p> |
  |  | 426 | <?php |
  |  | 427 | printf( /\* translators: %s Package selected \*/ |
  |  | 428 | \_\_( '<strong><u>Package</strong>:</u><br/> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 429 | esc\_html( tmem\_get\_package\_name( tmem\_get\_event\_package( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 430 | ); |
  |  | 431 | ?> |
  |  | 432 | <br /> |
  |  | 433 | <?php |
  |  | 434 | printf( /\* translators: %s Addons selected \*/ |
  |  | 435 | \_\_( '<strong><u>Addons Selected</strong>:</u><br /> %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 436 | esc\_html( tmem\_content\_tag\_event\_addons( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 437 | ); |
  |  | 438 | ?> |
  | 402 | 439 | <br /></p> |
  | 403 |  | <p><?php printf( \_\_( '<strong>Total Songs</strong>: %s', 'mobile-events-manager' ), count( $this->items ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  | 404 |  | <br /> |
  | 405 |  | <?php printf( \_\_( '<strong>Current Playlist Status</strong>: %s', 'mobile-events-manager' ), tmem\_playlist\_is\_open( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ? esc\_html\_\_( 'Open', 'mobile-events-manager' ) : esc\_html\_\_( 'Closed', 'mobile-events-manager' ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?> |
  |  | 440 | <p> |
  |  | 441 | <?php |
  |  | 442 | printf( /\* translators: %s Number of Songs \*/ |
  |  | 443 | \_\_( '<strong>Total Songs</strong>: %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 444 | count( $this->items )  // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 445 | ); |
  |  | 446 | ?> |
  |  | 447 | <br /> |
  |  | 448 | <?php |
  |  | 449 | printf( /\* translators: %% Playlist status \*/ |
  |  | 450 | \_\_( '<strong>Current Playlist Status</strong>: %s', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 451 | tmem\_playlist\_is\_open( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ? esc\_html\_\_( 'Open', 'mobile-events-manager' ) : esc\_html\_\_( 'Closed', 'mobile-events-manager' ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 452 | ); |
  |  | 453 | ?> |
  | 406 | 454 | </p> |
  | 407 | 455 |  |
  | 408 | 456 | <?php |
  | 409 |  | if ( $this->count\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) >= 0 ) : |
  |  | 457 | if ( $this->count\_entries( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) >= 0 ) : // phpcs:ignore WordPress.Security.NonceVerification |
  | 410 | 458 | ?> |
  | 411 | 459 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L413) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L461) |  |
  | 413 | 461 | <form method="post" target="\_blank"> |
  | 414 | 462 | <?php tmem\_admin\_action\_field( 'print\_playlist' ); ?> |
  | 415 |  | <input type="hidden" name="print\_playlist\_event\_id" id="print\_playlist\_event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> |
  |  | 463 | <input type="hidden" name="print\_playlist\_event\_id" id="print\_playlist\_event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> <?php // phpcs:ignore WordPress.Security.NonceVerification ?> |
  | 416 | 464 | <?php wp\_nonce\_field( 'print\_playlist\_entry', 'tmem\_nonce', true, true ); ?> |
  | 417 | 465 | <?php submit\_button( 'Print the Details', 'primary small', 'submit\_print\_pl', false ); ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L427) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L475) |  |
  | 427 | 475 | <?php tmem\_admin\_action\_field( 'email\_playlist' ); ?> |
  | 428 | 476 | <?php wp\_nonce\_field( 'email\_playlist\_entry', 'tmem\_nonce', true, true ); ?> |
  | 429 |  | <input type="hidden" name="email\_playlist\_event\_id" id="email\_playlist\_event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> |
  |  | 477 | <input type="hidden" name="email\_playlist\_event\_id" id="email\_playlist\_event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> <?php // phpcs:ignore WordPress.Security.NonceVerification ?> |
  | 430 | 478 | <?php submit\_button( 'Email the Details', 'primary small', 'submit\_email\_pl', false ); ?> |
  | 431 | 479 | <?php esc\_html\_e( ' and order Playlist by', 'mobile-events-manager' ); ?> <select name="email\_order\_by" id="email\_order\_by"> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L450) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L498) |  |
  | 450 | 498 | public function entry\_form() { |
  | 451 | 499 |  |
  | 452 |  | if ( ! isset( $\_GET['event\_id'] ) ) { |
  |  | 500 | if ( ! isset( $\_GET['event\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 453 | 501 | exit; |
  | 454 | 502 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L459) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L507) |  |
  | 459 | 507 | <?php wp\_nonce\_field( 'add\_playlist\_entry', 'tmem\_nonce', true, true ); ?> |
  | 460 | 508 | <?php tmem\_admin\_action\_field( 'add\_playlist\_entry' ); ?> |
  | 461 |  | <input type="hidden" id="event\_id" name="event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> |
  | 462 |  | <input type="hidden" id="added\_by" name="added\_by" value="<?php echo esc\_attr( tmem\_get\_event\_client\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); ?>" /> |
  |  | 509 | <input type="hidden" id="event\_id" name="event\_id" value="<?php echo esc\_attr( absint( wp\_unslash( $\_GET['event\_id'] ) ) ); ?>" /> <?php // phpcs:ignore WordPress.Security.NonceVerification ?> |
  |  | 510 | <input type="hidden" id="added\_by" name="added\_by" value="<?php echo esc\_attr( tmem\_get\_event\_client\_id( absint( wp\_unslash( $\_GET['event\_id'] ) ) ) ); ?>" /> <?php // phpcs:ignore WordPress.Security.NonceVerification ?> |
  | 463 | 511 | <table id="tmem-playlist-form-table"> |
  | 464 | 512 | <tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2576138#L535) | […](/browser/mobile-events-manager/trunk/includes/admin/events/class-tmem-playlist-table.php?rev=2647987#L583) |  |
  | 535 | 583 | public function prepare\_items() { |
  | 536 | 584 |  |
  | 537 |  | if ( ! isset( $\_GET['event\_id'] ) ) { |
  |  | 585 | if ( ! isset( $\_GET['event\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 538 | 586 | exit; |
  | 539 | 587 | } |
  | 540 | 588 |  |
  | 541 |  | $columns               = $this->get\_columns(); // Retrieve table columns |
  | 542 |  | $hidden                = array(); // Which fields are hidden |
  | 543 |  | $sortable              = $this->get\_sortable\_columns(); // Which fields can be sorted by |
  |  | 589 | $columns               = $this->get\_columns(); // Retrieve table columns. |
  |  | 590 | $hidden                = array(); // Which fields are hidden. |
  |  | 591 | $sortable              = $this->get\_sortable\_columns(); // Which fields can be sorted by. |
  | 544 | 592 | $this->\_column\_headers = array( $columns, $hidden, $sortable ); |
  | 545 | 593 |  |
  | 546 | 594 | $per\_page     = $this->get\_items\_per\_page( 'entries\_per\_page', 5 ); |
  | 547 | 595 | $current\_page = $this->get\_pagenum(); |
  | 548 |  | $total\_items  = $this->count\_entries( absint( wp\_~~unslash( $\_GET['event\_id']~~ ) ) ); |
  |  | 596 | $total\_items  = $this->count\_entries( absint( wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_GET['event\_id'] ) ) ) ) ); |
  | 549 | 597 |  |
  | 550 | 598 | $this->set\_pagination\_args( |
  | 551 | 599 | array( |
  | 552 |  | 'total\_items' => $total\_items, // We have to calculate the total number of items |
  | 553 |  | 'per\_page'    => $per\_page, // We have to determine how many items to show on a page |
  |  | 600 | 'total\_items' => $total\_items, // We have to calculate the total number of items. |
  |  | 601 | 'per\_page'    => $per\_page, // We have to determine how many items to show on a page. |
  | 554 | 602 | ) |
  | 555 | 603 | ); |
* ## [mobile-events-manager/trunk/includes/admin/events/contextual-help.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/contextual-help.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/contextual-help.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L32) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L32) |  |
  | 32 | 32 | $screen = get\_current\_screen(); |
  | 33 | 33 |  |
  | 34 |  | if ( ~~$screen->id != 'tmem-event'~~ ) { |
  |  | 34 | if ( 'tmem-event' !== $screen->id ) { |
  | 35 | 35 | return; |
  | 36 | 36 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L42) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L42) |  |
  | 42 | 42 | '<p><strong>' . \_\_( 'For more information:', 'mobile-events-manager' ) . '</strong></p>' . |
  | 43 | 43 | '<p>' . sprintf( |
  |  | 44 | /\* translators: %s URL for section \*/ |
  | 44 | 45 | \_\_( 'Visit the <a href="%s">documentation</a> on the Mobile Events Manager website.', 'mobile-events-manager' ), |
  | 45 | 46 | esc\_url( 'http://mobileeventsmanager.co.uk/support/' ) |
  | 46 | 47 | ) . '</p>' . |
  | 47 | 48 | '<p>' . sprintf( |
  |  | 49 | /\* translators: %s URL for section \*/ |
  | 48 | 50 | \_\_( 'Join our <a href="%s">Facebook Group</a>.', 'mobile-events-manager' ), |
  | 49 | 51 | esc\_url( 'https://www.facebook.com/groups/mobileeventsmanager/' ) |
  | 50 | 52 | ) . '</p>' . |
  | 51 | 53 | '<p>' . sprintf( |
  |  | 54 | /\* translators: %s URL for section \*/ |
  | 52 | 55 | \_\_( '<a href="%1$s">Post an issue</a> on <a href="%2$s">GitHub</a>.', 'mobile-events-manager' ), |
  | 53 | 56 | esc\_url( 'https://github.com/tmem/mobile-events-manager/issues' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L55) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L58) |  |
  | 55 | 58 | ) . '</p>' . |
  | 56 | 59 | '<p>' . sprintf( |
  |  | 60 | /\* translators: %s URL for section \*/ |
  | 57 | 61 | \_\_( 'View <a href="%s">add-ons</a>.', 'mobile-events-manager' ), |
  | 58 | 62 | esc\_url( 'http://mobileeventsmanager.co.uk/add-ons/' ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L63) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L67) |  |
  | 63 | 67 | array( |
  | 64 | 68 | 'id'      => 'tmem-event-options', |
  |  | 69 | /\* translators: %s Event/Events Options \*/ |
  | 65 | 70 | 'title'   => sprintf( \_\_( '%s Options', 'mobile-events-manager' ), $singular ), |
  | 66 | 71 | 'content' => |
  | 67 |  | '<p>' . sprintf( |
  |  | 72 | '<p>' . sprintf( /\* translators: %1 %2 Event %3 URL \*/ |
  | 68 | 73 | \_\_( '<strong>%1$s Status</strong> - Set the status of this %2$s. An description of each status can be found <a href="%3$s" target="\_blank">here</a>', 'mobile-events-manager' ), |
  | 69 | 74 | $singular, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L71) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L76) |  |
  | 71 | 76 | 'http://mobileeventsmanager.co.uk/docs/event-statuses/' |
  | 72 | 77 | ) . '</p>' . |
  | 73 |  | '<p>' . \_\_( '<strong>Email Quote Template</strong> - During transition to <strong>Enquiry</strong> status, select which quote email template should be sent to the client.', 'mobile-events-manager' ) . '</p>' . |
  | 74 |  | '<p>' . \_\_( '<strong>Online Quote Template</strong> - During transition to <strong>Enquiry</strong> status, select which quote template should be used to generate the page that displays the online quote.', 'mobile-events-manager' ) . '</p>' . |
  | 75 |  | '<p>' . sprintf( |
  |  | 78 | '<p>' . \_\_( '<strong>Email Quote Template</strong> - During transition to <strong>Enquiry</strong> status, select which qu  ote email template should be sent to the client.', 'mobile-events-manager' ) . '</p>' . |
  |  | 79 | '<p>' . \_\_( '<strong>Online Quote Template</strong> - During transition to <strong>Enquiry</strong> status, select which quote template should be used to generate the page that displays the online quote.', 'mobile-events-manager' ) . '</p>' . |
  |  | 80 | '<p>' . sprintf( |
  |  | 81 | /\* translators: %1 Deposit label \*/ |
  | 76 | 82 | \_\_( '<strong>%1$s Paid?</strong> - Select this option if the client has paid their %1$s.', 'mobile-events-manager' ), |
  | 77 | 83 | tmem\_get\_deposit\_label() |
  | 78 | 84 | ) . '</p>' . |
  | 79 | 85 | '<p>' . sprintf( |
  |  | 86 | /\* translators: %1 Balance label \*/ |
  | 80 | 87 | \_\_( '<strong>%1$s Paid?</strong> - Select this option if the client has paid their %1$s.', 'mobile-events-manager' ), |
  | 81 | 88 | tmem\_get\_balance\_label() |
  | 82 | 89 | ) . '</p>' . |
  | 83 | 90 | '<p>' . sprintf( |
  |  | 91 | /\* translators: %1 Playlist label \*/ |
  | 84 | 92 | \_\_( '<strong>Enable %1$s Playlist?</strong> - Toggle whether or not the client can manage the playlist for this %2$s.', 'mobile-events-manager' ), |
  | 85 | 93 | $singular, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L94) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L102) |  |
  | 94 | 102 | 'title'   => \_\_( 'Client Details', 'mobile-events-manager' ), |
  | 95 | 103 | 'content' => |
  |  | 104 | /\* translators: %s Event label \*/ |
  | 96 | 105 | '<p>' . sprintf( \_\_( "Select a client for this %s. If the client does not exist, you can select <em>Add New Client</em>. In doing so, additional fields will be displayed enabling you to enter the new client's details.", 'mobile-events-manager' ), strtolower( $singular ) ) . '</p>' . |
  | 97 | 106 | '<p>' . \_\_( '<strong>Disable Client Update Emails?</strong> - Selecting this option will stop any emails being sent to the client during update.', 'mobile-events-manager' ) . '</p>' . |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L103) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L112) |  |
  | 103 | 112 | array( |
  | 104 | 113 | 'id'      => 'tmem-event-details', |
  |  | 114 | /\* translators: %s Event label \*/ |
  | 105 | 115 | 'title'   => sprintf( \_\_( '%s Details', 'mobile-events-manager' ), $singular ), |
  | 106 | 116 | 'content' => |
  | 107 | 117 | '<p>' . sprintf( |
  |  | 118 | /\* translators: %1 %2 Event label %3 URL \*/ |
  | 108 | 119 | \_\_( '<strong>%1$s Type</strong> - Set the type of %2$s <em>i.e. Wedding or 40th Birthday</em>. You can define the types <a href="%3$s">here</a> or simply click the <i class="fas fa-plus"></i> icon to add a new %2$s type inline.', 'mobile-events-manager' ), |
  | 109 | 120 | $singular, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L111) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L122) |  |
  | 111 | 122 | admin\_url( 'edit-tags.php?taxonomy=event-types&post\_type=tmem-event' ) |
  | 112 | 123 | ) . '</p>' . |
  |  | 124 | /\* translators: %1 %2 Event label \*/ |
  | 113 | 125 | '<p>' . sprintf( \_\_( '<strong>%1$s Contract</strong> - Select the contract associated with this %2$s.', 'mobile-events-manager' ), $singular, strtolower( $singular ) ) . '</p>' . |
  |  | 126 | /\* translators: %1 %2 Event label \*/ |
  | 114 | 127 | '<p>' . sprintf( \_\_( '<strong>%1$s Name</strong> - Assign a name for this %2$s. Can be viewed and adjusted by the client.', 'mobile-events-manager' ), $singular, strtolower( $singular ) ) . '</p>' . |
  | 115 | 128 | '<p>' . sprintf( |
  |  | 129 | /\* translators: %1 %2 Event label \*/ |
  | 116 | 130 | \_\_( '<strong>%1$s Date</strong> - Use the datepicker to set the date for this %2$s.', 'mobile-events-manager' ), |
  | 117 | 131 | $singular, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L119) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L133) |  |
  | 119 | 133 | ) . '</p>' . |
  | 120 | 134 | '<p>' . sprintf( |
  |  | 135 | /\* translators: %s Event label \*/ |
  | 121 | 136 | \_\_( '<strong>Start Time</strong> - Set the start time of the %s', 'mobile-events-manager' ), |
  | 122 | 137 | strtolower( $singular ) |
  | 123 | 138 | ) . '</p>' . |
  | 124 | 139 | '<p>' . sprintf( |
  |  | 140 | /\* translators: %s Event label \*/ |
  | 125 | 141 | \_\_( '<strong>End Time</strong> - Set the end time of the %s', 'mobile-events-manager' ), |
  | 126 | 142 | strtolower( $singular ) |
  | 127 | 143 | ) . '</p>' . |
  | 128 | 144 | '<p>' . sprintf( |
  |  | 145 | /\* translators: %s Event label \*/ |
  | 129 | 146 | \_\_( '<strong>Total Cost</strong> - Enter the total cost of the %s. If using equipment packages and add-ons, selecting these will automatically set this cost.', 'mobile-events-manager' ), |
  | 130 | 147 | strtolower( $singular ) |
  | 131 | 148 | ) . '</p>' . |
  | 132 | 149 | '<p>' . sprintf( |
  |  | 150 | /\* translators: %1 Deposit label %2 Contract label \*/ |
  | 133 | 151 | \_\_( '<strong>%1$s</strong> - Enter the %1$s that needs to be collected for this %2$s upon contract signing. This field can be auto populated depending on your settings and equipment packages and add-on selections', 'mobile-events-manager' ), |
  | 134 | 152 | tmem\_get\_deposit\_label(), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L136) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L154) |  |
  | 136 | 154 | ) . '</p>' . |
  | 137 | 155 | '<p>' . sprintf( |
  |  | 156 | /\* translators: %1 Event label \*/ |
  | 138 | 157 | \_\_( '<strong>Select an %1$s Package</strong> - If packages are enabled and defined you can assign one to the %1$s here. Doing so will auto update the <em>Total Cost</em> and <em>%2$s</em> fields. Additionally, the <em>Select Add-ons</em> options will be updated to exclude add-ons included within the selected package.', 'mobile-events-manager' ), |
  | 139 | 158 | $singular, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L141) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L160) |  |
  | 141 | 160 | ) . '</p>' . |
  | 142 | 161 | '<p>' . sprintf( |
  |  | 162 | /\* translators: %1 Event label \*/ |
  | 143 | 163 | \_\_( '<strong>Select Add-ons</strong> - If packages are enabled you can assign add-ons to your %1$s here. The <em>Total Cost</em> and <em>%2$s</em> fields will be updated automatically to reflect the new costs.', 'mobile-events-manager' ), |
  | 144 | 164 | strtolower( $singular ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L152) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L172) |  |
  | 152 | 172 | array( |
  | 153 | 173 | 'id'      => 'tmem-event-employees', |
  |  | 174 | /\* translators: %s Event label \*/ |
  | 154 | 175 | 'title'   => sprintf( \_\_( '%s Employees', 'mobile-events-manager' ), $singular ), |
  | 155 | 176 | 'content' => |
  | 156 | 177 | '<p>' . sprintf( |
  |  | 178 | /\* translators: %s Event label \*/ |
  | 157 | 179 | \_\_( '<strong>Select Primary Employee</strong> - Select the primary employee for this %s.', 'mobile-events-manager' ), |
  | 158 | 180 | strtolower( $singular ) |
  | 159 | 181 | ) . '</p>' . |
  | 160 | 182 | '<p>' . sprintf( |
  |  | 183 | /\* translators: %1 Event label \*/ |
  | 161 | 184 | \_\_( 'Employees that are assigned to the %1$s are listed here together with their role and wage. You can add additional employees to the %1$s, select their %1$s role and allocate their wages.', 'mobile-events-manager' ), |
  | 162 | 185 | strtolower( $singular ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L181) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L204) |  |
  | 181 | 204 | 'content' => |
  | 182 | 205 | '<p>' . sprintf( |
  |  | 206 | /\* translators: %1 Event label \*/ |
  | 183 | 207 | \_\_( 'This section allows you to add transactions associated with the %1$s as well as listing existing associated transactions.', 'mobile-events-manager' ), |
  | 184 | 208 | strtolower( $singular ) |
  | 185 | 209 | ) . '</p>' . |
  | 186 | 210 | '<p>' . sprintf( |
  |  | 211 | /\* translators: %1 Event label \*/ |
  | 187 | 212 | \_\_( 'If transactions already exist, the total amount of income and expenditure is displayed as well as the total overall earnings so far for the %1$s.', 'mobile-events-manager' ), |
  | 188 | 213 | strtolower( $singular ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2455787#L198) | […](/browser/mobile-events-manager/trunk/includes/admin/events/contextual-help.php?rev=2647987#L223) |  |
  | 198 | 223 | '<p>' . \_\_( '<strong>Enquiry Source</strong> - Select how the client heard about your business', 'mobile-events-manager' ) . '</p>' . |
  | 199 | 224 | '<p>' . sprintf( |
  |  | 225 | /\* translators: %s Event label \*/ |
  | 200 | 226 | \_\_( '<strong>Setup Date</strong> - Use the datepicker to select the date that you need to setup for this %s.', 'mobile-events-manager' ), |
  | 201 | 227 | strtolower( $singular ) |
  | 202 | 228 | ) . '</p>' . |
  | 203 | 229 | '<p>' . sprintf( |
  |  | 230 | /\* translators: %s Event label \*/ |
  | 204 | 231 | \_\_( '<strong>Setup Time</strong> - Select the time that you need to setup for this %s.', 'mobile-events-manager' ), |
  | 205 | 232 | strtolower( $singular ) |
* ## [mobile-events-manager/trunk/includes/admin/events/event-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/event-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/event-actions.php")

  | [r2514025](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L16 "Show revision 2514025 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L25) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L25) |  |
  | 25 | 25 | \* |
  | 26 | 26 | \* @since   1.4 |
  | 27 |  | \* @param   arr   Array of form post data. |
  |  | 27 | \* @param   arr $data  Array of form post data. |
  | 28 | 28 | \*/ |
  | 29 | 29 | function tmem\_add\_event\_playlist\_entry\_action( $data ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L58) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L58) |  |
  | 58 | 58 | \* |
  | 59 | 59 | \* @since   1.3 |
  | 60 |  | ~~\* @param   arr $\_POST super global~~ |
  | 61 | 60 | \* @return  void |
  | 62 | 61 | \*/ |
  | 63 | 62 | function tmem\_bulk\_action\_remove\_playlist\_entry\_action() { |
  | 64 | 63 |  |
  | 65 |  | if ( isset( $\_POST['action'] ) ) { |
  | 66 |  | $action = sanitize\_text\_field( wp\_unslash( $\_POST['action'] ) ); |
  | 67 |  | } elseif ( isset( $\_POST['action2'] ) ) { |
  | 68 |  | $action = sanitize\_text\_field( wp\_unslash( $\_POST['action2'] ) ); |
  |  | 64 | if ( isset( $\_POST['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 65 | $action = sanitize\_text\_field( wp\_unslash( $\_POST['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 66 | } elseif ( isset( $\_POST['action2'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 67 | $action = sanitize\_text\_field( wp\_unslash( $\_POST['action2'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 69 | 68 | } else { |
  | 70 | 69 | return; |
  | 71 | 70 | } |
  | 72 | 71 |  |
  | 73 |  | if ( ! isset( $action, $\_POST['tmem-playlist-bulk-delete'] ) ) { |
  |  | 72 | if ( ! isset( $action, $\_POST['tmem-playlist-bulk-delete'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 74 | 73 | return; |
  | 75 | 74 | } |
  | 76 | 75 |  |
  | 77 |  | foreach ( ~~wp\_unslash( $\_POST['tmem-playlist-bulk-delete'] ) as $id ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized~~ |
  |  | 76 | foreach ( sanitize\_text\_field( wp\_unslash( $\_POST['tmem-playlist-bulk-delete'] ) ) as $id ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 78 | 77 | tmem\_remove\_stored\_playlist\_entry( absint( wp\_unslash( $id ) ) ); |
  | 79 | 78 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L95) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L94) |  |
  | 95 | 94 | \* |
  | 96 | 95 | \* @since   1.3 |
  | 97 |  | \* @param   int|arr $~~entry\_ids  Playlist entries to remove~~ |
  |  | 96 | \* @param   int|arr $data  Playlist entries to remove. |
  | 98 | 97 | \* @return  void |
  | 99 | 98 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L127) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L126) |  |
  | 127 | 126 | \* |
  | 128 | 127 | \* @since   1.3 |
  | 129 |  | \* @param   arr $data   The super global $\_POST |
  | 130 |  | \* @return  str     Output for the print page. |
  |  | 128 | \* @param   arr $data   The super global $\_POST. |
  | 131 | 129 | \*/ |
  | 132 | 130 | function tmem\_print\_event\_playlist\_action( $data ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L219) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L217) |  |
  | 219 | 217 | \* |
  | 220 | 218 | \* @since   1.3 |
  | 221 |  | \* @param   arr $data   The super global $\_POST |
  | 222 |  | \* @return  void |
  |  | 219 | \* @param   arr $data   The super global $\_POST. |
  | 223 | 220 | \*/ |
  | 224 | 221 | function tmem\_email\_event\_playlist\_action( $data ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L248) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L245) |  |
  | 248 | 245 | 'event\_id'   => $tmem\_event->ID, |
  | 249 | 246 | 'client\_id'  => $tmem\_event->client, |
  |  | 247 | /\* translators: %s Event \*/ |
  | 250 | 248 | 'subject'    => sprintf( \_\_( 'Playlist for %s ID {contract\_id}', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 251 | 249 | 'message'    => $html\_content\_start . $content . $html\_content\_end, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2514025#L271) | […](/browser/mobile-events-manager/trunk/includes/admin/events/event-actions.php?rev=2647987#L269) |  |
  | 271 | 269 | \* |
  | 272 | 270 | \* @since   1.3 |
  | 273 |  | \* @param   arr $data   The super global $\_POST |
  | 274 |  | \* @return  str     Output for the print page. |
  | 275 |  | \*/ |
  | 276 |  |  |
  |  | 271 | \* @param   arr $data   The super global $\_POST. |
  |  | 272 | \*/ |
  | 277 | 273 | function tmem\_print\_event\_details\_action( $data ) { |
  | 278 | 274 | if ( ! wp\_verify\_nonce( $data['tmem\_nonce'], 'print\_event\_details' ) ) { |
* ## [mobile-events-manager/trunk/includes/admin/events/events.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/events.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/events.php")

  | [r2637682](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L12 "Show revision 2637682 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L12 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | \* |
  | 13 | 13 | \* @since   0.5 |
  | 14 |  | \*/ |
  |  | 14 | \* @package TMEM |
  |  | 15 | \*/ |
  |  | 16 |  |
  | 15 | 17 | if ( ! defined( 'ABSPATH' ) ) { |
  | 16 | 18 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L18) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L20) |  |
  | 18 | 20 |  |
  | 19 | 21 | /\*\* |
  | 20 |  | \* Define the columns to be displayed for event posts |
  |  | 22 | \* Define the columns to be displayed for event posts. |
  | 21 | 23 | \* |
  | 22 | 24 | \* @since   0.5 |
  | 23 |  | \* @param   arr $columns    Array of column names |
  |  | 25 | \* @param   arr $columns    Array of column names. |
  | 24 | 26 | \* @return  arr     $columns    Filtered array of column names |
  | 25 | 27 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L29) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L31) |  |
  | 29 | 31 | 'cb'           => '<input type="checkbox" />', |
  | 30 | 32 | 'event\_date'   => \_\_( 'Date', 'mobile-events-manager' ), |
  |  | 33 | /\* translators: %s Event Events placeholder \*/ |
  | 31 | 34 | 'event\_id'     => sprintf( \_\_( '%s ID', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 32 | 35 | 'client'       => \_\_( 'Client', 'mobile-events-manager' ), |
  | 33 | 36 | 'employees'    => \_\_( 'Employees', 'mobile-events-manager' ), |
  | 34 | 37 | 'event\_status' => \_\_( 'Status', 'mobile-events-manager' ), |
  |  | 38 | /\* translators: %s Event Events placeholder \*/ |
  | 35 | 39 | 'event\_type'   => sprintf( \_\_( '%s type', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 36 | 40 | 'event\_name'   => \_\_( 'Name', 'mobile-events-manager' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L65) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L69) |  |
  | 65 | 69 | function tmem\_event\_post\_hidden\_columns( $hidden, $screen ) { |
  | 66 | 70 |  |
  | 67 |  | if ( 'edit-tmem-event' == $screen->id ) { |
  |  | 71 | if ( 'edit-tmem-event' === $screen->id ) { |
  | 68 | 72 | $hidden[] = 'event\_name'; |
  | 69 | 73 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L74) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L78) |  |
  | 74 | 78 |  |
  | 75 | 79 | /\*\* |
  | 76 |  | \* Define which columns are sortable for event posts |
  |  | 80 | \* Define which columns are sortable for event posts. |
  | 77 | 81 | \* |
  | 78 | 82 | \* @since   0.7 |
  | 79 |  | \* @param   arr $sortable\_columns   Array of event post sortable columns |
  |  | 83 | \* @param   arr $sortable\_columns   Array of event post sortable columns. |
  | 80 | 84 | \* @return  arr     $sortable\_columns   Filtered Array of event post sortable columns |
  | 81 | 85 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L93) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L97) |  |
  | 93 | 97 | \* |
  | 94 | 98 | \* @since   0.9 |
  | 95 |  | \* @param   str $column\_name    The name of the column to display |
  | 96 |  | \* @param   int $post\_id        The current post ID |
  | 97 |  | \* @return |
  |  | 99 | \* @param   str $column\_name    The name of the column to display. |
  |  | 100 | \* @param   int $post\_id        The current post ID. |
  | 98 | 101 | \*/ |
  | 99 | 102 | function tmem\_event\_posts\_custom\_column( $column\_name, $post\_id ) { |
  | 100 | 103 | global $post; |
  | 101 | 104 |  |
  | 102 |  | if ( tmem\_employee\_can( 'edit\_txns' ) && ~~$column\_name == 'value'~~ ) { |
  |  | 105 | if ( tmem\_employee\_can( 'edit\_txns' ) && 'value' === $column\_name ) { |
  | 103 | 106 | $value = tmem\_get\_event\_price( $post\_id ); |
  | 104 | 107 | } |
  | 105 | 108 |  |
  | 106 | 109 | switch ( $column\_name ) { |
  | 107 |  | // Event Date |
  |  | 110 | // Event Date. |
  | 108 | 111 | case 'event\_date': |
  | 109 | 112 | if ( tmem\_employee\_can( 'read\_events' ) ) { |
  | 110 |  | echo '<strong><a href="' . esc\_url( admin\_url( 'post.php?post=' . $post\_id . '&action=edit' ) ) . '">' . esc\_html( date( 'd M Y', strtotime( get\_post\_meta( $post\_id, '\_tmem\_event\_date', true ) ) ) ) . '</a>'; |
  |  | 113 | echo '<strong><a href="' . esc\_url( admin\_url( 'post.php?post=' . $post\_id . '&action=edit' ) ) . '">' . esc\_html( gmdate( 'd M Y', strtotime( get\_post\_meta( $post\_id, '\_tmem\_event\_date', true ) ) ) ) . '</a>'; |
  | 111 | 114 | } else { |
  | 112 |  | echo '<strong>' . esc\_html( date( 'd M Y', strtotime( get\_post\_meta( $post\_id, '\_tmem\_event\_date', true ) ) ) ) . '</strong>'; |
  |  | 115 | echo '<strong>' . esc\_html( gmdate( 'd M Y', strtotime( get\_post\_meta( $post\_id, '\_tmem\_event\_date', true ) ) ) ) . '</strong>'; |
  | 113 | 116 | } |
  | 114 | 117 | break; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L118) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L121) |  |
  | 118 | 121 | break; |
  | 119 | 122 |  |
  | 120 |  | // Client |
  |  | 123 | // Client. |
  | 121 | 124 | case 'client': |
  | 122 | 125 | $client = get\_userdata( get\_post\_meta( $post->ID, '\_tmem\_event\_client', true ) ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L147) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L150) |  |
  | 147 | 150 | break; |
  | 148 | 151 |  |
  | 149 |  | // Employees |
  |  | 152 | // Employees. |
  | 150 | 153 | case 'employees': |
  | 151 | 154 | global $wp\_roles; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L209) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L212) |  |
  | 209 | 212 | echo '</em>'; |
  | 210 | 213 |  |
  | 211 |  | if ( ~~$i != count( $employees )~~ ) { |
  |  | 214 | if ( count( $employees ) !== $i ) { |
  | 212 | 215 | echo '<br />'; |
  | 213 | 216 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L217) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L220) |  |
  | 217 | 220 | break; |
  | 218 | 221 |  |
  | 219 |  | // Status |
  |  | 222 | // Status. |
  | 220 | 223 | case 'event\_status': |
  | 221 | 224 | echo esc\_html( get\_post\_status\_object( $post->post\_status )->label ); |
  | 222 | 225 | break; |
  | 223 | 226 |  |
  | 224 |  | // Event Type |
  |  | 227 | // Event Type. |
  | 225 | 228 | case 'event\_type': |
  | 226 | 229 | $event\_types = get\_the\_terms( $post\_id, 'event-types' ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L233) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L236) |  |
  | 233 | 236 | break; |
  | 234 | 237 |  |
  | 235 |  | // Event Name |
  |  | 238 | // Event Name. |
  | 236 | 239 | case 'event\_name': |
  | 237 | 240 | echo esc\_html( tmem\_get\_event\_name( $post\_id ) ); |
  | 238 | 241 | break; |
  | 239 | 242 |  |
  | 240 |  | // Value |
  |  | 243 | // Value. |
  | 241 | 244 | case 'value': |
  | 242 | 245 | if ( tmem\_employee\_can( 'edit\_txns' ) ) { |
  | 243 |  | if ( ! empty( $value ) && ~~$value != '0.00'~~ ) { |
  | 244 |  |  |
  | 245 |  | echo ~~tmem\_currency\_filter( tmem\_format\_amount( $value~~ ) ); |
  |  | 246 | if ( ! empty( $value ) && '0.00' !== $value ) { |
  |  | 247 |  |
  |  | 248 | echo esc\_html( tmem\_currency\_filter( tmem\_format\_amount( $value ) ) ); |
  | 246 | 249 | echo '<br />'; |
  | 247 | 250 |  |
  | 248 | 251 | } else { |
  | 249 |  | echo '<span class="tmem-form-error">' . ~~tmem\_currency\_filter( tmem\_format\_amount( '0.00'~~ ) ) . '</span>'; |
  |  | 252 | echo '<span class="tmem-form-error">' . esc\_html( tmem\_currency\_filter( tmem\_format\_amount( '0.00' ) ) ) . '</span>'; |
  | 250 | 253 | } |
  | 251 | 254 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L254) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L257) |  |
  | 254 | 257 | break; |
  | 255 | 258 |  |
  | 256 |  | // Balance |
  |  | 259 | // Balance. |
  | 257 | 260 | case 'balance': |
  | 258 | 261 | if ( tmem\_employee\_can( 'edit\_txns' ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L264) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L267) |  |
  | 264 | 267 | $deposit\_status = tmem\_get\_event\_deposit\_status( $post\_id ); |
  | 265 | 268 |  |
  | 266 |  | if ( 'Paid' == tmem\_get\_event\_deposit\_status( $post\_id ) ) { |
  |  | 269 | if ( 'Paid' === tmem\_get\_event\_deposit\_status( $post\_id ) ) { |
  | 267 | 270 | printf( |
  |  | 271 | /\* translators: %1 Deposit %2 amount \*/ |
  | 268 | 272 | \_\_( '<i title="%1$s %2$s paid" class="far fa-check-square" aria-hidden="true">', 'mobile-events-manager' ), // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 269 | 273 | esc\_html( tmem\_currency\_filter( tmem\_format\_amount( tmem\_get\_event\_deposit( $post\_id ) ) ) ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L276) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L280) |  |
  | 276 | 280 | break; |
  | 277 | 281 |  |
  | 278 |  | // Playlist |
  |  | 282 | // Playlist. |
  | 279 | 283 | case 'playlist': |
  | 280 | 284 | if ( tmem\_employee\_can( 'read\_events' ) ) { |
  | 281 | 285 | $total = tmem\_count\_playlist\_entries( $post\_id ); |
  | 282 | 286 |  |
  | 283 |  | echo '<a href="' . esc\_url( tmem\_get\_admin\_page( 'playlists' ) . $post\_id ) . '">' . |
  |  | 287 | echo '<a href="' . esc\_url( tmem\_get\_admin\_page( 'playlists' ) . $post\_id ) . '">' . |
  | 284 | 288 | esc\_html( \_n( 'Details', 'Details', $total, 'mobile-events-manager' ) ) . '</a>' . "\r\n"; |
  | 285 | 289 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L288) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L292) |  |
  | 288 | 292 | break; |
  | 289 | 293 |  |
  | 290 |  | // Journal |
  |  | 294 | // Journal. |
  | 291 | 295 | case 'journal': |
  | 292 | 296 | if ( tmem\_employee\_can( 'read\_events\_all' ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L300) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L304) |  |
  | 300 | 304 | } |
  | 301 | 305 | break; |
  | 302 |  |  |
  | 303 |  | /\* |
  | 304 |  | \* Display venue name on events page |
  |  | 306 |  |
  |  | 307 | /\* |
  |  | 308 | \* Display venue name on events page |
  | 305 | 309 | \* copyright Dan Porter, Jack Mawhinney |
  | 306 |  | \* |
  |  | 310 | \* |
  | 307 | 311 | \*/ |
  | 308 |  | // Venue Name |
  |  | 312 | // Venue Name. |
  | 309 | 313 | case 'venue': |
  | 310 | 314 | $tmem\_event = new TMEM\_Event( $post\_id ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L321) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L325) |  |
  | 321 | 325 | \* |
  | 322 | 326 | \* @since   1.0 |
  | 323 |  | \* @param   arr $actions    Array of actions |
  |  | 327 | \* @param   arr $actions    Array of actions. |
  | 324 | 328 | \* @return  arr     $actions    Filtered Array of actions |
  | 325 | 329 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L335) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L339) |  |
  | 335 | 339 | \* |
  | 336 | 340 | \* @since   1.3 |
  | 337 |  | ~~\* @param~~ |
  | 338 |  | ~~\* @return~~ |
  | 339 | 341 | \*/ |
  | 340 | 342 | function tmem\_event\_add\_reject\_bulk\_actions() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L342) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L344) |  |
  | 342 | 344 | global $post; |
  | 343 | 345 |  |
  | 344 |  | $current\_status = isset( $\_GET['post\_status'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_status'] ) ) : false; |
  | 345 |  |  |
  | 346 |  | if ( ~~$current\_status != 'tmem-unattended' || 'tmem-event' != get\_post\_type() ) {~~ |
  |  | 346 | $current\_status = isset( $\_GET['post\_status'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_status'] ) ) : false; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 347 |  |
  |  | 348 | if ( 'tmem-unattended' !== $current\_status || 'tmem-event' !== get\_post\_type() ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 347 | 349 | return; |
  | 348 | 350 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L364) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L366) |  |
  | 364 | 366 | \* |
  | 365 | 367 | \* @since   1.3 |
  | 366 |  | ~~\* @param~~ |
  | 367 |  | ~~\* @return~~ |
  | 368 | 368 | \*/ |
  | 369 | 369 | function tmem\_event\_instant\_reject() { |
  | 370 | 370 |  |
  | 371 |  | if ( ! isset( $\_REQUEST['post\_status'] ) || ~~$\_REQUEST['post\_status'] != 'tmem-unattended' || isset( $\_REQUEST['tmem-message'] ) ) {~~ |
  | 372 |  | return; |
  | 373 |  | } |
  | 374 |  |  |
  | 375 |  | if ( isset( $\_REQUEST['action'] ) ) { |
  | 376 |  | $action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['action'] ) ); |
  | 377 |  | } elseif ( isset( $\_REQUEST['action2'] ) ) { |
  | 378 |  | $action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['action2'] ) ); |
  |  | 371 | if ( ! isset( $\_REQUEST['post\_status'] ) || 'tmem-unattended' !== $\_REQUEST['post\_status'] || isset( $\_REQUEST['tmem-message'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 372 | return; |
  |  | 373 | } |
  |  | 374 |  |
  |  | 375 | if ( isset( $\_REQUEST['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 376 | $action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 377 | } elseif ( isset( $\_REQUEST['action2'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 378 | $action = sanitize\_text\_field( wp\_unslash( $\_REQUEST['action2'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 379 | 379 | } else { |
  | 380 | 380 | $action = ''; |
  | 381 | 381 | } |
  | 382 | 382 |  |
  | 383 |  | if ( empty( $action ) || ~~$action != 'reject\_enquiry' || empty( $\_REQUEST['post'] ) ) {~~ |
  |  | 383 | if ( empty( $action ) || 'reject\_enquiry' !== $action || empty( $\_REQUEST['post'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 384 | 384 | return; |
  | 385 | 385 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L394) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L394) |  |
  | 394 | 394 | $i = 0; |
  | 395 | 395 |  |
  | 396 |  | foreach ( wp\_unslash( $\_REQUEST['post'] ) as $event\_id ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 396 | foreach ( wp\_unslash( $\_REQUEST['post'] ) // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 397 | as $event\_id ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 397 | 398 | if ( ! tmem\_update\_event\_status( $event\_id, 'tmem-rejected', get\_post\_status( $event\_id ), $args ) ) { |
  | 398 | 399 | $message = 'unattended\_enquiries\_rejected\_failed'; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L422) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L423) |  |
  | 422 | 423 | \* |
  | 423 | 424 | \* @since   1.0 |
  | 424 |  | ~~\* @param~~ |
  | 425 |  | ~~\* @return  void~~ |
  | 426 | 425 | \*/ |
  | 427 | 426 | function tmem\_event\_post\_filter\_list() { |
  | 428 | 427 |  |
  | 429 |  | if ( ! isset( $\_GET['post\_type'] ) || ~~$\_GET['post\_type'] != 'tmem-event' ) {~~ |
  |  | 428 | if ( ! isset( $\_GET['post\_type'] ) || 'tmem-event' !== $\_GET['post\_type'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 430 | 429 | return; |
  | 431 | 430 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L449) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L448) |  |
  | 449 | 448 | \* |
  | 450 | 449 | \* @since   1.0 |
  | 451 |  | ~~\* @param~~ |
  | 452 |  | ~~\* @return  void~~ |
  | 453 | 450 | \*/ |
  | 454 | 451 | function tmem\_event\_date\_filter\_dropdown() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L462) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L459) |  |
  | 462 | 459 | $month\_count = count( $months ); |
  | 463 | 460 |  |
  | 464 |  | if ( ! $month\_count || ( 1 ==~~$month\_count && 0~~ == $months[0]->month ) ) { |
  | 465 |  | return; |
  | 466 |  | } |
  | 467 |  |  |
  | 468 |  | $m = isset( $\_GET['tmem\_filter\_date'] ) ? (int) $\_GET['tmem\_filter\_date'] : 0; |
  |  | 461 | if ( ! $month\_count || ( 1 === $month\_count && 0 === $months[0]->month ) ) { |
  |  | 462 | return; |
  |  | 463 | } |
  |  | 464 |  |
  |  | 465 | $m = isset( $\_GET['tmem\_filter\_date'] ) ? (int) $\_GET['tmem\_filter\_date'] : 0; // phpcs:ignore WordPress.Security.NonceVerification |
  | 469 | 466 |  |
  | 470 | 467 | ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L474) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L471) |  |
  | 474 | 471 | <?php |
  | 475 | 472 | foreach ( $months as $arc\_row ) { |
  | 476 |  | if ( 0 == $arc\_row->year ) { |
  |  | 473 | if ( 0 === $arc\_row->year ) { |
  | 477 | 474 | continue; |
  | 478 | 475 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L485) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L482) |  |
  | 485 | 482 | selected( $m, $year . $month, false ), |
  | 486 | 483 | esc\_attr( $arc\_row->year . $month ), |
  | 487 |  | ~~/\* translators: 1: month name, 2: 4-digit year \*/~~ |
  | 488 | 484 | sprintf( |
  |  | 485 | /\* translators: %1 month name, %2: year \*/ |
  | 489 | 486 | esc\_html\_\_( '%1$s %2$d', 'mobile-events-manager' ), |
  | 490 | 487 | esc\_attr( $wp\_locale->get\_month( $month ) ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L502) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L499) |  |
  | 502 | 499 | \* |
  | 503 | 500 | \* @since   1.0 |
  | 504 |  | ~~\* @param~~ |
  | 505 |  | ~~\* @return~~ |
  | 506 | 501 | \*/ |
  | 507 | 502 | function tmem\_event\_type\_filter\_dropdown() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L517) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L512) |  |
  | 517 | 512 | ); |
  | 518 | 513 |  |
  | 519 |  | $current = isset( $\_GET['tmem\_filter\_type'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_type'] ) ) : ''; |
  |  | 514 | $current = isset( $\_GET['tmem\_filter\_type'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_type'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  | 520 | 515 |  |
  | 521 | 516 | ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L523) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L518) |  |
  | 523 | 518 | <?php if ( $event\_types ) : ?> |
  | 524 | 519 | <select name="tmem\_filter\_type"> |
  |  | 520 | <?php /\* translators: %s Event Events \*/ ?> |
  | 525 | 521 | <option value=""><?php printf( esc\_html\_\_( 'All %s Types', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></option> |
  | 526 | 522 | <?php foreach ( $event\_types as $event\_type ) : ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L538) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L534) |  |
  | 538 | 534 | \* |
  | 539 | 535 | \* @since   1.0 |
  | 540 |  | ~~\* @param~~ |
  | 541 | 536 | \* @return  str     Outputs the dropdown for the employee filter |
  | 542 | 537 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L546) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L541) |  |
  | 546 | 541 | $employee\_count = count( $employees ); |
  | 547 | 542 |  |
  | 548 |  | if ( ! $employee\_count || 1 == $employee\_count ) { |
  |  | 543 | if ( ! $employee\_count || 1 === $employee\_count ) { |
  | 549 | 544 | return; |
  | 550 | 545 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L558) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L553) |  |
  | 558 | 553 | 'name'            => 'tmem\_filter\_employee', |
  | 559 | 554 | 'id'              => 'filter-by-employee', |
  | 560 |  | 'selected'        => isset( $\_GET['tmem\_filter\_employee'] ) ? absint( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ) : 0, |
  |  | 555 | 'selected'        => isset( $\_GET['tmem\_filter\_employee'] ) ? absint( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ) : 0, // phpcs:ignore WordPress.Security.NonceVerification |
  | 561 | 556 | 'first\_entry'     => \_\_( 'All Employees', 'mobile-events-manager' ), |
  | 562 | 557 | 'first\_entry\_val' => 0, |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L573) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L568) |  |
  | 573 | 568 | \* |
  | 574 | 569 | \* @since   1.0 |
  | 575 |  | ~~\* @param   arr~~ |
  | 576 |  | ~~\* @return  arr~~ |
  | 577 | 570 | \*/ |
  | 578 | 571 | function tmem\_event\_client\_filter\_dropdown() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L583) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L576) |  |
  | 583 | 576 | $all\_clients = tmem\_get\_clients( $roles, $employee ); |
  | 584 | 577 |  |
  | 585 |  | if ( ! $all\_clients || 1 == count( $all\_clients ) ) { |
  | 586 |  | return; |
  | 587 |  | } |
  | 588 |  |  |
  | 589 |  | $selected = isset( $\_GET['tmem\_filter\_client'] ) ? (int) $\_GET['tmem\_filter\_client'] : 0; |
  |  | 578 | if ( ! $all\_clients || 1 === count( $all\_clients ) ) { |
  |  | 579 | return; |
  |  | 580 | } |
  |  | 581 |  |
  |  | 582 | $selected = isset( $\_GET['tmem\_filter\_client'] ) ? (int) $\_GET['tmem\_filter\_client'] : 0; // phpcs:ignore WordPress.Security.NonceVerification |
  | 590 | 583 |  |
  | 591 | 584 | foreach ( $all\_clients as $\_client ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L628) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L621) |  |
  | 628 | 621 | \* |
  | 629 | 622 | \* @since   1.0 |
  | 630 |  | \* @param   arr $views      Array of views |
  |  | 623 | \* @param   arr $views      Array of views. |
  | 631 | 624 | \* @return  arr     $views      Filtered Array of views |
  | 632 | 625 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L635) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L628) |  |
  | 635 | 628 | $active\_only = tmem\_get\_option( 'show\_active\_only' ); |
  | 636 | 629 |  |
  | 637 |  | if ( 'tmem-event' != get\_post\_type() || ! $active\_only ) { |
  |  | 630 | if ( 'tmem-event' !== get\_post\_type() || ! $active\_only ) { |
  | 638 | 631 | return $views; |
  | 639 | 632 | } |
  | 640 | 633 |  |
  | 641 | 634 | $args = array(); |
  | 642 |  | if ( ! empty( $\_GET['tmem\_filter\_employee'] ) || ! tmem\_employee\_can( 'read\_events\_all' ) ) { |
  |  | 635 | if ( ! empty( $\_GET['tmem\_filter\_employee'] ) || ! tmem\_employee\_can( 'read\_events\_all' ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 643 | 636 | $args['employee'] = get\_current\_user\_id(); |
  | 644 | 637 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L664) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L657) |  |
  | 664 | 657 |  |
  | 665 | 658 | if ( $active\_only ) { |
  | 666 |  | $search       = \_\_( 'All', 'mobile-events-manager' ); |
  |  | 659 | $search = \_\_( 'All', 'mobile-events-manager' ); |
  |  | 660 | /\* translators: %s Event or Events \*/ |
  | 667 | 661 | $replace      = sprintf( \_\_( 'Active %s', 'mobile-events-manager' ), tmem\_get\_label\_plural() ); |
  | 668 | 662 | $views['all'] = str\_replace( $search, $replace, $views['all'] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L670) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L664) |  |
  | 670 | 664 |  |
  | 671 | 665 | foreach ( $views as $status => $link ) { |
  | 672 |  | if ( ~~$status != 'all'~~ && ! in\_array( $status, $all\_statuses ) ) { |
  |  | 666 | if ( 'all' !== $status && ! in\_array( $status, $all\_statuses ) ) { |
  | 673 | 667 | unset( $views[ $status ] ); |
  | 674 | 668 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L683) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L677) |  |
  | 683 | 677 | \* |
  | 684 | 678 | \* @since   1.0 |
  | 685 |  | \* @param   arr $actions    Current post row actions |
  | 686 |  | \* @param   obj $post       The WP\_Post post object |
  |  | 679 | \* @param   arr $actions    Current post row actions. |
  |  | 680 | \* @param   obj $post       The WP\_Post post object. |
  | 687 | 681 | \*/ |
  | 688 | 682 | function tmem\_event\_post\_row\_actions( $actions, $post ) { |
  | 689 | 683 |  |
  | 690 |  | if ( ~~$post->post\_type != 'tmem-event'~~ ) { |
  |  | 684 | if ( 'tmem-event' !== $post->post\_type ) { |
  | 691 | 685 | return $actions; |
  | 692 | 686 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L698) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L692) |  |
  | 698 | 692 | unset( $actions['view'] ); |
  | 699 | 693 | } |
  | 700 |  | if ( isset( $actions['edit'] ) && 'tmem-unattended' == $post->post\_status ) { |
  |  | 694 | if ( isset( $actions['edit'] ) && 'tmem-unattended' === $post->post\_status ) { |
  | 701 | 695 | unset( $actions['edit'] ); |
  | 702 | 696 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L705) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L699) |  |
  | 705 | 699 | } |
  | 706 | 700 |  |
  | 707 |  | // Unattended events have additional actions to allow one-click responses |
  |  | 701 | // Unattended events have additional actions to allow one-click responses. |
  | 708 | 702 | $url = remove\_query\_arg( array( 'tmem-action', 'event\_id' ) ); |
  | 709 | 703 |  |
  | 710 |  | if ( 'tmem-unattended' == $post->post\_status ) { |
  | 711 |  |  |
  | 712 |  | // Quote for event |
  |  | 704 | if ( 'tmem-unattended' === $post->post\_status ) { |
  |  | 705 |  |
  |  | 706 | // Quote for event. |
  | 713 | 707 | $actions['quote'] = sprintf( |
  |  | 708 | /\* translators: %s URL to quote \*/ |
  | 714 | 709 | \_\_( '<a href="%s">Quote</a>', 'mobile-events-manager' ), |
  | 715 | 710 | admin\_url( 'post.php?post=' . $post->ID . '&action=edit&tmem\_action=respond' ) |
  | 716 | 711 | ); |
  | 717 | 712 |  |
  | 718 |  | // Check availability |
  |  | 713 | // Check availability. |
  | 719 | 714 | $actions['availability'] = sprintf( |
  |  | 715 | /\* translators: %s Availability URL \*/ |
  | 720 | 716 | \_\_( '<a href="%s">Availability</a>', 'mobile-events-manager' ), |
  | 721 | 717 | add\_query\_arg( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L728) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L724) |  |
  | 728 | 724 | ); |
  | 729 | 725 |  |
  | 730 |  | // Respond Unavailable |
  |  | 726 | // Respond Unavailable. |
  | 731 | 727 | $actions['respond\_unavailable'] = sprintf( |
  |  | 728 | /\* translators: %s Unavailable URL \*/ |
  | 732 | 729 | \_\_( '<span class="trash"><a href="%s">Unavailable</a></span>', 'mobile-events-manager' ), |
  | 733 | 730 | add\_query\_arg( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L752) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L749) |  |
  | 752 | 749 | \* |
  | 753 | 750 | \* @since   1.0 |
  | 754 |  | \* @param   arr $actions    Current post row actions |
  | 755 |  | \* @param   obj $post       The WP\_Post post object |
  |  | 751 | \* @param   obj $post The WP\_Post post object. |
  | 756 | 752 | \*/ |
  | 757 | 753 | function tmem\_event\_set\_post\_title( $post ) { |
  | 758 | 754 |  |
  | 759 |  | if ( 'tmem-event' != $post->post\_type ) { |
  |  | 755 | if ( 'tmem-event' !== $post->post\_type ) { |
  | 760 | 756 | return; |
  | 761 | 757 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L772) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L768) |  |
  | 772 | 768 | \* |
  | 773 | 769 | \* @since   1.5 |
  | 774 |  | \* @param   arr $actions    Current post row actions |
  | 775 |  | \* @param   obj $post       The WP\_Post post object |
  |  | 770 | \* @param   obj $post The WP\_Post post object. |
  | 776 | 771 | \*/ |
  | 777 | 772 | function tmem\_output\_event\_name\_field( $post ) { |
  | 778 | 773 |  |
  | 779 |  | if ( 'tmem-event' != $post->post\_type ) { |
  | 780 |  | return; |
  | 781 |  | } |
  | 782 |  |  |
  | 783 |  | $value       = esc\_attr( tmem\_get\_event\_name( $post->ID ) ); |
  |  | 774 | if ( 'tmem-event' !== $post->post\_type ) { |
  |  | 775 | return; |
  |  | 776 | } |
  |  | 777 |  |
  |  | 778 | $value = esc\_attr( tmem\_get\_event\_name( $post->ID ) ); |
  |  | 779 | /\* translators: %s App name \*/ |
  | 784 | 780 | $placeholder = sprintf( \_\_( 'Optional: Display name in %s', 'mobile-events-manager' ), tmem\_get\_option( 'app\_name', \_\_( 'Client Zone', 'mobile-events-manager' ) ) ); |
  | 785 | 781 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L790) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L786) |  |
  | 790 | 786 | </div> |
  | 791 | 787 | </div> |
  | 792 |  | <br/><?php |
  | 793 |  | if ( tmem\_employee\_can( 'read\_events' ) ) { |
  | 794 |  | echo '<a class="button-primary" href="' . esc\_url( tmem\_get\_admin\_page( 'playlists' ) . $post->ID ) . '">' . |
  | 795 |  | esc\_html( \_n( '', 'Print/Email Event Details', 'mobile-events-manager' ) ) . '</a>' . "\r\n"; |
  | 796 |  | } else { |
  | 797 |  | echo '&mdash;'; |
  | 798 |  | } |
  |  | 788 | <br/> |
  |  | 789 | <?php |
  |  | 790 | if ( tmem\_employee\_can( 'read\_events' ) ) { |
  |  | 791 | echo '<a class="button-primary" href="' . esc\_url( tmem\_get\_admin\_page( 'playlists' ) . $post->ID ) . '">' . |
  |  | 792 | /\* translators: %s Event or Events \*/ |
  |  | 793 | sprintf( esc\_html\_\_( 'Print/Email %s Details', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ), "</a>\r\n"; |
  |  | 794 | } else { |
  |  | 795 | echo '&mdash;'; |
  |  | 796 | } |
  | 799 | 797 | ?> |
  | 800 | 798 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L806) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L804) |  |
  | 806 | 804 | \* |
  | 807 | 805 | \* @since   1.3 |
  | 808 |  | \* @param   str $translation    The current button text translation |
  | 809 |  | \* @param   str $text           The text translation for the button |
  |  | 806 | \* @param   str $translation    The current button text translation. |
  |  | 807 | \* @param   str $text           The text translation for the button. |
  | 810 | 808 | \* @return  str     $translation    The filtererd text translation |
  | 811 | 809 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L814) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L812) |  |
  | 814 | 812 | global $post; |
  | 815 | 813 |  |
  | 816 |  | if ( ! isset( $post ) || 'tmem-event' != $post->post\_type ) { |
  |  | 814 | if ( ! isset( $post ) || 'tmem-event' !== $post->post\_type ) { |
  | 817 | 815 | return $translation; |
  | 818 | 816 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L820) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L818) |  |
  | 820 | 818 | $event\_statuses = tmem\_all\_event\_status(); |
  | 821 | 819 |  |
  | 822 |  | if ( ~~$text == 'Publish'~~ && isset( $event\_statuses[ $post->post\_status ] ) ) { |
  |  | 820 | if ( 'Publish' === $text && isset( $event\_statuses[ $post->post\_status ] ) ) { |
  | 823 | 821 | return \_\_( 'Update Event', 'mobile-events-manager' ); |
  | 824 |  | } elseif ( ~~$text == 'Publish'~~ ) { |
  |  | 822 | } elseif ( 'Publish' === $text ) { |
  | 825 | 823 | return \_\_( 'Create Event', 'mobile-events-manager' ); |
  | 826 |  | } elseif ( ~~$text == 'Update'~~ ) { |
  |  | 824 | } elseif ( 'Update' === $text ) { |
  | 827 | 825 | return \_\_( 'Update Event', 'mobile-events-manager' ); |
  | 828 | 826 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L837) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L835) |  |
  | 837 | 835 | \* |
  | 838 | 836 | \* @since   1.3 |
  | 839 |  | ~~\* @param~~ |
  | 840 |  | ~~\* @return~~ |
  | 841 | 837 | \*/ |
  | 842 | 838 | function tmem\_event\_highlight\_unattended\_event\_rows() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L844) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L840) |  |
  | 844 | 840 | global $post; |
  | 845 | 841 |  |
  | 846 |  | if ( ! isset( $post ) || 'tmem-event' != $post->post\_type ) { |
  | 847 |  | return; |
  | 848 |  | } |
  | 849 |  |  |
  | 850 |  | // Allow the colour to be filtered |
  |  | 842 | if ( ! isset( $post ) || 'tmem-event' !== $post->post\_type ) { |
  |  | 843 | return; |
  |  | 844 | } |
  |  | 845 |  |
  |  | 846 | // Allow the colour to be filtered. |
  | 851 | 847 | $row\_colour = apply\_filters( 'tmem\_unattended\_event\_row\_colour', '#FFEBE8' ); |
  | 852 | 848 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L867) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L863) |  |
  | 867 | 863 | \* |
  | 868 | 864 | \* @since   1.3 |
  | 869 |  | ~~\* @param~~ |
  | 870 |  | ~~\* @param~~ |
  | 871 | 865 | \*/ |
  | 872 | 866 | function tmem\_event\_remove\_date\_filter() { |
  | 873 | 867 |  |
  | 874 |  | if ( ! isset( $\_GET['post\_type'] ) || ~~$\_GET['post\_type'] != 'tmem-event' ) {~~ |
  |  | 868 | if ( ! isset( $\_GET['post\_type'] ) || 'tmem-event' !== $\_GET['post\_type'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 875 | 869 | return; |
  | 876 | 870 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L885) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L879) |  |
  | 885 | 879 | \* |
  | 886 | 880 | \* @since   1.3 |
  | 887 |  | \* @param   obj $query      The WP\_Query object |
  |  | 881 | \* @param   obj $query      The WP\_Query object. |
  | 888 | 882 | \* @return  void |
  | 889 | 883 | \*/ |
  | 890 | 884 | function tmem\_event\_post\_order( $query ) { |
  | 891 | 885 |  |
  | 892 |  | if ( ! is\_admin() || 'tmem-event' != $query->get( 'post\_type' ) ) { |
  | 893 |  | return; |
  | 894 |  | } |
  | 895 |  |  |
  | 896 |  | $orderby = '' == $query->get( 'orderby' ) ? tmem\_get\_option( 'events\_order\_by', 'event\_date' ) : $query->get( 'orderby' ); |
  | 897 |  | $order   = '' == $query->get( 'order' ) ? tmem\_get\_option( 'events\_order', 'event\_date' ) : $query->get( 'order' ); |
  |  | 886 | if ( ! is\_admin() || 'tmem-event' !== $query->get( 'post\_type' ) ) { |
  |  | 887 | return; |
  |  | 888 | } |
  |  | 889 |  |
  |  | 890 | $orderby = '' === $query->get( 'orderby' ) ? tmem\_get\_option( 'events\_order\_by', 'event\_date' ) : $query->get( 'orderby' ); |
  |  | 891 | $order   = '' === $query->get( 'order' ) ? tmem\_get\_option( 'events\_order', 'event\_date' ) : $query->get( 'order' ); |
  | 898 | 892 |  |
  | 899 | 893 | switch ( $orderby ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L934) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L928) |  |
  | 934 | 928 | \* |
  | 935 | 929 | \* @since   1.0 |
  | 936 |  | \* @param   arr $query      The WP\_Query |
  |  | 930 | \* @param   arr $query      The WP\_Query. |
  | 937 | 931 | \* @return  void |
  | 938 | 932 | \*/ |
  | 939 | 933 | function tmem\_limit\_results\_to\_employee\_events( $query ) { |
  | 940 | 934 |  |
  | 941 |  | if ( ! is\_admin() || 'tmem-event' != $query->get( 'post\_type' ) || tmem\_employee\_can( 'read\_events\_all' ) ) { |
  |  | 935 | if ( ! is\_admin() || 'tmem-event' !== $query->get( 'post\_type' ) || tmem\_employee\_can( 'read\_events\_all' ) ) { |
  | 942 | 936 | return; |
  | 943 | 937 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L977) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L971) |  |
  | 977 | 971 | function tmem\_hide\_inactive\_events( $query ) { |
  | 978 | 972 |  |
  | 979 |  | if ( ! is\_admin() || ! $query->is\_main\_query() || 'tmem-event' != $query->get( 'post\_type' ) ) { |
  |  | 973 | if ( ! is\_admin() || ! $query->is\_main\_query() || 'tmem-event' !== $query->get( 'post\_type' ) ) { |
  | 980 | 974 | return; |
  | 981 | 975 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L985) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L979) |  |
  | 985 | 979 | } |
  | 986 | 980 |  |
  | 987 |  | if ( isset( $\_GET['post\_status'] ) && 'all' !=~~$\_GET['post\_status'] ) {~~ |
  |  | 981 | if ( isset( $\_GET['post\_status'] ) && 'all' !== $\_GET['post\_status'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 988 | 982 | return; |
  | 989 | 983 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1017) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1011) |  |
  | 1017 | 1011 | \* |
  | 1018 | 1012 | \* @since   1.3 |
  | 1019 |  | \* @param   arr $query      The WP\_Query |
  |  | 1013 | \* @param   arr $query      The WP\_Query. |
  | 1020 | 1014 | \* @return  void |
  | 1021 | 1015 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1024) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1018) |  |
  | 1024 | 1018 | global $pagenow; |
  | 1025 | 1019 |  |
  | 1026 |  | $post\_type   = isset( $\_GET['post\_type'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_type'] ) ) : ''; |
  | 1027 |  | $post\_status = isset( $\_GET['post\_status'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_status'] ) ) : ''; |
  | 1028 |  |  |
  | 1029 |  | if ( 'edit.php' !=~~$pagenow || 'tmem-event' !~~= $post\_type || ! is\_admin() ) { |
  | 1030 |  | return; |
  | 1031 |  | } |
  | 1032 |  |  |
  | 1033 |  | if ( ! isset( $\_GET['filter\_action'] ) ) { |
  | 1034 |  | return; |
  | 1035 |  | } |
  | 1036 |  |  |
  | 1037 |  | // Filter by selected date |
  | 1038 |  | if ( ! empty( $\_GET['tmem\_filter\_date'] ) ) { |
  | 1039 |  |  |
  | 1040 |  | // Create the date start and end range |
  | 1041 |  | $start = ~~date( 'Y-m-d', strtotime( substr( sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_date'] ) ), 0, 4 ) . '-' . substr( sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_date'] ) ), -2 ) . '-01' ) );~~ |
  | 1042 |  | $end   = ~~date( 'Y-m-t', strtotime( $start ) );~~ |
  |  | 1020 | $post\_type   = isset( $\_GET['post\_type'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_type'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1021 | $post\_status = isset( $\_GET['post\_status'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['post\_status'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1022 |  |
  |  | 1023 | if ( 'edit.php' !== $pagenow || 'tmem-event' !== $post\_type || ! is\_admin() ) { |
  |  | 1024 | return; |
  |  | 1025 | } |
  |  | 1026 |  |
  |  | 1027 | if ( ! isset( $\_GET['filter\_action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1028 | return; |
  |  | 1029 | } |
  |  | 1030 |  |
  |  | 1031 | // Filter by selected date. |
  |  | 1032 | if ( ! empty( $\_GET['tmem\_filter\_date'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1033 |  |
  |  | 1034 | // Create the date start and end range. |
  |  | 1035 | $start = gmdate( 'Y-m-d', strtotime( substr( sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_date'] ) ), 0, 4 ) . '-' . substr( sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_date'] ) ), -2 ) . '-01' ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1036 | $end   = gmdate( 'Y-m-t', strtotime( $start ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1043 | 1037 |  |
  | 1044 | 1038 | $query->query\_vars['meta\_query'] = array( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1052) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1046) |  |
  | 1052 | 1046 | } |
  | 1053 | 1047 |  |
  | 1054 |  | // Filter by event type |
  | 1055 |  | if ( ! empty( $\_GET['tmem\_filter\_type'] ) ) { |
  | 1056 |  |  |
  | 1057 |  | $type = isset( $\_GET['tmem\_filter\_type'] ) ? absint( $\_GET['tmem\_filter\_type'] ) : 0; |
  | 1058 |  |  |
  | 1059 |  | if ( ~~$type != 0~~ ) { |
  |  | 1048 | // Filter by event type. |
  |  | 1049 | if ( ! empty( $\_GET['tmem\_filter\_type'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1050 |  |
  |  | 1051 | $type = isset( $\_GET['tmem\_filter\_type'] ) ? absint( $\_GET['tmem\_filter\_type'] ) : 0; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1052 |  |
  |  | 1053 | if ( 0 !== $type ) { |
  | 1060 | 1054 | $query->set( |
  | 1061 | 1055 | 'tax\_query', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1071) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1065) |  |
  | 1071 | 1065 | } |
  | 1072 | 1066 |  |
  | 1073 |  | // Filter by selected employee |
  | 1074 |  | if ( ! empty( $\_GET['tmem\_filter\_employee'] ) ) { |
  |  | 1067 | // Filter by selected employee. |
  |  | 1068 | if ( ! empty( $\_GET['tmem\_filter\_employee'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1075 | 1069 |  |
  | 1076 | 1070 | $query->query\_vars['meta\_query'] = array( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1078) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1072) |  |
  | 1078 | 1072 | array( |
  | 1079 | 1073 | 'key'   => '\_tmem\_event\_dj', |
  | 1080 |  | 'value' => sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ), |
  |  | 1074 | 'value' => sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1081 | 1075 | ), |
  | 1082 | 1076 | array( |
  | 1083 | 1077 | 'key'     => '\_tmem\_event\_employees', |
  | 1084 |  | 'value'   => sprintf( ':"%s";', sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ) ), |
  |  | 1078 | 'value'   => sprintf( ':"%s";', sanitize\_text\_field( wp\_unslash( $\_GET['tmem\_filter\_employee'] ) ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1085 | 1079 | 'compare' => 'LIKE', |
  | 1086 | 1080 | ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1089) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1083) |  |
  | 1089 | 1083 | } |
  | 1090 | 1084 |  |
  | 1091 |  | // Filter by selected client |
  | 1092 |  | if ( ! empty( $\_GET['tmem\_filter\_client'] ) ) { |
  |  | 1085 | // Filter by selected client. |
  |  | 1086 | if ( ! empty( $\_GET['tmem\_filter\_client'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1093 | 1087 |  |
  | 1094 | 1088 | $query->query\_vars['meta\_query'] = array( |
  | 1095 | 1089 | array( |
  | 1096 | 1090 | 'key'   => '\_tmem\_event\_client', |
  | 1097 |  | 'value' => absint( wp\_unslash( $\_GET['tmem\_filter\_client'] ) ), |
  |  | 1091 | 'value' => absint( wp\_unslash( $\_GET['tmem\_filter\_client'] ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1098 | 1092 | ), |
  | 1099 | 1093 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1101) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1095) |  |
  | 1101 | 1095 | } |
  | 1102 | 1096 |  |
  | 1103 |  | // Filter by selected venue |
  | 1104 |  | if ( ! empty( $\_GET['tmem\_filter\_venue'] ) ) { |
  |  | 1097 | // Filter by selected venue. |
  |  | 1098 | if ( ! empty( $\_GET['tmem\_filter\_venue'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1105 | 1099 |  |
  | 1106 | 1100 | $query->query\_vars['meta\_query'] = array( |
  | 1107 | 1101 | array( |
  | 1108 | 1102 | 'key'   => '\_tmem\_event\_venue\_id', |
  | 1109 |  | 'value' => absint( wp\_unslash( $\_GET['tmem\_filter\_venue'] ) ), |
  |  | 1103 | 'value' => absint( wp\_unslash( $\_GET['tmem\_filter\_venue'] ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1110 | 1104 | ), |
  | 1111 | 1105 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1124) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1118) |  |
  | 1124 | 1118 | \* |
  | 1125 | 1119 | \* @since   1.0 |
  | 1126 |  | \* @param   arr $query      The WP\_Query |
  |  | 1120 | \* @param   arr $query      The WP\_Query. |
  | 1127 | 1121 | \* @return  void |
  | 1128 | 1122 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1130) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1124) |  |
  | 1130 | 1124 | global $pagenow; |
  | 1131 | 1125 |  |
  | 1132 |  | if ( ! is\_admin() || 'tmem-event' !=~~$query->get( 'post\_type' ) || ! $query->is\_search() || 'edit.php' !~~= $pagenow ) { |
  | 1133 |  | return; |
  | 1134 |  | } |
  | 1135 |  |  |
  | 1136 |  | // If searching it's only useful if we include clients and employees |
  |  | 1126 | if ( ! is\_admin() || 'tmem-event' !== $query->get( 'post\_type' ) || ! $query->is\_search() || 'edit.php' !== $pagenow ) { |
  |  | 1127 | return; |
  |  | 1128 | } |
  |  | 1129 |  |
  |  | 1130 | // If searching it's only useful if we include clients and employees. |
  | 1137 | 1131 | $users = new WP\_User\_Query( |
  | 1138 | 1132 | array( |
  | 1139 |  | 'search'         => sanitize\_text\_field( wp\_unslash( ~~$\_GET['s'] ) ), // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  |  | 1133 | 'search'         => sanitize\_text\_field( wp\_unslash( empty( $\_GET['s'] ) ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1140 | 1134 | 'search\_columns' => array( |
  | 1141 | 1135 | 'user\_login', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1145) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1139) |  |
  | 1145 | 1139 | ), |
  | 1146 | 1140 | ) |
  | 1147 |  | ); // WP\_User\_Query |
  |  | 1141 | ); // WP\_User\_Query. |
  | 1148 | 1142 |  |
  | 1149 | 1143 | $user\_results = $users->get\_results(); |
  | 1150 | 1144 |  |
  | 1151 |  | // Loop through WP\_User\_Query search looking for events where user is client or employee |
  |  | 1145 | // Loop through WP\_User\_Query search looking for events where user is client or employee. |
  | 1152 | 1146 | if ( ! empty( $user\_results ) ) { |
  | 1153 | 1147 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1178) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1172) |  |
  | 1178 | 1172 | ), |
  | 1179 | 1173 | ) |
  | 1180 |  | ); // get\_posts |
  |  | 1174 | ); // get\_posts. |
  | 1181 | 1175 |  |
  | 1182 | 1176 | if ( ! empty( $results ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1188) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1182) |  |
  | 1188 | 1182 | } |
  | 1189 | 1183 | } |
  | 1190 |  | }~~// foreach( $users as $user )~~ |
  |  | 1184 | } |
  | 1191 | 1185 |  |
  | 1192 | 1186 | if ( ! empty( $events ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1196) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1190) |  |
  | 1196 | 1190 |  |
  | 1197 | 1191 | } |
  | 1198 |  | }~~// if( !empty( $users ) )~~ |
  |  | 1192 | } |
  | 1199 | 1193 |  |
  | 1200 | 1194 | } // tmem\_event\_post\_search |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1205) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1199) |  |
  | 1205 | 1199 | \* |
  | 1206 | 1200 | \* @since   1.3 |
  | 1207 |  | \* @param   arr $caps       The users actual capabilities |
  | 1208 |  | \* @param   str $cap        The capability name |
  | 1209 |  | \* @param   int $user\_id    The user ID |
  |  | 1201 | \* @param   arr $caps       The users actual capabilities. |
  |  | 1202 | \* @param   str $cap        The capability name. |
  |  | 1203 | \* @param   int $user\_id    The user ID. |
  | 1210 | 1204 | \* @param   arr $args       Adds the context to the cap. Typically the object ID. |
  | 1211 | 1205 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1213) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1207) |  |
  | 1213 | 1207 |  |
  | 1214 | 1208 | // If editing, deleting, or reading an event, get the post and post type object. |
  | 1215 |  | if ( 'edit\_tmem\_event' ==~~$cap || 'delete\_tmem\_event' == $cap || 'read\_tmem\_event' == $cap || 'publish\_tmem\_event'~~ == $cap ) { |
  |  | 1209 | if ( 'edit\_tmem\_event' === $cap || 'delete\_tmem\_event' === $cap || 'read\_tmem\_event' === $cap || 'publish\_tmem\_event' === $cap ) { |
  | 1216 | 1210 |  |
  | 1217 | 1211 | $post = get\_post( $args[0] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1228) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1222) |  |
  | 1228 | 1222 | } |
  | 1229 | 1223 |  |
  | 1230 |  | // If editing a event, assign the required capability.~~\*/~~ |
  | 1231 |  | if ( 'edit\_tmem\_event' == $cap ) { |
  |  | 1224 | // If editing a event, assign the required capability. |
  |  | 1225 | if ( 'edit\_tmem\_event' === $cap ) { |
  | 1232 | 1226 |  |
  | 1233 | 1227 | if ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1239) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1233) |  |
  | 1239 | 1233 |  |
  | 1240 | 1234 | // If deleting a event, assign the required capability. |
  | 1241 |  | elseif ( 'delete\_tmem\_event' == $cap ) { |
  |  | 1235 | elseif ( 'delete\_tmem\_event' === $cap ) { |
  | 1242 | 1236 |  |
  | 1243 | 1237 | if ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1249) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1243) |  |
  | 1249 | 1243 |  |
  | 1250 | 1244 | // If reading a private event, assign the required capability. |
  | 1251 |  | elseif ( 'read\_tmem\_event' == $cap ) { |
  | 1252 |  |  |
  | 1253 |  | if ( 'private' != $post->post\_status ) { |
  |  | 1245 | elseif ( 'read\_tmem\_event' === $cap ) { |
  |  | 1246 |  |
  |  | 1247 | if ( 'private' !== $post->post\_status ) { |
  | 1254 | 1248 | $caps[] = 'read'; |
  | 1255 | 1249 | } elseif ( in\_array( $user\_id, tmem\_get\_event\_employees( $post->ID ) ) ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1282) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1276) |  |
  | 1282 | 1276 | } |
  | 1283 | 1277 |  |
  | 1284 |  | if ( ~~$post->post\_status == 'trash'~~ ) { |
  |  | 1278 | if ( 'trash' === $post->post\_status ) { |
  | 1285 | 1279 | return; |
  | 1286 | 1280 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1290) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1284) |  |
  | 1290 | 1284 | } |
  | 1291 | 1285 |  |
  | 1292 |  | // Permission Check |
  |  | 1286 | // Permission Check. |
  | 1293 | 1287 | if ( ! tmem\_employee\_can( 'manage\_events' ) ) { |
  | 1294 | 1288 | TMEM()->debug->log\_it( sprintf( 'PERMISSION ERROR: User %s is not allowed to edit events', get\_current\_user\_id() ) ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1300) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1294) |  |
  | 1300 | 1294 | remove\_action( 'save\_post\_tmem-event', 'tmem\_save\_event\_post', 10, 3 ); |
  | 1301 | 1295 |  |
  | 1302 |  | // Fire our pre-save hook |
  |  | 1296 | // Fire our pre-save hook. |
  | 1303 | 1297 | do\_action( 'tmem\_pre\_event\_save', $post\_id, $post, $update ); |
  | 1304 | 1298 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1313) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1307) |  |
  | 1313 | 1307 | \* If adding a new client, call the method and use the returned user ID. |
  | 1314 | 1308 | \*/ |
  | 1315 |  | $event\_data['\_tmem\_event\_client'] = isset( $\_POST['client\_name'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['client\_name'] ) ) !=~~'add\_new' ? sanitize\_text\_field( wp\_unslash( $\_POST['client\_name'] ) ) : tmem\_add\_client();~~ |
  |  | 1309 | $event\_data['\_tmem\_event\_client'] = isset( $\_POST['client\_name'] ) && sanitize\_text\_field( wp\_unslash( $\_POST['client\_name'] ) ) !== 'add\_new' ? sanitize\_text\_field( wp\_unslash( $\_POST['client\_name'] ) ) : tmem\_add\_client(); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1316 | 1310 |  |
  | 1317 | 1311 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1326) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1320) |  |
  | 1326 | 1320 | \* The flag will be checked and processed during the content tag filtering process. |
  | 1327 | 1321 | \*/ |
  | 1328 |  | if ( ! empty( $\_POST['tmem\_reset\_pw'] ) ) { |
  |  | 1322 | if ( ! empty( $\_POST['tmem\_reset\_pw'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1329 | 1323 |  |
  | 1330 | 1324 | $debug[] = sprintf( 'Client %s flagged for password reset', $event\_data['\_tmem\_event\_client'] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1337) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1331) |  |
  | 1337 | 1331 | \* Otherwise, determine if we're using the client's address or adding a manual venue address |
  | 1338 | 1332 | \*/ |
  | 1339 |  | if ( isset( $\_POST['venue\_id'] ) && ~~$\_POST['venue\_id'] != 'manual' && $\_POST['venue\_id'] != 'client' ) {~~ |
  | 1340 |  | $event\_data['\_tmem\_event\_venue\_id'] = sanitize\_text\_field( wp\_unslash( $\_POST['venue\_id'] ) ); |
  | 1341 |  | } elseif ( ! empty( $\_POST['\_tmem\_event\_venue\_id'] ) && ~~$\_POST['\_tmem\_event\_venue\_id'] == 'client' ) {~~ |
  |  | 1333 | if ( isset( $\_POST['venue\_id'] ) && 'manual' !== $\_POST['venue\_id'] && 'client' !== $\_POST['venue\_id'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1334 | $event\_data['\_tmem\_event\_venue\_id'] = sanitize\_text\_field( wp\_unslash( $\_POST['venue\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1335 | } elseif ( ! empty( $\_POST['\_tmem\_event\_venue\_id'] ) && 'client' === $\_POST['\_tmem\_event\_venue\_id'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1342 | 1336 | $event\_data['\_tmem\_event\_venue\_id'] = 'client'; |
  | 1343 | 1337 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1349) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1343) |  |
  | 1349 | 1343 | \* for the venue. |
  | 1350 | 1344 | \*/ |
  | 1351 |  | if ( ~~$\_POST['venue\_id'] == 'manual' && ! empty( $\_POST['save\_venue'] ) ) {~~ |
  | 1352 |  |  |
  | 1353 |  | foreach ( $\_POST as $venue\_key => $venue\_value ) { |
  | 1354 |  |  |
  | 1355 |  | if ( substr( $venue\_key, 0, 6 ) == 'venue\_' ) { |
  |  | 1345 | if ( 'manual' === $\_POST['venue\_id'] && ! empty( $\_POST['save\_venue'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1346 |  |
  |  | 1347 | foreach ( $\_POST as $venue\_key => $venue\_value ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1348 |  |
  |  | 1349 | if ( substr( $venue\_key, 0, 6 ) === 'venue\_' ) { |
  | 1356 | 1350 |  |
  | 1357 | 1351 | $venue\_meta[ $venue\_key ] = $venue\_value; |
  | 1358 | 1352 |  |
  | 1359 |  | if ( ~~$venue\_key == 'venue\_postcode'~~ && ! empty( $venue\_value ) ) { |
  |  | 1353 | if ( 'venue\_postcode' === $venue\_key && ! empty( $venue\_value ) ) { |
  | 1360 | 1354 | $venue\_meta[ $venue\_key ] = strtoupper( $venue\_value ); |
  | 1361 |  | } elseif ( ~~$venue\_key == 'venue\_email'~~ && ! empty( $venue\_value ) ) { |
  |  | 1355 | } elseif ( 'venue\_email' === $venue\_key && ! empty( $venue\_value ) ) { |
  | 1362 | 1356 | $venue\_meta[ $venue\_key ] = sanitize\_email( $venue\_value ); |
  | 1363 | 1357 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1367) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1361) |  |
  | 1367 | 1361 | } |
  | 1368 | 1362 |  |
  | 1369 |  | // Create the new venue |
  | 1370 |  | $event\_data['\_tmem\_event\_venue\_id'] = tmem\_add\_venue( isset( $\_POST['venue\_name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['venue\_name'] ) ) : 'N/A', $venue\_meta ); |
  |  | 1363 | // Create the new venue. |
  |  | 1364 | $event\_data['\_tmem\_event\_venue\_id'] = tmem\_add\_venue( isset( $\_POST['venue\_name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['venue\_name'] ) ) : 'N/A', $venue\_meta ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1371 | 1365 |  |
  | 1372 | 1366 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1374) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1368) |  |
  | 1374 | 1368 | // The venue is set to manual or client for this event so store the values in event post meta data. |
  | 1375 | 1369 | else { |
  | 1376 |  | // Manual venue address entry |
  | 1377 |  | if ( ~~$\_POST['venue\_id'] != 'client' ) {~~ |
  | 1378 |  |  |
  | 1379 |  | $event\_data['\_tmem\_event\_venue\_name']     = ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_name'] ) ) ); |
  | 1380 |  | $event\_data['\_tmem\_event\_venue\_contact']  = isset( $\_POST['venue\_contact'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_contact'] ) ) ) : ''; |
  | 1381 |  | $event\_data['\_tmem\_event\_venue\_phone']    = isset( $\_POST['venue\_phone'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_phone'] ) ) ) : ''; |
  | 1382 |  | $event\_data['\_tmem\_event\_venue\_email']    = isset( $\_POST['venue\_email'] ) ? strtolower( sanitize\_email( wp\_unslash( $\_POST['venue\_email'] ) ) ) : ''; |
  | 1383 |  | $event\_data['\_tmem\_event\_venue\_address1'] = isset( $\_POST['venue\_address1'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_address1'] ) ) ) : ''; |
  | 1384 |  | $event\_data['\_tmem\_event\_venue\_address2'] = isset( $\_POST['venue\_address2'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_address2'] ) ) ) : ''; |
  | 1385 |  | $event\_data['\_tmem\_event\_venue\_town']     = isset( $\_POST['venue\_town'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_town'] ) ) ) : ''; |
  | 1386 |  | $event\_data['\_tmem\_event\_venue\_county']   = isset( $\_POST['venue\_county'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_county'] ) ) ) : ''; |
  | 1387 |  | $event\_data['\_tmem\_event\_venue\_postcode'] = isset( $\_POST['venue\_postcode'] ) ? strtoupper( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_postcode'] ) ) ) : ''; |
  | 1388 |  |  |
  | 1389 |  | } else { // Using clients address |
  |  | 1370 | // Manual venue address entry. |
  |  | 1371 | if ( 'client' !== $\_POST['venue\_id'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1372 |  |
  |  | 1373 | $event\_data['\_tmem\_event\_venue\_name']     = ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_name'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1374 | $event\_data['\_tmem\_event\_venue\_contact']  = isset( $\_POST['venue\_contact'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_contact'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1375 | $event\_data['\_tmem\_event\_venue\_phone']    = isset( $\_POST['venue\_phone'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_phone'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1376 | $event\_data['\_tmem\_event\_venue\_email']    = isset( $\_POST['venue\_email'] ) ? strtolower( sanitize\_email( wp\_unslash( $\_POST['venue\_email'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1377 | $event\_data['\_tmem\_event\_venue\_address1'] = isset( $\_POST['venue\_address1'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_address1'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1378 | $event\_data['\_tmem\_event\_venue\_address2'] = isset( $\_POST['venue\_address2'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_address2'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1379 | $event\_data['\_tmem\_event\_venue\_town']     = isset( $\_POST['venue\_town'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_town'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1380 | $event\_data['\_tmem\_event\_venue\_county']   = isset( $\_POST['venue\_county'] ) ? ucwords( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_county'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1381 | $event\_data['\_tmem\_event\_venue\_postcode'] = isset( $\_POST['venue\_postcode'] ) ? strtoupper( sanitize\_text\_field( wp\_unslash( $\_POST['venue\_postcode'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1382 |  |
  |  | 1383 | } else { // Using clients address. |
  | 1390 | 1384 |  |
  | 1391 | 1385 | $client\_data = get\_userdata( $event\_data['\_tmem\_event\_client'] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1418) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1412) |  |
  | 1418 | 1412 | $field = 'travel\_' . $travel\_field; |
  | 1419 | 1413 |  |
  | 1420 |  | $travel\_data[ $travel\_field ] = ! empty( $\_POST[ $field ] ) ? sanitize\_text\_field( wp\_unslash( $\_POST[ $field ] ) ) : ''; |
  | 1421 |  |  |
  | 1422 |  | if ( 'cost' ==~~$travel\_field && ! empty( $\_POST[ $field ] ) ) {~~ |
  | 1423 |  | $travel\_data[ $travel\_field ] = tmem\_sanitize\_amount( sanitize\_text\_field( wp\_unslash( $\_POST[ $field ] ) ) ); |
  |  | 1414 | $travel\_data[ $travel\_field ] = ! empty( $\_POST[ $field ] ) ? sanitize\_text\_field( wp\_unslash( $\_POST[ $field ] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1415 |  |
  |  | 1416 | if ( 'cost' === $travel\_field && ! empty( $\_POST[ $field ] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1417 | $travel\_data[ $travel\_field ] = tmem\_sanitize\_amount( sanitize\_text\_field( wp\_unslash( $\_POST[ $field ] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1424 | 1418 | } |
  | 1425 | 1419 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1440) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1434) |  |
  | 1440 | 1434 | \* Allow filtering of the event name with the `tmem\_event\_name` filter. |
  | 1441 | 1435 | \*/ |
  | 1442 |  | if ( empty( $\_POST['\_tmem\_event\_name'] ) ) { |
  | 1443 |  | $\_POST['\_tmem\_event\_name'] = get\_term( sanitize\_text\_field( wp\_unslash( ~~$\_POST['tmem\_event\_type'] ) ), 'event-types' )->name; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  | 1444 |  | } |
  | 1445 |  |  |
  | 1446 |  | $\_POST['\_tmem\_event\_name'] = apply\_filters( 'tmem\_event\_name', sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_name'] ) ), $post\_id ); |
  | 1447 |  |  |
  | 1448 |  | // Generate the playlist reference for guest access |
  |  | 1436 | if ( empty( $\_POST['\_tmem\_event\_name'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1437 | $\_POST['\_tmem\_event\_name'] = get\_term( sanitize\_text\_field( wp\_unslash( empty( $\_POST['tmem\_event\_type'] ) ) ), 'event-types' )->name; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1438 | } |
  |  | 1439 |  |
  |  | 1440 | $\_POST['\_tmem\_event\_name'] = apply\_filters( 'tmem\_event\_name', sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_name'] ) ), $post\_id ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1441 |  |
  |  | 1442 | // Generate the playlist reference for guest access. |
  | 1449 | 1443 | if ( empty( $update ) || empty( $current\_meta['\_tmem\_event\_playlist\_access'][0] ) ) { |
  | 1450 | 1444 | $event\_data['\_tmem\_event\_playlist\_access'] = tmem\_generate\_playlist\_guest\_code(); |
  | 1451 | 1445 | } |
  | 1452 | 1446 |  |
  | 1453 |  | // Set whether or not the playlist is enabled for the event |
  | 1454 |  | $event\_data['\_tmem\_event\_playlist'] = ! empty( $\_POST['enable\_playlist'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['enable\_playlist'] ) ) : 'N'; |
  |  | 1447 | // Set whether or not the playlist is enabled for the event. |
  |  | 1448 | $event\_data['\_tmem\_event\_playlist'] = ! empty( $\_POST['enable\_playlist'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['enable\_playlist'] ) ) : 'N'; // phpcs:ignore WordPress.Security.NonceVerification |
  | 1455 | 1449 |  |
  | 1456 | 1450 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1458) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1452) |  |
  | 1458 | 1452 | \* Loop through all $\_POST data and put all event meta fields into the $event\_data array |
  | 1459 | 1453 | \*/ |
  | 1460 |  | foreach ( $\_POST as $key => $value ) { |
  | 1461 |  |  |
  | 1462 |  | if ( substr( $key, 0, 12 ) == '\_tmem\_event\_' ) { |
  |  | 1454 | foreach ( $\_POST as $key => $value ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1455 |  |
  |  | 1456 | if ( substr( $key, 0, 12 ) === '\_tmem\_event\_' ) { |
  | 1463 | 1457 | $cost\_keys = array( |
  | 1464 | 1458 | '\_tmem\_event\_dj\_wage', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1484) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1478) |  |
  | 1484 | 1478 | \* determine their time format setting and adjust to H:i:s for saving. |
  | 1485 | 1479 | \*/ |
  | 1486 |  | if ( tmem\_get\_option( 'time\_format', 'H:i' ) == 'H:i' ) { // 24 Hr |
  | 1487 |  |  |
  | 1488 |  | $event\_data['\_tmem\_event\_start']        = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_min'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1489 |  | $event\_data['\_tmem\_event\_finish']       = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_min'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1490 |  | $event\_data['\_tmem\_event\_djsetup\_time'] = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_min'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1480 | if ( tmem\_get\_option( 'time\_format', 'H:i' ) === 'H:i' ) { // 24 Hr |
  |  | 1481 |  |
  |  | 1482 | $event\_data['\_tmem\_event\_start']        = gmdate( |
  |  | 1483 | 'H:i:s', |
  |  | 1484 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1485 | sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_min'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1486 | ) |
  |  | 1487 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1488 | $event\_data['\_tmem\_event\_finish']       = gmdate( |
  |  | 1489 | 'H:i:s', |
  |  | 1490 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1491 | sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_min'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1492 | ) |
  |  | 1493 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1494 | $event\_data['\_tmem\_event\_djsetup\_time'] = gmdate( |
  |  | 1495 | 'H:i:s', |
  |  | 1496 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1497 | sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_min'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1498 | ) |
  |  | 1499 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1491 | 1500 | } else { // 12 hr |
  | 1492 |  | $event\_data['\_tmem\_event\_start']        = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_period'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1493 |  | $event\_data['\_tmem\_event\_finish']       = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_period'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1494 |  | $event\_data['\_tmem\_event\_djsetup\_time'] = date( 'H:i:s', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_period'] ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 1495 |  | } |
  | 1496 |  |  |
  | 1497 |  | if ( empty( $\_POST['\_tmem\_event\_djsetup'] ) ) { |
  | 1498 |  | $event\_data['\_tmem\_event\_djsetup'] = sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1501 | $event\_data['\_tmem\_event\_start']        = gmdate( |
  |  | 1502 | 'H:i:s', |
  |  | 1503 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1504 | sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['event\_start\_period'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1505 | ) |
  |  | 1506 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1507 | $event\_data['\_tmem\_event\_finish']       = gmdate( |
  |  | 1508 | 'H:i:s', |
  |  | 1509 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1510 | sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['event\_finish\_period'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1511 | ) |
  |  | 1512 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1513 | $event\_data['\_tmem\_event\_djsetup\_time'] = gmdate( |
  |  | 1514 | 'H:i:s', |
  |  | 1515 | strtotime( // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1516 | sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_hr'] ) ) . ':' . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_min'] ) ) . sanitize\_text\_field( wp\_unslash( $\_POST['dj\_setup\_period'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1517 | ) |
  |  | 1518 | ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 1519 | } |
  |  | 1520 |  |
  |  | 1521 | if ( empty( $\_POST['\_tmem\_event\_djsetup'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1522 | $event\_data['\_tmem\_event\_djsetup'] = sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1499 | 1523 | } |
  | 1500 | 1524 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1505) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1529) |  |
  | 1505 | 1529 | \*/ |
  | 1506 | 1530 | if ( empty( $event\_data['\_tmem\_event\_end\_date'] ) ) { |
  | 1507 |  | if ( ~~date( 'H', strtotime( $event\_data['\_tmem\_event\_finish'] ) ) >~~ date( 'H', strtotime( $event\_data['\_tmem\_event\_start'] ) ) ) { |
  | 1508 |  | $event\_data['\_tmem\_event\_end\_date'] = sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ); // phpcs:ignore WordPress.Security.~~ValidatedSanitizedInput.InputNotValidated~~ |
  | 1509 |  | } else { // End date is following day |
  | 1510 |  | $event\_data['\_tmem\_event\_end\_date'] = ~~date( 'Y-m-d', strtotime( '+1 day', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ) ) ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  |  | 1531 | if ( gmdate( 'H', strtotime( $event\_data['\_tmem\_event\_finish'] ) ) > gmdate( 'H', strtotime( $event\_data['\_tmem\_event\_start'] ) ) ) { |
  |  | 1532 | $event\_data['\_tmem\_event\_end\_date'] = sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1533 | } else { // End date is following day. |
  |  | 1534 | $event\_data['\_tmem\_event\_end\_date'] = gmdate( 'Y-m-d', strtotime( '+1 day', strtotime( sanitize\_text\_field( wp\_unslash( $\_POST['\_tmem\_event\_date'] ) ) ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1511 | 1535 | } |
  | 1512 | 1536 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1515) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1539) |  |
  | 1515 | 1539 | \* Determine the state of the Deposit & Balance payments. |
  | 1516 | 1540 | \*/ |
  | 1517 |  | $event\_data['\_tmem\_event\_deposit\_status'] = ! empty( $\_POST['deposit\_paid'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['deposit\_paid'] ) ) : 'Due'; |
  | 1518 |  | $event\_data['\_tmem\_event\_balance\_status'] = ! empty( $\_POST['balance\_paid'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['balance\_paid'] ) ) : 'Due'; |
  | 1519 |  |  |
  | 1520 |  | $deposit\_payment = ( $event\_data['\_tmem\_event\_deposit\_status'] == 'Paid' && $current\_meta['\_tmem\_event\_deposit\_status'][0] != 'Paid' ) ? true : false; |
  | 1521 |  |  |
  | 1522 |  | $balance\_payment = ( $event\_data['\_tmem\_event\_balance\_status'] == 'Paid' && $current\_meta['\_tmem\_event\_balance\_status'][0] != 'Paid' ) ? true : false; |
  | 1523 |  |  |
  | 1524 |  | // Add-Ons |
  |  | 1541 | $event\_data['\_tmem\_event\_deposit\_status'] = ! empty( $\_POST['deposit\_paid'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['deposit\_paid'] ) ) : 'Due'; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1542 | $event\_data['\_tmem\_event\_balance\_status'] = ! empty( $\_POST['balance\_paid'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['balance\_paid'] ) ) : 'Due'; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1543 |  |
  |  | 1544 | $deposit\_payment = ( 'Paid' === $event\_data['\_tmem\_event\_deposit\_status'] && 'Paid' !== $current\_meta['\_tmem\_event\_deposit\_status'][0] ) ? true : false; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1545 | $balance\_payment = ( 'Paid' === $event\_data['\_tmem\_event\_balance\_status'] && 'Paid' !== $current\_meta['\_tmem\_event\_balance\_status'][0] ) ? true : false; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1546 |  |
  |  | 1547 | // Add-Ons. |
  | 1525 | 1548 | if ( tmem\_packages\_enabled() ) { |
  | 1526 |  | $event\_data['\_tmem\_event\_addons'] = ! empty( $\_POST['event\_addons'] ) ? array\_map( 'sanitize\_text\_field', wp\_unslash( $\_POST['event\_addons'] ) ) : ''; |
  | 1527 |  | } |
  | 1528 |  |  |
  | 1529 |  | // Assign the event type |
  |  | 1549 | $event\_data['\_tmem\_event\_addons'] = ! empty( $\_POST['event\_addons'] ) ? array\_map( 'sanitize\_text\_field', wp\_unslash( $\_POST['event\_addons'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1550 | } |
  |  | 1551 |  |
  |  | 1552 | // Assign the event type. |
  | 1530 | 1553 | $existing\_event\_type = wp\_get\_object\_terms( $post\_id, 'event-types' ); |
  | 1531 | 1554 |  |
  | 1532 |  | tmem\_set\_event\_type( $post\_id, (int) ~~$\_POST['tmem\_event\_type'] ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  | 1533 |  |  |
  | 1534 |  | // Assign the enquiry source |
  | 1535 |  | tmem\_set\_enquiry\_source( $post\_id, (int) ~~$\_POST['tmem\_enquiry\_source'] ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  |  | 1555 | tmem\_set\_event\_type( $post\_id, (int) sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_type'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1556 |  |
  |  | 1557 | // Assign the enquiry source. |
  |  | 1558 | tmem\_set\_enquiry\_source( $post\_id, (int) sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_enquiry\_source'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1536 | 1559 |  |
  | 1537 | 1560 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1544) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1567) |  |
  | 1544 | 1567 | $debug[] = 'Meta Updates Completed'; |
  | 1545 | 1568 |  |
  | 1546 |  | if ( ~~$deposit\_payment == true || $balance\_payment == true~~ ) { |
  | 1547 |  |  |
  | 1548 |  | if ( ~~$balance\_payment == true~~ ) { |
  |  | 1569 | if ( true === $deposit\_payment || true === $balance\_payment ) { |
  |  | 1570 |  |
  |  | 1571 | if ( true === $balance\_payment ) { |
  | 1549 | 1572 | unset( $event\_data['\_tmem\_event\_balance\_status'] ); |
  | 1550 | 1573 | unset( $event\_data['\_tmem\_event\_deposit\_status'] ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1556) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1579) |  |
  | 1556 | 1579 | } |
  | 1557 | 1580 |  |
  | 1558 |  | // Set the event status & initiate tasks based on the status |
  | 1559 |  | if ( ~~$\_POST['original\_post\_status'] != $\_POST['tmem\_event\_status'] ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated~~ |
  |  | 1581 | // Set the event status & initiate tasks based on the status. |
  |  | 1582 | if ( sanitize\_text\_field( wp\_unslash( $\_POST['original\_post\_status'] ) ) !== sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_status'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1560 | 1583 |  |
  | 1561 | 1584 | tmem\_update\_event\_status( |
  | 1562 | 1585 | $post\_id, |
  | 1563 |  | sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_status'] ) ), // phpcs:ignore WordPress.Security.~~ValidatedSanitizedInput.InputNotValidated~~ |
  | 1564 |  | sanitize\_text\_field( wp\_unslash( $\_POST['original\_post\_status'] ) ), // phpcs:ignore WordPress.Security.~~ValidatedSanitizedInput.InputNotValidated~~ |
  |  | 1586 | sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_status'] ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1587 | sanitize\_text\_field( wp\_unslash( $\_POST['original\_post\_status'] ) ), // phpcs:ignore WordPress.Security.NonceVerification |
  | 1565 | 1588 | array( |
  | 1566 |  | 'client\_notices' => empty( $\_POST['tmem\_block\_emails'] ) ? true : false, |
  | 1567 |  | 'email\_template' => ! empty( $\_POST['tmem\_email\_template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_email\_template'] ) ) : false, |
  | 1568 |  | 'quote\_template' => ! empty( $\_POST['tmem\_online\_quote'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_online\_quote'] ) ) : false, |
  |  | 1589 | 'client\_notices' => empty( $\_POST['tmem\_block\_emails'] ) ? true : false, // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1590 | 'email\_template' => ! empty( $\_POST['tmem\_email\_template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_email\_template'] ) ) : false, // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1591 | 'quote\_template' => ! empty( $\_POST['tmem\_online\_quote'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_online\_quote'] ) ) : false, // phpcs:ignore WordPress.Security.NonceVerification |
  | 1569 | 1592 | ) |
  | 1570 | 1593 | ); |
  | 1571 | 1594 |  |
  | 1572 |  | } else { // Event status is un-changed so just log the changes to the journal |
  |  | 1595 | } else { // Event status is un-changed so just log the changes to the journal. |
  | 1573 | 1596 |  |
  | 1574 | 1597 | tmem\_add\_journal( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1590) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1613) |  |
  | 1590 | 1613 | } |
  | 1591 | 1614 |  |
  | 1592 |  | // Fire the save event hook |
  | 1593 |  | do\_action( 'tmem\_save\_event', $post, sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_status'] ) ) ); // phpcs:ignore WordPress.Security.~~ValidatedSanitizedInput.InputNotValidated~~ |
  | 1594 |  |  |
  | 1595 |  | // Fire our post save hook |
  |  | 1615 | // Fire the save event hook. |
  |  | 1616 | do\_action( 'tmem\_save\_event', $post, sanitize\_text\_field( wp\_unslash( $\_POST['tmem\_event\_status'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1617 |  |
  |  | 1618 | // Fire our post save hook. |
  | 1596 | 1619 | do\_action( 'tmem\_after\_event\_save', $post\_id, $post, $update ); |
  | 1597 | 1620 |  |
  | 1598 |  | // Re-add the save post action to avoid loops |
  |  | 1621 | // Re-add the save post action to avoid loops. |
  | 1599 | 1622 | add\_action( 'save\_post\_tmem-event', 'tmem\_save\_event\_post', 10, 3 ); |
  | 1600 | 1623 |  |
  | 1601 | 1624 | $debug[] = sprintf( 'Completed Event Save for event %s', $post\_id ); |
  | 1602 | 1625 |  |
  | 1603 |  | if ( ! empty( $debug ) && TMEM\_DEBUG == true ) { |
  |  | 1626 | if ( ! empty( $debug ) && TMEM\_DEBUG === true ) { |
  | 1604 | 1627 |  |
  | 1605 | 1628 | $true = true; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1618) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1641) |  |
  | 1618 | 1641 | \* |
  | 1619 | 1642 | \* @since   1.3 |
  | 1620 |  | \* @param   arr $messages   The current messages |
  |  | 1643 | \* @param   arr $messages   The current messages. |
  | 1621 | 1644 | \* @return  arr     $messages   Filtered messages |
  | 1622 | 1645 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1625) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1648) |  |
  | 1625 | 1648 | global $post; |
  | 1626 | 1649 |  |
  | 1627 |  | if ( 'tmem-event' != $post->post\_type ) { |
  |  | 1650 | if ( 'tmem-event' !== $post->post\_type ) { |
  | 1628 | 1651 | return $messages; |
  | 1629 | 1652 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2637682#L1636) | […](/browser/mobile-events-manager/trunk/includes/admin/events/events.php?rev=2647987#L1659) |  |
  | 1636 | 1659 | $messages['tmem-event'] = array( |
  | 1637 | 1660 | 0 => '', // Unused. Messages start at index 1. |
  |  | 1661 | /\* translators: all translate to URLs \*/ |
  | 1638 | 1662 | 1 => sprintf( \_\_( '%2$s updated. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 1663 | /\* translators: all translate to URLs \*/ |
  | 1639 | 1664 | 4 => sprintf( \_\_( '%2$s updated. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 1665 | /\* translators: all translate to URLs \*/ |
  | 1640 | 1666 | 6 => sprintf( \_\_( '%2$s created. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 1667 | /\* translators: all translate to URLs \*/ |
  | 1641 | 1668 | 7 => sprintf( \_\_( '%2$s saved. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  |  | 1669 | /\* translators: all translate to URLs \*/ |
  | 1642 | 1670 | 8 => sprintf( \_\_( '%2$s submitted. %1$s%3$s List%4$s.', 'mobile-events-manager' ), $url1, $url2, $url3, $url4 ), |
  | 1643 | 1671 | ); |
* ## [mobile-events-manager/trunk/includes/admin/events/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/metaboxes.php")

  | [r2625441](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L16 "Show revision 2625441 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L25) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L25) |  |
  | 25 | 25 | \* |
  | 26 | 26 | \* @since   1.5 |
  | 27 |  | \* @param   int  $event\_id           The event ID |
  | 28 |  | \* @param   obj  $tmem\_event         The event object |
  | 29 |  | \* @param   bool $tmem\_event\_update  Whether an event is being updated |
  |  | 27 | \* @param   int  $event\_id           The event ID. |
  |  | 28 | \* @param   obj  $tmem\_event         The event object. |
  |  | 29 | \* @param   bool $tmem\_event\_update  Whether an event is being updated. |
  | 30 | 30 | \* @return  arr     Array of action links |
  | 31 | 31 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L48) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L48) |  |
  | 48 | 48 | \* |
  | 49 | 49 | \* @since   1.5 |
  | 50 |  | \* @param   int  $event\_id           The event ID |
  | 51 |  | \* @param   obj  $tmem\_event         The event object |
  | 52 |  | \* @param   bool $tmem\_event\_update  Whether an event is being updated |
  |  | 50 | \* @param   int  $event\_id           The event ID. |
  |  | 51 | \* @param   obj  $tmem\_event         The event object. |
  |  | 52 | \* @param   bool $tmem\_event\_update  Whether an event is being updated. |
  | 53 | 53 | \* @return  arr     Array of action links |
  | 54 | 54 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L57) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L57) |  |
  | 57 | 57 | $venue\_id = $tmem\_event->get\_venue\_id(); |
  | 58 | 58 | $actions  = array( |
  |  | 59 | /\* translators: %s Venue \*/ |
  | 59 | 60 | 'event\_options' => '<a href="#" class="toggle-event-options-section">' . sprintf( \_\_( 'Show %s options', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) . '</a>', |
  | 60 | 61 | ); |
  | 61 | 62 |  |
  | 62 |  | // Event workers |
  |  | 63 | // Event workers. |
  | 63 | 64 | if ( tmem\_is\_employer() ) { |
  |  | 65 | /\* translators: %s Event \*/ |
  | 64 | 66 | $actions['event\_workers'] = '<a href="#" class="toggle-add-worker-section">' . sprintf( \_\_( 'Show %s workers', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) . '</a>'; |
  | 65 | 67 | } |
  | 66 | 68 |  |
  | 67 |  | // New event type |
  |  | 69 | // New event type. |
  | 68 | 70 | if ( tmem\_is\_admin() ) { |
  |  | 71 | /\* translators: %s Event \*/ |
  | 69 | 72 | $actions['event\_type'] = '<a href="#" class="toggle-event-type-option-section">' . sprintf( \_\_( 'Add %s type', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) . '</a>'; |
  | 70 | 73 | } |
  | 71 | 74 |  |
  | 72 |  | // Venues |
  |  | 75 | // Venues. |
  | 73 | 76 | $actions['view\_venue'] = '<a href="#" class="toggle-event-view-venue-option-section">' . \_\_( 'Show venue', 'mobile-events-manager' ) . '</a>'; |
  | 74 | 77 | $actions['add\_venue']  = '<a href="#" class="toggle-event-add-venue-option-section">' . \_\_( 'Add venue', 'mobile-events-manager' ) . '</a>'; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L82) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L85) |  |
  | 82 | 85 | \* |
  | 83 | 86 | \* @since   1.5 |
  | 84 |  | \* @param   int  $event\_id           The event ID |
  | 85 |  | \* @param   obj  $tmem\_event         The event object |
  | 86 |  | \* @param   bool $tmem\_event\_update  Whether an event is being updated |
  |  | 87 | \* @param   int  $event\_id           The event ID. |
  |  | 88 | \* @param   obj  $tmem\_event         The event object. |
  |  | 89 | \* @param   bool $tmem\_event\_update  Whether an event is being updated. |
  | 87 | 90 | \* @return  arr     Array of action links |
  | 88 | 91 | \*/ |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L100) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L103) |  |
  | 100 | 103 | \* |
  | 101 | 104 | \* @since   1.3 |
  | 102 |  | ~~\* @param~~ |
  | 103 |  | ~~\* @return~~ |
  | 104 | 105 | \*/ |
  | 105 | 106 | function tmem\_remove\_event\_meta\_boxes() { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L126) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L127) |  |
  | 126 | 127 | \* |
  | 127 | 128 | \* @since   1.3 |
  | 128 |  | \* @param |
  | 129 |  | \* @return |
  |  | 129 | \* @param var $post Post Event Details. |
  | 130 | 130 | \*/ |
  | 131 | 131 | function tmem\_add\_event\_meta\_boxes( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L138) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L138) |  |
  | 138 | 138 | $tmem\_event->get\_event\_data(); |
  | 139 | 139 |  |
  | 140 |  | if ( 'draft' !=~~$post->post\_status && 'auto-draft' !~~= $post->post\_status ) { |
  |  | 140 | if ( 'draft' !== $post->post\_status && 'auto-draft' !== $post->post\_status ) { |
  | 141 | 141 | $tmem\_event\_update = true; |
  | 142 | 142 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L147) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L147) |  |
  | 147 | 147 | array( |
  | 148 | 148 | 'id'         => 'tmem-event-save-mb', |
  |  | 149 | /\* translators: %s Event \*/ |
  | 149 | 150 | 'title'      => sprintf( \_\_( '%1$s #%2$s', 'mobile-events-manager' ), tmem\_get\_label\_singular(), $tmem\_event->data['contract\_id'] ), |
  | 150 | 151 | 'callback'   => 'tmem\_event\_metabox\_save\_callback', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L167) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L168) |  |
  | 167 | 168 | array( |
  | 168 | 169 | 'id'         => 'tmem-event-overview-mb', |
  |  | 170 | /\* translators: %s Event \*/ |
  | 169 | 171 | 'title'      => sprintf( \_\_( '%s Overview', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 170 | 172 | 'callback'   => 'tmem\_event\_metabox\_overview\_callback', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L197) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L199) |  |
  | 197 | 199 | array( |
  | 198 | 200 | 'id'         => 'tmem-event-history-mb', |
  |  | 201 | /\* translators: %s Event \*/ |
  | 199 | 202 | 'title'      => sprintf( \_\_( '%s History', 'mobile-events-manager' ), tmem\_get\_label\_singular() ), |
  | 200 | 203 | 'callback'   => 'tmem\_event\_metabox\_history\_callback', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L207) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L210) |  |
  | 207 | 210 | ) |
  | 208 | 211 | ); |
  | 209 |  | // Runs before metabox output |
  |  | 212 | // Runs before metabox output. |
  | 210 | 213 | do\_action( 'tmem\_event\_before\_metaboxes' ); |
  | 211 | 214 |  |
  | 212 |  | // Begin metaboxes |
  |  | 215 | // Begin metaboxes. |
  | 213 | 216 | foreach ( $metaboxes as $metabox ) { |
  | 214 |  | // Dependancy check |
  | 215 |  | if ( ! empty( $metabox['dependancy'] ) && ~~$metabox['dependancy'] === false~~ ) { |
  |  | 217 | // Dependancy check. |
  |  | 218 | if ( ! empty( $metabox['dependancy'] ) && false === $metabox['dependancy'] ) { |
  | 216 | 219 | continue; |
  | 217 | 220 | } |
  | 218 | 221 |  |
  | 219 |  | // Permission check |
  |  | 222 | // Permission check. |
  | 220 | 223 | if ( ! empty( $metabox['permission'] ) && ! tmem\_employee\_can( $metabox['permission'] ) ) { |
  | 221 | 224 | continue; |
  | 222 | 225 | } |
  | 223 | 226 |  |
  | 224 |  | // Callback check |
  |  | 227 | // Callback check. |
  | 225 | 228 | if ( ! is\_callable( $metabox['callback'] ) ) { |
  | 226 | 229 | continue; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L238) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L241) |  |
  | 238 | 241 | } |
  | 239 | 242 |  |
  | 240 |  | // Runs after metabox output |
  |  | 243 | // Runs after metabox output. |
  | 241 | 244 | do\_action( 'tmem\_event\_after\_metaboxes' ); |
  | 242 |  | } // tmem\_add\_event\_meta\_boxes |
  |  | 245 | } // tmem\_add\_event\_meta\_boxes. |
  | 243 | 246 | add\_action( 'add\_meta\_boxes\_tmem-event', 'tmem\_add\_event\_meta\_boxes' ); |
  | 244 | 247 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L248) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L251) |  |
  | 248 | 251 | \* @since   1.3 |
  | 249 | 252 | \* @param   obj $post   The post object (WP\_Post). |
  | 250 |  | ~~\* @return~~ |
  | 251 | 253 | \*/ |
  | 252 | 254 | function tmem\_event\_metabox\_save\_callback( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L265) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L267) |  |
  | 265 | 267 | \* These items go inside the tmem-event-actions div |
  | 266 | 268 | \* @since   1.3.7 |
  | 267 |  | \* @param   int $post\_id    The Event post ID |
  |  | 269 | \* @param   int $post\_id    The Event post ID. |
  | 268 | 270 | \*/ |
  | 269 | 271 | do\_action( 'tmem\_event\_options\_fields', $post->ID ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L289) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L291) |  |
  | 289 | 291 | \* @since   1.5 |
  | 290 | 292 | \* @param   obj $post   The post object (WP\_Post). |
  | 291 |  | ~~\* @return~~ |
  | 292 | 293 | \*/ |
  | 293 | 294 | function tmem\_event\_metabox\_overview\_callback( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L309) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L310) |  |
  | 309 | 310 | \* @since   1.3 |
  | 310 | 311 | \* @param   obj $post   The post object (WP\_Post). |
  | 311 |  | ~~\* @return~~ |
  | 312 | 312 | \*/ |
  | 313 | 313 | function tmem\_event\_metabox\_admin\_callback( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L329) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L329) |  |
  | 329 | 329 | \* @since   1.3 |
  | 330 | 330 | \* @param   obj $post   The post object (WP\_Post). |
  | 331 |  | ~~\* @return~~ |
  | 332 | 331 | \*/ |
  | 333 | 332 | function tmem\_event\_metabox\_history\_callback( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L352) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L351) |  |
  | 352 | 351 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new |
  | 353 | 352 | \* @param   obj $post               The post object (WP\_Post). |
  | 354 |  | ~~\* @return~~ |
  | 355 | 353 | \*/ |
  | 356 | 354 | function tmem\_event\_metabox\_transactions\_callback( $post ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L374) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L372) |  |
  | 374 | 372 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 375 | 373 | \* @param   int $event\_id           The event ID. |
  | 376 |  | ~~\* @return  str~~ |
  | 377 | 374 | \*/ |
  | 378 | 375 | function tmem\_event\_metabox\_options\_status\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L408) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L405) |  |
  | 408 | 405 | $balance\_status = \_\_( 'Due', 'mobile-events-manager' ); |
  | 409 | 406 |  |
  | 410 |  | if ( $tmem\_event\_update && 'tmem-unattended' != $tmem\_event->post\_status ) { |
  |  | 407 | if ( $tmem\_event\_update && 'tmem-unattended' !== $tmem\_event->post\_status ) { |
  | 411 | 408 | $deposit\_status = $tmem\_event->get\_deposit\_status(); |
  | 412 | 409 | $balance\_status = $tmem\_event->get\_balance\_status(); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L427) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L424) |  |
  | 427 | 424 | ); |
  | 428 | 425 | ?> |
  | 429 |  | <?php printf( esc\_html\_\_( '%s Paid?', 'mobile-events-manager' ), esc\_html( tmem\_get\_deposit\_label() ) ); ?></p> |
  |  | 426 | <?php /\* translators: %s Deposit \*/ ?> |
  |  | 427 | <?php printf( esc\_html\_\_( '%s Paid?', 'mobile-events-manager' ), esc\_html( tmem\_get\_deposit\_label() ) ); ?></p> |
  | 430 | 428 |  |
  | 431 | 429 | <p> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L439) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L437) |  |
  | 439 | 437 | ); |
  | 440 | 438 | ?> |
  | 441 |  | <?php printf( esc\_html\_\_( '%s Paid?', 'mobile-events-manager' ), esc\_html( tmem\_get\_balance\_label() ) ); ?></p> |
  |  | 439 | <?php /\* translators: %s Balance \*/ ?> |
  |  | 440 | <?php printf( esc\_html\_\_( '%s Paid?', 'mobile-events-manager' ), esc\_html( tmem\_get\_balance\_label() ) ); ?></p> |
  | 442 | 441 |  |
  | 443 | 442 | <?php |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L462) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L461) |  |
  | 462 | 461 | return; |
  | 463 | 462 | } |
  | 464 |  |  |
  |  | 463 | /\* translators: %s Event \*/ |
  | 465 | 464 | $button\_text = \_\_( 'Add %s', 'mobile-events-manager' ); |
  | 466 | 465 |  |
  | 467 | 466 | if ( $tmem\_event\_update ) { |
  |  | 467 | /\* translators: %s Event \*/ |
  | 468 | 468 | $button\_text = \_\_( 'Update %s', 'mobile-events-manager' ); |
  | 469 | 469 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L471) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L471) |  |
  | 471 | 471 | $class = ''; |
  | 472 | 472 | $url   = add\_query\_arg( array( 'post\_type' => 'tmem-event' ), admin\_url( 'edit.php' ) ); |
  | 473 |  | $a     = sprintf( \_\_( 'Back to %s', 'mobile-events-manager' ), tmem\_get\_label\_plural() ); |
  | 474 |  |  |
  | 475 |  | if ( tmem\_employee\_can( 'manage\_all\_events' ) && ( ! $tmem\_event\_update || $tmem\_event->post\_status == 'tmem-unattended' ) ) { |
  |  | 473 | /\* translators: %s Events \*/ |
  |  | 474 | $a = sprintf( \_\_( 'Back to %s', 'mobile-events-manager' ), tmem\_get\_label\_plural() ); |
  |  | 475 |  |
  |  | 476 | if ( tmem\_employee\_can( 'manage\_all\_events' ) && ( ! $tmem\_event\_update || 'tmem-unattended' === $tmem\_event->post\_status ) ) { |
  | 476 | 477 | $class = 'tmem-delete'; |
  | 477 | 478 | $url   = wp\_nonce\_url( |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L485) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L486) |  |
  | 485 | 486 | 'trash-post\_' . $event\_id |
  | 486 | 487 | ); |
  | 487 |  | $a     = sprintf( \_\_( 'Delete %s', 'mobile-events-manager' ), tmem\_get\_label\_singular() ); |
  |  | 488 | /\* translators: %s Event \*/ |
  |  | 489 | $a = sprintf( \_\_( 'Delete %s', 'mobile-events-manager' ), tmem\_get\_label\_singular() ); |
  | 488 | 490 | } |
  | 489 | 491 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L520) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L522) |  |
  | 520 | 522 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 521 | 523 | \* @param   int $event\_id           The event ID. |
  | 522 |  | ~~\* @return  str~~ |
  | 523 | 524 | \*/ |
  | 524 | 525 | function tmem\_event\_metabox\_tasks\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L538) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L539) |  |
  | 538 | 539 | '%s: %s', |
  | 539 | 540 | tmem\_get\_task\_name( $task\_slug ), |
  | 540 |  | date( tmem\_get\_option( 'short\_date\_format' ), $run\_time ) |
  |  | 541 | gmdate( tmem\_get\_option( 'short\_date\_format' ), $run\_time ) |
  | 541 | 542 | ); |
  | 542 | 543 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L547) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L548) |  |
  | 547 | 548 | } else { |
  | 548 | 549 | $history\_class = ' description'; |
  | 549 |  | $history       = sprintf( \_\_( 'None of the available tasks have been executed for this %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ); |
  |  | 550 | /\* translators: %s Event \*/ |
  |  | 551 | $history = sprintf( \_\_( 'None of the available tasks have been executed for this %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ); |
  | 550 | 552 | } |
  | 551 | 553 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L554) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L556) |  |
  | 554 | 556 | <?php if ( ! $tmem\_event\_update || empty( $tasks ) ) : ?> |
  | 555 | 557 | <span class="description"> |
  |  | 558 | <?php /\* translators: %s Events \*/ ?> |
  | 556 | 559 | <?php printf( esc\_html\_\_( 'No tasks are available for this %s.', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular( true ) ) ); ?> |
  | 557 | 560 | </span> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L608) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L611) |  |
  | 608 | 611 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 609 | 612 | \* @param   int $event\_id           The event ID. |
  | 610 |  | ~~\* @return  str~~ |
  | 611 | 613 | \*/ |
  | 612 | 614 | function tmem\_event\_overview\_metabox\_client\_sections( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L660) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L662) |  |
  | 660 | 662 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 661 | 663 | \* @param   int $event\_id           The event ID. |
  | 662 |  | ~~\* @return  str~~ |
  | 663 | 664 | \*/ |
  | 664 | 665 | function tmem\_event\_overview\_metabox\_event\_sections( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L676) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L677) |  |
  | 676 | 677 | <div class="tmem-event-row-header"> |
  | 677 | 678 | <span class="tmem-repeatable-row-title"> |
  |  | 679 | <?php /\* translators: %s Events \*/ ?> |
  | 678 | 680 | <?php printf( esc\_html\_\_( '%s Details', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?> |
  | 679 | 681 | </span> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L708) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L710) |  |
  | 708 | 710 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 709 | 711 | \* @param   int $event\_id           The event ID. |
  | 710 |  | ~~\* @return  str~~ |
  | 711 | 712 | \*/ |
  | 712 | 713 | function tmem\_event\_overview\_metabox\_event\_price\_sections( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L762) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L763) |  |
  | 762 | 763 | array( |
  | 763 | 764 | 'name'  => '\_tmem\_event\_addons\_cost', |
  | 764 |  | 'value' => ~~! empty( $tmem\_event->addons\_price ) ? tmem\_sanitize\_amount( $tmem\_event->addons\_price ) : ''~~, |
  |  | 765 | 'value' => esc\_attr( ! empty( $tmem\_event->addons\_price ) ? tmem\_sanitize\_amount( $tmem\_event->addons\_price ) : '' ), |
  | 765 | 766 | ) |
  | 766 | 767 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L825) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L826) |  |
  | 825 | 826 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 826 | 827 | \* @param   int $event\_id           The event ID. |
  | 827 |  | ~~\* @return  str~~ |
  | 828 | 828 | \*/ |
  | 829 | 829 | function tmem\_event\_overview\_metabox\_client\_name\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L833) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L833) |  |
  | 833 | 833 | $block\_emails = false; |
  | 834 | 834 |  |
  | 835 |  | if ( 'tmem-enquiry' == $tmem\_event->post\_status && ! tmem\_get\_option( 'contract\_to\_client' ) ) { |
  |  | 835 | if ( 'tmem-enquiry' === $tmem\_event->post\_status && ! tmem\_get\_option( 'contract\_to\_client' ) ) { |
  | 836 | 836 | $block\_emails = true; |
  | 837 | 837 | } |
  | 838 | 838 |  |
  | 839 |  | if ( 'tmem-enquiry' == $tmem\_event->post\_status && ! tmem\_get\_option( 'booking\_conf\_to\_client' ) ) { |
  |  | 839 | if ( 'tmem-enquiry' === $tmem\_event->post\_status && ! tmem\_get\_option( 'booking\_conf\_to\_client' ) ) { |
  | 840 | 840 | $block\_emails = true; |
  | 841 | 841 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L843) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L843) |  |
  | 843 | 843 |  |
  | 844 | 844 | <div class="tmem-client-name"> |
  | 845 |  | <span class="tmem-repeatable-row-setting-label"><?php esc\_html\_e( 'Client', 'mobile-events-manager' ); ?></span> |
  | 846 |  |  |
  |  | 845 | <span class="tmem-repeatable-row-setting-label"><?php esc\_html\_e( 'Client', 'mobile-events-manager' ); ?></span> |
  | 847 | 846 | <?php if ( tmem\_event\_is\_active( $event\_id ) ) : ?> |
  | 848 | 847 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L886) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L885) |  |
  | 886 | 885 | <?php endif; ?> |
  | 887 | 886 | </div> |
  | 888 |  | <?php if ( tmem\_event\_is\_active( $tmem\_event->ID ) && 'tmem-completed' !=~~$tmem\_event->post\_status && 'tmem-approved' !~~= $tmem\_event->post\_status ) : ?> |
  |  | 887 | <?php if ( tmem\_event\_is\_active( $tmem\_event->ID ) && 'tmem-completed' !== $tmem\_event->post\_status && 'tmem-approved' !== $tmem\_event->post\_status ) : ?> |
  | 889 | 888 | <div class="tmem-repeatable-option tmem\_repeatable\_default\_wrapper"> |
  | 890 | 889 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L899) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L898) |  |
  | 899 | 898 | ); |
  | 900 | 899 | ?> |
  |  | 900 | <?php /\* translators: %s Events \*/ ?> |
  | 901 | 901 | <span class="screen-reader-text"><?php printf( esc\_html\_\_( 'Block update emails for this %s to the client', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular( true ) ) ); ?></span> |
  | 902 | 902 | </label> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L905) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L905) |  |
  | 905 | 905 | <?php endif; ?> |
  | 906 | 906 |  |
  | 907 |  | <?php if ( ! $tmem\_event\_update || 'tmem-approved' == $tmem\_event->post\_status ) : ?> |
  |  | 907 | <?php if ( ! $tmem\_event\_update || 'tmem-approved' === $tmem\_event->post\_status ) : ?> |
  | 908 | 908 | <div class="tmem-repeatable-option tmem\_repeatable\_default\_wrapper"> |
  | 909 | 909 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L918) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L918) |  |
  | 918 | 918 | ); |
  | 919 | 919 | ?> |
  |  | 920 | <?php /\* translators: %s Events \*/ ?> |
  | 920 | 921 | <span class="screen-reader-text"><?php printf( esc\_html\_\_( 'Click to reset the client password during %s update', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular( true ) ) ); ?></span> |
  | 921 | 922 | </label> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L937) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L938) |  |
  | 937 | 938 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 938 | 939 | \* @param   int $event\_id           The event ID. |
  | 939 |  | ~~\* @return  str~~ |
  | 940 | 940 | \*/ |
  | 941 | 941 | function tmem\_event\_overview\_metabox\_client\_templates\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L944) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L944) |  |
  | 944 | 944 | ?> |
  | 945 | 945 |  |
  | 946 |  | <?php if ( ! $tmem\_event\_update || ~~$tmem\_event->post\_status == 'tmem-unattended'~~ ) : ?> |
  |  | 946 | <?php if ( ! $tmem\_event\_update || 'tmem-unattended' === $tmem\_event->post\_status ) : ?> |
  | 947 | 947 | <div class="tmem-client-template-fields"> |
  | 948 | 948 | <div class="tmem-quote-template"> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1000) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1000) |  |
  | 1000 | 1000 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1001 | 1001 | \* @param   int $event\_id           The event ID. |
  | 1002 |  | ~~\* @return  str~~ |
  | 1003 | 1002 | \*/ |
  | 1004 | 1003 | function tmem\_event\_overview\_metabox\_add\_client\_section( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1215) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1214) |  |
  | 1215 | 1214 | <div class="tmem-custom-event-sections"> |
  | 1216 | 1215 | <div class="tmem-custom-event-section"> |
  |  | 1216 | <?php /\* translators: %s Client Name \*/ ?> |
  | 1217 | 1217 | <span class="tmem-custom-event-section-title"><?php printf( esc\_html\_\_( 'Contact Details for %s', 'mobile-events-manager' ), esc\_html( $client->display\_name ) ); ?></span> |
  | 1218 | 1218 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1264) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1264) |  |
  | 1264 | 1264 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1265 | 1265 | \* @param   int $event\_id           The event ID. |
  | 1266 |  | ~~\* @return  str~~ |
  | 1267 | 1266 | \*/ |
  | 1268 | 1267 | function tmem\_event\_overview\_metabox\_primary\_employee\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1274) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1273) |  |
  | 1274 | 1273 | $artist         = esc\_attr( tmem\_get\_option( 'artist' ) ); |
  | 1275 | 1274 |  |
  | 1276 |  | if ( isset( $\_GET['primary\_employee'] ) ) { |
  | 1277 |  | $employee\_id = absint( wp\_unslash( $\_GET['primary\_employee'] ) ); |
  |  | 1275 | if ( isset( $\_GET['primary\_employee'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1276 | $employee\_id = absint( wp\_unslash( $\_GET['primary\_employee'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1278 | 1277 | } |
  | 1279 | 1278 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1291) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1290) |  |
  | 1291 | 1290 | 'group'    => tmem\_is\_employer() ? true : false, // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1292 | 1291 | 'chosen'       => true, |
  |  | 1292 | /\* translators: %s Artiste type \*/ |
  | 1293 | 1293 | 'placeholder'  => sprintf( esc\_html\_\_( 'Select %s', 'mobile-events-manager' ), esc\_html( $artist ) ), |
  | 1294 | 1294 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1336) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1336) |  |
  | 1336 | 1336 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1337 | 1337 | \* @param   int $event\_id           The event ID. |
  | 1338 |  | ~~\* @return  str~~ |
  | 1339 | 1338 | \*/ |
  | 1340 | 1339 | function tmem\_event\_overview\_metabox\_event\_type\_contract\_venue\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1351) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1350) |  |
  | 1351 | 1350 | } |
  | 1352 | 1351 |  |
  | 1353 |  | if ( ! empty( $venue\_id ) && $venue\_id == $event\_id ) { |
  |  | 1352 | if ( ! empty( $venue\_id ) && $venue\_id === $event\_id ) { |
  | 1354 | 1353 | $venue\_id = 'manual'; |
  | 1355 | 1354 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1359) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1358) |  |
  | 1359 | 1358 | <div class="tmem-event-type"> |
  | 1360 | 1359 | <span class="tmem-repeatable-row-setting-label"> |
  |  | 1360 | <?php /\* translators: %s Event \*/ ?> |
  | 1361 | 1361 | <?php printf( esc\_html\_\_( '%s Type', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?> |
  | 1362 | 1362 | </span> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1403) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1403) |  |
  | 1403 | 1403 | add\_query\_arg( |
  | 1404 | 1404 | array( |
  | 1405 |  | 'page' => 'tmem-view-contract', |
  | 1406 |  | 'event\_id' => $event\_id, |
  |  | 1405 | 'page'     => 'tmem-view-contract', |
  |  | 1406 | 'event\_id' => $event\_id, |
  | 1407 | 1407 | ), |
  | 1408 |  | admin\_url( 'admin.php' ) |
  |  | 1408 | admin\_url( 'admin.php' ) |
  | 1409 | 1409 | ) |
  | 1410 | 1410 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1447) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1447) |  |
  | 1447 | 1447 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1448 | 1448 | \* @param   int $event\_id           The event ID. |
  | 1449 |  | ~~\* @return  str~~ |
  | 1450 | 1449 | \*/ |
  | 1451 | 1450 | function tmem\_event\_overview\_metabox\_event\_dates\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1505) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1504) |  |
  | 1505 | 1504 | <div class="tmem-event-finish-date"> |
  | 1506 | 1505 | <span class="tmem-repeatable-row-setting-label"> |
  | 1507 |  | <?php esc\_html\_e( 'End', 'mobile-events-manager' ); ?> |
  |  | 1506 | <?php esc\_html\_e( 'End Date', 'mobile-events-manager' ); ?> |
  | 1508 | 1507 | </span> |
  | 1509 | 1508 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1564) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1563) |  |
  | 1564 | 1563 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1565 | 1564 | \* @param   int $event\_id           The event ID. |
  | 1566 |  | ~~\* @return  str~~ |
  | 1567 | 1565 | \*/ |
  | 1568 | 1566 | function tmem\_event\_overview\_metabox\_event\_times\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1585) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1583) |  |
  | 1585 | 1583 | echo TMEM()->html->time\_hour\_select( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1586 | 1584 | array( |
  | 1587 |  | 'selected' => esc\_attr( ! empty( $start ) ? date( $format[0], esc\_html( strtotime( $start ) ) ) : '' ), |
  |  | 1585 | 'selected' => esc\_attr( ! empty( $start ) ? gmdate( $format[0], esc\_html( strtotime( $start ) ) ) : '' ), |
  | 1588 | 1586 | ) |
  | 1589 | 1587 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1592) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1590) |  |
  | 1592 | 1590 | echo TMEM()->html->time\_minute\_select( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1593 | 1591 | array( |
  | 1594 |  | 'selected' => esc\_attr( ! empty( $start ) ? date( $format[2], esc\_html( strtotime( $start ) ) ) : '' ), |
  |  | 1592 | 'selected' => esc\_attr( ! empty( $start ) ? gmdate( $format[2], esc\_html( strtotime( $start ) ) ) : '' ), |
  | 1595 | 1593 | ) |
  | 1596 | 1594 | ); |
  | 1597 | 1595 | ?> |
  | 1598 |  | <?php if ( 'H:i' != $format ) : ?> |
  |  | 1596 | <?php if ( 'H:i' !== $format ) : ?> |
  | 1599 | 1597 | <?php |
  | 1600 | 1598 | echo TMEM()->html->time\_period\_select( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1601 | 1599 | array( |
  | 1602 |  | 'selected' => esc\_attr( ! empty( $start ) ? date( 'A', esc\_html( strtotime( $start ) ) ) : '' ), |
  |  | 1600 | 'selected' => esc\_attr( ! empty( $start ) ? gmdate( 'A', esc\_html( strtotime( $start ) ) ) : '' ), |
  | 1603 | 1601 | ) |
  | 1604 | 1602 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1609) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1607) |  |
  | 1609 | 1607 | <div class="tmem-event-end-time"> |
  | 1610 | 1608 | <span class="tmem-repeatable-row-setting-label"> |
  | 1611 |  | <?php esc\_html\_e( 'End', 'mobile-events-manager' ); ?> |
  |  | 1609 | <?php esc\_html\_e( 'End Time', 'mobile-events-manager' ); ?> |
  | 1612 | 1610 | </span> |
  | 1613 | 1611 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1616) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1614) |  |
  | 1616 | 1614 | array( |
  | 1617 | 1615 | 'name'     => 'event\_finish\_hr', |
  | 1618 |  | 'selected' => esc\_attr( ! empty( $finish ) ? date( $format[0], strtotime( $finish ) ) : '' ), |
  |  | 1616 | 'selected' => esc\_attr( ! empty( $finish ) ? gmdate( $format[0], strtotime( $finish ) ) : '' ), |
  | 1619 | 1617 | ) |
  | 1620 | 1618 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1624) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1622) |  |
  | 1624 | 1622 | array( |
  | 1625 | 1623 | 'name'     => 'event\_finish\_min', |
  | 1626 |  | 'selected' => esc\_attr( ! empty( $finish ) ? date( $format[2], strtotime( $finish ) ) : '' ), |
  |  | 1624 | 'selected' => esc\_attr( ! empty( $finish ) ? gmdate( $format[2], strtotime( $finish ) ) : '' ), |
  | 1627 | 1625 | ) |
  | 1628 | 1626 | ); |
  | 1629 | 1627 | ?> |
  | 1630 |  | <?php if ( 'H:i' != $format ) : ?> |
  |  | 1628 | <?php if ( 'H:i' !== $format ) : ?> |
  | 1631 | 1629 | <?php |
  | 1632 | 1630 | echo TMEM()->html->time\_period\_select( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1633 | 1631 | array( |
  | 1634 | 1632 | 'name'     => 'event\_finish\_period', |
  | 1635 |  | 'selected' => esc\_attr( ! empty( $finish ) ? date( 'A', strtotime( $finish ) ) : '' ), |
  |  | 1633 | 'selected' => esc\_attr( ! empty( $finish ) ? gmdate( 'A', strtotime( $finish ) ) : '' ), |
  | 1636 | 1634 | ) |
  | 1637 | 1635 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1649) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1647) |  |
  | 1649 | 1647 | array( |
  | 1650 | 1648 | 'name'        => 'dj\_setup\_hr', |
  | 1651 |  | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? date( $format[0], strtotime( $setup\_time ) ) : '' ), |
  |  | 1649 | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? gmdate( $format[0], strtotime( $setup\_time ) ) : '' ), |
  | 1652 | 1650 | 'blank\_first' => true, |
  | 1653 | 1651 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1658) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1656) |  |
  | 1658 | 1656 | array( |
  | 1659 | 1657 | 'name'        => 'dj\_setup\_min', |
  | 1660 |  | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? date( $format[2], strtotime( $setup\_time ) ) : '' ), |
  |  | 1658 | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? gmdate( $format[2], strtotime( $setup\_time ) ) : '' ), |
  | 1661 | 1659 | 'blank\_first' => true, |
  | 1662 | 1660 | ) |
  | 1663 | 1661 | ); |
  | 1664 | 1662 | ?> |
  | 1665 |  | <?php if ( 'H:i' != $format ) : ?> |
  |  | 1663 | <?php if ( 'H:i' !== $format ) : ?> |
  | 1666 | 1664 | <?php |
  | 1667 | 1665 | echo TMEM()->html->time\_period\_select( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 1668 | 1666 | array( |
  | 1669 | 1667 | 'name'        => 'dj\_setup\_period', |
  | 1670 |  | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? date( 'A', strtotime( $setup\_time ) ) : '' ), |
  |  | 1668 | 'selected'    => esc\_attr( ! empty( $setup\_time ) ? gmdate( 'A', strtotime( $setup\_time ) ) : '' ), |
  | 1671 | 1669 | 'blank\_first' => true, |
  | 1672 | 1670 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1762) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1760) |  |
  | 1762 | 1760 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1763 | 1761 | \* @param   int $event\_id           The event ID. |
  | 1764 |  | ~~\* @return  str~~ |
  | 1765 | 1762 | \*/ |
  | 1766 | 1763 | function tmem\_event\_overview\_metabox\_event\_client\_notes\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1799) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1796) |  |
  | 1799 | 1796 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 1800 | 1797 | \* @param   int $event\_id           The event ID. |
  | 1801 |  | ~~\* @return  str~~ |
  | 1802 | 1798 | \*/ |
  | 1803 | 1799 | function tmem\_event\_overview\_metabox\_event\_playlist\_options\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1807) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1803) |  |
  | 1807 | 1803 | $limit\_class     = ''; |
  | 1808 | 1804 |  |
  | 1809 |  | if ( ! $tmem\_event\_update || 'tmem-unattended' == $tmem\_event->data['status'] ) { |
  |  | 1805 | if ( ! $tmem\_event\_update || 'tmem-unattended' === $tmem\_event->data['status'] ) { |
  | 1810 | 1806 | $playlist\_limit = tmem\_playlist\_global\_limit(); |
  | 1811 | 1807 | } else { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1827) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1823) |  |
  | 1827 | 1823 | <?php do\_action( 'tmem\_event\_overview\_options\_top', $event\_id ); ?> |
  | 1828 | 1824 | <div class="tmem-custom-event-section"> |
  |  | 1825 | <?php /\* translators: %s Events \*/ ?> |
  | 1829 | 1826 | <span class="tmem-custom-event-section-title"><?php printf( esc\_html\_\_( '%s Options', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></span> |
  | 1830 | 1827 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1874) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1871) |  |
  | 1874 | 1871 | <span id="tmem-playlist-view" class="tmem-playlist-view-option"> |
  | 1875 | 1872 | <label class="tmem-playlist-view"> |
  |  | 1873 | <?php /\* translators: %s Number of Songs \*/ ?> |
  | 1876 | 1874 | <?php printf( esc\_html( \_n( '%s Song in Playlist', '%s Songs in Playlist', $songs, 'mobile-events-manager' ) ), esc\_html( $songs ) ); ?> |
  | 1877 | 1875 | </label> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1920) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1918) |  |
  | 1920 | 1918 | <?php do\_action( 'tmem\_event\_overview\_workers\_top', $event\_id ); ?> |
  | 1921 | 1919 | <div class="tmem-custom-event-section"> |
  |  | 1920 | <?php /\* translators: %s Event \*/ ?> |
  | 1922 | 1921 | <span class="tmem-custom-event-section-title"><?php printf( esc\_html\_\_( '%s Workers', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></span> |
  | 1923 | 1922 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L1994) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L1993) |  |
  | 1994 | 1993 | ); |
  | 1995 | 1994 | ?> |
  | 1996 |  | " id="pay\_event\_employees" class="button button-primary button-small"><?php printf( esc\_html\_\_( 'Pay %s Employees', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></a></p> |
  |  | 1995 | " id="pay\_event\_employees" class="button button-primary button-small"> <?php /\* translators: %s Event \*/ ?><?php printf( esc\_html\_\_( 'Pay %s Employees', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></a></p> |
  | 1997 | 1996 | </div> |
  | 1998 | 1997 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2013) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2012) |  |
  | 2013 | 2012 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2014 | 2013 | \* @param   int $event\_id           The event ID. |
  | 2015 |  | ~~\* @return  str~~ |
  | 2016 | 2014 | \*/ |
  | 2017 | 2015 | function tmem\_event\_overview\_metabox\_add\_event\_type\_section( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2023) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2021) |  |
  | 2023 | 2021 | <div class="tmem-custom-event-sections"> |
  | 2024 | 2022 | <div class="tmem-custom-event-section"> |
  |  | 2023 | <?php /\* translators: %s Event \*/ ?> |
  | 2025 | 2024 | <span class="tmem-custom-event-section-title"><?php printf( esc\_html\_\_( 'New %s Type', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?></span> |
  | 2026 | 2025 |  |
  | 2027 | 2026 | <span class="tmem-new-event-type"> |
  | 2028 | 2027 | <label class="tmem-event-type"> |
  |  | 2028 | <?php /\* translators: %s Event \*/ ?> |
  | 2029 | 2029 | <?php printf( esc\_html\_\_( '%s Type', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ); ?> |
  | 2030 | 2030 | </label> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2043) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2043) |  |
  | 2043 | 2043 | <?php |
  | 2044 | 2044 | submit\_button( |
  |  | 2045 | /\* translators: %s Event \*/ |
  | 2045 | 2046 | sprintf( esc\_html\_\_( 'Add %s Type', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular() ) ), |
  | 2046 | 2047 | array( 'secondary', 'tmem-add-event-type' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2064) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2065) |  |
  | 2064 | 2065 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2065 | 2066 | \* @param   int $event\_id           The event ID. |
  | 2066 |  | ~~\* @return  str~~ |
  | 2067 | 2067 | \*/ |
  | 2068 | 2068 | function tmem\_event\_overview\_metabox\_venue\_details\_section( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2084) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2084) |  |
  | 2084 | 2084 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2085 | 2085 | \* @param   int $event\_id           The event ID. |
  | 2086 |  | ~~\* @return  str~~ |
  | 2087 | 2086 | \*/ |
  | 2088 | 2087 | function tmem\_event\_overview\_metabox\_add\_venue\_section( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2092) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2091) |  |
  | 2092 | 2091 | $venue\_id = $tmem\_event->data['venue\_id']; |
  | 2093 | 2092 |  |
  | 2094 |  | if ( 'Manual' == $venue\_id ) { |
  |  | 2093 | if ( 'Manual' === $venue\_id ) { |
  | 2095 | 2094 | $venue\_id = $event\_id; |
  | 2096 | 2095 | } |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2110) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2109) |  |
  | 2110 | 2109 | $employee\_id    = $tmem\_event->data['employee\_id'] ? $tmem\_event->data['employee\_id'] : get\_current\_user\_id(); |
  | 2111 | 2110 |  |
  | 2112 |  | if ( $tmem\_event->ID == $venue\_id ) { |
  |  | 2111 | if ( $tmem\_event->ID === $venue\_id ) { |
  | 2113 | 2112 | $section\_title  = \_\_( 'Manual Venue', 'mobile-events-manager' ); |
  | 2114 | 2113 | $add\_save\_label = \_\_( 'Save', 'mobile-events-manager' ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2270) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2269) |  |
  | 2270 | 2269 | <?php |
  | 2271 | 2270 | submit\_button( |
  |  | 2271 | /\* translators: %s Add \*/ |
  | 2272 | 2272 | sprintf( esc\_html\_\_( '%s Venue', 'mobile-events-manager' ), $add\_save\_label ), |
  | 2273 | 2273 | array( 'secondary', 'tmem-add-venue' ), |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2295) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2295) |  |
  | 2295 | 2295 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2296 | 2296 | \* @param   int $event\_id           The event ID. |
  | 2297 |  | ~~\* @return  str~~ |
  | 2298 | 2297 | \*/ |
  | 2299 | 2298 | function tmem\_event\_overview\_metabox\_venue\_travel\_section( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2320) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2319) |  |
  | 2320 | 2319 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2321 | 2320 | \* @param   int $event\_id           The event ID. |
  | 2322 |  | ~~\* @return  str~~ |
  | 2323 | 2321 | \*/ |
  | 2324 | 2322 | function tmem\_event\_overview\_metabox\_event\_equipment\_travel\_costs\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2367) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2365) |  |
  | 2367 | 2365 | 'class'       => 'tmem-currency', |
  | 2368 | 2366 | 'placeholder' => esc\_attr( tmem\_sanitize\_amount( '0.0000' ) ), |
  | 2369 |  | 'value'       => ~~tmem\_sanitize\_amount( $tmem\_event->data['addons\_price']~~ ), |
  |  | 2367 | 'value'       => esc\_attr( tmem\_sanitize\_amount( $tmem\_event->data['addons\_price'] ) ), |
  | 2370 | 2368 | 'readonly'    => true, |
  | 2371 | 2369 | ) |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2414) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2412) |  |
  | 2414 | 2412 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2415 | 2413 | \* @param   int $event\_id           The event ID. |
  | 2416 |  | ~~\* @return  str~~ |
  | 2417 | 2414 | \*/ |
  | 2418 | 2415 | function tmem\_event\_overview\_metabox\_event\_discount\_deposit\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2496) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2493) |  |
  | 2496 | 2493 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2497 | 2494 | \* @param   int $event\_id           The event ID. |
  | 2498 |  | ~~\* @return  str~~ |
  | 2499 | 2495 | \*/ |
  | 2500 | 2496 | function tmem\_event\_overview\_metabox\_event\_price\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2539) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2535) |  |
  | 2539 | 2535 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2540 | 2536 | \* @param   int $event\_id           The event ID. |
  | 2541 |  | ~~\* @return  str~~ |
  | 2542 | 2537 | \*/ |
  | 2543 | 2538 | function tmem\_event\_metabox\_admin\_enquiry\_source\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2570) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2565) |  |
  | 2570 | 2565 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2571 | 2566 | \* @param   int $event\_id           The event ID. |
  | 2572 |  | ~~\* @return  str~~ |
  | 2573 | 2567 | \*/ |
  | 2574 | 2568 | function tmem\_event\_metabox\_admin\_employee\_notes\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2581) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2575) |  |
  | 2581 | 2575 | echo TMEM()->html->textarea( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 2582 | 2576 | array( |
  |  | 2577 | /\* translators: %s artiste \*/ |
  | 2583 | 2578 | 'label'       => sprintf( esc\_html\_\_( '%s Notes:', 'mobile-events-manager' ), esc\_html( tmem\_get\_option( 'artist' ) ) ), |
  | 2584 | 2579 | 'name'        => '\_tmem\_event\_dj\_notes', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2636) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2631) |  |
  | 2636 | 2631 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2637 | 2632 | \* @param   int $event\_id           The event ID. |
  | 2638 |  | ~~\* @return  str~~ |
  | 2639 | 2633 | \*/ |
  | 2640 | 2634 | function tmem\_event\_metabox\_txn\_list\_table( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2658) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2652) |  |
  | 2658 | 2652 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2659 | 2653 | \* @param   int $event\_id           The event ID. |
  | 2660 |  | ~~\* @return  str~~ |
  | 2661 | 2654 | \*/ |
  | 2662 | 2655 | function tmem\_event\_metabox\_txn\_add\_new\_row( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2807) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2800) |  |
  | 2807 | 2800 | \* @global  bool    $tmem\_event\_update  True if this event is being updated, false if new. |
  | 2808 | 2801 | \* @param   int $event\_id           The event ID. |
  | 2809 |  | ~~\* @return  str~~ |
  | 2810 | 2802 | \*/ |
  | 2811 | 2803 | function tmem\_event\_metabox\_history\_journal\_table( $event\_id ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2833) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2825) |  |
  | 2833 | 2825 | <?php foreach ( $journals as $journal ) : ?> |
  | 2834 | 2826 | <tr> |
  | 2835 |  | <td><a href="<?php echo esc\_url( get\_edit\_comment\_link( $journal->comment\_ID ) ); ?>"><?php echo esc\_html( date( tmem\_get\_option( 'time\_format' ) . ' ' . tmem\_get\_option( 'short\_date\_format' ), strtotime( $journal->comment\_date ) ) ); ?></a></td> |
  |  | 2827 | <td><a href="<?php echo esc\_url( get\_edit\_comment\_link( $journal->comment\_ID ) ); ?>"><?php echo esc\_html( gmdate( tmem\_get\_option( 'time\_format' ) . ' ' . tmem\_get\_option( 'short\_date\_format' ), strtotime( $journal->comment\_date ) ) ); ?></a></td> |
  | 2836 | 2828 | <td><?php echo substr( $journal->comment\_content, 0, 250 ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?></td> |
  | 2837 | 2829 | </tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2846) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2838) |  |
  | 2846 | 2838 | <?php else : ?> |
  | 2847 | 2839 | <tr> |
  |  | 2840 | <?php /\* translators: %s Event \*/ ?> |
  | 2848 | 2841 | <td colspan="2"><?php printf( esc\_html\_\_( 'There are no journal entries associated with this %s', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular( true ) ) ); ?></td> |
  | 2849 | 2842 | </tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2855) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2848) |  |
  | 2855 | 2848 | <tfoot> |
  | 2856 | 2849 | <tr> |
  |  | 2850 | <?php /\* translators: %s Journal \*/ ?> |
  | 2857 | 2851 | <td colspan="2"><span class="description">(<?php printf( \_\_( 'Displaying the most recent %1$d entries of <a href="%2$s">%3$d total', 'mobile-events-manager' ), ( $count >= 3 ) ? 3 : $count, add\_query\_arg( array( 'p' => $event\_id ), admin\_url( 'edit-comments.php?p=5636' ) ), $count ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>)</span></td> |
  | 2858 | 2852 | </tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2903) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2897) |  |
  | 2903 | 2897 | <?php foreach ( $emails as $email ) : ?> |
  | 2904 | 2898 | <tr> |
  | 2905 |  | <td><?php echo esc\_html( date( tmem\_get\_option( 'time\_format' ) . ' ' . tmem\_get\_option( 'short\_date\_format' ), strtotime( $email->post\_date ) ) ); ?></td> |
  |  | 2899 | <td><?php echo esc\_html( gmdate( tmem\_get\_option( 'time\_format' ) . ' ' . tmem\_get\_option( 'short\_date\_format' ), strtotime( $email->post\_date ) ) ); ?></td> |
  | 2906 | 2900 | <td><a href="<?php echo esc\_url( get\_edit\_post\_link( $email->ID ) ); ?>"><?php echo esc\_html( get\_the\_title( $email->ID ) ); ?></a></td> |
  | 2907 | 2901 | <td> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2909) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2903) |  |
  | 2909 | 2903 | echo esc\_html( get\_post\_status\_object( $email->post\_status )->label ); |
  | 2910 | 2904 |  |
  | 2911 |  | if ( ! empty( $email->post\_modified ) && 'opened' == $email->post\_status ) : |
  |  | 2905 | if ( ! empty( $email->post\_modified ) && 'opened' === $email->post\_status ) : |
  | 2912 | 2906 | ?> |
  | 2913 | 2907 | <?php echo '<br />'; ?> |
  | 2914 |  | <span class="description"><?php echo esc\_html( date( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $email->post\_modified ) ) ); ?></span> |
  |  | 2908 | <span class="description"><?php echo esc\_html( gmdate( tmem\_get\_option( 'time\_format', 'H:i' ) . ' ' . tmem\_get\_option( 'short\_date\_format', 'd/m/Y' ), strtotime( $email->post\_modified ) ) ); ?></span> |
  | 2915 | 2909 | <?php endif; ?></td> |
  | 2916 | 2910 | </tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2925) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2919) |  |
  | 2925 | 2919 | <?php else : ?> |
  | 2926 | 2920 | <tr> |
  |  | 2921 | <?php /\* translators: %s Event \*/ ?> |
  | 2927 | 2922 | <td colspan="3"><?php printf( esc\_html\_\_( 'There are no emails associated with this %s', 'mobile-events-manager' ), esc\_html( tmem\_get\_label\_singular( true ) ) ); ?></td> |
  | 2928 | 2923 | </tr> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2625441#L2934) | […](/browser/mobile-events-manager/trunk/includes/admin/events/metaboxes.php?rev=2647987#L2929) |  |
  | 2934 | 2929 | <tfoot> |
  | 2935 | 2930 | <tr> |
  |  | 2931 | <?php /\* translators: %1 %2 Event Details \*/ ?> |
  | 2936 | 2932 | <td colspan="3"><span class="description">(<?php printf( esc\_html\_\_( 'Displaying the most recent %1$d emails of %2$d total', 'mobile-events-manager' ), ( $count >= 3 ) ? 3 : esc\_html( $count ), esc\_html( $count ) ); ?>)</span></td> |
  | 2937 | 2933 | </tr> |
* ## [mobile-events-manager/trunk/includes/admin/events/playlist-page.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/events/playlist-page.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/events/playlist-page.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/events/playlist-page.php?rev=2576138#L152 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/events/playlist-page.php?rev=2647987#L152 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 152 | 152 |  |
  | 153 | 153 | $i = 0; |
  | 154 |  |  |
  | 155 |  | $output ~~= '<h1>' . '<u>' .~~  \_\_( 'Event Details for ', 'mobile-events-manager' ) . tmem\_content\_tag\_event\_name( $tmem\_event->ID ) . '</u>' . '</h1>'; |
  | 156 |  |  |
  | 157 |  | // Show Core Details about the event |
  | 158 |  |  |
  |  | 154 |  |
  |  | 155 | $output = '<h1>' . '<u>' . \_\_( 'Event Details for ', 'mobile-events-manager' ) . tmem\_content\_tag\_event\_name( $tmem\_event->ID ) . '</u>' . '</h1>'; |
  |  | 156 |  |
  |  | 157 | // Show Core Details about the event |
  |  | 158 |  |
  | 159 | 159 | $output .= '<div id="h2">' . \_\_( 'Core Details', 'mobile-events-manager' ) . '</div>'; |
  | 160 |  |  |
  |  | 160 |  |
  | 161 | 161 | $output .= '<p><b>' . \_\_( 'Client Name', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_client\_display\_name( $tmem\_event->client ) . '<br />' . '</p>'; |
  | 162 |  |  |
  |  | 162 |  |
  | 163 | 163 | $output .= '<p><b>' . \_\_( 'Client Phone Number', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_client\_phone( $tmem\_event->client ) . '<br />' . '</p>'; |
  | 164 |  |  |
  |  | 164 |  |
  | 165 | 165 | $output .= '<p><b>' . \_\_( 'Event Date', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_event\_long\_date( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 166 |  |  |
  |  | 166 |  |
  | 167 | 167 | $output .= '<p><b>' . \_\_( 'Event Type', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_event\_type( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 168 |  |  |
  | 169 |  | $output .= '<p><b>' . \_\_( 'Event Timings', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_start\_time( $tmem\_event->ID ) . ' - ' .tmem\_content\_tag\_end\_time( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 170 |  |  |
  |  | 168 |  |
  |  | 169 | $output .= '<p><b>' . \_\_( 'Event Timings', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_start\_time( $tmem\_event->ID ) . ' - ' . tmem\_content\_tag\_end\_time( $tmem\_event->ID ) . '<br />' . '</p>'; |
  |  | 170 |  |
  | 171 | 171 | $output .= '<p><b>' . \_\_( 'Notes for the Artiste', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_dj\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 172 |  |  |
  |  | 172 |  |
  | 173 | 173 | $output .= '<p><b>' . \_\_( 'Client Notes', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_client\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 174 |  |  |
  | 175 |  | // Shows the Venue Details |
  | 176 |  |  |
  |  | 174 |  |
  |  | 175 | // Shows the Venue Details |
  |  | 176 |  |
  | 177 | 177 | $output .= '<div id="h2">' . \_\_( 'Venue Details', 'mobile-events-manager' ) . '</div>'; |
  | 178 |  |  |
  |  | 178 |  |
  | 179 | 179 | $output .= '<p><b>' . \_\_( 'Venue Name', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_venue( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 180 |  |  |
  |  | 180 |  |
  | 181 | 181 | $output .= '<p><b>' . \_\_( 'Venue Address', 'mobile-events-manager' ) . ': ' . '</b><br />' . tmem\_content\_tag\_venue\_full\_address( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 182 |  |  |
  |  | 182 |  |
  | 183 | 183 | $output .= '<p><b>' . \_\_( 'Venue Details', 'mobile-events-manager' ) . ': ' . '</b><br />' . tmem\_content\_tag\_venue\_details( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 184 |  |  |
  |  | 184 |  |
  | 185 | 185 | $output .= '<p><b>' . \_\_( 'Venue Notes', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_venue\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 186 |  |  |
  | 187 |  | // Shows the Packages and Addons |
  | 188 |  |  |
  |  | 186 |  |
  |  | 187 | // Shows the Packages and Addons |
  |  | 188 |  |
  | 189 | 189 | $output .= '<div id="h2">' . \_\_( 'Packages & Add-Ons', 'mobile-events-manager' ) . '</div>'; |
  | 190 |  |  |
  | 191 |  | $output .= '<p><div id="h3">' . \_\_('Package selected', 'mobile-events-manager' ) . '</div></p>'; |
  | 192 |  |  |
  | 193 |  | $output .= '<p>' . tmem\_content\_tag\_event\_package( $tmem\_event->ID ) . '</p>'; |
  | 194 |  |  |
  | 195 |  | $output .= '<p><div id="h3">' . \_\_('Add-ons Selected', 'mobile-events-manager' ) . '</div></p>'; |
  | 196 |  |  |
  | 197 |  | $output .= '<p>' . tmem\_content\_tag\_event\_addons( $tmem\_event->ID ) . '</p>'; |
  | 198 |  |  |
  | 199 |  | // Shows the Playlist |
  | 200 |  |  |
  |  | 190 |  |
  |  | 191 | $output .= '<p><div id="h3">' . \_\_( 'Package selected', 'mobile-events-manager' ) . '</div></p>'; |
  |  | 192 |  |
  |  | 193 | $output .= '<p>' . tmem\_content\_tag\_event\_package( $tmem\_event->ID ) . '</p>'; |
  |  | 194 |  |
  |  | 195 | $output .= '<p><div id="h3">' . \_\_( 'Add-ons Selected', 'mobile-events-manager' ) . '</div></p>'; |
  |  | 196 |  |
  |  | 197 | $output .= '<p>' . tmem\_content\_tag\_event\_addons( $tmem\_event->ID ) . '</p>'; |
  |  | 198 |  |
  |  | 199 | // Shows the Playlist |
  |  | 200 |  |
  | 201 | 201 | $output .= '<div id="h2">' . \_\_( 'Playlist', 'mobile-events-manager' ) . '</div>'; |
  | 202 |  | $output .= '<p>' .\_\_( 'Songs in Playlist', 'mobile-events-manager' ) . ': ' . count( $results ) . '<br />' . "\n" . '</p>'; |
  | 203 |  |  |
  |  | 202 | $output .= '<p>' . \_\_( 'Songs in Playlist', 'mobile-events-manager' ) . ': ' . count( $results ) . '<br />' . "\n" . '</p>'; |
  |  | 203 |  |
  | 204 | 204 | $headers = '<tr style="height: 30px">' . "\n" . |
  | 205 | 205 | '<td style="width: 15%"><strong>' . \_\_( 'Song', 'mobile-events-manager' ) . '</strong></td>' . "\n" . |
  | […](/browser/mobile-events-manager/trunk/includes/admin/events/playlist-page.php?rev=2576138#L245) | […](/browser/mobile-events-manager/trunk/includes/admin/events/playlist-page.php?rev=2647987#L245) |  |
  | 245 | 245 |  |
  | 246 | 246 | } else { |
  | 247 |  | $output ~~= '<h1>' . '<u>' .~~  \_\_( 'Event Details for ', 'mobile-events-manager' ) . tmem\_content\_tag\_event\_name( $tmem\_event->ID ) . '</u>' . '</h1>'; |
  | 248 |  |  |
  | 249 |  | // Copyright Jack Mawhinney & Dan Porter |
  | 250 |  |  |
  |  | 247 | $output = '<h1>' . '<u>' . \_\_( 'Event Details for ', 'mobile-events-manager' ) . tmem\_content\_tag\_event\_name( $tmem\_event->ID ) . '</u>' . '</h1>'; |
  |  | 248 |  |
  |  | 249 | // Copyright Jack Mawhinney & Dan Porter |
  |  | 250 |  |
  | 251 | 251 | $output .= '<div id="h2">' . \_\_( 'Core Details', 'mobile-events-manager' ) . '</div>'; |
  | 252 |  |  |
  |  | 252 |  |
  | 253 | 253 | $output .= '<p><b>' . \_\_( 'Client Name', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_client\_display\_name( $tmem\_event->client ) . '<br />' . '</p>'; |
  | 254 |  |  |
  |  | 254 |  |
  | 255 | 255 | $output .= '<p><b>' . \_\_( 'Client Phone Number', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_client\_phone( $tmem\_event->client ) . '<br />' . '</p>'; |
  | 256 |  |  |
  |  | 256 |  |
  | 257 | 257 | $output .= '<p><b>' . \_\_( 'Event Date', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_event\_long\_date( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 258 |  |  |
  |  | 258 |  |
  | 259 | 259 | $output .= '<p><b>' . \_\_( 'Event Type', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_get\_event\_type( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 260 |  |  |
  | 261 |  | $output .= '<p><b>' . \_\_( 'Event Timings', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_start\_time( $tmem\_event->ID ) . ' - ' .tmem\_content\_tag\_end\_time( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 262 |  |  |
  |  | 260 |  |
  |  | 261 | $output .= '<p><b>' . \_\_( 'Event Timings', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_start\_time( $tmem\_event->ID ) . ' - ' . tmem\_content\_tag\_end\_time( $tmem\_event->ID ) . '<br />' . '</p>'; |
  |  | 262 |  |
  | 263 | 263 | $output .= '<p><b>' . \_\_( 'Notes for the Artiste', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_dj\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 264 |  |  |
  |  | 264 |  |
  | 265 | 265 | $output .= '<p><b>' . \_\_( 'Client Notes', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_client\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 266 |  |  |
  | 267 |  | // Shows the Venue Details. Copyright Jack Mawhinney & Dan Porter |
  | 268 |  |  |
  |  | 266 |  |
  |  | 267 | // Shows the Venue Details. Copyright Jack Mawhinney & Dan Porter |
  |  | 268 |  |
  | 269 | 269 | $output .= '<div id="h2">' . \_\_( 'Venue Details', 'mobile-events-manager' ) . '</div>'; |
  | 270 |  |  |
  |  | 270 |  |
  | 271 | 271 | $output .= '<p><b>' . \_\_( 'Venue Name', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_venue( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 272 |  |  |
  |  | 272 |  |
  | 273 | 273 | $output .= '<p><b>' . \_\_( 'Venue Address', 'mobile-events-manager' ) . ': ' . '</b><br />' . tmem\_content\_tag\_venue\_full\_address( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 274 |  |  |
  |  | 274 |  |
  | 275 | 275 | $output .= '<p><b>' . \_\_( 'Venue Details', 'mobile-events-manager' ) . ': ' . '</b><br />' . tmem\_content\_tag\_venue\_details( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 276 |  |  |
  |  | 276 |  |
  | 277 | 277 | $output .= '<p><b>' . \_\_( 'Venue Notes', 'mobile-events-manager' ) . ': ' . '</b>' . tmem\_content\_tag\_venue\_notes( $tmem\_event->ID ) . '<br />' . '</p>'; |
  | 278 |  |  |
  | 279 |  | // Shows the Packages and Addons. Copyright Jack Mawhinney & Dan Porter |
  | 280 |  |  |
  |  | 278 |  |
  |  | 279 | // Shows the Packages and Addons. Copyright Jack Mawhinney & Dan Porter |
  |  | 280 |  |
  | 281 | 281 | $output .= '<div id="h2">' . \_\_( 'Packages & Add-Ons', 'mobile-events-manager' ) . '</div>'; |
  | 282 |  |  |
  | 283 |  | $output .= '<p><div id="h3">' . \_\_('Package selected', 'mobile-events-manager' ) . '</div></p>'; |
  | 284 |  |  |
  | 285 |  | $output .= '<p>' . tmem\_content\_tag\_event\_package( $tmem\_event->ID ) . '</p>'; |
  | 286 |  |  |
  | 287 |  | $output .= '<p><div id="h3">' . \_\_('Add-ons Selected', 'mobile-events-manager' ) . '</div></p>'; |
  | 288 |  |  |
  | 289 |  | $output .= '<p>' . tmem\_content\_tag\_event\_addons( $tmem\_event->ID ) . '</p>'; |
  | 290 |  |  |
  |  | 282 |  |
  |  | 283 | $output .= '<p><div id="h3">' . \_\_( 'Package selected', 'mobile-events-manager' ) . '</div></p>'; |
  |  | 284 |  |
  |  | 285 | $output .= '<p>' . tmem\_content\_tag\_event\_package( $tmem\_event->ID ) . '</p>'; |
  |  | 286 |  |
  |  | 287 | $output .= '<p><div id="h3">' . \_\_( 'Add-ons Selected', 'mobile-events-manager' ) . '</div></p>'; |
  |  | 288 |  |
  |  | 289 | $output .= '<p>' . tmem\_content\_tag\_event\_addons( $tmem\_event->ID ) . '</p>'; |
  |  | 290 |  |
  | 291 | 291 | $output .= '<div id="h2">' . \_\_( 'Playlist', 'mobile-events-manager' ) . '</div>'; |
  | 292 | 292 | $output .= '<p>' . \_\_( 'There aren&#39t any songs in the playlist :(', 'mobile-dj-manager' ) . '</p>' . "\n"; |
  | 293 |  |  |
  |  | 293 |  |
  | 294 | 294 | } |
  | 295 | 295 |  |
* ## [mobile-events-manager/trunk/includes/admin/extensions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/extensions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/extensions.php")

  | [r2487225](/browser/mobile-events-manager/trunk/includes/admin/extensions.php?rev=2487225#L17 "Show revision 2487225 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/extensions.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/menu.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/menu.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/menu.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2576138#L17 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2576138#L55) | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2647987#L55) |  |
  | 55 | 55 | $tmem\_comms\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Communications', 'mobile-events-manager' ), \_\_( 'Communications', 'mobile-events-manager' ), 'tmem\_employee', 'tmem-comms', 'tmem\_comms\_page' ); |
  | 56 | 56 |  |
  | 57 |  | $tmem\_comms\_history\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Communication History', 'mobile-events-manager' ), |
  | 58 |  | \_\_( 'Communication History', 'mobile-events-manager' ), 'tmem\_employee', 'edit.php?post\_type=tmem\_communication' ); |
  |  | 57 | $tmem\_comms\_history\_page = add\_submenu\_page( |
  |  | 58 | 'edit.php?post\_type=tmem-event', |
  |  | 59 | \_\_( 'Communication History', 'mobile-events-manager' ), |
  |  | 60 | \_\_( 'Communication History', 'mobile-events-manager' ), |
  |  | 61 | 'tmem\_employee', |
  |  | 62 | 'edit.php?post\_type=tmem\_communication' |
  |  | 63 | ); |
  | 59 | 64 | } |
  | 60 | 65 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2576138#L74) | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2647987#L79) |  |
  | 74 | 79 | if ( ( tmem\_get\_option( 'enable\_packages' ) ) && tmem\_employee\_can( 'manage\_packages' ) ) { |
  | 75 | 80 | $tmem\_packages\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Packages', 'mobile-events-manager' ), \_\_( 'Packages', 'mobile-events-manager' ), 'tmem\_package\_edit\_own', 'edit.php?post\_type=tmem-package', '' ); |
  | 76 |  | $tmem\_addons\_page   = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Addons', 'mobile-events-manager' ), |
  | 77 |  | \_\_( 'Addons', 'mobile-events-manager' ), 'tmem\_package\_edit\_own', 'edit.php?post\_type=tmem-addon', '' ); |
  |  | 81 | $tmem\_addons\_page   = add\_submenu\_page( |
  |  | 82 | 'edit.php?post\_type=tmem-event', |
  |  | 83 | \_\_( 'Addons', 'mobile-events-manager' ), |
  |  | 84 | \_\_( 'Addons', 'mobile-events-manager' ), |
  |  | 85 | 'tmem\_package\_edit\_own', |
  |  | 86 | 'edit.php?post\_type=tmem-addon', |
  |  | 87 | '' |
  |  | 88 | ); |
  | 78 | 89 | } |
  | 79 | 90 |  |
  | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2576138#L91) | […](/browser/mobile-events-manager/trunk/includes/admin/menu.php?rev=2647987#L102) |  |
  | 91 | 102 | $tmem\_custom\_client\_fields\_page = add\_submenu\_page( null, \_\_( 'Custom Client Fields', 'mobile-events-manager' ), \_\_( 'Custom Client Fields', 'mobile-events-manager' ), 'manage\_tmem', 'tmem-custom-client-fields', 'tmem\_custom\_client\_fields\_page' ); |
  | 92 | 103 |  |
  | 93 |  | $tmem\_tools\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Tools', 'mobile-events-manager' ), \_\_( 'Tools', 'mobile-events-manager' ), 'tmem\_employee', 'tmem-tools', 'tmem\_tools\_page' ); |
  | 94 |  |  |
  |  | 104 | $tmem\_tools\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Tools', 'mobile-events-manager' ), \_\_( 'Tools', 'mobile-events-manager' ), 'tmem\_employee', 'tmem-tools', 'tmem\_tools\_page' ); |
  |  | 105 |  |
  | 95 | 106 | $tmem\_upgrades\_screen = add\_submenu\_page( null, \_\_( 'TMEM Upgrades', 'mobile-events-manager' ), \_\_( 'TMEM Upgrades', 'mobile-events-manager' ), 'tmem\_employee', 'tmem-upgrades', 'tmem\_upgrades\_screen' ); |
  | 96 |  |  |
  |  | 107 |  |
  | 97 | 108 | $tmem\_settings\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'Settings', 'mobile-events-manager' ), \_\_( '<strong><span style="color:#F90">Settings</span></strong>', 'mobile-events-manager' ), 'manage\_tmem', 'tmem-settings', 'tmem\_options\_page' ); |
  | 98 | 109 |  |
  | 99 | 110 | $tmem\_extensions\_page = add\_submenu\_page( 'edit.php?post\_type=tmem-event', \_\_( 'TMEM Extensions', 'mobile-events-manager' ), \_\_( '<strong><span style="color:#F90">Extensions</span></strong>', 'mobile-events-manager' ), 'tmem\_employee', 'tmem-addons', 'tmem\_extensions\_page' ); |
  | 100 |  |  |
  | 101 | 111 |  |
  | 102 | 112 | } // tmem\_admin\_menu |
* ## [mobile-events-manager/trunk/includes/admin/pages/client-fields.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/pages/client-fields.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/pages/client-fields.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/pages/client-fields.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/pages/client-fields.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-addons-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-clients-export.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-conversions-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-employees-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export-earnings.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php?rev=2455787#L21 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-export.php?rev=2647987#L21 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | \*/ |
  | 22 | 22 |  |
  | 23 |  | // Exit if accessed directly |
  |  | 23 | // Exit if accessed directly. |
  | 24 | 24 | if ( ! defined( 'ABSPATH' ) ) { |
  | 25 | 25 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php?rev=2455787#L21 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-graph.php?rev=2647987#L21 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | \*/ |
  | 22 | 22 |  |
  | 23 |  | // Exit if accessed directly |
  |  | 23 | // Exit if accessed directly. |
  | 24 | 24 | if ( ! defined( 'ABSPATH' ) ) { |
  | 25 | 25 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-packages-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-pie-graph.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-transaction-types-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/class-tmem-types-reports-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @since       1.0.4 |
  | 18 | 18 | \*/ |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-clients.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-employees.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-events.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export-txns.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/class-batch-export.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php?rev=2455787#L19 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/export/export-functions.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php")

  | [r2514025](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2514025#L18 "Show revision 2514025 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2514025#L735) | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2647987#L735) |  |
  | 735 | 735 | </select> |
  | 736 | 736 | <select id="tmem-graphs-year-start" name="year"> |
  | 737 |  | <?php for ( $i = date(~~'Y') -7; $i <= date('Y') +~~5; $i++ ) : ?> |
  |  | 737 | <?php for ( $i = date( 'Y' ) - 7; $i <= date( 'Y' ) + 5; $i++ ) : ?> |
  | 738 | 738 | <option value="<?php echo absint( $i ); ?>" <?php selected( $i, $dates['year'] ); ?>><?php echo esc\_html( $i ); ?></option> |
  | 739 | 739 | <?php endfor; ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2514025#L751) | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2647987#L751) |  |
  | 751 | 751 | </select> |
  | 752 | 752 | <select id="tmem-graphs-year-end" name="year\_end"> |
  | 753 |  | <?php for ( $i = date(~~'Y') -7; $i <= date( 'Y' ) +~~5; $i++ ) : ?> |
  |  | 753 | <?php for ( $i = date( 'Y' ) - 7; $i <= date( 'Y' ) + 5; $i++ ) : ?> |
  | 754 | 754 | <option value="<?php echo absint( $i ); ?>" <?php selected( $i, $dates['year\_end'] ); ?>><?php echo esc\_html( $i ); ?></option> |
  | 755 | 755 | <?php endfor; ?> |
  | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2514025#L944) | […](/browser/mobile-events-manager/trunk/includes/admin/reporting/graphing-functions.php?rev=2647987#L944) |  |
  | 944 | 944 | $dates['year\_end'] = date( 'Y', $current\_time ) - 1; |
  | 945 | 945 | break; |
  | 946 |  |  |
  |  | 946 |  |
  | 947 | 947 | case 'next\_year': |
  | 948 | 948 | $dates['m\_start']  = 1; |
* ## [mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/reporting/reporting-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/roles/roles-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/roles/roles-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/roles/roles-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/roles/roles-functions.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/roles/roles-functions.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/settings/contextual-help.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/settings/contextual-help.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/settings/contextual-help.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/settings/contextual-help.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/settings/contextual-help.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/settings/display-settings.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/settings/display-settings.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/settings/display-settings.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/settings/display-settings.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/settings/display-settings.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/settings/register-settings.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/settings/register-settings.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/settings/register-settings.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2576138#L16 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2576138#L964) | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987#L964) |  |
  | 964 | 964 | 'red'       => \_\_( 'Red', 'mobile-events-manager' ), |
  | 965 | 965 | 'turquoise' => \_\_( 'Turquoise', 'mobile-events-manager' ), |
  | 966 |  | 'yellow' => \_\_( 'Yellow', 'mobile-events-manager' ), |
  | 967 |  | 'black' => \_\_( 'Black', 'mobile-events-manager' ), |
  | 968 |  | 'white'=> \_\_( 'White', 'mobile-events-manager' ), |
  | 969 |  | 'purple'=> \_\_( 'Purple', 'mobile-events-manager' ), |
  | 970 |  | 'pink'=> \_\_( 'Pink', 'mobile-events-manager' ), |
  |  | 966 | 'yellow'    => \_\_( 'Yellow', 'mobile-events-manager' ), |
  |  | 967 | 'black'     => \_\_( 'Black', 'mobile-events-manager' ), |
  |  | 968 | 'white'     => \_\_( 'White', 'mobile-events-manager' ), |
  |  | 969 | 'purple'    => \_\_( 'Purple', 'mobile-events-manager' ), |
  |  | 970 | 'pink'      => \_\_( 'Pink', 'mobile-events-manager' ), |
  | 971 | 971 | 'lightgrey' => \_\_( 'Light Grey', 'mobile-events-manager' ), |
  | 972 |  | 'darkgrey'=> \_\_( 'Dark Grey', 'mobile-events-manager' ), |
  |  | 972 | 'darkgrey'  => \_\_( 'Dark Grey', 'mobile-events-manager' ), |
  | 973 | 973 | ), |
  | 974 | 974 | 'std'     => 'blue', |
  | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2576138#L1667) | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987#L1667) |  |
  | 1667 | 1667 | // Get the setting type (checkbox, select, etc) |
  | 1668 | 1668 | $type = isset( $settings[ $tab ][ $key ]['type'] ) ? $settings[ $tab ][ $key ]['type'] : false; |
  |  | 1669 | $field\_type = isset( $settings[ $tab ][ $section ][$key]['type'] ) ? $settings[ $tab ][ $section ][$key]['type'] : false; |
  | 1669 | 1670 |  |
  | 1670 | 1671 | if ( $type ) { |
  | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2576138#L1673) | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987#L1674) |  |
  | 1673 | 1674 | } |
  | 1674 | 1675 |  |
  |  | 1676 | if( "text" === $field\_type){ |
  |  | 1677 | // if field type is text |
  |  | 1678 | $input[ $key ] = apply\_filters( 'tmem\_settings\_sanitize\_text', $value, $key ); |
  |  | 1679 | } |
  |  | 1680 |  |
  | 1675 | 1681 | // General filter |
  | 1676 | 1682 | $input[ $key ] = apply\_filters( 'tmem\_settings\_sanitize', $input[ $key ], $key ); |
  | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2576138#L1713) | […](/browser/mobile-events-manager/trunk/includes/admin/settings/register-settings.php?rev=2647987#L1719) |  |
  | 1713 | 1719 | \*/ |
  | 1714 | 1720 | function tmem\_sanitize\_text\_field( $input ) { |
  | 1715 |  | return ~~trim( $input~~ ); |
  |  | 1721 | return sanitize\_text\_field( trim( $input ) ); |
  | 1716 | 1722 | } // tmem\_sanitize\_text\_field |
  | 1717 | 1723 | add\_filter( 'tmem\_settings\_sanitize\_text', 'tmem\_sanitize\_text\_field' ); |
* ## [mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php?rev=2455787#L17 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/tasks/class-tmem-tasks-table.php?rev=2647987#L17 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 |  | // Exit if accessed directly |
  |  | 19 | // Exit if accessed directly. |
  | 20 | 20 | if ( ! defined( 'ABSPATH' ) ) { |
  | 21 | 21 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/tasks/task-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/tasks/task-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/tasks/task-actions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/tasks/task-actions.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/tasks/task-actions.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/tasks/tasks-page.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/templates/contextual-help.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/templates/contextual-help.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/templates/contextual-help.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/templates/contextual-help.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/templates/contextual-help.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/templates/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/templates/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/templates/metaboxes.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/templates/metaboxes.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/templates/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/tools.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/tools.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/tools.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2576138#L19 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2576138#L283) | […](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2647987#L283) |  |
  | 283 | 283 | $auto\_payment\_template   = tmem\_get\_option( 'payment\_cfm\_template', '' ); |
  | 284 | 284 | $manual\_payment\_template = tmem\_get\_option( 'manual\_payment\_cfm\_template', '' ); |
  | 285 |  | $email\_invoice\_template = tmem\_get\_option( 'email\_invoice', '' ); |
  |  | 285 | $email\_invoice\_template  = tmem\_get\_option( 'email\_invoice', '' ); |
  | 286 | 286 |  |
  | 287 | 287 | $return .= "\n" . '-- TMEM Email Templates' . "\n\n"; |
  | […](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2576138#L294) | […](/browser/mobile-events-manager/trunk/includes/admin/tools.php?rev=2647987#L294) |  |
  | 294 | 294 | $return .= 'Manual Payment:           ' . ( ! empty( $manual\_payment\_template ) ? get\_the\_title( $manual\_payment\_template ) . ' (' . $manual\_payment\_template . ')' . "\n" : "Unset\n" ); |
  | 295 | 295 | $return .= 'Email Invoice:           ' . ( ! empty( $email\_invoice\_template ) ? get\_the\_title( $email\_invoice\_template ) . ' (' . $email\_invoice\_template . ')' . "\n" : "Unset\n" ); |
  | 296 |  |  |
  |  | 296 |  |
  | 297 | 297 | $return = apply\_filters( 'tmem\_sysinfo\_after\_tmem\_pages', $return ); |
  | 298 | 298 |  |
* ## [mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/transactions/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrade-functions.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/upgrades/upgrades.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/users/employee-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/users/employee-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/users/employee-actions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/users/employee-actions.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/users/employee-actions.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/venues/metaboxes.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/venues/metaboxes.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/venues/metaboxes.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/admin/venues/metaboxes.php?rev=2455787#L16 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/venues/metaboxes.php?rev=2647987#L16 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \*/ |
  | 17 | 17 |  |
  | 18 |  | // Exit if accessed directly |
  |  | 18 | // Exit if accessed directly. |
  | 19 | 19 | if ( ! defined( 'ABSPATH' ) ) { |
  | 20 | 20 | exit; |
* ## [mobile-events-manager/trunk/includes/admin/welcome.php](/changeset/2647987/mobile-events-manager/trunk/includes/admin/welcome.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/admin/welcome.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/admin/welcome.php?rev=2576138#L18 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/admin/welcome.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/ajax-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/ajax-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/ajax-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/ajax-functions.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/ajax-functions.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/api/class-tmem-api.php](/changeset/2647987/mobile-events-manager/trunk/includes/api/class-tmem-api.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/api/class-tmem-api.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/api/class-tmem-api.php?rev=2455787#L23 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/api/class-tmem-api.php?rev=2647987#L23 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 23 | 23 | \*/ |
  | 24 | 24 |  |
  | 25 |  | // Exit if accessed directly |
  |  | 25 | // Exit if accessed directly. |
  | 26 | 26 | if ( ! defined( 'ABSPATH' ) ) { |
  | 27 | 27 | exit; |
* ## [mobile-events-manager/trunk/includes/availability/availability-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/availability/availability-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/availability/availability-actions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/availability/availability-actions.php?rev=2455787#L15 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/availability/availability-actions.php?rev=2647987#L15 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
* ## [mobile-events-manager/trunk/includes/availability/availability-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/availability/availability-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/availability/availability-functions.php")

  | [r2625441](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2625441#L15 "Show revision 2625441 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2647987#L15 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2625441#L348) | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2647987#L348) |  |
  | 348 | 348 | \* Retrieve all absences for an employee. |
  | 349 | 349 | \* |
  | 350 |  | \* @since1.5.7 |
  | 351 |  | \* @param~~int     $employee\_id~~ WP User ID |
  | 352 |  | \* @return~~array~~Array of employee absence objects |
  | 353 |  | \*/ |
  | 354 |  | function tmem\_get\_employee\_absences( $employee\_id ){ |
  |  | 350 | \* @since   1.5.7 |
  |  | 351 | \* @param   int $employee\_id    WP User ID |
  |  | 352 | \* @return  array   Array of employee absence objects |
  |  | 353 | \*/ |
  |  | 354 | function tmem\_get\_employee\_absences( $employee\_id ) { |
  | 355 | 355 | $employee\_id = absint( $employee\_id ); |
  | 356 | 356 |  |
  | 357 |  | if ( empty( $employee\_id ) ){ |
  |  | 357 | if ( empty( $employee\_id ) ) { |
  | 358 | 358 | return false; |
  | 359 | 359 | } |
  | 360 | 360 |  |
  | 361 |  | $absences = TMEM()->availability\_db->get\_entries( array( |
  | 362 |  | 'number'       => -1, |
  | 363 |  | 'employee\_id'  => $employee\_id |
  | 364 |  | ) ); |
  | 365 |  |  |
  | 366 |  | return $absences; |
  |  | 361 | $absences = TMEM()->availability\_db->get\_entries( |
  |  | 362 | array( |
  |  | 363 | 'number'      => -1, |
  |  | 364 | 'employee\_id' => $employee\_id, |
  |  | 365 | ) |
  |  | 366 | ); |
  |  | 367 |  |
  |  | 368 | return $absences; |
  | 367 | 369 | } // tmem\_get\_employee\_absences |
  | 368 | 370 |  |
  | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2625441#L454) | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2647987#L456) |  |
  | 454 | 456 | $newline = "\n"; |
  | 455 | 457 |  |
  | 456 |  | $default  = sprintf( \_\_( 'Status: %s'~~, 'mobile-events-manager' ), '{event\_status}'~~) . $newline; |
  |  | 458 | $default  = sprintf( \_\_( 'Status: %s', 'mobile-events-manager' ), '{event\_status}' ) . $newline; |
  | 457 | 459 | $default .= sprintf( \_\_( '<br/> Date: %s', 'mobile-events-manager' ), '{event\_date}' ) . $newline; |
  | 458 | 460 | $default .= sprintf( \_\_( '<br/> Start: %s', 'mobile-events-manager' ), '{start\_time}' ) . $newline; |
  | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2625441#L464) | […](/browser/mobile-events-manager/trunk/includes/availability/availability-functions.php?rev=2647987#L466) |  |
  | 464 | 466 | // $text = tmem\_get\_event\_tip\_content(); |
  | 465 | 467 | $text = ! empty( $text ) ? $text : $default; |
  | 466 |  | //$text = utf8\_encode( str\_replace( PHP\_EOL, '<br>', $text ) ); |
  |  | 468 | // $text = utf8\_encode( str\_replace( PHP\_EOL, '<br>', $text ) ); |
  | 467 | 469 | $text = utf8\_encode( str\_replace( '<br>', PHP\_EOL, $text ) ); |
  | 468 | 470 |  |
* ## [mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php](/changeset/2647987/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php")

  | [r2625441](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L18 "Show revision 2625441 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L355) | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L355) |  |
  | 355 | 355 | 'finish' => $tmem\_event->get\_finish\_time(), |
  | 356 | 356 | 'start'  => $tmem\_event->get\_start\_time(), |
  | 357 |  | 'status' => $tmem\_event->get\_status()~~."test"~~, |
  |  | 357 | 'status' => $tmem\_event->get\_status() . 'test', |
  | 358 | 358 | 'role'   => $data['role'], |
  | 359 | 359 | ); |
  | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L419) | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L419) |  |
  | 419 | 419 | $absence |
  | 420 | 420 | ); |
  | 421 |  | if ( ! empty( $employee ) ){ |
  |  | 421 | if ( ! empty( $employee ) ) { |
  | 422 | 422 | $title = sprintf( '%s: %s', \_\_( 'Absence', 'mobile-events-manager' ), $employee ); |
  | 423 | 423 | } |
  | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L447) | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L447) |  |
  | 447 | 447 | } |
  | 448 | 448 |  |
  | 449 |  |  |
  | 450 | 449 | $description[] = sprintf( \_\_( 'From: %s', 'mobile-events-manager' ), $from ); |
  | 451 | 450 | $description[] = sprintf( \_\_( '<br/> To: %s', 'mobile-events-manager' ), $to ); |
  | 452 | 451 |  |
  | 453 |  | if ( ! empty( $absence->notes ) ){ |
  |  | 452 | if ( ! empty( $absence->notes ) ) { |
  | 454 | 453 | $description[] = stripslashes( $absence->notes ); |
  | 455 | 454 | } |
  | 456 | 455 |  |
  | 457 |  | $notes  = '<p>' . implode( '<br>', $description ) . '</p>'; |
  | 458 |  |  |
  | 459 |  | if ( tmem\_employee\_can( 'manage\_employees' ) )  { |
  | 460 |  | $notes .= sprintf( |
  | 461 |  | '<p><a class="tmem-delete availability-link delete-absence" id="%d" href="#" >%s</a></p>', |
  | 462 |  | $absence->id, |
  | 463 |  | \_\_( 'Delete entry', 'mobile-events-manager' ) |
  | 464 |  | ); |
  | 465 |  | } |
  | 466 |  |  |
  |  | 456 | $notes = '<p>' . implode( '<br>', $description ) . '</p>'; |
  |  | 457 |  |
  |  | 458 | if ( tmem\_employee\_can( 'manage\_employees' ) ) { |
  |  | 459 | $notes .= sprintf( |
  |  | 460 | '<p><a class="tmem-delete availability-link delete-absence" id="%d" href="#" >%s</a></p>', |
  |  | 461 | $absence->id, |
  |  | 462 | \_\_( 'Delete entry', 'mobile-events-manager' ) |
  |  | 463 | ); |
  |  | 464 | } |
  | 467 | 465 |  |
  | 468 | 466 | $this->results[] = array( |
  | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L524) | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L522) |  |
  | 524 | 522 | // $actions      = array(); |
  | 525 | 523 | // $event\_url    = add\_query\_arg( |
  | 526 |  | // array( |
  | 527 |  | // 'post'   => $tmem\_event->ID, |
  | 528 |  | // 'action' => 'edit', |
  | 529 |  | // ), |
  | 530 |  | // admin\_url( 'post.php' ) |
  |  | 524 | // array( |
  |  | 525 | // 'post'   => $tmem\_event->ID, |
  |  | 526 | // 'action' => 'edit', |
  |  | 527 | // ), |
  |  | 528 | // admin\_url( 'post.php' ) |
  | 531 | 529 | // ); |
  | 532 | 530 |  |
  | 533 | 531 | // $title = tmem\_do\_content\_tags( |
  | 534 |  | // tmem\_get\_calendar\_event\_title(), |
  | 535 |  | // $tmem\_event->ID, |
  | 536 |  | // $tmem\_event->client |
  |  | 532 | // tmem\_get\_calendar\_event\_title(), |
  |  | 533 | // $tmem\_event->ID, |
  |  | 534 | // $tmem\_event->client |
  | 537 | 535 | // ); |
  | 538 | 536 |  |
  | 539 | 537 | // $tip\_title = tmem\_do\_content\_tags( |
  | 540 |  | // tmem\_get\_calendar\_event\_tip\_title(), |
  | 541 |  | // $tmem\_event->ID, |
  | 542 |  | // $tmem\_event->client |
  |  | 538 | // tmem\_get\_calendar\_event\_tip\_title(), |
  |  | 539 | // $tmem\_event->ID, |
  |  | 540 | // $tmem\_event->client |
  | 543 | 541 | // ); |
  | 544 | 542 |  |
  | 545 |  | // $tip\_title    = sprintf( |
  | 546 |  | ~~//~~  '%s %s - %s', |
  | 547 |  | ~~//~~  esc\_html( tmem\_get\_label\_singular() ), |
  | 548 |  | ~~//~~  $event->ID, |
  | 549 |  | ~~//~~  esc\_attr( $event\_type ) |
  | 550 |  | ~~//~~  ); |
  |  | 543 | // $tip\_title    = sprintf( |
  |  | 544 | // '%s %s - %s', |
  |  | 545 | // esc\_html( tmem\_get\_label\_singular() ), |
  |  | 546 | // $event->ID, |
  |  | 547 | // esc\_attr( $event\_type ) |
  |  | 548 | // ); |
  | 551 | 549 |  |
  | 552 | 550 | // $notes = '<p>' . str\_replace( PHP\_EOL, '<br>', tmem\_get\_calendar\_event\_tip\_content() ) . '<p>'; |
  | 553 | 551 | // $notes = tmem\_do\_content\_tags( |
  | 554 |  | // $notes, |
  | 555 |  | // $tmem\_event->ID, |
  | 556 |  | // $tmem\_event->client |
  |  | 552 | // $notes, |
  |  | 553 | // $tmem\_event->ID, |
  |  | 554 | // $tmem\_event->client |
  | 557 | 555 | // ); |
  | 558 | 556 |  |
  | 559 | 557 | // $actions[] = sprintf( |
  | 560 |  | // '<a class="availability-link" href="%s" >%s</a>', |
  | 561 |  | // $event\_url, |
  | 562 |  | // sprintf( \_\_( 'View %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) |
  |  | 558 | // '<a class="availability-link" href="%s" >%s</a>', |
  |  | 559 | // $event\_url, |
  |  | 560 | // sprintf( \_\_( 'View %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) |
  | 563 | 561 | // ); |
  | 564 | 562 |  |
  | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2625441#L566) | […](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-availability-checker.php?rev=2647987#L564) |  |
  | 566 | 564 |  |
  | 567 | 565 | // if ( ! empty( $actions ) ) { |
  | 568 |  | // $notes .= '<p>' . implode( '&nbsp;&#124;&nbsp;', $actions ) . '</p>'; |
  |  | 566 | // $notes .= '<p>' . implode( '&nbsp;&#124;&nbsp;', $actions ) . '</p>'; |
  | 569 | 567 | // } |
  | 570 | 568 | // global $tmem\_options; |
  | 571 | 569 | // $this->results[] = array( |
  | 572 |  | // 'allDay'          => false, |
  | 573 |  | // 'backgroundColor' => tmem\_get\_calendar\_color( 'background', true ), |
  | 574 |  | // 'borderColor'     => tmem\_get\_calendar\_color( 'border', true ), |
  | 575 |  | // 'className'       => 'tmem\_calendar\_event', |
  | 576 |  | // 'end'             => $tmem\_event->get\_finish\_date() . ' ' . $tmem\_event->get\_finish\_time(), |
  | 577 |  | // 'id'              => $tmem\_event->ID, |
  | 578 |  | // 'notes'           => $notes, |
  | 579 |  | // 'start'           => $tmem\_event->date . ' ' . $tmem\_event->get\_start\_time(), |
  | 580 |  | // 'textColor'       => tmem\_get\_calendar\_color( 'text', true ), |
  | 581 |  | // 'tipTitle'        => $tip\_title, |
  | 582 |  | // 'title'           => $title, |
  | 583 |  | // 'tmem\_options'    => $tmem\_options, |
  | 584 |  | // 'event\_statuses'  => $event\_statuses |
  |  | 570 | // 'allDay'          => false, |
  |  | 571 | // 'backgroundColor' => tmem\_get\_calendar\_color( 'background', true ), |
  |  | 572 | // 'borderColor'     => tmem\_get\_calendar\_color( 'border', true ), |
  |  | 573 | // 'className'       => 'tmem\_calendar\_event', |
  |  | 574 | // 'end'             => $tmem\_event->get\_finish\_date() . ' ' . $tmem\_event->get\_finish\_time(), |
  |  | 575 | // 'id'              => $tmem\_event->ID, |
  |  | 576 | // 'notes'           => $notes, |
  |  | 577 | // 'start'           => $tmem\_event->date . ' ' . $tmem\_event->get\_start\_time(), |
  |  | 578 | // 'textColor'       => tmem\_get\_calendar\_color( 'text', true ), |
  |  | 579 | // 'tipTitle'        => $tip\_title, |
  |  | 580 | // 'title'           => $title, |
  |  | 581 | // 'tmem\_options'    => $tmem\_options, |
  |  | 582 | // 'event\_statuses'  => $event\_statuses |
  | 585 | 583 | // ); |
  | 586 | 584 | $popover      = 'top'; |
  | 587 |  | $tmem\_event   = new TMEM\_Event( $event->ID ); |
  | 588 |  | $event\_type   = $tmem\_event->get\_type(); |
  | 589 |  | $event\_status = $tmem\_event->get\_status(); |
  | 590 |  | $employee     = tmem\_get\_employee\_display\_name( $tmem\_event->employee\_id ); |
  | 591 |  | $event\_id     = tmem\_get\_event\_contract\_id( $tmem\_event->ID ); |
  | 592 |  | $title        = sprintf( '%s (%s)', esc\_attr( $event\_type ), esc\_attr( $event\_status) ); |
  | 593 |  | $description  = array(); |
  | 594 |  | $notes        = tmem\_get\_calendar\_event\_description\_text(); |
  | 595 |  | $notes        = tmem\_do\_content\_tags( $notes, $tmem\_event->ID, $tmem\_event->client ); |
  | 596 |  | $tip\_title    = sprintf( |
  | 597 |  | '%s %s - %s', |
  | 598 |  | esc\_html( tmem\_get\_label\_singular() ), |
  | 599 |  | $event\_id, |
  | 600 |  | esc\_attr( $event\_type ) |
  | 601 |  | ); |
  | 602 |  |  |
  | 603 |  | $event\_url = add\_query\_arg( array( |
  | 604 |  | 'post'   => $tmem\_event->ID, |
  | 605 |  | 'action' => 'edit' |
  | 606 |  | ), admin\_url( 'post.php' ) ); |
  | 607 |  |  |
  | 608 |  | $notes .= sprintf( |
  | 609 |  | '<p><a class="availability-link" href="%s" >%s</a></p>', |
  | 610 |  | $event\_url, |
  | 611 |  | sprintf( \_\_( 'View %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) |
  | 612 |  | ); |
  | 613 |  |  |
  | 614 |  | $this->results[] = array( |
  | 615 |  | 'allDay'          => false, |
  | 616 |  | 'backgroundColor' => tmem\_get\_calendar\_color( 'background', true ), |
  | 617 |  | 'borderColor'     => tmem\_get\_calendar\_color( 'border', true ), |
  | 618 |  | 'className'       => 'tmem\_calendar\_event', |
  | 619 |  | 'end'             => $tmem\_event->get\_finish\_date() . ' ' . $tmem\_event->get\_finish\_time(), |
  | 620 |  | 'id'              => $tmem\_event->ID, |
  | 621 |  | 'notes'           => $notes, |
  | 622 |  | 'start'           => $tmem\_event->date . ' ' . $tmem\_event->get\_start\_time(), |
  | 623 |  | 'textColor'       => tmem\_get\_calendar\_color( 'text', true ), |
  | 624 |  | 'tipTitle'        => $tip\_title, |
  | 625 |  | 'title'           => $title, |
  | 626 |  | 'event\_statuses'  => $event\_statuses, |
  | 627 |  | ); |
  |  | 585 | $tmem\_event   = new TMEM\_Event( $event->ID ); |
  |  | 586 | $event\_type   = $tmem\_event->get\_type(); |
  |  | 587 | $event\_status = $tmem\_event->get\_status(); |
  |  | 588 | $employee     = tmem\_get\_employee\_display\_name( $tmem\_event->employee\_id ); |
  |  | 589 | $event\_id     = tmem\_get\_event\_contract\_id( $tmem\_event->ID ); |
  |  | 590 | $title        = sprintf( '%s (%s)', esc\_attr( $event\_type ), esc\_attr( $event\_status ) ); |
  |  | 591 | $description  = array(); |
  |  | 592 | $notes        = tmem\_get\_calendar\_event\_description\_text(); |
  |  | 593 | $notes        = tmem\_do\_content\_tags( $notes, $tmem\_event->ID, $tmem\_event->client ); |
  |  | 594 | $tip\_title    = sprintf( |
  |  | 595 | '%s %s - %s', |
  |  | 596 | esc\_html( tmem\_get\_label\_singular() ), |
  |  | 597 | $event\_id, |
  |  | 598 | esc\_attr( $event\_type ) |
  |  | 599 | ); |
  |  | 600 |  |
  |  | 601 | $event\_url = add\_query\_arg( |
  |  | 602 | array( |
  |  | 603 | 'post'   => $tmem\_event->ID, |
  |  | 604 | 'action' => 'edit', |
  |  | 605 | ), |
  |  | 606 | admin\_url( 'post.php' ) |
  |  | 607 | ); |
  |  | 608 |  |
  |  | 609 | $notes .= sprintf( |
  |  | 610 | '<p><a class="availability-link" href="%s" >%s</a></p>', |
  |  | 611 | $event\_url, |
  |  | 612 | sprintf( \_\_( 'View %s', 'mobile-events-manager' ), tmem\_get\_label\_singular( true ) ) |
  |  | 613 | ); |
  |  | 614 |  |
  |  | 615 | $this->results[] = array( |
  |  | 616 | 'allDay'          => false, |
  |  | 617 | 'backgroundColor' => tmem\_get\_calendar\_color( 'background', true ), |
  |  | 618 | 'borderColor'     => tmem\_get\_calendar\_color( 'border', true ), |
  |  | 619 | 'className'       => 'tmem\_calendar\_event', |
  |  | 620 | 'end'             => $tmem\_event->get\_finish\_date() . ' ' . $tmem\_event->get\_finish\_time(), |
  |  | 621 | 'id'              => $tmem\_event->ID, |
  |  | 622 | 'notes'           => $notes, |
  |  | 623 | 'start'           => $tmem\_event->date . ' ' . $tmem\_event->get\_start\_time(), |
  |  | 624 | 'textColor'       => tmem\_get\_calendar\_color( 'text', true ), |
  |  | 625 | 'tipTitle'        => $tip\_title, |
  |  | 626 | 'title'           => $title, |
  |  | 627 | 'event\_statuses'  => $event\_statuses, |
  |  | 628 | ); |
  | 628 | 629 | } |
  | 629 | 630 | } |
* ## [mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php](/changeset/2647987/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php")

  | [r2487269](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php?rev=2487269#L20 "Show revision 2487269 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability-meta.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php](/changeset/2647987/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php?rev=2455787#L22 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/availability/class-tmem-db-availability.php?rev=2647987#L22 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | \*/ |
  | 23 | 23 |  |
  | 24 |  | // Exit if accessed directly |
  |  | 24 | // Exit if accessed directly. |
  | 25 | 25 | if ( ! defined( 'ABSPATH' ) ) { |
  | 26 | 26 | exit; |
* ## [mobile-events-manager/trunk/includes/class-tmem-cache-helper.php](/changeset/2647987/mobile-events-manager/trunk/includes/class-tmem-cache-helper.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/class-tmem-cache-helper.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/class-tmem-cache-helper.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/class-tmem-cache-helper.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/class-tmem-license-handler.php](/changeset/2647987/mobile-events-manager/trunk/includes/class-tmem-license-handler.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/class-tmem-license-handler.php")

  | [r2514025](/browser/mobile-events-manager/trunk/includes/class-tmem-license-handler.php?rev=2514025#L21 "Show revision 2514025 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/class-tmem-license-handler.php?rev=2647987#L21 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | \*/ |
  | 22 | 22 |  |
  | 23 |  | // Exit if accessed directly |
  |  | 23 | // Exit if accessed directly. |
  | 24 | 24 | if ( ! defined( 'ABSPATH' ) ) { |
  | 25 | 25 | exit; |
* ## [mobile-events-manager/trunk/includes/clients/client-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/clients/client-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/clients/client-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/clients/client-functions.php?rev=2455787#L15 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/clients/client-functions.php?rev=2647987#L15 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
* ## [mobile-events-manager/trunk/includes/clientzone-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/clientzone-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/clientzone-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/clientzone-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/clientzone-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/contract/contract-actions.php](/changeset/2647987/mobile-events-manager/trunk/includes/contract/contract-actions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/contract/contract-actions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/contract/contract-actions.php?rev=2455787#L15 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/contract/contract-actions.php?rev=2647987#L15 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
* ## [mobile-events-manager/trunk/includes/contract/contract-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/contract/contract-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/contract/contract-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/contract/contract-functions.php?rev=2455787#L15 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/contract/contract-functions.php?rev=2647987#L15 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 |  | // Exit if accessed directly |
  |  | 17 | // Exit if accessed directly. |
  | 18 | 18 | if ( ! defined( 'ABSPATH' ) ) { |
  | 19 | 19 | exit; |
* ## [mobile-events-manager/trunk/includes/deprecated-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/deprecated-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/deprecated-functions.php")

  | [r2539802](/browser/mobile-events-manager/trunk/includes/deprecated-functions.php?rev=2539802#L11 "Show revision 2539802 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/deprecated-functions.php?rev=2647987#L11 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | \*/ |
  | 12 | 12 |  |
  | 13 |  | // Exit if accessed directly |
  |  | 13 | // Exit if accessed directly. |
  | 14 | 14 | if ( ! defined( 'ABSPATH' ) ) { |
  | 15 | 15 | exit; |
* ## [mobile-events-manager/trunk/includes/emails/class-tmem-emails.php](/changeset/2647987/mobile-events-manager/trunk/includes/emails/class-tmem-emails.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/emails/class-tmem-emails.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/emails/class-tmem-emails.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/emails/class-tmem-emails.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/emails/email-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/emails/email-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/emails/email-functions.php")

  | [r2514025](/browser/mobile-events-manager/trunk/includes/emails/email-functions.php?rev=2514025#L18 "Show revision 2514025 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/emails/email-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/employee-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/employee-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/employee-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/employee-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/employee-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/events/event-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/events/event-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/events/event-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/events/event-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/events/event-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/formatting.php](/changeset/2647987/mobile-events-manager/trunk/includes/formatting.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/formatting.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/formatting.php?rev=2455787#L19 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/formatting.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
* ## [mobile-events-manager/trunk/includes/install.php](/changeset/2647987/mobile-events-manager/trunk/includes/install.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/install.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/install.php?rev=2576138#L478 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/install.php?rev=2647987#L478 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 478 | 478 | ) |
  | 479 | 479 | ); |
  | 480 |  |  |
  |  | 480 |  |
  | 481 | 481 | $email\_invoice = wp\_insert\_post( |
  | 482 | 482 | array( |
  | […](/browser/mobile-events-manager/trunk/includes/install.php?rev=2576138#L500) | […](/browser/mobile-events-manager/trunk/includes/install.php?rev=2647987#L500) |  |
  | 500 | 500 | $options['manual\_payment\_cfm\_template'] = $payment\_cfm; |
  | 501 | 501 | $options['default\_contract']            = $default\_contract; |
  | 502 |  | $options['email\_invoice']= $email\_invoice; |
  |  | 502 | $options['email\_invoice']               = $email\_invoice; |
  | 503 | 503 |  |
  | 504 | 504 | } |
  | […](/browser/mobile-events-manager/trunk/includes/install.php?rev=2576138#L799) | […](/browser/mobile-events-manager/trunk/includes/install.php?rev=2647987#L799) |  |
  | 799 | 799 | wp\_insert\_term( \_\_( 'Via Stairs', 'mobile-events-manager' ), 'venue-details', array( 'description' => \_\_( 'Access to this Venue is via stairs', 'mobile-events-manager' ) ) ); |
  | 800 | 800 | wp\_insert\_term( \_\_( 'Lift on site', 'mobile-events-manager' ), 'venue-details', array( 'description' => \_\_( 'Access to this Venue is via a lift', 'mobile-events-manager' ) ) ); |
  | 801 |  |  |
  |  | 801 |  |
  | 802 | 802 | // Create the custom TMEM User Roles. |
  | 803 | 803 | $roles = new TMEM\_Roles(); |
* ## [mobile-events-manager/trunk/includes/journal-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/journal-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/journal-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/journal-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/journal-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/misc-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/misc-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/misc-functions.php")

  | [r2637683](/browser/mobile-events-manager/trunk/includes/misc-functions.php?rev=2637683#L19 "Show revision 2637683 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/misc-functions.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/misc-functions.php?rev=2637683#L202) | […](/browser/mobile-events-manager/trunk/includes/misc-functions.php?rev=2647987#L202) |  |
  | 202 | 202 | \*/ |
  | 203 | 203 | $('<?php echo esc\_html( $field ); ?>').on('changeDate', function() { |
  | 204 |  | var tmemdate\_ = $(this).val(); |
  | 205 |  | var tmemdate\_ = tmemdate\_.split('-').reverse().join('-'); |
  | 206 |  | var tmemdate\_ = tmemdate\_.replace(/-/g,"/"); |
  | 207 |  | $('#<?php echo esc\_attr( $args['altfield'] ); ?>').val(tmemdate\_); |
  |  | 204 | var tmemdate\_ = $(this).val(); |
  |  | 205 | var tmemdate\_ = tmemdate\_.split('-').reverse().join('-'); |
  |  | 206 | var tmemdate\_ = tmemdate\_.replace(/-/g,"/"); |
  |  | 207 | $('#<?php echo esc\_attr( $args['altfield'] ); ?>').val(tmemdate\_); |
  | 208 | 208 | }); |
  | 209 | 209 | }); |
* ## [mobile-events-manager/trunk/includes/payments/payments.php](/changeset/2647987/mobile-events-manager/trunk/includes/payments/payments.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/payments/payments.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/payments/payments.php?rev=2455787#L19 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/payments/payments.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
* ## [mobile-events-manager/trunk/includes/payments/process-payments.php](/changeset/2647987/mobile-events-manager/trunk/includes/payments/process-payments.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/payments/process-payments.php")

  | [r2474613](/browser/mobile-events-manager/trunk/includes/payments/process-payments.php?rev=2474613#L19 "Show revision 2474613 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/payments/process-payments.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
* ## [mobile-events-manager/trunk/includes/payments/template.php](/changeset/2647987/mobile-events-manager/trunk/includes/payments/template.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/payments/template.php")

  | [r2474613](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L19 "Show revision 2474613 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L19 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | \*/ |
  | 20 | 20 |  |
  | 21 |  | // Exit if accessed directly |
  |  | 21 | // Exit if accessed directly. |
  | 22 | 22 | if ( ! defined( 'ABSPATH' ) ) { |
  | 23 | 23 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L41) | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L41) |  |
  | 41 | 41 | ?> |
  | 42 | 42 | <div id="tmem\_payments\_form\_wrap" class="tmem\_clearfix"> |
  | 43 |  | <?php if (~~tmem\_get\_event\_balance( $tmem\_event->ID ) <= 0 )~~{ ?> |
  | 44 |  | <div class="nothingtopay"><?php esc\_html\_e(~~'You currently have nothing left to pay for your function. Yay!', 'mobile-events-manager');~~?></div> |
  |  | 43 | <?php if ( tmem\_get\_event\_balance( $tmem\_event->ID ) <= 0 ) { ?> |
  |  | 44 | <div class="nothingtopay"><?php esc\_html\_e( 'You currently have nothing left to pay for your function. Yay!', 'mobile-events-manager' ); ?></div> |
  | 45 | 45 | <?php } else { ?> |
  | 46 | 46 |  |
  | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L57) | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L57) |  |
  | 57 | 57 | do\_action( 'tmem\_payment\_form\_top' ); |
  | 58 | 58 |  |
  | 59 |  | if ( tmem\_show\_gateways() ) { |
  | 60 |  | do\_action( 'tmem\_payment\_mode\_select' ); |
  | 61 |  | } else { |
  | 62 |  | do\_action( 'tmem\_payment\_form' ); |
  | 63 |  | } |
  |  | 59 | if ( tmem\_show\_gateways() ) { |
  |  | 60 | do\_action( 'tmem\_payment\_mode\_select' ); |
  |  | 61 | } else { |
  |  | 62 | do\_action( 'tmem\_payment\_form' ); |
  |  | 63 | } |
  | 64 | 64 |  |
  | 65 | 65 | /\*\* |
  | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L69) | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L69) |  |
  | 69 | 69 | \*/ |
  | 70 | 70 | do\_action( 'tmem\_checkout\_form\_bottom' ) |
  | 71 |  | ?> |
  |  | 71 | ?> |
  | 72 | 72 | </form> |
  | 73 | 73 | <?php do\_action( 'tmem\_after\_purchase\_form' ); ?> |
  | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L126) | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L126) |  |
  | 126 | 126 | echo '<input type="radio" name="payment-mode" class="tmem-gateway" id="tmem-gateway-' . esc\_attr( $gateway\_id ) . '" value="' . esc\_attr( $gateway\_id ) . '"' . $checked . '>' . esc\_html( $gateway['payment\_label'] ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 127 | 127 | echo '</label>'; |
  | 128 |  | } |
  |  | 128 | } |
  | 129 | 129 |  |
  | 130 | 130 | do\_action( 'tmem\_payment\_mode\_after\_gateways' ); |
  | 131 | 131 |  |
  | 132 |  | ?> |
  |  | 132 | ?> |
  | 133 | 133 | </div> |
  | 134 | 134 | <?php do\_action( 'tmem\_payment\_mode\_after\_gateways\_wrap' ); ?> |
  | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2474613#L173) | […](/browser/mobile-events-manager/trunk/includes/payments/template.php?rev=2647987#L173) |  |
  | 173 | 173 | \* Changed 14-01-21 to work with new gateways |
  | 174 | 174 | \*/ |
  | 175 |  |  |
  | 176 |  | if ( has\_action( 'tmem\_' . $payment\_mode . '\_form') ) { |
  | 177 |  | do\_action( 'tmem\_' . $payment\_mode . '\_form'); |
  |  | 175 |  |
  |  | 176 | if ( has\_action( 'tmem\_' . $payment\_mode . '\_form' ) ) { |
  |  | 177 | do\_action( 'tmem\_' . $payment\_mode . '\_form' ); |
  | 178 | 178 | } else { |
  | 179 | 179 | do\_action( 'tmem\_cc\_form' ); |
* ## [mobile-events-manager/trunk/includes/privacy-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/privacy-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/privacy-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/privacy-functions.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/privacy-functions.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/includes/scripts.php](/changeset/2647987/mobile-events-manager/trunk/includes/scripts.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/scripts.php")

  | [r2637683](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2637683#L161 "Show revision 2637683 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2647987#L161 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 161 | 161 | } |
  | 162 | 162 |  |
  | 163 |  | // Added Dan to load new CSS |
  |  | 163 | // Added Dan to load new CSS |
  | 164 | 164 | if ( is\_page( tmem\_get\_option( 'payments\_page' ) ) ) { |
  | 165 | 165 | wp\_register\_style( 'tmem-payments-css', TMEM\_PLUGIN\_URL . '/assets/css/tmem-payments.css' ); |
  | […](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2637683#L177) | […](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2647987#L177) |  |
  | 177 | 177 | wp\_enqueue\_style( 'dashicons' ); |
  | 178 | 178 | } |
  | 179 |  |  |
  | 180 |  |  |
  | 181 |  |  |
  | 182 | 179 |  |
  | 183 | 180 | } // tmem\_register\_styles |
  | […](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2637683#L424) | […](/browser/mobile-events-manager/trunk/includes/scripts.php?rev=2647987#L421) |  |
  | 424 | 421 | 'unavailable\_template' => tmem\_get\_option( 'unavailable' ), |
  | 425 | 422 | ) |
  | 426 |  | ) |
  | 427 |  | ); |
  | 428 |  |  |
  | 429 |  | wp\_register\_script( 'jquery-flot', $js\_dir . 'jquery.flot.min.js' ); |
  | 430 |  | wp\_enqueue\_script( 'jquery-flot' ); |
  |  | 423 | ) |
  |  | 424 | ); |
  |  | 425 |  |
  |  | 426 | wp\_register\_script( 'jquery-flot', $js\_dir . 'jquery.flot.min.js' ); |
  |  | 427 | wp\_enqueue\_script( 'jquery-flot' ); |
  | 431 | 428 |  |
  | 432 | 429 | } // tmem\_register\_admin\_scripts |
* ## [mobile-events-manager/trunk/includes/travel-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/travel-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/travel-functions.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/travel-functions.php?rev=2455787#L18 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/travel-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
* ## [mobile-events-manager/trunk/includes/venue-functions.php](/changeset/2647987/mobile-events-manager/trunk/includes/venue-functions.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/venue-functions.php")

  | [r2576138](/browser/mobile-events-manager/trunk/includes/venue-functions.php?rev=2576138#L18 "Show revision 2576138 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/venue-functions.php?rev=2647987#L18 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 |  | // Exit if accessed directly |
  |  | 20 | // Exit if accessed directly. |
  | 21 | 21 | if ( ! defined( 'ABSPATH' ) ) { |
  | 22 | 22 | exit; |
  | […](/browser/mobile-events-manager/trunk/includes/venue-functions.php?rev=2576138#L332) | […](/browser/mobile-events-manager/trunk/includes/venue-functions.php?rev=2647987#L332) |  |
  | 332 | 332 | } |
  | 333 | 333 | } |
  | 334 |  |  |
  |  | 334 |  |
  | 335 | 335 | $venue\_name     = tmem\_get\_event\_venue\_meta( $venue\_id, 'name' ); |
  | 336 | 336 | $venue\_contact  = tmem\_get\_event\_venue\_meta( $venue\_id, 'contact' ); |
* ## [mobile-events-manager/trunk/includes/widgets.php](/changeset/2647987/mobile-events-manager/trunk/includes/widgets.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/includes/widgets.php")

  | [r2455787](/browser/mobile-events-manager/trunk/includes/widgets.php?rev=2455787#L20 "Show revision 2455787 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/includes/widgets.php?rev=2647987#L20 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 |  | // Exit if accessed directly |
  |  | 22 | // Exit if accessed directly. |
  | 23 | 23 | if ( ! defined( 'ABSPATH' ) ) { |
  | 24 | 24 | exit; |
* ## [mobile-events-manager/trunk/mobile-events-manager.php](/changeset/2647987/mobile-events-manager/trunk/mobile-events-manager.php "Show the changeset 2647987 restricted to mobile-events-manager/trunk/mobile-events-manager.php")

  | [r2637682](/browser/mobile-events-manager/trunk/mobile-events-manager.php?rev=2637682#L5 "Show revision 2637682 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/mobile-events-manager.php?rev=2647987#L5 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Plugin URI: https://www.mobileeventsmanager.co.uk |
  | 6 | 6 | \* Description: The flexible event management solution for WordPress - not just for DJs! |
  | 7 |  | \* Version: 1.4.~~3.1~~ |
  |  | 7 | \* Version: 1.4.4 |
  | 8 | 8 | \* Date: 6 November 2021 |
  | 9 | 9 | \* Author: Dan Porter, Jack Mawhinney |
  | […](/browser/mobile-events-manager/trunk/mobile-events-manager.php?rev=2637682#L164) | […](/browser/mobile-events-manager/trunk/mobile-events-manager.php?rev=2647987#L164) |  |
  | 164 | 164 | private function setup\_constants() { |
  | 165 | 165 | global $wpdb; |
  | 166 |  | define( 'TMEM\_VERSION\_NUM', '1.4.~~3.1~~' ); |
  |  | 166 | define( 'TMEM\_VERSION\_NUM', '1.4.4' ); |
  | 167 | 167 | define( 'TMEM\_VERSION\_KEY', 'tmem\_version' ); |
  | 168 | 168 | define( 'TMEM\_PLUGIN\_DIR', untrailingslashit( dirname( \_\_FILE\_\_ ) ) ); |
* ## [mobile-events-manager/trunk/readme.txt](/changeset/2647987/mobile-events-manager/trunk/readme.txt "Show the changeset 2647987 restricted to mobile-events-manager/trunk/readme.txt")

  | [r2637682](/browser/mobile-events-manager/trunk/readme.txt?rev=2637682#L5 "Show revision 2637682 of this file in browser") | [r2647987](/browser/mobile-events-manager/trunk/readme.txt?rev=2647987#L5 "Show revision 2647987 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 5.8.3 |
  | 6 | 6 | Requires PHP: 5.4 |
  | 7 |  | Stable tag: 1.4.~~3.1~~ |
  |  | 7 | Stable tag: 1.4.4 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/mobile-events-manager/trunk/readme.txt?rev=2637682#L108) | […](/browser/mobile-events-manager/trunk/readme.txt?rev=2647987#L108) |  |
  | 108 | 108 | == Changelog == |
  | 109 | 109 |  |
  |  | 110 | = 1.4.4 = |
  |  | 111 |  |
  |  | 112 | \*\*Enhancement:\*\* Show an error if end time is set before the start time. |
  |  | 113 | \*\*Fix:\*\* Security fix |
  |  | 114 |  |
  | 110 | 115 | = 1.4.3.1 = |
  | 111 | 116 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2647987)
* [Zip Archive](?format=zip&new=2647987)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wpscan.com_3349f6cb_20250114_191306.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Mobile Events Manager < 1.4.4 - Admin+ Stored Cross-Site Scripting

### Description

The plugin does not sanitise and escape various of its settings, allowing high privilege users to perform Cross-Site Scripting attacks even when the unfiltered\_html capability is disallowed

### Proof of Concept

Payload used: <script>alert(/XSS/)</script>
- Put the payload in the TMEM Events > Settings > Events > Event prefix field, then Create an event to trigger the XSS
- Put the payload in the TMEM Events > Settings > Client Zone > Application Name field. The XSS will be triggered thought the plugin
- Put the payload in the TMEM Events > Settings > General > Company Name field. The XSS will be triggered in the admin dashboard

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

mobile-events-manager](https://a8cteam5105.wordpress.com/plugin/mobile-events-manager/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 1.4.4

### References

CVE
[CVE-2021-25049](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25049)

URL
<https://plugins.trac.wordpress.org/changeset/2647987>

### Classification

Type
XSS

OWASP top 10
[A7: Cross-Site Scripting (XSS)](https://www.owasp.org/index.php/Top_10-2017_A7-Cross-Site_Scripting_%28XSS%29)

CWE
[CWE-79](https://cwe.mitre.org/data/definitions/79.html)

CVSS
[3.4 (low)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:N/I:L/A:N)

### Miscellaneous

Original Researcher
Varun thorat

Submitter
Varun thorat

Submitter twitter
[Extrins1c](//twitter.com/Extrins1c)

Verified
Yes

WPVDB ID
[227cbf50-59da-4f4c-85da-1959a108ae7e](https://a8cteam5105.wordpress.com/vulnerability/227cbf50-59da-4f4c-85da-1959a108ae7e/)

### Timeline

Publicly Published
2021-12-24 (about 3 years ago)

Added
2021-12-24 (about 3 years ago)

Last Updated
2022-04-10 (about 2 years ago)

### Other

Published
Title

Published
2024-10-15
Title
[Smart Online Order for Clover < 1.5.8 - Reflected Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/f07e90fd-203b-4290-8bb3-13858c5f0889/)

Published
2024-04-05
Title
[WebinarPress < 1.33.10 - Reflected Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/6610028c-2a30-4cba-b829-c3c5d6159b45/)

Published
2024-10-31
Title
[Ditty < 3.1.47 - Author+ Stored XSS](https://a8cteam5105.wordpress.com/vulnerability/d1c78389-29eb-4dce-848c-e0eab85ff5cd/)

Published
2024-05-29
Title
[Font Farsi <= 1.6.6 - Administrator+ Stored Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/da1d6596-907c-458e-8376-83c3f9937765/)

Published
2023-02-17
Title
[Google Maps v3 Shortcode <= 1.2.1 - Contributor+ XSS](https://a8cteam5105.wordpress.com/vulnerability/c69f821f-cfe9-47a0-b790-0cc790c6f047/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)

