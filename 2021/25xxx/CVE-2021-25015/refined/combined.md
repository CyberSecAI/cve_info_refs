=== Content from wpscan.com_47cecd83_20250115_081641.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# myCred < 2.4 - Reflected Cross-Site Scripting

### Description

The plugin does not sanitise and escape the search query before outputting it back in the history dashboard page, leading to a Reflected Cross-Site Scripting issue

### Proof of Concept

https://example.com/wp-admin/users.php?page=mycred\_default-history&s=%3Cimg+src+onerror%3Dalert%28/XSS/%29%3E

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

mycred](https://a8cteam5105.wordpress.com/plugin/mycred/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 2.4

### References

CVE
[CVE-2021-25015](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25015)

URL
<https://plugins.trac.wordpress.org/changeset/2648350/mycred>

### Classification

Type
XSS

OWASP top 10
[A7: Cross-Site Scripting (XSS)](https://www.owasp.org/index.php/Top_10-2017_A7-Cross-Site_Scripting_%28XSS%29)

CWE
[CWE-79](https://cwe.mitre.org/data/definitions/79.html)

CVSS
[7.5 (high)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Krzysztof Zając

Submitter
Krzysztof Zając

Submitter website
<https://kazet.cc/>

Verified
Yes

WPVDB ID
[7608829d-2820-49e2-a10e-e93eb3005f68](https://a8cteam5105.wordpress.com/vulnerability/7608829d-2820-49e2-a10e-e93eb3005f68/)

### Timeline

Publicly Published
2021-12-27 (about 3 years ago)

Added
2021-12-27 (about 3 years ago)

Last Updated
2022-04-09 (about 2 years ago)

### Other

Published
Title

Published
2024-03-04
Title
[Easy!Appointments < 1.3.2 - Contributor+ Stored Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/85a800e8-cada-4277-8741-81692be0c252/)

Published
2015-02-02
Title
[WordPress Video Player <= 1.5.4 - Reflected Cross-Site Scripting (XSS)](https://a8cteam5105.wordpress.com/vulnerability/f1745029-3889-4698-84b9-bb4f3944288f/)

Published
2024-04-16
Title
[Tagbox – UGC Galleries, Social Media Widgets, User Reviews & Analytics < 3.3 - Authenticated (Contributor+) Stored Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/6f9408f6-50d5-4c19-9ad5-f7502c25fa6e/)

Published
2014-08-01
Title
[Repagent - dewplayer-vinyl.swf xml Parameter XML File H&ling XSS](https://a8cteam5105.wordpress.com/vulnerability/cba7cb8f-efb7-448a-927a-51a9d6990c9b/)

Published
2023-07-05
Title
[WP Reroute Email < 1.5.0 - Unauthenticated Stored Cross-Site Scripting](https://a8cteam5105.wordpress.com/vulnerability/38ba58fb-5cfa-4283-82e5-80e270d3da91/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from plugins.trac.wordpress.org_3850e8c2_20250115_081641.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2648350%2Fmycred)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2632101/mycred "Changeset 2632101 for mycred")
* [Next Change](/changeset/2648354/mycred "Changeset 2648354 for mycred") →

---

# Changeset [2648350](/changeset/2648350 "Show full changeset") for [mycred](/browser/mycred?rev=2648350 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/23/2021 12:47:56 PM
([3 years](/timeline?from=2021-12-23T12%3A47%3A56Z&precision=second "See timeline at 12/23/2021 12:47:56 PM") ago)

Author:
wpexpertsio
Message:

Version 2.4

Location:
[mycred/trunk](/browser/mycred/trunk?rev=2648350)
Files:

93 added
12 deleted
24 edited

* [addons/badges/includes/mycred-badge-functions.php](/browser/mycred/trunk/addons/badges/includes/mycred-badge-functions.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [addons/badges/myCRED-addon-badges.php](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350 "Show entry in browser")
  (modified)
  ([6 diffs](#file2 "Show differences"))
* [addons/buddypress/hooks](/browser/mycred/trunk/addons/buddypress/hooks?rev=911247 "Show what was removed (content at revision 2648349)")
  (deleted)
* [addons/buy-creds/includes/buycred-shortcodes.php](/browser/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php?rev=2648350 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [addons/coupons/assets](/browser/mycred/trunk/addons/coupons/assets?rev=2648350 "Show entry in browser")
  (added)
* [addons/coupons/assets/css](/browser/mycred/trunk/addons/coupons/assets/css?rev=2648350 "Show entry in browser")
  (added)
* [addons/coupons/assets/css/admin.css](/browser/mycred/trunk/addons/coupons/assets/css/admin.css?rev=2648350 "Show entry in browser")
  (added)
* [addons/coupons/assets/js](/browser/mycred/trunk/addons/coupons/assets/js?rev=2648350 "Show entry in browser")
  (added)
* [addons/coupons/assets/js/admin.js](/browser/mycred/trunk/addons/coupons/assets/js/admin.js?rev=2648350 "Show entry in browser")
  (added)
* [addons/coupons/includes/mycred-coupon-object.php](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2648350 "Show entry in browser")
  (modified)
  ([3 diffs](#file10 "Show differences"))
* [addons/coupons/myCRED-addon-coupons.php](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350 "Show entry in browser")
  (modified)
  ([8 diffs](#file11 "Show differences"))
* [addons/email-notices/myCRED-addon-email-notices.php](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2648350 "Show entry in browser")
  (modified)
  ([4 diffs](#file12 "Show differences"))
* [addons/ranks/myCRED-addon-ranks.php](/browser/mycred/trunk/addons/ranks/myCRED-addon-ranks.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [assets/css/admin.css](/browser/mycred/trunk/assets/css/admin.css?rev=952319 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/css/mycred-admin.css](/browser/mycred/trunk/assets/css/mycred-admin.css?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [assets/css/mycred-front.css](/browser/mycred/trunk/assets/css/mycred-front.css?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [assets/images/treasures/badges.jpg](/browser/mycred/trunk/assets/images/treasures/badges.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/images/treasures/currency.jpg](/browser/mycred/trunk/assets/images/treasures/currency.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/images/treasures/fitness.jpg](/browser/mycred/trunk/assets/images/treasures/fitness.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/images/treasures/gems.jpg](/browser/mycred/trunk/assets/images/treasures/gems.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/images/treasures/learning.jpg](/browser/mycred/trunk/assets/images/treasures/learning.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/images/treasures/rank.jpg](/browser/mycred/trunk/assets/images/treasures/rank.jpg?rev=2582075 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/js/accordion.js](/browser/mycred/trunk/assets/js/accordion.js?rev=824577 "Show what was removed (content at revision 2648349)")
  (deleted)
* [assets/js/mycred-tools.js](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350 "Show entry in browser")
  (modified)
  ([6 diffs](#file24 "Show differences"))
* [assets/screenshot-6.png](/browser/mycred/trunk/assets/screenshot-6.png?rev=2598136 "Show what was removed (content at revision 2648349)")
  (deleted)
* [includes/classes/class.query-leaderboard.php](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350 "Show entry in browser")
  (modified)
  ([7 diffs](#file26 "Show differences"))
* [includes/classes/class.query-log.php](/browser/mycred/trunk/includes/classes/class.query-log.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [includes/hooks/external/mycred-hook-affiliatewp.php](/browser/mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [includes/hooks/mycred-hook-referrals.php](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350 "Show entry in browser")
  (modified)
  ([5 diffs](#file29 "Show differences"))
* [includes/hooks/mycred-hook-watching-video.php](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2648350 "Show entry in browser")
  (modified)
  ([3 diffs](#file30 "Show differences"))
* [includes/mycred-blocks](/browser/mycred/trunk/includes/mycred-blocks?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks](/browser/mycred/trunk/includes/mycred-blocks/blocks?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-id](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-id?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-id/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-id/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-id/mycred-affiliate-id.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-id/mycred-affiliate-id.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-link](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-link?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-link/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-link/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-affiliate-link/mycred-affiliate-link.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-affiliate-link/mycred-affiliate-link.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-badges](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-badges?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-badges/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-badges/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-badges/mycred-badges.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-badges/mycred-badges.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-best-user](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-best-user?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-best-user/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-best-user/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-best-user/mycred-best-user.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-best-user/mycred-best-user.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy-form](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy-form?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy-form/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy-form/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy-form/mycred-buy-form.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy-form/mycred-buy-form.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-buy/mycred-buy.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-buy/mycred-buy.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-email-subsc](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-email-subsc?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-email-subsc/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-email-subsc/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-email-subsc/mycred-email-subsc.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-email-subsc/mycred-email-subsc.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-exchange](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-exchange?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-exchange/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-exchange/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-exchange/mycred-exchange.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-exchange/mycred-exchange.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-give](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-give?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-give/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-give/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-give/mycred-give.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-give/mycred-give.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-history](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-history?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-history/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-history/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-history/mycred-history.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-history/mycred-history.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-hook-table](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-hook-table?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-hook-table/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-hook-table/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-hook-table/mycred-hook-table.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-hook-table/mycred-hook-table.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-leaderboard](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-leaderboard?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-leaderboard/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-leaderboard/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-leaderboard/mycred-leaderboard.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-leaderboard/mycred-leaderboard.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-link](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-link?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-link/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-link/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-link/mycred-link.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-link/mycred-link.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-list-ranks](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-list-ranks?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-list-ranks/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-list-ranks/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-list-ranks/mycred-list-ranks.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-list-ranks/mycred-list-ranks.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-load-coupon](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-load-coupon?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-load-coupon/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-load-coupon/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-load-coupon/mycred-load-coupon.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-load-coupon/mycred-load-coupon.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-badges](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-badges?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-badges/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-badges/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-badges/mycred-my-badges.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-badges/mycred-my-badges.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance-converted](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance-converted?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance-converted/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance-converted/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance-converted/mycred-my-balance-converted.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance-converted/mycred-my-balance-converted.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-balance/mycred-my-balance.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-balance/mycred-my-balance.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-rank](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-rank?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-rank/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-rank/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-rank/mycred-my-rank.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-rank/mycred-my-rank.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-ranks](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-ranks?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-ranks/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-ranks/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-my-ranks/mycred-my-ranks.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-my-ranks/mycred-my-ranks.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-balance](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-balance?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-balance/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-balance/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-balance/mycred-total-balance.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-balance/mycred-total-balance.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-pts](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-pts?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-pts/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-pts/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-pts/mycred-total-pts.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-pts/mycred-total-pts.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-since](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-since?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-since/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-since/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-total-since/mycred-total-since.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-total-since/mycred-total-since.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-transfer](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-transfer?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-transfer/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-transfer/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-transfer/mycred-transfer.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-transfer/mycred-transfer.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-all-ranks](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-all-ranks?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-all-ranks/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-all-ranks/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-all-ranks/mycred-users-of-all-ranks.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-all-ranks/mycred-users-of-all-ranks.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-rank](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-rank?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-rank/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-rank/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-users-of-rank/mycred-users-of-rank.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-users-of-rank/mycred-users-of-rank.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-video](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-video?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-video/index.js](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-video/index.js?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/blocks/mycred-video/mycred-video.php](/browser/mycred/trunk/includes/mycred-blocks/blocks/mycred-video/mycred-video.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/includes](/browser/mycred/trunk/includes/mycred-blocks/includes?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/includes/mycred-gutenberg-functions.php](/browser/mycred/trunk/includes/mycred-blocks/includes/mycred-gutenberg-functions.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-blocks/mycred-blocks.php](/browser/mycred/trunk/includes/mycred-blocks/mycred-blocks.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-functions.php](/browser/mycred/trunk/includes/mycred-functions.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file117 "Show differences"))
* [includes/mycred-network.php](/browser/mycred/trunk/includes/mycred-network.php?rev=952319 "Show what was removed (content at revision 2648349)")
  (deleted)
* [includes/mycred-remote.php](/browser/mycred/trunk/includes/mycred-remote.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file119 "Show differences"))
* [includes/mycred-tools-import-export.php](/browser/mycred/trunk/includes/mycred-tools-import-export.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-tools-setup-import-export.php](/browser/mycred/trunk/includes/mycred-tools-setup-import-export.php?rev=2648350 "Show entry in browser")
  (added)
* [includes/mycred-tools.php](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350 "Show entry in browser")
  (modified)
  ([5 diffs](#file122 "Show differences"))
* [includes/shortcodes/mycred\_referal\_stats.php](/browser/mycred/trunk/includes/shortcodes/mycred_referal_stats.php?rev=2547251 "Show what was removed (content at revision 2648349)")
  (deleted)
* [includes/shortcodes/mycred\_video.php](/browser/mycred/trunk/includes/shortcodes/mycred_video.php?rev=2648350 "Show entry in browser")
  (modified)
  ([2 diffs](#file124 "Show differences"))
* [includes/widgets/mycred-widget-leaderboard.php](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350 "Show entry in browser")
  (modified)
  ([14 diffs](#file125 "Show differences"))
* [modules/mycred-module-buddypress.php](/browser/mycred/trunk/modules/mycred-module-buddypress.php?rev=2648350 "Show entry in browser")
  (modified)
  ([1 diff](#file126 "Show differences"))
* [modules/mycred-module-log.php](/browser/mycred/trunk/modules/mycred-module-log.php?rev=2648350 "Show entry in browser")
  (modified)
  ([2 diffs](#file127 "Show differences"))
* [mycred.php](/browser/mycred/trunk/mycred.php?rev=2648350 "Show entry in browser")
  (modified)
  ([10 diffs](#file128 "Show differences"))
* [readme.txt](/browser/mycred/trunk/readme.txt?rev=2648350 "Show entry in browser")
  (modified)
  ([6 diffs](#file129 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [mycred/trunk/addons/badges/includes/mycred-badge-functions.php](/changeset/2648350/mycred/trunk/addons/badges/includes/mycred-badge-functions.php "Show the changeset 2648350 restricted to mycred/trunk/addons/badges/includes/mycred-badge-functions.php")

  | [r2586918](/browser/mycred/trunk/addons/badges/includes/mycred-badge-functions.php?rev=2586918#L612 "Show revision 2586918 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/badges/includes/mycred-badge-functions.php?rev=2648350#L612 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 612 | 612 |  |
  | 613 | 613 | } |
  | 614 |  |  |
  |  | 614 |  |
  | 615 | 615 | $clean\_ids = array(); |
  | 616 | 616 | if ( ! empty( $badge\_ids ) ) { |
* ## [mycred/trunk/addons/badges/myCRED-addon-badges.php](/changeset/2648350/mycred/trunk/addons/badges/myCRED-addon-badges.php "Show the changeset 2648350 restricted to mycred/trunk/addons/badges/myCRED-addon-badges.php")

  | [r2621330](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1107 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1107 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 1107 | 1107 |  |
  | 1108 | 1108 | $add\_level    = '<button type="button" class="button button-seconary button-small top-right-corner" id="badges-add-new-level">' . esc\_js( \_\_( 'Add Level', 'mycred' ) ) . '</button>'; |
  | 1109 |  | $remove\_level = '<button type="button" class="button button-seconary button-small top-right-corner remove-badge-level" data-level="~~' . $level . '~~">' . esc\_js( \_\_( 'Remove Level', 'mycred' ) ) . '</button>'; |
  |  | 1109 | $remove\_level = '<button type="button" class="button button-seconary button-small top-right-corner remove-badge-level" data-level="{{level}}">' . esc\_js( \_\_( 'Remove Level', 'mycred' ) ) . '</button>'; |
  | 1110 | 1110 |  |
  | 1111 | 1111 | $level\_image  = $this->get\_level\_image( $setup, $level ); |
  | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1118) | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1118) |  |
  | 1118 | 1118 | $template = str\_replace( '{{level}}',             $level, $template ); |
  | 1119 | 1119 | $template = str\_replace( '{{addlevelbutton}}',    $add\_level, $template ); |
  |  | 1120 |  |
  |  | 1121 | $js\_level = str\_replace( '{{removelevelbutton}}', $remove\_level, $js\_level ); |
  |  | 1122 |  |
  |  | 1123 | $remove\_level = str\_replace( '{{level}}',         $level, $remove\_level ); |
  |  | 1124 |  |
  | 1120 | 1125 | $template = str\_replace( '{{removelevelbutton}}', $remove\_level, $template ); |
  | 1121 | 1126 |  |
  | 1122 |  | ~~$js\_level = str\_replace( '{{removelevelbutton}}', $remove\_level, $js\_level );~~ |
  | 1123 | 1127 | $js\_level = str\_replace( '{{emptylevelimage}}',   $empty\_level, $js\_level ); |
  | 1124 | 1128 | $js\_level = str\_replace( '{{levelimage}}',        '', $js\_level ); |
  | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1268) | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1272) |  |
  | 1268 | 1272 | $template           = str\_replace( '{{rewards}}',       $rewards, $template ); |
  | 1269 | 1273 |  |
  | 1270 |  | $rewards            = str\_replace( $level,         '{{level}}', $rewards ); |
  |  | 1274 | $rewards            = str\_replace( $level,              '{{level}}', $rewards ); |
  | 1271 | 1275 |  |
  | 1272 | 1276 | $js\_level           = str\_replace( '{{rewards}}',       $rewards, $js\_level ); |
  | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1678) | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1682) |  |
  | 1678 | 1682 | public function badge\_user\_screen( $user ) { |
  | 1679 | 1683 |  |
  | 1680 |  | ~~// Only visible to admins~~ |
  | 1681 |  | ~~if ( ! mycred\_is\_admin() ) return;~~ |
  | 1682 |  |  |
  | 1683 | 1684 | $user\_id      = $user->ID; |
  | 1684 | 1685 | $all\_badges   = mycred\_get\_badge\_ids(); |
  | 1685 | 1686 | $users\_badges = mycred\_get\_users\_badges( $user\_id ); |
  | 1686 | 1687 |  |
  |  | 1688 | if ( ! mycred\_is\_admin() ) |
  |  | 1689 | $all\_badges = array\_keys( $users\_badges ); |
  |  | 1690 |  |
  | 1687 | 1691 | ?> |
  | 1688 | 1692 | <style type="text/css"> |
  | 1689 | 1693 | .badge-wrapper { min-height: 230px; } |
  |  | 1694 | .badge-wrapper-center { display: inline-flex; justify-content: center; align-items: center; } |
  | 1690 | 1695 | .badge-wrapper select { width: 100%; } |
  | 1691 | 1696 | .badge-image-wrap { text-align: center; } |
  | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1710) | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1715) |  |
  | 1710 | 1715 | $earned\_level = 0; |
  | 1711 | 1716 | $badge\_image  = $badge->main\_image; |
  |  | 1717 | $level\_select = ''; |
  | 1712 | 1718 |  |
  | 1713 | 1719 | if ( array\_key\_exists( $badge\_id, $users\_badges ) ) { |
  | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2621330#L1717) | […](/browser/mycred/trunk/addons/badges/myCRED-addon-badges.php?rev=2648350#L1723) |  |
  | 1717 | 1723 | } |
  | 1718 | 1724 |  |
  | 1719 |  | $level\_select = '<input type="hidden" name="mycred\_badge\_manual[badges][' . $badge\_id . '][level]" value="0" /><select disabled="disabled"><option>Level 1</option></select>'; |
  | 1720 |  | if ( count( $badge->levels ) > 1 ) { |
  | 1721 |  |  |
  | 1722 |  | $level\_select  = '<select name="mycred\_badge\_manual[badges][' . $badge\_id . '][level]">'; |
  | 1723 |  | $level\_select .= '<option value=""'; |
  | 1724 |  | if ( ! $earned ) $level\_select .= ' selected="selected"'; |
  | 1725 |  | $level\_select .= '>' . \_\_( 'Select a level', 'mycred' ) . '</option>'; |
  | 1726 |  |  |
  | 1727 |  | foreach ( $badge->levels as $level\_id => $level ) { |
  | 1728 |  | $level\_select .= '<option value="' . $level\_id . '"'; |
  | 1729 |  | if ( $earned && $earned\_level == $level\_id ) $level\_select .= ' selected="selected"'; |
  | 1730 |  | $level\_select .= '>' . ( ( $level['label'] != '' ) ? $level['label'] : sprintf( '%s %d', \_\_( 'Level', 'mycred' ), ( $level\_id + 1 ) ) ) . '</option>'; |
  |  | 1725 | if ( mycred\_is\_admin() ) { |
  |  | 1726 |  |
  |  | 1727 | $level\_select = '<input type="hidden" name="mycred\_badge\_manual[badges][' . $badge\_id . '][level]" value="0" /><select disabled="disabled"><option>Level 1</option></select>'; |
  |  | 1728 | if ( count( $badge->levels ) > 1 ) { |
  |  | 1729 |  |
  |  | 1730 | $level\_select  = '<select name="mycred\_badge\_manual[badges][' . $badge\_id . '][level]">'; |
  |  | 1731 | $level\_select .= '<option value=""'; |
  |  | 1732 | if ( ! $earned ) $level\_select .= ' selected="selected"'; |
  |  | 1733 | $level\_select .= '>' . \_\_( 'Select a level', 'mycred' ) . '</option>'; |
  |  | 1734 |  |
  |  | 1735 | foreach ( $badge->levels as $level\_id => $level ) { |
  |  | 1736 | $level\_select .= '<option value="' . $level\_id . '"'; |
  |  | 1737 | if ( $earned && $earned\_level == $level\_id ) $level\_select .= ' selected="selected"'; |
  |  | 1738 | $level\_select .= '>' . ( ( $level['label'] != '' ) ? $level['label'] : sprintf( '%s %d', \_\_( 'Level', 'mycred' ), ( $level\_id + 1 ) ) ) . '</option>'; |
  |  | 1739 | } |
  |  | 1740 |  |
  |  | 1741 | $level\_select .= '</select>'; |
  |  | 1742 |  |
  | 1731 | 1743 | } |
  | 1732 | 1744 |  |
  | 1733 |  | ~~$level\_select .= '</select>';~~ |
  | 1734 |  |  |
  | 1735 | 1745 | } |
  |  | 1746 | else { |
  |  | 1747 |  |
  |  | 1748 | if ( ! empty( $badge->levels[ $earned\_level ]['label'] ) ) { |
  |  | 1749 | $level\_select = $badge->levels[ $earned\_level ]['label']; |
  |  | 1750 | } |
  |  | 1751 |  |
  |  | 1752 | } |
  | 1736 | 1753 |  |
  | 1737 | 1754 | ?> |
  | 1738 |  | <div class="badge-wrapper color-option<?php if ( $earned === 1 ) echo ' selected'; ?>" id="mycred-badge<?php echo $badge\_id; ?>-wrapper"> |
  | 1739 |  | <label for="mycred-badge<?php echo $badge\_id; ?>"><input type="checkbox" name="mycred\_badge\_manual[badges][<?php echo $badge\_id; ?>][has]" class="toggle-badge" id="mycred-badge<?php echo $badge\_id; ?>" <?php checked( $earned, 1 );?> value="1" /> <?php \_e( 'Earned', 'mycred' ); ?></label> |
  | 1740 |  | <div class="badge-image-wrap"> |
  | 1741 |  |  |
  | 1742 |  | <div class="badge-image<?php if ( $badge\_image == '' ) echo ' empty'; ?>"><?php echo $badge\_image; ?></div> |
  | 1743 |  |  |
  | 1744 |  | <h4><?php echo $badge->title; ?></h4> |
  |  | 1755 | <div class="badge-wrapper<?php if ( ! mycred\_is\_admin() ) echo ' badge-wrapper-center'; ?> color-option<?php if ( $earned === 1 ) echo ' selected'; ?>" id="mycred-badge<?php echo $badge\_id; ?>-wrapper"> |
  |  | 1756 | <div> |
  |  | 1757 | <?php if ( mycred\_is\_admin() ):?> |
  |  | 1758 | <label for="mycred-badge<?php echo $badge\_id; ?>"><input type="checkbox" name="mycred\_badge\_manual[badges][<?php echo $badge\_id; ?>][has]" class="toggle-badge" id="mycred-badge<?php echo $badge\_id; ?>" <?php checked( $earned, 1 );?> value="1" /> <?php \_e( 'Earned', 'mycred' ); ?></label> |
  |  | 1759 | <?php endif; ?> |
  |  | 1760 | <div class="badge-image-wrap"> |
  |  | 1761 |  |
  |  | 1762 | <div class="badge-image<?php if ( $badge\_image == '' ) echo ' empty'; ?>"><?php echo $badge\_image; ?></div> |
  |  | 1763 |  |
  |  | 1764 | <h4><?php echo $badge->title; ?></h4> |
  |  | 1765 | </div> |
  |  | 1766 | <div class="badge-actions" style="min-height: 32px;"> |
  |  | 1767 |  |
  |  | 1768 | <?php echo $level\_select; ?> |
  |  | 1769 |  |
  |  | 1770 | </div> |
  |  | 1771 |  |
  |  | 1772 | <?php if ( $badge->open\_badge && array\_key\_exists( $badge\_id, $users\_badges ) ):?> |
  |  | 1773 | <div class="badge-image-wrap"> |
  |  | 1774 | <a href="<?php echo $badge->get\_earned\_image( $user\_id ); ?> " class="button button-primary button-large mycred-open-badge-download" download>Download</a> |
  |  | 1775 | </div> |
  |  | 1776 | <?php endif; ?> |
  | 1745 | 1777 | </div> |
  | 1746 |  | ~~<div class="badge-actions" style="min-height: 32px;">~~ |
  | 1747 |  |  |
  | 1748 |  | ~~<?php echo $level\_select; ?>~~ |
  | 1749 |  |  |
  | 1750 |  | ~~</div>~~ |
  | 1751 |  |  |
  | 1752 |  | ~~<?php if ( $badge->open\_badge && array\_key\_exists( $badge\_id, $users\_badges ) ):?>~~ |
  | 1753 |  | ~~<div class="badge-image-wrap">~~ |
  | 1754 |  | ~~<a href="<?php echo $badge->get\_earned\_image( $user\_id ); ?> " class="button button-primary button-large mycred-open-badge-download" download>Download</a>~~ |
  | 1755 |  | ~~</div>~~ |
  | 1756 |  | ~~<?php endif; ?>~~ |
  | 1757 | 1778 | </div> |
  | 1758 | 1779 | <?php |
* ## [mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php](/changeset/2648350/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php "Show the changeset 2648350 restricted to mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php")

  | [r2621330](/browser/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php?rev=2621330#L92 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php?rev=2648350#L92 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 92 | 92 | \* @see http://codex.mycred.me/shortcodes/mycred\_buy\_form/ |
  | 93 | 93 | \* @since 1.0 |
  |  | 94 | \* @since 2.4 Submit button input changed with button to add compatibility with modern UI. |
  | 94 | 95 | \* @version 1.3 |
  | 95 | 96 | \*/ |
  | […](/browser/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php?rev=2621330#L327) | […](/browser/mycred/trunk/addons/buy-creds/includes/buycred-shortcodes.php?rev=2648350#L328) |  |
  | 327 | 328 |  |
  | 328 | 329 | <div class="form-group"> |
  | 329 |  | <~~input type="submit" class="button btn btn-block btn-lg" value="<?php echo $button\_label; ?>" /~~> |
  |  | 330 | <button class="button btn btn-block btn-lg" ><?php echo $button\_label; ?></button> |
  | 330 | 331 | </div> |
  | 331 | 332 |  |
* ## [mycred/trunk/addons/coupons/includes/mycred-coupon-object.php](/changeset/2648350/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php "Show the changeset 2648350 restricted to mycred/trunk/addons/coupons/includes/mycred-coupon-object.php")

  | [r2189638](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2189638#L78 "Show revision 2189638 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2648350#L78 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 78 | 78 |  |
  | 79 | 79 | /\*\* |
  |  | 80 | \* Check badges/ranks |
  |  | 81 | \*/ |
  |  | 82 | public $enabled\_disabled  = ''; |
  |  | 83 |  |
  |  | 84 | /\*\* |
  |  | 85 | \* Assign badges/ranks rewards |
  |  | 86 | \*/ |
  |  | 87 | public $rewards      = 0; |
  |  | 88 |  |
  |  | 89 | /\*\* |
  | 80 | 90 | \* Construct |
  | 81 | 91 | \*/ |
  | […](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2189638#L136) | […](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2648350#L146) |  |
  | 136 | 146 |  |
  | 137 | 147 | $this->used              = $this->get\_usage\_count(); |
  |  | 148 | $this->enabled\_disabled  = mycred\_get\_post\_meta( $this->post\_id, 'check', true ); |
  |  | 149 | $this->rewards           = mycred\_get\_post\_meta( $this->post\_id, 'reward', true ); |
  | 138 | 150 |  |
  | 139 | 151 | if ( ! mycred\_point\_type\_exists( $this->point\_type ) ) |
  | […](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2189638#L307) | […](/browser/mycred/trunk/addons/coupons/includes/mycred-coupon-object.php?rev=2648350#L319) |  |
  | 307 | 319 | ); |
  | 308 | 320 |  |
  |  | 321 | $enabled\_disabled = $this->enabled\_disabled; |
  |  | 322 | $rewards = $this->rewards; |
  |  | 323 |  |
  |  | 324 | if( $enabled\_disabled == 'on' ) { |
  |  | 325 |  |
  |  | 326 | if( ! empty ( $rewards )  ) { |
  |  | 327 |  |
  |  | 328 | foreach ($rewards as $key => $value) { |
  |  | 329 |  |
  |  | 330 | if( class\_exists( 'myCRED\_Badge' ) && $value['types'] == 'mycred\_coupon\_badges' ) { |
  |  | 331 | mycred\_assign\_badge\_to\_user( $user\_id, $value['ids'] ); |
  |  | 332 |  |
  |  | 333 | } |
  |  | 334 |  |
  |  | 335 | if( class\_exists( 'myCRED\_Ranks\_Module' ) && $value['types'] == 'mycred\_coupon\_ranks' && mycred\_manual\_ranks( $this->point\_type ) ) { |
  |  | 336 | $ranks = new myCRED\_Rank( $value['ids'] ); |
  |  | 337 | $ranks->assign($user\_id); |
  |  | 338 |  |
  |  | 339 | } |
  |  | 340 | } |
  |  | 341 | } |
  |  | 342 | } |
  |  | 343 |  |
  | 309 | 344 | do\_action( 'mycred\_use\_coupon', $user\_id, $this ); |
  | 310 | 345 |  |
* ## [mycred/trunk/addons/coupons/myCRED-addon-coupons.php](/changeset/2648350/mycred/trunk/addons/coupons/myCRED-addon-coupons.php "Show the changeset 2648350 restricted to mycred/trunk/addons/coupons/myCRED-addon-coupons.php")

  | [r2621330](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L57 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L57 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 57 | 57 | add\_action( 'mycred\_add\_menu',       array( $this, 'add\_to\_menu' ), $this->menu\_pos ); |
  | 58 | 58 | add\_action( 'admin\_notices',         array( $this, 'warn\_bad\_expiration' ), $this->menu\_pos ); |
  |  | 59 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_admin\_scripts' ) ); |
  | 59 | 60 |  |
  | 60 | 61 | } |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L83) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L84) |  |
  | 83 | 84 | add\_filter( 'bulk\_actions-edit-' . MYCRED\_COUPON\_KEY,               array( $this, 'bulk\_actions' ) ); |
  | 84 | 85 | add\_action( 'save\_post\_' . MYCRED\_COUPON\_KEY,                       array( $this, 'save\_coupon' ), 10, 2 ); |
  |  | 86 |  |
  |  | 87 | //AJAX |
  |  | 88 | add\_action( 'wp\_ajax\_mycred\_change\_dropdown', array( $this, 'mycred\_change\_dropdown\_ajax\_handler' ) ); |
  | 85 | 89 |  |
  | 86 | 90 | } |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L381) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L385) |  |
  | 381 | 385 | wp\_enqueue\_style( 'mycred-bootstrap-grid' ); |
  | 382 | 386 | wp\_enqueue\_style( 'mycred-forms' ); |
  | 383 |  |  |
  |  | 387 | wp\_enqueue\_style( MYCRED\_SLUG . '-buttons' ); |
  | 384 | 388 | add\_filter( 'postbox\_classes\_' . MYCRED\_COUPON\_KEY . '\_mycred-coupon-setup',        array( $this, 'metabox\_classes' ) ); |
  | 385 | 389 | add\_filter( 'postbox\_classes\_' . MYCRED\_COUPON\_KEY . '\_mycred-coupon-limits',       array( $this, 'metabox\_classes' ) ); |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L396) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L400) |  |
  | 396 | 400 | \* @version 1.0 |
  | 397 | 401 | \*/ |
  | 398 |  | public function coupon\_style() { } |
  |  | 402 | public function coupon\_style() { |
  |  | 403 |  |
  |  | 404 | } |
  |  | 405 |  |
  |  | 406 | /\*\* |
  |  | 407 | \* Enqueue Admin Script |
  |  | 408 | \* @since 2.4 |
  |  | 409 | \* @version 1.0 |
  |  | 410 | \*/ |
  |  | 411 | public function enqueue\_admin\_scripts() { |
  |  | 412 |  |
  |  | 413 | wp\_register\_style( 'mycred-coupon-badge-rank-style', plugins\_url( 'assets/css/admin.css', myCRED\_COUPONS ), '', myCRED\_COUPONS\_VERSION ); |
  |  | 414 | wp\_register\_script( 'mycred-coupon-badge-rank-js', plugins\_url( 'assets/js/admin.js', myCRED\_COUPONS ), array( 'jquery' ), myCRED\_COUPONS\_VERSION, true ); |
  |  | 415 |  |
  |  | 416 | } |
  | 399 | 417 |  |
  | 400 | 418 | /\*\* |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L431) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L449) |  |
  | 431 | 449 | 'core' |
  | 432 | 450 | ); |
  |  | 451 |  |
  |  | 452 | if( class\_exists( 'myCRED\_Badge' ) || class\_exists( 'myCRED\_Ranks\_Module' ) ) { |
  |  | 453 | add\_meta\_box( |
  |  | 454 | 'mycred-coupon-badges-ranks', |
  |  | 455 | \_\_( 'Assign Badge/Ranks To Users', 'mycred' ), |
  |  | 456 | array( $this, 'mycred\_coupon\_badges\_ranks' ), |
  |  | 457 | MYCRED\_COUPON\_KEY, |
  |  | 458 | 'advanced', |
  |  | 459 | 'core' |
  |  | 460 | ); |
  |  | 461 | } |
  | 433 | 462 |  |
  | 434 | 463 | if ( $post->post\_status == 'publish' ) |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L600) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L629) |  |
  | 600 | 629 | </div> |
  | 601 | 630 | </div> |
  | 602 |  | <?php |
  | 603 |  |  |
  | 604 |  | } |
  |  | 631 | <?php |
  |  | 632 |  |
  |  | 633 | } |
  |  | 634 |  |
  |  | 635 | /\*\* |
  |  | 636 | \* Metabox: Coupon Requirements for badge/ranks |
  |  | 637 | \* @since 2.4 |
  |  | 638 | \* @version 1.0 |
  |  | 639 | \*/ |
  |  | 640 | public function mycred\_coupon\_badges\_ranks( $post ) { |
  |  | 641 |  |
  |  | 642 | wp\_enqueue\_script( 'mycred-coupon-badge-rank-js' ); |
  |  | 643 | wp\_enqueue\_style( 'mycred-coupon-badge-rank-style' ); |
  |  | 644 | $types\_ids = mycred\_get\_post\_meta( $post->ID, 'reward' ); |
  |  | 645 | $check\_enable\_disable = mycred\_get\_post\_meta( $post->ID, 'check', true ); |
  |  | 646 | $enable\_disable = ! empty( $check\_enable\_disable ); |
  |  | 647 | $coupon = mycred\_get\_coupon( $post->ID ); |
  |  | 648 | $manual\_rank = ''; |
  |  | 649 |  |
  |  | 650 | if( class\_exists( 'myCRED\_Badge' ) ) { |
  |  | 651 | $badge\_id = mycred\_get\_badge\_ids(); |
  |  | 652 | } |
  |  | 653 | if( class\_exists( 'myCRED\_Ranks\_Module' ) ){ |
  |  | 654 | $ranks = mycred\_get\_ranks(); |
  |  | 655 | $manual\_rank = mycred\_manual\_ranks( $coupon->point\_type ); |
  |  | 656 | } |
  |  | 657 | ob\_start(); ?> |
  |  | 658 | <div class="mycred-border" > |
  |  | 659 | <div class="row"> |
  |  | 660 | <div class="mycred-title"><button type="button" class="dashicons-before dashicons-no-alt close-button" ></button><?php |
  |  | 661 | \_e( 'Reward', 'mycred' ); ?> |
  |  | 662 | </div> |
  |  | 663 | <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> |
  |  | 664 | <div class="form-group"> |
  |  | 665 | <label for="mycred-select-coupon-reward"><?php \_e( 'Select Reward Type : ', 'mycred' ); ?></label> |
  |  | 666 | <div class="mycred-select-coupon-reward" > |
  |  | 667 | <select name="mycred\_coupon[reward][types][]" class="mycred-select-coupon-rewards"><?php |
  |  | 668 | if( class\_exists( 'myCRED\_Badge' ) && ( empty( $ranks ) || ! empty( $badge\_id ) ) ){ ?> |
  |  | 669 | <option value="mycred\_coupon\_badges" ><?php \_e( 'Badges', 'mycred' ); ?></option> |
  |  | 670 | <?php } |
  |  | 671 | if( class\_exists( 'myCRED\_Ranks\_Module' ) && $manual\_rank && ( ! empty( $ranks ) || empty( $badge\_id ) ) ) { ?> |
  |  | 672 | <option value="mycred\_coupon\_ranks" ><?php \_e( 'Ranks', 'mycred' ); ?></option> |
  |  | 673 | <?php } ?> |
  |  | 674 | </select> |
  |  | 675 | </div> |
  |  | 676 | </div> |
  |  | 677 | </div> |
  |  | 678 | </div> |
  |  | 679 |  |
  |  | 680 | <div class="row"> |
  |  | 681 | <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> |
  |  | 682 | <div class="form-group"> |
  |  | 683 | <div class="ids show-badges" > |
  |  | 684 | <label for="mycred-select-coupon" id="change-text"><?php echo class\_exists( 'myCRED\_Badge' ) && ( empty( $ranks ) || ! empty( $badge\_id ) ) ? \_e( 'Badges : ', 'mycred' ) : \_e( 'Ranks : ', 'mycred' ); ?></label> |
  |  | 685 | <div class="mycred-select-coupon"><?php |
  |  | 686 | if( ! empty( $badge\_id ) || ! empty( $ranks ) ){?> |
  |  | 687 | <select name="mycred\_coupon[reward][ids][]" class="mycred-select-ids"><?php |
  |  | 688 | if( class\_exists( 'myCRED\_Badge' ) ) { |
  |  | 689 | foreach ($badge\_id as $key => $value) { |
  |  | 690 | $badges = mycred\_get\_badge( $value );?> |
  |  | 691 | <option value="<?php echo $value ?>" ><?php \_e( $badges->title ) ?></option><?php |
  |  | 692 | } |
  |  | 693 | } |
  |  | 694 | if( class\_exists( 'myCRED\_Ranks\_Module' ) && empty($badge\_id) ) { |
  |  | 695 | foreach ( $ranks as $key => $value ) { ?> |
  |  | 696 | <option value="<?php echo $value->post\_id ?>"><?php \_e( $value->post->post\_title ) ?></option><?php |
  |  | 697 | } |
  |  | 698 | }?> |
  |  | 699 | </select><?php |
  |  | 700 | } ?> |
  |  | 701 | </div> |
  |  | 702 | </div> |
  |  | 703 | </div> |
  |  | 704 | </div> |
  |  | 705 | </div> |
  |  | 706 | </div> |
  |  | 707 |  |
  |  | 708 | <?php $html = ob\_get\_clean(); ?> |
  |  | 709 |  |
  |  | 710 | <div class="mycred-badge-rank-hide-show"> |
  |  | 711 | <div class="mycred-switch"> |
  |  | 712 | <label><strong><?php \_e( 'Enable this to assign badge/ranks through coupon.', 'mycred' ); ?></strong></label> |
  |  | 713 | <label class="mycred-switch1"> |
  |  | 714 | <input type="checkbox" id="mycred-check" name="mycred\_coupon[check]" <?php echo $enable\_disable == true ? 'checked' : ''; ?>> |
  |  | 715 | <span class="slider round"></span> |
  |  | 716 | </label> |
  |  | 717 | </div> |
  |  | 718 | </div> |
  |  | 719 | <div class="form mycred-coupon-form" <?php echo $enable\_disable == true ? 'style="display: block;"' : 'style="display: none;"' ?> > |
  |  | 720 | <label class="mycred-rank-msg"> |
  |  | 721 | <strong><?php \_e( 'You can only assign Ranks when Ranks are set to Manual Mode.: ', 'mycred' ); ?></strong> |
  |  | 722 | </label><?php |
  |  | 723 |  |
  |  | 724 | if( ! empty( $types\_ids ) ){ |
  |  | 725 | foreach ( $types\_ids[0] as $keys => $values ) { |
  |  | 726 | echo $this->mycred\_coupon\_badge\_rank\_html( $values['types'], $values['ids'], $manual\_rank ); |
  |  | 727 | } |
  |  | 728 | }else { |
  |  | 729 | echo $html; |
  |  | 730 | }?> |
  |  | 731 |  |
  |  | 732 | <div><button type="button" class="mycred-addmore-button button-secondary">Add More</button></div> |
  |  | 733 | </div><?php |
  |  | 734 |  |
  |  | 735 | wp\_localize\_script( 'mycred-coupon-badge-rank-js', 'mycred\_coupon\_object', |
  |  | 736 | array( |
  |  | 737 | 'html' => $html, |
  |  | 738 | ) |
  |  | 739 | ); |
  |  | 740 | } |
  |  | 741 |  |
  |  | 742 | public function mycred\_coupon\_badge\_rank\_html( $types, $ids, $manual\_rank ){ |
  |  | 743 |  |
  |  | 744 | $selected\_type = ''; |
  |  | 745 |  |
  |  | 746 | if( class\_exists( 'myCRED\_Badge' ) ) { |
  |  | 747 | $badge\_id = mycred\_get\_badge\_ids(); |
  |  | 748 | } |
  |  | 749 | if( class\_exists( 'myCRED\_Ranks\_Module' ) ){ |
  |  | 750 | $ranks = mycred\_get\_ranks(); |
  |  | 751 | } |
  |  | 752 |  |
  |  | 753 | ?> |
  |  | 754 |  |
  |  | 755 | <div class="mycred-border" > |
  |  | 756 | <div class="row"> |
  |  | 757 | <div class="mycred-title"><button type="button" class="dashicons-before dashicons-no-alt close-button" ></button><?php |
  |  | 758 | \_e( 'Reward', 'mycred' ); ?> |
  |  | 759 | </div> |
  |  | 760 | <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> |
  |  | 761 | <div class="form-group"> |
  |  | 762 | <label for="mycred-select-coupon-reward"><?php \_e( 'Select Reward Type : ', 'mycred' ); ?></label> |
  |  | 763 | <div class="mycred-select-coupon-reward"> |
  |  | 764 | <select name="mycred\_coupon[reward][types][]" class="mycred-select-coupon-rewards"><?php |
  |  | 765 |  |
  |  | 766 | if ( class\_exists( 'myCRED\_Badge' ) ) { |
  |  | 767 |  |
  |  | 768 | if ( $types == 'mycred\_coupon\_badges' ) $selected\_type = 'badge'; |
  |  | 769 |  |
  |  | 770 | ?> |
  |  | 771 | <option value="mycred\_coupon\_badges" <?php echo $types == 'mycred\_coupon\_badges' ? 'selected="selected"' : ''; ?>><?php \_e( 'Badges', 'mycred' ); ?></option> |
  |  | 772 | <?php } |
  |  | 773 | else { |
  |  | 774 | if ( $types == 'mycred\_coupon\_badges' && class\_exists( 'myCRED\_Ranks\_Module' ) && $manual\_rank ) $selected\_type = 'rank'; |
  |  | 775 | } |
  |  | 776 | if( class\_exists( 'myCRED\_Ranks\_Module' ) && $manual\_rank ) { |
  |  | 777 |  |
  |  | 778 | if ( $types == 'mycred\_coupon\_ranks' ) $selected\_type = 'rank'; |
  |  | 779 | ?> |
  |  | 780 | <option value="mycred\_coupon\_ranks" <?php echo  $types == 'mycred\_coupon\_ranks' ? 'selected="selected"' : ''; ?>><?php \_e( 'Ranks', 'mycred' ); ?></option> |
  |  | 781 | <?php } |
  |  | 782 | else{ |
  |  | 783 | if ( $types == 'mycred\_coupon\_ranks' && class\_exists( 'myCRED\_Badge' ) ) $selected\_type = 'badge'; |
  |  | 784 | } ?> |
  |  | 785 |  |
  |  | 786 |  |
  |  | 787 | </select> |
  |  | 788 | </div> |
  |  | 789 | </div> |
  |  | 790 | </div> |
  |  | 791 |  |
  |  | 792 | </div> |
  |  | 793 |  |
  |  | 794 | <div class="row"> |
  |  | 795 | <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> |
  |  | 796 | <div class="form-group"> |
  |  | 797 | <div class="ids show-badges" > |
  |  | 798 | <label for="mycred-select-coupon" id="change-text"><?php ( ! empty( $badge\_id ) && $types == 'mycred\_coupon\_badges' ) ? \_e( 'Badges : ', 'mycred' ) : \_e( 'Ranks : ', 'mycred' ); ?></label> |
  |  | 799 | <div class="mycred-select-coupon"><?php |
  |  | 800 |  |
  |  | 801 | if( ! empty( $badge\_id ) || ! empty( $ranks ) ){?> |
  |  | 802 |  |
  |  | 803 | <select name="mycred\_coupon[reward][ids][]" class="mycred-select-ids"><?php |
  |  | 804 |  |
  |  | 805 | if( $selected\_type == 'badge' ){ |
  |  | 806 | foreach ($badge\_id as $key => $value) { |
  |  | 807 | $badges = mycred\_get\_badge( $value );?> |
  |  | 808 | <option value="<?php echo $value ?>" <?php echo  $ids == $value ? 'selected="selected"' : ''; ?>><?php \_e( $badges->title ) ?></option><?php |
  |  | 809 | } |
  |  | 810 | }elseif( $selected\_type == 'rank'  ) { |
  |  | 811 |  |
  |  | 812 | foreach ( $ranks as $key => $value ) { ?> |
  |  | 813 | <option value="<?php echo $value->post\_id ?>" <?php echo  $ids == $value->post\_id ? 'selected="selected"' : ''; ?>><?php \_e( $value->post->post\_title ) ?></option><?php |
  |  | 814 | } |
  |  | 815 | } |
  |  | 816 | ?> |
  |  | 817 |  |
  |  | 818 | </select><?php |
  |  | 819 |  |
  |  | 820 | }?> |
  |  | 821 |  |
  |  | 822 | </div> |
  |  | 823 | </div> |
  |  | 824 | </div> |
  |  | 825 | </div> |
  |  | 826 | </div> |
  |  | 827 | </div><?php |
  |  | 828 | } |
  |  | 829 |  |
  |  | 830 |  |
  |  | 831 | public function mycred\_change\_dropdown\_ajax\_handler() { |
  |  | 832 |  |
  |  | 833 | $value = sanitize\_text\_field( $\_POST['value'] ); |
  |  | 834 |  |
  |  | 835 | if( class\_exists( 'myCRED\_Badge' ) ) { |
  |  | 836 | $badge\_id = mycred\_get\_badge\_ids(); |
  |  | 837 | } |
  |  | 838 | if( class\_exists( 'myCRED\_Ranks\_Module' ) ){ |
  |  | 839 | $ranks = mycred\_get\_ranks(); |
  |  | 840 | } |
  |  | 841 |  |
  |  | 842 | if ( $value == 'mycred\_coupon\_badges' ){ |
  |  | 843 |  |
  |  | 844 | $ids\_title = array(); |
  |  | 845 | foreach ($badge\_id as $key => $value) { |
  |  | 846 |  |
  |  | 847 | $badges = mycred\_get\_badge( $value ); |
  |  | 848 | $badge\_title = $badges->title; |
  |  | 849 | $badge\_id = $value; |
  |  | 850 | $ids\_title[] =  array( $badge\_id, $badge\_title ); |
  |  | 851 |  |
  |  | 852 | } |
  |  | 853 |  |
  |  | 854 | $ids\_title = json\_encode( $ids\_title ); |
  |  | 855 |  |
  |  | 856 | echo $ids\_title; |
  |  | 857 | wp\_die(); |
  |  | 858 | } |
  |  | 859 |  |
  |  | 860 | if ( $value == 'mycred\_coupon\_ranks' ){ |
  |  | 861 |  |
  |  | 862 | $ids\_title = array(); |
  |  | 863 | foreach ($ranks as $key => $value) { |
  |  | 864 |  |
  |  | 865 | $rank\_title = $value->post->post\_title; |
  |  | 866 | $rank\_id = $value->post\_id; |
  |  | 867 | $ids\_title[] =  array( $rank\_id, $rank\_title ); |
  |  | 868 |  |
  |  | 869 | } |
  |  | 870 |  |
  |  | 871 | $ids\_title = json\_encode( $ids\_title ); |
  |  | 872 |  |
  |  | 873 | echo $ids\_title; |
  |  | 874 | wp\_die(); |
  |  | 875 | } |
  |  | 876 |  |
  |  | 877 | } |
  | 605 | 878 |  |
  | 606 | 879 | /\*\* |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L638) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L911) |  |
  | 638 | 911 |  |
  | 639 | 912 | if ( $post === NULL || ! $this->core->user\_is\_point\_editor() || ! isset( $\_POST['mycred\_coupon'] ) ) return $post\_id; |
  |  | 913 |  |
  |  | 914 | if( ! isset( $\_POST['mycred\_coupon']['check'] ) ){ |
  |  | 915 | $\_POST['mycred\_coupon']['check'] = false; |
  |  | 916 | } |
  | 640 | 917 |  |
  | 641 | 918 | foreach ( $\_POST['mycred\_coupon'] as $meta\_key => $meta\_value ) { |
  | 642 | 919 |  |
  | 643 |  | $new\_value = sanitize\_text\_field( $meta\_value ); |
  |  | 920 | if( $meta\_key == 'reward' ){ |
  |  | 921 |  |
  |  | 922 | $types\_ids = array(); |
  |  | 923 | foreach ($meta\_value['types'] as $key => $value) { |
  |  | 924 |  |
  |  | 925 | $reward\_value = sanitize\_text\_field( $value ); |
  |  | 926 | $reward\_id = sanitize\_text\_field( $meta\_value['ids'][$key] ); |
  |  | 927 |  |
  |  | 928 | $types\_ids[] = array( 'types' => $reward\_value ,  'ids' => $reward\_id ) ; |
  |  | 929 |  |
  |  | 930 | } |
  |  | 931 |  |
  |  | 932 | $new\_value = $types\_ids; |
  |  | 933 | } |
  |  | 934 | else{ |
  |  | 935 |  |
  |  | 936 | $new\_value = sanitize\_text\_field( $meta\_value ); |
  |  | 937 | } |
  | 644 | 938 |  |
  | 645 | 939 | // Make sure we provide a valid date that strtotime() can understand |
  | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2621330#L657) | […](/browser/mycred/trunk/addons/coupons/myCRED-addon-coupons.php?rev=2648350#L951) |  |
  | 657 | 951 | // No need to update if it's still the same value |
  | 658 | 952 | $old\_value = mycred\_get\_post\_meta( $post\_id, $meta\_key, true ); |
  |  | 953 |  |
  | 659 | 954 | if ( $new\_value != $old\_value ) |
  | 660 | 955 | mycred\_update\_post\_meta( $post\_id, $meta\_key, $new\_value ); |
  | 661 |  |  |
  | 662 | 956 | } |
  | 663 | 957 |  |
* ## [mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php](/changeset/2648350/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php "Show the changeset 2648350 restricted to mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php")

  | [r2582075](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2582075#L595 "Show revision 2582075 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2648350#L595 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 595 | 595 | <div class="form-group"> |
  | 596 | 596 | <label for="mycred-email-instance"<?php if ( $post->post\_status == 'publish' && empty( $trigger ) ) echo ' style="color:red;font-weight:bold;"'; ?>><?php \_e( 'Send this email notice when...', 'mycred' ); ?></label> |
  | 597 |  | <select name="mycred\_email[instance]" id="mycred-email-instance" class="form-control"> |
  |  | 597 | <select name="mycred\_email[instance]" id="mycred-email-instance" class="form-control mycred-email-instance-options"> |
  | 598 | 598 | <?php |
  | 599 | 599 |  |
  | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2582075#L644) | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2648350#L644) |  |
  | 644 | 644 | <?php |
  | 645 | 645 |  |
  | 646 |  | if ( count( $this->point\_types ) > 1 ) { |
  | 647 |  |  |
  | 648 |  | mycred\_types\_select\_from\_checkboxes( 'mycred\_email[ctype][]', 'mycred-email-ctype', $email->point\_types ); |
  |  | 646 |  |
  |  | 647 |  |
  |  | 648 | if ( count( $this->point\_types ) > 1  ) { |
  |  | 649 |  |
  |  | 650 | $point\_types\_html = mycred\_types\_select\_from\_checkboxes( 'mycred\_email[ctype][]', 'mycred-email-ctype', $email->point\_types, true ); |
  |  | 651 |  |
  |  | 652 |  |
  |  | 653 | echo apply\_filters( 'mycred\_point\_type\_checkbox', $point\_types\_html ); |
  | 649 | 654 |  |
  | 650 | 655 | } |
  | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2582075#L663) | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2648350#L668) |  |
  | 663 | 668 |  |
  | 664 | 669 | </div> |
  |  | 670 | <?php do\_action('mycred\_after\_email\_triggers', $post); ?> |
  | 665 | 671 | <hr /> |
  | 666 | 672 |  |
  | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2582075#L1001) | […](/browser/mycred/trunk/addons/email-notices/myCRED-addon-email-notices.php?rev=2648350#L1007) |  |
  | 1001 | 1007 | if ( ! empty( $\_POST['mycred\_email']['styling'] ) ) |
  | 1002 | 1008 | mycred\_update\_post\_meta( $post\_id, 'mycred\_email\_styling', wp\_kses\_post( $\_POST['mycred\_email']['styling'] ) ); |
  | 1003 |  |  |
  |  | 1009 |  |
  |  | 1010 | do\_action( 'mycred\_save\_email\_notice', $post\_id ); |
  | 1004 | 1011 | } |
  | 1005 | 1012 |  |
* ## [mycred/trunk/addons/ranks/myCRED-addon-ranks.php](/changeset/2648350/mycred/trunk/addons/ranks/myCRED-addon-ranks.php "Show the changeset 2648350 restricted to mycred/trunk/addons/ranks/myCRED-addon-ranks.php")

  | [r2621330](/browser/mycred/trunk/addons/ranks/myCRED-addon-ranks.php?rev=2621330#L1520 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/addons/ranks/myCRED-addon-ranks.php?rev=2648350#L1520 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 1520 | 1520 | if ( ! $this->is\_manual\_mode( $point\_type ) ) |
  | 1521 | 1521 | mycred\_assign\_ranks( $point\_type ); |
  |  | 1522 |  |
  |  | 1523 | // Let others play |
  |  | 1524 | do\_action( 'mycred\_save\_rank', $post\_id ); |
  | 1522 | 1525 |  |
  | 1523 | 1526 | } |
* ## [mycred/trunk/assets/css/mycred-admin.css](/changeset/2648350/mycred/trunk/assets/css/mycred-admin.css "Show the changeset 2648350 restricted to mycred/trunk/assets/css/mycred-admin.css")

  | [r2621330](/browser/mycred/trunk/assets/css/mycred-admin.css?rev=2621330#L203 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/assets/css/mycred-admin.css?rev=2648350#L203 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 203 | 203 | content: ''; |
  | 204 | 204 | } |
  |  | 205 |  |
  |  | 206 | .v-align-middle{ |
  |  | 207 | vertical-align: middle; |
  |  | 208 | } |
  |  | 209 |  |
  |  | 210 | .mycred-tools-import-export table tr td { |
  |  | 211 | width: 215px; |
  |  | 212 | } |
  |  | 213 |  |
  |  | 214 | .mycred-tools-import-export table tr td:nth-last-child( 1 ) { |
  |  | 215 | width: max-content; |
  |  | 216 | } |
  |  | 217 |  |
  |  | 218 | .mycred-tools-import-export table tr { |
  |  | 219 | height: 55px; |
  |  | 220 | } |
  |  | 221 |  |
  |  | 222 | .mycred-tools-import-export .mycred-container{ |
  |  | 223 | padding: 10px 0; |
  |  | 224 | } |
  |  | 225 |  |
  |  | 226 | .mycred-tools-import-export .mycred-container label{ |
  |  | 227 | display: block; |
  |  | 228 | } |
  |  | 229 | #myCRED-wrap .mycred-tools-setup ol { |
  |  | 230 | margin-block-start: 1em; |
  |  | 231 | margin-block-end: 1em; |
  |  | 232 | margin-inline-start: 0px; |
  |  | 233 | margin-inline-end: 0px; |
  |  | 234 | padding: 0px; |
  |  | 235 | padding-inline-start: 40px; |
  |  | 236 | margin-bottom: 0px; |
  |  | 237 | } |
  |  | 238 |  |
  |  | 239 | .mycred-tools-setup, .mycred-tools-setup-export{ |
  |  | 240 | float: left; |
  |  | 241 | width: 50%; |
  |  | 242 | } |
* ## [mycred/trunk/assets/css/mycred-front.css](/changeset/2648350/mycred/trunk/assets/css/mycred-front.css "Show the changeset 2648350 restricted to mycred/trunk/assets/css/mycred-front.css")

  | [r2621330](/browser/mycred/trunk/assets/css/mycred-front.css?rev=2621330#L1 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/assets/css/mycred-front.css?rev=2648350#L1 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | .widget .myCRED-rank{float:right}.widget .myCRED-rank span{padding-right:4px;color:gray}.widget .myCRED-balance{display:block;margin-bottom:24px;text-align:center;font-size:larger}.widget .myCRED-leaderboard .cred{float:right}.widget .myCRED-leaderboard .first-item{font-size:110%}.widget .myCRED-history{padding:0;margin:0;list-style-type:none}.widget .myCRED-history .creds{float:right;padding:0;clear:left}.mycred-nav-rank img{display:inherit}button.mycred-submit-transfer.btn.btn-primary.btn-block.btn-lg{margin:20px 0}input.mycred-autofill.form-control.ui-autocomplete-input{margin-left:20px}.mycred-transfer-form input.form-control{margin-left:28px;margin-top:10px}.site .button:focus,.wp-block-button .wp-block-button\_\_link:focus,.wp-block-search\_\_button:focus,input[type=reset]:focus,input[type=submit]:focus{background:0;outline-offset:-6px;outline:2px solid currentColor}.site textarea:focus,input[type=color]:focus,input[type=date]:focus,input[type=datetime-local]:focus,input[type=datetime]:focus,input[type=email]:focus,input[type=month]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=time]:focus,input[type=url]:focus,input[type=week]:focus{color:var(--form--color-text);outline-offset:2px;outline:0}.site .button:focus,.wp-block-button .wp-block-button\_\_link:focus,.wp-block-search\_\_button:focus,input[type=reset]:focus,input[type=submit]:focus{background:0;outline-offset:-6px;outline:0}span.form-control-static{text-transform:capitalize;font-weight:400;margin-left:20px}p.form-control-static{margin:0 16px}form#mycred-transfer-form-transfer{background:#f9f9f9;padding:25px;box-shadow:0 0 20px 0 rgb(0 0 0 / 20%),0 5px 5px 0 rgb(0 0 0 / 24%);border-radius:10px}form#mycred-transfer-form-donation{background:#f9f9f9;padding:25px;margin:150px 0;box-shadow:0 0 20px 0 rgb(0 0 0 / 20%),0 5px 5px 0 rgb(0 0 0 / 24%);border-radius:10px}input#mycred-transfer-form-message-field{margin-left:24px}span#mycred-transfer-form-amount-field{margin-left:28px}.mycred-badges-list-item img{width:25%;display:inline-block;float:left}.mycred-badges-list-item h3{color:red}.mycred-badges-list-item .mycred-left{float:left;width:72%;margin-left:15px}.mycred-badges-list-item .clear{clear:both}.mycred-badges-list-item .mycred-mr-l{margin-left:25px}.mycred-badges-list-item{border-top:0 solid #9c9c9c;min-height:180px;padding:15px 0;cursor:pointer}.mycred-badges-list-item~.mycred-badges-list-item{border-top-width:1px}.mycred-badges-list h3:first-child{margin-bottom:15px;margin-top:0}.mycred-badges-list-item.not-earned{filter:grayscale(1)}.mycred-tabset .mycred-badge-count{color:#fff;font-size:18px;background:#0173aa;border-radius:50%;padding:0 7px}.mycred-badges-list-item .mycred-sup-category{background:#0173aa;color:#fff;margin:0 3px;padding:2px 6px;font-size:14px;border-radius:4px}ul.mycred-badges-list-tabs{list-style-type:none;display:flex;margin:0;padding:0}ul.mycred-badges-list-tabs li{padding:10px;cursor:pointer;border:1px solid transparent;margin-right:5px;margin-bottom:-1px}ul.mycred-badges-list-tabs li.active{border:1px solid #47525d;border-bottom:1px solid #ccc}.mycred-badges-list-panels{border-top:1px solid #47525d}.mycred-badges-list-panel.active{display:initial}.mycred-badges-list-panel{display:none}.mycred-badge-count{color:#fff;font-size:18px;background:#0173aa;border-radius:50%;padding:0 7px;margin-left:5px}.mycred-badge-page .mycred-level-image{width:150px}.mycred-badge-page .mycred-badge-page-level{float:left;width:30%;text-align:center}.mycred-badge-page .mycred-level-requirement{font-size:19px;text-align:left}.mycred-badge-page .mycred-badge-image{width:150px}.mycred-badge-page-level .mycred-level-image{width:70px}.mycred-float-left{float:left}.mycred-float-right{float:right}.mycred-badge-earner-grid img{width:150px;height:150px;padding:10px}.mycred-badge-earner-grid h4{margin:0}.mycred-badge-earner-grid{text-align:center}.mycred-badges-list-item p{margin-top:0}.mycred-left{float:left}.mycred-right{float:right}.mycred-clear{clear:both}.mycred-remove-margin{margin:0}.mycred-remove-padding{padding:0}.mycred-evidence-page .intro{margin-left:45px}.mycred-evidence-page p{font-size:19px;margin:0}.mycred-evidence-page a{text-decoration:none;color:red}.mycred-evidence-page .dashicons-yes-alt{line-height:inherit;color:green}.mycred-badge-page-level ul{margin-left:0;padding-left:20px}.mycred-badge-page-level .mycred-level-reward{text-align:left}.mycred-level-reward{margin-bottom:15px}.mycred-badge-page-level{margin-right:15px}.mycred-badges-list-item:hover{background:#efefef}.mycred-badge-congratulation-msg{background:#f0f0f0;padding:25px 10px;margin:20px 0;border-radius:5px}li.mycred-strike-off{text-decoration:line-through}.mycred-search-bar{padding:10px 0}.mycred-history-wrapper .pagination>li{display:inline-block;padding:5px}.mycred-badge-page-level h4 {text-align: left;} |
  |  | 1 | .widget .myCRED-rank { |
  |  | 2 | float: right; |
  |  | 3 | } |
  |  | 4 | .widget .myCRED-rank span { |
  |  | 5 | padding-right: 4px; |
  |  | 6 | color: gray; |
  |  | 7 | } |
  |  | 8 | .widget .myCRED-balance { |
  |  | 9 | display: block; |
  |  | 10 | margin-bottom: 24px; |
  |  | 11 | text-align: center; |
  |  | 12 | font-size: larger; |
  |  | 13 | } |
  |  | 14 | .widget .myCRED-leaderboard .cred { |
  |  | 15 | float: right; |
  |  | 16 | } |
  |  | 17 | .widget .myCRED-leaderboard .first-item { |
  |  | 18 | font-size: 110%} |
  |  | 19 | .widget .myCRED-history { |
  |  | 20 | padding: 0; |
  |  | 21 | margin: 0; |
  |  | 22 | list-style-type: none; |
  |  | 23 | } |
  |  | 24 | .widget .myCRED-history .creds { |
  |  | 25 | float: right; |
  |  | 26 | padding: 0; |
  |  | 27 | clear: left; |
  |  | 28 | } |
  |  | 29 | .mycred-nav-rank img { |
  |  | 30 | display: inherit; |
  |  | 31 | } |
  |  | 32 | button.mycred-submit-transfer.btn.btn-primary.btn-block.btn-lg { |
  |  | 33 | margin: 20px 0; |
  |  | 34 | } |
  |  | 35 | input.mycred-autofill.form-control.ui-autocomplete-input { |
  |  | 36 | margin-left: 20px; |
  |  | 37 | } |
  |  | 38 | .mycred-transfer-form input.form-control { |
  |  | 39 | margin-left: 28px; |
  |  | 40 | margin-top: 10px; |
  |  | 41 | } |
  |  | 42 |  |
  |  | 43 | span.form-control-static { |
  |  | 44 | text-transform: capitalize; |
  |  | 45 | font-weight: 400; |
  |  | 46 | margin-left: 20px; |
  |  | 47 | } |
  |  | 48 | p.form-control-static { |
  |  | 49 | margin: 0 16px; |
  |  | 50 | } |
  |  | 51 | form#mycred-transfer-form-transfer { |
  |  | 52 | background: #f9f9f9; |
  |  | 53 | padding: 25px; |
  |  | 54 | box-shadow: 0 0 20px 0 rgb(0 0 0 / 20%), 0 5px 5px 0 rgb(0 0 0 / 24%); |
  |  | 55 | border-radius: 10px; |
  |  | 56 | } |
  |  | 57 | form#mycred-transfer-form-donation { |
  |  | 58 | background: #f9f9f9; |
  |  | 59 | padding: 25px; |
  |  | 60 | margin: 150px 0; |
  |  | 61 | box-shadow: 0 0 20px 0 rgb(0 0 0 / 20%), 0 5px 5px 0 rgb(0 0 0 / 24%); |
  |  | 62 | border-radius: 10px; |
  |  | 63 | } |
  |  | 64 | input#mycred-transfer-form-message-field { |
  |  | 65 | margin-left: 24px; |
  |  | 66 | } |
  |  | 67 | span#mycred-transfer-form-amount-field { |
  |  | 68 | margin-left: 28px; |
  |  | 69 | } |
  |  | 70 | .mycred-badges-list-item img { |
  |  | 71 | width: 25%; |
  |  | 72 | display: inline-block; |
  |  | 73 | float: left; |
  |  | 74 | } |
  |  | 75 | .mycred-badges-list-item h3 { |
  |  | 76 | color: red; |
  |  | 77 | } |
  |  | 78 | .mycred-badges-list-item .mycred-left { |
  |  | 79 | float: left; |
  |  | 80 | width: 72%; |
  |  | 81 | margin-left: 15px; |
  |  | 82 | } |
  |  | 83 | .mycred-badges-list-item .clear { |
  |  | 84 | clear: both; |
  |  | 85 | } |
  |  | 86 | .mycred-badges-list-item .mycred-mr-l { |
  |  | 87 | margin-left: 25px; |
  |  | 88 | } |
  |  | 89 | .mycred-badges-list-item { |
  |  | 90 | border-top: 0 solid #9c9c9c; |
  |  | 91 | min-height: 180px; |
  |  | 92 | padding: 15px 0; |
  |  | 93 | cursor: pointer; |
  |  | 94 | } |
  |  | 95 | .mycred-badges-list-item~.mycred-badges-list-item { |
  |  | 96 | border-top-width: 1px; |
  |  | 97 | } |
  |  | 98 | .mycred-badges-list h3:first-child { |
  |  | 99 | margin-bottom: 15px; |
  |  | 100 | margin-top: 0; |
  |  | 101 | } |
  |  | 102 | .mycred-badges-list-item.not-earned { |
  |  | 103 | filter: grayscale(1); |
  |  | 104 | } |
  |  | 105 | .mycred-tabset .mycred-badge-count { |
  |  | 106 | color: #fff; |
  |  | 107 | font-size: 18px; |
  |  | 108 | background: #0173aa; |
  |  | 109 | border-radius: 50%; |
  |  | 110 | padding: 0 7px; |
  |  | 111 | } |
  |  | 112 | .mycred-badges-list-item .mycred-sup-category { |
  |  | 113 | background: #0173aa; |
  |  | 114 | color: #fff; |
  |  | 115 | margin: 0 3px; |
  |  | 116 | padding: 2px 6px; |
  |  | 117 | font-size: 14px; |
  |  | 118 | border-radius: 4px; |
  |  | 119 | } |
  |  | 120 | ul.mycred-badges-list-tabs { |
  |  | 121 | list-style-type: none; |
  |  | 122 | display: flex; |
  |  | 123 | margin: 0; |
  |  | 124 | padding: 0; |
  |  | 125 | } |
  |  | 126 | ul.mycred-badges-list-tabs li { |
  |  | 127 | padding: 10px; |
  |  | 128 | cursor: pointer; |
  |  | 129 | border: 1px solid transparent; |
  |  | 130 | margin-right: 5px; |
  |  | 131 | margin-bottom: -1px; |
  |  | 132 | } |
  |  | 133 | ul.mycred-badges-list-tabs li.active { |
  |  | 134 | border: 1px solid #47525d; |
  |  | 135 | border-bottom: 1px solid #ccc; |
  |  | 136 | } |
  |  | 137 | .mycred-badges-list-panels { |
  |  | 138 | border-top: 1px solid #47525d; |
  |  | 139 | } |
  |  | 140 | .mycred-badges-list-panel.active { |
  |  | 141 | display: initial; |
  |  | 142 | } |
  |  | 143 | .mycred-badges-list-panel { |
  |  | 144 | display: none; |
  |  | 145 | } |
  |  | 146 | .mycred-badge-count { |
  |  | 147 | color: #fff; |
  |  | 148 | font-size: 18px; |
  |  | 149 | background: #0173aa; |
  |  | 150 | border-radius: 50%; |
  |  | 151 | padding: 0 7px; |
  |  | 152 | margin-left: 5px; |
  |  | 153 | } |
  |  | 154 | .mycred-badge-page .mycred-level-image { |
  |  | 155 | width: 150px; |
  |  | 156 | } |
  |  | 157 | .mycred-badge-page .mycred-badge-page-level { |
  |  | 158 | float: left; |
  |  | 159 | width: 30%; |
  |  | 160 | text-align: center; |
  |  | 161 | } |
  |  | 162 | .mycred-badge-page .mycred-level-requirement { |
  |  | 163 | font-size: 19px; |
  |  | 164 | text-align: left; |
  |  | 165 | } |
  |  | 166 | .mycred-badge-page .mycred-badge-image { |
  |  | 167 | width: 150px; |
  |  | 168 | } |
  |  | 169 | .mycred-badge-page-level .mycred-level-image { |
  |  | 170 | width: 70px; |
  |  | 171 | } |
  |  | 172 | .mycred-float-left { |
  |  | 173 | float: left; |
  |  | 174 | } |
  |  | 175 | .mycred-float-right { |
  |  | 176 | float: right; |
  |  | 177 | } |
  |  | 178 | .mycred-badge-earner-grid img { |
  |  | 179 | width: 150px; |
  |  | 180 | height: 150px; |
  |  | 181 | padding: 10px; |
  |  | 182 | } |
  |  | 183 | .mycred-badge-earner-grid h4 { |
  |  | 184 | margin: 0; |
  |  | 185 | } |
  |  | 186 | .mycred-badge-earner-grid { |
  |  | 187 | text-align: center; |
  |  | 188 | } |
  |  | 189 | .mycred-badges-list-item p { |
  |  | 190 | margin-top: 0; |
  |  | 191 | } |
  |  | 192 | .mycred-left { |
  |  | 193 | float: left; |
  |  | 194 | } |
  |  | 195 | .mycred-right { |
  |  | 196 | float: right; |
  |  | 197 | } |
  |  | 198 | .mycred-clear { |
  |  | 199 | clear: both; |
  |  | 200 | } |
  |  | 201 | .mycred-remove-margin { |
  |  | 202 | margin: 0; |
  |  | 203 | } |
  |  | 204 | .mycred-remove-padding { |
  |  | 205 | padding: 0; |
  |  | 206 | } |
  |  | 207 | .mycred-evidence-page .intro { |
  |  | 208 | margin-left: 45px; |
  |  | 209 | } |
  |  | 210 | .mycred-evidence-page p { |
  |  | 211 | font-size: 19px; |
  |  | 212 | margin: 0; |
  |  | 213 | } |
  |  | 214 | .mycred-evidence-page a { |
  |  | 215 | text-decoration: none; |
  |  | 216 | color: red; |
  |  | 217 | } |
  |  | 218 | .mycred-evidence-page .dashicons-yes-alt { |
  |  | 219 | line-height: inherit; |
  |  | 220 | color: green; |
  |  | 221 | } |
  |  | 222 | .mycred-badge-page-level ul { |
  |  | 223 | margin-left: 0; |
  |  | 224 | padding-left: 20px; |
  |  | 225 | } |
  |  | 226 | .mycred-badge-page-level .mycred-level-reward { |
  |  | 227 | text-align: left; |
  |  | 228 | } |
  |  | 229 | .mycred-level-reward { |
  |  | 230 | margin-bottom: 15px; |
  |  | 231 | } |
  |  | 232 | .mycred-badge-page-level { |
  |  | 233 | margin-right: 15px; |
  |  | 234 | } |
  |  | 235 | .mycred-badges-list-item:hover { |
  |  | 236 | background: #efefef; |
  |  | 237 | } |
  |  | 238 | .mycred-badge-congratulation-msg { |
  |  | 239 | background: #f0f0f0; |
  |  | 240 | padding: 25px 10px; |
  |  | 241 | margin: 20px 0; |
  |  | 242 | border-radius: 5px; |
  |  | 243 | } |
  |  | 244 | li.mycred-strike-off { |
  |  | 245 | text-decoration: line-through; |
  |  | 246 | } |
  |  | 247 | .mycred-search-bar { |
  |  | 248 | padding: 10px 0; |
  |  | 249 | } |
  |  | 250 | .mycred-history-wrapper .pagination>li { |
  |  | 251 | display: inline-block; |
  |  | 252 | padding: 5px; |
  |  | 253 | } |
  |  | 254 | .mycred-badge-page-level h4  { |
  |  | 255 | text-align:  left; |
  |  | 256 | } |
  |  | 257 |  |
  | 2 | 258 |  |
  | 3 | 259 |  |
* ## [mycred/trunk/assets/js/mycred-tools.js](/changeset/2648350/mycred/trunk/assets/js/mycred-tools.js "Show the changeset 2648350 restricted to mycred/trunk/assets/js/mycred-tools.js")

  | [r2621330](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L1 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L1 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(~~document ).ready(~~ function() { |
  | 2 |  |  |
  | 3 |  | var $selector = jQuery(~~'.bulk-award-type'~~ ); |
  |  | 1 | jQuery(document).ready(function() { |
  |  | 2 |  |
  |  | 3 | var $selector = jQuery('.bulk-award-type'); |
  | 4 | 4 |  |
  | 5 | 5 | $selector.select2(); |
  | 6 | 6 |  |
  | 7 |  | $selector.on( "select2:select", function ( e ) { |
  | 8 |  | if( e.params.data.id == 'points' ) |
  | 9 |  | { |
  | 10 |  | jQuery( '.bulk-award-point' ).fadeIn(); |
  | 11 |  | jQuery( '.bulk-award-badge' ).fadeOut(); |
  | 12 |  | jQuery( '.bulk-award-rank' ).fadeOut(); |
  | 13 |  | jQuery( '.tools-revoke-btn' ).remove(); |
  | 14 |  | jQuery( '.tools-bulk-assign-award-btn' ).addClass( 'award-points' ); |
  | 15 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-badges' ); |
  | 16 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-ranks' ); |
  | 17 |  | jQuery( '.tools-bulk-assign-award-btn' ).html(`Update <span class="dashicons dashicons-update mycred-button1"></span> `); |
  | 18 |  | } |
  | 19 |  | else if( e.params.data.id == 'badges' ) |
  | 20 |  | { |
  | 21 |  | jQuery( '.bulk-award-badge' ).fadeIn(); |
  | 22 |  | jQuery( '.bulk-award-point' ).fadeOut(); |
  | 23 |  | jQuery( '.bulk-award-rank' ).fadeOut(); |
  | 24 |  | jQuery( '.tools-bulk-assign-award-btn' ).after( |
  |  | 7 | $selector.on("select2:select", function(e) { |
  |  | 8 | if (e.params.data.id == 'points') { |
  |  | 9 | jQuery('.bulk-award-point').fadeIn(); |
  |  | 10 | jQuery('.bulk-award-badge').fadeOut(); |
  |  | 11 | jQuery('.bulk-award-rank').fadeOut(); |
  |  | 12 | jQuery('.tools-revoke-btn').remove(); |
  |  | 13 | jQuery('.tools-bulk-assign-award-btn').addClass('award-points'); |
  |  | 14 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-badges'); |
  |  | 15 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-ranks'); |
  |  | 16 | jQuery('.tools-bulk-assign-award-btn').html(`Update <span class="dashicons dashicons-update mycred-button1"></span> `); |
  |  | 17 | } else if (e.params.data.id == 'badges') { |
  |  | 18 | jQuery('.bulk-award-badge').fadeIn(); |
  |  | 19 | jQuery('.bulk-award-point').fadeOut(); |
  |  | 20 | jQuery('.bulk-award-rank').fadeOut(); |
  |  | 21 | jQuery('.tools-bulk-assign-award-btn').after( |
  | 25 | 22 | `<button class="button button-large large button-primary tools-revoke-btn" style="margin-left: 10px;"> |
  | 26 | 23 | <span class="dashicons dashicons-update mycred-button1"></span> |
  | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L28) | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L25) |  |
  | 28 | 25 | </button>` |
  | 29 | 26 | ); |
  | 30 |  | jQuery( '.tools-bulk-assign-award-btn' ).html(`<span class="dashicons dashicons-update mycred-button1"></span> Award`); |
  | 31 |  | jQuery( '.tools-bulk-assign-award-btn' ).addClass( 'award-badges' ); |
  | 32 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-points' ); |
  | 33 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-ranks' ); |
  | 34 |  | } |
  | 35 |  | else if( e.params.data.id == 'ranks' ) |
  | 36 |  | { |
  | 37 |  | jQuery( '.bulk-award-rank' ).fadeIn(); |
  | 38 |  | jQuery( '.bulk-award-point' ).fadeOut(); |
  | 39 |  | jQuery( '.bulk-award-badge' ).fadeOut(); |
  | 40 |  | jQuery( '.tools-revoke-btn' ).remove(); |
  | 41 |  | jQuery( '.tools-bulk-assign-award-btn' ).addClass( 'award-ranks' ); |
  | 42 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-points' ); |
  | 43 |  | jQuery( '.tools-bulk-assign-award-btn' ).removeClass( 'award-badges' ); |
  | 44 |  | jQuery( '.tools-bulk-assign-award-btn' ).html(`Update <span class="dashicons dashicons-update mycred-button1"></span>`); |
  | 45 |  | } |
  | 46 |  | } ); |
  |  | 27 | jQuery('.tools-bulk-assign-award-btn').html(`<span class="dashicons dashicons-update mycred-button1"></span> Award`); |
  |  | 28 | jQuery('.tools-bulk-assign-award-btn').addClass('award-badges'); |
  |  | 29 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-points'); |
  |  | 30 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-ranks'); |
  |  | 31 | } else if (e.params.data.id == 'ranks') { |
  |  | 32 | jQuery('.bulk-award-rank').fadeIn(); |
  |  | 33 | jQuery('.bulk-award-point').fadeOut(); |
  |  | 34 | jQuery('.bulk-award-badge').fadeOut(); |
  |  | 35 | jQuery('.tools-revoke-btn').remove(); |
  |  | 36 | jQuery('.tools-bulk-assign-award-btn').addClass('award-ranks'); |
  |  | 37 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-points'); |
  |  | 38 | jQuery('.tools-bulk-assign-award-btn').removeClass('award-badges'); |
  |  | 39 | jQuery('.tools-bulk-assign-award-btn').html(`Update <span class="dashicons dashicons-update mycred-button1"></span>`); |
  |  | 40 | } |
  |  | 41 | }); |
  | 47 | 42 |  |
  | 48 | 43 | //Log Entry |
  | 49 |  | var $logEntry = jQuery(~~'.log-entry' ).is( ':checked'~~ ); |
  | 50 |  |  |
  | 51 |  | if~~( $logEntry~~ ) |
  | 52 |  | jQuery(~~'.log-entry-row'~~ ).show(); |
  |  | 44 | var $logEntry = jQuery('.log-entry').is(':checked'); |
  |  | 45 |  |
  |  | 46 | if ($logEntry) |
  |  | 47 | jQuery('.log-entry-row').show(); |
  | 53 | 48 | else |
  | 54 |  | jQuery(~~'.log-entry-row'~~ ).hide(); |
  |  | 49 | jQuery('.log-entry-row').hide(); |
  | 55 | 50 |  |
  | 56 | 51 | jQuery(".log-entry").change(function() { |
  | 57 |  | if~~( this.checked )~~ |
  | 58 |  | jQuery(~~'.log-entry-row'~~ ).show(); |
  |  | 52 | if (this.checked) |
  |  | 53 | jQuery('.log-entry-row').show(); |
  | 59 | 54 | else |
  | 60 |  | jQuery(~~'.log-entry-row'~~ ).hide(); |
  |  | 55 | jQuery('.log-entry-row').hide(); |
  | 61 | 56 | }); |
  | 62 | 57 |  |
  | 63 | 58 |  |
  | 64 | 59 | //Pointtype |
  | 65 |  | $selector = jQuery(~~'.bulk-award-pt'~~ ); |
  | 66 |  | $selector.select2({ |
  | 67 |  |  |
  | 68 |  | }); |
  |  | 60 | $selector = jQuery('.bulk-award-pt'); |
  |  | 61 | $selector.select2({ |
  |  | 62 |  |
  |  | 63 | }); |
  | 69 | 64 |  |
  | 70 | 65 | //Users |
  | 71 |  | $selector = jQuery(~~'.bulk-users'~~ ); |
  |  | 66 | $selector = jQuery('.bulk-users'); |
  | 72 | 67 | $selector.select2(); |
  | 73 | 68 |  |
  | 74 |  | var $awardToAll = jQuery(~~'.award-to-all' ).is( ':checked'~~ ); |
  | 75 |  |  |
  | 76 |  | if~~( !$awardToAll~~ ) |
  | 77 |  | jQuery(~~'.users-row'~~ ).show(); |
  |  | 69 | var $awardToAll = jQuery('.award-to-all').is(':checked'); |
  |  | 70 |  |
  |  | 71 | if (!$awardToAll) |
  |  | 72 | jQuery('.users-row').show(); |
  | 78 | 73 | else |
  | 79 |  | jQuery(~~'.users-row'~~ ).hide(); |
  |  | 74 | jQuery('.users-row').hide(); |
  | 80 | 75 |  |
  | 81 | 76 | jQuery(".award-to-all").change(function() { |
  | 82 |  | if~~( !this.checked )~~ |
  | 83 |  | jQuery(~~'.users-row'~~ ).show(); |
  |  | 77 | if (!this.checked) |
  |  | 78 | jQuery('.users-row').show(); |
  | 84 | 79 | else |
  | 85 |  | jQuery(~~'.users-row'~~ ).hide(); |
  |  | 80 | jQuery('.users-row').hide(); |
  | 86 | 81 | }); |
  | 87 | 82 |  |
  | 88 | 83 | //User Roles |
  | 89 |  | $selector = jQuery(~~'.bulk-roles'~~ ); |
  |  | 84 | $selector = jQuery('.bulk-roles'); |
  | 90 | 85 | $selector.select2(); |
  | 91 | 86 |  |
  | 92 | 87 |  |
  | 93 | 88 | //Badges |
  | 94 |  | $selector = jQuery(~~'.bulk-badges'~~ ); |
  |  | 89 | $selector = jQuery('.bulk-badges'); |
  | 95 | 90 | $selector.select2(); |
  | 96 | 91 |  |
  | 97 | 92 | //Ranks |
  | 98 |  | $selector = jQuery(~~'.bulk-ranks'~~ ); |
  |  | 93 | $selector = jQuery('.bulk-ranks'); |
  | 99 | 94 | $selector.select2(); |
  | 100 | 95 |  |
  | 101 | 96 | //Bulk Assign AJAX |
  | 102 |  | jQuery(~~document ).on( 'click', '.tools-bulk-assign-award-btn', function(e)~~{ |
  |  | 97 | jQuery(document).on('click', '.tools-bulk-assign-award-btn', function(e) { |
  | 103 | 98 |  |
  | 104 | 99 | e.preventDefault(); |
  | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L106) | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L101) |  |
  | 106 | 101 | var $confirm; |
  | 107 | 102 |  |
  | 108 |  | var $selectedType = jQuery(~~'.bulk-award-type' ).find( ':selected'~~ ).val(); |
  | 109 |  | var $pointsToAward = jQuery(~~'[name="bulk\_award\_point"]'~~ ).val(); |
  | 110 |  | var $pointType = jQuery(~~'[name="bulk\_award\_pt"]'~~ ).val(); |
  | 111 |  | var $logEntry = jQuery(~~'.log-entry'~~ ).prop('checked'); |
  | 112 |  | var $logEntryText = jQuery(~~'[name="log\_entry\_text"]'~~ ).val(); |
  | 113 |  | var $awardToAllUsers = jQuery(~~'.award-to-all'~~ ).prop('checked'); |
  | 114 |  | var $users = JSON.stringify(~~jQuery( '[name="bulk\_users"]' ).val()~~ ); |
  | 115 |  | var $user\_roles = JSON.stringify(~~jQuery( '[name="bulk\_roles"]' ).val()~~ ); |
  | 116 |  |  |
  | 117 |  | if~~( $pointsToAward < 0~~ ) |
  | 118 |  | $confirm = confirm(~~mycredTools.revokeConfirmText~~ ); |
  |  | 103 | var $selectedType = jQuery('.bulk-award-type').find(':selected').val(); |
  |  | 104 | var $pointsToAward = jQuery('[name="bulk\_award\_point"]').val(); |
  |  | 105 | var $pointType = jQuery('[name="bulk\_award\_pt"]').val(); |
  |  | 106 | var $logEntry = jQuery('.log-entry').prop('checked'); |
  |  | 107 | var $logEntryText = jQuery('[name="log\_entry\_text"]').val(); |
  |  | 108 | var $awardToAllUsers = jQuery('.award-to-all').prop('checked'); |
  |  | 109 | var $users = JSON.stringify(jQuery('[name="bulk\_users"]').val()); |
  |  | 110 | var $user\_roles = JSON.stringify(jQuery('[name="bulk\_roles"]').val()); |
  |  | 111 |  |
  |  | 112 | if ($pointsToAward < 0) |
  |  | 113 | $confirm = confirm(mycredTools.revokeConfirmText); |
  | 119 | 114 | else |
  | 120 |  | $confirm = confirm(~~mycredTools.awardConfirmText~~ ); |
  | 121 |  |  |
  | 122 |  | if~~( !$confirm~~ ) |
  |  | 115 | $confirm = confirm(mycredTools.awardConfirmText); |
  |  | 116 |  |
  |  | 117 | if (!$confirm) |
  | 123 | 118 | return false; |
  | 124 | 119 |  |
  | 125 | 120 | //Ranks |
  | 126 |  | var $rankToAward = jQuery(~~'.bulk-ranks' ).find( ':selected'~~ ).val(); |
  |  | 121 | var $rankToAward = jQuery('.bulk-ranks').find(':selected').val(); |
  | 127 | 122 |  |
  | 128 | 123 | //Badges |
  | 129 |  | var $badgesToAward = JSON.stringify(~~jQuery( '[name="bulk\_badges"]' ).val()~~ ); |
  |  | 124 | var $badgesToAward = JSON.stringify(jQuery('[name="bulk\_badges"]').val()); |
  | 130 | 125 |  |
  | 131 | 126 | jQuery.ajax({ |
  | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L148) | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L143) |  |
  | 148 | 143 |  |
  | 149 | 144 | }, |
  | 150 |  | beforeSend: function() |
  | 151 |  | { |
  | 152 |  | jQuery( '.tools-bulk-assign-award-btn' ).find( 'span' ).css( 'display','inherit' ); |
  | 153 |  | }, |
  | 154 |  | success: function( data ) |
  | 155 |  | { |
  | 156 |  | jQuery( '.tools-bulk-assign-award-btn' ).find( 'span' ).hide(); |
  | 157 |  |  |
  | 158 |  | if( data.success === true && $pointsToAward < 0 ) |
  | 159 |  | { |
  | 160 |  | alert( mycredTools.successfullyDeducted ); |
  | 161 |  | resetForm(); |
  |  | 145 | beforeSend: function() { |
  |  | 146 | jQuery('.tools-bulk-assign-award-btn').find('span').css('display', 'inherit'); |
  |  | 147 | }, |
  |  | 148 | success: function(data) { |
  |  | 149 | jQuery('.tools-bulk-assign-award-btn').find('span').hide(); |
  |  | 150 |  |
  |  | 151 | if (data.success === true && $pointsToAward < 0) { |
  |  | 152 | alert(mycredTools.successfullyDeducted); |
  |  | 153 | mycredToolsResetForm(); |
  | 162 | 154 | return; |
  | 163 | 155 | } |
  | 164 | 156 |  |
  | 165 |  | if( data.success === true ) |
  | 166 |  | { |
  | 167 |  | alert( mycredTools.successfullyAwarded ); |
  | 168 |  | resetForm(); |
  | 169 |  | } |
  | 170 |  |  |
  | 171 |  | if( data.success == 'pointsRequired' ) |
  | 172 |  | { |
  | 173 |  | alert( mycredTools.pointsRequired ); |
  | 174 |  | } |
  | 175 |  | if( data.success == 'logEntryRequired' ) |
  | 176 |  | { |
  | 177 |  | alert( mycredTools.logEntryRequired ); |
  | 178 |  | } |
  | 179 |  | if( data.success == 'userOrRoleIsRequired' ) |
  | 180 |  | { |
  | 181 |  | alert( mycredTools.userOrRoleIsRequired ); |
  | 182 |  | } |
  | 183 |  | if( data.success == 'badgesFieldRequried' ) |
  | 184 |  | { |
  | 185 |  | alert( mycredTools.badgesFieldRequried ); |
  |  | 157 | if (data.success === true) { |
  |  | 158 | alert(mycredTools.successfullyAwarded); |
  |  | 159 | mycredToolsResetForm(); |
  |  | 160 | } |
  |  | 161 |  |
  |  | 162 | if (data.success == 'pointsRequired') { |
  |  | 163 | alert(mycredTools.pointsRequired); |
  |  | 164 | } |
  |  | 165 | if (data.success == 'logEntryRequired') { |
  |  | 166 | alert(mycredTools.logEntryRequired); |
  |  | 167 | } |
  |  | 168 | if (data.success == 'userOrRoleIsRequired') { |
  |  | 169 | alert(mycredTools.userOrRoleIsRequired); |
  |  | 170 | } |
  |  | 171 | if (data.success == 'badgesFieldRequried') { |
  |  | 172 | alert(mycredTools.badgesFieldRequried); |
  | 186 | 173 | } |
  | 187 | 174 | } |
  | 188 | 175 | }) |
  | 189 |  | }); |
  |  | 176 | }); |
  | 190 | 177 |  |
  | 191 | 178 | //jQuery Bulk Revoke |
  | 192 |  | jQuery(~~document ).on( 'click', '.tools-revoke-btn', function(e)~~{ |
  |  | 179 | jQuery(document).on('click', '.tools-revoke-btn', function(e) { |
  | 193 | 180 |  |
  | 194 | 181 | e.preventDefault(); |
  | 195 |  |  |
  | 196 |  | var $confirm = confirm(~~mycredTools.revokeConfirmText~~ ); |
  | 197 |  |  |
  | 198 |  | if~~( !$confirm~~ ) |
  | 199 |  | return false; |
  | 200 |  |  |
  | 201 |  | var $selectedType = jQuery(~~'.bulk-award-type' ).find( ':selected'~~ ).val(); |
  | 202 |  | var $badgesToRevoke = JSON.stringify(~~jQuery( '[name="bulk\_badges"]' ).val()~~ ); |
  | 203 |  | var $awardToAllUsers = jQuery(~~'.award-to-all'~~ ).prop('checked'); |
  | 204 |  | var $users = JSON.stringify(~~jQuery( '[name="bulk\_users"]' ).val()~~ ); |
  | 205 |  | var $user\_roles = JSON.stringify(~~jQuery( '[name="bulk\_roles"]' ).val()~~ ); |
  |  | 182 |  |
  |  | 183 | var $confirm = confirm(mycredTools.revokeConfirmText); |
  |  | 184 |  |
  |  | 185 | if (!$confirm) |
  |  | 186 | return false; |
  |  | 187 |  |
  |  | 188 | var $selectedType = jQuery('.bulk-award-type').find(':selected').val(); |
  |  | 189 | var $badgesToRevoke = JSON.stringify(jQuery('[name="bulk\_badges"]').val()); |
  |  | 190 | var $awardToAllUsers = jQuery('.award-to-all').prop('checked'); |
  |  | 191 | var $users = JSON.stringify(jQuery('[name="bulk\_users"]').val()); |
  |  | 192 | var $user\_roles = JSON.stringify(jQuery('[name="bulk\_roles"]').val()); |
  | 206 | 193 |  |
  | 207 | 194 |  |
  | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L218) | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L205) |  |
  | 218 | 205 | user\_roles: $user\_roles, |
  | 219 | 206 | }, |
  | 220 |  | beforeSend: function() |
  | 221 |  | { |
  | 222 |  | jQuery( '.tools-revoke-btn' ).find( 'span' ).css( 'display','inherit' ); |
  | 223 |  | }, |
  | 224 |  | success: function( data ) |
  | 225 |  | { |
  | 226 |  | jQuery( '.tools-revoke-btn' ).find( 'span' ).hide(); |
  | 227 |  |  |
  | 228 |  | if( data.success === true ) |
  | 229 |  | { |
  | 230 |  | alert( mycredTools.successfullyRevoked ); |
  | 231 |  | resetForm(); |
  | 232 |  | } |
  | 233 |  | if( data.success == 'userOrRoleIsRequired' ) |
  | 234 |  | { |
  | 235 |  | alert( mycredTools.userOrRoleIsRequired ); |
  | 236 |  | } |
  | 237 |  | if( data.success == 'badgesFieldRequried' ) |
  | 238 |  | { |
  | 239 |  | alert( mycredTools.badgesFieldRequried ); |
  | 240 |  | } |
  | 241 |  | } |
  | 242 |  | }); |
  | 243 |  | } ); |
  | 244 |  | } ); |
  |  | 207 | beforeSend: function() { |
  |  | 208 | jQuery('.tools-revoke-btn').find('span').css('display', 'inherit'); |
  |  | 209 | }, |
  |  | 210 | success: function(data) { |
  |  | 211 | jQuery('.tools-revoke-btn').find('span').hide(); |
  |  | 212 |  |
  |  | 213 | if (data.success === true) { |
  |  | 214 | alert(mycredTools.successfullyRevoked); |
  |  | 215 | mycredToolsResetForm(); |
  |  | 216 | } |
  |  | 217 | if (data.success == 'userOrRoleIsRequired') { |
  |  | 218 | alert(mycredTools.userOrRoleIsRequired); |
  |  | 219 | } |
  |  | 220 | if (data.success == 'badgesFieldRequried') { |
  |  | 221 | alert(mycredTools.badgesFieldRequried); |
  |  | 222 | } |
  |  | 223 | } |
  |  | 224 | }); |
  |  | 225 | }); |
  |  | 226 |  |
  |  | 227 | /\* |
  |  | 228 | \* @since 2.4 |
  |  | 229 | \* @version 1.0 |
  |  | 230 | \*/ |
  |  | 231 | var $pt\_selector = jQuery('#tools-type-import-export'); |
  |  | 232 |  |
  |  | 233 | $pt\_selector.select2(); |
  |  | 234 |  |
  |  | 235 | jQuery(document).on('click', '#select-all-pt', function() { |
  |  | 236 |  |
  |  | 237 | jQuery('#tools-type-import-export').select2('destroy'); |
  |  | 238 |  |
  |  | 239 | var $values = []; |
  |  | 240 |  |
  |  | 241 | jQuery('#tools-type-import-export option').each(function(i, obj) { |
  |  | 242 |  |
  |  | 243 | if (obj.selected) { |
  |  | 244 | jQuery('#tools-type-import-export').val(null).trigger('change'); |
  |  | 245 | jQuery('#tools-type-import-export').select2(); |
  |  | 246 | return false; |
  |  | 247 | } |
  |  | 248 | if (!obj.selected) { |
  |  | 249 | jQuery('#tools-type-import-export').find('option').prop('selected', 'selected').end(); |
  |  | 250 | jQuery('#tools-type-import-export').select2(); |
  |  | 251 | return false; |
  |  | 252 | } |
  |  | 253 | return false; |
  |  | 254 | }); |
  |  | 255 | }); |
  |  | 256 |  |
  |  | 257 | var $uf\_selector = jQuery('#tools-uf-import-export'); |
  |  | 258 | $uf\_selector.select2(); |
  |  | 259 |  |
  |  | 260 | //Download Formatted Points |
  |  | 261 | jQuery(document).on('click', '#download-formatted-template-csv', function() { |
  |  | 262 | var $requestTab = jQuery('.request-tab').val(); |
  |  | 263 | jQuery.ajax({ |
  |  | 264 | url: ajaxurl, |
  |  | 265 | type: 'POST', |
  |  | 266 | data: { |
  |  | 267 | action: 'mycred-tools-import-export', |
  |  | 268 | request\_tab: $requestTab, |
  |  | 269 | template: 'formatted' |
  |  | 270 | }, |
  |  | 271 | beforeSend: function() { |
  |  | 272 | mycredToolsAddLoader('#download-formatted-template-csv'); |
  |  | 273 | }, |
  |  | 274 | success: function(data) { |
  |  | 275 | mycredToolsDowloadCSV(data, 'formatted-points-template'); |
  |  | 276 | mycredToolsRemoveLoader('#download-formatted-template-csv', 'dashicons dashicons-download v-align-middle'); |
  |  | 277 | } |
  |  | 278 | }); |
  |  | 279 | }); |
  |  | 280 |  |
  |  | 281 | //Downlaod Row Points |
  |  | 282 | jQuery(document).on('click', '#download-raw-template-csv', function() { |
  |  | 283 | var $requestTab = jQuery('.request-tab').val(); |
  |  | 284 | jQuery.ajax({ |
  |  | 285 | url: ajaxurl, |
  |  | 286 | type: 'POST', |
  |  | 287 | data: { |
  |  | 288 | action: 'mycred-tools-import-export', |
  |  | 289 | request\_tab: $requestTab, |
  |  | 290 | template: 'raw' |
  |  | 291 | }, |
  |  | 292 | beforeSend: function() { |
  |  | 293 | mycredToolsAddLoader('#download-raw-template-csv'); |
  |  | 294 | }, |
  |  | 295 | success: function(data) { |
  |  | 296 | mycredToolsDowloadCSV(data, `raw-${$requestTab}-template`); |
  |  | 297 | mycredToolsRemoveLoader('#download-raw-template-csv', 'dashicons dashicons-download v-align-middle'); |
  |  | 298 | } |
  |  | 299 | }); |
  |  | 300 | }); |
  |  | 301 |  |
  |  | 302 | //Export Raw Points |
  |  | 303 | jQuery(document).on('click', '#export-raw', function(e) { |
  |  | 304 |  |
  |  | 305 | e.preventDefault(); |
  |  | 306 |  |
  |  | 307 | var $requestTab = jQuery('.request-tab').val(); |
  |  | 308 |  |
  |  | 309 | var $pt = jQuery('#tools-type-import-export').val(); |
  |  | 310 |  |
  |  | 311 | var $userField = jQuery('#tools-uf-import-export').val(); |
  |  | 312 |  |
  |  | 313 | var $fileFormat = 'csv'; |
  |  | 314 |  |
  |  | 315 | var $postField, $setupTypes = Array(); |
  |  | 316 |  |
  |  | 317 | if (($pt == undefined || $pt.length == 0) && $requestTab == 'points') { |
  |  | 318 | alert('Select alteast one Point Type.'); |
  |  | 319 | return false; |
  |  | 320 | } |
  |  | 321 |  |
  |  | 322 | if (($pt == undefined || $pt.length == 0) && $requestTab == 'badges') { |
  |  | 323 | alert('Select alteast one Badge.'); |
  |  | 324 | return false; |
  |  | 325 | } |
  |  | 326 |  |
  |  | 327 | if (($pt == undefined || $pt.length == 0) && $requestTab == 'ranks') { |
  |  | 328 | alert('Select alteast one Rank.'); |
  |  | 329 | return false; |
  |  | 330 | } |
  |  | 331 |  |
  |  | 332 | if ($requestTab == 'badges' || $requestTab == 'ranks') |
  |  | 333 | var $postField = jQuery('#tools-badge-fields-import-export').val() |
  |  | 334 |  |
  |  | 335 | if ($requestTab == 'setup') { |
  |  | 336 | $fileFormat = 'json'; |
  |  | 337 | $\_setupTypes = jQuery('.mycred-tools-setup input[type=checkbox]'); |
  |  | 338 | var $counter = 0; |
  |  | 339 | jQuery.each($\_setupTypes, function(index, element) { |
  |  | 340 |  |
  |  | 341 | var $elementValue = jQuery(element); |
  |  | 342 |  |
  |  | 343 | if (jQuery(element).is(':checked') === false) return; |
  |  | 344 |  |
  |  | 345 | if (jQuery(element).is(':checked') === true) { |
  |  | 346 | var $\_obj = {}; |
  |  | 347 | var \_name = $elementValue.attr('name'); |
  |  | 348 | var $\_value = $elementValue.attr('value'); |
  |  | 349 | $\_obj[\_name] = $\_value; |
  |  | 350 | $setupTypes[$counter] = $\_obj; |
  |  | 351 | $counter++; |
  |  | 352 | } |
  |  | 353 | }); |
  |  | 354 |  |
  |  | 355 | if ($setupTypes.length == 0) { |
  |  | 356 | alert('Nothing selected to Import.'); |
  |  | 357 | return false; |
  |  | 358 | } |
  |  | 359 | } |
  |  | 360 |  |
  |  | 361 | jQuery.ajax({ |
  |  | 362 | url: ajaxurl, |
  |  | 363 | type: 'POST', |
  |  | 364 | data: { |
  |  | 365 | action: 'mycred-tools-import-export', |
  |  | 366 | request\_tab: $requestTab, |
  |  | 367 | request: 'export', |
  |  | 368 | template: 'raw', |
  |  | 369 | user\_field: $userField, |
  |  | 370 | post\_field: $postField, |
  |  | 371 | types: JSON.stringify($pt), |
  |  | 372 | setup\_types: $setupTypes |
  |  | 373 | }, |
  |  | 374 | beforeSend: function() { |
  |  | 375 | mycredToolsAddLoader('#export-raw'); |
  |  | 376 | }, |
  |  | 377 | success: function(data) { |
  |  | 378 | mycredToolsDowloadCSV(data, `raw-${$requestTab}`, $fileFormat); |
  |  | 379 | mycredToolsRemoveLoader('#export-raw', 'dashicons dashicons-database-export v-align-middle'); |
  |  | 380 | } |
  |  | 381 | }); |
  |  | 382 | }); |
  |  | 383 |  |
  |  | 384 | //Export Formatted |
  |  | 385 | jQuery(document).on('click', '#export-formatted', function() { |
  |  | 386 |  |
  |  | 387 | var $requestTab = jQuery('.request-tab').val(); |
  |  | 388 |  |
  |  | 389 | var $pt = jQuery('#tools-type-import-export').val(); |
  |  | 390 |  |
  |  | 391 | var $userField = jQuery('#tools-uf-import-export').val(); |
  |  | 392 |  |
  |  | 393 | if ($pt == undefined || $pt.length == 0) { |
  |  | 394 | alert('Select alteast one Point Type.'); |
  |  | 395 | return false; |
  |  | 396 | } |
  |  | 397 |  |
  |  | 398 | jQuery.ajax({ |
  |  | 399 | url: ajaxurl, |
  |  | 400 | type: 'POST', |
  |  | 401 | data: { |
  |  | 402 | action: 'mycred-tools-import-export', |
  |  | 403 | request\_tab: $requestTab, |
  |  | 404 | request: 'export', |
  |  | 405 | template: 'formatted', |
  |  | 406 | user\_field: $userField, |
  |  | 407 | types: JSON.stringify($pt) |
  |  | 408 | }, |
  |  | 409 | beforeSend: function() { |
  |  | 410 | mycredToolsAddLoader('#export-formatted'); |
  |  | 411 | }, |
  |  | 412 | success: function(data) { |
  |  | 413 | mycredToolsDowloadCSV(data, `formatted-${$requestTab}`); |
  |  | 414 | mycredToolsRemoveLoader('#export-formatted', 'dashicons dashicons-database-export v-align-middle'); |
  |  | 415 | } |
  |  | 416 | }); |
  |  | 417 | }); |
  |  | 418 |  |
  |  | 419 | //Import Points |
  |  | 420 | jQuery(document).on('click', '#import', function(e) { |
  |  | 421 |  |
  |  | 422 | e.preventDefault(); |
  |  | 423 |  |
  |  | 424 | var $requestTab = jQuery('.request-tab').val(), |
  |  | 425 | $importFormatType; |
  |  | 426 |  |
  |  | 427 | if ($requestTab == 'badges' || $requestTab == 'ranks') |
  |  | 428 | $importFormatType = jQuery('#import-format-type').val(); |
  |  | 429 |  |
  |  | 430 | if (document.getElementById('import-file').files.length == 0) { |
  |  | 431 | alert('Upload file first.'); |
  |  | 432 | return false; |
  |  | 433 | } |
  |  | 434 |  |
  |  | 435 | if ((document.getElementById('import-file').files[0].type !== 'application/vnd.ms-excel' && document.getElementById('import-file').files[0].type !== 'text/csv') && ($requestTab != 'setup')) { |
  |  | 436 | alert('Upload csv format file.'); |
  |  | 437 | return false; |
  |  | 438 | } |
  |  | 439 |  |
  |  | 440 | //Setup |
  |  | 441 | if (document.getElementById('import-file').files[0].type !== 'application/json' && ($requestTab == 'setup')) { |
  |  | 442 | alert('Upload JSON format file.'); |
  |  | 443 | return false; |
  |  | 444 | } |
  |  | 445 |  |
  |  | 446 | var file = jQuery(document).find('#import-file'); |
  |  | 447 | var file = file[0].files[0]; |
  |  | 448 |  |
  |  | 449 | var formData = new FormData(); |
  |  | 450 | formData.append('action', 'mycred-tools-import-export'); |
  |  | 451 | formData.append('request\_tab', $requestTab); |
  |  | 452 | formData.append('import\_format\_type', $importFormatType); |
  |  | 453 | formData.append('request', 'import'); |
  |  | 454 | formData.append('\_file', file); |
  |  | 455 |  |
  |  | 456 |  |
  |  | 457 | jQuery.ajax({ |
  |  | 458 | url: mycredTools.ajax\_url, |
  |  | 459 | type: 'POST', |
  |  | 460 | data: formData, |
  |  | 461 | contentType: false, |
  |  | 462 | processData: false, |
  |  | 463 | error: function(e) { |
  |  | 464 | console.log('Error', e); |
  |  | 465 | }, |
  |  | 466 | beforeSend: function() { |
  |  | 467 | mycredToolsAddLoader('#import'); |
  |  | 468 | }, |
  |  | 469 | success: function(data) { |
  |  | 470 |  |
  |  | 471 | if (data == '') |
  |  | 472 | data = 'File successfully imported.'; |
  |  | 473 |  |
  |  | 474 | alert(data); |
  |  | 475 | jQuery('#import-file').val(''); |
  |  | 476 | mycredToolsRemoveLoader('#import', 'dashicons dashicons-database-import v-align-middle'); |
  |  | 477 | } |
  |  | 478 | }); |
  |  | 479 | }); |
  |  | 480 |  |
  |  | 481 | jQuery('#tools-badge-fields-import-export').select2(); |
  |  | 482 |  |
  |  | 483 | jQuery('#import-format-type').select2(); |
  |  | 484 |  |
  |  | 485 | //Setup Import Export |
  |  | 486 | jQuery(document).on('change', '.mycred-tools-setup input[type=checkbox]', function(e) { |
  |  | 487 |  |
  |  | 488 | if (this.checked) |
  |  | 489 | jQuery(this).parent().parent().nextUntil('li').find('input[type=checkbox]').prop('checked', true); |
  |  | 490 | else |
  |  | 491 | jQuery(this).parent().parent().nextUntil('li').find('input[type=checkbox]').prop('checked', false); |
  |  | 492 |  |
  |  | 493 | }) |
  |  | 494 |  |
  |  | 495 | }); |
  | 245 | 496 |  |
  | 246 | 497 | //Reset Form |
  | 247 |  | function resetForm() |
  | 248 |  | { |
  |  | 498 | function mycredToolsResetForm() { |
  | 249 | 499 | var $selectedValue = jQuery('.bulk-award-type').val(); |
  | 250 | 500 | jQuery(".mycred-tools-ba-award-form").trigger('reset'); |
  | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2621330#L254) | […](/browser/mycred/trunk/assets/js/mycred-tools.js?rev=2648350#L504) |  |
  | 254 | 504 | jQuery('#bulk-ranks').val(null).trigger('change'); |
  | 255 | 505 | jQuery(".log-entry").removeAttr("checked"); |
  | 256 |  | jQuery(~~'.log-entry-row'~~ ).hide(); |
  |  | 506 | jQuery('.log-entry-row').hide(); |
  | 257 | 507 | jQuery(".award-to-all").removeAttr("checked"); |
  | 258 |  | jQuery(~~'.users-row'~~ ).show(); |
  | 259 |  | jQuery('.bulk-award-type').val(~~$selectedValue~~ ); |
  |  | 508 | jQuery('.users-row').show(); |
  |  | 509 | jQuery('.bulk-award-type').val($selectedValue); |
  | 260 | 510 | } |
  |  | 511 |  |
  |  | 512 | //Downlaods CSV |
  |  | 513 | function mycredToolsDowloadCSV(data, fileName, fileFormat = 'csv') { |
  |  | 514 | /\* |
  |  | 515 | \* Make CSV downloadable |
  |  | 516 | \*/ |
  |  | 517 | var downloadLink = document.createElement("a"); |
  |  | 518 | var fileData = ['\ufeff' + data]; |
  |  | 519 |  |
  |  | 520 | var blobObject = new Blob(fileData, { |
  |  | 521 | type: "text/csv;charset=utf-8;" |
  |  | 522 | }); |
  |  | 523 |  |
  |  | 524 | var url = URL.createObjectURL(blobObject); |
  |  | 525 | downloadLink.href = url; |
  |  | 526 | downloadLink.download = `${fileName}.${fileFormat}`; |
  |  | 527 |  |
  |  | 528 | /\* |
  |  | 529 | \* Actually download CSV |
  |  | 530 | \*/ |
  |  | 531 | document.body.appendChild(downloadLink); |
  |  | 532 | downloadLink.click(); |
  |  | 533 | document.body.removeChild(downloadLink); |
  |  | 534 | } |
  |  | 535 |  |
  |  | 536 | function mycredToolsAddLoader(parentIdentifier) { |
  |  | 537 | jQuery(`${parentIdentifier} span`).removeClass(); |
  |  | 538 | jQuery(`${parentIdentifier} span`).addClass('dashicons dashicons-update mycred-button1').css('display', 'inherit'); |
  |  | 539 | } |
  |  | 540 |  |
  |  | 541 | function mycredToolsRemoveLoader(parentIdentifier, iconIdentifier) { |
  |  | 542 | jQuery(`${parentIdentifier} span`).removeClass(); |
  |  | 543 | jQuery(`${parentIdentifier} span`).addClass(iconIdentifier); |
  |  | 544 | } |
* ## [mycred/trunk/includes/classes/class.query-leaderboard.php](/changeset/2648350/mycred/trunk/includes/classes/class.query-leaderboard.php "Show the changeset 2648350 restricted to mycred/trunk/includes/classes/class.query-leaderboard.php")

  | [r2621330](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L16 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L16 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | public $user\_id         = 0; |
  | 17 | 17 | private $max\_size       = 250; |
  | 18 |  |  |
  | 19 | 18 | public $args            = array(); |
  | 20 | 19 | public $based\_on        = 'balance'; |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L217) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L216) |  |
  | 217 | 216 | $this->leaderboard = $results; |
  | 218 | 217 |  |
  |  | 218 |  |
  | 219 | 219 | if ( $append\_current\_user ) |
  | 220 | 220 | $this->append\_current\_user(); |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L288) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L288) |  |
  | 288 | 288 | public function get\_db\_query() { |
  | 289 | 289 |  |
  | 290 |  | if ( $this->based\_on == 'balance' ) |
  |  | 290 |  |
  |  | 291 | if ( $this->based\_on == 'balance'  ) { |
  | 291 | 292 | $query = $this->get\_balance\_db\_query(); |
  | 292 |  | else |
  |  | 293 | } |
  |  | 294 | else { |
  | 293 | 295 | $query = $this->get\_reference\_db\_query(); |
  |  | 296 | } |
  |  | 297 |  |
  |  | 298 |  |
  | 294 | 299 |  |
  | 295 | 300 | return $query; |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L391) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L396) |  |
  | 391 | 396 | global $wpdb, $mycred\_log\_table; |
  | 392 | 397 |  |
  |  | 398 | $query             = ''; |
  | 393 | 399 | $time\_filter       = $this->get\_timefilter(); |
  | 394 | 400 | $multisite\_check   = $this->get\_multisitefilter(); |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L735) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L741) |  |
  | 735 | 741 | global $wpdb; |
  | 736 | 742 |  |
  |  | 743 |  |
  |  | 744 |  |
  |  | 745 |  |
  |  | 746 |  |
  | 737 | 747 | // Filter: Daily |
  | 738 | 748 | if ( $this->args['timeframe'] == 'today' ) { |
  | 739 | 749 | $query = $wpdb->prepare( "AND l.time BETWEEN %d AND %d", strtotime( 'today midnight', $this->now ), $this->args['now'] ); |
  | 740 | 750 | } |
  |  | 751 |  |
  |  | 752 | // Filter: Yesterday |
  |  | 753 | elseif ( $this->args['timeframe'] == 'yesterday' ) { |
  |  | 754 | $query = $wpdb->prepare( "AND l.time BETWEEN %d AND %d", strtotime( '-1 day midnight', $this->now ), strtotime( 'today midnight', $this->now )); |
  |  | 755 |  |
  |  | 756 | } |
  |  | 757 |  |
  |  | 758 |  |
  | 741 | 759 | // Filter: Weekly |
  | 742 | 760 | elseif ( $this->args['timeframe'] == 'this-week' ) { |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L798) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L816) |  |
  | 798 | 816 | } |
  | 799 | 817 |  |
  | 800 |  | ~~if ( ! $this->args['total'] )~~ |
  | 801 | 818 | $query = $wpdb->prepare( "AND l.meta\_value != {$balance\_format}", $this->core->zero() ); |
  | 802 | 819 |  |
  | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2621330#L820) | […](/browser/mycred/trunk/includes/classes/class.query-leaderboard.php?rev=2648350#L837) |  |
  | 820 | 837 | // Option to exclude zero balances |
  | 821 | 838 | $query = ''; |
  | 822 |  | $checkIDs='~^\d+(,\d+)~~?$~';~~ |
  |  | 839 | $checkIDs='~^\d+(,\d+)\*$~'; |
  | 823 | 840 | $exclude=$this->args['exclude']; |
  | 824 | 841 |  |
  | 825 | 842 | if (!empty($exclude)) { |
  |  | 843 |  |
  | 826 | 844 | if(preg\_match($checkIDs,$exclude)){ |
  | 827 | 845 |  |
  | 828 | 846 | $exclude=$this->args['exclude']; |
  | 829 |  | } |
  | 830 |  | else{ |
  |  | 847 |  |
  |  | 848 | } |
  |  | 849 | elseif(!preg\_match($checkIDs,$exclude)){ |
  |  | 850 |  |
  | 831 | 851 | $exclude=mycred\_leaderboard\_exclude\_role($exclude); |
  | 832 |  | } |
  | 833 |  | $query = $wpdb->prepare( "AND l.user\_id NOT IN (%s) ",$exclude); |
  |  | 852 |  |
  |  | 853 | } |
  |  | 854 | $query = $wpdb->prepare( "AND l.user\_id NOT IN ($exclude)"); |
  |  | 855 |  |
  | 834 | 856 | } |
  | 835 | 857 | return apply\_filters( 'mycred\_leaderboard\_exclude\_user\_filter', $query, $this ); |
  | 836 |  |  |
  | 837 | 858 | } |
  | 838 | 859 |  |
* ## [mycred/trunk/includes/classes/class.query-log.php](/changeset/2648350/mycred/trunk/includes/classes/class.query-log.php "Show the changeset 2648350 restricted to mycred/trunk/includes/classes/class.query-log.php")

  | [r2621330](/browser/mycred/trunk/includes/classes/class.query-log.php?rev=2621330#L1841 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/classes/class.query-log.php?rev=2648350#L1841 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 1841 | 1841 |  |
  | 1842 | 1842 | if ( isset( $\_GET['s'] ) && $\_GET['s'] != '' ) |
  | 1843 |  | $serarch\_string = ~~$\_GET['s']~~; |
  |  | 1843 | $serarch\_string = sanitize\_text\_field( $\_GET['s'] ); |
  | 1844 | 1844 | else |
  | 1845 | 1845 | $serarch\_string = ''; |
* ## [mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php](/changeset/2648350/mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php "Show the changeset 2648350 restricted to mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php")

  | [r2632100](/browser/mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php?rev=2632100#L208 "Show revision 2632100 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/hooks/external/mycred-hook-affiliatewp.php?rev=2648350#L208 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 208 | 208 | \* Referral Payout |
  | 209 | 209 | \* @since 1.6 |
  |  | 210 | \* @since 2.4 @filter added `mycred\_affiliate\_prefs` for LevelCRED |
  | 210 | 211 | \* @version 1.0 |
  | 211 | 212 | \*/ |
* ## [mycred/trunk/includes/hooks/mycred-hook-referrals.php](/changeset/2648350/mycred/trunk/includes/hooks/mycred-hook-referrals.php "Show the changeset 2648350 restricted to mycred/trunk/includes/hooks/mycred-hook-referrals.php")

  | [r2621330](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2621330#L261 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350#L261 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 261 | 261 | if ( $this->ref\_counts( $user\_id, $IP ) ) { |
  | 262 | 262 |  |
  |  | 263 | if ( $this->core->has\_entry( 'visitor\_referral', time(), $user\_id, $IP, $this->mycred\_type ) ) return; |
  |  | 264 |  |
  | 263 | 265 | // Award |
  | 264 | 266 | $this->core->add\_creds( |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2621330#L272) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350#L274) |  |
  | 272 | 274 | ); |
  | 273 | 275 |  |
  |  | 276 |  |
  |  | 277 |  |
  | 274 | 278 | do\_action( 'mycred\_visitor\_referral', $user\_id, $IP, $this ); |
  | 275 | 279 |  |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2621330#L328) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350#L332) |  |
  | 328 | 332 | setcookie( $key, $ref, time()-3600, COOKIEPATH, COOKIE\_DOMAIN ); |
  | 329 | 333 |  |
  |  | 334 |  |
  |  | 335 |  |
  | 330 | 336 | // Attempt to get the users IP |
  | 331 | 337 | $IP = apply\_filters( 'mycred\_affiliate\_IP', $\_SERVER['REMOTE\_ADDR'], 'signup', $this ); |
  |  | 338 |  |
  |  | 339 | if ( $this->core->has\_entry( 'signup\_referral', $new\_user\_id, $user\_id, $IP, $this->mycred\_type ) ) return; |
  |  | 340 |  |
  |  | 341 |  |
  | 332 | 342 | if ( $IP != '' && $IP != '0.0.0.0' ) { |
  |  | 343 |  |
  |  | 344 | if ( $this->core->has\_entry( 'signup\_referral', $new\_user\_id, $user\_id, $IP, $this->mycred\_type ) ) return; |
  | 333 | 345 |  |
  | 334 | 346 | if ( $this->ref\_counts( $user\_id, $IP, 'signup' ) ) { |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2621330#L363) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350#L375) |  |
  | 363 | 375 | else { |
  | 364 | 376 |  |
  |  | 377 | if ( $this->core->has\_entry( 'signup\_referral', $new\_user\_id, $user\_id, $IP, $this->mycred\_type ) ) return; |
  |  | 378 |  |
  | 365 | 379 | $this->core->add\_creds( |
  | 366 | 380 | 'signup\_referral', |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2621330#L397) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-referrals.php?rev=2648350#L411) |  |
  | 397 | 411 |  |
  | 398 | 412 | if ( $referred\_by == '' || $referred\_by\_IP == '' || $this->mycred\_type != $referred\_type ) return; |
  |  | 413 |  |
  |  | 414 | if ( $this->core->has\_entry( 'signup\_referral', $user\_id, $referred\_by, $referred\_by\_IP, $this->mycred\_type ) ) return; |
  | 399 | 415 |  |
  | 400 | 416 | // Award |
* ## [mycred/trunk/includes/hooks/mycred-hook-watching-video.php](/changeset/2648350/mycred/trunk/includes/hooks/mycred-hook-watching-video.php "Show the changeset 2648350 restricted to mycred/trunk/includes/hooks/mycred-hook-watching-video.php")

  | [r2328747](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2328747#L38 "Show revision 2328747 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2648350#L38 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 38 | 38 |  |
  | 39 | 39 | add\_filter( 'mycred\_video\_js', array( $this, 'adjust\_js' ) ); |
  | 40 |  | add\_~~filter( 'mycred\_video\_view\_' . $this->mycred\_type, array( $this, 'video\_view' ), 10, 2~~ ); |
  |  | 40 | add\_action( 'mycred\_video\_view\_' . $this->mycred\_type, array( $this, 'video\_view' ), 10 ); |
  | 41 | 41 |  |
  | 42 | 42 | } |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2328747#L80) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2648350#L80) |  |
  | 80 | 80 | // Prep |
  | 81 | 81 | $amount   = $this->core->number( $amount ); |
  | 82 |  | $interval = abs( ~~$interval~~ / 1000 ); |
  |  | 82 | $interval = abs( floatval( $interval ) / 1000 ); |
  | 83 | 83 |  |
  | 84 | 84 | // Get playback details |
  | […](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2328747#L480) | […](/browser/mycred/trunk/includes/hooks/mycred-hook-watching-video.php?rev=2648350#L480) |  |
  | 480 | 480 |  |
  | 481 | 481 | $type\_key = sanitize\_key( $type\_key ); |
  | 482 |  | if ( mycred\_point\_type\_exists( $type\_key ) && ! in\_array( $type\_~~id~~, $types ) ) |
  |  | 482 | if ( mycred\_point\_type\_exists( $type\_key ) && ! in\_array( $type\_key, $types ) ) |
  | 483 | 483 | $types[] = $type\_key; |
  | 484 | 484 |  |
* ## [mycred/trunk/includes/mycred-functions.php](/changeset/2648350/mycred/trunk/includes/mycred-functions.php "Show the changeset 2648350 restricted to mycred/trunk/includes/mycred-functions.php")

  | [r2621330](/browser/mycred/trunk/includes/mycred-functions.php?rev=2621330#L4254 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/mycred-functions.php?rev=2648350#L4254 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 4254 | 4254 | } |
  | 4255 | 4255 | endif; |
  |  | 4256 |  |
  |  | 4257 | /\*\* |
  |  | 4258 | \* Sanitizes Array | Associative  Array | Multi-dimensional Array |
  |  | 4259 | \* @since 2.4 |
  |  | 4260 | \* @version 1.0 |
  |  | 4261 | \*/ |
  |  | 4262 |  |
  |  | 4263 | if( !function\_exists( 'mycred\_sanitize\_array' ) ): |
  |  | 4264 | function mycred\_sanitize\_array( $\_array ) |
  |  | 4265 | { |
  |  | 4266 | foreach( $\_array as $key => $value ) |
  |  | 4267 | { |
  |  | 4268 | $key = sanitize\_text\_field( $key ); |
  |  | 4269 |  |
  |  | 4270 | if( is\_array( $value ) ) |
  |  | 4271 | { |
  |  | 4272 | $value = mycred\_sanitize\_array( $value ); |
  |  | 4273 | } |
  |  | 4274 | else |
  |  | 4275 | { |
  |  | 4276 | $\_array[$key] = sanitize\_text\_field( $value ); |
  |  | 4277 | } |
  |  | 4278 | } |
  |  | 4279 |  |
  |  | 4280 | return $\_array; |
  |  | 4281 | } |
  |  | 4282 | endif; |
* ## [mycred/trunk/includes/mycred-remote.php](/changeset/2648350/mycred/trunk/includes/mycred-remote.php "Show the changeset 2648350 restricted to mycred/trunk/includes/mycred-remote.php")

  | [r2522593](/browser/mycred/trunk/includes/mycred-remote.php?rev=2522593#L54 "Show revision 2522593 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/mycred-remote.php?rev=2648350#L54 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 54 | 54 | public function handle\_magic() { |
  | 55 | 55 |  |
  | 56 |  | if ( function\_exists( 'get\_magic\_quotes\_gpc' ) ) |
  | 57 |  | { |
  | 58 |  | if ( get\_magic\_quotes\_gpc() ) { |
  | 59 |  | $process = array( &$\_GET, &$\_POST, &$\_COOKIE, &$\_REQUEST ); |
  | 60 |  |  |
  | 61 |  | foreach ( $process as $key => $val ) { |
  | 62 |  | foreach ( $val as $k => $v ) { |
  | 63 |  | unset( $process[ $key ][ $k ] ); |
  | 64 |  | if ( is\_array( $v ) ) { |
  | 65 |  | $process[ $key ][ stripslashes( $k ) ] = $v; |
  | 66 |  | $process[] = &$process[ $key ][ stripslashes( $k ) ]; |
  | 67 |  | } else { |
  | 68 |  | $process[ $key ][ stripslashes( $k ) ] = stripslashes( $v ); |
  | 69 |  | } |
  | 70 |  | } |
  | 71 |  | } |
  | 72 |  |  |
  | 73 |  | unset( $process ); |
  | 74 |  | } |
  | 75 |  | } |
  | 76 |  | else |
  | 77 |  | { |
  | 78 |  | $process = array( &$\_GET, &$\_POST, &$\_COOKIE, &$\_REQUEST ); |
  | 79 |  |  |
  | 80 |  | foreach ( $process as $key => $val ) { |
  | 81 |  | foreach ( $val as $k => $v ) { |
  | 82 |  | unset( $process[ $key ][ $k ] ); |
  | 83 |  | if ( is\_array( $v ) ) { |
  | 84 |  | $process[ $key ][ $k ] = $v; |
  | 85 |  | $process[] = &$process[ $key ][ $k ]; |
  | 86 |  | } else { |
  | 87 |  | $process[ $key ][ $k ] = $v ; |
  | 88 |  | } |
  | 89 |  | } |
  | 90 |  | } |
  | 91 |  | unset( $process ); |
  | 92 |  | } |
  |  | 56 | $process = array( &$\_GET, &$\_POST, &$\_COOKIE, &$\_REQUEST ); |
  |  | 57 |  |
  |  | 58 | foreach ( $process as $key => $val ) { |
  |  | 59 | foreach ( $val as $k => $v ) { |
  |  | 60 | unset( $process[ $key ][ $k ] ); |
  |  | 61 | if ( is\_array( $v ) ) { |
  |  | 62 | $process[ $key ][ stripslashes( $k ) ] = $v; |
  |  | 63 | $process[] = &$process[ $key ][ stripslashes( $k ) ]; |
  |  | 64 | } else { |
  |  | 65 | $process[ $key ][ stripslashes( $k ) ] = stripslashes( $v ); |
  |  | 66 | } |
  |  | 67 | } |
  |  | 68 | } |
  |  | 69 |  |
  |  | 70 | unset( $process ); |
  |  | 71 |  |
  |  | 72 |  |
  | 93 | 73 | // Let others play |
  | 94 | 74 | do\_action\_ref\_array( 'mycred\_remote\_magic', array( &$this ) ); |
* ## [mycred/trunk/includes/mycred-tools.php](/changeset/2648350/mycred/trunk/includes/mycred-tools.php "Show the changeset 2648350 restricted to mycred/trunk/includes/mycred-tools.php")

  | [r2621330](/browser/mycred/trunk/includes/mycred-tools.php?rev=2621330#L23 "Show revision 2621330 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350#L23 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 23 | 23 | public function admin\_enqueue\_scripts() |
  | 24 | 24 | { |
  |  | 25 | wp\_enqueue\_style( MYCRED\_SLUG . '-admin' ); |
  |  | 26 |  |
  | 25 | 27 | wp\_enqueue\_script( MYCRED\_SLUG . '-select2-script' ); |
  | 26 | 28 |  |
  | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2621330#L35) | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350#L37) |  |
  | 35 | 37 | 'mycredTools', |
  | 36 | 38 | array( |
  |  | 39 | 'ajax\_url'              =>  admin\_url( 'admin-ajax.php' ), |
  | 37 | 40 | 'awardConfirmText'      =>  \_\_( 'Do you really want to bulk award?', 'mycred' ), |
  | 38 | 41 | 'revokeConfirmText'     =>  \_\_( 'Do you really want to bulk deduct?', 'mycred' ), |
  | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2621330#L65) | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350#L68) |  |
  | 65 | 68 | /\*\* |
  | 66 | 69 | \* Tools menu callback |
  |  | 70 | \* @since 2.3 |
  |  | 71 | \* @since 2.4 Import Export Module Added |
  |  | 72 | \* @version 1.1 |
  | 67 | 73 | \*/ |
  | 68 | 74 | public function tools\_page() { |
  | 69 | 75 |  |
  | 70 |  | $import\_export = get\_mycred\_tools\_page\_url('~~import-export~~'); |
  |  | 76 | $import\_export = get\_mycred\_tools\_page\_url('points'); |
  | 71 | 77 | $logs\_cleanup = get\_mycred\_tools\_page\_url('logs-cleanup'); |
  | 72 | 78 | $reset\_data = get\_mycred\_tools\_page\_url('reset-data'); |
  | 73 |  |  |
  |  | 79 | $pages = array( |
  |  | 80 | 'import-export', |
  |  | 81 | 'points', |
  |  | 82 | 'badges', |
  |  | 83 | 'ranks', |
  |  | 84 | 'setup' |
  |  | 85 | ); |
  | 74 | 86 | ?> |
  | 75 | 87 |  |
  | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2621330#L82) | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350#L94) |  |
  | 82 | 94 | <h2 class="nav-tab-wrapper"> |
  | 83 | 95 | <a href="<?php echo admin\_url('admin.php?page=mycred-tools') ?>" class="nav-tab <?php echo !isset( $\_GET['mycred-tools'] ) ? 'nav-tab-active' : ''; ?>">Bulk Assign</a> |
  | 84 |  | <~~!-- <a href="<?php //echo $import\_export ?>" class="nav-tab <?php //echo ( isset( $\_GET['mycred-tools'] ) && $\_GET['mycred-tools'] == 'import-export'~~ ) ? 'nav-tab-active' : ''; ?>">Import/Export</a> |
  | 85 |  | <a href="<?php //echo $logs\_cleanup ?>" class="nav-tab <?php //echo ( isset( $\_GET['mycred-tools'] ) && $\_GET['mycred-tools'] == 'logs-cleanup' ) ? 'nav-tab-active' : ''; ?>">Logs Cleanup</a> |
  |  | 96 | <a href="<?php echo $import\_export ?>" class="nav-tab <?php echo ( isset( $\_GET['mycred-tools'] ) && in\_array( $\_GET['mycred-tools'], $pages ) ) ? 'nav-tab-active' : ''; ?>">Import/Export</a> |
  |  | 97 | <!-- <a href="<?php //echo $logs\_cleanup ?>" class="nav-tab <?php //echo ( isset( $\_GET['mycred-tools'] ) && $\_GET['mycred-tools'] == 'logs-cleanup' ) ? 'nav-tab-active' : ''; ?>">Logs Cleanup</a> |
  | 86 | 98 | <a href="<?php //echo $reset\_data ?>" class="nav-tab <?php //echo ( isset( $\_GET['mycred-tools'] ) && $\_GET['mycred-tools'] == 'reset-data' ) ? 'nav-tab-active' : ''; ?>">Reset Data</a> --> |
  | 87 | 99 | </h2> |
  | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2621330#L91) | […](/browser/mycred/trunk/includes/mycred-tools.php?rev=2648350#L103) |  |
  | 91 | 103 |  |
  | 92 | 104 | if ( isset( $\_GET['mycred-tools'] ) ) { |
  | 93 |  | if ( $\_GET['mycred-tools'] == 'import-export' ) { ?> |
  | 94 |  | <h1>IMPORT/EXPORT</h1> |
  | 95 |  | <?php |
  |  | 105 |  |
  |  | 106 | if ( in\_array( $\_GET['mycred-tools'], $pages ) ) |
  |  | 107 | { |
  |  | 108 | $mycred\_tools\_import\_export = new myCRED\_Tools\_Import\_Export(); |
  |  | 109 |  |
  |  | 110 | $mycred\_tools\_import\_export->get\_header(); |
  | 96 | 111 | } |
  | 97 | 112 | } |
* ## [mycred/trunk/includes/shortcodes/mycred\_video.php](/changeset/2648350/mycred/trunk/includes/shortcodes/mycred_video.php "Show the changeset 2648350 restricted to mycred/trunk/includes/shortcodes/mycred_video.php")

  | [r2096269](/browser/mycred/trunk/includes/shortcodes/mycred_video.php?rev=2096269#L8 "Show revision 2096269 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/shortcodes/mycred_video.php?rev=2648350#L8 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* @see http://codex.mycred.me/shortcodes/mycred\_video/ |
  | 9 | 9 | \* @since 1.2 |
  |  | 10 | \* @since 2.4 Removed logic, Interval greater than 3 was not working |
  | 10 | 11 | \* @version 1.2.2 |
  | 11 | 12 | \*/ |
  | […](/browser/mycred/trunk/includes/shortcodes/mycred_video.php?rev=2096269#L46) | […](/browser/mycred/trunk/includes/shortcodes/mycred_video.php?rev=2648350#L47) |  |
  | 46 | 47 |  |
  | 47 | 48 | // Interval |
  | 48 |  | if ( ~~strlen( $interval ) < 3~~ ) { |
  |  | 49 | if ( $interval ) { |
  | 49 | 50 | $interval = (float) $interval; |
  | 50 | 51 | $interval = abs( $interval \* 1000 ); |
* ## [mycred/trunk/includes/widgets/mycred-widget-leaderboard.php](/changeset/2648350/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php "Show the changeset 2648350 restricted to mycred/trunk/includes/widgets/mycred-widget-leaderboard.php")

  | [r2415257](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L25 "Show revision 2415257 of this file in browser") | [r2648350](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L25 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 |  |
  | 26 | 26 | } |
  |  | 27 |  |
  | 27 | 28 |  |
  | 28 | 29 | /\*\* |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L30) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L31) |  |
  | 30 | 31 | \*/ |
  | 31 | 32 | public function widget( $args, $instance ) { |
  |  | 33 |  |
  | 32 | 34 |  |
  | 33 | 35 | $instance['title']         = isset( $instance['title'] )         ? $instance['title']         : 'Leaderboard'; |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L36) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L38) |  |
  | 36 | 38 | $instance['total']         = isset( $instance['total'] )         ? $instance['total']         : 0; |
  | 37 | 39 | $instance['number']        = isset( $instance['number'] )        ? $instance['number']        : 5; |
  | 38 |  | $instance['show\_visitors'] = isset( $instance['show\_visitors'] ) ? $instance['show\_visitors'] : 0; |
  |  | 40 | $instance['show\_visitors'] = isset( $instance['show\_visitors'] ) ? $instance['show\_visitors']         : 0; |
  | 39 | 41 | $instance['row\_layout']    = isset( $instance['row\_layout'] )    ? $instance['row\_layout']    : '<span>#%position%</span> <span>%user\_profile\_link%</span> <span>%cred\_f%</span>'; |
  | 40 | 42 | $instance['offset']        = isset( $instance['offset'] )        ? $instance['offset']        : 0; |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L46) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L48) |  |
  | 46 | 48 | $instance['nothing']       = isset( $instance['nothing'] )       ? $instance['nothing']       : 'Leaderboard is empty'; |
  | 47 | 49 | $instance['exclude\_zero']  = isset( $instance['exclude\_zero'] )  ? $instance['exclude\_zero']  : 1; |
  |  | 50 | $instance['message']       = isset( $instance['message'] )        ? $instance['message']        : '<a href="%login\_url\_here%">Login</a> to view leaderboard.'; |
  |  | 51 |  |
  | 48 | 52 |  |
  | 49 | 53 | extract( $args, EXTR\_SKIP ); |
  |  | 54 |  |
  | 50 | 55 |  |
  | 51 | 56 | // Check if we want to show this to visitors |
  | 52 |  | if ( (! isset($instance['show\_visitors']) || ! $instance['show\_visitors']) && ! is\_user\_logged\_in() ) return; |
  | 53 |  |  |
  | 54 |  | if ( ! isset( $instance['type'] ) || empty( $instance['type'] ) ) |
  |  | 57 | if ( (! isset($instance['show\_visitors']) || ! $instance['show\_visitors'] ) && ! is\_user\_logged\_in() ) { |
  |  | 58 | return; |
  |  | 59 | } |
  |  | 60 |  |
  |  | 61 |  |
  |  | 62 | if ( !is\_user\_logged\_in() && !$instance['show\_visitors']  ) { |
  |  | 63 | return; |
  |  | 64 | } |
  |  | 65 |  |
  |  | 66 | if ( ! isset( $instance['type'] ) || empty( $instance['type'] ) ) { |
  | 55 | 67 | $instance['type'] = MYCRED\_DEFAULT\_TYPE\_KEY; |
  |  | 68 | } |
  | 56 | 69 |  |
  | 57 | 70 | $mycred = mycred( $instance['type'] ); |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L68) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L81) |  |
  | 68 | 81 | 'nothing' => $instance['nothing'], |
  | 69 | 82 | 'exclude\_zero' => $instance['exclude\_zero'], |
  | 70 |  | 'exclude' => $instance['exclude'] |
  |  | 83 | 'exclude' => $instance['exclude'], |
  |  | 84 | 'message' => $instance['message'] |
  |  | 85 |  |
  | 71 | 86 | ); |
  | 72 | 87 |  |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L74) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L89) |  |
  | 74 | 89 | $args['order'] = $instance['order']; |
  | 75 | 90 |  |
  | 76 |  | if ( isset(~~$instance['offset'] )~~ ) |
  |  | 91 | if ( isset($instance['offset'])  ) |
  | 77 | 92 | $args['offset'] = $instance['offset']; |
  | 78 |  |  |
  | 79 |  | if ( isset( $instance['current'] ) ) |
  | 80 |  | $args['current'] = 1; |
  |  | 93 |  |
  |  | 94 | if ( isset($instance['exclude'])  ) |
  |  | 95 | $args['exclude'] = $instance['exclude']; |
  |  | 96 |  |
  |  | 97 | if (  $instance['current'] === 0  ) { |
  |  | 98 | return; |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | if (  isset($instance['current'])  ) { |
  |  | 102 | $args['current'] = $instance['current']; |
  |  | 103 | } |
  | 81 | 104 |  |
  | 82 | 105 | echo $before\_widget; |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L85) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L108) |  |
  | 85 | 108 | if ( ! empty( $instance['title'] ) ) |
  | 86 | 109 | echo $before\_title . $mycred->template\_tags\_general( $instance['title'] ) . $after\_title; |
  | 87 |  |  |
  |  | 110 |  |
  | 88 | 111 | echo mycred\_render\_shortcode\_leaderboard( $args ); |
  | 89 |  |  |
  |  | 112 |  |
  | 90 | 113 | // Footer |
  | 91 | 114 | echo $after\_widget; |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L97) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L120) |  |
  | 97 | 120 | \*/ |
  | 98 | 121 | public function form( $instance ) { |
  |  | 122 |  |
  | 99 | 123 |  |
  | 100 | 124 | // Defaults |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L105) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L129) |  |
  | 105 | 129 |  |
  | 106 | 130 | $number        = isset( $instance['number'] )        ? $instance['number']        : 5; |
  | 107 |  | $show\_visitors = isset( $instance['show\_visitors'] ) ? $instance['show\_visitors'] : 0; |
  |  | 131 | $show\_visitors = isset( $instance['show\_visitors'] ) ? $instance['show\_visitors']   : 0; |
  | 108 | 132 | $row\_layout    = isset( $instance['row\_layout'] )    ? $instance['row\_layout']    : '<span>#%position%</span> <span>%user\_profile\_link%</span> <span>%cred\_f%</span>'; |
  | 109 | 133 | $offset        = isset( $instance['offset'] )        ? $instance['offset']        : 0; |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L115) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L139) |  |
  | 115 | 139 | $exclude\_zero  = isset( $instance['exclude\_zero'] )  ? $instance['exclude\_zero']  : 1; |
  | 116 | 140 | $exclude     = isset( $instance['exclude'] )     ? $instance['exclude']     : ''; |
  |  | 141 | $message        = isset( $instance['message'] )        ? $instance['message']        : '<a href="%login\_url\_here%">Login</a> to view leaderboard.'; |
  | 117 | 142 | $mycred        = mycred( $type ); |
  | 118 | 143 | $mycred\_types  = mycred\_get\_types(); |
  |  | 144 |  |
  |  | 145 |  |
  |  | 146 |  |
  | 119 | 147 |  |
  | 120 | 148 | ?> |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L164) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L192) |  |
  | 164 | 192 |  |
  | 165 | 193 | <p class="myCRED-widget-field"> |
  | 166 |  | <label for="<?php echo esc\_attr( $this->get\_field\_id( 'show\_visitors' ) ); ?>"><input type="checkbox" name="<?php echo esc\_attr( $this->get\_field\_name( 'show\_visitors' ) ); ?>" id="<?php echo esc\_attr( $this->get\_field\_id( 'show\_visitors' ) ); ?>" value="1"<?php checked( $show\_visitors, 1 ); ?> class="checkbox" /> <?php \_e( 'Visible to non-members', 'mycred' ); ?></label> |
  |  | 194 | <label for="<?php echo esc\_attr( $this->get\_field\_id( 'show\_visitors' ) ); ?>"> |
  |  | 195 |  |
  |  | 196 |  |
  |  | 197 | <input type="checkbox" id="<?php echo esc\_attr( $this->get\_field\_id( 'show\_visitors' ) ); ?>" name="<?php echo esc\_attr( $this->get\_field\_name( 'show\_visitors' ) ); ?>" value="1" <?php if( $show\_visitors == '1') echo "checked = 'checked'"; ?>> |
  |  | 198 |  |
  |  | 199 |  |
  |  | 200 |  |
  |  | 201 | <?php \_e( 'Visible to non-members', 'mycred' ); ?></label> |
  | 167 | 202 | </p> |
  | 168 | 203 | <p class="myCRED-widget-field"> |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L200) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L235) |  |
  | 200 | 235 | </p> |
  | 201 | 236 | <p class="myCRED-widget-field"> |
  | 202 |  | <label for="<?php echo esc\_attr( $this->get\_field\_id( 'current' ) ); ?>"><input type="checkbox" name="<?php echo esc\_attr( $this->get\_field\_name( 'current' ) ); ?>" id="<?php echo esc\_attr( $this->get\_field\_id( 'current' ) ); ?>" value="1"<?php checked( $current, 1 ); ?> class="checkbox" />  <?php \_e( 'Append current users position', 'mycred' ); ?></label><br /> |
  |  | 237 | <label for="<?php echo esc\_attr( $this->get\_field\_id( 'current' ) ); ?>"> |
  |  | 238 | <input type="checkbox" name="<?php echo esc\_attr( $this->get\_field\_name( 'current' ) ); ?>" id="<?php echo esc\_attr( $this->get\_field\_id( 'current' ) ); ?>" value="1"<?php if( $current == '1') echo "checked = 'checked'"; ?> class="checkbox" /> |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 |  |
  |  | 242 | <?php \_e( 'Append current users position', 'mycred' ); ?></label><br /> |
  | 203 | 243 | <small><?php \_e( 'If the current user is not in this leaderboard, you can select to append them at the end with their current position.', 'mycred' ); ?></small> |
  | 204 | 244 | </p> |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L223) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L263) |  |
  | 223 | 263 |  |
  | 224 | 264 | $instance                  = $old\_instance; |
  | 225 |  |  |
  |  | 265 |  |
  |  | 266 | $instance['show\_visitors']  = sanitize\_text\_field($new\_instance['show\_visitors']); |
  | 226 | 267 | $instance['number']        = absint( $new\_instance['number'] ); |
  | 227 | 268 | $instance['title']         = wp\_kses\_post( $new\_instance['title'] ); |
  | 228 | 269 | $instance['type']          = sanitize\_key( $new\_instance['type'] ); |
  | 229 |  | $instance['based\_on']      = sanitize\_~~key~~( $new\_instance['based\_on'] ); |
  |  | 270 | $instance['based\_on']      = sanitize\_text\_field( $new\_instance['based\_on'] ); |
  | 230 | 271 | $instance['total']         = sanitize\_key( $new\_instance['total'] ); |
  | 231 |  | $instance['show\_visitors'] = ( ~~isset( $new\_instance['show\_visitors'] ) ) ? 1~~ : 0; |
  |  | 272 | $instance['show\_visitors'] = ( !empty( $new\_instance['show\_visitors'] ) ) ? sanitize\_text\_field( $new\_instance['show\_visitors'] ) : 0; |
  | 232 | 273 | $instance['row\_layout']    = wp\_kses\_post( $new\_instance['row\_layout'] ); |
  | 233 | 274 | $instance['offset']        = sanitize\_text\_field( $new\_instance['offset'] ); |
  | 234 | 275 | $instance['order']         = sanitize\_text\_field( $new\_instance['order'] ); |
  | 235 |  | $instance['current']       = ~~( isset( $new\_instance['current'] ) ) ? 1 : 0~~; |
  |  | 276 | $instance['current']       = sanitize\_text\_field( $new\_instance['current'] ) ; |
  | 236 | 277 | $instance['timeframe']     = sanitize\_text\_field( $new\_instance['timeframe'] ); |
  | 237 | 278 | $instance['wrap']          = sanitize\_text\_field( $new\_instance['wrap'] ); |
  | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2415257#L239) | […](/browser/mycred/trunk/includes/widgets/mycred-widget-leaderboard.php?rev=2648350#L280) |  |
  | 239 | 280 | $instance['exclude\_zero']  = sanitize\_text\_field( $new\_instance['exclude\_zero'] ); |
  | 240 | 281 | $instance['exclude']  = sanitize\_text\_field( $new\_instance['exclude'] ); |
  |  | 282 |  |
  | 241 | 283 |  |
  | 242 | 284 | mycred\_flush\_widget\_cache( 'mycred\_widget\_list' ); |
* ## [mycred/trunk/modules/mycred-module-buddypress.php](/changeset/2648350/mycred/trunk/modules/mycred-module-buddypress.php "Show the changeset 2648350 restricted to mycred/trunk/modules/mycred-module-buddypress.php")

  | [r2043924](/browser/mycred/trunk/modules/mycred-module-buddypress.php?rev=2043924#L422 "Show revision 2043924 of this file in browser") | [r2648350](/browser/mycred/trunk/modules/mycred-module-buddypress.php?rev=2648350#L422 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 422 | 422 |  |
  | 423 | 423 | ?> |
  | 424 |  | <h4><span class="dashicons dashicons-admin-plugins static"></span><label>~~BuddyPress~~</label></h4> |
  |  | 424 | <h4><span class="dashicons dashicons-admin-plugins static"></span><label><?php echo apply\_filters( 'mycred\_bp\_change\_text', 'BuddyPress' ); ?></label></h4> |
  | 425 | 425 | <div class="body" style="display:none;"> |
  | 426 | 426 |  |
* ## [mycred/trunk/modules/mycred-module-log.php](/changeset/2648350/mycred/trunk/modules/mycred-module-log.php "Show the changeset 2648350 restricted to mycred/trunk/modules/mycred-module-log.php")

  | [r2043924](/browser/mycred/trunk/modules/mycred-module-log.php?rev=2043924#L337 "Show revision 2043924 of this file in browser") | [r2648350](/browser/mycred/trunk/modules/mycred-module-log.php?rev=2648350#L337 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 337 | 337 |  |
  | 338 | 338 | mycred\_delete\_option( 'mycred-cache-total-' . $log\_entry->ctype ); |
  |  | 339 |  |
  |  | 340 | $old\_creds = $this->core->number( $log\_entry->creds ); |
  |  | 341 |  |
  |  | 342 | $this->core->update\_users\_balance( $log\_entry->user\_id, $amount - $old\_creds, $point\_type ); |
  | 339 | 343 |  |
  | 340 | 344 | } |
  | […](/browser/mycred/trunk/modules/mycred-module-log.php?rev=2043924#L582) | […](/browser/mycred/trunk/modules/mycred-module-log.php?rev=2648350#L586) |  |
  | 582 | 586 | // Search Results |
  | 583 | 587 | if ( isset( $\_GET['s'] ) && ! empty( $\_GET['s'] ) ) |
  | 584 |  | $search\_for = ' <span class="subtitle">' . \_\_( 'Search results for', 'mycred' ) . ' "' . ~~$\_GET['s']~~ . '"</span>'; |
  |  | 588 | $search\_for = ' <span class="subtitle">' . \_\_( 'Search results for', 'mycred' ) . ' "' . sanitize\_text\_field( $\_GET['s'] ) . '"</span>'; |
  | 585 | 589 |  |
  | 586 | 590 | elseif ( isset( $\_GET['time'] ) && $\_GET['time'] != '' ) { |
* ## [mycred/trunk/mycred.php](/changeset/2648350/mycred/trunk/mycred.php "Show the changeset 2648350 restricted to mycred/trunk/mycred.php")

  | [r2632100](/browser/mycred/trunk/mycred.php?rev=2632100#L4 "Show revision 2632100 of this file in browser") | [r2648350](/browser/mycred/trunk/mycred.php?rev=2648350#L4 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://mycred.me |
  | 5 | 5 | \* Description: An adaptive points management system for WordPress powered websites. |
  | 6 |  | \* Version: 2.~~3.2~~ |
  |  | 6 | \* Version: 2.4 |
  | 7 | 7 | \* Tags: point, credit, loyalty program, engagement, reward, woocommerce rewards |
  | 8 | 8 | \* Author: myCred |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L21) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L21) |  |
  | 21 | 21 |  |
  | 22 | 22 | // Plugin Version |
  | 23 |  | public $version             = '2.~~3.2~~'; |
  |  | 23 | public $version             = '2.4'; |
  | 24 | 24 |  |
  | 25 | 25 | // Instnace |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L55) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L55) |  |
  | 55 | 55 | \* @version 1.0 |
  | 56 | 56 | \*/ |
  | 57 |  | public function \_\_clone() { \_doing\_it\_wrong( \_\_FUNCTION\_\_, 'Cheatin&#8217; huh?', '2.~~3.2~~' ); } |
  |  | 57 | public function \_\_clone() { \_doing\_it\_wrong( \_\_FUNCTION\_\_, 'Cheatin&#8217; huh?', '2.4' ); } |
  | 58 | 58 |  |
  | 59 | 59 | /\*\* |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L62) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L62) |  |
  | 62 | 62 | \* @version 1.0 |
  | 63 | 63 | \*/ |
  | 64 |  | public function \_\_wakeup() { \_doing\_it\_wrong( \_\_FUNCTION\_\_, 'Cheatin&#8217; huh?', '2.~~3.2~~' ); } |
  |  | 64 | public function \_\_wakeup() { \_doing\_it\_wrong( \_\_FUNCTION\_\_, 'Cheatin&#8217; huh?', '2.4' ); } |
  | 65 | 65 |  |
  | 66 | 66 | /\*\* |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L83) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L83) |  |
  | 83 | 83 | define( $name, $value ); |
  | 84 | 84 | elseif ( ! $definable && defined( $name ) ) |
  | 85 |  | \_doing\_it\_wrong( 'myCRED\_Core->define()', 'Could not define: ' . $name . ' as it is already defined somewhere else!', '2.~~2~~' ); |
  |  | 85 | \_doing\_it\_wrong( 'myCRED\_Core->define()', 'Could not define: ' . $name . ' as it is already defined somewhere else!', '2.4' ); |
  | 86 | 86 | } |
  | 87 | 87 |  |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L95) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L95) |  |
  | 95 | 95 | require\_once $required\_file; |
  | 96 | 96 | else |
  | 97 |  | \_doing\_it\_wrong( 'myCRED\_Core->file()', 'Requested file ' . $required\_file . ' not found.', '2.~~3.2~~' ); |
  |  | 97 | \_doing\_it\_wrong( 'myCRED\_Core->file()', 'Requested file ' . $required\_file . ' not found.', '2.4' ); |
  | 98 | 98 | } |
  | 99 | 99 |  |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L177) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L177) |  |
  | 177 | 177 | $this->define( 'myCRED\_CLASSES\_DIR',          myCRED\_INCLUDES\_DIR . 'classes/', false ); |
  | 178 | 178 | $this->define( 'myCRED\_IMPORTERS\_DIR',        myCRED\_INCLUDES\_DIR . 'importers/', false ); |
  |  | 179 | $this->define( 'myCRED\_BLOCKS\_DIR',           myCRED\_INCLUDES\_DIR . 'mycred-blocks/', false ); |
  | 179 | 180 | $this->define( 'myCRED\_SHORTCODES\_DIR',       myCRED\_INCLUDES\_DIR . 'shortcodes/', false ); |
  | 180 | 181 | $this->define( 'myCRED\_WIDGETS\_DIR',          myCRED\_INCLUDES\_DIR . 'widgets/', false ); |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L226) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L227) |  |
  | 226 | 227 | \* Include Plugin Files |
  | 227 | 228 | \* @since 1.7 |
  | 228 |  | \* @version 1.2 |
  |  | 229 | \* @since 2.4 Tools Import/ Export Added |
  |  | 230 | \* @version 1.3 |
  | 229 | 231 | \*/ |
  | 230 | 232 | public function includes() { |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L251) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L253) |  |
  | 251 | 253 | $this->file( myCRED\_INCLUDES\_DIR . 'mycred-tools.php' ); |
  | 252 | 254 | $this->file( myCRED\_INCLUDES\_DIR . 'mycred-tools-bulk-assign.php' ); |
  | 253 |  |  |
  |  | 255 | $this->file( myCRED\_INCLUDES\_DIR . 'mycred-tools-setup-import-export.php' ); |
  |  | 256 | $this->file( myCRED\_INCLUDES\_DIR . 'mycred-tools-import-export.php' ); |
  |  | 257 |  |
  | 254 | 258 | if( isset ( $\_GET['mycred\_tour\_guide'] ) ){ |
  | 255 | 259 |  |
  | […](/browser/mycred/trunk/mycred.php?rev=2632100#L279) | […](/browser/mycred/trunk/mycred.php?rev=2648350#L283) |  |
  | 279 | 283 | $this->file( myCRED\_MODULES\_DIR . 'mycred-module-caching.php' ); |
  | 280 | 284 |  |
  |  | 285 | // Mycred Blocks |
  |  | 286 | $this->file( myCRED\_BLOCKS\_DIR . 'mycred-blocks.php' ); |
  |  | 287 |  |
  | 281 | 288 | //Uninstall Settings |
  | 282 | 289 | $this->file( myCRED\_INCLUDES\_DIR . 'mycred-uninstall.php' ); |
* ## [mycred/trunk/readme.txt](/changeset/2648350/mycred/trunk/readme.txt "Show the changeset 2648350 restricted to mycred/trunk/readme.txt")

  | [r2632100](/browser/mycred/trunk/readme.txt?rev=2632100#L4 "Show revision 2632100 of this file in browser") | [r2648350](/browser/mycred/trunk/readme.txt?rev=2648350#L4 "Show revision 2648350 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.8 |
  | 5 | 5 | Tested up to: 5.8.2 |
  | 6 |  | Stable tag: 2.~~3.2~~ |
  |  | 6 | Stable tag: 2.4 |
  | 7 | 7 | Requires PHP: 7.0 |
  | 8 | 8 | License: GPLv2 or later |
  | […](/browser/mycred/trunk/readme.txt?rev=2632100#L31) | […](/browser/mycred/trunk/readme.txt?rev=2648350#L31) |  |
  | 31 | 31 | \* \*\*Badges -\*\* Boost your users' participation by rewarding them for their exceptional performance. |
  | 32 | 32 |  |
  |  | 33 | \*\*Latest update - myCred v2.4\*\* |
  |  | 34 |  |
  |  | 35 | \*\*myCred v2.4\*\* focuses on expanding the plugin’s ability to import and export points, ranks, and badges from and to other sites. What’s better is that you can choose to export or import complete setup settings like point types, achievements level, and created badges with achievements level with the simplest of ease. |
  |  | 36 |  |
  |  | 37 | Here is a list of the complete features introduced in myCred v2.4: |
  |  | 38 | \* Import or export user points |
  |  | 39 | \* Export all or specific point types |
  |  | 40 | \* Export setup settings for all point types |
  |  | 41 | \* Import or export setup settings in JSON format |
  |  | 42 | \* Import or all or specific export user ranks |
  |  | 43 | \* Import or export all or specific user badges |
  |  | 44 | \* Import badges With ID/Title/Slug |
  |  | 45 | \* Import ranks With ID/Title/Slug |
  |  | 46 | \* Export raw or formatted file |
  |  | 47 | \* Select users fields in the exported file |
  |  | 48 | \* Assign Badges/Ranks using coupons |
  |  | 49 | \* Merged myCred Gutenberg to myCred Core |
  |  | 50 |  |
  | 33 | 51 | \*\*Latest update - myCred v2.3\*\* |
  | 34 | 52 |  |
  | […](/browser/mycred/trunk/readme.txt?rev=2632100#L37) | […](/browser/mycred/trunk/readme.txt?rev=2648350#L55) |  |
  | 37 | 55 | Here are some of the most prominent features of the latest update: |
  | 38 | 56 |  |
  | 39 |  | \* A ~~“Bulk Assign”~~ tool for awarding/revoking points, badges, and ranks in bulk. |
  |  | 57 | \* A "Bulk Assign" tool for awarding/revoking points, badges, and ranks in bulk. |
  | 40 | 58 | \* The admin can exclude any user role from receiving points. Previously, the admin could only exclude users using user ID only. |
  | 41 | 59 | \* A timeframe attribute in [mycred\_my\_balance\_converted] shortcode - users can see their converted point balance in a given timeframe using predefined filters (Yesterday, Today, this week, this month, last month). |
  | 42 | 60 |  |
  | 43 |  | \*\*~~Las~~t update - myCred v2.2\*\* |
  |  | 61 | \*\*Recent update - myCred v2.2\*\* |
  | 44 | 62 |  |
  | 45 | 63 | \*\*myCred v2.2\*\* focuses on improving the overall user interface, single badge page layout, point-type image, and social media sharing for a better user experience and operational efficiency. |
  | […](/browser/mycred/trunk/readme.txt?rev=2632100#L282) | […](/browser/mycred/trunk/readme.txt?rev=2648350#L300) |  |
  | 282 | 300 | == Upgrade Notice == |
  | 283 | 301 |  |
  |  | 302 | = 2.4 = |
  |  | 303 | New features and Bug fixes. |
  |  | 304 |  |
  | 284 | 305 | = 2.3.2 = |
  | 285 | 306 | Code improvement. |
  | […](/browser/mycred/trunk/readme.txt?rev=2632100#L324) | […](/browser/mycred/trunk/readme.txt?rev=2648350#L345) |  |
  | 324 | 345 | == Changelog == |
  | 325 | 346 |  |
  |  | 347 | = 2.4 = |
  |  | 348 | - \*\*NEW\*\* - Introduced an Import/Export tool. |
  |  | 349 | - \*\*NEW\*\* - Admin can assign "Badges" and "Manual Ranks" using coupons. |
  |  | 350 | - \*\*NEW\*\* - Merged myCred Gutenberg to myCred Core. |
  |  | 351 | - \*\*TWEAK\*\* - Code improvements. |
  |  | 352 | - \*\*FIX\*\* - myCred video interval three-digit value not working |
  |  | 353 | - \*\*FIX\*\* - exclude\_zero attribute not working when total=1 in mycred\_leaderboard shortcode. |
  |  | 354 | - \*\*FIX\*\* - In the badge edit window, remove level button always removes the first level. |
  |  | 355 | - \*\*FIX\*\* - Badges are not visible in the user profile for non-admin users. |
  |  | 356 | - \*\*FIX\*\* - When updating log entry it will not reflect on the current balance. |
  |  | 357 | - \*\*FIX\*\* - CSS confliction with some themes. |
  |  | 358 | - \*\*FIX\*\* - Stopped users from getting points on signup referral multiple times on a single event. |
  |  | 359 | - \*\*FIX\*\* - Leaderboard excludes users by role not working. |
  |  | 360 | - \*\*FIX\*\* - Leaderboard excludes users by comma-separated ids not working. |
  |  | 361 |  |
  | 326 | 362 | = 2.3.2 = |
  | 327 | 363 | - \*\*TWAEK\*\* - Code improvement. |
  | […](/browser/mycred/trunk/readme.txt?rev=2632100#L337) | […](/browser/mycred/trunk/readme.txt?rev=2648350#L373) |  |
  | 337 | 373 | - \*\*FIX\*\* - Membership page layout issues. |
  | 338 | 374 | - \*\*FIX\*\* - Points conversion not working when using arrows to increase or decrease the amount in [mycred\_cashcred] shortcode. |
  | 339 |  | - \*\*FIX\*\* - buyCred payment dialog couldn~~’~~t load on the subsite. |
  |  | 375 | - \*\*FIX\*\* - buyCred payment dialog couldnâ€™t load on the subsite. |
  | 340 | 376 | - \*\*FIX\*\* - After deleting the badge their data will keep existing on the user's meta. |
  | 341 | 377 | - \*\*FIX\*\* - "this-week" value not working in [mycred\_leaderboard] timeframe attribute when the week starts other than "Monday" in your WordPress setting. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2648350)
* [Zip Archive](?format=zip&new=2648350)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


