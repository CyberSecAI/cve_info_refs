=== Content from gitlab.com_09f83bba_20250115_094037.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Revoked User can approve a Merge Request created by him via approve/unapprove API which leads to Merge request info leak

**[HackerOne report #1198317](https://hackerone.com/reports/1198317)** by `muthu_prakash` on 2021-05-15, assigned to GitLab Team:

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

In Gitlab when a user is demoted to Guest role, the Guest user will not be able to view and edit the Merge requests in a project even if the merge request is created by him. But the Guest user can use the Approvals API to approve/unapprove the merge request even after the User is demoted to Guest. This API also leaks the Merge request details which the guest user is not supposed to view.

##### Steps to reproduce

* Created a new Project with private access
* Created a new file in master branch (Made some changes )
* Invited a user with a maintainer role.
* From the maintainer role account created a new branch named test, made some changes.
* After that from project admin account I created a Merge request with source branch as test and target branch as master.
* Assigned that merge request to the maintainer role access user.
* After creating the merge request, from project admin account demoted the maintainer role user to Guest role
* From demoted user account I created a personal access token with all the available scopes selected
* Using API client sent a POST request to the approvals endpoint

  Sample endpoint:
  + <https://gitlab.com/api/v4/projects/26669301/merge_requests/1/unapprove>
  + <https://gitlab.com/api/v4/projects/26669301/merge_requests/1/approve>
* This API endpoint will respond with 201 status with the merge request details which the Guest user is not supposed to approve and view.

##### Impact

Demoted users can approve the merge requests created by them and can view the confidential data of those merge requests once their role revoked. This leads to sensitive info disclosure to unauthorised users

##### What is the current *bug* behavior?

Demoted users can approve the merge requests created by them and can view the confidential data of those merge requests once their role is revoked

##### What is the expected *correct* behavior?

Demoted users should be blocked from approving the merge requests created by them and viewing the confidential data of those merge requests once their role is revoked

##### Output of checks

This bug happens on GitLab.com

#### Impact

Demoted users can approve the merge requests created by them and can view the confidential data of those merge requests once their role revoked. This leads to sensitive info disclosure to unauthorised users

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_9350897f_20250115_094035.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39945.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39945.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39945.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39945.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Dec 13, 2021

  [65e8ec7a](/gitlab-org/cves/-/commit/65e8ec7af2b031135072d10081090c39f1d9fb14)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/65e8ec7af2b031135072d10081090c39f1d9fb14)
  ·
  65e8ec7a

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Dec 13, 2021

  65e8ec7a

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/65e8ec7af2b031135072d10081090c39f1d9fb14)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Dec 13, 2021

Loading


