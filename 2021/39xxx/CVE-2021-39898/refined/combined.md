=== Content from gitlab.com_de35d714_20250114_231715.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Webhook token leaked in project exports allowing to trigger CI pipeline

**[HackerOne report #698068](https://hackerone.com/reports/698068)** by `xanbanx` on 2019-09-19, assigned to [@jritchey](/jritchey "James Ritchey"):

Hi GitLab Security Team,

### Summary

When exporting a Github connect repository within GitLab, the project export contains the `external_webhook_token`. This token allows anyone in possession to forge authentic requests to trigger a CI pipeline within GitLab although the person might not be a project member anymore.

### Steps to reproduce

Tested on GitLab Enterprise Edition 12.3.0-pre [32dae283](/gitlab-org/gitlab/-/commit/32dae28364b37b63bd5e628108ec4c6bbfa0502f "Merge branch '1487-audit-events-for-protected-events' into 'master'")

Before, create a **Github** account, create a project there, and push a valid `.gitlab-ci.yml` file.

1. Create a new project. Chose `CI/CD for external repo` to import a project
2. Chose `Github` under `Connect repositories from`
3. Enter your personal access token from your GitHub account where you want to import the project from
4. Select the project you created before Github for sync
5. After importing the project, goto `https://example.gitlab.com/<namespace>/<project>/edit` and export the project
6. Download the project archive, extract it, and inspect the containing `project.json`

```
...
    "jobs_cache_index": null,
    "external_authorization_classification_label": "",
    "external_webhook_token": "hcnPbsfximlueXxaaIkg",
    "pages_https_only": true,
    "merge_requests_author_approval": null,
...
```

Note, this is a fake token for the report.

When looking in the code one observes the request `POST :id/mirror/pull` in <https://gitlab.com/gitlab-org/gitlab/blob/master/ee/lib/api/project_mirror.rb#L59>. This request is used to trigger a new pipeline for a Github connected repository. This request uses the `X-Hub-Signature` header to authenticate the request to create the pipeline. This signature is computed by computing an HMAC over the request data using `external_webhook_token` as the key.

By being in possession of `external_webhook_token` it means that you craft a request and forge a valid `X-Hub-Signature` to create a new pipeline. So anyone, who can download the project can later on, when for example he is not a project member anymore, craft such a request and thereby trigger a pipeline.

### Impact

The external `external_webhook_token` is exported. This allows anyone in possession of this token to forge a valid POST request to trigger a new CI pipeline. In the worst case, an attacker can possibly create thousands of CI pipelines and thus DoS the CI infrastructure.

### What is the current *bug* behavior?

The project export contains `external_webhook_token`. This allows anyone to forge a POST request to start a new pipeline.

### What is the expected *correct* behavior?

Do not include the `external_webhook_token` in the project export. Anyway, it is not useful because this secret is bound to one specific webhook at Github, which still points to the original GitLab project. Importing the project to a different namespace or different GitLab instance would therefore make this token not working anymore.

### Output of checks

This bug happens on GitLab.com

Best regards,

Xanbanx

## Impact

See above.

## Implementation plan

* [backend](/gitlab-org/gitlab/-/issues?label_name=backend "Issues that require backend work") Add `external_webhook_token` to `excluded_attributes -> project` in <https://gitlab.com/gitlab-org/gitlab/blob/master/lib/gitlab/import_export/project/import_export.yml#L162> and remove it from <https://gitlab.com/gitlab-org/gitlab/blob/master/spec/lib/gitlab/import_export/safe_model_attributes.yml#L569>,
* [test](/gitlab-org/gitlab/-/issues?label_name=test "Issues related to our test suite") Verify if exported project does not contain that token,

Edited Oct 05, 2021 by [Alan (Maciej) Paruszewski](/alan)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_acc8beae_20250114_231713.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39898.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39898.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39898.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39898.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Nov 04, 2021

  [43725fb9](/gitlab-org/cves/-/commit/43725fb9155ae0648d2687a97eb5abcef66bb242)
  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/43725fb9155ae0648d2687a97eb5abcef66bb242)
  ·
  43725fb9

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

  43725fb9

  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/43725fb9155ae0648d2687a97eb5abcef66bb242)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

Loading


