```json
{
  "cveId": "CVE-2021-39341",
  "description": "The OptinMonster WordPress plugin is vulnerable to sensitive information disclosure and unauthorized setting updates due to insufficient authorization validation via the `logged_in_or_has_api_key` function in the ~/OMAPI/RestApi.php file that can used to exploit inject malicious web scripts on sites with the plugin installed. This affects versions up to, and including, 2.6.4.",
  "vulnerability": {
    "rootCause": "The plugin's REST API endpoints lacked proper authorization checks. Specifically, the `logged_in_or_has_api_key` function incorrectly allowed access based on a `Referer` header check, allowing unauthenticated requests.  Additionally, the function failed to properly restrict access based on the HTTP request type, allowing attackers to bypass capability checks.",
    "weaknesses": [
      "Insecure Direct Object Reference",
      "Improper Authorization",
       "Insufficient Verification of Data Authenticity"
    ],
    "impact": "An unauthenticated attacker could gain access to sensitive data such as the site's full path and API key. The API key could then be used to make unauthorized changes to any campaign associated with a site's connected OptinMonster account, including adding malicious Javascript, leading to site redirection, complete site takeover, injecting new admin user accounts, or creating backdoors.",
    "attackVectors": "An unauthenticated attacker could send crafted HTTP requests to the insecure REST-API endpoints, specifically /wp-json/omapp/v1/support and others, by setting the `Referer` header to `https://wp.app.optinmonster.test`, the HTTP request type to OPTIONS, and the `X-HTTP-Method-Override` header to GET or POST.",
    "attackerCapabilities": "The attacker does not need any authentication. They need to be able to send HTTP requests to the vulnerable WordPress site and craft the specific headers.",
        "additionalDetails": "The vulnerability allowed attackers to retrieve sensitive information via the `/wp-json/omapp/v1/support` endpoint, including the site's full path and API key for the OptinMonster app. This API key could then be used to modify campaign settings and add arbitrary JavaScript which could lead to further site compromises. The vulnerability was due to insufficient capability checking in the `logged_in_or_has_api_key` function used as the `permissions_callback` for the plugin's REST API endpoints. The function incorrectly granted access if the request had a `Referer` header set to `https://wp.app.optinmonster.test` and the HTTP request type set to OPTIONS, allowing unauthenticated users to make arbitrary requests."
  }
}
```