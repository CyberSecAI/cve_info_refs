=== Content from github.com_7377384a_20250114_193432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F699490be8e931af0ef1f135c55384db1f4232637)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F699490be8e931af0ef1f135c55384db1f4232637)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenOLAT%2FOpenOLAT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenOLAT](/OpenOLAT)
/
**[OpenOLAT](/OpenOLAT/OpenOLAT)**
Public

* [Notifications](/login?return_to=%2FOpenOLAT%2FOpenOLAT) You must be signed in to change notification settings
* [Fork
  146](/login?return_to=%2FOpenOLAT%2FOpenOLAT)
* [Star
   344](/login?return_to=%2FOpenOLAT%2FOpenOLAT)

* [Code](/OpenOLAT/OpenOLAT)
* [Issues
  2](/OpenOLAT/OpenOLAT/issues)
* [Pull requests
  2](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects
  0](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

Additional navigation options

* [Code](/OpenOLAT/OpenOLAT)
* [Issues](/OpenOLAT/OpenOLAT/issues)
* [Pull requests](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

## Commit

[Permalink](/OpenOLAT/OpenOLAT/commit/699490be8e931af0ef1f135c55384db1f4232637)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

OO-5549: fix the wiki import and add some unit tests

[Browse files](/OpenOLAT/OpenOLAT/tree/699490be8e931af0ef1f135c55384db1f4232637)
Browse the repository at this point in the history

* Loading branch information

[![@lainsr](https://avatars.githubusercontent.com/u/1712399?s=40&v=4)](/lainsr)

[lainsr](/OpenOLAT/OpenOLAT/commits?author=lainsr "View all commits by lainsr")
committed
Jun 22, 2021

1 parent
[b39c9ee](/OpenOLAT/OpenOLAT/commit/b39c9ee24e057c655392968ae30c0e9c8ee2a2de)

commit 699490b

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**164 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/olat

    - core/util

      * src/main/java/org/olat/core/util/PathUtils.java
        [PathUtils.java](#diff-33c676e463b92a7049d7670ff3f11b320a77a1fe44e90bd1fb28c5f771ef7d6b)
    - fileresource/types

      * src/main/java/org/olat/fileresource/types/FileResource.java
        [FileResource.java](#diff-4331f28594b53461c1cf8251a2321ffb48098c6288165075cf2566bcaaba6bb0)
      * src/main/java/org/olat/fileresource/types/ImsCPFileResource.java
        [ImsCPFileResource.java](#diff-0398d6372968ac41de7a5f3d30a0859717ec46204cefc0717b6e9b0696b37775)
      * src/main/java/org/olat/fileresource/types/ImsQTI21Resource.java
        [ImsQTI21Resource.java](#diff-de350ad6b13733a6e856a9c78c30eaeba23a864185d2616b37448e1411f4192b)
      * src/main/java/org/olat/fileresource/types/ScormCPFileResource.java
        [ScormCPFileResource.java](#diff-b846596af261dee9f850c6ffafcd7fff683576cde42b067eb523539d87bea07a)
    - modules/wiki

      * src/main/java/org/olat/modules/wiki/WikiManager.java
        [WikiManager.java](#diff-b3f00174ded9dcc934acb1b6c0107b28cf98f6edef1ab3ac6e5ef4cf67b7967d)
  + test/java/org/olat

    - modules

      * ims/cp

        + src/test/java/org/olat/modules/ims/cp/ImsCPHandlerTest.java
          [ImsCPHandlerTest.java](#diff-519cbbafa8bef9a342bf4a22bc9c246e29b192257fe558fa4b9c573275c00666)
        + src/test/java/org/olat/modules/ims/cp/imscp.zip
          [imscp.zip](#diff-479006f972b95d96f53d4f9b9e7bc408817818455dfe596344d79a4fd217da16)
        + src/test/java/org/olat/modules/ims/cp/imscp\_alt.zip
          [imscp\_alt.zip](#diff-6f0a8e3fd75cbe0b8898bdc41f6e363c378d51a76b114775ab465b153c71ccab)
      * wiki

        + src/test/java/org/olat/modules/wiki/WikiManagerTest.java
          [WikiManagerTest.java](#diff-bab6d615257410f8908cf6260c8d268bcda61f80714532561f296126d4b52f57)
        + src/test/java/org/olat/modules/wiki/wiki.zip
          [wiki.zip](#diff-d16ea65c543bdaf7ff5f90c17d77f526b9bc3e7c019f6f69d3f0415e15ea4b1a)
        + src/test/java/org/olat/modules/wiki/wiki\_alt.zip
          [wiki\_alt.zip](#diff-f102bd6ef4d4b6a0b05b1f124430c03252456be7c7e24260c9f4b7d44d6ee89d)
    - test

      * src/test/java/org/olat/test/AllTestsJunit4.java
        [AllTestsJunit4.java](#diff-3fff0aea405c89497d8138446b032ba13d4f9e20853daf17b6f2e08874dd291a)

## There are no files selected for viewing

14 changes: 11 additions & 3 deletions

14
[src/main/java/org/olat/core/util/PathUtils.java](#diff-33c676e463b92a7049d7670ff3f11b320a77a1fe44e90bd1fb28c5f771ef7d6b "src/main/java/org/olat/core/util/PathUtils.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/core/util/PathUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,6 +22,7 @@ |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  | import java.nio.file.FileSystems; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.FileVisitor; |
|  |  | import java.nio.file.Files; |
| Expand All | | @@ -32,9 +33,11 @@ |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.StandardCopyOption; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.EnumSet; |
|  |  | import java.util.ServiceConfigurationError; |
|  |  |  |
|  |  | import org.apache.commons.io.IOUtils; |
|  |  | import org.olat.core.logging.OLATRuntimeException; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
| Expand Down  Expand Up | | @@ -62,7 +65,8 @@ public static boolean copyFileToDir(Path source, File targetDir, String path) th |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Use the closeSubsequentFS method to close the file system. |
|  |  | \* Use the closeSubsequentFS method to close the file system. The method doesn't |
|  |  | \* follow sym. links and its depth is limited. |
|  |  | \* |
|  |  | \* @param file The file to visit |
|  |  | \* @param filename The filename |
| Expand Down  Expand Up | | @@ -90,14 +94,14 @@ public static Path visit(File file, String filename, FileVisitor<Path> visitor) |
|  |  | fPath = file.toPath(); |
|  |  | } |
|  |  | if(fPath != null) { |
|  |  | Files.walkFileTree(fPath, visitor); |
|  |  | Files.walkFileTree(fPath, EnumSet.noneOf(FileVisitOption.class), 32, visitor); |
|  |  | } |
|  |  | return fPath; |
|  |  | } |
|  |  |  |
|  |  | public static void closeSubsequentFS(Path path) { |
|  |  | if(path != null && FileSystems.getDefault() != path.getFileSystem()) { |
|  |  | IOUtils.closeQuietly(path.getFileSystem()); |
|  |  | IOUtils.closeQuietly(path.getFileSystem(), null); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -125,6 +129,10 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) |
|  |  | throws IOException { |
|  |  | Path relativeFile = source.relativize(file); |
|  |  | final Path destFile = Paths.get(destDir.toString(), relativeFile.toString()); |
|  |  | Path normalizedPath = destFile.normalize(); |
|  |  | if(!normalizedPath.startsWith(destDir)) { |
|  |  | throw new OLATRuntimeException("Invalid ZIP"); |
|  |  | } |
|  |  | if(filter.matches(file)) { |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | } |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[src/main/java/org/olat/fileresource/types/FileResource.java](#diff-4331f28594b53461c1cf8251a2321ffb48098c6288165075cf2566bcaaba6bb0 "src/main/java/org/olat/fileresource/types/FileResource.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/fileresource/types/FileResource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,20 +30,22 @@ |
|  |  | import java.nio.charset.Charset; |
|  |  | import java.nio.file.FileSystem; |
|  |  | import java.nio.file.FileSystems; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.PathMatcher; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.nio.file.spi.FileSystemProvider; |
|  |  | import java.util.EnumSet; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  | import java.util.zip.ZipEntry; |
|  |  | import java.util.zip.ZipFile; |
|  |  |  |
|  |  | import org.olat.core.id.OLATResourceable; |
|  |  | import org.apache.logging.log4j.Logger; |
|  |  | import org.olat.core.id.OLATResourceable; |
|  |  | import org.olat.core.logging.Tracing; |
|  |  | import org.olat.core.util.CodeHelper; |
|  |  | import org.olat.core.util.PathUtils; |
| Expand Down  Expand Up | | @@ -193,7 +195,7 @@ private static boolean isEncodingOk(File file, String encoding) { |
|  |  | protected static RootSearcher searchRootDirectory(Path fPath) |
|  |  | throws IOException { |
|  |  | RootSearcher rootSearcher = new RootSearcher(); |
|  |  | Files.walkFileTree(fPath, rootSearcher); |
|  |  | Files.walkFileTree(fPath, EnumSet.noneOf(FileVisitOption.class), 16, rootSearcher); |
|  |  | return rootSearcher; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -209,7 +211,7 @@ public static boolean copyResource(File file, String filename, File targetDirect |
|  |  | } |
|  |  |  |
|  |  | Path destDir = targetDirectory.toPath(); |
|  |  | Files.walkFileTree(path, new CopyVisitor(path, destDir, filter)); |
|  |  | Files.walkFileTree(path, EnumSet.noneOf(FileVisitOption.class), 24, new CopyVisitor(path, destDir, filter)); |
|  |  | PathUtils.closeSubsequentFS(path); |
|  |  | return true; |
|  |  | } catch (IOException e) { |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[src/main/java/org/olat/fileresource/types/ImsCPFileResource.java](#diff-0398d6372968ac41de7a5f3d30a0859717ec46204cefc0717b6e9b0696b37775 "src/main/java/org/olat/fileresource/types/ImsCPFileResource.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/fileresource/types/ImsCPFileResource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,11 +27,13 @@ |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.EnumSet; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Iterator; |
|  |  | import java.util.List; |
| Expand Down  Expand Up | | @@ -75,7 +77,7 @@ public static ResourceEvaluation evaluate(File file, String filename) { |
|  |  | Path manifestPath = fPath.resolve(realManifestPath); |
|  |  |  |
|  |  | RootSearcher rootSearcher = new RootSearcher(); |
|  |  | Files.walkFileTree(fPath, rootSearcher); |
|  |  | Files.walkFileTree(fPath, EnumSet.noneOf(FileVisitOption.class), 16, rootSearcher); |
|  |  | if(rootSearcher.foundRoot()) { |
|  |  | manifestPath = rootSearcher.getRoot().resolve(IMS\_MANIFEST); |
|  |  | } else { |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[src/main/java/org/olat/fileresource/types/ImsQTI21Resource.java](#diff-de350ad6b13733a6e856a9c78c30eaeba23a864185d2616b37448e1411f4192b "src/main/java/org/olat/fileresource/types/ImsQTI21Resource.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/fileresource/types/ImsQTI21Resource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,11 +29,13 @@ |
|  |  | import java.io.IOException; |
|  |  | import java.io.InputStream; |
|  |  | import java.net.URI; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.EnumSet; |
|  |  |  |
|  |  | import org.apache.logging.log4j.Logger; |
|  |  | import org.olat.core.logging.Tracing; |
| Expand Down  Expand Up | | @@ -79,7 +81,7 @@ public static ResourceEvaluation evaluate(File file, String filename) { |
|  |  | Path manifestPath = fPath.resolve(realManifestPath); |
|  |  |  |
|  |  | RootSearcher rootSearcher = new RootSearcher(); |
|  |  | Files.walkFileTree(fPath, rootSearcher); |
|  |  | Files.walkFileTree(fPath, EnumSet.noneOf(FileVisitOption.class), 16, rootSearcher); |
|  |  | if(rootSearcher.foundRoot()) { |
|  |  | manifestPath = rootSearcher.getRoot().resolve(IMS\_MANIFEST); |
|  |  | } else { |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[src/main/java/org/olat/fileresource/types/ScormCPFileResource.java](#diff-b846596af261dee9f850c6ffafcd7fff683576cde42b067eb523539d87bea07a "src/main/java/org/olat/fileresource/types/ScormCPFileResource.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/fileresource/types/ScormCPFileResource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,11 +27,13 @@ |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.EnumSet; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.HashSet; |
|  |  | import java.util.Iterator; |
| Expand Down  Expand Up | | @@ -79,7 +81,7 @@ public static ResourceEvaluation evaluate(File file, String filename) { |
|  |  | Path manifestPath = fPath.resolve(realManifestPath); |
|  |  |  |
|  |  | RootSearcher rootSearcher = new RootSearcher(); |
|  |  | Files.walkFileTree(fPath, rootSearcher); |
|  |  | Files.walkFileTree(fPath, EnumSet.noneOf(FileVisitOption.class), 16, rootSearcher); |
|  |  | if(rootSearcher.foundRoot()) { |
|  |  | manifestPath = rootSearcher.getRoot().resolve(IMS\_MANIFEST); |
|  |  | } else { |
| Expand Down | |  |

20 changes: 14 additions & 6 deletions

20
[src/main/java/org/olat/modules/wiki/WikiManager.java](#diff-b3f00174ded9dcc934acb1b6c0107b28cf98f6edef1ab3ac6e5ef4cf67b7967d "src/main/java/org/olat/modules/wiki/WikiManager.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/main/java/org/olat/modules/wiki/WikiManager.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,13 +30,15 @@ |
|  |  | import java.io.InputStream; |
|  |  | import java.io.OutputStream; |
|  |  | import java.io.UnsupportedEncodingException; |
|  |  | import java.nio.file.FileVisitOption; |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.Paths; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.StandardCopyOption; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.EnumSet; |
|  |  | import java.util.Iterator; |
|  |  | import java.util.List; |
|  |  | import java.util.Properties; |
| Expand Down  Expand Up | | @@ -162,7 +164,7 @@ public boolean importWiki(File file, String filename, File targetDirectory) { |
|  |  | } |
|  |  |  |
|  |  | Path destDir = targetDirectory.toPath(); |
|  |  | Files.walkFileTree(path, new ImportVisitor(destDir)); |
|  |  | Files.walkFileTree(path, EnumSet.noneOf(FileVisitOption.class), 16, new ImportVisitor(destDir)); |
|  |  | PathUtils.closeSubsequentFS(path); |
|  |  | return true; |
|  |  | } catch (IOException e) { |
| Expand Down  Expand Up | | @@ -299,26 +301,32 @@ public ImportVisitor(Path destDir) throws IOException { |
|  |  | public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) |
|  |  | throws IOException { |
|  |  | String filename = file.getFileName().toString(); |
|  |  | Path normalizedPath = file.normalize(); |
|  |  | if(!normalizedPath.startsWith(destDir)) { |
|  |  | throw new IOException("Invalid ZIP"); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | if(filename.endsWith(WikiManager.WIKI\_PROPERTIES\_SUFFIX)) { |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | checkDestinationFile(destFile); |
|  |  | resetAndCopyProperties(file, destFile); |
|  |  | } else if (filename.endsWith(WIKI\_FILE\_SUFFIX)) { |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | checkDestinationFile(destFile); |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | } else if (!filename.contains(WIKI\_FILE\_SUFFIX + "-") |
|  |  | && !filename.contains(WIKI\_PROPERTIES\_SUFFIX + "-")) { |
|  |  | final Path destFile = Paths.get(mediaDir.toString(), file.toString()); |
|  |  | checkDestinationFile(destFile); |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | } |
|  |  | return FileVisitResult.CONTINUE; |
|  |  | } |
|  |  |  |
|  |  | private void checkDestinationFile(Path destFile) throws IOException { |
|  |  | Path normalizedPath = destFile.normalize(); |
|  |  | if(!normalizedPath.startsWith(destDir)) { |
|  |  | throw new OLATRuntimeException("Invalid ZIP"); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[src/test/java/org/olat/modules/ims/cp/ImsCPHandlerTest.java](#diff-519cbbafa8bef9a342bf4a22bc9c246e29b192257fe558fa4b9c573275c00666 "src/test/java/org/olat/modules/ims/cp/ImsCPHandlerTest.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/ims/cp/ImsCPHandlerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,61 @@ |
|  |  | package org.olat.modules.ims.cp; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.net.URISyntaxException; |
|  |  | import java.net.URL; |
|  |  | import java.util.Locale; |
|  |  |  |
|  |  | import org.junit.Assert; |
|  |  | import org.junit.Test; |
|  |  | import org.olat.core.id.Identity; |
|  |  | import org.olat.core.logging.OLATRuntimeException; |
|  |  | import org.olat.fileresource.FileResourceManager; |
|  |  | import org.olat.fileresource.types.ImsCPFileResource; |
|  |  | import org.olat.repository.RepositoryEntry; |
|  |  | import org.olat.repository.handlers.RepositoryHandler; |
|  |  | import org.olat.repository.handlers.RepositoryHandlerFactory; |
|  |  | import org.olat.test.JunitTestHelper; |
|  |  | import org.olat.test.OlatTestCase; |
|  |  | import org.springframework.beans.factory.annotation.Autowired; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* Initial date: 22 juin 2021<br> |
|  |  | \* @author srosse, stephane.rosse@frentix.com, http://www.frentix.com |
|  |  | \* |
|  |  | \*/ |
|  |  | public class ImsCPHandlerTest extends OlatTestCase { |
|  |  |  |
|  |  | @Autowired |
|  |  | private RepositoryHandlerFactory handlerFactory; |
|  |  |  |
|  |  | @Test |
|  |  | public void importImsCP() throws URISyntaxException { |
|  |  | Identity author = JunitTestHelper.createAndPersistIdentityAsRndAuthor("ims-cp-1"); |
|  |  | URL imsCpUrl = ImsCPHandlerTest.class.getResource("imscp.zip"); |
|  |  | File imsCpFile = new File(imsCpUrl.toURI()); |
|  |  |  |
|  |  | RepositoryHandler cpHandler = handlerFactory.getRepositoryHandler(ImsCPFileResource.TYPE\_NAME); |
|  |  | RepositoryEntry entry = cpHandler.importResource(author, null, "IMS CP", null, false, null, Locale.ENGLISH, imsCpFile, imsCpFile.getName()); |
|  |  | Assert.assertNotNull(entry); |
|  |  |  |
|  |  | File cpRoot = FileResourceManager.getInstance().unzipFileResource(entry.getOlatResource()); |
|  |  | File image = new File(cpRoot, "IMG\_1482.jpg"); |
|  |  | Assert.assertTrue(image.exists()); |
|  |  | File manifestXml = new File(cpRoot, "imsmanifest.xml"); |
|  |  | Assert.assertTrue(manifestXml.exists()); |
|  |  | File page = new File(cpRoot, "new.html"); |
|  |  | Assert.assertTrue(page.exists()); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected=OLATRuntimeException.class) |
|  |  | public void importImsCPSlide() throws URISyntaxException { |
|  |  | Identity author = JunitTestHelper.createAndPersistIdentityAsRndAuthor("ims-cp-1"); |
|  |  | URL imsCpUrl = ImsCPHandlerTest.class.getResource("imscp\_alt.zip"); |
|  |  | File imsCpFile = new File(imsCpUrl.toURI()); |
|  |  |  |
|  |  | RepositoryHandler cpHandler = handlerFactory.getRepositoryHandler(ImsCPFileResource.TYPE\_NAME); |
|  |  | cpHandler.importResource(author, null, "IMS CP", null, false, null, Locale.ENGLISH, imsCpFile, imsCpFile.getName()); |
|  |  | } |
|  |  |  |
|  |  | } |

Binary file added
BIN
+12.7 KB

[src/test/java/org/olat/modules/ims/cp/imscp.zip](#diff-479006f972b95d96f53d4f9b9e7bc408817818455dfe596344d79a4fd217da16 "src/test/java/org/olat/modules/ims/cp/imscp.zip")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/ims/cp/imscp.zip)
Edit file

Delete file

Binary file not shown.

Binary file added
BIN
+10.3 KB

[src/test/java/org/olat/modules/ims/cp/imscp\_alt.zip](#diff-6f0a8e3fd75cbe0b8898bdc41f6e363c378d51a76b114775ab465b153c71ccab "src/test/java/org/olat/modules/ims/cp/imscp_alt.zip")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/ims/cp/imscp_alt.zip)
Edit file

Delete file

Binary file not shown.

62 changes: 62 additions & 0 deletions

62
[src/test/java/org/olat/modules/wiki/WikiManagerTest.java](#diff-bab6d615257410f8908cf6260c8d268bcda61f80714532561f296126d4b52f57 "src/test/java/org/olat/modules/wiki/WikiManagerTest.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/wiki/WikiManagerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,62 @@ |
|  |  | package org.olat.modules.wiki; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.net.URISyntaxException; |
|  |  | import java.net.URL; |
|  |  |  |
|  |  | import org.junit.After; |
|  |  | import org.junit.Before; |
|  |  | import org.junit.Test; |
|  |  | import org.olat.core.logging.OLATRuntimeException; |
|  |  | import org.olat.core.util.CodeHelper; |
|  |  | import org.olat.core.util.FileUtils; |
|  |  | import org.olat.core.util.WebappHelper; |
|  |  | import org.olat.test.OlatTestCase; |
|  |  | import org.springframework.beans.factory.annotation.Autowired; |
|  |  | import org.wildfly.common.Assert; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* Initial date: 22 juin 2021<br> |
|  |  | \* @author srosse, stephane.rosse@frentix.com, http://www.frentix.com |
|  |  | \* |
|  |  | \*/ |
|  |  | public class WikiManagerTest extends OlatTestCase { |
|  |  |  |
|  |  | @Autowired |
|  |  | private WikiManager wikiManager; |
|  |  |  |
|  |  | private File tmpWikiDir; |
|  |  |  |
|  |  | @Before |
|  |  | public void createTmpDir() { |
|  |  | tmpWikiDir = new File(WebappHelper.getTmpDir(), "wiki" + CodeHelper.getForeverUniqueID()); |
|  |  | } |
|  |  |  |
|  |  | @After |
|  |  | public void deleteTmpDir() { |
|  |  | FileUtils.deleteDirsAndFiles(tmpWikiDir, true, true); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void importWiki() throws URISyntaxException { |
|  |  | URL wikiUrl = WikiManagerTest.class.getResource("wiki.zip"); |
|  |  | File wikiFile = new File(wikiUrl.toURI()); |
|  |  | wikiManager.importWiki(wikiFile, null, tmpWikiDir); |
|  |  |  |
|  |  | File image = new File(tmpWikiDir, "media/IMG\_1482.jpg"); |
|  |  | Assert.assertTrue(image.exists()); |
|  |  | File imageMetadata = new File(tmpWikiDir, "media/IMG\_1482.jpg.metadata"); |
|  |  | Assert.assertTrue(imageMetadata.exists()); |
|  |  | File indexPage = new File(tmpWikiDir, "wiki/SW5kZXg=.wp"); |
|  |  | Assert.assertTrue(indexPage.exists()); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected=OLATRuntimeException.class) |
|  |  | public void importWikiSlide() throws URISyntaxException { |
|  |  | URL wikiUrl = WikiManagerTest.class.getResource("wiki\_alt.zip"); |
|  |  | File wikiFile = new File(wikiUrl.toURI()); |
|  |  | wikiManager.importWiki(wikiFile, null, tmpWikiDir); |
|  |  | } |
|  |  |  |
|  |  | } |

Binary file added
BIN
+5.6 KB

[src/test/java/org/olat/modules/wiki/wiki.zip](#diff-d16ea65c543bdaf7ff5f90c17d77f526b9bc3e7c019f6f69d3f0415e15ea4b1a "src/test/java/org/olat/modules/wiki/wiki.zip")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/wiki/wiki.zip)
Edit file

Delete file

Binary file not shown.

Binary file added
BIN
+5.61 KB

[src/test/java/org/olat/modules/wiki/wiki\_alt.zip](#diff-f102bd6ef4d4b6a0b05b1f124430c03252456be7c7e24260c9f4b7d44d6ee89d "src/test/java/org/olat/modules/wiki/wiki_alt.zip")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/modules/wiki/wiki_alt.zip)
Edit file

Delete file

Binary file not shown.

2 changes: 2 additions & 0 deletions

2
[src/test/java/org/olat/test/AllTestsJunit4.java](#diff-3fff0aea405c89497d8138446b032ba13d4f9e20853daf17b6f2e08874dd291a "src/test/java/org/olat/test/AllTestsJunit4.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/699490be8e931af0ef1f135c55384db1f4232637/src/test/java/org/olat/test/AllTestsJunit4.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -236,6 +236,7 @@ |
|  |  | org.olat.modules.iq.IQManagerTest.class, |
|  |  | org.olat.modules.fo.ForumManagerTest.class,//fail |
|  |  | org.olat.modules.wiki.WikiUnitTest.class, |
|  |  | org.olat.modules.wiki.WikiManagerTest.class, |
|  |  | org.olat.modules.wiki.versioning.diff.CookbookDiffTest.class, |
|  |  | org.olat.modules.wiki.gui.components.wikiToHtml.FilterUtilTest.class, |
|  |  | org.olat.modules.coach.manager.CoachingDAOTest.class, |
| Expand Down  Expand Up | | @@ -359,6 +360,7 @@ |
|  |  | org.olat.course.nodes.projectbroker.ProjectBrokerManagerTest.class, |
|  |  | org.olat.core.commons.persistence.DBTest.class, |
|  |  | org.olat.modules.ims.cp.CPManagerTest.class, |
|  |  | org.olat.modules.ims.cp.ImsCPHandlerTest.class, |
|  |  | org.olat.modules.ims.qti.fileresource.FileResourceValidatorTest.class, |
|  |  | org.olat.ims.qti.QTIResultManagerTest.class, |
|  |  | org.olat.ims.qti.qpool.QTIImportProcessorTest.class, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `699490b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F699490be8e931af0ef1f135c55384db1f4232637) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f88584ab_20250114_193430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F5668a41ab3f1753102a89757be013487544279d5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F5668a41ab3f1753102a89757be013487544279d5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenOLAT%2FOpenOLAT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenOLAT](/OpenOLAT)
/
**[OpenOLAT](/OpenOLAT/OpenOLAT)**
Public

* [Notifications](/login?return_to=%2FOpenOLAT%2FOpenOLAT) You must be signed in to change notification settings
* [Fork
  146](/login?return_to=%2FOpenOLAT%2FOpenOLAT)
* [Star
   344](/login?return_to=%2FOpenOLAT%2FOpenOLAT)

* [Code](/OpenOLAT/OpenOLAT)
* [Issues
  2](/OpenOLAT/OpenOLAT/issues)
* [Pull requests
  2](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects
  0](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

Additional navigation options

* [Code](/OpenOLAT/OpenOLAT)
* [Issues](/OpenOLAT/OpenOLAT/issues)
* [Pull requests](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

## Commit

[Permalink](/OpenOLAT/OpenOLAT/commit/5668a41ab3f1753102a89757be013487544279d5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

OO-5549: check parent by unzip

[Browse files](/OpenOLAT/OpenOLAT/tree/5668a41ab3f1753102a89757be013487544279d5)
Browse the repository at this point in the history

* Loading branch information

[![@lainsr](https://avatars.githubusercontent.com/u/1712399?s=40&v=4)](/lainsr)

[lainsr](/OpenOLAT/OpenOLAT/commits?author=lainsr "View all commits by lainsr")
committed
Jun 21, 2021

1 parent
[3f219ac](/OpenOLAT/OpenOLAT/commit/3f219ac457afde82e3be57bc614352ab92c05684)

commit 5668a41

 Show file tree

 Hide file tree

Showing
**17 changed files**
with
**180 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/olat

    - core/util

      * src/main/java/org/olat/core/util/ZipUtil.java
        [ZipUtil.java](#diff-f7f51bdf7ddcab1281ad4e2ec2f7d2863dceff266817ef5f6eaceb815d680318)
      * vfs

        + src/main/java/org/olat/core/util/vfs/LocalFolderImpl.java
          [LocalFolderImpl.java](#diff-5119e5ab95104a3072733656788026777e3d797196d3d63e8a002aeba54385ab)
        + src/main/java/org/olat/core/util/vfs/MergeSource.java
          [MergeSource.java](#diff-6f1c1ab343162d6b1c8ab3e290bcce4b2bc41d787af5bc14db69314d5ef79e5b)
        + src/main/java/org/olat/core/util/vfs/NamedContainerImpl.java
          [NamedContainerImpl.java](#diff-4c5ae5109dedc2893d0091a277aee6cb87d3f93ccb6746d3971fc38be64e95ab)
        + src/main/java/org/olat/core/util/vfs/VFSContainer.java
          [VFSContainer.java](#diff-1efeeed21fbcf0313ec4b0b60029009b39bb888cf2bcb3696a68b08e278496a7)
        + src/main/java/org/olat/core/util/vfs/VirtualContainer.java
          [VirtualContainer.java](#diff-bc930f7490d61c2e8fb1953d6c1927f985c5ba9acd4a293353e4c44b33b8970c)
    - course/assessment/bulk

      * src/main/java/org/olat/course/assessment/bulk/DataStepForm.java
        [DataStepForm.java](#diff-6b3f1037438fce087fb427e567defddc81ae95e091df5c659bcb14d191aa92c1)
    - ims

      * cp/ui

        + src/main/java/org/olat/ims/cp/ui/VFSCPContainer.java
          [VFSCPContainer.java](#diff-6404347f7553273a5404602ec647cbb08204442630ac3dc8af72e22a2c865401)
        + src/main/java/org/olat/ims/cp/ui/VFSCPNamedContainerItem.java
          [VFSCPNamedContainerItem.java](#diff-529b4937a965ad7fe9f85cc6919ac21936b32a3db127f093dbf1f29efb1dca50)
        + src/main/java/org/olat/ims/cp/ui/VFSMediaFilesContainer.java
          [VFSMediaFilesContainer.java](#diff-c92bb951af5ebae29abf1d49013d977ffc50d2405df1f9adbf8e15b753f14f4a)
        + src/main/java/org/olat/ims/cp/ui/VFSRootCPContainer.java
          [VFSRootCPContainer.java](#diff-b4fbf0c1202929fb3eebec4f1188bf6fb6bb3e6ee25b844eacd79e86166c4f31)
      * qti21

        + pool

          - src/main/java/org/olat/ims/qti21/pool/QTI21ImportProcessor.java
            [QTI21ImportProcessor.java](#diff-3ec4fc3529ea87e7ca862962b1f029dfec7b4260ebd3eb23575168fc2fb1a776)
        + repository/handlers

          - src/main/java/org/olat/ims/qti21/repository/handlers/CopyAndConvertVisitor.java
            [CopyAndConvertVisitor.java](#diff-dc7d0f072f09afcb9cf5de787af80b1407e719b7e7c78e09256a75a780c92fa5)
    - modules/wiki

      * src/main/java/org/olat/modules/wiki/WikiManager.java
        [WikiManager.java](#diff-b3f00174ded9dcc934acb1b6c0107b28cf98f6edef1ab3ac6e5ef4cf67b7967d)
  + test/java/org/olat

    - core/util

      * src/test/java/org/olat/core/util/Slide.zip
        [Slide.zip](#diff-f3e8f77230683fe3be29a416c8bed3543c1ab1ad6d25ea0f4f63f768578726df)
      * src/test/java/org/olat/core/util/ZipUtilTest.java
        [ZipUtilTest.java](#diff-ef674330bc7b6c1c174d3dba09d6620a5cccef9292df99dc9e9f9b2dcc55d4a8)
    - test

      * src/test/java/org/olat/test/AllTestsJunit4.java
        [AllTestsJunit4.java](#diff-3fff0aea405c89497d8138446b032ba13d4f9e20853daf17b6f2e08874dd291a)

## There are no files selected for viewing

25 changes: 19 additions & 6 deletions

25
[src/main/java/org/olat/core/util/ZipUtil.java](#diff-f7f51bdf7ddcab1281ad4e2ec2f7d2863dceff266817ef5f6eaceb815d680318 "src/main/java/org/olat/core/util/ZipUtil.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/ZipUtil.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -37,6 +37,7 @@ |
|  |  | import java.nio.file.FileVisitResult; |
|  |  | import java.nio.file.Files; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.Paths; |
|  |  | import java.nio.file.SimpleFileVisitor; |
|  |  | import java.nio.file.attribute.BasicFileAttributes; |
|  |  | import java.util.ArrayList; |
| Expand Down  Expand Up | | @@ -188,20 +189,24 @@ public static boolean unzip(VFSLeaf zipLeaf, VFSContainer targetDir, Identity id |
|  |  | private static boolean unzip(InputStream in, VFSContainer targetDir, Identity identity, boolean versioning) { |
|  |  |  |
|  |  | VFSRepositoryService vfsRepositoryService = CoreSpringFactory.getImpl(VFSRepositoryService.class); |
|  |  |  |
|  |  |  |
|  |  | try(ZipInputStream oZip = new ZipInputStream(in)) { |
|  |  | // unzip files |
|  |  | ZipEntry oEntr = oZip.getNextEntry(); |
|  |  | while (oEntr != null) { |
|  |  | if (oEntr.getName() != null && !oEntr.getName().startsWith(DIR\_NAME\_\_MACOSX)) { |
|  |  | String name = oEntr.getName(); |
|  |  | if(!targetDir.isInPath(name)) { |
|  |  | throw new IOException("Invalip ZIP"); |
|  |  | } |
|  |  |  |
|  |  | if (name != null && !name.startsWith(DIR\_NAME\_\_MACOSX)) { |
|  |  | if (oEntr.isDirectory()) { |
|  |  | // skip MacOSX specific metadata directory |
|  |  | // create directories |
|  |  | getAllSubdirs(targetDir, oEntr.getName(), identity, true); |
|  |  | getAllSubdirs(targetDir, name, identity, true); |
|  |  | } else { |
|  |  | // create file |
|  |  | VFSContainer createIn = targetDir; |
|  |  | String name = oEntr.getName(); |
|  |  | // check if entry has directories which did not show up as |
|  |  | // directories above |
|  |  | int dirSepIndex = name.lastIndexOf('/'); |
| Expand Down  Expand Up | | @@ -317,7 +322,7 @@ private static boolean unzipNonStrict(InputStream in, VFSContainer targetDir, Id |
|  |  | VFSRepositoryService vfsRepositoryService = CoreSpringFactory.getImpl(VFSRepositoryService.class); |
|  |  |  |
|  |  | // unzip files |
|  |  | net.sf.jazzlib.ZipEntry oEntr = oZip.getNextEntry(); |
|  |  | net.sf.jazzlib.ZipEntry oEntr = oZip.getNextEntry();//TODO zip |
|  |  |  |
|  |  | VFSLeaf lastLeaf = null; |
|  |  | while (oEntr != null) { |
| Expand Down  Expand Up | | @@ -455,7 +460,7 @@ public static List<String> checkLockedFileBeforeUnzipNonStrict(VFSLeaf zipLeaf, |
|  |  | // skip MacOSX specific metadata directory |
|  |  | // directories aren't locked |
|  |  | oZip.closeEntry(); |
|  |  | oEntr = oZip.getNextEntry(); |
|  |  | oEntr = oZip.getNextEntry();//TODO zip |
|  |  | continue; |
|  |  | } else { |
|  |  | // search file |
| Expand Down  Expand Up | | @@ -847,9 +852,17 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO |
|  |  | \* @param outdir, path to output directory, relative to cwd or absolute |
|  |  | \*/ |
|  |  | private static void xxunzip(InputStream is, String outdir) throws IOException { |
|  |  | final Path outPath = Paths.get(outdir); |
|  |  |  |
|  |  | try(ZipInputStream zis = new ZipInputStream (new BufferedInputStream(is))) { |
|  |  | ZipEntry entry; |
|  |  | while ((entry = zis.getNextEntry()) != null) { |
|  |  | Path filePath = Paths.get(outdir, entry.getName()); |
|  |  | Path normalizedPath = filePath.normalize(); |
|  |  | if(!normalizedPath.startsWith(outPath)) { |
|  |  | throw new IOException("Invalid ZIP"); |
|  |  | } |
|  |  |  |
|  |  | File of = new File(outdir, entry.getName()); |
|  |  | if (entry.isDirectory()) { |
|  |  | of.mkdirs(); |
| Expand Down | |  |

8 changes: 8 additions & 0 deletions

8
[src/main/java/org/olat/core/util/vfs/LocalFolderImpl.java](#diff-5119e5ab95104a3072733656788026777e3d797196d3d63e8a002aeba54385ab "src/main/java/org/olat/core/util/vfs/LocalFolderImpl.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/vfs/LocalFolderImpl.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -335,6 +335,14 @@ public VFSItem resolve(String path) { |
|  |  | return resolved; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | Path bFile = getBasefile().toPath(); |
|  |  | Path filePath = bFile.resolve(path); |
|  |  | Path normalizedPath = filePath.normalize(); |
|  |  | return normalizedPath.startsWith(bFile); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public String getRelPath() { |
|  |  | Path bFile = getBasefile().toPath(); |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/core/util/vfs/MergeSource.java](#diff-6f1c1ab343162d6b1c8ab3e290bcce4b2bc41d787af5bc14db69314d5ef79e5b "src/main/java/org/olat/core/util/vfs/MergeSource.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/vfs/MergeSource.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -202,6 +202,11 @@ public VFSLeaf createChildLeaf(String name) { |
|  |  | return rootWriteContainer.createChildLeaf(name); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return rootWriteContainer.isInPath(path); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSStatus copyFrom(VFSItem source) { |
|  |  | if (canWrite() != VFSConstants.YES) { |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/core/util/vfs/NamedContainerImpl.java](#diff-4c5ae5109dedc2893d0091a277aee6cb87d3f93ccb6746d3971fc38be64e95ab "src/main/java/org/olat/core/util/vfs/NamedContainerImpl.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/vfs/NamedContainerImpl.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -121,6 +121,11 @@ public String getRelPath() { |
|  |  | return getDelegate().getRelPath(); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return getDelegate().isInPath(path); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSStatus delete() { |
|  |  | return getDelegate().delete(); |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[src/main/java/org/olat/core/util/vfs/VFSContainer.java](#diff-1efeeed21fbcf0313ec4b0b60029009b39bb888cf2bcb3696a68b08e278496a7 "src/main/java/org/olat/core/util/vfs/VFSContainer.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/vfs/VFSContainer.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -86,6 +86,13 @@ public interface VFSContainer extends VFSItem { |
|  |  | \*/ |
|  |  | public VFSLeaf createChildLeaf(String name); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* @param path |
|  |  | \* @return |
|  |  | \*/ |
|  |  | public boolean isInPath(String path); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set a default filter that will be applied to this container getItems method |
|  |  | \* |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/core/util/vfs/VirtualContainer.java](#diff-bc930f7490d61c2e8fb1953d6c1927f985c5ba9acd4a293353e4c44b33b8970c "src/main/java/org/olat/core/util/vfs/VirtualContainer.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/core/util/vfs/VirtualContainer.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -105,6 +105,11 @@ public String getRelPath() { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSItem resolve(String path) { |
|  |  | if(path != null && path.length() > 1 && path.startsWith("/")) { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/main/java/org/olat/course/assessment/bulk/DataStepForm.java](#diff-6b3f1037438fce087fb427e567defddc81ae95e091df5c659bcb14d191aa92c1 "src/main/java/org/olat/course/assessment/bulk/DataStepForm.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/course/assessment/bulk/DataStepForm.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -366,7 +366,7 @@ private void processReturnFiles(VFSLeaf target, List<BulkAssessmentRow> rows) { |
|  |  | try(InputStream is = target.getInputStream(); |
|  |  | ZipInputStream zis = new ZipInputStream(is)) { |
|  |  | byte[] b = new byte[FileUtils.BSIZE]; |
|  |  | while ((entry = zis.getNextEntry()) != null) { |
|  |  | while ((entry = zis.getNextEntry()) != null) {//TODO zip |
|  |  | if(!entry.isDirectory()) { |
|  |  | while (zis.read(b) > 0) { |
|  |  | //continue |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/ims/cp/ui/VFSCPContainer.java](#diff-6404347f7553273a5404602ec647cbb08204442630ac3dc8af72e22a2c865401 "src/main/java/org/olat/ims/cp/ui/VFSCPContainer.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/cp/ui/VFSCPContainer.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,6 +96,11 @@ public VFSItem resolve(String path) { |
|  |  | public String getRelPath() { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public List<VFSItem> getItems() { |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/ims/cp/ui/VFSCPNamedContainerItem.java](#diff-529b4937a965ad7fe9f85cc6919ac21936b32a3db127f093dbf1f29efb1dca50 "src/main/java/org/olat/ims/cp/ui/VFSCPNamedContainerItem.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/cp/ui/VFSCPNamedContainerItem.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,6 +71,11 @@ public List<VFSItem> getItems(VFSItemFilter filter) { |
|  |  | return getItems(); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSStatus copyFrom(VFSItem source) { |
|  |  | return VFSConstants.NO; |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/ims/cp/ui/VFSMediaFilesContainer.java](#diff-c92bb951af5ebae29abf1d49013d977ffc50d2405df1f9adbf8e15b753f14f4a "src/main/java/org/olat/ims/cp/ui/VFSMediaFilesContainer.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/cp/ui/VFSMediaFilesContainer.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -85,6 +85,11 @@ public String getRelPath() { |
|  |  | return rootContainer.getRelPath(); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return rootContainer.isInPath(path); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSContainer getParentContainer() { |
|  |  | return null; |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/main/java/org/olat/ims/cp/ui/VFSRootCPContainer.java](#diff-b4fbf0c1202929fb3eebec4f1188bf6fb6bb3e6ee25b844eacd79e86166c4f31 "src/main/java/org/olat/ims/cp/ui/VFSRootCPContainer.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/cp/ui/VFSRootCPContainer.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,6 +112,11 @@ public String getRelPath() { |
|  |  | return rootContainer.getRelPath(); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isInPath(String path) { |
|  |  | return rootContainer.isInPath(path); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public VFSItem resolve(String path) { |
|  |  | // 1) try to resolve directly from root (HTML editor instance) |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[src/main/java/org/olat/ims/qti21/pool/QTI21ImportProcessor.java](#diff-3ec4fc3529ea87e7ca862962b1f029dfec7b4260ebd3eb23575168fc2fb1a776 "src/main/java/org/olat/ims/qti21/pool/QTI21ImportProcessor.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/qti21/pool/QTI21ImportProcessor.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -161,6 +161,11 @@ private QuestionItem processResource(ResourceType resource, Path imsmanifestPath |
|  |  | if(Files.notExists(assessmentItemPath)) { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | Path normalizedPath = assessmentItemPath.normalize(); |
|  |  | if(!normalizedPath.startsWith(parentPath)) { |
|  |  | throw new IOException("Invalid Item"); |
|  |  | } |
|  |  |  |
|  |  | String dir = qpoolFileStorage.generateDir(); |
|  |  | //storage |
| Expand Down  Expand Up | | @@ -213,6 +218,10 @@ private QuestionItem processResource(ResourceType resource, Path imsmanifestPath |
|  |  | for(String material:materials) { |
|  |  | if(material.indexOf("://") < 0) {// material can be an external URL |
|  |  | Path materialFile = assessmentItemPath.getParent().resolve(material); |
|  |  | Path normalizedMaterialPath = materialFile.normalize(); |
|  |  | if(!normalizedMaterialPath.startsWith(parentPath)) { |
|  |  | throw new IOException("Invalid Item"); |
|  |  | } |
|  |  | PathUtils.copyFileToDir(materialFile, outputFile.getParentFile(), material); |
|  |  | } |
|  |  | } |
| Expand Down | |  |

13 changes: 12 additions & 1 deletion

13
[src/main/java/org/olat/ims/qti21/repository/handlers/CopyAndConvertVisitor.java](#diff-dc7d0f072f09afcb9cf5de787af80b1407e719b7e7c78e09256a75a780c92fa5 "src/main/java/org/olat/ims/qti21/repository/handlers/CopyAndConvertVisitor.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/ims/qti21/repository/handlers/CopyAndConvertVisitor.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -115,8 +115,10 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) |
|  |  | if(filename.startsWith(".")) { |
|  |  | //ignore |
|  |  | } else if(filename.endsWith("xml") && !filename.equals("imsmanifest.xml")) { |
|  |  | checkPath(destFile); |
|  |  | convertXmlFile(file, destFile); |
|  |  | } else { |
|  |  | checkPath(destFile); |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -127,13 +129,22 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) |
|  |  | public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) |
|  |  | throws IOException { |
|  |  | Path relativeDir = source.relativize(dir); |
|  |  | final Path dirToCreate = Paths.get(destDir.toString(), relativeDir.toString()); |
|  |  | final Path dirToCreate = Paths.get(destDir.toString(), relativeDir.toString()); |
|  |  | checkPath(dirToCreate); |
|  |  |  |
|  |  | if(!dirToCreate.toFile().exists()) { |
|  |  | Files.createDirectory(dirToCreate); |
|  |  | } |
|  |  | return FileVisitResult.CONTINUE; |
|  |  | } |
|  |  |  |
|  |  | private void checkPath(Path file) throws IOException { |
|  |  | Path normalizedPath = file.normalize(); |
|  |  | if(!normalizedPath.startsWith(destDir)) { |
|  |  | throw new IOException("Invalid ZIP"); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Convert the XML files, assessmentItem or assessmentTest |
|  |  | \* |
| Expand Down | |  |

19 changes: 12 additions & 7 deletions

19
[src/main/java/org/olat/modules/wiki/WikiManager.java](#diff-b3f00174ded9dcc934acb1b6c0107b28cf98f6edef1ab3ac6e5ef4cf67b7967d "src/main/java/org/olat/modules/wiki/WikiManager.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/main/java/org/olat/modules/wiki/WikiManager.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -298,15 +298,20 @@ public ImportVisitor(Path destDir) throws IOException { |
|  |  | @Override |
|  |  | public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) |
|  |  | throws IOException { |
|  |  | String filename = file.getFileName().toString(); |
|  |  | String filename = file.getFileName().toString(); |
|  |  | Path normalizedPath = file.normalize(); |
|  |  | if(!normalizedPath.startsWith(destDir)) { |
|  |  | throw new IOException("Invalid ZIP"); |
|  |  | } |
|  |  |  |
|  |  | if(filename.endsWith(WikiManager.WIKI\_PROPERTIES\_SUFFIX)) { |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | resetAndCopyProperties(file, destFile); |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | resetAndCopyProperties(file, destFile); |
|  |  | } else if (filename.endsWith(WIKI\_FILE\_SUFFIX)) { |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | String f = convertAlternativeFilename(file.toString()); |
|  |  | final Path destFile = Paths.get(wikiDir.toString(), f); |
|  |  | Files.copy(file, destFile, StandardCopyOption.REPLACE\_EXISTING); |
|  |  | } else if (!filename.contains(WIKI\_FILE\_SUFFIX + "-") |
|  |  | && !filename.contains(WIKI\_PROPERTIES\_SUFFIX + "-")) { |
|  |  | final Path destFile = Paths.get(mediaDir.toString(), file.toString()); |
| Expand Down | |  |

Binary file added
BIN
+756 Bytes

[src/test/java/org/olat/core/util/Slide.zip](#diff-f3e8f77230683fe3be29a416c8bed3543c1ab1ad6d25ea0f4f63f768578726df "src/test/java/org/olat/core/util/Slide.zip")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/test/java/org/olat/core/util/Slide.zip)
Edit file

Delete file

Binary file not shown.

76 changes: 76 additions & 0 deletions

76
[src/test/java/org/olat/core/util/ZipUtilTest.java](#diff-ef674330bc7b6c1c174d3dba09d6620a5cccef9292df99dc9e9f9b2dcc55d4a8 "src/test/java/org/olat/core/util/ZipUtilTest.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/test/java/org/olat/core/util/ZipUtilTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,76 @@ |
|  |  | /\*\* |
|  |  | \* <a href="http://www.openolat.org"> |
|  |  | \* OpenOLAT - Online Learning and Training</a><br> |
|  |  | \* <p> |
|  |  | \* Licensed under the Apache License, Version 2.0 (the "License"); <br> |
|  |  | \* you may not use this file except in compliance with the License.<br> |
|  |  | \* You may obtain a copy of the License at the |
|  |  | \* <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache homepage</a> |
|  |  | \* <p> |
|  |  | \* Unless required by applicable law or agreed to in writing,<br> |
|  |  | \* software distributed under the License is distributed on an "AS IS" BASIS, <br> |
|  |  | \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. <br> |
|  |  | \* See the License for the specific language governing permissions and <br> |
|  |  | \* limitations under the License. |
|  |  | \* <p> |
|  |  | \* Initial code contributed and copyrighted by<br> |
|  |  | \* frentix GmbH, http://www.frentix.com |
|  |  | \* <p> |
|  |  | \*/ |
|  |  | package org.olat.core.util; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.net.URL; |
|  |  |  |
|  |  | import org.junit.Assert; |
|  |  | import org.junit.Test; |
|  |  | import org.olat.core.commons.modules.bc.FolderConfig; |
|  |  | import org.olat.core.id.Identity; |
|  |  | import org.olat.core.util.vfs.VFSContainer; |
|  |  | import org.olat.core.util.vfs.VFSItem; |
|  |  | import org.olat.core.util.vfs.VFSLeaf; |
|  |  | import org.olat.core.util.vfs.VFSManager; |
|  |  | import org.olat.core.util.vfs.callbacks.FullAccessCallback; |
|  |  | import org.olat.test.OlatTestCase; |
|  |  | import org.olat.test.VFSJavaIOFile; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* Initial date: 21 juin 2021<br> |
|  |  | \* @author srosse, stephane.rosse@frentix.com, http://www.frentix.com |
|  |  | \* |
|  |  | \*/ |
|  |  | public class ZipUtilTest extends OlatTestCase { |
|  |  |  |
|  |  | @Test |
|  |  | public void unzipFileToDir() throws Exception { |
|  |  | File tmpFolder = new File(WebappHelper.getTmpDir(), "zip" + CodeHelper.getRAMUniqueID()); |
|  |  | URL url = ZipUtilTest.class.getResource("Slide.zip"); |
|  |  | File zipFile = new File(url.toURI()); |
|  |  |  |
|  |  | File unzipDir = new File(tmpFolder, "unzip1"); |
|  |  | unzipDir.mkdirs(); |
|  |  |  |
|  |  | boolean success = ZipUtil.unzip(zipFile, unzipDir); |
|  |  | Assert.assertFalse(success); |
|  |  | File img = new File(tmpFolder, "IMG\_1489.png"); |
|  |  | Assert.assertFalse(img.exists()); |
|  |  | FileUtils.deleteDirsAndFiles(tmpFolder, true, true); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void unzipLeafToContainer() throws Exception { |
|  |  | URL url = ZipUtilTest.class.getResource("Slide.zip"); |
|  |  | VFSLeaf zipLeaf = new VFSJavaIOFile(url.toURI()); |
|  |  | VFSContainer tmpDir = VFSManager.olatRootContainer(FolderConfig.getRelativeTmpDir()); |
|  |  | tmpDir.setLocalSecurityCallback(new FullAccessCallback()); |
|  |  | VFSContainer targetDir = tmpDir.createChildContainer("zip" + CodeHelper.getForeverUniqueID()); |
|  |  | boolean success = ZipUtil.unzip(zipLeaf, targetDir, (Identity)null, false); |
|  |  |  |
|  |  | VFSItem img = tmpDir.resolve("IMG\_1489.png"); |
|  |  | Assert.assertNull(img); |
|  |  | Assert.assertFalse(success); |
|  |  |  |
|  |  | targetDir.deleteSilently(); |
|  |  | } |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[src/test/java/org/olat/test/AllTestsJunit4.java](#diff-3fff0aea405c89497d8138446b032ba13d4f9e20853daf17b6f2e08874dd291a "src/test/java/org/olat/test/AllTestsJunit4.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/5668a41ab3f1753102a89757be013487544279d5/src/test/java/org/olat/test/AllTestsJunit4.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,6 +73,7 @@ |
|  |  | org.olat.core.util.SimpleHtmlParserTest.class, |
|  |  | org.olat.core.util.IPUtilsTest.class, |
|  |  | org.olat.core.util.IPUtilsValidRangeTest.class, |
|  |  | org.olat.core.util.ZipUtilTest.class, |
|  |  | org.olat.core.util.ZipUtilConcatTest.class, |
|  |  | org.olat.core.util.mail.EmailAddressValidatorTest.class, |
|  |  | org.olat.core.util.mail.manager.MailManagerTest.class, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5668a41`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F5668a41ab3f1753102a89757be013487544279d5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.openolat.org_64cfbcab_20250114_193433.html ===


{{ (>\_<) }}

This version of your browser is not supported.

Try upgrading to the latest stable version.
Something went seriously wrong.



=== Content from github.com_70f596c5_20250114_193427.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F2cf73c972e23ccd69cc1e103e43c2c8253571d3e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F2cf73c972e23ccd69cc1e103e43c2c8253571d3e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenOLAT%2FOpenOLAT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenOLAT](/OpenOLAT)
/
**[OpenOLAT](/OpenOLAT/OpenOLAT)**
Public

* [Notifications](/login?return_to=%2FOpenOLAT%2FOpenOLAT) You must be signed in to change notification settings
* [Fork
  146](/login?return_to=%2FOpenOLAT%2FOpenOLAT)
* [Star
   344](/login?return_to=%2FOpenOLAT%2FOpenOLAT)

* [Code](/OpenOLAT/OpenOLAT)
* [Issues
  2](/OpenOLAT/OpenOLAT/issues)
* [Pull requests
  2](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects
  0](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

Additional navigation options

* [Code](/OpenOLAT/OpenOLAT)
* [Issues](/OpenOLAT/OpenOLAT/issues)
* [Pull requests](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

## Commit

[Permalink](/OpenOLAT/OpenOLAT/commit/2cf73c972e23ccd69cc1e103e43c2c8253571d3e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

OO-5549: replace the wildfly assert by a junit one

[Browse files](/OpenOLAT/OpenOLAT/tree/2cf73c972e23ccd69cc1e103e43c2c8253571d3e)
Browse the repository at this point in the history

* Loading branch information

[![@lainsr](https://avatars.githubusercontent.com/u/1712399?s=40&v=4)](/lainsr)

[lainsr](/OpenOLAT/OpenOLAT/commits?author=lainsr "View all commits by lainsr")
committed
Jul 2, 2021

1 parent
[bc32119](/OpenOLAT/OpenOLAT/commit/bc3211953222306b0fddd21caa39e9e06236792c)

commit 2cf73c9

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[src/test/java/org/olat/modules/wiki/WikiManagerTest.java](#diff-bab6d615257410f8908cf6260c8d268bcda61f80714532561f296126d4b52f57 "src/test/java/org/olat/modules/wiki/WikiManagerTest.java")

Show comments

[View file](/OpenOLAT/OpenOLAT/blob/2cf73c972e23ccd69cc1e103e43c2c8253571d3e/src/test/java/org/olat/modules/wiki/WikiManagerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,7 @@ |
|  |  | import java.net.URL; |
|  |  |  |
|  |  | import org.junit.After; |
|  |  | import org.junit.Assert; |
|  |  | import org.junit.Before; |
|  |  | import org.junit.Test; |
|  |  | import org.olat.core.logging.OLATRuntimeException; |
| Expand All | | @@ -32,7 +33,6 @@ |
|  |  | import org.olat.core.util.WebappHelper; |
|  |  | import org.olat.test.OlatTestCase; |
|  |  | import org.springframework.beans.factory.annotation.Autowired; |
|  |  | import org.wildfly.common.Assert; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2cf73c9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fcommit%2F2cf73c972e23ccd69cc1e103e43c2c8253571d3e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4425f9d8_20250114_193433.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fsecurity%2Fadvisories%2FGHSA-x95v-2pgj-9x8j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenOLAT%2FOpenOLAT%2Fsecurity%2Fadvisories%2FGHSA-x95v-2pgj-9x8j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenOLAT%2FOpenOLAT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenOLAT](/OpenOLAT)
/
**[OpenOLAT](/OpenOLAT/OpenOLAT)**
Public

* [Notifications](/login?return_to=%2FOpenOLAT%2FOpenOLAT) You must be signed in to change notification settings
* [Fork
  146](/login?return_to=%2FOpenOLAT%2FOpenOLAT)
* [Star
   344](/login?return_to=%2FOpenOLAT%2FOpenOLAT)

* [Code](/OpenOLAT/OpenOLAT)
* [Issues
  2](/OpenOLAT/OpenOLAT/issues)
* [Pull requests
  2](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects
  0](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

Additional navigation options

* [Code](/OpenOLAT/OpenOLAT)
* [Issues](/OpenOLAT/OpenOLAT/issues)
* [Pull requests](/OpenOLAT/OpenOLAT/pulls)
* [Actions](/OpenOLAT/OpenOLAT/actions)
* [Projects](/OpenOLAT/OpenOLAT/projects)
* [Security](/OpenOLAT/OpenOLAT/security)
* [Insights](/OpenOLAT/OpenOLAT/pulse)

# Path Traversal in Archive Handling Leading to Code Execution

High

[gnaegi](/gnaegi)
published
GHSA-x95v-2pgj-9x8j
Aug 31, 2021

## Package

No package listed

## Affected versions

<15.5.3

## Patched versions

15.3.18, 15.5.3

## Description

### Impact

Using a specially prepared ZIP file it is possible to overwrite any file that is writable by the application server user (e.g. the tomcat user). Depending on the configuration this can be limited to files of the OpenOlat user data directory, however, if not properly set up, the attack could also be used to overwrite application server config files, java code or even operating system files.

The attack could be used to corrupt or modify any OpenOlat file such as course structures, config files or temporary test data. Those attack would require in-depth knowledge of the installation and thus more theoretical.

If the app server configuration allows the execution of jsp files and the path to the context is known, it is also possible to execute java code.

If the app server runs with the same user that is used to deploy the OpenOlat code or has write permissions on the OpenOlat code files and the path to the context is know, code injection is possible.

The attack requires an OpenOlat user account to upload a ZIP file and trigger the unzip method. It can not be exploited by unregistered users.

### Patches

The problem is fixed in version 15.3.18, 15.5.3 and 16.0. It is advised to upgrade to version 16.0.x

### Workarounds

There are no known workarounds to fix this problem, an upgrade is necessary.

### References

<https://jira.openolat.org/browse/OO-5549> (only visible to members of the OpenOlat partner program)

### For more information

If you have any questions or comments about this advisory:

* Email us at [contact@openolat.org](contact%40openolat.org)

### Severity

High

### CVE ID

CVE-2021-39180

### Weaknesses

No CWEs

### Credits

* [![@fkt](https://avatars.githubusercontent.com/u/22221461?s=40&v=4)](/fkt)
  [fkt](/fkt)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


