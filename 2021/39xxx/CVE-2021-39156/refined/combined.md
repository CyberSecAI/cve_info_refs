=== Content from github.com_62998358_20250114_230835.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fsecurity%2Fadvisories%2FGHSA-hqxw-mm44-gc4r)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fsecurity%2Fadvisories%2FGHSA-hqxw-mm44-gc4r)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=istio%2Fistio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[istio](/istio)
/
**[istio](/istio/istio)**
Public

* [Notifications](/login?return_to=%2Fistio%2Fistio) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fistio%2Fistio)
* [Star
   36.3k](/login?return_to=%2Fistio%2Fistio)

* [Code](/istio/istio)
* [Issues
  461](/istio/istio/issues)
* [Pull requests
  39](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

Additional navigation options

* [Code](/istio/istio)
* [Issues](/istio/istio/issues)
* [Pull requests](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

# Fragments in Path May Lead to Authorization Policy Bypass

High

[brian-avery](/brian-avery)
published
GHSA-hqxw-mm44-gc4r
Aug 24, 2021

## Package

docker

Istio
([Docker](/advisories?query=ecosystem%3Adocker))

## Affected versions

<1.9.8

## Patched versions

1.9.8, 1.10.4, 1.11.1

## Description

### Impact

Istio 1.11.0, 1.10.3 and below, and 1.9.7 and below contain a remotely exploitable vulnerability where an HTTP request with `#fragment` in the path may bypass Istio’s URI path based authorization policies.

### Patches

* Istio 1.11.1 and above
* Istio 1.10.4 and above
* Istio 1.9.8 and above

### Workarounds

A Lua filter may be written to normalize the path. This is similar to the Path normalization presented in the [Security Best Practices](https://istio.io/latest/docs/ops/best-practices/security/#case-normalization) guide.

### References

More details can be found in the [Istio Security Bulletin](https://istio.io/latest/news/security/istio-security-2021-008)

### For more information

If you have any questions or comments about this advisory, please email us at istio-security-vulnerability-reports@googlegroups.com

### Severity

High

8.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N

### CVE ID

CVE-2021-39156

### Weaknesses

No CWEs

### Credits

* [![@yangminzhu](https://avatars.githubusercontent.com/u/2189160?s=40&v=4)](/yangminzhu)
  [yangminzhu](/yangminzhu)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from istio.io_35288b18_20250114_230836.html ===


* About
  + [Service mesh](/latest/about/service-mesh)
  + [Solutions](/latest/about/solutions)
  + [Case studies](/latest/about/case-studies)
  + [Ecosystem](/latest/about/ecosystem)
  + [Deployment](/latest/about/deployment)
  + [Training](/latest/about/training)
  + [FAQ](/latest/about/faq)
* [Blog](/latest/blog/)
* [News](/latest/news/)
* [Get involved](/latest/get-involved/)
* [Documentation](/latest/docs/)

[Try Istio](/latest/docs/setup/getting-started)

# ISTIO-SECURITY-2021-008

Multiple CVEs related to AuthorizationPolicy, EnvoyFilter and Envoy.

Aug 24, 2021

| Disclosure Details | |
| --- | --- |
| CVE(s) | [CVE-2021-32777](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32777)[CVE-2021-32781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32781)[CVE-2021-32778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32778)[CVE-2021-32780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32780)[CVE-2021-39155](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39155)[CVE-2021-39156](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39156) |
| CVSS Impact Score | 8.6 [AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV%3aL%2fAC%3aL%2fPR%3aN%2fUI%3aR%2fS%3aC%2fC%3aH%2fI%3aH%2fA%3aH&version=3.1) |
| Affected Releases | All releases prior to 1.9.81.10.0 to 1.10.31.11.0 |

## CVEs

Envoy, and subsequently Istio, is vulnerable to six newly discovered vulnerabilities
(note that Envoy’s CVE-2021-32779 is merged with Istio’s CVE-2021-39156):

### CVE-2021-39156 (CVE-2021-32779)

Istio contains a remotely exploitable vulnerability, [CVE-2021-39156](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39156),
where an HTTP request with a fragment (a section in the end of a URI that begins with a `#` character) in the URI path could bypass Istio’s URI path-based authorization policies.
For instance, an Istio authorization policy [denies](/latest/docs/reference/config/security/authorization-policy/#AuthorizationPolicy-Action) requests sent to the URI path `/user/profile`.
In the vulnerable versions, a request with URI path `/user/profile#section1` bypasses the deny policy and routes to the backend (with the normalized URI path `/user/profile%23section1`), possibly leading to a security incident.

The fix depends on a fix in Envoy, which is associated with [CVE-2021-32779](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32779).

* CVSS Score: 8.1 [AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N&version=3.1)

You are impacted by this vulnerability if:

* You use Istio patch versions earlier than 1.9.8, 1.10.4 or 1.11.1.
* You use authorization policies with
  [DENY actions](/latest/docs/reference/config/security/authorization-policy/#AuthorizationPolicy-Action) and
  [`operation.paths`](/latest/docs/reference/config/security/authorization-policy/#Operation), or
  [ALLOW actions](/latest/docs/reference/config/security/authorization-policy/#AuthorizationPolicy-Action) and
  [`operation.notPaths`](/latest/docs/reference/config/security/authorization-policy/#Operation).

With the [mitigation](/latest/news/security/istio-security-2021-008/#mitigation),
the fragment part of the request’s URI is removed before the authorization and routing.
This prevents a request with a fragment in its URI from bypassing authorization policies which are based on the URI without the fragment part.

To opt-out from the new behavior in the [mitigation](/latest/news/security/istio-security-2021-008/#mitigation),
the fragment section in the URI will be kept. You can configure your installation as follows.

Disabling the new behavior will normalize your paths as described above and is considered unsafe. Ensure that you have accommodated for this in any security policies before using this option.
```
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: opt-out-fragment-cve-fix
  namespace: istio-system
spec:
  meshConfig:
    defaultConfig:
      proxyMetadata:
        HTTP_STRIP_FRAGMENT_FROM_PATH_UNSAFE_IF_DISABLED: "false"
```
### CVE-2021-39155

Istio contains a remotely exploitable vulnerability where an HTTP request could potentially bypass an Istio authorization policy when using rules based on `hosts` or `notHosts`.
In the vulnerable versions, the Istio authorization policy compares the HTTP `Host` or `:authority` headers in a case-sensitive manner,
which is inconsistent with [RFC 4343](https://datatracker.ietf.org/doc/html/rfc4343). For example, the user could have an authorization policy that rejects requests with host `secret.com`,
but the attacker can bypass this by sending the request with hostname `Secret.com`.
The routing flow routes the traffic to the backend for `secret.com` which is a policy violation.

See [CVE-2021-39155](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39155) for more information.

* CVSS Score: 8.3 [AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:L](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:L&version=3.1)

You are impacted by this vulnerability if:

* You use Istio patch versions earlier than 1.9.8, 1.10.4 or 1.11.1.
* You use Istio authorization policies with
  [DENY actions](/latest/docs/reference/config/security/authorization-policy/#AuthorizationPolicy-Action) and
  [`operation.hosts`](/latest/docs/reference/config/security/authorization-policy/#Operation), or
  [ALLOW actions](/latest/docs/reference/config/security/authorization-policy/#AuthorizationPolicy-Action) and
  [`operation.notHosts`](/latest/docs/reference/config/security/authorization-policy/#Operation).

With the [mitigation](/latest/news/security/istio-security-2021-008/#mitigation),
when authorization policies based on `hosts` or `notHosts` are used, the Istio authorization policy compares the HTTP `Host` or `:authority` headers
in a case-insensitive manner to the `hosts` or `notHosts` specs.

### CVE-2021-32777

Envoy contains a remotely exploitable vulnerability that an HTTP request with multiple value headers could do an incomplete authorization policy check when the `ext_authz` extension is used.
When a request header contains multiple values, the external authorization server will only see the last value of the given header. See [CVE-2021-32777](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32777) for more information.

* CVSS Score: 8.6

You are impacted by this vulnerability if:

* You use Istio patch versions earlier than 1.9.8, 1.10.4 or 1.11.1.
* You use [`EnvoyFilters`](/latest/docs/reference/config/networking/envoy-filter/).

### CVE-2021-32778

Envoy contains a remotely exploitable vulnerability where an Envoy client opening and then resetting a large number of HTTP/2 requests could lead to excessive CPU consumption.
See [CVE-2021-32778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32778) for for information.

* CVSS Score: 8.6

You are impacted by this vulnerability if you use Istio patch versions earlier than 1.9.8, 1.10.4 or 1.11.1.

### CVE-2021-32780

Envoy contains a remotely exploitable vulnerability where an untrusted upstream service could
cause Envoy to terminate abnormally by sending the GOAWAY frame followed by the SETTINGS frame
with the `SETTINGS_MAX_CONCURRENT_STREAMS` parameter set to 0. See [CVE-2021-32780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32780) for more information.

* CVSS Score: 8.6

You are impacted by this vulnerability if you use Istio patch versions 1.10.0 to 1.10.3 or 1.11.0.

### CVE-2021-32781

Envoy contains a remotely exploitable vulnerability that affects Envoy’s `decompressor`, `json-transcoder` or `grpc-web` extensions or
proprietary extensions that modify and increase the size of request or response bodies.
Modifying and increasing the size of the body in an Envoy extension beyond the internal buffer size could lead to
Envoy accessing deallocated memory and terminating abnormally. See [CVE-2021-32781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32781) for more information.

* CVSS Score: 8.6

You are impacted by this vulnerability if:

* You use Istio patch versions earlier than 1.9.8, 1.10.4 or 1.11.1.
* You use [`EnvoyFilters`](/latest/docs/reference/config/networking/envoy-filter/).

### Mitigation

To mitigate the above CVEs, update your cluster to the latest supported version:

* Istio 1.9.8 or up, if using 1.9.x
* Istio 1.10.4 or up, if using 1.10.x
* Istio 1.11.1 or up, if using 1.11.x
* The patch version specified by your cloud provider

## Non-CVE vulnerabilities

### Istio does not ignore ports in `AuthorizationPolicy` `host` and `notHosts` comparisons

When creating a `VirtualService` or `Gateway`, Istio generates configuration matching both the hostname itself and the hostname with all matching ports. For instance, a `VirtualService` or `Gateway` for a host of `httpbin.foo` generates a config matching `httpbin.foo` and `httpbin.foo:*`. However, an `AuthorizationPolicy` using exact match only matches the exact string given for the `hosts` or `notHosts` fields.

Your cluster is impacted if you have an `AuthorizationPolicy` using exact string comparison for the [`hosts` or `notHosts`](/latest/docs/reference/config/security/authorization-policy/#Operation).

#### `AuthorizationPolicy` Mitigation

Update your authorization policy [rules](/latest/docs/reference/config/security/authorization-policy/#Rule) to use prefix match instead of exact match. For example, to match a `VirtualService` or `Gateway` with a host of `httpbin.com` , create an `AuthorizationPolicy` with `hosts: ["httpbin.com", "httpbin.com:*"]` as shown below.

```
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: httpbin
  namespace: foo
spec:
  action: DENY
  rules:
  - from:
    - source:
        namespaces: ["dev"]
    to:
    - operation:
        hosts: ["httpbin.com", "httpbin.com:*"]
```
## Credit

We would like to thank Yangmin Zhu (Google) for reporting some of the above issues.

[ISTIO-SECURITY-2022-002](/latest/news/security/istio-security-2022-002/ "Privileged Escalation in Kubernetes Gateway API.")[ISTIO-SECURITY-2021-007](/latest/news/security/istio-security-2021-007/ "Istio contains a remotely exploitable vulnerability where credentials specified in the Gateway and DestinationRule credentialName field can be accessed from different namespaces.")

---

English中文Українська

* [Terms and Conditions](https://www.linuxfoundation.org/legal/terms)|
  [Privacy policy](https://www.linuxfoundation.org/legal/privacy-policy)|
  [Trademarks](https://www.linuxfoundation.org/legal/trademark-usage)|
  [Edit this Page on GitHub](https://github.com/istio/istio.io/edit/release-1.24/content/en/news/security/istio-security-2021-008/index.md)

© 2024 the Istio Authors.
Version
Istio
1.24.2

* next release
* [older releases](https://istio.io/archive)

