=== Content from gitlab.com_f3506197_20250114_190407.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39914.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39914.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39914.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39914.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Nov 04, 2021

  [95c67720](/gitlab-org/cves/-/commit/95c677206df91f50defa706d87afa2a312195aaa)
  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/95c677206df91f50defa706d87afa2a312195aaa)
  繚
  95c67720

  [ GitLab Bot ](/gitlab-bot) authored Nov 04, 2021

  95c67720

  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/95c677206df91f50defa706d87afa2a312195aaa)
  [ GitLab Bot ](/gitlab-bot) authored Nov 04, 2021

Loading



=== Content from gitlab.com_e92690f8_20250114_190408.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Namespace path cleaning vulnerable to regular expression denial of service

### Summary

The [regular expression](https://gitlab.com/gitlab-org/gitlab/-/blob/877bc64444e697daf1317c1bee0e72f44660c5b0/app/models/namespace.rb#L137) used to remove trailing `.`, `.git` or `.atom` from namespace paths is vulnerable to regular expression denial of service due to backtracking issues when provided with a long malicious string.

### Steps to reproduce

Demonstration on the command line

```
ruby -e '("."*50000+"!").gsub!(/(\.atom|\.git|\.)*\z/, "")'
```

This line will max out the CPU at 100% until killed.

This regex runs on input from external systems when provisioning accounts as seen by [this search](https://gitlab.com/search?utf8=%E2%9C%93&search=Namespace.clean_path&group_id=9970&project_id=278964&scope=&search_code=true&snippets=false&repository_ref=master&nav_source=navbar) but I don't want to test this on gitlab.com.

I might setup something locally for a better PoC, but I think I can come up with a fix instead of doing that and save the same. :)

### Example Project

### What is the current *bug* behavior?

A malicious string can cause a maxed out CPU on the server. Repeating the attack could tie up a lot of resources on the machine running GitLab.

### What is the expected *correct* behavior?

Path should be cleaned in constant time.

### Relevant logs and/or screenshots

### Output of checks

#### Results of GitLab environment info

Expand for output related to GitLab environment info
```

(For installations with omnibus-gitlab package run and paste the output of:
`sudo gitlab-rake gitlab:env:info`)

(For installations from source run and paste the output of:
`sudo -u git -H bundle exec rake gitlab:env:info RAILS_ENV=production`)

```
#### Results of GitLab application Check

Expand for output related to the GitLab application check
```

(For installations with omnibus-gitlab package run and paste the output of:
sudo gitlab-rake gitlab:check SANITIZE=true)

(For installations from source run and paste the output of:
sudo -u git -H bundle exec rake gitlab:check RAILS_ENV=production SANITIZE=true)

(we will only investigate if the tests are passing)

```
### Proposal

In Namespace, replace `gsub` with `loop` as [proposed below](https://gitlab.com/gitlab-org/gitlab/-/issues/289948#note_535987937 "Namespace path cleaning vulnerable to regular expression denial of service").

### Other proposals considered

* Introduce a sensible max length limit for the path.

Edited Jul 23, 2021 by [Dan Jensen](/djensen)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


