=== Content from gitlab.com_b872fbbb_20250114_195228.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39885.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39885.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39885.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39885.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  May 11, 2022

  [3984d852](/gitlab-org/cves/-/commit/3984d8528477727c8b620f95fcf714a20c080e17)
  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3984d8528477727c8b620f95fcf714a20c080e17)
  繚
  3984d852

  [ GitLab Bot ](/gitlab-bot) authored May 11, 2022

  3984d852

  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3984d8528477727c8b620f95fcf714a20c080e17)
  [ GitLab Bot ](/gitlab-bot) authored May 11, 2022

Loading



=== Content from gitlab.com_197482a9_20250114_195230.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Stored XSS in merge request creation page through payload in approval rule name

**[HackerOne report #1342009](https://hackerone.com/reports/1342009)** by `joaxcar` on 2021-09-16:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hi GitLab team, I found a stored XSS in merge request creation page caused by a payload in the name of an "approval rule".

Adding approval rules is a feature that is unlocked for premium subscriptions or above. This does not seem to block it from being used against regular users on for example Gitlab.com by inviting them into the "infected project".

This occurs when adding an "Approval rule" to a project and giving it a javascript/html payload as the name and attaching the rule to an approver. When a user tries to create a merge request in the project and opens the "Reviewers" dropdown, information about the user with the attached rule will be shown and the rule name will be injected underneath.

With the payload

```
<iframe/srcdoc='<script/src=/joaxcar_group/first/-/jobs/1415515489/artifacts/raw/data/alert.js></script>'></iframe>
```

this XSS bypasses the current CSP on Gitlab.com (tried it with an Ultimate trial and inviting a user without a trial to the project)

As I got the impression that all XSS are treated equal when reporting a similar issue, I have not made any deeper analysis of the reason for this firing. Thought I just report it right away. Please reach back to me if you need me to research the impact deeper! As an example, it does not fire when one "edits" a MR which is a bit odd...

##### Steps to reproduce

1. Create two user accounts, `attacker_user` and `victim_user` (`attacker_user` must have at least premium features enabled)
2. Log in as `attacker_user`
3. Create a project `xss_project` by going to <https://gitlab.com/projects/new#blank_project>
4. Go to projects settings on <https://gitlab.com/attacker_user/xss_project/edit> and scroll down to and expand "Merge request approvals"

[![approvals.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ccbd5b2229efeb51d8e24c0b43778c0066de54fb/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39656636386563392d363634382d346263642d613434652d3037386561363332386130632f617070726f76616c732e706e67)

5. Click "Add approval rule"
6. Put the payload as the name, If on Gitlab.com use

```
<iframe/srcdoc='<script/src=/joaxcar_group/first/-/jobs/1415515489/artifacts/raw/data/alert.js></script>'></iframe>
```

if this is tested on a server without CSP feel free to use the payload

```
<script>alert(document.domain)</script>
```

7. Search for and select `attacker_user` as approver and click create rule.

[![create.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/b09a35361bfff0cae3079fef0bf299262a9bb703/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61633965666264632d623338342d343066312d613038652d6535313362396665373832652f6372656174652e706e67)

8. Invite `victim_user` to the project as `Developer` on <https://gitlab.com/attacker_user/xss_project/-/project_members>
9. Log out and log back in as `victim_user`
10. Go to <https://gitlab.com/attacker_user/xss_project/-/branches/new> and create a branch `new`
11. Directly click on "Create merge request" (which will appear on the screen)

[![newMR.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d8e23e81023223579c29eb2ff57f9c0415b9a236/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65626664316235622d623662302d346464622d613336372d3236613532393763313236302f6e65774d522e706e67)

12. Click on the dropdown at "Reviewers"
13. Payload will trigger

[![fire.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/7a003a45b335f3b9f9eb8a5cef3d2b389a94c2c0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36323661653262392d623734302d346562302d616264372d6530623437323932633565352f666972652e706e67)

##### Impact

Stored XSS with CSP bypass. Full Javascript functionality without restrictions, so everything from stealing data to generating and exfiltrating access tokens.

##### Examples

If you access my private project at Gitlab.com (<https://gitlab.com/ultimate-joaxcar-test3/xss>) as an admin, you should be able to create an MR and trigger payload. (Just an alert box)

##### What is the current *bug* behavior?

Approver rule name is injected in the user information without proper sanitization.

##### What is the expected *correct* behavior?

The name should be sanitized

##### Output of checks

This bug happens on GitLab.com

#### Impact

Stored XSS with CSP bypass. Full Javascript functionality without restrictions, so everything from stealing data to generating and exfiltrating access tokens.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [newMR.png](https://h1.sec.gitlab.net/a/ebfd1b5b-b6b0-4ddb-a367-26a5297c1260/newMR.png)
* [fire.png](https://h1.sec.gitlab.net/a/626ae2b9-b740-4eb0-abd7-e0b47292c5e5/fire.png)
* [create.png](https://h1.sec.gitlab.net/a/ac9efbdc-b384-40f1-a08e-e513b9fe782e/create.png)
* [approvals.png](https://h1.sec.gitlab.net/a/9ef68ec9-6648-4bcd-a44e-078ea6328a0c/approvals.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Sep 17, 2021 by [Michael Henriksen](/mhenriksen)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


