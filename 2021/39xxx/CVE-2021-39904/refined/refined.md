The provided content relates to CVE-2021-39904.

**Root Cause:** The vulnerability stems from a lack of proper access control in GraphQL mutations. Specifically, the `discussionToggleResolve` mutation allows users who created a Merge Request to modify the state of discussion threads (resolving or unresolving them) even after the Merge Request has been locked by the repository owner.

**Weaknesses/Vulnerabilities:**
*   **Improper Access Control:** The system fails to prevent the Merge Request creator from performing state-changing actions on a locked Merge Request via GraphQL mutations. The locking mechanism was not adequately enforced at the GraphQL level.

**Impact of Exploitation:** An attacker (the Merge Request creator) can bypass the locked status of a Merge Request and perform actions such as resolving or unresolving discussion threads.

**Attack Vectors:**
*   **GraphQL Mutation:** The attacker leverages the `discussionToggleResolve` GraphQL mutation to modify the state of discussion threads.
*   **Direct API interaction:** The attacker does not use the UI, but instead uses a direct GraphQL query to achieve the modification.

**Required Attacker Capabilities/Position:**
*   **Merge Request Creator:** The attacker must be the creator of the Merge Request.
*   **Knowledge of GraphQL:** The attacker needs to be able to craft and execute GraphQL queries to identify the discussion ID and use the `discussionToggleResolve` mutation.
*   **Access to GraphQL Explorer:** Access to GitLab's GraphQL explorer tool is needed to discover the discussion IDs and perform the actions.