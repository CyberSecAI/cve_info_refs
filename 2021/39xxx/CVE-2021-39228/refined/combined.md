=== Content from github.com_ab198673_20250115_100106.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Freleases%2Ftag%2Fv0.11.6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Freleases%2Ftag%2Fv0.11.6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=tremor-rs%2Ftremor-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tremor-rs](/tremor-rs)
/
**[tremor-runtime](/tremor-rs/tremor-runtime)**
Public

* [Notifications](/login?return_to=%2Ftremor-rs%2Ftremor-runtime) You must be signed in to change notification settings
* [Fork
  126](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)
* [Star
   874](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)

* [Code](/tremor-rs/tremor-runtime/tree/v0.11.6)
* [Issues
  126](/tremor-rs/tremor-runtime/issues)
* [Pull requests
  15](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects
  1](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

Additional navigation options

* [Code](/tremor-rs/tremor-runtime/tree/v0.11.6)
* [Issues](/tremor-rs/tremor-runtime/issues)
* [Pull requests](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

1. [Releases](/tremor-rs/tremor-runtime/releases)
2. [v0.11.6](/tremor-rs/tremor-runtime/releases/tag/v0.11.6)

# v0.11.6 - Fix Memory safety issue

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/tremor-rs/tremor-runtime/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.11.6)

 Loading

[View all tags](/tremor-rs/tremor-runtime/tags)

![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)
[mfelsche](/mfelsche)
released this
16 Sep 12:16

·
[2793 commits](/tremor-rs/tremor-runtime/compare/v0.11.6...main)
to main
since this release

[v0.11.6](/tremor-rs/tremor-runtime/tree/v0.11.6)

[`074f664`](/tremor-rs/tremor-runtime/commit/074f6647db6d615715a24081486fd442be84f204)

# 0.11.6

## Fixes

* Fix possible memory safety issue when using patch or merge on `state` [#1217](https://github.com/tremor-rs/tremor-runtime/pull/1217).

Affected tremor-script code sample:

```
# this is where the memory safety issue occured
let state = merge state of event end;
emit state;

```

As an optimization we were optimizing both `patch` and `merge` to update the target expression (`state` in the case above) in-place, but only if the `merge`/`patch` result is assigned to itself. In case of `state` as target expression we were adding references to a given memory region where the `event` data was allocated and those references now outlived the actual `event` data allocation. 😱

This whole optimization has been removed for now.

 Assets
5

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c6f5fd03_20250115_100106.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fsecurity%2Fadvisories%2FGHSA-mc22-5q92-8v85)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fsecurity%2Fadvisories%2FGHSA-mc22-5q92-8v85)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=tremor-rs%2Ftremor-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tremor-rs](/tremor-rs)
/
**[tremor-runtime](/tremor-rs/tremor-runtime)**
Public

* [Notifications](/login?return_to=%2Ftremor-rs%2Ftremor-runtime) You must be signed in to change notification settings
* [Fork
  126](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)
* [Star
   874](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)

* [Code](/tremor-rs/tremor-runtime)
* [Issues
  126](/tremor-rs/tremor-runtime/issues)
* [Pull requests
  15](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects
  1](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

Additional navigation options

* [Code](/tremor-rs/tremor-runtime)
* [Issues](/tremor-rs/tremor-runtime/issues)
* [Pull requests](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

# Memory Safety Issue when using patch or merge on state and assign the result back to state

Moderate

[mfelsche](/mfelsche)
published
GHSA-mc22-5q92-8v85
Sep 17, 2021

## Package

cargo

Tremor
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

< 0.11.6, > 0.7.2

## Patched versions

0.11.6

## Description

### Impact

This vulnerability is a memory safety Issue when using [`patch`](https://www.tremor.rs/docs/tremor-script/index#patch) or [`merge`](https://www.tremor.rs/docs/tremor-script/index#merge) on `state` and assign the result back to `state`.

In this case affected versions of Tremor and the [tremor-script crate](https://crates.io/crates/tremor-script) maintains references to memory that might have been freed already. And these memory regions can be accessed by retrieving the `state`, e.g. send it over TCP or HTTP. This requires the Tremor server (or any other program using tremor-script) to execute a tremor-script script that uses the mentioned language construct.

#### Details

If affects the following two tremor-script language constructs:

* A [Merge](https://www.tremor.rs/docs/tremor-script/index#merge) where we assign the result back to the target expression

  and the expression to be merged needs to reference the `event`:

```
let state = merge state of event end;

```

* A [Patch](https://www.tremor.rs/docs/tremor-script/index#patch) where we assign the result back to the target expression

  and the patch operations used need to reference the `event`:

```
let state = patch state of insert event.key => event.value end;

```

For constructs like this (it does not matter what it references in the expression to be merged or the patch operations) an optimization

was applied to manipulate the target value in-place, instead of cloning it.

Our `Value` struct, which underpins all event data in `tremor-script`, is representing strings as borrowed `beef::Cow<'lifetime, str>`,

that reference the raw data `Vec<u8>` the event is based upon. We keep this raw byte-array next to the `Value` structure inside our `Event` as a self-referential struct,

so we make sure that the structured `Value` and its references are valid across its whole lifetime.

The optimization was considered safe as long as it was only possible to merge or patch `event` data or static data.

When `state` was introduced to `tremor-script` (in version 0.7.3) a new possibility to keep `Value` data around for longer than the lifetime of an event emerged.

If `event` data is merged or patched into `state` without cloning it first, it can still reference keys or values from

the previous event, which will now be invalid. This allows access to those already freed regions of memory and to get their content out over the wire.

### Patches

The issue has been patched in <https://crates.io/crates/tremor-script/0.11.6> and <https://github.com/tremor-rs/tremor-runtime/releases/tag/v0.11.6> via commit [1a2efcd](https://github.com/tremor-rs/tremor-runtime/commit/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e) by removing the optimization

and always clone the target expression of a [Merge](https://www.tremor.rs/docs/tremor-script/index#merge) or [Patch](<https://www.tremor.rs/docs/tremor-script/index#patch>.

### Workarounds

If an upgrade is not possible, a possible workaround is to avoid the optimization

by introducing a temporary variable and not immediately reassigning to `state`:

```
let tmp = merge state of event end;
let state = tmp

```
### References

The actual fix is applied in this PR: [#1217](https://github.com/tremor-rs/tremor-runtime/pull/1217)

### For more information

If you have any questions or comments about this advisory:

* Open an issue on our repository [tremor-rs/tremor-runtime](https://github.com/tremor-rs/tremor-runtime)
* Please join our discord <https://chat.tremor.rs> and reach out to the team.

### Severity

Moderate

6.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N

### CVE ID

CVE-2021-39228

### Weaknesses

[CWE-416](/advisories?query=cwe%3A416) [CWE-825](/advisories?query=cwe%3A825)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_42b9d692_20250115_100104.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fcommit%2F1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fcommit%2F1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tremor-rs%2Ftremor-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tremor-rs](/tremor-rs)
/
**[tremor-runtime](/tremor-rs/tremor-runtime)**
Public

* [Notifications](/login?return_to=%2Ftremor-rs%2Ftremor-runtime) You must be signed in to change notification settings
* [Fork
  126](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)
* [Star
   874](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)

* [Code](/tremor-rs/tremor-runtime)
* [Issues
  126](/tremor-rs/tremor-runtime/issues)
* [Pull requests
  15](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects
  1](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

Additional navigation options

* [Code](/tremor-rs/tremor-runtime)
* [Issues](/tremor-rs/tremor-runtime/issues)
* [Pull requests](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

## Commit

[Permalink](/tremor-rs/tremor-runtime/commit/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Remove patch and merge in\_place optimizations.

[Browse files](/tremor-rs/tremor-runtime/tree/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e)
Browse the repository at this point in the history

```
They are too dangerous and can lead to memory unsafety.

Also added proper state handling to script based tests.

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>
```

* Loading branch information

Matthias Wahl
committed
Sep 15, 2021

1 parent
[bffc2a5](/tremor-rs/tremor-runtime/commit/bffc2a555bc4922bbb36b7186445477d8c0d0193)

commit 1a2efcd

 Show file tree

 Hide file tree

Showing
**19 changed files**
with
**40 additions**
and
**152 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tests

  + tests/script.rs
    [script.rs](#diff-b96721b980b80dbb43657d4dd76e67fd2a7beb729832713ff6c2981f3bc295e3)
  + tests/script\_runtime\_error.rs
    [script\_runtime\_error.rs](#diff-02a8eb5aec54350f7f7b447424ebc4bd42abb43c90f37de177a145b3fea29a80)
  + script\_runtime\_errors

    - merge\_assign\_target\_new\_no\_object

      * tests/script\_runtime\_errors/merge\_assign\_target\_new\_no\_object/error.txt
        [error.txt](#diff-c508ed83c73ee1962a00aa22e52959330cab5f02b8f8993c9dea29d4462dfc5e)
      * tests/script\_runtime\_errors/merge\_assign\_target\_new\_no\_object/in
        [in](#diff-7bba9d420b570506d133ab178bec273fd82a7f8dceb6074de1a8f9c2bae87f91)
      * tests/script\_runtime\_errors/merge\_assign\_target\_new\_no\_object/script.tremor
        [script.tremor](#diff-4f184a44548e4829f510f260b0f8e10fd86b3bba15e000241734ed9910c62685)
    - merge\_assign\_target\_target\_no\_object

      * tests/script\_runtime\_errors/merge\_assign\_target\_target\_no\_object/error.txt
        [error.txt](#diff-9fb664fd7db3ec544cbb5cf6b56745be099a18a69ee64d49554c6d0c50b29bf6)
      * tests/script\_runtime\_errors/merge\_assign\_target\_target\_no\_object/in
        [in](#diff-533e2c8527f4158c101c043517149b79e230e954a7f5edacaabee0f3124e819d)
      * tests/script\_runtime\_errors/merge\_assign\_target\_target\_no\_object/script.tremor
        [script.tremor](#diff-f08926d4c0879d65f9e50abb339cdb3757f5c98e1af8361777fe91dd21183e16)
  + scripts

    - merge\_assign\_target\_state

      * tests/scripts/merge\_assign\_target\_state/in
        [in](#diff-669dd2cac8950494133a1ba76b29a0c48ca9d75537eae8a1a0ab484c481ac77d)
      * tests/scripts/merge\_assign\_target\_state/out
        [out](#diff-8f36ed324707aeeff5229a0083890b47f9c1859db91fc3412ef16e062b1f8f99)
      * tests/scripts/merge\_assign\_target\_state/script.tremor
        [script.tremor](#diff-75259cc122db280ee81148402cbb640afcb6e3e5110cbc91ef3f1cfa4d931fdd)
    - patch\_assign\_target

      * tests/scripts/patch\_assign\_target/in
        [in](#diff-9d225793573f2dd10cd921ccf1ef8af0c32aea5659d9fb770754b52e33008c43)
      * tests/scripts/patch\_assign\_target/out
        [out](#diff-7a213cedbcf30a16b4f22ce24cee3a0a20cfcb28eb1013f366d38d66121220cc)
      * tests/scripts/patch\_assign\_target/script.tremor
        [script.tremor](#diff-a700d4134b647b24f98f20851e5a17b3534452b06b1854a8b8faf6ffd0dea2eb)
* tremor-script/src

  + tremor-script/src/ast.rs
    [ast.rs](#diff-79ba8fe1d939a8d720e1e4f936d0d2cf5a61681fd1f8d42839c057649d102bcb)
  + ast

    - tremor-script/src/ast/base\_expr.rs
      [base\_expr.rs](#diff-c811d94fd8b36474774e35d331bb1bad06b9c9a615f1c8291fb496aea54a3852)
    - tremor-script/src/ast/raw.rs
      [raw.rs](#diff-a803fd94333e0f206f892ddb7b21bcf1db586da50db9c6ab24f820993d1a70a4)
    - tremor-script/src/ast/to\_static.rs
      [to\_static.rs](#diff-26cb5448ec00ff168f5b6addb98f06d1e442182f91825a608bd9d0bdaf55134c)
  + interpreter

    - tremor-script/src/interpreter/expr.rs
      [expr.rs](#diff-7c5f7a0c0d6e770e398794aa91af6a15af0b06580ed88846f1a6a3e7db8a5fe7)

## There are no files selected for viewing

5 changes: 3 additions & 2 deletions

5
[tests/script.rs](#diff-b96721b980b80dbb43657d4dd76e67fd2a7beb729832713ff6c2981f3bc295e3 "tests/script.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,7 @@ macro\_rules! test\_cases { |
|  |  | out\_json.reverse(); |
|  |  |  |
|  |  | let mut results = Vec::new(); |
|  |  | let mut state = Value::null(); |
|  |  | for (id, mut json) in in\_json.into\_iter().enumerate() { |
|  |  | let uri = EventOriginUri{ |
|  |  | host: "test".into(), |
| Expand All | | @@ -62,7 +63,6 @@ macro\_rules! test\_cases { |
|  |  | }; |
|  |  | let context = EventContext::new(id as u64, Some(&uri)); |
|  |  | let mut meta = Value::from(Object::default()); |
|  |  | let mut state = Value::null(); |
|  |  | match script.run(&context, AggrType::Tick, &mut json, &mut state, &mut meta)? { |
|  |  | Return::Drop => (), |
|  |  | Return::EmitEvent{..} => results.push(json), |
| Expand Down  Expand Up | | @@ -154,6 +154,7 @@ test\_cases!( |
|  |  | // TODO |
|  |  | // const\_in\_const\_lookup, |
|  |  | // INSERT |
|  |  | merge\_assign\_target\_state, |
|  |  | expr\_path, |
|  |  | patch\_default, |
|  |  | patch\_default\_key, |
| Expand Down  Expand Up | | @@ -186,7 +187,7 @@ test\_cases!( |
|  |  | heredoc\_quoted\_curly, |
|  |  | string\_interpolation\_import, |
|  |  | string\_interpolation\_prefix, |
|  |  | patch\_in\_place, |
|  |  | patch\_assign\_target, |
|  |  | tuple\_pattern, |
|  |  | pattern\_cmp, |
|  |  | pass\_args, |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[tests/script\_runtime\_error.rs](#diff-02a8eb5aec54350f7f7b447424ebc4bd42abb43c90f37de177a145b3fea29a80 "tests/script_runtime_error.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_error.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -105,10 +105,10 @@ macro\_rules! ignore\_cases { |
|  |  | file.read\_to\_string(&mut err)?; |
|  |  | let \_err = err.trim(); |
|  |  |  |
|  |  | let mut state = Value::null(); |
|  |  | if let Some(mut json) = in\_json.pop() { |
|  |  | let context = EventContext::new(0, None); |
|  |  | let mut meta = Value::object(); |
|  |  | let mut state = Value::null(); |
|  |  | let s = script.run(&context, AggrType::Tick, &mut json, &mut state, &mut meta); |
|  |  | if let Err(e) = s { |
|  |  | let mut h = Dumb::new(); |
| Expand Down  Expand Up | | @@ -144,8 +144,8 @@ test\_cases!( |
|  |  | function\_error\_n, |
|  |  | match\_bad\_guard\_type, |
|  |  | match\_no\_clause\_hit, |
|  |  | merge\_in\_place\_new\_no\_object, |
|  |  | merge\_in\_place\_target\_no\_object, |
|  |  | merge\_assign\_target\_new\_no\_object, |
|  |  | merge\_assign\_target\_target\_no\_object, |
|  |  | merge\_new\_no\_object, |
|  |  | merge\_target\_no\_object, |
|  |  | missing\_local, |
| Expand Down | |  |

0

[...rs/merge\_in\_place\_new\_no\_object/error.txt → ...rge\_assign\_target\_new\_no\_object/error.txt](#diff-c508ed83c73ee1962a00aa22e52959330cab5f02b8f8993c9dea29d4462dfc5e "tests/script_runtime_errors/merge_in_place_new_no_object/error.txt → tests/script_runtime_errors/merge_assign_target_new_no_object/error.txt")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_new_no_object/error.txt)
Edit file

Delete file

File renamed without changes.

0

[...me\_errors/merge\_in\_place\_new\_no\_object/in → ...rors/merge\_assign\_target\_new\_no\_object/in](#diff-7bba9d420b570506d133ab178bec273fd82a7f8dceb6074de1a8f9c2bae87f91 "tests/script_runtime_errors/merge_in_place_new_no_object/in → tests/script_runtime_errors/merge_assign_target_new_no_object/in")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_new_no_object/in)
Edit file

Delete file

File renamed without changes.

0

[...erge\_in\_place\_new\_no\_object/script.tremor → ...assign\_target\_new\_no\_object/script.tremor](#diff-4f184a44548e4829f510f260b0f8e10fd86b3bba15e000241734ed9910c62685 "tests/script_runtime_errors/merge_in_place_new_no_object/script.tremor → tests/script_runtime_errors/merge_assign_target_new_no_object/script.tremor")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_new_no_object/script.tremor)
Edit file

Delete file

File renamed without changes.

0

[...merge\_in\_place\_target\_no\_object/error.txt → ...\_assign\_target\_target\_no\_object/error.txt](#diff-9fb664fd7db3ec544cbb5cf6b56745be099a18a69ee64d49554c6d0c50b29bf6 "tests/script_runtime_errors/merge_in_place_target_no_object/error.txt → tests/script_runtime_errors/merge_assign_target_target_no_object/error.txt")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_target_no_object/error.txt)
Edit file

Delete file

File renamed without changes.

0

[...errors/merge\_in\_place\_target\_no\_object/in → ...s/merge\_assign\_target\_target\_no\_object/in](#diff-533e2c8527f4158c101c043517149b79e230e954a7f5edacaabee0f3124e819d "tests/script_runtime_errors/merge_in_place_target_no_object/in → tests/script_runtime_errors/merge_assign_target_target_no_object/in")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_target_no_object/in)
Edit file

Delete file

File renamed without changes.

0

[...e\_in\_place\_target\_no\_object/script.tremor → ...ign\_target\_target\_no\_object/script.tremor](#diff-f08926d4c0879d65f9e50abb339cdb3757f5c98e1af8361777fe91dd21183e16 "tests/script_runtime_errors/merge_in_place_target_no_object/script.tremor → tests/script_runtime_errors/merge_assign_target_target_no_object/script.tremor")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/script_runtime_errors/merge_assign_target_target_no_object/script.tremor)
Edit file

Delete file

File renamed without changes.

2 changes: 2 additions & 0 deletions

2
[tests/scripts/merge\_assign\_target\_state/in](#diff-669dd2cac8950494133a1ba76b29a0c48ca9d75537eae8a1a0ab484c481ac77d "tests/scripts/merge_assign_target_state/in")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/merge_assign_target_state/in)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,2 @@ |
|  |  | {"foo": "bar"} |
|  |  | {"snot": "badger", "foo": "grmpf"} |

2 changes: 2 additions & 0 deletions

2
[tests/scripts/merge\_assign\_target\_state/out](#diff-8f36ed324707aeeff5229a0083890b47f9c1859db91fc3412ef16e062b1f8f99 "tests/scripts/merge_assign_target_state/out")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/merge_assign_target_state/out)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,2 @@ |
|  |  | {"foo":"bar"} |
|  |  | {"foo":"grmpf","snot":"badger"} |

8 changes: 8 additions & 0 deletions

8
[tests/scripts/merge\_assign\_target\_state/script.tremor](#diff-75259cc122db280ee81148402cbb640afcb6e3e5110cbc91ef3f1cfa4d931fdd "tests/scripts/merge_assign_target_state/script.tremor")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/merge_assign_target_state/script.tremor)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,8 @@ |
|  |  | # initialize state to record, so we can do the merge |
|  |  | let state = match state of |
|  |  | case null => {} |
|  |  | default => state |
|  |  | end; |
|  |  |  |
|  |  | let state = merge state of event end; |
|  |  | emit state |

0

[tests/scripts/patch\_in\_place/in → tests/scripts/patch\_assign\_target/in](#diff-9d225793573f2dd10cd921ccf1ef8af0c32aea5659d9fb770754b52e33008c43 "tests/scripts/patch_in_place/in → tests/scripts/patch_assign_target/in")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/patch_assign_target/in)
Edit file

Delete file

File renamed without changes.

0

[tests/scripts/patch\_in\_place/out → tests/scripts/patch\_assign\_target/out](#diff-7a213cedbcf30a16b4f22ce24cee3a0a20cfcb28eb1013f366d38d66121220cc "tests/scripts/patch_in_place/out → tests/scripts/patch_assign_target/out")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/patch_assign_target/out)
Edit file

Delete file

File renamed without changes.

0

[tests/scripts/patch\_in\_place/script.tremor → ...scripts/patch\_assign\_target/script.tremor](#diff-a700d4134b647b24f98f20851e5a17b3534452b06b1854a8b8faf6ffd0dea2eb "tests/scripts/patch_in_place/script.tremor → tests/scripts/patch_assign_target/script.tremor")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tests/scripts/patch_assign_target/script.tremor)
Edit file

Delete file

File renamed without changes.

4 changes: 0 additions & 4 deletions

4
[tremor-script/src/ast.rs](#diff-79ba8fe1d939a8d720e1e4f936d0d2cf5a61681fd1f8d42839c057649d102bcb "tremor-script/src/ast.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tremor-script/src/ast.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -961,10 +961,6 @@ pub enum Expr<'script> { |
|  |  | Match(Box<Match<'script, Self>>), |
|  |  | /// IfElse style match expression |
|  |  | IfElse(Box<IfElse<'script, Self>>), |
|  |  | /// In place patch expression |
|  |  | PatchInPlace(Box<Patch<'script>>), |
|  |  | /// In place merge expression |
|  |  | MergeInPlace(Box<Merge<'script>>), |
|  |  | /// Assignment expression |
|  |  | Assign { |
|  |  | /// Id |
| Expand Down | |  |

2 changes: 0 additions & 2 deletions

2
[tremor-script/src/ast/base\_expr.rs](#diff-c811d94fd8b36474774e35d331bb1bad06b9c9a615f1c8291fb496aea54a3852 "tremor-script/src/ast/base_expr.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tremor-script/src/ast/base_expr.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -248,8 +248,6 @@ impl<'script> BaseExpr for Expr<'script> { |
|  |  | Expr::Emit(e) => e.mid(), |
|  |  | Expr::Imut(e) => e.mid(), |
|  |  | Expr::Match(e) => e.mid(), |
|  |  | Expr::MergeInPlace(e) => e.mid(), |
|  |  | Expr::PatchInPlace(e) => e.mid(), |
|  |  | Expr::IfElse(e) => e.mid(), |
|  |  | } |
|  |  | } |
| Expand Down | |  |

48 changes: 18 additions & 30 deletions

48
[tremor-script/src/ast/raw.rs](#diff-a803fd94333e0f206f892ddb7b21bcf1db586da50db9c6ab24f820993d1a70a4 "tremor-script/src/ast/raw.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tremor-script/src/ast/raw.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,14 +18,14 @@ |
|  |  |  |
|  |  | use crate::{ |
|  |  | ast::{ |
|  |  | base\_expr, eq::AstEq, query, upable::Upable, ArrayPattern, ArrayPredicatePattern, |
|  |  | AssignPattern, BinExpr, BinOpKind, Bytes, BytesPart, ClauseGroup, Comprehension, |
|  |  | ComprehensionCase, Costly, DefaultCase, EmitExpr, EventPath, Expr, ExprPath, Expression, |
|  |  | Field, FnDecl, FnDoc, Helper, Ident, IfElse, ImutExpr, ImutExprInt, Invocable, Invoke, |
|  |  | InvokeAggr, InvokeAggrFn, List, Literal, LocalPath, Match, Merge, MetadataPath, ModDoc, |
|  |  | NodeMetas, Patch, PatchOperation, Path, Pattern, PredicateClause, PredicatePattern, Record, |
|  |  | RecordPattern, Recur, ReservedPath, Script, Segment, StatePath, StrLitElement, StringLit, |
|  |  | TestExpr, TuplePattern, UnaryExpr, UnaryOpKind, |
|  |  | base\_expr, query, upable::Upable, ArrayPattern, ArrayPredicatePattern, AssignPattern, |
|  |  | BinExpr, BinOpKind, Bytes, BytesPart, ClauseGroup, Comprehension, ComprehensionCase, |
|  |  | Costly, DefaultCase, EmitExpr, EventPath, Expr, ExprPath, Expression, Field, FnDecl, FnDoc, |
|  |  | Helper, Ident, IfElse, ImutExpr, ImutExprInt, Invocable, Invoke, InvokeAggr, InvokeAggrFn, |
|  |  | List, Literal, LocalPath, Match, Merge, MetadataPath, ModDoc, NodeMetas, Patch, |
|  |  | PatchOperation, Path, Pattern, PredicateClause, PredicatePattern, Record, RecordPattern, |
|  |  | Recur, ReservedPath, Script, Segment, StatePath, StrLitElement, StringLit, TestExpr, |
|  |  | TuplePattern, UnaryExpr, UnaryOpKind, |
|  |  | }, |
|  |  | errors::{ |
|  |  | err\_generic, error\_generic, error\_missing\_effector, error\_oops, Error, ErrorKind, Result, |
| Expand Down  Expand Up | | @@ -646,28 +646,16 @@ impl<'script> Upable<'script> for ExprRaw<'script> { |
|  |  | let path = a.path.up(helper)?; |
|  |  | let mid = helper.add\_meta(a.start, a.end); |
|  |  | match a.expr.up(helper)? { |
|  |  | Expr::Imut(ImutExprInt::Merge(m)) => { |
|  |  | if path.ast\_eq(&m.target) { |
|  |  | Expr::MergeInPlace(Box::new(\*m)) |
|  |  | } else { |
|  |  | Expr::Assign { |
|  |  | mid, |
|  |  | path, |
|  |  | expr: Box::new(ImutExprInt::Merge(m).into()), |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | Expr::Imut(ImutExprInt::Patch(m)) => { |
|  |  | if path.ast\_eq(&m.target) { |
|  |  | Expr::PatchInPlace(Box::new(\*m)) |
|  |  | } else { |
|  |  | Expr::Assign { |
|  |  | mid, |
|  |  | path, |
|  |  | expr: Box::new(ImutExprInt::Patch(m).into()), |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | Expr::Imut(ImutExprInt::Merge(m)) => Expr::Assign { |
|  |  | mid, |
|  |  | path, |
|  |  | expr: Box::new(ImutExprInt::Merge(m).into()), |
|  |  | }, |
|  |  | Expr::Imut(ImutExprInt::Patch(m)) => Expr::Assign { |
|  |  | mid, |
|  |  | path, |
|  |  | expr: Box::new(ImutExprInt::Patch(m).into()), |
|  |  | }, |
|  |  | expr => Expr::Assign { |
|  |  | mid, |
|  |  | path, |
| Expand Down | |  |

2 changes: 0 additions & 2 deletions

2
[tremor-script/src/ast/to\_static.rs](#diff-26cb5448ec00ff168f5b6addb98f06d1e442182f91825a608bd9d0bdaf55134c "tremor-script/src/ast/to_static.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tremor-script/src/ast/to_static.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -159,8 +159,6 @@ impl<'script> Expr<'script> { |
|  |  | match self { |
|  |  | Expr::Match(e) => Expr::Match(Box::new(e.into\_static())), |
|  |  | Expr::IfElse(e) => Expr::IfElse(Box::new(e.into\_static())), |
|  |  | Expr::PatchInPlace(e) => Expr::PatchInPlace(Box::new(e.into\_static())), |
|  |  | Expr::MergeInPlace(e) => Expr::MergeInPlace(Box::new(e.into\_static())), |
|  |  | Expr::Assign { mid, path, expr } => Expr::Assign { |
|  |  | mid, |
|  |  | path: path.into\_static(), |
| Expand Down | |  |

113 changes: 4 additions & 109 deletions

113
[tremor-script/src/interpreter/expr.rs](#diff-7c5f7a0c0d6e770e398794aa91af6a15af0b06580ed88846f1a6a3e7db8a5fe7 "tremor-script/src/interpreter/expr.rs")

Show comments

[View file](/tremor-rs/tremor-runtime/blob/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e/tremor-script/src/interpreter/expr.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,24 +13,23 @@ |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | use super::{ |
|  |  | merge\_values, patch\_value, resolve, resolve\_value, set\_local\_shadow, test\_guard, |
|  |  | test\_predicate\_expr, Env, ExecOpts, LocalStack, NULL, |
|  |  | resolve, resolve\_value, set\_local\_shadow, test\_guard, test\_predicate\_expr, Env, ExecOpts, |
|  |  | LocalStack, NULL, |
|  |  | }; |
|  |  | use crate::errors::{ |
|  |  | error\_assign\_array, error\_assign\_to\_const, error\_bad\_key\_err, error\_invalid\_assign\_target, |
|  |  | error\_need\_obj, error\_need\_obj\_err, error\_no\_clause\_hit, Result, |
|  |  | error\_need\_obj\_err, error\_no\_clause\_hit, Result, |
|  |  | }; |
|  |  | use crate::prelude::\*; |
|  |  | use crate::registry::RECUR\_PTR; |
|  |  | use crate::{ |
|  |  | ast::{ |
|  |  | BaseExpr, ClauseGroup, ClausePreCondition, Comprehension, DefaultCase, EmitExpr, EventPath, |
|  |  | Expr, IfElse, ImutExprInt, Match, Merge, Patch, Path, Segment, |
|  |  | Expr, IfElse, ImutExprInt, Match, Path, Segment, |
|  |  | }, |
|  |  | errors::error\_oops\_err, |
|  |  | }; |
|  |  | use crate::{stry, Value}; |
|  |  | use matches::matches; |
|  |  | use std::mem; |
|  |  | use std::{ |
|  |  | borrow::{Borrow, Cow}, |
| Expand Down  Expand Up | | @@ -219,104 +218,6 @@ impl<'script> Expr<'script> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | fn patch\_in\_place<'run, 'event>( |
|  |  | opts: ExecOpts, |
|  |  | env: &'run Env<'run, 'event>, |
|  |  | event: &'run Value<'event>, |
|  |  | state: &'run Value<'static>, |
|  |  | meta: &'run Value<'event>, |
|  |  | local: &'run LocalStack<'event>, |
|  |  | expr: &'run Patch<'event>, |
|  |  | ) -> Result<Cow<'run, Value<'event>>> { |
|  |  | // This function is called when we encounter code that consumes a value |
|  |  | // to patch it. So the following code: |
|  |  | // ```tremor |
|  |  | // let event = patch event of insert "key" => "value" end |
|  |  | // ``` |
|  |  | // When executed on it's own would clone the event, add a key and |
|  |  | // overwrite original event. |
|  |  | // |
|  |  | // We optimise this as: |
|  |  | // ``` |
|  |  | // patch\_in\_place event of insert "key" => "value" end |
|  |  | // ``` |
|  |  | // |
|  |  | // This code is generated in impl Upable for ExprRaw where the following |
|  |  | // checks are performed: |
|  |  | // |
|  |  | // 1) the patch is on the RHS of an assignment |
|  |  | // 2) the path of the assigned value and the path of the patched |
|  |  | // expression are identical. |
|  |  | // |
|  |  | // In turn this guarantees (at compile time): |
|  |  | // |
|  |  | // 1) The target (`expr`) is a path lookup |
|  |  | // 2) The target is not a known constant as otherwise the assignment |
|  |  | // will complan |
|  |  | // 3) this leave the `expr` to be either a local, the event, the state, |
|  |  | // metadata or a subkey thereof. |
|  |  | // |
|  |  | // And the following guarantees at run time: |
|  |  | // |
|  |  | // 1) the `expr` is an existing key of the mentioned categories, |
|  |  | // otherwise `expr.target.run` will error. |
|  |  | // 2) `value` will never be owned (however the resolve function is |
|  |  | // generic so it needs to return a Cow) |
|  |  |  |
|  |  | let value: Cow<'run, Value<'event>> = |
|  |  | stry!(expr.target.run(opts, env, event, state, meta, local)); |
|  |  | debug\_assert!( |
|  |  | !matches!(value, Cow::Owned(\_)), |
|  |  | "We should never see a owned value here as patch\_in\_place is only ever called on existing data in event, state, meta or local" |
|  |  | ); |
|  |  | let v: &Value<'event> = value.borrow(); |
|  |  | // ALLOW: https://github.com/tremor-rs/tremor-runtime/issues/1032 |
|  |  | #[allow(mutable\_transmutes, clippy::transmute\_ptr\_to\_ptr)] |
|  |  | // ALLOW: https://github.com/tremor-rs/tremor-runtime/issues/1032 |
|  |  | let v: &mut Value<'event> = unsafe { mem::transmute(v) }; |
|  |  | stry!(patch\_value(opts, env, event, state, meta, local, v, expr)); |
|  |  | Ok(value) |
|  |  | } |
|  |  |  |
|  |  | fn merge\_in\_place<'run, 'event>( |
|  |  | &'run self, |
|  |  | opts: ExecOpts, |
|  |  | env: &'run Env<'run, 'event>, |
|  |  | event: &'run mut Value<'event>, |
|  |  | state: &'run mut Value<'static>, |
|  |  | meta: &'run mut Value<'event>, |
|  |  | local: &'run mut LocalStack<'event>, |
|  |  | expr: &'run Merge<'event>, |
|  |  | ) -> Result<Cow<'run, Value<'event>>> { |
|  |  | // Please see the soundness reasoning in `patch\_in\_place` for details |
|  |  | // those functions perform the same function just with slighty different |
|  |  | // operations. |
|  |  | let value\_cow: Cow<'run, Value<'event>> = |
|  |  | stry!(expr.target.run(opts, env, event, state, meta, local)); |
|  |  | debug\_assert!( |
|  |  | !matches!(value\_cow, Cow::Owned(\_)), |
|  |  | "We should never see a owned value here as merge\_in\_place is only ever called on existing data in event, state, meta or local" |
|  |  | ); |
|  |  |  |
|  |  | if value\_cow.is\_object() { |
|  |  | let value: &Value<'event> = value\_cow.borrow(); |
|  |  | // ALLOW: https://github.com/tremor-rs/tremor-runtime/issues/1032 |
|  |  | #[allow(mutable\_transmutes, clippy::transmute\_ptr\_to\_ptr)] |
|  |  | // ALLOW: https://github.com/tremor-rs/tremor-runtime/issues/1032 |
|  |  | let value: &mut Value<'event> = unsafe { mem::transmute(value) }; |
|  |  | let replacement = stry!(expr.expr.run(opts, env, event, state, meta, local,)); |
|  |  |  |
|  |  | if replacement.is\_object() { |
|  |  | stry!(merge\_values(self, &expr.expr, value, &replacement)); |
|  |  | Ok(value\_cow) |
|  |  | } else { |
|  |  | error\_need\_obj(self, &expr.expr, replacement.value\_type(), env.meta) |
|  |  | } |
|  |  | } else { |
|  |  | error\_need\_obj(self, &expr.target, value\_cow.value\_type(), env.meta) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // TODO: Quite some overlap with `ImutExprInt::comprehension` |
|  |  | fn comprehension<'run, 'event>( |
|  |  | &'run self, |
| Expand Down  Expand Up | | @@ -641,12 +542,6 @@ impl<'script> Expr<'script> { |
|  |  | } |
|  |  | Expr::Match(ref expr) => self.match\_expr(opts, env, event, state, meta, local, expr), |
|  |  | Expr::IfElse(ref expr) => self.if\_expr(opts, env, event, state, meta, local, expr), |
|  |  | Expr::MergeInPlace(ref expr) => self |
|  |  | .merge\_in\_place(opts, env, event, state, meta, local, expr) |
|  |  | .map(Cont::Cont), |
|  |  | Expr::PatchInPlace(ref expr) => { |
|  |  | Self::patch\_in\_place(opts, env, event, state, meta, local, expr).map(Cont::Cont) |
|  |  | } |
|  |  | Expr::Comprehension(ref expr) => { |
|  |  | self.comprehension(opts, env, event, state, meta, local, expr) |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1a2efcd`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fcommit%2F1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_608d04f8_20250115_100105.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fpull%2F1217)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fpull%2F1217)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=tremor-rs%2Ftremor-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tremor-rs](/tremor-rs)
/
**[tremor-runtime](/tremor-rs/tremor-runtime)**
Public

* [Notifications](/login?return_to=%2Ftremor-rs%2Ftremor-runtime) You must be signed in to change notification settings
* [Fork
  126](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)
* [Star
   874](/login?return_to=%2Ftremor-rs%2Ftremor-runtime)

* [Code](/tremor-rs/tremor-runtime)
* [Issues
  126](/tremor-rs/tremor-runtime/issues)
* [Pull requests
  15](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects
  1](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

Additional navigation options

* [Code](/tremor-rs/tremor-runtime)
* [Issues](/tremor-rs/tremor-runtime/issues)
* [Pull requests](/tremor-rs/tremor-runtime/pulls)
* [Actions](/tremor-rs/tremor-runtime/actions)
* [Projects](/tremor-rs/tremor-runtime/projects)
* [Security](/tremor-rs/tremor-runtime/security)
* [Insights](/tremor-rs/tremor-runtime/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftremor-rs%2Ftremor-runtime%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftremor-rs%2Ftremor-runtime%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Remove in-place optimizations of patch and merge #1217

 Merged

[mfelsche](/mfelsche)
merged 4 commits into
[main](/tremor-rs/tremor-runtime/tree/main "tremor-rs/tremor-runtime:main")
from
[remove\_in\_place](/tremor-rs/tremor-runtime/tree/remove_in_place "tremor-rs/tremor-runtime:remove_in_place")

Sep 15, 2021

 Merged

# [Remove in-place optimizations of patch and merge](#top) #1217

[mfelsche](/mfelsche)
merged 4 commits into
[main](/tremor-rs/tremor-runtime/tree/main "tremor-rs/tremor-runtime:main")
from
[remove\_in\_place](/tremor-rs/tremor-runtime/tree/remove_in_place "tremor-rs/tremor-runtime:remove_in_place")

Sep 15, 2021

[Conversation
4](/tremor-rs/tremor-runtime/pull/1217)
[Commits
4](/tremor-rs/tremor-runtime/pull/1217/commits)
[Checks
0](/tremor-rs/tremor-runtime/pull/1217/checks)
[Files changed](/tremor-rs/tremor-runtime/pull/1217/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mfelsche](https://avatars.githubusercontent.com/u/1152667?s=60&v=4)](/mfelsche)

Copy link

Member

### @mfelsche **[mfelsche](/mfelsche)** commented [Sep 15, 2021](#issue-996989223) • edited Loading

# Pull request

## Description

This PR removes the `patch` and `merge` in-place optimizations, as they can lead to memory unsafety.

a script like:

```
# initialize state
let state = match state of
  case null => {}
  default state
end;
let state = merge state of event end;
emit state

```

will happily mutate `state` and insert values from `event`, which will no longer be valid after the event is gone, and so allow a view into freed up or reallocated memory via string keys or values.

We try to get back to those optimizations in a safer way.

## Related

* Related Issues: fixes [transmute in \_in\_place functions #1032](https://github.com/tremor-rs/tremor-runtime/issues/1032)

## Checklist

* The RFC, if required, has been submitted and approved
* Any user-facing impact of the changes is reflected in docs.tremor.rs
* The code is tested
* Use of unsafe code is reasoned about in a comment
* Update CHANGELOG.md appropriately, recording any changes, bug fixes, or other observable changes in behavior
* The performance impact of the change is measured (see below)

## Performance

Sorry, something went wrong.

All reactions

 Matthias Wahl
added 2 commits
[September 15, 2021 13:40](#commits-pushed-1a2efcd)

`[Remove patch and merge in_place optimizations.](/tremor-rs/tremor-runtime/pull/1217/commits/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e "Remove patch and merge in_place optimizations.

They are too dangerous and can lead to memory unsafety.

Also added proper state handling to script based tests.

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>")`
 …

`[1a2efcd](/tremor-rs/tremor-runtime/pull/1217/commits/1a2efcdbe68e5e7fd0a05836ac32d2cde78a0b2e)`

```
They are too dangerous and can lead to memory unsafety.

Also added proper state handling to script based tests.

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>
```

`[Add proper state handling to 'tremor run'.](/tremor-rs/tremor-runtime/pull/1217/commits/3bbb69d25b9ca995a4c25838781f89c62f2ca923 "Add proper state handling to 'tremor run'.

So state is not reset to 'null' after every event but lasts the whole 'tremor run' session when running a tremor script.

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>")`
 …

`[3bbb69d](/tremor-rs/tremor-runtime/pull/1217/commits/3bbb69d25b9ca995a4c25838781f89c62f2ca923)`

```
So state is not reset to 'null' after every event but lasts the whole 'tremor run' session when running a tremor script.

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>
```

[![Licenser](https://avatars.githubusercontent.com/u/119093?s=60&v=4)](/Licenser)

**[Licenser](/Licenser)**
previously approved these changes
[Sep 15, 2021](#pullrequestreview-755016653)

 [View reviewed changes](/tremor-rs/tremor-runtime/pull/1217/files/3bbb69d25b9ca995a4c25838781f89c62f2ca923)

Copy link

Member

### @Licenser **[Licenser](/Licenser)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nice catch! 🚀

Sorry, something went wrong.

All reactions

`[Update CHANGELOG](/tremor-rs/tremor-runtime/pull/1217/commits/2f812884155beebe369c8adc04a08fe55393ec70 "Update CHANGELOG

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>")`
 …

`[2f81288](/tremor-rs/tremor-runtime/pull/1217/commits/2f812884155beebe369c8adc04a08fe55393ec70)`

```
Signed-off-by: Matthias Wahl <mwahl@wayfair.com>
```

 [![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
dismissed
[Licenser](/Licenser)’s [stale review](#pullrequestreview-755016653)
via
`[2f81288](/tremor-rs/tremor-runtime/commit/2f812884155beebe369c8adc04a08fe55393ec70)`
[September 15, 2021 12:14](#event-5305542107)

[![Licenser](https://avatars.githubusercontent.com/u/119093?s=60&v=4)](/Licenser)

**[Licenser](/Licenser)**
previously approved these changes
[Sep 15, 2021](#pullrequestreview-755036800)

 [View reviewed changes](/tremor-rs/tremor-runtime/pull/1217/files/2f812884155beebe369c8adc04a08fe55393ec70)

[![@coveralls](https://avatars.githubusercontent.com/u/2354108?s=80&v=4)](/coveralls)

Copy link

Collaborator

### **[coveralls](/coveralls)** commented [Sep 15, 2021](#issuecomment-919969821) • edited Loading

| [Coverage Status](https://coveralls.io/builds/42893818)  Coverage increased (+0.02%) to 85.244% when pulling **[70f7e11](https://github.com/tremor-rs/tremor-runtime/commit/70f7e11da37d9a16c7f8e41e83014f62398b8043) on remove\_in\_place** into **[bffc2a5](https://github.com/tremor-rs/tremor-runtime/commit/bffc2a555bc4922bbb36b7186445477d8c0d0193) on main**. |
| --- |

All reactions

Sorry, something went wrong.

`[Add merge in place and patch in place benches](/tremor-rs/tremor-runtime/pull/1217/commits/70f7e11da37d9a16c7f8e41e83014f62398b8043 "Add merge in place and patch in place benches

Signed-off-by: Matthias Wahl <mwahl@wayfair.com>")`
 …

`[70f7e11](/tremor-rs/tremor-runtime/pull/1217/commits/70f7e11da37d9a16c7f8e41e83014f62398b8043)`

```
Signed-off-by: Matthias Wahl <mwahl@wayfair.com>
```

 [![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
dismissed
[Licenser](/Licenser)’s [stale review](#pullrequestreview-755036800)
via
`[70f7e11](/tremor-rs/tremor-runtime/commit/70f7e11da37d9a16c7f8e41e83014f62398b8043)`
[September 15, 2021 13:31](#event-5306002068)

 [![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
marked this pull request as ready for review
[September 15, 2021 13:48](#event-5306120364)

 [![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
requested review from
[anupdhml](/anupdhml) and
[darach](/darach)
as [code owners](/tremor-rs/tremor-runtime/blob/bffc2a555bc4922bbb36b7186445477d8c0d0193/CODEOWNERS#L2)
[September 15, 2021 13:48](#event-5306120410)

[![darach](https://avatars.githubusercontent.com/u/229042?s=60&v=4)](/darach)

**[darach](/darach)**
approved these changes
[Sep 15, 2021](#pullrequestreview-755150568)

 [View reviewed changes](/tremor-rs/tremor-runtime/pull/1217/files/70f7e11da37d9a16c7f8e41e83014f62398b8043)

Copy link

Member

### @darach **[darach](/darach)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM 👍

Sorry, something went wrong.

All reactions

[![Licenser](https://avatars.githubusercontent.com/u/119093?s=60&v=4)](/Licenser)

**[Licenser](/Licenser)**
approved these changes
[Sep 15, 2021](#pullrequestreview-755156697)

 [View reviewed changes](/tremor-rs/tremor-runtime/pull/1217/files/70f7e11da37d9a16c7f8e41e83014f62398b8043)

[![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
merged commit [`ec22294`](/tremor-rs/tremor-runtime/commit/ec22294e1fab94bf344d85b7664d224e4790ddec)
into
main

[Sep 15, 2021](https://github.com/tremor-rs/tremor-runtime/pull/1217#event-5306211254)

 [![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
deleted the
remove\_in\_place

branch
[September 15, 2021 14:01](#event-5306211415)

[![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=80&v=4)](/mfelsche)

Copy link

Member

Author

### **[mfelsche](/mfelsche)** commented [Sep 15, 2021](#issuecomment-920047550) • edited Loading

| For performance we see a slight increase for patch and merge with the optimization removed, which is honestly surprising. |
| --- |

All reactions

Sorry, something went wrong.

[![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=40&v=4)](/mfelsche)
[mfelsche](/mfelsche)
mentioned this pull request
[Sep 16, 2021](#ref-pullrequest-998085835)

[Backport Removal of in\_place optimizations for 0.11
#1218](/tremor-rs/tremor-runtime/pull/1218)
 Merged

6 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftremor-rs%2Ftremor-runtime%2Fpull%2F1217)

Reviewers

[![@darach](https://avatars.githubusercontent.com/u/229042?s=40&v=4)](/darach) [darach](/darach)

darach approved these changes

[![@Licenser](https://avatars.githubusercontent.com/u/119093?s=40&v=4)](/Licenser) [Licenser](/Licenser)

Licenser approved these changes

[![@anupdhml](https://avatars.githubusercontent.com/u/761072?s=40&v=4)](/anupdhml) [anupdhml](/anupdhml)

 Awaiting requested review from anupdhml

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [transmute in \_in\_place functions](https://github.com/tremor-rs/tremor-runtime/issues/1032)

4 participants

[![@mfelsche](https://avatars.githubusercontent.com/u/1152667?s=52&v=4)](/mfelsche) [![@coveralls](https://avatars.githubusercontent.com/u/2354108?s=52&v=4)](/coveralls) [![@Licenser](https://avatars.githubusercontent.com/u/119093?s=52&v=4)](/Licenser) [![@darach](https://avatars.githubusercontent.com/u/229042?s=52&v=4)](/darach)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


