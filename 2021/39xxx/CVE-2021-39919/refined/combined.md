=== Content from gitlab.com_9ca7d6f5_20250114_184851.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39919.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39919.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39919.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39919.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Dec 13, 2021

  [0807c159](/gitlab-org/cves/-/commit/0807c159503df4a117e3497582c1dbbee789947d)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/0807c159503df4a117e3497582c1dbbee789947d)
  ·
  0807c159

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Dec 13, 2021

  0807c159

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/0807c159503df4a117e3497582c1dbbee789947d)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Dec 13, 2021

Loading



=== Content from gitlab.com_44177a9b_20250114_184852.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Stop exposing reset password token and new user email token in logs

### Summary

The reset password email link token and the new user email link token are exposed in logs.

In `gitlab-ctl tail` on my test Omnibus instance on GitLab 14.4-pre:

```
==> /var/log/gitlab/gitlab-rails/production.log <==
[ActiveJob] Enqueued ActionMailer::MailDeliveryJob (Job ID: 606abb60-97f2-480f-8c59-4a9a240d3b94) to Sidekiq(mailers) with arguments: "Notify", "new_user_email", "deliver_now", {:args=>[2, "17uGGXB4g2DNrzqwf_To"]}
```

In Kibana for GitLab.com <https://log.gprd.gitlab.net/goto/0a869b9d34de16f82b4e37106a213d01> (I changed the values):

```
[ActiveJob] Enqueued ActionMailer::MailDeliveryJob (Job ID: 3c179dfe-4646-4dab-b34d-2000e14e15fe) to Sidekiq(mailers) with arguments: "DeviseMailer", "reset_password_instructions", "deliver_now", {:args=>[#<GlobalID:0x00007f7d73399df7 @uri=#<URI::GID gid://gitlab/User/1234567>>, "mtofpQMP_ghqeyXZWF-r", {}]}
```

### Steps to reproduce

Use reset password flow or create a new user in the Admin UI, then search the logs for `reset_password_instructions` or `new_user_email`.

### What is the current *bug* behavior?

The tokens are exposed in the logs.

### What is the expected *correct* behavior?

The tokens should not be output to logs.

### Possible fixes

Suppress these `ActiveJob` messages entirely, since they are redundant with Sidekiq logging.

### References

<https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/development/sidekiq_style_guide.md#arguments-logging>

Edited Oct 05, 2021 by [Michael Kozono](/mkozono)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


