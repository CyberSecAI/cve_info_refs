=== Content from gitlab.com_9784cd31_20250115_093154.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39877.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39877.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39877.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39877.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Oct 01, 2021

  [d12057e6](/gitlab-org/cves/-/commit/d12057e6c316eb483b2b8cf313cd1856cb1737df)
  [Publishing 0 updated advisories and 4 new advisories](/gitlab-org/cves/-/commit/d12057e6c316eb483b2b8cf313cd1856cb1737df)
  繚
  d12057e6

  [ GitLab Bot ](/gitlab-bot) authored Oct 01, 2021

  d12057e6

  [Publishing 0 updated advisories and 4 new advisories](/gitlab-org/cves/-/commit/d12057e6c316eb483b2b8cf313cd1856cb1737df)
  [ GitLab Bot ](/gitlab-bot) authored Oct 01, 2021

Loading



=== Content from gitlab.com_80429798_20250115_093155.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Denial-of-service attack in Markdown parser

**[HackerOne report #1077021](https://hackerone.com/reports/1077021)** by `phli` on 2021-01-12, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

> NOTE! Thanks for submitting a report! Please replace *all* the (parenthesized) sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to triage and respond quickly, so be sure to take your time filling out the report!

##### Summary

I really appreciate the help fom GitLab security group in verifying the existence of the bug.

An attacker prepares the attack by uploading a special Markdown file to a repository in a deployed GitLab server or GitLab.com. When any user tries to view the Markdown file in the browser, the **server-side** can consume 100% CPU usage for more than half a minute in the particular CPU core that handles the job. When multiple such Markdown file views happen simultaneously, all CPU cores can be occupied, which finally leads to DoS.

##### Steps to reproduce

1. Known vulnerable attack surfaces. 1) Self-deployed GitLab server instance, version 13.7.3 (on Linux Debian 9); and 2) GitLab.com. Probably there exist many other vulnerable cases I haven't tested.

   2 The attacker is privileged to edit a repository that belongs to the victim server. The attacker uploads special Markdown files. Multiple users (can also be attackers) try to visit and view the page at the same time, CPU cores can be all occupied. No user authentication is needed if the repository is set as publicly accessible.

###### To reproduce

1. A special Markdown file is uploaded to the victim GitLab server. For example, the `600000.md` in <https://gitlab.com/ppnuts/PoC>
2. A user tries to view the Markdown file by clicking on the file name. The user is then directed to <https://gitlab.com/ppnuts/PoC/-/blob/master/600000.md>
3. The user shall observe a loading shape on the screen without actually get the rendered content. Check screenshot below.

   [![loading.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/72a77451e768bce5979cf7ca2a4954d1b342cef1/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f32326334613136392d356237342d343539632d393237652d3535316234616231376339612f6c6f6164696e672e706e67).

   However, at this moment, the CPU on the server-side is 100% consumed. For example, when I do a `top` on the server-side, I can observe the process takes 100% CPU usage. Check screenshot below.

   [![top.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/07f636410447cb1bac5f0f303d6ca4c5c95cd2bb/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38663662633261312d643632612d346330642d616139322d3866373631303038393032322f746f702e706e67)
4. If multiple users view the Markdown file simultaneously, all CPU cores can be occupied. Or simply just several browser instances.
5. After a long time, the client-side might show *Error loading viewer*. Check screenshot below.

   [![error.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/032c130b729d9f4a3125b48d092f1db218b35362/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f66343739383061352d343138382d346436342d396538332d3264626532623562323465652f6572726f722e706e67).

   And the server-side CPU is then released.

##### Impact

If all CPU cores are occupied, other resources become unavailable.

##### Examples

Please check <https://gitlab.com/ppnuts/PoC>.

##### What is the current *bug* behavior?

Client-side cannot load/render the Markdown file on time; Server-side CPU is over-consumed. The whole services can be down if all CPU cores are occupied.

##### What is the expected *correct* behavior?

The Markdown file shall be rendered correctly on time.

##### Relevant logs and/or screenshots

See above.

##### Output of checks

This bug happens on GitLab.com

###### Results of GitLab environment info

Installed using `apt-get`. Host environment:

```
$uname -a
Linux labpc 4.9.0-11-amd64 #1 SMP Debian 4.9.189-3+deb9u2 (2019-11-11) x86_64 GNU/Linux
```

```
System information
System:		Debian 9.13
Current User:	git
Using RVM:	no
Ruby Version:	2.7.2p137
Gem Version:	3.1.4
Bundler Version:2.1.4
Rake Version:	13.0.1
Redis Version:	5.0.9
Git Version:	2.29.0
Sidekiq Version:5.2.9
Go Version:	unknown

GitLab information
Version:	13.7.3
Revision:	1ef3b81f122
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	12.4
URL:		http://137.189.89.174
HTTP Clone URL:	http://137.189.89.174/some-group/some-project.git
SSH Clone URL:	git@137.189.89.174:some-group/some-project.git
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers:

GitLab Shell
Version:	13.14.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git
```

#### Impact

Turn down the GitLab server, and make all services unavailable, i.e., DoS.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [top.png](https://h1.sec.gitlab.net/a/8f6bc2a1-d62a-4c0d-aa92-8f7610089022/top.png)
* [loading.png](https://h1.sec.gitlab.net/a/22c4a169-5b74-459c-927e-551b4ab17c9a/loading.png)
* [error.png](https://h1.sec.gitlab.net/a/f47980a5-4188-4d64-9e83-2dbe2b5b24ee/error.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Aug 25, 2021 by [Nick Thomas](/nick.thomas)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


