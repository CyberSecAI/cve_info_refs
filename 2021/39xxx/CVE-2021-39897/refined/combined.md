=== Content from gitlab.com_d3020db6_20250114_224025.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Invited group members, with access inherited from parent group, continue to have project access even after invited subgroup is transfered

**[HackerOne report #1330806](https://hackerone.com/reports/1330806)** by `joaxcar` on 2021-09-05, assigned to GitLab Team:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

I have found an issue similar to the one fixed in patch 14.2.2 [link](https://about.gitlab.com/releases/2021/08/31/security-release-gitlab-14-2-2-released/#invited-group-members-continue-to-have-project-access-even-after-invited-group-is-deleted) where users had access to a shared project even after the invited group was deleted.

The problem is caused by the group inheritance, when a user shares a project with a subgroup the users from any parent groups are given access to the project as well (which is the documented behavior, see image). The problem is that if the subgroup is later transferred to another parent group, the users in the new parent group will get access to the shared project, but the users from the old parent group does not get their access revoked.

[REDACTED]

Further, if the subgroup which was the target of the shared project is subsequently deleted, only users with access stemming from the current parent groups are revoked. This leaves the project in a state with no apparent invited groups or other members, but with "ghost" members with anything from `Guest` to `Maintainer` access depending on the initial invitation.

A "worst care scenario" is that a user shares a project with a group with `maximum access level` at `maintainer`, because the user trust the maintainers. This group is later added as a subgroup to another group temporarily for some reason, and then again transferred to its own hierarchy. Any maintainers or owners of this temporary parent group will now have hidden `maintainer` access to the project, even if the invited group is deleted.

This hidden access seems to be persistent until the project owner starts editing project access again, inviting a new group will "kick out" all hidden members as it seems.

##### Steps to reproduce

One basic scenario to prove the vulnerability, having three users in a group and moving the subgroup with the shared project out from the parent group.

1. Create three users `project_owner`, `group_owner` and `hidden_maintainer`
2. Log in as `group_owner` and create two groups `target_group` and `temporary_parent`
3. In `target_group` create a subgroup `subgroup01`
4. Invite `project_owner` as a `Developer` of `target_group`
5. Invite `hidden_maintainer` as a `Maintainer` of `target_group`
6. Log in as `project_owner` and create a **private** project `project01` in the user namespace, <https://domain.gitlab.com/projects/new#blank_project>
7. Go to <https://domain.gitlab.com/project_owner/project01/-/project_members> and click "invite group". Search for and select `target_group / subgroup` and "max-role" `Maintainer`. Click "Invite".

[REDACTED]

8. Log in as `group_owner` and go to <https://domain.gitlab.com/groups/target_group/subgroup01/-/edit> and expand the "Advanced" tab at the bottom.
9. Scroll to the option "Transfer group" and select `temporary_parent` and click "transfer group".

[REDACTED]

10. When the group is now part of `temporary_parent` go to <https://domain.gitlab.com/groups/target_group/subgroup01/-/edit> again and expand the "Advanced" tab. Now scroll to the bottom and click and accept "Remove group"
11. As `group_owner` go to <https://domain.gitlab.com/project_owner/project01> and verify that you get an 404 not found error (this user is no member any more)
12. Log in as `hidden_maintainer` and go to the same <https://domain.gitlab.com/project_owner/project01> and verify that this user have access
13. Go to <https://domain.gitlab.com/project_owner/project01/-/project_members> and verify that the list only include `project_owner`

Another scenario would be to have the `hidden_maintainer` as a member of `temporary_parent` and transfer the `subgroup01` to `temporary_parent` and then directly back to `target_group`. This would "touch" the `hidden_maintainer` and give it access to the group. In these examples the invited group is a subgroup from start, this is not necessary. It could as well be a regular group that is then transferred to a parent group and then moved back out again.

##### Example

User [REDACTED] having access to the private project owned by [REDACTED]

[REDACTED]
[REDACTED]

##### Impact

Users can get hidden unauthorized access to a project that is shared with a group where the users access is inherited. In the worst care scenario a user could acquire hidden **maintainer** access to a **private** project! The user will have full access to the project as a maintainer including settings and repository.

##### What is the current *bug* behavior?

When a group containing shared access to a project is transferred out from a parent group, the users of the parent group will retain their access to the shared project.

##### What is the expected *correct* behavior?

When a group containing shared access to a project is transferred from a parent group users in the parent group should lose access to the project.

##### Relevant logs and/or screenshots

##### Output of checks

This bug happens on GitLab.com

#### Impact

Users can get hidden unauthorized access to a project that is shared with a group where the users access is inherited. In the worst care scenario a user could acquire hidden **maintainer** access to a **private** project! The user will have full access to the project as a maintainer including settings and repository.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [max.png](https://h1.sec.gitlab.net/a/9cfd09c5-f7b3-45db-bfbc-22a5e28b6054/max.png)
* [transfer.png](https://h1.sec.gitlab.net/a/a1ae03a5-93b9-4de9-8a9e-aae52dbe0a89/transfer.png)
* [inviterule.png](https://h1.sec.gitlab.net/a/90194bdc-6b13-48aa-a358-1e1fc2ebdfca/inviterule.png)
* [private.png](https://h1.sec.gitlab.net/a/c85b47b5-b384-475e-bfb5-f5427973e221/private.png)
* [hiddenaccess.png](https://h1.sec.gitlab.net/a/f01094e5-6dc5-4d98-bb55-4b6f11af4ac2/hiddenaccess.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Dec 01, 2021 by [Nikhil George](/ngeorge1)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_ab16b078_20250114_224022.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39897.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39897.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39897.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39897.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Nov 04, 2021

  [b8a6ff01](/gitlab-org/cves/-/commit/b8a6ff01dc97d412e4b17cb7a6ef7c8f5ed8e58e)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b8a6ff01dc97d412e4b17cb7a6ef7c8f5ed8e58e)
  ·
  b8a6ff01

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

  b8a6ff01

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b8a6ff01dc97d412e4b17cb7a6ef7c8f5ed8e58e)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 04, 2021

Loading


