=== Content from gitlab.com_07f36ce9_20250114_182400.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39878.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39878.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39878.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39878.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Oct 01, 2021

  [70657ae8](/gitlab-org/cves/-/commit/70657ae821efd28df59dda8282cae96c772522e5)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/70657ae821efd28df59dda8282cae96c772522e5)
  繚
  70657ae8

  [ GitLab Bot ](/gitlab-bot) authored Oct 01, 2021

  70657ae8

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/70657ae821efd28df59dda8282cae96c772522e5)
  [ GitLab Bot ](/gitlab-bot) authored Oct 01, 2021

Loading



=== Content from gitlab.com_bca84684_20250114_182401.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# XSS by clicking Jira's link

**[HackerOne report #1194254](https://hackerone.com/reports/1194254)** by `ooooooo_q` on 2021-05-12, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Since the value of `/-/jira_connect/users?return_to=xxx` of `xxx` is used as a link as it is, it becomes XSS in some browsers.

##### Steps to reproduce

1. Prepare a gitlab environment with no CSP configured (e.g. `localhost`)
2. Logged in with safari browser
3. Go to the `https://localhost/-/jira_connect/users?return_to=javascript:alert(location)` URL
4. click `Return to GitLab for Jira` button

##### Impact

XSS

##### Examples

Affects logged-in users regardless of project.

##### What is the current *bug* behavior?

<https://gitlab.com/gitlab-org/gitlab/-/blob/v13.11.3-ee/app/controllers/jira_connect/users_controller.rb>

```
class JiraConnect::UsersController < ApplicationController
  feature_category :integrations

  layout 'signup_onboarding'

  def show
    [@]jira_app_link = params.delete(:return_to)
  end
end
```

<https://gitlab.com/gitlab-org/gitlab/-/blob/v13.11.3-ee/app/views/jira_connect/users/show.html.haml>

```
  - if [@]jira_app_link
    %p= external_link s_('Integrations|Return to GitLab for Jira'), [@]jira_app_link, class: 'gl-button btn btn-confirm'
```

<https://gitlab.com/gitlab-org/gitlab/-/blob/v13.11.3-ee/app/helpers/external_link_helper.rb>

```
module ExternalLinkHelper
  def external_link(body, url, options = {})
    link_to url, { target: '_blank', rel: 'noopener noreferrer' }.merge(options) do
      "#{body}#{sprite_icon('external-link', css_class: 'gl-ml-1')}".html_safe
    end
  end
end
```

`external_link` has not verified the validity of the url.

##### What is the expected *correct* behavior?

If it is a link other than http and https, it will not work.

##### Relevant logs and/or screenshots

[![jira_safari_xss.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/af590c33da8e7639f9f8186e64214724957c317f/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f35363236383565652d303362652d346534342d393663312d6666636666643637303164352f6a6972615f7361666172695f7873732e706e67)

##### Output of checks

Blocked by CSP at GitLab.com

###### Results of GitLab environment info

```
###  gitlab-rake gitlab:env:info

System information
System:
Current User:	git
Using RVM:	no
Ruby Version:	2.7.2p137
Gem Version:	3.1.4
Bundler Version:2.1.4
Rake Version:	13.0.3
Redis Version:	6.0.12
Git Version:	2.31.1
Sidekiq Version:5.2.9
Go Version:	unknown

GitLab information
Version:	13.11.3
Revision:	b321336e443
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	12.6
URL:		https://gitlab.example.com
HTTP Clone URL:	https://gitlab.example.com/some-group/some-project.git
SSH Clone URL:	git@gitlab.example.com:some-group/some-project.git
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers:

GitLab Shell
Version:	13.17.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git
```

#### Impact

It becomes XSS when the user is directed to the user who is logged in with the Safari browser to the instance where CSP is not set.

Chrome and Firefox showed other tabs and javascript was not executed.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [jira\_safari\_xss.png](https://h1.sec.gitlab.net/a/562685ee-03be-4e44-96c1-ffcffd6701d5/jira_safari_xss.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


