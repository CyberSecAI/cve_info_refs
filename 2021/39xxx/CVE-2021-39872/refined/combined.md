=== Content from gitlab.com_022ff757_20250114_193238.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Users with expired password can still access API and Git with token

**[HackerOne report #1285226](https://hackerone.com/reports/1285226)** by `joaxcar` on 2021-07-30, assigned to GitLab Team:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Users with an "expired password" can still access the full API with tokens. This includes the REST API, GraphQL API and Git HTTP access. The same issue was mitigated in [13.12.2](https://about.gitlab.com/releases/2021/06/01/security-release-gitlab-13-12-2-released/#insufficient-expired-password-validation) as "Insufficient Expired Password Validation". That patch blocked users with expired passwords from accessing the REST API. My report [1192460](https://hackerone.com/reports/1192460) led to a patch [14.0.2](https://about.gitlab.com/releases/2021/07/01/security-release-gitlab-14-0-2-released/#a-deactivated-user-can-access-data-through-graphql) that also blocked access through GraphQL.

It seems that these patches caused some problem for users accessing GitLab instances using LDAP. And a [merge request](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/63466 "Fix Password expired error on git fetch via SSH for LDAP user") trying to address this problem got merged in one of the latests releases. Unfortenetly this new "fix for LDAP" also seems to have opened up access for regular user accounts with expired passwords again.

**Images showing access through REST, GraphQL and Git with a account with expired password:**

REDACTED

##### Steps to reproduce

(tested on 14.1.0 self-hosted)

1. Create a user user01, and log in
2. Create a new project at <https://gitlab.domain.com/projects/new#blank_project> make sure to put it as `private`. Take a note of the ID of the project
3. Go to <https://gitlab.domain.com/-/profile/personal_access_tokens> and create a personal access token
4. Log in as an administrator
5. Go to the admin page for editing the user <https://gitlab.domain.com/admin/users/user01/edit> and change the users password. This triggers `password expired at` to be set to the current time. Effectively putting the user01 in the state of "expired password""
6. Trying to log in as user01 with old password will now fail, using the new password will trigger "enter a new password" page. **Do not enter a new password here as this will put the user in a unexpired state again**

REDACTED

7. Now instead try to use the user01 token from step 2 in a REST request such as

```
curl --request GET \
  --url https://gitlab.domain.com/api/v4/projects/:ID \
  --header 'Authorization: Bearer <TOKEN>' \
```

This should show the `private` project that should not be accessible.

##### Impact

A user that should not have access to the instance as the password has expired can still access the API and Git with tokens.

##### What is the current *bug* behavior?

Requests to the API and Git is not blocked for users with expired password

##### What is the expected *correct* behavior?

Requests to the API and Git by users with expired password should be blocked and presented with a message like `403 Forbidden - Your password expired. Please access GitLab from a web browser to update your password.` as before.

#### Impact

Users with expired passwords can still access the full API and Git using tokens

## Attachments

REDACTED

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jan 25, 2022 by [Rohit Shambhuni](/rshambhuni)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_08798a3a_20250114_193236.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-39872.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-39872.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-39872.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-39872.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Oct 01, 2021

  [508f87ac](/gitlab-org/cves/-/commit/508f87acb4c9db7d798a2ee8127df7f0ff254195)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/508f87acb4c9db7d798a2ee8127df7f0ff254195)
  ·
  508f87ac

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 01, 2021

  508f87ac

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/508f87acb4c9db7d798a2ee8127df7f0ff254195)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 01, 2021

Loading


