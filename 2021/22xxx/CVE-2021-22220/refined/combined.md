=== Content from gitlab.com_405135ed_20250114_225229.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# XSS on the blob viewer of notebooks

**[HackerOne report #1060114](https://hackerone.com/reports/1060114)** by `yvvdwf` on 2020-12-16, assigned to [@ankelly](/ankelly "Andrew Kelly"):

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

Gitlab recently [uses](https://gitlab.com/gitlab-org/gitlab/-/blob/899cc9b0a475fd247b3d9003f855df3876e853f1/app/assets/javascripts/notebook/cells/output/html.vue#L29) `Dompurify` to sanitize data. Dompurify allows `data-*` attributes by default. When using `data-*` attributes with the presence of `rails-ujs`, attackers might trick victims to execute any javascript.

The following attack scenario triggers an alert when you click anywhere on the blob viewer screen of notebooks. Since gitlab allows sending API requests via Javascript in Web browsers, attackers may perform arbitrary actions on behalf of victims, such as, escalate permissions, access to private objects, etc.

##### Steps to reproduce

1. In a project, create a file `xss.ipynb` with the following content (**note** edited with a known safe payload):

```
{
 &#34;cells&#34;: [
  {
   &#34;cell_type&#34;: &#34;markdown&#34;,
   &#34;source&#34;: [
        &#34;&lt;a data-type=script data-remote=true href=&#39;https://gitlab.com/ankelly/pipeline_payload/-/jobs/[REDACTED]/artifacts/raw/data/alert.js&#39; style=&#39;position:fixed;z-index:9999;top:0;left:0;right:0;bottom:0&#39;&gt;&lt;/a&gt;CLICK ANYWHERE TO SHOW POPUP&#34;
   ]
  }]
}
```

2. When viewing this file, you might notice that there exists a transparent layer that is on the topmost. This layer intercepts any event clicks. Once you click *anywhere* you should see a popup.

##### Impact

Once victims click anywhere on the screen of notebook viewer, attackers might execute their javascript. Since gitlab allows sending API requests via Javascript in Web browsers, attackers may perform arbitrary actions on behalf of victims, such as, escalate permissions, access to private objects, etc.

##### Examples

<https://gitlab.com/yvvdwf/notebook/-/blob/master/xss.ipynb>

##### What is the current *bug* behavior?

`data-*` attributes are not removed when sanitizing.

##### What is the expected *correct* behavior?

`data-*` attributes should be removed when sanitizing.

##### Output of checks

This bug happens on GitLab.com

#### Impact

Once victims click anywhere on the screen of notebook viewer, attackers might execute their javascript. Since gitlab allows sending API requests via Javascript in Web browsers, attackers may perform arbitrary actions on behalf of victims, such as, escalate permissions, access to private objects, etc.

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jul 07, 2022 by [Costel Maxim](/cmaxim)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_17a284cf_20250114_225228.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22220.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22220.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22220.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22220.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jul 02, 2021

  [3d9fe963](/gitlab-org/cves/-/commit/3d9fe9637672bf49ba337985dea51ff4aa14e4a3)
  [Publishing 3 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3d9fe9637672bf49ba337985dea51ff4aa14e4a3)
  ·
  3d9fe963

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 02, 2021

  3d9fe963

  [Publishing 3 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/3d9fe9637672bf49ba337985dea51ff4aa14e4a3)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 02, 2021

Loading


