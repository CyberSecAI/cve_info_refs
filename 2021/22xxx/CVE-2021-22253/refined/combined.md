=== Content from gitlab.com_a98a1d3c_20250114_230328.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Unauthorized User Can Trigger Deployment to the Protected Environment

**[HackerOne report #1113783](https://hackerone.com/reports/1113783)** by `vaib25vicky` on 2021-03-01, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Maintainer or owner can define protected environment and users who can access the protected environment.

There are two issues present here

1. User removed from the project still have access to the protected environment
2. User who is removed and no longer part of the project then Maintainer can't remove him from the project settings > environment

Because of this two issues User who is removed and no longer part of the project can still trigger deployment from the project environment page.

##### Steps to reproduce

(Steps for Gitlab.com)

* Create a public group
* Protected environment is a Premium feature so you have to opt for trial. Go to your group > settings > billing and start your free trial

  `https://gitlab.com/groups/<namespace>/-/billings`
* Create a public project inside the group named `test_project`
* As maintainer invites a member to your project `test_project` with developer permission. lets say `user_foo`
* As maintainer creates a `.gitlab-ci.yml` file in your project with below content

```

deploy:
  stage: deploy
  script:
    - echo "Deploy to production serverl"
  environment:
    name: production
    url: https://example.com

```

* As maintainer go to your project settings > CI/CD > Protected Environment and define a protected env such as

  `https://gitlab.com/<namespace>/test_project/-/settings/ci_cd`

Environment - production

Allowed to deploy - maintainer + user\_foo

[![pe1.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/7020ccb92b4cf11f1380517d04eeb4eea395651e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39323735373538332d393735332d343561362d623761322d3235626439633661643461632f7065312e706e67)

* In new incognito window or browser, login to the developer user `user_foo` account and go to the environment page

  `https://gitlab.com/<namespace>/test_project/-/environments`
* Since, `user_foo` is allowed to access protected environment he can edit, stop, re-deploy .

[![pe2.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/3a9bbe91039959bb54808e8ba18afa05d317d893/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f32353531363463352d376565662d346461342d623736632d3638313363333834653366392f7065322e706e67)

* Go back to the maintainer account and removed `user_foo` from project
* `user_foo` refresh the page or go again to `https://gitlab.com/<namespace>/test_project/-/environments`

You will see that other options such as `stop` , `edit` are revoked but not `re-deploy`

[![pe3.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ea4e32dcec248357d774ec569fa7927b1e70236a/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37333863303466302d373034362d343963392d623531652d6232383030643332636361652f7065332e706e67)

**User can not only re-deploy latest but all the previous deployment too**

* As user `user_foo` click on an old deployment and you will see the deployment pipeline will run and new deployment will be deployed

[![pe4.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/e6342578c7df55024ee8d1f07127965dd6707ca7/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61353034633065362d333737612d343933622d393335632d3238633265333262623535322f7065342e706e67)

[![pe5.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d6d4aed4438634dfc85d3255234b0077902c8214/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30343264396432632d383831332d343238632d383437362d3965316165613831343761642f7065352e706e67)

* You can see a new pipeline job `deploy` runs by going over `https://gitlab.com/<namespace>/test_project/-/jobs`

[![pe6.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/bb61f2c5565aad79a77f08165db15eaa83fb88c8/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30633638393065382d396163662d343936342d623862632d6666303431323339313032362f7065362e706e67)

##### Second issue is Maintainer can't removed the member from the protected environment

Continuing the previous scenario

* As maintainer go to the project > settings > CI/CD > protected environment

  `https://gitlab.com/<namespace>/test_project/-/settings/ci_cd`
* Click on `Allowed to deploy` and unselect `user_foo` from the list

[![pe7.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/aef6be87bf7159f3c92ee616b313d8e13761b77b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36663939633764302d303263622d343236652d616431322d3239326637363735613261632f7065372e706e67)

* Refresh the page, and again expand `protected environment`. You will see that user still not removed and there is no way maintainer can removed the user.

##### What is the current *bug* behavior?

It is concluded that even after the user is removed

* He can still have access to the deployment and re-deploy/trigger any deployment he wishes.
* User can not only can re-deploy latest but all the previous deployment too.
* Maintainer is not able to remove the user from the protected environment so user have access to protected environment all the time

##### What is the expected *correct* behavior?

Gitlab should remove the user from protected environment list and revoked all his access too

##### Output of checks

This bug happens on GitLab.com. I've not tested Gitlab instance but I'm confident that same vulnerability exists there too.

#### Impact

Protected Environment is an important feature which allows to restrict access and unexpected deployments to the environment. This vulnerability allows a malicious user who is not even the part of the project to trigger deployment to the protected environment and doing so may break a company or project current deployment and effects its user and data.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [pe1.png](https://h1.sec.gitlab.net/a/92757583-9753-45a6-b7a2-25bd9c6ad4ac/pe1.png)
* [pe2.png](https://h1.sec.gitlab.net/a/255164c5-7eef-4da4-b76c-6813c384e3f9/pe2.png)
* [pe3.png](https://h1.sec.gitlab.net/a/738c04f0-7046-49c9-b51e-b2800d32ccae/pe3.png)
* [pe4.png](https://h1.sec.gitlab.net/a/a504c0e6-377a-493b-935c-28c2e32bb552/pe4.png)
* [pe5.png](https://h1.sec.gitlab.net/a/042d9d2c-8813-428c-8476-9e1aea8147ad/pe5.png)
* [pe6.png](https://h1.sec.gitlab.net/a/0c6890e8-9acf-4964-b8bc-ff0412391026/pe6.png)
* [pe7.png](https://h1.sec.gitlab.net/a/6f99c7d0-02cb-426e-ad12-292f7675a2ac/pe7.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

1. Create a public group
2. Create a public project in that group
3. Create an environment named production
4. Setup a `.gitlab-ci.yml`
5. Invite a second user as `developer`
6. In CI/CD project settings create a protected environment for the `production` environment and allow the invited user to deploy
7. Remove the second user from the project and they'll still be able to redeploy from the `/-/environments` page

Edited Mar 08, 2021 by [Dominic Couture](/dcouture)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_7bed4754_20250114_230327.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22253.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22253.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22253.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22253.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Aug 23, 2021

  [d6616a4d](/gitlab-org/cves/-/commit/d6616a4df4034d1afbcab2440f7d8d655fb175f1)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/d6616a4df4034d1afbcab2440f7d8d655fb175f1)
  ·
  d6616a4d

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 23, 2021

  d6616a4d

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/d6616a4df4034d1afbcab2440f7d8d655fb175f1)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 23, 2021

Loading


