=== Content from openwrt.org_3ff31ce2_20250114_221151.html ===


[![OpenWrt Wiki](/_media/logo.png)OpenWrt Wiki](/start "OpenWrt Wiki")

* Tools
  + User Tools
  + [Log In](/advisory/2021-02-02-1?do=login&sectok= "Log In")
  + Site Tools
  + [Recent Changes](/advisory/2021-02-02-1?do=recent "Recent Changes [r]")
  + [Media Manager](/advisory/2021-02-02-1?do=media&ns=advisory "Media Manager")
  + [Sitemap](/advisory/2021-02-02-1?do=index "Sitemap [x]")
  + Page Tools
  + [Show pagesource](/advisory/2021-02-02-1?do=edit "Show pagesource [v]")
  + [Old revisions](/advisory/2021-02-02-1?do=revisions "Old revisions [o]")
  + [Backlinks](/advisory/2021-02-02-1?do=backlink "Backlinks")
  + [Back to top](#dokuwiki__top "Back to top [t]")

* Translations of this page
  + Translations of this page [?](/meta/translation "meta:translation")
  + [English (en)](/advisory/2021-02-02-1 "English")
  + [|العربية (ar)](/ar/advisory/2021-02-02-1 "|العربية")
  + [Česky (cs)](/cs/advisory/2021-02-02-1 "Česky")
  + [Deutsch (de)](/de/advisory/2021-02-02-1 "Deutsch")
  + [Español (es)](/es/advisory/2021-02-02-1 "Español")
  + [Français (fr)](/fr/advisory/2021-02-02-1 "Français")
  + [Magyar (hu)](/hu/advisory/2021-02-02-1 "Magyar")
  + [Italiano (it)](/it/advisory/2021-02-02-1 "Italiano")
  + [日本語 (ja)](/ja/advisory/2021-02-02-1 "日本語")
  + [한국어 (ko)](/ko/advisory/2021-02-02-1 "한국어")
  + [Polski (pl)](/pl/advisory/2021-02-02-1 "Polski")
  + [Português (pt)](/pt/advisory/2021-02-02-1 "Português")
  + [Português (pt-br)](/pt-br/advisory/2021-02-02-1 "Português")
  + [Русский (ru)](/ru/advisory/2021-02-02-1 "Русский")
  + [Türkçe (tr)](/tr/advisory/2021-02-02-1 "Türkçe")
  + [Українська (uk)](/uk/advisory/2021-02-02-1 "Українська")
  + [Tiếng Việt (vi)](/vi/advisory/2021-02-02-1 "Tiếng Việt")
  + [中文 (zh)](/zh/advisory/2021-02-02-1 "中文")
  + [繁體中文 (zh-tw)](/zh-tw/advisory/2021-02-02-1 "繁體中文")

* [Log In](/advisory/2021-02-02-1?do=login&sectok= "Log In")

---

1. You are here
2. [Home](/start "start")
3. [OpenWrt Security Advisories](/advisory/start "advisory:start")
4. [Security Advisory 2021-02-02-1 - netifd and odhcp6c routing loop on IPv6 point to point links (CVE-2021-22161)](/advisory/2021-02-02-1 "advisory:2021-02-02-1")

---

 Learn about OpenWrt
#### Learn about OpenWrt

* [Supported devices](/supported_devices "supported_devices")
* [Packages](/packages/start "packages:start")
* [Downloads](/downloads "downloads")
* [Documentation](/docs/start "docs:start")
  + [Quick start guide](/docs/guide-quick-start/start "docs:guide-quick-start:start")
  + [User guide](/docs/guide-user/start "docs:guide-user:start")
  + [Developer guide](/docs/guide-developer/start "docs:guide-developer:start")
* [Security](/docs/guide-developer/security "docs:guide-developer:security")
* [FAQ](/faq "faq")
* [Forum](https://forum.openwrt.org/ "https://forum.openwrt.org/")
#### Contributing

* [Submitting patches](/submitting-patches "submitting-patches")
* [Reporting bugs](/bugs "bugs")
* [Contributing to wiki](/wiki/wikirules "wiki:wikirules")
#### Project

* [About OpenWrt](/about "about")
* [Rules](/rules "rules")
* [Infrastructure](/infrastructure "infrastructure")
* [Donate](/donate "donate")
* [Merchandise](/merchandise "merchandise")
* [Website](/wiki/start "wiki:start")
* [Trademark policy](/trademark "trademark")
* [License](/license "license")
* [Contacts](/contact "contact")

* [Show pagesource](/advisory/2021-02-02-1?do=edit "Show pagesource [v]")
* [Old revisions](/advisory/2021-02-02-1?do=revisions "Old revisions [o]")
* [Backlinks](/advisory/2021-02-02-1?do=backlink "Backlinks")
* [Back to top](#dokuwiki__top "Back to top [t]")

×
####

###### Table of Contents

* [Security Advisory 2021-02-02-1 - netifd and odhcp6c routing loop on IPv6 point to point links (CVE-2021-22161)](#security_advisory_2021-02-02-1_-_netifd_and_odhcp6c_routing_loop_on_ipv6_point_to_point_links_cve-2021-22161)
  + [DESCRIPTION](#description)
  + [REQUIREMENTS](#requirements)
  + [MITIGATIONS](#mitigations)
  + [AFFECTED VERSIONS](#affected_versions)
  + [CREDITS](#credits)
  + [REFERENCES](#references)
    - [Development snapshot](#development_snapshot)
    - [OpenWrt 19.07 release](#openwrt_1907_release)

# Security Advisory 2021-02-02-1 - netifd and odhcp6c routing loop on IPv6 point to point links (CVE-2021-22161)

## DESCRIPTION

In case a link prefix route points to a point-to-point link it can trigger a routing loop if the destination IPv6 address belongs to the prefix and is not a local IPv6 address. If such a packet is received and not directed to a local IPv6 address it will be routed back to the point-to-point link due to the link prefix route; the upstream ISP router will in its turn route the IPv6 packet back due to the assigned prefix route creating a “ping pong” effect.

The possible routing loop on point-to-point links (e.g PPP) can happen when router advertisements are received having at least one global unique IPv6 prefix for which the on-link flag is set. The WAN interface is assigned the global unique prefix (e.g. 2001:db8:1:0::/64) from which an IPv6 address is picked which will be installed on the wan interface (e.g. 2001:db8:1:0:5054:ff:feab:d87c/64).

As the on-link flag is set the prefix route 2001:db8:1::/64 will be present in the routing table which will route any packet with as destination 2001:db8:1::/64 to the WAN interface and will be routed back by the upstream router due to the WAN interface having been assigned the global unique prefix.
Besides not installing the prefix route 2001:db8:1::/64 on point-to-point links adding an unreachable route is required to avoid the routing loop.

## REQUIREMENTS

The WAN interface needs to be a point-to-point interface (e.g. PPP) and IPv6 router advertisement messages need to be received which contain at least one global unique IPv6 prefix for which the on-link flag is set.

## MITIGATIONS

You need to update the affected netifd and odhcp6c packages you're using with the command below.

```
 opkg update; opkg upgrade netifd; sleep 5; opkg upgrade odhcp6c
```

Then verify, that you're running fixed version.

```
 opkg list-installed netifd
 opkg list-installed odhcp6c
```

The above command should output following:

```
 netifd - 2021-01-09-753c351b-1 - for stable OpenWrt 19.07 release
 netifd - 2021-01-09-c00c8335-1 - for master/snapshot

 odhcp6c - 2021-01-09-64e1b4e7-16 - for stable OpenWrt 19.07 release
 odhcp6c - 2021-01-09-53f07e90-16 - for master/snapshot
```

The fix is contained in the following and later versions:

* OpenWrt 19.07: 2021-01-17 (fixed by [v19.07.6-4-g250dbb3a60f3](https://git.openwrt.org/250dbb3a60f334adc31587a3f6f75f2168df7cac "https://git.openwrt.org/250dbb3a60f334adc31587a3f6f75f2168df7cac") and [v19.07.6-5-g9999c87d3a3c](https://git.openwrt.org/9999c87d3a3cf93344be99d314bdd63e2ca782f1 "https://git.openwrt.org/9999c87d3a3cf93344be99d314bdd63e2ca782f1"))
* OpenWrt master: 2021-01-09 (fixed by [reboot-15532-ge857b097678d](https://git.openwrt.org/e857b097678d660c1121cd7ab8e753bb864970ab "https://git.openwrt.org/e857b097678d660c1121cd7ab8e753bb864970ab") and [reboot-15531-g430154135106](https://git.openwrt.org/430154135106cbea6816a379774fd250a72a7063 "https://git.openwrt.org/430154135106cbea6816a379774fd250a72a7063"))
## AFFECTED VERSIONS

To our knowledge, OpenWrt version 19.07.0 to 19.07.6 are affected. The fixed
packages will be integrated in the upcoming OpenWrt 19.07.7 release. Older
versions of OpenWrt (e.g. OpenWrt 18.06, OpenWrt 15.05 and LEDE 17.01) are end
of life and not supported any more.

## CREDITS

This issue was identified by Xiang Li from [Network and Information Security](https://netsec.ccert.edu.cn/ "https://netsec.ccert.edu.cn/") Lab at Tsinghua University and fixed by Hans Dedecker.

## REFERENCES

### Development snapshot

* netifd [e857b097678d660c1121cd7ab8e753bb864970ab](https://git.openwrt.org/e857b097678d660c1121cd7ab8e753bb864970ab "https://git.openwrt.org/e857b097678d660c1121cd7ab8e753bb864970ab")
* odhcp6c [430154135106cbea6816a379774fd250a72a7063](https://git.openwrt.org/430154135106cbea6816a379774fd250a72a7063 "https://git.openwrt.org/430154135106cbea6816a379774fd250a72a7063")
### OpenWrt 19.07 release

* netifd [9999c87d3a3cf93344be99d314bdd63e2ca782f1](https://git.openwrt.org/9999c87d3a3cf93344be99d314bdd63e2ca782f1 "https://git.openwrt.org/9999c87d3a3cf93344be99d314bdd63e2ca782f1")
* odhcp6c [250dbb3a60f334adc31587a3f6f75f2168df7cac](https://git.openwrt.org/250dbb3a60f334adc31587a3f6f75f2168df7cac "https://git.openwrt.org/250dbb3a60f334adc31587a3f6f75f2168df7cac")

This website uses cookies. By using the website, you agree with storing cookies on your computer. Also you acknowledge that you have read and understand our Privacy Policy. If you do not agree leave the website.OK[More information about cookies](https://en.wikipedia.org/wiki/HTTP_cookie)

* Last modified: 2021/02/08 07:00
* by ynezz

**Self-registration in the wiki has been disabled.

If you want to contribute to the OpenWrt wiki, please post [HERE](https://forum.openwrt.org/t/applying-for-openwrt-wiki-account/101671 "https://forum.openwrt.org/t/applying-for-openwrt-wiki-account/101671") in the forum or ask on IRC for access.**

---

[![cc](/lib/tpl/bootstrap3/images/license/cc.png) ![by](/lib/tpl/bootstrap3/images/license/by.png) ![sa](/lib/tpl/bootstrap3/images/license/sa.png)](https://creativecommons.org/licenses/by-sa/4.0/deed.en "CC Attribution-Share Alike 4.0 International")

Except where otherwise noted, content on this wiki is licensed under the following license:
[CC Attribution-Share Alike 4.0 International](https://creativecommons.org/licenses/by-sa/4.0/deed.en "CC Attribution-Share Alike 4.0 International")

![](/lib/exe/taskrunner.php?id=advisory%3A2021-02-02-1&1736892710)


