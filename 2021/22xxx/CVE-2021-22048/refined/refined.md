Here's the breakdown of the provided content related to CVE-2021-22048:

**Summary:**

CVE-2021-22048 is a privilege escalation vulnerability affecting VMware vCenter Server due to a flaw in the Integrated Windows Authentication (IWA) mechanism. An attacker with non-administrative access could exploit this to gain higher privileges. The vulnerability is addressed in various vCenter Server updates.

**Root cause of vulnerability:**

- The vulnerability lies within the Integrated Windows Authentication (IWA) mechanism in vCenter Server. Specifically, memory corruption within the Secure Token Service (vmware-stsd) was identified when IWA was used with an Active Directory joined VCSA.

**Weaknesses/vulnerabilities present:**

- Privilege escalation vulnerability exists in vCenter Server's IWA authentication mechanism.
- Memory corruption issues in the Secure Token Service (vmware-stsd), specifically when using Integrated Windows Authentication (IWA) in combination with an Active Directory domain. This memory corruption could lead to service crashes and core dumps.

**Impact of exploitation:**

- A malicious actor with non-administrative access to vCenter Server can elevate their privileges to a higher privileged group.
- The memory corruption can lead to the vmware-stsd service crashing, resulting in the inability to start the Secure Token Service (sts).
- Service crashes can prevent patching and upgrading of vCenter Server.

**Attack vectors:**

- An attacker with non-administrative access to vCenter Server.
- The vulnerability is triggered through the IWA authentication mechanism.
- The vulnerability is exposed on the network (adjacent network according to the CVSS vector).

**Required attacker capabilities/position:**

- The attacker must have non-administrative access to vCenter Server.
- Network access to the vCenter Server is required, but the attacker does not need to be directly on the same network (adjacent network is indicated in CVSS vector).

**Additional details from the content:**

*   **Workarounds:**  The primary workaround is to switch from Integrated Windows Authentication (IWA) to either:
    *   AD over LDAPS authentication.
    *   Identity Provider Federation for AD FS (vSphere 7.0 or later).
*   **Affected Products:** VMware vCenter Server and VMware Cloud Foundation are affected.
*   **Patches:** The vulnerability is addressed in specific updates of vCenter Server:
    *   vCenter Server 8.0a
    *   vCenter Server 7.0 U3i
    *   Updates are also available for Cloud Foundation (KB90336).
*   **CVSS Score:** The vulnerability has a CVSS v3 base score of 7.1 (CVSS:3.1/AV:A/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H). This indicates a high severity issue requiring adjacent network access, low privileges, and no user interaction to exploit.
*   **Reporting:** The vulnerability was reported by Yaron Zinar and Sagi Sheinfeld of Crowdstrike.
*   **Memory Corruption Issue:** The memory corruption issue related to IWA with Active Directory is distinct from the privilege escalation vulnerability, although they are related and both are caused by the IWA mechanism.
*   **Upgrade failures**: The memory corruption issue could lead to "Exception occurred in postInstallHook" errors during vCenter upgrades, where the Secure Token Service fails to start. The resolution requires a revert to a healthy state, the workaround and then the patch can be applied.
*   **vCenter versions affected**: The memory corruption was observed in vCenter Server 7.0.3 and resolved in vCenter Server 7.0 U3g.
*   **vCenter upgrades:** vCenter upgrades from 6.x to 7.0 U3f will fail with the “Starting VMware Security Token Service” error if the VCSA is using IWA.
*   **Core Dumps:** Memory corruption leads to core dump files being created (core.Thread-2.xxxx)

The provided information offers more in-depth details compared to a basic CVE description, clarifying the root cause, impact, and providing specific workarounds and resolutions.