=== Content from gitlab.com_6059ca35_20250114_202947.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22250.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22250.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22250.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22250.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Aug 23, 2021

  [3bbd79ba](/gitlab-org/cves/-/commit/3bbd79ba7d148095f2ecc2f4a00932dbff9b866e)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/3bbd79ba7d148095f2ecc2f4a00932dbff9b866e)
  繚
  3bbd79ba

  [ GitLab Bot ](/gitlab-bot) authored Aug 23, 2021

  3bbd79ba

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/3bbd79ba7d148095f2ecc2f4a00932dbff9b866e)
  [ GitLab Bot ](/gitlab-bot) authored Aug 23, 2021

Loading



=== Content from gitlab.com_c4bc9f77_20250114_202948.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Ability to list and delete impersonation tokens for your own user

**[HackerOne report #1205916](https://hackerone.com/reports/1205916)** by `jimeno` on 2021-05-22, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

GitLab official [documentation](https://docs.gitlab.com/ee/api/README.html#impersonation-tokens) says only and Administrator can create an Impersonation Token. Otherwise users could deny them the use of this feature by continuously [checking](https://docs.gitlab.com/ee/api/personal_access_tokens.html#list-personal-access-tokens) their Personal Access Tokens via the API and then [revoking](https://docs.gitlab.com/ee/api/personal_access_tokens.html#revoke-a-personal-access-token) the generated impersonation token.

> Impersonation tokens are a type of personal access token. They can be created only by an administrator, and are used to authenticate with the API as a specific user.

**Suggested fix:** only an administrator should be able to revoke an impersonation token. Also, impersonation tokens should not be listable by the impersonated user itself. Also, user won't see the impersonation token when browsing to their list of tokens via the GitLab UI.

**Note:** This report falls under the premise that only administrators should be able to revoke impersonation tokens.

##### Steps to reproduce

This was tested on a GitLab Ultimate instance.

1. As Admin, browse to `/admin/users`, select your unprivileged user and click Impersonation Tokens section.
2. Generate a new token scoped as you wish and note the name you set to it.
3. As user, browse to your profile and create a new Personal Access Token (PAT) scoped to API access at least.
4. As user, list your PATs.

   ```
   $ curl --header "PRIVATE-TOKEN: YOUR-PAT" "https://YOUR-INSTANCE/api/v4/personal_access_tokens" -s | jq .
   ```
5. Note the response includes the impersonation token created by the administrator user. Take a note of the token identifier.
6. As user, revoke the impersonation token created by the administrator. Remember to replace the ID (6) with yours.

   ```
   $ curl -X DELETE --header "PRIVATE-TOKEN: YOUR-PAT" "https://YOUR-INSTANCE/api/v4/personal_access_tokens/6"
   ```

[recording-1621698195653.webm](https://user-content.gitlab-static.net/3ca6103658c9ece3be78a44a13468e59402d6e1e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63383039656463612d633533652d346634352d383066362d6565343437343162653138342f7265636f7264696e672d313632313639383139353635332e7765626d "Download 'recording-1621698195653.webm'")

##### Impact

Low privileged user is able to revoke impersonation token created by the instance administrator for their account. On the other hand, normal GitLab user is able to know when an administrator has created an impersonation token for their account.

##### Examples

N/A

##### What is the current *bug* behavior?

Low privileged user is able to revoke impersonation token created by the instance administrator for their account.

##### What is the expected *correct* behavior?

Only administrator user is able to revoke impersonation tokens. Impersonated user doesn't see the impersonation token when listing their Personal Access Tokens.

##### Relevant logs and/or screenshots

N/A

##### Output of checks

Only tested in GitLab Ultimate.

###### Results of GitLab environment info

```
root@rigel:/# gitlab-rake gitlab:env:info

System information
System:
Proxy:		no
Current User:	git
Using RVM:	no
Ruby Version:	2.7.2p137
Gem Version:	3.1.4
Bundler Version:2.1.4
Rake Version:	13.0.3
Redis Version:	6.0.12
Git Version:	2.31.1
Sidekiq Version:5.2.9
Go Version:	unknown

GitLab information
Version:	13.12.0-ee
Revision:	12a3ec8fb4a
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	12.6
URL:		https://rigel.wiki
HTTP Clone URL:	https://rigel.wiki/some-group/some-project.git
SSH Clone URL:	git@rigel.wiki:some-group/some-project.git
Elasticsearch:	no
Geo:		no
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers: auth0

GitLab Shell
Version:	13.18.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git

```

#### Impact

Low privileged user is able to revoke impersonation token created by the instance administrator for their account. On the other hand, normal GitLab user is able to know when an administrator has created an impersonation token for their account.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [recording-1621698195653.webm](https://h1.sec.gitlab.net/a/c809edca-c53e-4f45-80f6-ee44741be184/recording-1621698195653.webm)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


