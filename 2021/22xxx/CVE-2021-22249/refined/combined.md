=== Content from gitlab.com_e73cd386_20250114_202928.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22249.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22249.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22249.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22249.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Aug 23, 2021

  [4f28ed3e](/gitlab-org/cves/-/commit/4f28ed3e9cadc1206c39eb9efda64d7517a890b0)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/4f28ed3e9cadc1206c39eb9efda64d7517a890b0)
  ·
  4f28ed3e

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 23, 2021

  4f28ed3e

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/4f28ed3e9cadc1206c39eb9efda64d7517a890b0)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Aug 23, 2021

Loading



=== Content from gitlab.com_7f579b46_20250114_202930.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Private user email disclosure via group invitation

**[HackerOne report #1204320](https://hackerone.com/reports/1204320)** by `jimeno` on 2021-05-20, assigned to GitLab Team:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

GitLab paid plans support group administrators to restrict group memberships by email domain. For example, a grpup administrator can create a setting so that all group members must have a `gitlab.com` email address. Related documentation can be found [here](https://gitlab.com/help/user/group/index#restrict-group-access-by-domain).

Thanks to it, any GitLab who can create a group can leak other users email address, even when these are configured as [private](https://docs.gitlab.com/ee/user/profile/#make-your-user-profile-page-private)

##### Steps to reproduce

> **NOTE:** Please, use an Ultimate GitLab instance as that's the one I used.

1. Create a GitLab group and enable domain restrictions. Only add `gitlab.com` to the allow-list.

   [![email_restriction.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/31169a5bb1ffb519eeb7bac8d84d130b06ef11a6/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65663832333238632d623362622d346535322d623461372d6265313766313030333565312f656d61696c5f7265737472696374696f6e2e706e67)
2. Create a new GitLab user and make sure their profile is [private](https://docs.gitlab.com/ee/user/profile/#make-your-user-profile-page-private) by following the official linked documentation.

   [![private_settings.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/278589425d0f83565ad23e5f3bda4772a89210a7/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65646366353139662d643630322d343237372d616538352d3837333166376136346534652f707269766174655f73657474696e67732e706e67)
3. As your attacker, visit their profile `https://your-instance.tld/private` and make sure GitLab says the profile is private.

   [![private_view.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/b0b2d78ff879985a25d4ddfb8755de455dce59c3/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30346334343366362d356131382d343261362d383662332d6539363964336234653030382f707269766174655f766965772e706e67)
4. Try to invite the user to the group (you will need to know their username) and notice the error in a red textbox on top of the page displays their email address to you.

   [![email_disclosure.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/03855a87b6365ffc9c44cbdfc493f4bed710cb98/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36653635653066302d326263382d343234322d623839382d6431643639616466396638362f656d61696c5f646973636c6f737572652e706e67)

[recording-1621534191673.webm](https://user-content.gitlab-static.net/dbdb34d8952b825028734320d410ae44b4c3167b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37363038316130362d386366312d346630662d623836392d6662646232373031366639322f7265636f7264696e672d313632313533343139313637332e7765626d "Download 'recording-1621534191673.webm'")

##### Impact

Email address disclosure.

##### Examples

N/A.

##### What is the current *bug* behavior?

Email address of user is displayed to attacker when group invitation fails.

##### What is the expected *correct* behavior?

Error message is displayed to the attacker while respecting invited user's privacy settings.

##### Relevant logs and/or screenshots

N/A.

##### Output of checks

N/A.

###### Results of GitLab environment info

```
root@rigel:/# gitlab-rake gitlab:env:info

System information
System:
Proxy:		no
Current User:	git
Using RVM:	no
Ruby Version:	2.7.2p137
Gem Version:	3.1.4
Bundler Version:2.1.4
Rake Version:	13.0.3
Redis Version:	6.0.12
Git Version:	2.31.1
Sidekiq Version:5.2.9
Go Version:	unknown

GitLab information
Version:	13.11.4-ee
Revision:	d1a2e182d3b
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	12.6
URL:		https://rigel.wiki
HTTP Clone URL:	https://rigel.wiki/some-group/some-project.git
SSH Clone URL:	git@rigel.wiki:some-group/some-project.git
Elasticsearch:	no
Geo:		no
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers: auth0

GitLab Shell
Version:	13.17.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git
```

#### Impact

Email address disclosure.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [email\_restriction.png](https://h1.sec.gitlab.net/a/ef82328c-b3bb-4e52-b4a7-be17f10035e1/email_restriction.png)
* [private\_view.png](https://h1.sec.gitlab.net/a/04c443f6-5a18-42a6-86b3-e969d3b4e008/private_view.png)
* [private\_settings.png](https://h1.sec.gitlab.net/a/edcf519f-d602-4277-ae85-8731f7a64e4e/private_settings.png)
* [recording-1621534191673.webm](https://h1.sec.gitlab.net/a/76081a06-8cf1-4f0f-b869-fbdb27016f92/recording-1621534191673.webm)
* [email\_disclosure.png](https://h1.sec.gitlab.net/a/6e65e0f0-2bc8-4242-b898-d1d69adf9f86/email_disclosure.png)

## Proposal

A fix proposal is discussed [here](https://gitlab.com/gitlab-org/gitlab/-/issues/331857#note_586041753 "Private user email disclosure via group invitation").

Edited Jul 29, 2021 by [Rohit Shambhuni](/rshambhuni)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


