=== Content from discuss.rubyonrails.org_0f3a7a8d_20250115_100449.html ===


![Ruby on Rails Discussions](data:image/svg;base64...)
Loading

[Ruby on Rails Discussions](/)

# [[CVE-2021-22903] Possible Open Redirect Vulnerability in Action Pack](/t/cve-2021-22903-possible-open-redirect-vulnerability-in-action-pack/77867)

[Security Announcements](/c/security-announcements/9)

[tenderlove](https://discuss.rubyonrails.org/u/tenderlove)
(Aaron Patterson)

May 5, 2021, 4:58pm

1

There is a possible Open Redirect Vulnerability in Action Pack. This
vulnerability has been assigned the CVE identifier CVE-2021-22903.

Versions Affected: >= v6.1.0.rc2
Not affected: < v6.1.0.rc2
Fixed Versions: 6.1.3.2

## Impact

This is similar to CVE-2021-22881: Specially crafted Host headers in
combination with certain “allowed host” formats can cause the Host
Authorization middleware in Action Pack to redirect users to a malicious
website.

Since rails/rails@9bc7ea5, strings in config.hosts that do not have a leading
dot are converted to regular expressions without proper escaping. This causes,
for example, config.hosts << “[sub.example.com](http://sub.example.com)” to permit a request with a Host
header value of [sub-example.com](http://sub-example.com).

## Releases

The fixed releases are available at the normal locations.

## Workarounds

The following monkey patch put in an initializer can be used as a workaround:

```
class ActionDispatch::HostAuthorization::Permissions
  def sanitize_string(host)
    if host.start_with?(".")
      /\A(.+\.)?#{Regexp.escape(host[1..-1])}\z/i
    else
      /\A#{Regexp.escape host}\z/i
    end
  end
end

```
## Patches

To aid users who aren’t able to upgrade immediately we have provided patches for
the two supported release series. They are in git-am format and consist of a
single changeset.

* 6-1-open-redirect.patch - Patch for 6.1 series

Please note that only the 6.1.Z, 6.0.Z, and 5.2.Z series are supported at
present. Users of earlier unsupported releases are advised to upgrade as soon
as possible as we cannot guarantee the continued availability of security
fixes for unsupported releases.

## Credits

Thanks Jonathan Hefner ([HackerOne](https://hackerone.com/jonathanhefner)) for reporting this bug!

[6-1-open-redirect.patch](/uploads/short-url/mG4Y7AxbibtmruIWBjZ1MQN5YNm.patch) (1.9 KB)

4 Likes

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [[CVE-2021-22881] Possible Open Redirect in Host Authorization Middleware](https://discuss.rubyonrails.org/t/cve-2021-22881-possible-open-redirect-in-host-authorization-middleware/77130)  [Security Announcements](/c/security-announcements/9) | 0 | 8689 | February 10, 2021 |
| [Possible Open Redirect in Host Authorization Middleware](https://discuss.rubyonrails.org/t/possible-open-redirect-in-host-authorization-middleware/79505)  [Security Announcements](/c/security-announcements/9) | 0 | 6076 | December 14, 2021 |
| [[CVE-2021-22942] Possible Open Redirect in Host Authorization Middleware](https://discuss.rubyonrails.org/t/cve-2021-22942-possible-open-redirect-in-host-authorization-middleware/78722)  [Security Announcements](/c/security-announcements/9) | 0 | 8117 | August 19, 2021 |
| [[CVE-2023-22797] Possible Open Redirect Vulnerability in Action Pack](https://discuss.rubyonrails.org/t/cve-2023-22797-possible-open-redirect-vulnerability-in-action-pack/82120)  [Security Announcements](/c/security-announcements/9) [patch](https://discuss.rubyonrails.org/tag/patch) ,  [security](https://discuss.rubyonrails.org/tag/security) ,  [actioncontroller](https://discuss.rubyonrails.org/tag/actioncontroller) | 0 | 5402 | January 17, 2023 |
| [[CVE-2022-22577] Possible XSS Vulnerability in Action Pack](https://discuss.rubyonrails.org/t/cve-2022-22577-possible-xss-vulnerability-in-action-pack/80533)  [Security Announcements](/c/security-announcements/9) [patch](https://discuss.rubyonrails.org/tag/patch) | 0 | 11545 | April 26, 2022 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


