=== Content from gitlab.com_93cd5532_20250115_095240.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Server-side DoS through rendering crafted Markdown documents in GitLab CE versions

**[HackerOne report #1090049](https://hackerone.com/reports/1090049)** by `phli` on 2021-01-29, assigned to [@dcouture](/dcouture "Dominic Couture"):

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Self-hosted GitLab CE versions allow users to feed arbitrary Markdown files for rendering. This can be done in the browser user-interface or command-line APIs (i.e., /api/v4/markdown). Some crafted Markdown files trigger some performance bugs in the Markdown renderers and cause server-side to take unexpectedly longer execution time to render. This can potentially make the server unavailable if the crafted file takes too much CPU time. This cannot be mitigated by tuning application limits.

##### Steps to reproduce

(1. Environment)

Latest GitLab CE version, 13.8.1, more information can be found below.

And operating system:

```
Linux labpc 4.9.0-11-amd64 #1 SMP Debian 4.9.189-3+deb9u2 (2019-11-11) x86_64 GNU/Linux
```

(2. API request)

Directly query the Markdown API with the crafted Markdown document.

```
input = "```css\n```typescript\n[\n```\n" * 300000
payload = {'text': input}
start_time = time.time()
response = requests.post("http://REDACTED/api/v4/markdown", data=payload) # replace the URL with your own one. This one only works in my own local area network.
interval = round(time.time() - start_time, 3)
print(interval)
```

(3. user action )

Just wait for the response and check the execution time. I have tried with the repetition of 300000, the corresponding time exceeds 10 seconds. For your reference, I have tried many other normal inputs in the same size, the execution time is mostly within 1 second. This suggests there definitely is a performance issue in the GitLab's Markdown renderer when handling such an input. You can change the number 300000 to others for your testing.

##### Impact

The server-side CPU consumption increases if the CPUs are occupied by such Markdown requests. Moreover, DoS can be caused and makes all services unavailable to other normal users and operations.

##### Examples

To avoid to impact on GitLab.com, I DON'T test on GitLab.com. However, I suspect the problem can also appear in GitLab.com.

(If you are using an older version of GitLab, this will also help determine whether the bug has been fixed in a more recent version)

I am using the latest version, at the time of reporting the bug.

##### What is the current *bug* behavior?

(What actually happens, include relevant screenshots, API results, or complete HTTP requests)

So, the execution time is much longer than expected.

##### What is the expected *correct* behavior?

I expect the rendering to be done within 1 or 2 seconds. The response from the above script can get the rendered HTML content.

##### Relevant logs and/or screenshots

(Paste any relevant logs - please use code blocks (```) to format console output,

logs, and code as it's very hard to read otherwise.)

##### Output of checks

(If you are reporting a bug on GitLab.com, write: This bug happens on GitLab.com)

###### Results of GitLab environment info

```
System information
System:		Debian 9.13
Current User:	git
Using RVM:	no
Ruby Version:	2.7.2p137
Gem Version:	3.1.4
Bundler Version:2.1.4
Rake Version:	13.0.3
Redis Version:	5.0.9
Git Version:	2.29.0
Sidekiq Version:5.2.9
Go Version:	unknown

GitLab information
Version:	13.8.1
Revision:	7248f8bff5a
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	12.4
URL:		http://REDACTED
HTTP Clone URL:	http://REDACTED/some-group/some-project.git
SSH Clone URL:	git@REDACTED:some-group/some-project.git
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers:

GitLab Shell
Version:	13.15.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git
```

#### Impact

Sophisticated CPU exhaustion DoS.

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jul 02, 2021 by [Dominic Couture](/dcouture)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_aa0bac81_20250115_095239.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2021](/gitlab-org/cves/-/tree/master/2021)
* [**CVE-2021-22217.json**](/gitlab-org/cves/-/blob/master/2021/CVE-2021-22217.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2021/CVE-2021-22217.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2021/CVE-2021-22217.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jun 08, 2021

  [5e98405f](/gitlab-org/cves/-/commit/5e98405fd4f9bd921da811b7d14ebfc7e319e5d7)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/5e98405fd4f9bd921da811b7d14ebfc7e319e5d7)
  ·
  5e98405f

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jun 08, 2021

  5e98405f

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/5e98405fd4f9bd921da811b7d14ebfc7e319e5d7)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jun 08, 2021

Loading


