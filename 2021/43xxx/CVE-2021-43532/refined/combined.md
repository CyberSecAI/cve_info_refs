=== Content from www.mozilla.org_0ee21338_20250114_183109.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-48

## Security Vulnerabilities fixed in Firefox 94

Announced
November 2, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 94

#### [#CVE-2021-38503: iframe sandbox rules did not apply to XSLT stylesheets](#CVE-2021-38503)

Reporter
Armin Ebert
Impact
high
##### Description

The iframe sandbox rules were not correctly applied to XSLT stylesheets, allowing an iframe to bypass restrictions such as executing scripts or navigating the top-level frame.

##### References

* [Bug 1729517](https://bugzilla.mozilla.org/show_bug.cgi?id=1729517)

#### [#CVE-2021-38504: Use-after-free in file picker dialog](#CVE-2021-38504)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When interacting with an HTML input element's file picker dialog with `webkitdirectory` set, a use-after-free could have resulted, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1730156](https://bugzilla.mozilla.org/show_bug.cgi?id=1730156)

#### [#CVE-2021-38505: Windows 10 Cloud Clipboard may have recorded sensitive user data](#CVE-2021-38505)

Reporter
Sergey Galich
Impact
high
##### Description

Microsoft introduced a new feature in Windows 10 known as Cloud Clipboard which, if enabled, will record data copied to the clipboard to the cloud, and make it available on other computers in certain scenarios. Applications that wish to prevent copied data from being recorded in Cloud History must use specific clipboard formats; and Firefox before versions 94 and ESR 91.3 did not implement them. This could have caused sensitive data to be recorded to a user's Microsoft account.
*This bug only affects Firefox for Windows 10+ with Cloud Clipboard enabled. Other operating systems are unaffected.*

##### References

* [Bug 1730194](https://bugzilla.mozilla.org/show_bug.cgi?id=1730194)

#### [#CVE-2021-38506: Firefox could be coaxed into going into fullscreen mode without notification or warning](#CVE-2021-38506)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Through a series of navigations, Firefox could have entered fullscreen mode without notification or warning to the user. This could lead to spoofing attacks on the browser UI including phishing.

##### References

* [Bug 1730750](https://bugzilla.mozilla.org/show_bug.cgi?id=1730750)

#### [#CVE-2021-38507: Opportunistic Encryption in HTTP2 could be used to bypass the Same-Origin-Policy on services hosted on other ports](#CVE-2021-38507)

Reporter
Takeshi Terada
Impact
high
##### Description

The Opportunistic Encryption feature of HTTP2 (RFC 8164) allows a connection to be transparently upgraded to TLS while retaining the visual properties of an HTTP connection, including being same-origin with unencrypted connections on port 80. However, if a second encrypted port on the same IP address (e.g. port 8443) did not opt-in to opportunistic encryption; a network attacker could forward a connection from the browser to port 443 to port 8443, causing the browser to treat the content of port 8443 as same-origin with HTTP. This was resolved by disabling the Opportunistic Encryption feature, which had low usage.

##### References

* [Bug 1730935](https://bugzilla.mozilla.org/show_bug.cgi?id=1730935)

#### [#CVE-2021-43530: Universal XSS in Firefox for Android via QR Code URLs](#CVE-2021-43530)

Reporter
Hafiizh
Impact
high
##### Description

A Universal XSS vulnerability was present in Firefox for Android resulting from improper sanitization when processing a URL scanned from a QR code.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1736886](https://bugzilla.mozilla.org/show_bug.cgi?id=1736886)

#### [#CVE-2021-38508: Permission Prompt could be overlaid, resulting in user confusion and potential spoofing](#CVE-2021-38508)

Reporter
Raphael
Impact
moderate
##### Description

By displaying a form validity message in the correct location at the same time as a permission prompt (such as for geolocation), the validity message could have obscured the prompt, resulting in the user potentially being tricked into granting the permission.

##### References

* [Bug 1366818](https://bugzilla.mozilla.org/show_bug.cgi?id=1366818)

#### [#CVE-2021-43531: Web Extensions could access pre-redirect URL when their context menu was triggered by a user](#CVE-2021-43531)

Reporter
Rob Wu
Impact
moderate
##### Description

When a user loaded a Web Extensions context menu, the Web Extension could access the post-redirect URL of the element clicked. If the Web Extension lacked the WebRequest permission for the hosts involved in the redirect, this would be a same-origin-violation leaking data the Web Extension should have access to. This was fixed to provide the pre-redirect URL. This is related to CVE-2021-43532 but in the context of Web Extensions.

##### References

* [Bug 1659155](https://bugzilla.mozilla.org/show_bug.cgi?id=1659155)

#### [#CVE-2021-38509: Javascript alert box could have been spoofed onto an arbitrary domain](#CVE-2021-38509)

Reporter
Ademar Nowasky Junior
Impact
moderate
##### Description

Due to an unusual sequence of attacker-controlled events, a Javascript `alert()` dialog with arbitrary (although unstyled) contents could be displayed over top an uncontrolled webpage of the attacker's choosing.

##### References

* [Bug 1718571](https://bugzilla.mozilla.org/show_bug.cgi?id=1718571)

#### [#CVE-2021-38510: Download Protections were bypassed by .inetloc files on Mac OS](#CVE-2021-38510)

Reporter
Hou JingYi
Impact
moderate
##### Description

The executable file warning was not presented when downloading .inetloc files, which can run commands on a user's computer.
*Note: This issue only affected Mac OS operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1731779](https://bugzilla.mozilla.org/show_bug.cgi?id=1731779)

#### [#CVE-2021-43532: 'Copy Image Link' context menu action could have been abused to see authentication tokens](#CVE-2021-43532)

Reporter
Ademar Nowasky Junior
Impact
low
##### Description

The 'Copy Image Link' context menu action would copy the final image URL after redirects. By embedding an image that triggered authentication flows - in conjunction with a Content Security Policy that stopped a redirection chain in the middle - the final image URL could be one that contained an authentication token used to takeover a user account. If a website tricked a user into copy and pasting the image link back to the page, the page would be able to steal the authentication tokens. This was fixed by making the action return the original URL, before any redirects.

##### References

* [Bug 1719203](https://bugzilla.mozilla.org/show_bug.cgi?id=1719203)

#### [#CVE-2021-43533: URL Parsing may incorrectly parse internationalized domains](#CVE-2021-43533)

Reporter
Taiga Shirakura
Impact
low
##### Description

When parsing internationalized domain names, high bits of the characters in the URLs were sometimes stripped, resulting in inconsistencies that could lead to user confusion or attacks such as phishing.

##### References

* [Bug 1724233](https://bugzilla.mozilla.org/show_bug.cgi?id=1724233)

#### [#CVE-2021-43534: Memory safety bugs fixed in Firefox 94 and Firefox ESR 91.3](#CVE-2021-43534)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Christian Holler, Valentin Gosu, and Andrew McCreight reported memory safety bugs present in Firefox 93 and Firefox ESR 91.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 94 and Firefox ESR 91.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1606864%2C1712671%2C1730048%2C1735152)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_605ae200_20250114_183108.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1719203)
* [XML](/show_bug.cgi?ctype=xml&id=1719203)

Closed
[Bug 1719203](/show_bug.cgi?id=1719203)
(CVE-2021-43532)

Opened 4 years ago
Closed 3 years ago

# Context-menu "Copy Image Link" leaks intermediate redirect paths if loading interrupted

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Context-menu "Copy Image Link" leaks intermediate redirect paths if loading interrupted

## Categories

### (Firefox :: Security, task, P1)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Security#Security)

Security
▾

Firefox :: Security
For app-level security bugs.

If the problem relates to underlying components (PSM, NSS, Core, Toolkit) then please file it in the appropriate product instead of here.

[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

task

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

94 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix) |
| firefox94 | --- | [verified](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox92 |  | wontfix |
| firefox93 |  | wontfix |
| firefox94 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: nowasky.jr, Assigned: dao, NeedInfo)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d949a35ad3900bd0ee47938b23a0cbee?d=mm&size=40)  [dao](/user_profile?user_id=219124)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ce6324506e3ed0df15f710f791388a6a?d=mm&size=40)  [nowasky.jr](/user_profile?user_id=678218)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/fe2c2192f4fabf01f2d2e700631bb8fe?d=mm&size=40)  [manuel](/user_profile?user_id=688976)

NeedInfo From:

 [dao](/user_profile?user_id=219124)

[3 years ago](#c0)

[NeedInfo:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#needinfo)

Update

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2021-43531](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.")

Dependency [tree](/showdependencytree.cgi?id=1719203&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1719203)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2021-43531](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value."), [1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")

## Details

### (Keywords: csectype-disclosure, reporter-external, sec-low, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main94+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-43532

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main94+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a7343127_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a7354459_75935 "3 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [poc.html](/attachment.cgi?id=9229778)  [4 years ago](#c0)  [Ademar Nowasky Junior](/user_profile?user_id=678218)   1.58 KB, text/html |  | [Details](/attachment.cgi?id=9229778&action=edit) |
| --- | --- | --- |
| [poc2.html](/attachment.cgi?id=9230151)  [4 years ago](#c9)  [Ademar Nowasky Junior](/user_profile?user_id=678218)   3.94 KB, text/html |  | [Details](/attachment.cgi?id=9230151&action=edit) |
| [Bug 1719203 - Let "Copy Image Link" use the original URL before redirects. r=gijs](/attachment.cgi?id=9241602)  [3 years ago](#c21)  [Dão Gottwald [:dao]](/user_profile?user_id=219124)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9241602&action=edit) | [Review](/attachment.cgi?id=9241602) |
| [advisory.txt](/attachment.cgi?id=9248025)  [3 years ago](#c36)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   692 bytes, text/plain |  | [Details](/attachment.cgi?id=9248025&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1719203#c0)• 4 years ago |
|  | |

Attached file
[poc.html](attachment.cgi?id=9229778)
— [Details](attachment.cgi?id=9229778&action=edit)

Hello,

The "Copy Image Link" item in the context menu of an image copies the URL after redirects. This data potentially reveals information about the redirect that would not otherwise be known to the original site. This could be used by a malicious site to obtain sensitive information like usernames or single-sign-on tokens encoded within the target URLs.

In cases where the sensitive information is not present in the final URL but instead in a redirect chain, it's possible to use a CSP img-src directive to break the redirect chain where it's needed to leave the image link with the sensitive information.

To perform this attack the victim needs to copy and paste the image link into the attacker's page.

The POC demonstrates the redirect chain case in a scenario where the user can choose an avatar by copying and pasting its URL in an input field. Each avatar is loaded in a div as a background-image and the malicious image tags are loaded in front of it with opacity:0 to make them transparent. By right-clicking the avatar image to copy its link the victim will be instead interacting with the malicious image tag.

The POC redirect chain works as follow:

1. The image src is set to <https://urlwee.com/foqfun1>
2. The image src URL will redirect to the sensitive URL <https://bit.ly/36esqPj?token=secret123>
3. The sensitive URL will redirect to <https://example.com>

The goal is to leak the <https://bit.ly/36esqPj?token=secret123>. This is accomplished with the following CSP:

<meta http-equiv="Content-Security-Policy" content="img-src 'self' <https://urlwee.com> [https://bit.ly">](https://bit.ly%22%3E)

As the CSP directive doesn't have the <https://example.com> URL it will block the redirect to it, leaving the image link as <https://bit.ly/36esqPj?token=secret123>

Video: <https://youtu.be/R2kb3fph8PE>

Firefox version: 90.0b12 (Windows)

Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1719203#c1)• 4 years ago |
|  | |

(In reply to Ademar Nowasky Junior from [comment #0](/show_bug.cgi?id=1719203#c0 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

Thanks for the report.

> To perform this attack the victim needs to copy and paste the image link into the attacker's page.

I'm a bit unclear on this. In the PoC in the video, the image is already present in the page. This means the attacker already has access to the pre-redirect URL (the foqfun1 one). Under what circumstances does the attacker have this pre-redirect URL while also being unable to determine the target of the redirect? That is, if `token=secret123` is secret, why isn't the `foqfun1` URL secret?

Is there a practical application here, ie do twitter/fb/forum software of some sort divulge secrets in URLs in a way that this lets you exploit?

Using a pre-redirect URL causes other issues - the relevant code is at <https://searchfox.org/mozilla-central/rev/5b3444ad300e244b5af4214212e22bd9e4b7088a/browser/actors/ContextMenuChild.jsm#976-993> and trivial checks on blame suggest that using the pre-redirect URI may cause issues with caching, image blocking, and/or blob URIs. :-\

We fixed the image drag & drop version of this problem in [bug 1189814](/show_bug.cgi?id=1189814 "RESOLVED FIXED - Dragging and dropping image to <textbox> pastes final URL of image after redirects"). I don't know how intentional continuing to use the post-redirect URL for the context menu is. Dan/Mats, thoughts?

Flags: needinfo?(nowasky.jr)Flags: needinfo?(mats)Flags: needinfo?(dveditz)

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1719203#c2)• 4 years ago |
|  | |

Hello,

Thanks for the response.

OAuth and probably other authorization mechanisms would suffer from this. In the most common scenario, the initial authorization endpoint is publicly exposed, and later in the redirection chain the access token is passed in a URL parameter.

Implementations of the Single Sign-On are also affected. Google, for instance, uses the <https://accounts.google.com/CheckCookie> endpoint for authentication. Once the browser request this URL, a redirection chain initiates passing the authentication data in the SIDT parameter to authenticate the user into other sites (youtube, blogger, ...). One of the redirects would look like this:

[https://accounts.youtube.com/accounts/SetSID?ssdc=1&sidt=<SENSITIVE-DATA-HERE>&continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&tcc=1&dbus=blogger&dbus=BR&dbus=googlesource](https://accounts.youtube.com/accounts/SetSID?ssdc=1&sidt=%EF%BF%BDSENSITIVE-DATA-HERE%3E&continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&tcc=1&dbus=blogger&dbus=BR&dbus=googlesource)

If the SIDT was not being invalidated after the first use, the attacker would be able to authenticate into the victim account through this attack.

Overall, the impact of this bug doesn't differ much from [Bug 1687342](/show_bug.cgi?id=1687342 "VERIFIED FIXED - Firefox leaks full redirect path via CSP violation reports"), where Firefox was leaking the redirect URL via CSP reports. On that occasion, I made a video about how it could be used to compromise the Google account as previously described. You can check it @ <https://youtu.be/FgdplWFBEso>

Flags: needinfo?(nowasky.jr)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1719203#c3)• 4 years ago |
|  | |

(In reply to Ademar Nowasky Junior from [comment #2](/show_bug.cgi?id=1719203#c2 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> OAuth and probably other authorization mechanisms would suffer from this. In the most common scenario, the initial authorization endpoint is publicly exposed, and later in the redirection chain the access token is passed in a URL parameter.

OK, that more or less makes sense.

> Implementations of the Single Sign-On are also affected. Google, for instance, uses the <https://accounts.google.com/CheckCookie> endpoint for authentication. Once the browser request this URL, a redirection chain initiates passing the authentication data in the SIDT parameter to authenticate the user into other sites (youtube, blogger, ...). One of the redirects would look like this:
>
> [https://accounts.youtube.com/accounts/SetSID?ssdc=1&sidt=<SENSITIVE-DATA-HERE>&continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&tcc=1&dbus=blogger&dbus=BR&dbus=googlesource](https://accounts.youtube.com/accounts/SetSID?ssdc=1&sidt=%EF%BF%BDSENSITIVE-DATA-HERE%3E&continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&tcc=1&dbus=blogger&dbus=BR&dbus=googlesource)
>
> If the SIDT was not being invalidated after the first use, the attacker would be able to authenticate into the victim account through this attack.

Hm, and this works even when the requests are made from an `img` tag? Because I would have expected (a) that if the server response sends `Content-Type: text/html` (but maybe it doesn't for the redirect?) the browser stops the load and (b) that if the server sees a request `Accept` header of `image/webp,*/*`, and a `Sec-Fetch-Dest: image` header, it would not proceed...

Certainly seems like there's room for better defense in depth there, but I guess we might still have to investigate pasting the pre-redirect URI. This is unfortunate because besides the possibility of other issues I cited in my previous comment, it's less user-friendly for non-malicious cases...

> Overall, the impact of this bug doesn't differ much from [Bug 1687342](/show_bug.cgi?id=1687342 "VERIFIED FIXED - Firefox leaks full redirect path via CSP violation reports"), where Firefox was leaking the redirect URL via CSP reports. On that occasion, I made a video about how it could be used to compromise the Google account as previously described. You can check it @ <https://youtu.be/FgdplWFBEso>

And just to confirm, AIUI [bug 1687342](/show_bug.cgi?id=1687342 "VERIFIED FIXED - Firefox leaks full redirect path via CSP violation reports") involves no user interaction, whereas this requires convincing the user to right-click the image, copy the image link, and pasting it into the input field, right?

Flags: needinfo?(nowasky.jr)

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1719203#c4)• 4 years ago |
|  | |

> Hm, and this works even when the requests are made from an `img` tag? Because I would have expected (a) that if the server response sends `Content-Type: text/html` (but maybe it doesn't for the redirect?) the browser stops the load

The browser will follow HTTP redirects regardless of the content-type value and will stop if it's blocked by the CSP or if the requested page returns another status code that isn't a HTTP redirect. This is what I experienced.

> and (b) that if the server sees a request `Accept` header of `image/webp,*/*`, and a `Sec-Fetch-Dest: image` header, it would not proceed...

From my tests looks like servers don't care about the `Accept` and the `Sec-Fetch-Dest` headers.

> Certainly seems like there's room for better defense in depth there, but I guess we might still have to investigate pasting the pre-redirect URI. This is unfortunate because besides the possibility of other issues I cited in my previous comment, it's less user-friendly for non-malicious cases...

Yeah, I agree. A solution that probably would no break non-malicious cases would be to paste the pre-redirect URI if the redirect(s) doesn't take to a valid image.

> And just to confirm, AIUI [bug 1687342](/show_bug.cgi?id=1687342 "VERIFIED FIXED - Firefox leaks full redirect path via CSP violation reports") involves no user interaction, whereas this requires convincing the user to right-click the image, copy the image link, and pasting it into the input field, right?

You are right about this bug requiring user interaction. The similarity with [Bug 1687342](/show_bug.cgi?id=1687342 "VERIFIED FIXED - Firefox leaks full redirect path via CSP violation reports") is the data that is compromised and the final impact on the victim.

Flags: needinfo?(nowasky.jr)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1719203#c5)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1719203&comment_id=15475304 "1 revision") |
|  | |

This is conflating "what the cross-origin page knows" (governed by the same-origin policy) and "what the user's agent (the browser) tells the user".

The document knows the original URL of the image it put in it's source. The same-origin policy says that's all that document should ever know about that URL -- any redirects on the network could be information from another context and should not be leaked back to that original page. This is not a perfect policy and some information is leaked such as whether the image loaded or was an error and that can sometimes be used to infer things about whether a redirect happened or not, but won't leak the full path back to the original document. Information can also be gleaned from applying CSP policies and what errors are returned, though you shouldn't be able to recover secrets that way.

"Copy Image URL" is information the browser knows (the real URL of the image) and shares with the user. Firefox believes that what the user most wants is the real source of that image after redirects since the redirects might be different in other contexts and result in a different image. Chrome, for one example, has chosen the original URL as the more useful value. But that is a feature of the browser and separate from the same-origin policy. This value is not leaked (by the browser) back to the containing page.

In this POC you're asking the user to share their information back with you, by interacting with the browser and then pasting the result back into a browser field. It is the user, via a "social engineering" attack, that has leaked the data to the page. To me, that part is not a Firefox "bug", and the Firefox "Copy Image URL" feature is more useful than Chrome's.

**The above is not a security bug**

A completely different problem, in my mind, is why we have a "Copy Image URL" menu item at all on an image that did not load! What the user is seeing is the background image, but if that's what's triggering the context menu item why aren't we giving the user the background image URL? Do we normally give the URL of broken images so the user can play with it in another context? Probably -- maybe a site prevents "deep-linking" but the image can be viewed directly?

I can accept that as useful, but then in this case we're stopping one URL short of where we know we redirected. Is that because the penultimate redirect was "successful" but the CSP block made the next one an error? But we're already letting the user in on the erroring image URL. Not sure if that's a bug or not, or if it is whether it's worth fixing. Not a security bug though, just a question of what's useful to the user.

Flags: needinfo?(dveditz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1719203#c6)• 4 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #5](/show_bug.cgi?id=1719203#c5 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> A completely different problem, in my mind, is why we have a "Copy Image URL" menu item at all on an image that did not load!

I think this was originally (20-25 years ago, when the web looked a bit different...) done for people who block images initially to speed things up, and then want to see specific ones by loading them separately. I *think* we still support this under the hood, though I'm pretty sure we removed most if not all of the UI...

> What the user is seeing is the background image, but if that's what's triggering the context menu item why aren't we giving the user the background image URL?

Context menu code in general is pretty dumb; it uses the same model as web DOM event processing and just picks the "top" element, with no regard for transparency or anything else. Doing something different is possible, but not entirely straightforward (see for example all the bugs that got filed against our picture-in-picture overlay button, which attempts to ignore semi-transparent web elements). This is often what the user sees, but not always, like in this case.

> Do we normally give the URL of broken images so the user can play with it in another context? Probably -- maybe a site prevents "deep-linking" but the image can be viewed directly?

This may be another angle, I'm not sure.

> I can accept that as useful, but then in this case we're stopping one URL short of where we know we redirected. Is that because the penultimate redirect was "successful" but the CSP block made the next one an error?

AIUI this is the outcome of the image request's `currentRequestFinalURI` property, the implementation of which lives in DOM and imagelib...

> But we're already letting the user in on the erroring image URL. Not sure if that's a bug or not, or if it is whether it's worth fixing. Not a security bug though, just a question of what's useful to the user.

Do you want to open this bug up? It kind of sounds like it, but you haven't. :-)

Flags: needinfo?(dveditz)

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1719203#c7)• 4 years ago |
|  | |

> In this POC you're asking the user to share their information back with you, by interacting with the browser and then pasting the result back into a browser field. It is the user, via a "social engineering" attack, that has leaked the data to the page. To me, that part is not a Firefox "bug", and the Firefox "Copy Image URL" feature is more useful than Chrome's.

It's an user interaction, just like the drag'n drop variant reported in [Bug 1189814](/show_bug.cgi?id=1189814 "RESOLVED FIXED - Dragging and dropping image to <textbox> pastes final URL of image after redirects") that abused a browser feature to leak the redirect URL.

Indeed it's the user that is sharing the information, but the browser is allowing him to be tricked into doing so by copying the sensitive ULR from an image that is being shown as another one.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1719203#c8)• 4 years ago |
|  | |

It's a fuzzy line. To me the drag-and-drop case was a plausible user interaction that could be conceptualized as a single movement (say in a game) that led to a surprising result because the browser, not the user, was revealing something. In this case the page has to ask the user to 1) right-click or "open the context menu", 2) explicitly chose "copy link" and then 3) give the link back to the page. That's unusual and suspicious, though I admit I am more suspicious than most.

> Do you want to open this bug up? It kind of sounds like it, but you haven't. :-)

I'm not 100% sure so it's safer to leave it as a sec bug a bit longer. If we were returning the final URL of a valid image I'd say it's not even a bug, let alone a security one. I'm less keen on it when there are redirects and there were errors loading the image. CSP induced in this case, but there could be other reasons: for example, a facebook link redirecting to the user's profile wouldn't load as an image, but could reveal their username.

I was hoping to get a few other folks to chime in.

fwiw this behavior was added in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"), which seems suspiciously recent. Did Firefox really return the original src URL in its first decade plus?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a95699_1689)• 4 years ago |

Summary: Firefox leaks full redirect path via Image links → Context-menu "Copy Image Link" leaks intermediate redirect paths if loading interrupted

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1719203#c9)• 4 years ago |
|  | |

Attached file
[poc2.html](attachment.cgi?id=9230151)
— [Details](attachment.cgi?id=9230151&action=edit)

(In reply to Daniel Veditz [:dveditz] from [comment #8](/show_bug.cgi?id=1719203#c8 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> It's a fuzzy line. To me the drag-and-drop case was a plausible user interaction that could be conceptualized as a single movement (say in a game) that led to a surprising result because the browser, not the user, was revealing something. In this case the page has to ask the user to 1) right-click or "open the context menu", 2) explicitly chose "copy link" and then 3) give the link back to the page. That's unusual and suspicious, though I admit I am more suspicious than most.

I get your point, although my POC shows an unusual scenario that demonstrates the issue but certainly doesn't reflect how it could be abused in a real attack.

I took the time to create another one, where the user has the option to choose images from another site, which sends through post message to the opener the URL of the safe image that the user chooses. When the user pastes the chosen URL, which is in fact the sensitive URL, the site intercepts the paste operation and actually paste the safe image URL that was received before, updates the image preview and replaces the clipboard data with the safe image URL to clear up any trace. The sensitive URL is printed to the console.

Check the new attached POC.

Heres's a video of it: <https://youtu.be/H3U_eOjMJ7Y>

Flags: needinfo?(dveditz)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1719203#c10)• 4 years ago |
|  | |

Marking it sec-low for now because it requires a lot of user interaction and isn't clear that the middle URL in a redirect chain is any worst than the last in general.

Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1719203#c11)• 4 years ago |
|  | |

This PoC is more plausible, but it's still oddly "hard" for users for any serious site. yes, handwaving about a "partner" site, which yet isn't partner enough to make "click on the image you want" work? I'm sure it will work on some people.

Incidentally, if you "Copy Image" instead of copying the link you get the image you want out of this testcase without leaking anything :-) In Chrome, however, "Copy Image" is disabled (grey) because it's a broken image (so the background image can't be used to fool users).

Initially I was thinking that CSP blocking might be the problem, that if only blockages were handled differently we could return the innocuous blocked-by-CSP "<https://example.org>" rather than the redirect with the secret. But there's no guarantee the CSP block in this scenario is on the last URL. If we changed the behavior to return the "last known URL" then Ademar could simply change the testcase CSP to block `bit.ly` and we're back to leaking secrets if you can lure a user into copy/paste.

There aren't many people around who were involved in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"). I'm not entirely sure about the motivation, though I can guess it can be handy at times. This divergence from Chrome behavior has also caused problems for people writing extensions: see [bug 1659155](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") (and other bugs where people complain about our behavior).

I see 3 main choices:

1. always report the in-source/pre-redirect URL.
   * pro:
     + matches Chrome; consistency is good for devs
     + no potential info leak
     + easy change
   * con:
     + undoes [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri").
     + Not as easy to get the actual image URL for devs? I can't find much of a way to get the final URL of the image in DevTools after the fact. You pretty much have to open the console (logging requests) or the network tab *before* loading the page to see that the in-content `src=` redirects. Or you can open the Browser Console and try to pick it out amongst all the other messages from the browser chrome. You could also "open image in new tab" to see the final URL, if the final URL doesn't depend on the page context (an anti-deep-linking site might block the load).
2. report the pre-redirect URL for --broken-- images, the final URL for valid images
   * pro:
     + preserves the current convenience when it matters most
     + prevents attacks like this one or against non-image URLs like a social site homepages that redirect to something with your account name.
   * con:
     + can still leak final URLs of valid images, if any of those are sensitive (maybe avatar links?). Should be pretty limited though
     + Is it hard to detect that the image didn't load at the point we're setting this value? Is the onerror status saved anywhere handy?
3. Do nothing
   * pro:
     + least effort
     + preserves whatever [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri") was doing
   * con:
     + luring attacks like this one, that are likely small scale given complexity and risk of detection if used on too many victims
     + possible that the in-source URL was more canonical and therefore more useful than the redirect which might be to some transient cached version. Silly example: a weather graphic showing current conditions by redirecting from the canonical URL to different end images at different times based on your location (cookies? geo-ip?). Of course the source URL can be easily found using DevTools or even the ancient Page Info Media tab.

You could argue a reasonable case for any of those options. I kind of like #2 as a compromise, but maybe it's better to either match Chrome (#1) or not bother (#3). There are still some edge case info leaks with #2 and a partial fix just invites more bug submissions (just as this bug references [bug 1189814](/show_bug.cgi?id=1189814 "RESOLVED FIXED - Dragging and dropping image to <textbox> pastes final URL of image after redirects")). The OAuth case worries me though, even though this could only be a small-scale or targeted attack. Not every OAuth-using site would be vulnerable -- most bounce from siteA->Auth->siteA and this bug's technique wouldn't work there.

Dao: you were involved a little bit in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"). Do you know more of the history behind that change?

Flags: needinfo?(dveditz) → needinfo?(dao+bmo)See Also: → [CVE-2021-43531](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value."), [1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1719203#c12)• 3 years ago |
|  | |

FYI, I've sent to Google a PoC that abuses this behavior to leak an authentication token from their login flow. Although they can protect themselves by checking for the `Sec-Fetch-Dest: image` header, they think this may be a security issue on Firefox and would like to discuss it with Mozilla.

I'm not sure how to proceed from here. I've shared with them the bug number but probably someone from Mozilla should allow them to access it.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1719203#c13)• 3 years ago |
|  | |

(In reply to Ademar Nowasky Junior from [comment #12](/show_bug.cgi?id=1719203#c12 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> FYI, I've sent to Google a PoC that abuses this behavior to leak an authentication token from their login flow. Although they can protect themselves by checking for the `Sec-Fetch-Dest: image` header, they think this may be a security issue on Firefox and would like to discuss it with Mozilla.
>
> I'm not sure how to proceed from here. I've shared with them the bug number but probably someone from Mozilla should allow them to access it.

--> Dan?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1719203#c14)• 3 years ago |
|  | |

They should know how to reach us already but I haven't seen anything. If they want to start a discussion in mail separate from this bug they can send to `security@mozilla.org`, and if they'd like to take part in this bug we can add them to the CC list if they have an account on Bugzilla (which I guess also involves sending mail to that address to let us know who they are and that they're interested).

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1719203#c15)• 3 years ago |
|  | |

I'm more strongly preferring option #1 now, with the understanding that I'm not proposing completely reverting [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"). There are several image-related operations on the context menu. The change in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri") was about making them do what a user expected if the URL was modified by an extension via the WebRequest API, since the extension couldn't make the same alteration when the image was handled by the privileged context menu code. We could revert "Copy Image Link" to the ***URL in the image link*** to fix this problem, while continuing to use the final URL for the rest ("Open Image in New Tab", "Save Image As...", "Copy Image", "Email Image", and "Set Image as Desktop Background" -- did I miss any?).

It's fortuitous this context menu label recently changed in [bug 1690561](/show_bug.cgi?id=1690561 "VERIFIED FIXED - Adjust content context menu item labels for clarity/brevity"). The previous text, "Copy Image Location", would more likely be understood by users as implying the image's final URL, while "Link" gives us more leeway to make this change.

If someone really needs to copy the final URL they could "Open Image in New Tab" and copy the URL from there, or use DevTools to observe the network requests. Most of the time this workaround won't be necessary and users won't notice a difference, since the two URLs will be identical or the first will reliably redirect.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1719203#c16)• 3 years ago |
|  | |

I concur with your preference, Dan: We should fix this for "Copy Image Links" and match Chrome behavior.

Even though, we rate this one as "sec-low", I want to acknowledge that abusing "Copy Image Link" to steal cross-origin tokens is a nice trick.

This attack requires an unexpected user interaction, we can't expect users to understand that the "Image Link" is in fact a link to non-image content that contains sensitive URL information. So, it's really worth fixing.

(As an aside, I fully expect high-value websites to defend against attacks like this, by employing a reasonable "Sec-Fetch-Dest" check as a mitigation. Furthermore, I'd expect a check that isn't denying "image" destinations, but rather allowing the intended and expected destinations only).

|  | [arturjanc](/user_profile?user_id=612321) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1719203#c17)• 3 years ago |
|  | |

The discussion on this bug is already quite comprehensive, but I figured I'd chime in with a couple of additional comments in favor of Option 1:

1. As the reporter notes, there are a number of common, sensitive auth flows (including Google's) where a secret token gets appended in a redirect URL. The current behavior leads to a situation where copy-and-pasting an image URL can lead to account takeover; while this does require social engineering, it seems like an unnecessary footgun.
2. The web platform protects post-redirect URLs from being revealed cross-origin (e.g. in CORS or for CSP reporting: <https://lists.w3.org/Archives/Public/public-webappsec/2014Feb/0036.html>). Since this is already an important security boundary, upholding it in this case is probably also a good idea.

Re: `Sec-Fetch-Dest`, in principle sites can use it to reject requests that would be problematic here. However, in this particular case the endpoint which appends the token to the URL likely needs to support both navigations and resource loads (e.g. if a resource is legitimately loaded as an <img> but the credentials expired, the server can redirect to the endpoint which appends the token, which will then redirect back to the resource). In this case `Sec-Fetch-Dest: image` would be a legitimate value for that endpoint, so it may not be possible to denylist it.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1719203#c18)• 3 years ago |
|  | |

Thanks for the note about Sec-Fetch-Dest, Artur.

It seems we're all in agreement on how to fix this. Let's get this assigned.

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1719203#c19)• 3 years ago |
|  | |

I've come up with a slightly different technique to intercept a redirect chain that uses a `content-security-policy-report-only: img-src` header and listen for the `securitypolicyviolation` event to infer which redirect step is being requested. Once the desired redirect step is reached, a call to `window.stop()` is made to stop the redirection chain.

This technique brings two major advantages for the attack:

(In reply to Ademar Nowasky Junior from [comment #2](/show_bug.cgi?id=1719203#c2 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> If the SIDT was not being invalidated after the first use, the attacker would be able to authenticate into the victim account through this attack.

1. Now the redirect chain is aborted before the targeted redirect URL is submitted to the network. This is useful in those cases where the target URL contains a token that would be invalidated after the first use.

(In reply to Daniel Veditz [:dveditz] from [comment #11](/show_bug.cgi?id=1719203#c11 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> The OAuth case worries me though, even though this could only be a small-scale or targeted attack. Not every OAuth-using site would be vulnerable -- most bounce from siteA->Auth->siteA and this bug's technique wouldn't work there.

2. Now it should work on cases like URL1->AUTH->URL1 where leaking the AUTH URL would not be possible with the previous technique that used a regular content-security-policy header to intercept the redirect chain.

The PoC I've sent to Google used this method to leak a valid token from their login flow. It shows a scenario where a "Search by Image" website instructs the user into searching for an image that is being displayed while being overlapped by the invisible malicious image tag.

PoC: <https://storage.googleapis.com/nowa0/gvrp/index.html>

Video: <https://youtu.be/80YsDLBo2Kc>

|  | [Dão Gottwald [:dao]](/user_profile?user_id=219124)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1719203#c20)• 3 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #11](/show_bug.cgi?id=1719203#c11 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> Dao: you were involved a little bit in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"). Do you know more of the history behind that change?

Sorry, no, but the plan you have agreed upon sounds good to me. I can take care of implementing this.

Assignee: nobody → dao+bmoStatus: UNCONFIRMED → ASSIGNEDEver confirmed: trueFlags: needinfo?(dao+bmo)Priority: -- → P1

|  | [Dão Gottwald [:dao]](/user_profile?user_id=219124)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1719203#c21)• 3 years ago |
|  | |

Attached file
[Bug 1719203 - Let "Copy Image Link" use the original URL before redirects. r=gijs](attachment.cgi?id=9241602)
— [Details](attachment.cgi?id=9241602&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a6648838_600971)• 3 years ago |

[Attachment #9241602](/attachment.cgi?id=9241602&action=edit "Bug 1719203 - Let \"Copy Image Link\" use the original URL before redirects. r=gijs") -
Attachment description: WIP: Bug 1719203 - Let "Copy Image Link" use the original URL before redirects. → Bug 1719203 - Let "Copy Image Link" use the original URL before redirects.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a6793904_447061)• 3 years ago |

Blocks: [CVE-2021-43531](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.")

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1719203#c22)• 3 years ago |
|  | |

Once this bug is resolved, check whether [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent") should be marked as a duplicate of this one.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a6817544_600971)• 3 years ago |

[Attachment #9241602](/attachment.cgi?id=9241602&action=edit "Bug 1719203 - Let \"Copy Image Link\" use the original URL before redirects. r=gijs") -
Attachment description: Bug 1719203 - Let "Copy Image Link" use the original URL before redirects. → Bug 1719203 - Let "Copy Image Link" use the original URL before redirects. r=gijs

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1719203#c24)• 3 years ago |
|  | |

Let "Copy Image Link" use the original URL before redirects. r=Gijs

<https://hg.mozilla.org/integration/autoland/rev/bda4a0ce2d5ccb6e820818859ff03d8e7cd31001>

<https://hg.mozilla.org/mozilla-central/rev/bda4a0ce2d5c>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 94 Branch

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1719203#c25)• 3 years ago |
|  | |

(In reply to Ademar Nowasky Junior from [comment #19](/show_bug.cgi?id=1719203#c19 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> I've come up with a slightly different technique to intercept a redirect chain that uses a `content-security-policy-report-only: img-src` header and listen for the `securitypolicyviolation` event to infer which redirect step is being requested. Once the desired redirect step is reached, a call to `window.stop()` is made to stop the redirection chain.
>
> This technique brings two major advantages for the attack:
>
> (In reply to Ademar Nowasky Junior from [comment #2](/show_bug.cgi?id=1719203#c2 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))
>
> > If the SIDT was not being invalidated after the first use, the attacker would be able to authenticate into the victim account through this attack.
>
> 1. Now the redirect chain is aborted before the targeted redirect URL is submitted to the network. This is useful in those cases where the target URL contains a token that would be invalidated after the first use.
>
> (In reply to Daniel Veditz [:dveditz] from [comment #11](/show_bug.cgi?id=1719203#c11 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))
>
> > The OAuth case worries me though, even though this could only be a small-scale or targeted attack. Not every OAuth-using site would be vulnerable -- most bounce from siteA->Auth->siteA and this bug's technique wouldn't work there.
>
> 2. Now it should work on cases like URL1->AUTH->URL1 where leaking the AUTH URL would not be possible with the previous technique that used a regular content-security-policy header to intercept the redirect chain.
>
> The PoC I've sent to Google used this method to leak a valid token from their login flow. It shows a scenario where a "Search by Image" website instructs the user into searching for an image that is being displayed while being overlapped by the invisible malicious image tag.
>
> PoC: <https://storage.googleapis.com/nowa0/gvrp/index.html>
>
> Video: <https://youtu.be/80YsDLBo2Kc>

@Daniel, will this meet the bar for a reward? Thanks

Flags: needinfo?(dveditz)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1719203#c26)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1719203&comment_id=15582187 "1 revision") |
|  | |

(In reply to Ademar Nowasky Junior from [comment #25](/show_bug.cgi?id=1719203#c25 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> @Daniel, will this meet the bar for a reward? Thanks

The bounty committee usually meets once a week, and will probably discuss this now that the issue has closed. Their decision will get posted in the bug.

Flags: needinfo?(dveditz)

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1719203#c27)• 3 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #26](/show_bug.cgi?id=1719203#c26 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> (In reply to Ademar Nowasky Junior from [comment #25](/show_bug.cgi?id=1719203#c25 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))
>
> > @Daniel, will this meet the bar for a reward? Thanks
>
> The bounty committee usually meets once a week, and will probably discuss this now that the issue has closed. Their decision will get posted in the bug.

Alright! Thanks

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a6882857_447061)• 3 years ago |

Flags: needinfo?(mats)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a6889706_553429)• 3 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1719203#c28)• 3 years ago |
|  | |

Are we fine with this riding the trains or do you want 93 uplift? Last beta is today, AIUI.

Flags: needinfo?(pascalc)Flags: needinfo?(dao+bmo)

|  | [Petruta Horea [:phorea], Desktop Test Engineering](/user_profile?user_id=475155) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1719203#c29)• 3 years ago |
|  | |

For verifying this bug I used the test cases provided (`poc.html`, `poc2.html` and `poc3 - comment 19`) and the steps from duplicate [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent").

I can confirm that the scenario described in [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent") no longer reproduces with latest Nightly 94.0a1 2021-09-26.

As for the testcases attached to this bug (`poc.html` and `poc2.html`), I see no difference between 92RC (affected) and latest Nightly (fixed). The pop-up and the console errors are the same in both Firefox versions.

For <https://storage.googleapis.com/nowa0/gvrp/index.html> ([comment 19](/show_bug.cgi?id=1719203#c19 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")), the image is not loaded neither in Nightly nor in older Fx versions.

Can someone please advise on how to further verify this bug using the provided testcases? Thank you!

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1719203#c30)• 3 years ago |
|  | |

(In reply to Petruta Horea [:phorea] from [comment #29](/show_bug.cgi?id=1719203#c29 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> For verifying this bug I used the test cases provided (`poc.html`, `poc2.html` and `poc3 - comment 19`) and the steps from duplicate [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent").
>
> I can confirm that the scenario described in [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent") no longer reproduces with latest Nightly 94.0a1 2021-09-26.
>
> As for the testcases attached to this bug (`poc.html` and `poc2.html`), I see no difference between 92RC (affected) and latest Nightly (fixed). The pop-up and the console errors are the same in both Firefox versions.
>
> For <https://storage.googleapis.com/nowa0/gvrp/index.html> ([comment 19](/show_bug.cgi?id=1719203#c19 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")), the image is not loaded neither in Nightly nor in older Fx versions.
>
> Can someone please advise on how to further verify this bug using the provided testcases? Thank you!

`poc.html` and `poc2.html` are now with broken links so they will not work anymore.

To verify this bug using the `https://storage.googleapis.com/nowa0/gvrp/index.html` PoC, you may need to disable Firefox Enhanced Tracking Protection and make sure you are logged into a Google account.

The bug seems to be fixed on 94.0a1 (2021-09-27).

|  | [Dão Gottwald [:dao]](/user_profile?user_id=219124)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1719203#c31)• 3 years ago |
|  | |

I don't think we should uplift this.

Flags: needinfo?(dao+bmo)

|  | [Petruta Horea [:phorea], Desktop Test Engineering](/user_profile?user_id=475155) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1719203#c32)• 3 years ago |
|  | |

Tested on latest Nightly 94.0a1 using Win 10 64-bit and Mac OSX 10.14.6.

(In reply to Ademar Nowasky Junior from [comment #30](/show_bug.cgi?id=1719203#c30 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> `poc.html` and `poc2.html` are now with broken links so they will not work anymore.
>
> To verify this bug using the `https://storage.googleapis.com/nowa0/gvrp/index.html` PoC, you may need to disable Firefox Enhanced Tracking Protection and make sure you are logged into a Google account.
>
> The bug seems to be fixed on 94.0a1 (2021-09-27).

Thank you!

I followed the instructions, however the image is still not displayed. Right clicking and then selecting "Paste" in the "Paste the Image Link" field, does paste the image url. First time I try on a clean profile, it will show bellow the `Leaked URL: <address bar url>` (or nothing) and the next times I try, the imgur url is shown as leaked: `Leaked URL: https://i.imgur.com/9qfP4d9.jpg`.

The following error is displayed in the web console:

`Uncaught leak :) index.html:293:21 onpaste https://storage.googleapis.com/nowa0/gvrp/ index.html:293 receiveMessage resource://gre/actors/ControllersChild.jsm:14`

Chrome browser has the same behavior. I wasn't able to expose the google account. Based on this and the above comments I'm marking this as verified.

Status: RESOLVED → VERIFIED
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=verified)Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a7343127_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a7354459_75935)• 3 years ago |

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)Flags: needinfo?(pascalc) → in-testsuite+

|  | [Ademar Nowasky Junior](/user_profile?user_id=678218)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1719203#c33)• 3 years ago |
|  | |

Any plans to uplift this to Firefox ESR?

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1719203#c34)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1719203&comment_id=15609512 "1 revision") |
|  | |

This bug requires considerable user interaction for exploitation, and depends on specific circumstances for a website in order to be security-sensitive. I'm 50/50 on this one, I'd be fine with uplifting, but also fine if we did not.

Gijs/Dao: Should we uplift the fix in this bug and [bug 1659155](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") to ESR91?

Flags: needinfo?(gijskruitbosch+bugs)Flags: needinfo?(dao+bmo)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1719203#c35)• 3 years ago |
|  | |

(In reply to Rob Wu [:robwu] from [comment #34](/show_bug.cgi?id=1719203#c34 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> This bug requires considerable user interaction for exploitation, and depends on specific circumstances for a website in order to be security-sensitive. I'm 50/50 on this one, I'd be fine with uplifting, but also fine if we did not.
>
> Gijs/Dao: Should we uplift the fix in this bug and [bug 1659155](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") to ESR91?

Dão said no earlier:

(In reply to Dão Gottwald [::dao] from [comment #31](/show_bug.cgi?id=1719203#c31 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

> I don't think we should uplift this.

but I'm not sure if that was just about beta 93; we have more baking time to consider for 91. Either way, I defer to Dão's judgment.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a9670046_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main94+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1719203#c36)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9248025)
— [Details](attachment.cgi?id=9248025&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a13020424_428608)• 3 years ago |

Alias: CVE-2021-43532

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a36069170_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1719203#a91578573_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1719203&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Ademar Nowasky Junior](/user_profile?user_id=678218)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


