```
{
  "vulnerability": {
    "cve_id": "CVE-2021-43305",
    "description": "Heap buffer overflow in Clickhouse's LZ4 compression codec when parsing a malicious query. There is no verification that the copy operations in the LZ4::decompressImpl loop and especially the arbitrary copy operation wildCopy<copy_amount>(op, ip, copy_end), don&#8217;t exceed the destination buffer&#8217;s limits. This issue is very similar to CVE-2021-43304, but the vulnerable copy operation is in a different wildCopy call.",
    "technical_details": "The vulnerability is located in the LZ4::decompressImpl function, specifically in the wildCopy operation. The function does not validate if the copy operation exceeds the destination buffer limits. The attacker can provide a crafted compressed data with a header that has a smaller decompressed size compared to the actual size of the compressed data, which can lead to a heap buffer overflow when the wildCopy function is executed.",
    "affected_components": [
      "LZ4 compression codec in ClickHouse"
    ],
    "root_cause": "Lack of bounds check in the LZ4 decompression implementation",
    "vulnerabilities": [
      "Heap buffer overflow"
    ],
    "impact": "Remote code execution (RCE), crash of the ClickHouse server, memory corruption",
    "attack_vector": "Parsing a malicious query with crafted compressed data.",
     "required_capabilities": "Authenticated user with read permissions to ClickHouse server. Ability to send malformed compressed data."
  }
}
```