=== Content from github.com_10017be0_20250114_232603.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fsecurity%2Fadvisories%2FGHSA-25mp-g6fv-mqxx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fsecurity%2Fadvisories%2FGHSA-25mp-g6fv-mqxx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   129k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  606](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

# Unexpected server crash in Next.js versions above 11.1.0 and below 12.0.5

High

[timneutkens](/timneutkens)
published
GHSA-25mp-g6fv-mqxx
Dec 6, 2021

## Package

npm

next
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

< 12.0.5

## Patched versions

12.0.5,11.1.3

## Description

### Impact

* **Affected:** All of the following must be true to be affected by this CVE
  + Next.js versions above `v11.1.0` and below `v12.0.5`
  + Node.js above `v15.0.0` being used
  + Using `next start` or a [custom server](https://nextjs.org/docs/advanced-features/custom-server)
* **Not affected**: Deployments on Vercel ([vercel.com](https://vercel.com)) are not affected along with similar environments where invalid requests are filtered before reaching Next.js.

### Patches

<https://github.com/vercel/next.js/releases/tag/v12.0.5>

<https://github.com/vercel/next.js/releases/tag/v11.1.3>

### Severity

High

### CVE ID

CVE-2021-43803

### Weaknesses

No CWEs

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_2d9e683a_20250114_232555.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fpull%2F32080)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fpull%2F32080)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   129k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  606](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fvercel%2Fnext.js%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fvercel%2Fnext.js%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix server be killed by handling unhandled promise with status 500 #32080

 Closed

[chentsulin](/chentsulin)
wants to merge
1
commit into
[vercel:canary](/vercel/next.js/tree/canary "vercel/next.js:canary")
from
chentsulin:fix-UnhandledPromiseRejection

 Closed

# [Fix server be killed by handling unhandled promise with status 500](#top) #32080

[chentsulin](/chentsulin)
wants to merge
1
commit into
[vercel:canary](/vercel/next.js/tree/canary "vercel/next.js:canary")
from
chentsulin:fix-UnhandledPromiseRejection

[Conversation
2](/vercel/next.js/pull/32080)
[Commits
1](/vercel/next.js/pull/32080/commits)
[Checks
0](/vercel/next.js/pull/32080/checks)
[Files changed](/vercel/next.js/pull/32080/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![chentsulin](https://avatars.githubusercontent.com/u/3382565?s=60&v=4)](/chentsulin)

Copy link

Contributor

### @chentsulin **[chentsulin](/chentsulin)** commented [Dec 3, 2021](#issue-1070478437) ‚Ä¢ edited Loading

Fixes #32075.

Catching the whole request handling block seems reasonable to me. The server should not exit the process just because one request error happens.

## Bug

* Related issues linked using `fixes #number`

Sorry, something went wrong.

All reactions

[![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=40&v=4)](/chentsulin)

`[Fix server be killed by handling unhandled promise with status 500](/vercel/next.js/pull/32080/commits/98802333570664794ff88f40cdd1637f988c7efe "Fix server be killed by handling unhandled promise with status 500")`

`[9880233](/vercel/next.js/pull/32080/commits/98802333570664794ff88f40cdd1637f988c7efe)`

 [![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=40&u=536713f6c30e718b10509f649e3ffa0585f911fe&v=4)](/chentsulin)
[chentsulin](/chentsulin)
requested review from
[huozhi](/huozhi),
[ijjk](/ijjk),
[shuding](/shuding) and
[timneutkens](/timneutkens)
as [code owners](/vercel/next.js/blob/647c06b339ccabb5ee583cbdd32e12b8af6b0fd4/.github/CODEOWNERS#L4)
[December 3, 2021 11:10](#event-5711460932)

[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&u=0d3d36a4bef923933ffa54c609191dbae9988642&v=4)](/ijjk)
[ijjk](/ijjk)
added
the
[type: next](/vercel/next.js/labels/type%3A%20next)
label
[Dec 3, 2021](#event-5711461146)

[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=80&u=0d3d36a4bef923933ffa54c609191dbae9988642&v=4)](/ijjk)

Copy link

Member

### **[ijjk](/ijjk)** commented [Dec 3, 2021](#issuecomment-985445331)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Stats from current PR **Default Build** (Increase detected ‚ö†Ô∏è)  **General** Overall increase ‚ö†Ô∏è  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | buildDuration | 24.4s | 24s | -344ms | | buildDurationCached | 4.5s | 4.4s | -167ms | | nodeModulesSize | 347 MB | 347 MB | ‚ö†Ô∏è +627 B |    **Page Load Tests** Overall increase ‚úì  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | / failed reqs | 0 | 0 | ‚úì | | / total time (seconds) | 4.078 | 4.081 | 0 | | / avg req/sec | 613.05 | 612.64 | ‚ö†Ô∏è -0.41 | | /error-in-render failed reqs | 0 | 0 | ‚úì | | /error-in-render total time (seconds) | 2.166 | 2.078 | -0.09 | | /error-in-render avg req/sec | 1154.37 | 1202.98 | +48.61 |    **Client Bundles (main, webpack, commons)**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | 450.HASH.js gzip | 179 B | 179 B | ‚úì | | framework-HASH.js gzip | 42.2 kB | 42.2 kB | ‚úì | | main-HASH.js gzip | 28.4 kB | 28.4 kB | ‚úì | | webpack-HASH.js gzip | 1.45 kB | 1.45 kB | ‚úì | | Overall change | 72.3 kB | 72.3 kB | ‚úì |    **Legacy Client Bundles (polyfills)**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | polyfills-HASH.js gzip | 31 kB | 31 kB | ‚úì | | Overall change | 31 kB | 31 kB | ‚úì |    **Client Pages**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | \_app-HASH.js gzip | 1.37 kB | 1.37 kB | ‚úì | | \_error-HASH.js gzip | 194 B | 194 B | ‚úì | | amp-HASH.js gzip | 312 B | 312 B | ‚úì | | css-HASH.js gzip | 326 B | 326 B | ‚úì | | dynamic-HASH.js gzip | 2.38 kB | 2.38 kB | ‚úì | | head-HASH.js gzip | 350 B | 350 B | ‚úì | | hooks-HASH.js gzip | 635 B | 635 B | ‚úì | | image-HASH.js gzip | 4.49 kB | 4.49 kB | ‚úì | | index-HASH.js gzip | 263 B | 263 B | ‚úì | | link-HASH.js gzip | 1.87 kB | 1.87 kB | ‚úì | | routerDirect..HASH.js gzip | 321 B | 321 B | ‚úì | | script-HASH.js gzip | 383 B | 383 B | ‚úì | | withRouter-HASH.js gzip | 318 B | 318 B | ‚úì | | 85e02e95b279..7e3.css gzip | 107 B | 107 B | ‚úì | | Overall change | 13.3 kB | 13.3 kB | ‚úì |    **Client Build Manifests**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | \_buildManifest.js gzip | 460 B | 460 B | ‚úì | | Overall change | 460 B | 460 B | ‚úì |    **Rendered Page Sizes**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | index.html gzip | 533 B | 533 B | ‚úì | | link.html gzip | 546 B | 546 B | ‚úì | | withRouter.html gzip | 527 B | 527 B | ‚úì | | Overall change | 1.61 kB | 1.61 kB | ‚úì |     ---   **Default Build with SWC**  **General** Overall increase ‚ö†Ô∏è  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | buildDuration | 27.4s | 26.4s | -1s | | buildDurationCached | 4.5s | 4.4s | -96ms | | nodeModulesSize | 347 MB | 347 MB | ‚ö†Ô∏è +627 B |    **Page Load Tests** Overall increase ‚úì  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | / failed reqs | 0 | 0 | ‚úì | | / total time (seconds) | 4.146 | 4.056 | -0.09 | | / avg req/sec | 603.02 | 616.36 | +13.34 | | /error-in-render failed reqs | 0 | 0 | ‚úì | | /error-in-render total time (seconds) | 2.175 | 2.192 | ‚ö†Ô∏è +0.02 | | /error-in-render avg req/sec | 1149.51 | 1140.64 | ‚ö†Ô∏è -8.87 |    **Client Bundles (main, webpack, commons)**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | 450.HASH.js gzip | 179 B | 179 B | ‚úì | | framework-HASH.js gzip | 42.3 kB | 42.3 kB | ‚úì | | main-HASH.js gzip | 28.6 kB | 28.6 kB | ‚úì | | webpack-HASH.js gzip | 1.44 kB | 1.44 kB | ‚úì | | Overall change | 72.5 kB | 72.5 kB | ‚úì |    **Legacy Client Bundles (polyfills)**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | polyfills-HASH.js gzip | 31 kB | 31 kB | ‚úì | | Overall change | 31 kB | 31 kB | ‚úì |    **Client Pages**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | \_app-HASH.js gzip | 1.35 kB | 1.35 kB | ‚úì | | \_error-HASH.js gzip | 180 B | 180 B | ‚úì | | amp-HASH.js gzip | 305 B | 305 B | ‚úì | | css-HASH.js gzip | 321 B | 321 B | ‚úì | | dynamic-HASH.js gzip | 2.37 kB | 2.37 kB | ‚úì | | head-HASH.js gzip | 342 B | 342 B | ‚úì | | hooks-HASH.js gzip | 622 B | 622 B | ‚úì | | image-HASH.js gzip | 4.53 kB | 4.53 kB | ‚úì | | index-HASH.js gzip | 256 B | 256 B | ‚úì | | link-HASH.js gzip | 1.9 kB | 1.9 kB | ‚úì | | routerDirect..HASH.js gzip | 314 B | 314 B | ‚úì | | script-HASH.js gzip | 375 B | 375 B | ‚úì | | withRouter-HASH.js gzip | 309 B | 309 B | ‚úì | | 85e02e95b279..7e3.css gzip | 107 B | 107 B | ‚úì | | Overall change | 13.3 kB | 13.3 kB | ‚úì |    **Client Build Manifests**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | \_buildManifest.js gzip | 458 B | 458 B | ‚úì | | Overall change | 458 B | 458 B | ‚úì |    **Rendered Page Sizes**  |  | vercel/next.js canary | chentsulin/next.js fix-UnhandledPromiseRejection | Change | | --- | --- | --- | --- | | index.html gzip | 533 B | 533 B | ‚úì | | link.html gzip | 546 B | 546 B | ‚úì | | withRouter.html gzip | 528 B | 528 B | ‚úì | | Overall change | 1.61 kB | 1.61 kB | ‚úì |     Commit: [9880233](https://github.com/vercel/next.js/commit/98802333570664794ff88f40cdd1637f988c7efe) |

All reactions

Sorry, something went wrong.

[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&u=0d3d36a4bef923933ffa54c609191dbae9988642&v=4)](/ijjk)
[ijjk](/ijjk)
mentioned this pull request
[Dec 3, 2021](#ref-pullrequest-1070745984)

[Ensure invalid URLs respond with 400 correctly
#32092](/vercel/next.js/pull/32092)
 Merged

3 tasks

[![ijjk](https://avatars.githubusercontent.com/u/22380829?s=60&v=4)](/ijjk)

**[ijjk](/ijjk)**
reviewed
[Dec 3, 2021](#pullrequestreview-822853205)

 [View reviewed changes](/vercel/next.js/pull/32080/files/98802333570664794ff88f40cdd1637f988c7efe)

Copy link

Member

### @ijjk **[ijjk](/ijjk)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hi, I opened an alternative PR for this [here](https://github.com/vercel/next.js/pull/32092) which includes responding with a 400 (bad request) for this case and adds some tests, thanks for the PR though!

Sorry, something went wrong.

 üëç
2
 chentsulin and Fonger reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

[![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=40&u=536713f6c30e718b10509f649e3ffa0585f911fe&v=4)](/chentsulin)
[chentsulin](/chentsulin)
closed this
[Dec 3, 2021](#event-5713377799)

 [![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=40&u=536713f6c30e718b10509f649e3ffa0585f911fe&v=4)](/chentsulin)
[chentsulin](/chentsulin)
deleted the
fix-UnhandledPromiseRejection

branch
[December 3, 2021 17:10](#event-5713378592)

[kodiakhq](/apps/kodiakhq) bot
pushed a commit
that referenced
this pull request
[Dec 3, 2021](#ref-commit-6d98b4f)
[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&u=0d3d36a4bef923933ffa54c609191dbae9988642&v=4)](/ijjk)

`[Ensure invalid URLs respond with 400 correctly (](/vercel/next.js/commit/6d98b4fb4315dec1badecf0e9bdc212a4272b264 "Ensure invalid URLs respond with 400 correctly (#32092)

This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: https://github.com/vercel/next.js/issues/32075
Closes: https://github.com/vercel/next.js/pull/32080")[#32092](https://github.com/vercel/next.js/pull/32092)[)](/vercel/next.js/commit/6d98b4fb4315dec1badecf0e9bdc212a4272b264 "Ensure invalid URLs respond with 400 correctly (#32092)

This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: https://github.com/vercel/next.js/issues/32075
Closes: https://github.com/vercel/next.js/pull/32080")`
‚Ä¶

`[6d98b4f](/vercel/next.js/commit/6d98b4fb4315dec1badecf0e9bdc212a4272b264)`

```
This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: <https://github.com/vercel/next.js/issues/32075>
Closes: [#32080](https://github.com/vercel/next.js/pull/32080)
```

[![@vercel](https://avatars.githubusercontent.com/u/14985020?s=40&v=4)](/vercel)
[vercel](/vercel)
locked as **resolved** and limited conversation to collaborators
[Jan 27, 2022](#event-5960790304)

[natew](/natew)
pushed a commit
to natew/next.js
that referenced
this pull request
[Feb 16, 2022](#ref-commit-b92ebe7)
[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&u=0d3d36a4bef923933ffa54c609191dbae9988642&v=4)](/ijjk) [![@natew](https://avatars.githubusercontent.com/u/12100?s=40&v=4)](/natew)

`[Ensure invalid URLs respond with 400 correctly (](/natew/next.js/commit/b92ebe7830b60d18f2b1aa64eb801cd2443114d7 "Ensure invalid URLs respond with 400 correctly (#32092)

This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: https://github.com/vercel/next.js/issues/32075
Closes: https://github.com/vercel/next.js/pull/32080")[vercel#32092](https://github.com/vercel/next.js/pull/32092)[)](/natew/next.js/commit/b92ebe7830b60d18f2b1aa64eb801cd2443114d7 "Ensure invalid URLs respond with 400 correctly (#32092)

This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: https://github.com/vercel/next.js/issues/32075
Closes: https://github.com/vercel/next.js/pull/32080")`
‚Ä¶

`[b92ebe7](/natew/next.js/commit/b92ebe7830b60d18f2b1aa64eb801cd2443114d7)`

```
This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: <https://github.com/vercel/next.js/issues/32075>
Closes: [vercel#32080](https://github.com/vercel/next.js/pull/32080)
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fpull%2F32080).

Reviewers

[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&v=4)](/ijjk) [ijjk](/ijjk)

ijjk left review comments

[![@huozhi](https://avatars.githubusercontent.com/u/4800338?s=40&v=4)](/huozhi) [huozhi](/huozhi)

 Awaiting requested review from huozhi

[![@shuding](https://avatars.githubusercontent.com/u/3676859?s=40&v=4)](/shuding) [shuding](/shuding)

 Awaiting requested review from shuding

[![@timneutkens](https://avatars.githubusercontent.com/u/6324199?s=40&v=4)](/timneutkens) [timneutkens](/timneutkens)

 Awaiting requested review from timneutkens

Assignees

No one assigned

Labels

[type: next](/vercel/next.js/labels/type%3A%20next)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=52&v=4)](/chentsulin) [![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=52&v=4)](/ijjk)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_47559b51_20250114_232557.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Freleases%2Ftag%2Fv11.1.3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Freleases%2Ftag%2Fv11.1.3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   129k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js/tree/v11.1.3)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  606](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js/tree/v11.1.3)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

1. [Releases](/vercel/next.js/releases)
2. [v11.1.3](/vercel/next.js/releases/tag/v11.1.3)

# v11.1.3

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/vercel/next.js/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v11.1.3)

 Loading

[View all tags](/vercel/next.js/tags)

![@timneutkens](https://avatars.githubusercontent.com/u/6324199?s=40&v=4)
[timneutkens](/timneutkens)
released this
04 Dec 22:10

¬∑
[17679 commits](/vercel/next.js/compare/v11.1.3...canary)
to canary
since this release

[v11.1.3](/vercel/next.js/tree/v11.1.3)

[`ec1a0f7`](/vercel/next.js/commit/ec1a0f7643172e5beba96e7be7d000471813cf69)

See <https://github.com/vercel/next.js/releases/v12.0.5> for details about this patch.

 Assets
2

 Loading

 üéâ
2
 ykzts and ladieman217 reacted with hooray emoji
 ‚ù§Ô∏è
6
 muco-rolle, nezdemkovski, kachkaev, ladieman217, sirLisko, and tlhfckoctbcr reacted with heart emoji
 üöÄ
3
 nezdemkovski, ladieman217, and mrocha98 reacted with rocket emoji

All reactions

* üéâ
  2 reactions
* ‚ù§Ô∏è
  6 reactions
* üöÄ
  3 reactions

 8 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_5ea64a44_20250114_232601.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Freleases%2Fv12.0.5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Freleases%2Fv12.0.5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   129k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js/tree/v12.0.5)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  606](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js/tree/v12.0.5)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

1. [Releases](/vercel/next.js/releases)
2. [v12.0.5](/vercel/next.js/releases/v12.0.5)

# v12.0.5

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/vercel/next.js/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v12.0.5)

 Loading

[View all tags](/vercel/next.js/tags)

![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&v=4)
[ijjk](/ijjk)
released this
03 Dec 23:49

¬∑
[16688 commits](/vercel/next.js/compare/v12.0.5...canary)
to canary
since this release

[v12.0.5](/vercel/next.js/tree/v12.0.5)

[`b6162bb`](/vercel/next.js/commit/b6162bb6b6b46788ef2ae700d81c99e94d903900)

**This upgrade is completely backward-compatible and recommended for all users on versions below 12.0.5. A backport of the patch to Next.js 11 is available as 11.1.3.**

When a URL is provided to `next-server` that cannot be parsed, an `unhandledPromiseRejection` could occur. On Node.js versions < `v15.0.0` this isn't a fatal issue as only a warning is shown. However, in Node.js versions > `v15.0.0`, this causes the server process to exit, which can result in unexpected server crashes.

## How to Upgrade

* We have released patch versions for both the stable and canary channels of Next.js.
* To upgrade run `npm install next@latest --save`

## Impact

* **Affected:** All of the following must be true to be affected
  + Next.js versions above `v11.1.0` and below `v12.0.5`
  + Node.js above `v15.0.0` being used
  + Using `next start` or a [custom server](https://nextjs.org/docs/advanced-features/custom-server)
* **Not affected**: Deployments on Vercel ([vercel.com](https://vercel.com)) are not affected along with similar environments where invalid requests are filtered before reaching Next.js.

We recommend everyone to upgrade regardless of whether you can reproduce the issue or not.

### How to Assess Impact

If you are running Node.js > `v15.0.0` with Next.js, you can filter any server error logs for `ERR_INVALID_URL`.

## What is Being Done

As Next.js has grown in popularity and usage by enterprises, it has received the attention of security researchers and auditors. We are thankful to GitHub user `hopeless-programmer-online` for their investigation and discovery of the original bug.

We've landed a patch that ensures this is handled properly so the `unhandledPromiseRejection` issue no longer occurs.

Regression tests for this attack were added to the [security](https://github.com/vercel/next.js/blob/canary/test/integration/production/test/security.js) integration test suite

* A public CVE is requested.
* We encourage responsible disclosure of future reports. Please email us at `security@vercel.com`. We are actively monitoring this mailbox.

---

### Core Changes

* Add a swc transform for removal of `console.*` calls.: [#31449](https://github.com/vercel/next.js/pull/31449)
* Support ESLint v8: [#29865](https://github.com/vercel/next.js/pull/29865)
* fix: allow `next lint` without `eslint-config-next` installed: [#29823](https://github.com/vercel/next.js/pull/29823)
* Remove TextEncoder and TextDecoder wrappers: [#31490](https://github.com/vercel/next.js/pull/31490)
* simplify output messages: [#31454](https://github.com/vercel/next.js/pull/31454)
* update webpack: [#31455](https://github.com/vercel/next.js/pull/31455)
* NextResponse: add `.json` static method: [#31483](https://github.com/vercel/next.js/pull/31483)
* Use \_error for development in streaming: [#31466](https://github.com/vercel/next.js/pull/31466)
* Refactor the middleware SSR loader: [#31508](https://github.com/vercel/next.js/pull/31508)
* Add detection for `Google-PageRenderer` bot: [#31521](https://github.com/vercel/next.js/pull/31521)
* Click-to-open error state for development overlay [#14461](https://github.com/vercel/next.js/issues/14461): [#21819](https://github.com/vercel/next.js/pull/21819)
* Ensure only one doctype is rendered: [#31534](https://github.com/vercel/next.js/pull/31534)
* Update swc: [#31540](https://github.com/vercel/next.js/pull/31540)
* Add/wasm build: [#31470](https://github.com/vercel/next.js/pull/31470)
* telemetry: track usage of 'optimizeFonts': [#31522](https://github.com/vercel/next.js/pull/31522)
* Make missing `Document` components an error: [#31505](https://github.com/vercel/next.js/pull/31505)
* Adjust AVIF size so that its smaller than WebP size: [#31494](https://github.com/vercel/next.js/pull/31494)
* Fix unhandled rejection on route change in dev: [#31554](https://github.com/vercel/next.js/pull/31554)
* Re-add native package folders and ensure wasm artifacts are downloaded: [#31561](https://github.com/vercel/next.js/pull/31561)
* Fix HMR for middleware [#30791](https://github.com/vercel/next.js/issues/30791): [#31548](https://github.com/vercel/next.js/pull/31548)
* Minor simplifications to `renderToWebStream`: [#31553](https://github.com/vercel/next.js/pull/31553)
* Fix accessing router before ready for HMR ping: [#31588](https://github.com/vercel/next.js/pull/31588)
* Implement SWC port of next-page-disallow-re-export-all-exports: [#31582](https://github.com/vercel/next.js/pull/31582)
* [ESLint] Prevent `no-html-link-for-pages` from warning for static files: [#31495](https://github.com/vercel/next.js/pull/31495)
* Move root div to an app wrapper: [#31596](https://github.com/vercel/next.js/pull/31596)
* Add types for geo lat and long: [#31624](https://github.com/vercel/next.js/pull/31624)
* Fix non-concurrent function \_document: [#31628](https://github.com/vercel/next.js/pull/31628)
* Remove outdated comment about string children being deprecated in `next/link`: [#30606](https://github.com/vercel/next.js/pull/30606)
* fix(middleware): consider localhost variations: [#31603](https://github.com/vercel/next.js/pull/31603)
* Update swc: [#31639](https://github.com/vercel/next.js/pull/31639)
* Extract next-swc Rust code into its own package: [#31635](https://github.com/vercel/next.js/pull/31635)
* Fix dev router usage before router initializing: [#31632](https://github.com/vercel/next.js/pull/31632)
* avoid mutating response.cookie options: [#31679](https://github.com/vercel/next.js/pull/31679)
* Add cookies and headers for request using in RSC: [#31623](https://github.com/vercel/next.js/pull/31623)
* Remove trace\_target env var in favor of .next/trace: [#31697](https://github.com/vercel/next.js/pull/31697)
* Add error link when hydration error occurs: [#31519](https://github.com/vercel/next.js/pull/31519)
* Fix initial compile timing incorrect measurement: [#31733](https://github.com/vercel/next.js/pull/31733)
* Lazily init getStaticPathsWorker: [#31760](https://github.com/vercel/next.js/pull/31760)
* Remove noop import: [#31722](https://github.com/vercel/next.js/pull/31722)
* update webpack: [#31759](https://github.com/vercel/next.js/pull/31759)
* Fix wasm loading: [#31772](https://github.com/vercel/next.js/pull/31772)
* Remove some watcher hacks and update version: [#31768](https://github.com/vercel/next.js/pull/31768)
* Improve and refactor some types: [#31704](https://github.com/vercel/next.js/pull/31704)
* read file in swc when no loaders follow the next-swc-loader: [#31682](https://github.com/vercel/next.js/pull/31682)
* Lazy-load postcss: [#31762](https://github.com/vercel/next.js/pull/31762)
* update webpack: [#31798](https://github.com/vercel/next.js/pull/31798)
* Ensure middleware order is preserved: [#31801](https://github.com/vercel/next.js/pull/31801)
* Refactor sandbox module cache: [#31822](https://github.com/vercel/next.js/pull/31822)
* Fix hydration middleware effects: [#31800](https://github.com/vercel/next.js/pull/31800)
* fix: support function components in \_document in no-page-custom-font: [#31560](https://github.com/vercel/next.js/pull/31560)
* Add support for removing React properties.: [#31606](https://github.com/vercel/next.js/pull/31606)
* Include submodules in exported type definition: [#28316](https://github.com/vercel/next.js/pull/28316)
* Move require.resolve into the module scope: [#31799](https://github.com/vercel/next.js/pull/31799)
* fix amp validator message format: [#31018](https://github.com/vercel/next.js/pull/31018)
* Fix auto export condition in edge SSR: [#31845](https://github.com/vercel/next.js/pull/31845)
* bugfix: href value is not defined when typing out the href: [#31813](https://github.com/vercel/next.js/pull/31813)
* Do not load external binding if local was found: [#31853](https://github.com/vercel/next.js/pull/31853)
* fix: rsc headers: [#31854](https://github.com/vercel/next.js/pull/31854)
* Add port and hostname options to Next Server: [#31858](https://github.com/vercel/next.js/pull/31858)
* Fix: Cannot assign to read only property 'children': [#31784](https://github.com/vercel/next.js/pull/31784)
* Fix disabling of built-in CSS support if there is a custom loader: [#31078](https://github.com/vercel/next.js/pull/31078)
* include no-document-import-in-page rule in plugin index: [#31890](https://github.com/vercel/next.js/pull/31890)
* Account for platform/arch not supported by napi-rs: [#31938](https://github.com/vercel/next.js/pull/31938)
* Removng prop writable checking in prod: [#31929](https://github.com/vercel/next.js/pull/31929)
* Enable default functional document when concurrentFeatures is enabled: [#31954](https://github.com/vercel/next.js/pull/31954)
* Stop using environment variables in `pages/_document`: [#31946](https://github.com/vercel/next.js/pull/31946)
* Fix image related link prop warning with react 18 beta: [#31895](https://github.com/vercel/next.js/pull/31895)
* Escape string when converting to regexp: [#31791](https://github.com/vercel/next.js/pull/31791)
* Add TS types for NextMiddleware: [#30578](https://github.com/vercel/next.js/pull/30578)
* fix(types): add missing ua type for NextRequest: [#31901](https://github.com/vercel/next.js/pull/31901)
* Ensure that external modules are not bundled into the client for RSC: [#31968](https://github.com/vercel/next.js/pull/31968)
* Resolve streaming data for flight requests: [#32010](https://github.com/vercel/next.js/pull/32010)
* Allow pre-release React 18 as peer: [#31991](https://github.com/vercel/next.js/pull/31991)
* fix(Link): Do not ignore onMouseEnter prop with absolute href: [#32012](https://github.com/vercel/next.js/pull/32012)
* add experimental.swcFileReading flag to disable file reading in swc: [#31995](https://github.com/vercel/next.js/pull/31995)
* Fix middleware types with skipLibCheck: false: [#32025](https://github.com/vercel/next.js/pull/32025)
* Include page for export errors for easier debugging: [#32013](https://github.com/vercel/next.js/pull/32013)
* avoid retaining webpack config too long: [#32053](https://github.com/vercel/next.js/pull/32053)
* Skip warnings for Image not rendered to the dom: [#32049](https://github.com/vercel/next.js/pull/32049)
* Improve exported root definitions: [#32077](https://github.com/vercel/next.js/pull/32077)
* Fix running server with Polyfilled fetch: [#31935](https://github.com/vercel/next.js/pull/31935)
* Ensure invalid URLs respond with 400 correctly: [#32092](https://github.com/vercel/next.js/pull/32092)
* Remove future.strictPostcssConfiguration config: [#32098](https://github.com/vercel/next.js/pull/32098)
* Revert "Fix running server with Polyfilled fetch ([#31935](https://github.com/vercel/next.js/pull/31935))": [#32100](https://github.com/vercel/next.js/pull/32100)

### Documentation Changes

* Update react-18.md: [#31476](https://github.com/vercel/next.js/pull/31476)
* Add docs for the Rust Compiler (SWC).: [#31467](https://github.com/vercel/next.js/pull/31467)
* Script examples: [#31181](https://github.com/vercel/next.js/pull/31181)
* Fix type declaration for API Routes response: [#31486](https://github.com/vercel/next.js/pull/31486)
* Update environment-variables.md: [#31525](https://github.com/vercel/next.js/pull/31525)
* Add middleware examples to custom page extensions: [#31545](https://github.com/vercel/next.js/pull/31545)
* Added guide for setting up Next.js with MDX: [#30869](https://github.com/vercel/next.js/pull/30869)
* Fix typo in MDX guide: [#31709](https://github.com/vercel/next.js/pull/31709)
* Added note on env vars: [#31237](https://github.com/vercel/next.js/pull/31237)
* docs(next-config): extend phase lines reference: [#31711](https://github.com/vercel/next.js/pull/31711)
* [Docs][Fix] Broken Link to API Reference: [#31820](https://github.com/vercel/next.js/pull/31820)
* Docs(router): Add type for url parameter: [#31737](https://github.com/vercel/next.js/pull/31737)
* SWC: Add error checks and tests to next-dynamic: [#31683](https://github.com/vercel/next.js/pull/31683)
* Docs(React 18): add missing `Suspense` import: [#31897](https://github.com/vercel/next.js/pull/31897)
* Docs(React 18): remove unnecessary `React` import: [#31900](https://github.com/vercel/next.js/pull/31900)
* IMPROVE: Middlerware Set Cookie API Ref: [#31707](https://github.com/vercel/next.js/pull/31707)
* Update `next export` documentation.: [#31465](https://github.com/vercel/next.js/pull/31465)
* Update Jest examples and docs: [#31633](https://github.com/vercel/next.js/pull/31633)
* Add note to docs about `sharp` memory usage on default Linux setup: [#31919](https://github.com/vercel/next.js/pull/31919)
* docs(Testing): Remove duplicate link: [#32071](https://github.com/vercel/next.js/pull/32071)

### Example Changes

* Replace old static path by public | typo: [#31573](https://github.com/vercel/next.js/pull/31573)
* Update README of cms-cosmic example: [#31701](https://github.com/vercel/next.js/pull/31701)
* 'imgix.cosmicjs.com' image domain in cms-cosmic example: [#31703](https://github.com/vercel/next.js/pull/31703)
* Fix pwa demo: [#31734](https://github.com/vercel/next.js/pull/31734)
* docs(examples): add secure flag explanation to with-iron-session: [#31896](https://github.com/vercel/next.js/pull/31896)
* [WIP] Add tracing to `with-sentry` example: [#30401](https://github.com/vercel/next.js/pull/30401)
* Fix with-mongo example by removing deprecated function: [#30675](https://github.com/vercel/next.js/pull/30675)
* grammatical error in alert.js: [#32062](https://github.com/vercel/next.js/pull/32062)

### Misc Changes

* Revert "Add docs for the Rust Compiler (SWC).": [#31484](https://github.com/vercel/next.js/pull/31484)
* Ensure wasm package.json is written before publish: [#31568](https://github.com/vercel/next.js/pull/31568)
* Update labeler.json
* Update labeler.json
* Update send-to-jaeger URL output: [#31563](https://github.com/vercel/next.js/pull/31563)
* Fixing typo in Documentation about Testing: [#31653](https://github.com/vercel/next.js/pull/31653)
* Add docs for the Next.js Compiler written in Rust (leveraging SWC): [#31485](https://github.com/vercel/next.js/pull/31485)
* Fix prettier linting
* Fix labels for release sections
* Fix musl build
* Enable require for swc\_bundler: [#31663](https://github.com/vercel/next.js/pull/31663)
* add test case: [#31691](https://github.com/vercel/next.js/pull/31691)
* Update swc: [#31816](https://github.com/vercel/next.js/pull/31816)
* docs(middleware): file extension consistency: [#31879](https://github.com/vercel/next.js/pull/31879)
* Remove unpurpose test: [#31898](https://github.com/vercel/next.js/pull/31898)
* Remove unnecessary workflow step : [#31943](https://github.com/vercel/next.js/pull/31943)
* Update swc: [#31963](https://github.com/vercel/next.js/pull/31963)
* docs(NextRequest): req.cookie => req.cookies: [#31975](https://github.com/vercel/next.js/pull/31975)
* Add next-swc to labeler
* Add Rich, Maedah, and Ismael to the docs label
* Updated Maedahs name in label gen config: [#32005](https://github.com/vercel/next.js/pull/32005)
* Fix copying swc binary for isolated tests locally: [#32026](https://github.com/vercel/next.js/pull/32026)
* Lock node version for CI: [#32057](https://github.com/vercel/next.js/pull/32057)
* Make CI build cache key more specific: [#32059](https://github.com/vercel/next.js/pull/32059)
* Remove "yarn jest" from Next.js repo scripts: [#32042](https://github.com/vercel/next.js/pull/32042)
* Fix the testall npm script: [#32081](https://github.com/vercel/next.js/pull/32081)

### Credits

Huge thanks to [@mzaien](https://github.com/mzaien), [@losfair](https://github.com/losfair), [@ykzts](https://github.com/ykzts), [@leerob](https://github.com/leerob), [@timneutkens](https://github.com/timneutkens), [@stefanprobst](https://github.com/stefanprobst), [@javivelasco](https://github.com/javivelasco), [@sokra](https://github.com/sokra), [@goncy](https://github.com/goncy), [@knezevicdev](https://github.com/knezevicdev), [@Kikobeats](https://github.com/Kikobeats), [@huozhi](https://github.com/huozhi), [@shuding](https://github.com/shuding), [@styfle](https://github.com/styfle), [@yang-feng-yfeng](https://github.com/yang-feng-yfeng), [@kdy1](https://github.com/kdy1), [@xuchaobei](https://github.com/xuchaobei), @elkevinwolf, [@padmaia](https://github.com/padmaia), [@kyliau](https://github.com/kyliau), [@devknoll](https://github.com/devknoll), [@fabienheureux](https://github.com/fabienheureux), [@hanneslund](https://github.com/hanneslund), [@nilskaspersson](https://github.com/nilskaspersson), [@Andarist](https://github.com/Andarist), [@mathcrln](https://github.com/mathcrln), [@ijjk](https://github.com/ijjk), [@dferber90](https://github.com/dferber90), [@molebox](https://github.com/molebox), [@FranciscoMoretti](https://github.com/FranciscoMoretti), [@benschwarz](https://github.com/benschwarz), @wendellhu95, [@gazdagergo](https://github.com/gazdagergo), [@imabp](https://github.com/imabp), [@ljosberinn](https://github.com/ljosberinn), [@samuliasmala](https://github.com/samuliasmala), [@lfades](https://github.com/lfades), [@ka2jun8](https://github.com/ka2jun8), [@monsonjeremy](https://github.com/monsonjeremy), [@pqt](https://github.com/pqt), [@vvo](https://github.com/vvo), [@leoortizz](https://github.com/leoortizz), [@michel-kraemer](https://github.com/michel-kraemer), [@thibautsabot](https://github.com/thibautsabot), [@MaedahBatool](https://github.com/MaedahBatool), [@lobsterkatie](https://github.com/lobsterkatie), [@ntkoopman](https://github.com/ntkoopman), [@delbaoliveira](https://github.com/delbaoliveira), [@iicdii](https://github.com/iicdii), [@j-mendez](https://github.com/j-mendez), [@chentsulin](https://github.com/chentsulin), [@ericmatthys](https://github.com/ericmatthys), [@lennym](https://github.com/lennym), [@balogunkeji](https://github.com/balogunkeji), and [@wnr](https://github.com/wnr) for helping!

### Contributors

* [![@benschwarz](https://avatars.githubusercontent.com/u/924?s=64&v=4)](https://github.com/benschwarz)
* [![@ykzts](https://avatars.githubusercontent.com/u/12539?s=64&v=4)](https://github.com/ykzts)
* [![@lennym](https://avatars.githubusercontent.com/u/117398?s=64&v=4)](https://github.com/lennym)
* [![@vvo](https://avatars.githubusercontent.com/u/123822?s=64&v=4)](https://github.com/vvo)
* [![@styfle](https://avatars.githubusercontent.com/u/229881?s=64&v=4)](https://github.com/styfle)
* [![@michel-kraemer](https://avatars.githubusercontent.com/u/295407?s=64&v=4)](https://github.com/michel-kraemer)
* [![@wnr](https://avatars.githubusercontent.com/u/719555?s=64&v=4)](https://github.com/wnr)
* [![@ericmatthys](https://avatars.githubusercontent.com/u/1154586?s=64&v=4)](https://github.com/ericmatthys)
* [![@sokra](https://avatars.githubusercontent.com/u/1365881?s=64&v=4)](https://github.com/sokra)
* [![@devknoll](https://avatars.githubusercontent.com/u/1477230?s=64&v=4)](https://github.com/devknoll)
* [![@javivelasco](https://avatars.githubusercontent.com/u/1634922?s=64&v=4)](https://github.com/javivelasco)
* [![@fabienheureux](https://avatars.githubusercontent.com/u/1702255?s=64&v=4)](https://github.com/fabienheureux)
* [![@dferber90](https://avatars.githubusercontent.com/u/1765075?s=64&v=4)](https://github.com/dferber90)
* [![@ntkoopman](https://avatars.githubusercontent.com/u/1769749?s=64&v=4)](https://github.com/ntkoopman)
* [![@Kikobeats](https://avatars.githubusercontent.com/u/2096101?s=64&v=4)](https://github.com/Kikobeats)
* [![@padmaia](https://avatars.githubusercontent.com/u/2865858?s=64&v=4)](https://github.com/padmaia)
* [![@kyliau](https://avatars.githubusercontent.com/u/2941178?s=64&v=4)](https://github.com/kyliau)
* [![@kevinwolfcr](https://avatars.githubusercontent.com/u/3157426?s=64&v=4)](https://github.com/kevinwolfcr)
* [![@chentsulin](https://avatars.githubusercontent.com/u/3382565?s=64&v=4)](https://github.com/chentsulin)
* [![@shuding](https://avatars.githubusercontent.com/u/3676859?s=64&v=4)](https://github.com/shuding)
* [![@lfades](https://avatars.githubusercontent.com/u/4278345?s=64&v=4)](https://github.com/lfades)
* [![@huozhi](https://avatars.githubusercontent.com/u/4800338?s=64&v=4)](https://github.com/huozhi)
* [![@iicdii](https://avatars.githubusercontent.com/u/4951716?s=64&v=4)](https://github.com/iicdii)
* [![@xuchaobei](https://avatars.githubusercontent.com/u/5110783?s=64&v=4)](https://github.com/xuchaobei)
* [![@nilskaspersson](https://avatars.githubusercontent.com/u/5513113?s=64&v=4)](https://github.com/nilskaspersson)
* [![@losfair](https://avatars.githubusercontent.com/u/6104981?s=64&v=4)](https://github.com/losfair)
* [![@pqt](https://avatars.githubusercontent.com/u/6316025?s=64&v=4)](https://github.com/pqt)
* [![@timneutkens](https://avatars.githubusercontent.com/u/6324199?s=64&v=4)](https://github.com/timneutkens)
* [![@goncy](https://avatars.githubusercontent.com/u/6494462?s=64&v=4)](https://github.com/goncy)
* [![@j-mendez](https://avatars.githubusercontent.com/u/8095978?s=64&v=4)](https://github.com/j-mendez)
* [![@monsonjeremy](https://avatars.githubusercontent.com/u/8846086?s=64&v=4)](https://github.com/monsonjeremy)
* [![@gazdagergo](https://avatars.githubusercontent.com/u/8988279?s=64&v=4)](https://github.com/gazdagergo)
* [![@leerob](https://avatars.githubusercontent.com/u/9113740?s=64&v=4)](https://github.com/leerob)
* [![@thibautsabot](https://avatars.githubusercontent.com/u/9283289?s=64&v=4)](https://github.com/thibautsabot)
* [![@Andarist](https://avatars.githubusercontent.com/u/9800850?s=64&v=4)](https://github.com/Andarist)
* [![@wzhudev](https://avatars.githubusercontent.com/u/12122021?s=64&v=4)](https://github.com/wzhudev)
* [![@ka2jun8](https://avatars.githubusercontent.com/u/12580072?s=64&v=4)](https://github.com/ka2jun8)
* [![@MaedahBatool](https://avatars.githubusercontent.com/u/12712988?s=64&v=4)](https://github.com/MaedahBatool)
* [![@samuliasmala](https://avatars.githubusercontent.com/u/14218719?s=64&v=4)](https://github.com/samuliasmala)
* [![@lobsterkatie](https://avatars.githubusercontent.com/u/14812505?s=64&v=4)](https://github.com/lobsterkatie)
* [![@FranciscoMoretti](https://avatars.githubusercontent.com/u/16997807?s=64&v=4)](https://github.com/FranciscoMoretti)
* [![@stefanprobst](https://avatars.githubusercontent.com/u/20753323?s=64&v=4)](https://github.com/stefanprobst)
* [![@knezevicdev](https://avatars.githubusercontent.com/u/21034293?s=64&v=4)](https://github.com/knezevicdev)
* [![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=64&v=4)](https://github.com/ijjk)
* [![@molebox](https://avatars.githubusercontent.com/u/22930449?s=64&v=4)](https://github.com/molebox)
* [![@hanneslund](https://avatars.githubusercontent.com/u/25056922?s=64&v=4)](https://github.com/hanneslund)
* [![@ljosberinn](https://avatars.githubusercontent.com/u/29307652?s=64&v=4)](https://github.com/ljosberinn)
* [![@kdy1](https://avatars.githubusercontent.com/u/29931815?s=64&v=4)](https://github.com/kdy1)
* [![@delbaoliveira](https://avatars.githubusercontent.com/u/32464864?s=64&v=4)](https://github.com/delbaoliveira)
* [![@mzaien](https://avatars.githubusercontent.com/u/43112535?s=64&v=4)](https://github.com/mzaien)
* [![@mathcrln](https://avatars.githubusercontent.com/u/44712449?s=64&v=4)](https://github.com/mathcrln)
* [![@balogunkeji](https://avatars.githubusercontent.com/u/46797265?s=64&v=4)](https://github.com/balogunkeji)
* [![@yang-feng-yfeng](https://avatars.githubusercontent.com/u/49683353?s=64&v=4)](https://github.com/yang-feng-yfeng)
* [![@imabp](https://avatars.githubusercontent.com/u/53480076?s=64&v=4)](https://github.com/imabp)
* [![@leoortizz](https://avatars.githubusercontent.com/u/83593673?s=64&v=4)](https://github.com/leoortizz)

benschwarz, ykzts, and 53 other contributors

 Assets
2

 Loading

 üëç
11
 trentprynn, mzaien, PointSingularity, testfailed, styfle, markozxuu, BenHakimIlyass, sergeichestakov, kjsik11, TkaczykAdam, and DSKonstantin reacted with thumbs up emoji
 üòÑ
3
 BenHakimIlyass, sergeichestakov, and TkaczykAdam reacted with laugh emoji
 üéâ
20
 mrocha98, shinnoki, fillon, ykzts, jasonkarjadi, mraxime, mzaien, imranbarbhuiya, Theofilos-Chamalis, testfailed, and 10 more reacted with hooray emoji
 ‚ù§Ô∏è
13
 erulabs, camdendotlol, mrocha98, mzaien, testfailed, alex-drocks, styfle, markozxuu, BenHakimIlyass, JohnGemstone, and 3 more reacted with heart emoji
 üöÄ
3
 BenHakimIlyass, sergeichestakov, and ZachStolz94 reacted with rocket emoji

All reactions

* üëç
  11 reactions
* üòÑ
  3 reactions
* üéâ
  20 reactions
* ‚ù§Ô∏è
  13 reactions
* üöÄ
  3 reactions

 28 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_064d67ee_20250114_232551.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fcommit%2F6d98b4fb4315dec1badecf0e9bdc212a4272b264)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fcommit%2F6d98b4fb4315dec1badecf0e9bdc212a4272b264)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=vercel%2Fnext.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vercel](/vercel)
/
**[next.js](/vercel/next.js)**
Public

* [Notifications](/login?return_to=%2Fvercel%2Fnext.js) You must be signed in to change notification settings
* [Fork
  27.4k](/login?return_to=%2Fvercel%2Fnext.js)
* [Star
   129k](/login?return_to=%2Fvercel%2Fnext.js)

* [Code](/vercel/next.js)
* [Issues
  3.1k](/vercel/next.js/issues)
* [Pull requests
  606](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

Additional navigation options

* [Code](/vercel/next.js)
* [Issues](/vercel/next.js/issues)
* [Pull requests](/vercel/next.js/pulls)
* [Discussions](/vercel/next.js/discussions)
* [Actions](/vercel/next.js/actions)
* [Security](/vercel/next.js/security)
* [Insights](/vercel/next.js/pulse)

## Commit

[Permalink](/vercel/next.js/commit/6d98b4fb4315dec1badecf0e9bdc212a4272b264)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Ensure invalid URLs respond with 400 correctly ([#32092](https://github.com/vercel/next.js/pull/32092))

[Browse files](/vercel/next.js/tree/6d98b4fb4315dec1badecf0e9bdc212a4272b264)
Browse the repository at this point in the history

```
This ensures we catch any errors in `handleRequest` so that we can respond with a 400 for invalid requests.

## Bug

- [x] Related issues linked using `fixes #number`
- [x] Integration tests added
- [ ] Errors have helpful link attached, see `contributing.md`

Fixes: <https://github.com/vercel/next.js/issues/32075>
Closes: [#32080](https://github.com/vercel/next.js/pull/32080)
```

* Loading branch information

[![@ijjk](https://avatars.githubusercontent.com/u/22380829?s=40&v=4)](/ijjk)

[ijjk](/vercel/next.js/commits?author=ijjk "View all commits by ijjk")
authored
Dec 3, 2021

1 parent
[1c199a5](/vercel/next.js/commit/1c199a5e4a158685007c006820e6eaec94796528)

commit 6d98b4f

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**198 additions**
and
**163 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* packages/next

  + build/swc

    - packages/next/build/swc/index.js
      [index.js](#diff-b3bf60b472b7bb06493a547602dc446d86a0e0f08f8a3b0c96662ae23fd95629)
  + server

    - packages/next/server/next-server.ts
      [next-server.ts](#diff-ea09101c272788873ce720075e4839f0254179af0a07259a107752cafb193949)
* test/integration/production/test

  + test/integration/production/test/security.js
    [security.js](#diff-e00c04be5037e176ecf7b7ce0aa3c0c6857ead04935efa47042de6f41cbf115b)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[packages/next/build/swc/index.js](#diff-b3bf60b472b7bb06493a547602dc446d86a0e0f08f8a3b0c96662ae23fd95629 "packages/next/build/swc/index.js")

Show comments

[View file](/vercel/next.js/blob/6d98b4fb4315dec1badecf0e9bdc212a4272b264/packages/next/build/swc/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | import { platform, arch } from 'os' |
|  |  | import { platformArchTriples } from '@napi-rs/triples' |
|  |  | import Log from '../output/log' |
|  |  | import \* as Log from '../output/log' |
|  |  |  |
|  |  | const ArchName = arch() |
|  |  | const PlatformName = platform() |
| Expand Down | |  |

332 changes: 170 additions & 162 deletions

332
[packages/next/server/next-server.ts](#diff-ea09101c272788873ce720075e4839f0254179af0a07259a107752cafb193949 "packages/next/server/next-server.ts")

Show comments

[View file](/vercel/next.js/blob/6d98b4fb4315dec1badecf0e9bdc212a4272b264/packages/next/server/next-server.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -359,206 +359,214 @@ export default class Server { |
|  |  | res: ServerResponse, |
|  |  | parsedUrl?: NextUrlWithParsedQuery |
|  |  | ): Promise<void> { |
|  |  | const urlParts = (req.url || '').split('?') |
|  |  | const urlNoQuery = urlParts[0] |
|  |  |  |
|  |  | if (urlNoQuery?.match(/(\\|\/\/)/)) { |
|  |  | const cleanUrl = normalizeRepeatedSlashes(req.url!) |
|  |  | res.setHeader('Location', cleanUrl) |
|  |  | res.setHeader('Refresh', `0;url=${cleanUrl}`) |
|  |  | res.statusCode = 308 |
|  |  | res.end(cleanUrl) |
|  |  | return |
|  |  | } |
|  |  | try { |
|  |  | const urlParts = (req.url || '').split('?') |
|  |  | const urlNoQuery = urlParts[0] |
|  |  |  |
|  |  | if (urlNoQuery?.match(/(\\|\/\/)/)) { |
|  |  | const cleanUrl = normalizeRepeatedSlashes(req.url!) |
|  |  | res.setHeader('Location', cleanUrl) |
|  |  | res.setHeader('Refresh', `0;url=${cleanUrl}`) |
|  |  | res.statusCode = 308 |
|  |  | res.end(cleanUrl) |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | setLazyProp({ req: req as any }, 'cookies', getCookieParser(req.headers)) |
|  |  | setLazyProp({ req: req as any }, 'cookies', getCookieParser(req.headers)) |
|  |  |  |
|  |  | // Parse url if parsedUrl not provided |
|  |  | if (!parsedUrl || typeof parsedUrl !== 'object') { |
|  |  | parsedUrl = parseUrl(req.url!, true) |
|  |  | } |
|  |  | // Parse url if parsedUrl not provided |
|  |  | if (!parsedUrl || typeof parsedUrl !== 'object') { |
|  |  | parsedUrl = parseUrl(req.url!, true) |
|  |  | } |
|  |  |  |
|  |  | // Parse the querystring ourselves if the user doesn't handle querystring parsing |
|  |  | if (typeof parsedUrl.query === 'string') { |
|  |  | parsedUrl.query = parseQs(parsedUrl.query) |
|  |  | } |
|  |  | // Parse the querystring ourselves if the user doesn't handle querystring parsing |
|  |  | if (typeof parsedUrl.query === 'string') { |
|  |  | parsedUrl.query = parseQs(parsedUrl.query) |
|  |  | } |
|  |  |  |
|  |  | // When there are hostname and port we build an absolute URL |
|  |  | const initUrl = |
|  |  | this.hostname && this.port |
|  |  | ? `http://${this.hostname}:${this.port}${req.url}` |
|  |  | : req.url |
|  |  | // When there are hostname and port we build an absolute URL |
|  |  | const initUrl = |
|  |  | this.hostname && this.port |
|  |  | ? `http://${this.hostname}:${this.port}${req.url}` |
|  |  | : req.url |
|  |  |  |
|  |  | addRequestMeta(req, '\_\_NEXT\_INIT\_URL', initUrl) |
|  |  | addRequestMeta(req, '\_\_NEXT\_INIT\_QUERY', { ...parsedUrl.query }) |
|  |  | addRequestMeta(req, '\_\_NEXT\_INIT\_URL', initUrl) |
|  |  | addRequestMeta(req, '\_\_NEXT\_INIT\_QUERY', { ...parsedUrl.query }) |
|  |  |  |
|  |  | const url = parseNextUrl({ |
|  |  | headers: req.headers, |
|  |  | nextConfig: this.nextConfig, |
|  |  | url: req.url?.replace(/^\/+/, '/'), |
|  |  | }) |
|  |  | const url = parseNextUrl({ |
|  |  | headers: req.headers, |
|  |  | nextConfig: this.nextConfig, |
|  |  | url: req.url?.replace(/^\/+/, '/'), |
|  |  | }) |
|  |  |  |
|  |  | if (url.basePath) { |
|  |  | req.url = replaceBasePath(req.url!, this.nextConfig.basePath) |
|  |  | addRequestMeta(req, '\_nextHadBasePath', true) |
|  |  | } |
|  |  | if (url.basePath) { |
|  |  | req.url = replaceBasePath(req.url!, this.nextConfig.basePath) |
|  |  | addRequestMeta(req, '\_nextHadBasePath', true) |
|  |  | } |
|  |  |  |
|  |  | if ( |
|  |  | this.minimalMode && |
|  |  | req.headers['x-matched-path'] && |
|  |  | typeof req.headers['x-matched-path'] === 'string' |
|  |  | ) { |
|  |  | const reqUrlIsDataUrl = req.url?.includes('/\_next/data') |
|  |  | const matchedPathIsDataUrl = |
|  |  | req.headers['x-matched-path']?.includes('/\_next/data') |
|  |  | const isDataUrl = reqUrlIsDataUrl || matchedPathIsDataUrl |
|  |  |  |
|  |  | let parsedPath = parseUrl( |
|  |  | isDataUrl ? req.url! : (req.headers['x-matched-path'] as string), |
|  |  | true |
|  |  | ) |
|  |  | if ( |
|  |  | this.minimalMode && |
|  |  | req.headers['x-matched-path'] && |
|  |  | typeof req.headers['x-matched-path'] === 'string' |
|  |  | ) { |
|  |  | const reqUrlIsDataUrl = req.url?.includes('/\_next/data') |
|  |  | const matchedPathIsDataUrl = |
|  |  | req.headers['x-matched-path']?.includes('/\_next/data') |
|  |  | const isDataUrl = reqUrlIsDataUrl || matchedPathIsDataUrl |
|  |  |  |
|  |  | let parsedPath = parseUrl( |
|  |  | isDataUrl ? req.url! : (req.headers['x-matched-path'] as string), |
|  |  | true |
|  |  | ) |
|  |  |  |
|  |  | let matchedPathname = parsedPath.pathname! |
|  |  | let matchedPathname = parsedPath.pathname! |
|  |  |  |
|  |  | let matchedPathnameNoExt = isDataUrl |
|  |  | ? matchedPathname.replace(/\.json$/, '') |
|  |  | : matchedPathname |
|  |  | let matchedPathnameNoExt = isDataUrl |
|  |  | ? matchedPathname.replace(/\.json$/, '') |
|  |  | : matchedPathname |
|  |  |  |
|  |  | if (this.nextConfig.i18n) { |
|  |  | const localePathResult = normalizeLocalePath( |
|  |  | matchedPathname || '/', |
|  |  | this.nextConfig.i18n.locales |
|  |  | ) |
|  |  | if (this.nextConfig.i18n) { |
|  |  | const localePathResult = normalizeLocalePath( |
|  |  | matchedPathname || '/', |
|  |  | this.nextConfig.i18n.locales |
|  |  | ) |
|  |  |  |
|  |  | if (localePathResult.detectedLocale) { |
|  |  | parsedUrl.query.\_\_nextLocale = localePathResult.detectedLocale |
|  |  | if (localePathResult.detectedLocale) { |
|  |  | parsedUrl.query.\_\_nextLocale = localePathResult.detectedLocale |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (isDataUrl) { |
|  |  | matchedPathname = denormalizePagePath(matchedPathname) |
|  |  | matchedPathnameNoExt = denormalizePagePath(matchedPathnameNoExt) |
|  |  | } |
|  |  |  |
|  |  | const pageIsDynamic = isDynamicRoute(matchedPathnameNoExt) |
|  |  | const combinedRewrites: Rewrite[] = [] |
|  |  | if (isDataUrl) { |
|  |  | matchedPathname = denormalizePagePath(matchedPathname) |
|  |  | matchedPathnameNoExt = denormalizePagePath(matchedPathnameNoExt) |
|  |  | } |
|  |  |  |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.beforeFiles) |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.afterFiles) |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.fallback) |
|  |  | const pageIsDynamic = isDynamicRoute(matchedPathnameNoExt) |
|  |  | const combinedRewrites: Rewrite[] = [] |
|  |  |  |
|  |  | const utils = getUtils({ |
|  |  | pageIsDynamic, |
|  |  | page: matchedPathnameNoExt, |
|  |  | i18n: this.nextConfig.i18n, |
|  |  | basePath: this.nextConfig.basePath, |
|  |  | rewrites: combinedRewrites, |
|  |  | }) |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.beforeFiles) |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.afterFiles) |
|  |  | combinedRewrites.push(...this.customRoutes.rewrites.fallback) |
|  |  |  |
|  |  | try { |
|  |  | // ensure parsedUrl.pathname includes URL before processing |
|  |  | // rewrites or they won't match correctly |
|  |  | if (this.nextConfig.i18n && !url.locale?.path.detectedLocale) { |
|  |  | parsedUrl.pathname = `/${url.locale?.locale}${parsedUrl.pathname}` |
|  |  | } |
|  |  | utils.handleRewrites(req, parsedUrl) |
|  |  | const utils = getUtils({ |
|  |  | pageIsDynamic, |
|  |  | page: matchedPathnameNoExt, |
|  |  | i18n: this.nextConfig.i18n, |
|  |  | basePath: this.nextConfig.basePath, |
|  |  | rewrites: combinedRewrites, |
|  |  | }) |
|  |  |  |
|  |  | // interpolate dynamic params and normalize URL if needed |
|  |  | if (pageIsDynamic) { |
|  |  | let params: ParsedUrlQuery | false = {} |
|  |  | try { |
|  |  | // ensure parsedUrl.pathname includes URL before processing |
|  |  | // rewrites or they won't match correctly |
|  |  | if (this.nextConfig.i18n && !url.locale?.path.detectedLocale) { |
|  |  | parsedUrl.pathname = `/${url.locale?.locale}${parsedUrl.pathname}` |
|  |  | } |
|  |  | utils.handleRewrites(req, parsedUrl) |
|  |  |  |
|  |  | Object.assign(parsedUrl.query, parsedPath.query) |
|  |  | const paramsResult = utils.normalizeDynamicRouteParams( |
|  |  | parsedUrl.query |
|  |  | ) |
|  |  | // interpolate dynamic params and normalize URL if needed |
|  |  | if (pageIsDynamic) { |
|  |  | let params: ParsedUrlQuery | false = {} |
|  |  |  |
|  |  | if (paramsResult.hasValidParams) { |
|  |  | params = paramsResult.params |
|  |  | } else if (req.headers['x-now-route-matches']) { |
|  |  | const opts: Record<string, string> = {} |
|  |  | params = utils.getParamsFromRouteMatches( |
|  |  | req, |
|  |  | opts, |
|  |  | parsedUrl.query.\_\_nextLocale || '' |
|  |  | Object.assign(parsedUrl.query, parsedPath.query) |
|  |  | const paramsResult = utils.normalizeDynamicRouteParams( |
|  |  | parsedUrl.query |
|  |  | ) |
|  |  |  |
|  |  | if (opts.locale) { |
|  |  | parsedUrl.query.\_\_nextLocale = opts.locale |
|  |  | if (paramsResult.hasValidParams) { |
|  |  | params = paramsResult.params |
|  |  | } else if (req.headers['x-now-route-matches']) { |
|  |  | const opts: Record<string, string> = {} |
|  |  | params = utils.getParamsFromRouteMatches( |
|  |  | req, |
|  |  | opts, |
|  |  | parsedUrl.query.\_\_nextLocale || '' |
|  |  | ) |
|  |  |  |
|  |  | if (opts.locale) { |
|  |  | parsedUrl.query.\_\_nextLocale = opts.locale |
|  |  | } |
|  |  | } else { |
|  |  | params = utils.dynamicRouteMatcher!(matchedPathnameNoExt) |
|  |  | } |
|  |  |  |
|  |  | if (params) { |
|  |  | params = utils.normalizeDynamicRouteParams(params).params |
|  |  |  |
|  |  | matchedPathname = utils.interpolateDynamicPath( |
|  |  | matchedPathname, |
|  |  | params |
|  |  | ) |
|  |  | req.url = utils.interpolateDynamicPath(req.url!, params) |
|  |  | } |
|  |  | } else { |
|  |  | params = utils.dynamicRouteMatcher!(matchedPathnameNoExt) |
|  |  | } |
|  |  |  |
|  |  | if (params) { |
|  |  | params = utils.normalizeDynamicRouteParams(params).params |
|  |  | if (reqUrlIsDataUrl && matchedPathIsDataUrl) { |
|  |  | req.url = formatUrl({ |
|  |  | ...parsedPath, |
|  |  | pathname: matchedPathname, |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | matchedPathname = utils.interpolateDynamicPath( |
|  |  | matchedPathname, |
|  |  | params |
|  |  | ) |
|  |  | req.url = utils.interpolateDynamicPath(req.url!, params) |
|  |  | Object.assign(parsedUrl.query, params) |
|  |  | utils.normalizeVercelUrl(req, true) |
|  |  | } |
|  |  |  |
|  |  | if (reqUrlIsDataUrl && matchedPathIsDataUrl) { |
|  |  | req.url = formatUrl({ |
|  |  | ...parsedPath, |
|  |  | pathname: matchedPathname, |
|  |  | }) |
|  |  | } catch (err) { |
|  |  | if (err instanceof DecodeError) { |
|  |  | res.statusCode = 400 |
|  |  | return this.renderError(null, req, res, '/\_error', {}) |
|  |  | } |
|  |  |  |
|  |  | Object.assign(parsedUrl.query, params) |
|  |  | utils.normalizeVercelUrl(req, true) |
|  |  | } |
|  |  | } catch (err) { |
|  |  | if (err instanceof DecodeError) { |
|  |  | res.statusCode = 400 |
|  |  | return this.renderError(null, req, res, '/\_error', {}) |
|  |  | throw err |
|  |  | } |
|  |  | throw err |
|  |  | } |
|  |  |  |
|  |  | parsedUrl.pathname = `${this.nextConfig.basePath || ''}${ |
|  |  | matchedPathname === '/' && this.nextConfig.basePath |
|  |  | ? '' |
|  |  | : matchedPathname |
|  |  | }` |
|  |  | url.pathname = parsedUrl.pathname |
|  |  | } |
|  |  | parsedUrl.pathname = `${this.nextConfig.basePath || ''}${ |
|  |  | matchedPathname === '/' && this.nextConfig.basePath |
|  |  | ? '' |
|  |  | : matchedPathname |
|  |  | }` |
|  |  | url.pathname = parsedUrl.pathname |
|  |  | } |
|  |  |  |
|  |  | addRequestMeta(req, '\_\_nextHadTrailingSlash', url.locale?.trailingSlash) |
|  |  | if (url.locale?.domain) { |
|  |  | addRequestMeta(req, '\_\_nextIsLocaleDomain', true) |
|  |  | } |
|  |  | addRequestMeta(req, '\_\_nextHadTrailingSlash', url.locale?.trailingSlash) |
|  |  | if (url.locale?.domain) { |
|  |  | addRequestMeta(req, '\_\_nextIsLocaleDomain', true) |
|  |  | } |
|  |  |  |
|  |  | if (url.locale?.path.detectedLocale) { |
|  |  | req.url = formatUrl(url) |
|  |  | addRequestMeta(req, '\_\_nextStrippedLocale', true) |
|  |  | if (url.pathname === '/api' || url.pathname.startsWith('/api/')) { |
|  |  | return this.render404(req, res, parsedUrl) |
|  |  | if (url.locale?.path.detectedLocale) { |
|  |  | req.url = formatUrl(url) |
|  |  | addRequestMeta(req, '\_\_nextStrippedLocale', true) |
|  |  | if (url.pathname === '/api' || url.pathname.startsWith('/api/')) { |
|  |  | return this.render404(req, res, parsedUrl) |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (!this.minimalMode || !parsedUrl.query.\_\_nextLocale) { |
|  |  | if (url?.locale?.locale) { |
|  |  | parsedUrl.query.\_\_nextLocale = url.locale.locale |
|  |  | if (!this.minimalMode || !parsedUrl.query.\_\_nextLocale) { |
|  |  | if (url?.locale?.locale) { |
|  |  | parsedUrl.query.\_\_nextLocale = url.locale.locale |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (url?.locale?.defaultLocale) { |
|  |  | parsedUrl.query.\_\_nextDefaultLocale = url.locale.defaultLocale |
|  |  | } |
|  |  | if (url?.locale?.defaultLocale) { |
|  |  | parsedUrl.query.\_\_nextDefaultLocale = url.locale.defaultLocale |
|  |  | } |
|  |  |  |
|  |  | if (url.locale?.redirect) { |
|  |  | res.setHeader('Location', url.locale.redirect) |
|  |  | res.statusCode = TEMPORARY\_REDIRECT\_STATUS |
|  |  | res.end() |
|  |  | return |
|  |  | } |
|  |  | if (url.locale?.redirect) { |
|  |  | res.setHeader('Location', url.locale.redirect) |
|  |  | res.statusCode = TEMPORARY\_REDIRECT\_STATUS |
|  |  | res.end() |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | res.statusCode = 200 |
|  |  | try { |
|  |  | res.statusCode = 200 |
|  |  | return await this.run(req, res, parsedUrl) |
|  |  | } catch (err) { |
|  |  | } catch (err: any) { |
|  |  | if ( |
|  |  | (err && typeof err === 'object' && err.code === 'ERR\_INVALID\_URL') || |
|  |  | err instanceof DecodeError |
|  |  | ) { |
|  |  | res.statusCode = 400 |
|  |  | return this.renderError(null, req, res, '/\_error', {}) |
|  |  | } |
|  |  |  |
|  |  | if (this.minimalMode || this.renderOpts.dev) { |
|  |  | throw err |
|  |  | } |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6d98b4f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fcommit%2F6d98b4fb4315dec1badecf0e9bdc212a4272b264) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


