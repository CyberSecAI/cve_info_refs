=== Content from www.yubico.com_cf927031_20250114_205352.html ===


[Skip to content](#wp--skip-link--target)
EnglishFrançaisDeutsch日本語EspañolSvenska

* [Contact Sales](/contact-us/)
* [Resellers](/support/resellers/)
* [Support](https://support.yubico.com/hc/en-us/)

menu![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[![Yubico Header Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)
Why Yubicoexpand\_more
[Why Yubico](https://www.yubico.com/why-yubico/)
How we help

* [Enterprises](https://www.yubico.com/why-yubico/for-business/)
* [SMBs](https://www.yubico.com/why-yubico/yubico-and-smbs/)
* [Individuals](https://www.yubico.com/why-yubico/for-individuals/)
* [Developers](https://www.yubico.com/why-yubico/for-developers/)

Work with us

* [Careers](https://www.yubico.com/careers/)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Connect & learn

* [Contact Sales](https://www.yubico.com/contact-us/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](/why-yubico/about-us/)
* [The team](/why-yubico/team/)
* [Investors](https://investors.yubico.com/)
* [Innovation history](https://www.yubico.com/why-yubico/yubico-innovation-history/)
* [Secure it Forward](https://www.yubico.com/why-yubico/secure-it-forward/)

![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-easy-to-use-1.jpg)Easy-to-use, secure authenticationWith YubiKey there’s no tradeoff between great security and usabilityWhy YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/WhyY-nav-google-1.jpg)Proven at scale at GoogleGoogle defends against account takeovers and reduces IT costsGoogle Case Studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)Protecting vulnerable organizationsSecure it Forward: Yubico matches up to 5% of the number of YubiKeys purchased on Yubico.comSecure it Forwardsecurity-advisory
Productsexpand\_more
[All products](/products/)
Hardware

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

Services

* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)
* [YubiEnterprise Delivery](https://www.yubico.com/products/yubienterprise-delivery/)
* [Yubico Enrollment Suite](https://www.yubico.com/products/yubicoenrollmentsuite/)
* [YubiCloud](https://www.yubico.com/products/yubicloud/)

Software and tools

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)
* [Computer login tools](https://www.yubico.com/products/computer-login-tools/)
* [Software Development Toolkits](https://www.yubico.com/products/software-development-toolkits-sdks/)

Discover the YubiKey

* [Using YubiKey is easy](https://www.yubico.com/products/ease-of-use/)
* [Find the right YubiKey](/quiz/)
* [Works with YubiKey](/works-with-yubikey/catalog/)
* [Compare YubiKeys](https://www.yubico.com/store/compare/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-hundreds-services-nav-3-1.jpg)One key for hundreds of apps and servicesYubiKey works out-of-the-box and has no client software or batteryYubico protects yousecurity-advisory
![See YubiKeys as a Service](https://www.yubico.com/wp-content/uploads/2023/03/img-YubiEnterprise-nav-3-1.jpg)YubiKey as a Service delivers scale and savingsGain a future-proofed solution and faster MFA rolloutsYubiKey as a Servicesecurity-advisory
Solutionsexpand\_more
[Solutions overview](/solutions/)
Initiatives

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Executive Order OMB M-22-09](https://www.yubico.com/solutions/executive-order-hub/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Compliance](https://www.yubico.com/solutions/cybersecurity-compliance/)
* [Cyber Insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [Critical infrastructure](https://www.yubico.com/solutions/critical-infrastructure-security/)
* [Secure supply chain](/solutions/supply-chain-security/)
* [Protect call centers](https://www.yubico.com/solutions/call-centers/)

Use cases

* [Hybrid & remote workers](/solutions/secure-hybrid-and-remote-workers/)
* [Secure privileged users](https://www.yubico.com/solutions/privileged-users/)
* [Mobile restricted environments](https://www.yubico.com/solutions/mobile-restricted-environment/)
* [Shared workstations](https://www.yubico.com/solutions/shared-workstations/)

Technologies

* [Microsoft ecosystem](https://www.yubico.com/solutions/microsoft-365-mfa/)
* [Salesforce workspace](https://www.yubico.com/solutions/yubico-and-salesforce/)
* [IAM solutions](https://www.yubico.com/solutions/identity-access-management/)
* [AWS environment](https://www.yubico.com/solutions/yubico-and-amazon-web-services/)
* [HYPR experience](https://www.yubico.com/solutions/hypr-and-yubico/)
* [Okta identity solutions](https://www.yubico.com/solutions/okta-and-yubico/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-passwordless-nav-5-1.jpg)The Bridge to PasswordlessBegin the journey to make your organization passwordless Get the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-zero-trust-nav-3.jpg)Accelerate your Zero Trust Strategy7 best authentication practices to jumpstart your Zero Trust programGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-federal-nav-3.jpg)Federal cybersecurity requirements Guidance for leaders to prepare for the modern cyber threat eraGet the white papersecurity-advisory
Industriesexpand\_more
[Industries overview](https://www.yubico.com/industries/)
Industries

* [High tech](https://www.yubico.com/industries/technology/)
* [Federal government](https://www.yubico.com/industries/federal/)
* [Department of Defense](https://www.yubico.com/industries/us-department-of-defense/)
* [Federal systems integrators](https://www.yubico.com/industries/federal-systems-integrators/)
* [State & local government](https://www.yubico.com/industries/state-local-government/)
* [Education](https://www.yubico.com/industries/education/)
* [Financial services](https://www.yubico.com/industries/finance/)

* [Retail & hospitality](https://www.yubico.com/industries/retail-and-hospitality/)
* [Telecommunications](/industries/telecommunications/)
* [Healthcare](https://www.yubico.com/industries/healthcare/)
* [Pharmaceuticals](https://www.yubico.com/industries/pharmaceuticals/)
* [Cryptocurrency](https://www.yubico.com/industries/cryptocurrency/)
* [Energy & natural resources](https://www.yubico.com/industries/energy-and-natural-resources/)
* [Manufacturing](https://www.yubico.com/industries/manufacturing/)
* [Elections & campaigns](https://www.yubico.com/industries/political-campaigns/)
* [Insurance organizations](https://www.yubico.com/industries/phishing-resistant-mfa-and-passwordless-for-insurance-organizations/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-mfg-nav.jpg)Manufacturing and supply chain security Authentication best practices for manufacturingGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-phishing-nav.jpg)Phishing-resistant MFA: Fact vs. FictionMeet requirements for phishing-resistant MFA in OMB M-22-09 guidelinesGet the white papersecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-nat-resources-nav.jpg)Secure energy and natural resources from cyber threats Best practices for phishing-resistant MFA to protect infrastructureGet the white papersecurity-advisory
Resourcesexpand\_more
[All resources](/resources/)
Learn

* [Yubico Blog](https://www.yubico.com/blog/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Developer program](https://developers.yubico.com/)
* [Product briefs](https://www.yubico.com/resource_categories/product-briefs/)
* [Solution briefs](https://www.yubico.com/resource_categories/solution-briefs/)
* [Passkeys](https://www.yubico.com/passkeys/)

Best practices

* [Case studies](https://www.yubico.com/resources/reference-customers/)
* [Get a pilot started](https://www.yubico.com/resources/getting-started/)
* [White papers and reports](https://www.yubico.com/resource_categories/white-papers/)
* [Webinars](https://www.yubico.com/resource_categories/webinars/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-beyondTrust-nav.jpg)BeyondTrust: secured with a subscriptionPrivileged Access Management leader simplifies deploymentSee case studysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/04/DCT-608-Navigation-promotional-image-for-451-webinar-390x216-1.jpg)S&P Global Market Intelligence report: old habits die hardOnly 46% of orgs protect their applications with MFA. How about yours?Read the reportsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/08/img-Ebook-nav.jpg)Considering Passkeys for your Enterprise?Learn how to avoid common passkey pitfallsVisit Passkey Hubsecurity-advisory
Supportexpand\_more
 [Support home](https://support.yubico.com/hc/en-us)
Get started

* [Find the right YubiKey](/quiz/)
* [Set up your YubiKey](/setup/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support articles](https://support.yubico.com/hc/en-us/)

Services

* [Support Services](https://www.yubico.com/support/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [YubiKey as a Service](https://www.yubico.com/products/yubikey-as-a-service/)

Additional resources

* [Works with YubiKey Program](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular)
* [Buying and shipping information](https://www.yubico.com/support/shipping-and-buying-information/)
* [Security advisories](https://www.yubico.com/support/security-advisories/)
* [Help center](https://support.yubico.com/hc/en-us/)

![](https://www.yubico.com/wp-content/uploads/2023/03/img-setup-nav-3.jpg)How to set up your YubiKeyFollow our guided tutorials to start protecting your servicesSet up your YubiKeysecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-find-nav-3.jpg)Find the best YubiKey for your needsTake the guided quiz and see which YubiKeys fit your needsTake the quizsecurity-advisory
![](https://www.yubico.com/wp-content/uploads/2023/03/img-accelerate-nav-3.jpg)Accelerate your YubiKey deploymentTechnical and operational guidance for your YubiKey rolloutProfessional Servicessecurity-advisory
Search![X icon](https://www.yubico.com/wp-content/themes/yubicool/img/icons/close.svg)[Subscribe](/products/yubienterprise-subscription/)[Store](/store/)

* # ********Security Advisory YSA-2021-0****4****

  ## ****Security Advisory – Input validation issues in libyubihsm****

  Published Date: 2021-12-08
  Tracking IDs: YSA-2021-04
  CVE: [CVE-2021-43399](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-43399)
  CVSS 3.1: [4.0](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:L/PR:H/UI:R/S:U/C:L/I:L/A:L&version=3.1)

  ### Summary

  The YubiHSM library that is included in the yubihsm-shell project, does not properly validate the length of some operations including SSH signing requests and some data operations received from the YubiHSM 2.

  ### Affected products

  The yubihsm-shell project is included in the YubiHSM 2 SDK product. Release version 2021.08 and prior of the SDK are affected. Note that several components included in the SDK depend on the YubiHSM library from the yubihsm-shell project. YubiHSM, YubiHSM 2, YubiKey 5 Series, YubiKey 4 Series, YubiKey FIPS Series, Security Key by Yubico Series, or previous generation YubiKey devices are **not** impacted.

  ### How to tell if you are affected

  #### Check the version of yubihsm-shell:

  `$ yubihsm-shell --version
  yubihsm-shell 2.2.0`

  If you have yubihsm-shell version 2.2.0 (included in the YubiHSM 2 SDK 2021.08 release) or below, your software is affected and we recommend upgrading to the latest [YubiHSM 2 SDK](https://developers.yubico.com/YubiHSM2/Releases/).

  For users of the YubiHSM 2 SDK without yubihsm-shell, versions 2021.08 and below are affected.

  ### Customer Actions

  Affected parties should upgrade yubihsm-shell by installing the latest version of [YubiHSM 2 SDK](https://developers.yubico.com/YubiHSM2/Releases/).

  ### Issue Details

  An issue was discovered in the yh\_com\_sign\_ssh\_certificate() function of libyubihsm in YubiHSM 2 SDK version 2021.08 and earlier. This function is invoked through both the ‘certify’ command in yubihsm-shell, and the “-a sign-ssh-certificate” command-line flag. The function does not correctly validate the input length field of the provided data buffer, which can lead to an out-of-bounds write. In the context of the yubihsm-shell, an out-of-bounds write will lead to a crash of the running process due to runtime protections in Yubico releases.

  Binaries and releases from third parties may be impacted differently if different runtime and platform mitigation strategies are used.

  Boundary checks have been introduced in other areas of libyubihsm to increase the resilience of the logic that processes data from the YubiHSM.

  ### Downloads

  The current release of the YubiHSM 2 SDK, which contains binaries for yubihsm-shell for most common platforms, can be found [here](https://developers.yubico.com/YubiHSM2/Releases/). The current source code release of yubihsm-shell can be found [here](https://developers.yubico.com/yubihsm-shell).

  ## **Acknowledgements**

  On September 4, 2021, Christian Reitter notified Yubico of this security issue. We thank Christian Reitter for reporting it and working with us under coordinated vulnerability disclosure.

  ### **Timeline**

  | September 4, 2021 | Christian Reitter reports issue to Yubico |
  | --- | --- |
  | December 8, 2021 | Yubico releases advisory YSA-2021-04 |

[![Yubico Text Logo](https://www.yubico.com/wp-content/themes/yubicool/img/logos/logo.svg)](https://www.yubico.com)

* [RSS Feed](https://www.yubico.com/feed/)
* [X](https://x.com/Yubico)
* [LinkedIn](https://www.linkedin.com/company/Yubico)
* [Facebook](https://www.facebook.com/Yubikey)
* [Instagram](https://www.instagram.com/Yubico)
* [YouTube](https://www.youtube.com/c/Yubico)
* [GitHub](https://www.github.com/Yubico)

Find

* [Product finder quiz](/quiz/)

Set up

* [Find set-up guides](/setup/)

Buy

* [Buy online](/store)
* [Contact sales](/contact-us/)

Sign up

* [Get Yubico updates](https://www.yubico.com/email-subscription/)

Why Yubico

* [Careers](https://www.yubico.com/careers/)
* [Events](https://www.yubico.com/events/)
* [Press room](https://www.yubico.com/press/)
* [About us](https://www.yubico.com/why-yubico/about-us/)
* [Investors](https://investors.yubico.com)
* [Partner programs](https://www.yubico.com/why-yubico/partners/)

Products

* [YubiKey 5 Series](https://www.yubico.com/products/yubikey-5-overview/)
* [YubiKey 5 FIPS Series](https://www.yubico.com/products/yubikey-fips/)
* [YubiKey Bio Series](https://www.yubico.com/products/yubikey-bio-series/)
* [Security Key Series](https://www.yubico.com/products/security-key/)
* [YubiHSM 2 & YubiHSM 2 FIPS](https://www.yubico.com/products/hardware-security-module/)

* [Yubico Authenticator](https://www.yubico.com/products/yubico-authenticator/)

Solutions

* [Zero Trust](https://www.yubico.com/solutions/zero-trust/)
* [Phishing-resistant MFA](https://www.yubico.com/solutions/multi-factor-authentication/)
* [Passwordless](https://www.yubico.com/solutions/passwordless/)
* [Cyber insurance](https://www.yubico.com/solutions/cyber-insurance/)
* [More solutions](https://www.yubico.com/solutions/)

Industries

* [Industries overview](https://www.yubico.com/industries/)

Resources

* [Yubico blog](https://www.yubico.com/blog/)
* [Resource library](https://www.yubico.com/resources/library/)
* [Cybersecurity glossary](https://www.yubico.com/resources/glossary/)
* [Authentication standards](https://www.yubico.com/authentication-standards/)
* [Developer program](https://developers.yubico.com/)

Support

* [Works with YubiKey](https://www.yubico.com/works-with-yubikey/catalog/?sort=popular/)
* [Help center](https://support.yubico.com/hc/en-us/)
* [Downloads](https://www.yubico.com/support/download/)
* [Product documentation](https://docs.yubico.com/)
* [Support Services](https://www.yubico.com/support-services/)
* [Professional Services](https://www.yubico.com/support/yubico-for-professional-services/)
* [Contact support](https://support.yubico.com/hc/en-us/requests/new/)

EnglishFrançaisDeutsch日本語EspañolSvenska
 Yubico © 2025 All Rights Reserved.

* [Sitemap](/sitemap_index.xml)
* [Cookies](/support/terms-conditions/cookie-notice/)
* [Legal](/support/terms-conditions/)
* [Privacy](/support/terms-conditions/privacy-notice/)
* [Patents](https://www.yubico.com/why-yubico/patents/)
* [Terms of use](/support/terms-conditions/yubico-website-terms-conditions/)
* [Trust](/trust/)



=== Content from blog.inhq.net_5c2dd1c6_20250114_205349.html ===
![](https://mato.inhq.net/m?rec=1&bots=1&idsite=1)[invd blog](/)

[Archive](/archive/)[CVEs](/cve/)[Consulting](/consulting/)[About](/about/)

# Yubico yubihsm-shell Vulnerability (CVE-2021-43399)

Dec 8, 2021
â¢
Christian Reitter
ID:
CVE-2021-43399

Related articles:
[Yubico YubiHSM PKCS#11 Library Vulnerability (CVE-2023-39908)](/posts/yubico-yubihsm-pkcs-vuln/)
â¢ [Yubico libykpiv Vulnerabilities II](/posts/yubico-libykpiv-vuln2/)
â¢ [Yubico libyubihsmâVulnerabilities (CVE-2021-27217, CVE-2021-32489)](/posts/yubico-libyubihsm-vuln2/)

I have discovered a new security issue in the Yubico HSM client-side code. An attacker with control over the data input of the [SSH Certificate Signing](https://developers.yubico.com/YubiHSM2/Usage_Guides/OpenSSH_certificates.html)
functionality can cause a stack buffer overflow with arbitrary data in the `yubihsm-shell` tool. The overflow is mitigated into a denial of service through existing runtime hardening.

This article will describe the issue.

## Contents

* [The Vulnerability](#the-vulnerability)
  + [Attack Scenario and Security Implications](#attack-scenario-and-security-implications)
  + [Proof-of-Concept](#proof-of-concept)
* [Coordinated Disclosure](#coordinated-disclosure)
  + [Relevant yubihsm-shell Sources](#relevant-yubihsm-shell-sources)
  + [Detailed Timeline](#detailed-timeline)
  + [Bug Bounty](#bug-bounty)
## Consulting

*Iâm a freelance Security Consultant and currently available for new projects.
If you are looking for assistance to secure your projects or organization, [contact me](/consulting).*

## The Vulnerability

Please see some of the previous articles on libyubihsm for the technical background and relevance of this code.
Unlike other Yubico HSM client issues, this flaw is specific to the standalone CLI program and doesnât affect users of the library code.

Letâs talk about the code that leads to the issue.

When `yubihsm-shell` is called with the `sign-ssh-certificate` action, it checks the required parameters:

```
case action_arg_signMINUS_sshMINUS_certificate: {
  if (args_info.template_id_given == 0) {
    fprintf(stderr, "Missing argument template-id\n");
    rc = EXIT_FAILURE;
    break;
  }

  if (args_info.algorithm_given == 0) {
    fprintf(stderr, "Missing argument algorithm\n");
    rc = EXIT_FAILURE;
    break;
  }

// more checks
// [...]
```

[main.c](https://github.com/Yubico/yubihsm-shell/blob/8a26dba77c6b9e2a6b5a626cecf3a6e4a87aa86f/src/main.c#L2716-L2748)

Once the checks are passed, the SSH certificate file is read in via `get_input_data()` and stored in the local `buf[]` buffer.
Notably, this buffer accepts up to **8192 bytes** of binary input and is generically used for different actions.

The buffer is then passed to the `yh_com_sign_ssh_certificate()` function, which is defined like this:

```
int yh_com_sign_ssh_certificate(yubihsm_context *ctx, Argument *argv,
                                cmd_format in_fmt, cmd_format fmt) {

// [...]

  uint8_t data[YH_MSG_BUF_SIZE + 1024];
  size_t response_len = sizeof(data);

  memcpy(data, argv[4].x, argv[4].len);
```

[command.c](https://github.com/Yubico/yubihsm-shell/blob/81809972c7173f77b330be725cce82db9ac3b1d7/src/commands.c#L2468-L2479)

The `YH_MSG_BUF_SIZE` is set to `2048`, so the local `data[]` buffer holds **3072 bytes**. Since the correlating `response_len` size limit is not used correctly to restrict write operations, the `memcpy()` operation performs a classic stack buffer overflow beyond the end of `data[]` if `yubihsm-shell` is called on SSH certificate input files that are between **3073** and **8192** bytes in length.

Stack buffer overflows with arbitrary binary data of variable length are fairly interesting for attackers since they can be used for reliable stack smashing attacks. If successful, this redirects the program control flow and allows - more or less - arbitrary code execution.

Fortunately for `yubihsm-shell` users, the existing RELEASE target build steps include the hardening flags `-fstack-protector-all` and `-D_FORTIFY_SOURCE=2` (on non-Windows builds). This instructs the compiler to add runtime checks which detect the buffer overflow and terminate the program before additional harm is done.
As a result, the program terminates either directly during the `memcpy()` or at the end of the `yh_com_sign_ssh_certificate()` function.

The expected impact therefore is a denial of service of `yubihsm-shell`.

### Attack Scenario and Security Implications

Based on my understanding of the affected CLI functionality, the SSH certificate file is plausibly generated a lower-privileged or untrusted external user and moved to the target system for signing via the HSM by a higher-privileged user. The trust boundary step that is involved makes this vulnerability interesting from a conceptual standpoint. However, the denial of service impact is without major consequences, especially if `yubihsm-shell` is operated manually.

A notable side effect of the specific CLI crash behavior is that one of the 16 [communication session](https://developers.yubico.com/YubiHSM2/Concepts/Session.html) slots of the HSM2 target stays blocked until it times out after 30 seconds. *If* there is an automated system that can be tricked into processing problematic SSH certificates via `yubihsm-shell` *repeatedly* and *in quick succession*, this can be used to cause a temporary denial of service of the HSM for other client connections, if there are any.

#### CVSS Score

I have focused on the CVSS score for

* a local attack
* enough privileges to influence the SSH certificate file on disk before it is used
* manual use by the `yubihsm-shell` operator
* with an availability impact

There are other ways to score this and Yubico has chosen a slightly different approach. Overall, the issue severity is somewhere between `Low` and `Medium`, primarily due to the effective mitigations that prevent more serious effects in practice.

| ID | CVSS 3.1 Score | Parameters |
| --- | --- | --- |
| [CVE-2021-43399](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-43399) | **4.0** (Medium) | [AV:L/AC:H/PR:H/UI:R/S:U/C:N/I:N/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:H/PR:H/UI:R/S:U/C:N/I:N/A:H&version=3.1) or [AV:L/AC:L/PR:H/UI:R/S:U/C:L/I:L/A:L](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:L/PR:H/UI:R/S:U/C:L/I:L/A:L&version=3.1) |

### Proof-of-Concept

**WARNING: use the following code at your own risk. Although not intended, please assume that this will PERMANENTLY overwrite data on the HSM device that you have connected.**

Procedure:

1. Install an affected version of the `yubihsm-shell` program. There are no custom patches required.
2. Connect a HSM2 device in factory settings via USB.
3. Run the commands below.

```
# create a dummy input file with a problematic filesize
dd if=/dev/zero bs=4242 count=1 of=example1.req
# trigger the affected functionality
sudo ./yubihsm-shell --connector=yhusb:// -v127 -p password -a sign-ssh-certificate --template-id 0x1234 --algorithm rsa-pkcs1-sha1 --in example1.req
```
## Coordinated Disclosure

Overall, my thoughts on the coordinated disclosure are similar to the [previous disclosure](/posts/yubico-libyubihsm-vuln2/#coordinated-disclosure).

It definitely helped to have an existing communication channel. My impression is that the disclosure coordination was not as fluid as with previous issues, and there were a number of hiccups along the way that required extra attention.

However, I still think it is positive that `yubihsm-shell` is developed as open source code and available for independent review, even though the release schedule and extra release preparations make it more time consuming than other projects to report security issues in.

### Relevant yubihsm-shell Sources

| variant | source | fix | references |
| --- | --- | --- | --- |
| Yubico upstream | [GitHub](https://github.com/Yubico/yubihsm-shell) | version **2.3.0**, bundled in SDK release [2021.12](https://developers.yubico.com/YubiHSM2/Releases) | [YSA-2021-04](https://www.yubico.com/support/security-advisories/ysa-2021-04/) |
| Fedora | [Fedora](https://src.fedoraproject.org/rpms/yubihsm-shell) | [2.3.0-1](https://src.fedoraproject.org/rpms/yubihsm-shell/c/52348de622ceb99f65a0f8d23203e87a5a0c1274) | [Bug 2030694](https://bugzilla.redhat.com/show_bug.cgi?id=2030694) |

### Detailed Timeline

| Date | info |
| --- | --- |
| 2021-09-15 | Disclosure of issue to Yubico |
| 2021-09-23 | Yubico acknowledges the issue |
| 2021-09-27 | POC sent to Yubico |
| 2021-09 to 2021-10 | Communication on issue impact and scoring |
| 2021-11-03 | Yubico communicates release date 2021-11-23 |
| 2021-11-17 | Yubico communicates release date 2021-12-01 |
| 2021-12-01 | Yubico communicates release date 2021-12-08 this was originally sent on 2021-11-24 but mangled |
| 2021-12-08 | Yubico publishes YSA-2021-04 |
| 2021-12-08 | Publication of this article |

Note that the Yubico timeline incorrectly describes 2021-09-04 as the initial disclosure date.

### Bug Bounty

Yubico provided two YubiKeys as a hardware bug bounty for this issue.

* **Christian Reitter**

Information security and other interests.


