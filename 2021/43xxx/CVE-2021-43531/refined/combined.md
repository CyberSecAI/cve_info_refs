=== Content from www.mozilla.org_0ee21338_20250115_093211.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-48

## Security Vulnerabilities fixed in Firefox 94

Announced
November 2, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 94

#### [#CVE-2021-38503: iframe sandbox rules did not apply to XSLT stylesheets](#CVE-2021-38503)

Reporter
Armin Ebert
Impact
high
##### Description

The iframe sandbox rules were not correctly applied to XSLT stylesheets, allowing an iframe to bypass restrictions such as executing scripts or navigating the top-level frame.

##### References

* [Bug 1729517](https://bugzilla.mozilla.org/show_bug.cgi?id=1729517)

#### [#CVE-2021-38504: Use-after-free in file picker dialog](#CVE-2021-38504)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When interacting with an HTML input element's file picker dialog with `webkitdirectory` set, a use-after-free could have resulted, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1730156](https://bugzilla.mozilla.org/show_bug.cgi?id=1730156)

#### [#CVE-2021-38505: Windows 10 Cloud Clipboard may have recorded sensitive user data](#CVE-2021-38505)

Reporter
Sergey Galich
Impact
high
##### Description

Microsoft introduced a new feature in Windows 10 known as Cloud Clipboard which, if enabled, will record data copied to the clipboard to the cloud, and make it available on other computers in certain scenarios. Applications that wish to prevent copied data from being recorded in Cloud History must use specific clipboard formats; and Firefox before versions 94 and ESR 91.3 did not implement them. This could have caused sensitive data to be recorded to a user's Microsoft account.
*This bug only affects Firefox for Windows 10+ with Cloud Clipboard enabled. Other operating systems are unaffected.*

##### References

* [Bug 1730194](https://bugzilla.mozilla.org/show_bug.cgi?id=1730194)

#### [#CVE-2021-38506: Firefox could be coaxed into going into fullscreen mode without notification or warning](#CVE-2021-38506)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Through a series of navigations, Firefox could have entered fullscreen mode without notification or warning to the user. This could lead to spoofing attacks on the browser UI including phishing.

##### References

* [Bug 1730750](https://bugzilla.mozilla.org/show_bug.cgi?id=1730750)

#### [#CVE-2021-38507: Opportunistic Encryption in HTTP2 could be used to bypass the Same-Origin-Policy on services hosted on other ports](#CVE-2021-38507)

Reporter
Takeshi Terada
Impact
high
##### Description

The Opportunistic Encryption feature of HTTP2 (RFC 8164) allows a connection to be transparently upgraded to TLS while retaining the visual properties of an HTTP connection, including being same-origin with unencrypted connections on port 80. However, if a second encrypted port on the same IP address (e.g. port 8443) did not opt-in to opportunistic encryption; a network attacker could forward a connection from the browser to port 443 to port 8443, causing the browser to treat the content of port 8443 as same-origin with HTTP. This was resolved by disabling the Opportunistic Encryption feature, which had low usage.

##### References

* [Bug 1730935](https://bugzilla.mozilla.org/show_bug.cgi?id=1730935)

#### [#CVE-2021-43530: Universal XSS in Firefox for Android via QR Code URLs](#CVE-2021-43530)

Reporter
Hafiizh
Impact
high
##### Description

A Universal XSS vulnerability was present in Firefox for Android resulting from improper sanitization when processing a URL scanned from a QR code.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1736886](https://bugzilla.mozilla.org/show_bug.cgi?id=1736886)

#### [#CVE-2021-38508: Permission Prompt could be overlaid, resulting in user confusion and potential spoofing](#CVE-2021-38508)

Reporter
Raphael
Impact
moderate
##### Description

By displaying a form validity message in the correct location at the same time as a permission prompt (such as for geolocation), the validity message could have obscured the prompt, resulting in the user potentially being tricked into granting the permission.

##### References

* [Bug 1366818](https://bugzilla.mozilla.org/show_bug.cgi?id=1366818)

#### [#CVE-2021-43531: Web Extensions could access pre-redirect URL when their context menu was triggered by a user](#CVE-2021-43531)

Reporter
Rob Wu
Impact
moderate
##### Description

When a user loaded a Web Extensions context menu, the Web Extension could access the post-redirect URL of the element clicked. If the Web Extension lacked the WebRequest permission for the hosts involved in the redirect, this would be a same-origin-violation leaking data the Web Extension should have access to. This was fixed to provide the pre-redirect URL. This is related to CVE-2021-43532 but in the context of Web Extensions.

##### References

* [Bug 1659155](https://bugzilla.mozilla.org/show_bug.cgi?id=1659155)

#### [#CVE-2021-38509: Javascript alert box could have been spoofed onto an arbitrary domain](#CVE-2021-38509)

Reporter
Ademar Nowasky Junior
Impact
moderate
##### Description

Due to an unusual sequence of attacker-controlled events, a Javascript `alert()` dialog with arbitrary (although unstyled) contents could be displayed over top an uncontrolled webpage of the attacker's choosing.

##### References

* [Bug 1718571](https://bugzilla.mozilla.org/show_bug.cgi?id=1718571)

#### [#CVE-2021-38510: Download Protections were bypassed by .inetloc files on Mac OS](#CVE-2021-38510)

Reporter
Hou JingYi
Impact
moderate
##### Description

The executable file warning was not presented when downloading .inetloc files, which can run commands on a user's computer.
*Note: This issue only affected Mac OS operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1731779](https://bugzilla.mozilla.org/show_bug.cgi?id=1731779)

#### [#CVE-2021-43532: 'Copy Image Link' context menu action could have been abused to see authentication tokens](#CVE-2021-43532)

Reporter
Ademar Nowasky Junior
Impact
low
##### Description

The 'Copy Image Link' context menu action would copy the final image URL after redirects. By embedding an image that triggered authentication flows - in conjunction with a Content Security Policy that stopped a redirection chain in the middle - the final image URL could be one that contained an authentication token used to takeover a user account. If a website tricked a user into copy and pasting the image link back to the page, the page would be able to steal the authentication tokens. This was fixed by making the action return the original URL, before any redirects.

##### References

* [Bug 1719203](https://bugzilla.mozilla.org/show_bug.cgi?id=1719203)

#### [#CVE-2021-43533: URL Parsing may incorrectly parse internationalized domains](#CVE-2021-43533)

Reporter
Taiga Shirakura
Impact
low
##### Description

When parsing internationalized domain names, high bits of the characters in the URLs were sometimes stripped, resulting in inconsistencies that could lead to user confusion or attacks such as phishing.

##### References

* [Bug 1724233](https://bugzilla.mozilla.org/show_bug.cgi?id=1724233)

#### [#CVE-2021-43534: Memory safety bugs fixed in Firefox 94 and Firefox ESR 91.3](#CVE-2021-43534)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Christian Holler, Valentin Gosu, and Andrew McCreight reported memory safety bugs present in Firefox 93 and Firefox ESR 91.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 94 and Firefox ESR 91.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1606864%2C1712671%2C1730048%2C1735152)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_e476fcf1_20250115_093206.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1659155)
* [XML](/show_bug.cgi?ctype=xml&id=1659155)

Closed
[Bug 1659155](/show_bug.cgi?id=1659155)
(CVE-2021-43531)

Opened 4 years ago
Closed 3 years ago

# contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.

## Categories

### (WebExtensions :: General, defect, P1)

[Product:](/describecomponents.cgi?product=WebExtensions)

WebExtensions
▾

WebExtensions
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Product](/buglist.cgi?product=WebExtensions&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=WebExtensions)
Watch This Product

[Component:](/describecomponents.cgi?product=WebExtensions&component=General#General)

General
▾

WebExtensions :: General
All other bugs about WebExtensions
[See Open Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=WebExtensions&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=WebExtensions&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### (firefox-esr78 wontfix, firefox-esr91- wontfix, firefox92 wontfix, firefox93 wontfix, firefox94+ fixed, firefox95+ fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

95 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix) |
| firefox94 | [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed) |
| firefox95 | [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 | - | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox92 |  | wontfix |
| firefox93 |  | wontfix |
| firefox94 | + | fixed |
| firefox95 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

[Blocking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Blocking_Flags)

| webextensions | --- |
| --- | --- |

## People

### (Reporter: robwu, Assigned: robwu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/30e26944b9b786ea16fce8b18394c6e4?d=mm&size=40)  [robwu](/user_profile?user_id=447061)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/30e26944b9b786ea16fce8b18394c6e4?d=mm&size=40)  [robwu](/user_profile?user_id=447061)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2132cf6e7db0fa0e604b86d120c813ee?d=mm&size=40)  [zombie](/user_profile?user_id=445095)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2021-43532](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1659155&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1659155)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1621249](/show_bug.cgi?id=1621249 "RESOLVED FIXED - DeviantArt Images (And Twitter DMs images) downloads fail with extensions, but not with \"stock\" save image"), [1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"), [1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent")

[CVE-2021-43532](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")

[mozilla-hub.atlassian.net/browse/WEBE...](https://mozilla-hub.atlassian.net/browse/WEBEXT-184 "https://mozilla-hub.atlassian.net/browse/WEBEXT-184")

## Details

### (4 keywords, Whiteboard: [addons-jira][adv-main94+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-43531

[Keywords:](/describekeywords.cgi)

[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[dev-doc-complete](/buglist.cgi?keywords=dev-doc-complete&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[addons-jira][adv-main94+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a36464560_75935 "3 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | [qe-verify](#a37461210_458186 "3 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [menus-srcUrl-redirect.zip](/attachment.cgi?id=9170075)  [4 years ago](#c0)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   1.54 KB, application/zip |  | [Details](/attachment.cgi?id=9170075&action=edit) |
| --- | --- | --- |
| [Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API](/attachment.cgi?id=9244718)  [3 years ago](#c9)  [Rob Wu [:robwu]](/user_profile?user_id=447061)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c15 "3 years ago") | [Details](/attachment.cgi?id=9244718&action=edit) | [Review](/attachment.cgi?id=9244718) |
| [advisory.txt](/attachment.cgi?id=9248074)  [3 years ago](#c20)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   531 bytes, text/plain |  | [Details](/attachment.cgi?id=9248074&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1659155#c0)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1659155&comment_id=14989409 "2 revisions") |
|  | |

Attached file
[menus-srcUrl-redirect.zip](attachment.cgi?id=9170075)
— [Details](attachment.cgi?id=9170075&action=edit)

Since [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri"), the `info.srcUrl` field of the `contextMenus.onClicked` event returns the URL after redirects, instead of the URL of the image request.

Prior to that bug, and also in Chrome, the `info.srcUrl` field was the image's src element.

STR:

1. Load attached extension, which opens a tab with an image.
2. Right-click on the image and click on the extension's context menu.

Expected (Chrome 84):

* A dialog with a URL ending with "before-redirect".

Actual (Firefox 81):

* A dialog with a URL ending with "after-redirect"

I'm inclined to resolve the bug as follows:

* ~~Update MDN to clarify that `info.srcUrl` may differ from the `<img>`'s src attribute. In Chrome, this is always the URL of the initial request. In Firefox, this is the final URL (after any redirects).~~ EDIT: The alternative is preferred, see [comment 2](/show_bug.cgi?id=1659155#c2 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") and [comment 3](/show_bug.cgi?id=1659155#c3 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.").
* Add a unit test to make sure that the behavior continues to be as documented.

The alternative is to let `info.srcUrl` be the initial URL again. This would result in consistent behavior between Firefox and Chrome. I guess that few users cared either way, since nobody has filed a bug about this (I only discovered this when I [investigated a report about DownThemAll not working on Twitter](https://bugzilla.mozilla.org/show_bug.cgi?id=1621249#c4)).

Some extensions ([including DownThemAll](https://github.com/downthemall/downthemall/blob/858b8f277e8f9c0a080193916c6f01c73aa437a0/lib/background.ts#L505-L531)) use `info.srcUrl` to identify the element to which the context menu is anchored from a content script. Since there is a superior alternative (`info.targetElementId` + [`browser.menus.getTargetElement`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus/getTargetElement)), I would recommend extension authors to use that API to really identify the target element without having to traverse the whole DOM to find the image element of interest.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1659155#c1)• 4 years ago |
|  | |

I'll wait till the next bug triage, and if the team agrees, I'll add `dev-doc-needed` to the bug.

Or maybe `dev-doc-complete` after updating the documentation myself, at <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus/OnClickData>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a2521_447061)• 4 years ago |

See Also: → [1621249](/show_bug.cgi?id=1621249 "RESOLVED FIXED - DeviantArt Images (And Twitter DMs images) downloads fail with extensions, but not with \"stock\" save image")

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a530314_447061)• 4 years ago |

Type: task → enhancementSee Also: [1452819](/show_bug.cgi?id=1452819 "VERIFIED FIXED - Save Image without file extension does not use ContentType") → [1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1659155#c2)• 4 years ago |
|  | |

I'm a bit on the fence here.

Writing cross browser compatible code would be nice, thus srcUrl being consistent with (probably) the rest of the browsers implementing this api is preferable. As well, while targetElementId is superior for the purpose, it's not cross browser.

Having the final url in srcUrl is probably useful for some, but I'm not sure it outweighs the compatibility.

In retrospect we should have kept srcUrl compatible, and introduced finalSrcUrl. It feels like doing that at this point just muddies the water.

I think we'd probably be better off if this were compatible at least in V3, and it probably makes sense to have it compatible in V2 to lower the V2->V3 transition.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1659155#c3)• 4 years ago |
|  | |

During the triage we decided that `info.srcUrl` should be the original URL, before redirects. This is because the final URL (after redirects) is normally not exposed to the web platform, and the original URL is usually expected. It's also more compatible with Chrome.

The doubts about final URL vs current URL is not limited to extensions, there is a similar discussion going on in [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent"). That bug and this bug may be able to share the same solution.

FYI, the property is internally called `.mediaURL`, and used by video, audio and images. For video and audio, it's already the pre-redirect URL. For images, it's somehow the final URL: <https://searchfox.org/mozilla-central/rev/d54210d490ef335b13fc1fcac817525120c8c46b/browser/actors/ContextMenuChild.jsm#1005-1022>

Severity: -- → S3Type: enhancement → defectPriority: -- → P3See Also: → [1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a28293909_1689)• 4 years ago |

See Also: → [CVE-2021-43532](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1659155#c4)• 3 years ago |
|  | |

The reason it's the post-redirect URL was *also* web extensions :-( This was done in [bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri") (and causing other problems, see [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted"))

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1659155#c5)• 3 years ago |
|  | |

In the case of a redirected image this reveals information to an extension that the Same-origin policy forbids unless it has WebRequest access to the hosts in order to follow the redirect chain.

Group: firefox-core-securityKeywords: [csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Regressed by: [1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a33169473_546015)• 3 years ago |

Has Regression Range: --- → yesKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1659155#c6)• 3 years ago |
|  | |

Depending on the implementation, fixing [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted") would resolve this bug and also [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1659155#c7)• 3 years ago |
|  | |

(In reply to Rob Wu [:robwu] from [comment #6](/show_bug.cgi?id=1659155#c6 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value."))

> Depending on the implementation, fixing [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted") would resolve this bug and also [bug 1644802](/show_bug.cgi?id=1644802 "RESOLVED DUPLICATE - Right click copy image location inconsistent")

There's a patch up in 1719203 now, is more work needed here or not?

Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1659155#c8)• 3 years ago |
|  | |

Yes, more work is needed.

The extension framework implementation reads the URL from `contextData.srcUrl` :

* <https://searchfox.org/mozilla-central/rev/235982cdb78d0dc3ab4e48326b084ce087302cab/browser/components/extensions/parent/ext-menus.js#694>
* <https://searchfox.org/mozilla-central/rev/235982cdb78d0dc3ab4e48326b084ce087302cab/browser/components/extensions/parent/ext-menus.js#958>

`srcUrl` is currently set to `mediaURL` at <https://searchfox.org/mozilla-central/rev/235982cdb78d0dc3ab4e48326b084ce087302cab/browser/base/content/nsContextMenu.js#136>

To fix this bug, we would have to replace `srcUrl: this.mediaURL` with `srcUrl: this.originalMediaURL` (introduced in the patch for [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")), plus a unit test for this scenario. The fix is trivial, the tests are most of the work. I could take care of that once the patch for [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted") lands.

Assignee: nobody → robStatus: NEW → ASSIGNEDDepends on: [CVE-2021-43532](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")Flags: needinfo?(rob)Whiteboard: [addons-jira]

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1659155#c9)• 3 years ago |
|  | |

Attached file
[Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API](attachment.cgi?id=9244718)
— [Details](attachment.cgi?id=9244718&action=edit)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a36174414_447061)• 3 years ago |

See Also: → <https://mozilla-hub.atlassian.net/browse/WEBEXT-184>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1659155#c10)• 3 years ago |
|  | |

Once this bug gets fixed, the change should be documented in the release notes.

And the documentation of srcUrl on MDN should clarify that the URL is the pre-redirect URL, but that it was the post-redirect URL from Firefox 59 ([bug 1406253](/show_bug.cgi?id=1406253 "RESOLVED FIXED - HTMLImageElement currentURI after redirect is pre-redirect uri")) up until Firefox 95 (fixed in this bug) (or maybe even 94, if we decide to uplift this bug for consistency with the behavior in [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")).

Keywords: [dev-doc-needed](/buglist.cgi?keywords=dev-doc-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1659155#c11)• 3 years ago |
|  | |

Use pre-redirect URL as srcUrl in contextMenus API r=Gijs

<https://hg.mozilla.org/integration/autoland/rev/010f3ed252635ba277844b24ed7b073592d5e8df>

<https://hg.mozilla.org/mozilla-central/rev/010f3ed25263>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 95 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a36464504_75935)• 3 years ago |

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix)
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B)
[tracking-firefox95](/buglist.cgi?f1=cf_tracking_firefox95&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [94+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=94%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a36464560_75935)• 3 years ago |

Flags: in-testsuite+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1659155#c12)• 3 years ago |
|  | |

Changing the priority to p1 as the bug is tracked by a release manager for the current beta.

See [What Do You Triage](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html) for more information

Priority: P3 → P1

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1659155#c13)• 3 years ago |
|  | |

The patch landed in nightly and beta is affected.

:robwu, is this bug important enough to require an uplift?

If not please set `status_beta` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1659155#c14)• 3 years ago |
|  | |

Comment on [attachment 9244718](/attachment.cgi?id=9244718 "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API") [[details]](/attachment.cgi?id=9244718&action=edit "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API")

[Bug 1659155](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") - Use pre-redirect URL as srcUrl in contextMenus API

### Beta/Release Uplift Approval Request

* **User impact if declined**: It would be nice if the two related secbugs were fixed in the same release (this bug and [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")). Otherwise there is inconsistent behavior.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Why potentially risky: This changes the behavior of the extension API in some cases.

  Why not risky: The new behavior is consistent with user expectations in other situations ([bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")), and identical to the behavior of the same extension API in Chromium.
* **String changes made/needed**:
Flags: needinfo?(rob)
[Attachment #9244718](/attachment.cgi?id=9244718&action=edit "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1659155#c15)• 3 years ago |
|  | |

Comment on [attachment 9244718](/attachment.cgi?id=9244718 "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API") [[details]](/attachment.cgi?id=9244718&action=edit "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API")

[Bug 1659155](/show_bug.cgi?id=1659155 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value.") - Use pre-redirect URL as srcUrl in contextMenus API

Approved for 94.0b5.

[Attachment #9244718](/attachment.cgi?id=9244718&action=edit "Bug 1659155 - Use pre-redirect URL as srcUrl in contextMenus API") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1659155#c16)• 3 years ago |
|  | |

Should we take this and [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted") on ESR91?

Flags: needinfo?(rob)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1659155#c17)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/e8852d521e10>

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1659155#c18)• 3 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #16](/show_bug.cgi?id=1659155#c16 "RESOLVED FIXED - contextMenus.onClicked: info.srcUrl is the final URL (after redirects) instead of the <img src> value."))

> Should we take this and [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted") on ESR91?

I'd put this question in the other bug (there is already a question from the reporter, but nobody was needinfo'd).

The change to the extension API is a behavioral change, which has some (small) risk of affecting extensions.

The change to the context menu implementation ([bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted")) affects user behavior.

The main question is whether we consider the sec issue severe enough to warrant uplifting to ESR. I'm 50/50 divided on this one, I'd be fine with uplifting, but also fine if we did not. I'll put a needinfo on the other bug.

Flags: needinfo?(rob)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a37333666_75935)• 3 years ago |

[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[94+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=94%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a37461210_458186)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1659155#c19)• 3 years ago |
|  | |

Sounds like this is wontfix for ESR91 based on the last comments in [bug 1719203](/show_bug.cgi?id=1719203 "VERIFIED FIXED - Context-menu \"Copy Image Link\" leaks intermediate redirect paths if loading interrupted").

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=-)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a37932944_578488)• 3 years ago |

Whiteboard: [addons-jira] → [addons-jira][adv-main94+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1659155#c20)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9248074)
— [Details](attachment.cgi?id=9248074&action=edit)

|  | [Richard Bloor](/user_profile?user_id=501605) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1659155#c21)• 3 years ago |
|  | |

Could I get some clarification here:

* the documentation for srcUrl is rather cryptic, what image is it referring to?
* what is the difference between the pre-redirect URL and post-redirect URL?
Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1659155#c22)• 3 years ago |
|  | |

It's the image (e.g. <img> or a background image) under the pointer where the context menu has been opened.

The "pre-redirect" URL is the initial URL, e.g. the value of an <img>'s src attribute (or the value of the url() CSS function in case of background-image).

After a redirect (e.g. HTTP 302 by a server), the final URL (post any redirects) is the ultimate redirection target, likely different from the initial URL.

/

Flags: needinfo?(rob)

|  | [Richard Bloor](/user_profile?user_id=501605) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1659155#c23)• 3 years ago |
|  | |

Documentation changes are ready to review:

* [menus.OnClickedData.srcUrl returns <img src> #10214](https://github.com/mdn/content/pull/10214)
* [menus.OnClickedData.srcUrl returned post-redirect URL #13259](https://github.com/mdn/browser-compat-data/pull/13259)
Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1659155#c24)• 3 years ago |
|  | |

Posted reviews.

Flags: needinfo?(rob)

|  | [Richard Bloor](/user_profile?user_id=501605) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a38614213_501605)• 3 years ago |

Keywords: [dev-doc-needed](/buglist.cgi?keywords=dev-doc-needed&resolution=---)

|  | [Richard Bloor](/user_profile?user_id=501605) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a38623355_501605)• 3 years ago |

Keywords: [dev-doc-complete](/buglist.cgi?keywords=dev-doc-complete&resolution=---)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a41107626_428608)• 3 years ago |

Alias: CVE-2021-43531

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1659155#a64156397_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1659155&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Rob Wu [:robwu]](/user_profile?user_id=447061)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


