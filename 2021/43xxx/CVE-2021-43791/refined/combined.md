=== Content from github.com_2e27b797_20250115_082541.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-wj76-pcqr-mf9f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-wj76-pcqr-mf9f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  889](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

# Ineffective expiration validation for invitation links

Moderate

[alexmv](/alexmv)
published
GHSA-wj76-pcqr-mf9f
Dec 2, 2021

## Package

Zulip Server
(Zulip)

## Affected versions

<4.8

## Patched versions

4.8

## Description

### Impact

Expiration dates on the confirmation objects associated with email invitations were not enforced properly in the new account registration flow.

### Patches

The issue is fixed in Zulip 4.8.

### Workarounds

None.

### Severity

Moderate

### CVE ID

CVE-2021-43791

### Weaknesses

[CWE-613](/advisories?query=cwe%3A613)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d1e4b48f_20250115_082541.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa014ef75a3a0ed7f24ebb157632ba58751e732c6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa014ef75a3a0ed7f24ebb157632ba58751e732c6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  889](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Commit

[Permalink](/zulip/zulip/commit/a014ef75a3a0ed7f24ebb157632ba58751e732c6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

CVE-2021-43791: Validate confirmation keys in /accounts/register/ cod…

[Browse files](/zulip/zulip/tree/a014ef75a3a0ed7f24ebb157632ba58751e732c6)
Browse the repository at this point in the history

```
…epath.

A confirmation link takes a user to the check_prereg_key_and_redirect
endpoint, before getting redirected to POST to /accounts/register/. The
problem was that validation was happening in the check_prereg_key_and_redirect
part and not in /accounts/register/ - meaning that one could submit an
expired confirmation key and be able to register.

We fix this by moving validation into /accouts/register/.
```

* Loading branch information

[![@mateuszmandera](https://avatars.githubusercontent.com/u/45007152?s=40&v=4)](/mateuszmandera) [![@alexmv](https://avatars.githubusercontent.com/u/28347?s=40&v=4)](/alexmv)

[mateuszmandera](/zulip/zulip/commits?author=mateuszmandera "View all commits by mateuszmandera")
authored and
[alexmv](/zulip/zulip/commits?author=alexmv "View all commits by alexmv")
committed
Dec 1, 2021

1 parent
[a1cd660](/zulip/zulip/commit/a1cd660147a5d89c9aec7c2bb4c0feeea2790229)

commit a014ef7

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**56 additions**
and
**30 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* confirmation

  + confirmation/models.py
    [models.py](#diff-14e7a35bdda1a5bef5f114807ba49ecb8f0dcd4569bfe768faaedd167fffb7d6)
* zerver

  + tests

    - zerver/tests/test\_signup.py
      [test\_signup.py](#diff-940c870652d79870a457600e9cde59f74a5b9980268c9df6e62e0c0d846b7e66)
  + views

    - zerver/views/registration.py
      [registration.py](#diff-ef438982c0e0813a344af6f2022cad723baf88ca5b43807014e095ed9282bf84)
* zproject

  + zproject/urls.py
    [urls.py](#diff-3d2a8322b0ee987dc05f991c59594bb00881e8879a320ba1e1e4444ce87a2cef)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[confirmation/models.py](#diff-14e7a35bdda1a5bef5f114807ba49ecb8f0dcd4569bfe768faaedd167fffb7d6 "confirmation/models.py")

Show comments

[View file](/zulip/zulip/blob/a014ef75a3a0ed7f24ebb157632ba58751e732c6/confirmation/models.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -170,9 +170,9 @@ def \_\_init\_\_( |
|  |  |  |
|  |  |  |
|  |  | \_properties = { |
|  |  | Confirmation.USER\_REGISTRATION: ConfirmationType("check\_prereg\_key\_and\_redirect"), |
|  |  | Confirmation.USER\_REGISTRATION: ConfirmationType("get\_prereg\_key\_and\_redirect"), |
|  |  | Confirmation.INVITATION: ConfirmationType( |
|  |  | "check\_prereg\_key\_and\_redirect", validity\_in\_days=settings.INVITATION\_LINK\_VALIDITY\_DAYS |
|  |  | "get\_prereg\_key\_and\_redirect", validity\_in\_days=settings.INVITATION\_LINK\_VALIDITY\_DAYS |
|  |  | ), |
|  |  | Confirmation.EMAIL\_CHANGE: ConfirmationType("confirm\_email\_change"), |
|  |  | Confirmation.UNSUBSCRIBE: ConfirmationType( |
| Expand All | | @@ -182,7 +182,7 @@ def \_\_init\_\_( |
|  |  | Confirmation.MULTIUSE\_INVITE: ConfirmationType( |
|  |  | "join", validity\_in\_days=settings.INVITATION\_LINK\_VALIDITY\_DAYS |
|  |  | ), |
|  |  | Confirmation.REALM\_CREATION: ConfirmationType("check\_prereg\_key\_and\_redirect"), |
|  |  | Confirmation.REALM\_CREATION: ConfirmationType("get\_prereg\_key\_and\_redirect"), |
|  |  | Confirmation.REALM\_REACTIVATION: ConfirmationType("realm\_reactivation"), |
|  |  | } |
|  |  |  |
| Expand Down | |  |

22 changes: 16 additions & 6 deletions

22
[zerver/tests/test\_signup.py](#diff-940c870652d79870a457600e9cde59f74a5b9980268c9df6e62e0c0d846b7e66 "zerver/tests/test_signup.py")

Show comments

[View file](/zulip/zulip/blob/a014ef75a3a0ed7f24ebb157632ba58751e732c6/zerver/tests/test_signup.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -855,7 +855,7 @@ def test\_register(self) -> None: |
|  |  | with queries\_captured() as queries, cache\_tries\_captured() as cache\_tries: |
|  |  | self.register(self.nonreg\_email("test"), "test") |
|  |  | # Ensure the number of queries we make is not O(streams) |
|  |  | self.assert\_length(queries, 89) |
|  |  | self.assert\_length(queries, 91) |
|  |  |  |
|  |  | # We can probably avoid a couple cache hits here, but there doesn't |
|  |  | # seem to be any O(N) behavior. Some of the cache hits are related |
| Expand Down  Expand Up | | @@ -2014,8 +2014,7 @@ def test\_confirmation\_key\_of\_wrong\_type(self) -> None: |
|  |  | # Verify that using the wrong type doesn't work in the main confirm code path |
|  |  | email\_change\_url = create\_confirmation\_link(prereg\_user, Confirmation.EMAIL\_CHANGE) |
|  |  | email\_change\_key = email\_change\_url.split("/")[-1] |
|  |  | url = "/accounts/do\_confirm/" + email\_change\_key |
|  |  | result = self.client\_get(url) |
|  |  | result = self.client\_post("/accounts/register/", {"key": email\_change\_key}) |
|  |  | self.assertEqual(result.status\_code, 404) |
|  |  | self.assert\_in\_response( |
|  |  | "Whoops. We couldn't find your confirmation link in the system.", result |
| Expand All | | @@ -2032,8 +2031,17 @@ def test\_confirmation\_expired(self) -> None: |
|  |  | with patch("confirmation.models.timezone\_now", return\_value=date\_sent): |
|  |  | url = create\_confirmation\_link(prereg\_user, Confirmation.USER\_REGISTRATION) |
|  |  |  |
|  |  | target\_url = "/" + url.split("/", 3)[3] |
|  |  | result = self.client\_get(target\_url) |
|  |  | key = url.split("/")[-1] |
|  |  | confirmation\_link\_path = "/" + url.split("/", 3)[3] |
|  |  | # Both the confirmation link and submitting the key to the registration endpoint |
|  |  | # directly will return the appropriate error. |
|  |  | result = self.client\_get(confirmation\_link\_path) |
|  |  | self.assertEqual(result.status\_code, 404) |
|  |  | self.assert\_in\_response( |
|  |  | "Whoops. The confirmation link has expired or been deactivated.", result |
|  |  | ) |
|  |  |  |
|  |  | result = self.client\_post("/accounts/register/", {"key": key}) |
|  |  | self.assertEqual(result.status\_code, 404) |
|  |  | self.assert\_in\_response( |
|  |  | "Whoops. The confirmation link has expired or been deactivated.", result |
| Expand Down  Expand Up | | @@ -2124,7 +2132,9 @@ def test\_confirmation\_obj\_not\_exist\_error(self) -> None: |
|  |  | url, {"key": registration\_key, "from\_confirmation": 1, "full\_nme": "alice"} |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 404) |
|  |  | self.assert\_in\_response("The registration link has expired or is not valid.", response) |
|  |  | self.assert\_in\_response( |
|  |  | "Whoops. We couldn't find your confirmation link in the system.", response |
|  |  | ) |
|  |  |  |
|  |  | registration\_key = confirmation\_link.split("/")[-1] |
|  |  | response = self.client\_post( |
| Expand Down | |  |

52 changes: 34 additions & 18 deletions

52
[zerver/views/registration.py](#diff-ef438982c0e0813a344af6f2022cad723baf88ca5b43807014e095ed9282bf84 "zerver/views/registration.py")

Show comments

[View file](/zulip/zulip/blob/a014ef75a3a0ed7f24ebb157632ba58751e732c6/zerver/views/registration.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | import logging |
|  |  | import urllib |
|  |  | from typing import Any, Dict, List, Optional |
|  |  | from typing import Any, Dict, List, Optional, Union |
|  |  | from urllib.parse import urlencode |
|  |  |  |
|  |  | from django.conf import settings |
| Expand Down  Expand Up | | @@ -94,10 +94,36 @@ |
|  |  |  |
|  |  |  |
|  |  | @has\_request\_variables |
|  |  | def check\_prereg\_key\_and\_redirect( |
|  |  | def get\_prereg\_key\_and\_redirect( |
|  |  | request: HttpRequest, confirmation\_key: str, full\_name: Optional[str] = REQ(default=None) |
|  |  | ) -> HttpResponse: |
|  |  | confirmation = Confirmation.objects.filter(confirmation\_key=confirmation\_key).first() |
|  |  | key\_check\_result = check\_prereg\_key(request, confirmation\_key) |
|  |  | if isinstance(key\_check\_result, HttpResponse): |
|  |  | return key\_check\_result |
|  |  | # confirm\_preregistrationuser.html just extracts the confirmation\_key |
|  |  | # (and GET parameters) and redirects to /accounts/register, so that the |
|  |  | # user can enter their information on a cleaner URL. |
|  |  | return render( |
|  |  | request, |
|  |  | "confirmation/confirm\_preregistrationuser.html", |
|  |  | context={"key": confirmation\_key, "full\_name": full\_name}, |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def check\_prereg\_key( |
|  |  | request: HttpRequest, confirmation\_key: str |
|  |  | ) -> Union[Confirmation, HttpResponse]: |
|  |  | """ |
|  |  | Checks if the Confirmation key is valid, returning the Confirmation object in case of success |
|  |  | and an appropriate error page otherwise. |
|  |  | """ |
|  |  | try: |
|  |  | confirmation: Optional[Confirmation] = Confirmation.objects.get( |
|  |  | confirmation\_key=confirmation\_key |
|  |  | ) |
|  |  | except Confirmation.DoesNotExist: |
|  |  | confirmation = None |
|  |  |  |
|  |  | if confirmation is None or confirmation.type not in [ |
|  |  | Confirmation.USER\_REGISTRATION, |
|  |  | Confirmation.INVITATION, |
| Expand All | | @@ -117,14 +143,7 @@ def check\_prereg\_key\_and\_redirect( |
|  |  | except ConfirmationKeyException as exception: |
|  |  | return render\_confirmation\_key\_error(request, exception) |
|  |  |  |
|  |  | # confirm\_preregistrationuser.html just extracts the confirmation\_key |
|  |  | # (and GET parameters) and redirects to /accounts/register, so that the |
|  |  | # user can enter their information on a cleaner URL. |
|  |  | return render( |
|  |  | request, |
|  |  | "confirmation/confirm\_preregistrationuser.html", |
|  |  | context={"key": confirmation\_key, "full\_name": full\_name}, |
|  |  | ) |
|  |  | return confirmation |
|  |  |  |
|  |  |  |
|  |  | @require\_post |
| Expand All | | @@ -139,15 +158,12 @@ def accounts\_register( |
|  |  | default=None, converter=to\_converted\_or\_fallback(to\_non\_negative\_int, None) |
|  |  | ), |
|  |  | ) -> HttpResponse: |
|  |  | try: |
|  |  | confirmation = Confirmation.objects.get(confirmation\_key=key) |
|  |  | except Confirmation.DoesNotExist: |
|  |  | return render(request, "zerver/confirmation\_link\_expired\_error.html", status=404) |
|  |  | key\_check\_result = check\_prereg\_key(request, key) |
|  |  | if isinstance(key\_check\_result, HttpResponse): |
|  |  | return key\_check\_result |
|  |  |  |
|  |  | prereg\_user = confirmation.content\_object |
|  |  | prereg\_user = key\_check\_result.content\_object |
|  |  | assert prereg\_user is not None |
|  |  | if prereg\_user.status == confirmation\_settings.STATUS\_REVOKED: |
|  |  | return render(request, "zerver/confirmation\_link\_expired\_error.html", status=404) |
|  |  | email = prereg\_user.email |
|  |  | realm\_creation = prereg\_user.realm\_creation |
|  |  | password\_required = prereg\_user.password\_required |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[zproject/urls.py](#diff-3d2a8322b0ee987dc05f991c59594bb00881e8879a320ba1e1e4444ce87a2cef "zproject/urls.py")

Show comments

[View file](/zulip/zulip/blob/a014ef75a3a0ed7f24ebb157632ba58751e732c6/zproject/urls.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -128,9 +128,9 @@ |
|  |  | accounts\_home, |
|  |  | accounts\_home\_from\_multiuse\_invite, |
|  |  | accounts\_register, |
|  |  | check\_prereg\_key\_and\_redirect, |
|  |  | create\_realm, |
|  |  | find\_account, |
|  |  | get\_prereg\_key\_and\_redirect, |
|  |  | realm\_redirect, |
|  |  | ) |
|  |  | from zerver.views.report import ( |
| Expand Down  Expand Up | | @@ -559,8 +559,8 @@ |
|  |  | path("accounts/register/", accounts\_register, name="accounts\_register"), |
|  |  | path( |
|  |  | "accounts/do\_confirm/<confirmation\_key>", |
|  |  | check\_prereg\_key\_and\_redirect, |
|  |  | name="check\_prereg\_key\_and\_redirect", |
|  |  | get\_prereg\_key\_and\_redirect, |
|  |  | name="get\_prereg\_key\_and\_redirect", |
|  |  | ), |
|  |  | path( |
|  |  | "accounts/confirm\_new\_email/<confirmation\_key>", |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a014ef7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa014ef75a3a0ed7f24ebb157632ba58751e732c6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


