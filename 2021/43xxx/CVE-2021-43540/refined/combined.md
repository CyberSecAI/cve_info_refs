=== Content from www.mozilla.org_9ac8834a_20250115_100151.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-52

## Security Vulnerabilities fixed in Firefox 95

Announced
December 7, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 95

#### [#CVE-2021-43536: URL leakage when navigating while executing asynchronous function](#CVE-2021-43536)

Reporter
Sunwoo Kim and Youngmin Kim of SNU CompSec Lab
Impact
high
##### Description

Under certain circumstances, asynchronous functions could have caused a navigation to fail but expose the target URL.

##### References

* [Bug 1730120](https://bugzilla.mozilla.org/show_bug.cgi?id=1730120)

#### [#CVE-2021-43537: Heap buffer overflow when using structured clone](#CVE-2021-43537)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

An incorrect type conversion of sizes from 64bit to 32bit integers allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1738237](https://bugzilla.mozilla.org/show_bug.cgi?id=1738237)

#### [#CVE-2021-43538: Missing fullscreen and pointer lock notification when requesting both](#CVE-2021-43538)

Reporter
Irvan Kurniawan (@sourc7)
Impact
high
##### Description

By misusing a race in our notification code, an attacker could have forcefully hidden the notification for pages that had received full screen and pointer lock access, which could have been used for spoofing attacks.

##### References

* [Bug 1739091](https://bugzilla.mozilla.org/show_bug.cgi?id=1739091)

#### [#CVE-2021-43539: GC rooting failure when calling wasm instance methods](#CVE-2021-43539)

Reporter
Asumu Takikawa and Ioanna Dimitriou
Impact
high
##### Description

Failure to correctly record the location of live pointers across wasm instance calls resulted in a GC occurring within the call not tracing those live pointers. This could have led to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1739683](https://bugzilla.mozilla.org/show_bug.cgi?id=1739683)

#### [#CVE-2021-4128: Use-after-free in fullscreen objects on MacOS](#CVE-2021-4128)

Reporter
Atila Butkovits
Impact
high
##### Description

When transitioning in and out of fullscreen mode, a graphics object was not correctly protected; resulting in memory corruption and a potentially exploitable crash.
*This bug only affects Firefox on MacOS. Other operating systems are unaffected.*

##### References

* [Bug 1735852](https://bugzilla.mozilla.org/show_bug.cgi?id=1735852)

#### [#CVE-2021-43540: WebExtensions could have installed persistent ServiceWorkers](#CVE-2021-43540)

Reporter
Jake Heath
Impact
moderate
##### Description

WebExtensions with the correct permissions were able to create and install ServiceWorkers for third-party websites that would not have been uninstalled with the extension.

##### References

* [Bug 1636629](https://bugzilla.mozilla.org/show_bug.cgi?id=1636629)

#### [#CVE-2021-43541: External protocol handler parameters were unescaped](#CVE-2021-43541)

Reporter
chriscla
Impact
moderate
##### Description

When invoking protocol handlers for external protocols, a supplied parameter URL containing spaces was not properly escaped.

##### References

* [Bug 1696685](https://bugzilla.mozilla.org/show_bug.cgi?id=1696685)

#### [#CVE-2021-43542: XMLHttpRequest error codes could have leaked the existence of an external protocol handler](#CVE-2021-43542)

Reporter
Raphael Smolik
Impact
moderate
##### Description

Using XMLHttpRequest, an attacker could have identified installed applications by probing error messages for loading external protocols.

##### References

* [Bug 1723281](https://bugzilla.mozilla.org/show_bug.cgi?id=1723281)

#### [#CVE-2021-43543: Bypass of CSP sandbox directive when embedding](#CVE-2021-43543)

Reporter
Armin Ebert
Impact
moderate
##### Description

Documents loaded with the CSP sandbox directive could have escaped the sandbox's script restriction by embedding additional content.

##### References

* [Bug 1738418](https://bugzilla.mozilla.org/show_bug.cgi?id=1738418)

#### [#CVE-2021-43544: Receiving a malicious URL as text through a SEND intent could have led to XSS](#CVE-2021-43544)

Reporter
Irwan
Impact
moderate
##### Description

When receiving a URL through a SEND intent, Firefox would have searched for the text, but subsequent usages of the address bar might have caused the URL to load unintentionally, which could lead to XSS and spoofing attacks.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1739934](https://bugzilla.mozilla.org/show_bug.cgi?id=1739934)

#### [#CVE-2021-43545: Denial of Service when using the Location API in a loop](#CVE-2021-43545)

Reporter
Paul ZÃ¼hlcke
Impact
low
##### Description

Using the Location API in a loop could have caused severe application hangs and crashes.

##### References

* [Bug 1720926](https://bugzilla.mozilla.org/show_bug.cgi?id=1720926)

#### [#CVE-2021-43546: Cursor spoofing could overlay user interface when native cursor is zoomed](#CVE-2021-43546)

Reporter
Daniel Veditz
Impact
low
##### Description

It was possible to recreate previous cursor spoofing attacks against users with a zoomed native cursor.

##### References

* [Bug 1737751](https://bugzilla.mozilla.org/show_bug.cgi?id=1737751)

#### [#CVE-2021-4129: Memory safety bugs fixed in Firefox 95 and Firefox ESR 91.4](#CVE-2021-4129)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Julian Hector, Randell Jesup, Gabriele Svelto, Tyson Smith, Christian Holler, and Masayuki Nakano reported memory safety bugs present in Firefox 94. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 95](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1393362%2C1736046%2C1736751%2C1737009%2C1739372%2C1739421)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_70aefc0c_20250115_100150.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  Â·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summaryâ–¾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View â–¾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1636629)
* [XML](/show_bug.cgi?ctype=xml&id=1636629)

Closed
[Bug 1636629](/show_bug.cgi?id=1636629)
(CVE-2021-43540)

Opened 5 years ago
Closed 3 years ago

# Extensions can Inject ServiceWorkers which persist after uninstall

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Extensions can Inject ServiceWorkers which persist after uninstall

## Categories

### (WebExtensions :: Request Handling, defect, P1)

[Product:](/describecomponents.cgi?product=WebExtensions)

WebExtensions
â–¾

WebExtensions
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Product](/buglist.cgi?product=WebExtensions&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=WebExtensions)
Watch This Product

[Component:](/describecomponents.cgi?product=WebExtensions&component=Request%20Handling#Request%20Handling)

Request Handling
â–¾

WebExtensions :: Request Handling
Bugs about request handling including webRequest and webNavigation.
[See Open Bugs in This Component](/buglist.cgi?product=WebExtensions&component=Request%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=WebExtensions&component=Request%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=WebExtensions&component=Request%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

76 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### (firefox-esr68 wontfix, firefox-esr78 wontfix, firefox-esr91 wontfix, firefox76 wontfix, firefox77 wontfix, firefox78 wontfix, firefox79 wontfix, firefox93 wontfix, firefox94 wontfix, firefox95 verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

95 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox76 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=wontfix) |
| firefox77 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox77&o1=equals&v1=wontfix) |
| firefox78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=wontfix) |
| firefox79 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=wontfix) |
| firefox93 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix) |
| firefox94 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix) |
| firefox95 | --- | [verified](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | wontfix |
| firefox-esr78 |  | wontfix |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox76 |  | wontfix |
| firefox77 |  | wontfix |
| firefox78 |  | wontfix |
| firefox79 |  | wontfix |
| firefox93 |  | wontfix |
| firefox94 |  | wontfix |
| firefox95 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

[Blocking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Blocking_Flags)

| webextensions | --- |
| --- | --- |

## People

### (Reporter: jake.heath91, Assigned: rpl)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/cb15f57474d95eb43c5d903ae3fa34ae?d=mm&size=40)  [rpl](/user_profile?user_id=339062)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/02475a6017d82f579da6865561143be1?d=mm&size=40)  [jake.heath91](/user_profile?user_id=636411)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2132cf6e7db0fa0e604b86d120c813ee?d=mm&size=40)  [zombie](/user_profile?user_id=445095)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

24 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1807919](/show_bug.cgi?id=1807919 "NEW - Add to test_ext_redirects_sw_scripts.js a new test case to cover extension redirection of service worker type module main script and ES modules")

Dependency [tree](/showdependencytree.cgi?id=1636629&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1636629)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1714220](/show_bug.cgi?id=1714220 "RESOLVED DUPLICATE - Hijack Service Worker using Extension")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1648635](/show_bug.cgi?id=1648635 "NEW - Changes from channel.setResponseHeader are persisted in the (disk) cache"), [1810382](/show_bug.cgi?id=1810382 "RESOLVED INVALID - webRequest filterResponseData always fail on service workers scripts")

[1826174](/show_bug.cgi?id=1826174 "RESOLVED FIXED - [DNR] Add test case for service worker redirect in DNR")

[mozilla-hub.atlassian.net/browse/WEBE...](https://mozilla-hub.atlassian.net/browse/WEBEXT-110 "https://mozilla-hub.atlassian.net/browse/WEBEXT-110")

## Details

### (Keywords: sec-moderate, Whiteboard: [post-critsmash-triage][adv-main95+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-43540

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main95+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [btot](/user_profile?user_id=553429) | [qe-verify](#a46442059_553429 "3 years ago") | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files)

| [background.zip](/attachment.cgi?id=9146967)  [5 years ago](#c0)  [Jake Heath](/user_profile?user_id=636411)   1.62 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9146967&action=edit) |
| --- | --- | --- |
| [Bug 1636629 - Log a more explicit error message on invalid redirects. r?asuth!,mixedpuppy!](/attachment.cgi?id=9246421)  [3 years ago](#c19)  [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9246421&action=edit) | [Review](/attachment.cgi?id=9246421) |
| [Bug 1636629 - Permission check on stream filter parent creation. r?mixedpuppy!](/attachment.cgi?id=9246422)  [3 years ago](#c20)  [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9246422&action=edit) | [Review](/attachment.cgi?id=9246422) |
| [Bug 1636629 - Test extension invalid redirects and stream filters applied to service workers scripts. r?asuth!,mixedpuppy!](/attachment.cgi?id=9246423)  [3 years ago](#c21)  [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9246423&action=edit) | [Review](/attachment.cgi?id=9246423) |
| [Beta.png](/attachment.cgi?id=9248594)  [3 years ago](#c26)  [Alex Cornestean](/user_profile?user_id=651196)   74.78 KB, image/png |  | [Details](/attachment.cgi?id=9248594&action=edit) |
| [Nightly.png](/attachment.cgi?id=9248595)  [3 years ago](#c27)  [Alex Cornestean](/user_profile?user_id=651196)   79.64 KB, image/png |  | [Details](/attachment.cgi?id=9248595&action=edit) |
| [advisory.txt](/attachment.cgi?id=9253414)  [3 years ago](#c31)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   233 bytes, text/plain |  | [Details](/attachment.cgi?id=9253414&action=edit) |

Bottom â†“
Tags â–¾

* Reset

Timeline â–¾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jake Heath](/user_profile?user_id=636411)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1636629#c0)â€¢ 5 years ago |
|  | |

Attached file
[background.zip](attachment.cgi?id=9146967)
â€” [Details](attachment.cgi?id=9146967&action=edit)

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0

Steps to reproduce:

Side-load the attached extension and observe that a tab appears loading the URL "<https://example.com>". Then, navigate to "about:debugging" and notice a ServiceWorker has been installed on the example.com domain with the URL "<https://example.com/?injected-sw=1>". Remove the side-loaded extension and notice the ServiceWorker is not unloaded.

Actual results:

An extension installed a ServiceWorker into the domain of a page.

Expected results:

This may be by design, but I don't think extensions should be able to inject ServiceWorkers into pages. This would allow extension developers to monitor all HTTP traffic from that domain and would give them persistent access to this monitoring capability even if the extension is uninstalled. Since the ServiceWorker can be installed with any random query parameter, as demonstrated in the code, this is also extremely difficult for the true owners of the domain to remove the ServiceWorker from the user's browser. User's will likely need to remove the ServiceWorker manually.

It should also be noted that these ServiceWorkers will always be around. Due to how they are installed through header and body manipulations, when the ServiceWorker attempts to update, the content-type will not match the "application/javascript" that is expected when the extension is no longer installed. This will cause the browser to fall back to the original ServiceWorker code.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a47329_159069)â€¢ 5 years ago |

Product: Firefox â†’ WebExtensions

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1636629#c1)â€¢ 5 years ago |
|  | |

Thank you for the detailed explanation and PoC.

(In reply to Jake Heath from [comment #0](/show_bug.cgi?id=1636629#c0 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> This would allow extension developers to monitor all HTTP traffic from that domain

In order to install a ServiceWorker for the origin, the extension already needs all permissions which would allow it to "monitor all traffic".

> Since the ServiceWorker can be installed with any random query parameter, as demonstrated in the code, this is also extremely difficult for the true owners of the domain to remove the ServiceWorker from the user's browser.

I managed to unregister it via the console by reading `navigator.serviceWorker.controller` and creating a new ServiceWorkerRegistration with the same `scriptURL`.

> It should also be noted that these ServiceWorkers will always be around. Due to how they are installed through header and body manipulations, when the ServiceWorker attempts to update, the content-type will not match the "application/javascript" that is expected when the extension is no longer installed. This will cause the browser to fall back to the original ServiceWorker code.

huh, I guess this is step 7 from the update fetch algorithm:

<https://w3c.github.io/ServiceWorker/#ref-for-fetching-scripts-perform-fetch%E2%91%A0>

I'm not that familiar with the ServiceWorkers design, but this seems like a foot gun for websites using them even without any malicious extensions. It looks like deleting the whole website and turning it into static content would keep the service worker alive forever, since those request would likely return a `text/html` 404 error page.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1636629#c2)â€¢ 5 years ago |
|  | |

Service Workers are supposed to be revalidated within 24 hours. If it's possible to force a bad cached version to be around indefinitely, then there's an issue with the spec/implementation. One of the reasons for the removal of HPKP is the undesired side effect of breaking websites for too long by an accidental or intentionally malicious action. I would expect/hope that Service workers are immune to this, but I didn't check recently, and didn't get a clear expectation from the spec discussion at <https://github.com/w3c/ServiceWorker/issues/514>

On the extension-specific part: after uninstalling an extension, it can partially stay active if it managed to inject a script in an existing web page. Short of reloading/discarding all existing tabs, this cannot be resolved. But restarting the browser would generally result in a clean state again.

This report shows that Service workers could be abused to extend the scope of maliciousness.

If we want to mitigate that without changing the API, then we could consider adding a flag to service workers whose response have been tainted by the webRequest.filterResponseData / StreamFilter API, and forcibly unregister such service workers upon extension uninstall.

|  | [Jake Heath](/user_profile?user_id=636411)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1636629#c3)â€¢ 5 years ago |
|  | |

(In reply to Tomislav Jovanovic :zombie from [comment #1](/show_bug.cgi?id=1636629#c1 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> Thank you for the detailed explanation and PoC.
>
> (In reply to Jake Heath from [comment #0](/show_bug.cgi?id=1636629#c0 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))
>
> > This would allow extension developers to monitor all HTTP traffic from that domain
>
> In order to install a ServiceWorker for the origin, the extension already needs all permissions which would allow it to "monitor all traffic".

You're correct here. The main point of the issue though is the persistence, maybe a title change is needed. After the extension is uninstalled, the ServiceWorker remains.

> > Since the ServiceWorker can be installed with any random query parameter, as demonstrated in the code, this is also extremely difficult for the true owners of the domain to remove the ServiceWorker from the user's browser.
>
> I managed to unregister it via the console by reading `navigator.serviceWorker.controller` and creating a new ServiceWorkerRegistration with the same `scriptURL`.

O neat, I didn't know of this API. That would help domain owners remove these extensions programmatically.

> > It should also be noted that these ServiceWorkers will always be around. Due to how they are installed through header and body manipulations, when the ServiceWorker attempts to update, the content-type will not match the "application/javascript" that is expected when the extension is no longer installed. This will cause the browser to fall back to the original ServiceWorker code.
>
> huh, I guess this is step 7 from the update fetch algorithm:
>
> <https://w3c.github.io/ServiceWorker/#ref-for-fetching-scripts-perform-fetch%E2%91%A0>
>
> I'm not that familiar with the ServiceWorkers design, but this seems like a foot gun for websites using them even without any malicious extensions. It looks like deleting the whole website and turning it into static content would keep the service worker alive forever, since those request would likely return a `text/html` 404 error page.

This response also speaks to Rob's comment, but this was my thought as well. The ServiceWorker is supposed to update within 24 hours. However, due to step 7 of the update fetch algorithm, the ServiceWorker will never get the correct response "Content-Type" after the extension has been unloaded because the extension purposefully modifies the "Content-Type" header of a known 200 request to be "application/javascript". When it sees "text/html" instead of "application/javascript", for instance, the ServiceWorker update will fail and it will fall back to the existing extension code. When I originally discovered this issue, I decided against writing it up because of this limitation, but it was only recently (several months later), that I noticed my injected service worker was still running in the background. It had never removed itself.

> If we want to mitigate that without changing the API, then we could consider adding a flag to service workers whose response have been tainted by the webRequest.filterResponseData / StreamFilter API, and forcibly unregister such service workers upon extension uninstall.

Agreed, I think the fix should be that ServiceWorkers injected via extensions should be unloaded when the extension is unloaded. This sounds like a difficult engineering effort, but one that would be worth it. I can think of so many avenues for extensions to abuse this functionality to leak information about user's who install their extension and I think it would be incredibly difficult to put this burden on domain owners to regularly check for malicious ServiceWorkers that have been installed on the domain.

|  | [Emma Humphries â˜•ï¸ðŸŽ¸ðŸ§žâ€â™€ï¸âœ¨ (she/they) [:emceeaich] (Pacific Time) use needinfo](/user_profile?user_id=554394) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1636629#c4)â€¢ 5 years ago |
|  | |

This bug is part of a group of bugs in a security or private group which have the old default Severity of `normal` which has not been changed, and the default priority of `--`. This indicates that this bugs Severity should be set to `--` so it will show up in triage lists.

|  | [Emma Humphries â˜•ï¸ðŸŽ¸ðŸ§žâ€â™€ï¸âœ¨ (she/they) [:emceeaich] (Pacific Time) use needinfo](/user_profile?user_id=554394) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1636629#c5)â€¢ 5 years ago |
|  | |

Trying to set that severity again.

Severity: normal â†’ --

|  | [Stuart Colville [:muffinresearch]](/user_profile?user_id=462407) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1636629#c6)â€¢ 5 years ago |
|  | |

What would be the effort in reliably detecting that a service worker was injected via an extension (assuming that's feasible)? Having SWs that were installed via an extension live and die with the extension sounds attractive.

Flags: needinfo?(rob)

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1636629#c7)â€¢ 5 years ago |
|  | |

(In reply to Stuart Colville [:scolville] from [comment #6](/show_bug.cgi?id=1636629#c6 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> What would be the effort in reliably detecting that a service worker was injected via an extension (assuming that's feasible)? Having SWs that were installed via an extension live and die with the extension sounds attractive.

In this particular case the extension is registering the service worker from a content script and intercepting the script url using the webRequest API,

but there is also another similar scenario:

an extensions may actually be intercepting a service worker that a website is registering on their own and changing the script by using the same strategy (the webRequest API).

I haven't actively looked into this yet (and so the details that follow may be incomplete or not completely true/doable) but maybe we could opt to make sure that we don't cache the service worker scripts that have been intercepted and changed by an extensions using the webRequest API, so that once the extension is uninstalled the script url would be loaded from the website site and not be the one that the extensions did change.

Let's also hear asuth opinion about this issue.

Flags: needinfo?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1636629#c8)â€¢ 5 years ago |
|  | |

ServiceWorkers don't auto-unregister on 404's per spec decision: <https://github.com/w3c/ServiceWorker/issues/204>.

Persistent malicious ServiceWorkers are absolutely a concern, and I don't want to undercut that. In particular, mitigations are not something that would be obvious to sites unless they are actively checking their site logs or have been notified of attacks by bad actors.

In terms of mitigations from a site perspective:

* Sites will inherently see the update checks and these will explicitly be labeled with a `Service-Worker` [header](https://w3c.github.io/ServiceWorker/#service-worker-script-request).
  + Sites can serve a self-unregistering ServiceWorker when this header is observed on unexpected URLs.
  + Sites can serve a response containing a `Clear-Site-Data: storage` [<https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Clear-Site-Data>).
* A site can get all active registrations via [navigator.serviceWorker.getRegistrations](https://w3c.github.io/ServiceWorker/#navigator-service-worker-getRegistrations) and unregister those that don't match those it currently expects. This does assume the site is able to get a clean load from the server, however. This will happen on shift-reload.

The primary intentional security invariants as they relate to malicious ServiceWorkers are that:

* The root/main script must be same-origin to the site.
* Fetches initiated by/on behalf of ServiceWorkers cannot be intercepted by the ServiceWorker. [importScripts](https://w3c.github.io/ServiceWorker/#importscripts) for explicitly sets the request's [service-workers mode](https://fetch.spec.whatwg.org/#request-service-workers-mode) to "none".
* And in general, the site wins over the ServiceWorker. There have been a number of design proposals to allow for ServiceWorkers that cryptographically validate their successor which are legitimate use-cases (ex: encrypted webmail), but unfortunately indistinguishable from the behavior a persistent compromised ServiceWorker would want.
* The underlying script storage for a given ServiceWorker is never directly exposed to content.
  + Our implementation uses the Cache API in a chrome namespace.
  + However, we do expose a Chrome-privileged API for devtools and tests. [Devtools uses it here for content-only purposes](https://searchfox.org/mozilla-central/rev/446160560bf32ebf4cb7c4e25d7386ee22667255/devtools/server/actors/storage.js#2098).

:luca's proposal about marking specific ServiceWorker installs as [tainted in the CS sense](https://en.wikipedia.org/wiki/Taint_checking) by extensions seems like one of the 2 feasible granularities. It's definitely the least disruptive mitigation from a user perspective as:

* The user won't lose any data. ServiceWorker installs are silent and generally structured to be idempotent.
  + The caveat is that there's still only a single storage bucket used for all storage in the origin, and it's quite possible for a freshly installed ServiceWorker to be impacted by a previous ServiceWorker install.
* There would be no ambiguity about the webextension having actively been involved in manipulating the ServiceWorker's installation. Actions taken by content scripts can do any number of complex things, but manipulating a SW install fetch is unambiguous.
* The user intent of uninstalling an extension seems straightforward. The user expectation of uninstalling an extension is that it is no longer around and it will stop continuing to impact the browser. The ServiceWorker should be removed.

The other granularity is origin-level and tracking whether a webextension has potentially influenced the execution of script in an origin at all beyond rejecting loads. This would include:

* Altering any network requests by performing a redirect or altering received content.
* Use of content scripts or tabs.executeScript that allowed the extension principal to do anything under the guise of the origin in question. This includes creating script tags, direct manipulation of storage APIs, etc.

For this level of tainting, the user would potentially want to be offered the option to clear all cookies and site data for origins that had been impacted by the extension. The unfortunate reality is that malicious web extensions have a lot of options to manipulate an origin's browser storage that could continue to impact future browsing sessions. Various examples:

* A freshly re-installed ServiceWorker may continue to use already populated Cache API storage thinking it's valid. Or the ServiceWorker may attempt to re-validate but be tripped up by data placed in storage maliciously and that the ServiceWorker doesn't know how to deal with. For example, an intentionally constructed IDB structured value, or an IDB database that has a much higher version than the ServiceWorker has used.
* Sites like wikipedia have previously used LocalStorage as a JS script cache, which could be manipulated to contain attacker-controlled code.
* Sites may have debugging/analytics infrastructure that's parameterized by data stored locally in the browser for A/B testing, statistical sampling, explicit support, or other possible reasons. These settings could be changed and send the data to an attacker-controlled origin. And as in the previous example, the attacker could leverage the general brittleness of most code to break self-correcting logic.

The user would need to be asked about wiping site data on uninstall, as the impact of wiping origin storage could be user noticeable. To this end, origin-level tainting might be combined with a prompting mechanism that grants permissions for an extension to access a given origin when the super-sketchy `<all_urls>` permission is used or when the ["Access your data on # other sites"](https://support.mozilla.org/en-US/kb/permission-request-messages-firefox-extensions?as=u&utm_source=inproduct#w_access-your-data-on-other-sites) prompt makes it impossible to understand what permissions are being granted. This way the user is able to provide more informed consent on a per-site basis, and potentially understand the need to wipe the storage later. This could also provide somewhat of an audit log. It would be a general UX and security improvement, as it's unlikely that users implicitly understand that the ["Access your data for all websites"](https://support.mozilla.org/en-US/kb/permission-request-messages-firefox-extensions?as=u&utm_source=inproduct#w_access-your-data-for-all-websites) grant means that any extension with the permission can have complete control over the user's banking/paypal/e-commerce sessions the next time they log in.

Flags: needinfo?(bugmail)

|  | [Jake Heath](/user_profile?user_id=636411)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1636629#c9)â€¢ 5 years ago |
|  | |

Another solution that may be worth considering is disallowing SW registration requests from being intercepted and/or modified by the webRequest API. Those are special types of requests and would simple enough to distinguish between normal HTTP requests.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1636629#c10)â€¢ 5 years ago |
|  | |

I wouldn't be against preventing service worker access, but I'd like to have more data.

* What does Chrome do in this case?
* Can we identify how many extensions may be registering serviceworkers? (this would be hard to do for webRequest modifications)
* Are there any valid use cases for extensions to install/modify service worker scripts?

Mitigations could be:

* require a permission to do anything with service workers
  + and ensure removal on disable/uninstall of the extension
* prevent any service worker access

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1636629#c11)â€¢ 5 years ago |
|  | |

(In reply to Shane Caraveo (:mixedpuppy) from [comment #10](/show_bug.cgi?id=1636629#c10 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> I wouldn't be against preventing service worker access, but I'd like to have more data.
>
> * What does Chrome do in this case?

Chrome is not affected by this bug, as there is no `webRequest.filterResponseData` API that would allow modification of response bodies. The only way to change the response to the requested URL is through redirects, but that is not permitted either ("The script resource is behind a redirect, which is disallowed."). FYI Firefox also disallows redirected responses.

> * Can we identify how many extensions may be registering serviceworkers? (this would be hard to do for webRequest modifications)
> * Are there any valid use cases for extensions to install/modify service worker scripts?

Modify = blocking through webRequest? Yes, it's easy to imagine a valid use case - content blockers.

Modify = spoofing service worker scripts through webRequest? I can imagine use cases, but their existence do not justify the consequences of leaving this "feature" open by default. (emphasis on "by default" - opting in via a permission or pref seems more acceptable)

I think that a reasonable first step to resolve this bug is to prevent extensions from using `webRequest.filterResponseData` on service worker scripts, potentially behind a pref in case there is a legitimate need after all.

Flags: needinfo?(rob)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1636629#c12)â€¢ 5 years ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1636629&comment_id=14816982 "1 revision") |
|  | |

(In reply to Shane Caraveo (:mixedpuppy) from [comment #10](/show_bug.cgi?id=1636629#c10 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> * Are there any valid use cases for extensions to install/modify service worker scripts?

It seems likely to be necessary in the ad blocker arms race that ServiceWorkers would want to be modified, even if only for performance and simplicity. Plus, if ServiceWorkers became a way to avoid the reach of WebExtensions, I think it's likely we'd see them used inappropriately and all users would experience performance and power usage regressions that wouldn't help.

> * Can we identify how many extensions may be registering serviceworkers? (this would be hard to do for webRequest modifications)

In terms of installation, I think it's effectively impossible to tell if a content script is making a ServiceWorker install happen or not for [halting problem](https://en.wikipedia.org/wiki/Halting_problem) reasons. Although I guess we could infer the less clever ones using whatever mechanism lets webextensions bypass CSP the page is subject to?

|  | [Stuart Colville [:muffinresearch]](/user_profile?user_id=462407) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1636629#c13)â€¢ 5 years ago |
|  | |

(In reply to Shane Caraveo (:mixedpuppy) from [comment #10](/show_bug.cgi?id=1636629#c10 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> * Can we identify how many extensions may be registering serviceworkers? (this would be hard to do for webRequest modifications)

I've filed a bug separately to cover the operational side of this - see [bug 1637976](/show_bug.cgi?id=1637976 "RESOLVED MOVED") for details.

|  | [Tomislav Jovanovic :zombie](/user_profile?user_id=445095) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a1094074_445095)â€¢ 5 years ago |

Severity: -- â†’ S2Priority: -- â†’ P2

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1636629#c14)â€¢ 5 years ago |
|  | |

Ok, we'll prevent filtering serviceworker scripts with filterResponseData but have that behind a pref (turned on) so we can backout if necessaray.

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a1096085_339062)â€¢ 5 years ago |

Component: Untriaged â†’ Request Handling

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a1099639_1689)â€¢ 5 years ago |

Flags: needinfo?(dveditz)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a2211915_75935)â€¢ 5 years ago |

[status-firefox76](/buglist.cgi?f1=cf_status_firefox76&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox76&o1=equals&v1=wontfix)
[status-firefox77](/buglist.cgi?f1=cf_status_firefox77&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox77&o1=equals&v1=wontfix)
[status-firefox78](/buglist.cgi?f1=cf_status_firefox78&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=affected)
[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- â†’ [?](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=%3F)

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1636629#c15)â€¢ 5 years ago |
|  | |

Removing employee no longer with company from CC list of private bugs.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1636629#c16)â€¢ 5 years ago |
|  | |

Marking as confirmed since this bug is clearly valid.

Also linking to [bug 1648635](/show_bug.cgi?id=1648635 "NEW - Changes from channel.setResponseHeader are persisted in the (disk) cache") because it is relevant.

Status: UNCONFIRMED â†’ NEWEver confirmed: trueSee Also: â†’ [1648635](/show_bug.cgi?id=1648635 "NEW - Changes from channel.setResponseHeader are persisted in the (disk) cache")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a6536227_1689)â€¢ 4 years ago |

Flags: needinfo?(dveditz)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Summary: Extensions can Inject ServiceWorkers into Arbitrary Pages â†’ Extensions can Inject ServiceWorkers which persist after uninstall

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1636629#c18)â€¢ 4 years ago |
|  | |

We're going to introduce a pref to make Service Worker interception with `filterResponseData` an opt-in feature. We can explore other ways to resolve this issue (without disabling the feature) later. The scope of this bug is to resolve the service worker interception, we should also look into `importScripts` and maybe regular scripts too.

Bumping to P1 because we intend to resolve this in this version so that the next ESR (ESR91) includes this fix.

Assignee: nobody â†’ robStatus: NEW â†’ ASSIGNEDPriority: P2 â†’ P1

|  | [Julien Chaupitre](/user_profile?user_id=654294) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a37815780_654294)â€¢ 3 years ago |

See Also: â†’ <https://mozilla-hub.atlassian.net/browse/WEBEXT-110>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a45069537_447061)â€¢ 3 years ago |

Assignee: rob â†’ lgreco

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1636629#c19)â€¢ 3 years ago |
|  | |

Attached file
[Bug 1636629 - Log a more explicit error message on invalid redirects. r?asuth!,mixedpuppy!](attachment.cgi?id=9246421)
â€” [Details](attachment.cgi?id=9246421&action=edit)

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1636629#c20)â€¢ 3 years ago |
|  | |

Attached file
[Bug 1636629 - Permission check on stream filter parent creation. r?mixedpuppy!](attachment.cgi?id=9246422)
â€” [Details](attachment.cgi?id=9246422&action=edit)

Depends on D128736

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1636629#c21)â€¢ 3 years ago |
|  | |

Attached file
[Bug 1636629 - Test extension invalid redirects and stream filters applied to service workers scripts. r?asuth!,mixedpuppy!](attachment.cgi?id=9246423)
â€” [Details](attachment.cgi?id=9246423&action=edit)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1636629#c22)â€¢ 3 years ago |
|  | |

Landed:

<https://hg.mozilla.org/integration/autoland/rev/8ec39d08c9afc4c7eeef775ce7076bf6baa4b5b8>

<https://hg.mozilla.org/integration/autoland/rev/9791a5dc84d8eb1622d5ad8d6ad8bdbb3539f403>

Backed out for causing xpcshell failures in test\_ext\_permissions\_api.js:

<https://hg.mozilla.org/integration/autoland/rev/a5bba1f25e5ab6085648c5906cecbfe9417e74e3>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=usercancel%2Ctestfailed%2Cbusted%2Cexception&revision=9791a5dc84d8eb1622d5ad8d6ad8bdbb3539f403&selectedTaskRun=djZ-3WO5TiebkakaHjjpww.0>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=355972018&repo=autoland>

```
[task 2021-10-25T18:36:56.372Z] 18:36:56     INFO -  TEST-PASS | xpcshell.ini:toolkit/components/extensions/test/xpcshell/test_ext_permissions_api.js | test_api_on_permissions_changed - [test_api_on_permissions_changed : 170] webRequest API is injected after permission request - Expected: true, Actual: true - true == true
[task 2021-10-25T18:36:56.372Z] 18:36:56  WARNING -  TEST-UNEXPECTED-FAIL | xpcshell.ini:toolkit/components/extensions/test/xpcshell/test_ext_permissions_api.js | test_api_on_permissions_changed - [test_api_on_permissions_changed : 170] webRequestFilterResponse.serviceWorkerScript API is injected after permission request - Expected: true, Actual: false - false == true

```
Flags: needinfo?(lgreco)

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1636629#c23)â€¢ 3 years ago |
|  | |

I have updated the patch that triggered this failure to make sure it does trigger that failure, and also confirmed with Shane that we are in agreement about pushing the updated patch back into autoland.

Flags: needinfo?(lgreco)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1636629#c24)â€¢ 3 years ago |
|  | |

Log a more explicit error message on invalid redirects. r=asuth,mixedpuppy

<https://hg.mozilla.org/integration/autoland/rev/7fd59a7f04059ee17ee40dfcfa2ce74b263dffd4>

Permission check on stream filter parent creation. r=mixedpuppy

<https://hg.mozilla.org/integration/autoland/rev/a5bee441d127717c8481c38b3d3db48511d6f5f7>

<https://hg.mozilla.org/mozilla-central/rev/a5bee441d127>

<https://hg.mozilla.org/mozilla-central/rev/7fd59a7f0405>

Group: firefox-core-security â†’ core-security-releaseStatus: ASSIGNED â†’ RESOLVEDClosed: 3 years ago
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- â†’ [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed)Resolution: --- â†’ FIXEDTarget Milestone: --- â†’ 95 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a46403678_75935)â€¢ 3 years ago |

[status-firefox78](/buglist.cgi?f1=cf_status_firefox78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=affected) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox78&o1=equals&v1=wontfix)
[status-firefox79](/buglist.cgi?f1=cf_status_firefox79&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=affected) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox79&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix)
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=%3F) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a46442059_553429)â€¢ 3 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Alex Cornestean](/user_profile?user_id=651196) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1636629#c25)â€¢ 3 years ago |
|  | |

Hello,

Iâ€™m attempting to verify the fix, however, Iâ€™m not entirely sure of the results Iâ€™ve obtained which should confirm the fix.

First I reproduced the issue on the latest Beta 94 (94.0/20211028161635) (which does not have the fix). I loaded the add-on in the first comment via about:debugging and indeed a new tab with <https://example.com/> was opened. Returning to about:debugging as per the STR, a service worker with this name <https://example.com/?injected-sw=1> is listed in the Service Workers section as Running. Removing the add-on, does not remove the service worker, however it will stop running after a short time - the status will say Stopped. I think this was the behavior the reporter of the bug noticed.

Then, on the latest Nightly 95 (95.0a1/20211031213949) (which has the fix), I did the same (loaded the add-on via about:debugging, example.com opened in a new tab, switched to about:debugging again). NO service worker was installed. The Service Worker section is empty.

Could you please confirm this is the expected result? I will not change the status of the issue until further notice.

Thank you !

Note: Tested on the latest Nightly and Beta under Windows 10 x64 and Ubuntu 16.04 LTS.

|  | [Alex Cornestean](/user_profile?user_id=651196) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1636629#c26)â€¢ 3 years ago |
|  | |

Attached image
[Beta.png](attachment.cgi?id=9248594)
â€” [Details](attachment.cgi?id=9248594&action=edit)

|  | [Alex Cornestean](/user_profile?user_id=651196) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1636629#c27)â€¢ 3 years ago |
|  | |

Attached image
[Nightly.png](attachment.cgi?id=9248595)
â€” [Details](attachment.cgi?id=9248595&action=edit)

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1636629#c28)â€¢ 3 years ago |
|  | |

Hi Luca, adding ni for Alex' question in [comment 25](/show_bug.cgi?id=1636629#c25 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"). Thanks!

Flags: needinfo?(lgreco)

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1636629#c29)â€¢ 3 years ago |
|  | |

(In reply to Alex Cornestean from [comment #25](/show_bug.cgi?id=1636629#c25 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> ...
>
> Could you please confirm this is the expected result? I will not change the status of the issue until further notice.
>
> ...

Hi Alex, I confirm that what you described in [comment 25](/show_bug.cgi?id=1636629#c25 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall") is the expected result.

In particular:

* on Firefox < 95: the attached test extension is able to register a fake ("non actually existing") serviceworker script on example.com by using:

  + blocking listener on `webRequest.onHeaderReceived` (used to set the content type that is expected to be valid for a service worker script)
  + blocking listener on `webRequest.onBeforeRequest` + `webRequest.filterResponseData` API method (used to set the body of the fake serviceworker script to the JS code the extensions wants to execute in the example.com service worker)
* on Firefox >= 95: the attached test extensions fails to create the fake serviceworker script successfully because using `webRequest.filterResponseData` fails (as expected with the changes landed from this bug) and a `TypeError: ServiceWorker script at https://example.com/?injected-sw=1 for scope https://example.com/ threw an exception during script evaluation.` webRequest is logged in the browser console, as a side effect of the extension being unable to use webRequest.filterResponseData on the service worker script ([1]) .

Clearing a previously registered service worker isn't covered by any of the patches landed or attached to this bug as we previously agreed (see [comment 14](/show_bug.cgi?id=1636629#c14 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall") and [comment 18](/show_bug.cgi?id=1636629#c18 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall") for a short summary of what we agreed on for this bug).

---

[1]: if the extension does set a `filter.onerror` callback, Firefox is going to also call it with `filter.error` set to "Invalid Request ID", but that isn't the case for the attached test extension (anyway that behavior is covered by the attached test case, which has not been landed yet but it has been used locally to confirm the expected behaviors while working on the other 2 patches).

Flags: needinfo?(lgreco)

|  | [Alex Cornestean](/user_profile?user_id=651196) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1636629#c30)â€¢ 3 years ago |
|  | |

Thank you, Luca !

As per [Comment 29](/show_bug.cgi?id=1636629#c29 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"), I will mark the issue as Verified Fixed.

Status: RESOLVED â†’ VERIFIED
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=verified)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a48268364_75935)â€¢ 3 years ago |

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a49462765_428608)â€¢ 3 years ago |

Whiteboard: [post-critsmash-triage] â†’ [post-critsmash-triage][adv-main95+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1636629#c31)â€¢ 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9253414)
â€” [Details](attachment.cgi?id=9253414&action=edit)

|  | [Jake Heath](/user_profile?user_id=636411)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1636629#c32)â€¢ 3 years ago |
|  | |

Nice job, everyone! From my perspective that is fixed to me. The SW should never have been installed.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a49549829_428608)â€¢ 3 years ago |

Alias: CVE-2021-43540

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a72597705_1689)â€¢ 2 years ago |

Group: core-security-release

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1636629#c33)â€¢ 2 years ago |
|  | |

Assigning needinfo to myself as a reminder for rebasing and landing the patch with the additional test case.

If [Bug 1247687](/show_bug.cgi?id=1247687 "RESOLVED FIXED - Implement worker modules") did already land, consider adding also a test case with the test extension intercepting and trying to redirect main script and imported modules related to a `{ type: "module" }` service worker, otherwise to file a followup to track the additions to the test case.

Flags: needinfo?(lgreco)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a83266880_600971)â€¢ 2 years ago |

[Attachment #9246423](/attachment.cgi?id=9246423&action=edit "Bug 1636629 - Test extension invalid redirects and stream filters applied to service workers scripts. r?asuth!,mixedpuppy!") -
Attachment description: Bug 1636629 - Test invalid redirects and filters. r?asuth!,mixedpuppy! â†’ Bug 1636629 - Test extension invalid redirects and stream filters applied to service workers scripts. r?asuth!,mixedpuppy!

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1636629#c34)â€¢ 2 years ago |
|  | |

Pushed by luca.greco@alcacoop.it:
<https://hg.mozilla.org/integration/autoland/rev/e5627209199d>
Test extension invalid redirects and stream filters applied to service workers scripts. r=asuth,mixedpuppy

|  | [Cosmin Sabou [:CosminS]](/user_profile?user_id=600699) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1636629#c35)â€¢ 2 years ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/e5627209199d>

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a83335638_339062)â€¢ 2 years ago |

Blocks: [1807919](/show_bug.cgi?id=1807919 "NEW - Add to test_ext_redirects_sw_scripts.js a new test case to cover extension redirection of service worker type module main script and ES modules")

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1636629#c36)â€¢ 2 years ago |
|  | |

(In reply to Luca Greco [:rpl] [:luca] [:lgreco] from [comment #33](/show_bug.cgi?id=1636629#c33 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall"))

> Assigning needinfo to myself as a reminder for rebasing and landing the patch with the additional test case.
>
> If [Bug 1247687](/show_bug.cgi?id=1247687 "RESOLVED FIXED - Implement worker modules") did already land, consider adding also a test case with the test extension intercepting and trying to redirect main script and imported modules related to a `{ type: "module" }` service worker, otherwise to file a followup to track the additions to the test case.

Filed [Bug 1807919](/show_bug.cgi?id=1807919 "NEW - Add to test_ext_redirects_sw_scripts.js a new test case to cover extension redirection of service worker type module main script and ES modules") as a followup to cover the additional scenario in the test (landed in central in [comment 35](/show_bug.cgi?id=1636629#c35 "VERIFIED FIXED - Extensions can Inject ServiceWorkers which persist after uninstall")).

Flags: needinfo?(lgreco)

|  | [Luca Greco [:rpl] [:luca] [:lgreco]](/user_profile?user_id=339062)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a85494419_339062)â€¢ 2 years ago |

See Also: â†’ [1810382](/show_bug.cgi?id=1810382 "RESOLVED INVALID - webRequest filterResponseData always fail on service workers scripts")

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1636629#a91561862_447061)â€¢ 2 years ago |

See Also: â†’ [1826174](/show_bug.cgi?id=1826174 "RESOLVED FIXED - [DNR] Add test case for service worker redirect in DNR")
You need to [log in](/show_bug.cgi?id=1636629&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top â†‘

## Attachment

Hide Details

### General

Creator:  [Jake Heath](/user_profile?user_id=636411)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from security.gentoo.org_ffa2d904_20250115_100150.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities â€” GLSA **202202-03**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could result in the arbitrary execution of code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **97.0** |
| Unaffected versions | >= **91.6.0**>= **97.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-91.6.0:esr"

```

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-91.6.0:esr"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-97.0:rapid"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-97.0:rapid"

```
### References

* [CVE-2021-29970](https://nvd.nist.gov/vuln/detail/CVE-2021-29970)
* [CVE-2021-29972](https://nvd.nist.gov/vuln/detail/CVE-2021-29972)
* [CVE-2021-29974](https://nvd.nist.gov/vuln/detail/CVE-2021-29974)
* [CVE-2021-29975](https://nvd.nist.gov/vuln/detail/CVE-2021-29975)
* [CVE-2021-29976](https://nvd.nist.gov/vuln/detail/CVE-2021-29976)
* [CVE-2021-29977](https://nvd.nist.gov/vuln/detail/CVE-2021-29977)
* [CVE-2021-29980](https://nvd.nist.gov/vuln/detail/CVE-2021-29980)
* [CVE-2021-29981](https://nvd.nist.gov/vuln/detail/CVE-2021-29981)
* [CVE-2021-29982](https://nvd.nist.gov/vuln/detail/CVE-2021-29982)
* [CVE-2021-29984](https://nvd.nist.gov/vuln/detail/CVE-2021-29984)
* [CVE-2021-29985](https://nvd.nist.gov/vuln/detail/CVE-2021-29985)
* [CVE-2021-29986](https://nvd.nist.gov/vuln/detail/CVE-2021-29986)
* [CVE-2021-29987](https://nvd.nist.gov/vuln/detail/CVE-2021-29987)
* [CVE-2021-29988](https://nvd.nist.gov/vuln/detail/CVE-2021-29988)
* [CVE-2021-29989](https://nvd.nist.gov/vuln/detail/CVE-2021-29989)
* [CVE-2021-29990](https://nvd.nist.gov/vuln/detail/CVE-2021-29990)
* [CVE-2021-30547](https://nvd.nist.gov/vuln/detail/CVE-2021-30547)
* [CVE-2021-38491](https://nvd.nist.gov/vuln/detail/CVE-2021-38491)
* [CVE-2021-38493](https://nvd.nist.gov/vuln/detail/CVE-2021-38493)
* [CVE-2021-38495](https://nvd.nist.gov/vuln/detail/CVE-2021-38495)
* [CVE-2021-38503](https://nvd.nist.gov/vuln/detail/CVE-2021-38503)
* [CVE-2021-38504](https://nvd.nist.gov/vuln/detail/CVE-2021-38504)
* [CVE-2021-38506](https://nvd.nist.gov/vuln/detail/CVE-2021-38506)
* [CVE-2021-38507](https://nvd.nist.gov/vuln/detail/CVE-2021-38507)
* [CVE-2021-38508](https://nvd.nist.gov/vuln/detail/CVE-2021-38508)
* [CVE-2021-38509](https://nvd.nist.gov/vuln/detail/CVE-2021-38509)
* [CVE-2021-4129](https://nvd.nist.gov/vuln/detail/CVE-2021-4129)
* [CVE-2021-4140](https://nvd.nist.gov/vuln/detail/CVE-2021-4140)
* [CVE-2021-43536](https://nvd.nist.gov/vuln/detail/CVE-2021-43536)
* [CVE-2021-43537](https://nvd.nist.gov/vuln/detail/CVE-2021-43537)
* [CVE-2021-43538](https://nvd.nist.gov/vuln/detail/CVE-2021-43538)
* [CVE-2021-43539](https://nvd.nist.gov/vuln/detail/CVE-2021-43539)
* [CVE-2021-43540](https://nvd.nist.gov/vuln/detail/CVE-2021-43540)
* [CVE-2021-43541](https://nvd.nist.gov/vuln/detail/CVE-2021-43541)
* [CVE-2021-43542](https://nvd.nist.gov/vuln/detail/CVE-2021-43542)
* [CVE-2021-43543](https://nvd.nist.gov/vuln/detail/CVE-2021-43543)
* [CVE-2021-43545](https://nvd.nist.gov/vuln/detail/CVE-2021-43545)
* [CVE-2021-43546](https://nvd.nist.gov/vuln/detail/CVE-2021-43546)
* [CVE-2022-0511](https://nvd.nist.gov/vuln/detail/CVE-2022-0511)
* [CVE-2022-22737](https://nvd.nist.gov/vuln/detail/CVE-2022-22737)
* [CVE-2022-22738](https://nvd.nist.gov/vuln/detail/CVE-2022-22738)
* [CVE-2022-22739](https://nvd.nist.gov/vuln/detail/CVE-2022-22739)
* [CVE-2022-22740](https://nvd.nist.gov/vuln/detail/CVE-2022-22740)
* [CVE-2022-22741](https://nvd.nist.gov/vuln/detail/CVE-2022-22741)
* [CVE-2022-22742](https://nvd.nist.gov/vuln/detail/CVE-2022-22742)
* [CVE-2022-22743](https://nvd.nist.gov/vuln/detail/CVE-2022-22743)
* [CVE-2022-22745](https://nvd.nist.gov/vuln/detail/CVE-2022-22745)
* [CVE-2022-22747](https://nvd.nist.gov/vuln/detail/CVE-2022-22747)
* [CVE-2022-22748](https://nvd.nist.gov/vuln/detail/CVE-2022-22748)
* [CVE-2022-22751](https://nvd.nist.gov/vuln/detail/CVE-2022-22751)
* [CVE-2022-22753](https://nvd.nist.gov/vuln/detail/CVE-2022-22753)
* [CVE-2022-22754](https://nvd.nist.gov/vuln/detail/CVE-2022-22754)
* [CVE-2022-22755](https://nvd.nist.gov/vuln/detail/CVE-2022-22755)
* [CVE-2022-22756](https://nvd.nist.gov/vuln/detail/CVE-2022-22756)
* [CVE-2022-22757](https://nvd.nist.gov/vuln/detail/CVE-2022-22757)
* [CVE-2022-22758](https://nvd.nist.gov/vuln/detail/CVE-2022-22758)
* [CVE-2022-22759](https://nvd.nist.gov/vuln/detail/CVE-2022-22759)
* [CVE-2022-22760](https://nvd.nist.gov/vuln/detail/CVE-2022-22760)
* [CVE-2022-22761](https://nvd.nist.gov/vuln/detail/CVE-2022-22761)
* [CVE-2022-22762](https://nvd.nist.gov/vuln/detail/CVE-2022-22762)
* [CVE-2022-22763](https://nvd.nist.gov/vuln/detail/CVE-2022-22763)
* [CVE-2022-22764](https://nvd.nist.gov/vuln/detail/CVE-2022-22764)
* MOZ-2021-0004
* MOZ-2021-0005
* MOZ-2021-0006
* MOZ-2021-0007
* MOZ-2021-0008

**Release date**

February 21, 2022

**Latest revision**

February 21, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [802768](https://bugs.gentoo.org/show_bug.cgi?id=802768)
* [807947](https://bugs.gentoo.org/show_bug.cgi?id=807947)
* [813498](https://bugs.gentoo.org/show_bug.cgi?id=813498)
* [821385](https://bugs.gentoo.org/show_bug.cgi?id=821385)
* [828538](https://bugs.gentoo.org/show_bug.cgi?id=828538)
* [831039](https://bugs.gentoo.org/show_bug.cgi?id=831039)
* [832992](https://bugs.gentoo.org/show_bug.cgi?id=832992)

### Questions or comments?

Please feel free to contact us.

**Â© 2001â€“2020 Gentoo Foundation, Inc.**


