=== Content from github.com_0c754157_20250114_181430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fcommit%2Fe2697a575e9df6692b423e02d731f293c1313284)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fcommit%2Fe2697a575e9df6692b423e02d731f293c1313284)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=line%2Farmeria)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[line](/line)
/
**[armeria](/line/armeria)**
Public

* [Notifications](/login?return_to=%2Fline%2Farmeria) You must be signed in to change notification settings
* [Fork
  925](/login?return_to=%2Fline%2Farmeria)
* [Star
   4.9k](/login?return_to=%2Fline%2Farmeria)

* [Code](/line/armeria)
* [Issues
  598](/line/armeria/issues)
* [Pull requests
  80](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

Additional navigation options

* [Code](/line/armeria)
* [Issues](/line/armeria/issues)
* [Pull requests](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

## Commit

[Permalink](/line/armeria/commit/e2697a575e9df6692b423e02d731f293c1313284)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-8fp4-rp6c-5gcv](https://github.com/advisories/GHSA-8fp4-rp6c-5gcv "GHSA-8fp4-rp6c-5gcv")

[Browse files](/line/armeria/tree/e2697a575e9df6692b423e02d731f293c1313284)
Browse the repository at this point in the history

```
Motivation:

- We changed how `PathAndQuery` handles `%2F` (/) in 1.12.0 via [#3855](https://github.com/line/armeria/pull/3855).
  This change introduces an unexpected hole in its double-dot detection
  logic.
- Since we decided not to decode `%2F`, we should not decode it
  whereever possible.

Modifications:

- Hardened the double-dot detection logic in `PathAndQuery`.
- `Bytes.data` now always store the bytes in their decoded form. We keep
  whether the byte has to be encoded in a separate `BitSet`.
- Split `ArmeriaHttpUtil.decodePath()` into `decodePath()` and
  `decodePathParam()`.
  - We don't decode `%2F` in `decodePath()` but we do in
    `decodePathParam()`.
  - `RoutingResultBuilder.rawParam()` now uses `decodePathParam()`
    because `decodePath()` doesn't decode `%2F` anymore.

Result:

- A path that contains double dots with `%2F`, such as
  `/files/..%2Fsecrets.txt`, are now rejected correctly.
```

* Loading branch information

[![@trustin](https://avatars.githubusercontent.com/u/173918?s=40&v=4)](/trustin)

[trustin](/line/armeria/commits?author=trustin "View all commits by trustin")
authored
Dec 2, 2021

1 parent
[a110551](/line/armeria/commit/a1105519e920b00ee3bc848a5074d943925931ef)

commit e2697a5

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**501 additions**
and
**222 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* core/src

  + main/java/com/linecorp/armeria

    - internal/common

      * core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java
        [ArmeriaHttpUtil.java](#diff-d3c73d7bd166e39d1a62d9b65a3d739dc48abb1659fe70979e300e8de4b8d2e8)
      * core/src/main/java/com/linecorp/armeria/internal/common/PathAndQuery.java
        [PathAndQuery.java](#diff-adbfbcace3c362757e9455c82a2fe615bfd93dac1749ec3eff89287f6857b866)
    - server

      * core/src/main/java/com/linecorp/armeria/server/RoutingResultBuilder.java
        [RoutingResultBuilder.java](#diff-50c000054ccf14bd13a27a6d095ca6a9eeb0a8b1bfba2ea13b9167a6c49b6dec)
  + test/java/com/linecorp/armeria

    - internal/common

      * core/src/test/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtilTest.java
        [ArmeriaHttpUtilTest.java](#diff-ff53798fe12e21ead9ef96c18d9793057ee40088a707a84da6c73aa35998f553)
      * core/src/test/java/com/linecorp/armeria/internal/common/PathAndQueryTest.java
        [PathAndQueryTest.java](#diff-5a50f1ba78c3d521cef86c09b4714219dd59c7ce1747b952f665ce411440e35b)
    - server

      * core/src/test/java/com/linecorp/armeria/server/RoutingResultTest.java
        [RoutingResultTest.java](#diff-443ba03d053f7d6d1c3f0fc66230650fe5c329e307c6f4e90582c1cd0d6b9cb2)

## There are no files selected for viewing

37 changes: 35 additions & 2 deletions

37
[core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java](#diff-d3c73d7bd166e39d1a62d9b65a3d739dc48abb1659fe70979e300e8de4b8d2e8 "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java")

Show comments

[View file](/line/armeria/blob/e2697a575e9df6692b423e02d731f293c1313284/core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -304,11 +304,37 @@ public static String concatPaths(@Nullable String path1, @Nullable String path2) |
|  |  | \*/ |
|  |  | public static String decodePath(String path) { |
|  |  | if (path.indexOf('%') < 0) { |
|  |  | // No need to decoded; not percent-encoded |
|  |  | // No need to decode because it's not percent-encoded |
|  |  | return path; |
|  |  | } |
|  |  |  |
|  |  | // Decode percent-encoded characters, but don't decode %2F into /, so that a user can choose |
|  |  | // to use it as a non-separator. |
|  |  | // |
|  |  | // For example, for the path pattern `/orgs/{org\_name}/agents/{agent\_name}`: |
|  |  | // - orgs/mi6/agents/ethan-hunt |
|  |  | // - org\_name: mi6 |
|  |  | // - agent\_name: ethan-hunt |
|  |  | // - orgs/mi%2F6/agents/ethan-hunt |
|  |  | // - org\_name: mi/6 |
|  |  | // - agent\_name: ethan-hunt |
|  |  | return slowDecodePath(path, false); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Decodes a single percent-encoded path parameter. |
|  |  | \*/ |
|  |  | public static String decodePathParam(String pathParam) { |
|  |  | if (pathParam.indexOf('%') < 0) { |
|  |  | // No need to decode because it's not percent-encoded |
|  |  | return pathParam; |
|  |  | } |
|  |  |  |
|  |  | // Decode percent-encoded characters. |
|  |  | return slowDecodePath(pathParam, true); |
|  |  | } |
|  |  |  |
|  |  | private static String slowDecodePath(String path, boolean decodeSlash) { |
|  |  | // An invalid character is replaced with 0xFF, which will be replaced into '�' by UTF-8 decoder. |
|  |  | final int len = path.length(); |
|  |  | try (TemporaryThreadLocals tempThreadLocals = TemporaryThreadLocals.acquire()) { |
| Expand All | | @@ -335,7 +361,14 @@ public static String decodePath(String path) { |
|  |  | // The first or second digit is not hexadecimal. |
|  |  | buf[dstLen++] = (byte) 0xFF; |
|  |  | } else { |
|  |  | buf[dstLen++] = (byte) ((digit1 << 4) | digit2); |
|  |  | final byte decoded = (byte) ((digit1 << 4) | digit2); |
|  |  | if (decodeSlash || decoded != 0x2F) { |
|  |  | buf[dstLen++] = decoded; |
|  |  | } else { |
|  |  | buf[dstLen++] = '%'; |
|  |  | buf[dstLen++] = '2'; |
|  |  | buf[dstLen++] = (byte) path.charAt(i); // f or F - preserve the case. |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e2697a5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fcommit%2Fe2697a575e9df6692b423e02d731f293c1313284) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_939f5a54_20250114_181433.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fsecurity%2Fadvisories%2FGHSA-8fp4-rp6c-5gcv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fsecurity%2Fadvisories%2FGHSA-8fp4-rp6c-5gcv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=line%2Farmeria)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[line](/line)
/
**[armeria](/line/armeria)**
Public

* [Notifications](/login?return_to=%2Fline%2Farmeria) You must be signed in to change notification settings
* [Fork
  925](/login?return_to=%2Fline%2Farmeria)
* [Star
   4.9k](/login?return_to=%2Fline%2Farmeria)

* [Code](/line/armeria)
* [Issues
  598](/line/armeria/issues)
* [Pull requests
  80](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

Additional navigation options

* [Code](/line/armeria)
* [Issues](/line/armeria/issues)
* [Pull requests](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

# Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') in com.linecorp.armeria:armeria

High

[trustin](/trustin)
published
GHSA-8fp4-rp6c-5gcv
Dec 2, 2021

## Package

maven

com.linecorp.armeria:armeria
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

>= 1.12.0

## Patched versions

1.13.4

## Description

### Impact

An attacker can access an Armeria server's local file system beyond its restricted directory by sending an HTTP request whose path contains `%2F` (encoded `/`), such as `/files/..%2Fsecrets.txt`, bypassing Armeria's path validation logic.

### Patches

Armeria 1.13.4 or above contains the hardened path validation logic that handles `%2F` properly.

### Workarounds

This vulnerability can be worked around by inserting a decorator that performs an additional validation on the request path, e.g.

```
Server
  .builder()
  .serviceUnder(
    "/files",
    FileService
      .of(...)
      .decorate((delegate, ctx, req) -> {
        String path = req.headers().path();
        if (path.contains("%2f") || path.contains("%2F")) {
          return HttpResponse.of(HttpStatus.BAD_REQUEST);
        }
        return delegate.serve(ctx, req);
      })
  )
  .build()
```
### For more information

If you have any questions or comments about this advisory:

* Open an issue in [line/armeria](https://github.com/line/armeria)
* Chat with us at [Slack](https://armeria.dev/s/slack)

### Credits

This vulnerability was originally reported by Abdallah Zaher ([elcayser-0x0a](https://hackerone.com/elcayser-0x0a?type=user)).

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2021-43795

### Weaknesses

[CWE-22](/advisories?query=cwe%3A22)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2a76d43d_20250114_181432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fpull%2F3855)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fpull%2F3855)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=line%2Farmeria)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[line](/line)
/
**[armeria](/line/armeria)**
Public

* [Notifications](/login?return_to=%2Fline%2Farmeria) You must be signed in to change notification settings
* [Fork
  925](/login?return_to=%2Fline%2Farmeria)
* [Star
   4.9k](/login?return_to=%2Fline%2Farmeria)

* [Code](/line/armeria)
* [Issues
  598](/line/armeria/issues)
* [Pull requests
  80](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

Additional navigation options

* [Code](/line/armeria)
* [Issues](/line/armeria/issues)
* [Pull requests](/line/armeria/pulls)
* [Discussions](/line/armeria/discussions)
* [Actions](/line/armeria/actions)
* [Security](/line/armeria/security)
* [Insights](/line/armeria/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fline%2Farmeria%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fline%2Farmeria%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Exclude `%2F(/)` from decoding of percents in a request path. #3855

 Merged

[trustin](/trustin)
merged 3 commits into
[line:master](/line/armeria/tree/master "line/armeria:master")
from
[ikhoon:exclude-%2f-decoding](/ikhoon/armeria/tree/exclude-%252f-decoding "ikhoon/armeria:exclude-%2f-decoding")

Oct 5, 2021

 Merged

# [Exclude `%2F(/)` from decoding of percents in a request path.](#top) #3855

[trustin](/trustin)
merged 3 commits into
[line:master](/line/armeria/tree/master "line/armeria:master")
from
[ikhoon:exclude-%2f-decoding](/ikhoon/armeria/tree/exclude-%252f-decoding "ikhoon/armeria:exclude-%2f-decoding")

Oct 5, 2021

[Conversation
5](/line/armeria/pull/3855)
[Commits
3](/line/armeria/pull/3855/commits)
[Checks
0](/line/armeria/pull/3855/checks)
[Files changed](/line/armeria/pull/3855/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ikhoon](https://avatars.githubusercontent.com/u/1866157?s=60&v=4)](/ikhoon)

Copy link

Contributor

### @ikhoon **[ikhoon](/ikhoon)** commented [Oct 5, 2021](#issue-1015806217)

Motivation:

Currently, `%2F` and `%2f` are converted into `/` while decoding

request paths. It might route a path to an unexpected service if users

really want to send `%2F` as data itself.

Furthermore, other specifications such as gRPC transcoding do not

expect to decode `%2F` to `/`.

<https://github.com/googleapis/googleapis/blob/02710fa0ea5312d79d7fb986c9c9823fb41049a9/google/api/http.proto#L257-L258>

It should be better to exclude `%2F` for less confusion and better

interop with other echo systems.

Modifications:

* Exclude `%2F` and `%2f` from decoding percent-encoded characters in paths.

Result:

`%2F` and `%2f` are no longer converted to `/` when decoding a request path.

Sorry, something went wrong.

All reactions

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&v=4)](/ikhoon)

`[Exclude %2F(/) from decoding of percents in a request path.](/line/armeria/pull/3855/commits/a380cf982f665459b79909555b5d4b024d7daf1a "Exclude `%2F(/)` from decoding of percents in a request path.

Motivation:

Currently, `%2F` and `%2f` are converted into `/` while decoding
request paths. It might route a path to an unexpected service if users
really want to send `%2F` as data itself.
Furthermore, other specifications such as gRPC transcoding do not
expect to decode `%2F` as `/`.
https://github.com/googleapis/googleapis/blob/02710fa0ea5312d79d7fb986c9c9823fb41049a9/google/api/http.proto#L257-L258
It should be better to exclude `%2F` for less confusion and better
interop with other echo systems.

Modifications:

- Exclude `%2F` and `%2f` from decoding percent-encoded characters in paths.

Result:

`%2F` and `%2f` are no longer converted to `/` when decoding a request path.")`
 …

`[a380cf9](/line/armeria/pull/3855/commits/a380cf982f665459b79909555b5d4b024d7daf1a)`

```
Motivation:

Currently, `%2F` and `%2f` are converted into `/` while decoding
request paths. It might route a path to an unexpected service if users
really want to send `%2F` as data itself.
Furthermore, other specifications such as gRPC transcoding do not
expect to decode `%2F` as `/`.
<https://github.com/googleapis/googleapis/blob/02710fa0ea5312d79d7fb986c9c9823fb41049a9/google/api/http.proto#L257-L258>
It should be better to exclude `%2F` for less confusion and better
interop with other echo systems.

Modifications:

- Exclude `%2F` and `%2f` from decoding percent-encoded characters in paths.

Result:

`%2F` and `%2f` are no longer converted to `/` when decoding a request path.
```

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&u=6f856980034741483b90900b7f5144e1185492dd&v=4)](/ikhoon)
[ikhoon](/ikhoon)
added
the
[defect](/line/armeria/labels/defect)
label
[Oct 5, 2021](#event-5407648532)

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&u=6f856980034741483b90900b7f5144e1185492dd&v=4)](/ikhoon)
[ikhoon](/ikhoon)
added this to the [1.12.0](/line/armeria/milestone/187) milestone
[Oct 5, 2021](#event-5407648539)

 [![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&u=6f856980034741483b90900b7f5144e1185492dd&v=4)](/ikhoon)
[ikhoon](/ikhoon)
requested review from
[minwoox](/minwoox) and
[trustin](/trustin)
as [code owners](/line/armeria/blob/0d51decbc71caf425e0557e460ff2318012e6bdc/.github/CODEOWNERS#L3)
[October 5, 2021 02:08](#event-5407648556)

[![trustin](https://avatars.githubusercontent.com/u/173918?s=60&v=4)](/trustin)

**[trustin](/trustin)**
reviewed
[Oct 5, 2021](#pullrequestreview-771039562)

 [View reviewed changes](/line/armeria/pull/3855/files/a380cf982f665459b79909555b5d4b024d7daf1a)

[core/src/main/java/com/linecorp/armeria/internal/common/PathAndQuery.java](/line/armeria/pull/3855/files/a380cf982f665459b79909555b5d4b024d7daf1a#diff-adbfbcace3c362757e9455c82a2fe615bfd93dac1749ec3eff89287f6857b866)
Outdated

|  |  | wasSlash = decoded == '/'; |
| --- | --- | --- |
|  |  | if (decoded == '/') { |
|  |  | // Do not decode '%2F' and '%2f' in the path to '/' for compatibility with |
|  |  | // other echo systems, e.g. HTTP/JSON to gRPC transcoding. |

Copy link

Member

### @trustin **[trustin](/trustin)** [Oct 5, 2021](#discussion_r721937322)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | // other echo systems, e.g. HTTP/JSON to gRPC transcoding. |
| --- | --- |
|  | // other implementations in the ecosystem, e.g. HTTP/JSON to gRPC transcoding. |

Sorry, something went wrong.

All reactions

[core/src/main/java/com/linecorp/armeria/internal/common/PathAndQuery.java](/line/armeria/pull/3855/files/a380cf982f665459b79909555b5d4b024d7daf1a#diff-adbfbcace3c362757e9455c82a2fe615bfd93dac1749ec3eff89287f6857b866)

|  |  | // Do not decode '%2F' and '%2f' in the path to '/' for compatibility with |
| --- | --- | --- |
|  |  | // other echo systems, e.g. HTTP/JSON to gRPC transcoding. |
|  |  | // https://github.com/googleapis/googleapis/blob/02710fa0ea5312d79d7fb986c9c9823fb41049a9/google/api/http.proto#L257-L258 |
|  |  | final byte marker = RAW\_CHAR\_TO\_MARKER['/']; |

Copy link

Member

### @trustin **[trustin](/trustin)** [Oct 5, 2021](#discussion_r721942661)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How about adding the comment like we did for the other branch below:

```
// Insert a special mark so we can distinguish a raw character ('/') and
// percent-encoded character ('%2F') in a path string.
// We will encode this mark back into a percent-encoded character later.

```

Sorry, something went wrong.

All reactions

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&v=4)](/ikhoon)

`[Address comments by](/line/armeria/pull/3855/commits/1fd8b8c6b7710027b4c3523483f4296c29c12a41 "Address comments by @trustin") [@trustin](https://github.com/trustin)`

`[1fd8b8c](/line/armeria/pull/3855/commits/1fd8b8c6b7710027b4c3523483f4296c29c12a41)`

[![@trustin](https://avatars.githubusercontent.com/u/173918?s=80&u=d9bb1bad1efcfdabaff1a411d81ae4692c6a8700&v=4)](/trustin)

Copy link

Member

### **[trustin](/trustin)** commented [Oct 5, 2021](#issuecomment-934494273)

| [@ikhoon](https://github.com/ikhoon) Could you check the test failures? |
| --- |

 👍
1
 minwoox reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![minwoox](https://avatars.githubusercontent.com/u/25103250?s=60&v=4)](/minwoox)

**[minwoox](/minwoox)**
approved these changes
[Oct 5, 2021](#pullrequestreview-771623017)

 [View reviewed changes](/line/armeria/pull/3855/files/1fd8b8c6b7710027b4c3523483f4296c29c12a41)

Copy link

Contributor

### @minwoox **[minwoox](/minwoox)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

👍 👍 👍

Sorry, something went wrong.

All reactions

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&v=4)](/ikhoon)

`[Fix broken tests](/line/armeria/pull/3855/commits/b37ea068718ba85649684ca8bc199614af2b3a36 "Fix broken tests")`

`[b37ea06](/line/armeria/pull/3855/commits/b37ea068718ba85649684ca8bc199614af2b3a36)`

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Oct 5, 2021](#issuecomment-934680719)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) Report Merging [#3855](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) ([b37ea06](https://github.com/line/armeria/commit/b37ea068718ba85649684ca8bc199614af2b3a36)) into [master](https://codecov.io/gh/line/armeria/commit/8c45211dfcb631402fb58e4162fdb423af5a0f04?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) ([8c45211](https://github.com/line/armeria/commit/8c45211dfcb631402fb58e4162fdb423af5a0f04)) will **increase** coverage by `0.10%`. The diff coverage is `100.00%`.  [Impacted file tree graph](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line)  ``` @@             Coverage Diff              @@ ##             master    #3855      +/-   ## ============================================ + Coverage     73.20%   73.31%   +0.10%      - Complexity    15041    15285     +244      ============================================   Files          1323     1332       +9        Lines         57902    58511     +609        Branches       7342     7410      +68      ============================================ + Hits          42387    42895     +508      - Misses        11775    11846      +71      - Partials       3740     3770      +30      ```  | [Impacted Files](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) | Coverage Δ |  | | --- | --- | --- | | [...linecorp/armeria/internal/common/PathAndQuery.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2ludGVybmFsL2NvbW1vbi9QYXRoQW5kUXVlcnkuamF2YQ==) | `86.71% <100.00%> (+0.35%)` | ⬆️ | | [.../common/AbstractHttp2ConnectionHandlerBuilder.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2ludGVybmFsL2NvbW1vbi9BYnN0cmFjdEh0dHAyQ29ubmVjdGlvbkhhbmRsZXJCdWlsZGVyLmphdmE=) | `34.78% <0.00%> (-4.35%)` | ⬇️ | | [...nternal/common/AbstractHttp2ConnectionHandler.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2ludGVybmFsL2NvbW1vbi9BYnN0cmFjdEh0dHAyQ29ubmVjdGlvbkhhbmRsZXIuamF2YQ==) | `82.00% <0.00%> (-4.00%)` | ⬇️ | | [...ecorp/armeria/internal/common/HttpHeadersUtil.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2ludGVybmFsL2NvbW1vbi9IdHRwSGVhZGVyc1V0aWwuamF2YQ==) | `83.87% <0.00%> (-2.80%)` | ⬇️ | | [.../com/linecorp/armeria/server/file/FileService.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL3NlcnZlci9maWxlL0ZpbGVTZXJ2aWNlLmphdmE=) | `82.43% <0.00%> (-2.60%)` | ⬇️ | | [...ia/common/stream/ConcatPublisherStreamMessage.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2NvbW1vbi9zdHJlYW0vQ29uY2F0UHVibGlzaGVyU3RyZWFtTWVzc2FnZS5qYXZh) | `78.29% <0.00%> (-2.33%)` | ⬇️ | | [...ia/internal/common/stream/ByteBufDecoderInput.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2ludGVybmFsL2NvbW1vbi9zdHJlYW0vQnl0ZUJ1ZkRlY29kZXJJbnB1dC5qYXZh) | `84.89% <0.00%> (-2.16%)` | ⬇️ | | [...p/armeria/common/stream/AbstractStreamMessage.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL2NvbW1vbi9zdHJlYW0vQWJzdHJhY3RTdHJlYW1NZXNzYWdlLmphdmE=) | `79.20% <0.00%> (-1.99%)` | ⬇️ | | [.../com/linecorp/armeria/server/RoutingPredicate.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Y29yZS9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL3NlcnZlci9Sb3V0aW5nUHJlZGljYXRlLmphdmE=) | `70.96% <0.00%> (-1.62%)` | ⬇️ | | [...ecorp/armeria/server/grpc/UnframedGrpcService.java](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line#diff-Z3JwYy9zcmMvbWFpbi9qYXZhL2NvbS9saW5lY29ycC9hcm1lcmlhL3NlcnZlci9ncnBjL1VuZnJhbWVkR3JwY1NlcnZpY2UuamF2YQ==) | `76.63% <0.00%> (-1.25%)` | ⬇️ | | ... and [76 more](https://codecov.io/gh/line/armeria/pull/3855/diff?src=pr&el=tree-more&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) |  |  |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line). Last update [8c45211...b37ea06](https://codecov.io/gh/line/armeria/pull/3855?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=line). |

All reactions

Sorry, something went wrong.

[![trustin](https://avatars.githubusercontent.com/u/173918?s=60&v=4)](/trustin)

**[trustin](/trustin)**
approved these changes
[Oct 5, 2021](#pullrequestreview-772017093)

 [View reviewed changes](/line/armeria/pull/3855/files/b37ea068718ba85649684ca8bc199614af2b3a36)

[![@trustin](https://avatars.githubusercontent.com/u/173918?s=40&u=d9bb1bad1efcfdabaff1a411d81ae4692c6a8700&v=4)](/trustin)
[trustin](/trustin)
merged commit [`4a4a575`](/line/armeria/commit/4a4a57576f517a53d69204d36181268896d40b09)
into
line:master

[Oct 5, 2021](https://github.com/line/armeria/pull/3855#event-5413891213)

 [![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=40&u=6f856980034741483b90900b7f5144e1185492dd&v=4)](/ikhoon)
[ikhoon](/ikhoon)
deleted the
exclude-%2f-decoding

branch
[November 3, 2021 02:26](#event-5559171434)

[trustin](/trustin)
added a commit
that referenced
this pull request
[Dec 2, 2021](#ref-commit-e2697a5)
[![@trustin](https://avatars.githubusercontent.com/u/173918?s=40&u=d9bb1bad1efcfdabaff1a411d81ae4692c6a8700&v=4)](/trustin)

`[Merge pull request from](/line/armeria/commit/e2697a575e9df6692b423e02d731f293c1313284 "Merge pull request from GHSA-8fp4-rp6c-5gcv

Motivation:

- We changed how `PathAndQuery` handles `%2F` (/) in 1.12.0 via #3855.
  This change introduces an unexpected hole in its double-dot detection
  logic.
- Since we decided not to decode `%2F`, we should not decode it
  whereever possible.

Modifications:

- Hardened the double-dot detection logic in `PathAndQuery`.
- `Bytes.data` now always store the bytes in their decoded form. We keep
  whether the byte has to be encoded in a separate `BitSet`.
- Split `ArmeriaHttpUtil.decodePath()` into `decodePath()` and
  `decodePathParam()`.
  - We don't decode `%2F` in `decodePath()` but we do in
    `decodePathParam()`.
  - `RoutingResultBuilder.rawParam()` now uses `decodePathParam()`
    because `decodePath()` doesn't decode `%2F` anymore.

Result:

- A path that contains double dots with `%2F`, such as
  `/files/..%2Fsecrets.txt`, are now rejected correctly.") [GHSA-8fp4-rp6c-5gcv](https://github.com/advisories/GHSA-8fp4-rp6c-5gcv "GHSA-8fp4-rp6c-5gcv")`
…

`[e2697a5](/line/armeria/commit/e2697a575e9df6692b423e02d731f293c1313284)`

```
Motivation:

- We changed how `PathAndQuery` handles `%2F` (/) in 1.12.0 via [#3855](https://github.com/line/armeria/pull/3855).
  This change introduces an unexpected hole in its double-dot detection
  logic.
- Since we decided not to decode `%2F`, we should not decode it
  whereever possible.

Modifications:

- Hardened the double-dot detection logic in `PathAndQuery`.
- `Bytes.data` now always store the bytes in their decoded form. We keep
  whether the byte has to be encoded in a separate `BitSet`.
- Split `ArmeriaHttpUtil.decodePath()` into `decodePath()` and
  `decodePathParam()`.
  - We don't decode `%2F` in `decodePath()` but we do in
    `decodePathParam()`.
  - `RoutingResultBuilder.rawParam()` now uses `decodePathParam()`
    because `decodePath()` doesn't decode `%2F` anymore.

Result:

- A path that contains double dots with `%2F`, such as
  `/files/..%2Fsecrets.txt`, are now rejected correctly.
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fline%2Farmeria%2Fpull%2F3855)

Reviewers

[![@minwoox](https://avatars.githubusercontent.com/u/25103250?s=40&v=4)](/minwoox) [minwoox](/minwoox)

minwoox approved these changes

[![@trustin](https://avatars.githubusercontent.com/u/173918?s=40&v=4)](/trustin) [trustin](/trustin)

trustin approved these changes

Assignees

No one assigned

Labels

[defect](/line/armeria/labels/defect)

Projects

None yet

Milestone

 [**1.12.0**](/line/armeria/milestone/187 "1.12.0")

Development

Successfully merging this pull request may close these issues.

3 participants

[![@ikhoon](https://avatars.githubusercontent.com/u/1866157?s=52&v=4)](/ikhoon) [![@trustin](https://avatars.githubusercontent.com/u/173918?s=52&v=4)](/trustin) [![@minwoox](https://avatars.githubusercontent.com/u/25103250?s=52&v=4)](/minwoox)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


