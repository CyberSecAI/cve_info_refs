This document discusses multiple vulnerabilities, including CVE-2021-42973, found in the Eltima SDK, which provides USB over Ethernet capabilities. These vulnerabilities are present in various cloud services that use the SDK, including Amazon Workspaces.

**Root cause of vulnerability:**
The root cause is improper handling of user-supplied input in the IOCTL handlers 0x22005B and 0x22001B of the `wspvuhub.sys` and `wspusbfilter.sys` drivers. These handlers use `METHOD_NEITHER` for data transfer, meaning the driver is responsible for validating, probing, locking, and mapping user-provided buffers. The driver fails to validate buffer sizes, leading to integer overflows and out-of-bounds memory access during memory operations.

**Weaknesses/vulnerabilities present:**
- **Integer overflow:** Insecure arithmetic operations on user-controlled data without overflow checks when calculating the copy size during memory operations. This can lead to an attacker controlling the size parameter of `memmove` allowing out-of-bounds writes.
- **Lack of input validation:** The IOCTL handlers fail to properly validate user-controlled sizes, resulting in the possibility of allocating a smaller buffer than is being written to.
- **`METHOD_NEITHER` misuse:**  The driver uses `METHOD_NEITHER` without the required buffer validation, probing, and locking before accessing user-mode addresses.
- **Double fetches**: The driver fails to ensure data is fetched only once from user mode addresses.

**Impact of exploitation:**
- **Privilege escalation:** Exploitation can lead to arbitrary code execution in kernel mode, allowing attackers to gain SYSTEM level privileges, bypass security products, overwrite system components, corrupt the operating system, and perform malicious operations.
- **Remote Exploitation:** As the vulnerability exists both in the server and client side, remote desktops are also vulnerable.
- **Sandbox Escape:** Due to the lack of ACL enforcements on the device object, the vulnerability can be triggered from sandboxes.

**Attack vectors:**
- Sending specially crafted IRP packets to the vulnerable drivers, specifically using IOCTL codes 0x22005B and 0x22001B.
- Triggering the vulnerable code by sending IRP with different parameters for the allocation and copy functions.

**Required attacker capabilities/position:**
- The attacker needs the ability to send IOCTL requests to the vulnerable driver. This can be done from a low privileged user.
- No specific user level privileges are required for exploitation.