=== Content from wiki.debian.org_8d48714b_20250115_210831.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Espa√±ol](/es/LTS) - [Fran√ßais](/fr/LTS) - [Italiano](/it/LTS) - [ÌïúÍµ≠Ïñ¥](/ko/LTS) - [Portugu√™s](/pt/LTS) - [Portugu√™s (Brasil)](/pt_BR/LTS) - [–†—É—Å—Å–∫–∏–π](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).



=== Content from lists.debian.org_adcdad6b_20250115_080058.html ===


---

[[Date Prev](msg00001.html)][[Date Next](msg00003.html)]
[[Thread Prev](msg00001.html)][[Thread Next](msg00003.html)]
[[Date Index](maillist.html#00002)]
[[Thread Index](threads.html#00002)]

# [SECURITY] [DLA 3176-1] clickhouse security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3176-1] clickhouse security update
* *From*: Tobias Frost <tobi@debian.org>
* *Date*: Fri, 4 Nov 2022 07:11:35 +0100
* *Message-id*: <[[üîé]](/msgid-search/Y2StF5yFLEfoMdZX%40isildor.loewenhoehle.ip)¬†[Y2StF5yFLEfoMdZX@isildor.loewenhoehle.ip](msg00002.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3176-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                         Tobias Frost
November 03, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : clickhouse
Version        : 18.16.1+ds-4+deb10u1
CVE ID         : CVE-2021-42387 CVE-2021-42388 CVE-2021-43304 CVE-2021-43305
Debian Bug     : 1008216

Several security vulnerabilities were discovered in clickhouse, a
column-oriented database system.

The vulnerabilities require authentication, but can be triggered by any user
with read permissions. This means the attacker must perform reconnaissance on
the specific ClickHouse server target to obtain valid credentials. Any set of
credentials would do, since even a user with the lowest privileges can trigger
all of the vulnerabilities. By triggering the vulnerabilities, an attacker can
crash the ClickHouse server, leak memory contents or even cause remote code
execution.

CVE-2021-42387:
  Heap out-of-bounds read in Clickhouse's LZ4 compression codec when
  parsing a malicious query. As part of the LZ4::decompressImpl() loop,
  a 16-bit unsigned user-supplied value ('offset') is read from the
  compressed data. The offset is later used in the length of a copy
  operation, without checking the upper bounds of the source of the copy
  operation.

CVE-2021-42388:
  Heap out-of-bounds read in Clickhouse's LZ4 compression codec when
  parsing a malicious query. As part of the LZ4::decompressImpl() loop,
  a 16-bit unsigned user-supplied value ('offset') is read from the
  compressed data. The offset is later used in the length of a copy
  operation, without checking the lower bounds of the source of the copy
  operation.

CVE-2021-43304:
  Heap buffer overflow in Clickhouse's LZ4 compression codec when
  parsing a malicious query. There is no verification that the copy
  operations in the LZ4::decompressImpl loop and especially the
  arbitrary copy operation wildCopy&lt;copy_amount&gt;(op, ip,
  copy_end), don&amp;#8217;t exceed the destination buffer&amp;#8217;s
  limits.

CVE-2021-43305:
  Heap buffer overflow in Clickhouse's LZ4 compression codec when
  parsing a malicious query. There is no verification that the copy
  operations in the LZ4::decompressImpl loop and especially the
  arbitrary copy operation wildCopy&lt;copy_amount&gt;(op, ip,
  copy_end), don&amp;#8217;t exceed the destination buffer&amp;#8217;s
  limits. This issue is very similar to CVE-2021-43304, but the
  vulnerable copy operation is in a different wildCopy call.

For Debian 10 buster, these problems have been fixed in version
18.16.1+ds-4+deb10u1.

We recommend that you upgrade your clickhouse packages.

For the detailed security status of clickhouse please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/clickhouse>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpuJEJ9zi1NA.pgp)**

*Description:* PGP signature

---



=== Content from github.com_6ea12d6a_20250115_210833.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Ftree%2F6951e8147d7a25f7bb4f7d43738793cff239db6d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Ftree%2F6951e8147d7a25f7bb4f7d43738793cff239db6d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.5k](/login?return_to=%2FClickHouse%2FClickHouse)

ClickHouse¬Æ is a real-time analytics database management system

[clickhouse.com](https://clickhouse.com "https://clickhouse.com")

### License

[Apache-2.0 license](/ClickHouse/ClickHouse/blob/master/LICENSE)

[38.5k
stars](/ClickHouse/ClickHouse/stargazers) [7k
forks](/ClickHouse/ClickHouse/forks) [Branches](/ClickHouse/ClickHouse/branches) [Tags](/ClickHouse/ClickHouse/tags) [Activity](/ClickHouse/ClickHouse/activity)
 [Star](/login?return_to=%2FClickHouse%2FClickHouse)

 [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.8k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  412](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

# ClickHouse/ClickHouse

   ¬†6951e81[Branches](/ClickHouse/ClickHouse/branches)[Tags](/ClickHouse/ClickHouse/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit¬†History[69,200 Commits](/ClickHouse/ClickHouse/commits/6951e8147d7a25f7bb4f7d43738793cff239db6d/) | | |
| [.github](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/.github ".github") | | [.github](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/.github ".github") |  |  |
| [base](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/base "base") | | [base](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/base "base") |  |  |
| [benchmark](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/benchmark "benchmark") | | [benchmark](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/benchmark "benchmark") |  |  |
| [cmake](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/cmake "cmake") | | [cmake](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/cmake "cmake") |  |  |
| [contrib](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/contrib "contrib") | | [contrib](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/contrib "contrib") |  |  |
| [debian](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/debian "debian") | | [debian](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/debian "debian") |  |  |
| [docker](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/docker "docker") | | [docker](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/docker "docker") |  |  |
| [docs](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/docs "docs") | | [docs](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/docs "docs") |  |  |
| [programs](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/programs "programs") | | [programs](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/programs "programs") |  |  |
| [src](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src "src") | | [src](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src "src") |  |  |
| [tests](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/tests "tests") | | [tests](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/tests "tests") |  |  |
| [utils](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/utils "utils") | | [utils](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/utils "utils") |  |  |
| [website](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/website "website") | | [website](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/website "website") |  |  |
| [.arcignore](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.arcignore ".arcignore") | | [.arcignore](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.arcignore ".arcignore") |  |  |
| [.clang-format](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.clang-format ".clang-format") | | [.clang-format](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.clang-format ".clang-format") |  |  |
| [.clang-tidy](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.clang-tidy ".clang-tidy") | | [.clang-tidy](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.clang-tidy ".clang-tidy") |  |  |
| [.editorconfig](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.editorconfig ".editorconfig") | | [.editorconfig](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.editorconfig ".editorconfig") |  |  |
| [.gitattributes](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitattributes ".gitattributes") | | [.gitattributes](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitattributes ".gitattributes") |  |  |
| [.gitignore](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitignore ".gitignore") | | [.gitignore](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitignore ".gitignore") |  |  |
| [.gitmodules](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitmodules ".gitmodules") | | [.gitmodules](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.gitmodules ".gitmodules") |  |  |
| [.potato.yml](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.potato.yml ".potato.yml") | | [.potato.yml](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.potato.yml ".potato.yml") |  |  |
| [.pylintrc](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.pylintrc ".pylintrc") | | [.pylintrc](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.pylintrc ".pylintrc") |  |  |
| [.vimrc](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.vimrc ".vimrc") | | [.vimrc](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.vimrc ".vimrc") |  |  |
| [.yamllint](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.yamllint ".yamllint") | | [.yamllint](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/.yamllint ".yamllint") |  |  |
| [AUTHORS](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/AUTHORS "AUTHORS") | | [AUTHORS](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/AUTHORS "AUTHORS") |  |  |
| [CHANGELOG.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CHANGELOG.md "CHANGELOG.md") |  |  |
| [CMakeLists.txt](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CMakeLists.txt "CMakeLists.txt") | | [CMakeLists.txt](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CMakeLists.txt "CMakeLists.txt") |  |  |
| [CODE\_OF\_CONDUCT.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") | | [CODE\_OF\_CONDUCT.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") |  |  |
| [CONTRIBUTING.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CONTRIBUTING.md "CONTRIBUTING.md") | | [CONTRIBUTING.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/CONTRIBUTING.md "CONTRIBUTING.md") |  |  |
| [LICENSE](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/LICENSE "LICENSE") | | [LICENSE](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/LICENSE "LICENSE") |  |  |
| [PreLoad.cmake](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/PreLoad.cmake "PreLoad.cmake") | | [PreLoad.cmake](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/PreLoad.cmake "PreLoad.cmake") |  |  |
| [README.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/README.md "README.md") | | [README.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/README.md "README.md") |  |  |
| [SECURITY.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/SECURITY.md "SECURITY.md") | | [SECURITY.md](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/SECURITY.md "SECURITY.md") |  |  |
| [docker-compose.yml](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/docker-compose.yml "docker-compose.yml") | | [docker-compose.yml](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/docker-compose.yml "docker-compose.yml") |  |  |
| [format\_sources](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/format_sources "format_sources") | | [format\_sources](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/format_sources "format_sources") |  |  |
| [release](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/release "release") | | [release](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/release "release") |  |  |
| [uncrustify.cfg](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/uncrustify.cfg "uncrustify.cfg") | | [uncrustify.cfg](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/uncrustify.cfg "uncrustify.cfg") |  |  |
| [ya.make](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/ya.make "ya.make") | | [ya.make](/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/ya.make "ya.make") |  |  |
| View all files | | |

## Repository files navigation

* README
* Code of conduct
* License
* Security

[![ClickHouse ‚Äî open source distributed column-oriented DBMS](https://github.com/ClickHouse/ClickHouse/raw/master/website/images/logo-400x240.png)](https://clickhouse.tech)

ClickHouse¬Æ is an open-source column-oriented database management system that allows generating analytical data reports in real time.

## Useful Links

* [Official website](https://clickhouse.tech/) has quick high-level overview of ClickHouse on main page.
* [Tutorial](https://clickhouse.tech/docs/en/getting_started/tutorial/) shows how to set up and query small ClickHouse cluster.
* [Documentation](https://clickhouse.tech/docs/en/) provides more in-depth information.
* [YouTube channel](https://www.youtube.com/c/ClickHouseDB) has a lot of content about ClickHouse in video format.
* [Slack](https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg) and [Telegram](https://telegram.me/clickhouse_en) allow to chat with ClickHouse users in real-time.
* [Blog](https://clickhouse.yandex/blog/en/) contains various ClickHouse-related articles, as well as announcements and reports about events.
* [Code Browser](https://clickhouse.tech/codebrowser/html_report/ClickHouse/index.html) with syntax highlight and navigation.
* [Contacts](https://clickhouse.tech/#contacts) can help to get your questions answered if there are any.
* You can also [fill this form](https://clickhouse.tech/#meet) to meet Yandex ClickHouse team in person.

## About

ClickHouse¬Æ is a real-time analytics database management system

[clickhouse.com](https://clickhouse.com "https://clickhouse.com")

### Topics

[rust](/topics/rust "Topic: rust")
[embedded](/topics/embedded "Topic: embedded")
[sql](/topics/sql "Topic: sql")
[database](/topics/database "Topic: database")
[big-data](/topics/big-data "Topic: big-data")
[ai](/topics/ai "Topic: ai")
[analytics](/topics/analytics "Topic: analytics")
[cpp](/topics/cpp "Topic: cpp")
[clickhouse](/topics/clickhouse "Topic: clickhouse")
[dbms](/topics/dbms "Topic: dbms")
[self-hosted](/topics/self-hosted "Topic: self-hosted")
[distributed](/topics/distributed "Topic: distributed")
[olap](/topics/olap "Topic: olap")
[cloud-native](/topics/cloud-native "Topic: cloud-native")
[mpp](/topics/mpp "Topic: mpp")
[hacktoberfest](/topics/hacktoberfest "Topic: hacktoberfest")
[lakehouse](/topics/lakehouse "Topic: lakehouse")

### Resources

[Readme](#readme-ov-file)
### License

[Apache-2.0 license](/ClickHouse/ClickHouse/blob/master/LICENSE)
### Code of conduct

[Code of conduct](#coc-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/ClickHouse/ClickHouse/activity)
[Custom properties](/ClickHouse/ClickHouse/custom-properties)
### Stars

[**38.5k**
stars](/ClickHouse/ClickHouse/stargazers)
### Watchers

[**691**
watching](/ClickHouse/ClickHouse/watchers)
### Forks

[**7k**
forks](/ClickHouse/ClickHouse/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse&report=ClickHouse+%28user%29)

## [Releases 612](/ClickHouse/ClickHouse/releases)

[Release v24.8.12.28-lts
Latest

Jan 14, 2025](/ClickHouse/ClickHouse/releases/tag/v24.8.12.28-lts)
[+ 611 releases](/ClickHouse/ClickHouse/releases)

## [Contributors 1,615](/ClickHouse/ClickHouse/graphs/contributors)

* [![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=64&v=4)](https://github.com/alexey-milovidov)
* [![@alesapin](https://avatars.githubusercontent.com/u/3684697?s=64&v=4)](https://github.com/alesapin)
* [![@kssenii](https://avatars.githubusercontent.com/u/54203879?s=64&v=4)](https://github.com/kssenii)
* [![@KochetovNicolai](https://avatars.githubusercontent.com/u/4092911?s=64&v=4)](https://github.com/KochetovNicolai)
* [![@tavplubix](https://avatars.githubusercontent.com/u/14847450?s=64&v=4)](https://github.com/tavplubix)
* [![@Avogar](https://avatars.githubusercontent.com/u/48961922?s=64&v=4)](https://github.com/Avogar)
* [![@rschu1ze](https://avatars.githubusercontent.com/u/100446237?s=64&v=4)](https://github.com/rschu1ze)
* [![@azat](https://avatars.githubusercontent.com/u/430798?s=64&v=4)](https://github.com/azat)
* [![@kitaisreal](https://avatars.githubusercontent.com/u/22458333?s=64&v=4)](https://github.com/kitaisreal)
* [![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=64&v=4)](https://github.com/vdimir)
* [![@CurtizJ](https://avatars.githubusercontent.com/u/20361854?s=64&v=4)](https://github.com/CurtizJ)
* [![@antonio2368](https://avatars.githubusercontent.com/u/17751307?s=64&v=4)](https://github.com/antonio2368)
* [![@Algunenano](https://avatars.githubusercontent.com/u/664253?s=64&v=4)](https://github.com/Algunenano)
* [![@Felixoid](https://avatars.githubusercontent.com/u/3025537?s=64&v=4)](https://github.com/Felixoid)

[+ 1,601 contributors](/ClickHouse/ClickHouse/graphs/contributors)

## Languages

* [C++
  79.8%](/ClickHouse/ClickHouse/search?l=c%2B%2B)
* [Python
  8.6%](/ClickHouse/ClickHouse/search?l=python)
* [Shell
  4.4%](/ClickHouse/ClickHouse/search?l=shell)
* [C
  3.3%](/ClickHouse/ClickHouse/search?l=c)
* [Jinja
  1.9%](/ClickHouse/ClickHouse/search?l=jinja)
* [CMake
  1.3%](/ClickHouse/ClickHouse/search?l=cmake)
* Other
  0.7%

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_45a68bc5_20250115_131053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FLZ4_decompress_faster.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FLZ4_decompress_faster.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.5k](/login?return_to=%2FClickHouse%2FClickHouse)

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.7k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  407](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_260b5136_20250115_210832.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FICompressionCodec.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FICompressionCodec.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.5k](/login?return_to=%2FClickHouse%2FClickHouse)

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.8k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  412](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

## Files

¬†6951e81
## Breadcrumbs

1. [ClickHouse](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d)
2. /[src](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src)
3. /[Compression](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression)
/
# ICompressionCodec.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/ClickHouse/ClickHouse/commits/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/ICompressionCodec.cpp)131 lines (101 loc) ¬∑ 3.92 KB¬†6951e81
## Breadcrumbs

1. [ClickHouse](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d)
2. /[src](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src)
3. /[Compression](/ClickHouse/ClickHouse/tree/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression)
/
# ICompressionCodec.cpp

Top
## File metadata and controls

* Code
* Blame

131 lines (101 loc) ¬∑ 3.92 KB[Raw](https://github.com/ClickHouse/ClickHouse/raw/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/ICompressionCodec.cpp)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131#include "ICompressionCodec.h"
#include <cassert>
#include <Parsers/ASTFunction.h>#include <common/unaligned.h>#include <Common/Exception.h>#include <Parsers/queryToString.h>#include <Parsers/ASTIdentifier.h>#include <Compression/CompressionCodecMultiple.h>
namespace DB{
namespace ErrorCodes{ extern const int CANNOT\_DECOMPRESS; extern const int CORRUPTED\_DATA; extern const int LOGICAL\_ERROR;}
void ICompressionCodec::setCodecDescription(const String & codec\_name, const ASTs & arguments){ std::shared\_ptr<ASTFunction> result = std::make\_shared<ASTFunction>(); result->name = "CODEC";
 /// Special case for codec Multiple, which doesn't have name. It's just list /// of other codecs. if (codec\_name.empty()) { ASTPtr codec\_desc = std::make\_shared<ASTExpressionList>(); for (const auto & argument : arguments) codec\_desc->children.push\_back(argument); result->arguments = codec\_desc; } else { ASTPtr codec\_desc; if (arguments.empty()) /// Codec without arguments is just ASTIdentifier codec\_desc = std::make\_shared<ASTIdentifier>(codec\_name); else /// Codec with arguments represented as ASTFunction codec\_desc = makeASTFunction(codec\_name, arguments);
 result->arguments = std::make\_shared<ASTExpressionList>(); result->arguments->children.push\_back(codec\_desc); }
 result->children.push\_back(result->arguments); full\_codec\_desc = result;}
ASTPtr ICompressionCodec::getFullCodecDesc() const{ if (full\_codec\_desc == nullptr) throw Exception("Codec description is not prepared", ErrorCodes::LOGICAL\_ERROR);
 return full\_codec\_desc;}
ASTPtr ICompressionCodec::getCodecDesc() const{ auto arguments = getFullCodecDesc()->as<ASTFunction>()->arguments; /// If it has exactly one argument, than it's single codec, return it if (arguments->children.size() == 1) return arguments->children[0]; else /// Otherwise we have multiple codecs and return them as expression list return arguments;}
UInt64 ICompressionCodec::getHash() const{ SipHash hash; updateHash(hash); return hash.get64();}
UInt32 ICompressionCodec::compress(const char \* source, UInt32 source\_size, char \* dest) const{ assert(source != nullptr && dest != nullptr);
 dest[0] = getMethodByte(); UInt8 header\_size = getHeaderSize(); /// Write data from header\_size UInt32 compressed\_bytes\_written = doCompressData(source, source\_size, &dest[header\_size]); unalignedStore<UInt32>(&dest[1], compressed\_bytes\_written + header\_size); unalignedStore<UInt32>(&dest[5], source\_size); return header\_size + compressed\_bytes\_written;}
UInt32 ICompressionCodec::decompress(const char \* source, UInt32 source\_size, char \* dest) const{ assert(source != nullptr && dest != nullptr);
 UInt8 header\_size = getHeaderSize(); if (source\_size < header\_size) throw Exception(ErrorCodes::CORRUPTED\_DATA, "Can't decompress data: the compressed data size ({}, this should include header size) is less than the header size ({})", source\_size, static\_cast<size\_t>(header\_size));
 uint8\_t our\_method = getMethodByte(); uint8\_t method = source[0]; if (method != our\_method) throw Exception(ErrorCodes::CANNOT\_DECOMPRESS, "Can't decompress data with codec byte {} using codec with byte {}", method, our\_method);
 UInt32 decompressed\_size = readDecompressedBlockSize(source); doDecompressData(&source[header\_size], source\_size - header\_size, dest, decompressed\_size);
 return decompressed\_size;}
UInt32 ICompressionCodec::readCompressedBlockSize(const char \* source){ return unalignedLoad<UInt32>(&source[1]);}
UInt32 ICompressionCodec::readDecompressedBlockSize(const char \* source){ return unalignedLoad<UInt32>(&source[5]);}
uint8\_t ICompressionCodec::readMethod(const char \* source){ return static\_cast<uint8\_t>(source[0]);}
}

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from jfrog.com_480306fe_20250115_080058.html ===


[![JFrog banner](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/10/10144003/Group-97223.png)](https://github.com/marketplace/jfrog/?utm_campaign=github-copilot)
[![JFrog banner](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/10/10143852/homepage-banner-mobile-360x53-1.jpg)](https://github.com/marketplace/jfrog/?utm_campaign=github-copilot)

[![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/08/08132607/jfrog-logo-2022.svg "JFrog logo")
![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/08/08132607/jfrog-logo-2022.svg "JFrog logo")](https://jfrog.com/)

* [Products](#products "Products")
* [Solutions](#solutions "Solutions")
* [Pricing](https://jfrog.com/pricing/ "Pricing")
* [Developers](#developers "Developers")
* [Resources](#resources "Resources")
* [Partners](#partners "Partners")

* [Discover Our Partner Ecosystem  >](https://jfrog.com/partners/)
* [Find a JFrog Partner  >](https://partnerfinder.jfrog.com/)
* [Explore Partner Integrations  >](https://jfrog.com/integrations/)

* [Community  >](https://jfrog.com/community/)
* [Documentation  >](https://jfrog.com/help/)
* [Integrations  >](https://jfrog.com/integration/)
* [Applications  >](https://docs.jfrog-applications.jfrog.io/)

Use¬†Case

* Cloud Solutions
  + [Flexible Cloud Deployment Solutions](https://jfrog.com/cloud/)
* AI/ML
  + [Model Lifecycle Management (MLOps)](https://jfrog.com/jfrog-ml/mlops/)
  + [Data Engineering & Feature Management (DataOps)](https://jfrog.com/jfrog-ml/dataops/)
  + [AI/ML Development and Deployment](https://jfrog.com/mlops/)
  + [MLSecOps](https://jfrog.com/mlsecops/)
* DevOps
  + [Artifact Management](https://jfrog.com/artifact-management/)
  + [Tool Consolidation](https://jfrog.com/tool-consolidation/)
  + [Release Lifecycle Management](https://jfrog.com/rlm/)
* DevSecOps
  + [Holistic Software Supply Chain Security](https://jfrog.com/xray/)
  + [Curate Open-Source Packages](https://jfrog.com/curation/)
  + [Source Code Scanning (SAST)](https://jfrog.com/sast/)
  + [Software Composition Analysis (SCA)](https://jfrog.com/xray/sca-scan/)
  + [Secrets Detection](https://jfrog.com/xray/secrets-detection-source-binaries/)
  + [Infrastructure as Code (IaC) Security](https://jfrog.com/xray/iac-security-check/)
* Device/IoT
  + [Connected Device Management](https://jfrog.com/connect/)

Integrations

* [GitHub  >](https://jfrog.com/jfrog-and-github/)
* [NVIDIA  >](/jfrog-and-nvidia/)
* [Docker  >](https://jfrog.com/integration/docker-registry/)
* [Maven  >](https://jfrog.com/integration/maven-repository/)
* [See all integrations  >](https://jfrog.com/integration/)

Industry

* [Financial Services  >](https://jfrog.com/industry/financial-services/)
* [Public Sector  >](https://jfrog.com/industry/public-sector/)
* [Technology  >](https://jfrog.com/technology-software-services/)
* [Healthcare  >](https://jfrog.com/healthcare-services/)
* [Gaming  >](https://jfrog.com/gaming/)
* [Automotive  >](https://jfrog.com/automotive-services/)
* [Enterprise  >](http://jfrog.com/solutions/enterprise)

Learning & Guides

* [JFrog Help Center  >](https://jfrog.com/help/)
* [Security Research  >](https://research.jfrog.com/)
* [JFrog Academy  >](https://academy.jfrog.com/)
* [Events  >](https://jfrog.com/about/events/)
* [Webinars & Workshops  >](https://jfrog.com/webinar/)
* [DevOps Consulting Services  >](https://jfrog.com/devops-consulting-services/)
* [DevOps Certification  >](https://jfrog.com/certification/)
* [State of Union Report  >](https://jfrog.com/software-supply-chain-state-of-union/)
* [Software Supply Chain Topics  >](https://jfrog.com/learn/)

Collateral

* [Resource Center  >](https://jfrog.com/resource-center/)
* [JFrog Blog  >](https://jfrog.com/blog/)
* [Customer Stories  >](https://jfrog.com/about/customers/)

Customer Zone

* [Support  >

  Customer support, tickets and community](https://jfrog.com/support/)
* [Manage & Troubleshoot  >

  Renew, retrieve licenses, legal and more](https://jfrog.com/customer-zone/)
* [MyJFrog  >

  Cloud customer portal](https://my.jfrog.com/login/)
* [Cloud Status  >

  Service status & event subscription](https://status.jfrog.io/)
* [JFrog Trust  >

  How we protect you & your data](https://jfrog.com/trust/)

[The JFrog Platform
Deliver Trusted Software with Speed

The only software supply chain platform to give you end-to-end visibility, security, and control for automating delivery of trusted releases. Bring together DevOps, DevSecOps and MLOps teams in a single source of truth.
View Platform](https://jfrog.com/platform/)

DevOps

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132304/jfrog-artifactory.svg "jfrog-artifactory")
[JFrog Artifactory
Universal Artifact & ML Model Repository Manager](https://jfrog.com/artifactory/)

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132437/jfrog-distribution.svg "jfrog-distribution")
[JFrog Distribution
Secure Distribution Across Consumption Points](https://jfrog.com/distribution/)

![JFrog Connect](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/09231026/icon-jfrog-connect.svg "icon-jfrog-connect")

[JFrog Connect
IoT Device Management with DevOps Agility](https://jfrog.com/connect/)

DevSecOps

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132519/jfrog-curation.svg "jfrog-curation")

[JFrog Curation
Seamlessly Curate Software Packages & ML Models](https://jfrog.com/curation/)

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132556/jfrog-xray.svg "jfrog-xray")

[JFrog Security Essentials (Xray)
Integrated SCA for Software & AI Artifacts](https://jfrog.com/xray/)

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132556/jfrog-xray.svg "jfrog-xray")

[JFrog Advanced Security
Supply Chain Exposure Scanning & Impact Analysis](https://jfrog.com/devops-native-security/)

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/10145634/JFrog_Runtime.svg "JFrog_Runtime")

[JFrog Runtime
Real-time visibility into runtime vulnerabilities](https://jfrog.com/runtime/)

AI/ML

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/29162205/ml-nav-icon.svg "ml-nav-icon")

[JFrog ML
Build, Train, Secure, Deploy, Serve and Monitor ML Models and GenAI](https://jfrog.com/jfrog-ml/)

[Contact Us](https://jfrog.com/contact-us/)[Start Free](https://jfrog.com/start-free/)

* Products

  The JFrog Platform
  Deliver Trusted Software with Speed

  The only software supply chain platform to give you end-to-end visibility, security, and control for automating delivery of trusted releases. Bring together DevOps, DevSecOps and MLOps teams in a single source of truth.
  [View Platform](https://jfrog.com/platform/)

  + DevOps
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132304/jfrog-artifactory.svg)

       JFrog Artifactory
      Universal Artifact & ML Model Repository Manager](https://jfrog.com/artifactory/)
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132437/jfrog-distribution.svg)

       JFrog Distribution
      Secure Distribution Across Consumption Points](https://jfrog.com/distribution/)
    - [![JFrog Connect](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/09231026/icon-jfrog-connect.svg)

       JFrog Connect
      IoT Device Management with DevOps Agility](https://jfrog.com/connect/)
  + DevSecOps
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132519/jfrog-curation.svg)

       JFrog Curation
      Seamlessly Curate Software Packages & ML Models](https://jfrog.com/curation/)
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132556/jfrog-xray.svg)

       JFrog Security Essentials (Xray)
      Integrated SCA for Software & AI Artifacts](https://jfrog.com/xray/)
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/22132556/jfrog-xray.svg)

       JFrog Advanced Security
      Supply Chain Exposure Scanning & Impact Analysis](https://jfrog.com/devops-native-security/)
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/10145634/JFrog_Runtime.svg)

       JFrog Runtime
      Real-time visibility into runtime vulnerabilities](https://jfrog.com/runtime/)
  + AI/ML
    - [![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2017/08/29162205/ml-nav-icon.svg)

       JFrog ML
      Build, Train, Secure, Deploy, Serve and Monitor ML Models and GenAI](https://jfrog.com/jfrog-ml/)
* Solutions

  + Use¬†Case
    - Cloud Solutions
      * [Flexible Cloud Deployment Solutions](https://jfrog.com/cloud/)
    - AI/ML
      * [Model Lifecycle Management (MLOps)](https://jfrog.com/jfrog-ml/mlops/)
      * [Data Engineering & Feature Management (DataOps)](https://jfrog.com/jfrog-ml/dataops/)
      * [AI/ML Development and Deployment](https://jfrog.com/mlops/)
      * [MLSecOps](https://jfrog.com/mlsecops/)
    - DevOps
      * [Artifact Management](https://jfrog.com/artifact-management/)
      * [Tool Consolidation](https://jfrog.com/tool-consolidation/)
      * [Release Lifecycle Management](https://jfrog.com/rlm/)
    - DevSecOps
      * [Holistic Software Supply Chain Security](https://jfrog.com/xray/)
      * [Curate Open-Source Packages](https://jfrog.com/curation/)
      * [Source Code Scanning (SAST)](https://jfrog.com/sast/)
      * [Software Composition Analysis (SCA)](https://jfrog.com/xray/sca-scan/)
      * [Secrets Detection](https://jfrog.com/xray/secrets-detection-source-binaries/)
      * [Infrastructure as Code (IaC) Security](https://jfrog.com/xray/iac-security-check/)
    - Device/IoT
      * [Connected Device Management](https://jfrog.com/connect/)
  + Integrations
    - [GitHub](https://jfrog.com/jfrog-and-github/)
    - [NVIDIA](/jfrog-and-nvidia/)
    - [Docker](https://jfrog.com/integration/docker-registry/)
    - [Maven](https://jfrog.com/integration/maven-repository/)
    - [See all integrations](https://jfrog.com/integration/)
  + Industry
    - [Financial Services](https://jfrog.com/industry/financial-services/)
    - [Public Sector](https://jfrog.com/industry/public-sector/)
    - [Technology](https://jfrog.com/technology-software-services/)
    - [Healthcare](https://jfrog.com/healthcare-services/)
    - [Gaming](https://jfrog.com/gaming/)
    - [Automotive](https://jfrog.com/automotive-services/)
    - [Enterprise](http://jfrog.com/solutions/enterprise)
* [Pricing](https://jfrog.com/pricing/)
* Developers

  + - [Community](https://jfrog.com/community/)
    - [Documentation](https://jfrog.com/help/)
    - [Integrations](https://jfrog.com/integration/)
    - [Applications](https://docs.jfrog-applications.jfrog.io/)
* Resources

  + Learning & Guides
    - [JFrog Help Center](https://jfrog.com/help/)
    - [Security Research](https://research.jfrog.com/)
    - [JFrog Academy](https://academy.jfrog.com/)
    - [Events](https://jfrog.com/about/events/)
    - [Webinars & Workshops](https://jfrog.com/webinar/)
    - [DevOps Consulting Services](https://jfrog.com/devops-consulting-services/)
    - [DevOps Certification](https://jfrog.com/certification/)
    - [State of Union Report](https://jfrog.com/software-supply-chain-state-of-union/)
    - [Software Supply Chain Topics](https://jfrog.com/learn/)
  + Collateral
    - [Resource Center](https://jfrog.com/resource-center/)
    - [JFrog Blog](https://jfrog.com/blog/)
    - [Customer Stories](https://jfrog.com/about/customers/)
  + Customer Zone
    - [Support
      Customer support, tickets and community](https://jfrog.com/support/)
    - [Manage & Troubleshoot
      Renew, retrieve licenses, legal and more](https://jfrog.com/customer-zone/)
    - [MyJFrog
      Cloud customer portal](https://my.jfrog.com/login/)
    - [Cloud Status
      Service status & event subscription](https://status.jfrog.io/)
    - [JFrog Trust
      How we protect you & your data](https://jfrog.com/trust/)
* Partners

  + - [Discover Our Partner Ecosystem](https://jfrog.com/partners/)
    - [Find a JFrog Partner](https://partnerfinder.jfrog.com/)
    - [Explore Partner Integrations](https://jfrog.com/integrations/)

[Blog Home](/blog/)

# 7 RCE and DoS vulnerabilities Found in ClickHouse DBMS

![Uriya Yavnieli](data:image/svg+xml... "Uriya Yavnieli")![Uriya Yavnieli](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/08/19141403/Uriya-Yavnieli.png "Uriya Yavnieli")

By
[Uriya Yavnieli,  JFrog Security Researcher](https://jfrog.com/blog-author/uriya-yavnieli/)

Or Peles, JFrog Vulnerability Research Team Leader

March 15, 2022

  10 min read

SHARE:

![ClickHouse DBMS](data:image/svg+xml...)![ClickHouse DBMS](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2022/02/09164005/ClickHouse-DBMS-863x300-1.png)

The JFrog Security research team constantly monitors open-source projects to find new vulnerabilities or malicious packages and share them with the wider community to help improve their overall security posture. As part of this effort, the team recently discovered seven new [security vulnerabilities](https://jfrog.com/knowledge-base/understanding-security-vulnerabilities/) in [ClickHouse](https://clickhouse.tech/), a widely used open-source Database Management System (DBMS) dedicated to online analytical processing (OLAP). ClickHouse was developed by Yandex for the Yandex.Metrica, a web analytics tool often used to get visual reports and video recordings of user actions, as well as track traffic sources to help evaluate the effectiveness of online and offline advertising. The JFrog Security team responsibly disclosed these vulnerabilities and worked with ClickHouse‚Äôs maintainers on verifying the fixes.

The vulnerabilities require authentication, but can be triggered by any user with read permissions. This means the attacker must perform reconnaissance on the specific ClickHouse server target to obtain valid credentials. Any set of credentials would do, since even a user with the lowest privileges can trigger all of the vulnerabilities. By triggering the vulnerabilities, an attacker can crash the ClickHouse server, leak memory contents or even cause remote code execution (RCE).

Following are the seven vulnerabilities the JFrog Security team discovered:

* **CVE-2021-43304** and **CVE-2021-43305**¬†‚Äì heap buffer overflow vulnerabilities in LZ4 compression codec
* **CVE-2021-42387** and **CVE-2021-42388** ‚Äì heap out-of-bounds read vulnerabilities in LZ4 compression codec
* **CVE-2021-42389** ‚Äì divide by zero in Delta compression codec
* **CVE-2021-42390** ‚Äì divide by zero in Delta-Double compression codec
* **CVE-2021-42391** ‚Äì divide by zero in Gorilla compression codec

| **CVE ID** | **Description** | **Potential Impact** | **CVSSv3.1 Score** |
| --- | --- | --- | --- |
| CVE-2021-43304 | Heap buffer overflow in LZ4 compression codec when parsing a malicious query | RCE | 8.8 |
| CVE-2021-43305 | Heap buffer overflow in LZ4 compression codec when parsing a malicious query | RCE | 8.8 |
| CVE-2021-42387 | Heap out-of-bounds read in LZ4 compression codec when parsing a malicious query | Denial of Service or Information Leakage | 7.1 |
| CVE-2021-42388 | Heap out-of-bounds read in LZ4 compression codec when parsing a malicious query | Denial of Service or Information Leakage | 7.1 |
| CVE-2021-42389 | Divide-by-zero in Delta compression codec when parsing a malicious query | Denial of Service | 6.5 |
| CVE-2021-42390 | Divide-by-zero in DeltaDouble compression codec when parsing a malicious query | Denial of Service | 6.5 |
| CVE-2021-42391 | Divide-by-zero in Gorilla compression codec when parsing a malicious query | Denial of Service | 6.5 |

## Technical Background

The ClickHouse server allows a user to compress its queries. A user can pass a compressed query by supplying the **decompress=1** URL query string parameter to its web interface, like so:

```
cat query.bin | curl -sS --data-binary @- 'http://serverIP:8123/?user=guest1&password=1234&decompress=1'
```

Where serverIP is the IP address of the ClickHouse server that has a user ‚Äúguest1‚Äù with password ‚Äú1234‚Äù set up. This user can also be configured with a ‚Äúreadonly‚Äù policy.

The query‚Äôs content (query.bin) should be in the following format:

```
struct {
    uint128_t hash; // Google‚Äôs CityHash128
    uint8_t compress_method;
    uint32_t size_compressed_without_checksum; // the length (in bytes) of the entire struct (including compressed_data contents) minus the first 16bytes hash field.
    uint32_t decompressed_size; // the expected decompressed output size
    char compressed_data[0]; // the compressed data bytes (variable length)
};
```

The client supplies the entire struct to the server and thus controls all of its contents.

The compressed data is consumed by constructing a [CompressedReadBuffer](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/CompressedReadBuffer.cpp) instance with the struct as its input.

CompressedReadBuffer‚Äôs code [calls readCompressedData](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/CompressedReadBuffer.cpp#L12) which reads the struct and extracts its length values, calculates the CityHash128 over the struct contents (excluding the hash field), and verifies it against the struct‚Äôs hash field. It then [resizes](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/CompressedReadBuffer.cpp#L21) (basically [realloc()‚Äôs](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/IO/BufferWithOwnMemory.h#L88)) the initially [allocated](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/IO/BufferWithOwnMemory.h#L117) memory buffer used to hold the decompressed data. Then, through ICompressionCodec::decompress, the selected codec‚Äôs [doDecompressData](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/ICompressionCodec.cpp#L109) is called.

In **CVE-2021-42387**, **CVE-2021-43304**, **CVE-2021-42388** and **CVE-2021-43305** the LZ4 codec calls [LZ4::decompress(source, dest, source\_size, dest\_size, ..)](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/LZ4_decompress_faster.cpp#L527) with the ‚Äòcompressed\_data‚Äô as source, its length as source\_size, the resized memory buffer as dest, and the struct‚Äôs ‚Äòdecompressed\_size‚Äô value as dest\_size. LZ4::decompress eventually calls [LZ4::decompressImpl(source, dest, dest\_size)](https://github.com/ClickHouse/ClickHouse/blob/6951e8147d7a25f7bb4f7d43738793cff239db6d/src/Compression/LZ4_decompress_faster.cpp#L415) that does the actual LZ4 decompression in a loop ‚Äìcopying different parts of the compressed input in user-controlled lengths and offsets (supplied as part of the compressed\_data bytes) to the decompressed output memory buffer. It defines pointer variables for tracking the current location in the source (ip) and the dest (op).

### CVE-2021-43304¬† ‚Äì a heap buffer overflow vulnerability

Here is the code of LZ4::decompressImpl() that is relevant for CVE-2021-43304:

```
template
void NO_INLINE decompressImpl(
     const char * const source,
     char * const dest,
     size_t dest_size)
{
    ...
    while (true)
    {
        ...
        wildCopy(op, ip, copy_end);    /// Here we can write up to copy_amount - 1 bytes after buffer.

        ip += length;
        op = copy_end;

        if (copy_end >= output_end)
            return;
        ...
    }
}
```

**ip** is a pointer that points to the compressed buffer and **op** is a pointer that points to the allocated destination buffer, which is allocated with a size of the given decompressed\_size that is passed in the header. **copy\_end** is a pointer that points to the end of the copy area.

**copy\_amount** is the parameter of the template, which can be 8, 16 or 32. The copy area is being copied in chunks that each one of them is in size of **copy\_amount**. For example, this is the implementation of wildCopy16:

```
inline void wildCopy16(UInt8 * dst, const UInt8 * src, const UInt8 * dst_end)
{
    /// Unrolling with clang is doing >10% performance degrade.
#if defined(__clang__)
    #pragma nounroll
#endif
    do
    {
        copy16(dst, src);
        dst += 16;
        src += 16;
    } while (dst < dst_end);
}

```

Since the user controls **decompressed\_size** and the compressed buffer, an attacker can take advantage of this situation by preparing compressed data with a header that contains a decompressed\_size which is smaller than the actual size of the compressed data. Note that the lengths of the overflow, as well as source‚Äôs allocation size and the overflowing byte contents are fully controlled by the user, which greatly facilitates exploitation.

Also note that the existing size check of ‚Äúif (copy\_end >= output\_end)‚Äù does not prevent this vulnerability as it appears after the copy operation. CVE-2021-43305 is similar to CVE-2021-43304, but [involves](https://github.com/ClickHouse/ClickHouse/blob/master/src/Compression/LZ4_decompress_faster.cpp#L518) a different copy operation (whose source is a controlled offset of the destination buffer).

## Exploiting CVE-2021-43304

In order to prove the exploitability of CVE-2021-43304, we created a specially crafted compressed file and sent it as previously explained. The query.bin file is comprised of the following header:

* hash = the matching calculated Cityhash
* compress\_method = 0x82 (LZ4 method)
* size\_compressed\_without\_checksum = 0xc80a
* decompressed\_size = 0x1

And for the compressed data we‚Äôve used ‚Äò\xff‚Äô (repeating 200 times) ‚ÄòA‚Äô (repeating 5100 times). These are arbitrary values. The resulting malformed compressed file:

`00000000 26 fc 61 db c0 83 bb 0a db 58 5a f0 34 e1 30 f6 |&.a......XZ.4.0.|

00000010 82 0a c8 00 00 01 00 00 00 f0 ff ff ff ff ff ff |................|

00000020 ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff |................|

*

000000e0 ff ff 41 41 41 41 41 41 41 41 41 41 41 41 41 41 |..AAAAAAAAAAAAAA|

000000f0 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 |AAAAAAAAAAAAAAAA|

*

0000c81a`

The 200 0xff‚Äôs are being used in the loop inside LZ4::decompressImpl():

```
template
void NO_INLINE decompressImpl(
     const char * const source,
     char * const dest,
     size_t dest_size)
{
    ...
    while (true)
    {
        ...
        size_t length;

        auto continue_read_length = [&]
        {
            unsigned s;
            do
            {
                s = *ip++;
                length += s;
            } while (unlikely(s == 255));
        };

        /// Get literal length.

        const unsigned token = *ip++;
        length = token >> 4;
        if (length == 0x0F)
            continue_read_length();

        /// Copy literals.

        UInt8 * copy_end = op + length;

        ...

        wildCopy(op, ip, copy_end);    /// Here we can write up to copy_amount - 1 bytes after buffer.
        ...
    }
}
```

That will increase **length** by 0xff \* 200 = 51000, which is exactly the size of the rest of the data.

So although the decompressed size is 1, a much larger size will be copied to the destination.

By sending the query to a vulnerable ClickHouse server, while debugging the server‚Äôs process, we managed to periodically get the following crash, proving control of the instruction pointer register, since the code branches to an address taken from the RAX register, which has been overwritten with our ‚ÄúA‚Äù values:

![debugging the server process](data:image/svg+xml...)![debugging the server process](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2022/02/09170754/debugging-the-server-process.png)

Although this specific crash is statistical, we believe that with proper heap shaping techniques, a stable exploit can be developed.

### CVE-2021-42388 and CVE-2021-42387 ‚Äì heap OOB read vulnerabilities

In LZ4::decompressImpl():

```
template
void NO_INLINE decompressImpl(
     const char * const source,
     char * const dest,
     size_t dest_size)
{
    ...
    while (true)
    {
        ...
        const UInt8 * match = op - offset;
        ...
        if (length > copy_amount * 2)
            wildCopy(op + copy_amount, match + copy_amount, copy_end);
        ...
    }
}
```

As part of the LZ4::decompressImpl() loop, a 16-bit unsigned user-supplied value (‚Äòoffset‚Äô) is read from the compressed\_data. it is subtracted from the current op and stored in **match** pointer (**op** is a pointer that starts as **dest** and moves forward). There is no verification that the **match** pointer is not smaller than **dest**. Later, there‚Äôs a copy operation from match to output pointer ‚Äì possibly **copying out of bounds memory from before the ‚Äòdest‚Äô memory buffer**. Accessing memory outside of the buffer‚Äôs bounds can expose sensitive information or lead in certain cases to a crash of the application due to segmentation fault.

CVE-2021-42387 is a similar vulnerability to CVE-2021-42388, which exceeds the upper bounds of the compressed buffer (source) as part of the copy operation.

## CVE-2021-42389, CVE-2021-42390 and CVE-2021-42391 ‚Äì Divide by zero vulnerabilities

These are divide-by-zero vulnerabilities in various codecs supported by ClickHouse. They are based on setting the first byte of the compressed buffer (described in the ‚ÄúTechnical Background‚Äù section above) to zero. The decompression code reads the first byte of the compressed buffer and performs a modulo operation with it to get the remainder:

```
UInt8 bytes_size = source[0];
UInt8 bytes_to_skip = uncompressed_size % bytes_size;
```

In most of the cases the modulo operation in Intel x86-64 is performed by a DIV instruction, which, apart from dividing the numbers, also keeps the remainder in a register. So in case bytes\_size is 0, it will end up dividing by zero.

These vulnerabilities were found by ‚Äúsmart fuzzing‚Äù the decompression mechanism. Smart fuzzing leverages the knowledge of the input format for generating input data which (relatively) adheres to the expected protocol schema, instead of completely random data.

## Fixes and Workarounds

In order to fix the issues, update ClickHouse to the [v21.10.2.15-stable](https://github.com/ClickHouse/ClickHouse/releases/tag/v21.10.2.15-stable) version or later.

If upgrading is not possible, add firewall rules in the server that will restrict the access to the web port (8123) and the TCP server‚Äôs port (9000) to specific clients only.

## Are JFrog products vulnerable?

JFrog products are not vulnerable to this issue, since they do not use the ClickHouse DBMS

## Acknowledgement

We would like to thank the ClickHouse Inc. team for promptly and professionally handling this issue.

## Learn More

In addition to exposing new security vulnerabilities and threats, JFrog provides developers and security teams easy access to the latest relevant information for their software with automated security scanning. Explore how [JFrog Xray can be of help to you.](https://jfrog.com/xray)

*Questions? Thoughts?* Contact us at **research@jfrog.com** for any inquiries.

 Tags:
[security-research](/blog/tag/security-research/)
[vulnerability disclosure](/blog/tag/vulnerability-disclosure/)

[Start a Trial](https://jfrog.com/start-free/)

SHARE:

Sign up for blog updates

I agree that JFrog may use my information in accordance with the [JFrog Privacy Notice](/privacy-notice/)

Subscribe

### Popular Tags

* [CI/CD](https://jfrog.com/blog/tag/ci-cd/)
* [Artifactory](https://jfrog.com/blog/tag/artifactory/)
* [Best Practices](https://jfrog.com/blog/tag/best-practices/)
* [DevOps](https://jfrog.com/blog/tag/devops/)
* [Xray](https://jfrog.com/blog/tag/xray/)

## See what JFrog & GitHub can do together

![](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2024/08/22165740/jfrog_github_asset.png)

[Learn More](https://jfrog.com/jfrog-and-github/)

## Thank You!

Full Name\*

Email\*

I have read and agree to the [Privacy Policy](/privacy-policy/)

Proceed

Products

* [Artifactory](https://jfrog.com/artifactory/)
* [Xray](https://jfrog.com/xray/)
* [Curation](https://jfrog.com/curation/)
* [Distribution](https://jfrog.com/distribution/)
* [Container Registry](https://jfrog.com/container-registry/)
* [Connect](https://jfrog.com/connect/)
* [JFrog ML](https://jfrog.com/jfrog-ml/)

* [JFrog Platform](https://jfrog.com/platform/)

* [Start Free](https://jfrog.com/start-free/)

Resources

* [Blog](https://jfrog.com/blog/)
* [Security Research](https://research.jfrog.com/)
* [Events](https://jfrog.com/about/events/)
* [Integrations](https://jfrog.com/integration/)
* [JFrog Help Center](https://jfrog.com/help/)
* [Software Supply Chain Topics](https://jfrog.com/learn/)
* [Open Source](https://jfrog.com/community/open-source/)
* [JFrog Trust](https://jfrog.com/trust/)
* [Compare JFrog](https://jfrog.com/compare/)

Company

* [About](https://jfrog.com/about/)
* [Management](https://jfrog.com/about/management/)
* [Investor Relations](https://investors.jfrog.com/overview/default.aspx)
* [Partners](https://jfrog.com/partners/)
* [Customers](https://jfrog.com/about/customers/)
* [Careers](https://join.jfrog.com/)

* [Press](https://jfrog.com/press-room/)
* [Contact Us](https://jfrog.com/contact-us/)
* [Brand Guidelines](https://jfrog.com/brand-guidelines/)

Developer

* [Community](https://jfrog.com/community/)
* [Downloads](https://jfrog.com/community/open-source/)
* [Community Events](https://jfrog.com/community/events/)
* [Community Forum](https://stackoverflow.com/questions/tagged/artifactory)
* [Applications](https://docs.jfrog-applications.jfrog.io/)

 Follow Us

¬© 2025 JFrog Ltd All Rights Reserved

Discover More

* [The JNDI Strikes Back ‚Äì Unauthenticated RCE in H2 Database Console](https://jfrog.com/blog/the-jndi-strikes-back-unauthenticated-rce-in-h2-database-console/)
* [What is a Software Supply Chain?](https://jfrog.com/learn/software-supply-chain/)
* [Use Case: Security Tools Consolidation](https://jfrog.com/usecase/security-tool-consolidation/)

[![JFrog Logo](data:image/svg+xml... "JFrog Logo")![JFrog Logo](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2021/12/29113553/jfrog-logo-2022.svg "JFrog Logo")](https://jfrog.com/)
[Terms of Use](/terms-of-use/)
| [Privacy Notice](https://jfrog.com/privacy-notice/)
| [Cookies Policy](https://jfrog.com/jfrog-cookies-policy/)
|
Cookies Settings
![Privacy Options](data:image/svg+xml...)![Privacy Options](https://jfrog.com/wp-content/themes/jfrog.com/assets/images/general/privacyoptions.svg)

|
[Accessibility Notice](https://jfrog.com/jfrog-accessibility-notice/)
|
Accessibility Mode

## Thank You!

Your submission has been recieved.

We will contact you soon!

OK

x

## Oops... Something went wrong

Please try again later

Continue

![close](data:image/svg+xml...)![close](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2019/12/20130026/close.png)

## Information

![frog hand](data:image/svg+xml...)

![close](https://speedmedia.jfrog.com/08612fe1-9391-4cf3-ac1a-6dd49c36b276/media.jfrog.com/wp-content/uploads/2019/12/20130026/close.png)

![US Flag](data:image/svg+xml... "flag_us")

![JFrog Logo](data:image/svg+xml... "jfrog-logo")
[![Chinese Flag](data:image/svg+xml... "flag_chinese")](https://jfrogchina.com/)



=== Content from github.com_d85c1561_20250115_131052.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FLZ4_decompress_faster.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fblob%2F6951e8147d7a25f7bb4f7d43738793cff239db6d%2Fsrc%2FCompression%2FLZ4_decompress_faster.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.5k](/login?return_to=%2FClickHouse%2FClickHouse)

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.7k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  407](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


