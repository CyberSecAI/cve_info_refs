=== Content from www.openwall.com_d786e0e0_20250114_205345.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2021/03/06/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <E1lIDvd-0006DY-2i@xenbits.xenproject.org>
Date: Fri, 05 Mar 2021 17:07:53 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security-team-members@....org>
Subject: Xen Security Advisory 369 v2 (CVE-2021-28039) - Linux: special
 config may crash when trying to map foreign pages

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2021-28039 / XSA-369
                              version 2

   Linux: special config may crash when trying to map foreign pages

UPDATES IN VERSION 2
====================

CVE assigned.

ISSUE DESCRIPTION
=================

With CONFIG_XEN_BALLOON_MEMORY_HOTPLUG disabled and
CONFIG_XEN_UNPOPULATED_ALLOC enabled the Linux kernel will use guest
physical addresses allocated via the ZONE_DEVICE functionality for
mapping foreign guest's pages.

This will result in problems, as the p2m list will only cover the initial
memory size of the domain plus some padding at the end. Most ZONE_DEVICE
allocated addresses will be outside the p2m range and thus a mapping can't
be established with those memory addresses, resulting in a crash.

The attack involves doing I/O requiring large amounts of data to be
mapped by the Dom0 or driver domain.  The amount of data needed to
result in a crash can vary depending on the memory layout of the
affected Dom0 or driver domain.

IMPACT
======

A Dom0 or driver domain based on a Linux kernel (configured as
described above) can be crashed by a malicious guest administrator, or
possibly malicious unprivileged guest processes.

VULNERABLE SYSTEMS
==================

Only x86 paravirtualized (PV) Dom0 or driver domains are
affected.

Only Linux kernels configured *with* CONFIG_XEN_UNPOPULATED_ALLOC and
*without* CONFIG_XEN_BALLOON_MEMORY_HOTPLUG are vulnerable.  Only
kernels from kernel version 5.9 onwards are affected.

CONFIG_XEN_BALLOON_MEMORY_HOTPLUG is enabled by default in upstream
Linux when Xen support is enabled, so kernels using upstream default
Kconfig are not affected.  Most distribution kernels supporting Xen
dom0 use are likewise not vulnerable.

Arm systems or x86 PVH or x86 HVM driver domains are not affected.

MITIGATION
==========

There is no mitigation available.

RESOLUTION
==========

Applying the appropriate attached patch resolves this issue.

xsa369-linux.patch           Linux 5.9-stable - 5.12-rc

$ sha256sum xsa369*
937df4f078a070cf47bdd718c6b8a042ec6bee255eedc422d833c2ae3dd561c7  xsa369-linux.patch
$

CREDITS
=======

This issue was discovered by Marek Marczykowski-Górecki of Invisible
Things Lab.

For patch:
Reported-by: Marek Marczykowski-Górecki <marmarek@...isiblethingslab.com>

NOTE REGARDING LACK OF EMBARGO
==============================

This was reported publicly multiple times, before the XSA could be
issued.
-----BEGIN PGP SIGNATURE-----

iQFABAEBCAAqFiEEI+MiLBRfRHX6gGCng/4UyVfoK9kFAmBCZVUMHHBncEB4ZW4u
b3JnAAoJEIP+FMlX6CvZp8wIALvuzrh0iQDIg86Mx/eTtfVflmrz91YiDPfhrDj1
L1D2lR+uFPKFpb3CdDTlzKoby/1ym4wbTLCjnDdXxjmPTdn4KybcBNbNONt2p69X
dr/3KsO6yW5tjSi3FRZnnyTnTJN/q65tijG23sAcF7KuNW+xT2d70tWMH+LeMQZO
fGkztK08cZspFfZZiOJHuqi5qpzoaBw7/vqlCphoiDMeE1EOGpaa/+bGb4doehyj
dN8dyEWbyWdTp5lAxmduJfDMuixeESIxPnXP8jV3Z9b+Gt5l9S0cM+DCWDRUkW3M
W0Z7va35sFLCx4+N7fLuzMUkzoLWpTJq2i2m9lploexe3nY=
=PtNk
-----END PGP SIGNATURE-----

Download attachment "[xsa369-linux.patch](2/1)" of type "application/octet-stream" (5098 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from xenbits.xen.org_5f75cf37_20250114_205346.html ===

# Information

| Advisory | [XSA-369](advisory-369.html) |
| --- | --- |
| Public release | 2021-03-04 10:58 |
| Updated | 2023-12-15 15:35 |
| Version | 3 |
| CVE(s) | [CVE-2021-28039](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28039) |
| Title | Linux: special config may crash when trying to map foreign pages |

# Files

<advisory-369.txt> (signed advisory file)

<xsa369-linux.patch>
# Advisory

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2021-28039 / XSA-369
                               version 3

   Linux: special config may crash when trying to map foreign pages

UPDATES IN VERSION 3
====================

Normalize version tags

ISSUE DESCRIPTION
=================

With CONFIG_XEN_BALLOON_MEMORY_HOTPLUG disabled and
CONFIG_XEN_UNPOPULATED_ALLOC enabled the Linux kernel will use guest
physical addresses allocated via the ZONE_DEVICE functionality for
mapping foreign guest's pages.

This will result in problems, as the p2m list will only cover the initial
memory size of the domain plus some padding at the end. Most ZONE_DEVICE
allocated addresses will be outside the p2m range and thus a mapping can't
be established with those memory addresses, resulting in a crash.

The attack involves doing I/O requiring large amounts of data to be
mapped by the Dom0 or driver domain.  The amount of data needed to
result in a crash can vary depending on the memory layout of the
affected Dom0 or driver domain.

IMPACT
======

A Dom0 or driver domain based on a Linux kernel (configured as
described above) can be crashed by a malicious guest administrator, or
possibly malicious unprivileged guest processes.

VULNERABLE SYSTEMS
==================

Only x86 paravirtualized (PV) Dom0 or driver domains are
affected.

Only Linux kernels configured *with* CONFIG_XEN_UNPOPULATED_ALLOC and
*without* CONFIG_XEN_BALLOON_MEMORY_HOTPLUG are vulnerable.  Only
kernels from kernel version 5.9 onwards are affected.

CONFIG_XEN_BALLOON_MEMORY_HOTPLUG is enabled by default in upstream
Linux when Xen support is enabled, so kernels using upstream default
Kconfig are not affected.  Most distribution kernels supporting Xen
dom0 use are likewise not vulnerable.

Arm systems or x86 PVH or x86 HVM driver domains are not affected.

MITIGATION
==========

There is no mitigation available.

RESOLUTION
==========

Applying the appropriate attached patch resolves this issue.

xsa369-linux.patch           Linux 5.9 - 5.12-rc

$ sha256sum xsa369*
[937df4f078a070cf47bdd718c6b8a042ec6bee255eedc422d833c2ae3dd561c7  xsa369-linux.patch](xsa369-linux.patch)
$

CREDITS
=======

This issue was discovered by Marek Marczykowski-Górecki of Invisible
Things Lab.

For patch:
Reported-by: Marek Marczykowski-Górecki <marmarek@invisiblethingslab.com>

NOTE REGARDING LACK OF EMBARGO
==============================

This was reported publicly multiple times, before the XSA could be
issued.
-----BEGIN PGP SIGNATURE-----

iQFABAEBCAAqFiEEI+MiLBRfRHX6gGCng/4UyVfoK9kFAmV8b/sMHHBncEB4ZW4u
b3JnAAoJEIP+FMlX6CvZaPgIAMOsfssmqWQoAfjrR8lOU8vI3qoHrTr1FlS/c8b6
Wj+Tqq0EEKrMCftyf4KgrNAJuOUCOq8z09Ub3TCr5rHqX1S1SNYIDFu+cwaLn9Em
xPv4eYSz08UdtlmaX0Q6v8kBdJ6dR1iEeDO/53Vv1reIDsy7CMIMQBUDxb6I7U4e
XZa+WjPjllHuBZ7KoMvcInAXPVKGXdQ21EPAl+tZyMSOr5po/WgljfuAyMld1B/0
22g7GB+wx9g6zVSY0dCecpPKwfIMRcKeUKo9eC32jUfw0Iyqc/kE8aa2pQKFH8yC
K2IUp56Xi/p8+E9P0TfaH1Xml7dJlcyKD6JDCoEllK4iQ9U=
=Ebsa
-----END PGP SIGNATURE-----

```

---

Xenproject.org Security Team


=== Content from security.netapp.com_78f04836_20250114_205351.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [March 2021 Linux Kernel 5.11.3 Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20210409-0001)

## March 2021 Linux Kernel 5.11.3 Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20210409-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20210409-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20210409-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20210409-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20210409-0001
**Version:**
8.0

**Last updated:**
05/01/2024

**Status:**
Final.

**CVEs:** CVE-2021-27363, CVE-2021-27364, CVE-2021-27365, CVE-2021-28038, CVE-2021-28039

Overview
#### Summary

Multiple NetApp products incorporate Linux Kernel. Linux Kernel versions through 5.11.3 are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2021-27363](https://nvd.nist.gov/vuln/detail/CVE-2021-27363) | 4.4 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:L |
| [CVE-2021-27364](https://nvd.nist.gov/vuln/detail/CVE-2021-27364) | 7.1 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H |
| [CVE-2021-27365](https://nvd.nist.gov/vuln/detail/CVE-2021-27365) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2021-28038](https://nvd.nist.gov/vuln/detail/CVE-2021-28038) | 6.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H |
| [CVE-2021-28039](https://nvd.nist.gov/vuln/detail/CVE-2021-28039) | 6.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=688e8128b7a92df982709a4137ea4588d16f24aa>
* <http://xenbits.xen.org/xsa/advisory-367.html>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f9dbdf97a5bd92b1a49cee3d591b55b11fd7a6d5>

Affected Products
#### Affected Products

* NetApp Cloud Backup (formerly AltaVault)
* NetApp SolidFire Baseboard Management Controller (BMC)

#### Products Not Affected

* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Trident
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Service Processor - 8080/8060/8040/8020
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM6 SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp VASA Provider for Clustered Data ONTAP 9.7 and above
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* OnCommand Insight
* OnCommand Workflow Automation
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 9.7 and above
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112
* StorageGRID Baseboard Management Controller (BMC)
* StorageGRID9 (9.x and prior)
* System Manager 9.x
* Virtual Storage Console for VMware vSphere 9.7 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp Cloud Backup (formerly AltaVault)** | NetApp Cloud Backup (formerly AltaVault) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2880179.html) for more information. |
| **NetApp SolidFire Baseboard Management Controller (BMC)** | NetApp SolidFire Baseboard Management Controller (BMC) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2847476.html%20) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20210409-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20210409 | Initial Public Release |
| 2.0 | 20210414 | E-Series SANtricity OS Controller Baseboard Management Controller (BMC) - EF600A moved to Products Not Affected |
| 3.0 | 20210423 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 4.0 | 20210624 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Products Not Affected |
| 5.0 | 20210813 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Products Not Affected |
| 6.0 | 20211101 | NetApp SolidFire Baseboard Management Controller (BMC) moved to Won't Fix status |
| 7.0 | 20220106 | NetApp Cloud Backup (formerly AltaVault) moved to Won't Fix status |
| 8.0 | 20240501 | Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from git.kernel.org_4dff5026_20250114_205348.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=882213990d32fd224340a4533f6318dd152be4b2)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=882213990d32fd224340a4533f6318dd152be4b2)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=882213990d32fd224340a4533f6318dd152be4b2)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=882213990d32fd224340a4533f6318dd152be4b2)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Juergen Gross <jgross@suse.com> | 2021-02-24 16:03:08 +0100 |
| --- | --- | --- |
| committer | Juergen Gross <jgross@suse.com> | 2021-03-03 08:32:13 +0100 |
| commit | [882213990d32fd224340a4533f6318dd152be4b2](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=882213990d32fd224340a4533f6318dd152be4b2) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=882213990d32fd224340a4533f6318dd152be4b2)) | |
| tree | [17a5d1b082a1156c6fb298376703f6bbb173e809](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=882213990d32fd224340a4533f6318dd152be4b2) | |
| parent | [2991397d23ec597405b116d96de3813420bdcbc3](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2991397d23ec597405b116d96de3813420bdcbc3) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=882213990d32fd224340a4533f6318dd152be4b2&id2=2991397d23ec597405b116d96de3813420bdcbc3)) | |
| download | [linux-882213990d32fd224340a4533f6318dd152be4b2.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-882213990d32fd224340a4533f6318dd152be4b2.tar.gz) | |

xen: fix p2m size in dom0 for disabled memory hotplug caseSince commit 9e2369c06c8a18 ("xen: add helpers to allocate unpopulated
memory") foreign mappings are using guest physical addresses allocated
via ZONE\_DEVICE functionality.
This will result in problems for the case of no balloon memory hotplug
being configured, as the p2m list will only cover the initial memory
size of the domain. Any ZONE\_DEVICE allocated address will be outside
the p2m range and thus a mapping can't be established with that memory
address.
Fix that by extending the p2m size for that case. At the same time add
a check for a to be created mapping to be within the p2m limits in
order to detect errors early.
While changing a comment, remove some 32-bit leftovers.
This is XSA-369.
Fixes: 9e2369c06c8a18 ("xen: add helpers to allocate unpopulated memory")
Cc: <stable@vger.kernel.org> # 5.9
Reported-by: Marek Marczykowski-Górecki <marmarek@invisiblethingslab.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Reviewed-by: Jan Beulich <jbeulich@suse.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=882213990d32fd224340a4533f6318dd152be4b2)

| -rw-r--r-- | [arch/x86/include/asm/xen/page.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/include/asm/xen/page.h?id=882213990d32fd224340a4533f6318dd152be4b2) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/x86/xen/p2m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/xen/p2m.c?id=882213990d32fd224340a4533f6318dd152be4b2) | 10 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/x86/xen/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/xen/setup.c?id=882213990d32fd224340a4533f6318dd152be4b2) | 25 | |  |  |  | | --- | --- | --- | |

3 files changed, 21 insertions, 26 deletions

| diff --git a/arch/x86/include/asm/xen/page.h b/arch/x86/include/asm/xen/page.hindex 1a162e559753b5..7068e4bb057d9a 100644--- a/[arch/x86/include/asm/xen/page.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/include/asm/xen/page.h?id=2991397d23ec597405b116d96de3813420bdcbc3)+++ b/[arch/x86/include/asm/xen/page.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/include/asm/xen/page.h?id=882213990d32fd224340a4533f6318dd152be4b2)@@ -87,6 +87,18 @@ clear\_foreign\_p2m\_mapping(struct gnttab\_unmap\_grant\_ref \*unmap\_ops, #endif  /\*+ \* The maximum amount of extra memory compared to the base size. The+ \* main scaling factor is the size of struct page. At extreme ratios+ \* of base:extra, all the base memory can be filled with page+ \* structures for the extra memory, leaving no space for anything+ \* else.+ \*+ \* 10x seems like a reasonable balance between scaling flexibility and+ \* leaving a practically usable system.+ \*/+#define XEN\_EXTRA\_MEM\_RATIO (10)++/\* \* Helper functions to write or read unsigned long values to/from \* memory, when the access may fault. \*/diff --git a/arch/x86/xen/p2m.c b/arch/x86/xen/p2m.cindex 9545b8df531599..a3cc33091f46c1 100644--- a/[arch/x86/xen/p2m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/xen/p2m.c?id=2991397d23ec597405b116d96de3813420bdcbc3)+++ b/[arch/x86/xen/p2m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/xen/p2m.c?id=882213990d32fd224340a4533f6318dd152be4b2)@@ -416,6 +416,9 @@ void \_\_init xen\_vmalloc\_p2m\_tree(void) xen\_p2m\_last\_pfn = xen\_max\_p2m\_pfn;  p2m\_limit = (phys\_addr\_t)P2M\_LIMIT \* 1024 \* 1024 \* 1024 / PAGE\_SIZE;+ if (!p2m\_limit && IS\_ENABLED(CONFIG\_XEN\_UNPOPULATED\_ALLOC))+ p2m\_limit = xen\_start\_info->nr\_pages \* XEN\_EXTRA\_MEM\_RATIO;+ vm.flags = VM\_ALLOC; vm.size = ALIGN(sizeof(unsigned long) \* max(xen\_max\_p2m\_pfn, p2m\_limit), PMD\_SIZE \* PMDS\_PER\_MID\_PAGE);@@ -652,10 +655,9 @@ bool \_\_set\_phys\_to\_machine(unsigned long pfn, unsigned long mfn) pte\_t \*ptep; unsigned int level; - if (unlikely(pfn >= xen\_p2m\_size)) {- BUG\_ON(mfn != INVALID\_P2M\_ENTRY);- return true;- }+ /\* Only invalid entries allowed above the highest p2m covered frame. \*/+ if (unlikely(pfn >= xen\_p2m\_size))+ return mfn == INVALID\_P2M\_ENTRY;  /\* \* The interface requires atomic updates on p2m elements.diff --git a/arch/x86/xen/setup.c b/arch/x86/xen/setup.cindex 7eab14d56369d2..1a3b75652fa4f6 100644--- a/[arch/x86/xen/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/xen/setup.c?id=2991397d23ec597405b116d96de3813420bdcbc3)+++ b/[arch/x86/xen/setup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/xen/setup.c?id=882213990d32fd224340a4533f6318dd152be4b2)@@ -59,18 +59,6 @@ static struct { } xen\_remap\_buf \_\_initdata \_\_aligned(PAGE\_SIZE); static unsigned long xen\_remap\_mfn \_\_initdata = INVALID\_P2M\_ENTRY; -/\* - \* The maximum amount of extra memory compared to the base size. The- \* main scaling factor is the size of struct page. At extreme ratios- \* of base:extra, all the base memory can be filled with page- \* structures for the extra memory, leaving no space for anything- \* else.- \* - \* 10x seems like a reasonable balance between scaling flexibility and- \* leaving a practically usable system.- \*/-#define EXTRA\_MEM\_RATIO (10)- static bool xen\_512gb\_limit \_\_initdata = IS\_ENABLED(CONFIG\_XEN\_512GB);  static void \_\_init xen\_parse\_512gb(void)@@ -790,20 +778,13 @@ char \* \_\_init xen\_memory\_setup(void) extra\_pages += max\_pages - max\_pfn;  /\*- \* Clamp the amount of extra memory to a EXTRA\_MEM\_RATIO- \* factor the base size. On non-highmem systems, the base- \* size is the full initial memory allocation; on highmem it- \* is limited to the max size of lowmem, so that it doesn't- \* get completely filled.+ \* Clamp the amount of extra memory to a XEN\_EXTRA\_MEM\_RATIO+ \* factor the base size. \* \* Make sure we have no memory above max\_pages, as this area \* isn't handled by the p2m management.- \*- \* In principle there could be a problem in lowmem systems if- \* the initial memory is also very large with respect to- \* lowmem, but we won't try to deal with that here. \*/- extra\_pages = min3(EXTRA\_MEM\_RATIO \* min(max\_pfn, PFN\_DOWN(MAXMEM)),+ extra\_pages = min3(XEN\_EXTRA\_MEM\_RATIO \* min(max\_pfn, PFN\_DOWN(MAXMEM)), extra\_pages, max\_pages - max\_pfn); i = 0; addr = xen\_e820\_table.entries[0].addr; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:52:25 +0000


