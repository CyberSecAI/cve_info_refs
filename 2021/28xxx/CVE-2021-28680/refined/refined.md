Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The `devise_masquerade` gem, in versions prior to 1.3, stored the impersonating user's ID in the session cookie, without including the user's bcrypt password salt. This allowed an attacker, who knows the `secret_key_base`, to forge a "masquerade" session, and then use the "masquerade back" functionality to impersonate the original user (typically an admin), without knowing the original user's password salt.

**Weaknesses/Vulnerabilities Present:**

*   **Insecure Session Management:** The gem's implementation of masquerade functionality did not adequately protect against tampering with the session cookie. The lack of password salt in the masquerade data exposed a vulnerability to session manipulation.
*   **Dependency on Secret Key:** The vulnerability relies on the attacker knowing the `secret_key_base`. While this is a common dependency for Rails applications, it shouldn't lead to direct impersonation of users.
*   **Missing Layer of Security:** The extension removed a layer of security present in plain Devise applications which requires knowing the user's password salt to create a valid session.

**Impact of Exploitation:**

*   **User Impersonation:** An attacker could impersonate any user, including administrators, without needing their password or password salt. This would allow an attacker to gain full control of the application, depending on the permissions of the targeted user.
*   **Privilege Escalation:** By impersonating an admin, an attacker could perform actions reserved for administrators, such as modifying user data, accessing sensitive information, or taking down the application.

**Attack Vectors:**

*   **Session Cookie Manipulation:** The attacker manipulates the session cookie to inject a forged "masquerade" state by adding the `devise_masquerade_user` key and setting it to the targeted admin's ID.
*   **Web Browser:** The attacker would need to use a web browser and be able to set the manipulated cookie.

**Required Attacker Capabilities/Position:**

*   **Knowledge of `secret_key_base`:** The attacker needs to obtain the application's `secret_key_base`. This could be obtained through source code leaks, misconfigurations, or other vulnerabilities.
*   **Ability to Login as any User:** The attacker must be able to log in as a valid user on the application.
*   **User ID Knowledge:** The attacker needs to know the user ID of the target user they want to impersonate, although this is often sequential and can be bruteforced.
*   **Network access to the web application:** The attacker would need to be able to send requests to the web application.

**Additional details:**

The blog post provides a detailed step-by-step walkthrough of the attack using a vulnerable version of the demo application. It also includes a Ruby script that demonstrates how to decrypt, modify, and re-encrypt session cookies. The post also mentions that the fix was to move the masquerade data to the server's cache instead of the session cookie.