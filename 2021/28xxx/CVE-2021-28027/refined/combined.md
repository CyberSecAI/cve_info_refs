=== Content from rustsec.org_b98e3604_20250114_213407.html ===


RUSTSEC-2021-0027: bam: Loading a bgzip block can write out of bounds if size overflows. › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/bam/RUSTSEC-2021-0027.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/bam/RUSTSEC-2021-0027.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0027)

# RUSTSEC-2021-0027

Loading a bgzip block can write out of bounds if size overflows.

Reported
January 7, 2021

Issued
March 1, 2021

(last modified: June 13, 2023)

Package
[bam](/packages/bam.html)
([crates.io](https://crates.io/crates/bam))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Aliases

* [CVE-2021-28027](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-28027)
* [GHSA-cpqj-r29q-chrh](https://github.com/advisories/GHSA-cpqj-r29q-chrh)

References

* <https://gitlab.com/tprodanov/bam/-/issues/4>

CVSS Score
9.8
CRITICAL

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityHigh
IntegrityHigh
AvailabilityHigh

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
Patched

* `>=0.1.3`

Affected Functions
Version
`bam::bgzip::Block::load`

* `<0.1.3`

### Description

Affected versions of `bam` set the length of an internal buffer using
`self.compressed.set_len(block_size - HEADER_SIZE - MIN_EXTRA_SIZE)` and then
wrote into it. While `block_size` was constrained to a proper maximum, when it
was too small the subtraction could overflow negatively to a large number past
the capacity of `self.compressed`.

This can result in memory corruption in the form of writing out of bounds when
loading a `bgzip` file with a small `block_size`.

Commit `061eee38d4` fixed this issue by checking for the underflow when setting
the buffer size.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


