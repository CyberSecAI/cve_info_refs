=== Content from www.mozilla.org_9ac8834a_20250115_085503.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-52

## Security Vulnerabilities fixed in Firefox 95

Announced
December 7, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 95

#### [#CVE-2021-43536: URL leakage when navigating while executing asynchronous function](#CVE-2021-43536)

Reporter
Sunwoo Kim and Youngmin Kim of SNU CompSec Lab
Impact
high
##### Description

Under certain circumstances, asynchronous functions could have caused a navigation to fail but expose the target URL.

##### References

* [Bug 1730120](https://bugzilla.mozilla.org/show_bug.cgi?id=1730120)

#### [#CVE-2021-43537: Heap buffer overflow when using structured clone](#CVE-2021-43537)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

An incorrect type conversion of sizes from 64bit to 32bit integers allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1738237](https://bugzilla.mozilla.org/show_bug.cgi?id=1738237)

#### [#CVE-2021-43538: Missing fullscreen and pointer lock notification when requesting both](#CVE-2021-43538)

Reporter
Irvan Kurniawan (@sourc7)
Impact
high
##### Description

By misusing a race in our notification code, an attacker could have forcefully hidden the notification for pages that had received full screen and pointer lock access, which could have been used for spoofing attacks.

##### References

* [Bug 1739091](https://bugzilla.mozilla.org/show_bug.cgi?id=1739091)

#### [#CVE-2021-43539: GC rooting failure when calling wasm instance methods](#CVE-2021-43539)

Reporter
Asumu Takikawa and Ioanna Dimitriou
Impact
high
##### Description

Failure to correctly record the location of live pointers across wasm instance calls resulted in a GC occurring within the call not tracing those live pointers. This could have led to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1739683](https://bugzilla.mozilla.org/show_bug.cgi?id=1739683)

#### [#CVE-2021-4128: Use-after-free in fullscreen objects on MacOS](#CVE-2021-4128)

Reporter
Atila Butkovits
Impact
high
##### Description

When transitioning in and out of fullscreen mode, a graphics object was not correctly protected; resulting in memory corruption and a potentially exploitable crash.
*This bug only affects Firefox on MacOS. Other operating systems are unaffected.*

##### References

* [Bug 1735852](https://bugzilla.mozilla.org/show_bug.cgi?id=1735852)

#### [#CVE-2021-43540: WebExtensions could have installed persistent ServiceWorkers](#CVE-2021-43540)

Reporter
Jake Heath
Impact
moderate
##### Description

WebExtensions with the correct permissions were able to create and install ServiceWorkers for third-party websites that would not have been uninstalled with the extension.

##### References

* [Bug 1636629](https://bugzilla.mozilla.org/show_bug.cgi?id=1636629)

#### [#CVE-2021-43541: External protocol handler parameters were unescaped](#CVE-2021-43541)

Reporter
chriscla
Impact
moderate
##### Description

When invoking protocol handlers for external protocols, a supplied parameter URL containing spaces was not properly escaped.

##### References

* [Bug 1696685](https://bugzilla.mozilla.org/show_bug.cgi?id=1696685)

#### [#CVE-2021-43542: XMLHttpRequest error codes could have leaked the existence of an external protocol handler](#CVE-2021-43542)

Reporter
Raphael Smolik
Impact
moderate
##### Description

Using XMLHttpRequest, an attacker could have identified installed applications by probing error messages for loading external protocols.

##### References

* [Bug 1723281](https://bugzilla.mozilla.org/show_bug.cgi?id=1723281)

#### [#CVE-2021-43543: Bypass of CSP sandbox directive when embedding](#CVE-2021-43543)

Reporter
Armin Ebert
Impact
moderate
##### Description

Documents loaded with the CSP sandbox directive could have escaped the sandbox's script restriction by embedding additional content.

##### References

* [Bug 1738418](https://bugzilla.mozilla.org/show_bug.cgi?id=1738418)

#### [#CVE-2021-43544: Receiving a malicious URL as text through a SEND intent could have led to XSS](#CVE-2021-43544)

Reporter
Irwan
Impact
moderate
##### Description

When receiving a URL through a SEND intent, Firefox would have searched for the text, but subsequent usages of the address bar might have caused the URL to load unintentionally, which could lead to XSS and spoofing attacks.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1739934](https://bugzilla.mozilla.org/show_bug.cgi?id=1739934)

#### [#CVE-2021-43545: Denial of Service when using the Location API in a loop](#CVE-2021-43545)

Reporter
Paul Zühlcke
Impact
low
##### Description

Using the Location API in a loop could have caused severe application hangs and crashes.

##### References

* [Bug 1720926](https://bugzilla.mozilla.org/show_bug.cgi?id=1720926)

#### [#CVE-2021-43546: Cursor spoofing could overlay user interface when native cursor is zoomed](#CVE-2021-43546)

Reporter
Daniel Veditz
Impact
low
##### Description

It was possible to recreate previous cursor spoofing attacks against users with a zoomed native cursor.

##### References

* [Bug 1737751](https://bugzilla.mozilla.org/show_bug.cgi?id=1737751)

#### [#CVE-2021-4129: Memory safety bugs fixed in Firefox 95 and Firefox ESR 91.4](#CVE-2021-4129)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Julian Hector, Randell Jesup, Gabriele Svelto, Tyson Smith, Christian Holler, and Masayuki Nakano reported memory safety bugs present in Firefox 94. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 95](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1393362%2C1736046%2C1736751%2C1737009%2C1739372%2C1739421)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_00b84c86_20250115_085503.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1735852)
* [XML](/show_bug.cgi?ctype=xml&id=1735852)

Closed
[Bug 1735852](/show_bug.cgi?id=1735852)
(CVE-2021-4128)

Opened 3 years ago
Closed 3 years ago

# Intermittent [tier2] dom/html/test/test\_fullscreen-api-race.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Intermittent [tier2] dom/html/test/test\_fullscreen-api-race.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S4

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected) |
| firefox93 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=unaffected) |
| firefox94 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix) |
| firefox95 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed) |
| firefox96 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox93 |  | unaffected |
| firefox94 |  | wontfix |
| firefox95 |  | fixed |
| firefox96 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: intermittent-bug-filer, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5c4fd708e5516a59b5bc1d7ced90f15f?d=mm&size=40)  [intermittent-bug-filer](/user_profile?user_id=573381)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1731947](/show_bug.cgi?id=1731947 "RESOLVED DUPLICATE - Intermittent [tier 2] dom/html/test/test_fullscreen-api.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main95+r])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-4128

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[intermittent-failure](/buglist.cgi?keywords=intermittent-failure&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main95+r]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [noni](/user_profile?user_id=458186) | [qe-verify](#a1875165_458186 "3 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ nsCocoaWindow::DoMakeFullScreen(bool, bool) ]](https://crash-stats.mozilla.org/signature/?signature=nsCocoaWindow%3A%3ADoMakeFullScreen%28bool%2C%20bool%29)

[[@ mozilla::layers::NativeLayerRootCA::SetWindowIsFullscreen ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Alayers%3A%3ANativeLayerRootCA%3A%3ASetWindowIsFullscreen)

[[@ mozilla::detail::InvalidArrayIndex\_CRASH | mozilla::layers::NativeLayerRootCA::SetWindowIsFullscreen ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adetail%3A%3AInvalidArrayIndex_CRASH%20%7C%20mozilla%3A%3Alayers%3A%3ANativeLayerRootCA%3A%3ASetWindowIsFullscreen)

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Treeherder Bug Filer](/user_profile?user_id=573381)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1735852#c0)• 3 years ago |
| treeherder | |

**Filed by:** abutkovits [at] mozilla.com

**Parsed log:** <https://treeherder.mozilla.org/logviewer?job_id=354790877&repo=autoland>

**Full log:** <https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/c-QOWpJGSve-mABLJfp9rw/runs/0/artifacts/public/logs/live_backing.log>

---

```
[task 2021-10-14T16:01:32.132Z] 16:01:32     INFO - mozcrash Downloading symbols from: https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/aOTiTtrfTxqINuQO_UGaYw/artifacts/public/build/target.crashreporter-symbols.zip
[task 2021-10-14T16:01:36.540Z] 16:01:36     INFO - mozcrash Copy/paste: /opt/worker/tasks/task_163422606348914/fetches/minidump_stackwalk/minidump_stackwalk /var/folders/db/3zrknqk954d_sn2t59z8ydsh000014/T/tmpqbxfdjr1.mozrunner/minidumps/9A84A0AB-EB47-447A-ABF4-356050F5767C.dmp /var/folders/db/3zrknqk954d_sn2t59z8ydsh000014/T/tmp0647css6
[task 2021-10-14T16:01:42.137Z] 16:01:42     INFO - mozcrash Saved minidump as /opt/worker/tasks/task_163422606348914/build/blobber_upload_dir/9A84A0AB-EB47-447A-ABF4-356050F5767C.dmp
[task 2021-10-14T16:01:42.137Z] 16:01:42     INFO - mozcrash Saved app info as /opt/worker/tasks/task_163422606348914/build/blobber_upload_dir/9A84A0AB-EB47-447A-ABF4-356050F5767C.extra
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO - PROCESS-CRASH | dom/html/test/test_fullscreen-api-race.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO - Crash dump filename: /var/folders/db/3zrknqk954d_sn2t59z8ydsh000014/T/tmpqbxfdjr1.mozrunner/minidumps/9A84A0AB-EB47-447A-ABF4-356050F5767C.dmp
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO - Operating system: Mac OS X
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO -                   10.15.7 19H524
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO - CPU: amd64
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO -      family 6 model 158 stepping 10
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO -      12 CPUs
[task 2021-10-14T16:01:42.516Z] 16:01:42     INFO -
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO - GPU: UNKNOWN
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO - Crash reason:  EXC_BAD_ACCESS / EXC_I386_GPFLT
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO - Crash address: 0x0
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO - Process uptime: 87 seconds
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO - Thread 0 tid 775 (crashed) - GeckoMain 0  XUL!mozilla::layers::NativeLayerRootCA::SetWindowIsFullscreen(bool) [NativeLayerCA.mm:68f5bca6b432346740523a54babd677e6a08ae1a : 479 + 0x1c]
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rax = 0x000000012b8dddd0   rdx = 0x0000000117fcbca8
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rcx = 0x0000000000000001   rbx = 0xe5e5e5e5e5e5e5e5
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rsi = 0x00000000e5e5e5e5   rdi = 0x0000000120cb5520
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rbp = 0x00007ffee8561be0   rsp = 0x00007ffee8561bc0
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -      r8 = 0x0000000000000002    r9 = 0x0000000100000000
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     r10 = 0x0000000117fcbca8   r11 = 0x00000001145b8810
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     r12 = 0x0000000000000007   r13 = 0x000000010c30b600
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     r14 = 0x000000012a85fee0   r15 = 0x0000000000000004
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rip = 0x0000000112fa22e3
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     Found by: given as instruction pointer in context
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -  1  XUL!nsCocoaWindow::DoMakeFullScreen(bool, bool) [nsCocoaWindow.mm:68f5bca6b432346740523a54babd677e6a08ae1a : 1675 + 0x17]
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee8561c10
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rsp = 0x00007ffee8561bf0   r12 = 0x0000000000000000
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     r13 = 0x000000010c30b600   r14 = 0x0000000000000000
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     r15 = 0x000000010c30b600   rip = 0x00000001145ed81b
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -  2  XUL!nsGlobalWindowOuter::SetWidgetFullscreen(FullscreenReason, bool, nsIWidget*, nsIScreen*) [nsGlobalWindowOuter.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 4654 + 0x6]
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rbx = 0x0000000107949bc0   rbp = 0x00007ffee8561c60
[task 2021-10-14T16:01:42.517Z] 16:01:42     INFO -     rsp = 0x00007ffee8561c20   r12 = 0x0000000000000002
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r13 = 0x000000010c30b600   r14 = 0x0000000000000000
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r15 = 0x0000000000000000   rip = 0x00000001130d2e6c
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -  3  XUL!MakeWidgetFullscreen(nsGlobalWindowOuter*, FullscreenReason, bool) [nsGlobalWindowOuter.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 4509 + 0x15]
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rbx = 0x0000000107949bc0   rbp = 0x00007ffee8561d10
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rsp = 0x00007ffee8561c70   r12 = 0x0000000000000002
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r13 = 0x0000000107949be0   r14 = 0x000000010c30b600
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r15 = 0x0000000000000000   rip = 0x00000001130d35ee
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -  4  XUL!nsGlobalWindowOuter::SetFullscreenInternal(FullscreenReason, bool) [nsGlobalWindowOuter.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 4601 + 0xd]
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee8561d80
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rsp = 0x00007ffee8561d20   r12 = 0x0000000000000000
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r13 = 0x0000000107949be0   r14 = 0x0000000107949bc0
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r15 = 0x0000000000000002   rip = 0x00000001130d289a
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -  5  XUL!mozilla::dom::ExitFullscreenScriptRunnable::Run() [Document.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 14134 + 0x10]
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rbx = 0x00000001618deb50   rbp = 0x00007ffee8561db0
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rsp = 0x00007ffee8561d90   r12 = 0x00007ffee8561e68
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r13 = 0x00007ffee8561e78   r14 = 0x00000001618deb50
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r15 = 0x00000001618deb50   rip = 0x0000000113149cd7
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -  6  XUL!nsContentUtils::AddScriptRunner(already_AddRefed<nsIRunnable>) [nsContentUtils.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 5757 + 0x9]
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rbx = 0x0000000121414000   rbp = 0x00007ffee8561e40
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     rsp = 0x00007ffee8561dc0   r12 = 0x00007ffee8561e68
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r13 = 0x00007ffee8561e78   r14 = 0x00000001618deb50
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     r15 = 0x00000001618deb50   rip = 0x0000000110f15e9b
[task 2021-10-14T16:01:42.518Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -  7  XUL!mozilla::dom::Document::ExitFullscreenInDocTree(mozilla::dom::Document*) [Document.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 14188 + 0x8]
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rbx = 0x0000000121414000   rbp = 0x00007ffee8561eb0
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rsp = 0x00007ffee8561e50   r12 = 0x00007ffee8561e68
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r13 = 0x00007ffee8561e78   r14 = 0x0000000121414000
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r15 = 0x00000001618deb50   rip = 0x0000000113127659
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -  8  XUL!mozilla::dom::Document::OnPageHide(bool, mozilla::dom::EventTarget*, bool) [Document.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 11731 + 0x8]
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee8561f30
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rsp = 0x00007ffee8561ec0   r12 = 0x00007ffee8561ee0
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r13 = 0x0000000121414000   r14 = 0x0000000001040200
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r15 = 0x00007ffee8561ef0   rip = 0x0000000110f96cb9
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -  9  XUL!nsDocumentViewer::PageHide(bool) [nsDocumentViewer.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 1389 + 0x15]
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rbx = 0x000022d7708992e0   rbp = 0x00007ffee8562020
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rsp = 0x00007ffee8561f40   r12 = 0x0000000000000000
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r13 = 0x0000000000000001   r14 = 0x0000000000000001
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r15 = 0x000000010ea2e640   rip = 0x0000000111556671
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO - 10  XUL!nsDocShell::FirePageHideNotificationInternal(bool, bool) [nsDocShell.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 1119 + 0x10]
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee85620e0
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     rsp = 0x00007ffee8562030   r12 = 0x0000000000000001
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r13 = 0x0000000000000001   r14 = 0x000000010ea2e640
[task 2021-10-14T16:01:42.519Z] 16:01:42     INFO -     r15 = 0x000000012ae7f800   rip = 0x00000001117e5d00
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO - 11  XUL!nsDocShell::Destroy() [nsDocShell.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 4409 + 0xf]
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rbx = 0x0000000123946c00   rbp = 0x00007ffee8562130
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rsp = 0x00007ffee85620f0   r12 = 0x00007ffee85620f8
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r13 = 0x000000012ae7f800   r14 = 0x000000010b2c9b40
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r15 = 0x000000012ae7f990   rip = 0x00000001117e1cc0
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO - 12  XUL!mozilla::AppWindow::Destroy() [AppWindow.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 632 + 0xa]
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rbx = 0x0000000123946c00   rbp = 0x00007ffee8562190
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rsp = 0x00007ffee8562140   r12 = 0x000000010e129700
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r13 = 0x0000000000000003   r14 = 0x000000010e129710
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r15 = 0x0000000121799470   rip = 0x0000000111804390
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO - 13  XUL!{virtual override thunk({offset(-8)}, nsChromeTreeOwner::Destroy())} + 0x12
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rbx = 0x000000010b27f308   rbp = 0x00007ffee85621a0
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rsp = 0x00007ffee85621a0   r12 = 0x00000001209cdc00
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r13 = 0x0000000000000003   r14 = 0x0000000107949bc0
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r15 = 0x000000011800da50   rip = 0x0000000115160212
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO - 14  XUL!nsGlobalWindowOuter::ReallyCloseWindow() [nsGlobalWindowOuter.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 6356 + 0x9]
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rbx = 0x000000010b27f308   rbp = 0x00007ffee85621c0
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     rsp = 0x00007ffee85621b0   r12 = 0x00000001209cdc00
[task 2021-10-14T16:01:42.520Z] 16:01:42     INFO -     r13 = 0x0000000000000003   r14 = 0x0000000107949bc0
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r15 = 0x000000011800da50   rip = 0x00000001130d88eb
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO - 15  XUL!nsCloseEvent::Run() [nsGlobalWindowOuter.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 6157 + 0x5]
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rbx = 0x000000000000000c   rbp = 0x00007ffee85621d0
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rsp = 0x00007ffee85621d0   r12 = 0x00000001209cdc00
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r13 = 0x0000000000000003   r14 = 0x000000012a044040
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r15 = 0x000000011800da50   rip = 0x00000001130da78b
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO - 16  XUL!mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [TaskController.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 770 + 0x263]
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rbx = 0x000000000000000c   rbp = 0x00007ffee85627f0
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rsp = 0x00007ffee85621e0   r12 = 0x00000001209cdc00
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r13 = 0x0000000000000003   r14 = 0x000000012a044040
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r15 = 0x000000011800da50   rip = 0x000000011087cb76
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO - 17  XUL!nsThread::ProcessNextEvent(bool, bool*) [nsThread.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 1151 + 0x3f]
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rbx = 0x00007ffee85629f0   rbp = 0x00007ffee8562a70
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     rsp = 0x00007ffee8562800   r12 = 0x0000000107955900
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r13 = 0x000000010b259040   r14 = 0x000000010b27adf0
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     r15 = 0x000000010b259040   rip = 0x000000011088bfb8
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.521Z] 16:01:42     INFO - 18  XUL!NS_ProcessPendingEvents(nsIThread*, unsigned int) [nsThreadUtils.cpp:68f5bca6b432346740523a54babd677e6a08ae1a : 432 + 0x1e]
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee8562ac0
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rsp = 0x00007ffee8562a80   r12 = 0x00007ffee8562a8f
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     r13 = 0x000000010b259040   r14 = 0x000000011088b8f0
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     r15 = 0x00000000001302ed   rip = 0x000000011088939b
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO - 19  XUL!nsAppShell::ProcessGeckoEvents(void*) [nsAppShell.mm:68f5bca6b432346740523a54babd677e6a08ae1a : 500 + 0x50]
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rbx = 0x0000000000000000   rbp = 0x00007ffee8562b20
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rsp = 0x00007ffee8562ad0   r12 = 0x0000000000000001
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     r13 = 0x000000010b2c1920   r14 = 0x000000010b259040
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     r15 = 0x0000000600002e00   rip = 0x000000011147189a
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO - 20  CoreFoundation!__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 0x11
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rbx = 0x0000000111471790   rbp = 0x00007ffee8562b30
[task 2021-10-14T16:01:42.522Z] 16:01:42     INFO -     rsp = 0x00007ffee8562b30   r12 = 0x0000000000000001
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     r13 = 0x0000000000002c01   r14 = 0x000000010b2c1920
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     r15 = 0x0000000600002e88   rip = 0x00007fff340fdd52
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO - 21  CoreFoundation!__CFRunLoopDoSource0 + 0x67
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rbp = 0x00007ffee8562b60   rsp = 0x00007ffee8562b40
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rip = 0x00007fff340fdcf1
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO - 22  CoreFoundation!__CFRunLoopDoSources0 + 0xd1
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rbp = 0x00007ffee8562bd0   rsp = 0x00007ffee8562b70
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rip = 0x00007fff340fdb0b
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO - 23  CoreFoundation!__CFRunLoopRun + 0x39f
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rbp = 0x00007ffee85638e0   rsp = 0x00007ffee8562be0
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rip = 0x00007fff340fc83a
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO - 24  CoreFoundation!CFRunLoopRunSpecific + 0x1ce
[task 2021-10-14T16:01:42.523Z] 16:01:42     INFO -     rbp = 0x00007ffee8563970   rsp = 0x00007ffee85638f0
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rip = 0x00007fff340fbe3e
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO - 25  HIToolbox!RunCurrentEventLoopInMode + 0x124
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rbp = 0x00007ffee85639c0   rsp = 0x00007ffee8563980
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rip = 0x00007fff32d28abd
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO - 26  HIToolbox!ReceiveNextEventCommon + 0x248
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rbx = 0x0000000000000001   rbp = 0x00007ffee8563a40
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rsp = 0x00007ffee85639d0   r12 = 0x0000000000000000
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     r13 = 0x0000000000000000   r14 = 0x0000000000000000
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     r15 = 0x00000000ffffd96d   rip = 0x00007fff32d287d5
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO - 27  HIToolbox!_BlockUntilNextEventMatchingListInModeWithFilter + 0x40
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rbx = 0xffffffffffffffff   rbp = 0x00007ffee8563a60
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     rsp = 0x00007ffee8563a50   r12 = 0x0000000000000001
[task 2021-10-14T16:01:42.524Z] 16:01:42     INFO -     r13 = 0x0000000000000000   r14 = 0x00007fff948ad4c0
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     r15 = 0x00007fff8b9b0b00   rip = 0x00007fff32d28579
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO - 28  AppKit!_DPSNextEvent + 0x373
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rbx = 0xffffffffffffffff   rbp = 0x00007ffee8563e60
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rsp = 0x00007ffee8563a70   r12 = 0x0000000000000001
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     r13 = 0x0000000000000000   r14 = 0x00007fff948ad4c0
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     r15 = 0x00007fff8b9b0b00   rip = 0x00007fff3136e039
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO - 29  AppKit!-[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] + 0x548
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rbp = 0x00007ffee85640c0   rsp = 0x00007ffee8563e70
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rip = 0x00007fff3136c880
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO - 30  XUL!-[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] [nsAppShell.mm:68f5bca6b432346740523a54babd677e6a08ae1a : 173 + 0x25]
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rbp = 0x00007ffee8564130   rsp = 0x00007ffee85640d0
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rip = 0x0000000111470e11
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO - 31  AppKit!-[NSApplication run] + 0x292
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rbx = 0x000000010794e2f0   rbp = 0x00007ffee85641f0
[task 2021-10-14T16:01:42.525Z] 16:01:42     INFO -     rsp = 0x00007ffee8564140   r12 = 0x000000012afdebb0
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     r13 = 0x00007fff6ce4f800   r14 = 0x0000000000000000
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     r15 = 0x000000011ed16880   rip = 0x00007fff3135e58e
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     Found by: call frame info
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO - 32  XUL!nsAppShell::Run() [nsAppShell.mm:68f5bca6b432346740523a54babd677e6a08ae1a : 792 + 0x1a]
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     rbp = 0x00007ffee8564220   rsp = 0x00007ffee8564200
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     rip = 0x000000011147206b
[task 2021-10-14T16:01:42.526Z] 16:01:42     INFO -     Found by: previous frame's frame pointer
....

```

|  | [Atila Butkovits](/user_profile?user_id=661920) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a334_661920)• 3 years ago |

Group: core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1735852#c1)• 3 years ago |
|  | |

The actual crash is on a null value, but there are a few poison-y values in the registers. The crash looks like it is happening at the interface between DOM and Widget code. The crash is happening during test\_fullscreen-api-race.html which I guess does seem like something that could cause a crash like this.

Group: core-security → dom-core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1735852#c2)• 3 years ago |
|  | |

Edgar, do you think there's anything actionable here? Thanks.

Flags: needinfo?(echen)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1735852#c3)• 3 years ago |
|  | |

There appear to be a very small number of crashes in the wild, for example

[bp-f3041bef-ff33-45ce-9709-c31d50210928](https://crash-stats.mozilla.org/report/index/f3041bef-ff33-45ce-9709-c31d50210928)

[bp-13299d9f-aee2-4c3f-bee8-8321f0211022](https://crash-stats.mozilla.org/report/index/13299d9f-aee2-4c3f-bee8-8321f0211022)

Crash Signature: [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)] → [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]
[@ mozilla::layers::NativeLayerRootCA::SetWindowIsFullscreen ]
[@ mozilla::detail::InvalidArrayIndex\_CRASH | mozilla::layers::NativeLayerRootCA::SetWindowIsFullscreen ]Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1735852#c5)• 3 years ago |
|  | |

I think this is a regression of [bug 1653417](/show_bug.cgi?id=1653417 "RESOLVED FIXED - [meta] Use AVSampleBufferDisplayLayer to display video frames on macOS") which introduces <https://searchfox.org/mozilla-central/rev/4f9bbbe5487da6d1c3680488e016f7bb0cbaa128/gfx/layers/NativeLayerCA.mm#541>. Seems like someone changes `mSublayers` (maybe from a different thread?) while we iterate it.

Hi Brad, is this something that would be also fixed by [bug 1731956](/show_bug.cgi?id=1731956 "RESOLVED FIXED - Intermittent dom/html/test/test_fullscreen-api-race.html | application crashed [@ mozilla::layers::NativeLayerCA::~NativeLayerCA()]") which adds a mutex lock in <https://searchfox.org/mozilla-central/rev/4f9bbbe5487da6d1c3680488e016f7bb0cbaa128/gfx/layers/NativeLayerCA.mm#536>?

Flags: needinfo?(echen) → needinfo?(bwerth)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a1736728_406194)• 3 years ago |

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected)
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected)
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected)

|  | [Brad Werth [:bradwerth] | Out until Feb 2025](/user_profile?user_id=571010) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1735852#c6)• 3 years ago |
|  | |

(In reply to Edgar Chen [:edgar] from [comment #5](/show_bug.cgi?id=1735852#c5 "RESOLVED FIXED - Intermittent [tier2] dom/html/test/test_fullscreen-api-race.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]"))

> I think this is a regression of [bug 1653417](/show_bug.cgi?id=1653417 "RESOLVED FIXED - [meta] Use AVSampleBufferDisplayLayer to display video frames on macOS") which introduces <https://searchfox.org/mozilla-central/rev/4f9bbbe5487da6d1c3680488e016f7bb0cbaa128/gfx/layers/NativeLayerCA.mm#541>. Seems like someone changes `mSublayers` (maybe from a different thread?) while we iterate it.
>
> Hi Brad, is this something that would be also fixed by [bug 1731956](/show_bug.cgi?id=1731956 "RESOLVED FIXED - Intermittent dom/html/test/test_fullscreen-api-race.html | application crashed [@ mozilla::layers::NativeLayerCA::~NativeLayerCA()]") which adds a mutex lock in <https://searchfox.org/mozilla-central/rev/4f9bbbe5487da6d1c3680488e016f7bb0cbaa128/gfx/layers/NativeLayerCA.mm#536>?

Yes, [Bug 1731956](/show_bug.cgi?id=1731956 "RESOLVED FIXED - Intermittent dom/html/test/test_fullscreen-api-race.html | application crashed [@ mozilla::layers::NativeLayerCA::~NativeLayerCA()]") and [Bug 1736446](/show_bug.cgi?id=1736446 "RESOLVED FIXED - NativeLayerCA should consistently protect member variable access with a lock") should have resolved this. I've been keeping an eye on the crash signature to ensure that it's not reoccurring.

Flags: needinfo?(bwerth)

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1735852#c7)• 3 years ago |
|  | |

Thanks! Close per [comment 6](/show_bug.cgi?id=1735852#c6 "RESOLVED FIXED - Intermittent [tier2] dom/html/test/test_fullscreen-api-race.html | application crashed [@ nsCocoaWindow::DoMakeFullScreen(bool, bool)]").

Status: NEW → RESOLVEDClosed: 3 years agoComponent: DOM: Core & HTML → GraphicsResolution: --- → FIXED

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a1737475_406194)• 3 years ago |

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix)
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed)
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a1741052_75935)• 3 years ago |

Group: dom-core-security → core-security-release
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=unaffected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a1875165_458186)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a4213397_428608)• 3 years ago |

Whiteboard: [adv-main95+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a4220581_428608)• 3 years ago |

Whiteboard: [adv-main95+] → [adv-main95+r]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a5441140_578488)• 3 years ago |

Alias: CVE-2021-4128

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1735852#a27348055_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1735852&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑


