=== Content from lkml.org_b72d0ec6_20250114_191500.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2021]](/lkml/2021) Â  [[Oct]](/lkml/2021/10) Â  [[18]](/lkml/2021/10/18) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2021/10/18/485)Â  [[forward]](/lkml/bounce/2021/10/18/485)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2021/10/18/485) * [Zqiang](/lkml/2021/10/18/521)   + [Matthew Wilcox](/lkml/2021/10/18/521)     - [Zqiang](/lkml/2021/10/25/214)       * [Jens Axboe](/lkml/2021/10/25/603)  Patch in this message  * [Get diff 1](/lkml/diff/2021/10/18/485/1) | / | | | From | Zqiang <> | | --- | --- | | Subject | [PATCH v3] block: fix incorrect references to disk objects | | Date | Mon, 18 Oct 2021 19:58:07 +0800 | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` When adding partitions to the disk, the reference count of the diskobject is increased. then alloc partition device and calleddevice_add(), if the device_add() return error, the referencecount of the disk object will be reduced twice, at put_device(pdev)and put_disk(disk). this leads to the end of the object's life cycleprematurely, and trigger following calltrace.  __init_work+0x2d/0x50 kernel/workqueue.c:519  synchronize_rcu_expedited+0x3af/0x650 kernel/rcu/tree_exp.h:847  bdi_remove_from_list mm/backing-dev.c:938 [inline]  bdi_unregister+0x17f/0x5c0 mm/backing-dev.c:946  release_bdi+0xa1/0xc0 mm/backing-dev.c:968  kref_put include/linux/kref.h:65 [inline]  bdi_put+0x72/0xa0 mm/backing-dev.c:976  bdev_free_inode+0x11e/0x220 block/bdev.c:408  i_callback+0x3f/0x70 fs/inode.c:226  rcu_do_batch kernel/rcu/tree.c:2508 [inline]  rcu_core+0x76d/0x16c0 kernel/rcu/tree.c:2743  __do_softirq+0x1d7/0x93b kernel/softirq.c:558  invoke_softirq kernel/softirq.c:432 [inline]  __irq_exit_rcu kernel/softirq.c:636 [inline]  irq_exit_rcu+0xf2/0x130 kernel/softirq.c:648  sysvec_apic_timer_interrupt+0x93/0xc0Return directly after calling the put_device().Reported-by: Hao Sun <sunhao.th@gmail.com>Signed-off-by: Zqiang <qiang.zhang1211@gmail.com>--- v1->v2: directly returning instead of assigning disk to NULL v2->v3: modify description information block/partitions/core.c | 1 + 1 file changed, 1 insertion(+)diff --git a/block/partitions/core.c b/block/partitions/core.cindex 9dbddc355b40..ed5deef1d7e1 100644--- a/block/partitions/core.c+++ b/block/partitions/core.c@@ -424,6 +424,7 @@ static struct block_device *add_partition(struct gendisk *disk, int partno, 	device_del(pdev); out_put: 	put_device(pdev);+	return ERR_PTR(err); out_put_disk: 	put_disk(disk); 	return ERR_PTR(err);-- 2.17.1 ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2021-10-18 13:59 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from bugzilla.redhat.com_8ea857f7_20250114_191459.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2025938)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2025938)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2025938)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2025938

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2025938**](show_bug.cgi?id=2025938)
(CVE-2021-4150)
- [CVE-2021-4150](https://access.redhat.com/security/cve/CVE-2021-4150) kernel: Block subsystem mishandles reference counts

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-4150 kernel: Block subsystem mishandles reference counts

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-4150 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2026492](show_bug.cgi?id=2026492) [2034666](show_bug.cgi?id=2034666) | | TreeView+ | [depends on](buglist.cgi?bug_id=2025938&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2025938&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-11-23 12:40 UTC by Pedro Sampaio | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-01-18 07:30 UTC ([History](show_activity.cgi?id=2025938)) | | [CC List:](page.cgi?id=fields.html#cclist) | 42 users (show)  acaringi adscvr airlied alciregi bhu brdeoliv bskeggs chwhite crwood dhoward dvlasenk fhrbata fpacheco hdegoede hkrzesin jarod jarodwilson jburrell jeremy jforbes jglisse jlelli jonathan josef jshortt jstancek jwboyer kcarcia kernel-maint kernel-mgr lgoncalv linville masami256 mchehab nmurray ptalbert qzhao rvrbovsk steved vkumar walters williams | | Fixed In Version: | kernel 5.15 rc7 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A use-after-free flaw was found in the add\_partition in block/partitions/core.c in the Linux kernel. A local attacker with user privileges could cause a denial of service on the system. The issue results from the lack of code cleanup when device\_add call fails when adding a partition to the disk. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-01-18 07:30:39 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2025938#c0)  Pedro Sampaio    2021-11-23 12:40:45 UTC  ``` The block subsystem in the Linux kernel before 5.14 mishandles reference counts, which allows local users to cause a denial of service (use-after-free) or possibly have unspecified other impacts via a crafted user space program related to the disk object reference count.  References:  <https://lkml.org/lkml/2021/9/6/781> <https://lkml.org/lkml/2021/10/18/485>   ```  [Comment 5](show_bug.cgi?id=2025938#c5)  Product Security DevOps Team    2022-01-18 07:30:35 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2021-4150>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2025938&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_bb2a7f49_20250115_114141.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from lkml.org_1a9c601f_20250114_191501.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2021]](/lkml/2021) Â  [[Sep]](/lkml/2021/9) Â  [[6]](/lkml/2021/9/6) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2021/9/6/781)Â  [[forward]](/lkml/bounce/2021/9/6/781)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2021/9/6/781) * [Hao Sun](/lkml/2021/10/13/1529)   + [Hao Sun](/lkml/2021/10/13/1529)     - [Zqiang](/lkml/2021/10/18/27)       * [Christoph Hellwig](/lkml/2021/10/18/29)         + [Zqiang](/lkml/2021/10/18/141) | / | | | From | Hao Sun <> | | --- | --- | | Date | Tue, 7 Sep 2021 09:22:03 +0800 | | Subject | WARNING in \_\_init\_work | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` Hello,When using Healer to fuzz the latest Linux kernel, the following crashwas triggered.HEAD commit: 27151f177827 Merge tag 'perf-tools-for-v5.15-2021-09-04'git tree: upstreamconsole output:<https://drive.google.com/file/d/1M5oyA_IcWSDB2XpnoX8SDmKJA3JhKltz/view?usp=sharing>kernel config: <https://drive.google.com/file/d/1ZMVJ2vNe0EiIEeWNVyrGb7hBdOG5Uj3e/view?usp=sharing>C reproducer: <https://drive.google.com/file/d/1AtDNXl8XEBfglKXsKsAH2NuXBcrp8Zp9/view?usp=sharing>Syzlang reproducer:<https://drive.google.com/file/d/1R_XD_cyMNS0Q_SGSqomRy_LIClOrd-gI/view?usp=sharing>If you fix this issue, please add the following tag to the commit:Reported-by: Hao Sun <sunhao.th@gmail.com>ODEBUG: object ffffc9000073cda0 is NOT on stack ffffc90005f34000, but annotated.------------[ cut here ]------------WARNING: CPU: 2 PID: 27648 at lib/debugobjects.c:548debug_object_is_on_stack lib/debugobjects.c:545 [inline]WARNING: CPU: 2 PID: 27648 at lib/debugobjects.c:548__debug_object_init+0x224/0x520 lib/debugobjects.c:607Modules linked in:CPU: 2 PID: 27648 Comm: syz-executor Not tainted 5.14.0+ #13Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOSrel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014RIP: 0010:debug_object_is_on_stack lib/debugobjects.c:545 [inline]RIP: 0010:__debug_object_init+0x224/0x520 lib/debugobjects.c:607Code: 84 ca fe ff ff 83 c0 01 4c 89 f6 48 c7 c7 f8 b0 3c 85 89 05 7ec2 56 06 65 48 8b 04 25 40 70 01 00 48 8b 50 20 e8 05 9b f5 01 <0f> 0be9 9e fe ff ff 89 05 87 4d e3 03 e9 c4 fe ff ff 48 c7 c7 e0RSP: 0018:ffffc9000073ccf0 EFLAGS: 00010282RAX: 0000000000000050 RBX: ffff88810cf2f398 RCX: 0000000000000100RDX: 0000000000000000 RSI: ffffffff812cf85c RDI: 00000000ffffffffRBP: ffffffff88868538 R08: 0000000000000000 R09: 0000000000000001R10: ffffc9000073cc80 R11: 0000000000000005 R12: 0000000000000203R13: 0000000000054450 R14: ffffc9000073cda0 R15: ffff88807dd264f0FS:  0000000002ad0940(0000) GS:ffff88807dd00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00000000005061ec CR3: 0000000100da5000 CR4: 0000000000750ee0DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400PKRU: 55555554Call Trace: <IRQ> __init_work+0x3f/0x50 kernel/workqueue.c:519 synchronize_rcu_expedited+0x26a/0x460 kernel/rcu/tree_exp.h:847 bdi_remove_from_list mm/backing-dev.c:938 [inline] bdi_unregister+0x97/0x270 mm/backing-dev.c:946 release_bdi+0x4a/0x70 mm/backing-dev.c:968 kref_put include/linux/kref.h:65 [inline] bdi_put+0x47/0x70 mm/backing-dev.c:976 bdev_free_inode+0x59/0xc0 fs/block_dev.c:819 i_callback+0x24/0x50 fs/inode.c:224 rcu_do_batch kernel/rcu/tree.c:2508 [inline] rcu_core+0x2d6/0x9f0 kernel/rcu/tree.c:2743 __do_softirq+0xe9/0x561 kernel/softirq.c:558 invoke_softirq kernel/softirq.c:432 [inline] __irq_exit_rcu kernel/softirq.c:636 [inline] irq_exit_rcu+0xe2/0x100 kernel/softirq.c:648 sysvec_apic_timer_interrupt+0x9e/0xc0 arch/x86/kernel/apic/apic.c:1097 </IRQ> asm_sysvec_apic_timer_interrupt+0x12/0x20 arch/x86/include/asm/idtentry.h:638RIP: 0010:__sanitizer_cov_trace_pc+0x37/0x60 kernel/kcov.c:197Code: 65 48 8b 14 25 40 70 01 00 81 e1 00 01 00 00 a9 00 01 ff 00 740e 85 c9 74 35 8b 82 34 15 00 00 85 c0 74 2b 8b 82 10 15 00 00 <83> f802 75 20 48 8b 8a 18 15 00 00 8b 92 14 15 00 00 48 8b 01 48RSP: 0018:ffffc90005f37b78 EFLAGS: 00000246RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000000000RDX: ffff888109448000 RSI: ffffffff8212a28c RDI: ffffc90005f37d30RBP: 0000000000000006 R08: 0000000000000d40 R09: ffff8880165fc5e0R10: ffffc90005f37cd0 R11: 0000000000000003 R12: 0000000000000375R13: ffff888107597b40 R14: ffffc90005f37d30 R15: ffff8880174b0ea0 tomoyo_domain_quota_is_ok+0xac/0x150 security/tomoyo/util.c:1092 tomoyo_supervisor+0x228/0x7f0 security/tomoyo/common.c:2089 tomoyo_audit_path_log security/tomoyo/file.c:168 [inline] tomoyo_path_permission+0xa0/0xf0 security/tomoyo/file.c:587 tomoyo_path_perm+0x22f/0x2d0 security/tomoyo/file.c:838 tomoyo_path_symlink+0x43/0x70 security/tomoyo/tomoyo.c:199 security_path_symlink+0x48/0x80 security/security.c:1164 do_symlinkat+0x75/0x120 fs/namei.c:4274 __do_sys_symlink fs/namei.c:4301 [inline] __se_sys_symlink fs/namei.c:4299 [inline] __x64_sys_symlink+0x3a/0x40 fs/namei.c:4299 do_syscall_x64 arch/x86/entry/common.c:50 [inline] do_syscall_64+0x34/0xb0 arch/x86/entry/common.c:80 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP: 0033:0x46a597Code: 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48 83 c8 ff c3 662e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 b8 58 00 00 00 0f 05 <48> 3d01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48RSP: 002b:00007ffd09085778 EFLAGS: 00000206 ORIG_RAX: 0000000000000058RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 000000000046a597RDX: 0000000000000000 RSI: 00000000004e40f9 RDI: 00007ffd09085810RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000014R10: 0000000000000000 R11: 0000000000000206 R12: 0000000000000000R13: 0000000000000000 R14: 00007ffd09085810 R15: 00007ffd090857cc----------------Code disassembly (best guess):   0: 65 48 8b 14 25 40 70 mov    %gs:0x17040,%rdx   7: 01 00   9: 81 e1 00 01 00 00    and    $0x100,%ecx   f: a9 00 01 ff 00        test   $0xff0100,%eax  14: 74 0e                je     0x24  16: 85 c9                test   %ecx,%ecx  18: 74 35                je     0x4f  1a: 8b 82 34 15 00 00    mov    0x1534(%rdx),%eax  20: 85 c0                test   %eax,%eax  22: 74 2b                je     0x4f  24: 8b 82 10 15 00 00    mov    0x1510(%rdx),%eax* 2a: 83 f8 02              cmp    $0x2,%eax <-- trapping instruction  2d: 75 20                jne    0x4f  2f: 48 8b 8a 18 15 00 00 mov    0x1518(%rdx),%rcx  36: 8b 92 14 15 00 00    mov    0x1514(%rdx),%edx  3c: 48 8b 01              mov    (%rcx),%rax  3f: 48                    rex.W% ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2021-09-07 03:23 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |


