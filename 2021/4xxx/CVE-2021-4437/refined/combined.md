=== Content from github.com_13604270_20250114_190417.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Freleases%2Ftag%2F%2540lambda-middleware%252Fframeguard_v1.1.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Freleases%2Ftag%2F%2540lambda-middleware%252Fframeguard_v1.1.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=dbartholomae%2Flambda-middleware)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dbartholomae](/dbartholomae)
/
**[lambda-middleware](/dbartholomae/lambda-middleware)**
Public

* [Notifications](/login?return_to=%2Fdbartholomae%2Flambda-middleware) You must be signed in to change notification settings
* [Fork
  18](/login?return_to=%2Fdbartholomae%2Flambda-middleware)
* [Star
   153](/login?return_to=%2Fdbartholomae%2Flambda-middleware)

* [Code](/dbartholomae/lambda-middleware/tree/%40lambda-middleware/frameguard_v1.1.0)
* [Issues
  0](/dbartholomae/lambda-middleware/issues)
* [Pull requests
  0](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects
  0](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

Additional navigation options

* [Code](/dbartholomae/lambda-middleware/tree/%40lambda-middleware/frameguard_v1.1.0)
* [Issues](/dbartholomae/lambda-middleware/issues)
* [Pull requests](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

[Releases](/dbartholomae/lambda-middleware/releases)
[Tags](/dbartholomae/lambda-middleware/tags)

# @lambda-middleware/frameguard\_v1.1.0

* [@lambda-middleware/frameguard\_v1.1.0](/dbartholomae/lambda-middleware/tree/%40lambda-middleware/frameguard_v1.1.0)
* [`9afd41c`](/dbartholomae/lambda-middleware/commit/9afd41cf43e9af45a999f6cdc51c7f9f6b01aef8)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/dbartholomae/lambda-middleware/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...%40lambda-middleware/frameguard_v1.1.0)

   Loading

  [View all tags](/dbartholomae/lambda-middleware/tags)

[@lambda-middleware/frameguard\_v1.1.0](/dbartholomae/lambda-middleware/releases/tag/%40lambda-middleware/frameguard_v1.1.0)

* [@lambda-middleware/frameguard\_v1.1.0](/dbartholomae/lambda-middleware/tree/%40lambda-middleware/frameguard_v1.1.0)
* [`9afd41c`](/dbartholomae/lambda-middleware/commit/9afd41cf43e9af45a999f6cdc51c7f9f6b01aef8)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/dbartholomae/lambda-middleware/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...%40lambda-middleware/frameguard_v1.1.0)

   Loading

  [View all tags](/dbartholomae/lambda-middleware/tags)

![@actions-user](https://avatars.githubusercontent.com/u/65916846?s=40&v=4)
[actions-user](/actions-user)
tagged this
13 Oct 18:22

```
@lambda-middleware/frameguard v1.1.0
```

 Assets
2

 Loading

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_b19a5639_20250114_190413.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fcommit%2Ff689404d830cbc1edd6a1018d3334ff5f44dc6a6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fcommit%2Ff689404d830cbc1edd6a1018d3334ff5f44dc6a6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=dbartholomae%2Flambda-middleware)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dbartholomae](/dbartholomae)
/
**[lambda-middleware](/dbartholomae/lambda-middleware)**
Public

* [Notifications](/login?return_to=%2Fdbartholomae%2Flambda-middleware) You must be signed in to change notification settings
* [Fork
  18](/login?return_to=%2Fdbartholomae%2Flambda-middleware)
* [Star
   153](/login?return_to=%2Fdbartholomae%2Flambda-middleware)

* [Code](/dbartholomae/lambda-middleware)
* [Issues
  0](/dbartholomae/lambda-middleware/issues)
* [Pull requests
  0](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects
  0](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

Additional navigation options

* [Code](/dbartholomae/lambda-middleware)
* [Issues](/dbartholomae/lambda-middleware/issues)
* [Pull requests](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

## Commit

[Permalink](/dbartholomae/lambda-middleware/commit/f689404d830cbc1edd6a1018d3334ff5f44dc6a6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix(json-deserializer): fixed codeQL vulnerability

[Browse files](/dbartholomae/lambda-middleware/tree/f689404d830cbc1edd6a1018d3334ff5f44dc6a6)
Browse the repository at this point in the history

```
Removed the regex used to identify a JSON mime-type as this was potentially vulnerable to
'Regular expression Denial of Service attacks' and making changes to make the regex more restrictive (but compliant with RFC 6838) did not pass tests for this issue online.

This now matches based on the last segment of a mimetype being json or json; this should match all the expected mime types.

Updated unit-tests with additional tests for a variety of compatible mime types.
```

* Loading branch information

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

[matt-jenner](/dbartholomae/lambda-middleware/commits?author=matt-jenner "View all commits by matt-jenner")
committed
Aug 30, 2021

1 parent
[c9b14ba](/dbartholomae/lambda-middleware/commit/c9b14ba0ab958357bb9c23e9894acaff5cb1351c)

commit f689404

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**25 additions**
and
**14 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* packages/json-deserializer/src

  + packages/json-deserializer/src/JsonDeserializer.test.ts
    [JsonDeserializer.test.ts](#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)
  + packages/json-deserializer/src/JsonDeserializer.ts
    [JsonDeserializer.ts](#diff-d10a1ad655a0573f94fd1b6592d36ff992a267f852c4a94b164096b6585cc70d)

## There are no files selected for viewing

25 changes: 16 additions & 9 deletions

25
[packages/json-deserializer/src/JsonDeserializer.test.ts](#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855 "packages/json-deserializer/src/JsonDeserializer.test.ts")

Show comments

[View file](/dbartholomae/lambda-middleware/blob/f689404d830cbc1edd6a1018d3334ff5f44dc6a6/packages/json-deserializer/src/JsonDeserializer.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,16 +29,23 @@ describe("jsonDeserializer", () => { |
|  |  | }, |
|  |  | }; |
|  |  |  |
|  |  | it("deserializes objects if the event has a json content-type header", async () => { |
|  |  | const event: APIGatewayProxyEvent = createEvent({ |
|  |  | headers: { "Content-Type": "application/json" }, |
|  |  | body: JSON.stringify(testObject), |
|  |  | }); |
|  |  | describe("deserializes objects the event has a valid json content-type header:", () => { |
|  |  | it.each([ |
|  |  | ["subtype is json", "application/json"], |
|  |  | ["subtype structured syntax specifier is json", "application/ld+json"], |
|  |  | ["semicolon is appended", "application/json;"], |
|  |  | ["whitespace is appended", "application/json; "], |
|  |  | ])("%s (%p)", async (\_string, mimeType: string) => { |
|  |  | const event: APIGatewayProxyEvent = createEvent({ |
|  |  | headers: { "Content-Type": mimeType }, |
|  |  | body: JSON.stringify(testObject), |
|  |  | }); |
|  |  |  |
|  |  | await handlerWithMiddleware(event, createContext()); |
|  |  | expect(processedEvent.bodyObject).toMatchObject( |
|  |  | JSON.parse(JSON.stringify(testObject)) |
|  |  | ); |
|  |  | await handlerWithMiddleware(event, createContext()); |
|  |  | expect(processedEvent.bodyObject).toMatchObject( |
|  |  | JSON.parse(JSON.stringify(testObject)) |
|  |  | ); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe("sets the request bodyObject to null if:", () => { |
| Expand Down | |  |

14 changes: 9 additions & 5 deletions

14
[packages/json-deserializer/src/JsonDeserializer.ts](#diff-d10a1ad655a0573f94fd1b6592d36ff992a267f852c4a94b164096b6585cc70d "packages/json-deserializer/src/JsonDeserializer.ts")

Show comments

[View file](/dbartholomae/lambda-middleware/blob/f689404d830cbc1edd6a1018d3334ff5f44dc6a6/packages/json-deserializer/src/JsonDeserializer.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,4 @@ |
|  |  | import { PromiseHandler } from "@lambda-middleware/utils"; |
|  |  | import debugFactory, { IDebugger } from "debug"; |
|  |  | import { |
|  |  | APIGatewayProxyEvent, |
|  |  | APIGatewayProxyResult, |
| Expand All | | @@ -8,8 +7,6 @@ import { |
|  |  | import { APIGatewayProxyObjectEvent } from "./types/APIGatewayProxyObjectEvent"; |
|  |  | import { RequestBodyNotJsonError } from "./customErrors/RequestBodyNotJsonError"; |
|  |  |  |
|  |  | const logger: IDebugger = debugFactory("@lambda-middleware/json-serializer"); |
|  |  |  |
|  |  | export const jsonDeserializer = <E extends APIGatewayProxyEvent>() => ( |
|  |  | handler: PromiseHandler<APIGatewayProxyObjectEvent<E>, APIGatewayProxyResult> |
|  |  | ) => async (event: E, context: Context): Promise<APIGatewayProxyResult> => { |
| Expand Down  Expand Up | | @@ -50,6 +47,13 @@ const isJsonMimeType = (event: APIGatewayProxyEvent) => { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | const mimePattern = /^application\/(.+\+)?json(;.\*)?$/; |
|  |  | return mimePattern.test(contentTypeHeader); |
|  |  | const mimeParts = contentTypeHeader.split("/"); |
|  |  |  |
|  |  | if (mimeParts.length != 2) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | const lastSubtypePart = mimeParts[1].toLowerCase().split("+").pop()?.trim(); |
|  |  |  |
|  |  | return lastSubtypePart === "json" || lastSubtypePart === "json;"; |
|  |  | }; |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f689404`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fcommit%2Ff689404d830cbc1edd6a1018d3334ff5f44dc6a6) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_6cd0cea1_20250114_190416.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fpull%2F57)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fpull%2F57)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=dbartholomae%2Flambda-middleware)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dbartholomae](/dbartholomae)
/
**[lambda-middleware](/dbartholomae/lambda-middleware)**
Public

* [Notifications](/login?return_to=%2Fdbartholomae%2Flambda-middleware) You must be signed in to change notification settings
* [Fork
  18](/login?return_to=%2Fdbartholomae%2Flambda-middleware)
* [Star
   153](/login?return_to=%2Fdbartholomae%2Flambda-middleware)

* [Code](/dbartholomae/lambda-middleware)
* [Issues
  0](/dbartholomae/lambda-middleware/issues)
* [Pull requests
  0](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects
  0](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

Additional navigation options

* [Code](/dbartholomae/lambda-middleware)
* [Issues](/dbartholomae/lambda-middleware/issues)
* [Pull requests](/dbartholomae/lambda-middleware/pulls)
* [Discussions](/dbartholomae/lambda-middleware/discussions)
* [Actions](/dbartholomae/lambda-middleware/actions)
* [Projects](/dbartholomae/lambda-middleware/projects)
* [Security](/dbartholomae/lambda-middleware/security)
* [Insights](/dbartholomae/lambda-middleware/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fdbartholomae%2Flambda-middleware%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fdbartholomae%2Flambda-middleware%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add the json-deserializer middleware package #57

 Merged

[mergify](/apps/mergify)
merged 27 commits into
[dbartholomae:main](/dbartholomae/lambda-middleware/tree/main "dbartholomae/lambda-middleware:main")
from
[matt-jenner:feature/json-deserializer](/matt-jenner/lambda-middleware/tree/feature/json-deserializer "matt-jenner/lambda-middleware:feature/json-deserializer")

Sep 1, 2021

 Merged

# [Add the json-deserializer middleware package](#top) #57

[mergify](/apps/mergify)
merged 27 commits into
[dbartholomae:main](/dbartholomae/lambda-middleware/tree/main "dbartholomae/lambda-middleware:main")
from
[matt-jenner:feature/json-deserializer](/matt-jenner/lambda-middleware/tree/feature/json-deserializer "matt-jenner/lambda-middleware:feature/json-deserializer")

Sep 1, 2021

[Conversation
27](/dbartholomae/lambda-middleware/pull/57)
[Commits
27](/dbartholomae/lambda-middleware/pull/57/commits)
[Checks
0](/dbartholomae/lambda-middleware/pull/57/checks)
[Files changed](/dbartholomae/lambda-middleware/pull/57/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=60&v=4)](/matt-jenner)

Copy link

Contributor

### @matt-jenner **[matt-jenner](/matt-jenner)** commented [Jul 25, 2021](#issue-952273131)

This implements a json-deserializer middleware, it expects an object extending ApiGatewayProxyEvent and returns an ApiGatewayProxyObjectEvent which replaces the string body for an object of type `Record<string, unknown>`.

It introduces the concept of a `RequestBodyNotJsonError` to be used to catch and return an appropriate 400 error back if a non json payload is passed.

If no body or a non-json header is passed it will pass null as the body property on the event passed to the underlying handler.

Closes [#54](https://github.com/dbartholomae/lambda-middleware/issues/54)

## Checklist:

* I have updated the documentation accordingly.
* I have read the **CONTRIBUTING** document.

I'm sorry for the delays in supplying this PR, but things got crazily busy at work, and then summer (and a large DIY project - building a garden office now my work has decided no-one is going back to the office full-time) happened which I'm afraid took most of my spare time and I like to code when fully able to commit myself to it.

Although I mostly got this done within a few hours work. I ran into an issue with the 100% code-coverage requirements which caused me to delay submiting. While I do have full coverage in TS (and I always like to see with libraries I expect someone to depend upon), there was one issue where the `super(message)` line in the `RequestBodyNotJsonError` class would NOT mark itself as covered despite definately hitting the line in my tests.

Jest reports the line as not-covered due to the coverage being applied to ES5 code rather than the TS itself. I've confirmed coverage is 100% as if you switch the output to ES6 it reports 100% coverage.

After reading quite a bit around the issue, it seems to relate to the fact that when the TS line:

`super(message)`

is transpiled down to ES5, it comes out as:

`var _this = _super.call(this, message) || this;`

While the former part of the or statement is covered, it doesn't cover all the cases of the transpiled statement fully.

I've tried various approaches to resolve this including a suggestion of adding `https://www.npmjs.com/package/ts-es5-istanbul-coverage` but eventually thought it best to submit it cleanly without this and see your thoughts.

See here for more information:

* [Emitted code for super() results in 'Branch not covered' in coverage reports.¬†microsoft/TypeScript#13029](https://github.com/microsoft/TypeScript/issues/13029)
* [Typescript extended classes show branch error¬†SitePen/remap-istanbul#106](https://github.com/SitePen/remap-istanbul/issues/106)

Otherwise, hopefully the PR should be otherwise mostly self-explanatory, the logic itself is very simple and is the precursor for my other feature request logged in [#55](https://github.com/dbartholomae/lambda-middleware/issues/55).

Sorry, something went wrong.

All reactions

 [matt-jenner](/matt-jenner)
added 3 commits
[July 25, 2021 12:08](#commits-pushed-57fe6a9)

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[feat(json-deserilalizer): initial implementation of json- deserialize‚Ä¶](/dbartholomae/lambda-middleware/pull/57/commits/57fe6a99c8b4555c72932cdce0b6ce5cff594207 "feat(json-deserilalizer): initial implementation of json- deserializer package

This implements a json-deserializer middleware, it expects an object extending ApiGatewayProxyEvent and returns an ApiGatewayProxyObjectEvent which replaces the string body for an object of type Record<string, unknown>.

It introduces the concept of a RequestBodyNotJsonError to be used to return an appropriate 400 error back if passed a non json payload is passed.

If no body or a non-json header is passed it will pass null as the body property on the event passed to the underlying handler.")`
 ‚Ä¶

`[57fe6a9](/dbartholomae/lambda-middleware/pull/57/commits/57fe6a99c8b4555c72932cdce0b6ce5cff594207)`

```
‚Ä¶r package

This implements a json-deserializer middleware, it expects an object extending ApiGatewayProxyEvent and returns an ApiGatewayProxyObjectEvent which replaces the string body for an object of type Record<string, unknown>.

It introduces the concept of a RequestBodyNotJsonError to be used to return an appropriate 400 error back if passed a non json payload is passed.

If no body or a non-json header is passed it will pass null as the body property on the event passed to the underlying handler.
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[docs(json-deserializer): Added readme.md to json-deserializer](/dbartholomae/lambda-middleware/pull/57/commits/ed72ce79047f94064a8b50de3b49809532f541c0 "docs(json-deserializer): Added readme.md to json-deserializer")`

`[ed72ce7](/dbartholomae/lambda-middleware/pull/57/commits/ed72ce79047f94064a8b50de3b49809532f541c0)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[docs: Added packages/json-deserializer to main readme.md](/dbartholomae/lambda-middleware/pull/57/commits/5165316450ed0009b7da783ba8095e152118d11a "docs: Added packages/json-deserializer to main readme.md")`

`[5165316](/dbartholomae/lambda-middleware/pull/57/commits/5165316450ed0009b7da783ba8095e152118d11a)`

[![@CLAassistant](https://avatars.githubusercontent.com/u/11571300?s=80&u=04709ab66059d1fb5246ce2d47bd3bc44e639ee0&v=4)](/CLAassistant)

Copy link

### **[CLAassistant](/CLAassistant)** commented [Jul 25, 2021](#issuecomment-886200987) ‚Ä¢ edited Loading

| [CLA assistant check](https://cla-assistant.io/dbartholomae/lambda-middleware?pullRequest=57) All committers have signed the CLA. |
| --- |

All reactions

Sorry, something went wrong.

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)
[matt-jenner](/matt-jenner)
mentioned this pull request
[Jul 25, 2021](#ref-issue-899059153)

[Add io-ts validator middleware
#55](/dbartholomae/lambda-middleware/issues/55)

Closed

3 tasks

[![dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=60&v=4)](/dbartholomae)

**[dbartholomae](/dbartholomae)**
reviewed
[Jul 25, 2021](#pullrequestreview-714317686)

 [View reviewed changes](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a)

Copy link

Owner

### @dbartholomae **[dbartholomae](/dbartholomae)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Won't be able to do a full review until I'm back from vacation, but here are already some observations

Sorry, something went wrong.

All reactions

[packages/json-deserializer/src/JsonDeserializer.test.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)
Outdated

Show resolved

Hide resolved

[packages/json-deserializer/src/JsonDeserializer.test.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)
Outdated

Show resolved

Hide resolved

[packages/json-deserializer/src/JsonDeserializer.test.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)

Show resolved

Hide resolved

[packages/json-deserializer/src/JsonDeserializer.test.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)

Show resolved

Hide resolved

[packages/json-deserializer/src/JsonDeserializer.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-d10a1ad655a0573f94fd1b6592d36ff992a267f852c4a94b164096b6585cc70d)
Outdated

Show resolved

Hide resolved

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=80&u=3af25660091d3ca2595609d808c546210aac225e&v=4)](/dbartholomae)

Copy link

Owner

### **[dbartholomae](/dbartholomae)** commented [Jul 25, 2021](#issuecomment-886211697)

| Concerning the coverage, just adding a comment explaining it and an Istanbul ignore next might well suffice |
| --- |

 üëç
1
 matt-jenner reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

 [matt-jenner](/matt-jenner)
added 4 commits
[July 28, 2021 08:40](#commits-pushed-0312425)

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[fix(json-deserializer): fixed code-coverage](/dbartholomae/lambda-middleware/pull/57/commits/0312425b01c9cb2d2a4c65266979ba9b7c615bc8 "fix(json-deserializer): fixed code-coverage

Worked around issue with code-coverage in  RequestBodyNotJsonError.ts by adding istanbul ignore next comment and an explanation of why as-agreed.")`
 ‚Ä¶

`[0312425](/dbartholomae/lambda-middleware/pull/57/commits/0312425b01c9cb2d2a4c65266979ba9b7c615bc8)`

```
Worked around issue with code-coverage in  RequestBodyNotJsonError.ts by adding istanbul ignore next comment and an explanation of why as-agreed.
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[refactor(json-deserializer): remove should from unit-test statements](/dbartholomae/lambda-middleware/pull/57/commits/890e9dd867301388fd11c94e3ef0ee2c5fc6bfcc "refactor(json-deserializer): remove should from unit-test statements")`

`[890e9dd](/dbartholomae/lambda-middleware/pull/57/commits/890e9dd867301388fd11c94e3ef0ee2c5fc6bfcc)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[refactor(json-deserializer): replace let with const in jsonDeserializer](/dbartholomae/lambda-middleware/pull/57/commits/ab9a9ab4666bfac2d8652b3d8ffdd56764301afa "refactor(json-deserializer): replace let with const in jsonDeserializer")`

`[ab9a9ab](/dbartholomae/lambda-middleware/pull/57/commits/ab9a9ab4666bfac2d8652b3d8ffdd56764301afa)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[feat(json-deserializer): do not overwrite body use bodyObject](/dbartholomae/lambda-middleware/pull/57/commits/12f738354d07a6f1fe71164281283b87df71f355 "feat(json-deserializer): do not overwrite body use bodyObject")`

`[12f7383](/dbartholomae/lambda-middleware/pull/57/commits/12f738354d07a6f1fe71164281283b87df71f355)`

[![dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=60&v=4)](/dbartholomae)

**[dbartholomae](/dbartholomae)**
requested changes
[Aug 30, 2021](#pullrequestreview-742029876)

 [View reviewed changes](/dbartholomae/lambda-middleware/pull/57/files/12f738354d07a6f1fe71164281283b87df71f355)

Copy link

Owner

### @dbartholomae **[dbartholomae](/dbartholomae)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for waiting! I've added comments to make it easy to add the status code to the error. I'll also check why CI isn't running on this PR. There might need to run `rush change` to also add a changelog. But CI should tell us.

Sorry, something went wrong.

All reactions

[packages/json-deserializer/src/JsonDeserializer.test.ts](/dbartholomae/lambda-middleware/pull/57/files/5165316450ed0009b7da783ba8095e152118d11a#diff-568b257f1c5b69024f2a0b6deb28462958036cf7dbf174b8675d995fd2719855)

Show resolved

Hide resolved

[packages/json-deserializer/src/customErrors/RequestBodyNotJsonError.ts](/dbartholomae/lambda-middleware/pull/57/files/12f738354d07a6f1fe71164281283b87df71f355#diff-2eb42aa2eef4fbf4bb6a1418d3b4a9477f9edfd768c53d68d4ddfc1e324dd6cc)

Show resolved

Hide resolved

[packages/json-deserializer/src/customErrors/RequestBodyNotJsonError.ts](/dbartholomae/lambda-middleware/pull/57/files/12f738354d07a6f1fe71164281283b87df71f355#diff-2eb42aa2eef4fbf4bb6a1418d3b4a9477f9edfd768c53d68d4ddfc1e324dd6cc)

Show resolved

Hide resolved

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=80&u=3af25660091d3ca2595609d808c546210aac225e&v=4)](/dbartholomae)

Copy link

Owner

### **[dbartholomae](/dbartholomae)** commented [Aug 30, 2021](#issuecomment-908667749)

| Please also rebase, this should run CI for the branch (I've just updated the main branch with a small config change). |
| --- |

 üëç
1
 matt-jenner reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

 [matt-jenner](/matt-jenner)
added 8 commits
[August 30, 2021 22:33](#commits-pushed-c29dbbe)

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[feat(json-deserilalizer): initial implementation of json- deserialize‚Ä¶](/dbartholomae/lambda-middleware/pull/57/commits/c29dbbe2292d1cdd35febdad7d6d02404aa19001 "feat(json-deserilalizer): initial implementation of json- deserializer package

This implements a json-deserializer middleware, it expects an object extending ApiGatewayProxyEvent and returns an ApiGatewayProxyObjectEvent which replaces the string body for an object of type Record<string, unknown>.

It introduces the concept of a RequestBodyNotJsonError to be used to return an appropriate 400 error back if passed a non json payload is passed.

If no body or a non-json header is passed it will pass null as the body property on the event passed to the underlying handler.")`
 ‚Ä¶

`[c29dbbe](/dbartholomae/lambda-middleware/pull/57/commits/c29dbbe2292d1cdd35febdad7d6d02404aa19001)`

```
‚Ä¶r package

This implements a json-deserializer middleware, it expects an object extending ApiGatewayProxyEvent and returns an ApiGatewayProxyObjectEvent which replaces the string body for an object of type Record<string, unknown>.

It introduces the concept of a RequestBodyNotJsonError to be used to return an appropriate 400 error back if passed a non json payload is passed.

If no body or a non-json header is passed it will pass null as the body property on the event passed to the underlying handler.
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[docs(json-deserializer): Added readme.md to json-deserializer](/dbartholomae/lambda-middleware/pull/57/commits/dee51cf5b045c534aad80bec0a72d35f1a39735b "docs(json-deserializer): Added readme.md to json-deserializer")`

`[dee51cf](/dbartholomae/lambda-middleware/pull/57/commits/dee51cf5b045c534aad80bec0a72d35f1a39735b)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[docs: Added packages/json-deserializer to main readme.md](/dbartholomae/lambda-middleware/pull/57/commits/c4bfa4e6f48c424110e663bb48ef93ae69d410b0 "docs: Added packages/json-deserializer to main readme.md")`

`[c4bfa4e](/dbartholomae/lambda-middleware/pull/57/commits/c4bfa4e6f48c424110e663bb48ef93ae69d410b0)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[fix(json-deserializer): fixed code-coverage](/dbartholomae/lambda-middleware/pull/57/commits/7d0ab74f9d88f8f0c61bc688fd9e2d1e397f3a4f "fix(json-deserializer): fixed code-coverage

Worked around issue with code-coverage in  RequestBodyNotJsonError.ts by adding istanbul ignore next comment and an explanation of why as-agreed.")`
 ‚Ä¶

`[7d0ab74](/dbartholomae/lambda-middleware/pull/57/commits/7d0ab74f9d88f8f0c61bc688fd9e2d1e397f3a4f)`

```
Worked around issue with code-coverage in  RequestBodyNotJsonError.ts by adding istanbul ignore next comment and an explanation of why as-agreed.
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[refactor(json-deserializer): remove should from unit-test statements](/dbartholomae/lambda-middleware/pull/57/commits/8b12ef5e9161fcb13bdef509d9422a9197eae5ac "refactor(json-deserializer): remove should from unit-test statements")`

`[8b12ef5](/dbartholomae/lambda-middleware/pull/57/commits/8b12ef5e9161fcb13bdef509d9422a9197eae5ac)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[refactor(json-deserializer): replace let with const in jsonDeserializer](/dbartholomae/lambda-middleware/pull/57/commits/42c6ce599d06fa59883299340426f33daea59ccb "refactor(json-deserializer): replace let with const in jsonDeserializer")`

`[42c6ce5](/dbartholomae/lambda-middleware/pull/57/commits/42c6ce599d06fa59883299340426f33daea59ccb)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[feat(json-deserializer): do not overwrite body use bodyObject](/dbartholomae/lambda-middleware/pull/57/commits/972a978aaab7b0d5ddadd79c800048543725b4e0 "feat(json-deserializer): do not overwrite body use bodyObject")`

`[972a978](/dbartholomae/lambda-middleware/pull/57/commits/972a978aaab7b0d5ddadd79c800048543725b4e0)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[Merge branch 'feature/json-deserializer' of](/dbartholomae/lambda-middleware/pull/57/commits/fe5e1b2998bff249f575da6114da13ec1d4ee88d "Merge branch 'feature/json-deserializer' of https://github.com/matt-jenner/lambda-middleware into feature/json-deserializer") [https://github.com/matt-j‚Ä¶](https://github.com/matt-jenner/lambda-middleware)`
 ‚Ä¶

`[fe5e1b2](/dbartholomae/lambda-middleware/pull/57/commits/fe5e1b2998bff249f575da6114da13ec1d4ee88d)`

```
[‚Ä¶enner/lambda-middleware](https://github.com/matt-jenner/lambda-middleware) into feature/json-deserializer
```

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Aug 30, 2021](#issuecomment-908718036) ‚Ä¢ edited Loading

| [Codecov](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae) Report Merging [#57](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae) ([dfa8dbd](https://github.com/dbartholomae/lambda-middleware/commit/dfa8dbd71f720601c8db2b72a0f09c8309633fec)) into [main](https://codecov.io/gh/dbartholomae/lambda-middleware/commit/30b8e5e127fcb9b41a50ebf1a1e948157c08b142?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae) ([30b8e5e](https://github.com/dbartholomae/lambda-middleware/commit/30b8e5e127fcb9b41a50ebf1a1e948157c08b142)) will **not change** coverage. The diff coverage is `n/a`.  [Impacted file tree graph](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae)  ``` @@            Coverage Diff            @@ ##              main       #57   +/-   ## =========================================   Coverage   100.00%   100.00%            =========================================   Files           54        54              Lines          520       520              Branches        98        98            =========================================   Hits           520       520            ```  ---   [Continue to review full report at Codecov](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae) `Œî = absolute <relative> (impact)`, `√∏ = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae). Last update [30b8e5e...dfa8dbd](https://codecov.io/gh/dbartholomae/lambda-middleware/pull/57?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Daniel+Bartholomae). |
| --- |

All reactions

Sorry, something went wrong.

 [matt-jenner](/matt-jenner)
and others
added 3 commits
[August 30, 2021 22:52](#commits-pushed-c9b14ba)

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner) [![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[feat(json-deserialiser): add statusCode to error response](/dbartholomae/lambda-middleware/pull/57/commits/c9b14ba0ab958357bb9c23e9894acaff5cb1351c "feat(json-deserialiser): add statusCode to error response

This alters the error response to return a statusCode property with a value of 400 to make it compatible with the error-handling middleware also included in the lambda-middleware package as suggested by @dbartholomae.

Co-authored-by: Daniel Bartholomae <daniel@bartholomae.name>")`
 ‚Ä¶

`[c9b14ba](/dbartholomae/lambda-middleware/pull/57/commits/c9b14ba0ab958357bb9c23e9894acaff5cb1351c)`

```

This alters the error response to return a statusCode property with a value of 400 to make it compatible with the error-handling middleware also included in the lambda-middleware package as suggested by [@dbartholomae](https://github.com/dbartholomae).

Co-authored-by: Daniel Bartholomae <daniel@bartholomae.name>
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[fix(json-deserializer): fixed codeQL vulnerability](/dbartholomae/lambda-middleware/pull/57/commits/f689404d830cbc1edd6a1018d3334ff5f44dc6a6 "fix(json-deserializer): fixed codeQL vulnerability

Removed the regex used to identify a JSON mime-type as this was potentially vulnerable to
'Regular expression Denial of Service attacks' and making changes to make the regex more restrictive (but compliant with RFC 6838) did not pass tests for this issue online.

This now matches based on the last segment of a mimetype being json or json; this should match all the expected mime types.

Updated unit-tests with additional tests for a variety of compatible mime types.")`
 ‚Ä¶

`[f689404](/dbartholomae/lambda-middleware/pull/57/commits/f689404d830cbc1edd6a1018d3334ff5f44dc6a6)`

```
Removed the regex used to identify a JSON mime-type as this was potentially vulnerable to
'Regular expression Denial of Service attacks' and making changes to make the regex more restrictive (but compliant with RFC 6838) did not pass tests for this issue online.

This now matches based on the last segment of a mimetype being json or json; this should match all the expected mime types.

Updated unit-tests with additional tests for a variety of compatible mime types.
```

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=40&v=4)](/matt-jenner)

`[chore(json-deserializer): added changes after calling rush change](/dbartholomae/lambda-middleware/pull/57/commits/95d87dcbee0a1f48dcc2c698009e833a1c3e114a "chore(json-deserializer): added changes after calling rush change")`

`[95d87dc](/dbartholomae/lambda-middleware/pull/57/commits/95d87dcbee0a1f48dcc2c698009e833a1c3e114a)`

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=80&v=4)](/matt-jenner)

Copy link

Contributor

Author

### **[matt-jenner](/matt-jenner)** commented [Aug 30, 2021](#issuecomment-908785080)

| Thanks for the review, I hope you had a good holiday. I've added your suggestions and fixed one codeQL vulnerability relating to Regular expression denial of service (it was simpler to just remove the regex üôÇ).  It's running the build now but for some reason it's not seeing my package in the build, it lists 13 packages not the 14 I see if I run `rush test:integration` or `rush test:unit` locally and the project is listed in `rush.json` so I would have thought it would have picked it up?  Any ideas on this front as I'm afraid I'm not a rush expert, thanks üôÇ. |
| --- |

All reactions

Sorry, something went wrong.

[![dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=60&v=4)](/dbartholomae)

**[dbartholomae](/dbartholomae)**
approved these changes
[Sep 1, 2021](#pullrequestreview-743810624)

 [View reviewed changes](/dbartholomae/lambda-middleware/pull/57/files/95d87dcbee0a1f48dcc2c698009e833a1c3e114a)

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=80&v=4)](/matt-jenner)

Copy link

Contributor

Author

### **[matt-jenner](/matt-jenner)** commented [Sep 1, 2021](#issuecomment-910236218)

| Thanks for the approval - it will feel good to finally get this in, I think you need to merge this manually though as mergify is complaining that the workflow has changed. Once this is in, I can start on the next issue I logged to create the io-ts validator middleware before I'm due back in work next week, thanks üôÇ. |
| --- |

All reactions

Sorry, something went wrong.

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=80&u=3af25660091d3ca2595609d808c546210aac225e&v=4)](/dbartholomae)

Copy link

Owner

### **[dbartholomae](/dbartholomae)** commented [Sep 1, 2021](#issuecomment-910272717)

| Thanks! I now figured out the problem: When I changed the settings to run the GitHub actions for this PR, I changed them in a way that lead to actions running on the main branch code instead of the PR branch code instead. I've just updated the main branch to fix this. If you could rebase/merge main one more time, it should be solved :) |
| --- |

All reactions

Sorry, something went wrong.

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[Merge remote-tracking branch 'origin/main' into feature/json-deserial‚Ä¶](/dbartholomae/lambda-middleware/pull/57/commits/f4c0c3cea83dfc3a6517b8aab46228e43f40e95e "Merge remote-tracking branch 'origin/main' into feature/json-deserializer")`
 ‚Ä¶

`[f4c0c3c](/dbartholomae/lambda-middleware/pull/57/commits/f4c0c3cea83dfc3a6517b8aab46228e43f40e95e)`

```
‚Ä¶izer
```

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=80&u=3af25660091d3ca2595609d808c546210aac225e&v=4)](/dbartholomae)

Copy link

Owner

### **[dbartholomae](/dbartholomae)** commented [Sep 1, 2021](#issuecomment-910388233)

| Just realized that you gave me access to the branch, so I did the merge of main myself and will merge this branch once CI is green. |
| --- |

All reactions

Sorry, something went wrong.

 [dbartholomae](/dbartholomae)
added 8 commits
[September 1, 2021 18:48](#commits-pushed-f54cd0d)

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[fix: solve TypeScript problem in example](/dbartholomae/lambda-middleware/pull/57/commits/f54cd0db29547d2900b3b07500368e8c18aa1c50 "fix: solve TypeScript problem in example")`

`[f54cd0d](/dbartholomae/lambda-middleware/pull/57/commits/f54cd0db29547d2900b3b07500368e8c18aa1c50)`

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[chore: update serverless dependencies](/dbartholomae/lambda-middleware/pull/57/commits/a72b369e779439e549f060118c5dd19e38bba008 "chore: update serverless dependencies")`

`[a72b369](/dbartholomae/lambda-middleware/pull/57/commits/a72b369e779439e549f060118c5dd19e38bba008)`

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[fix: update example to use bodyObject instead of body](/dbartholomae/lambda-middleware/pull/57/commits/deed12603a970c392fbc1aaa4442b970376e6698 "fix: update example to use bodyObject instead of body")`

`[deed126](/dbartholomae/lambda-middleware/pull/57/commits/deed12603a970c392fbc1aaa4442b970376e6698)`

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[chore: add changelog update](/dbartholomae/lambda-middleware/pull/57/commits/3fb29a3ace8c2f1bfb9e7986ac3f9314f60e2410 "chore: add changelog update")`

`[3fb29a3](/dbartholomae/lambda-middleware/pull/57/commits/3fb29a3ace8c2f1bfb9e7986ac3f9314f60e2410)`

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[chore: update serverless runtime](/dbartholomae/lambda-middleware/pull/57/commits/63db06322974e179ec4ec4dfff54360a1ea4fb69 "chore: update serverless runtime

The previous runtime version is no longer valid.")`
 ‚Ä¶

`[63db063](/dbartholomae/lambda-middleware/pull/57/commits/63db06322974e179ec4ec4dfff54360a1ea4fb69)`

```
The previous runtime version is no longer valid.
```

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[chore: update serverless versions in template](/dbartholomae/lambda-middleware/pull/57/commits/7524415002abd8119730916366096871f86327e4 "chore: update serverless versions in template")`

`[7524415](/dbartholomae/lambda-middleware/pull/57/commits/7524415002abd8119730916366096871f86327e4)`

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[chore: set service name directly in serverless.yml files](/dbartholomae/lambda-middleware/pull/57/commits/c016054aae000f8c3930836b5e1587a3d7035d1e "chore: set service name directly in serverless.yml files

The old notation is deprecated now

See https://www.serverless.com/framework/docs/deprecations/#SERVICE_OBJECT_NOTATION")`
 ‚Ä¶

`[c016054](/dbartholomae/lambda-middleware/pull/57/commits/c016054aae000f8c3930836b5e1587a3d7035d1e)`

```
The old notation is deprecated now

See <https://www.serverless.com/framework/docs/deprecations/#SERVICE_OBJECT_NOTATION>
```

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae)

`[fix: use example compatible with serverless](/dbartholomae/lambda-middleware/pull/57/commits/dfa8dbd71f720601c8db2b72a0f09c8309633fec "fix: use example compatible with serverless

Currently, an empty body in serverless will change the status code from 200 to 204")`
 ‚Ä¶

`[dfa8dbd](/dbartholomae/lambda-middleware/pull/57/commits/dfa8dbd71f720601c8db2b72a0f09c8309633fec)`

```
Currently, an empty body in serverless will change the status code from 200 to 204
```

[![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/apps/mergify)
[mergify](/apps/mergify)
bot
merged commit [`4514449`](/dbartholomae/lambda-middleware/commit/45144493d0d3011a9b88440b4d848d9300a77379)
into
dbartholomae:main

[Sep 1, 2021](https://github.com/dbartholomae/lambda-middleware/pull/57#event-5241583439)

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=80&u=3af25660091d3ca2595609d808c546210aac225e&v=4)](/dbartholomae)

Copy link

Owner

### **[dbartholomae](/dbartholomae)** commented [Sep 1, 2021](#issuecomment-910594208)

| There was also a slight problem with the integration test: it still used `body` instead of `bodyObject`. It's fixed, and version 1.1.0 is now available on npm. |
| --- |

All reactions

Sorry, something went wrong.

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=80&v=4)](/matt-jenner)

Copy link

Contributor

Author

### **[matt-jenner](/matt-jenner)** commented [Sep 1, 2021](#issuecomment-910693788)

| There was also a slight problem with the integration test: it still used `body` instead of `bodyObject`. It's fixed, and version 1.1.0 is now available on npm.  Thanks for fixing that, I really mustn't code quite so late üôÇ looking forward to switching my project over to use this now and start on the next middleware üòÅ |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fdbartholomae%2Flambda-middleware%2Fpull%2F57)

Reviewers

[![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=40&v=4)](/dbartholomae) [dbartholomae](/dbartholomae)

dbartholomae approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Add a JSON Deserializer Middleware](https://github.com/dbartholomae/lambda-middleware/issues/54)

3 participants

[![@matt-jenner](https://avatars.githubusercontent.com/u/1902452?s=52&v=4)](/matt-jenner) [![@CLAassistant](https://avatars.githubusercontent.com/u/11571300?s=52&v=4)](/CLAassistant) [![@dbartholomae](https://avatars.githubusercontent.com/u/3396992?s=52&v=4)](/dbartholomae)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


