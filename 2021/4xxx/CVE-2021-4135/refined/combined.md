=== Content from git.kernel.org_5bca893f_20250114_182508.html ===


| [cgit logo](/) | [index](/) : [kernel/git/netdev/net.git](/pub/scm/linux/kernel/git/netdev/net.git/) | main |
| --- | --- | --- |
| Netdev Group's networking tree | Netdev Group |

| [about](/pub/scm/linux/kernel/git/netdev/net.git/about/)[summary](/pub/scm/linux/kernel/git/netdev/net.git/)[refs](/pub/scm/linux/kernel/git/netdev/net.git/refs/?id=481221775d53)[log](/pub/scm/linux/kernel/git/netdev/net.git/log/)[tree](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=481221775d53)[commit](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=481221775d53)[diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=481221775d53)[stats](/pub/scm/linux/kernel/git/netdev/net.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Haimin Zhang <tcs.kernel@gmail.com> | 2021-12-15 19:15:30 +0800 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2021-12-15 17:49:13 -0800 |
| commit | [481221775d53d6215a6e5e9ce1cce6d2b4ab9a46](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=481221775d53d6215a6e5e9ce1cce6d2b4ab9a46) ([patch](/pub/scm/linux/kernel/git/netdev/net.git/patch/?id=481221775d53d6215a6e5e9ce1cce6d2b4ab9a46)) | |
| tree | [3e90ccb18df415c98980ff8a0f7bc92f658bd20b](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=481221775d53) | |
| parent | [972ce7e3801e790bb348bfe98be1ab65af15bacd](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=972ce7e3801e790bb348bfe98be1ab65af15bacd) ([diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=481221775d53&id2=972ce7e3801e790bb348bfe98be1ab65af15bacd)) | |
| download | [net-481221775d53.tar.gz](/pub/scm/linux/kernel/git/netdev/net.git/snapshot/net-481221775d53.tar.gz) | |

netdevsim: Zero-initialize memory for new map's value in function nsim\_bpf\_map\_allocZero-initialize memory for new map's value in function nsim\_bpf\_map\_alloc
since it may cause a potential kernel information leak issue, as follows:
1. nsim\_bpf\_map\_alloc calls nsim\_map\_alloc\_elem to allocate elements for
a new map.
2. nsim\_map\_alloc\_elem uses kmalloc to allocate map's value, but doesn't
zero it.
3. A user application can use IOCTL BPF\_MAP\_LOOKUP\_ELEM to get specific
element's information in the map.
4. The kernel function map\_lookup\_elem will call bpf\_map\_copy\_value to get
the information allocated at step-2, then use copy\_to\_user to copy to the
user buffer.
This can only leak information for an array map.
Fixes: 395cacb5f1a0 ("netdevsim: bpf: support fake map offload")
Suggested-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Haimin Zhang <tcs.kernel@gmail.com>
Link: [https://lore.kernel.org/r/20211215111530.72103-1-tcs.kernel@gmail.com](https://lore.kernel.org/r/20211215111530.72103-1-tcs.kernel%40gmail.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=481221775d53)

| -rw-r--r-- | [drivers/net/netdevsim/bpf.c](/pub/scm/linux/kernel/git/netdev/net.git/diff/drivers/net/netdevsim/bpf.c?id=481221775d53) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/net/netdevsim/bpf.c b/drivers/net/netdevsim/bpf.cindex 90aafb56f1409e..a4382021293238 100644--- a/[drivers/net/netdevsim/bpf.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/drivers/net/netdevsim/bpf.c?id=972ce7e3801e790bb348bfe98be1ab65af15bacd)+++ b/[drivers/net/netdevsim/bpf.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/drivers/net/netdevsim/bpf.c?id=481221775d53d6215a6e5e9ce1cce6d2b4ab9a46)@@ -514,6 +514,7 @@ nsim\_bpf\_map\_alloc(struct netdevsim \*ns, struct bpf\_offloaded\_map \*offmap) goto err\_free; key = nmap->entry[i].key; \*key = i;+ memset(nmap->entry[i].value, 0, offmap->map.value\_size); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:23:45 +0000


