=== Content from bugzilla.redhat.com_39d37b72_20250115_081644.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2026484)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2026484)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2026484)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2026484

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2026484**](show_bug.cgi?id=2026484)
(CVE-2021-4023)
- [CVE-2021-4023](https://access.redhat.com/security/cve/CVE-2021-4023) kernel: Improper IO-uring request cancellation operation allows local users to cause a crash

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-4023 kernel: Improper IO-uring request cancellation operation allows...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-4023 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2026810](show_bug.cgi?id=2026810 "CLOSED ERRATA - CVE-2021-4023 kernel: Improper IO-uring request cancellation operation allows local users to cause a crash [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2026547](show_bug.cgi?id=2026547) [2026790](show_bug.cgi?id=2026790) | | TreeView+ | [depends on](buglist.cgi?bug_id=2026484&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2026484&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-11-24 19:57 UTC by Pedro Sampaio | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-03-01 17:42 UTC ([History](show_activity.cgi?id=2026484)) | | [CC List:](page.cgi?id=fields.html#cclist) | 42 users (show)  acaringi adscvr airlied alciregi bhu brdeoliv bskeggs chwhite crwood dhoward dvlasenk fhrbata fpacheco hdegoede hkrzesin jarod jarodwilson jburrell jeremy jforbes jglisse jlelli jonathan josef jshortt jstancek jwboyer kcarcia kernel-maint kernel-mgr lgoncalv linville masami256 mchehab nmurray ptalbert qzhao rvrbovsk steved vkumar walters williams | | Fixed In Version: | kernel 5.15rc1 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in the io-workqueue implementation in the Linux kernel. The kernel can panic when an improper cancellation operation triggers the submission of new io-uring operations during a shortage of free space. This flaw allows a local user with permissions to execute io-uring requests to possibly crash the system. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-11-26 15:54:34 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2026484#c0)  Pedro Sampaio    2021-11-24 19:57:30 UTC  ``` A flaw was found in the io-workqueue implementation in the Linux kernel. The kernel can panic when an improper cancellation operation triggers the submission of new io-uring operations during  a shortage of free space.   This allows a local user with permissions to execute io-uring requests to possible crash the system.  Statement:  Red Hat has not implemented io-uring in any shipping products however it appears to be enabled in the Fedora Project.  References:  <https://git.kernel.dk/cgit/linux-block/commit/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e> <https://lkml.org/lkml/2021/9/8/64>   ```  [Comment 5](show_bug.cgi?id=2026484#c5)  Wade Mealing    2021-11-26 01:32:24 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 2026810](show_bug.cgi?id=2026810 "CLOSED ERRATA - CVE-2021-4023 kernel: Improper IO-uring request cancellation operation allows local users to cause a crash [fedora-all]")]   ```  [Comment 6](show_bug.cgi?id=2026484#c6)  Product Security DevOps Team    2021-11-26 15:54:30 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2021-4023>   ```  [Comment 7](show_bug.cgi?id=2026484#c7)  Justin M. Forbes    2021-11-29 17:33:23 UTC  ``` This was fixed for Fedora with the 5.14.6 stable kernel updates.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2026484&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_b6d01139_20250115_131639.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from lkml.org_d336cd56_20250115_131639.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2021]](/lkml/2021) Â  [[Sep]](/lkml/2021/9) Â  [[8]](/lkml/2021/9/8) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2021/9/8/64)Â  [[forward]](/lkml/bounce/2021/9/8/64)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2021/9/8/64) * [Hao Sun](/lkml/2021/9/8/190)   + [Pavel Begunkov](/lkml/2021/9/8/190)   + [Pavel Begunkov](/lkml/2021/9/8/814) | / | | | From | Hao Sun <> | | --- | --- | | Date | Wed, 8 Sep 2021 14:46:29 +0800 | | Subject | WARNING in io\_wq\_submit\_work | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` Hello,When using Healer to fuzz the latest Linux kernel, the following crashwas triggered.HEAD commit: 4b93c544e90e-thunderbolt: test: split up test casesgit tree: upstreamconsole output:<https://drive.google.com/file/d/1RZfBThifWgo2CiwPTeNzYG4P0gkZlINT/view?usp=sharing>kernel config: <https://drive.google.com/file/d/1c0u2EeRDhRO-ZCxr9MP2VvAtJd6kfg-p/view?usp=sharing>C reproducer: <https://drive.google.com/file/d/18LXBclar1FlOngPkayjq8k-vKcw-SR98/view?usp=sharing>Syzlang reproducer:<https://drive.google.com/file/d/1rUgX8kHPhxiYHIbuhZnDZknDe1DzDmhd/view?usp=sharing>Similar report:<https://groups.google.com/u/1/g/syzkaller-bugs/c/siEpifWtNAw/m/IkUK1DmOCgAJ>If you fix this issue, please add the following tag to the commit:Reported-by: Hao Sun <sunhao.th@gmail.com>FAULT_INJECTION: forcing a failure.name failslab, interval 1, probability 0, space 0, times 0CPU: 2 PID: 11607 Comm: syz-executor Not tainted 5.14.0+ #1Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS1.13.0-1ubuntu1.1 04/01/2014Call Trace: __dump_stack lib/dump_stack.c:88 [inline] dump_stack_lvl+0xcd/0x134 lib/dump_stack.c:105 fail_dump lib/fault-inject.c:52 [inline] should_fail.cold+0x5/0xa lib/fault-inject.c:146 should_failslab+0x5/0x10 mm/slab_common.c:1326 slab_pre_alloc_hook mm/slab.h:494 [inline] slab_alloc_node mm/slub.c:2880 [inline] kmem_cache_alloc_node+0x67/0x380 mm/slub.c:2995 alloc_task_struct_node kernel/fork.c:171 [inline] dup_task_struct kernel/fork.c:883 [inline] copy_process+0x5df/0x73d0 kernel/fork.c:2027 create_io_thread+0xb6/0xf0 kernel/fork.c:2533 create_io_worker+0x25a/0x540 fs/io-wq.c:758 io_wqe_create_worker fs/io-wq.c:267 [inline] io_wqe_enqueue+0x68c/0xba0 fs/io-wq.c:866 io_queue_async_work+0x28b/0x5d0 fs/io_uring.c:1473 __io_queue_sqe+0x6c3/0xc70 fs/io_uring.c:6933 io_queue_sqe fs/io_uring.c:6951 [inline] io_submit_state_end fs/io_uring.c:7141 [inline] io_submit_sqes+0x1da4/0x9c00 fs/io_uring.c:7245 __do_sys_io_uring_enter fs/io_uring.c:9875 [inline] __se_sys_io_uring_enter fs/io_uring.c:9817 [inline] __x64_sys_io_uring_enter+0x7a9/0xe80 fs/io_uring.c:9817 do_syscall_x64 arch/x86/entry/common.c:50 [inline] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP: 0033:0x4739cdCode: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3 0f 1e fa 48 89 f8 4889 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48RSP: 002b:00007eff5bd9dc58 EFLAGS: 00000246 ORIG_RAX: 00000000000001aaRAX: ffffffffffffffda RBX: 000000000059c0a0 RCX: 00000000004739cdRDX: 0000000000000000 RSI: 000000000000450c RDI: 0000000000000003RBP: 00007eff5bd9dc90 R08: 0000000000000000 R09: 0000000000000000R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000002R13: 00007ffc1b637edf R14: 00007ffc1b638080 R15: 00007eff5bd9ddc0------------[ cut here ]------------WARNING: CPU: 2 PID: 11607 at fs/io_uring.c:1164 req_ref_getfs/io_uring.c:1164 [inline]WARNING: CPU: 2 PID: 11607 at fs/io_uring.c:1164io_wq_submit_work+0x2b4/0x310 fs/io_uring.c:6731Modules linked in:CPU: 2 PID: 11607 Comm: syz-executor Not tainted 5.14.0+ #1Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS1.13.0-1ubuntu1.1 04/01/2014RIP: 0010:req_ref_get fs/io_uring.c:1164 [inline]RIP: 0010:io_wq_submit_work+0x2b4/0x310 fs/io_uring.c:6731Code: 49 89 c5 0f 84 5b fe ff ff e8 b8 14 91 ff 4c 89 ef e8 80 f3 ffff e9 49 fe ff ff e8 a6 14 91 ff e9 85 fe ff ff e8 9c 14 91 ff <0f> 0beb a7 4c 89 f7 e8 f0 93 d8 ff e9 79 fd ff ff 4c 89 ef e8 53RSP: 0018:ffffc90009e4f868 EFLAGS: 00010246RAX: 0000000000000000 RBX: 000000000000007f RCX: ffff8881025b8000RDX: 0000000000000000 RSI: ffff8881025b8000 RDI: 0000000000000002RBP: ffff888025a43238 R08: ffffffff81e50ba4 R09: 000000000000007fR10: 0000000000000005 R11: ffffed1004b4863b R12: ffff888025a43180R13: ffff888025a431dc R14: ffff888025a431d8 R15: 0000000000100000FS:  00007eff5bd9e700(0000) GS:ffff888063f00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 000000000330ac48 CR3: 000000002ef85000 CR4: 0000000000350ee0Call Trace: io_run_cancel fs/io-wq.c:809 [inline] io_acct_cancel_pending_work.isra.0+0x2c0/0x640 fs/io-wq.c:950 io_wqe_cancel_pending_work+0x6c/0x130 fs/io-wq.c:968 io_wq_destroy fs/io-wq.c:1185 [inline] io_wq_put_and_exit+0x78c/0xc10 fs/io-wq.c:1198 io_uring_clean_tctx fs/io_uring.c:9607 [inline] io_uring_cancel_generic+0x5fe/0x740 fs/io_uring.c:9687 io_uring_files_cancel include/linux/io_uring.h:16 [inline] do_exit+0x25c/0x2dd0 kernel/exit.c:780 do_group_exit+0x125/0x340 kernel/exit.c:922 get_signal+0x4d5/0x25a0 kernel/signal.c:2868 arch_do_signal_or_restart+0x2ed/0x1c40 arch/x86/kernel/signal.c:865 handle_signal_work kernel/entry/common.c:148 [inline] exit_to_user_mode_loop kernel/entry/common.c:172 [inline] exit_to_user_mode_prepare+0x192/0x2a0 kernel/entry/common.c:209 __syscall_exit_to_user_mode_work kernel/entry/common.c:291 [inline] syscall_exit_to_user_mode+0x19/0x60 kernel/entry/common.c:302 do_syscall_64+0x42/0xb0 arch/x86/entry/common.c:86 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP: 0033:0x4739cdCode: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3 0f 1e fa 48 89 f8 4889 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48RSP: 002b:00007eff5bd9dcd8 EFLAGS: 00000246 ORIG_RAX: 00000000000000caRAX: fffffffffffffe00 RBX: 000000000059c0a0 RCX: 00000000004739cdRDX: 0000000000000000 RSI: 0000000000000080 RDI: 000000000059c0a8RBP: 000000000059c0a8 R08: 0000000000000000 R09: 0000000000000000R10: 0000000000000000 R11: 0000000000000246 R12: 000000000059c0acR13: 00007ffc1b637edf R14: 00007ffc1b638080 R15: 00007eff5bd9ddc0% ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2021-09-08 08:47 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from git.kernel.dk_c7861b9b_20250115_131641.html ===


| [cgit logo](/cgit/) | [index](/cgit/) : [linux-block](/cgit/linux-block/) | 5.10-stable-backport.2 5.10-stable-backport.3 5.15-stable 5.7-stable 5.8-stable 5.9-stable aio-buffered aio-dio aio-dio-3.7 aio-poll aio-poll-ring aio-poll.v1 aio-ring arch-cleanup async-buffered async-buffered.2 async-buffered.3 async-buffered.4 async-buffered.5 async-buffered.6 async-buffered.7 async-buffered.8 async-readahead barrier binject bio-cnt blk-alloc-optimize blk-dio blk-iopoll blk-kill-atomic-flags blk-mq-legacy-sched blk-mq-legacy-sched.1 blk-mq-legacy-sched.2 blk-mq-nvme blk-mq-sched blk-mq-sched.1 blk-mq-sched.2 blk-mq-sched.3 blk-mq-sched.4 blk-mq-sched.5 blk-mq-sched.6 blk-mq-sched.7 blk-mq/core blk-mq/drivers blk-mq/misc blk-polled-io blk-polled-io-v2 blktrace block-5.10 block-5.11 block-5.12 block-5.13 block-5.14 block-5.15 block-5.16 block-5.17 block-5.18 block-5.19 block-5.5 block-5.5-next block-5.6 block-5.7 block-5.8 block-5.9 block-6.0 block-6.1 block-6.10 block-6.11 block-6.12 block-6.13 block-6.2 block-6.3 block-6.4 block-6.5 block-6.6 block-6.7 block-6.8 block-6.9 block-deadline block-issue-ts block-test btrace-fault buffered-uncached buffered-uncached-6.12.8 buffered-uncached-fs.10 buffered-uncached.10 buffered-uncached.2 buffered-uncached.3 buffered-uncached.4 buffered-uncached.5 buffered-uncached.6 buffered-uncached.7 buffered-uncached.8 buffered-uncached.9 cmdfilter cpu-alloc-cache dio-mem-align discard-rw epoll-min\_ts epoll-min\_ts.2 fastpoll-mshot fcache fmode\_nowait for-2.6.37/barrier for-2.6.37/core for-2.6.37/drivers for-2.6.37/misc for-2.6.38/core for-2.6.38/drivers for-2.6.38/event-handling for-2.6.38/multiqueue for-2.6.39/core for-2.6.39/drivers for-2.6.39/ioc-rq-alloc for-2.6.39/stack-plug for-2.6.40/core for-2.6.40/drivers for-2.6.40/splice for-3.1/core for-3.1/drivers for-3.10/core for-3.10/drivers for-3.11/core for-3.11/drivers for-3.12/core for-3.12/drivers for-3.13/core for-3.13/drivers for-3.13/post-mq-drivers for-3.14/core for-3.14/drivers for-3.15/core for-3.15/drivers for-3.16/blk-mq-drivers for-3.16/blk-mq-tagging for-3.16/core for-3.16/drivers for-3.16/rq-buffer-removal for-3.17/core for-3.17/drivers for-3.18/core for-3.18/drivers for-3.19/core for-3.19/drivers for-3.2/core for-3.2/drivers for-3.2/mtip32xx for-3.20/bdi for-3.20/core for-3.20/drivers for-3.3/core for-3.3/drivers for-3.3/mtip32xx for-3.4/core for-3.4/drivers for-3.5/core for-3.5/drivers for-3.6/core for-3.6/drivers for-3.7/core for-3.8/core for-3.8/drivers for-3.9/core for-3.9/drivers for-4.1/core for-4.1/drivers for-4.10/block for-4.10/dio for-4.10/discard for-4.10/fs-unmap for-4.10/hch-dio for-4.10/lightnvm for-4.10/merge for-4.10/post for-4.10/start-stop-queues for-4.10/wb-buf-throttle for-4.10/wbt-updates for-4.11/blk-mq-legacy-sched for-4.11/block for-4.11/linus-merge for-4.11/next for-4.11/review for-4.11/rq-refactor for-4.11/rq-refactor-next for-4.12/block for-4.12/post-merge for-4.12/test for-4.13/block for-4.13/merge for-4.14/block for-4.14/block-postmerge for-4.15/block for-4.15/timer for-4.16/block for-4.17/block for-4.17/merged for-4.18/block for-4.19/block for-4.19/block-old for-4.19/post for-4.19/wbt for-4.2/core for-4.2/drivers for-4.2/sg for-4.2/writeback for-4.20/block for-4.20/libata for-4.21/aio for-4.21/block for-4.21/block-late for-4.21/libata for-4.21/libata-late for-4.3/bio-error for-4.3/blkcg for-4.3/core for-4.3/drivers for-4.3/immutable-vecs for-4.3/sg for-4.4/core for-4.4/drivers for-4.4/integrity for-4.4/io-poll for-4.4/lightnvm for-4.4/reservations for-4.5/core for-4.5/drivers for-4.5/lightnvm for-4.5/nvme for-4.6/core for-4.6/drivers for-4.6/drivers-merged for-4.7/core for-4.7/drivers for-4.7/lightnvm for-4.8/bi\_opf for-4.8/bi\_rwf for-4.8/core for-4.8/drivers for-4.9/block for-4.9/block-irq for-4.9/block-smp for-4.9/mq-async-run for-5.1/block for-5.1/block-post for-5.1/libata for-5.10/block for-5.10/drivers for-5.10/io\_uring for-5.10/libata for-5.11/block for-5.11/block-merged for-5.11/drivers for-5.11/io\_uring for-5.12/block for-5.12/block-ipi for-5.12/drivers for-5.12/io\_uring for-5.12/libata for-5.13/block for-5.13/drivers for-5.13/drivers-post-merge for-5.13/io\_uring for-5.13/libata for-5.14/block for-5.14/drivers for-5.14/drivers-late for-5.14/io\_uring for-5.14/libata for-5.15/block for-5.15/drivers for-5.15/io\_uring for-5.15/io\_uring-vfs for-5.15/libata for-5.16/bdev-size for-5.16/block for-5.16/cdrom for-5.16/drivers for-5.16/inode-sync for-5.16/io\_uring for-5.16/ki\_complete for-5.16/passthrough-flag for-5.16/scsi-ma for-5.17/block for-5.17/drivers for-5.17/io\_uring for-5.17/io\_uring-getdents64 for-5.17/io\_uring-xattr for-5.18/64bit-pi for-5.18/alloc-cleanups for-5.18/block for-5.18/drivers for-5.18/io\_uring for-5.18/io\_uring-statx for-5.18/write-streams for-5.19/block for-5.19/block-exec for-5.19/cdrom for-5.19/drivers for-5.19/io\_uring for-5.19/io\_uring-cancel\_fd for-5.19/io\_uring-fixed-alloc for-5.19/io\_uring-huge for-5.19/io\_uring-net for-5.19/io\_uring-passthrough for-5.19/io\_uring-pbuf for-5.19/io\_uring-socket for-5.19/io\_uring-xattr for-5.19/writeback for-5.2/block for-5.2/block-post for-5.2/io\_uring for-5.2/libata for-5.20/block for-5.20/block-iter for-5.20/drivers for-5.20/drivers-post for-5.20/io\_uring for-5.20/io\_uring-buffered-writes for-5.20/io\_uring-cancel for-5.20/io\_uring-iter for-5.20/io\_uring-msg-fd for-5.20/io\_uring-tw for-5.20/io\_uring-zerocopy-send for-5.3/block for-5.3/io\_uring for-5.3/libata for-5.4/block for-5.4/io\_uring for-5.4/libata for-5.4/post for-5.5/block for-5.5/disk-revalidate for-5.5/drivers for-5.5/drivers-post for-5.5/io\_uring for-5.5/io\_uring-post for-5.5/io\_uring-test for-5.5/libata for-5.5/zoned for-5.6/block for-5.6/block-test for-5.6/drivers for-5.6/io\_uring for-5.6/io\_uring-epoll-test for-5.6/io\_uring-vfs for-5.6/io\_uring-vfs-creds for-5.6/io\_uring-vfs-next for-5.6/io\_uring-vfs-shared-wq for-5.6/io\_uring-vfs-wq for-5.6/libata for-5.7/block for-5.7/drivers for-5.7/io\_uring for-5.7/libata for-5.8/block for-5.8/drivers for-5.8/io\_uring for-5.9/block for-5.9/block-fs for-5.9/block-merge for-5.9/drivers for-5.9/io\_uring for-6.1/block for-6.1/io\_uring for-6.1/io\_uring-late for-6.1/passthrough for-6.10/block for-6.10/io\_uring for-6.11/block for-6.11/block-limits for-6.11/block-post for-6.11/io\_uring for-6.12/block for-6.12/io\_uring for-6.12/io\_uring-discard for-6.13/block for-6.13/block-atomic for-6.13/io\_uring for-6.14/block for-6.14/io\_uring for-6.2/block for-6.2/io\_uring for-6.2/io\_uring-next for-6.2/writeback for-6.3/block for-6.3/block-merged for-6.3/dio for-6.3/io\_uring for-6.3/iov-extract for-6.3/iter-ubuf for-6.4/block for-6.4/io\_uring for-6.4/splice for-6.5/block for-6.5/block-late for-6.5/io\_uring for-6.5/splice for-6.6/block for-6.6/io\_uring for-6.7/block for-6.7/io\_uring for-6.7/io\_uring-sockopt for-6.8/block for-6.8/io\_uring for-6.9/block for-6.9/io\_uring for-current for-linus for-linus-next for-linus2 for-next i\_dio\_count ide-5.11 inode-dio-wait io-streamid io\_uring io\_uring-5.10 io\_uring-5.10-next io\_uring-5.11 io\_uring-5.12 io\_uring-5.13 io\_uring-5.14 io\_uring-5.14-test io\_uring-5.15 io\_uring-5.16 io\_uring-5.17 io\_uring-5.18 io\_uring-5.19 io\_uring-5.5 io\_uring-5.6 io\_uring-5.6-poll io\_uring-5.7 io\_uring-5.8 io\_uring-5.9 io\_uring-6.0 io\_uring-6.1 io\_uring-6.10 io\_uring-6.11 io\_uring-6.12 io\_uring-6.13 io\_uring-6.2 io\_uring-6.3 io\_uring-6.4 io\_uring-6.5 io\_uring-6.6 io\_uring-6.7 io\_uring-6.8 io\_uring-6.9 io\_uring-big-sqe io\_uring-bio-cache io\_uring-bio-cache.2 io\_uring-bio-cache.3 io\_uring-bio-cache.4 io\_uring-bio-cache.5 io\_uring-bio-cache.6 io\_uring-buf-select io\_uring-bundle io\_uring-cancel-op io\_uring-cur io\_uring-defer-tw io\_uring-eventfd io\_uring-exit-cancel io\_uring-fd-pass io\_uring-fd-select io\_uring-files\_struct io\_uring-flags2 io\_uring-fops io\_uring-fops.v2 io\_uring-fops.v3 io\_uring-fops.v4 io\_uring-fops.v5 io\_uring-fops.v6 io\_uring-fops.v7 io\_uring-futex io\_uring-group io\_uring-ignore-inline io\_uring-irq io\_uring-iter io\_uring-min-wait io\_uring-min\_ts io\_uring-msg-ring.1 io\_uring-msg\_ring io\_uring-mshot-read io\_uring-napi io\_uring-net-coalesce io\_uring-next io\_uring-pbuf-partial io\_uring-poll-table io\_uring-recvsend-bundle io\_uring-reg-wait io\_uring-ring-alloc io\_uring-ring-map io\_uring-ring-resize io\_uring-rsrc io\_uring-rsrc.1 io\_uring-rsrc.2 io\_uring-rsrc.3 io\_uring-rsrc.4 io\_uring-rw-retry io\_uring-sched-submit io\_uring-send-queue io\_uring-sendzc-provided io\_uring-sync-issue io\_uring-sync-msg\_ring io\_uring-task-poll io\_uring-test io\_uring-tw io\_uring-waitid io\_uring-worker io\_uring-worker.v2 io\_uring-worker.v3 io\_uring-worker.v4 io\_uring-wq-lock iov-iter iov-misc iov\_iter iov\_iter.2 iov\_iter.3 iowait iowait.2 iowait.3 iowait.4 iter-ubuf iter-ubuf.2 leak libata-5.10 libata-5.14 libata-5.15 libata-5.5 libata-5.6 libata-5.7 libata-5.8 libata-5.9 libata-eh libata-pio libata-qd32 loop-dio loop-direct loop-extent\_map loop-fastfs lsi-scsi-mq m1-test m1-test-nvme m1/2022-02-19 m1/2022-02-20 m1/2022-03-01 master misc misc-5.12 misc-5.15 misc-next mq-conversions mq-deadline mq-inflight mq-inflight.2 mq-maps mq-perf mq-stats mtip multiqueue net-accept-more new-queue-20130523 new-queue-mtip32xx no-cache-io no-ipi nonblock-path-lookup nvme-4.18 nvme-passthru-wip nvme-passthru-wip.2 odirect-pcache one-queue-per-device ovl-kiocb perf-wip perf-wip.2 pgo pipe-nonblock pipe-nonblock.2 plug poll-multiple random-splice read-ahead read\_iter readpages-ahead readpages-ahead-args rw\_iter sbitmap-wake splice swap-fix syslet syslet-share syz-test syzbot-test syztest task\_work tglx tif-notify-signal tif-task\_work tif-task\_work.3 tif-task\_work.arch tw-test v3.10-blk-mq v3.10-lsi-mq v3.10-scsi-mq v3.10-stable wb-buf-throttle wb-buf-throttle-v2 wb-buf-throttle-v3 wb-buf-throttle-v4 wb-buf-throttle-v4.6 wb-buf-throttle-v4.7 wb-buf-throttle-v4.8 wb-buf-throttle-v5 wb-buf-throttle-v6 wb-buf-throttle-v7 wb-next wb-start-all wbt-discard wbt-odirect workqueue wq-no-manager write-stream write-stream.1 write-stream.10 write-stream.2 write-stream.3 write-stream.4 write-stream.5 write-stream.6 write-stream.7 write-stream.8 write-stream.9 writeback xfs-async-dio xfs-async-dio.2 xfs-async-dio.3 xfs-async-dio.4 xfs-async-dio.5 xfs-async-dio.6 |
| --- | --- | --- |
| Linux 6.x block layer and io\_uring tree(s) | axboe@kernel.dk |

| [summary](/cgit/linux-block/?h=io_uring-5.15)[refs](/cgit/linux-block/refs/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e)[log](/cgit/linux-block/log/?h=io_uring-5.15)[tree](/cgit/linux-block/tree/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e)[commit](/cgit/linux-block/commit/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e)[diff](/cgit/linux-block/diff/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavel Begunkov <asml.silence@gmail.com> | 2021-09-08 10:09:29 +0100 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@kernel.dk> | 2021-09-08 06:34:57 -0600 |
| commit | [713b9825a4c47897f66ad69409581e7734a8728e](/cgit/linux-block/commit/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e) ([patch](/cgit/linux-block/patch/?id=713b9825a4c47897f66ad69409581e7734a8728e)) | |
| tree | [c997b0660d1e1e53973ddb4f90ff5e45802306fd](/cgit/linux-block/tree/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e) | |
| parent | [626bf91a292e2035af5b9d9cce35c5c138dfe06d](/cgit/linux-block/commit/?h=io_uring-5.15&id=626bf91a292e2035af5b9d9cce35c5c138dfe06d) ([diff](/cgit/linux-block/diff/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e&id2=626bf91a292e2035af5b9d9cce35c5c138dfe06d)) | |

io-wq: fix cancellation on create-worker failureWARNING: CPU: 0 PID: 10392 at fs/io\_uring.c:1151 req\_ref\_put\_and\_test
fs/io\_uring.c:1151 [inline]
WARNING: CPU: 0 PID: 10392 at fs/io\_uring.c:1151 req\_ref\_put\_and\_test
fs/io\_uring.c:1146 [inline]
WARNING: CPU: 0 PID: 10392 at fs/io\_uring.c:1151
io\_req\_complete\_post+0xf5b/0x1190 fs/io\_uring.c:1794
Modules linked in:
Call Trace:
tctx\_task\_work+0x1e5/0x570 fs/io\_uring.c:2158
task\_work\_run+0xe0/0x1a0 kernel/task\_work.c:164
tracehook\_notify\_signal include/linux/tracehook.h:212 [inline]
handle\_signal\_work kernel/entry/common.c:146 [inline]
exit\_to\_user\_mode\_loop kernel/entry/common.c:172 [inline]
exit\_to\_user\_mode\_prepare+0x232/0x2a0 kernel/entry/common.c:209
\_\_syscall\_exit\_to\_user\_mode\_work kernel/entry/common.c:291 [inline]
syscall\_exit\_to\_user\_mode+0x19/0x60 kernel/entry/common.c:302
do\_syscall\_64+0x42/0xb0 arch/x86/entry/common.c:86
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
When io\_wqe\_enqueue() -> io\_wqe\_create\_worker() fails, we can't just
call io\_run\_cancel() to clean up the request, it's already enqueued via
io\_wqe\_insert\_work() and will be executed either by some other worker
during cancellation (e.g. in io\_wq\_put\_and\_exit()).
Reported-by: Hao Sun <sunhao.th@gmail.com>
Fixes: 3146cba99aa28 ("io-wq: make worker creation resilient against signals")
Signed-off-by: Pavel Begunkov <asml.silence@gmail.com>
Link: https://lore.kernel.org/r/93b9de0fcf657affab0acfd675d4abcd273ee863.1631092071.git.asml.silence@gmail.com
Signed-off-by: Jens Axboe <axboe@kernel.dk>
[Diffstat](/cgit/linux-block/diff/?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e)

| -rw-r--r-- | [fs/io-wq.c](/cgit/linux-block/diff/fs/io-wq.c?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 20 insertions, 9 deletions

| diff --git a/fs/io-wq.c b/fs/io-wq.cindex d80e4a735677..35e7ee26f7ea 100644--- a/[fs/io-wq.c](/cgit/linux-block/tree/fs/io-wq.c?h=io_uring-5.15&id=626bf91a292e2035af5b9d9cce35c5c138dfe06d)+++ b/[fs/io-wq.c](/cgit/linux-block/tree/fs/io-wq.c?h=io_uring-5.15&id=713b9825a4c47897f66ad69409581e7734a8728e)@@ -832,6 +832,11 @@ append: wq\_list\_add\_after(&work->list, &tail->list, &acct->work\_list); } +static bool io\_wq\_work\_match\_item(struct io\_wq\_work \*work, void \*data)+{+ return work == data;+}+ static void io\_wqe\_enqueue(struct io\_wqe \*wqe, struct io\_wq\_work \*work) { struct io\_wqe\_acct \*acct = io\_work\_get\_acct(wqe, work);@@ -844,7 +849,6 @@ static void io\_wqe\_enqueue(struct io\_wqe \*wqe, struct io\_wq\_work \*work) \*/ if (test\_bit(IO\_WQ\_BIT\_EXIT, &wqe->wq->state) || (work->flags & IO\_WQ\_WORK\_CANCEL)) {-run\_cancel: io\_run\_cancel(work, wqe); return; }@@ -864,15 +868,22 @@ run\_cancel: bool did\_create;  did\_create = io\_wqe\_create\_worker(wqe, acct);- if (unlikely(!did\_create)) {- raw\_spin\_lock(&wqe->lock);- /\* fatal condition, failed to create the first worker \*/- if (!acct->nr\_workers) {- raw\_spin\_unlock(&wqe->lock);- goto run\_cancel;- }- raw\_spin\_unlock(&wqe->lock);+ if (likely(did\_create))+ return;++ raw\_spin\_lock(&wqe->lock);+ /\* fatal condition, failed to create the first worker \*/+ if (!acct->nr\_workers) {+ struct io\_cb\_cancel\_data match = {+ .fn = io\_wq\_work\_match\_item,+ .data = work,+ .cancel\_all = false,+ };++ if (io\_acct\_cancel\_pending\_work(wqe, acct, &match))+ raw\_spin\_lock(&wqe->lock); }+ raw\_spin\_unlock(&wqe->lock); } } |
| --- |

generated by [cgit v1.2.3-59-gdc87](https://git.zx2c4.com/cgit/about/) ([git 2.39.0](https://git-scm.com/)) at 2025-01-15 13:16:41 +0000



=== Content from access.redhat.com_b204446c_20250115_212218.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


