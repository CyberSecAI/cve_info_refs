=== Content from github.com_de0bd421_20250115_080323.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frizinorg%2Frizin%2Fissues%2F2015)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frizinorg%2Frizin%2Fissues%2F2015)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=rizinorg%2Frizin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rizinorg](/rizinorg)
/
**[rizin](/rizinorg/rizin)**
Public

* [Notifications](/login?return_to=%2Frizinorg%2Frizin) You must be signed in to change notification settings
* [Fork
  373](/login?return_to=%2Frizinorg%2Frizin)
* [Star
   2.8k](/login?return_to=%2Frizinorg%2Frizin)

* [Code](/rizinorg/rizin)
* [Issues
  411](/rizinorg/rizin/issues)
* [Pull requests
  50](/rizinorg/rizin/pulls)
* [Discussions](/rizinorg/rizin/discussions)
* [Actions](/rizinorg/rizin/actions)
* [Projects
  10](/rizinorg/rizin/projects)
* [Security](/rizinorg/rizin/security)
* [Insights](/rizinorg/rizin/pulse)

Additional navigation options

* [Code](/rizinorg/rizin)
* [Issues](/rizinorg/rizin/issues)
* [Pull requests](/rizinorg/rizin/pulls)
* [Discussions](/rizinorg/rizin/discussions)
* [Actions](/rizinorg/rizin/actions)
* [Projects](/rizinorg/rizin/projects)
* [Security](/rizinorg/rizin/security)
* [Insights](/rizinorg/rizin/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frizinorg%2Frizin%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frizinorg%2Frizin%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# CVE-2021-4022: Segfault when analyzing an ELF64 for HPPA architecture #2015

Closed

[OctavioGalland](/OctavioGalland) opened this issue
Nov 23, 2021
· 9 comments
 · Fixed by [#2031](https://github.com/rizinorg/rizin/pull/2031)

Closed

# [CVE-2021-4022: Segfault when analyzing an ELF64 for HPPA architecture](#top) #2015

[OctavioGalland](/OctavioGalland) opened this issue
Nov 23, 2021
· 9 comments
 · Fixed by [#2031](https://github.com/rizinorg/rizin/pull/2031)

Labels
[crash](/rizinorg/rizin/labels/crash)
[RzType](/rizinorg/rizin/labels/RzType)

## Comments

[![@OctavioGalland](https://avatars.githubusercontent.com/u/2702822?s=80&v=4)](/OctavioGalland)

Copy link

### **[OctavioGalland](/OctavioGalland)** commented [Nov 23, 2021](#issue-1061438966)

|  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Work environment With [@ogianatiempo](https://github.com/ogianatiempo) we discovered a bug which makes rizin crash when analyzing certain kind of binaries.   | Questions | Answers | | --- | --- | | OS/arch/bits (mandatory) | Ubuntu 20.04 x86\_64 64 | | File format of the file you reverse (mandatory) | ELF64 | | Architecture/bits of the file (mandatory) | HPPA | | `rizin -v` full output, **not truncated** (mandatory) | rizin 0.4.0-git @ linux-x86-64 commit: [681de8e](https://github.com/rizinorg/rizin/commit/681de8e3b21023b5a35f9eaf02960f2ef9fe96ee), build: 2021-11-23\_\_11:49:48 |  Expected behavior Running `aaa` on an ELF64 file shouldn't make rizin crash. Actual behavior Rizin segfaults. Steps to reproducebinary the behavior Run `aaa` (or start rizin with the `-A` flag) with the binary named `crash` attached below. Additional Logs, screenshots, source code, configuration dump, ... The crash happens in the file `librz/core/analysis_tp.c` at line 950. When analyzing the binary attached below, the `goto` at line 849 is executed, but then at line 950 `free` is called with `retctx.ret_reg` as an argument. The problem is that `retctx.ret_reg` only gets initialized at line 860, but that line never gets executed because the `goto` gets executed first. As a result of this, whatever was on the stack at that time gets `free`ed (for example, in the statically linked release version for linux, the block size will be the value that gets `free`ed).  So far, we've only seen the crash happen on a `HPPA` binary. In the archive attached to this issue, we modified the elf header and set the architecture to `amd64` and that binary doesn't seem to crash.  Here's a bit of information about both binaries:  ``` $ binwalk -W crash nocrash   OFFSET      crash                                                                nocrash -------------------------------------------------------------------------------- 0x00000000  7F 45 4C 46 02 30 30 30 30 30 30 30 30 30 30 30 |.ELF.00000000000| \ 7F 45 4C 46 02 30 30 30 30 30 30 30 30 30 30 30 |.ELF.00000000000| 0x00000010  30 30 0F 00 30 30 30 30 30 30 30 30 30 30 30 30 |00..000000000000| / 30 30 3E 00 30 30 30 30 30 30 30 30 30 30 30 30 |00>.000000000000| 0x00000020  40 00 00 00 00 00 00 00 30 30 30 30 30 30 30 30 |@.......00000000| \ 40 00 00 00 00 00 00 00 30 30 30 30 30 30 30 30 |@.......00000000| 0x00000030  30 30 30 30 30 30 30 30 02 00 30 30 30 30 30 30 |00000000..000000| / 30 30 30 30 30 30 30 30 02 00 30 30 30 30 30 30 |00000000..000000| 0x00000040  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| \ 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| 0x00000050  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| / 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| 0x00000060  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| \ 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| 0x00000070  30 30 30 30 30 30 30 30 01 00 00 00 05 30 30 30 |00000000.....000| / 30 30 30 30 30 30 30 30 01 00 00 00 05 30 30 30 |00000000.....000| 0x00000080  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| \ 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| 0x00000090  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| / 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| 0x000000A0  30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000| \ 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 |0000000000000000|  ```  (the only difference is the target architecture)  ``` $ readelf -h crash ...   Machine:                           HPPA ... $ readelf -h nocrash ...   Machine:                           Advanced Micro Devices X86-64 ...  ```  And here's the crash in action:  ``` $ ~/rizin/build/binrz/rizin/rizin -A crash  [x] Analyze all flags starting with sym. and entry0 (aa) [x] Analyze function calls (aac) [Skipping huge ranges of instructions for references (aar) [x] Analyze len bytes of instructions for references (aar) [x] Check for classes [x] Finding xrefs in noncode section with analysis.in=io.maps [x] Analyze value pointers (aav) [Warning: Skipping large region30 to 0x6060606060606060 (aav) [Cannot find program counter register in the current profile. [x] Emulate functions to find computed references (aaef) [Segmentation fault (core dumped)l functions (aaft)  ```  As mentioned before, the binary with `amd64` in the header works well:  ``` $ ~/rizin/build/binrz/rizin/rizin -A nocrash  [x] Analyze all flags starting with sym. and entry0 (aa) [x] Analyze function calls (aac) [Skipping huge ranges of instructions for references (aar) [x] Analyze len bytes of instructions for references (aar) [x] Check for classes [x] Type matching analysis for all functions (aaft) [x] Propagate noreturn information [x] Use -AA or aaaa to perform additional experimental analysis. [0x3030303030303030]>  ```  [binaries.zip](https://github.com/rizinorg/rizin/files/7589045/binaries.zip) |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@pelijah](https://avatars.githubusercontent.com/u/16493991?s=80&u=cc1e06c9b598e8bb75a6af5b2ac39faad0b4f82a&v=4)](/pelijah)

Copy link

Contributor

### **[pelijah](/pelijah)** commented [Nov 23, 2021](#issuecomment-977145069)

| Can't reproduce. |
| --- |

All reactions

Sorry, something went wrong.

[![@XVilka](https://avatars.githubusercontent.com/u/203261?s=80&u=1f62654dd929e7c04961142f54d270675289da7f&v=4)](/XVilka)

Copy link

Member

### **[XVilka](/XVilka)** commented [Nov 24, 2021](#issuecomment-977545423)

| Endless loop, it seems:  ``` WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) [x] Analyze all flags starting with sym. and entry0 (aa) [x] Analyze function calls (aac) [Skipping huge ranges of instructions for references (aar) [x] Analyze len bytes of instructions for references (aar) [x] Check for classes [x] Finding xrefs in noncode section with analysis.in=io.maps [x] Analyze value pointers (aav) [Warning: Skipping large region30 to 0x6060606060606060 (aav) [WARNING: rz_reg_getv: assertion 'reg && name' failed (line 302) Cannot find program counter register in the current profile. [x] Emulate functions to find computed references (aaef) [AddressSanitizer:DEADLYSIGNAL all functions (aaft) ================================================================= ==106810==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x7f616855ab36 bp 0x3030303030303030 sp 0x7ffec2e90570 T0) ==106810==The signal is caused by a READ memory access. ==106810==Hint: this fault was caused by a dereference of a high value address (see register values below).  Dissassemble the provided pc to learn which register was used.     #0 0x7f616855ab36 in __asan::asan_free(void*, __sanitizer::BufferedStackTrace*, __asan::AllocType) (/lib64/libasan.so.6+0x28b36)     #1 0x7f61685e0637 in free (/lib64/libasan.so.6+0xae637)     #2 0x7f615c673ab4 in rz_core_analysis_type_match ../librz/core/analysis_tp.c:950     #3 0x7f615c6d2f86 in rz_core_analysis_types_propagation ../librz/core/canalysis.c:7015     #4 0x7f615c6d602f in rz_core_analysis_everything ../librz/core/canalysis.c:6744     #5 0x7f615ca7e2ff in cmd_analysis_all ../librz/core/cmd/cmd_analysis.c:7439     #6 0x7f615ca7e2ff in rz_cmd_analysis ../librz/core/cmd/cmd_analysis.c:8384     #7 0x7f615caf9e65 in call_cd ../librz/core/cmd/cmd_api.c:753     #8 0x7f615caf9e65 in rz_cmd_call_parsed_args ../librz/core/cmd/cmd_api.c:768     #9 0x7f615cacd12c in handle_ts_arged_stmt_internal ../librz/core/cmd/cmd.c:3981     #10 0x7f615cacd12c in handle_ts_arged_stmt ../librz/core/cmd/cmd.c:3929     #11 0x7f615c8f11c4 in handle_ts_stmt ../librz/core/cmd/cmd.c:5429     #12 0x7f615ca2e4dd in handle_ts_statements_internal ../librz/core/cmd/cmd.c:5486     #13 0x7f615ca2e4dd in handle_ts_statements ../librz/core/cmd/cmd.c:5451     #14 0x7f615ca2f9d4 in core_cmd_tsrzcmd ../librz/core/cmd/cmd.c:5594     #15 0x7f615c9eb7b6 in rz_core_cmd ../librz/core/cmd/cmd.c:5643     #16 0x7f61679d0199 in rz_main_rizin ../librz/main/rizin.c:1317     #17 0x7f6166e0355f in __libc_start_call_main (/lib64/libc.so.6+0x2d55f)     #18 0x7f6166e0360b in __libc_start_main_alias_1 (/lib64/libc.so.6+0x2d60b)     #19 0x4018f4 in _start (/home/akochkov/.local/bin/rizin+0x4018f4)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV (/lib64/libasan.so.6+0x28b36) in __asan::asan_free(void*, __sanitizer::BufferedStackTrace*, __asan::AllocType) ==106810==ABORTING  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@OctavioGalland](https://avatars.githubusercontent.com/u/2702822?s=80&v=4)](/OctavioGalland)

Copy link

Author

### **[OctavioGalland](/OctavioGalland)** commented [Nov 24, 2021](#issuecomment-977841292)

| Can't reproduce.  Sorry, forgot to add: The crash only happens on a release build. When running a debug build, the error condition is catched by the assertion at the beginning of the function `rz_core_analysis_type_match`. |
| --- |

All reactions

Sorry, something went wrong.

[![@OctavioGalland](https://avatars.githubusercontent.com/u/2702822?s=80&v=4)](/OctavioGalland)

Copy link

Author

### **[OctavioGalland](/OctavioGalland)** commented [Nov 24, 2021](#issuecomment-977872150) • edited Loading

| Endless loop, it seems:  ``` WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) WARNING: extract_arg: assertion 'analysis && fcn && op && reg' failed (line 671) [x] Analyze all flags starting with sym. and entry0 (aa) [x] Analyze function calls (aac) [Skipping huge ranges of instructions for references (aar) [x] Analyze len bytes of instructions for references (aar) [x] Check for classes [x] Finding xrefs in noncode section with analysis.in=io.maps [x] Analyze value pointers (aav) [Warning: Skipping large region30 to 0x6060606060606060 (aav) [WARNING: rz_reg_getv: assertion 'reg && name' failed (line 302) Cannot find program counter register in the current profile. [x] Emulate functions to find computed references (aaef) [AddressSanitizer:DEADLYSIGNAL all functions (aaft) ================================================================= ==106810==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x7f616855ab36 bp 0x3030303030303030 sp 0x7ffec2e90570 T0) ==106810==The signal is caused by a READ memory access. ==106810==Hint: this fault was caused by a dereference of a high value address (see register values below).  Dissassemble the provided pc to learn which register was used.     #0 0x7f616855ab36 in __asan::asan_free(void*, __sanitizer::BufferedStackTrace*, __asan::AllocType) (/lib64/libasan.so.6+0x28b36)     #1 0x7f61685e0637 in free (/lib64/libasan.so.6+0xae637)     #2 0x7f615c673ab4 in rz_core_analysis_type_match ../librz/core/analysis_tp.c:950     #3 0x7f615c6d2f86 in rz_core_analysis_types_propagation ../librz/core/canalysis.c:7015     #4 0x7f615c6d602f in rz_core_analysis_everything ../librz/core/canalysis.c:6744     #5 0x7f615ca7e2ff in cmd_analysis_all ../librz/core/cmd/cmd_analysis.c:7439     #6 0x7f615ca7e2ff in rz_cmd_analysis ../librz/core/cmd/cmd_analysis.c:8384     #7 0x7f615caf9e65 in call_cd ../librz/core/cmd/cmd_api.c:753     #8 0x7f615caf9e65 in rz_cmd_call_parsed_args ../librz/core/cmd/cmd_api.c:768     #9 0x7f615cacd12c in handle_ts_arged_stmt_internal ../librz/core/cmd/cmd.c:3981     #10 0x7f615cacd12c in handle_ts_arged_stmt ../librz/core/cmd/cmd.c:3929     #11 0x7f615c8f11c4 in handle_ts_stmt ../librz/core/cmd/cmd.c:5429     #12 0x7f615ca2e4dd in handle_ts_statements_internal ../librz/core/cmd/cmd.c:5486     #13 0x7f615ca2e4dd in handle_ts_statements ../librz/core/cmd/cmd.c:5451     #14 0x7f615ca2f9d4 in core_cmd_tsrzcmd ../librz/core/cmd/cmd.c:5594     #15 0x7f615c9eb7b6 in rz_core_cmd ../librz/core/cmd/cmd.c:5643     #16 0x7f61679d0199 in rz_main_rizin ../librz/main/rizin.c:1317     #17 0x7f6166e0355f in __libc_start_call_main (/lib64/libc.so.6+0x2d55f)     #18 0x7f6166e0360b in __libc_start_main_alias_1 (/lib64/libc.so.6+0x2d60b)     #19 0x4018f4 in _start (/home/akochkov/.local/bin/rizin+0x4018f4)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV (/lib64/libasan.so.6+0x28b36) in __asan::asan_free(void*, __sanitizer::BufferedStackTrace*, __asan::AllocType) ==106810==ABORTING  ```  This is a similar output to the one we saw when we tested this using asan. But I think this isn't an infinite loop: at first a bunch of warnings are produced, but then asan detects a read at an invalid address (that read is triggered by the line `analysis_tp.c:950`, which is a call to `free`). If asan wasn't enabled, it would have resulted in a segfault.  Another way to test this is to debug it and set a breakpoint at `rz_core_analysis_type_match`, and then step a few times until it hits line 950, where the invalid `free` should take place. When we debugged it we noticed the following: At line 848:  ``` 	if (!pc) { 		goto out_function; // <---- this goto gets executed 	} ```  The goto leads to line 949:  ``` out_function: 	free(retctx.ret_reg); ```  Skipping the definition of `retctx.ret_reg` at line 860 (which should have been executed before the goto):  ``` 	// Create a new context to store the return type propagation state 	struct ReturnTypeAnalysisCtx retctx = { 		.resolved = false, 		.ret_type = NULL, 		.ret_reg = NULL 	}; ```  Since the invalid free corresponds to an uninitialized variable, depending on the build the severity of the bug changes. For instance, when compiling a release build using the last commit we were able to control the address being `free`ed too (by changing the block size), which could potentially lead to security concerns:  [asciicast](https://asciinema.org/a/5KBhoep7DpMR417jv1NZtMLk9) |
| --- |

All reactions

Sorry, something went wrong.

[![@ret2libc](https://avatars.githubusercontent.com/u/562321?s=40&u=fe8de9fa20540877d7dcf11f7c229452a6a1c70d&v=4)](/ret2libc)
[ret2libc](/ret2libc)
changed the title
~~Segfault when analyzing an ELF64 for HPPA architecture~~
CVE-2021-4022: Segfault when analyzing an ELF64 for HPPA architecture
[Nov 26, 2021](#event-5677850922)

[![@ret2libc](https://avatars.githubusercontent.com/u/562321?s=80&u=fe8de9fa20540877d7dcf11f7c229452a6a1c70d&v=4)](/ret2libc)

Copy link

Member

### **[ret2libc](/ret2libc)** commented [Nov 26, 2021](#issuecomment-979998845)

| [@OctavioGalland](https://github.com/OctavioGalland) I marked the CVE in the title. I think in the future we could actually just assign them ourselves from Github, WDYT [@XVilka](https://github.com/XVilka) [@wargio](https://github.com/wargio) [@thestr4ng3r](https://github.com/thestr4ng3r) [@kazarmy](https://github.com/kazarmy) ? |
| --- |

All reactions

Sorry, something went wrong.

[![@XVilka](https://avatars.githubusercontent.com/u/203261?s=80&u=1f62654dd929e7c04961142f54d270675289da7f&v=4)](/XVilka)

Copy link

Member

### **[XVilka](/XVilka)** commented [Nov 26, 2021](#issuecomment-980001362)

| [@ret2libc](https://github.com/ret2libc) yes, we did this in the past. |
| --- |

All reactions

Sorry, something went wrong.

[![@wargio](https://avatars.githubusercontent.com/u/561184?s=80&u=c001f4842b9a3906da1269e8ac0e46b95234d83d&v=4)](/wargio)

Copy link

Member

### **[wargio](/wargio)** commented [Nov 26, 2021](#issuecomment-980003916)

| sounds good to me. |
| --- |

All reactions

Sorry, something went wrong.

[![@ret2libc](https://avatars.githubusercontent.com/u/562321?s=40&u=fe8de9fa20540877d7dcf11f7c229452a6a1c70d&v=4)](/ret2libc)
[ret2libc](/ret2libc)
mentioned this issue
[Nov 26, 2021](#ref-pullrequest-1064578027)

[Initialize retctx,ctx before freeing the inner elements
#2031](/rizinorg/rizin/pull/2031)
 Merged

5 tasks

[![@wargio](https://avatars.githubusercontent.com/u/561184?s=80&u=c001f4842b9a3906da1269e8ac0e46b95234d83d&v=4)](/wargio)

Copy link

Member

### **[wargio](/wargio)** commented [Nov 26, 2021](#issuecomment-980225758)

| [@OctavioGalland](https://github.com/OctavioGalland) can you confirm that the issue has been patched? |
| --- |

All reactions

Sorry, something went wrong.

[![@OctavioGalland](https://avatars.githubusercontent.com/u/2702822?s=80&v=4)](/OctavioGalland)

Copy link

Author

### **[OctavioGalland](/OctavioGalland)** commented [Nov 29, 2021](#issuecomment-981579894)

| Yes, it's been fixed. Thanks! |
| --- |

 ❤️
1
 wargio reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frizinorg%2Frizin%2Fissues%2F2015)

Assignees

No one assigned

Labels

[crash](/rizinorg/rizin/labels/crash)
[RzType](/rizinorg/rizin/labels/RzType)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Initialize retctx,ctx before freeing the inner elements](/rizinorg/rizin/pull/2031)
 [rizinorg/rizin](/rizinorg/rizin)

5 participants

[![@XVilka](https://avatars.githubusercontent.com/u/203261?s=52&v=4)](/XVilka) [![@wargio](https://avatars.githubusercontent.com/u/561184?s=52&v=4)](/wargio) [![@ret2libc](https://avatars.githubusercontent.com/u/562321?s=52&v=4)](/ret2libc) [![@OctavioGalland](https://avatars.githubusercontent.com/u/2702822?s=52&v=4)](/OctavioGalland) [![@pelijah](https://avatars.githubusercontent.com/u/16493991?s=52&v=4)](/pelijah)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


