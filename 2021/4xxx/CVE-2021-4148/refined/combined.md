=== Content from bugzilla.redhat.com_bb4177f2_20250115_102729.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2026487)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2026487)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2026487)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2026487

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2026487**](show_bug.cgi?id=2026487)
(CVE-2021-4148)
- [CVE-2021-4148](https://access.redhat.com/security/cve/CVE-2021-4148) kernel: Improper implementation of block\_invalidatepage() allows users to crash the kernel

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-4148 kernel: Improper implementation of block\_invalidatepage() allow...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-4148 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2034507](show_bug.cgi?id=2034507 "CLOSED ERRATA - CVE-2021-4148 kernel: Improper implementation of block_invalidatepage() allows users to crash the kernel [fedora-all]") [2034508](show_bug.cgi?id=2034508) [2034509](show_bug.cgi?id=2034509) [2034510](show_bug.cgi?id=2034510) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2026492](show_bug.cgi?id=2026492) [2034660](show_bug.cgi?id=2034660) | | TreeView+ | [depends on](buglist.cgi?bug_id=2026487&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2026487&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-11-24 20:06 UTC by Pedro Sampaio | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-05-19 11:39 UTC ([History](show_activity.cgi?id=2026487)) | | [CC List:](page.cgi?id=fields.html#cclist) | 44 users (show)  acaringi adscvr airlied alciregi aquini bhu brdeoliv bskeggs chwhite crwood dhoward dvlasenk fhrbata fpacheco hdegoede hkrzesin jarod jarodwilson jburrell jeremy jforbes jglisse jlelli jonathan josef jshortt jstancek jwboyer kcarcia kernel-maint kernel-mgr lgoncalv linville masami256 mchehab nmurray ptalbert qzhao rkeshri rvrbovsk steved vkumar walters williams | | Fixed In Version: | kernel 5.14.16 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability was found in the Linux kernel's block\_invalidatepage in fs/buffer.c in the filesystem. A missing sanity check may allow a local attacker with user privilege to cause a denial of service (DOS) problem. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-05-18 06:02:46 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2026487#c0)  Pedro Sampaio    2021-11-24 20:06:50 UTC  ``` In the Linux kernel before 5.15, improper implementation of block_invalidatepage() allows users to crash the kernel. As long as the page passed to block_invalidatepage() is a huge page and the length is the size of the huge page instead of a single page due to read-only FS THP support, the operation would throw BUG if the size is greater than a single page. Furthermore, all the implementations that are *NOT* THP aware and hardcoded PAGE_SIZE can trigger BUG(), like block_invalidatepage().  References:  <https://lkml.org/lkml/2021/9/17/1037> <https://lkml.org/lkml/2021/9/12/323>   ```  [Comment 4](show_bug.cgi?id=2026487#c4)  Rohit Keshri    2021-12-21 07:45:11 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 2034507](show_bug.cgi?id=2034507 "CLOSED ERRATA - CVE-2021-4148 kernel: Improper implementation of block_invalidatepage() allows users to crash the kernel [fedora-all]")]   ```  [Comment 11](show_bug.cgi?id=2026487#c11)  Justin M. Forbes    2022-03-16 16:28:28 UTC  ``` This issue was fixed for Fedora with the 5.14.16 stable kernel updates.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2026487&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from lkml.org_f59fc68b_20250115_140639.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2021]](/lkml/2021) Â  [[Sep]](/lkml/2021/9) Â  [[12]](/lkml/2021/9/12) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2021/9/12/323)Â  [[forward]](/lkml/bounce/2021/9/12/323)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2021/9/12/323) * [Hao Sun](/lkml/2021/9/14/487)   + [Christoph Hellwig](/lkml/2021/9/14/487)     - [Hao Sun](/lkml/2021/9/14/1653)       * [Christoph Hellwig](/lkml/2021/9/15/115)         + [Yang Shi](/lkml/2021/9/15/870) | / | | | From | Hao Sun <> | | --- | --- | | Date | Mon, 13 Sep 2021 10:00:27 +0800 | | Subject | general protection fault in wb\_timer\_fn | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` Hello,When using Healer to fuzz the latest Linux kernel, the following crashwas triggered.HEAD commit:  4b93c544e90e-thunderbolt: test: split up test casesgit tree: upstreamconsole output:<https://drive.google.com/file/d/1naN-5p-rFgKpHrshO_kQr5f_KlhvFGGU/view?usp=sharing>kernel config: <https://drive.google.com/file/d/1c0u2EeRDhRO-ZCxr9MP2VvAtJd6kfg-p/view?usp=sharing>C reproducer: <https://drive.google.com/file/d/19EDhssGw_V1oO2vWOPrgQqve0TdFSgvh/view?usp=sharing>Syzlang reproducer:<https://drive.google.com/file/d/13EGCCoaMe9oitrQCfy44BkGVLbKKFP6X/view?usp=sharing>Similar report:<https://groups.google.com/g/syzkaller-bugs/c/H7fKH_5GVSE/m/-1aj5-d1BAAJ>If you fix this issue, please add the following tag to the commit:Reported-by: Hao Sun <sunhao.th@gmail.com>general protection fault, probably for non-canonical address0xdffffc0000000029: 0000 [#1] PREEMPT SMP KASANKASAN: null-ptr-deref in range [0x0000000000000148-0x000000000000014f]CPU: 2 PID: 8539 Comm: syz-executor Not tainted 5.14.0+ #1Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS1.13.0-1ubuntu1.1 04/01/2014RIP: 0010:latency_exceeded block/blk-wbt.c:237 [inline]RIP: 0010:wb_timer_fn+0x149/0x2080 block/blk-wbt.c:360Code: 03 80 3c 02 00 0f 85 08 1c 00 00 48 8b 9b b0 00 00 00 48 b8 0000 00 00 00 fc ff df 48 8d bb 48 01 00 00 48 89 fa 48 c1 ea 03 <80> 3c02 00 0f 85 d5 1b 00 00 48 8b 83 48 01 00 00 48 8d 7d 28 48RSP: 0018:ffffc90000848cd0 EFLAGS: 00010212RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffff888014e79c80RDX: 0000000000000029 RSI: ffff888014e79c80 RDI: 0000000000000148RBP: ffff88801e2adc00 R08: ffffffff83de2dfd R09: 0000000000000003R10: 0000000000000005 R11: ffffed1003c55bb0 R12: 0000000000000003R13: 0000000000000000 R14: ffff8881053bc800 R15: ffff88801e2adcd0FS:  0000000003176940(0000) GS:ffff888063f00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00000000014d53ad CR3: 000000002e5ff000 CR4: 0000000000350ee0Call Trace: <IRQ> call_timer_fn+0x1a5/0x6b0 kernel/time/timer.c:1421 expire_timers kernel/time/timer.c:1466 [inline] __run_timers.part.0+0x6b0/0xa90 kernel/time/timer.c:1734 __run_timers kernel/time/timer.c:1715 [inline] run_timer_softirq+0xb6/0x1d0 kernel/time/timer.c:1747 __do_softirq+0x1d7/0x93b kernel/softirq.c:558 invoke_softirq kernel/softirq.c:432 [inline] __irq_exit_rcu kernel/softirq.c:636 [inline] irq_exit_rcu+0xf2/0x130 kernel/softirq.c:648 sysvec_apic_timer_interrupt+0x93/0xc0 arch/x86/kernel/apic/apic.c:1097 </IRQ> asm_sysvec_apic_timer_interrupt+0x12/0x20 arch/x86/include/asm/idtentry.h:638RIP: 0010:get_current arch/x86/include/asm/current.h:15 [inline]RIP: 0010:write_comp_data+0xe/0x70 kernel/kcov.c:217Code: 00 8b 89 1c 15 00 00 48 8b 02 48 83 c0 01 48 39 c1 76 07 4c 8904 c2 48 89 02 c3 90 49 89 fa bf 03 00 00 00 49 89 f1 49 89 d0 <65> 488b 34 25 40 f0 01 00 e8 34 ff ff ff 84 c0 74 44 48 8b 86 20RSP: 0018:ffffc9000106f7f8 EFLAGS: 00000246RAX: 000000000d0444bb RBX: 80000000fd589217 RCX: ffffffff81ac95bdRDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000003RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000R10: 0000000000000007 R11: ffffed100247709c R12: 0000000000000000R13: 0000000000000001 R14: dffffc0000000000 R15: ffff88802e806788 copy_present_pte mm/memory.c:976 [inline] copy_pte_range mm/memory.c:1070 [inline] copy_pmd_range mm/memory.c:1156 [inline] copy_pud_range mm/memory.c:1193 [inline] copy_p4d_range mm/memory.c:1217 [inline] copy_page_range+0xf4d/0x4750 mm/memory.c:1290 dup_mmap kernel/fork.c:610 [inline] dup_mm+0xa50/0x13d0 kernel/fork.c:1454 copy_mm kernel/fork.c:1506 [inline] copy_process+0x6c23/0x73d0 kernel/fork.c:2195 kernel_clone+0xe7/0x10d0 kernel/fork.c:2585 __do_sys_clone+0xc8/0x110 kernel/fork.c:2702 do_syscall_x64 arch/x86/entry/common.c:50 [inline] do_syscall_64+0x35/0xb0 arch/x86/entry/common.c:80 entry_SYSCALL_64_after_hwframe+0x44/0xaeRIP: 0033:0x471f0fCode: ed 0f 85 64 01 00 00 64 4c 8b 0c 25 10 00 00 00 45 31 c0 4d 8d91 d0 02 00 00 31 d2 31 f6 bf 11 00 20 01 b8 38 00 00 00 0f 05 <48> 3d00 f0 ff ff 0f 87 f5 00 00 00 41 89 c5 85 c0 0f 85 fc 00 00RSP: 002b:00007ffc62d06000 EFLAGS: 00000246 ORIG_RAX: 0000000000000038RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 0000000000471f0fRDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000001200011RBP: 0000000000000001 R08: 0000000000000000 R09: 0000000003176940R10: 0000000003176c10 R11: 0000000000000246 R12: 0000000000000001R13: 0000000000000005 R14: 00007ffc62d060b0 R15: 00007ffc62d0606cModules linked in:Dumping ftrace buffer:   (ftrace buffer empty)---[ end trace ef2331b2238dd17a ]---RIP: 0010:latency_exceeded block/blk-wbt.c:237 [inline]RIP: 0010:wb_timer_fn+0x149/0x2080 block/blk-wbt.c:360Code: 03 80 3c 02 00 0f 85 08 1c 00 00 48 8b 9b b0 00 00 00 48 b8 0000 00 00 00 fc ff df 48 8d bb 48 01 00 00 48 89 fa 48 c1 ea 03 <80> 3c02 00 0f 85 d5 1b 00 00 48 8b 83 48 01 00 00 48 8d 7d 28 48RSP: 0018:ffffc90000848cd0 EFLAGS: 00010212RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffff888014e79c80RDX: 0000000000000029 RSI: ffff888014e79c80 RDI: 0000000000000148RBP: ffff88801e2adc00 R08: ffffffff83de2dfd R09: 0000000000000003R10: 0000000000000005 R11: ffffed1003c55bb0 R12: 0000000000000003R13: 0000000000000000 R14: ffff8881053bc800 R15: ffff88801e2adcd0FS:  0000000003176940(0000) GS:ffff888063f00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00000000014d53ad CR3: 000000002e5ff000 CR4: 0000000000350ee0----------------Code disassembly (best guess):   0: 03 80 3c 02 00 0f    add    0xf00023c(%rax),%eax   6: 85 08                test   %ecx,(%rax)   8: 1c 00                sbb    $0x0,%al   a: 00 48 8b              add    %cl,-0x75(%rax)   d: 9b                    fwait   e: b0 00                mov    $0x0,%al  10: 00 00                add    %al,(%rax)  12: 48 b8 00 00 00 00 00 movabs $0xdffffc0000000000,%rax  19: fc ff df  1c: 48 8d bb 48 01 00 00 lea    0x148(%rbx),%rdi  23: 48 89 fa              mov    %rdi,%rdx  26: 48 c1 ea 03          shr    $0x3,%rdx* 2a: 80 3c 02 00          cmpb   $0x0,(%rdx,%rax,1) <-- trapping instruction  2e: 0f 85 d5 1b 00 00    jne    0x1c09  34: 48 8b 83 48 01 00 00 mov    0x148(%rbx),%rax  3b: 48 8d 7d 28          lea    0x28(%rbp),%rdi  3f: 48                    rex.W% ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2021-09-13 04:01 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from lkml.org_4b336681_20250115_140639.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2021]](/lkml/2021) Â  [[Sep]](/lkml/2021/9) Â  [[17]](/lkml/2021/9/17) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2021/9/17/1037)Â  [[forward]](/lkml/bounce/2021/9/17/1037)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2021/9/17/1037) * [Yang Shi](/lkml/2021/9/17/1143)   + [Yang Shi](/lkml/2021/9/17/1143)     - [Matthew Wilcox](/lkml/2021/9/19/131)       * [Yang Shi](/lkml/2021/9/20/2328)         + [Matthew Wilcox](/lkml/2021/9/20/2333)  Patch in this message  * [Get diff 1](/lkml/diff/2021/9/17/1037/1) | / | | | From | Yang Shi <> | | --- | --- | | Subject | [PATCH] fs: buffer: check huge page size instead of single page for invalidatepage | | Date | Fri, 17 Sep 2021 13:57:31 -0700 | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` Hao Sun reported the below BUG on v5.15-rc1 kernel:kernel BUG at fs/buffer.c:1510!invalid opcode: 0000 [#1] PREEMPT SMPCPU: 0 PID: 5 Comm: kworker/0:0 Not tainted 5.14.0+ #15Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOSrel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014Workqueue: events delayed_fputRIP: 0010:block_invalidatepage+0x27f/0x2a0 -origin/fs/buffer.c:1510Code: ff ff e8 b4 07 d7 ff b9 02 00 00 00 be 02 00 00 00 4c 89 ff 48c7 c2 40 4e 25 84 e8 2b c2 c4 02 e9 c9 fe ff ff e8 91 07 d7 ff <0f> 0be8 8a 07 d7 ff 0f 0b e8 83 07 d7 ff 48 8d 5d ff e9 57 ff ffRSP: 0018:ffffc9000065bb60 EFLAGS: 00010293RAX: 0000000000000000 RBX: ffffea0000670000 RCX: 0000000000000000RDX: ffff8880097fa240 RSI: ffffffff81608a9f RDI: ffffea0000670000RBP: ffffea0000670000 R08: 0000000000000001 R09: 0000000000000000R10: ffffc9000065b9f8 R11: 0000000000000003 R12: ffffffff81608820R13: ffffc9000065bc68 R14: 0000000000000000 R15: ffffc9000065bbf0FS:  0000000000000000(0000) GS:ffff88807dc00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00007f4aef93fb08 CR3: 0000000108cf2000 CR4: 0000000000750ef0DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400PKRU: 55555554Call Trace: do_invalidatepage -origin/mm/truncate.c:157 [inline] truncate_cleanup_page+0x15c/0x280 -origin/mm/truncate.c:176 truncate_inode_pages_range+0x169/0xc30 -origin/mm/truncate.c:325 kill_bdev.isra.29+0x28/0x30 blkdev_flush_mapping+0x4c/0x130 -origin/block/bdev.c:658 blkdev_put_whole+0x54/0x60 -origin/block/bdev.c:689 blkdev_put+0x6f/0x210 -origin/block/bdev.c:953 blkdev_close+0x25/0x30 -origin/block/fops.c:459 __fput+0xdf/0x380 -origin/fs/file_table.c:280 delayed_fput+0x25/0x40 -origin/fs/file_table.c:308 process_one_work+0x359/0x850 -origin/kernel/workqueue.c:2297 worker_thread+0x41/0x4d0 -origin/kernel/workqueue.c:2444 kthread+0x178/0x1b0 -origin/kernel/kthread.c:319 ret_from_fork+0x1f/0x30 -origin/arch/x86/entry/entry_64.S:295Modules linked in:Dumping ftrace buffer:   (ftrace buffer empty)---[ end trace 9dbb8f58f2109f10 ]---RIP: 0010:block_invalidatepage+0x27f/0x2a0 -origin/fs/buffer.c:1510Code: ff ff e8 b4 07 d7 ff b9 02 00 00 00 be 02 00 00 00 4c 89 ff 48c7 c2 40 4e 25 84 e8 2b c2 c4 02 e9 c9 fe ff ff e8 91 07 d7 ff <0f> 0be8 8a 07 d7 ff 0f 0b e8 83 07 d7 ff 48 8d 5d ff e9 57 ff ffRSP: 0018:ffffc9000065bb60 EFLAGS: 00010293RAX: 0000000000000000 RBX: ffffea0000670000 RCX: 0000000000000000RDX: ffff8880097fa240 RSI: ffffffff81608a9f RDI: ffffea0000670000RBP: ffffea0000670000 R08: 0000000000000001 R09: 0000000000000000R10: ffffc9000065b9f8 R11: 0000000000000003 R12: ffffffff81608820R13: ffffc9000065bc68 R14: 0000000000000000 R15: ffffc9000065bbf0FS:  0000000000000000(0000) GS:ffff88807dc00000(0000) knlGS:0000000000000000CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033CR2: 00007ff98674f000 CR3: 0000000106b2e000 CR4: 0000000000750ef0DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400PKRU: 55555554The debugging showed the page passed to invalidatepage is a huge pageand the length is the size of huge page instead of single page due toread only FS THP support.  But block_invalidatepage() would throw BUG ifthe size is greater than single page.However there is actually a bigger problem in invalidatepage().  All theimplementations are *NOT* THP aware and hardcoded PAGE_SIZE.  Some triggersBUG(), like block_invalidatepage(), some just returns error if length isgreater than PAGE_SIZE.Converting PAGE_SIZE to thp_size() actually is not enough since the actualinvalidation part just assumes single page is passed in.  Since other subpagesmay have private too because PG_private is per subpage so there may bemultiple subpages have private.  This may prevent the THP from splittingand reclaiming since the extra refcount pins from private of subpages.The complete fix seems not trivial and involve how to deal with hugepage in page cache.  So the scope of this patch is limited to close theBUG at the moment.Fixes: eb6ecbed0aa2 ("mm, thp: relax the VM_DENYWRITE constraint on file-backed THPs")Reported-by: Hao Sun <sunhao.th@gmail.com>Tested-by: Hao Sun <sunhao.th@gmail.com>Cc: <stable@vger.kernel.org>Signed-off-by: Yang Shi <shy828301@gmail.com>--- fs/buffer.c | 4 ++-- 1 file changed, 2 insertions(+), 2 deletions(-)diff --git a/fs/buffer.c b/fs/buffer.cindex ab7573d72dd7..4bcb54c4d1be 100644--- a/fs/buffer.c+++ b/fs/buffer.c@@ -1507,7 +1507,7 @@ void block_invalidatepage(struct page *page, unsigned int offset, 	/* 	 * Check for overflow 	 */-	BUG_ON(stop > PAGE_SIZE || stop < length);+	BUG_ON(stop > thp_size(page) || stop < length);  	head = page_buffers(page); 	bh = head;@@ -1535,7 +1535,7 @@ void block_invalidatepage(struct page *page, unsigned int offset, 	 * The get_block cached value has been unconditionally invalidated, 	 * so real IO is not possible anymore. 	 */-	if (length == PAGE_SIZE)+	if (length >= PAGE_SIZE) 		try_to_release_page(page, 0); out: 	return;-- 2.26.2 ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2021-09-17 22:58 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from access.redhat.com_d53892ae_20250115_230322.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


