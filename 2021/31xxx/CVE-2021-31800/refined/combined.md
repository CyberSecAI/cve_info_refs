=== Content from github.com_9b546d4d_20250114_190055.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

## Files

 cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Copy path Blame  Blame
## Latest commit

## History

[History](/fortra/impacket/commits/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)4692 lines (4007 loc) · 216 KB cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Top
## File metadata and controls

* Code
* Blame

4692 lines (4007 loc) · 216 KB[Raw](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000# SECUREAUTH LABS. Copyright 2018 SecureAuth Corporation. All rights reserved.## This software is provided under under a slightly modified version# of the Apache Software License. See the accompanying LICENSE file# for more information.## Author: Alberto Solino (@agsolino)## TODO:# [-] Functions should return NT error codes# [-] Handling errors in all situations, right now it's just raising exceptions. # [\*] Standard authentication support# [ ] Organize the connectionData stuff# [\*] Add capability to send a bad user ID if the user is not authenticated,# right now you can ask for any command without actually being authenticated# [ ] PATH TRAVERSALS EVERYWHERE.. BE WARNED!# [ ] Check error situation (now many places assume the right data is coming)# [ ] Implement IPC to the main process so the connectionData is on a single place# [ ] Hence.. implement locking# estamos en la B
import calendarimport socketimport timeimport datetimeimport structimport threadingimport loggingimport logging.configimport ntpathimport osimport fnmatchimport errnoimport sysimport randomimport shutilimport stringimport hashlibimport hmac
from binascii import unhexlify, hexlify, a2b\_hexfrom six import PY2, b, text\_typefrom six.moves import configparser, socketserver
# For signingfrom impacket import smb, nmb, ntlm, uuidfrom impacket import smb3structs as smb2from impacket.spnego import SPNEGO\_NegTokenInit, TypesMech, MechTypes, SPNEGO\_NegTokenResp, ASN1\_AID, ASN1\_SUPPORTED\_MECHfrom impacket.nt\_errors import STATUS\_NO\_MORE\_FILES, STATUS\_NETWORK\_NAME\_DELETED, STATUS\_INVALID\_PARAMETER, \ STATUS\_FILE\_CLOSED, STATUS\_MORE\_PROCESSING\_REQUIRED, STATUS\_OBJECT\_PATH\_NOT\_FOUND, STATUS\_DIRECTORY\_NOT\_EMPTY, \ STATUS\_FILE\_IS\_A\_DIRECTORY, STATUS\_NOT\_IMPLEMENTED, STATUS\_INVALID\_HANDLE, STATUS\_OBJECT\_NAME\_COLLISION, \ STATUS\_NO\_SUCH\_FILE, STATUS\_CANCELLED, STATUS\_OBJECT\_NAME\_NOT\_FOUND, STATUS\_SUCCESS, STATUS\_ACCESS\_DENIED, \ STATUS\_NOT\_SUPPORTED, STATUS\_INVALID\_DEVICE\_REQUEST, STATUS\_FS\_DRIVER\_REQUIRED, STATUS\_INVALID\_INFO\_CLASS, \ STATUS\_LOGON\_FAILURE
# Setting LOG to current's module nameLOG = logging.getLogger(\_\_name\_\_)
# These ones not defined in nt\_errorsSTATUS\_SMB\_BAD\_UID = 0x005B0002STATUS\_SMB\_BAD\_TID = 0x00050002
# Utility functions# and general functions. # There are some common functions that can be accessed from more than one SMB # command (or either TRANSACTION). That's why I'm putting them here# TODO: Return NT ERROR Codes
def computeNTLMv2(identity, lmhash, nthash, serverChallenge, authenticateMessage, ntlmChallenge, type1): # Let's calculate the NTLMv2 Response
 responseKeyNT = ntlm.NTOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), nthash) responseKeyLM = ntlm.LMOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), lmhash)
 ntProofStr = authenticateMessage['ntlm'][:16] temp = authenticateMessage['ntlm'][16:] ntProofStr2 = ntlm.hmac\_md5(responseKeyNT, serverChallenge + temp) lmChallengeResponse = authenticateMessage['lanman'] sessionBaseKey = ntlm.hmac\_md5(responseKeyNT, ntProofStr)
 responseFlags = type1['flags']
 # Let's check the return flags if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY) == 0: # No extended session security, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_128) == 0: # No support for 128 key len, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_128 if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH) == 0: # No key exchange supported, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SEAL) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SEAL if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SIGN if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN
 keyExchangeKey = ntlm.KXKEY(ntlmChallenge['flags'], sessionBaseKey, lmChallengeResponse, ntlmChallenge['challenge'], '', lmhash, nthash, True)
 # If we set up key exchange, let's fill the right variables if ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH: exportedSessionKey = authenticateMessage['session\_key'] exportedSessionKey = ntlm.generateEncryptedSessionKey(keyExchangeKey, exportedSessionKey) else: encryptedRandomSessionKey = None # [MS-NLMP] page 46 exportedSessionKey = keyExchangeKey
 # Do they match? if ntProofStr == ntProofStr2: # Yes!, process login return STATUS\_SUCCESS, exportedSessionKey else: return STATUS\_LOGON\_FAILURE, exportedSessionKey
def outputToJohnFormat(challenge, username, domain, lmresponse, ntresponse):# We don't want to add a possible failure here, since this is an# extra bonus. We try, if it fails, returns nothing# ToDo: Document the parameter's types (bytes / string) and check all the places where it's called ret\_value = '' if type(challenge) is not bytes: challenge = challenge.decode('latin-1')
 try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse).decode('latin-1')[:32], hexlify(ntresponse).decode()[32:]), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode()), 'hash\_version': 'ntlm'} except: # Let's try w/o decoding Unicode try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('latin-1'), domain.decode('latin-1'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse)[:32].decode('latin-1'), hexlify(ntresponse)[32:].decode('latin-1')), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username, domain, hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode('latin-1')), 'hash\_version': 'ntlm'} except Exception as e: import traceback traceback.print\_exc() LOG.error("outputToJohnFormat: %s" % e) pass
 return ret\_value
def writeJohnOutputToFile(hash\_string, hash\_version, file\_name): fn\_data = os.path.splitext(file\_name) if hash\_version == "ntlmv2": output\_filename = fn\_data[0] + "\_ntlmv2" + fn\_data[1] else: output\_filename = fn\_data[0] + "\_ntlm" + fn\_data[1]
 with open(output\_filename,"a") as f: f.write(hash\_string) f.write('\n')
def decodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return text.decode('utf-16le') else: return text
def encodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return (text).encode('utf-16le') else: return text.encode('ascii') def getFileTime(t): t \*= 10000000 t += 116444736000000000 return t
def getUnixTime(t): t -= 116444736000000000 t //= 10000000 return t
def getSMBDate(t): # TODO: Fix this :P d = datetime.date.fromtimestamp(t) year = d.year - 1980 ret = (year << 8) + (d.month << 4) + d.day return ret
def getSMBTime(t): # TODO: Fix this :P d = datetime.datetime.fromtimestamp(t) return (d.hour << 8) + (d.minute << 4) + d.second
def getShares(connId, smbServer): config = smbServer.getServerConfig() sections = config.sections() # Remove the global one del(sections[sections.index('global')]) shares = {} for i in sections: shares[i] = dict(config.items(i)) return shares
def searchShare(connId, share, smbServer): config = smbServer.getServerConfig() if config.has\_section(share): return dict(config.items(share)) else: return None
def openFile(path,fileName, accessMode, fileAttributes, openMode): fileName = os.path.normpath(fileName.replace('\\','/')) errorCode = 0 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) mode = 0 # Check the Open Mode if openMode & 0x10: # If the file does not exist, create it. mode = os.O\_CREAT else: # If file does not exist, return an error if os.path.exists(pathName) is not True: errorCode = STATUS\_NO\_SUCH\_FILE return 0,mode, pathName, errorCode
 if os.path.isdir(pathName) and (fileAttributes & smb.ATTR\_DIRECTORY) == 0: # Request to open a normal file and this is actually a directory errorCode = STATUS\_FILE\_IS\_A\_DIRECTORY return 0, mode, pathName, errorCode # Check the Access Mode if accessMode & 0x7 == 1: mode |= os.O\_WRONLY elif accessMode & 0x7 == 2: mode |= os.O\_RDWR else: mode = os.O\_RDONLY
 try: if sys.platform == 'win32': mode |= os.O\_BINARY fid = os.open(pathName, mode) except Exception as e: LOG.error("openFile: %s,%s" % (pathName, mode) ,e) fid = 0 errorCode = STATUS\_ACCESS\_DENIED
 return fid, mode, pathName, errorCode
def queryFsInformation(path, filename, level=0, pktFlags = smb.SMB.FLAGS2\_UNICODE):
 if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) fileSize = os.path.getsize(pathName) (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FS\_ATTRIBUTE\_INFO or level == smb2.SMB2\_FILESYSTEM\_ATTRIBUTE\_INFO: data = smb.SMBQueryFsAttributeInfo() data['FileSystemAttributes'] = smb.FILE\_CASE\_SENSITIVE\_SEARCH | smb.FILE\_CASE\_PRESERVED\_NAMES data['MaxFilenNameLengthInBytes'] = 255 data['LengthOfFileSystemName'] = len('XTFS')\*2 data['FileSystemName'] = 'XTFS'.encode('utf-16le') return data.getData() elif level == smb.SMB\_INFO\_VOLUME: data = smb.SMBQueryFsInfoVolume( flags = pktFlags ) data['VolumeLabel'] = 'SHARE'.encode(encoding) return data.getData() elif level == smb.SMB\_QUERY\_FS\_VOLUME\_INFO or level == smb2.SMB2\_FILESYSTEM\_VOLUME\_INFO: data = smb.SMBQueryFsVolumeInfo() data['VolumeLabel'] = '' data['VolumeCreationTime'] = getFileTime(ctime) return data.getData()  elif level == smb.SMB\_QUERY\_FS\_SIZE\_INFO: data = smb.SMBQueryFsSizeInfo() return data.getData() elif level == smb.FILE\_FS\_FULL\_SIZE\_INFORMATION: data = smb.SMBFileFsFullSizeInformation() return data.getData() elif level == smb.FILE\_FS\_SIZE\_INFORMATION: data = smb.FileFsSizeInformation() return data.getData() else: lastWriteTime = mtime attribs = 0 if os.path.isdir(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_DIRECTORY if os.path.isfile(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_NORMAL fileAttributes = attribs return fileSize, lastWriteTime, fileAttributes
def findFirst2(path, fileName, level, searchAttributes, pktFlags = smb.SMB.FLAGS2\_UNICODE, isSMB2 = False): # TODO: Depending on the level, this could be done much simpler  #print "FindFirs2 path:%s, filename:%s" % (path, fileName) fileName = os.path.normpath(fileName.replace('\\','/')) # Let's choose the right encoding depending on the request if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:]
 pathName = os.path.join(path,fileName) files = []
 if pathName.find('\*') == -1 and pathName.find('?') == -1: # No search patterns pattern = '' else: pattern = os.path.basename(pathName) dirName = os.path.dirname(pathName)
 # Always add . and .. Not that important for Windows, but Samba whines if  # not present (for \* search only) if pattern == '\*': files.append(os.path.join(dirName,'.')) files.append(os.path.join(dirName,'..'))
 if pattern != '': for file in os.listdir(dirName): if fnmatch.fnmatch(file.lower(),pattern.lower()): entry = os.path.join(dirName, file) if os.path.isdir(entry): if searchAttributes & smb.ATTR\_DIRECTORY: files.append(entry) else: files.append(entry) else: if os.path.exists(pathName): files.append(pathName)
 searchResult = [] searchCount = len(files) errorCode = STATUS\_SUCCESS
 for i in files: if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_DIRECTORY\_INFO: item = smb.SMBFindFileDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_INFO\_STANDARD: item = smb.SMBFindInfoStandard( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileIdFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileIdBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_NAMES\_INFO or level == smb2.SMB2\_FILE\_NAMES\_INFO: item = smb.SMBFindFileNamesInfo( flags = pktFlags ) else: LOG.error("Wrong level %d!" % level) return searchResult, searchCount, STATUS\_NOT\_SUPPORTED  (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(i) if os.path.isdir(i): item['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: item['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE
 item['FileName'] = os.path.basename(i).encode(encoding)
 if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['ShortName'] = '\x00'\*24 item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO: item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_INFO\_STANDARD: item['EaSize'] = size item['CreationDate'] = getSMBDate(ctime) item['CreationTime'] = getSMBTime(ctime) item['LastAccessDate'] = getSMBDate(atime) item['LastAccessTime'] = getSMBTime(atime) item['LastWriteDate'] = getSMBDate(mtime) item['LastWriteTime'] = getSMBTime(mtime) searchResult.append(item)
 # No more files if (level >= smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or isSMB2 is True) and searchCount > 0: searchResult[-1]['NextEntryOffset'] = 0
 return searchResult, searchCount, errorCode
def queryFileInformation(path, filename, level): #print "queryFileInfo path: %s, filename: %s, level:0x%x" % (path,filename,level) return queryPathInformation(path,filename, level)
def queryPathInformation(path, filename, level): # TODO: Depending on the level, this could be done much simpler #print("queryPathInfo path: %s, filename: %s, level:0x%x" % (path,filename,level)) try: errorCode = 0 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FILE\_BASIC\_INFO: infoRecord = smb.SMBQueryFileBasicInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_STANDARD\_INFO: infoRecord = smb.SMBQueryFileStandardInfo() infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 elif level == smb.SMB\_QUERY\_FILE\_ALL\_INFO or level == smb2.SMB2\_FILE\_ALL\_INFO: infoRecord = smb.SMBQueryFileAllInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 infoRecord['FileName'] = filename.encode('utf-16le') elif level == smb2.SMB2\_FILE\_NETWORK\_OPEN\_INFO: infoRecord = smb.SMBFileNetworkOpenInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['ChangeTime'] = getFileTime(mtime) infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['FileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['FileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_EA\_INFO or level == smb2.SMB2\_FILE\_EA\_INFO:  infoRecord = smb.SMBQueryFileEaInfo() elif level == smb2.SMB2\_FILE\_STREAM\_INFO: infoRecord = smb.SMBFileStreamInformation() else: LOG.error('Unknown level for query path info! 0x%x' % level) # UNSUPPORTED return None, STATUS\_NOT\_SUPPORTED
 return infoRecord, errorCode else: # NOT FOUND return None, STATUS\_OBJECT\_NAME\_NOT\_FOUND except Exception as e: LOG.error('queryPathInfo: %s' % e) raise
def queryDiskInformation(path):# TODO: Do something useful here :)# For now we just return fake values totalUnits = 65535 freeUnits = 65535 return totalUnits, freeUnits
# Here we implement the NT transaction handlersclass NTTRANSCommands: def default(self, connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): pass
# Here we implement the NT transaction handlersclass TRANSCommands: @staticmethod def lanMan(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): # Minimal [MS-RAP] implementation, just to return the shares connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS if struct.unpack('<H',parameters[:2])[0] == 0: # NetShareEnum Request netShareEnum = smb.SMBNetShareEnum(parameters) if netShareEnum['InfoLevel'] == 1: shares = getShares(connId, smbServer) respParameters = smb.SMBNetShareEnumResponse() respParameters['EntriesReturned'] = len(shares) respParameters['EntriesAvailable'] = len(shares) tailData = '' for i in shares: # NetShareInfo1 len == 20 entry = smb.NetShareInfo1() entry['NetworkName'] = i + '\x00'\*(13-len(i)) entry['Type'] = int(shares[i]['share type']) # (beto) If offset == 0 it crashes explorer.exe on windows 7 entry['RemarkOffsetLow'] = 20 \* len(shares) + len(tailData) respData += entry.getData() if 'comment' in shares[i]: tailData += shares[i]['comment'] + '\x00' else: tailData += '\x00' respData += tailData else: # We don't support other info levels errorCode = STATUS\_NOT\_SUPPORTED elif struct.unpack('<H',parameters[:2])[0] == 13: # NetrServerGetInfo Request respParameters = smb.SMBNetServerGetInfoResponse() netServerInfo = smb.SMBNetServerInfo1() netServerInfo['ServerName'] = smbServer.getServerName() respData = netServerInfo.getData() respParameters['TotalBytesAvailable'] = len(respData) elif struct.unpack('<H',parameters[:2])[0] == 1: # NetrShareGetInfo Request request = smb.SMBNetShareGetInfo(parameters) respParameters = smb.SMBNetShareGetInfoResponse() shares = getShares(connId, smbServer) share = shares[request['ShareName'].upper()] shareInfo = smb.NetShareInfo1()  shareInfo['NetworkName'] = request['ShareName'].upper() + '\x00' shareInfo['Type'] = int(share['share type']) respData = shareInfo.getData() if 'comment' in share: shareInfo['RemarkOffsetLow'] = len(respData) respData += share['comment'] + '\x00' respParameters['TotalBytesAvailable'] = len(respData)  else: # We don't know how to handle anything else errorCode = STATUS\_NOT\_SUPPORTED
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def transactNamedPipe(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS SMBCommand = smb.SMBCommand(recvPacket['Data'][0]) transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Extract the FID fid = struct.unpack('<H', transParameters['Setup'][2:])[0]
 if fid in connData['OpenedFiles']: fileHandle = connData['OpenedFiles'][fid]['FileHandle'] if fileHandle != PIPE\_FILE\_DESCRIPTOR: os.write(fileHandle,data) respData = os.read(fileHandle,data) else: sock = connData['OpenedFiles'][fid]['Socket'] sock.send(data) respData = sock.recv(maxDataCount) else: errorCode = STATUS\_INVALID\_HANDLE
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the transaction2 handlersclass TRANS2Commands: # All these commands return setup, parameters, data, errorCode @staticmethod def setPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setPathInfoParameters = smb.SMBSetPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters) if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] fileName = decodeSMBString(recvPacket['Flags2'], setPathInfoParameters['FileName']) fileName = os.path.normpath(fileName.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): informationLevel = setPathInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) if mtime != -1 or atime != -1: os.utime(pathName,(atime,mtime)) else: smbServer.log('Unknown level for set path info! 0x%x' % setPathInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_OBJECT\_NAME\_NOT\_FOUND
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetPathInformationResponse\_Parameters()
 else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def setFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setFileInfoParameters = smb.SMBSetFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if setFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileName'] informationLevel = setFileInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_DISPOSITION\_INFO: infoRecord = smb.SMBSetFileDispositionInfo(parameters) if infoRecord['DeletePending'] > 0: # Mark this file for removal after closed connData['OpenedFiles'][setFileInfoParameters['FID']]['DeleteOnClose'] = True respParameters = smb.SMBSetFileInformationResponse\_Parameters() elif informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) os.utime(fileName,(atime,mtime)) elif informationLevel == smb.SMB\_SET\_FILE\_END\_OF\_FILE\_INFO: fileHandle = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileHandle'] infoRecord = smb.SMBSetFileEndOfFileInfo(data) if infoRecord['EndOfFile'] > 0: os.lseek(fileHandle, infoRecord['EndOfFile']-1, 0) os.write(fileHandle, b'\x00') else: smbServer.log('Unknown level for set file info! 0x%x' % setFileInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_NO\_SUCH\_FILE
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetFileInformationResponse\_Parameters() else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b''
 queryFileInfoParameters = smb.SMBQueryFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if queryFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][queryFileInfoParameters['FID']]['FileName']
 infoRecord, errorCode = queryFileInformation('', fileName, queryFileInfoParameters['InformationLevel'])
 if infoRecord is not None: respParameters = smb.SMBQueryFileInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = 0
 queryPathInfoParameters = smb.SMBQueryPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] try: infoRecord, errorCode = queryPathInformation(path, decodeSMBString(recvPacket['Flags2'], queryPathInfoParameters['FileName']), queryPathInfoParameters['InformationLevel']) except Exception as e: smbServer.log("queryPathInformation: %s" % e,logging.ERROR)
 if infoRecord is not None: respParameters = smb.SMBQueryPathInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_SMB\_BAD\_TID  smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFsInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId) errorCode = 0 # Get the Tid associated if recvPacket['Tid'] in connData['ConnectedShares']: data = queryFsInformation(connData['ConnectedShares'][recvPacket['Tid']]['path'], '', struct.unpack('<H',parameters)[0], pktFlags = recvPacket['Flags2'])
 smbServer.setConnectionData(connId, connData)
 return b'',b'', data, errorCode
 @staticmethod def findNext2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS findNext2Parameters = smb.SMBFindNext2\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 sid = findNext2Parameters['SID'] if recvPacket['Tid'] in connData['ConnectedShares']: if sid in connData['SIDs']: searchResult = connData['SIDs'][sid] respParameters = smb.SMBFindNext2Response\_Parameters() endOfSearch = 1 searchCount = 1 totalData = 0 for i in enumerate(searchResult): data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) >= findNext2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data totalData += lenData  # Have we reached the end of the search or still stuff to send? if endOfSearch > 0: # Let's remove the SID from our ConnData del(connData['SIDs'][sid])
 respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else:  errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def findFirst2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' findFirst2Parameters = smb.SMBFindFirst2\_Parameters( recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path']
 searchResult, searchCount, errorCode = findFirst2(path,  decodeSMBString( recvPacket['Flags2'], findFirst2Parameters['FileName'] ),  findFirst2Parameters['InformationLevel'],  findFirst2Parameters['SearchAttributes'] , pktFlags = recvPacket['Flags2'])
 respParameters = smb.SMBFindFirst2Response\_Parameters() endOfSearch = 1 sid = 0x80 # default SID searchCount = 0 totalData = 0 for i in enumerate(searchResult): #i[1].dump() data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) > findFirst2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 # Simple way to generate a fid if len(connData['SIDs']) == 0: sid = 1 else: sid = list(connData['SIDs'].keys())[-1] + 1 # Store the remaining search results in the ConnData SID connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data
 padLen = (8-(lenData % 8)) %8 respData += b'\xaa'\*padLen totalData += lenData + padLen
 respParameters['SID'] = sid respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the commands handlersclass SMBCommands:
 @staticmethod def smbTransaction(connId, smbServer, SMBCommand, recvPacket, transCommands): connData = smbServer.getConnectionData(connId)
 respSMBCommand = smb.SMBCommand(recvPacket['Command'])
 transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Do the stuff if transParameters['ParameterCount'] != transParameters['TotalParameterCount']: # TODO: Handle partial parameters  raise Exception("Unsupported partial parameters in TRANSACT2!") else: transData = smb.SMBTransaction\_SData(flags = recvPacket['Flags2']) # Standard says servers shouldn't trust Parameters and Data comes  # in order, so we have to parse the offsets, ugly
 paramCount = transParameters['ParameterCount'] transData['Trans\_ParametersLength'] = paramCount dataCount = transParameters['DataCount'] transData['Trans\_DataLength'] = dataCount transData.fromString(SMBCommand['Data']) if transParameters['ParameterOffset'] > 0: paramOffset = transParameters['ParameterOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Parameters'] = SMBCommand['Data'][paramOffset:paramOffset+paramCount] else: transData['Trans\_Parameters'] = b''
 if transParameters['DataOffset'] > 0: dataOffset = transParameters['DataOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Data'] = SMBCommand['Data'][dataOffset:dataOffset + dataCount] else:  transData['Trans\_Data'] = b''  # Call the handler for this TRANSACTION if transParameters['SetupCount'] == 0: # No subcommand, let's play with the Name command = decodeSMBString(recvPacket['Flags2'],transData['Name']) else: command = struct.unpack('<H', transParameters['Setup'][:2])[0]  if command in transCommands: # Call the TRANS subcommand setup = b'' parameters = b'' data = b'' try:  setup, parameters, data, errorCode = transCommands[command](connId, smbServer,  recvPacket,  transData['Trans\_Parameters'],  transData['Trans\_Data'], transParameters['MaxDataCount']) except Exception as e: #print 'Transaction: %s' % e,e smbServer.log('Transaction: (%r,%s)' % (command, e), logging.ERROR) errorCode = STATUS\_ACCESS\_DENIED #raise
 if setup == b'' and parameters == b'' and data == b'': # Something wen't wrong respParameters = b'' respData = b'' else: # Build the answer if hasattr(data, 'getData'): data = data.getData() remainingData = len(data) if hasattr(parameters, 'getData'): parameters = parameters.getData() remainingParameters = len(parameters) commands = [] dataDisplacement = 0 while remainingData > 0 or remainingParameters > 0:  respSMBCommand = smb.SMBCommand(recvPacket['Command']) respParameters = smb.SMBTransactionResponse\_Parameters() respData = smb.SMBTransaction2Response\_Data()
 respParameters['TotalParameterCount'] = len(parameters)[View remainder of file in raw view](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_467b90fd_20250114_190108.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Freleases)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Freleases)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Findex&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

# Releases: fortra/impacket

[Releases](/fortra/impacket/releases)
[Tags](/fortra/impacket/tags)

Releases · fortra/impacket
## Impacket 0.12.0

16 Sep 20:07

![@anadrianmanrique](https://avatars.githubusercontent.com/u/60896207?s=40&v=4)
[anadrianmanrique](/anadrianmanrique)

[impacket\_0\_12\_0](/fortra/impacket/tree/impacket_0_12_0)

[`db53482`](/fortra/impacket/commit/db53482dc864fec69156898d52c1b595a777ca9a)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_12_0)

 Loading

[View all tags](/fortra/impacket/tags)

[Impacket 0.12.0](/fortra/impacket/releases/tag/impacket_0_12_0)
[Latest](/fortra/impacket/releases/latest)

[Latest](/fortra/impacket/releases/latest)

## Impacket 0.12.0:

Project's main page at <https://www.coresecurity.com/core-labs/open-source-tools/impacket>

ChangeLog for 0.12.0:

1. Library improvements

   * Fixed broken hRSetServiceObjectSecurity method (@rkivys)
   * Removed dsinternals dependency ([@anadrianmanrique](https://github.com/anadrianmanrique))
   * Fixed srvs.hNetrShareEnum returning erronous shares ([@cnotin](https://github.com/cnotin))
   * Fixed lmhash computing to support non standard characters in the password ([@anadrianmanrique](https://github.com/anadrianmanrique))
   * Assorted fixes when processing Unicode data ([@alexisbalbachan](https://github.com/alexisbalbachan))
   * Added `[MS-GKDI]` Group Key Distribution Protocol implementation ([@zblurx](https://github.com/zblurx))
   * Fixed incorrect padding in SMBSessionSetupAndX\_Extended\_ResponseData ([@rtpt-erikgeiser](https://github.com/rtpt-erikgeiser))
   * Upgraded dependency pyreadline -> pyreadline3 ([@anadrianmanrique](https://github.com/anadrianmanrique))
   * SMB Server:
     + Added query information level 0x0109 for smb1 "SMB\_QUERY\_FILE\_STREAM\_INFO" ([@Adamkadaban](https://github.com/Adamkadaban))
     + Fixed filename encoding in queryPathInformation ([@JerAxxxxxxx](https://github.com/JerAxxxxxxx))
     + Fixed NextEntryOffset for large directory listings ([@robnanola](https://github.com/robnanola))
     + Fixed server returning an empty folder when cutting and pasting recursive directories ([@robnanola](https://github.com/robnanola))
   * DHCP: Fixed encoding issues ([@ujwalkomarla](https://github.com/ujwalkomarla))
2. Examples improvements

   * [secretsdump.py](/fortra/impacket/blob/impacket_0_12_0/examples/secretsdump.py):
     + Double DC Sync performance for DCs supporting SID lookups ([@tomspencer](https://github.com/tomspencer))
     + Added ability to skip dumping of SAM or SECURITY hives when performing remote operations ([@RazzburyPi](https://github.com/RazzburyPi))
     + Added ability to specify users to skip when dumping NTDS ([@RazzburyPi](https://github.com/RazzburyPi))
   * [ticketer.py](/fortra/impacket/blob/impacket_0_12_0/examples/ticketer.py):
     + Support to create Sapphire tickets ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * [GetUserSPNs.py](/fortra/impacket/blob/impacket_0_12_0/examples/GetUserSPNs.py), [getTGT.py](/fortra/impacket/blob/impacket_0_12_0/examples/getTGT.py):
     + Support for Kerberoasting without pre-authentication and ST request through AS-REQ ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * [wmiexec.py](/fortra/impacket/blob/impacket_0_12_0/examples/wmiexec.py):
     + Fix kerberos with remoteHost & add '-target-ip'([@XiaoliChan](https://github.com/XiaoliChan))
   * [ntlmrelayx.py](/fortra/impacket/blob/impacket_0_12_0/examples/ntlmrelayx.py):
     + Added the creation of a new machine account through SMB ([@BlWasp](https://github.com/BlWasp))
     + NTLMRelayX Multirelay fixes for target handling, added --keep-relaying flag ([@alexisbalbachan](https://github.com/alexisbalbachan))
     + Logging multirelay status when triggering the example ([@gabrielg5](https://github.com/gabrielg5))
     + Write certificates to file rather than outputting b64 to console ([@RazzburyPi](https://github.com/RazzburyPi))
     + Improved ability to continue relaying to ADCS web enrollment endpoint in order to request multiple certificates for different users ([@RazzburyPi](https://github.com/RazzburyPi))
     + Fixed compatibility issue with other SMB clients connecting to the SOCKS proxy created by ntlmrelayx ([@jfjallid](https://github.com/jfjallid))
     + Allow configuration of the SOCKS5 address and port ([@rtpt-erikgeiser](https://github.com/rtpt-erikgeiser))
     + Fixed implementation of MSSQLShell ([@gabrielg5](https://github.com/gabrielg5))
     + Logging notification of received connections in all relay servers ([@gabrielg5](https://github.com/gabrielg5))
     + Add domain and username to interactive Ldap shell message ([@minniear](https://github.com/minniear))
     + Enhanced MSSQLShell in NTLMRelayX leveraging TcpShell & output messages ([@gabrielg5](https://github.com/gabrielg5))
     + LDAP Attack: Bugfixes when parsing responses ([@SAERXCIT](https://github.com/SAERXCIT))
   * [getST.py](/fortra/impacket/blob/impacket_0_12_0/examples/getST.py):
     + Added -self, -altservice and -u2u for S4U2self abuse, S4U2self+u2u, and service substitution ([@ShutdownRepo](https://github.com/ShutdownRepo))
     + Added ability to set the RENEW ticket option to renew a TGT ([@shikatano](https://github.com/shikatano))
     + Fixed unicode encoding error when using the -impersonate flag ([@alexisbalbachan](https://github.com/alexisbalbachan))
   * [getTGT.py](/fortra/impacket/blob/impacket_0_12_0/examples/getTGT.py):
     + Added principalType as new parameter ([@DevSpork](https://github.com/DevSpork))
   * [reg.py](/fortra/impacket/blob/impacket_0_12_0/examples/reg.py):
     + Start remote registry as unprivileged user in reg.py ([@dadevel](https://github.com/dadevel))
     + Allow adding Binary values ([@dc3l1ne](https://github.com/dc3l1ne))
     + Add missing Null byte for REG\_SZ values ([@PfiatDe](https://github.com/PfiatDe))
     + Support for adding REG\_MULTI\_SZ values through (@garbrielg5)
   * [smbclient.py](/fortra/impacket/blob/impacket_0_12_0/examples/smbclient.py):
     + Added ability to provide an output file that the smbclient mini shell will write commands and output to ([@RazzburyPi](https://github.com/RazzburyPi))
     + Fixed path parse issue when running `tree` command ([@trietend](https://github.com/trietend))
   * [smbserver.py](/fortra/impacket/blob/impacket_0_12_0/examples/smbserver.py):
     + Added parameter "-outputfile" to set smbserver log file(gabrielg5)
   * [DumpNTLMInfo.py](/fortra/impacket/blob/impacket_0_12_0/examples/DumpNTLMInfo.py):
     + Allow execution on non-default ports ([@jeffmcjunkin](https://github.com/jeffmcjunkin))
     + Fixed KeyError exception when running with a Windows 2003 target ([@XiaoliChan](https://github.com/XiaoliChan))
   * [findDelegation.py](/fortra/impacket/blob/impacket_0_12_0/examples/findDelegation.py):
     + Added new column to show if SPN exists ([@p0dalirius](https://github.com/p0dalirius))
   * [mssqlclient.py](/fortra/impacket/blob/impacket_0_12_0/examples/mssqlclient.py):
     + Added `-target-ip` parameter to allow Kerberos authentication without much change in the DNS configuration of the local machine ([@Palkovsky](https://github.com/Palkovsky))
   * [mssqlshell.py](/fortra/impacket/blob/impacket_0_12_0/examples/mssqlshell.py):
     + Switching back to original DB after running `enum_impersonate` command ([@exploide](https://github.com/exploide))
     + Fixed logging in printReplies showing error messages ([@gabrielg5](https://github.com/gabrielg5))
   * [registry-read.py](/fortra/impacket/blob/impacket_0_12_0/examples/registry-read.py):
     + Fixed scenario where value name contains backlash ([@DidierA](https://github.com/DidierA))
   * [net.py](/fortra/impacket/blob/impacket_0_12_0/examples/net.py):
     + Fixed User "Account Active" property value ([@marcobarlottini](https://github.com/marcobarlottini))
     + Fixed log messages printing variables in the wrong order ([@Cyb3rC3lt](https://github.com/Cyb3rC3lt))
   * [rbcd.py](/fortra/impacket/blob/impacket_0_12_0/examples/rbcd.py):
     + Handled SID not found in LDAP error ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * [GetUserSPNs.py](/fortra/impacket/blob/impacket_0_12_0/examples/GetUserSPNs.py):
     + Updated the help information for -outputfile to be consistent with -save ([@scarvell](https://github.com/scarvell))
   * [ntfs-read.py](/fortra/impacket/blob/impacket_0_12_0/examples/ntfs-read.py):
     + Minor refactor in ntfs-read.py to make it more human-readable ([@NtAlexio2](https://github.com/NtAlexio2))
   * [ldap\_shell.py](/fortra/impacket/blob/impacket_0_12_0/examples/ldap_shell.py):
     + Added support for dirsync and whoami commands ([@nurfed1](https://github.com/nurfed1))
   * [lookupsid.py](/fortra/impacket/blob/impacket_0_12_0/examples/lookupsid.py):
     + Now supports kerberos auth ([@A1vinSmith](https://github.com/A1vinSmith))
   * [samrdump.py](/fortra/impacket/blob/impacket_0_12_0/examples/samrdump.py):
     + Will fetch AdminComment using MSRPC ([@joeldeleep](https://github.com/joeldeleep))
   * [tstool.py](/fortra/impacket/blob/impacket_0_12_0/examples/tstool.py):
     + Added support for kerberos auth, resolves SIDs ([@nopernik](https://github.com/nopernik))
3. New examples

   * [describeTicket.py](/fortra/impacket/blob/impacket_0_12_0/examples/describeTicket.py): Ticket describer and decrypter. ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * [GetADComputers.py](/fortra/impacket/blob/impacket_0_12_0/examples/GetADComputers.py): Query's DC via LDAP and returns the COMPUTER objects and the useful attributes such as full dns name, operating system name and version. ([@F-Masood](https://github.com/F-Masood))
   * [GetLAPSPassword.py](/fortra/impacket/blob/impacket_0_12_0/examples/GetLAPSPassword.py): Extract LAPS passwords from LDAP ([@zblurx](https://github.com/zblurx) and [@dru1d-foofus](https://github.com/dru1d-foofus))
   * [dacledit.py](/fortra/impacket/blob/impacket_0_12_0/examples/dacledit.py): This script can be used to read, write, remove, backup, restore ACEs (Access Control Entries) in an object DACL (Discretionary Access Control List). ([@ShutdownRepo](https://github.com/ShutdownRepo)) (@BlWasp\_) ([@wlayzz](https://github.com/wlayzz))
   * [owneredit.py](/fortra/impacket/blob/impacket_0_12_0/examples/owneredit.py): Added this script to abuse WriteOwner (ADS\_RIGHT\_WRITE\_OWNER) access rights. This allows to take ownership of another object, and then edit that object's DACL ([@ShutdownRepo](https://github.com/ShutdownRepo)) (@BlWasp\_)

As always, thanks a lot to all these contributors that make this library better every day (up to now):

[@tomspencer](https://github.com/tomspencer) [@anadrianmanrique](https://github.com/anadrianmanrique) [@ShutdownRepo](https://github.com/ShutdownRepo) [@dadevel](https://github.com/dadevel) [@gjhami](https://github.com/gjhami) [@NtAlexio2](https://github.com/NtAlexio2) [@F-Masood](https://github.com/F-Masood) [@BlWasp](https://github.com/BlWasp) [@gabrielg5](https://github.com/gabrielg5) [@XiaoliChan](https://github.com/XiaoliChan) [@omry99](https://github.com/omry99) [@wlayzz](https://github.com/wlayzz) [@themaks](https://github.com/themaks) [@alexisbalbachan](https://github.com/alexisbalbachan) [@RazzburyPi](https://github.com/RazzburyPi) [@jeffmcjunkin](https://github.com/jeffmcjunkin) [@p0dalirius](https://github.com/p0dalirius) [@dc3l1ne](https://github.com/dc3l1ne) [@jfjallid](https://github.com/jfjallid) [@Palkovsky](https://github.com/Palkovsky) [@rtpt-erikgeiser](https://github.com/rtpt-erikgeiser) [@trietend](https://github.com/trietend) [@zblurx](https://github.com/zblurx) [@dru1d-foofus](https://github.com/dru1d-foofus) [@PfiatDe](https://github.com/PfiatDe) [@DidierA](https://github.com/DidierA) [@marcobarlottini](https://github.com/marcobarlottini) [@PeterGabaldon](https://github.com/PeterGabaldon) [@m8r1us](https://github.com/m8r1us) [@5yn](https://github.com/5yn) [@tzuralon](https://github.com/tzuralon) [@Adamkadaban](https://github.com/Adamkadaban) [@scarvell](https://github.com/scarvell) [@JerAxxxxxxx](https://github.com/JerAxxxxxxx) [@ujwalkomarla](https://github.com/ujwalkomarla) [@robnanola](https://github.com/robnanola) [@SAERXCIT](https://github.com/SAERXCIT) [@nurfed1](https://github.com/nurfed1) [@A1vinSmith](https://github.com/A1vinSmith) [@joeldeleep](https://github.com/joeldeleep) [@nopernik](https://github.com/nopernik)

### Contributors

* [![@trietend](https://avatars.githubusercontent.com/u/212042?s=64&v=4)](https://github.com/trietend)
* [![@robnanola](https://avatars.githubusercontent.com/u/216977?s=64&v=4)](https://github.com/robnanola)
* [![@cnotin](https://avatars.githubusercontent.com/u/550823?s=64&v=4)](https://github.com/cnotin)
* [![@gabrielg5](https://avatars.githubusercontent.com/u/1108902?s=64&v=4)](https://github.com/gabrielg5)
* [![@scarvell](https://avatars.githubusercontent.com/u/1268862?s=64&v=4)](https://github.com/scarvell)
* [![@jeffmcjunkin](https://avatars.githubusercontent.com/u/1383363?s=64&v=4)](https://github.com/jeffmcjunkin)
* [![@DidierA](https://avatars.githubusercontent.com/u/1620015?s=64&v=4)](https://github.com/DidierA)
* [![@shikatano](https://avatars.githubusercontent.com/u/2265505?s=64&v=4)](https://github.com/shikatano)
* [![@dru1d-foofus](https://avatars.githubusercontent.com/u/4245930?s=64&v=4)](https://github.com/dru1d-foofus)
* [![@exploide](https://avatars.githubusercontent.com/u/5670236?s=64&v=4)](https://github.com/exploide)
* [![@themaks](https://avatars.githubusercontent.com/u/6764424?s=64&v=4)](https://github.com/themaks)
* [![@minniear](https://avatars.githubusercontent.com/u/7416815?s=64&v=4)](https://github.com/minniear)
* [![@ujwalkomarla](https://avatars.githubusercontent.com/u/7496275?s=64&v=4)](https://github.com/ujwalkomarla)
* [![@tomspencer](https://avatars.githubusercontent.com/u/7527713?s=64&v=4)](https://github.com/tomspencer)
* [![@nurfed1](https://avatars.githubusercontent.com/u/8027846?s=64&v=4)](https://github.com/nurfed1)
* [![@alexisbalbachan](https://avatars.githubusercontent.com/u/8486486?s=64&v=4)](https://github.com/alexisbalbachan)
* [![@Palkovsky](https://avatars.githubusercontent.com/u/9727832?s=64&v=4)](https://github.com/Palkovsky)
* [![@jfjallid](https://avatars.githubusercontent.com/u/10165473?s=64&v=4)](https://github.com/jfjallid)
* [![@nopernik](https://avatars.githubusercontent.com/u/11662758?s=64&v=4)](https://github.com/nopernik)
* [![@gjhami](https://avatars.githubusercontent.com/u/11875826?s=64&v=4)](https://github.com/gjhami)
* [![@dc3l1ne](https://avatars.githubusercontent.com/u/13917813?s=64&v=4)](https://github.com/dc3l1ne)
* [![@tzuralon](https://avatars.githubusercontent.com/u/15824496?s=64&v=4)](https://github.com/tzuralon)
* [![@m8r1us](https://avatars.githubusercontent.com/u/20727068?s=64&v=4)](https://github.com/m8r1us)
* [![@A1vinSmith](https://avatars.githubusercontent.com/u/24937594?s=64&v=4)](https://github.com/A1vinSmith)
* [![@5yn](https://avatars.githubusercontent.com/u/25803146?s=64&v=4)](https://github.com/5yn)
* [![@XiaoliChan](https://avatars.githubusercontent.com/u/30458572?s=64&v=4)](https://github.com/XiaoliChan)
* [![@DevSpork](https://avatars.githubusercontent.com/u/31934016?s=64&v=4)](https://github.com/DevSpork)
* [![@Cyb3rC3lt](https://avatars.githubusercontent.com/u/33097451?s=64&v=4)](https://github.com/Cyb3rC3lt)
* [![@wlayzz](https://avatars.githubusercontent.com/u/34021743?s=64&v=4)](https://github.com/wlayzz)
* [![@PeterGabaldon](https://avatars.githubusercontent.com/u/34518201?s=64&v=4)](https://github.com/PeterGabaldon)
* [![@Adamkadaban](https://avatars.githubusercontent.com/u/34610663?s=64&v=4)](https://github.com/Adamkadaban)
* [![@BlWasp](https://avatars.githubusercontent.com/u/35003340?s=64&v=4)](https://github.com/BlWasp)
* [![@ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?s=64&v=4)](https://github.com/ShutdownRepo)
* [![@joeldeleep](https://avatars.githubusercontent.com/u/42582155?s=64&v=4)](https://github.com/joeldeleep)
* [![@omry99](https://avatars.githubusercontent.com/u/43474808?s=64&v=4)](https://github.com/omry99)
* [![@JerAxxxxxxx](https://avatars.githubusercontent.com/u/44646571?s=64&v=4)](https://github.com/JerAxxxxxxx)
* [![@PfiatDe](https://avatars.githubusercontent.com/u/47333109?s=64&v=4)](https://github.com/PfiatDe)
* [![@dadevel](https://avatars.githubusercontent.com/u/57419228?s=64&v=4)](https://github.com/dadevel)
* [![@anadrianmanrique](https://avatars.githubusercontent.com/u/60896207?s=64&v=4)](https://github.com/anadrianmanrique)
* [![@F-Masood](https://avatars.githubusercontent.com/u/65596260?s=64&v=4)](https://github.com/F-Masood)
* [![@zblurx](https://avatars.githubusercontent.com/u/68540460?s=64&v=4)](https://github.com/zblurx)
* [![@rtpt-erikgeiser](https://avatars.githubusercontent.com/u/70747329?s=64&v=4)](https://github.com/rtpt-erikgeiser)
* [![@SAERXCIT](https://avatars.githubusercontent.com/u/78735647?s=64&v=4)](https://github.com/SAERXCIT)
* [![@p0dalirius](https://avatars.githubusercontent.com/u/79218792?s=64&v=4)](https://github.com/p0dalirius)
* [![@RazzburyPi](https://avatars.githubusercontent.com/u/85591098?s=64&v=4)](https://github.com/RazzburyPi)
* [![@NtAlexio2](https://avatars.githubusercontent.com/u/110637492?s=64&v=4)](https://github.com/NtAlexio2)
* [![@marcobarlottini](https://avatars.githubusercontent.com/u/179370549?s=64&v=4)](https://github.com/marcobarlottini)

trietend, robnanola, and 45 other contributors

 Assets
3

 Loading

 👍
14
 mlec1, godylockz, zblurx, ShadowUser17, exploide, PROPS1, 0x123456789, stevleibelt, laztname, orzchen, and 4 more reacted with thumbs up emoji
 🎉
8
 darkseid-is, dadevel, Veids, darses, RapidWolf95, covertivy, idealphase, and momep26787 reacted with hooray emoji
 ❤️
3
 martingalloar, covertivy, and momep26787 reacted with heart emoji

All reactions

* 👍
  14 reactions
* 🎉
  8 reactions
* ❤️
  3 reactions

 21 people reacted

## Impacket 0.11.0

03 Aug 17:36

![@anadrianmanrique](https://avatars.githubusercontent.com/u/60896207?s=40&v=4)
[anadrianmanrique](/anadrianmanrique)

[impacket\_0\_11\_0](/fortra/impacket/tree/impacket_0_11_0)

[`5af85c2`](/fortra/impacket/commit/5af85c240076444d631d5f504e294daff065796b)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_11_0)

 Loading

[View all tags](/fortra/impacket/tags)

[Impacket 0.11.0](/fortra/impacket/releases/tag/impacket_0_11_0)

## Impacket 0.11.0:

Project's main page at <https://www.coresecurity.com/core-labs/open-source-tools/impacket>

ChangeLog for 0.11.0:

1. Library improvements

   * Added new Kerberos error codes ([@ly4k](https://github.com/ly4k)).
   * Added `[MS-TSTS]` Terminal Services Terminal Server Runtime Interface Protocol implementation ([@nopernik](https://github.com/nopernik)).
   * Changed the setting up for new SSL connections ([@mpgn](https://github.com/mpgn), @CT-H00K and [@0xdeaddood](https://github.com/0xdeaddood)).
   * Added a callback function to smbserver for incoming authentications ([@p0dalirius](https://github.com/p0dalirius)).
   * Fix crash in winregistry ([@laxa](https://github.com/laxa))
   * Fixes in IDispatch derived classes in comev implementation ([@NtAlexio2](https://github.com/NtAlexio2))
   * Fix [CVE-2020-17049](https://github.com/advisories/GHSA-g2p3-j47p-8cwj "CVE-2020-17049") in ccache.py ([@godylockz](https://github.com/godylockz))
   * Smbserver: Added SMB2\_FILE\_ALLOCATION\_INFO type determination ([@JerAxxxxxxx](https://github.com/JerAxxxxxxx))
   * tds: Fixed python3 incompatibility when receiving over TLS socket ([@exploide](https://github.com/exploide))
   * crypto: Ensure passwords are utf-8 encoded before deriving Kerberos keys ([@jojonas](https://github.com/jojonas))
   * ese: Fixed python3 incompatibility when reading from db ([@alexisbalbachan](https://github.com/alexisbalbachan))
   * ldap queries: Escaped characters are now correctly parsed ([@alexisbalbachan](https://github.com/alexisbalbachan))
   * Support SASL authentication in ldap protocol ([@NtAlexio2](https://github.com/NtAlexio2))
2. Examples improvements

   * [GetADUsers.py](/fortra/impacket/blob/impacket_0_11_0/examples/GetADUsers.py), [GetNPUsers.py](/fortra/impacket/blob/impacket_0_11_0/examples/GetNPUsers.py), [GetUserSPNs.py](/fortra/impacket/blob/impacket_0_11_0/examples/GetUserSPNs.py) and [findDelegation.py](/fortra/impacket/blob/impacket_0_11_0/examples/findDelegation.py):
     + Added dc-host option to connect to specific KDC using its FQDN or NetBIOS name ([@rmaksimov](https://github.com/rmaksimov) and [@0xdeaddood](https://github.com/0xdeaddood)).
   * [GetNPUsers.py](/fortra/impacket/blob/impacket_0_11_0/examples/GetNPUsers.py)
     + Printing TGT in stdout despite -outputfile parameter ([@alexisbalbachan](https://github.com/alexisbalbachan) and [@Zamanry](https://github.com/Zamanry))
     + Fixed output hash format for AES128/256 (etype 17/18) ([@erasmusc](https://github.com/erasmusc))
   * [GetUserSPNs.py](/fortra/impacket/blob/impacket_0_11_0/examples/GetUserSPNs.py):
     + Added LDAP paged search ([@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers) and [@SAERXCIT](https://github.com/SAERXCIT)).
     + Added a -stealth flag to remove the SPN filter from the LDAP query ([@clavoillotte](https://github.com/clavoillotte)).
     + Improved searchFilter ([@ShutdownRepo](https://github.com/ShutdownRepo))
     + Use LDAP paged search ([@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers))
   * [psexec.py](/fortra/impacket/blob/impacket_0_11_0/examples/psexec.py):
     + Added support for name customization using a custom binary file ([@Dramelac](https://github.com/Dramelac)).
   * [smbexec.py](/fortra/impacket/blob/impacket_0_11_0/examples/smbexec.py):
     + Security fixes for privilege escalation vulnerabilities ([@bugch3ck](https://github.com/bugch3ck)).
     + Fixed python3 compatibility issues, added workaround TCP over NetBIOS being disabled ([@ljrk0](https://github.com/ljrk0))
   * [secretsdump.py](/fortra/impacket/blob/impacket_0_11_0/examples/secretsdump.py):
     + Added a new option to extract only NTDS.DIT data for specific users based on an LDAP filter ([@snovvcrash](https://github.com/snovvcrash)).
     + Security fixes for privilege escalation vulnerabilities ([@bugch3ck](https://github.com/bugch3ck)).
   * [mssqlclient.py](/fortra/impacket/blob/impacket_0_11_0/examples/mssqlclient.py):
     + Added multiple new commands. Now supports xp\_dirtree execution ([@Mayfly277](https://github.com/Mayfly277), [@trietend](https://github.com/trietend) and [@TurtleARM](https://github.com/TurtleARM)).
   * [ntlmrelayx.py](/fortra/impacket/blob/impacket_0_11_0/examples/ntlmrelayx.py):
     + Added ability to trigger SQLShell when running ntlmrelayx in interactive mode ([@sploutchy](https://github.com/sploutchy)).
     + Added filter option to the socks command in ntlmrelayx CLI ([@shoxxdj](https://github.com/shoxxdj))
     + Added ability to register DNS records through LDAP.
   * [addcomputer.py](/fortra/impacket/blob/impacket_0_11_0/examples/addcomputer.py), [rbcd.py](/fortra/impacket/blob/impacket_0_11_0/examples/rbcd.py):
     + Allow weak TLS ciphers for LDAP connections ([@AdrianVollmer](https://github.com/AdrianVollmer))
   * [Get-GPPPassword.py](/fortra/impacket/blob/impacket_0_11_0/examples/Get-GPPPassword.py):
     + Better handling of various XML files in Group Policy Preferences ([@p0dalirius](https://github.com/p0dalirius))
   * [smbclient.py](/fortra/impacket/blob/impacket_0_11_0/examples/smbclient.py):
     + Added recursive file listing ([@Sq00ky](https://github.com/Sq00ky))
   * [ticketer.py](/fortra/impacket/blob/impacket_0_11_0/examples/ticketer.py):
     + Ticket duration is now specified in hours instead of days ([@Dramelac](https://github.com/Dramelac))
     + Added extra-pac implementation ([@Dramelac](https://github.com/Dramelac))
3. New examples

   * [net.py](/fortra/impacket/blob/impacket_0_11_0/examples/net.py) Implementation of windows net.exe builtin tool ([@NtAlexio2](https://github.com/NtAlexio2))
   * [changepasswd.py](/fortra/impacket/blob/impacket_0_11_0/examples/changepasswd.py) New example that allows password changing or reseting through multiple protocols ([@Alef-Burzmali](https://github.com/Alef-Burzmali), [@snovvcrash](https://github.com/snovvcrash), [@bransh](https://github.com/bransh), [@api0cradle](https://github.com/api0cradle) and [@p0dalirius](https://github.com/p0dalirius))
   * [DumpNTLMInfo.py](/fortra/impacket/blob/impacket_0_11_0/examples/DumpNTLMInfo.py) New example that dumps remote host information in ntlm authentication model, without credentials. For SMB protocols v1, v2 and v3. ([@NtAlexio2](https://github.com/NtAlexio2))

As always, thanks a lot to all these contributors that make this library better every day (up to now):

[@ly4k](https://github.com/ly4k) [@nopernik](https://github.com/nopernik) [@snovvcrash](https://github.com/snovvcrash) [@ShutdownRepo](https://github.com/ShutdownRepo) [@kiwids0220](https://github.com/kiwids0220) [@mpgn](https://github.com/mpgn) @CT-H00K [@rmaksimov](https://github.com/rmaksimov) [@arossert](https://github.com/arossert) [@aevy-syn](https://github.com/aevy-syn) [@tirkarthi](https://github.com/tirkarthi) [@p0dalirius](https://github.com/p0dalirius) [@Dramelac](https://github.com/Dramelac) [@Mayfly277](https://github.com/Mayfly277) [@S3cur3Th1sSh1t](https://github.com/S3cur3Th1sSh1t) [@nobbd](https://github.com/nobbd) [@AdrianVollmer](https://github.com/AdrianVollmer) [@trietend](https://github.com/trietend) [@TurtleARM](https://github.com/TurtleARM) [@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers) [@SAERXCIT](https://github.com/SAERXCIT) [@clavoillotte](https://github.com/clavoillotte) [@Marshall-Hallenbeck](https://github.com/Marshall-Hallenbeck) [@sploutchy](https://github.com/sploutchy) [@almandin](https://github.com/almandin) [@rtpt-alexanderneumann](https://github.com/rtpt-alexanderneumann) [@JerAxxxxxxx](https://github.com/JerAxxxxxxx) [@NtAlexio2](https://github.com/NtAlexio2) [@laxa](https://github.com/laxa) [@godylockz](https://github.com/godylockz) [@exploide](https://github.com/exploide) [@jojonas](https://github.com/jojonas) [@Zamanry](https://github.com/Zamanry) [@erasmusc](https://github.com/erasmusc) [@bugch3ck](https://github.com/bugch3ck) [@ljrk0](https://github.com/ljrk0) [@Sq00ky](https://github.com/Sq00ky) [@shoxxdj](https://github.com/shoxxdj) [@Alef-Burzmali](https://github.com/Alef-Burzmali) [@bransh](https://github.com/bransh) [@api0cradle](https://github.com/api0cradle) [@alexisbalbachan](https://github.com/alexisbalbachan) [@0xdeaddood](https://github.com/0xdeaddood) [@Sanmopre](https://github.com/Sanmopre)

### Contributors

* [![@trietend](https://avatars.githubusercontent.com/u/212042?s=64&v=4)](https://github.com/trietend)
* [![@laxa](https://avatars.githubusercontent.com/u/450587?s=64&v=4)](https://github.com/laxa)
* [![@TurtleARM](https://avatars.githubusercontent.com/u/1218718?s=64&v=4)](https://github.com/TurtleARM)
* [![@Alef-Burzmali](https://avatars.githubusercontent.com/u/1355939?s=64&v=4)](https://github.com/Alef-Burzmali)
* [![@sploutchy](https://avatars.githubusercontent.com/u/1473439?s=64&v=4)](https://github.com/sploutchy)
* [![@Marshall-Hallenbeck](https://avatars.githubusercontent.com/u/1518719?s=64&v=4)](https://github.com/Marshall-Hallenbeck)
* [![@rmaksimov](https://avatars.githubusercontent.com/u/2904679?s=64&v=4)](https://github.com/rmaksimov)
* [![@tirkarthi](https://avatars.githubusercontent.com/u/3972343?s=64&v=4)](https://github.com/tirkarthi)
* [![@bugch3ck](https://avatars.githubusercontent.com/u/4165895?s=64&v=4)](https://github.com/bugch3ck)
* [![@jojonas](https://avatars.githubusercontent.com/u/5059857?s=64&v=4)](https://github.com/jojonas)
* [![@shoxxdj](https://avatars.githubusercontent.com/u/5250807?s=64&v=4)](https://github.com/shoxxdj)
* [![@exploide](https://avatars.githubusercontent.com/u/5670236?s=64&v=4)](https://github.com/exploide)
* [![@mpgn](https://avatars.githubusercontent.com/u/5891788?s=64&v=4)](https://github.com/mpgn)
* [![@nobbd](https://avatars.githubusercontent.com/u/5907251?s=64&v=4)](https://github.com/nobbd)
* [![@arossert](https://avatars.githubusercontent.com/u/7085494?s=64&v=4)](https://github.com/arossert)
* [![@ljrk0](https://avatars.githubusercontent.com/u/7831843?s=64&v=4)](https://github.com/ljrk0)
* [![@alexisbalbachan](https://avatars.githubusercontent.com/u/8486486?s=64&v=4)](https://github.com/alexisbalbachan)
* [![@almandin](https://avatars.githubusercontent.com/u/9830129?s=64&v=4)](https://github.com/almandin)
* [![@Dramelac](https://avatars.githubusercontent.com/u/10145128?s=64&v=4)](https://github.com/Dramelac)
* [![@nopernik](https://avatars.githubusercontent.com/u/11662758?s=64&v=4)](https://github.com/nopernik)
* [![@api0cradle](https://avatars.githubusercontent.com/u/12997471?s=64&v=4)](https://github.com/api0cradle)
* [![@clavoillotte](https://avatars.githubusercontent.com/u/13526797?s=64&v=4)](https://github.com/clavoillotte)
* [![@ThePirateWhoSmellsOfSunflowers](https://avatars.githubusercontent.com/u/18633286?s=64&v=4)](https://github.com/ThePirateWhoSmellsOfSunflowers)
* [![@snovvcrash](https://avatars.githubusercontent.com/u/23141800?s=64&v=4)](https://github.com/snovvcrash)
* [![@Mayfly277](https://avatars.githubusercontent.com/u/23179648?s=64&v=4)](https://github.com/Mayfly277)
* [![@bransh](https://avatars.githubusercontent.com/u/24248983?s=64&v=4)](https://github.com/bransh)
* [![@AdrianVollmer](https://avatars.githubusercontent.com/u/26064811?s=64&v=4)](https://github.com/AdrianVollmer)
* [![@S3cur3Th1sSh1t](https://avatars.githubusercontent.com/u/27858067?s=64&v=4)](https://github.com/S3cur3Th1sSh1t)
* [![@Zamanry](https://avatars.githubusercontent.com/u/28152647?s=64&v=4)](https://github.com/Zamanry)
* [![@Sanmopre](https://avatars.githubusercontent.com/u/40120264?s=64&v=4)](https://github.com/Sanmopre)
* [![@ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?s=64&v=4)](https://github.com/ShutdownRepo)
* [![@JerAxxxxxxx](https://avatars.githubusercontent.com/u/44646571?s=64&v=4)](https://github.com/JerAxxxxxxx)
* [![@Sq00ky](https://avatars.githubusercontent.com/u/44957111?s=64&v=4)](https://github.com/Sq00ky)
* [![@aevy-syn](https://avatars.githubusercontent.com/u/50951297?s=64&v=4)](https://github.com/aevy-syn)
* [![@ly4k](https://avatars.githubusercontent.com/u/53348818?s=64&v=4)](https://github.com/ly4k)
* [![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=64&v=4)](https://github.com/0xdeaddood)
* [![@kiwids0220](https://avatars.githubusercontent.com/u/60630639?s=64&v=4)](https://github.com/kiwids0220)
* [![@rtpt-alexanderneumann](https://avatars.githubusercontent.com/u/62751754?s=64&v=4)](https://github.com/rtpt-alexanderneumann)
* [![@0xArt3mis](https://avatars.githubusercontent.com/u/73144188?s=64&v=4)](https://github.com/0xArt3mis)
* [![@SAERXCIT](https://avatars.githubusercontent.com/u/78735647?s=64&v=4)](https://github.com/SAERXCIT)
* [![@p0dalirius](https://avatars.githubusercontent.com/u/79218792?s=64&v=4)](https://github.com/p0dalirius)
* [![@godylockz](https://avatars.githubusercontent.com/u/81207744?s=64&v=4)](https://github.com/godylockz)
* [![@NtAlexio2](https://avatars.githubusercontent.com/u/110637492?s=64&v=4)](https://github.com/NtAlexio2)
* [![@erasmusc](https://avatars.githubusercontent.com/u/131447877?s=64&v=4)](https://github.com/erasmusc)

trietend, laxa, and 42 other contributors

 Assets
3

 Loading

 👍
14
 ShadowUser17, war59312, musyoka101, Hackndo, juliourena, JerAxxxxxxx, nclv, aleksandrtikhonov, sqrtZeroKnowledge, jensregel, and 4 more reacted with thumbs up emoji
 🎉
5
 anadrianmanrique, NtAlexio2, Hackndo, JerAxxxxxxx, and NeffIsBack reacted with hooray emoji
 ❤️
9
 0xdeaddood, fgeek, Hackndo, Marshall-Hallenbeck, JerAxxxxxxx, covertivy, Thunde7, k3nundrum, and NeffIsBack reacted with heart emoji

All reactions

* 👍
  14 reactions
* 🎉
  5 reactions
* ❤️
  9 reactions

 22 people reacted

## Impacket 0.10.0

04 May 14:55

![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=40&v=4)
[0xdeaddood](/0xdeaddood)

[impacket\_0\_10\_0](/fortra/impacket/tree/impacket_0_10_0)

[`7a18ef5`](/fortra/impacket/commit/7a18ef5c8b06aac5e36334927789429777382928)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_10_0)

 Loading

[View all tags](/fortra/impacket/tags)

[Impacket 0.10.0](/fortra/impacket/releases/tag/impacket_0_10_0)

Project's main page at <https://www.secureauth.com/labs/open-source-tools/impacket/>

ChangeLog for 0.10.0:

1. Library improvements

   * Dropped support for Python 2.7.
   * Refactored the testing infrastructure ([@martingalloar](https://github.com/martingalloar)):
     + Added pytest as the testing framework to organize and mark test cases. Tox remain as the automation framework, and Coverage.py for measuring code coverage.
     + Custom bash scripts were replaced with test cases auto-discovery.
     + Local and remote test cases were marked for easy run and configuration.
     + DCE/RPC endpoint test cases were refactored and moved to a new layout.
     + An initial testing guide with the main steps to prepare a testing environment and run them.
     + Fixed a good amount of DCE/RPC endpoint test cases that were failing.
     + Added tests for [MS-PAR], [MS-RPRN], CCache and DPAPI.
   * Added a function to compute the Netlogon Authenticator at client-side in [MS-NRPC] ([@0xdeaddood](https://github.com/0xdeaddood))
   * Added [MS-DSSP] protocol implementation ([@simondotsh](https://github.com/simondotsh))
   * Added GetDriverDirectory functions to [MS-PAR] and [MS-RPRN] ([@raithedavion](https://github.com/raithedavion))
   * Refactored the Credential Cache:
     + Added new parseFile function to ccache.py ([@rmaksimov](https://github.com/rmaksimov))
     + Added support for loading CCache Version 3 ([@reznok](https://github.com/reznok))
     + Modified fromKRBCRED function used to load a Kirbi file ([@0xdeaddood](https://github.com/0xdeaddood))
     + Fixed Ccache to Kirbi conversion ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * Fixed default NTLM server challenge in smbserver (@rtpt-jonaslieb)
2. Examples improvements

   * [exchanger.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/exchanger.py):
     + Fixed a bug when a Global Address List doesn't exist on the server ([@mohemiv](https://github.com/mohemiv))
   * [mimikatz.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mimikatz.py)
     + Updated intro to not trigger the AV on windows ([@mpgn](https://github.com/mpgn))
   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py):
     + Implemented RAW Relay Server ([@CCob](https://github.com/CCob))
     + Added an LDAP attack dumping information about the domain's ADCS enrollment services ([@SAERXCIT](https://github.com/SAERXCIT))
     + Added multi-relay feature to the HTTP Relay Server. Now one incoming HTTP connection could be used against multiple targets ([@0xdeaddood](https://github.com/0xdeaddood))
     + Added an option to disable the multi-relay feature ([@zblurx](https://github.com/zblurx) and [@0xdeaddood](https://github.com/0xdeaddood))
     + Added multiple HTTP listeners running at the same time ([@SAERXCIT](https://github.com/SAERXCIT))
     + Support for the ADCS ESC1 and ESC6 attacks ([@hugo-syn](https://github.com/hugo-syn))
     + Added Shadow Credentials attack ([@ShutdownRepo](https://github.com/ShutdownRepo), [@Tw1sm](https://github.com/Tw1sm), [@nodauf](https://github.com/nodauf) and [@p0dalirius](https://github.com/p0dalirius))
     + Added the ability to define a password for the LDAP attack addComputer ([@ShutdownRepo](https://github.com/ShutdownRepo))
     + Added rename\_computer and modify add\_computer in LDAP interactive shell ([@capnkrunchy](https://github.com/capnkrunchy))
     + Implemented StartTLS ([@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers))
   * [reg.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/reg.py):
     + Added save function to allow remote saving of registry hives ([@ShutdownRepo](https://github.com/ShutdownRepo) and [@scopedsecurity](https://github.com/scopedsecurity))
   * [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py):
     + Added an option to dump credentials using the Kerberos Key List attack ([@0xdeaddood](https://github.com/0xdeaddood))
   * [smbpasswd.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbpasswd.py):
     + Added an option to force credentials change via injecting new values into SAM ([@snovvcrash](https://github.com/snovvcrash) and [@Alef-Burzmali](https://github.com/Alef-Burzmali)!)
3. New examples

   * [machine\_role.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/machine_role.py): This script retrieves a host's role along with its primary domain details ([@simondotsh](https://github.com/simondotsh))
   * [keylistattack.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/keylistattack.py): This example implements the Kerberos Key List attack to dump credentials abusing RODCs and Azure AD Kerberos Servers ([@0xdeaddood](https://github.com/0xdeaddood))

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@rmaksimov](https://github.com/rmaksimov) [@simondotsh](https://github.com/simondotsh) [@CCob](https://github.com/CCob) [@raithedavion](https://github.com/raithedavion) [@SAERXCIT](https://github.com/SAERXCIT) [@Maltemo](https://github.com/Maltemo) [@dirkjanm](https://github.com/dirkjanm) [@reznok](https://github.com/reznok) [@ShutdownRepo](https://github.com/ShutdownRepo) [@scopedsecurity](https://github.com/scopedsecurity) [@Tw1sm](https://github.com/Tw1sm) [@nodauf](https://github.com/nodauf) [@p0dalirius](https://github.com/p0dalirius) [@zblurx](https://github.com/zblurx) [@hugo-syn](https://github.com/hugo-syn) [@capnkrunchy](https://github.com/capnkrunchy) [@mohemiv](https://github.com/mohemiv) [@mpgn](https://github.com/mpgn) @rtpt-jonaslieb [@snovvcrash](https://github.com/snovvcrash) [@Alef-Burzmali](https://github.com/Alef-Burzmali) [@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers) [@jlvcm](https://github.com/jlvcm)

### Contributors

* [![@Alef-Burzmali](https://avatars.githubusercontent.com/u/1355939?s=64&v=4)](https://github.com/Alef-Burzmali)
* [![@jlvcm](https://avatars.githubusercontent.com/u/1488668?s=64&v=4)](https://github.com/jlvcm)
* [![@dirkjanm](https://avatars.githubusercontent.com/u/1773762?s=64&v=4)](https://github.com/dirkjanm)
* [![@rmaksimov](https://avatars.githubusercontent.com/u/2904679?s=64&v=4)](https://github.com/rmaksimov)
* [![@CCob](https://avatars.githubusercontent.com/u/3064210?s=64&v=4)](https://github.com/CCob)
* [![@martingalloar](https://avatars.githubusercontent.com/u/3941628?s=64&v=4)](https://github.com/martingalloar)
* [![@mohemiv](https://avatars.githubusercontent.com/u/5724896?s=64&v=4)](https://github.com/mohemiv)
* [![@mpgn](https://avatars.githubusercontent.com/u/5891788?s=64&v=4)](https://github.com/mpgn)
* [![@nodauf](https://avatars.githubusercontent.com/u/7670696?s=64&v=4)](https://github.com/nodauf)
* [![@raithedavion](https://avatars.githubusercontent.com/u/10229133?s=64&v=4)](https://github.com/raithedavion)
* [![@Maltemo](https://avatars.githubusercontent.com/u/18104855?s=64&v=4)](https://github.com/Maltemo)
* [![@ThePirateWhoSmellsOfSunflowers](https://avatars.githubusercontent.com/u/18633286?s=64&v=4)](https://github.com/ThePirateWhoSmellsOfSunflowers)
* [![@scopedsecurity](https://avatars.githubusercontent.com/u/18901000?s=64&v=4)](https://github.com/scopedsecurity)
* [![@snovvcrash](https://avatars.githubusercontent.com/u/23141800?s=64&v=4)](https://github.com/snovvcrash)
* [![@reznok](https://avatars.githubusercontent.com/u/23696484?s=64&v=4)](https://github.com/reznok)
* [![@Tw1sm](https://avatars.githubusercontent.com/u/37981031?s=64&v=4)](https://github.com/Tw1sm)
* [![@ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?s=64&v=4)](https://github.com/ShutdownRepo)
* [![@capnkrunchy](https://avatars.githubusercontent.com/u/47148444?s=64&v=4)](https://github.com/capnkrunchy)
* [![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=64&v=4)](https://github.com/0xdeaddood)
* [![@hugo-syn](https://avatars.githubusercontent.com/u/61210734?s=64&v=4)](https://github.com/hugo-syn)
* [![@zblurx](https://avatars.githubusercontent.com/u/68540460?s=64&v=4)](https://github.com/zblurx)
* [![@SAERXCIT](https://avatars.githubusercontent.com/u/78735647?s=64&v=4)](https://github.com/SAERXCIT)
* [![@p0dalirius](https://avatars.githubusercontent.com/u/79218792?s=64&v=4)](https://github.com/p0dalirius)
* [![@simondotsh](https://avatars.githubusercontent.com/u/91923903?s=64&v=4)](https://github.com/simondotsh)

Alef-Burzmali, jlvcm, and 22 other contributors

 Assets
3

 Loading

 ❤️
9
 ThePirateWhoSmellsOfSunflowers, rmaksimov, xnianq, jlvcm, mh4x0f, No-Github, ret2basic, syskey-del, and Blaqsense reacted with heart emoji
 🚀
8
 martingalloar, ShutdownRepo, SAERXCIT, 0xfeeddeadbeef, iyanging, jlvcm, No-Github, and syskey-del reacted with rocket emoji

All reactions

* ❤️
  9 reactions
* 🚀
  8 reactions

 14 people reacted

## Impacket 0.9.24

27 Oct 15:29

![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=40&v=4)
[0xdeaddood](/0xdeaddood)

[impacket\_0\_9\_24](/fortra/impacket/tree/impacket_0_9_24)

[`265ce17`](/fortra/impacket/commit/265ce178fc1afcf942e2e1fabd7c8fab64e94893)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_24)

 Loading

[View all tags](/fortra/impacket/tags)

[Impacket 0.9.24](/fortra/impacket/releases/tag/impacket_0_9_24)

Project's main page at <https://www.secureauth.com/labs/open-source-tools/impacket/>

ChangeLog for 0.9.24:

1. Library improvements

   * Fixed WMI objects parsing ([@franferrax](https://github.com/franferrax))
   * Added the RpcAddPrinterDriverEx method and related structures to [MS-RPRN]: Print System Remote Protocol ([@cube0x0](https://github.com/cube0x0))
   * Initial implementation of [MS-PAR]: Print System Asynchronous Remote Protocol ([@cube0x0](https://github.com/cube0x0))
   * Complying MS-RPCH with HTTP/1.1 ([@mohemiv](https://github.com/mohemiv))
   * Added return of server time in case of Kerberos error ([@ShutdownRepo](https://github.com/ShutdownRepo) and [@Hackndo](https://github.com/Hackndo))
2. Examples improvements

   * [getST.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/getST.py):
     + Added support for a custom additional ticket for S4U2Proxy ([@ShutdownRepo](https://github.com/ShutdownRepo))
   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/ntlmrelayx.py):
     + Added Negotiate authentication support to the HTTP server ([@LZD-TMoreggia](https://github.com/LZD-TMoreggia))
     + Added anonymous session handling in the HTTP server ([@0xdeaddood](https://github.com/0xdeaddood))
     + Fixed error in ldapattack.py when trying to escalate with machine account ([@Rcarnus](https://github.com/Rcarnus))
     + Added the implementation of AD CS attack ([@ExAndroidDev](https://github.com/ExAndroidDev))
     + Disabled the anonymous logon in the SMB server ([@ly4k](https://github.com/ly4k))
   * [psexec.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/psexec.py):
     + Fixed decoding problems on multi bytes characters ([@p0dalirius](https://github.com/p0dalirius))
   * [reg.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/reg.py):
     + Implemented ADD and DELETE functionalities ([@Gifts](https://github.com/Gifts))
   * [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/secretsdump.py):
     + Speeding up NTDS parsing ([@skelsec](https://github.com/skelsec))
   * [smbclient.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/smbclient.py):
     + Added 'mget' command which allows the download of multiple files ([@deadjakk](https://github.com/deadjakk))
     + Handling empty search count in FindFileBothDirectoryInfo ([@martingalloar](https://github.com/martingalloar))
   * [smbpasswd.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/smbpasswd.py):
     + Added the ability to change a user's password providing NTLM hashes ([@snovvcrash](https://github.com/snovvcrash))
   * [smbserver.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/smbserver.py):
     + Added NULL SMBv2 client connection handling ([@0xdeaddood](https://github.com/0xdeaddood))
     + Hardened path checks and Added TID checks ([@martingalloar](https://github.com/martingalloar))
     + Added SMB2 support to QUERY\_INFO Request and Enabled SMB\_COM\_FLUSH method ([@0xdeaddood](https://github.com/0xdeaddood))
     + Added missing constant and structure for the QUERY\_FS Information Level SMB\_QUERY\_FS\_DEVICE\_INFO ([@martingalloar](https://github.com/martingalloar))
   * [wmipersist.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/wmipersist.py):
     + Fixed VBA script execution and improved error checking ([@franferrax](https://github.com/franferrax))
3. New examples

   * [rbcd.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_24/examples/rbcd.py): Example script for handling the msDS-AllowedToActOnBehalfOfOtherIdentity property of a target computer ([@ShutdownRepo](https://github.com/ShutdownRepo) and [@p0dalirius](https://github.com/p0dalirius)) (based on the previous work of [@tothi](https://github.com/tothi) and [@NinjaStyle82](https://github.com/NinjaStyle82))

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@deadjakk](https://github.com/deadjakk) [@franferrax](https://github.com/franferrax) [@cube0x0](https://github.com/cube0x0) [@w0rmh013](https://github.com/w0rmh013) [@skelsec](https://github.com/skelsec) [@mohemiv](https://github.com/mohemiv) [@LZD-TMoreggia](https://github.com/LZD-TMoreggia) [@exploide](https://github.com/exploide) [@ShutdownRepo](https://github.com/ShutdownRepo) [@Hackndo](https://github.com/Hackndo) [@snovvcrash](https://github.com/snovvcrash) [@rmaksimov](https://github.com/rmaksimov) [@Gifts](https://github.com/Gifts) [@Rcarnus](https://github.com/Rcarnus) [@ExAndroidDev](https://github.com/ExAndroidDev) [@ly4k](https://github.com/ly4k) [@p0dalirius](https://github.com/p0dalirius)

### Contributors

* [![@Gifts](https://avatars.githubusercontent.com/u/1255811?s=64&v=4)](https://github.com/Gifts)
* [![@rmaksimov](https://avatars.githubusercontent.com/u/2904679?s=64&v=4)](https://github.com/rmaksimov)
* [![@martingalloar](https://avatars.githubusercontent.com/u/3941628?s=64&v=4)](https://github.com/martingalloar)
* [![@exploide](https://avatars.githubusercontent.com/u/5670236?s=64&v=4)](https://github.com/exploide)
* [![@mohemiv](https://avatars.githubusercontent.com/u/5724896?s=64&v=4)](https://github.com/mohemiv)
* [![@tothi](https://avatars.githubusercontent.com/u/6377720?s=64&v=4)](https://github.com/tothi)
* [![@franferrax](https://avatars.githubusercontent.com/u/8713657?s=64&v=4)](https://github.com/franferrax)
* [![@Rcarnus](https://avatars.githubusercontent.com/u/8790185?s=64&v=4)](https://github.com/Rcarnus)
* [![@NinjaStyle82](https://avatars.githubusercontent.com/u/10945042?s=64&v=4)](https://github.com/NinjaStyle82)
* [![@Hackndo](https://avatars.githubusercontent.com/u/11051803?s=64&v=4)](https://github.com/Hackndo)
* [![@skelsec](https://avatars.githubusercontent.com/u/19204702?s=64&v=4)](https://github.com/skelsec)
* [![@w0rmh013](https://avatars.githubusercontent.com/u/21958142?s=64&v=4)](https://github.com/w0rmh013)
* [![@snovvcrash](https://avatars.githubusercontent.com/u/23141800?s=64&v=4)](https://github.com/snovvcrash)
* [![@deadjakk](https://avatars.githubusercontent.com/u/30613497?s=64&v=4)](https://github.com/deadjakk)
* [![@cube0x0](https://avatars.githubusercontent.com/u/39370848?s=64&v=4)](https://github.com/cube0x0)
* [![@ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?s=64&v=4)](https://github.com/ShutdownRepo)
* [![@ly4k](https://avatars.githubusercontent.com/u/53348818?s=64&v=4)](https://github.com/ly4k)
* [![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=64&v=4)](https://github.com/0xdeaddood)
* [![@LZD-TMoreggia](https://avatars.githubusercontent.com/u/79073462?s=64&v=4)](https://github.com/LZD-TMoreggia)
* [![@p0dalirius](https://avatars.githubusercontent.com/u/79218792?s=64&v=4)](https://github.com/p0dalirius)
* [![@ExAndroidDev](https://avatars.githubusercontent.com/u/80745365?s=64&v=4)](https://github.com/ExAndroidDev)

Gifts, rmaksimov, and 19 other contributors

 Assets
3

 Loading

 🎉
4
 mpgn, haymizot, Flangvik, and hyunwen reacted with hooray emoji
 ❤️
3
 martingalloar, wywwzjj, and xiosec reacted with heart emoji

All reactions

* 🎉
  4 reactions
* ❤️
  3 reactions

 7 people reacted

## Impacket 0.9.23

09 Jun 15:07

![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=40&v=4)
[0xdeaddood](/0xdeaddood)

[impacket\_0\_9\_23](/fortra/impacket/tree/impacket_0_9_23)

[`090cf0c`](/fortra/impacket/commit/090cf0cc92f6da1a3efe366230d94608a265deba)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_23)

 Loading

[View all tags](/fortra/impacket/tags)

[Impacket 0.9.23](/fortra/impacket/releases/tag/impacket_0_9_23)

Project's main page at <https://www.secureauth.com/labs/open-source-tools/impacket/>

ChangeLog for 0.9.23:

1. Library improvements

   * Support connect timeout with SMBTransport ([@vruello](https://github.com/vruello))
   * Speeding up DcSync ([@mohemiv](https://github.com/mohemiv))
   * Fixed Python3 issue when serving SOCKS5 requests ([@agsolino](https://github.com/agsolino))
   * Moved docker container to Python 3.8 ([@mgallo](https://github.com/mgallo))
   * Added basic GitHub Actions workflow ([@mgallo](https://github.com/mgallo))
   * Fixed Path Traversal vulnerabilities in smbserver.py - [CVE-2021-31800](https://github.com/advisories/GHSA-mj63-64x7-57xf "CVE-2021-31800") ([@omriinbar](https://github.com/omriinbar) AppSec Researcher at CheckMarx)
   * Fixed POST request processing in httprelayserver.py ([@Rcarnus](https://github.com/Rcarnus))
   * Added cat command to smbclient.py ([@mxrch](https://github.com/mxrch))
   * Added new features to the LDAP Interactive Shell to facilitate AD exploitation ([@adamcrosser](https://github.com/adamcrosser))
   * Python 3.9 support ([@meeuw](https://github.com/meeuw) and [@cclauss](https://github.com/cclauss))
2. Examples improvements

   * [addcomputer.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/addcomputer.py):
     + Enable the machine account created via SAMR ([@0xdeaddood](https://github.com/0xdeaddood))
   * [getST.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/getST.py):
     + Added exploit for [CVE-2020-17049](https://github.com/advisories/GHSA-g2p3-j47p-8cwj "CVE-2020-17049") - Kerberos Bronze Bit attack ([@jakekarnes42](https://github.com/jakekarnes42))
     + Compute NTHash and AESKey for the Bronze Bit attack automatically ([@snovvcrash](https://github.com/snovvcrash))
   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/ntlmrelayx.py):
     + Fixed target parsing error ([@0xdeaddood](https://github.com/0xdeaddood))
   * [wmipersist.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/wmipersist.py):
     + Fixed filterBinding error ([@franferrax](https://github.com/franferrax))
     + Added PowerShell option for semi-interactive shells in dcomexec.py, smbexec.py and wmiexec.py ([@snovvcrash](https://github.com/snovvcrash))
     + Added new parameter to select COMVERSION in dcomexec.py, wmiexec.py, wmipersist.py and wmiquery.py ([@zexusx26](https://github.com/zexusx26))
3. New examples

   * [Get-GPPPassword.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/Get-GPPPassword.py): This example extracts and decrypts Group Policy Preferences passwords using streams for treating files instead of mounting shares. Additionally, it can parse GPP XML files offline ([@ShutdownRepo](https://github.com/ShutdownRepo) and [@p0dalirius](https://github.com/p0dalirius))
   * [smbpasswd.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_23/examples/smbpasswd.py): This script is an alternative to smbpasswd tool and intended to be used for changing expired passwords remotely over SMB (MSRPC-SAMR) ([@snovvcrash](https://github.com/snovvcrash))

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@mpgn](https://github.com/mpgn) [@vruello](https://github.com/vruello) [@mohemiv](https://github.com/mohemiv) [@jagotu](https://github.com/jagotu) [@jakekarnes42](https://github.com/jakekarnes42) [@snovvcrash](https://github.com/snovvcrash) [@zexusx26](https://github.com/zexusx26) [@omriinbar](https://github.com/omriinbar) [@Rcarnus](https://github.com/Rcarnus) [@nuschpl](https://github.com/nuschpl) [@mxrch](https://github.com/mxrch) [@ShutdownRepo](https://github.com/ShutdownRepo) [@p0dalirius](https://github.com/p0dalirius) [@adamcrosser](https://github.com/adamcrosser) [@franferrax](https://github.com/franferrax) [@meeuw](https://github.com/meeuw) and [@cclauss](https://github.com/cclauss)

### Contributors

* [![@meeuw](https://avatars.githubusercontent.com/u/773800?s=64&v=4)](https://github.com/meeuw)
* [![@mgallo](https://avatars.githubusercontent.com/u/1528511?s=64&v=4)](https://github.com/mgallo)
* [![@jagotu](https://avatars.githubusercontent.com/u/2465633?s=64&v=4)](https://github.com/jagotu)
* [![@cclauss](https://avatars.githubusercontent.com/u/3709715?s=64&v=4)](https://github.com/cclauss)
* [![@jakekarnes42](https://avatars.githubusercontent.com/u/3769323?s=64&v=4)](https://github.com/jakekarnes42)
* [![@nuschpl](https://avatars.githubusercontent.com/u/4950101?s=64&v=4)](https://github.com/nuschpl)
* [![@vruello](https://avatars.githubusercontent.com/u/5345986?s=64&v=4)](https://github.com/vruello)
* [![@mohemiv](https://avatars.githubusercontent.com/u/5724896?s=64&v=4)](https://github.com/mohemiv)
* [![@mpgn](https://avatars.githubusercontent.com/u/5891788?s=64&v=4)](https://github.com/mpgn)
* [![@franferrax](https://avatars.githubusercontent.com/u/8713657?s=64&v=4)](https://github.com/franferrax)
* [![@Rcarnus](https://avatars.githubusercontent.com/u/8790185?s=64&v=4)](https://github.com/Rcarnus)
* [![@mxrch](https://avatars.githubusercontent.com/u/17338428?s=64&v=4)](https://github.com/mxrch)
* [![@snovvcrash](https://avatars.githubusercontent.com/u/23141800?s=64&v=4)](https://github.com/snovvcrash)
* [![@zexusx26](https://avatars.githubusercontent.com/u/35561605?s=64&v=4)](https://github.com/zexusx26)
* [![@ShutdownRepo](https://avatars.githubusercontent.com/u/40902872?s=64&v=4)](https://github.com/ShutdownRepo)
* [![@UNC1739](https://avatars.githubusercontent.com/u/45573557?s=64&v=4)](https://github.com/UNC1739)
* [![@agsolino](https://avatars.githubusercontent.com/u/47219868?s=64&v=4)](https://github.com/agsolino)
* [![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=64&v=4)](https://github.com/0xdeaddood)
* [![@p0dalirius](https://avatars.githubusercontent.com/u/79218792?s=64&v=4)](https://github.com/p0dalirius)
* [![@omriinbar](https://avatars.githubusercontent.com/u/80689106?s=64&v=4)](https://github.com/omriinbar)

meeuw, mgallo, and 18 other contributors

 Assets
3

 Loading

 👍
40
 d4rkc0nd0r, edrojas69, 00lucasm, martingalloar, hugsy, No-Github, tonghuaroot, Lucifer1993, XTeam-Wing, hoefler02, and 30 more reacted with thumbs up emoji
 ❤️
15
 martingalloar, hoefler02, hartl3y94, kulisu, nbaertsch, lsoumille, XaFF-XaFF, eversinc33, NotMyThingy, corsch, and 5 more reacted with heart emoji
 🚀
11
 joswha, hartl3y94, leonjza, mk3-14159, nbaertsch, xElkomy, corsch, liyanyual, zerotts, p0dalirius, and keyboardancer reacted with rocket emoji

All reactions

* 👍
  40 reactions
* ❤️
  15 reactions
* 🚀
  11 reactions

 49 people reacted

## impacket 0.9.22

23 Nov 14:43

![@asolino](https://avatars.githubusercontent.com/u/11577828?s=40&v=4)
[asolino](/asolino)

[impacket\_0\_9\_22](/fortra/impacket/tree/impacket_0_9_22)

[`2438fb6`](/fortra/impacket/commit/2438fb66cea4c6a9b4a04939e1ef9c4208d60134)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_22)

 Loading

[View all tags](/fortra/impacket/tags)

[impacket 0.9.22](/fortra/impacket/releases/tag/impacket_0_9_22)

Project's main page at <https://www.secureauth.com/labs/impacket/>

ChangeLog for 0.9.22:

1. Library improvements

   * Added implementation of RPC over HTTP v2 protocol (by [@mohemiv](https://github.com/mohemiv)).
   * Added MS-NSPI, MS-OXNSPI and MS-OXABREF protocol implementations (by [@mohemiv](https://github.com/mohemiv)).
   * Improved the multi-page results in LDAP queries (by [@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers)).
   * NDR parser optimization (by [@mohemiv](https://github.com/mohemiv)).
   * Improved serialization of WMI method parameters (by [@tshmul](https://github.com/tshmul)).
   * Introduce the MS-NLMP 2.2.2.10 VERSION structure in NTLMAuthNegotiate messages (by [@franferrax](https://github.com/franferrax)).
   * Added some NETLOGON structs for NetrServerPasswordSet2 (by [@dirkjanm](https://github.com/dirkjanm)).
   * Python 3.8 support.
2. Examples improvements

   * [atexec.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/atexec.py): Fixed after MS patches related to RPC attacks (by [@mohemiv](https://github.com/mohemiv)).
   * [dpapi.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/dpapi.py): Added -no-pass, pass-the-hash and AES Key support for backup subcommand.
   * [GetNPUsers.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/GetNPUsers.py): Added ability to enumerate targets with Kerberos KRB5CC (by [@rmaksimov](https://github.com/rmaksimov)).
   * [GetUserSPNs.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/GetUserSPNs.py): Added new features for kerberoasting (by [@mohemiv](https://github.com/mohemiv)).
   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/ntlmrelayx.py):
     + Added ability to relay on new Windows versions that have SMB guest access disabled by default.
     + Added option to specify the NTLM Server Challenge used when receiving a connection.
     + Added relaying to RPC support (by [@mohemiv](https://github.com/mohemiv)).
     + Implemented WCFRelayServer (by [@cnotin](https://github.com/cnotin)).
     + Added Zerologon DCSync Relay Client (by [@dirkjanm](https://github.com/dirkjanm)).
     + Fixed issue in ldapattack.py when relaying and creating computer in CN=Computers (by [@Hackndo](https://github.com/Hackndo)).
   * [rpcdump.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/rpcdump.py): Added RPC over HTTP v2 support (by [@mohemiv](https://github.com/mohemiv)).
   * [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/secretsdump.py):
     + Added ability to specifically delete a shadow based on its ID (by [@phefley](https://github.com/phefley)).
     + Dump plaintext machine account password when dumping the local registry secrets(by [@dirkjanm](https://github.com/dirkjanm)).
3. New examples

   * [exchanger.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/exchanger.py): A tool for connecting to MS Exchange via RPC over HTTP v2 (by [@mohemiv](https://github.com/mohemiv)).
   * [rpcmap.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_22/examples/rpcmap.py): Scan for listening DCE/RPC interfaces (by [@mohemiv](https://github.com/mohemiv)).

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@mohemiv](https://github.com/mohemiv) [@mpgn](https://github.com/mpgn) @Romounet [@ThePirateWhoSmellsOfSunflowers](https://github.com/ThePirateWhoSmellsOfSunflowers) [@rmaksimov](https://github.com/rmaksimov) [@fuzzKitty](https://github.com/fuzzKitty) [@tshmul](https://github.com/tshmul) [@spinenkoia](https://github.com/spinenkoia) [@AaronRobson](https://github.com/AaronRobson) [@ABCIFOGeowi40](https://github.com/ABCIFOGeowi40) [@cclauss](https://github.com/cclauss) [@cnotin](https://github.com/cnotin) [@5alt](https://github.com/5alt) [@franferrax](https://github.com/franferrax) [@Dliv3](https://github.com/Dliv3) [@dirkjanm](https://github.com/dirkjanm) @Mr-Gag @vbersier [@phefley](https://github.com/phefley) [@Hackndo](https://github.com/Hackndo)

 Assets
3

 Loading

All reactions

## impacket 0.9.21

26 Mar 20:10

![@asolino](https://avatars.githubusercontent.com/u/11577828?s=40&v=4)
[asolino](/asolino)

[impacket\_0\_9\_21](/fortra/impacket/tree/impacket_0_9_21)

[`039087d`](/fortra/impacket/commit/039087dd05ac9ae180360b1559957164a30d9bf6)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_21)

 Loading

[View all tags](/fortra/impacket/tags)

[impacket 0.9.21](/fortra/impacket/releases/tag/impacket_0_9_21)

Project's main page at [www.secureauth.com](http://www.secureauth.com)

ChangeLog for 0.9.21:

1. Library improvements

   * New methods into CCache class to import/export kirbi (KRB-CRED) formatted tickets (by [@zer1t0](https://github.com/zer1t0)).
   * Add FSCTL\_SRV\_ENUMERATE\_SNAPSHOTS functionality to SMBConnection (by [@rxwx](https://github.com/rxwx)).
   * Changes in NetBIOS classes in nmb.py (select() by poll() read from socket) (by [@cnotin](https://github.com/cnotin)).
   * Timestamped logging added.
   * Interactive shell to perform LDAP operations (by [@mlefebvre](https://github.com/mlefebvre)).
   * Added two DCE/RPC calls in tsch.py (by [@mohemiv](https://github.com/mohemiv)).
   * Single-source the version number and standardize on symantic + pre-release + local versioning (by [@jsherwood0](https://github.com/jsherwood0)).
   * Added implementation for keytab files (by [@kcirtapw](https://github.com/kcirtapw)).
   * Added SMB 3.1.1 support for Client SMB Connections.
2. Examples improvements

   * [smbclient.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/smbclient.py): List the VSS snapshots for a specified path (by [@rxwx](https://github.com/rxwx)).
   * [GetUserSPNs.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/GetUserSPNs.py): Added delegation information associated with accounts (by [@G0ldenGunSec](https://github.com/G0ldenGunSec)).
   * [dpapi.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/dpapi.py):
     + Added more functions to decrypt masterkeys based on SID + hashes/key. Also support supplying hashes instead of the password for decryption(by [@dirkjanm](https://github.com/dirkjanm)).
     + Pass the hash support for backup key retrieval (by [@imaibou](https://github.com/imaibou)).
     + Added feature to decrypt a user's masterkey using the MS-BKRP (by [@imaibou](https://github.com/imaibou)).
   * [raiseChild.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/raiseChild.py): Added a new flag to specify the RID of a user to dump credentials (by [@0xdeaddood](https://github.com/0xdeaddood)).
   * Added flags to bypass badly made detection use cases (by [@MaxNad](https://github.com/MaxNad)):
     + [smbexec.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/smbexec.py): Possibility to rename the PSExec uploaded binary name with the -remote-binary-name flag.
     + [psexec.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/psexec.py): Possibility to use another service name with the -service-name flag.
   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/ntlmrelayx.py):
     + Added a flag to use a SID as the escalate user for delegation attacks(by [@0xe7](https://github.com/0xe7)).
     + Support for dumping LAPS passwords (by @praetorian-adam-crosser).
     + Added LDAP interactive mode that allow an attacker to manually perform basic operations like creating a new user, adding a user to a group , dump the AD, etc. (by [@mlefebvre](https://github.com/mlefebvre)).
     + Support for multiple relays through one SMB connection (by [@0xdeaddood](https://github.com/0xdeaddood)).
     + Added support for dumping gMSA passwords (by [@cube0x0](https://github.com/cube0x0)).
   * [ticketer.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/ticketer.py): Added an option to use the SPNs keys from a keytab for a silver ticket.(by [@kcirtapw](https://github.com/kcirtapw))
3. New Examples

   * [addcomputer.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/addcomputer.py): Allows add a computer to a domain using LDAP or SAMR (SMB) (by [@jagotu](https://github.com/jagotu))
   * [ticketConverter.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/ticketConverter.py): This script converts kirbi files, commonly used by mimikatz, into ccache files used by Impacket, and vice versa (by [@zer1t0](https://github.com/zer1t0)).
   * [findDelegation.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_21/examples/findDelegation.py): Simple script to quickly list all delegation relationships (unconstrained, constrained, resource-based constrained) in an AD environment (by [@G0ldenGunSec](https://github.com/G0ldenGunSec)).

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@jagotu](https://github.com/jagotu), [@zer1t0](https://github.com/zer1t0) ,[@rxwx](https://github.com/rxwx), [@mpgn](https://github.com/mpgn), [@danhph](https://github.com/danhph), [@awsmhacks](https://github.com/awsmhacks), [@slasyz](https://github.com/slasyz), [@cnotin](https://github.com/cnotin), [@exploide](https://github.com/exploide), [@G0ldenGunSec](https://github.com/G0ldenGunSec), [@dirkjanm](https://github.com/dirkjanm), [@0xdeaddood](https://github.com/0xdeaddood), [@MaxNad](https://github.com/MaxNad), [@imaibou](https://github.com/imaibou), [@BarakSilverfort](https://github.com/BarakSilverfort), [@0xe7](https://github.com/0xe7), [@mlefebvre](https://github.com/mlefebvre), [@rmaksimov](https://github.com/rmaksimov), @praetorian-adam-crosser, [@jsherwood0](https://github.com/jsherwood0), [@mohemiv](https://github.com/mohemiv), [@justin-p](https://github.com/justin-p), [@cube0x0](https://github.com/cube0x0), [@spinenkoia](https://github.com/spinenkoia), [@kcirtapw](https://github.com/kcirtapw), [@MrAnde7son](https://github.com/MrAnde7son), [@fridgehead](https://github.com/fridgehead), [@MarioVilas](https://github.com/MarioVilas).

 Assets
3

 Loading

All reactions

## impacket 0.9.20

25 Sep 17:47

![@asolino](https://avatars.githubusercontent.com/u/11577828?s=40&v=4)
[asolino](/asolino)

[impacket\_0\_9\_20](/fortra/impacket/tree/impacket_0_9_20)

[`647d7be`](/fortra/impacket/commit/647d7be7cb1328ea69340d3b689693220cd5762f)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_20)

 Loading

[View all tags](/fortra/impacket/tags)

[impacket 0.9.20](/fortra/impacket/releases/tag/impacket_0_9_20)

Project's main page at [www.secureauth.com](https://www.secureauth.com/labs/open-source-tools/impacket)

ChangeLog for 0.9.20:

1. Library improvements

   * Python 3.6 support! This is the first release supporting Python 3.x so please issue tickets whenever you find something not working as expected. Libraries and examples should be fully functional.
   * Test coverage [improvements](https://github.com/SecureAuthCorp/impacket/pull/540) by [@infinnovation-dev](https://github.com/infinnovation-dev)
   * Anonymous SMB 2.x Connections are not encrypted anymore (by [@cnotin](https://github.com/cnotin))
   * Support for [multiple PEKs](https://github.com/SecureAuthCorp/impacket/pull/618) when decrypting Windows 2016 DIT files (by [@mikeryan](https://github.com/mikeryan))
2. Examples improvements

   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_20/examples/ntlmrelayx.py):
     1. [CVE-2019-1019](https://github.com/SecureAuthCorp/impacket/pull/635): Bypass SMB singing for unpatched (by [@msimakov](https://github.com/msimakov))
     2. Added [POC](https://github.com/SecureAuthCorp/impacket/pull/637) code for [CVE-2019-1040](https://github.com/advisories/GHSA-8vpr-83m7-3f7q "CVE-2019-1040") (by [@dirkjanm](https://github.com/dirkjanm))
     3. Added NTLM relays leveraging [Webdav](https://github.com/SecureAuthCorp/impacket/pull/652) authentications (by [@salu90](https://github.com/salu90))
3. New Examples

   * [kintercept.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_20/examples/kintercept.py): A tool for intercepting krb5 connections and for testing KDC handling S4U2Self with unkeyed checksum (by [@iboukris](https://github.com/iboukris))

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@infinnovation-dev](https://github.com/infinnovation-dev), [@cnotin](https://github.com/cnotin), [@mikeryan](https://github.com/mikeryan), [@SR4ven](https://github.com/SR4ven), [@cclauss](https://github.com/cclauss), [@skorov](https://github.com/skorov), [@msimakov](https://github.com/msimakov), [@dirkjanm](https://github.com/dirkjanm), [@franferrax](https://github.com/franferrax), [@iboukris](https://github.com/iboukris), [@n1ngod](https://github.com/n1ngod), [@c0d3z3r0](https://github.com/c0d3z3r0), [@MrAnde7son](https://github.com/MrAnde7son).

 Assets
3

 Loading

All reactions

## impacket 0.9.19

01 Apr 17:47

![@asolino](https://avatars.githubusercontent.com/u/11577828?s=40&v=4)
[asolino](/asolino)

[impacket\_0\_9\_19](/fortra/impacket/tree/impacket_0_9_19)

[`621fd66`](/fortra/impacket/commit/621fd66fa4adef112ec45cd0c96207f2a6667300)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_19)

 Loading

[View all tags](/fortra/impacket/tags)

[impacket 0.9.19](/fortra/impacket/releases/tag/impacket_0_9_19)

Project's main page at [www.secureauth.com](https://www.secureauth.com/labs/open-source-tools/impacket)

ChangeLog for 0.9.19:

1. Library improvements

   * [[MS-EVEN]](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_19/impacket/dcerpc/v5/even.py) Interface implementation (Initial - by [@MrAnde7son](https://github.com/MrAnde7son) )
2. Examples improvements

   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_19/examples/ntlmrelayx.py):

     1. Socks local admin check (by [@imaibou](https://github.com/imaibou))
     2. Add Resource Based Delegation features (by [@dirkjanm](https://github.com/dirkjanm))
   * [smbclient.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_19/examples/smbclient.py): Added ability to create/remove mount points to exploit James Forshaw's [Abusing Mount Points over the SMB Protocol](https://tyranidslair.blogspot.com/2018/12/abusing-mount-points-over-smb-protocol.html) technique. (by [@Qwokka](https://github.com/Qwokka))
   * [GetST.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_19/examples/getST.py): Added resource-based constrained delegation support to S4U ([@eladshamir](https://github.com/eladshamir) )
   * [GetNPUsers.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py): Added hashcat/john format and users file input (by [@zer1t0](https://github.com/zer1t0) )

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@dirkjanm](https://github.com/dirkjanm), [@MrAnde7son](https://github.com/MrAnde7son), [@ibo](https://github.com/ibo), [@franferrax](https://github.com/franferrax), [@Qwokka](https://github.com/Qwokka), [@CaledoniaProject](https://github.com/CaledoniaProject) , [@eladshamir](https://github.com/eladshamir), [@zer1t0](https://github.com/zer1t0), [@martingalloar](https://github.com/martingalloar), [@muizzk](https://github.com/muizzk), [@Petraea](https://github.com/Petraea), [@SR4ven](https://github.com/SR4ven), [@Fist0urs](https://github.com/Fist0urs), [@zer1t0](https://github.com/zer1t0)

 Assets
3

 Loading

 👍
3
 SyedZaada77, CronoX1, and yekisac reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

 3 people reacted

## impacket 0.9.18

05 Dec 19:08

![@asolino](https://avatars.githubusercontent.com/u/11577828?s=40&v=4)
[asolino](/asolino)

[impacket\_0\_9\_18](/fortra/impacket/tree/impacket_0_9_18)

[`462449c`](/fortra/impacket/commit/462449c1bc774d725b38f31d4fa32ec7dfaac22e)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/fortra/impacket/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...impacket_0_9_18)

 Loading

[View all tags](/fortra/impacket/tags)

[impacket 0.9.18](/fortra/impacket/releases/tag/impacket_0_9_18)

Project's main page at [www.secureauth.com](https://www.secureauth.com/labs/open-source-tools/impacket)

ChangeLog for 0.9.18:

1. Library improvements

   * Replace unmaintained PyCrypto for pycryptodome ([@dirkjanm](https://github.com/dirkjanm))
   * Using cryptographically secure pseudo-random generators
   * Kerberos "no pre-auth and RC4" handling in GetKerberosTGT (by [@qlemaire](https://github.com/qlemaire))
   * Test cases adjustments, travis and flake support ([@cclauss](https://github.com/cclauss))
   * Python3 test cases fixes ([@eldipa](https://github.com/eldipa))
   * Adding DPAPI / Vaults related structures and functions to decrypt secrets.
   * [[MS-RPRN]](https://github.com/SecureAuthCorp/impacket/blob/master/impacket/dcerpc/v5/rprn.py) Interface implementation (Initial)
2. Examples improvements

   * [ntlmrelayx.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_18/examples/ntlmrelayx.py): Optimize ACL enumeration and improve error handling in ntlmrelayx LDAP attack (by [@dirkjanm](https://github.com/dirkjanm))
   * [secretsdump.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_18/examples/secretsdump.py): Added dumping of machine account Kerberos keys ([@dirkjanm](https://github.com/dirkjanm)). DPAPI\_SYSTEM LSA Secret is now parsed and key contents are shown.
   * [GetUserSPNs.py](https://github.com/SecureAuthCorp/impacket/blob/impacket_0_9_18/examples/GetUserSPNs.py): Bugfixes and cross-domain support ([@dirkjanm](https://github.com/dirkjanm))
3. New Examples

   * [dpapi.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/dpapi.py): Allows decrypting vaults, credentials and masterkeys protected by DPAPI. Domain backup key support added by [@MrAnde7son](https://github.com/MrAnde7son)

As always, thanks a lot to all these contributors that make this library better every day (since last version):

[@dirkjanm](https://github.com/dirkjanm), [@MrAnde7son](https://github.com/MrAnde7son), [@franferrax](https://github.com/franferrax), [@MrRobot86](https://github.com/MrRobot86), [@qlemaire](https://github.com/qlemaire), [@cauan](https://github.com/cauan), [@eldipa](https://github.com/eldipa)

 Assets
3

 Loading

All reactions

Previous *1* [2](/fortra/impacket/releases?page=2) [Next](/fortra/impacket/releases?page=2)

Previous [Next](/fortra/impacket/releases?page=2)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b476a9ed_20250114_190105.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

## Files

 cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Copy path Blame  Blame
## Latest commit

## History

[History](/fortra/impacket/commits/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)4692 lines (4007 loc) · 216 KB cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Top
## File metadata and controls

* Code
* Blame

4692 lines (4007 loc) · 216 KB[Raw](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000# SECUREAUTH LABS. Copyright 2018 SecureAuth Corporation. All rights reserved.## This software is provided under under a slightly modified version# of the Apache Software License. See the accompanying LICENSE file# for more information.## Author: Alberto Solino (@agsolino)## TODO:# [-] Functions should return NT error codes# [-] Handling errors in all situations, right now it's just raising exceptions. # [\*] Standard authentication support# [ ] Organize the connectionData stuff# [\*] Add capability to send a bad user ID if the user is not authenticated,# right now you can ask for any command without actually being authenticated# [ ] PATH TRAVERSALS EVERYWHERE.. BE WARNED!# [ ] Check error situation (now many places assume the right data is coming)# [ ] Implement IPC to the main process so the connectionData is on a single place# [ ] Hence.. implement locking# estamos en la B
import calendarimport socketimport timeimport datetimeimport structimport threadingimport loggingimport logging.configimport ntpathimport osimport fnmatchimport errnoimport sysimport randomimport shutilimport stringimport hashlibimport hmac
from binascii import unhexlify, hexlify, a2b\_hexfrom six import PY2, b, text\_typefrom six.moves import configparser, socketserver
# For signingfrom impacket import smb, nmb, ntlm, uuidfrom impacket import smb3structs as smb2from impacket.spnego import SPNEGO\_NegTokenInit, TypesMech, MechTypes, SPNEGO\_NegTokenResp, ASN1\_AID, ASN1\_SUPPORTED\_MECHfrom impacket.nt\_errors import STATUS\_NO\_MORE\_FILES, STATUS\_NETWORK\_NAME\_DELETED, STATUS\_INVALID\_PARAMETER, \ STATUS\_FILE\_CLOSED, STATUS\_MORE\_PROCESSING\_REQUIRED, STATUS\_OBJECT\_PATH\_NOT\_FOUND, STATUS\_DIRECTORY\_NOT\_EMPTY, \ STATUS\_FILE\_IS\_A\_DIRECTORY, STATUS\_NOT\_IMPLEMENTED, STATUS\_INVALID\_HANDLE, STATUS\_OBJECT\_NAME\_COLLISION, \ STATUS\_NO\_SUCH\_FILE, STATUS\_CANCELLED, STATUS\_OBJECT\_NAME\_NOT\_FOUND, STATUS\_SUCCESS, STATUS\_ACCESS\_DENIED, \ STATUS\_NOT\_SUPPORTED, STATUS\_INVALID\_DEVICE\_REQUEST, STATUS\_FS\_DRIVER\_REQUIRED, STATUS\_INVALID\_INFO\_CLASS, \ STATUS\_LOGON\_FAILURE
# Setting LOG to current's module nameLOG = logging.getLogger(\_\_name\_\_)
# These ones not defined in nt\_errorsSTATUS\_SMB\_BAD\_UID = 0x005B0002STATUS\_SMB\_BAD\_TID = 0x00050002
# Utility functions# and general functions. # There are some common functions that can be accessed from more than one SMB # command (or either TRANSACTION). That's why I'm putting them here# TODO: Return NT ERROR Codes
def computeNTLMv2(identity, lmhash, nthash, serverChallenge, authenticateMessage, ntlmChallenge, type1): # Let's calculate the NTLMv2 Response
 responseKeyNT = ntlm.NTOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), nthash) responseKeyLM = ntlm.LMOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), lmhash)
 ntProofStr = authenticateMessage['ntlm'][:16] temp = authenticateMessage['ntlm'][16:] ntProofStr2 = ntlm.hmac\_md5(responseKeyNT, serverChallenge + temp) lmChallengeResponse = authenticateMessage['lanman'] sessionBaseKey = ntlm.hmac\_md5(responseKeyNT, ntProofStr)
 responseFlags = type1['flags']
 # Let's check the return flags if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY) == 0: # No extended session security, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_128) == 0: # No support for 128 key len, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_128 if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH) == 0: # No key exchange supported, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SEAL) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SEAL if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SIGN if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN
 keyExchangeKey = ntlm.KXKEY(ntlmChallenge['flags'], sessionBaseKey, lmChallengeResponse, ntlmChallenge['challenge'], '', lmhash, nthash, True)
 # If we set up key exchange, let's fill the right variables if ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH: exportedSessionKey = authenticateMessage['session\_key'] exportedSessionKey = ntlm.generateEncryptedSessionKey(keyExchangeKey, exportedSessionKey) else: encryptedRandomSessionKey = None # [MS-NLMP] page 46 exportedSessionKey = keyExchangeKey
 # Do they match? if ntProofStr == ntProofStr2: # Yes!, process login return STATUS\_SUCCESS, exportedSessionKey else: return STATUS\_LOGON\_FAILURE, exportedSessionKey
def outputToJohnFormat(challenge, username, domain, lmresponse, ntresponse):# We don't want to add a possible failure here, since this is an# extra bonus. We try, if it fails, returns nothing# ToDo: Document the parameter's types (bytes / string) and check all the places where it's called ret\_value = '' if type(challenge) is not bytes: challenge = challenge.decode('latin-1')
 try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse).decode('latin-1')[:32], hexlify(ntresponse).decode()[32:]), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode()), 'hash\_version': 'ntlm'} except: # Let's try w/o decoding Unicode try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('latin-1'), domain.decode('latin-1'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse)[:32].decode('latin-1'), hexlify(ntresponse)[32:].decode('latin-1')), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username, domain, hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode('latin-1')), 'hash\_version': 'ntlm'} except Exception as e: import traceback traceback.print\_exc() LOG.error("outputToJohnFormat: %s" % e) pass
 return ret\_value
def writeJohnOutputToFile(hash\_string, hash\_version, file\_name): fn\_data = os.path.splitext(file\_name) if hash\_version == "ntlmv2": output\_filename = fn\_data[0] + "\_ntlmv2" + fn\_data[1] else: output\_filename = fn\_data[0] + "\_ntlm" + fn\_data[1]
 with open(output\_filename,"a") as f: f.write(hash\_string) f.write('\n')
def decodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return text.decode('utf-16le') else: return text
def encodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return (text).encode('utf-16le') else: return text.encode('ascii') def getFileTime(t): t \*= 10000000 t += 116444736000000000 return t
def getUnixTime(t): t -= 116444736000000000 t //= 10000000 return t
def getSMBDate(t): # TODO: Fix this :P d = datetime.date.fromtimestamp(t) year = d.year - 1980 ret = (year << 8) + (d.month << 4) + d.day return ret
def getSMBTime(t): # TODO: Fix this :P d = datetime.datetime.fromtimestamp(t) return (d.hour << 8) + (d.minute << 4) + d.second
def getShares(connId, smbServer): config = smbServer.getServerConfig() sections = config.sections() # Remove the global one del(sections[sections.index('global')]) shares = {} for i in sections: shares[i] = dict(config.items(i)) return shares
def searchShare(connId, share, smbServer): config = smbServer.getServerConfig() if config.has\_section(share): return dict(config.items(share)) else: return None
def openFile(path,fileName, accessMode, fileAttributes, openMode): fileName = os.path.normpath(fileName.replace('\\','/')) errorCode = 0 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) mode = 0 # Check the Open Mode if openMode & 0x10: # If the file does not exist, create it. mode = os.O\_CREAT else: # If file does not exist, return an error if os.path.exists(pathName) is not True: errorCode = STATUS\_NO\_SUCH\_FILE return 0,mode, pathName, errorCode
 if os.path.isdir(pathName) and (fileAttributes & smb.ATTR\_DIRECTORY) == 0: # Request to open a normal file and this is actually a directory errorCode = STATUS\_FILE\_IS\_A\_DIRECTORY return 0, mode, pathName, errorCode # Check the Access Mode if accessMode & 0x7 == 1: mode |= os.O\_WRONLY elif accessMode & 0x7 == 2: mode |= os.O\_RDWR else: mode = os.O\_RDONLY
 try: if sys.platform == 'win32': mode |= os.O\_BINARY fid = os.open(pathName, mode) except Exception as e: LOG.error("openFile: %s,%s" % (pathName, mode) ,e) fid = 0 errorCode = STATUS\_ACCESS\_DENIED
 return fid, mode, pathName, errorCode
def queryFsInformation(path, filename, level=0, pktFlags = smb.SMB.FLAGS2\_UNICODE):
 if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) fileSize = os.path.getsize(pathName) (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FS\_ATTRIBUTE\_INFO or level == smb2.SMB2\_FILESYSTEM\_ATTRIBUTE\_INFO: data = smb.SMBQueryFsAttributeInfo() data['FileSystemAttributes'] = smb.FILE\_CASE\_SENSITIVE\_SEARCH | smb.FILE\_CASE\_PRESERVED\_NAMES data['MaxFilenNameLengthInBytes'] = 255 data['LengthOfFileSystemName'] = len('XTFS')\*2 data['FileSystemName'] = 'XTFS'.encode('utf-16le') return data.getData() elif level == smb.SMB\_INFO\_VOLUME: data = smb.SMBQueryFsInfoVolume( flags = pktFlags ) data['VolumeLabel'] = 'SHARE'.encode(encoding) return data.getData() elif level == smb.SMB\_QUERY\_FS\_VOLUME\_INFO or level == smb2.SMB2\_FILESYSTEM\_VOLUME\_INFO: data = smb.SMBQueryFsVolumeInfo() data['VolumeLabel'] = '' data['VolumeCreationTime'] = getFileTime(ctime) return data.getData()  elif level == smb.SMB\_QUERY\_FS\_SIZE\_INFO: data = smb.SMBQueryFsSizeInfo() return data.getData() elif level == smb.FILE\_FS\_FULL\_SIZE\_INFORMATION: data = smb.SMBFileFsFullSizeInformation() return data.getData() elif level == smb.FILE\_FS\_SIZE\_INFORMATION: data = smb.FileFsSizeInformation() return data.getData() else: lastWriteTime = mtime attribs = 0 if os.path.isdir(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_DIRECTORY if os.path.isfile(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_NORMAL fileAttributes = attribs return fileSize, lastWriteTime, fileAttributes
def findFirst2(path, fileName, level, searchAttributes, pktFlags = smb.SMB.FLAGS2\_UNICODE, isSMB2 = False): # TODO: Depending on the level, this could be done much simpler  #print "FindFirs2 path:%s, filename:%s" % (path, fileName) fileName = os.path.normpath(fileName.replace('\\','/')) # Let's choose the right encoding depending on the request if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:]
 pathName = os.path.join(path,fileName) files = []
 if pathName.find('\*') == -1 and pathName.find('?') == -1: # No search patterns pattern = '' else: pattern = os.path.basename(pathName) dirName = os.path.dirname(pathName)
 # Always add . and .. Not that important for Windows, but Samba whines if  # not present (for \* search only) if pattern == '\*': files.append(os.path.join(dirName,'.')) files.append(os.path.join(dirName,'..'))
 if pattern != '': for file in os.listdir(dirName): if fnmatch.fnmatch(file.lower(),pattern.lower()): entry = os.path.join(dirName, file) if os.path.isdir(entry): if searchAttributes & smb.ATTR\_DIRECTORY: files.append(entry) else: files.append(entry) else: if os.path.exists(pathName): files.append(pathName)
 searchResult = [] searchCount = len(files) errorCode = STATUS\_SUCCESS
 for i in files: if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_DIRECTORY\_INFO: item = smb.SMBFindFileDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_INFO\_STANDARD: item = smb.SMBFindInfoStandard( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileIdFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileIdBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_NAMES\_INFO or level == smb2.SMB2\_FILE\_NAMES\_INFO: item = smb.SMBFindFileNamesInfo( flags = pktFlags ) else: LOG.error("Wrong level %d!" % level) return searchResult, searchCount, STATUS\_NOT\_SUPPORTED  (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(i) if os.path.isdir(i): item['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: item['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE
 item['FileName'] = os.path.basename(i).encode(encoding)
 if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['ShortName'] = '\x00'\*24 item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO: item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_INFO\_STANDARD: item['EaSize'] = size item['CreationDate'] = getSMBDate(ctime) item['CreationTime'] = getSMBTime(ctime) item['LastAccessDate'] = getSMBDate(atime) item['LastAccessTime'] = getSMBTime(atime) item['LastWriteDate'] = getSMBDate(mtime) item['LastWriteTime'] = getSMBTime(mtime) searchResult.append(item)
 # No more files if (level >= smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or isSMB2 is True) and searchCount > 0: searchResult[-1]['NextEntryOffset'] = 0
 return searchResult, searchCount, errorCode
def queryFileInformation(path, filename, level): #print "queryFileInfo path: %s, filename: %s, level:0x%x" % (path,filename,level) return queryPathInformation(path,filename, level)
def queryPathInformation(path, filename, level): # TODO: Depending on the level, this could be done much simpler #print("queryPathInfo path: %s, filename: %s, level:0x%x" % (path,filename,level)) try: errorCode = 0 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FILE\_BASIC\_INFO: infoRecord = smb.SMBQueryFileBasicInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_STANDARD\_INFO: infoRecord = smb.SMBQueryFileStandardInfo() infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 elif level == smb.SMB\_QUERY\_FILE\_ALL\_INFO or level == smb2.SMB2\_FILE\_ALL\_INFO: infoRecord = smb.SMBQueryFileAllInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 infoRecord['FileName'] = filename.encode('utf-16le') elif level == smb2.SMB2\_FILE\_NETWORK\_OPEN\_INFO: infoRecord = smb.SMBFileNetworkOpenInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['ChangeTime'] = getFileTime(mtime) infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['FileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['FileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_EA\_INFO or level == smb2.SMB2\_FILE\_EA\_INFO:  infoRecord = smb.SMBQueryFileEaInfo() elif level == smb2.SMB2\_FILE\_STREAM\_INFO: infoRecord = smb.SMBFileStreamInformation() else: LOG.error('Unknown level for query path info! 0x%x' % level) # UNSUPPORTED return None, STATUS\_NOT\_SUPPORTED
 return infoRecord, errorCode else: # NOT FOUND return None, STATUS\_OBJECT\_NAME\_NOT\_FOUND except Exception as e: LOG.error('queryPathInfo: %s' % e) raise
def queryDiskInformation(path):# TODO: Do something useful here :)# For now we just return fake values totalUnits = 65535 freeUnits = 65535 return totalUnits, freeUnits
# Here we implement the NT transaction handlersclass NTTRANSCommands: def default(self, connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): pass
# Here we implement the NT transaction handlersclass TRANSCommands: @staticmethod def lanMan(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): # Minimal [MS-RAP] implementation, just to return the shares connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS if struct.unpack('<H',parameters[:2])[0] == 0: # NetShareEnum Request netShareEnum = smb.SMBNetShareEnum(parameters) if netShareEnum['InfoLevel'] == 1: shares = getShares(connId, smbServer) respParameters = smb.SMBNetShareEnumResponse() respParameters['EntriesReturned'] = len(shares) respParameters['EntriesAvailable'] = len(shares) tailData = '' for i in shares: # NetShareInfo1 len == 20 entry = smb.NetShareInfo1() entry['NetworkName'] = i + '\x00'\*(13-len(i)) entry['Type'] = int(shares[i]['share type']) # (beto) If offset == 0 it crashes explorer.exe on windows 7 entry['RemarkOffsetLow'] = 20 \* len(shares) + len(tailData) respData += entry.getData() if 'comment' in shares[i]: tailData += shares[i]['comment'] + '\x00' else: tailData += '\x00' respData += tailData else: # We don't support other info levels errorCode = STATUS\_NOT\_SUPPORTED elif struct.unpack('<H',parameters[:2])[0] == 13: # NetrServerGetInfo Request respParameters = smb.SMBNetServerGetInfoResponse() netServerInfo = smb.SMBNetServerInfo1() netServerInfo['ServerName'] = smbServer.getServerName() respData = netServerInfo.getData() respParameters['TotalBytesAvailable'] = len(respData) elif struct.unpack('<H',parameters[:2])[0] == 1: # NetrShareGetInfo Request request = smb.SMBNetShareGetInfo(parameters) respParameters = smb.SMBNetShareGetInfoResponse() shares = getShares(connId, smbServer) share = shares[request['ShareName'].upper()] shareInfo = smb.NetShareInfo1()  shareInfo['NetworkName'] = request['ShareName'].upper() + '\x00' shareInfo['Type'] = int(share['share type']) respData = shareInfo.getData() if 'comment' in share: shareInfo['RemarkOffsetLow'] = len(respData) respData += share['comment'] + '\x00' respParameters['TotalBytesAvailable'] = len(respData)  else: # We don't know how to handle anything else errorCode = STATUS\_NOT\_SUPPORTED
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def transactNamedPipe(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS SMBCommand = smb.SMBCommand(recvPacket['Data'][0]) transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Extract the FID fid = struct.unpack('<H', transParameters['Setup'][2:])[0]
 if fid in connData['OpenedFiles']: fileHandle = connData['OpenedFiles'][fid]['FileHandle'] if fileHandle != PIPE\_FILE\_DESCRIPTOR: os.write(fileHandle,data) respData = os.read(fileHandle,data) else: sock = connData['OpenedFiles'][fid]['Socket'] sock.send(data) respData = sock.recv(maxDataCount) else: errorCode = STATUS\_INVALID\_HANDLE
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the transaction2 handlersclass TRANS2Commands: # All these commands return setup, parameters, data, errorCode @staticmethod def setPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setPathInfoParameters = smb.SMBSetPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters) if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] fileName = decodeSMBString(recvPacket['Flags2'], setPathInfoParameters['FileName']) fileName = os.path.normpath(fileName.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): informationLevel = setPathInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) if mtime != -1 or atime != -1: os.utime(pathName,(atime,mtime)) else: smbServer.log('Unknown level for set path info! 0x%x' % setPathInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_OBJECT\_NAME\_NOT\_FOUND
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetPathInformationResponse\_Parameters()
 else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def setFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setFileInfoParameters = smb.SMBSetFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if setFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileName'] informationLevel = setFileInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_DISPOSITION\_INFO: infoRecord = smb.SMBSetFileDispositionInfo(parameters) if infoRecord['DeletePending'] > 0: # Mark this file for removal after closed connData['OpenedFiles'][setFileInfoParameters['FID']]['DeleteOnClose'] = True respParameters = smb.SMBSetFileInformationResponse\_Parameters() elif informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) os.utime(fileName,(atime,mtime)) elif informationLevel == smb.SMB\_SET\_FILE\_END\_OF\_FILE\_INFO: fileHandle = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileHandle'] infoRecord = smb.SMBSetFileEndOfFileInfo(data) if infoRecord['EndOfFile'] > 0: os.lseek(fileHandle, infoRecord['EndOfFile']-1, 0) os.write(fileHandle, b'\x00') else: smbServer.log('Unknown level for set file info! 0x%x' % setFileInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_NO\_SUCH\_FILE
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetFileInformationResponse\_Parameters() else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b''
 queryFileInfoParameters = smb.SMBQueryFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if queryFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][queryFileInfoParameters['FID']]['FileName']
 infoRecord, errorCode = queryFileInformation('', fileName, queryFileInfoParameters['InformationLevel'])
 if infoRecord is not None: respParameters = smb.SMBQueryFileInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = 0
 queryPathInfoParameters = smb.SMBQueryPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] try: infoRecord, errorCode = queryPathInformation(path, decodeSMBString(recvPacket['Flags2'], queryPathInfoParameters['FileName']), queryPathInfoParameters['InformationLevel']) except Exception as e: smbServer.log("queryPathInformation: %s" % e,logging.ERROR)
 if infoRecord is not None: respParameters = smb.SMBQueryPathInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_SMB\_BAD\_TID  smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFsInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId) errorCode = 0 # Get the Tid associated if recvPacket['Tid'] in connData['ConnectedShares']: data = queryFsInformation(connData['ConnectedShares'][recvPacket['Tid']]['path'], '', struct.unpack('<H',parameters)[0], pktFlags = recvPacket['Flags2'])
 smbServer.setConnectionData(connId, connData)
 return b'',b'', data, errorCode
 @staticmethod def findNext2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS findNext2Parameters = smb.SMBFindNext2\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 sid = findNext2Parameters['SID'] if recvPacket['Tid'] in connData['ConnectedShares']: if sid in connData['SIDs']: searchResult = connData['SIDs'][sid] respParameters = smb.SMBFindNext2Response\_Parameters() endOfSearch = 1 searchCount = 1 totalData = 0 for i in enumerate(searchResult): data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) >= findNext2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data totalData += lenData  # Have we reached the end of the search or still stuff to send? if endOfSearch > 0: # Let's remove the SID from our ConnData del(connData['SIDs'][sid])
 respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else:  errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def findFirst2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' findFirst2Parameters = smb.SMBFindFirst2\_Parameters( recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path']
 searchResult, searchCount, errorCode = findFirst2(path,  decodeSMBString( recvPacket['Flags2'], findFirst2Parameters['FileName'] ),  findFirst2Parameters['InformationLevel'],  findFirst2Parameters['SearchAttributes'] , pktFlags = recvPacket['Flags2'])
 respParameters = smb.SMBFindFirst2Response\_Parameters() endOfSearch = 1 sid = 0x80 # default SID searchCount = 0 totalData = 0 for i in enumerate(searchResult): #i[1].dump() data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) > findFirst2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 # Simple way to generate a fid if len(connData['SIDs']) == 0: sid = 1 else: sid = list(connData['SIDs'].keys())[-1] + 1 # Store the remaining search results in the ConnData SID connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data
 padLen = (8-(lenData % 8)) %8 respData += b'\xaa'\*padLen totalData += lenData + padLen
 respParameters['SID'] = sid respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the commands handlersclass SMBCommands:
 @staticmethod def smbTransaction(connId, smbServer, SMBCommand, recvPacket, transCommands): connData = smbServer.getConnectionData(connId)
 respSMBCommand = smb.SMBCommand(recvPacket['Command'])
 transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Do the stuff if transParameters['ParameterCount'] != transParameters['TotalParameterCount']: # TODO: Handle partial parameters  raise Exception("Unsupported partial parameters in TRANSACT2!") else: transData = smb.SMBTransaction\_SData(flags = recvPacket['Flags2']) # Standard says servers shouldn't trust Parameters and Data comes  # in order, so we have to parse the offsets, ugly
 paramCount = transParameters['ParameterCount'] transData['Trans\_ParametersLength'] = paramCount dataCount = transParameters['DataCount'] transData['Trans\_DataLength'] = dataCount transData.fromString(SMBCommand['Data']) if transParameters['ParameterOffset'] > 0: paramOffset = transParameters['ParameterOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Parameters'] = SMBCommand['Data'][paramOffset:paramOffset+paramCount] else: transData['Trans\_Parameters'] = b''
 if transParameters['DataOffset'] > 0: dataOffset = transParameters['DataOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Data'] = SMBCommand['Data'][dataOffset:dataOffset + dataCount] else:  transData['Trans\_Data'] = b''  # Call the handler for this TRANSACTION if transParameters['SetupCount'] == 0: # No subcommand, let's play with the Name command = decodeSMBString(recvPacket['Flags2'],transData['Name']) else: command = struct.unpack('<H', transParameters['Setup'][:2])[0]  if command in transCommands: # Call the TRANS subcommand setup = b'' parameters = b'' data = b'' try:  setup, parameters, data, errorCode = transCommands[command](connId, smbServer,  recvPacket,  transData['Trans\_Parameters'],  transData['Trans\_Data'], transParameters['MaxDataCount']) except Exception as e: #print 'Transaction: %s' % e,e smbServer.log('Transaction: (%r,%s)' % (command, e), logging.ERROR) errorCode = STATUS\_ACCESS\_DENIED #raise
 if setup == b'' and parameters == b'' and data == b'': # Something wen't wrong respParameters = b'' respData = b'' else: # Build the answer if hasattr(data, 'getData'): data = data.getData() remainingData = len(data) if hasattr(parameters, 'getData'): parameters = parameters.getData() remainingParameters = len(parameters) commands = [] dataDisplacement = 0 while remainingData > 0 or remainingParameters > 0:  respSMBCommand = smb.SMBCommand(recvPacket['Command']) respParameters = smb.SMBTransactionResponse\_Parameters() respData = smb.SMBTransaction2Response\_Data()
 respParameters['TotalParameterCount'] = len(parameters)[View remainder of file in raw view](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_4fdc6355_20250114_190109.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-KRV2C5DATXBHG6TF6CEEX54KZ75THQS3.mbox.gz?message=KRV2C5DATXBHG6TF6CEEX54KZ75THQS3 "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/#KRV2C5DATXBHG6TF6CEEX54KZ75THQS3)

# [SECURITY] Fedora 32 Update: python-impacket-0.9.22-3.fc32

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

15 May
2021

15 May
'21

6:59 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-ab09c9a7a1
2021-05-16 01:59:37.899661
--------------------------------------------------------------------------------

Name : python-impacket
Product : Fedora 32
Version : 0.9.22
Release : 3.fc32
URL : <https://github.com/SecureAuthCorp/impacket>
Summary : Collection of Python classes providing access to network packets
Description :

Impacket is a collection of Python classes focused on providing access to
network packets. Impacket allows Python developers to craft and decode network
packets in simple and consistent manner. It is highly effective when used in
conjunction with a packet capture utility or package such as Pcapy. Packets
can be constructed from scratch, as well as parsed from raw data. Furthermore,
the object oriented API makes it simple to work with deep protocol hierarchies.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2021-31800 - #1957428, #1957427 - fix path traversal in
smbserver.py
--------------------------------------------------------------------------------
ChangeLog:

\* Fri May 7 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-3
- fix CVE-2021-31800 - #1957428, #1957427 during 0.9.22 lifecycle
\* Sun May 2 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-2
- fix dependencies for EPEL7 as of #1893859
\* Wed Apr 14 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-1
- Updated to new upstream release 0.9.22
- modernize specfile with bconds
- upstream patch for python39 compatibility (needed for FC34+)
\* Wed Jan 27 2021 Fedora Release Engineering releng@fedoraproject.org - 0.9.21-8
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_34_Mass_Rebuild>
\* Wed Jul 29 2020 Fedora Release Engineering releng@fedoraproject.org - 0.9.21-7
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_33_Mass_Rebuild>
\* Tue May 26 2020 Miro Hron��ok mhroncok@redhat.com - 0.9.21-6
- Rebuilt for Python 3.9
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1957426 - CVE-2021-31800 python-impacket: Multiple path traversal vulnerabilities in smbserver.py
<https://bugzilla.redhat.com/show_bug.cgi?id=1957426>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-ab09c9a7a1' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3/#KRV2C5DATXBHG6TF6CEEX54KZ75THQS3)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from lists.fedoraproject.org_93c3a6a9_20250114_190109.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6.mbox.gz?message=IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6 "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/#IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6)

# [SECURITY] Fedora 33 Update: python-impacket-0.9.22-3.fc33

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

15 May
2021

15 May
'21

7:06 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-888ccfd5b6
2021-05-16 02:06:09.511375
--------------------------------------------------------------------------------

Name : python-impacket
Product : Fedora 33
Version : 0.9.22
Release : 3.fc33
URL : <https://github.com/SecureAuthCorp/impacket>
Summary : Collection of Python classes providing access to network packets
Description :

Impacket is a collection of Python classes focused on providing access to
network packets. Impacket allows Python developers to craft and decode network
packets in simple and consistent manner. It is highly effective when used in
conjunction with a packet capture utility or package such as Pcapy. Packets
can be constructed from scratch, as well as parsed from raw data. Furthermore,
the object oriented API makes it simple to work with deep protocol hierarchies.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2021-31800 - #1957428, #1957427 - fix path traversal in
smbserver.py ---- Updated to new upstream release 0.9.22
--------------------------------------------------------------------------------
ChangeLog:

\* Fri May 7 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-3
- fix CVE-2021-31800 - #1957428, #1957427 during 0.9.22 lifecycle
\* Sun May 2 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-2
- fix dependencies for EPEL7 as of #1893859
\* Wed Apr 14 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-1
- Updated to new upstream release 0.9.22
- modernize specfile with bconds
- upstream patch for python39 compatibility (needed for FC34+)
\* Wed Jan 27 2021 Fedora Release Engineering releng@fedoraproject.org - 0.9.21-8
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_34_Mass_Rebuild>
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1957426 - CVE-2021-31800 python-impacket: Multiple path traversal vulnerabilities in smbserver.py
<https://bugzilla.redhat.com/show_bug.cgi?id=1957426>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-888ccfd5b6' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6/#IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_c3570366_20250115_113632.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-mj63-64x7-57xf)

**CVE-2021-31800**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-mj63-64x7-57xf)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2021-31800](/advisories/GHSA-mj63-64x7-57xf)

## Path traversal in impacket

Critical severity

GitHub Reviewed

Published
Jun 18, 2021
to the GitHub Advisory Database
•
Updated Sep 23, 2024

[Vulnerability details](/advisories/GHSA-mj63-64x7-57xf)
[Dependabot alerts
0](/advisories/GHSA-mj63-64x7-57xf/dependabot)

## Package

pip

impacket
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 0.9.23

## Patched versions

0.9.23

## Description

Multiple path traversal vulnerabilities exist in smbserver.py in Impacket before 0.9.23. An attacker that connects to a running smbserver instance can list and write to arbitrary files via ../ directory traversal. This could potentially be abused to achieve arbitrary code execution by replacing /etc/shadow or an SSH authorized key.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2021-31800>
* [fortra/impacket@49c643b](https://github.com/fortra/impacket/commit/49c643bf66620646884ed141c94e5fdd85bcdd2f)
* <https://github.com/SecureAuthCorp/impacket/blob/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py#L2008>
* <https://github.com/SecureAuthCorp/impacket/blob/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py#L2958>
* <https://github.com/SecureAuthCorp/impacket/blob/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py#L3485>
* <https://github.com/SecureAuthCorp/impacket/blob/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py#L876>
* <https://github.com/SecureAuthCorp/impacket/releases>
* [fortra/impacket@99bd29e](https://github.com/fortra/impacket/commit/99bd29e3995c254e2d6f6c2e3454e4271665955a)
* <https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_23>
* [GHSA-mj63-64x7-57xf](https://github.com/advisories/GHSA-mj63-64x7-57xf "GHSA-mj63-64x7-57xf")
* <https://github.com/pypa/advisory-database/tree/main/vulns/impacket/PYSEC-2021-17.yaml>
* [https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6](https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/IPXDPWCAPVX3UWYZ3N2T5OLBSBBUHJP6)
* [https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3](https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/KRV2C5DATXBHG6TF6CEEX54KZ75THQS3)
* [https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG](https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2021-31800)
May 5, 2021

Reviewed
May 19, 2021

Published to the GitHub Advisory Database
Jun 18, 2021

Last updated
Sep 23, 2024

### Severity

Critical

9.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
None

User interaction
None
##### Vulnerable System Impact Metrics

Confidentiality
High

Integrity
High

Availability
High
##### Subsequent System Impact Metrics

Confidentiality
None

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N

### [EPSS score](https://www.first.org/epss/user-guide)

1.029%
 (84th percentile)

### Weaknesses

[CWE-22](/advisories?query=cwe%3A22)

### CVE ID

CVE-2021-31800

### GHSA ID

GHSA-mj63-64x7-57xf

### Source code

[fortra/impacket](https://github.com/fortra/impacket)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-mj63-64x7-57xf/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.fedoraproject.org_58896068_20250114_190110.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-UF56LYB27LHEIFJTFHU3M75NMNNK2SCG.mbox.gz?message=UF56LYB27LHEIFJTFHU3M75NMNNK2SCG "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/#UF56LYB27LHEIFJTFHU3M75NMNNK2SCG)

# [SECURITY] Fedora 34 Update: python-impacket-0.9.22-3.fc34

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

15 May
2021

15 May
'21

10:02 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2021-52dfb60726
2021-05-16 02:01:05.994424
--------------------------------------------------------------------------------

Name : python-impacket
Product : Fedora 34
Version : 0.9.22
Release : 3.fc34
URL : <https://github.com/SecureAuthCorp/impacket>
Summary : Collection of Python classes providing access to network packets
Description :

Impacket is a collection of Python classes focused on providing access to
network packets. Impacket allows Python developers to craft and decode network
packets in simple and consistent manner. It is highly effective when used in
conjunction with a packet capture utility or package such as Pcapy. Packets
can be constructed from scratch, as well as parsed from raw data. Furthermore,
the object oriented API makes it simple to work with deep protocol hierarchies.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2021-31800 - #1957428, #1957427 - fix path traversal in
smbserver.py ---- Updated to new upstream release 0.9.22
--------------------------------------------------------------------------------
ChangeLog:

\* Fri May 7 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-3
- fix CVE-2021-31800 - #1957428, #1957427 during 0.9.22 lifecycle
\* Sun May 2 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-2
- fix dependencies for EPEL7 as of #1893859
\* Wed Apr 14 2021 Michal Ambroz <rebus \_AT seznam.cz> - 0.9.22-1
- Updated to new upstream release 0.9.22
- modernize specfile with bconds
- upstream patch for python39 compatibility (needed for FC34+)
\* Wed Jan 27 2021 Fedora Release Engineering releng@fedoraproject.org - 0.9.21-8
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_34_Mass_Rebuild>
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #1957426 - CVE-2021-31800 python-impacket: Multiple path traversal vulnerabilities in smbserver.py
<https://bugzilla.redhat.com/show_bug.cgi?id=1957426>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2021-52dfb60726' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/UF56LYB27LHEIFJTFHU3M75NMNNK2SCG/#UF56LYB27LHEIFJTFHU3M75NMNNK2SCG)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_6902180b_20250115_113631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fomriinbar)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fomriinbar)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

![@omriinbar](https://avatars.githubusercontent.com/u/80689106?s=64&v=4)

**omriinbar**
[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fomriinbar)

[Overview](/omriinbar)
[Repositories
4](/omriinbar?tab=repositories)
[Projects
0](/omriinbar?tab=projects)
[Packages
0](/omriinbar?tab=packages)
[Stars
1](/omriinbar?tab=stars)

More

* [Overview](/omriinbar)
* [Repositories](/omriinbar?tab=repositories)
* [Projects](/omriinbar?tab=projects)
* [Packages](/omriinbar?tab=packages)
* [Stars](/omriinbar?tab=stars)

![@omriinbar](https://avatars.githubusercontent.com/u/80689106?s=64&v=4)

**omriinbar**

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fomriinbar)

[![View omriinbar's full-sized avatar](https://avatars.githubusercontent.com/u/80689106?v=4)](https://avatars.githubusercontent.com/u/80689106?v=4)

# omriinbar

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fomriinbar)

[1
follower](https://github.com/omriinbar?tab=followers) · [2
following](https://github.com/omriinbar?tab=following)

Block or Report

# Block or report omriinbar

**Block user**

Prevent this user from interacting with your repositories and sending you notifications.
Learn more about [blocking users](https://docs.github.com/articles/blocking-a-user-from-your-personal-account).

You must be logged in to block users.

Add an optional note:

Please don't include any personal information such as legal names or email addresses. Maximum 100 characters, markdown supported. This note will be visible to only you.

Block user

**Report abuse**

Contact GitHub support about this user’s behavior.
Learn more about [reporting abuse](https://docs.github.com/articles/reporting-abuse-or-spam).

[Report abuse](/contact/report-abuse?report=omriinbar+%28user%29)

[Overview](/omriinbar)
[Repositories
4](/omriinbar?tab=repositories)
[Projects
0](/omriinbar?tab=projects)
[Packages
0](/omriinbar?tab=packages)
[Stars
1](/omriinbar?tab=stars)

More

* [Overview](/omriinbar)
* [Repositories](/omriinbar?tab=repositories)
* [Projects](/omriinbar?tab=projects)
* [Packages](/omriinbar?tab=packages)
* [Stars](/omriinbar?tab=stars)

## Popular repositories Loading

1. [test](/omriinbar/test) test
   Public

   "/><svg/onload=alert(1)>

   HTML
2. [impacket](/omriinbar/impacket) impacket
   Public

   Forked from [fortra/impacket](/fortra/impacket)

   Impacket is a collection of Python classes for working with network protocols.

   Python
3. [testsite](/omriinbar/testsite) testsite
   Public

   test

   HTML
4. [MacCatcher](/omriinbar/MacCatcher) MacCatcher
   Public

   Forked from [fuzzKitty/MacCatcher](/fuzzKitty/MacCatcher)

Something went wrong, please refresh the page to try again.

If the problem persists, check the [GitHub status page](https://www.githubstatus.com/)
or [contact support](/contact).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_585a6a85_20250114_190058.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

## Files

 cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Copy path Blame  Blame
## Latest commit

## History

[History](/fortra/impacket/commits/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)4692 lines (4007 loc) · 216 KB cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Top
## File metadata and controls

* Code
* Blame

4692 lines (4007 loc) · 216 KB[Raw](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000# SECUREAUTH LABS. Copyright 2018 SecureAuth Corporation. All rights reserved.## This software is provided under under a slightly modified version# of the Apache Software License. See the accompanying LICENSE file# for more information.## Author: Alberto Solino (@agsolino)## TODO:# [-] Functions should return NT error codes# [-] Handling errors in all situations, right now it's just raising exceptions. # [\*] Standard authentication support# [ ] Organize the connectionData stuff# [\*] Add capability to send a bad user ID if the user is not authenticated,# right now you can ask for any command without actually being authenticated# [ ] PATH TRAVERSALS EVERYWHERE.. BE WARNED!# [ ] Check error situation (now many places assume the right data is coming)# [ ] Implement IPC to the main process so the connectionData is on a single place# [ ] Hence.. implement locking# estamos en la B
import calendarimport socketimport timeimport datetimeimport structimport threadingimport loggingimport logging.configimport ntpathimport osimport fnmatchimport errnoimport sysimport randomimport shutilimport stringimport hashlibimport hmac
from binascii import unhexlify, hexlify, a2b\_hexfrom six import PY2, b, text\_typefrom six.moves import configparser, socketserver
# For signingfrom impacket import smb, nmb, ntlm, uuidfrom impacket import smb3structs as smb2from impacket.spnego import SPNEGO\_NegTokenInit, TypesMech, MechTypes, SPNEGO\_NegTokenResp, ASN1\_AID, ASN1\_SUPPORTED\_MECHfrom impacket.nt\_errors import STATUS\_NO\_MORE\_FILES, STATUS\_NETWORK\_NAME\_DELETED, STATUS\_INVALID\_PARAMETER, \ STATUS\_FILE\_CLOSED, STATUS\_MORE\_PROCESSING\_REQUIRED, STATUS\_OBJECT\_PATH\_NOT\_FOUND, STATUS\_DIRECTORY\_NOT\_EMPTY, \ STATUS\_FILE\_IS\_A\_DIRECTORY, STATUS\_NOT\_IMPLEMENTED, STATUS\_INVALID\_HANDLE, STATUS\_OBJECT\_NAME\_COLLISION, \ STATUS\_NO\_SUCH\_FILE, STATUS\_CANCELLED, STATUS\_OBJECT\_NAME\_NOT\_FOUND, STATUS\_SUCCESS, STATUS\_ACCESS\_DENIED, \ STATUS\_NOT\_SUPPORTED, STATUS\_INVALID\_DEVICE\_REQUEST, STATUS\_FS\_DRIVER\_REQUIRED, STATUS\_INVALID\_INFO\_CLASS, \ STATUS\_LOGON\_FAILURE
# Setting LOG to current's module nameLOG = logging.getLogger(\_\_name\_\_)
# These ones not defined in nt\_errorsSTATUS\_SMB\_BAD\_UID = 0x005B0002STATUS\_SMB\_BAD\_TID = 0x00050002
# Utility functions# and general functions. # There are some common functions that can be accessed from more than one SMB # command (or either TRANSACTION). That's why I'm putting them here# TODO: Return NT ERROR Codes
def computeNTLMv2(identity, lmhash, nthash, serverChallenge, authenticateMessage, ntlmChallenge, type1): # Let's calculate the NTLMv2 Response
 responseKeyNT = ntlm.NTOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), nthash) responseKeyLM = ntlm.LMOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), lmhash)
 ntProofStr = authenticateMessage['ntlm'][:16] temp = authenticateMessage['ntlm'][16:] ntProofStr2 = ntlm.hmac\_md5(responseKeyNT, serverChallenge + temp) lmChallengeResponse = authenticateMessage['lanman'] sessionBaseKey = ntlm.hmac\_md5(responseKeyNT, ntProofStr)
 responseFlags = type1['flags']
 # Let's check the return flags if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY) == 0: # No extended session security, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_128) == 0: # No support for 128 key len, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_128 if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH) == 0: # No key exchange supported, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SEAL) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SEAL if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SIGN if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN
 keyExchangeKey = ntlm.KXKEY(ntlmChallenge['flags'], sessionBaseKey, lmChallengeResponse, ntlmChallenge['challenge'], '', lmhash, nthash, True)
 # If we set up key exchange, let's fill the right variables if ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH: exportedSessionKey = authenticateMessage['session\_key'] exportedSessionKey = ntlm.generateEncryptedSessionKey(keyExchangeKey, exportedSessionKey) else: encryptedRandomSessionKey = None # [MS-NLMP] page 46 exportedSessionKey = keyExchangeKey
 # Do they match? if ntProofStr == ntProofStr2: # Yes!, process login return STATUS\_SUCCESS, exportedSessionKey else: return STATUS\_LOGON\_FAILURE, exportedSessionKey
def outputToJohnFormat(challenge, username, domain, lmresponse, ntresponse):# We don't want to add a possible failure here, since this is an# extra bonus. We try, if it fails, returns nothing# ToDo: Document the parameter's types (bytes / string) and check all the places where it's called ret\_value = '' if type(challenge) is not bytes: challenge = challenge.decode('latin-1')
 try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse).decode('latin-1')[:32], hexlify(ntresponse).decode()[32:]), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode()), 'hash\_version': 'ntlm'} except: # Let's try w/o decoding Unicode try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('latin-1'), domain.decode('latin-1'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse)[:32].decode('latin-1'), hexlify(ntresponse)[32:].decode('latin-1')), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username, domain, hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode('latin-1')), 'hash\_version': 'ntlm'} except Exception as e: import traceback traceback.print\_exc() LOG.error("outputToJohnFormat: %s" % e) pass
 return ret\_value
def writeJohnOutputToFile(hash\_string, hash\_version, file\_name): fn\_data = os.path.splitext(file\_name) if hash\_version == "ntlmv2": output\_filename = fn\_data[0] + "\_ntlmv2" + fn\_data[1] else: output\_filename = fn\_data[0] + "\_ntlm" + fn\_data[1]
 with open(output\_filename,"a") as f: f.write(hash\_string) f.write('\n')
def decodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return text.decode('utf-16le') else: return text
def encodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return (text).encode('utf-16le') else: return text.encode('ascii') def getFileTime(t): t \*= 10000000 t += 116444736000000000 return t
def getUnixTime(t): t -= 116444736000000000 t //= 10000000 return t
def getSMBDate(t): # TODO: Fix this :P d = datetime.date.fromtimestamp(t) year = d.year - 1980 ret = (year << 8) + (d.month << 4) + d.day return ret
def getSMBTime(t): # TODO: Fix this :P d = datetime.datetime.fromtimestamp(t) return (d.hour << 8) + (d.minute << 4) + d.second
def getShares(connId, smbServer): config = smbServer.getServerConfig() sections = config.sections() # Remove the global one del(sections[sections.index('global')]) shares = {} for i in sections: shares[i] = dict(config.items(i)) return shares
def searchShare(connId, share, smbServer): config = smbServer.getServerConfig() if config.has\_section(share): return dict(config.items(share)) else: return None
def openFile(path,fileName, accessMode, fileAttributes, openMode): fileName = os.path.normpath(fileName.replace('\\','/')) errorCode = 0 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) mode = 0 # Check the Open Mode if openMode & 0x10: # If the file does not exist, create it. mode = os.O\_CREAT else: # If file does not exist, return an error if os.path.exists(pathName) is not True: errorCode = STATUS\_NO\_SUCH\_FILE return 0,mode, pathName, errorCode
 if os.path.isdir(pathName) and (fileAttributes & smb.ATTR\_DIRECTORY) == 0: # Request to open a normal file and this is actually a directory errorCode = STATUS\_FILE\_IS\_A\_DIRECTORY return 0, mode, pathName, errorCode # Check the Access Mode if accessMode & 0x7 == 1: mode |= os.O\_WRONLY elif accessMode & 0x7 == 2: mode |= os.O\_RDWR else: mode = os.O\_RDONLY
 try: if sys.platform == 'win32': mode |= os.O\_BINARY fid = os.open(pathName, mode) except Exception as e: LOG.error("openFile: %s,%s" % (pathName, mode) ,e) fid = 0 errorCode = STATUS\_ACCESS\_DENIED
 return fid, mode, pathName, errorCode
def queryFsInformation(path, filename, level=0, pktFlags = smb.SMB.FLAGS2\_UNICODE):
 if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) fileSize = os.path.getsize(pathName) (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FS\_ATTRIBUTE\_INFO or level == smb2.SMB2\_FILESYSTEM\_ATTRIBUTE\_INFO: data = smb.SMBQueryFsAttributeInfo() data['FileSystemAttributes'] = smb.FILE\_CASE\_SENSITIVE\_SEARCH | smb.FILE\_CASE\_PRESERVED\_NAMES data['MaxFilenNameLengthInBytes'] = 255 data['LengthOfFileSystemName'] = len('XTFS')\*2 data['FileSystemName'] = 'XTFS'.encode('utf-16le') return data.getData() elif level == smb.SMB\_INFO\_VOLUME: data = smb.SMBQueryFsInfoVolume( flags = pktFlags ) data['VolumeLabel'] = 'SHARE'.encode(encoding) return data.getData() elif level == smb.SMB\_QUERY\_FS\_VOLUME\_INFO or level == smb2.SMB2\_FILESYSTEM\_VOLUME\_INFO: data = smb.SMBQueryFsVolumeInfo() data['VolumeLabel'] = '' data['VolumeCreationTime'] = getFileTime(ctime) return data.getData()  elif level == smb.SMB\_QUERY\_FS\_SIZE\_INFO: data = smb.SMBQueryFsSizeInfo() return data.getData() elif level == smb.FILE\_FS\_FULL\_SIZE\_INFORMATION: data = smb.SMBFileFsFullSizeInformation() return data.getData() elif level == smb.FILE\_FS\_SIZE\_INFORMATION: data = smb.FileFsSizeInformation() return data.getData() else: lastWriteTime = mtime attribs = 0 if os.path.isdir(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_DIRECTORY if os.path.isfile(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_NORMAL fileAttributes = attribs return fileSize, lastWriteTime, fileAttributes
def findFirst2(path, fileName, level, searchAttributes, pktFlags = smb.SMB.FLAGS2\_UNICODE, isSMB2 = False): # TODO: Depending on the level, this could be done much simpler  #print "FindFirs2 path:%s, filename:%s" % (path, fileName) fileName = os.path.normpath(fileName.replace('\\','/')) # Let's choose the right encoding depending on the request if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:]
 pathName = os.path.join(path,fileName) files = []
 if pathName.find('\*') == -1 and pathName.find('?') == -1: # No search patterns pattern = '' else: pattern = os.path.basename(pathName) dirName = os.path.dirname(pathName)
 # Always add . and .. Not that important for Windows, but Samba whines if  # not present (for \* search only) if pattern == '\*': files.append(os.path.join(dirName,'.')) files.append(os.path.join(dirName,'..'))
 if pattern != '': for file in os.listdir(dirName): if fnmatch.fnmatch(file.lower(),pattern.lower()): entry = os.path.join(dirName, file) if os.path.isdir(entry): if searchAttributes & smb.ATTR\_DIRECTORY: files.append(entry) else: files.append(entry) else: if os.path.exists(pathName): files.append(pathName)
 searchResult = [] searchCount = len(files) errorCode = STATUS\_SUCCESS
 for i in files: if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_DIRECTORY\_INFO: item = smb.SMBFindFileDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_INFO\_STANDARD: item = smb.SMBFindInfoStandard( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileIdFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileIdBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_NAMES\_INFO or level == smb2.SMB2\_FILE\_NAMES\_INFO: item = smb.SMBFindFileNamesInfo( flags = pktFlags ) else: LOG.error("Wrong level %d!" % level) return searchResult, searchCount, STATUS\_NOT\_SUPPORTED  (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(i) if os.path.isdir(i): item['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: item['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE
 item['FileName'] = os.path.basename(i).encode(encoding)
 if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['ShortName'] = '\x00'\*24 item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO: item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_INFO\_STANDARD: item['EaSize'] = size item['CreationDate'] = getSMBDate(ctime) item['CreationTime'] = getSMBTime(ctime) item['LastAccessDate'] = getSMBDate(atime) item['LastAccessTime'] = getSMBTime(atime) item['LastWriteDate'] = getSMBDate(mtime) item['LastWriteTime'] = getSMBTime(mtime) searchResult.append(item)
 # No more files if (level >= smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or isSMB2 is True) and searchCount > 0: searchResult[-1]['NextEntryOffset'] = 0
 return searchResult, searchCount, errorCode
def queryFileInformation(path, filename, level): #print "queryFileInfo path: %s, filename: %s, level:0x%x" % (path,filename,level) return queryPathInformation(path,filename, level)
def queryPathInformation(path, filename, level): # TODO: Depending on the level, this could be done much simpler #print("queryPathInfo path: %s, filename: %s, level:0x%x" % (path,filename,level)) try: errorCode = 0 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FILE\_BASIC\_INFO: infoRecord = smb.SMBQueryFileBasicInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_STANDARD\_INFO: infoRecord = smb.SMBQueryFileStandardInfo() infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 elif level == smb.SMB\_QUERY\_FILE\_ALL\_INFO or level == smb2.SMB2\_FILE\_ALL\_INFO: infoRecord = smb.SMBQueryFileAllInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 infoRecord['FileName'] = filename.encode('utf-16le') elif level == smb2.SMB2\_FILE\_NETWORK\_OPEN\_INFO: infoRecord = smb.SMBFileNetworkOpenInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['ChangeTime'] = getFileTime(mtime) infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['FileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['FileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_EA\_INFO or level == smb2.SMB2\_FILE\_EA\_INFO:  infoRecord = smb.SMBQueryFileEaInfo() elif level == smb2.SMB2\_FILE\_STREAM\_INFO: infoRecord = smb.SMBFileStreamInformation() else: LOG.error('Unknown level for query path info! 0x%x' % level) # UNSUPPORTED return None, STATUS\_NOT\_SUPPORTED
 return infoRecord, errorCode else: # NOT FOUND return None, STATUS\_OBJECT\_NAME\_NOT\_FOUND except Exception as e: LOG.error('queryPathInfo: %s' % e) raise
def queryDiskInformation(path):# TODO: Do something useful here :)# For now we just return fake values totalUnits = 65535 freeUnits = 65535 return totalUnits, freeUnits
# Here we implement the NT transaction handlersclass NTTRANSCommands: def default(self, connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): pass
# Here we implement the NT transaction handlersclass TRANSCommands: @staticmethod def lanMan(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): # Minimal [MS-RAP] implementation, just to return the shares connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS if struct.unpack('<H',parameters[:2])[0] == 0: # NetShareEnum Request netShareEnum = smb.SMBNetShareEnum(parameters) if netShareEnum['InfoLevel'] == 1: shares = getShares(connId, smbServer) respParameters = smb.SMBNetShareEnumResponse() respParameters['EntriesReturned'] = len(shares) respParameters['EntriesAvailable'] = len(shares) tailData = '' for i in shares: # NetShareInfo1 len == 20 entry = smb.NetShareInfo1() entry['NetworkName'] = i + '\x00'\*(13-len(i)) entry['Type'] = int(shares[i]['share type']) # (beto) If offset == 0 it crashes explorer.exe on windows 7 entry['RemarkOffsetLow'] = 20 \* len(shares) + len(tailData) respData += entry.getData() if 'comment' in shares[i]: tailData += shares[i]['comment'] + '\x00' else: tailData += '\x00' respData += tailData else: # We don't support other info levels errorCode = STATUS\_NOT\_SUPPORTED elif struct.unpack('<H',parameters[:2])[0] == 13: # NetrServerGetInfo Request respParameters = smb.SMBNetServerGetInfoResponse() netServerInfo = smb.SMBNetServerInfo1() netServerInfo['ServerName'] = smbServer.getServerName() respData = netServerInfo.getData() respParameters['TotalBytesAvailable'] = len(respData) elif struct.unpack('<H',parameters[:2])[0] == 1: # NetrShareGetInfo Request request = smb.SMBNetShareGetInfo(parameters) respParameters = smb.SMBNetShareGetInfoResponse() shares = getShares(connId, smbServer) share = shares[request['ShareName'].upper()] shareInfo = smb.NetShareInfo1()  shareInfo['NetworkName'] = request['ShareName'].upper() + '\x00' shareInfo['Type'] = int(share['share type']) respData = shareInfo.getData() if 'comment' in share: shareInfo['RemarkOffsetLow'] = len(respData) respData += share['comment'] + '\x00' respParameters['TotalBytesAvailable'] = len(respData)  else: # We don't know how to handle anything else errorCode = STATUS\_NOT\_SUPPORTED
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def transactNamedPipe(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS SMBCommand = smb.SMBCommand(recvPacket['Data'][0]) transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Extract the FID fid = struct.unpack('<H', transParameters['Setup'][2:])[0]
 if fid in connData['OpenedFiles']: fileHandle = connData['OpenedFiles'][fid]['FileHandle'] if fileHandle != PIPE\_FILE\_DESCRIPTOR: os.write(fileHandle,data) respData = os.read(fileHandle,data) else: sock = connData['OpenedFiles'][fid]['Socket'] sock.send(data) respData = sock.recv(maxDataCount) else: errorCode = STATUS\_INVALID\_HANDLE
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the transaction2 handlersclass TRANS2Commands: # All these commands return setup, parameters, data, errorCode @staticmethod def setPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setPathInfoParameters = smb.SMBSetPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters) if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] fileName = decodeSMBString(recvPacket['Flags2'], setPathInfoParameters['FileName']) fileName = os.path.normpath(fileName.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): informationLevel = setPathInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) if mtime != -1 or atime != -1: os.utime(pathName,(atime,mtime)) else: smbServer.log('Unknown level for set path info! 0x%x' % setPathInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_OBJECT\_NAME\_NOT\_FOUND
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetPathInformationResponse\_Parameters()
 else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def setFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setFileInfoParameters = smb.SMBSetFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if setFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileName'] informationLevel = setFileInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_DISPOSITION\_INFO: infoRecord = smb.SMBSetFileDispositionInfo(parameters) if infoRecord['DeletePending'] > 0: # Mark this file for removal after closed connData['OpenedFiles'][setFileInfoParameters['FID']]['DeleteOnClose'] = True respParameters = smb.SMBSetFileInformationResponse\_Parameters() elif informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) os.utime(fileName,(atime,mtime)) elif informationLevel == smb.SMB\_SET\_FILE\_END\_OF\_FILE\_INFO: fileHandle = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileHandle'] infoRecord = smb.SMBSetFileEndOfFileInfo(data) if infoRecord['EndOfFile'] > 0: os.lseek(fileHandle, infoRecord['EndOfFile']-1, 0) os.write(fileHandle, b'\x00') else: smbServer.log('Unknown level for set file info! 0x%x' % setFileInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_NO\_SUCH\_FILE
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetFileInformationResponse\_Parameters() else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b''
 queryFileInfoParameters = smb.SMBQueryFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if queryFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][queryFileInfoParameters['FID']]['FileName']
 infoRecord, errorCode = queryFileInformation('', fileName, queryFileInfoParameters['InformationLevel'])
 if infoRecord is not None: respParameters = smb.SMBQueryFileInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = 0
 queryPathInfoParameters = smb.SMBQueryPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] try: infoRecord, errorCode = queryPathInformation(path, decodeSMBString(recvPacket['Flags2'], queryPathInfoParameters['FileName']), queryPathInfoParameters['InformationLevel']) except Exception as e: smbServer.log("queryPathInformation: %s" % e,logging.ERROR)
 if infoRecord is not None: respParameters = smb.SMBQueryPathInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_SMB\_BAD\_TID  smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFsInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId) errorCode = 0 # Get the Tid associated if recvPacket['Tid'] in connData['ConnectedShares']: data = queryFsInformation(connData['ConnectedShares'][recvPacket['Tid']]['path'], '', struct.unpack('<H',parameters)[0], pktFlags = recvPacket['Flags2'])
 smbServer.setConnectionData(connId, connData)
 return b'',b'', data, errorCode
 @staticmethod def findNext2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS findNext2Parameters = smb.SMBFindNext2\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 sid = findNext2Parameters['SID'] if recvPacket['Tid'] in connData['ConnectedShares']: if sid in connData['SIDs']: searchResult = connData['SIDs'][sid] respParameters = smb.SMBFindNext2Response\_Parameters() endOfSearch = 1 searchCount = 1 totalData = 0 for i in enumerate(searchResult): data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) >= findNext2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data totalData += lenData  # Have we reached the end of the search or still stuff to send? if endOfSearch > 0: # Let's remove the SID from our ConnData del(connData['SIDs'][sid])
 respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else:  errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def findFirst2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' findFirst2Parameters = smb.SMBFindFirst2\_Parameters( recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path']
 searchResult, searchCount, errorCode = findFirst2(path,  decodeSMBString( recvPacket['Flags2'], findFirst2Parameters['FileName'] ),  findFirst2Parameters['InformationLevel'],  findFirst2Parameters['SearchAttributes'] , pktFlags = recvPacket['Flags2'])
 respParameters = smb.SMBFindFirst2Response\_Parameters() endOfSearch = 1 sid = 0x80 # default SID searchCount = 0 totalData = 0 for i in enumerate(searchResult): #i[1].dump() data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) > findFirst2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 # Simple way to generate a fid if len(connData['SIDs']) == 0: sid = 1 else: sid = list(connData['SIDs'].keys())[-1] + 1 # Store the remaining search results in the ConnData SID connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data
 padLen = (8-(lenData % 8)) %8 respData += b'\xaa'\*padLen totalData += lenData + padLen
 respParameters['SID'] = sid respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the commands handlersclass SMBCommands:
 @staticmethod def smbTransaction(connId, smbServer, SMBCommand, recvPacket, transCommands): connData = smbServer.getConnectionData(connId)
 respSMBCommand = smb.SMBCommand(recvPacket['Command'])
 transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Do the stuff if transParameters['ParameterCount'] != transParameters['TotalParameterCount']: # TODO: Handle partial parameters  raise Exception("Unsupported partial parameters in TRANSACT2!") else: transData = smb.SMBTransaction\_SData(flags = recvPacket['Flags2']) # Standard says servers shouldn't trust Parameters and Data comes  # in order, so we have to parse the offsets, ugly
 paramCount = transParameters['ParameterCount'] transData['Trans\_ParametersLength'] = paramCount dataCount = transParameters['DataCount'] transData['Trans\_DataLength'] = dataCount transData.fromString(SMBCommand['Data']) if transParameters['ParameterOffset'] > 0: paramOffset = transParameters['ParameterOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Parameters'] = SMBCommand['Data'][paramOffset:paramOffset+paramCount] else: transData['Trans\_Parameters'] = b''
 if transParameters['DataOffset'] > 0: dataOffset = transParameters['DataOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Data'] = SMBCommand['Data'][dataOffset:dataOffset + dataCount] else:  transData['Trans\_Data'] = b''  # Call the handler for this TRANSACTION if transParameters['SetupCount'] == 0: # No subcommand, let's play with the Name command = decodeSMBString(recvPacket['Flags2'],transData['Name']) else: command = struct.unpack('<H', transParameters['Setup'][:2])[0]  if command in transCommands: # Call the TRANS subcommand setup = b'' parameters = b'' data = b'' try:  setup, parameters, data, errorCode = transCommands[command](connId, smbServer,  recvPacket,  transData['Trans\_Parameters'],  transData['Trans\_Data'], transParameters['MaxDataCount']) except Exception as e: #print 'Transaction: %s' % e,e smbServer.log('Transaction: (%r,%s)' % (command, e), logging.ERROR) errorCode = STATUS\_ACCESS\_DENIED #raise
 if setup == b'' and parameters == b'' and data == b'': # Something wen't wrong respParameters = b'' respData = b'' else: # Build the answer if hasattr(data, 'getData'): data = data.getData() remainingData = len(data) if hasattr(parameters, 'getData'): parameters = parameters.getData() remainingParameters = len(parameters) commands = [] dataDisplacement = 0 while remainingData > 0 or remainingParameters > 0:  respSMBCommand = smb.SMBCommand(recvPacket['Command']) respParameters = smb.SMBTransactionResponse\_Parameters() respData = smb.SMBTransaction2Response\_Data()
 respParameters['TotalParameterCount'] = len(parameters)[View remainder of file in raw view](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_496ce003_20250114_190106.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fcommit%2F49c643bf66620646884ed141c94e5fdd85bcdd2f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fcommit%2F49c643bf66620646884ed141c94e5fdd85bcdd2f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

## Commit

[Permalink](/fortra/impacket/commit/49c643bf66620646884ed141c94e5fdd85bcdd2f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#1066](https://github.com/fortra/impacket/pull/1066) from omriinbar/master

[Browse files](/fortra/impacket/tree/49c643bf66620646884ed141c94e5fdd85bcdd2f)
Browse the repository at this point in the history

```
Fix Path Traversal vulnerabilities by checking path prefix against in…
```

* Loading branch information

[![@0xdeaddood](https://avatars.githubusercontent.com/u/56035084?s=40&v=4)](/0xdeaddood)

[0xdeaddood](/fortra/impacket/commits?author=0xdeaddood "View all commits by 0xdeaddood")
authored
May 3, 2021

2 parents
[91902ea](/fortra/impacket/commit/91902eafb68fea932cf2350cab329f15afa554e5)
+
[6688da5](/fortra/impacket/commit/6688da5d97592269aae72b3a00dc1ab186c0b33d)

commit 49c643b

Showing
**1 changed file**
with
**2,012 additions**
and
**1,937 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `49c643b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fcommit%2F49c643bf66620646884ed141c94e5fdd85bcdd2f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_323d86e9_20250114_190102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffortra%2Fimpacket%2Fblob%2Fcb6d43a677c338db930bc4e9161620832c1ec624%2Fimpacket%2Fsmbserver.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=fortra%2Fimpacket)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fortra](/fortra)
/
**[impacket](/fortra/impacket)**
Public

* [Notifications](/login?return_to=%2Ffortra%2Fimpacket) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Ffortra%2Fimpacket)
* [Star
   13.8k](/login?return_to=%2Ffortra%2Fimpacket)

* [Code](/fortra/impacket)
* [Issues
  194](/fortra/impacket/issues)
* [Pull requests
  150](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects
  0](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

Additional navigation options

* [Code](/fortra/impacket)
* [Issues](/fortra/impacket/issues)
* [Pull requests](/fortra/impacket/pulls)
* [Actions](/fortra/impacket/actions)
* [Projects](/fortra/impacket/projects)
* [Security](/fortra/impacket/security)
* [Insights](/fortra/impacket/pulse)

## Files

 cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Copy path Blame  Blame
## Latest commit

## History

[History](/fortra/impacket/commits/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)4692 lines (4007 loc) · 216 KB cb6d43a
## Breadcrumbs

1. [impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624)
2. /[impacket](/fortra/impacket/tree/cb6d43a677c338db930bc4e9161620832c1ec624/impacket)
/
# smbserver.py

Top
## File metadata and controls

* Code
* Blame

4692 lines (4007 loc) · 216 KB[Raw](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000# SECUREAUTH LABS. Copyright 2018 SecureAuth Corporation. All rights reserved.## This software is provided under under a slightly modified version# of the Apache Software License. See the accompanying LICENSE file# for more information.## Author: Alberto Solino (@agsolino)## TODO:# [-] Functions should return NT error codes# [-] Handling errors in all situations, right now it's just raising exceptions. # [\*] Standard authentication support# [ ] Organize the connectionData stuff# [\*] Add capability to send a bad user ID if the user is not authenticated,# right now you can ask for any command without actually being authenticated# [ ] PATH TRAVERSALS EVERYWHERE.. BE WARNED!# [ ] Check error situation (now many places assume the right data is coming)# [ ] Implement IPC to the main process so the connectionData is on a single place# [ ] Hence.. implement locking# estamos en la B
import calendarimport socketimport timeimport datetimeimport structimport threadingimport loggingimport logging.configimport ntpathimport osimport fnmatchimport errnoimport sysimport randomimport shutilimport stringimport hashlibimport hmac
from binascii import unhexlify, hexlify, a2b\_hexfrom six import PY2, b, text\_typefrom six.moves import configparser, socketserver
# For signingfrom impacket import smb, nmb, ntlm, uuidfrom impacket import smb3structs as smb2from impacket.spnego import SPNEGO\_NegTokenInit, TypesMech, MechTypes, SPNEGO\_NegTokenResp, ASN1\_AID, ASN1\_SUPPORTED\_MECHfrom impacket.nt\_errors import STATUS\_NO\_MORE\_FILES, STATUS\_NETWORK\_NAME\_DELETED, STATUS\_INVALID\_PARAMETER, \ STATUS\_FILE\_CLOSED, STATUS\_MORE\_PROCESSING\_REQUIRED, STATUS\_OBJECT\_PATH\_NOT\_FOUND, STATUS\_DIRECTORY\_NOT\_EMPTY, \ STATUS\_FILE\_IS\_A\_DIRECTORY, STATUS\_NOT\_IMPLEMENTED, STATUS\_INVALID\_HANDLE, STATUS\_OBJECT\_NAME\_COLLISION, \ STATUS\_NO\_SUCH\_FILE, STATUS\_CANCELLED, STATUS\_OBJECT\_NAME\_NOT\_FOUND, STATUS\_SUCCESS, STATUS\_ACCESS\_DENIED, \ STATUS\_NOT\_SUPPORTED, STATUS\_INVALID\_DEVICE\_REQUEST, STATUS\_FS\_DRIVER\_REQUIRED, STATUS\_INVALID\_INFO\_CLASS, \ STATUS\_LOGON\_FAILURE
# Setting LOG to current's module nameLOG = logging.getLogger(\_\_name\_\_)
# These ones not defined in nt\_errorsSTATUS\_SMB\_BAD\_UID = 0x005B0002STATUS\_SMB\_BAD\_TID = 0x00050002
# Utility functions# and general functions. # There are some common functions that can be accessed from more than one SMB # command (or either TRANSACTION). That's why I'm putting them here# TODO: Return NT ERROR Codes
def computeNTLMv2(identity, lmhash, nthash, serverChallenge, authenticateMessage, ntlmChallenge, type1): # Let's calculate the NTLMv2 Response
 responseKeyNT = ntlm.NTOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), nthash) responseKeyLM = ntlm.LMOWFv2(identity, '', authenticateMessage['domain\_name'].decode('utf-16le'), lmhash)
 ntProofStr = authenticateMessage['ntlm'][:16] temp = authenticateMessage['ntlm'][16:] ntProofStr2 = ntlm.hmac\_md5(responseKeyNT, serverChallenge + temp) lmChallengeResponse = authenticateMessage['lanman'] sessionBaseKey = ntlm.hmac\_md5(responseKeyNT, ntProofStr)
 responseFlags = type1['flags']
 # Let's check the return flags if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY) == 0: # No extended session security, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_EXTENDED\_SESSIONSECURITY if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_128) == 0: # No support for 128 key len, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_128 if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH) == 0: # No key exchange supported, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SEAL) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SEAL if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_SIGN if (ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN) == 0: # No sign available, taking it out responseFlags &= 0xffffffff ^ ntlm.NTLMSSP\_NEGOTIATE\_ALWAYS\_SIGN
 keyExchangeKey = ntlm.KXKEY(ntlmChallenge['flags'], sessionBaseKey, lmChallengeResponse, ntlmChallenge['challenge'], '', lmhash, nthash, True)
 # If we set up key exchange, let's fill the right variables if ntlmChallenge['flags'] & ntlm.NTLMSSP\_NEGOTIATE\_KEY\_EXCH: exportedSessionKey = authenticateMessage['session\_key'] exportedSessionKey = ntlm.generateEncryptedSessionKey(keyExchangeKey, exportedSessionKey) else: encryptedRandomSessionKey = None # [MS-NLMP] page 46 exportedSessionKey = keyExchangeKey
 # Do they match? if ntProofStr == ntProofStr2: # Yes!, process login return STATUS\_SUCCESS, exportedSessionKey else: return STATUS\_LOGON\_FAILURE, exportedSessionKey
def outputToJohnFormat(challenge, username, domain, lmresponse, ntresponse):# We don't want to add a possible failure here, since this is an# extra bonus. We try, if it fails, returns nothing# ToDo: Document the parameter's types (bytes / string) and check all the places where it's called ret\_value = '' if type(challenge) is not bytes: challenge = challenge.decode('latin-1')
 try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse).decode('latin-1')[:32], hexlify(ntresponse).decode()[32:]), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('utf-16le'), domain.decode('utf-16le'), hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode()), 'hash\_version': 'ntlm'} except: # Let's try w/o decoding Unicode try: if len(ntresponse) > 24: # Extended Security - NTLMv2 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username.decode('latin-1'), domain.decode('latin-1'), hexlify(challenge).decode('latin-1'), hexlify(ntresponse)[:32].decode('latin-1'), hexlify(ntresponse)[32:].decode('latin-1')), 'hash\_version': 'ntlmv2'} else: # NTLMv1 ret\_value = {'hash\_string': '%s::%s:%s:%s:%s' % ( username, domain, hexlify(lmresponse).decode('latin-1'), hexlify(ntresponse).decode('latin-1'), hexlify(challenge).decode('latin-1')), 'hash\_version': 'ntlm'} except Exception as e: import traceback traceback.print\_exc() LOG.error("outputToJohnFormat: %s" % e) pass
 return ret\_value
def writeJohnOutputToFile(hash\_string, hash\_version, file\_name): fn\_data = os.path.splitext(file\_name) if hash\_version == "ntlmv2": output\_filename = fn\_data[0] + "\_ntlmv2" + fn\_data[1] else: output\_filename = fn\_data[0] + "\_ntlm" + fn\_data[1]
 with open(output\_filename,"a") as f: f.write(hash\_string) f.write('\n')
def decodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return text.decode('utf-16le') else: return text
def encodeSMBString( flags, text ): if flags & smb.SMB.FLAGS2\_UNICODE: return (text).encode('utf-16le') else: return text.encode('ascii') def getFileTime(t): t \*= 10000000 t += 116444736000000000 return t
def getUnixTime(t): t -= 116444736000000000 t //= 10000000 return t
def getSMBDate(t): # TODO: Fix this :P d = datetime.date.fromtimestamp(t) year = d.year - 1980 ret = (year << 8) + (d.month << 4) + d.day return ret
def getSMBTime(t): # TODO: Fix this :P d = datetime.datetime.fromtimestamp(t) return (d.hour << 8) + (d.minute << 4) + d.second
def getShares(connId, smbServer): config = smbServer.getServerConfig() sections = config.sections() # Remove the global one del(sections[sections.index('global')]) shares = {} for i in sections: shares[i] = dict(config.items(i)) return shares
def searchShare(connId, share, smbServer): config = smbServer.getServerConfig() if config.has\_section(share): return dict(config.items(share)) else: return None
def openFile(path,fileName, accessMode, fileAttributes, openMode): fileName = os.path.normpath(fileName.replace('\\','/')) errorCode = 0 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) mode = 0 # Check the Open Mode if openMode & 0x10: # If the file does not exist, create it. mode = os.O\_CREAT else: # If file does not exist, return an error if os.path.exists(pathName) is not True: errorCode = STATUS\_NO\_SUCH\_FILE return 0,mode, pathName, errorCode
 if os.path.isdir(pathName) and (fileAttributes & smb.ATTR\_DIRECTORY) == 0: # Request to open a normal file and this is actually a directory errorCode = STATUS\_FILE\_IS\_A\_DIRECTORY return 0, mode, pathName, errorCode # Check the Access Mode if accessMode & 0x7 == 1: mode |= os.O\_WRONLY elif accessMode & 0x7 == 2: mode |= os.O\_RDWR else: mode = os.O\_RDONLY
 try: if sys.platform == 'win32': mode |= os.O\_BINARY fid = os.open(pathName, mode) except Exception as e: LOG.error("openFile: %s,%s" % (pathName, mode) ,e) fid = 0 errorCode = STATUS\_ACCESS\_DENIED
 return fid, mode, pathName, errorCode
def queryFsInformation(path, filename, level=0, pktFlags = smb.SMB.FLAGS2\_UNICODE):
 if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) fileSize = os.path.getsize(pathName) (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FS\_ATTRIBUTE\_INFO or level == smb2.SMB2\_FILESYSTEM\_ATTRIBUTE\_INFO: data = smb.SMBQueryFsAttributeInfo() data['FileSystemAttributes'] = smb.FILE\_CASE\_SENSITIVE\_SEARCH | smb.FILE\_CASE\_PRESERVED\_NAMES data['MaxFilenNameLengthInBytes'] = 255 data['LengthOfFileSystemName'] = len('XTFS')\*2 data['FileSystemName'] = 'XTFS'.encode('utf-16le') return data.getData() elif level == smb.SMB\_INFO\_VOLUME: data = smb.SMBQueryFsInfoVolume( flags = pktFlags ) data['VolumeLabel'] = 'SHARE'.encode(encoding) return data.getData() elif level == smb.SMB\_QUERY\_FS\_VOLUME\_INFO or level == smb2.SMB2\_FILESYSTEM\_VOLUME\_INFO: data = smb.SMBQueryFsVolumeInfo() data['VolumeLabel'] = '' data['VolumeCreationTime'] = getFileTime(ctime) return data.getData()  elif level == smb.SMB\_QUERY\_FS\_SIZE\_INFO: data = smb.SMBQueryFsSizeInfo() return data.getData() elif level == smb.FILE\_FS\_FULL\_SIZE\_INFORMATION: data = smb.SMBFileFsFullSizeInformation() return data.getData() elif level == smb.FILE\_FS\_SIZE\_INFORMATION: data = smb.FileFsSizeInformation() return data.getData() else: lastWriteTime = mtime attribs = 0 if os.path.isdir(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_DIRECTORY if os.path.isfile(pathName): attribs |= smb.SMB\_FILE\_ATTRIBUTE\_NORMAL fileAttributes = attribs return fileSize, lastWriteTime, fileAttributes
def findFirst2(path, fileName, level, searchAttributes, pktFlags = smb.SMB.FLAGS2\_UNICODE, isSMB2 = False): # TODO: Depending on the level, this could be done much simpler  #print "FindFirs2 path:%s, filename:%s" % (path, fileName) fileName = os.path.normpath(fileName.replace('\\','/')) # Let's choose the right encoding depending on the request if pktFlags & smb.SMB.FLAGS2\_UNICODE: encoding = 'utf-16le' else: encoding = 'ascii'
 if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\'): # strip leading '/' fileName = fileName[1:]
 pathName = os.path.join(path,fileName) files = []
 if pathName.find('\*') == -1 and pathName.find('?') == -1: # No search patterns pattern = '' else: pattern = os.path.basename(pathName) dirName = os.path.dirname(pathName)
 # Always add . and .. Not that important for Windows, but Samba whines if  # not present (for \* search only) if pattern == '\*': files.append(os.path.join(dirName,'.')) files.append(os.path.join(dirName,'..'))
 if pattern != '': for file in os.listdir(dirName): if fnmatch.fnmatch(file.lower(),pattern.lower()): entry = os.path.join(dirName, file) if os.path.isdir(entry): if searchAttributes & smb.ATTR\_DIRECTORY: files.append(entry) else: files.append(entry) else: if os.path.exists(pathName): files.append(pathName)
 searchResult = [] searchCount = len(files) errorCode = STATUS\_SUCCESS
 for i in files: if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_DIRECTORY\_INFO: item = smb.SMBFindFileDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_INFO\_STANDARD: item = smb.SMBFindInfoStandard( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_FULL\_DIRECTORY\_INFO: item = smb.SMBFindFileIdFullDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO: item = smb.SMBFindFileIdBothDirectoryInfo( flags = pktFlags ) elif level == smb.SMB\_FIND\_FILE\_NAMES\_INFO or level == smb2.SMB2\_FILE\_NAMES\_INFO: item = smb.SMBFindFileNamesInfo( flags = pktFlags ) else: LOG.error("Wrong level %d!" % level) return searchResult, searchCount, STATUS\_NOT\_SUPPORTED  (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(i) if os.path.isdir(i): item['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: item['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE
 item['FileName'] = os.path.basename(i).encode(encoding)
 if level == smb.SMB\_FIND\_FILE\_BOTH\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_ID\_BOTH\_DIRECTORY\_INFO or level == smb2.SMB2\_FILE\_BOTH\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['ShortName'] = '\x00'\*24 item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO: item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) item['FileName'] = os.path.basename(i).encode(encoding) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_FILE\_FULL\_DIRECTORY\_INFO or level == smb.SMB\_FIND\_FILE\_ID\_FULL\_DIRECTORY\_INFO or level == smb2.SMB2\_FULL\_DIRECTORY\_INFO: item['EaSize'] = 0 item['EndOfFile'] = size item['AllocationSize'] = size item['CreationTime'] = getFileTime(ctime) item['LastAccessTime'] = getFileTime(atime) item['LastWriteTime'] = getFileTime(mtime) item['LastChangeTime'] = getFileTime(mtime) padLen = (8-(len(item) % 8)) % 8 item['NextEntryOffset'] = len(item) + padLen elif level == smb.SMB\_FIND\_INFO\_STANDARD: item['EaSize'] = size item['CreationDate'] = getSMBDate(ctime) item['CreationTime'] = getSMBTime(ctime) item['LastAccessDate'] = getSMBDate(atime) item['LastAccessTime'] = getSMBTime(atime) item['LastWriteDate'] = getSMBDate(mtime) item['LastWriteTime'] = getSMBTime(mtime) searchResult.append(item)
 # No more files if (level >= smb.SMB\_FIND\_FILE\_DIRECTORY\_INFO or isSMB2 is True) and searchCount > 0: searchResult[-1]['NextEntryOffset'] = 0
 return searchResult, searchCount, errorCode
def queryFileInformation(path, filename, level): #print "queryFileInfo path: %s, filename: %s, level:0x%x" % (path,filename,level) return queryPathInformation(path,filename, level)
def queryPathInformation(path, filename, level): # TODO: Depending on the level, this could be done much simpler #print("queryPathInfo path: %s, filename: %s, level:0x%x" % (path,filename,level)) try: errorCode = 0 fileName = os.path.normpath(filename.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): (mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(pathName) if level == smb.SMB\_QUERY\_FILE\_BASIC\_INFO: infoRecord = smb.SMBQueryFileBasicInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_STANDARD\_INFO: infoRecord = smb.SMBQueryFileStandardInfo() infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 elif level == smb.SMB\_QUERY\_FILE\_ALL\_INFO or level == smb2.SMB2\_FILE\_ALL\_INFO: infoRecord = smb.SMBQueryFileAllInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['LastChangeTime'] = getFileTime(mtime) if os.path.isdir(pathName): infoRecord['ExtFileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['ExtFileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['Directory'] = 1 else: infoRecord['Directory'] = 0 infoRecord['FileName'] = filename.encode('utf-16le') elif level == smb2.SMB2\_FILE\_NETWORK\_OPEN\_INFO: infoRecord = smb.SMBFileNetworkOpenInfo() infoRecord['CreationTime'] = getFileTime(ctime) infoRecord['LastAccessTime'] = getFileTime(atime) infoRecord['LastWriteTime'] = getFileTime(mtime) infoRecord['ChangeTime'] = getFileTime(mtime) infoRecord['AllocationSize'] = size infoRecord['EndOfFile'] = size if os.path.isdir(pathName): infoRecord['FileAttributes'] = smb.ATTR\_DIRECTORY else: infoRecord['FileAttributes'] = smb.ATTR\_NORMAL | smb.ATTR\_ARCHIVE elif level == smb.SMB\_QUERY\_FILE\_EA\_INFO or level == smb2.SMB2\_FILE\_EA\_INFO:  infoRecord = smb.SMBQueryFileEaInfo() elif level == smb2.SMB2\_FILE\_STREAM\_INFO: infoRecord = smb.SMBFileStreamInformation() else: LOG.error('Unknown level for query path info! 0x%x' % level) # UNSUPPORTED return None, STATUS\_NOT\_SUPPORTED
 return infoRecord, errorCode else: # NOT FOUND return None, STATUS\_OBJECT\_NAME\_NOT\_FOUND except Exception as e: LOG.error('queryPathInfo: %s' % e) raise
def queryDiskInformation(path):# TODO: Do something useful here :)# For now we just return fake values totalUnits = 65535 freeUnits = 65535 return totalUnits, freeUnits
# Here we implement the NT transaction handlersclass NTTRANSCommands: def default(self, connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): pass
# Here we implement the NT transaction handlersclass TRANSCommands: @staticmethod def lanMan(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): # Minimal [MS-RAP] implementation, just to return the shares connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS if struct.unpack('<H',parameters[:2])[0] == 0: # NetShareEnum Request netShareEnum = smb.SMBNetShareEnum(parameters) if netShareEnum['InfoLevel'] == 1: shares = getShares(connId, smbServer) respParameters = smb.SMBNetShareEnumResponse() respParameters['EntriesReturned'] = len(shares) respParameters['EntriesAvailable'] = len(shares) tailData = '' for i in shares: # NetShareInfo1 len == 20 entry = smb.NetShareInfo1() entry['NetworkName'] = i + '\x00'\*(13-len(i)) entry['Type'] = int(shares[i]['share type']) # (beto) If offset == 0 it crashes explorer.exe on windows 7 entry['RemarkOffsetLow'] = 20 \* len(shares) + len(tailData) respData += entry.getData() if 'comment' in shares[i]: tailData += shares[i]['comment'] + '\x00' else: tailData += '\x00' respData += tailData else: # We don't support other info levels errorCode = STATUS\_NOT\_SUPPORTED elif struct.unpack('<H',parameters[:2])[0] == 13: # NetrServerGetInfo Request respParameters = smb.SMBNetServerGetInfoResponse() netServerInfo = smb.SMBNetServerInfo1() netServerInfo['ServerName'] = smbServer.getServerName() respData = netServerInfo.getData() respParameters['TotalBytesAvailable'] = len(respData) elif struct.unpack('<H',parameters[:2])[0] == 1: # NetrShareGetInfo Request request = smb.SMBNetShareGetInfo(parameters) respParameters = smb.SMBNetShareGetInfoResponse() shares = getShares(connId, smbServer) share = shares[request['ShareName'].upper()] shareInfo = smb.NetShareInfo1()  shareInfo['NetworkName'] = request['ShareName'].upper() + '\x00' shareInfo['Type'] = int(share['share type']) respData = shareInfo.getData() if 'comment' in share: shareInfo['RemarkOffsetLow'] = len(respData) respData += share['comment'] + '\x00' respParameters['TotalBytesAvailable'] = len(respData)  else: # We don't know how to handle anything else errorCode = STATUS\_NOT\_SUPPORTED
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def transactNamedPipe(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS SMBCommand = smb.SMBCommand(recvPacket['Data'][0]) transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Extract the FID fid = struct.unpack('<H', transParameters['Setup'][2:])[0]
 if fid in connData['OpenedFiles']: fileHandle = connData['OpenedFiles'][fid]['FileHandle'] if fileHandle != PIPE\_FILE\_DESCRIPTOR: os.write(fileHandle,data) respData = os.read(fileHandle,data) else: sock = connData['OpenedFiles'][fid]['Socket'] sock.send(data) respData = sock.recv(maxDataCount) else: errorCode = STATUS\_INVALID\_HANDLE
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the transaction2 handlersclass TRANS2Commands: # All these commands return setup, parameters, data, errorCode @staticmethod def setPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setPathInfoParameters = smb.SMBSetPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters) if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] fileName = decodeSMBString(recvPacket['Flags2'], setPathInfoParameters['FileName']) fileName = os.path.normpath(fileName.replace('\\','/')) if len(fileName) > 0 and (fileName[0] == '/' or fileName[0] == '\\') and path != '': # strip leading '/' fileName = fileName[1:] pathName = os.path.join(path,fileName) if os.path.exists(pathName): informationLevel = setPathInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) if mtime != -1 or atime != -1: os.utime(pathName,(atime,mtime)) else: smbServer.log('Unknown level for set path info! 0x%x' % setPathInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_OBJECT\_NAME\_NOT\_FOUND
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetPathInformationResponse\_Parameters()
 else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def setFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS setFileInfoParameters = smb.SMBSetFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if setFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileName'] informationLevel = setFileInfoParameters['InformationLevel'] if informationLevel == smb.SMB\_SET\_FILE\_DISPOSITION\_INFO: infoRecord = smb.SMBSetFileDispositionInfo(parameters) if infoRecord['DeletePending'] > 0: # Mark this file for removal after closed connData['OpenedFiles'][setFileInfoParameters['FID']]['DeleteOnClose'] = True respParameters = smb.SMBSetFileInformationResponse\_Parameters() elif informationLevel == smb.SMB\_SET\_FILE\_BASIC\_INFO: infoRecord = smb.SMBSetFileBasicInfo(data) # Creation time won't be set, the other ones we play with. atime = infoRecord['LastAccessTime'] if atime == 0: atime = -1 else: atime = getUnixTime(atime) mtime = infoRecord['LastWriteTime'] if mtime == 0: mtime = -1 else: mtime = getUnixTime(mtime) os.utime(fileName,(atime,mtime)) elif informationLevel == smb.SMB\_SET\_FILE\_END\_OF\_FILE\_INFO: fileHandle = connData['OpenedFiles'][setFileInfoParameters['FID']]['FileHandle'] infoRecord = smb.SMBSetFileEndOfFileInfo(data) if infoRecord['EndOfFile'] > 0: os.lseek(fileHandle, infoRecord['EndOfFile']-1, 0) os.write(fileHandle, b'\x00') else: smbServer.log('Unknown level for set file info! 0x%x' % setFileInfoParameters['InformationLevel'], logging.ERROR) # UNSUPPORTED errorCode = STATUS\_NOT\_SUPPORTED else: errorCode = STATUS\_NO\_SUCH\_FILE
 if errorCode == STATUS\_SUCCESS: respParameters = smb.SMBSetFileInformationResponse\_Parameters() else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFileInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b''
 queryFileInfoParameters = smb.SMBQueryFileInformation\_Parameters(parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: if queryFileInfoParameters['FID'] in connData['OpenedFiles']: fileName = connData['OpenedFiles'][queryFileInfoParameters['FID']]['FileName']
 infoRecord, errorCode = queryFileInformation('', fileName, queryFileInfoParameters['InformationLevel'])
 if infoRecord is not None: respParameters = smb.SMBQueryFileInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryPathInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = 0
 queryPathInfoParameters = smb.SMBQueryPathInformation\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path'] try: infoRecord, errorCode = queryPathInformation(path, decodeSMBString(recvPacket['Flags2'], queryPathInfoParameters['FileName']), queryPathInfoParameters['InformationLevel']) except Exception as e: smbServer.log("queryPathInformation: %s" % e,logging.ERROR)
 if infoRecord is not None: respParameters = smb.SMBQueryPathInformationResponse\_Parameters() respData = infoRecord else: errorCode = STATUS\_SMB\_BAD\_TID  smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def queryFsInformation(connId, smbServer, recvPacket, parameters, data, maxDataCount = 0): connData = smbServer.getConnectionData(connId) errorCode = 0 # Get the Tid associated if recvPacket['Tid'] in connData['ConnectedShares']: data = queryFsInformation(connData['ConnectedShares'][recvPacket['Tid']]['path'], '', struct.unpack('<H',parameters)[0], pktFlags = recvPacket['Flags2'])
 smbServer.setConnectionData(connId, connData)
 return b'',b'', data, errorCode
 @staticmethod def findNext2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' errorCode = STATUS\_SUCCESS findNext2Parameters = smb.SMBFindNext2\_Parameters(flags = recvPacket['Flags2'], data = parameters)
 sid = findNext2Parameters['SID'] if recvPacket['Tid'] in connData['ConnectedShares']: if sid in connData['SIDs']: searchResult = connData['SIDs'][sid] respParameters = smb.SMBFindNext2Response\_Parameters() endOfSearch = 1 searchCount = 1 totalData = 0 for i in enumerate(searchResult): data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) >= findNext2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data totalData += lenData  # Have we reached the end of the search or still stuff to send? if endOfSearch > 0: # Let's remove the SID from our ConnData del(connData['SIDs'][sid])
 respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else:  errorCode = STATUS\_INVALID\_HANDLE else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
 @staticmethod def findFirst2(connId, smbServer, recvPacket, parameters, data, maxDataCount): connData = smbServer.getConnectionData(connId)
 respSetup = b'' respParameters = b'' respData = b'' findFirst2Parameters = smb.SMBFindFirst2\_Parameters( recvPacket['Flags2'], data = parameters)
 if recvPacket['Tid'] in connData['ConnectedShares']: path = connData['ConnectedShares'][recvPacket['Tid']]['path']
 searchResult, searchCount, errorCode = findFirst2(path,  decodeSMBString( recvPacket['Flags2'], findFirst2Parameters['FileName'] ),  findFirst2Parameters['InformationLevel'],  findFirst2Parameters['SearchAttributes'] , pktFlags = recvPacket['Flags2'])
 respParameters = smb.SMBFindFirst2Response\_Parameters() endOfSearch = 1 sid = 0x80 # default SID searchCount = 0 totalData = 0 for i in enumerate(searchResult): #i[1].dump() data = i[1].getData() lenData = len(data) if (totalData+lenData) >= maxDataCount or (i[0]+1) > findFirst2Parameters['SearchCount']: # We gotta stop here and continue on a find\_next2 endOfSearch = 0 # Simple way to generate a fid if len(connData['SIDs']) == 0: sid = 1 else: sid = list(connData['SIDs'].keys())[-1] + 1 # Store the remaining search results in the ConnData SID connData['SIDs'][sid] = searchResult[i[0]:] respParameters['LastNameOffset'] = totalData break else: searchCount +=1 respData += data
 padLen = (8-(lenData % 8)) %8 respData += b'\xaa'\*padLen totalData += lenData + padLen
 respParameters['SID'] = sid respParameters['EndOfSearch'] = endOfSearch respParameters['SearchCount'] = searchCount else: errorCode = STATUS\_SMB\_BAD\_TID
 smbServer.setConnectionData(connId, connData)
 return respSetup, respParameters, respData, errorCode
# Here we implement the commands handlersclass SMBCommands:
 @staticmethod def smbTransaction(connId, smbServer, SMBCommand, recvPacket, transCommands): connData = smbServer.getConnectionData(connId)
 respSMBCommand = smb.SMBCommand(recvPacket['Command'])
 transParameters= smb.SMBTransaction\_Parameters(SMBCommand['Parameters'])
 # Do the stuff if transParameters['ParameterCount'] != transParameters['TotalParameterCount']: # TODO: Handle partial parameters  raise Exception("Unsupported partial parameters in TRANSACT2!") else: transData = smb.SMBTransaction\_SData(flags = recvPacket['Flags2']) # Standard says servers shouldn't trust Parameters and Data comes  # in order, so we have to parse the offsets, ugly
 paramCount = transParameters['ParameterCount'] transData['Trans\_ParametersLength'] = paramCount dataCount = transParameters['DataCount'] transData['Trans\_DataLength'] = dataCount transData.fromString(SMBCommand['Data']) if transParameters['ParameterOffset'] > 0: paramOffset = transParameters['ParameterOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Parameters'] = SMBCommand['Data'][paramOffset:paramOffset+paramCount] else: transData['Trans\_Parameters'] = b''
 if transParameters['DataOffset'] > 0: dataOffset = transParameters['DataOffset'] - 63 - transParameters['SetupLength'] transData['Trans\_Data'] = SMBCommand['Data'][dataOffset:dataOffset + dataCount] else:  transData['Trans\_Data'] = b''  # Call the handler for this TRANSACTION if transParameters['SetupCount'] == 0: # No subcommand, let's play with the Name command = decodeSMBString(recvPacket['Flags2'],transData['Name']) else: command = struct.unpack('<H', transParameters['Setup'][:2])[0]  if command in transCommands: # Call the TRANS subcommand setup = b'' parameters = b'' data = b'' try:  setup, parameters, data, errorCode = transCommands[command](connId, smbServer,  recvPacket,  transData['Trans\_Parameters'],  transData['Trans\_Data'], transParameters['MaxDataCount']) except Exception as e: #print 'Transaction: %s' % e,e smbServer.log('Transaction: (%r,%s)' % (command, e), logging.ERROR) errorCode = STATUS\_ACCESS\_DENIED #raise
 if setup == b'' and parameters == b'' and data == b'': # Something wen't wrong respParameters = b'' respData = b'' else: # Build the answer if hasattr(data, 'getData'): data = data.getData() remainingData = len(data) if hasattr(parameters, 'getData'): parameters = parameters.getData() remainingParameters = len(parameters) commands = [] dataDisplacement = 0 while remainingData > 0 or remainingParameters > 0:  respSMBCommand = smb.SMBCommand(recvPacket['Command']) respParameters = smb.SMBTransactionResponse\_Parameters() respData = smb.SMBTransaction2Response\_Data()
 respParameters['TotalParameterCount'] = len(parameters)[View remainder of file in raw view](https://github.com/fortra/impacket/raw/cb6d43a677c338db930bc4e9161620832c1ec624/impacket/smbserver.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


