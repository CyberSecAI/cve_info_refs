=== Content from kb.juniper.net_f8dbb57d_20250114_205502.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from www.juniper.net_f489119e_20250114_205503.html ===


X

![](https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg)

Help us improve your experience.

Let us know what you think.

Do you have time for a two-minute survey?

Yes

Maybe Later

Â
##### ON THIS PAGE

* [Configuring the General Authentication Service Trace Log Filename](#id-configuring-the-general-authentication-service-trace-log-filename)
* [Configuring the Number and Size of General Authentication Service
  Log Files](#id-configuring-the-number-and-size-of-general-authentication-service-log-files)
* [Configuring Access to the General Authentication Service Log
  File](#id-configuring-access-to-the-general-authentication-service-log-file)
* [Configuring a Regular Expression for General Authentication
  Service Messages to Be Logged](#id-configuring-a-regular-expression-for-general-authentication-service-messages-to-be-logged)
* [Configuring Subscriber Filtering for General Authentication
  Service Tracing](#id-configuring-subscriber-filtering-for-general-authentication-service-tracing)
* [Configuring the General Authentication Service Tracing Flags](#id-configuring-the-general-authentication-service-tracing-flags)
Â
# Tracing General Authentication Service (authd) Events for Troubleshooting

The Junos OS trace operations feature tracks
general authentication service operations and records events in a
log file. The error descriptions captured in the log file provide
detailed information to help you solve problems. The operations and
events are those associated with the authd process, which manages
the subscriber AAA infrastructure.

By default, nothing is traced. When you enable the tracing
operation, the default tracing behavior is as follows:

1. Important events are logged in a file located in the `/var/log` directory. By default, the router uses the filename, `authd`. You can specify a different filename, but you cannot
   change the directory (`/var/log`) in which trace files are
   located.
2. When the trace log file `filename` reaches 128Â kilobytes (KB), it is compressed and renamed `filename.0.gz`. Subsequent events are logged
   in a new file called `filename`, until
   it reaches capacity again. At this point, `filename.0.gz` is renamed `filename.1.gz` and `filename` is compressed and renamed `filename.0.gz`. This process repeats until
   the number of archived files reaches the maximum file number. Then
   the oldest trace fileâthe one with the highest numberâis
   overwritten.

   You can optionally specify the number of trace files to be from
   2 through 1000. You can also configure the maximum file size to be
   from 10 KB through 1 gigabyte (GB). For more information about how
   log files are created, see the [System Log Explorer](http://contentapps.juniper.net/syslog-explorer/).
3. By default, only the user who configures the tracing operation
   can access log files. You can optionally configure read-only access
   for all users.

The following topics describe how to configure all aspects of
tracing general authentication service operations:

## Configuring the General Authentication Service Trace Log Filename

By default, the name of the file that records trace output for
general authentication service is `authd`. You can specify
a different name by including the `file` statement at the `[edit system processes general-authentication-service]` hierarchy
level:

To configure the filename for general authentication
service tracing operations:

* Specify the name of the file used for the trace output.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set file aap_logfile_1

  ```

## Configuring the Number and Size of General Authentication Service Log Files

You can optionally specify the number of compressed, archived
trace log files to be from 2 through 1000. You can also configure
the maximum file size to be from 10 KB through 1 gigabyte (GB); the
default size is 128Â kilobytes (KB).

The archived files are differentiated by a suffix in the format `.number.gz`. The newest archived file is `.0.gz` and the oldest archived file is `.(maximum
number)-1.gz`. When the current trace log file reaches
the maximum size, it is compressed and renamed, and any existing archived
files are renamed. This process repeats until the maximum number of
archived files is reached, at which point the oldest file is overwritten.

For example, you can set the maximum file size to 2 MB, and
the maximum number of files to 20. When the file that receives the
output of the tracing operation, `filename`, reaches 2 MB, `filename` is
compressed and renamed `filename.0.gz`, and a new file called `filename` is
created. When the new `filename` reaches
2 MB, `filename.0.gz` is renamed `filename.1.gz` and `filename` is compressed and renamed `filename.0.gz`. This process repeats until there are 20 trace files.
Then the oldest file, `filename.19.gz`, is simply overwritten when the next oldest file, `filename.18.gz` is compressed and renamed to `filename.19.gz`.

To configure the number and size of trace files:

* Specify the name, number, and size of the file used for
  the trace output, by including the `files` and `size` options with the `traceoptions` statement.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set file aap_logfile_1 files 20 size 2097152

  ```

## Configuring Access to the General Authentication Service Log File

By default, log files can be accessed only by the user who configures
the tracing operation. You can allow all users to read the log file
and you can explicitly set the default behavior of the log file.

To specify that all users can read the log file:

* Configure the log file to be world-readable.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set file aap_logfile_1 world-readable

  ```

To explicitly set the default behavior, in which the
log file can only be read by the user who configured tracing:

* Configure the log file to be no-world-readable.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set file aap_logfile_1 no-world-readable

  ```

## Configuring a Regular Expression for General Authentication Service Messages to Be Logged

By default, the trace operation output includes all lines relevant
to the logged events. You can refine the output by including regular
expressions (regex) that will be matched.

To configure regular expressions to match:

* Configure the regular expression.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set file aap_logfile_1 match regular-expression

  ```

## Configuring Subscriber Filtering for General Authentication Service Tracing

Starting in Junos
OS Release 14.1, you can apply filters to the general authentication
service to limit tracing to particular subscribers or domains. Subscriber filtering simplifies troubleshooting in a scaled environment
by enabling you to focus on a reduced set of trace results.

For subscriber usernames that have the expected form of `user@domain`, you
can filter on the user, the domain, or both. You can use an asterisk
(\*) as a wildcard to substitute for characters at the beginning or
end of either term to match a greater number of subscribers.

Note:

You cannot filter results using a wildcard in the middle
of the user or domain terms. For example, the following uses of the
wildcard are not supported: tom\*25@example.com, tom125@ex\*.com.

When you enable filtering by username, traces that have insufficient
information to determine the username are automatically excluded.

To configure subscriber filtering:

* Specify the filter.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user user@domain

  ```

Consider the following examples of using the wildcard
for filtering:

* Filter results for the specific subscriber with the username,
  tom@example.com.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user tom@example.com

  ```
* Filter results for all subscribers whose username begins
  with tom.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user tom*

  ```
* Filter results for all subscribers whose username ends
  with tom.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user *tom

  ```
* Filter results for subscribers with the username tom at
  all domains beginning with ex.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user tom@ex*

  ```
* Filter results for all subscribers at all domains that
  end with ample.com.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user *ample.com

  ```
* Filter results for all subscribers whose username begins
  with tom at domains that end with example.com.

  ```
  [edit system processes general-authentication-service [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set filter user tom*@*example.com

  ```

## Configuring the General Authentication Service Tracing Flags

By default, only important events are logged. You can specify
which events and operations are logged by specifying one or more tracing
flags.

To configure the flags for the events to be logged:

* Configure the flags.

  ```
  [edit system services subscriber-management [traceoptions](../task/../../../cli-reference/topics/ref/statement/traceoptions-edit-system-processes.html)]
  user@host# set flag flag

  ```

### Related Documentation

* [AAA Service Framework Overview](../concept/aaa-service-framework-overview.html)
## Change History Table

Feature support is determined by the platform and release you are using. Use [Feature Explorer](https://apps.juniper.net/feature-explorer/) to determine if a feature is supported on your platform.

ReleaseDescription14.1Starting in Junos
OS Release 14.1, you can apply filters to the general authentication
service to limit tracing to particular subscribers or domains.Â Â
