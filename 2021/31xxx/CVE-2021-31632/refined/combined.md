=== Content from gist.github.com_2f1bf978_20250114_201407.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@Stacksmashers101](https://avatars.githubusercontent.com/u/82560476?s=64&v=4)](/Stacksmashers101)

# [Stacksmashers101](/Stacksmashers101)/**[sqli to rce](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe)**

Created
April 15, 2021 04:30

Show Gist options

* [Download ZIP](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe/archive/b0a298346396d183016fce0160c980a54b3851e3.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe.js&quot;&gt;&lt;/script&gt;
* Save Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe to your computer and use it in GitHub Desktop.

[Code](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe)
[Revisions
1](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe.js&quot;&gt;&lt;/script&gt;

Save Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe to your computer and use it in GitHub Desktop.

[Download ZIP](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe/archive/b0a298346396d183016fce0160c980a54b3851e3.zip)

 [Raw](/Stacksmashers101/c6b9ea92f42c23473170bb3acc8fc5fe/raw/b0a298346396d183016fce0160c980a54b3851e3/sqli%2520to%2520rce)

[**sqli to rce**](#file-sqli-to-rce)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | Injection attacks occur when data is sent to an interpreter which contain unintended commands with the data that are run by the interpreter. The most common injection flaw in web applications are SQL, but it is also possible to have injection flaws effect LDAP queries, XPath queries, and OS commands. We are going to cover SQL injections, but the techniques used to validate and control the input to the SQL interpreter are applicable to the other types of injections. |
| --- | --- |
|  | the same can be performed in b2evolution CMS 7.2.3 in the User Registration section, leading to remote code execution via SQL Injection (SQLi) |
|  | In the earlier Database chapter you saw the use of the cfqueryparam tag. It is one of the simplest steps you can take to help prevent SQL injection attacks on your web application, but it can only be used in the WHERE clause, INSERT values, and UPDATE values of an SQL statement. Other parts of an SQL statement require more work to protect against it. The example below is using cfqueryparam, but it is still susceptible to SQL injection attack through the ORDER BY clause. |
|  |  |
|  | <cfparam name="url.state" default="" /> |
|  | <cfparam name="url.orderby" default="LASTNAME" /> |
|  | <cfquery name="request.listing" datasource="cfartgallery"> |
|  | SELECT FIRSTNAME, LASTNAME, EMAIL, THEPASSWORD, ADDRESS |
|  | FROM table |
|  | WHERE 1=1 |
|  | <cfif Len(url.state)> |
|  | AND STATE = <cfqueryparam cfsqltype="cf\_sql\_varchar" value="#url.state#" /> |
|  | </cfif> |
|  | ORDER BY #url.orderby# |
|  | </cfquery> |
|  |  |
|  | By validating the URL parameters against a list of values we know to be good while changing all references from the URL scoped variables to variables we explicitly set, the SQL injection vulnerability is removed. The cfparam's were also removed because they are now redundant from the use of StructKeyExists() in the if statements. |
|  |  |
|  | <cfscript> |
|  | // list of valid values |
|  | variables.validStates = "CA,CO,DC,FL,GA,NM,NY,OK,SD"; |
|  | // check what was passed against list of valid values |
|  | if ( StructKeyExists(url, "state") AND ListFind(variables.validStates, url.state) ) { |
|  | variables.state = url.state; |
|  | } else { |
|  | variables.state = ""; |
|  | } |
|  |  |
|  | if ( StructKeyExists(url, "orderby") AND ListFind(variables.validOrderBys, url.orderby) ) { |
|  | variables.orderby = url.orderby; |
|  | } else { |
|  | variables.orderby = "LASTNAME"; |
|  | } |
|  |  |
|  | </cfscript> |
|  |  |
|  | While the above code removes the SQL injection, it can be made better. First, remove the hard coded list of States and reuse the query used to generate the list of States for the filter in the validation. Next, change the ‘Order By’ values from columns used in the database to a structure that references them. While this example has some pretty common and guessable columns names, the main purpose is to make it more difficult for an attacker to get knowledge of the database structure the web application is using. |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FStacksmashers101%2Fc6b9ea92f42c23473170bb3acc8fc5fe)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


