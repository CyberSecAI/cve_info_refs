=== Content from rustsec.org_aebae144_20250114_233928.html ===


RUSTSEC-2021-0072: tokio: Task dropped in wrong thread when aborting `LocalSet` task › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/tokio/RUSTSEC-2021-0072.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/tokio/RUSTSEC-2021-0072.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0072)

# RUSTSEC-2021-0072

Task dropped in wrong thread when aborting `LocalSet` task

Reported
July 7, 2021

Issued
July 8, 2021

(last modified: June 13, 2023)

Package
[tokio](/packages/tokio.html)
([crates.io](https://crates.io/crates/tokio))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#race-condition](/keywords/race-condition.html)
[#send](/keywords/send.html)

Aliases

* [CVE-2021-38191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-38191)
* [GHSA-2grh-hm3w-w7hv](https://github.com/advisories/GHSA-2grh-hm3w-w7hv)

References

* <https://github.com/tokio-rs/tokio/issues/3929>

Patched

* `>=1.5.1, <1.6.0`
* `>=1.6.3, <1.7.0`
* `>=1.7.2, <1.8.0`
* `>=1.8.1`

Unaffected

* `<0.3.0`

Affected Functions
Version
`tokio::task::JoinHandle::abort`

* `<=1.8.0, >=0.3.0`

### Description

When aborting a task with `JoinHandle::abort`, the future is dropped in the
thread calling abort if the task is not currently being executed. This is
incorrect for tasks spawned on a `LocalSet`.

This can easily result in race conditions as many projects use `Rc` or `RefCell`
in their Tokio tasks for better performance.

See [tokio#3929](https://github.com/tokio-rs/tokio/issues/3929) for more details.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.



=== Content from raw.githubusercontent.com_405d572d_20250114_233926.html ===
```toml
[advisory]
id = "RUSTSEC-2021-0072"
package = "tokio"
date = "2021-07-07"
url = "https://github.com/tokio-rs/tokio/issues/3929"
categories = ["memory-corruption"]
keywords = ["race condition", "send"]
aliases = ["CVE-2021-38191", "GHSA-2grh-hm3w-w7hv"]
[affected]
functions = { "tokio::task::JoinHandle::abort" = ["<= 1.8.0, >= 0.3.0"] }
[versions]
patched = [">= 1.5.1, < 1.6.0", ">= 1.6.3, < 1.7.0", ">= 1.7.2, < 1.8.0", ">= 1.8.1"]
unaffected = ["< 0.3.0"]
```
# Task dropped in wrong thread when aborting `LocalSet` task
When aborting a task with `JoinHandle::abort`, the future is dropped in the
thread calling abort if the task is not currently being executed. This is
incorrect for tasks spawned on a `LocalSet`.
This can easily result in race conditions as many projects use `Rc` or `RefCell`
in their Tokio tasks for better performance.
See [tokio#3929][issue] for more details.
[issue]: https://github.com/tokio-rs/tokio/issues/3929

