=== Content from lists.debian.org_2d033f0f_20250114_194258.html ===


---

[[Date Prev](msg00006.html)][[Date Next](msg00008.html)]
[[Thread Prev](msg00006.html)][[Thread Next](msg00008.html)]
[[Date Index](maillist.html#00007)]
[[Thread Index](threads.html#00007)]

# [SECURITY] [DLA 3445-1] cpio security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3445-1] cpio security update
* *From*: Adrian Bunk <bunk@debian.org>
* *Date*: Sun, 4 Jun 2023 23:12:22 +0300
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/ZHzwJtTsMM5bA9p0%40localhost)Â [ZHzwJtTsMM5bA9p0@localhost](msg00007.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3445-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Adrian Bunk
June 04, 2023                                 <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : cpio
Version        : 2.12+dfsg-9+deb10u1
CVE ID         : CVE-2019-14866 CVE-2021-38185
Debian Bug     : 941412 992045

Two vulnerabilities were fixed in GNU cpio, a program to manage
archives of files.

CVE-2019-14866

    Improper validation of input files when generatingtar archives.

CVE-2021-38185

    Arbitrary code via crafted pattern file.

For Debian 10 buster, these problems have been fixed in version
2.12+dfsg-9+deb10u1.

We recommend that you upgrade your cpio packages.

For the detailed security status of cpio please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/cpio>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEOvp1f6xuoR0v9F3wiNJCh6LYmLEFAmR88CIACgkQiNJCh6LY
mLFEnw//dJUPmrc9TF3gc0O8DcOf7y1dre2POsQzNm3NVBFsewVro5EM61s3pQAE
dt6k3wY5fxEzlu63ul8/ADPhKDWFhmOY2lUznxG9svjC/yVFFeFQXPLc/PAyqsrm
DezOIsi/WCCCtOLjrdeRera19urF9/lc70ANdIEgN4MmH1YG2tOk/c2Jd3SQMHpF
8RzYcPCCQB3+7YcMtei++WSxNaFT8ELWxIE6B6rDnpTps3whFQhDAfkNWmId+yUG
6UB6fO0HsqY3oRyEx4oatpYM+ua9xPDf6ydV3mIbOwV6TgcwjglVgeoP08Rzpwto
w7dNQoM9WKrzPxXgB8hiRXzPPW70/vtQ7kd+J1ygDVhSl4QXEtPoTyva5eXb4KMR
WWAbi0uG7nznI6iJ0Z/3egS3yY5Jh7s+BH14t74wnZ8zVp6HCO16Lpyyo48F30em
CkBXxbpfzBFdRv1anK0GdIcB/Kt2poPYiCjZxvlyzvwMYwJfVnKEH5hwekbvxrnc
EEEHiDRU2vIZs5vHikYQDWenTRqX7XnuzIvFJYV/lYKvtwPuUZS4cC+F1a3SDSZV
OKmiCr+GLtjbngYQUZKasibYd3a6ePH89loOWA9e/jbkG2LpJwhy7e74SqrGsVLS
qHzOeW5su6Nn+ETBIoZ6CRrsF5p5ZprAjofnOkS0lRjFh/pXw8c=
=j8tT
-----END PGP SIGNATURE-----

```

---



=== Content from lists.gnu.org_6388bf00_20250114_194259.html ===


| | **bug-cpio** | | --- | |
| --- | --- |

[[Top](../)][[All Lists](/archive/html)]

[Advanced](/archive/cgi-bin/namazu.cgi?idxname=bug-cpio)

---

[[Date Prev](msg00001.html)][[Date Next](msg00003.html)][[Thread Prev](msg00001.html)][[Thread Next](msg00004.html)][[Date Index](index.html#00002)][[Thread Index](threads.html#00002)]

## Re: cpio RCE Exploit Caused by Integer Overflow

---

| **From**: | Sergey Poznyakoff |
| --- | --- |

| **Subject**: | Re: cpio RCE Exploit Caused by Integer Overflow |
| **Date**: | Sat, 07 Aug 2021 12:02:30 +0200 |

---

```
Thank you.  Fixed in dd96882877721703e19272fe25034560b794061b.

Regards,
Sergey

```

---

reply via email to

---

| [[Prev in Thread](msg00001.html)] | **Current Thread** | [[Next in Thread](msg00004.html)] |
| --- | --- | --- |

* **[cpio RCE Exploit Caused by Integer Overflow](msg00000.html)**, *Maverick Chung*, 2021/08/06
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**, *Maverick Chung*, 2021/08/06
  + **Re: cpio RCE Exploit Caused by Integer Overflow**,
    *Sergey Poznyakoff*Â **<=**
    - **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00004.html)**, *Salvatore Bonaccorso*, 2021/08/11
      * **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00003.html)**, *Sergey Poznyakoff*, 2021/08/11
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00008.html)**, *Juerg Haefliger*, 2021/08/17
    - **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00007.html)**, *Sergey Poznyakoff*, 2021/08/17
      * **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00010.html)**, *Salvatore Bonaccorso*, 2021/08/21* **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00011.html)**, *Sergey Poznyakoff*, 2021/08/21* **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00012.html)**, *Salvatore Bonaccorso*, 2021/08/21
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00009.html)**, *Diederik de Haas*, 2021/08/17

---

* Prev by Date:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**
* Next by Date:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00003.html)**
* Previous by thread:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**
* Next by thread:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00004.html)**
* Index(es):
  + [**Date**](index.html#00002)
  + [**Thread**](threads.html#00002)



=== Content from lists.gnu.org_3cd9d32e_20250114_194259.html ===


| | **bug-cpio** | | --- | |
| --- | --- |

[[Top](../)][[All Lists](/archive/html)]

[Advanced](/archive/cgi-bin/namazu.cgi?idxname=bug-cpio)

---

[Date Prev][[Date Next](msg00001.html)][Thread Prev][[Thread Next](msg00001.html)][[Date Index](index.html#00000)][[Thread Index](threads.html#00000)]

## cpio RCE Exploit Caused by Integer Overflow

---

| **From**: | Maverick Chung |
| --- | --- |

| **Subject**: | cpio RCE Exploit Caused by Integer Overflow |
| **Date**: | Fri, 6 Aug 2021 20:15:00 +0000 |

---

| Hello,   Qiaoyi Fang (cc'ed) and I are both CS students at Duke, and we've discovered an RCE exploit in cpio, caused by an integer overflow in *ds\_fgetstr*. We've created the exploit on cpio 2.13, on the version the current kali-rolling. We've attached a bug report containing all the details, as well as the files necessary to reproduce the exploit. Additionally, we've recorded the exploit here: <https://youtu.be/F0yKJhu7Vak>.    Please let us know if you have any questions. Thank you!   Sincerely, Maverick Chung and Qiaoyi Fang |
| --- |

**[![Attachment:](/icons/compressed.png)](zipqrkbUoUc15.zip)
[cpiopwn-files.zip](zipqrkbUoUc15.zip)**

*Description:* cpiopwn-files.zip

**[![Attachment:](/icons/pdf.png)](pdfxOgaWPRm0N.pdf)
[cpio-bug-report.pdf](pdfxOgaWPRm0N.pdf)**

*Description:* cpio-bug-report.pdf

---

reply via email to

---

| [Prev in Thread] | **Current Thread** | [[Next in Thread](msg00001.html)] |
| --- | --- | --- |

* **cpio RCE Exploit Caused by Integer Overflow**,
  *Maverick Chung*Â **<=**
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**, *Maverick Chung*, 2021/08/06
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00002.html)**, *Sergey Poznyakoff*, 2021/08/07
    - **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00004.html)**, *Salvatore Bonaccorso*, 2021/08/11
      * **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00003.html)**, *Sergey Poznyakoff*, 2021/08/11
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00008.html)**, *Juerg Haefliger*, 2021/08/17
    - **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00007.html)**, *Sergey Poznyakoff*, 2021/08/17
      * **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00010.html)**, *Salvatore Bonaccorso*, 2021/08/21* **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00011.html)**, *Sergey Poznyakoff*, 2021/08/21* **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00012.html)**, *Salvatore Bonaccorso*, 2021/08/21
  + **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00009.html)**, *Diederik de Haas*, 2021/08/17

---

* Next by Date:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**
* Next by thread:
  **[Re: cpio RCE Exploit Caused by Integer Overflow](msg00001.html)**
* Index(es):
  + [**Date**](index.html#00000)
  + [**Thread**](threads.html#00000)



=== Content from git.savannah.gnu.org_0462f205_20250114_194257.html ===


| [cgit logo](/cgit/) | [index](/cgit/) : [cpio.git](/cgit/cpio.git/ "cpio.git") | alpha-2\_50\_90 literate master |
| --- | --- | --- |
| GNU cpio |  |

| [summary](/cgit/cpio.git/)[refs](/cgit/cpio.git/refs/?id=dd96882877721703e19272fe25034560b794061b)[log](/cgit/cpio.git/log/)[tree](/cgit/cpio.git/tree/?id=dd96882877721703e19272fe25034560b794061b)[commit](/cgit/cpio.git/commit/?id=dd96882877721703e19272fe25034560b794061b)[diff](/cgit/cpio.git/diff/?id=dd96882877721703e19272fe25034560b794061b) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergey Poznyakoff <gray@gnu.org> | 2021-08-07 12:52:21 +0300 |
| --- | --- | --- |
| committer | Sergey Poznyakoff <gray@gnu.org> | 2021-08-07 12:52:21 +0300 |
| commit | [dd96882877721703e19272fe25034560b794061b](/cgit/cpio.git/commit/?id=dd96882877721703e19272fe25034560b794061b) ([patch](/cgit/cpio.git/patch/?id=dd96882877721703e19272fe25034560b794061b)) | |
| tree | [2d81f2521f55cf3d82e7305d1475be9c8c1e0812](/cgit/cpio.git/tree/?id=dd96882877721703e19272fe25034560b794061b) | |
| parent | [269d2040a62e45a35d7f5eef3e868813d44213c0](/cgit/cpio.git/commit/?id=269d2040a62e45a35d7f5eef3e868813d44213c0) ([diff](/cgit/cpio.git/diff/?id=dd96882877721703e19272fe25034560b794061b&id2=269d2040a62e45a35d7f5eef3e868813d44213c0)) | |
| download | [cpio-dd96882877721703e19272fe25034560b794061b.tar.gz](/cgit/cpio.git/snapshot/cpio-dd96882877721703e19272fe25034560b794061b.tar.gz) | |

Rewrite dynamic string support.\* src/dstring.c (ds\_init): Take a single argument.
(ds\_free): New function.
(ds\_resize): Take a single argument. Use x2nrealloc to expand
the storage.
(ds\_reset,ds\_append,ds\_concat,ds\_endswith): New function.
(ds\_fgetstr): Rewrite. In particular, this fixes integer overflow.
\* src/dstring.h (dynamic\_string): Keep both the allocated length
(ds\_size) and index of the next free byte in the string (ds\_idx).
(ds\_init,ds\_resize): Change signature.
(ds\_len): New macro.
(ds\_free,ds\_reset,ds\_append,ds\_concat,ds\_endswith): New protos.
\* src/copyin.c: Use new ds\_ functions.
\* src/copyout.c: Likewise.
\* src/copypass.c: Likewise.
\* src/util.c: Likewise.
[Diffstat](/cgit/cpio.git/diff/?id=dd96882877721703e19272fe25034560b794061b)

| -rw-r--r-- | [src/copyin.c](/cgit/cpio.git/diff/src/copyin.c?id=dd96882877721703e19272fe25034560b794061b) | 40 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [src/copyout.c](/cgit/cpio.git/diff/src/copyout.c?id=dd96882877721703e19272fe25034560b794061b) | 16 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [src/copypass.c](/cgit/cpio.git/diff/src/copypass.c?id=dd96882877721703e19272fe25034560b794061b) | 34 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [src/dstring.c](/cgit/cpio.git/diff/src/dstring.c?id=dd96882877721703e19272fe25034560b794061b) | 88 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [src/dstring.h](/cgit/cpio.git/diff/src/dstring.h?id=dd96882877721703e19272fe25034560b794061b) | 31 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [src/util.c](/cgit/cpio.git/diff/src/util.c?id=dd96882877721703e19272fe25034560b794061b) | 6 | |  |  |  | | --- | --- | --- | |

6 files changed, 123 insertions, 92 deletions

| diff --git a/src/copyin.c b/src/copyin.cindex a096048..4fb14af 100644--- a/[src/copyin.c](/cgit/cpio.git/tree/src/copyin.c?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/copyin.c](/cgit/cpio.git/tree/src/copyin.c?id=dd96882877721703e19272fe25034560b794061b)@@ -55,11 +55,12 @@ query\_rename(struct cpio\_file\_stat\* file\_hdr, FILE \*tty\_in, FILE \*tty\_out, char \*str\_res; /\* Result for string function. \*/ static dynamic\_string new\_name; /\* New file name for rename option. \*/ static int initialized\_new\_name = false;+ if (!initialized\_new\_name)- {- ds\_init (&new\_name, 128);- initialized\_new\_name = true;- }+ {+ ds\_init (&new\_name);+ initialized\_new\_name = true;+ }  if (rename\_flag) {@@ -780,37 +781,36 @@ long\_format (struct cpio\_file\_stat \*file\_hdr, char const \*link\_name) already in `save\_patterns' (from the command line) are preserved. \*/  static void-read\_pattern\_file ()+read\_pattern\_file (void) {- int max\_new\_patterns;- char \*\*new\_save\_patterns;- int new\_num\_patterns;+ char \*\*new\_save\_patterns = NULL;+ size\_t max\_new\_patterns;+ size\_t new\_num\_patterns; int i;- dynamic\_string pattern\_name;+ dynamic\_string pattern\_name = DYNAMIC\_STRING\_INITIALIZER; FILE \*pattern\_fp;  if (num\_patterns < 0) num\_patterns = 0;- max\_new\_patterns = 1 + num\_patterns;- new\_save\_patterns = (char \*\*) xmalloc (max\_new\_patterns \* sizeof (char \*)); new\_num\_patterns = num\_patterns;- ds\_init (&pattern\_name, 128);+ max\_new\_patterns = num\_patterns;+ new\_save\_patterns = xcalloc (max\_new\_patterns, sizeof (new\_save\_patterns[0]));  pattern\_fp = fopen (pattern\_file\_name, "r"); if (pattern\_fp == NULL) open\_fatal (pattern\_file\_name); while (ds\_fgetstr (pattern\_fp, &pattern\_name, '\n') != NULL) {- if (new\_num\_patterns >= max\_new\_patterns)- {- max\_new\_patterns += 1;- new\_save\_patterns = (char \*\*)- xrealloc ((char \*) new\_save\_patterns,- max\_new\_patterns \* sizeof (char \*));- }+ if (new\_num\_patterns == max\_new\_patterns)+ new\_save\_patterns = x2nrealloc (new\_save\_patterns,+ &max\_new\_patterns,+ sizeof (new\_save\_patterns[0])); new\_save\_patterns[new\_num\_patterns] = xstrdup (pattern\_name.ds\_string); ++new\_num\_patterns; }++ ds\_free (&pattern\_name);+  if (ferror (pattern\_fp) || fclose (pattern\_fp) == EOF) close\_error (pattern\_file\_name); @@ -1210,7 +1210,7 @@ swab\_array (char \*ptr, int count) in the file system. \*/  void-process\_copy\_in ()+process\_copy\_in (void) { FILE \*tty\_in = NULL; /\* Interactive file for rename option. \*/ FILE \*tty\_out = NULL; /\* Interactive file for rename option. \*/diff --git a/src/copyout.c b/src/copyout.cindex 5ca587f..ca6798c 100644--- a/[src/copyout.c](/cgit/cpio.git/tree/src/copyout.c?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/copyout.c](/cgit/cpio.git/tree/src/copyout.c?id=dd96882877721703e19272fe25034560b794061b)@@ -594,9 +594,10 @@ assign\_string (char \*\*pvar, char \*value) The format of the header depends on the compatibility (-c) flag. \*/  void-process\_copy\_out ()+process\_copy\_out (void) {- dynamic\_string input\_name; /\* Name of file read from stdin. \*/+ dynamic\_string input\_name = DYNAMIC\_STRING\_INITIALIZER;+ /\* Name of file read from stdin. \*/ struct stat file\_stat; /\* Stat record for file. \*/ struct cpio\_file\_stat file\_hdr = CPIO\_FILE\_STAT\_INITIALIZER; /\* Output header information. \*/@@ -605,7 +606,6 @@ process\_copy\_out () char \*orig\_file\_name = NULL;  /\* Initialize the copy out. \*/- ds\_init (&input\_name, 128); file\_hdr.c\_magic = 070707;  /\* Check whether the output file might be a tape. \*/@@ -657,14 +657,9 @@ process\_copy\_out () { if (file\_hdr.c\_mode & CP\_IFDIR) {- int len = strlen (input\_name.ds\_string); /\* Make sure the name ends with a slash \*/- if (input\_name.ds\_string[len-1] != '/')- {- ds\_resize (&input\_name, len + 2);- input\_name.ds\_string[len] = '/';- input\_name.ds\_string[len+1] = 0;- }+ if (!ds\_endswith (&input\_name, '/'))+ ds\_append (&input\_name, '/'); } } @@ -875,6 +870,7 @@ process\_copy\_out () (unsigned long) blocks), (unsigned long) blocks); } cpio\_file\_stat\_free (&file\_hdr);+ ds\_free (&input\_name); }  diff --git a/src/copypass.c b/src/copypass.cindex 5d5e939..23ee687 100644--- a/[src/copypass.c](/cgit/cpio.git/tree/src/copypass.c?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/copypass.c](/cgit/cpio.git/tree/src/copypass.c?id=dd96882877721703e19272fe25034560b794061b)@@ -48,10 +48,12 @@ set\_copypass\_perms (int fd, const char \*name, struct stat \*st) If `link\_flag', link instead of copying. \*/  void-process\_copy\_pass ()+process\_copy\_pass (void) {- dynamic\_string input\_name; /\* Name of file from stdin. \*/- dynamic\_string output\_name; /\* Name of new file. \*/+ dynamic\_string input\_name = DYNAMIC\_STRING\_INITIALIZER;+ /\* Name of file from stdin. \*/+ dynamic\_string output\_name = DYNAMIC\_STRING\_INITIALIZER;+ /\* Name of new file. \*/ size\_t dirname\_len; /\* Length of `directory\_name'. \*/ int res; /\* Result of functions. \*/ char \*slash; /\* For moving past slashes in input name. \*/@@ -65,25 +67,18 @@ process\_copy\_pass () created files \*/  /\* Initialize the copy pass. \*/- ds\_init (&input\_name, 128);  dirname\_len = strlen (directory\_name); if (change\_directory\_option && !ISSLASH (directory\_name[0])) { char \*pwd = xgetcwd ();-- dirname\_len += strlen (pwd) + 1;- ds\_init (&output\_name, dirname\_len + 2);- strcpy (output\_name.ds\_string, pwd);- strcat (output\_name.ds\_string, "/");- strcat (output\_name.ds\_string, directory\_name);+ + ds\_concat (&output\_name, pwd);+ ds\_append (&output\_name, '/'); }- else- {- ds\_init (&output\_name, dirname\_len + 2);- strcpy (output\_name.ds\_string, directory\_name);- }- output\_name.ds\_string[dirname\_len] = '/';+ ds\_concat (&output\_name, directory\_name);+ ds\_append (&output\_name, '/');+ dirname\_len = ds\_len (&output\_name); output\_is\_seekable = true;  change\_dir ();@@ -116,8 +111,8 @@ process\_copy\_pass () /\* Make the name of the new file. \*/ for (slash = input\_name.ds\_string; \*slash == '/'; ++slash) ;- ds\_resize (&output\_name, dirname\_len + strlen (slash) + 2);- strcpy (output\_name.ds\_string + dirname\_len + 1, slash);+ ds\_reset (&output\_name, dirname\_len);+ ds\_concat (&output\_name, slash);  existing\_dir = false; if (lstat (output\_name.ds\_string, &out\_file\_stat) == 0)@@ -333,6 +328,9 @@ process\_copy\_pass () (unsigned long) blocks), (unsigned long) blocks); }++ ds\_free (&input\_name);+ ds\_free (&output\_name); }  /\* Try and create a hard link from FILE\_NAME to another file diff --git a/src/dstring.c b/src/dstring.cindex b261d5a..692d3e7 100644--- a/[src/dstring.c](/cgit/cpio.git/tree/src/dstring.c?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/dstring.c](/cgit/cpio.git/tree/src/dstring.c?id=dd96882877721703e19272fe25034560b794061b)@@ -20,8 +20,8 @@ #if defined(HAVE\_CONFIG\_H) # include <config.h> #endif- #include <stdio.h>+#include <stdlib.h> #if defined(HAVE\_STRING\_H) || defined(STDC\_HEADERS) #include <string.h> #else@@ -33,24 +33,41 @@ /\* Initialiaze dynamic string STRING with space for SIZE characters. \*/  void-ds\_init (dynamic\_string \*string, int size)+ds\_init (dynamic\_string \*string)+{+ memset (string, 0, sizeof \*string);+}++/\* Free the dynamic string storage. \*/++void+ds\_free (dynamic\_string \*string) {- string->ds\_length = size;- string->ds\_string = (char \*) xmalloc (size);+ free (string->ds\_string); } -/\* Expand dynamic string STRING, if necessary, to hold SIZE characters. \*/+/\* Expand dynamic string STRING, if necessary. \*/  void-ds\_resize (dynamic\_string \*string, int size)+ds\_resize (dynamic\_string \*string) {- if (size > string->ds\_length)+ if (string->ds\_idx == string->ds\_size) {- string->ds\_length = size;- string->ds\_string = (char \*) xrealloc ((char \*) string->ds\_string, size);+ string->ds\_string = x2nrealloc (string->ds\_string, &string->ds\_size,+ 1); } } +/\* Reset the index of the dynamic string S to LEN. \*/++void+ds\_reset (dynamic\_string \*s, size\_t len)+{+ while (len > s->ds\_size)+ ds\_resize (s);+ s->ds\_idx = len;+}+ /\* Dynamic string S gets a string terminated by the EOS character (which is removed) from file F. S will increase in size during the function if the string from F is longer than@@ -61,34 +78,50 @@ ds\_resize (dynamic\_string \*string, int size) char \* ds\_fgetstr (FILE \*f, dynamic\_string \*s, char eos) {- int insize; /\* Amount needed for line. \*/- int strsize; /\* Amount allocated for S. \*/ int next\_ch;  /\* Initialize. \*/- insize = 0;- strsize = s->ds\_length;+ s->ds\_idx = 0;  /\* Read the input string. \*/- next\_ch = getc (f);- while (next\_ch != eos && next\_ch != EOF)+ while ((next\_ch = getc (f)) != eos && next\_ch != EOF) {- if (insize >= strsize - 1)- {- ds\_resize (s, strsize \* 2 + 2);- strsize = s->ds\_length;- }- s->ds\_string[insize++] = next\_ch;- next\_ch = getc (f);+ ds\_resize (s);+ s->ds\_string[s->ds\_idx++] = next\_ch; }- s->ds\_string[insize++] = '\0';+ ds\_resize (s);+ s->ds\_string[s->ds\_idx] = '\0'; - if (insize == 1 && next\_ch == EOF)+ if (s->ds\_idx == 0 && next\_ch == EOF) return NULL; else return s->ds\_string; } +void+ds\_append (dynamic\_string \*s, int c)+{+ ds\_resize (s);+ s->ds\_string[s->ds\_idx] = c;+ if (c)+ {+ s->ds\_idx++;+ ds\_resize (s);+ s->ds\_string[s->ds\_idx] = 0;+ } +}++void+ds\_concat (dynamic\_string \*s, char const \*str)+{+ size\_t len = strlen (str);+ while (len + 1 > s->ds\_size)+ ds\_resize (s);+ memcpy (s->ds\_string + s->ds\_idx, str, len);+ s->ds\_idx += len;+ s->ds\_string[s->ds\_idx] = 0;+}+ char \* ds\_fgets (FILE \*f, dynamic\_string \*s) {@@ -100,3 +133,10 @@ ds\_fgetname (FILE \*f, dynamic\_string \*s) { return ds\_fgetstr (f, s, '\0'); }++/\* Return true if the dynamic string S ends with character C. \*/+int+ds\_endswith (dynamic\_string \*s, int c)+{+ return (s->ds\_idx > 0 && s->ds\_string[s->ds\_idx - 1] == c);+}diff --git a/src/dstring.h b/src/dstring.hindex 5d24181..ca7a5f1 100644--- a/[src/dstring.h](/cgit/cpio.git/tree/src/dstring.h?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/dstring.h](/cgit/cpio.git/tree/src/dstring.h?id=dd96882877721703e19272fe25034560b794061b)@@ -17,10 +17,6 @@ Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. \*/ -#ifndef NULL-#define NULL 0-#endif- /\* A dynamic string consists of record that records the size of an allocated string and the pointer to that string. The actual string is a normal zero byte terminated string that can be used with the@@ -30,22 +26,25 @@  typedef struct {- int ds\_length; /\* Actual amount of storage allocated. \*/- char \*ds\_string; /\* String. \*/+ size\_t ds\_size; /\* Actual amount of storage allocated. \*/+ size\_t ds\_idx; /\* Index of the next free byte in the string. \*/+ char \*ds\_string; /\* String storage. \*/ } dynamic\_string; +#define DYNAMIC\_STRING\_INITIALIZER { 0, 0, NULL } -/\* Macros that look similar to the original string functions.- WARNING: These macros work only on pointers to dynamic string records.- If used with a real record, an "&" must be used to get the pointer. \*/-#define ds\_strlen(s) strlen ((s)->ds\_string)-#define ds\_strcmp(s1, s2) strcmp ((s1)->ds\_string, (s2)->ds\_string)-#define ds\_strncmp(s1, s2, n) strncmp ((s1)->ds\_string, (s2)->ds\_string, n)-#define ds\_index(s, c) index ((s)->ds\_string, c)-#define ds\_rindex(s, c) rindex ((s)->ds\_string, c)+void ds\_init (dynamic\_string \*string);+void ds\_free (dynamic\_string \*string);+void ds\_reset (dynamic\_string \*s, size\_t len); -void ds\_init (dynamic\_string \*string, int size);-void ds\_resize (dynamic\_string \*string, int size);+/\* All functions below guarantee that s->ds\_string[s->ds\_idx] == '\0' \*/ char \*ds\_fgetname (FILE \*f, dynamic\_string \*s); char \*ds\_fgets (FILE \*f, dynamic\_string \*s); char \*ds\_fgetstr (FILE \*f, dynamic\_string \*s, char eos);+void ds\_append (dynamic\_string \*s, int c);+void ds\_concat (dynamic\_string \*s, char const \*str);++#define ds\_len(s) ((s)->ds\_idx)++int ds\_endswith (dynamic\_string \*s, int c);+diff --git a/src/util.c b/src/util.cindex 996d4fa..ff2746d 100644--- a/[src/util.c](/cgit/cpio.git/tree/src/util.c?id=269d2040a62e45a35d7f5eef3e868813d44213c0)+++ b/[src/util.c](/cgit/cpio.git/tree/src/util.c?id=dd96882877721703e19272fe25034560b794061b)@@ -846,11 +846,9 @@ get\_next\_reel (int tape\_des) FILE \*tty\_out; /\* File for interacting with user. \*/ int old\_tape\_des; char \*next\_archive\_name;- dynamic\_string new\_name;+ dynamic\_string new\_name = DYNAMIC\_STRING\_INITIALIZER; char \*str\_res; - ds\_init (&new\_name, 128);- /\* Open files for interactive communication. \*/ tty\_in = fopen (TTY\_NAME, "r"); if (tty\_in == NULL)@@ -925,7 +923,7 @@ get\_next\_reel (int tape\_des) error (PAXEXIT\_FAILURE, 0, \_("internal error: tape descriptor changed from %d to %d"), old\_tape\_des, tape\_des); - free (new\_name.ds\_string);+ ds\_free (&new\_name); fclose (tty\_in); fclose (tty\_out); } |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-14 19:42:56 +0000



=== Content from github.com_7f704220_20250114_194258.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffangqyi%2Fcpiopwn)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffangqyi%2Fcpiopwn)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=fangqyi%2Fcpiopwn)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fangqyi](/fangqyi)
/
**[cpiopwn](/fangqyi/cpiopwn)**
Public

* [Notifications](/login?return_to=%2Ffangqyi%2Fcpiopwn) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2Ffangqyi%2Fcpiopwn)
* [Star
   3](/login?return_to=%2Ffangqyi%2Fcpiopwn)

ACE poc exploit for glibc cpio 2.13 through mmap chunk metadata curruption (CVE-2021-38185)

[3
stars](/fangqyi/cpiopwn/stargazers) [2
forks](/fangqyi/cpiopwn/forks) [Branches](/fangqyi/cpiopwn/branches) [Tags](/fangqyi/cpiopwn/tags) [Activity](/fangqyi/cpiopwn/activity)
 [Star](/login?return_to=%2Ffangqyi%2Fcpiopwn)

 [Notifications](/login?return_to=%2Ffangqyi%2Fcpiopwn) You must be signed in to change notification settings

* [Code](/fangqyi/cpiopwn)
* [Issues
  0](/fangqyi/cpiopwn/issues)
* [Pull requests
  0](/fangqyi/cpiopwn/pulls)
* [Actions](/fangqyi/cpiopwn/actions)
* [Projects
  0](/fangqyi/cpiopwn/projects)
* [Security](/fangqyi/cpiopwn/security)
* [Insights](/fangqyi/cpiopwn/pulse)

Additional navigation options

* [Code](/fangqyi/cpiopwn)
* [Issues](/fangqyi/cpiopwn/issues)
* [Pull requests](/fangqyi/cpiopwn/pulls)
* [Actions](/fangqyi/cpiopwn/actions)
* [Projects](/fangqyi/cpiopwn/projects)
* [Security](/fangqyi/cpiopwn/security)
* [Insights](/fangqyi/cpiopwn/pulse)

# fangqyi/cpiopwn

   Â main[Branches](/fangqyi/cpiopwn/branches)[Tags](/fangqyi/cpiopwn/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commitÂ History[38 Commits](/fangqyi/cpiopwn/commits/main/) | | |
| [.gitignore](/fangqyi/cpiopwn/blob/main/.gitignore ".gitignore") | | [.gitignore](/fangqyi/cpiopwn/blob/main/.gitignore ".gitignore") |  |  |
| [Dockerfile](/fangqyi/cpiopwn/blob/main/Dockerfile "Dockerfile") | | [Dockerfile](/fangqyi/cpiopwn/blob/main/Dockerfile "Dockerfile") |  |  |
| [README.md](/fangqyi/cpiopwn/blob/main/README.md "README.md") | | [README.md](/fangqyi/cpiopwn/blob/main/README.md "README.md") |  |  |
| [docker\_fengshui.py](/fangqyi/cpiopwn/blob/main/docker_fengshui.py "docker_fengshui.py") | | [docker\_fengshui.py](/fangqyi/cpiopwn/blob/main/docker_fengshui.py "docker_fengshui.py") |  |  |
| [dynsym-hacked.bin](/fangqyi/cpiopwn/blob/main/dynsym-hacked.bin "dynsym-hacked.bin") | | [dynsym-hacked.bin](/fangqyi/cpiopwn/blob/main/dynsym-hacked.bin "dynsym-hacked.bin") |  |  |
| [exploit.py](/fangqyi/cpiopwn/blob/main/exploit.py "exploit.py") | | [exploit.py](/fangqyi/cpiopwn/blob/main/exploit.py "exploit.py") |  |  |
| View all files | | |

## Repository files navigation

* README
# cpiopwn (CVE-2021-38185)

This is an ACE POC of an integer overflow bug in cpio. This exploit bypasses all binary protections except full RELRO. This exploit uses cpio 2.13 and libc 2.31. Video demo: <https://youtu.be/F0yKJhu7Vak>

## Running the exploit

We've provided a Kali Dockerfile to run the exploit. The same exploit should work outside the Docker container, but offsets may be different.

### Instructions

* Build the file
  + `sudo docker build -t cpiopwn .`
* Start the image and mount files
  + `sudo docker run --mount type=bind,source=$(pwd),destination=/cpiopwn -it cpiopwn /bin/bash`
* `cd cpiopwn`
* Run the exploit, which will build a pattern file with `docker_fengshui.py` and call cpio with a large number of command line arguments.
  + `python3 exploit.py`

And that's it! After building the malicious pattern file, a prompt will show up, and it will start processing commands after a little bit of time.

### Notes

The exploit may take about a minute after the prompt appears before it starts responding to commands. We've provided a video of it running to show what should happen.

Additionally, the exploit may only work on computers with at least 12 GB of RAM, as it forces cpio to read gigabytes of input. We had some issues with servers running out of RAM with previous versions of the exploit - the current version has been tested on computers with 12 and 16 GB of RAM, but not smaller.

```
    |\__/,|   (`\
  _.|o o  |_   ) )
-(((---(((--------

```

## About

ACE poc exploit for glibc cpio 2.13 through mmap chunk metadata curruption (CVE-2021-38185)

### Topics

[linux](/topics/linux "Topic: linux")
[exploit](/topics/exploit "Topic: exploit")
[poc](/topics/poc "Topic: poc")
[cve](/topics/cve "Topic: cve")
[cpio](/topics/cpio "Topic: cpio")

### Resources

[Readme](#readme-ov-file)

[Activity](/fangqyi/cpiopwn/activity)
### Stars

[**3**
stars](/fangqyi/cpiopwn/stargazers)
### Watchers

[**1**
watching](/fangqyi/cpiopwn/watchers)
### Forks

[**2**
forks](/fangqyi/cpiopwn/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Ffangqyi%2Fcpiopwn&report=fangqyi+%28user%29)

## [Releases](/fangqyi/cpiopwn/releases)

No releases published

## [Packages 0](/users/fangqyi/packages?repo_name=cpiopwn)

No packages published

## [Contributors 2](/fangqyi/cpiopwn/graphs/contributors)

## Languages

* [Python
  83.0%](/fangqyi/cpiopwn/search?l=python)
* [Dockerfile
  17.0%](/fangqyi/cpiopwn/search?l=dockerfile)

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


