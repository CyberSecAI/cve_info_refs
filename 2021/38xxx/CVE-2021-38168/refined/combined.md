=== Content from github.com_340b7ff5_20250115_090054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Froxy-wi%2Froxy-wi%2Fissues%2F285)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Froxy-wi%2Froxy-wi%2Fissues%2F285)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=roxy-wi%2Froxy-wi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[roxy-wi](/roxy-wi)
/
**[roxy-wi](/roxy-wi/roxy-wi)**
Public

* [Notifications](/login?return_to=%2Froxy-wi%2Froxy-wi) You must be signed in to change notification settings
* [Fork
  256](/login?return_to=%2Froxy-wi%2Froxy-wi)
* [Star
   1.6k](/login?return_to=%2Froxy-wi%2Froxy-wi)

* [Code](/roxy-wi/roxy-wi)
* [Issues
  5](/roxy-wi/roxy-wi/issues)
* [Pull requests
  1](/roxy-wi/roxy-wi/pulls)
* [Discussions](/roxy-wi/roxy-wi/discussions)
* [Actions](/roxy-wi/roxy-wi/actions)
* [Projects
  0](/roxy-wi/roxy-wi/projects)
* [Security](/roxy-wi/roxy-wi/security)
* [Insights](/roxy-wi/roxy-wi/pulse)

Additional navigation options

* [Code](/roxy-wi/roxy-wi)
* [Issues](/roxy-wi/roxy-wi/issues)
* [Pull requests](/roxy-wi/roxy-wi/pulls)
* [Discussions](/roxy-wi/roxy-wi/discussions)
* [Actions](/roxy-wi/roxy-wi/actions)
* [Projects](/roxy-wi/roxy-wi/projects)
* [Security](/roxy-wi/roxy-wi/security)
* [Insights](/roxy-wi/roxy-wi/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Froxy-wi%2Froxy-wi%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Froxy-wi%2Froxy-wi%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# multiple vulnerabilities leading to preauth RCE #285

Closed

[rekter0](/rekter0) opened this issue
Aug 7, 2021
· 2 comments

Closed

# [multiple vulnerabilities leading to preauth RCE](#top) #285

[rekter0](/rekter0) opened this issue
Aug 7, 2021
· 2 comments

Labels
[bug](/roxy-wi/roxy-wi/labels/bug)
Something isn't working

## Comments

[![@rekter0](https://avatars.githubusercontent.com/u/58881147?s=80&u=84c20f2fc845e293812671518082a76d6ea9bcdd&v=4)](/rekter0)

Copy link

### **[rekter0](/rekter0)** commented [Aug 7, 2021](#issue-963203381)

| i found haproxy-wi in aws/digitalocean marketplace when i was looking for a solution to manage multiple reverse proxies, since it was opensource i peaked at how it works and found some critical issues when combined leading to pre-auth RCE # SQL injections: Inside `/app/sql.py` some SQL statements have user controlled input supplied directly into SQL queries ## Unauthenticated SQLi when an attacker request any of the pages inside `/app` folder, authentication is checked via `funct.check_login()`  ``` def check_login(): 	import sql 	import http.cookies >	cookie = http.cookies.SimpleCookie(os.environ.get("HTTP_COOKIE")) >	user_uuid = cookie.get('uuid') 	ref = os.environ.get("REQUEST_URI")  	sql.delete_old_uuid()  	if user_uuid is not None: >		sql.update_last_act_user(user_uuid.value) 		if sql.get_user_name_by_uuid(user_uuid.value) is None: 			print('<meta http-equiv="refresh" content="0; url=login.py?ref=%s">' % ref) 			return False 	else: 		print('<meta http-equiv="refresh" content="0; url=login.py?ref=%s">' % ref) 		return False ```  `check_login()` takes `uuid` cookie value and try to update expiration timestamp for the given uuid with `sql.update_last_act_user(user_uuid.value)`  ``` def update_last_act_user(uuid): 	cursor = conn.cursor() 	session_ttl = get_setting('session_ttl')  	if mysql_enable == '1': >		sql = """ update uuid set exp = now()+ INTERVAL %s day where uuid = '%s' """ % (session_ttl, uuid) 	else: >		sql = """ update uuid set exp = datetime('now', '+%s days') where uuid = '%s' """ % (session_ttl, uuid) 	try: 		cursor.execute(sql) 	except Exception as e: 		funct.out_error(e) ```  `uuid` cookie value is directly supplied into the query, so an unauthenticated attacker can perform a blind SQL injection to dump the database or extract a valid uuid to bypass authentication ## authenticated SQLi One example of authenticated SQLi via reaching select\_servers function  ``` def select_servers(**kwargs): 	cursor = conn.cursor() 	sql = """select * from servers where enable = '1' ORDER BY groups """  	if kwargs.get("server") is not None: 		sql = """select * from servers where ip='%s' """ % kwargs.get("server") 	if kwargs.get("full") is not None: 		sql = """select * from servers ORDER BY hostname """ 	if kwargs.get("get_master_servers") is not None: 		sql = """select id,hostname from servers where master = 0 and type_ip = 0 and enable = 1 ORDER BY groups """ 	if kwargs.get("get_master_servers") is not None and kwargs.get('uuid') is not None: 		sql = """ select servers.id, servers.hostname from servers  			left join user as user on servers.groups = user.groups  			left join uuid as uuid on user.id = uuid.user_id  			where uuid.uuid = '%s' and servers.master = 0 and servers.type_ip = 0 and servers.enable = 1 ORDER BY servers.groups  			""" % kwargs.get('uuid') 	if kwargs.get("id"): 		sql = """select * from servers where id='%s' """ % kwargs.get("id") 	if kwargs.get("hostname"): 		sql = """select * from servers where hostname='%s' """ % kwargs.get("hostname") 	if kwargs.get("id_hostname"): 		sql = """select * from servers where hostname='%s' or id = '%s' or ip = '%s'""" % (kwargs.get("id_hostname"), kwargs.get("id_hostname"), kwargs.get("id_hostname")) 	if kwargs.get("server") and kwargs.get("keep_alive"): 		sql = """select active from servers where ip='%s' """ % kwargs.get("server") 	try: 		cursor.execute(sql) 	except Exception as e: 		funct.out_error(e) 	else: 		return cursor.fetchall() ```  there's multiple injection points from user supplied input here  one way to reach this is from hapservers.py  ``` [...] [...] serv = form.getvalue('serv') service = form.getvalue('service') [...] [...]  if funct.check_is_server_in_group(serv):             servers = sql.select_servers(server=serv) ```  this could be exploited by least privilege account such as guest  There's some more functions supplying user input to SQL queries # Command injection: Inside `/app/funct.py` and `/api/api_funct.py` some commands executed are supplied with user input  one of many examples of a second order command injection here:  ``` def get_all_stick_table(): 	import sql 	hap_sock_p = sql.get_setting('haproxy_sock_port') 	cmd = 'echo "show table"|nc %s %s |awk \'{print $3}\' | tr -d \'\n\' | tr -d \'[:space:]\'' % (serv, hap_sock_p) 	output, stderr = subprocess_execute(cmd) 	return output[0] ```  haproxy\_sock\_port is stored in settings table, and an authenticated user can change it from `https://[%HOST%]/app/users.py#settings` then calls options page to call that function and execute arbitrary system command  most cmds in different functions are prone to command injection or second order from settings stored in the database and user controlled # Conclusion combining both unauthenticated SQLi to grab a valid uuid and bypass authentication, then use command injection an unauthenticated user can achieve pre-auth RCE |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@Aidaho12](https://avatars.githubusercontent.com/u/20718301?s=40&u=c1d3f2d11f93e4cbb045e3ac899db00c90847e17&v=4)](/Aidaho12)
[Aidaho12](/Aidaho12)
added
the
[bug](/roxy-wi/roxy-wi/labels/bug)
Something isn't working
label
[Aug 7, 2021](#event-5125645375)

[![@Aidaho12](https://avatars.githubusercontent.com/u/20718301?s=80&u=c1d3f2d11f93e4cbb045e3ac899db00c90847e17&v=4)](/Aidaho12)

Copy link

Member

### **[Aidaho12](/Aidaho12)** commented [Aug 9, 2021](#issuecomment-895008596)

| Thank you very much for you report!  The most sql requests have been re-writen to peewee ORM, and there isn't sqli now.  About command injection: types of parameters have started to be checked, it should close the most of injection |
| --- |

All reactions

Sorry, something went wrong.

[![@Aidaho12](https://avatars.githubusercontent.com/u/20718301?s=40&u=c1d3f2d11f93e4cbb045e3ac899db00c90847e17&v=4)](/Aidaho12)
[Aidaho12](/Aidaho12)
closed this as [completed](/roxy-wi/roxy-wi/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Aug 9, 2021](#event-5128061664)

[![@Derkness](https://avatars.githubusercontent.com/u/67995374?s=80&v=4)](/Derkness)

Copy link

### **[Derkness](/Derkness)** commented [Sep 18, 2021](#issuecomment-922176457) • edited Loading

| Would it be possible to link the fixing commit/pr? Just so I can see how to avoid this for my studies. (Mainly for the command injection) |
| --- |

All reactions

Sorry, something went wrong.

[![@Prylz](https://avatars.githubusercontent.com/u/105204993?s=40&v=4)](/Prylz)
[Prylz](/Prylz)
mentioned this issue
[Dec 6, 2022](#ref-issue-1479397813)

[Authenticated SQLi
#347](/roxy-wi/roxy-wi/issues/347)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Froxy-wi%2Froxy-wi%2Fissues%2F285)

Assignees

No one assigned

Labels

[bug](/roxy-wi/roxy-wi/labels/bug)
Something isn't working

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@Aidaho12](https://avatars.githubusercontent.com/u/20718301?s=52&v=4)](/Aidaho12) [![@rekter0](https://avatars.githubusercontent.com/u/58881147?s=52&v=4)](/rekter0) [![@Derkness](https://avatars.githubusercontent.com/u/67995374?s=52&v=4)](/Derkness)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


