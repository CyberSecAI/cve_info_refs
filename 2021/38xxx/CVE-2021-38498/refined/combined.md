=== Content from www.mozilla.org_5df6384f_20250114_184109.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-47

## Security Vulnerabilities fixed in Thunderbird 91.2

Announced
October 6, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.2

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-38502: Downgrade attack on SMTP STARTTLS connections](#CVE-2021-38502)

Reporter
Mattias Jacobsson
Impact
high
##### Description

Thunderbird ignored the configuration to require STARTTLS security for an SMTP connection. A MITM could perform a downgrade attack to intercept transmitted messages, or could take control of the authenticated session to execute SMTP commands chosen by the MITM. If an unprotected authentication method was configured, the MITM could obtain the authentication credentials, too.

##### References

* [Bug 1733366](https://bugzilla.mozilla.org/show_bug.cgi?id=1733366)

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Thunderbird 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Thunderbird 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-38501: Memory safety bugs fixed in Thunderbird 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Thunderbird 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_9a50dce2_20250114_184107.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1729642)
* [XML](/show_bug.cgi?ctype=xml&id=1729642)

Closed
[Bug 1729642](/show_bug.cgi?id=1729642)
(CVE-2021-38498)

Opened 3 years ago
Closed 3 years ago

# SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle

## Categories

### (Core :: Internationalization, task)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Internationalization#Internationalization)

Internationalization
▾

Core :: Internationalization
Internationalization is the process of designing and developing a software product to function in multiple locales. This process involves identifying the locales that must be supported, designing features which support those locales, and writing the code needed.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Internationalization&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Internationalization&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Internationalization)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

task

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

94 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | [93+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=93%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | [+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=fixed) |
| firefox94 | [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 | 93+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox92 |  | wontfix |
| firefox93 | + | fixed |
| firefox94 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: m.cooolie, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2afc3e713a960c7119ae73ca1cd5e8e?d=mm&size=40)  [m.cooolie](/user_profile?user_id=689709)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1875645d5594d36bca29657d51d24ed6?d=mm&size=40)  [m\_kato](/user_profile?user_id=8636)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1727259](/show_bug.cgi?id=1727259 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free in PLDHashTable::Search via nsNameSpaceManager::RegisterNameSpace")

Dependency [tree](/showdependencytree.cgi?id=1729642&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1729642)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1748520](/show_bug.cgi?id=1748520 "RESOLVED FIXED - High frequency valgrind-test | 20 bytes in 1 blocks are definitely lost at malloc / moz_xmalloc / nsDynamicAtom::Create / nsAtomTable::Atomize"), [1856084](/show_bug.cgi?id=1856084 "RESOLVED FIXED - Assertion failure: gAtomTable, at /builds/worker/checkouts/gecko/xpcom/ds/nsAtomTable.cpp:450")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main93+][adv-esr91.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-38498

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main93+][adv-esr91.2+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1761413_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | [qe-verify](#a1382861_458186 "3 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ PLDHashTable::Search | nsLanguageAtomService::GetLanguageGroup ]](https://crash-stats.mozilla.org/signature/?signature=PLDHashTable%3A%3ASearch%20%7C%20nsLanguageAtomService%3A%3AGetLanguageGroup)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [0908.zip](/attachment.cgi?id=9240010)  [3 years ago](#c0)  [m.cooolie](/user_profile?user_id=689709)   54.75 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9240010&action=edit) |
| --- | --- | --- |
| [ff.test.js](/attachment.cgi?id=9240550)  [3 years ago](#c10)  [m.cooolie](/user_profile?user_id=689709)   11.61 KB, text/javascript |  | [Details](/attachment.cgi?id=9240550&action=edit) |
| [Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers](/attachment.cgi?id=9241185)  [3 years ago](#c12)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   48 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#c19 "3 years ago")  RyanVM : [approval-mozilla-esr91+](#c21 "3 years ago") | [Details](/attachment.cgi?id=9241185&action=edit) | [Review](/attachment.cgi?id=9241185) |
| [Bug 1729642 - patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio](/attachment.cgi?id=9241186)  [3 years ago](#c13)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   48 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#a1064830_24572 "3 years ago")  RyanVM : [approval-mozilla-esr91+](#a1070506_75935 "3 years ago") | [Details](/attachment.cgi?id=9241186&action=edit) | [Review](/attachment.cgi?id=9241186) |
| [advisory.txt](/attachment.cgi?id=9243769)  [3 years ago](#c23)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   244 bytes, text/plain |  | [Details](/attachment.cgi?id=9243769&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [m.cooolie](/user_profile?user_id=689709)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1729642#c0)• 3 years ago |
|  | |

Attached file
[0908.zip](attachment.cgi?id=9240010)
— [Details](attachment.cgi?id=9240010&action=edit)

#Summary

SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle

#Reproduce

OS:Win10 X64

Firefox: Nightly 94.0a1 (2021-09-07) (64-bit)

step:

1. python -m http.server 80
2. install node&puppeteer-core (ffpuppet not work on windows)
3. node ff.test.js D:\firefox\_asan\target\firefox\firefox.exe <http://localhost/poc.htm>
4. wait for 30s if not crashes try again

#Type of crash

Tab process

#Analysis

Not yet

#Patch

Not Yet

# #ASAN

==3780==ERROR: AddressSanitizer: heap-use-after-free on address 0x1275b70c0d70 at pc 0x7ffe09934350 bp 0x00d37d5f9880 sp 0x00d37d5f98c8

READ of size 4 at 0x1275b70c0d70 thread T0

#0 0x7ffe0993434f in PLDHashTable::MakeEntryHandle /builds/worker/checkouts/gecko/xpcom/ds/PLDHashTable.cpp:619

#1 0x7ffe09934c5b in PLDHashTable::MakeEntryHandle /builds/worker/checkouts/gecko/xpcom/ds/PLDHashTable.cpp:673

#2 0x7ffe09cf2113 in nsLanguageAtomService::GetLanguageGroup /builds/worker/checkouts/gecko/intl/locale/nsLanguageAtomService.cpp:146

#3 0x7ffe1344b863 in mozilla::StaticPresData::GetFontPrefsForLang /builds/worker/checkouts/gecko/layout/base/StaticPresData.cpp:219

#4 0x7ffe132c18af in nsStyleFont::nsStyleFont /builds/worker/checkouts/gecko/layout/style/nsStyleStruct.cpp:240

#5 0x7ffe187c3330 in style::gecko\_properties::ComputedValues::default\_values /builds/worker/workspace/obj-build/x86\_64-pc-windows-msvc/release/build/style-4ff881e47c64df5b/out/gecko\_properties.rs:315

#6 0x7ffe181cf3fa in geckoservo::glue::Servo\_StyleSet\_Init /builds/worker/checkouts/gecko/servo/ports/geckolib/glue.rs:4095

#7 0x7ffe1325536a in mozilla::ServoStyleSet::ServoStyleSet /builds/worker/checkouts/gecko/layout/style/ServoStyleSet.cpp:117

#8 0x7ffe0cfde456 in mozilla::dom::Document::Init /builds/worker/checkouts/gecko/dom/base/Document.cpp:2639

#9 0x7ffe123d40d9 in NS\_NewDOMDocument /builds/worker/checkouts/gecko/dom/xml/XMLDocument.cpp:75

#10 0x7ffe0cec6f50 in mozilla::dom::DOMImplementation::CreateDocument /builds/worker/checkouts/gecko/dom/base/DOMImplementation.cpp:100

#11 0x7ffe0cec77ed in mozilla::dom::DOMImplementation::CreateDocument /builds/worker/checkouts/gecko/dom/base/DOMImplementation.cpp:128

#12 0x7ffe0efefef1 in mozilla::dom::DOMImplementation\_Binding::createDocument /builds/worker/workspace/obj-build/dom/bindings/DOMImplementationBinding.cpp:166

#13 0x7ffe0f858269 in mozilla::dom::binding\_detail::GenericMethod<mozilla::dom::binding\_detail::NormalThisPolicy,mozilla::dom::binding\_detail::ThrowExceptions> /builds/worker/checkouts/gecko/dom/bindings/BindingUtils.cpp:3300

#14 0x24bd57e396e (<unknown module>)

0x1275b70c0d70 is located 32 bytes inside of 48-byte region [0x1275b70c0d50,0x1275b70c0d80)

freed by thread T0 here:

#0 0x7ffe33555afb in free Z:\task\_163036031364766\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan\_malloc\_win.cpp:82

#1 0x7ffe09834114 in mozilla::KillClearOnShutdown /builds/worker/checkouts/gecko/xpcom/base/ClearOnShutdown.cpp:55

#2 0x7ffe09b9473d in mozilla::ShutdownXPCOM /builds/worker/checkouts/gecko/xpcom/build/XPCOMInit.cpp:650

#3 0x7ffe16f70200 in XRE\_TermEmbedding /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:218

#4 0x7ffe0aef9368 in mozilla::ipc::ScopedXREEmbed::Stop /builds/worker/checkouts/gecko/ipc/glue/ScopedXREEmbed.cpp:90

#5 0x7ffe16f71064 in XRE\_InitChildProcess /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:753

#6 0x7ff7897e1f49 in NS\_internal\_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327

#7 0x7ff7897e14d4 in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:131

#8 0x7ff7898de217 in \_\_scrt\_common\_main\_seh d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe\_common.inl:288

#9 0x7ffe61627033 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x180017033)

#10 0x7ffe63602650 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180052650)

previously allocated by thread T0 here:

#0 0x7ffe33555c0b in malloc Z:\task\_163036031364766\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan\_malloc\_win.cpp:98

#1 0x7ffe33ec139d in moz\_xmalloc /builds/worker/checkouts/gecko/memory/mozalloc/mozalloc.cpp:52

#2 0x7ffe09cf1bf7 in nsLanguageAtomService::GetService /builds/worker/checkouts/gecko/intl/locale/nsLanguageAtomService.cpp:87

#3 0x7ffe1344a428 in mozilla::StaticPresData::Init /builds/worker/checkouts/gecko/layout/base/StaticPresData.cpp:20

#4 0x7ffe13f33dd5 in nsLayoutStatics::Initialize /builds/worker/checkouts/gecko/layout/build/nsLayoutStatics.cpp:178

#5 0x7ffe13f33cbd in nsLayoutModuleInitialize /builds/worker/checkouts/gecko/layout/build/nsLayoutModule.cpp:104

#6 0x7ffe09a8abf9 in nsComponentManagerImpl::Init /builds/worker/checkouts/gecko/xpcom/components/nsComponentManager.cpp:408

#7 0x7ffe09b936e1 in NS\_InitXPCOM /builds/worker/checkouts/gecko/xpcom/build/XPCOMInit.cpp:446

#8 0x7ffe16f7013e in XRE\_InitEmbedding2 /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:192

#9 0x7ffe0aef98ac in mozilla::ipc::ScopedXREEmbed::Start /builds/worker/checkouts/gecko/ipc/glue/ScopedXREEmbed.cpp:83

#10 0x7ffe120ffe0f in mozilla::dom::ContentProcess::Init /builds/worker/checkouts/gecko/dom/ipc/ContentProcess.cpp:202

#11 0x7ffe16f70f01 in XRE\_InitChildProcess /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:715

#12 0x7ff7897e1f49 in NS\_internal\_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327

#13 0x7ff7897e14d4 in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:131

#14 0x7ff7898de217 in \_\_scrt\_common\_main\_seh d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe\_common.inl:288

#15 0x7ffe61627033 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x180017033)

#16 0x7ffe63602650 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180052650)

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/checkouts/gecko/xpcom/ds/PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle

Shadow bytes around the buggy address:

0x04bc6de98150: fa fa fd fd fd fd fd fd fa fa fd fd fd fd fd fa

0x04bc6de98160: fa fa 00 00 00 00 00 00 fa fa 00 00 00 00 00 00

0x04bc6de98170: fa fa 00 00 00 00 00 04 fa fa 00 00 00 00 00 00

0x04bc6de98180: fa fa 00 00 00 00 00 00 fa fa 00 00 00 00 00 00

0x04bc6de98190: fa fa 00 00 00 00 00 00 fa fa 00 00 00 00 00 00

=>0x04bc6de981a0: fa fa 00 00 00 00 00 00 fa fa fd fd fd fd[fd]fd

0x04bc6de981b0: fa fa fd fd fd fd fd fa fa fa 00 00 00 00 00 fa

0x04bc6de981c0: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa

0x04bc6de981d0: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa

0x04bc6de981e0: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa

0x04bc6de981f0: fa fa 00 00 00 00 00 fa fa fa 00 00 00 00 00 fa

Shadow byte legend (one shadow byte represents 8 application bytes):

Addressable: 00

Partially addressable: 01 02 03 04 05 06 07

Heap left redzone: fa

Freed heap region: fd

Stack left redzone: f1

Stack mid redzone: f2

Stack right redzone: f3

Stack after return: f5

Stack use after scope: f8

Global redzone: f9

Global init order: f6

Poisoned by user: f7

Container overflow: fc

Array cookie: ac

Intra object redzone: bb

ASan internal: fe

Left alloca redzone: ca

Right alloca redzone: cb

Shadow gap: cc

==3780==ABORTING

Flags: sec-bounty?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1729642#c1)• 3 years ago |
|  | |

Looks like some kind of shutdown issue, where content is somehow running after we clear a pref. There was a similar one from the same reporter. As with before, I think in practice this won't happen because we exit content processes early. Maybe we need to change fuzzing builds to not build with NS\_FREE\_PERMANENT\_DATA to avoid seeing these.

Group: firefox-core-security → layout-core-securityComponent: Security → DOM: CSS Object ModelProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a39595_406194)• 3 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a39662_406194)• 3 years ago |

See Also: → [1727259](/show_bug.cgi?id=1727259 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free in PLDHashTable::Search via nsNameSpaceManager::RegisterNameSpace")

|  | [Zibi Braniecki [:zbraniecki][:gandalf]](/user_profile?user_id=41270) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1729642#c2)• 3 years ago |
|  | |

CC'ing Dan. I don't think there's anything actionable for the i18n team here - the LanguageAtomService stack entry seems like it just is one of the things not freed by the process, but in case it bubbles up, Dan is architecting the LanguageTag unification.

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1729642#c3)• 3 years ago |
|  | |

(In reply to Zibi Braniecki [:zbraniecki][:gandalf] from [comment #2](/show_bug.cgi?id=1729642#c2 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle"))

> CC'ing Dan. I don't think there's anything actionable for the i18n team here - the LanguageAtomService stack entry seems like it just is one of the things not freed by the process, but in case it bubbles up, Dan is architecting the LanguageTag unification.

`StaticPresData` keeps a [raw weak pointer](https://searchfox.org/mozilla-central/rev/08c493902519265d570250c8e7ce575c8cd6f5b5/layout/base/StaticPresData.cpp#35) to `nsLanguageAtomService`, which is freed on shutdown.

So the main question is why are we running content script after shutdown? But also `StaticPresData::Shutdown() seems improperly ordered with`nsLanguageAtomService` shutdown.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1729642#c4)• 3 years ago |
|  | |

I see some similar UAFs in Thunderbird. [bp-24bf3c84-7106-4a71-87f1-c1ee30210903](https://crash-stats.mozilla.org/report/index/24bf3c84-7106-4a71-87f1-c1ee30210903)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1729642#c5)• 3 years ago |
|  | |

and Firefox: [bp-22d5e048-a2f3-49c7-8a73-551660210905](https://crash-stats.mozilla.org/report/index/22d5e048-a2f3-49c7-8a73-551660210905)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a44668_1689)• 3 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1729642#c6)• 3 years ago |
|  | |

(The Firefox one is in the main process.)

Seems like a shutdown issue in i18n.

Component: DOM: CSS Object Model → Internationalization

|  | [Dan Minor [:dminor]](/user_profile?user_id=466787) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1729642#c7)• 3 years ago |
|  | |

Hi Jonathan, do you have some time to look at this? It appears that you were the last to think about how to handle shutdown for `nsLanguageAtomService`, although it was many years ago [1].

[1] <https://searchfox.org/mozilla-central/rev/1761c710b035d7dc8892dfa8e56589b4e095221f/intl/locale/nsLanguageAtomService.cpp#88>

Flags: needinfo?(jkew)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1729642#c8)• 3 years ago |
|  | |

Hmm, given that [`nsLayoutStatics` can survive past the xpcom-shutdown notification](https://searchfox.org/mozilla-central/rev/1761c710b035d7dc8892dfa8e56589b4e095221f/layout/build/nsLayoutStatics.h#16-17), I guess it's wrong for `nsLanguageAtomService` to rely on `ClearOnShutdown` to clean up.

Instead of using `ClearOnShutdown`, maybe we could give `nsLanguageAtomService` a static `Shutdown` method that we explicitly call from `nsLayoutStatics::Shutdown` (like many other things).

Or we could make it refcounted, and let `StaticPresData` hold a strong reference, but maybe that's overkill here. I'll see if I can reproduce this locally and test a fix. Leaving ni? on myself to look into it.

Flags: needinfo?(jkew) → needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1729642#c9)• 3 years ago |
|  | |

Hmm, I think you may have attached the wrong archive; there's no ff.test.js in the zipfile here, but I do see a file ch.test.js which looks like it is intended for Chrome.

Flags: needinfo?(jfkthame) → needinfo?(m.cooolie)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a191886_406194)• 3 years ago |

Crash Signature: [@ PLDHashTable::Search | nsLanguageAtomService::GetLanguageGroup ]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a192124_406194)• 3 years ago |

Status: UNCONFIRMED → NEW
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected)
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)Ever confirmed: true

|  | [m.cooolie](/user_profile?user_id=689709)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1729642#c10)• 3 years ago |
|  | |

Attached file
[ff.test.js](attachment.cgi?id=9240550)
— [Details](attachment.cgi?id=9240550&action=edit)

sorry for that,my mistake.

node ff.test.js D:\firefox\_asan\target\firefox\firefox.exe <http://localhost/poc.html>

Flags: needinfo?(m.cooolie)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1729642#c11)• 3 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #8](/show_bug.cgi?id=1729642#c8 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle"))

> Instead of using `ClearOnShutdown`, maybe we could give `nsLanguageAtomService` a static `Shutdown` method that we explicitly call from `nsLayoutStatics::Shutdown` (like many other things).

This seems to work as expected; with such a change, I no longer see the error here.

However, ASAN then reports a similar issue with `nsNameSpaceManager`:

```
==128681==ERROR: AddressSanitizer: heap-use-after-free on address 0x608000002fc0 at pc 0x7f1339d1798c bp 0x7ffd033176c0 sp 0x7ffd033176b8
READ of size 8 at 0x608000002fc0 thread T0 (Web Content)
    #0 0x7f1339d1798b in PLDHashTable::EntryStore::IsAllocated() const /home/jkew/mozdev/mozilla-unified/xpcom/ds/PLDHashTable.h:325:41
    #1 0x7f1339d1798b in PLDHashTable::Search(void const*) const /home/jkew/mozdev/mozilla-unified/xpcom/ds/PLDHashTable.cpp:494:20
    #2 0x7f133dee1533 in nsTHashtable<nsBaseHashtableET<nsRefPtrHashKey<nsAtom>, int> >::GetEntry(nsAtom*) const /home/jkew/mozdev/mozilla-unified/objdir-ff-asan/dist/include/nsTHashtable.h:289:16
    #3 0x7f133dee1533 in nsBaseHashtable<nsRefPtrHashKey<nsAtom>, int, int, nsDefaultConverter<int, int> >::Get(nsAtom*, int*) const /home/jkew/mozdev/mozilla-unified/xpcom/ds/nsBaseHashtable.h:328:28
    #4 0x7f133dee1533 in nsNameSpaceManager::RegisterNameSpace(already_AddRefed<nsAtom>, int&) /home/jkew/mozdev/mozilla-unified/dom/base/nsNameSpaceManager.cpp:103:22
    #5 0x7f133dee1533 in nsNameSpaceManager::RegisterNameSpace(nsTSubstring<char16_t> const&, int&) /home/jkew/mozdev/mozilla-unified/dom/base/nsNameSpaceManager.cpp:91:10
    #6 0x7f133d7b97de in nsContentUtils::GetNodeInfoFromQName(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsNodeInfoManager*, unsigned short, mozilla::dom::NodeInfo**) /home/jkew/mozdev/mozilla-unified/dom/base/nsContentUtils.cpp:3363:22
    #7 0x7f133db27fc9 in mozilla::dom::Document::CreateElementNS(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::ElementCreationOptionsOrString const&, mozilla::ErrorResult&) /home/jkew/mozdev/mozilla-unified/dom/base/Document.cpp:8282:8
    #8 0x7f1343127c2a in NS_NewDOMDocument(mozilla::dom::Document**, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::DocumentType*, nsIURI*, nsIURI*, nsIPrincipal*, bool, nsIGlobalObject*, DocumentFlavor) /home/jkew/mozdev/mozilla-unified/dom/xml/XMLDocument.cpp:157:12
    #9 0x7f133d9d63a1 in mozilla::dom::DOMImplementation::CreateDocument(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::DocumentType*, mozilla::dom::Document**) /home/jkew/mozdev/mozilla-unified/dom/base/DOMImplementation.cpp:100:8
    #10 0x7f133d9d69aa in mozilla::dom::DOMImplementation::CreateDocument(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::dom::DocumentType*, mozilla::ErrorResult&) /home/jkew/mozdev/mozilla-unified/dom/base/DOMImplementation.cpp:128:9
    #11 0x7f133fc2a184 in mozilla::dom::DOMImplementation_Binding::createDocument(JSContext*, JS::Handle<JSObject*>, void*, JSJitMethodCallArgs const&) /home/jkew/mozdev/mozilla-unified/objdir-ff-asan/dom/bindings/DOMImplementationBinding.cpp:166:75
    #12 0x7f13404f290a in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /home/jkew/mozdev/mozilla-unified/dom/bindings/BindingUtils.cpp:3300:13
    #13 0x3d8d3096c401  (<unknown module>)

0x608000002fc0 is located 32 bytes inside of 96-byte region [0x608000002fa0,0x608000003000)
freed by thread T0 (Web Content) here:
    #0 0x5636077c6e22 in free /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:127:3
    #1 0x7f1339c35e8b in mozilla::KillClearOnShutdown(mozilla::ShutdownPhase) /home/jkew/mozdev/mozilla-unified/xpcom/base/ClearOnShutdown.cpp:55:19
    #2 0x7f1339f567ac in mozilla::ShutdownXPCOM(nsIServiceManager*) /home/jkew/mozdev/mozilla-unified/xpcom/build/XPCOMInit.cpp:650:5
    #3 0x7f1348a70d8c in XRE_TermEmbedding() /home/jkew/mozdev/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:218:3
    #4 0x7f133b5df3e5 in mozilla::ipc::ScopedXREEmbed::Stop() /home/jkew/mozdev/mozilla-unified/ipc/glue/ScopedXREEmbed.cpp:90:5
    #5 0x7f1348a71808 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/jkew/mozdev/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:753:16
    #6 0x5636077fb781 in content_process_main(mozilla::Bootstrap*, int, char**) /home/jkew/mozdev/mozilla-unified/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #7 0x5636077fb781 in main /home/jkew/mozdev/mozilla-unified/browser/app/nsBrowserApp.cpp:327:18
    #8 0x7f13546130b2 in __libc_start_main /build/glibc-eX1tMB/glibc-2.31/csu/../csu/libc-start.c:308:16

previously allocated by thread T0 (Web Content) here:
    #0 0x5636077c708d in malloc /builds/worker/fetches/llvm-project/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cpp:145:3
    #1 0x5636077fffdd in moz_xmalloc /home/jkew/mozdev/mozilla-unified/memory/mozalloc/mozalloc.cpp:52:15
    #2 0x7f133dedf8c2 in operator new(unsigned long) /home/jkew/mozdev/mozilla-unified/objdir-ff-asan/dist/include/mozilla/cxxalloc.h:33:10
    #3 0x7f133dedf8c2 in nsNameSpaceManager::GetInstance() /home/jkew/mozdev/mozilla-unified/dom/base/nsNameSpaceManager.cpp:39:17
    #4 0x7f133d79c681 in nsContentUtils::Init() /home/jkew/mozdev/mozilla-unified/dom/base/nsContentUtils.cpp:738:23
    #5 0x7f1344baf411 in nsLayoutStatics::Initialize() /home/jkew/mozdev/mozilla-unified/layout/build/nsLayoutStatics.cpp:163:8
    #6 0x7f1344baf2b5 in nsLayoutModuleInitialize() /home/jkew/mozdev/mozilla-unified/layout/build/nsLayoutModule.cpp:104:7
    #7 0x7f1339e6c588 in nsComponentManagerImpl::Init() /home/jkew/mozdev/mozilla-unified/xpcom/components/nsComponentManager.cpp:408:5
    #8 0x7f1339f55636 in NS_InitXPCOM /home/jkew/mozdev/mozilla-unified/xpcom/build/XPCOMInit.cpp:446:51
    #9 0x7f1348a70c97 in XRE_InitEmbedding2(nsIFile*, nsIFile*, nsIDirectoryServiceProvider*) /home/jkew/mozdev/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:192:8
    #10 0x7f133b5df8c6 in mozilla::ipc::ScopedXREEmbed::Start() /home/jkew/mozdev/mozilla-unified/ipc/glue/ScopedXREEmbed.cpp
    #11 0x7f1342e4f8ca in mozilla::dom::ContentProcess::Init(int, char**) /home/jkew/mozdev/mozilla-unified/dom/ipc/ContentProcess.cpp:202:13
    #12 0x7f1348a717ac in XRE_InitChildProcess(int, char**, XREChildData const*) /home/jkew/mozdev/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:715:21
    #13 0x5636077fb781 in content_process_main(mozilla::Bootstrap*, int, char**) /home/jkew/mozdev/mozilla-unified/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #14 0x5636077fb781 in main /home/jkew/mozdev/mozilla-unified/browser/app/nsBrowserApp.cpp:327:18
    #15 0x7f13546130b2 in __libc_start_main /build/glibc-eX1tMB/glibc-2.31/csu/../csu/libc-start.c:308:16

SUMMARY: AddressSanitizer: heap-use-after-free /home/jkew/mozdev/mozilla-unified/xpcom/ds/PLDHashTable.h:325:41 in PLDHashTable::EntryStore::IsAllocated() const
Shadow bytes around the buggy address:
  0x0c107fff85a0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa
  0x0c107fff85b0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c107fff85c0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c107fff85d0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 06 fa
  0x0c107fff85e0: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c107fff85f0: fa fa fa fa fd fd fd fd[fd]fd fd fd fd fd fd fd
  0x0c107fff8600: fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c107fff8610: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa
  0x0c107fff8620: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 02 fa
  0x0c107fff8630: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 02
  0x0c107fff8640: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==128681==ABORTING

```

So we should fix that at the same time. I see that `nsNameSpaceManager` is refcounted, but `nsContentUtils` only holds a raw pointer to it. Making that a strong reference (and then dropping it in `nsContentUtils::Shutdown`, like it already does for a number of others) looks like it should resolve the problem.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1729642#c12)• 3 years ago |
|  | |

Attached file
[Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers](attachment.cgi?id=9241185)
— [Details](attachment.cgi?id=9241185&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a551565_600971)• 3 years ago |

Assignee: nobody → jfkthameStatus: NEW → ASSIGNED

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1729642#c13)• 3 years ago |
|  | |

Attached file
[Bug 1729642 - patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio](attachment.cgi?id=9241186)
— [Details](attachment.cgi?id=9241186&action=edit)

Depends on D125587

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1729642#c14)• 3 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #11](/show_bug.cgi?id=1729642#c11 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle"))

> So we should fix that at the same time. I see that `nsNameSpaceManager` is refcounted, but `nsContentUtils` only holds a raw pointer to it. Making that a strong reference (and then dropping it in `nsContentUtils::Shutdown`, like it already does for a number of others) looks like it should resolve the problem.

That sounds like the same issue that has been reported in [bug 1727259](/show_bug.cgi?id=1727259 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free in PLDHashTable::Search via nsNameSpaceManager::RegisterNameSpace"), which I just CCed you on. [Comment 5](/show_bug.cgi?id=1729642#c5 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle") has a different fix that that basically gets rid of the nsContentUtils pointer entirely.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1729642#c15)• 3 years ago |
|  | |

Hah - yes, same issue (and the same reporter/essentially the same testcase as here).

I think (if I'm understanding correctly) the fix suggested there wouldn't ensure quite such tidy cleanup. The issue arises when a Document, via nsContentUtils, accesses sNameSpaceManager after the KillOnShutdown handler has cleared nsNameSpaceManager's reference. If we replace use of nsContentUtils::sNameSpaceManager with a call to nsNameSpaceManager::GetInstance(), won't that mean that in such a case, a new instance gets created and returned? I believe that will then hit [this assertion](https://searchfox.org/mozilla-central/rev/a82dd14b6bc3d05a6a3facc126607e6d34cc2f53/xpcom/base/ClearOnShutdown.cpp#20) when it tries to use InsertIntoShutdownList, as it's too late for that.

None of this would matter in a release build, AFAICS, but it would still leave a non-clean shutdown in debug builds.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1729642#c16)• 3 years ago |
|  | |

patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=platform-i18n-reviewers,dminor

<https://hg.mozilla.org/integration/autoland/rev/51359ee5adf3773a4c7da805b62d9d692cf6993a>

patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio

<https://hg.mozilla.org/integration/autoland/rev/7e31b3768b1e208ba8a5e241d6b3443a0d181c7b>

<https://hg.mozilla.org/mozilla-central/rev/51359ee5adf3>

<https://hg.mozilla.org/mozilla-central/rev/7e31b3768b1e>

Group: layout-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 94 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1729642#c17)• 3 years ago |
|  | |

Not worth an ESR78 uplift IMO given that it's nearly EOL this bug is rated sec-moderate, but please nominate this for Beta and ESR91 approval when you get a chance. It grafts cleanly as-landed.

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[tracking-firefox93](/buglist.cgi?f1=cf_tracking_firefox93&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [93+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=93%2B)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1729642#c18)• 3 years ago |
|  | |

Comment on [attachment 9241185](/attachment.cgi?id=9241185 "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") [[details]](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers")

[Bug 1729642](/show_bug.cgi?id=1729642 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle") - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers

### Beta/Release Uplift Approval Request

* **User impact if declined**: Possible use-after-free (during shutdown), which could result in a crash (or possibly other effects?).
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: (fixes verified in ASAN build using reporter's testcase; no known STR for a standard build)
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Just defers shutdown of the service, in case there's still a Document that tries to use it
* **String changes made/needed**:
[Attachment #9241185](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") -
Flags: approval-mozilla-esr91?
[Attachment #9241185](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") -
Flags: approval-mozilla-beta?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a825222_329583)• 3 years ago |

[Attachment #9241186](/attachment.cgi?id=9241186&action=edit "Bug 1729642 - patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio") -
Flags: approval-mozilla-beta?

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1729642#c19)• 3 years ago |
|  | |

Comment on [attachment 9241185](/attachment.cgi?id=9241185 "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") [[details]](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers")

[Bug 1729642](/show_bug.cgi?id=1729642 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle") - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers

Approved for 93 beta 8, thanks.

[Attachment #9241185](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1064830_24572)• 3 years ago |

[Attachment #9241186](/attachment.cgi?id=9241186&action=edit "Bug 1729642 - patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1729642#c20)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1729642&comment_id=15577899 "1 revision") |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/982c4804f2f4>

<https://hg.mozilla.org/releases/mozilla-beta/rev/3a14ad94e70f>

[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1729642#c21)• 3 years ago |
|  | |

Comment on [attachment 9241185](/attachment.cgi?id=9241185 "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") [[details]](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers")

[Bug 1729642](/show_bug.cgi?id=1729642 "RESOLVED FIXED - SUMMARY: AddressSanitizer: heap-use-after-free PLDHashTable.cpp:619 in PLDHashTable::MakeEntryHandle") - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers

Approved for 91.2esr.

[Attachment #9241185](/attachment.cgi?id=9241185&action=edit "Bug 1729642 - patch 1 - Make shutdown of nsLanguageAtomService explicit instead of relying on ClearOnShutdown. r=#platform-i18n-reviewers") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1070506_75935)• 3 years ago |

[Attachment #9241186](/attachment.cgi?id=9241186&action=edit "Bug 1729642 - patch 2 - Make nsContentUtils hold a strong reference to the nsNameSpaceManager. r=emilio") -
Flags: approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1729642#c22)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/c0c30730a063>

<https://hg.mozilla.org/releases/mozilla-esr91/rev/53441d71908f>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1382861_458186)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1761413_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1768612_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main93+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1769301_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main93+] → [reporter-external] [client-bounty-form] [verif?][adv-main93+][adv-esr91.2+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1729642#c23)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9243769)
— [Details](attachment.cgi?id=9243769&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a1932005_578488)• 3 years ago |

Alias: CVE-2021-38498

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a3585984_406194)• 3 years ago |

Blocks: [1727259](/show_bug.cgi?id=1727259 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free in PLDHashTable::Search via nsNameSpaceManager::RegisterNameSpace")See Also: [1727259](/show_bug.cgi?id=1727259 "RESOLVED FIXED - AddressSanitizer: heap-use-after-free in PLDHashTable::Search via nsNameSpaceManager::RegisterNameSpace") →

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a10503280_75935)• 3 years ago |

Regressions: [1748520](/show_bug.cgi?id=1748520 "RESOLVED FIXED - High frequency valgrind-test | 20 bytes in 1 blocks are definitely lost at malloc / moz_xmalloc / nsDynamicAtom::Create / nsAtomTable::Atomize")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a30470361_1689)• 2 years ago |

Group: core-security-release

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a67936687_75935)• 1 year ago |

Regressions: [1856084](/show_bug.cgi?id=1856084 "RESOLVED FIXED - Assertion failure: gAtomTable, at /builds/worker/checkouts/gecko/xpcom/ds/nsAtomTable.cpp:450")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1729642#a85999215_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1729642&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [m.cooolie](/user_profile?user_id=689709)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_a2d91c0e_20250114_184108.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-45

## Security Vulnerabilities fixed in Firefox ESR 91.2

Announced
October 5, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.2

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-38501: Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_4cca222d_20250114_184107.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-43

## Security Vulnerabilities fixed in Firefox 93

Announced
October 5, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 93

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-43535: Use-after-free in HTTP2 Session object](#CVE-2021-43535)

Reporter
Julien Cristau
Impact
high
##### Description

A use-after-free could have occured when an HTTP2 session object was released on a different thread, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1667102](https://bugzilla.mozilla.org/show_bug.cgi?id=1667102)

#### [#CVE-2021-38501: Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

#### [#CVE-2021-38499: Memory safety bugs fixed in Firefox 93](#CVE-2021-38499)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Julien Cristau, Christian Holler reported memory safety bugs present in Firefox 92. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1723170%2C1725356%2C1727364)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


