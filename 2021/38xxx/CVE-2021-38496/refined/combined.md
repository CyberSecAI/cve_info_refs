=== Content from www.debian.org_c71d4ad5_20250114_232647.html ===


---

[Date Prev][[Date Next](msg00001.html)]
[Thread Prev][[Thread Next](msg00001.html)]
[[Date Index](maillist.html#00000)]
[[Thread Index](threads.html#00000)]

# [SECURITY] [DSA 5034-1] thunderbird security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5034-1] thunderbird security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Sun, 2 Jan 2022 17:01:50 +0000
* *Message-id*: <[[üîé]](/msgid-search/20220102170150.GA31860%40seger.debian.org)¬†[20220102170150.GA31860@seger.debian.org](msg00000.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5034-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
January 02, 2022                      <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : thunderbird
CVE ID         : CVE-2021-4126 CVE-2021-38496 CVE-2021-38500 CVE-2021-38502
                 CVE-2021-38503 CVE-2021-38504 CVE-2021-38506 CVE-2021-38507
                 CVE-2021-38508 CVE-2021-38509 CVE-2021-43528 CVE-2021-43529
                 CVE-2021-43534 CVE-2021-43535 CVE-2021-43536 CVE-2021-43537
                 CVE-2021-43538 CVE-2021-43539 CVE-2021-43541 CVE-2021-43542
                 CVE-2021-43543 CVE-2021-43545 CVE-2021-43546 CVE-2021-44538

Multiple security issues were discovered in Thunderbird, which could
result in the execution of arbitrary code, spoofing, information disclosure,
downgrade attacks on SMTP STARTTLS connections or misleading display of
OpenPGP/MIME signatures.

For the oldstable distribution (buster), these problems have been fixed
in version 1:91.4.1-1~deb10u1.

For the stable distribution (bullseye), these problems have been fixed in
version 1:91.4.1-1~deb11u1.

We recommend that you upgrade your thunderbird packages.

For the detailed security status of thunderbird please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/thunderbird>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmHR2XsACgkQEMKTtsN8
TjYd7w//ak0oRg6eCbfKob7RuhyUJ+6VsRhi4OUhuJBn78TsdwY6RWn63FZLqR0k
zUPM77KHdbL1dBE4Cphijqk8SQWAiWjKY0qceTA0QLJD3in9ZeyZQ3pGElynfRfQ
b42lYuAeo04CxKxgdrvHcLtDTfVFTWTUS7bwB7uzufu5AwflESPJuDW+e98nG0Nh
8lP/jBk6MpPJ4+smPQY2TeRyicd+a5C7JIe1dZAh7MhDJ+KJ2n1/1K3DUUR2eCo/
MYlw00nXs/Vr1BJxwWxSfl9ahxUcOWQWZ8SjtvIJTJXSjw1RoP+1Vefln7rpKgDH
2rUbsWJwS5B/83e2mDvsatgCZPNVsecMDrvWWVoctJm652pdqIAXvBxtyncoSm+S
Wmn5gdGec9IHXSUty1wO2pXrbfUKtr3H5qtyoesDBvhlXrYeyI5jNYTrO6V493le
j0WmZC0sypibI1jMOfOR68BYeDVl7kz737e6I4OoaNg4UUbXXBPgDOdFBaODt9ql
egTHI2wMCuszUBUo3PfVp1pyvb2Lnr27NisQNU2rvDV/MSXba3tsEUXj+ka4UVQZ
XcAUEcWKUVBn4utbJQJ81k3/KbVsAo0emN9cSM3z4opHpkmLGeyyvvPMwE8+Y/FM
RqFfsn4wRGDgwOZyGCWZ9NERvQ/r+DeBWp/Ca5Cw1fyho/4mFQY=
=jRWO
-----END PGP SIGNATURE-----

```

---



=== Content from lists.debian.org_b809ed9d_20250114_232645.html ===


---

[[Date Prev](msg00000.html)][[Date Next](msg00002.html)]
[[Thread Prev](msg00000.html)][[Thread Next](msg00002.html)]
[[Date Index](maillist.html#00001)]
[[Thread Index](threads.html#00001)]

# [SECURITY] [DLA 2874-1] thunderbird security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 2874-1] thunderbird security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Tue, 4 Jan 2022 11:10:10 +0100 (CET)
* *Message-id*: <[[üîé]](/msgid-search/20220104101010.737312AA2C8%40andromeda)¬†[20220104101010.737312AA2C8@andromeda](msg00001.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2874-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>               Emilio Pozuelo Monfort
January 04, 2022                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : thunderbird
Version        : 1:91.4.1-1~deb9u1
CVE ID         : CVE-2021-4126 CVE-2021-38496 CVE-2021-38500 CVE-2021-38502
                 CVE-2021-38503 CVE-2021-38504 CVE-2021-38506 CVE-2021-38507
                 CVE-2021-38508 CVE-2021-38509 CVE-2021-43528 CVE-2021-43529
                 CVE-2021-43534 CVE-2021-43535 CVE-2021-43536 CVE-2021-43537
                 CVE-2021-43538 CVE-2021-43539 CVE-2021-43541 CVE-2021-43542
                 CVE-2021-43543 CVE-2021-43545 CVE-2021-43546 CVE-2021-44538

Multiple security issues were discovered in Thunderbird, which could
result in the execution of arbitrary code, spoofing, information disclosure,
downgrade attacks on SMTP STARTTLS connections or misleading display of
OpenPGP/MIME signatures.

For Debian 9 stretch, these problems have been fixed in version
1:91.4.1-1~deb9u1.

We recommend that you upgrade your thunderbird packages.

For the detailed security status of thunderbird please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/thunderbird>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAmHUHP4ACgkQnUbEiOQ2
gwIdhhAAsYJeGaKX7EakOQSqKqWksvfDg41A+TA01hpygOvfipqGlJl4sBCFHtfm
vPY4w6A+RsJWPohOch+DMc9EfXOJ1ivMp0nMMky/8xYYksAQqeThtwBfm2wHWpGT
IZAtn5doZe/53P++ejD5xLnCC19oCdBbEHsPj3p6OWzEUByqfPZBAv02lA+0pqqo
Mga52gFMI6xy4wmeuQZGtKsyI/hujLbYHnp7Rb8+3uwisb7QkzeVod77z211pGon
ifobrw52Bfa0Cb1e9Xesg70TDsZlPPlUnqHaUC5pE+OxS0Vx1G4Eur1+wQ9ao4V8
djlJWhmj1+1wNlSJ91Fsk0UQ+y6cVli4MU5wzIufQ0TdN+hMjQD0nuCejnjhQjPc
YNK7jYUwM4+DFGswYdpvoNa2uNtKzsu7sZQW9kfeF7H2uLoJgAUdNRdKrNmUrofQ
C4E2CsI3wTQxE9gmWX+LRGKr9r6QF15es7KCEGuFlAToVCh/d6vXF0f9IaH0ZE05
6W4sfcYoj6HKHEcKONuh6codpRceKx6gPgh+2n0pdoUNNlz/AbO0is+SiIInILlI
dYSdTxPLK0fZxD+ufi2E9IaQ2VvRg0Y933pQvjn3xbCCk7xehM7TD55LlwfUWPGb
/ffeEgwsObhA0cmV3jN6+bvxM9Tbk7DSd4Q30fuqSy8od5Ih0i4=
=kFGv
-----END PGP SIGNATURE-----

```

---



=== Content from bugzilla.mozilla.org_0e6910a1_20250114_232643.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ¬∑
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary‚ñæ

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ‚ñæ

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1725335)
* [XML](/show_bug.cgi?ctype=xml&id=1725335)

Closed
[Bug 1725335](/show_bug.cgi?id=1725335)
(CVE-2021-38496)

Opened 3 years ago
Closed 3 years ago

# AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run

## Categories

### (Core :: IPC, task)

[Product:](/describecomponents.cgi?product=Core)

Core
‚ñæ

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
‚ñæ

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

task

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

93 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | [93+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=93%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=verified) |
| firefox-esr91 | [93+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=93%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified) |
| firefox91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=wontfix) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | [+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 | 93+ | verified |
| firefox-esr91 | 93+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox91 |  | wontfix |
| firefox92 |  | wontfix |
| firefox93 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: m.cooolie, Assigned: nika)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2afc3e713a960c7119ae73ca1cd5e8e?d=mm&size=40)  [m.cooolie](/user_profile?user_id=689709)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, reporter-external, sec-high, Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+][adv-esr78.15+][adv-esr91.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-38496

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+][adv-esr78.15+][adv-esr91.2+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2283617_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [poc.zip](/attachment.cgi?id=9235918)  [3 years ago](#c0)  [m.cooolie](/user_profile?user_id=689709)   72.04 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9235918&action=edit) |
| --- | --- | --- |
| [demo.mp4](/attachment.cgi?id=9235919)  [3 years ago](#c1)  [m.cooolie](/user_profile?user_id=689709)   1.76 MB, video/mp4 |  | [Details](/attachment.cgi?id=9235919&action=edit) |
| [Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers](/attachment.cgi?id=9237084)  [3 years ago](#c4)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr91+](#c17 "3 years ago")  dveditz : [sec-approval+](#c10 "3 years ago") | [Details](/attachment.cgi?id=9237084&action=edit) | [Review](/attachment.cgi?id=9237084) |
| [Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask](/attachment.cgi?id=9237856)  [3 years ago](#c9)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr78+](#a2802373_75935 "3 years ago") | [Details](/attachment.cgi?id=9237856&action=edit) | [Review](/attachment.cgi?id=9237856) |
| [advisory.txt](/attachment.cgi?id=9243763)  [3 years ago](#c22)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   212 bytes, text/plain |  | [Details](/attachment.cgi?id=9243763&action=edit) |
| [advisory.txt](/attachment.cgi?id=9243767)  [3 years ago](#c23)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   220 bytes, text/plain |  | [Details](/attachment.cgi?id=9243767&action=edit) |

Show Obsolete

Bottom ‚Üì
Tags ‚ñæ

* Reset

Timeline ‚ñæ

* Reset
* Collapse All
* Expand All
* Comments Only

|  | Multiple Authors |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1725335#c0)‚Ä¢ 3 years ago ‚Ä¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1725335&comment_id=15524659 "1 revision") |
|  | |

Attached file
[poc.zip](attachment.cgi?id=9235918)
‚Äî [Details](attachment.cgi?id=9235918&action=edit)

#Summary

AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run

#Reproduce

OS:Win10 X64

Firefox: Nightly 93.0a1 (2021-08-11) (64-bit)

step:

1. sudo python -m http.server 80
2. install node puppeteer-core (ffpuppet not work on windows)
3. node ff.test.js D:\firefox\_asan\target\firefox\firefox.exe <http://localhost/fuzz1/1628742733366/fuzz-00005.htm>
4. wait for 30s if not crashes try again

I will try to make a minicase.

#Type of crash

Tab process

#Analysis

MessageTask hold a raw pointer to MessageChannel[1] with out correct observation object life cycle and used AT[2].

when mozilla::ShutdownXPCOM, PCompositorManagerChild destruct will free the mChannel[3] cause uaf.

```
[1]
ipc/glue/MessageChannel.h
553	MessageChannel* mChannel; // found in mozilla::ipc::MessageChannel::MessageTask

[2]
ipc/glue/MessageChannel.cpp
1844 mChannel->AssertWorkerThread(); // found in mozilla::ipc::MessageChannel::MessageTask::Run

[3]
ipc/glue/ProtocolUtils.h
555	MessageChannel mChannel; // found in mozilla::ipc::IToplevelProtocol

```

#Patch

Not Yet

#ASAN

```
=================================================================
==11116==ERROR: AddressSanitizer: heap-use-after-free on address 0x12778a4c5f88 at pc 0x7ff8e52cb16a bp 0x00dff11fd570 sp 0x00dff11fd5b8
READ of size 8 at 0x12778a4c5f88 thread T0
    #0 0x7ff8e52cb169 in mozilla::ipc::MessageChannel::MessageTask::Run /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1844
    #1 0x7ff8e3f2e75d in mozilla::RunnableTask::Run /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502
    #2 0x7ff8e3eeaae9 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805
    #3 0x7ff8e3ee692c in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641
    #4 0x7ff8e3ee72f0 in mozilla::TaskController::ProcessPendingMTTask /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425
    #5 0x7ff8e3f38bc1 in mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:138:7'>::Run /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:532
    #6 0x7ff8e3f0f71b in nsThread::ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1148
    #7 0x7ff8e3f1fffc in NS_ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:466
    #8 0x7ff8e3f0d41d in nsThread::Shutdown /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:840
    #9 0x7ff8e6e94a26 in mozilla::layers::ImageBridgeChild::ShutDown /builds/worker/checkouts/gecko/gfx/layers/ipc/ImageBridgeChild.cpp:489
    #10 0x7ff8e6f249b6 in gfxPlatform::ShutdownLayersIPC /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:1340
    #11 0x7ff8e3fafb8f in mozilla::ShutdownXPCOM /builds/worker/checkouts/gecko/xpcom/build/XPCOMInit.cpp:622
    #12 0x7ff8f1a0be30 in XRE_TermEmbedding /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:218
    #13 0x7ff8e52f4b98 in mozilla::ipc::ScopedXREEmbed::Stop /builds/worker/checkouts/gecko/ipc/glue/ScopedXREEmbed.cpp:90
    #14 0x7ff8f1a0cdff in XRE_InitChildProcess /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:753
    #15 0x7ff61d731f49 in NS_internal_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327
    #16 0x7ff61d7314d4 in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:131
    #17 0x7ff61d82f3f7 in __scrt_common_main_seh f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #18 0x7ff97f857033 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x180017033)
    #19 0x7ff980ee2650 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180052650)

0x12778a4c5f88 is located 264 bytes inside of 592-byte region [0x12778a4c5e80,0x12778a4c60d0)
freed by thread T0 here:
    #0 0x7ff94f755afb in free Z:\task_162801323523615\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_malloc_win.cpp:82
    #1 0x7ff8e55da72c in mozilla::layers::PCompositorManagerChild::~PCompositorManagerChild /builds/worker/workspace/obj-build/ipc/ipdl/PCompositorManagerChild.cpp:62
    #2 0x7ff8e52ece8e in mozilla::ipc::ActorLifecycleProxy::~ActorLifecycleProxy /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:280
    #3 0x7ff8e54b46d1 in mozilla::layers::PCompositorManagerParent::OnChannelClose /builds/worker/workspace/obj-build/ipc/ipdl/PCompositorManagerChild.cpp:596
    #4 0x7ff8e52d0945 in mozilla::ipc::MessageChannel::Close /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2580
    #5 0x7ff8e6e79061 in mozilla::layers::CompositorManagerChild::Shutdown /builds/worker/checkouts/gecko/gfx/layers/ipc/CompositorManagerChild.cpp:79
    #6 0x7ff8e6f249b1 in gfxPlatform::ShutdownLayersIPC /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:1339
    #7 0x7ff8e3fafb8f in mozilla::ShutdownXPCOM /builds/worker/checkouts/gecko/xpcom/build/XPCOMInit.cpp:622
    #8 0x7ff8f1a0be30 in XRE_TermEmbedding /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:218
    #9 0x7ff8e52f4b98 in mozilla::ipc::ScopedXREEmbed::Stop /builds/worker/checkouts/gecko/ipc/glue/ScopedXREEmbed.cpp:90
    #10 0x7ff8f1a0cdff in XRE_InitChildProcess /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:753
    #11 0x7ff61d731f49 in NS_internal_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327
    #12 0x7ff61d7314d4 in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:131
    #13 0x7ff61d82f3f7 in __scrt_common_main_seh f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #14 0x7ff97f857033 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x180017033)
    #15 0x7ff980ee2650 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180052650)

previously allocated by thread T0 here:
    #0 0x7ff94f755c0b in malloc Z:\task_162801323523615\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_malloc_win.cpp:98
    #1 0x7ff95ca1139d in moz_xmalloc /builds/worker/checkouts/gecko/memory/mozalloc/mozalloc.cpp:52
    #2 0x7ff8e6e78d34 in mozilla::layers::CompositorManagerChild::Init /builds/worker/checkouts/gecko/gfx/layers/ipc/CompositorManagerChild.cpp:65
    #3 0x7ff8ec883cde in mozilla::dom::ContentChild::RecvInitRendering /builds/worker/checkouts/gecko/dom/ipc/ContentChild.cpp:1542
    #4 0x7ff8e5533a67 in mozilla::dom::PContentChild::OnMessageReceived /builds/worker/workspace/obj-build/ipc/ipdl/PContentChild.cpp:8826
    #5 0x7ff8e52cc854 in mozilla::ipc::MessageChannel::DispatchAsyncMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2051
    #6 0x7ff8e52c8cbf in mozilla::ipc::MessageChannel::DispatchMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1978
    #7 0x7ff8e52cab3c in mozilla::ipc::MessageChannel::RunMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1826
    #8 0x7ff8e52cb0ec in mozilla::ipc::MessageChannel::MessageTask::Run /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1857
    #9 0x7ff8e3f2e75d in mozilla::RunnableTask::Run /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:502
    #10 0x7ff8e3eeaae9 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:805
    #11 0x7ff8e3ee692c in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:641
    #12 0x7ff8e3ee72f0 in mozilla::TaskController::ProcessPendingMTTask /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:425
    #13 0x7ff8e3f38ba1 in mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:135:7'>::Run /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:532
    #14 0x7ff8e3f0f71b in nsThread::ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1148
    #15 0x7ff8e3f1fffc in NS_ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:466
    #16 0x7ff8e52d5eae in mozilla::ipc::MessagePump::Run /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85
    #17 0x7ff8e51e41a5 in MessageLoop::RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324
    #18 0x7ff8e51e3f75 in MessageLoop::Run /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306
    #19 0x7ff8ed40cfda in nsBaseAppShell::Run /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137
    #20 0x7ff8ed5f410b in nsAppShell::Run /builds/worker/checkouts/gecko/widget/windows/nsAppShell.cpp:603
    #21 0x7ff8f1a0d934 in XRE_RunAppShell /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:917
    #22 0x7ff8e51e41a5 in MessageLoop::RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324
    #23 0x7ff8e51e3f75 in MessageLoop::Run /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306
    #24 0x7ff8f1a0cdc7 in XRE_InitChildProcess /builds/worker/checkouts/gecko/toolkit/xre/nsEmbedFunctions.cpp:749
    #25 0x7ff61d731f49 in NS_internal_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:327
    #26 0x7ff61d7314d4 in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:131
    #27 0x7ff61d82f3f7 in __scrt_common_main_seh f:\dd\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #28 0x7ff97f857033 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x180017033)

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run
Shadow bytes around the buggy address:
  0x049a7b918ba0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x049a7b918bb0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x049a7b918bc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x049a7b918bd0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x049a7b918be0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x049a7b918bf0: fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x049a7b918c00: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x049a7b918c10: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa
  0x049a7b918c20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x049a7b918c30: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x049a7b918c40: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==11116==ABORTING

```
Flags: sec-bounty?

|  | [m.cooolie](/user_profile?user_id=689709)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1725335#c1)‚Ä¢ 3 years ago |
|  | |

Attached video
[demo.mp4](attachment.cgi?id=9235919)
‚Äî [Details](attachment.cgi?id=9235919&action=edit)

Reproduce video

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a36284_159069)‚Ä¢ 3 years ago |

Group: firefox-core-security ‚Üí dom-core-securityComponent: Security ‚Üí IPCProduct: Firefox ‚Üí Core

|  | [Jed Davis [:jld] ‚ü®‚è∞|UTC-8‚ü© ‚ü¶he/him‚üß](/user_profile?user_id=462836) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1725335#c2)‚Ä¢ 3 years ago |
|  | |

Nika, you've been looking at MessageChannel lifecycle issues recently; any thoughts about this?

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1725335#c3)‚Ä¢ 3 years ago |
|  | |

I spent some time looking over the relevant code, and I think I might've found the source of the issue. It appears as though there are a few places where we iterate over `mPending` and remove entries which we want to process immediately. This is done without `Clear()`-ing the entries, and the entries are not skipped if `IsScheduled()`, which means that we could theoretically remove an entry which is still scheduled to be `Run()` at some point in these places: <https://searchfox.org/mozilla-central/rev/9dceacf3d761eb91237108ec438d64099a56f442/ipc/glue/MessageChannel.cpp#2774>, <https://searchfox.org/mozilla-central/rev/9dceacf3d761eb91237108ec438d64099a56f442/ipc/glue/MessageChannel.cpp#1298>. In addition we've got a few places where we pop tasks from the `mPending` queue, again without checking if `IsScheduled()`, and don't `Clear()` the tasks there either: <https://searchfox.org/mozilla-central/rev/9dceacf3d761eb91237108ec438d64099a56f442/ipc/glue/MessageChannel.cpp#2710-2714>, <https://searchfox.org/mozilla-central/rev/9dceacf3d761eb91237108ec438d64099a56f442/ipc/glue/MessageChannel.cpp#1623-1627>.

These removed tasks are not `Clear()`-ed, so if the channel is destroyed after they're removed but before they're `Run()`, we'll access `mChannel` to lock `mMonitor` before checking `isInList`, and will crash before we notice we've been cancelled. This could be potentially fixed by calling `Clear()` in more places, but I think it'd be simpler to remove the need for two functions by caching a pointer to `mMonitor` in the task itself, and locking it to check `isInList()` before accessing the `mChannel` member. That way we'll never try to access the channel unless we know that the `MessageTask` has not been cancelled & removed from `mPending`.

I'll attach a patch which makes my suggested changes.

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1725335#c4)‚Ä¢ 3 years ago |
|  | |

Attached file
[Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers](attachment.cgi?id=9237084)
‚Äî [Details](attachment.cgi?id=9237084&action=edit)

This simplifies the logic around MessageTask's lifecycle to make

ownership as clear as possible and reduce the number of redundant

checks.

This new change no longer clears the mChannel member when the

MessageTask is disconnected, instead relying on isInList() to check

whether the MessageTask is still in the channel's mPending list. This is

already being automatically managed as the mPending list is modified,

and should avoid potential usage mistakes.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a638559_600971)‚Ä¢ 3 years ago |

Assignee: nobody ‚Üí nika

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1725335#c5)‚Ä¢ 3 years ago |
|  | |

Thanks Nika!

It sounds like this is a general issue with IPC lifetime management and not just a layers shutdown issue, so I'll mark it sec-high.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a638736_406194)‚Ä¢ 3 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a638780_406194)‚Ä¢ 3 years ago |

Status: UNCONFIRMED ‚Üí NEW
[status-firefox91](/buglist.cgi?f1=cf_status_firefox91&o1=isnotempty):
--- ‚Üí [wontfix](/buglist.cgi?f1=cf_status_firefox91&o1=equals&v1=wontfix)
[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- ‚Üí [affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- ‚Üí [affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- ‚Üí [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- ‚Üí [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)Ever confirmed: true

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1725335#c6)‚Ä¢ 3 years ago |
|  | |

Given that we're nearly into RC week for Fx92/91.1esr/78.14esr at this point, I think we should target landing this in the next cycle. Note that ESR78 will require a rebased patch as well.

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=affected) ‚Üí [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[tracking-firefox93](/buglist.cgi?f1=cf_tracking_firefox93&o1=isnotempty):
--- ‚Üí [+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B)
[tracking-firefox-esr78](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=isnotempty):
--- ‚Üí [93+](/buglist.cgi?f1=cf_tracking_firefox_esr78&o1=equals&v1=93%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- ‚Üí [93+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=93%2B)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1725335#c7)‚Ä¢ 3 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #6](/show_bug.cgi?id=1725335#c6 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run"))

> Given that we're nearly into RC week for Fx92/91.1esr/78.14esr at this point, I think we should target landing this in the next cycle. Note that ESR78 will require a rebased patch as well.

This patch might be quite difficult to uplift to ESR78 due to the IPC architecture changes made since then

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1725335#c8)‚Ä¢ 3 years ago |
|  | |

Comment on [attachment 9237084](/attachment.cgi?id=9237084 "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") [[details]](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers")

[Bug 1725335](/show_bug.cgi?id=1725335 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run") - Streamline ownership and locking in MessageTask, r=#ipc-reviewers

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: I expect it would be somewhat difficult to create an exploit based on this patch due to the requirement of understanding how the interrupt handling system in MessageChannel works. I don't think that the patch paints a bulls-eye on the problem, though an observant reader could probably find it based on the patch.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: I originally thought this would be difficult to uplift, however it does appear that the patch applies cleanly on release, and with some small tweaks should apply to ESR78. I don't know if it will be as effective there (I haven't memorized all of the IPC changes since then), but I'll attach an ESR78-rebased version of the build.
* **How likely is this patch to cause regressions; how much testing does it need?**: I think this should be unlikely to cause regressions, but it is possible that I overlooked something.
[Attachment #9237084](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") -
Flags: sec-approval?

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1725335#c9)‚Ä¢ 3 years ago |
|  | |

Attached file
[Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask](attachment.cgi?id=9237856)
‚Äî [Details](attachment.cgi?id=9237856&action=edit)

This simplifies the logic around MessageTask's lifecycle to make

ownership as clear as possible and reduce the number of redundant

checks.

This new change no longer clears the mChannel member when the

MessageTask is disconnected, instead relying on isInList() to check

whether the MessageTask is still in the channel's mPending list. This is

already being automatically managed as the mPending list is modified,

and should avoid potential usage mistakes.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1725335#c10)‚Ä¢ 3 years ago |
|  | |

Comment on [attachment 9237084](/attachment.cgi?id=9237084 "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") [[details]](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers")

[Bug 1725335](/show_bug.cgi?id=1725335 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run") - Streamline ownership and locking in MessageTask, r=#ipc-reviewers

a=dveditz

Pretty obvious a race is involved from the patch, so maybe better to land this on nightly now and ride the upcoming merge to beta than to wait. Let's wait a couple of weeks on the ESR-78/ESR-91 uplifts, though.

[Attachment #9237084](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") -
Flags: sec-approval? ‚Üí sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1725335#c11)‚Ä¢ 3 years ago |
|  | |

Streamline ownership and locking in MessageTask, r=ipc-reviewers,mccr8

<https://hg.mozilla.org/integration/autoland/rev/de92d70a4e19441e7047639347cd35ce4d11bd1f>

<https://hg.mozilla.org/mozilla-central/rev/de92d70a4e19>

Group: dom-core-security ‚Üí core-security-releaseStatus: NEW ‚Üí RESOLVEDClosed: 3 years ago
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected) ‚Üí [fixed](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=fixed)Resolution: --- ‚Üí FIXEDTarget Milestone: --- ‚Üí 93 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a2283617_1689)‚Ä¢ 3 years ago |

Flags: sec-bounty? ‚Üí sec-bounty+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1725335#c12)‚Ä¢ 3 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1725335) to reply.

Flags: needinfo?(nika)Whiteboard: [reporter-external] [client-bounty-form] [verif?] ‚Üí [reporter-external] [client-bounty-form] [verif?][sec-survey]

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a2505272_551058)‚Ä¢ 3 years ago |

Flags: qe-verify+

|  | [m.cooolie](/user_profile?user_id=689709)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1725335#c13)‚Ä¢ 3 years ago |
|  | |

Please credit to yangkang(@dnpushme) of 360 ATA Team.

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a2528330_534482)‚Ä¢ 3 years ago |

Flags: needinfo?(nika)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1725335#c14)‚Ä¢ 3 years ago |
|  | |

Are we ready to uplift this to the esr branches?

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1725335#c15)‚Ä¢ 3 years ago |
|  | |

Comment on [attachment 9237084](/attachment.cgi?id=9237084 "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") [[details]](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers")

[Bug 1725335](/show_bug.cgi?id=1725335 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run") - Streamline ownership and locking in MessageTask, r=#ipc-reviewers

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: Potential security vulnerability due to UAF during shutdown of process actors
* **Fix Landed on Version**: 93
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The code hasn't changed much since 91 so the patch should apply cleanly as-is, and an uplift to 78 appeared to work more cleanly than I expected. An uplift to 78 may be a bit more risky due to the larger difference in time between when the patch was written and the original version, and less testing being done on that architecture
* **String or UUID changes made by this patch**: None
Flags: needinfo?(nika)
[Attachment #9237084](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") -
Flags: approval-mozilla-esr91?

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1725335#c16)‚Ä¢ 3 years ago |
|  | |

Comment on [attachment 9237856](/attachment.cgi?id=9237856 "Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask") [[details]](/attachment.cgi?id=9237856&action=edit "Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask")

[Bug 1725335](/show_bug.cgi?id=1725335 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run") - (ESR78) Streamline ownership and locking in MessageTask

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: See above
* **Fix Landed on Version**: 93
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: See above
* **String or UUID changes made by this patch**: None
[Attachment #9237856](/attachment.cgi?id=9237856&action=edit "Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask") -
Flags: approval-mozilla-esr78?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1725335#c17)‚Ä¢ 3 years ago |
|  | |

Comment on [attachment 9237084](/attachment.cgi?id=9237084 "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") [[details]](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers")

[Bug 1725335](/show_bug.cgi?id=1725335 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run") - Streamline ownership and locking in MessageTask, r=#ipc-reviewers

Approved for 91.2esr and 78.15esr.

[Attachment #9237084](/attachment.cgi?id=9237084&action=edit "Bug 1725335 - Streamline ownership and locking in MessageTask, r=#ipc-reviewers") -
Flags: approval-mozilla-esr91? ‚Üí approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a2802373_75935)‚Ä¢ 3 years ago |

[Attachment #9237856](/attachment.cgi?id=9237856&action=edit "Bug 1725335 - (ESR78) Streamline ownership and locking in MessageTask") -
Flags: approval-mozilla-esr78? ‚Üí approval-mozilla-esr78+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1725335#c18)‚Ä¢ 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/52b7f4545113>

<https://hg.mozilla.org/releases/mozilla-esr78/rev/c9b24377a173>

[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) ‚Üí [fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) ‚Üí [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a3017355_551058)‚Ä¢ 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1725335#c19)‚Ä¢ 3 years ago |
|  | |

Hi m.cooolie! I've tried to reproduce this bug using your steps from [comment 0](/show_bug.cgi?id=1725335#c0 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run"). Unfortunately, I was not able to follow the step 3, it seems that `ff.test.js` is missing from the poc file. Instead, I've tried loading the `poc.html` on a affected asan Nightly build (20210818155306), via a local HTTP python server, but I didn't encounter any tab crashes.

Could you please help us verify if this issue is fixed on you end with the following Firefox builds:

* Beta 93 <https://www.mozilla.org/en-US/firefox/channel/desktop/>
* Esr 78.15 <https://treeherder.mozilla.org/jobs?repo=mozilla-esr78&revision=c9b24377a1737cc8104c356a4cb1581ed1e0ea07>
* Esr 91.2 <https://treeherder.mozilla.org/jobs?repo=mozilla-esr91&revision=f5782767645c62e908c9abb0cabd957044e30b7e>
Flags: needinfo?(m.cooolie)

|  | [m.cooolie](/user_profile?user_id=689709)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1725335#c20)‚Ä¢ 3 years ago |
|  | |

(In reply to Ciprian Georgiu [:ciprian\_georgiu], Release Desktop QA from [comment #19](/show_bug.cgi?id=1725335#c19 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run"))

> Hi m.cooolie! I've tried to reproduce this bug using your steps from [comment 0](/show_bug.cgi?id=1725335#c0 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run"). Unfortunately, I was not able to follow the step 3, it seems that `ff.test.js` is missing from the poc file. Instead, I've tried loading the `poc.html` on a affected asan Nightly build (20210818155306), via a local HTTP python server, but I didn't encounter any tab crashes.
>
> Could you please help us verify if this issue is fixed on you end with the following Firefox builds:
>
> * Beta 93 <https://www.mozilla.org/en-US/firefox/channel/desktop/>
> * Esr 78.15 <https://treeherder.mozilla.org/jobs?repo=mozilla-esr78&revision=c9b24377a1737cc8104c356a4cb1581ed1e0ea07>
> * Esr 91.2 <https://treeherder.mozilla.org/jobs?repo=mozilla-esr91&revision=f5782767645c62e908c9abb0cabd957044e30b7e>

My test show uaf was not reproduced.

Flags: needinfo?(m.cooolie)

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1725335#c21)‚Ä¢ 3 years ago |
|  | |

Thanks m.coolie! I'll close this as verified fixed per [comment 20](/show_bug.cgi?id=1725335#c20 "VERIFIED FIXED - AddressSanitizer: heap-use-after-free MessageChannel.cpp:1844 in mozilla::ipc::MessageChannel::MessageTask::Run").

Status: RESOLVED ‚Üí VERIFIED
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=fixed) ‚Üí [verified](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=verified)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=fixed) ‚Üí [verified](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=verified)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) ‚Üí [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified)Flags: qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a4104724_578488)‚Ä¢ 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey] ‚Üí [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a4105992_578488)‚Ä¢ 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+] ‚Üí [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+][adv-esr78.15+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a4106153_578488)‚Ä¢ 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+][adv-esr78.15+] ‚Üí [reporter-external] [client-bounty-form] [verif?][sec-survey][adv-main93+][adv-esr78.15+][adv-esr91.2+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1725335#c22)‚Ä¢ 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9243763) (obsolete)
‚Äî [Details](attachment.cgi?id=9243763&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1725335#c23)‚Ä¢ 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9243767)
‚Äî [Details](attachment.cgi?id=9243767&action=edit)

[Attachment #9243763](/attachment.cgi?id=9243763&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a4268818_578488)‚Ä¢ 3 years ago |

Alias: CVE-2021-38496

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a32807285_1689)‚Ä¢ 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1725335#a88336094_5898)‚Ä¢ 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1725335&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ‚Üë

## Attachment

Hide Details

### General

Creator:  [m.cooolie](/user_profile?user_id=689709)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_d14a1c2f_20250114_232651.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we‚Äôd like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured ‚Äî we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-44

## Security Vulnerabilities fixed in Firefox ESR 78.15

Announced
October 5, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 78.15

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38500: Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation‚Äôs](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ¬©1998‚Äì2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_4cca222d_20250114_232650.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we‚Äôd like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured ‚Äî we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-43

## Security Vulnerabilities fixed in Firefox 93

Announced
October 5, 2021
Impact
high
Products
Firefox
Fixed in

* Firefox 93

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-43535: Use-after-free in HTTP2 Session object](#CVE-2021-43535)

Reporter
Julien Cristau
Impact
high
##### Description

A use-after-free could have occured when an HTTP2 session object was released on a different thread, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1667102](https://bugzilla.mozilla.org/show_bug.cgi?id=1667102)

#### [#CVE-2021-38501: Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

#### [#CVE-2021-38499: Memory safety bugs fixed in Firefox 93](#CVE-2021-38499)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Julien Cristau, Christian Holler reported memory safety bugs present in Firefox 92. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1723170%2C1725356%2C1727364)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation‚Äôs](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ¬©1998‚Äì2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_a2d91c0e_20250114_232653.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we‚Äôd like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured ‚Äî we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-45

## Security Vulnerabilities fixed in Firefox ESR 91.2

Announced
October 5, 2021
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.2

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93, Firefox ESR 78.15, and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-38501: Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Firefox 92 and Firefox ESR 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 93 and Firefox ESR 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation‚Äôs](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ¬©1998‚Äì2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_5df6384f_20250114_232656.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we‚Äôd like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured ‚Äî we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2021-47

## Security Vulnerabilities fixed in Thunderbird 91.2

Announced
October 6, 2021
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.2

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2021-38502: Downgrade attack on SMTP STARTTLS connections](#CVE-2021-38502)

Reporter
Mattias Jacobsson
Impact
high
##### Description

Thunderbird ignored the configuration to require STARTTLS security for an SMTP connection. A MITM could perform a downgrade attack to intercept transmitted messages, or could take control of the authenticated session to execute SMTP commands chosen by the MITM. If an unprotected authentication method was configured, the MITM could obtain the authentication credentials, too.

##### References

* [Bug 1733366](https://bugzilla.mozilla.org/show_bug.cgi?id=1733366)

#### [#CVE-2021-38496: Use-after-free in MessageTask](#CVE-2021-38496)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

During operations on MessageTasks, a task may have been removed while it was still scheduled, resulting in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1725335](https://bugzilla.mozilla.org/show_bug.cgi?id=1725335)

#### [#CVE-2021-38497: Validation message could have been overlaid on another origin](#CVE-2021-38497)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

Through use of `reportValidity()` and `window.open()`, a plain-text validation message could have been overlaid on another origin, leading to possible user confusion and spoofing attacks.

##### References

* [Bug 1726621](https://bugzilla.mozilla.org/show_bug.cgi?id=1726621)

#### [#CVE-2021-38498: Use-after-free of nsLanguageAtomService object](#CVE-2021-38498)

Reporter
Yangkang of 360 ATA Team
Impact
moderate
##### Description

During process shutdown, a document could have caused a use-after-free of a languages service object, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1729642](https://bugzilla.mozilla.org/show_bug.cgi?id=1729642)

#### [#CVE-2021-32810: Data race in crossbeam-deque](#CVE-2021-32810)

Reporter
Maor Kleinberger
Impact
moderate
##### Description

In the crossbeam crate, one or more tasks in the worker queue could have been be popped twice instead of other tasks that are forgotten and never popped. If tasks are allocated on the heap, this could have caused a double free and a memory leak.

##### References

* [Bug 1729813](https://bugzilla.mozilla.org/show_bug.cgi?id=1729813)
* [Bug https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw](https://github.com/crossbeam-rs/crossbeam/security/advisories/GHSA-pqqp-xmhj-wgcw)

#### [#CVE-2021-38500: Memory safety bugs fixed in Thunderbird 91.2](#CVE-2021-38500)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Andreas Pehrson and Christian Holler reported memory safety bugs present in Thunderbird 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1725854%2C1728321)

#### [#CVE-2021-38501: Memory safety bugs fixed in Thunderbird 91.2](#CVE-2021-38501)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and community members Kevin Brosnan, Mihai Alexandru Michis, and Christian Holler reported memory safety bugs present in Thunderbird 91.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685354%2C1715755%2C1723176)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation‚Äôs](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ¬©1998‚Äì2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


