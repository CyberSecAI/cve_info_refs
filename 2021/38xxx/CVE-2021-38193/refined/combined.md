=== Content from rustsec.org_7e033e47_20250114_233521.html ===


RUSTSEC-2021-0074: ammonia: Incorrect handling of embedded SVG and MathML leads to mutation XSS › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/ammonia/RUSTSEC-2021-0074.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/ammonia/RUSTSEC-2021-0074.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0074)

# RUSTSEC-2021-0074

Incorrect handling of embedded SVG and MathML leads to mutation XSS

Reported
July 8, 2021

Issued
July 8, 2021

(last modified: June 13, 2023)

Package
[ammonia](/packages/ammonia.html)
([crates.io](https://crates.io/crates/ammonia))

Type
Vulnerability

Categories

* [format-injection](/categories/format-injection.html)

Keywords
[#html](/keywords/html.html)
[#xss](/keywords/xss.html)

Aliases

* [CVE-2021-38193](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-38193)
* [GHSA-5325-xw5m-phm3](https://github.com/advisories/GHSA-5325-xw5m-phm3)

References

* <https://github.com/rust-ammonia/ammonia/pull/142>

Patched

* `>=3.1.0`
* `>=2.1.3, <3.0.0`

### Description

Affected versions of this crate did not account for namespace-related parsing
differences between HTML, SVG, and MathML. Even if the `svg` and `math` elements
are not allowed, the underlying HTML parser still treats them differently.
Running cleanup without accounting for these differing namespaces resulted in an "impossible"
DOM, which appeared "safe" when examining the DOM tree, but when serialized and deserialized,
could be exploited to inject arbitrary markup.

To exploit this, the application using this library must allow a tag that is parsed as raw text in HTML.
These [elements](https://github.com/servo/html5ever/blob/57eb334c0ffccc6f88d563419f0fbeef6ff5741c/html5ever/src/tree_builder/rules.rs) are:

* title
* textarea
* xmp
* iframe
* noembed
* noframes
* plaintext
* noscript
* style
* script

Applications that do not explicitly allow any of these tags should not be affected, since none are allowed by default.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.



=== Content from raw.githubusercontent.com_337aeaf2_20250114_233519.html ===
```toml
[advisory]
id = "RUSTSEC-2021-0074"
package = "ammonia"
date = "2021-07-08"
url = "https://github.com/rust-ammonia/ammonia/pull/142"
categories = ["format-injection"]
keywords = ["html", "xss"]
aliases = ["CVE-2021-38193", "GHSA-5325-xw5m-phm3"]
[versions]
patched = [">= 3.1.0", ">= 2.1.3, < 3.0.0"]
```
# Incorrect handling of embedded SVG and MathML leads to mutation XSS
Affected versions of this crate did not account for namespace-related parsing
differences between HTML, SVG, and MathML. Even if the `svg` and `math` elements
are not allowed, the underlying HTML parser still treats them differently.
Running cleanup without accounting for these differing namespaces resulted in an "impossible"
DOM, which appeared "safe" when examining the DOM tree, but when serialized and deserialized,
could be exploited to inject arbitrary markup.
To exploit this, the application using this library must allow a tag that is parsed as raw text in HTML.
These [elements] are:
\* title
\* textarea
\* xmp
\* iframe
\* noembed
\* noframes
\* plaintext
\* noscript
\* style
\* script
Applications that do not explicitly allow any of these tags should not be affected, since none are allowed by default.
[elements]: https://github.com/servo/html5ever/blob/57eb334c0ffccc6f88d563419f0fbeef6ff5741c/html5ever/src/tree\_builder/rules.rs

