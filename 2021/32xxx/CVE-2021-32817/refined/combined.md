=== Content from www.npmjs.com_71d35cb0_20250115_082351.html ===

skip to:[content](#main)[package search](#search)[sign in](#signin)â¤

* [Pro](/products/pro)
* [Teams](/products/teams)
* [Pricing](/products)
* [Documentation](https://docs.npmjs.com)
npmSearch[Sign Up](/signup)[Sign In](/login)
## express-hbs

2.5.0Â â¢Â PublicÂ â¢Â Published a year ago

* [Readme](?activeTab=readme)
* [Code Beta](?activeTab=code)
* [3 Dependencies](?activeTab=dependencies)
* [148 Dependents](?activeTab=dependents)
* [57 Versions](?activeTab=versions)

# express-hbs

Express handlebars template engine with multiple layouts, blocks and cached partials.

## v2.0.0

Version 2 was a rewrite and cleanup, with no known breaking changes. Lots of bugs were fixed which may have subtly changed behaviour.

Full details: <https://github.com/TryGhost/express-hbs/releases/tag/2.0.0>

## v1.0.0 Breaking Changes

If you're upgrading from v0.8.4 to v1.0.0 there are some potentially breaking changes to be aware of:

1. Handlebars @v4.0.5 - please see the [handlebars v4.0 compatibility notes](https://github.com/wycats/handlebars.js/blob/master/release-notes.md#v400---september-1st-2015)
2. The file extension for partial files must now match the extension configured in `extname` - please see [the PR](https://github.com/TryGhost/express-hbs/pull/88)

## Usage

To use with express 4.

```
var hbs = require('express-hbs');

// Use `.hbs` for extensions and find partials in `views/partials`.
app.engine('hbs', hbs.express4({
  partialsDir: __dirname + '/views/partials'
}));
app.set('view engine', 'hbs');
app.set('views', __dirname + '/views');
```

To use with express 3 is the same as above, except use hbs.express3

```
app.engine('hbs', hbs.express3({
  partialsDir: __dirname + '/views/partials'
}));
```

Options for `#express3` and `#express4`

```
hbs.express4({
  partialsDir: "{String/Array} [Required] Path to partials templates, one or several directories",

  // OPTIONAL settings
  restrictLayoutsTo: "{String} Absolute path to a directory to restrict layout directive reading from",
  blockHelperName: "{String} Override 'block' helper name.",
  contentHelperName: "{String} Override 'contentFor' helper name.",
  defaultLayout: "{String} Absolute path to default layout template",
  extname: "{String} Extension for templates & partials, defaults to `.hbs`",
  handlebars: "{Module} Use external handlebars instead of express-hbs dependency",
  i18n: "{Object} i18n object",
  layoutsDir: "{String} Path to layout templates",
  templateOptions: "{Object} options to pass to template()",
  beautify: "{Boolean} whether to pretty print HTML, see github.com/einars/js-beautify .jsbeautifyrc",

  // override the default compile
  onCompile: function(exhbs, source, filename) {
    var options;
    if (filename && filename.indexOf('partials') > -1) {
      options = {preventIndent: true};
    }
    return exhbs.handlebars.compile(source, options);
  }
});
```
## Syntax

To mark where layout should insert page

```
{{{body}}}

```

To declare a block placeholder in layout

```
{{{block "pageScripts"}}}

```

To define block content in a page

```
{{#contentFor "pageScripts"}}
  CONTENT HERE
{{/contentFor}}

```
## Layouts

There are three ways to use a layout, listed in precedence order

1. Declarative within a page. Use handlebars comment

   ```
   {{!< LAYOUT}}

   ```

   Layout file resolution:

   ```
   If path starts with '.'
       LAYOUT is relative to template
   Else If `layoutsDir` is set
       LAYOUT is relative to `layoutsDir`
   Else
       LAYOUT from path.resolve(dirname(template), LAYOUT)

   ```
2. As an option to render

   ## â ï¸ This creates a potential security vulnerability if used without a `restrictLayoutsTo`:

   The `restrictLayoutsTo` option will restrict reading layouts to a particular directory, if you do not pass this option then do not use the `layout` option in conjunction with passing user submitted data to res.render e.g. `res.render('index', req.query)`. This allows users to read arbitrary files from your filesystem!

   ```
   res.render('veggies', {
     title: 'My favorite veggies',
     veggies: veggies,
     layout: 'layout/veggie'
   });
   ```

   This option also allows for layout suppression (both the default layout and when specified declaratively in a page) by passing in a falsey Javascript value as the value of the `layout` property:

   ```
   res.render('veggies', {
     title: 'My favorite veggies',
     veggies: veggies,
     layout: null // render without using a layout template
   });
   ```

   Layout file resolution:

   ```
   If path starts with '.'
       layout is relative to template
   Else If `layoutsDir` is set
       layout is relative to `layoutsDir`
   Else
       layout from path.resolve(viewsDir, layout)

   ```
3. Lastly, use `defaultLayout` if specified in hbs configuration options.

Layouts can be nested: just include a declarative layout tag within any layout
template to have its content included in the declared "parent" layout. Be
aware that too much nesting can impact performances, and stay away from
infinite loops!

## Helpers

### Synchronous helpers

```
hbs.registerHelper('link', function(text, options) {
  var attrs = [];
  for(var prop in options.hash) {
    attrs.push(prop + '="' + options.hash[prop] + '"');
  }
  return new hbs.SafeString(
    "<a " + attrs.join(" ") + ">" + text + "</a>"
  );
});
```

in markup

```
{{{link 'barc.com' href='http://barc.com'}}}

```
### Asynchronous helpers

```
hbs.registerAsyncHelper('readFile', function(filename, cb) {
  fs.readFile(path.join(viewsDir, filename), 'utf8', function(err, content) {
    cb(new hbs.SafeString(content));
  });
});
```

in markup

```
{{{readFile 'tos.txt'}}}

```
## i18n support

Express-hbs supports [i18n](https://github.com/mashpie/i18n-node)

```
var i18n = require('i18n');

// minimal config
i18n.configure({
    locales: ['en', 'fr'],
    cookie: 'locale',
    directory: __dirname + "/locales"
});

app.engine('hbs', hbs.express3({
    // ... options from above
    i18n: i18n,  // registers __ and __n helpers
}));
app.set('view engine', 'hbs');
app.set('views', viewsDir);

// cookies are needed
app.use(express.cookieParser());

// init i18n module
app.use(i18n.init);
```
## Engine Instances

Create isolated engine instances with their own cache system and handlebars engine.

```
var hbs = require('express-hbs');
var instance1 = hbs.create();
var instance2 = hbs.create();
```
## Template options

The main use case for template options is setting the handlebars "data" object - this creates global template variables accessible with an `@` prefix.

Template options can be set in 3 ways. When setting global template options they can be [passed as config on creation of an instance](https://github.com/barc/express-hbs#usage), and they can also be updated used the `updateTemplateOptions(templateOptions)` method of an instance. To set template options for an individual request they can be set on `res.locals` using the helper method `updateLocalTemplateOptions(locals, templateOptions)`.

Both of these methods have a companion method `getTemplateOptions()` and `getLocalTemplateOptions(locals)`, which should be used when extending or merging the current options.

## Example

in File `app.js`

```
// http://expressjs.com/api.html#app.locals
app.locals({
    'PROD_MODE': 'production' === app.get('env')
});
```

File `views/layout/default.hbs`

```
<html>
  <head>
    <title>{{title}}</title>
    <link type="text/css" rel="stylesheet" href="/css/style.css"/>
    {{{block "pageStyles"}}}
  </head>
  <body>
    {{{body}}}

    {{> scripts}}

    {{#if PROD_MODE}}
    {{{block 'googleAnalyticsScripts'}}}
    {{/if}}

  </body>
</html>
```

File `views/index.hbs`

```
{{!< default}}

{{#contentFor 'pageStyles'}}
<style>
  .clicker {
    color: blue;
  };
</style>
{{/contentFor}}

<h1>{{title}}</h1>
<p class="clicker">Click me!</p>
```

To run example project

```
npm install -d
node example/app.js

```
## Testing

The test suite requires the `grunt-cli` package:

```
npm install -g grunt-cli
npm install -d

```

Once everything's installed, just run:

```
npm test

```
## Credits

Inspiration and code from [donpark/hbs](https://github.com/donpark/hbs)

Big thanks to all [CONTRIBUTORS](https://github.com/TryGhost/express-hbs/contributors)

## License

The MIT License (MIT)

Copyright (c) 2012-2023 Barc, Inc., Ghost Foundation - Released under the [MIT license](https://github.com/TryGhost/express-hbs/blob/HEAD/LICENSE).

## Readme

### Keywords

* [express4](/search?q=keywords:express4)
* [express](/search?q=keywords:express)
* [handlebars](/search?q=keywords:handlebars)
* [layout](/search?q=keywords:layout)
* [partials](/search?q=keywords:partials)
## Package Sidebar

### Install

`npm i express-hbs`

### Repository

[Gitgithub.com/TryGhost/express-hbs](https://github.com/TryGhost/express-hbs)

### Homepage

[github.com/TryGhost/express-hbs#readme](https://github.com/TryGhost/express-hbs#readme)

### DownloadsWeekly Downloads

10,291

### Version

2.5.0

### License

MIT

### Unpacked Size

88.8 kB

### Total Files

182

### Last publish

a year ago

### Collaborators

* [![zimoatghost](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci82NmRmYzQ5YWRiNGQwNDJiYzMyYTE3MzRiNDA5MGM3ZD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.TRbzd_6UeODbyhki6S5KWzMeKBoFazfGlamxHCS4g3Q "zimoatghost")](/~zimoatghost)
* [![allouis](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9kZmE1ZTE2MGMxODE2MjUyNWRlMTVkZDIyMzg5MjI3Nz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.RN7CsIlBEVnDVPFavXEQ1sxY18xlkl82hTEI2SAjRkc "allouis")](/~allouis)
* [![kernalghost](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9kMDM5ZTEyZDJiNGZhYmY1YzFiZjU2ZWNjMjZlYjc5Yz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.TckfXHNBeniidRoO7hbY3qDsZYH77IwIQAcLbMUn6os "kernalghost")](/~kernalghost)
* [![sanne-san](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9lYmRiNjU2NTRkN2IxYTgxNDg2YTAyYTdhMDc3ZjYyMD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.GXbWWMo1mZt4JOJ0xVY7ro_U-r-OfrET57w_QGq0TMk "sanne-san")](/~sanne-san)
* [![chrisraible](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8wMzIwNjA3OWZlOTdhZmUyYWNkMjBmMmYyMDc4YzFjMD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.KDHzt_UxRwmfjG8fj4l0lv98wJTRduS2zAaSJGInOhI "chrisraible")](/~chrisraible)
* [![erisds](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8xM2JjM2FlZDIyNmUzZDdiMGQyNjJlNTY2NDQ2OGY1MD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.9UlWFIKIJyUDUsD9SDctyg7a8XNZzI7BPW_S-CXEDVw "erisds")](/~erisds)
* [![johnonolan](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci83NWU5NThhNjY3NGE3ZDY4ZmUwZDU3NWZiMjM1MTE2Yz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.YiGfAbr3P0Xr7gLMJqZDGUppAe71YxaX_ZaAz39fy2U "johnonolan")](/~johnonolan)
* [![kevinansfield](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8zYWUwNDViYzE5OGExNTc0MDE4MjdjODQ1NWNkN2M5OT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.JDwAw1rktqp_1Lj89vXn5_6mOH45JiRKC0ww5z4UKOs "kevinansfield")](/~kevinansfield)
* [![cobbspur](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hYTU1ZDIzNmIyZmJjZDQyOWMwNGFmZjdmMWJmMDJmMD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.XJpnTZ1m-UtbrH8_julxobtuDejHvfF2ruNroyJUlyk "cobbspur")](/~cobbspur)
* [![aileencgn](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci84NWE0N2E2MGQ1Nzk1NzI2MDFmZjc0YjcyZmU4YjMyZD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.Za2aO9EgmDRiD-iNne6xq9y5MfXIc1__0Hsma_EPHbE "aileencgn")](/~aileencgn)
* [![jloh](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9hMGVlNWIwNDVmYmMxMzI3NTU0MjQ1M2IyYTk3MmQ5ZD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.yhWQGID7BkCXcsz33Qt57wfbnkizI1F_uBfVRp4gZME "jloh")](/~jloh)
* [![daniellockyer](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9jMzZiZGQzOGI4ZjVmZTZhYjE0Y2Q2MWVhZTQyZDllZT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.Ad3BPZ6dbaxCUj_tz14aijJ-GC_ruArrr6zzSX52rPc "daniellockyer")](/~daniellockyer)
* [![minimaluminium](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8zZGM3ZGUxYjNjMGU0ZDNkNmM1M2I3NTRmZDkyNzM2Yj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.xt-CLboNpKSVKrecmOb8mTRqXn5VhLSKXMuDxEKxPgU "minimaluminium")](/~minimaluminium)
* [![sam-lord](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9jZWUwOGMzYmJlOTY1ZDE3MzBhMjhkMWM3ODdkMGVlMz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.qRvlLSzlREZPWnwMFh4U8Ryat_EghEUonmr3EUX3Yw8 "sam-lord")](/~sam-lord)
* [![pauladamdavis](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci83M2JjMzZlZTJjMzA4YTI5YWZiY2ZmZGUyNTM1YTM2Mj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.F_hJLprwH1MSf1DWKkWeq2oQSq7FqpxbBVeHJRvOcDk "pauladamdavis")](/~pauladamdavis)
* [![bobvaneck](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9kOTQyOTk4MDBkM2JkY2RjNjU5MGM2NmY2YzNlNjM4MT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.ykUtvVJuDL1wOjykJ-8MyNvJVzIKW-SjDhzYI8QSxhY "bobvaneck")](/~bobvaneck)
* [![joeegrigg](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci84YzlhM2FjZDJhNjdlYTA1ZGUzMjU4YjcwNTEyYmJkNz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.tc4jxtbSmFygnvChFkALgv5nygPlZnIEANySNkAbyHA "joeegrigg")](/~joeegrigg)
* [![djordjevlais](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci81NjdjMTY5YTRhMmIyZGQ0NDAzZGJmOGE3M2FiYmM3NT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.HnSvWKFLVhx_ADGL_dEb4Nv_LlJHsfqWpbFxEat-E-c "djordjevlais")](/~djordjevlais)
* [![ronaldlangeveld](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci82Y2FhOTdjNjlkMjA4MWExYzM2NmY4Y2U1ZTRiMjkxZj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.km1EPHvR7IH4KICF2e5p8vIXMKG2mZQDxREYfkl3Rik "ronaldlangeveld")](/~ronaldlangeveld)
* [![hadret](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8yYzY5NjlkNDgyNmQxMmJkZTA5ZDI0MWRmMjI2MDVmMj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.0NXkz3oOeM7RNPQ9wL7QPFghJXC7c_pKbLKjvQk0Sik "hadret")](/~hadret)
* [![jonhickman](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci82YWQyMjVmZDg2M2JmMTZkOTkxOTJkNzlkN2I1YjRkMj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.ROCAVEP7MilEiwU-KCERPpZ_FgSrsnBnR1oZnxHZzdI "jonhickman")](/~jonhickman)
* [![erik-ghost](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci83YTE1NzEwZmRkZTc1MmRhM2ExYWYzYmQ1ZDYxMWI1Nz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.uXmYKqeJcNxxtGk3CczI3euPik2Ij3T_pJe8IaE1FLU "erik-ghost")](/~erik-ghost)
* [![sagzy](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8yNzQ0OWNjN2ZhM2YwNzJmYTAxYTk5NWE0ZWRjZjg3Mz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.VY19ExRgSzcxBvDHwrL3O4ZDab74Oxy94tQQ5_rsr-E "sagzy")](/~sagzy)
* [![dvdwinden](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8zODBlZGQ5MGM3MGY0ZjY4ZDRkZWVmODZlMzg2NTY1Zj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.fnsHiymxgHDochUrMcGlQMmOd5bhMCeV66nBPtlsdhw "dvdwinden")](/~dvdwinden)
* [![vershwal](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8yZTkxMzRlM2Y1NTk2ZDE3YjY3NzNlZTM0MmE5ZDU1ZD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.FYUiTTkwieUqP8gmHowBP0vitozY1dF9RS7vU7sJ_mI "vershwal")](/~vershwal)
* [![mike182uk](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci83MzBjMDNjN2VjZGJkNjU0MDI4YjNiZWI1ZjU5MjI5MD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.r1loDDKq2GIQVNATlTwC01oqpkvuXUVRmaLTWLX5-Ds "mike182uk")](/~mike182uk)
* [![9larsons](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9iMDRlYTFjMDY0MWE3NGRiNWUyMmVmZjFkM2JkZjY3Yz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.XbrcaQOT79hLq0HlOEq-smiUlYhmZFU8xN-TTn7R8Ec "9larsons")](/~9larsons)
* [![lsinger](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9kMmUwZTVmNmJmN2JmZTZlNDFkMDRiMzZkZDViZDdmMz9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.gHvjOMcYTLfYNc0gQIL4o-oNRcyREmcl1OxpPp4FjHc "lsinger")](/~lsinger)
* [![charliegilbert](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci80MmY2NzI3YjYxYWQwOGEyYWUzOGVhOTFmYjRlZDllZT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.OJO_cjFGt67u21yOV0KmQDwqbTyvBIDbDWzPBu8STOY "charliegilbert")](/~charliegilbert)
* [![jtwebman](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9lODdhMDU2YWJkNTJhNWQ4NWE0MjViMzljOTJiNGE3MD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.LWjmBPiZsK0xf46H_6hTe4bONNQK6g23wnKQPneyqsE "jtwebman")](/~jtwebman)
* [![kirrg001](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8yMjhjZjA2MmZhYzQyNzc1OTY4NjY3MDE2YzdkNDg5OT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.YHak-4C6NDHwMq7eOqXkLCFCyuwMxk6x5nK5r2HjcRk "kirrg001")](/~kirrg001)
[**Try** on RunKit](https://runkit.com/npm/express-hbs)[**Report** malware](/support?inquire=security&security-inquire=malware&package=express-hbs&version=2.5.0)
## Footer

### Support

* [Help](https://docs.npmjs.com)
* [Advisories](https://github.com/advisories)
* [Status](http://status.npmjs.org/)
* [Contact npm](/support)
### Company

* [About](/about)
* [Blog](https://github.blog/tag/npm/)
* [Press](/press)
### Terms & Policies

* [Policies](/policies/)
* [Terms of Use](/policies/terms)
* [Code of Conduct](/policies/conduct)
* [Privacy](/policies/privacy)



=== Content from securitylab.github.com_73844406_20250115_082349.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

May 14, 2021
# GHSL-2021-019: File disclosure in express-hbs - CVE-2021-32817

[![Author avatar](https://avatars.githubusercontent.com/u/102623)
Agustin Gianni](https://github.com/agustingianni)

## Coordinated Disclosure Timeline

* 01/25/2021: Report sent to maintainer
* 01/28/2021: Maintainer acknowledged report
* 04/22/2021: Maintainer added documentation warning users of the dangers of the pattern

## Executive Summary

[The Express render API](https://expressjs.com/en/api.html#res.render) was designed to only pass in template data. By allowing template engine configuration options to be passed through the Express render API directly, downstream users of an Express template engine may inadvertently introduce insecure behavior into their applications with impacts ranging from Cross Site Scripting (XSS) to Remote Code Execution (RCE).

## Technical Summary

[Express JS](https://expressjs.com/) allows developers to use a variety of template rendering engines. These engines substitute things inside the template by inspecting an object that the application has supplied. For example, the following snippet renders a template named “index” and passes an object with two elements, a title, and a message.

```

app.get('/', function (req, res) {
 res.render('index', { title: 'Hey', message: 'Hello there!' })
})

```

Template engines often need a way to set their configuration parameters, such as the path to the template directory, the name of the template, and other engine-specific parameters. To accomplish this many template engines have opted to receive their configuration options directly through the Express render API.

Passing template engine configuration parameters through the Express render API can lead to vulnerabilities if the object is user controlled. Downstream applications often opt to pass their template data in directly through the remote user-controlled `req.query` object. This results in a scenario where a remote attacker may be able to subvert the vulnerable application through malicious template engine configuration options.

The security impact is specific to the engine used by the application but ranges from XSS to RCE.

IMPORTANT: this is a library/engine level API misuse resulting in a **potential** vulnerability in downstream application code. Express did **not** intend for render engines to mix template data with configuration options in the same object. We have confirmed this in discussion with the ExpressJS team.

Real world downstream vulnerabilities manifest when applications pass a user controlled object (e.g. req.query) directly into a render engine that accepts config options through the Express render interface.

Our research has shown that this vulnerability pattern occurs in the wild and that many template engines are following this unintended Express render API pattern of use, resulting in an unknown number of affected downstream applications.

By reporting this API misuse at the engine level, we hope to capture this issue more broadly than trying to pursue every single affected application as well as prevent future API misuse.

## Product

express-hbs

## Tested Version

2.1.2

## Details

### Issue: template engine configuration options are passed through Express render API

Express-hbs mixes pure template data with engine configuration options through the Express render API. More specifically, the `layout` parameter may trigger file disclosure vulnerabilities in downstream applications.

This potential vulnerability is somewhat restricted in that only files with existing extentions (i.e. `file.extension`) can be included, files that lack an extension will have `.hbs` appended to them.

Example vulnerable application code:

```
const express = require('express')
const hbs = require('express-hbs')
const app = express()
const port = 3000

app.use(express.urlencoded({ extended: false }));
app.engine('hbs', hbs.express4({
   partialsDir: __dirname
}));

app.set('view engine', 'hbs');
app.set('views', __dirname);
app.get('/', (req, res) => {
   res.render('index', req.query)
})

app.listen(port, () => {
   console.log(`Example app listening at http://localhost:${port}`)
})

module.exports = app;

```

The following POC would retrieve the contents of the `/tmp/test.file` from a vulnerable application:

```
curl "http://localhost:3000?layout=/tmp/test.file"

```
#### Impact

File disclosure.

#### Resources

* <https://expressjs.com/en/api.html#res.render>
* <http://expressjs.com/en/guide/using-template-engines.html>
* <http://expressjs.com/en/advanced/developing-template-engines.html>

## CVE

* CVE-2021-32817

## Resources

* <https://github.com/TryGhost/express-hbs#layouts>

## Credit

This issue was discovered and reported by GHSL team member [@agustingianni (Agustin Gianni)](https://github.com/agustingianni).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2021-019` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_4a5ea69f_20250115_082346.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=TryGhost%2Fexpress-hbs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TryGhost](/TryGhost)
/
**[express-hbs](/TryGhost/express-hbs)**
Public

* [Notifications](/login?return_to=%2FTryGhost%2Fexpress-hbs) You must be signed in to change notification settings
* [Fork
  77](/login?return_to=%2FTryGhost%2Fexpress-hbs)
* [Star
   460](/login?return_to=%2FTryGhost%2Fexpress-hbs)

Express handlebars template engine with inheritance, partials, i18n and async helpers.

### License

[MIT license](/TryGhost/express-hbs/blob/main/LICENSE)

[460
stars](/TryGhost/express-hbs/stargazers) [77
forks](/TryGhost/express-hbs/forks) [Branches](/TryGhost/express-hbs/branches) [Tags](/TryGhost/express-hbs/tags) [Activity](/TryGhost/express-hbs/activity)
 [Star](/login?return_to=%2FTryGhost%2Fexpress-hbs)

 [Notifications](/login?return_to=%2FTryGhost%2Fexpress-hbs) You must be signed in to change notification settings

* [Code](/TryGhost/express-hbs)
* [Issues
  12](/TryGhost/express-hbs/issues)
* [Pull requests
  7](/TryGhost/express-hbs/pulls)
* [Actions](/TryGhost/express-hbs/actions)
* [Security](/TryGhost/express-hbs/security)
* [Insights](/TryGhost/express-hbs/pulse)

Additional navigation options

* [Code](/TryGhost/express-hbs)
* [Issues](/TryGhost/express-hbs/issues)
* [Pull requests](/TryGhost/express-hbs/pulls)
* [Actions](/TryGhost/express-hbs/actions)
* [Security](/TryGhost/express-hbs/security)
* [Insights](/TryGhost/express-hbs/pulse)

# TryGhost/express-hbs

    main[Branches](/TryGhost/express-hbs/branches)[Tags](/TryGhost/express-hbs/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[612 Commits](/TryGhost/express-hbs/commits/main/) | | |
| [.github/workflows](/TryGhost/express-hbs/tree/main/.github/workflows "This path skips through empty directories") | | [.github/workflows](/TryGhost/express-hbs/tree/main/.github/workflows "This path skips through empty directories") |  |  |
| [example](/TryGhost/express-hbs/tree/main/example "example") | | [example](/TryGhost/express-hbs/tree/main/example "example") |  |  |
| [lib](/TryGhost/express-hbs/tree/main/lib "lib") | | [lib](/TryGhost/express-hbs/tree/main/lib "lib") |  |  |
| [test](/TryGhost/express-hbs/tree/main/test "test") | | [test](/TryGhost/express-hbs/tree/main/test "test") |  |  |
| [.editorconfig](/TryGhost/express-hbs/blob/main/.editorconfig ".editorconfig") | | [.editorconfig](/TryGhost/express-hbs/blob/main/.editorconfig ".editorconfig") |  |  |
| [.eslintrc](/TryGhost/express-hbs/blob/main/.eslintrc ".eslintrc") | | [.eslintrc](/TryGhost/express-hbs/blob/main/.eslintrc ".eslintrc") |  |  |
| [.gitignore](/TryGhost/express-hbs/blob/main/.gitignore ".gitignore") | | [.gitignore](/TryGhost/express-hbs/blob/main/.gitignore ".gitignore") |  |  |
| [.jsbeautifyrc](/TryGhost/express-hbs/blob/main/.jsbeautifyrc ".jsbeautifyrc") | | [.jsbeautifyrc](/TryGhost/express-hbs/blob/main/.jsbeautifyrc ".jsbeautifyrc") |  |  |
| [LICENSE](/TryGhost/express-hbs/blob/main/LICENSE "LICENSE") | | [LICENSE](/TryGhost/express-hbs/blob/main/LICENSE "LICENSE") |  |  |
| [README.md](/TryGhost/express-hbs/blob/main/README.md "README.md") | | [README.md](/TryGhost/express-hbs/blob/main/README.md "README.md") |  |  |
| [SECURITY.md](/TryGhost/express-hbs/blob/main/SECURITY.md "SECURITY.md") | | [SECURITY.md](/TryGhost/express-hbs/blob/main/SECURITY.md "SECURITY.md") |  |  |
| [index.js](/TryGhost/express-hbs/blob/main/index.js "index.js") | | [index.js](/TryGhost/express-hbs/blob/main/index.js "index.js") |  |  |
| [package.json](/TryGhost/express-hbs/blob/main/package.json "package.json") | | [package.json](/TryGhost/express-hbs/blob/main/package.json "package.json") |  |  |
| [renovate.json](/TryGhost/express-hbs/blob/main/renovate.json "renovate.json") | | [renovate.json](/TryGhost/express-hbs/blob/main/renovate.json "renovate.json") |  |  |
| [yarn.lock](/TryGhost/express-hbs/blob/main/yarn.lock "yarn.lock") | | [yarn.lock](/TryGhost/express-hbs/blob/main/yarn.lock "yarn.lock") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
* Security
# express-hbs

Express handlebars template engine with multiple layouts, blocks and cached partials.

## v2.0.0

Version 2 was a rewrite and cleanup, with no known breaking changes. Lots of bugs were fixed which may have subtly changed behaviour.

Full details: <https://github.com/TryGhost/express-hbs/releases/tag/2.0.0>

## v1.0.0 Breaking Changes

If you're upgrading from v0.8.4 to v1.0.0 there are some potentially breaking changes to be aware of:

1. Handlebars @v4.0.5 - please see the [handlebars v4.0 compatibility notes](https://github.com/wycats/handlebars.js/blob/master/release-notes.md#v400---september-1st-2015)
2. The file extension for partial files must now match the extension configured in `extname` - please see [the PR](https://github.com/TryGhost/express-hbs/pull/88)

## Usage

To use with express 4.

```
var hbs = require('express-hbs');

// Use `.hbs` for extensions and find partials in `views/partials`.
app.engine('hbs', hbs.express4({
  partialsDir: __dirname + '/views/partials'
}));
app.set('view engine', 'hbs');
app.set('views', __dirname + '/views');
```

To use with express 3 is the same as above, except use hbs.express3

```
app.engine('hbs', hbs.express3({
  partialsDir: __dirname + '/views/partials'
}));
```

Options for `#express3` and `#express4`

```
hbs.express4({
  partialsDir: "{String/Array} [Required] Path to partials templates, one or several directories",

  // OPTIONAL settings
  restrictLayoutsTo: "{String} Absolute path to a directory to restrict layout directive reading from",
  blockHelperName: "{String} Override 'block' helper name.",
  contentHelperName: "{String} Override 'contentFor' helper name.",
  defaultLayout: "{String} Absolute path to default layout template",
  extname: "{String} Extension for templates & partials, defaults to `.hbs`",
  handlebars: "{Module} Use external handlebars instead of express-hbs dependency",
  i18n: "{Object} i18n object",
  layoutsDir: "{String} Path to layout templates",
  templateOptions: "{Object} options to pass to template()",
  beautify: "{Boolean} whether to pretty print HTML, see github.com/einars/js-beautify .jsbeautifyrc",

  // override the default compile
  onCompile: function(exhbs, source, filename) {
    var options;
    if (filename && filename.indexOf('partials') > -1) {
      options = {preventIndent: true};
    }
    return exhbs.handlebars.compile(source, options);
  }
});
```

## Syntax

To mark where layout should insert page

```
{{{body}}}

```

To declare a block placeholder in layout

```
{{{block "pageScripts"}}}

```

To define block content in a page

```
{{#contentFor "pageScripts"}}
  CONTENT HERE
{{/contentFor}}

```

## Layouts

There are three ways to use a layout, listed in precedence order

1. Declarative within a page. Use handlebars comment

   ```
   {{!< LAYOUT}}

   ```

   Layout file resolution:

   ```
   If path starts with '.'
       LAYOUT is relative to template
   Else If `layoutsDir` is set
       LAYOUT is relative to `layoutsDir`
   Else
       LAYOUT from path.resolve(dirname(template), LAYOUT)

   ```
2. As an option to render

   ## ⚠️ This creates a potential security vulnerability if used without a `restrictLayoutsTo`:

   The `restrictLayoutsTo` option will restrict reading layouts to a particular directory, if you do not pass this option then do not use the `layout` option in conjunction with passing user submitted data to res.render e.g. `res.render('index', req.query)`. This allows users to read arbitrary files from your filesystem!

   ```
   res.render('veggies', {
     title: 'My favorite veggies',
     veggies: veggies,
     layout: 'layout/veggie'
   });
   ```

   This option also allows for layout suppression (both the default layout and when specified declaratively in a page) by passing in a falsey Javascript value as the value of the `layout` property:

   ```
   res.render('veggies', {
     title: 'My favorite veggies',
     veggies: veggies,
     layout: null // render without using a layout template
   });
   ```

   Layout file resolution:

   ```
   If path starts with '.'
       layout is relative to template
   Else If `layoutsDir` is set
       layout is relative to `layoutsDir`
   Else
       layout from path.resolve(viewsDir, layout)

   ```
3. Lastly, use `defaultLayout` if specified in hbs configuration options.

Layouts can be nested: just include a declarative layout tag within any layout
template to have its content included in the declared "parent" layout. Be
aware that too much nesting can impact performances, and stay away from
infinite loops!

## Helpers

### Synchronous helpers

```
hbs.registerHelper('link', function(text, options) {
  var attrs = [];
  for(var prop in options.hash) {
    attrs.push(prop + '="' + options.hash[prop] + '"');
  }
  return new hbs.SafeString(
    "<a " + attrs.join(" ") + ">" + text + "</a>"
  );
});
```

in markup

```
{{{link 'barc.com' href='http://barc.com'}}}

```

### Asynchronous helpers

```
hbs.registerAsyncHelper('readFile', function(filename, cb) {
  fs.readFile(path.join(viewsDir, filename), 'utf8', function(err, content) {
    cb(new hbs.SafeString(content));
  });
});
```

in markup

```
{{{readFile 'tos.txt'}}}

```

## i18n support

Express-hbs supports [i18n](https://github.com/mashpie/i18n-node)

```
var i18n = require('i18n');

// minimal config
i18n.configure({
    locales: ['en', 'fr'],
    cookie: 'locale',
    directory: __dirname + "/locales"
});

app.engine('hbs', hbs.express3({
    // ... options from above
    i18n: i18n,  // registers __ and __n helpers
}));
app.set('view engine', 'hbs');
app.set('views', viewsDir);

// cookies are needed
app.use(express.cookieParser());

// init i18n module
app.use(i18n.init);
```

## Engine Instances

Create isolated engine instances with their own cache system and handlebars engine.

```
var hbs = require('express-hbs');
var instance1 = hbs.create();
var instance2 = hbs.create();
```

## Template options

The main use case for template options is setting the handlebars "data" object - this creates global template variables accessible with an `@` prefix.

Template options can be set in 3 ways. When setting global template options they can be [passed as config on creation of an instance](https://github.com/barc/express-hbs#usage), and they can also be updated used the `updateTemplateOptions(templateOptions)` method of an instance. To set template options for an individual request they can be set on `res.locals` using the helper method `updateLocalTemplateOptions(locals, templateOptions)`.

Both of these methods have a companion method `getTemplateOptions()` and `getLocalTemplateOptions(locals)`, which should be used when extending or merging the current options.

## Example

in File `app.js`

```
// http://expressjs.com/api.html#app.locals
app.locals({
    'PROD_MODE': 'production' === app.get('env')
});
```

File `views/layout/default.hbs`

```
<html>
  <head>
    <title>{{title}}</title>
    <link type="text/css" rel="stylesheet" href="/css/style.css"/>
    {{{block "pageStyles"}}}
  </head>
  <body>
    {{{body}}}

    {{> scripts}}

    {{#if PROD_MODE}}
    {{{block 'googleAnalyticsScripts'}}}
    {{/if}}

  </body>
</html>
```

File `views/index.hbs`

```
{{!< default}}

{{#contentFor 'pageStyles'}}
<style>
  .clicker {
    color: blue;
  };
</style>
{{/contentFor}}

<h1>{{title}}</h1>
<p class="clicker">Click me!</p>
```

To run example project

```
npm install -d
node example/app.js

```

## Testing

The test suite requires the `grunt-cli` package:

```
npm install -g grunt-cli
npm install -d

```

Once everything's installed, just run:

```
npm test

```

## Credits

Inspiration and code from [donpark/hbs](https://github.com/donpark/hbs)

Big thanks to all [CONTRIBUTORS](https://github.com/TryGhost/express-hbs/contributors)

## License

The MIT License (MIT)

Copyright (c) 2012-2025 Barc, Inc., Ghost Foundation - Released under the [MIT license](/TryGhost/express-hbs/blob/main/LICENSE).

## About

Express handlebars template engine with inheritance, partials, i18n and async helpers.

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/TryGhost/express-hbs/activity)
[Custom properties](/TryGhost/express-hbs/custom-properties)
### Stars

[**460**
stars](/TryGhost/express-hbs/stargazers)
### Watchers

[**28**
watching](/TryGhost/express-hbs/watchers)
### Forks

[**77**
forks](/TryGhost/express-hbs/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs&report=TryGhost+%28user%29)

## [Releases 12](/TryGhost/express-hbs/releases)

[2.1.2
Latest

Apr 15, 2019](/TryGhost/express-hbs/releases/tag/v2.1.2)
[+ 11 releases](/TryGhost/express-hbs/releases)

## [Packages 0](/orgs/TryGhost/packages?repo_name=express-hbs)

No packages published

## [Contributors 36](/TryGhost/express-hbs/graphs/contributors)

[+ 22 contributors](/TryGhost/express-hbs/graphs/contributors)

## Languages

* [JavaScript
  91.6%](/TryGhost/express-hbs/search?l=javascript)
* [Handlebars
  7.8%](/TryGhost/express-hbs/search?l=handlebars)
* Other
  0.6%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_00325ee0_20250115_082348.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs%2Fcommit%2Fff6fad6e357699412d4e916273314e5e7af1500e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs%2Fcommit%2Fff6fad6e357699412d4e916273314e5e7af1500e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TryGhost%2Fexpress-hbs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TryGhost](/TryGhost)
/
**[express-hbs](/TryGhost/express-hbs)**
Public

* [Notifications](/login?return_to=%2FTryGhost%2Fexpress-hbs) You must be signed in to change notification settings
* [Fork
  77](/login?return_to=%2FTryGhost%2Fexpress-hbs)
* [Star
   460](/login?return_to=%2FTryGhost%2Fexpress-hbs)

* [Code](/TryGhost/express-hbs)
* [Issues
  12](/TryGhost/express-hbs/issues)
* [Pull requests
  7](/TryGhost/express-hbs/pulls)
* [Actions](/TryGhost/express-hbs/actions)
* [Security](/TryGhost/express-hbs/security)
* [Insights](/TryGhost/express-hbs/pulse)

Additional navigation options

* [Code](/TryGhost/express-hbs)
* [Issues](/TryGhost/express-hbs/issues)
* [Pull requests](/TryGhost/express-hbs/pulls)
* [Actions](/TryGhost/express-hbs/actions)
* [Security](/TryGhost/express-hbs/security)
* [Insights](/TryGhost/express-hbs/pulse)

## Commit

[Permalink](/TryGhost/express-hbs/commit/ff6fad6e357699412d4e916273314e5e7af1500e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

🔒 Added notes on a potential security vulnerability

[Browse files](/TryGhost/express-hbs/tree/ff6fad6e357699412d4e916273314e5e7af1500e)
Browse the repository at this point in the history

```
- Express.js never intended for template options to be passed via res.render
- If you use res.render to pass a layout, the file will be read from disk
- If you pass user-submitted data as options to res.render e.g. using req.query, then user-submitted file paths will be read
- This is only a potential security vulnerability, depending on the implementation
- Further fixes will be pushed to express-hbs to disable this behaviour by default
```

* Loading branch information

[![@ErisDS](https://avatars.githubusercontent.com/u/101513?s=40&v=4)](/ErisDS)

[ErisDS](/TryGhost/express-hbs/commits?author=ErisDS "View all commits by ErisDS")
committed
Apr 22, 2021

1 parent
[070fe17](/TryGhost/express-hbs/commit/070fe175e8eb866230981b09926a1883517aca11)

commit ff6fad6

Showing
**1 changed file**
with
**4 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/TryGhost/express-hbs/blob/ff6fad6e357699412d4e916273314e5e7af1500e/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -99,6 +99,10 @@ There are three ways to use a layout, listed in precedence order |
|  |  |  |
|  |  | 2. As an option to render |
|  |  |  |
|  |  | ## ⚠️ This creates a potential security vulnerability: |
|  |  |  |
|  |  | Do not use this option in conjunction with passing user submitted data to res.render e.g. `res.render('index', req.query)`. This allows users to read arbitrary files from your filesystem! |
|  |  |  |
|  |  | ```js |
|  |  | res.render('veggies', { |
|  |  | title: 'My favorite veggies', |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ff6fad6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTryGhost%2Fexpress-hbs%2Fcommit%2Fff6fad6e357699412d4e916273314e5e7af1500e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


