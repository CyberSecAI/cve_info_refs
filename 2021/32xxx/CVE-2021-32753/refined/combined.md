=== Content from github.com_ed51c6b1_20250114_184626.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fedgexfoundry%2Fedgex-go%2Fsecurity%2Fadvisories%2FGHSA-xph4-vmcc-52gh)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fedgexfoundry%2Fedgex-go%2Fsecurity%2Fadvisories%2FGHSA-xph4-vmcc-52gh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=edgexfoundry%2Fedgex-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[edgexfoundry](/edgexfoundry)
/
**[edgex-go](/edgexfoundry/edgex-go)**
Public

* [Notifications](/login?return_to=%2Fedgexfoundry%2Fedgex-go) You must be signed in to change notification settings
* [Fork
  484](/login?return_to=%2Fedgexfoundry%2Fedgex-go)
* [Star
   1.4k](/login?return_to=%2Fedgexfoundry%2Fedgex-go)

* [Code](/edgexfoundry/edgex-go)
* [Issues
  36](/edgexfoundry/edgex-go/issues)
* [Pull requests
  2](/edgexfoundry/edgex-go/pulls)
* [Actions](/edgexfoundry/edgex-go/actions)
* [Projects
  0](/edgexfoundry/edgex-go/projects)
* [Security](/edgexfoundry/edgex-go/security)
* [Insights](/edgexfoundry/edgex-go/pulse)

Additional navigation options

* [Code](/edgexfoundry/edgex-go)
* [Issues](/edgexfoundry/edgex-go/issues)
* [Pull requests](/edgexfoundry/edgex-go/pulls)
* [Actions](/edgexfoundry/edgex-go/actions)
* [Projects](/edgexfoundry/edgex-go/projects)
* [Security](/edgexfoundry/edgex-go/security)
* [Insights](/edgexfoundry/edgex-go/pulse)

# Weak password in API gateway in EdgeX Foundry Edinburgh, Fuji, Geneva, and Hanoi releases allows remote attackers to obtain authentication token via dictionary-based password attack when OAuth2 authentication method is enabled.

High

[eb-oss](/eb-oss)
published
GHSA-xph4-vmcc-52gh
Jul 9, 2021

## Package

API gateway

## Affected versions

Edinburgh, Fuji, Geneva, Hanoi

## Patched versions

Ireland or later

## Description

### Impact

When the EdgeX API gateway is configured for OAuth2 authentication and a proxy user is created, the client\_id and client\_secret required to obtain an OAuth2 authentication token are set to the username of the proxy user. A remote network attacker can then perform a dictionary-based password attack on the OAuth2 token endpoint of the API gateway to obtain an OAuth2 authentication token and use that token to make authenticated calls to EdgeX microservices from an untrusted network.

OAuth2 is the default authentication method in EdgeX Edinburgh release. The default authentication method was changed to JWT in Fuji and later releases.

### Patches

Users should upgrade to the EdgeX Ireland release to obtain the fix. The OAuth2 authentication method is disabled in Ireland release.

### Workarounds

If unable to upgrade and OAuth2 authentication is required, users should create OAuth2 users directly using the Kong admin API and forgo the use of the `security-proxy-setup` tool to create OAuth2 users.

### References

* [Create an OAuth2 consumer directly using Kong API](https://docs.konghq.com/hub/kong-inc/oauth2/#create-a-consumer)

### For more information

If you have any questions or comments about this advisory:

* Contact us in the [Slack #security channel](https://slack.edgexfoundry.org/)
* Open an issue in [edgex-go](https://github.com/edgexfoundry/edgex-go)
* Email us at EdgeX-TSC-Security@lists.edgexfoundry.org

### Severity

High

8.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L

### CVE ID

CVE-2021-32753

### Weaknesses

[CWE-284](/advisories?query=cwe%3A284) [CWE-287](/advisories?query=cwe%3A287) [CWE-521](/advisories?query=cwe%3A521)

### Credits

* [![@bnevis-i](https://avatars.githubusercontent.com/u/21301128?s=40&v=4)](/bnevis-i)
  [bnevis-i](/bnevis-i)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.konghq.com_6fbbe502_20250114_184625.html ===


[Skip to content](#main)

[![Kong Logo](/assets/images/logos/konglogo-dark-theme.svg)](https://konghq.com)
|
[![Kong Docs Logo](/assets/images/logos/docslogo-dark-theme.svg)](/)

* Docs
  + [Explore the API Specs
    ![View all API Specs](/assets/images/landing-page/view-all-api-specs.png)
    View all API Specs
    ![View all API Specs arrow image](/assets/images/landing-page/arrow-right.svg)](/api/)
  + Documentation

    [API Specs](/api/)
    [Kong Gateway
    Lightweight, fast, and flexible cloud-native API gateway](/gateway/latest/)
    [Kong Konnect
    Single platform for SaaS end-to-end connectivity](/konnect/)
    [Kong AI Gateway
    Multi-LLM AI Gateway for GenAI infrastructure](/gateway/latest/ai-gateway/)
    [Kong Mesh
    Enterprise service mesh based on Kuma and Envoy](/mesh/latest/)
    [decK
    Helps manage Kong’s configuration in a declarative fashion](/deck/latest/)
    [Kong Ingress Controller
    Works inside a Kubernetes cluster and configures Kong to proxy traffic](/kubernetes-ingress-controller/latest/)
    [Kong Gateway Operator
    Manage your Kong deployments on Kubernetes using YAML Manifests](/gateway-operator/latest/)
    [Insomnia
    Collaborative API development platform](https://docs.insomnia.rest/)
* Plugin Hub
  + [Explore the Plugin Hub
    ![View all plugins](/assets/images/landing-page/view-all-plugins.svg)
    View all plugins
    ![View all plugins arrow image](/assets/images/landing-page/arrow-right.svg)](/hub/)
  + Functionality
    [View all
    ![View all arrow image](/assets/images/landing-page/arrow-right.svg)](/hub/)

    [View all plugins](/hub/)
    [![AI's icon](/assets/images/nav/hub/ai.svg)

    AI
    Govern, secure, and control AI traffic with multi-LLM AI Gateway plugins](/hub/?category=ai)
    [![Authentication's icon](/assets/images/nav/hub/lock_person.svg)

    Authentication
    Protect your services with an authentication layer](/hub/?category=authentication)
    [![Security's icon](/assets/images/nav/hub/shield.svg)

    Security
    Protect your services with additional security layer](/hub/?category=security)
    [![Traffic Control's icon](/assets/images/nav/hub/route.svg)

    Traffic Control
    Manage, throttle and restrict inbound and outbound API traffic](/hub/?category=traffic-control)
    [![Serverless's icon](/assets/images/nav/hub/serverless.svg)

    Serverless
    Invoke serverless functions in combination with other plugins](/hub/?category=serverless)
    [![Analytics & Monitoring's icon](/assets/images/nav/hub/bar_chart.svg)

    Analytics & Monitoring
    Visualize, inspect and monitor APIs and microservices traffic](/hub/?category=analytics-monitoring)
    [![Transformations's icon](/assets/images/nav/hub/swap_horiz.svg)

    Transformations
    Transform request and responses on the fly on Kong](/hub/?category=transformations)
    [![Logging's icon](/assets/images/nav/hub/list_alt.svg)

    Logging
    Log request and response data using the best transport for your infrastructure](/hub/?category=logging)
* [Support](https://support.konghq.com/)
* [Community](https://konghq.com/community/)
* [Kong Academy](https://education.konghq.com)

[Get a Demo](https://konghq.com/contact-sales?utm_source=docs.konghq.com)
[Start Free Trial](https://konghq.com/products/kong-konnect/register?utm_medium=referral&utm_source=docs&utm_campaign=gateway-konnect&utm_content=top-nav)

Plugin Hub

* [![Plugin Hub icon](/assets/images/icons/hub-layout/icn-breadcrumbs.svg)](/hub/)
* [Authentication](/hub/?category=authentication)
* [OAuth 2.0 Authentication](/hub/kong-inc/oauth2/)
* Introduction
* [Overview](/hub/kong-inc/oauth2/)

[![github-edit-page](/assets/images/icons/third-party/logo-github-white.svg)Edit this page](https://github.com/Kong/docs.konghq.com/edit/main/app/_hub/kong-inc/oauth2/overview/_index.md)

[![report-issue](/assets/images/icons/documentation/icn-monitoring-white.svg)Report an issue](https://github.com/Kong/docs.konghq.com/issues/)

![header icon](/assets/images/icons/hub/kong-inc_oauth2.png)

# OAuth 2.0 Authentication

Gateway
Version 3.9.x *(latest)*

* [unreleased](/hub/kong-inc/oauth2/unreleased/)
* [3.9.x *(latest)*](/hub/kong-inc/oauth2/)
* [3.8.x](/hub/kong-inc/oauth2/3.8.x/)
* [3.7.x](/hub/kong-inc/oauth2/3.7.x/)
* [3.6.x](/hub/kong-inc/oauth2/3.6.x/)
* [3.5.x](/hub/kong-inc/oauth2/3.5.x/)
* [3.4.x](/hub/kong-inc/oauth2/3.4.x/)
* [3.3.x](/hub/kong-inc/oauth2/3.3.x/)
* [3.2.x](/hub/kong-inc/oauth2/3.2.x/)
* [3.1.x](/hub/kong-inc/oauth2/3.1.x/)
* [2.8.x](/hub/kong-inc/oauth2/2.8.x/)

By Kong Inc.

* [![](/assets/images/icons/hub-layout/icn-breadcrumbs.svg)
  Plugin Hub](/hub/)
* ![](/assets/images/icons/hub-layout/icn-overview.svg)
  Introduction

  + [Overview](/hub/kong-inc/oauth2/)
* [![](/assets/images/icons/hub-layout/icn-configuration.svg)
  Configuration reference](/hub/kong-inc/oauth2/configuration/)
* ![](/assets/images/icons/hub-layout/icn-how-to.svg)
  Using the plugin

  + [Basic config examples](/hub/kong-inc/oauth2/how-to/basic-example/)
  + [Set rate limit for Oauth2 tokens](/hub/kong-inc/oauth2/how-to/oauth2rla/)
* [![](/assets/images/icons/hub-layout/icn-changelog.svg)
  Changelog](/hub/kong-inc/oauth2/changelog/)
* [Try it in Konnect](https://konghq.com/products/kong-konnect/register?utm_medium=referral&utm_source=docs&utm_campaign=gateway-konnect&utm_content=oauth2)

![On this page](/assets/images/icons/hub-layout/icn-on-this-page.svg)On this page

* [Usage](#usage)
  + [Endpoints](#endpoints)
  + [Create a Consumer](#create-a-consumer)
  + [Create an Application](#create-an-application)
* [Migrating Access Tokens](#migrating-access-tokens)
* [Viewing and Invalidating Access Tokens](#viewing-and-invalidating-access-tokens)
* [Upstream Headers](#upstream-headers)
* [OAuth 2.0 Flows](#oauth-20-flows)
  + [Client Credentials](#client-credentials)
  + [Authorization Code](#authorization-code)
* [(Legacy systems only) Resource owner password credentials](#legacy-systems-only-resource-owner-password-credentials)
* [Refresh Token](#refresh-token)
* [gRPC requests](#grpc-requests)
* [WebSocket requests](#websocket-requests)

> **This plugin is not compatible with Konnect**

> *Looking for the plugin's configuration parameters? You can find them in the [OAuth 2.0 Authentication configuration reference](/hub/kong-inc/oauth2/configuration/) doc.*

Add an OAuth 2.0 authentication layer with one of the following grant flows:

* [Authorization Code Grant](https://tools.ietf.org/html/rfc6749#section-4.1)
* [Client Credentials](https://tools.ietf.org/html/rfc6749#section-4.4)
* [Implicit Grant](https://tools.ietf.org/html/rfc6749#section-4.2)
* [Resource Owner Password Credentials Grant](https://tools.ietf.org/html/rfc6749#section-4.3)

> **Important**:
>
> * Once applied, any user with a valid credential can access the service.
>   To restrict usage to only some of the authenticated users, also add the
>   [ACL](/hub/kong-inc/acl/) plugin (not covered here) and create allowed or
>   denied groups of users.
> * As per the OAuth2 specs, this plugin requires the
>   underlying service to be served over HTTPS. To avoid any
>   confusion, we recommend that you configure the route used to serve the
>   underlying service to only accept HTTPS traffic (using its `protocols`
>   property).

## Usage

In order to use the plugin, you first need to create a consumer to associate one or more credentials to. The Consumer represents a developer using the upstream service.

> This plugin requires a database in order to work effectively. It **does not** work in DB-less or hybrid mode.

### Endpoints

By default the OAuth 2.0 plugin listens on the following endpoints when a client consumes the underlying Service via the [proxy port](https://docs.konghq.com/latest/configuration/#proxy_listen):

| Endpoint | description |
| --- | --- |
| `/oauth2/authorize` | The endpoint to the Authorization Server that provisions authorization codes for the [Authorization Code](https://tools.ietf.org/html/rfc6749#section-4.1) flow, or the access token when the [Implicit Grant](https://tools.ietf.org/html/rfc6749#section-4.2) flow is enabled. Only `POST` is supported. |
| `/oauth2/token` | The endpoint to the Authorization Server that provision access tokens. This is also the only endpoint to use for the [Client Credentials](https://tools.ietf.org/html/rfc6749#section-4.4) and [Resource Owner Password Credentials Grant](https://tools.ietf.org/html/rfc6749#section-4.3) flows. Only `POST` is supported. |
| `/oauth2_tokens` | The endpoint to the Authorization Server that allows creating new tokens. Useful on migrations (see below). |
| `/oauth2_tokens/:token_id` | The endpoint to the Authorization Server that allows reading, modifying and deleting access tokens. |

The clients trying to authorize and request access tokens must use these endpoints. Remember that the endpoints above must be combined with the right URI path or headers that you normally use to match a configured Route through Kong.

### Create a Consumer

You need to associate a credential to an existing [Consumer](/gateway/api/admin-ee/latest/#/Consumers/list-consumer/) object. To create a Consumer, you can execute the following request:

```
curl -X POST http://localhost:8001/consumers/ \
  --data "username=user123" \
  --data "custom_id=SOME_CUSTOM_ID"

```

| parameter | default | description |
| --- | --- | --- |
| `username`*semi-optional* |  | The username of the consumer. Either this field or `custom_id` must be specified. |
| `custom_id`*semi-optional* |  | A custom identifier used to map the consumer to another database. Either this field or `username` must be specified. |

A [Consumer](/gateway/api/admin-ee/latest/#/Consumers/list-consumer/) can have many credentials.

### Create an Application

Then you can finally provision new OAuth 2.0 credentials (also called “OAuth applications”) by making the following HTTP request:

```
curl -X POST http://localhost:8001/consumers/{consumer_id}/oauth2 \
  --data "name=Test%20Application" \
  --data "client_id=SOME-CLIENT-ID" \
  --data "client_secret=SOME-CLIENT-SECRET" \
  --data "redirect_uris=http://some-domain/endpoint/" \
  --data "hash_secret=true"

```

`consumer_id`: The [Consumer](/gateway/api/admin-ee/latest/#/Consumers/list-consumer/) entity to associate the credentials to

| form parameter | default | description |
| --- | --- | --- |
| `name` |  | The name to associate to the credential. In OAuth 2.0 this would be the application name. |
| `client_id`*optional* |  | You can optionally set your own unique `client_id`. If missing, the plugin will generate one. |
| `client_secret`*optional* |  | You can optionally set your own unique `client_secret`. If missing, the plugin will generate one. |
| `redirect_uris` |  | An array with one or more URLs in your app where users will be sent after authorization ([RFC 6742 Section 3.1.2](https://tools.ietf.org/html/rfc6749#section-3.1.2)) |
| `hash_secret` | `false` | A boolean flag that indicates whether the `client_secret` field will be stored in hashed form. If enabled on existing plugin instances, client secrets are hashed on the fly upon first usage. |

## Migrating Access Tokens

If you are migrating your existing OAuth 2.0 applications and access tokens over to Kong, then you can:

* Migrate consumers and applications by creating OAuth 2.0 applications as explained above.
* Migrate access tokens using the `/oauth2_tokens` endpoints in the Kong’s Admin API. For example:

```
curl -X POST http://localhost:8001/oauth2_tokens \
  --data 'credential.id=KONG-APPLICATION-ID' \
  --data "token_type=bearer" \
  --data "access_token=SOME-TOKEN" \
  --data "refresh_token=SOME-TOKEN" \
  --data "expires_in=3600"

```

| form parameter | default | description |
| --- | --- | --- |
| `credential` |  | Contains the ID of the OAuth 2.0 application created on Kong. |
| `token_type`*optional* | `bearer` | The [token type](https://tools.ietf.org/html/rfc6749#section-7.1). |
| `access_token`*optional* |  | You can optionally set your own access token value, otherwise a random string will be generated. |
| `refresh_token`*optional* |  | You can optionally set your own unique refresh token value, otherwise no refresh token will be generated. |
| `expires_in` |  | The expiration time (in seconds) of the access token. |
| `scope`*optional* |  | The authorized scope associated with the token. |
| `authenticated_userid`*optional* |  | The custom ID of the user who authorized the application. |

## Viewing and Invalidating Access Tokens

Active tokens can be listed and modified using the Admin API. A GET on the `/oauth2_tokens` endpoint returns the following:

```
curl -sX GET http://localhost:8001/oauth2_tokens/

```

Response:

```
{
  "total": 2,
  "data": [
    {
      "expires_in": 7200,
      "created_at": 1523386491000,
      "access_token": "FOEtUHwg0das9PhsasVmgMGbZn7nWSgK",
      "credential_id": "2c74324f-fa2d-434b-b6de-bd138652158f",
      "scope": "email",
      "id": "610740e5-700a-45f0-889a-5c7f0422c48d",
      "service_id": "898dfc5f-20f9-4315-a028-2ecb0193f834",
      "token_type": "bearer"
    },
    {
      "expires_in": 7200,
      "created_at": 1523386680000,
      "access_token": "58eat7UHEiPOmjNb16uQAxt4vu3fbu95",
      "credential_id": "2c74324f-fa2d-434b-b6de-bd138652158f",
      "scope": "email",
      "id": "edff2fc7-1634-4fb5-b714-de9435531e10",
      "service_id": "898dfc5f-20f9-4315-a028-2ecb0193f834",
      "token_type": "bearer"
    }
  ]
}

```

`credential_id` is the ID of the OAuth application at `localhost:8001/consumers/{consumer_id}/oauth2` and `service_id` is the API or service that the token is valid for.

Note that `expires_in` is static and does not decrement based on elapsed time: you must add it to `created_at` to calculate when the token will expire.

`DELETE http://localhost:8001/oauth2_tokens/<token ID>` allows you to immediately invalidate a token if needed.

## Upstream Headers

When a client has been authenticated and authorized, the plugin will append some headers to the request before proxying it to the upstream service, so that you can identify the consumer and the end-user in your code:

* `X-Consumer-ID`, the ID of the Consumer on Kong
* `X-Consumer-Custom-ID`, the `custom_id` of the Consumer (if set)
* `X-Consumer-Username`, the `username` of the Consumer (if set)
* `X-Credential-Identifier`, the `client_id` of the credential (if set), representing the client and the credential associated. See [Create an Application](#create-an-application) for more information.
* `X-Authenticated-Scope`, the comma-separated list of scopes that the end user has authenticated, if available (only if the consumer is not the ‘anonymous’ consumer)
* `X-Authenticated-Userid`, the logged-in user ID who has granted permission to the client (only if the consumer is not the ‘anonymous’ consumer)
* `X-Anonymous-Consumer`, will be set to `true` when authentication failed, and the ‘anonymous’ consumer was set instead.

You can use this information on your side to implement additional logic. You can use the `X-Consumer-ID` value to query the Kong Admin API and retrieve more information about the Consumer.

---

## OAuth 2.0 Flows

### Client Credentials

The [Client Credentials](https://tools.ietf.org/html/rfc6749#section-4.4) flow works out of the box, without building any authorization page.
The clients need to use the `/oauth2/token` endpoint to request an access token.

You can access the `/oauth2/token` endpoint to retrieve the `access_token` in the following ways:

* Using a POST request, set `Content-Type` to `application/x-www-form-urlencoded` and send the credentials as form data:

  ```
    curl -i -X POST 'https://example.service.com/oauth2/token' \
      --header 'Content-Type: application/x-www-form-urlencoded' \
      --data-urlencode 'client_id=XXXX' \
      --data-urlencode 'client_secret=XXXX' \
      --data-urlencode 'grant_type=client_credentials'

  ```
* Using a POST request, set `_Content-Type` to `application/json` and send the credentials as a JSON body:

  ```
    curl -i -X POST 'https://example.service.com/oauth2/token' \
      --header 'Content-Type: application/json' \
      --data-raw '{ "client_id": "XXXXX", "client_secret": "XXXX", "grant_type": "client_credentials" }'

  ```
* Using a POST request, send the credentials in URL query parameters:

  ```
    curl -i -X POST 'https://example.service.com/oauth2/token?client_id=XXXX&client_secret=XXXX&grant_type=client_credentials'

  ```

### Authorization Code

After provisioning Consumers and associating OAuth 2.0 credentials to them, it is important to understand how the OAuth 2.0 authorization flow works. As opposed to most of the Kong plugins, the OAuth 2.0 plugin requires some little additional work on your side to make everything work well:

* You **must** implement an authorization page on your web application, that will talk with the plugin server-side.
* *Optionally* you need to explain on your website/documentation how to consume your OAuth 2.0 protected services, so that developers accessing your service know how to build their client implementations

#### The flow explained

Building the authorization page is going to be the primary task that the plugin itself cannot do out of the box, because it requires to check that the user is properly logged in, and this operation is strongly tied with your authentication implementation.

The authorization page is made of two parts:

* The frontend page that the user will see, and that will allow him to authorize the client application to access his data
* The backend that will process the HTML form displayed in the frontend, that will talk with the OAuth 2.0 plugin on Kong, and that will ultimately redirect the user to a third party URL.

You can see a sample implementation in [node.js + express.js](https://github.com/Kong/kong-oauth2-hello-world) on GitHub.

A diagram representing this flow:

![OAuth2 flow](/assets/images/products/plugins/oauth2/oauth2-flow.png)

1. The client application will redirect the end user to the authorization page on your web application, passing `client_id`, `response_type` and `scope` (if required) as query string parameters. This is a sample authorization page:

   ![](/assets/images/products/plugins/oauth2/oauth2-prompt.png "OAuth 2.0 Prompt")
2. Before showing the actual authorization page, the web application will make sure that the user is logged in.
3. The client application will send the `client_id` in the query string, from which the web application can retrieve both the OAuth 2.0 application name, and developer name, by making the following request to Kong:

   ```
    curl localhost:8001/oauth2?client_id=XXX

   ```
4. If the end user authorized the application, the form will submit the data to your backend with a `POST` request, sending the `client_id`, `response_type` and `scope` parameters that were placed in `<input type="hidden" .. />` fields.
5. The backend must add the `provision_key` and `authenticated_userid` parameters to the `client_id`, `response_type` and `scope` parameters and it will make a `POST` request to Kong at your Service address, on the `/oauth2/authorize` endpoint. If an `Authorization` header has been sent by the client, that must be added too. The equivalent of:

   ```
    curl https://your.service.com/oauth2/authorize \
      --header "Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW" \
      --data "client_id=XXX" \
      --data "response_type=XXX" \
      --data "scope=XXX" \
      --data "provision_key=XXX" \
      --data "authenticated_userid=XXX"

   ```

   The `provision_key` is the key the plugin has generated when it has been added to the Service while `authenticated_userid` is the ID of the logged-in end user who has granted the permission.
6. Kong will respond with a JSON response:

   ```
    {
      "redirect_uri": "http://some/url"
    }

   ```

   With either a `200 OK` or `400 Bad Request` response code depending if the request was successful or not.
7. In **both** cases, ignore the response status code and just redirect the user to whatever URI is being returned in the `redirect_uri` property.
8. The client application will take it from here, and will continue the flow with Kong with no other interaction with your web application. Like exchanging the authorization code for an access token if it’s an Authorization Code Grant flow.
9. Once the Access Token has been retrieved, the client application will make requests on behalf of the user to your upstream service.
10. Access Tokens can expire, and when that happens the client application needs to renew the Access Token with Kong and retrieve a new one.

In this flow, the steps that you need to implement are:

* The login page, you probably already have it (step 2)
* The Authorization page, with its backend that will simply collect the values, make a `POST` request to Kong and redirect the user to whatever URL Kong has returned (steps 3 to 7).

---

## (Legacy systems only) Resource owner password credentials

> **Important**: The OAuth2 Security Best Practice explicitly mentions that Resource Owner Password Credentials
> [“MUST NOT BE USED”](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics-13#section-3.4).
> The following section is left here as a reference for supporting legacy systems.

The [Resource Owner Password Credentials Grant](https://tools.ietf.org/html/rfc6749#section-4.3) is a much simpler version of the Authorization Code flow, but it still requires to build an authorization backend (without the frontend) in order to make it work properly.

![OAuth 2.0 Flow](/assets/images/products/plugins/oauth2/oauth2-flow2.png)

1. On the first request, the client application makes a request with some OAuth2 parameters to your web application.
2. The backend of your web application adds the `provision_key` and `grant_type` parameters to the parameters originally sent by the client, then makes a `POST` request to Kong using the `/oauth2/token` endpoint of the configured plugin. If an `Authorization` header is sent by the client, that must be added too. For example:

   ```
    curl https://your.service.com/oauth2/token \
      --header "Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW" \
      --data "client_id=XXX" \
      --data "client_secret=XXX" \
      --data "grant_type=password" \
      --data "scope=XXX" \
      --data "provision_key=XXX" \
      --data "authenticated_userid=XXX" \
      --data "username=XXX" \
      --data "password=XXX"

   ```

   The `provision_key` is the key the plugin has generated when it has been added to the Service, while `authenticated_userid` is the ID of the end user whose `username` and `password` belong to.
3. Kong will respond with a JSON response
4. The JSON response sent by Kong must be sent back to the original client as it is. If the operation is successful, this response will include an access token, otherwise it will include an error.

In this flow, the steps that you need to implement are:

* The backend endpoint that will process the original request and will authenticate the `username` and `password` values sent by the client, and if the authentication is successful, make the request to Kong and return back to the client whatever response Kong has sent back.

---

## Refresh Token

When your access token expires, you can generate a new access token using the refresh token you received in conjunction to your expired access token.

```
curl -X POST https://your.service.com/oauth2/token \
  --data "grant_type=refresh_token" \
  --data "client_id=XXX" \
  --data "client_secret=XXX" \
  --data "refresh_token=XXX"

```

---

## gRPC requests

The same access tokens can be used by gRPC applications:

```
grpcurl -H 'authorization: bearer XXX' ...

```

Note that the rest of the credentials flow uses HTTPS and not gRPC protocol. Depending on your application, you might have to configure the `oauth2` plugin on two separate routes: one under `protocols: ["https"]` and another under `protocols: ["grpcs"]`.

## WebSocket requests

This plugin cannot issue new tokens from a WebSocket route, because the request
will be rejected as an invalid WebSocket handshake. Therefore, to use this
plugin with WebSocket services, an additional non-WebSocket route must be used
to issue tokens.

1. Create a WebSocket service:
   ```
    curl -X POST http://localhost:8001/services/ \
      --data "name=my-websocket-service" \
      --data "url=ws://my-websocket-backend:8080/"

   ```
2. Attach a route to the service:
   ```
    curl -X POST http://localhost:8001/services/my-websocket-service/routes \
      --data "name=my-websocket-route" \
      --data "protocols=wss" \
      --data "hosts=my-websocket-hostname.com" \

   ```
3. Attach an OAuth2 plugin instance to the service:

   > **Note**: Setting `global_credentials=true` is necessary to allow tokens
   > created by other plugin instances.

   ```
    curl -x POST http://localhost:8001/services/my-websocket-service/plugins \
      --data "name=oauth2" \
      --data "config.scopes=email" \
      --data "config.scopes=profile" \
      --data "config.global_credentials=true"

   ```
4. Create another route to handle token creation:
   > **Note**: Adding a POST method matcher ensures that regular WebSocket
   > handshake requests will not match this route.

   ```
    curl -X POST http://localhost:8001/routes \
      --data "name=my-websocket-token-helper" \
      --data "protocols=https" \
      --data "hosts=my-websocket-hostname.com" \
      --data "methods=POST"

   ```
5. Finally, add the additional OAuth2 plugin instance, using the route:

   ```
    curl -x POST http://localhost:8001/routes/my-websocket-token-helper/plugins \
      --data "name=oauth2" \
      --data "config.scopes=email" \
      --data "config.scopes=profile" \
      --data "config.global_credentials=true"

   ```

Client token requests (for example: `POST https://my-websocket-hostname.com/oauth2/authorize`)
will be handled by the `oauth2` plugin instance attached to the `my-websocket-token-helper`
route, and tokens issued by this route can be used in the WebSocket handshake
request to the `my-websocket-route` route.

---

Next
[OAuth 2.0 Authentication Configuration](/hub/kong-inc/oauth2/configuration/)

![Feedback widget](/assets/images/icons/feedback-widget.svg)

Thank you for your feedback.

Back
Submit

Was this page useful?

![]()

* ![Kong](/assets/images/logos/konglogo-light-theme-primary.svg)

  Powering the API world

  Increase developer productivity, security, and performance at scale with the unified platform for API management, service mesh, and ingress controller.
* + Products
    - [Kong Konnect](https://konghq.com/products/kong-konnect)
    - [Kong Gateway Enterprise](https://konghq.com/products/kong-enterprise)
    - [Kong Gateway](https://konghq.com/products/kong-gateway)
    - [Kong Mesh](https://konghq.com/products/kong-mesh)
    - [Kong Ingress Controller](https://konghq.com/products/kong-ingress-controller)
    - [Kong Insomnia](https://insomnia.rest/)
    - [Product Updates](https://konghq.com/product-updates)
    - [Get Started](https://konghq.com/contact-sales)
  + Documentation
    - [Kong Konnect Docs](/konnect/)
    - [Kong Gateway Docs](/gateway/latest/)
    - [Kong Gateway Enterprise Docs](/gateway/latest/kong-enterprise/)
    - [Kong Mesh Docs](/mesh/latest/)
    - [Kong Insomnia Docs](https://docs.insomnia.rest/)
    - [Kong Konnect Plugin Hub](/hub/)
  + Open Source
    - [Kong Gateway](https://konghq.com/install/#kong-community)
    - [Kuma](https://kuma.io/)
    - [Insomnia](https://insomnia.rest/)
    - [Kong Community](https://konghq.com/community)
  + Company
    - [About Kong](https://konghq.com/company/about-us)
    - [Customers](https://konghq.com/customers)
    - [Careers](https://konghq.com/company/careers)
    - [Press](https://konghq.com/press-room)
    - [Events](https://konghq.com/events)
    - [Contact](https://konghq.com/company/contact-us)

* [Terms](https://konghq.com/legal/terms-of-use)**•**
  [Privacy](https://konghq.com/legal/privacy-policy)**•**
  [Trust and Compliance](https://konghq.com/compliance)

© Kong Inc. 2025


