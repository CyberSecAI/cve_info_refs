=== Content from github.com_d45b207f_20250114_181650.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Fsecurity%2Fadvisories%2FGHSA-5ph6-qq5x-7jwc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Fsecurity%2Fadvisories%2FGHSA-5ph6-qq5x-7jwc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=projectcontour%2Fcontour)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcontour](/projectcontour)
/
**[contour](/projectcontour/contour)**
Public

* [Notifications](/login?return_to=%2Fprojectcontour%2Fcontour) You must be signed in to change notification settings
* [Fork
  689](/login?return_to=%2Fprojectcontour%2Fcontour)
* [Star
   3.7k](/login?return_to=%2Fprojectcontour%2Fcontour)

* [Code](/projectcontour/contour)
* [Issues
  123](/projectcontour/contour/issues)
* [Pull requests
  15](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

Additional navigation options

* [Code](/projectcontour/contour)
* [Issues](/projectcontour/contour/issues)
* [Pull requests](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

# ExternalName Services can be used to gain access to Envoy's admin interface

High

[youngnick](/youngnick)
published
GHSA-5ph6-qq5x-7jwc
Jul 23, 2021

## Package

No package listed

## Affected versions

All versions <= 1.16, 1.17.0

## Patched versions

v1.14.2, 1.15.2, 1.16.1, 1.17.,1, 1.18.0 and up

## Description

### Impact

Josh Ferrell ([@josh-ferrell](https://github.com/josh-ferrell)) from VMware has reported that a specially crafted ExternalName type Service may be used to access Envoy's admin interface, which Contour normally prevents from access outside the Envoy container. This can be used to shut down Envoy remotely (a denial of service), or to expose the existence of any Secret that Envoy is using for its configuration, including most notably TLS Keypairs. However, it *cannot* be used to get the *content* of those secrets.

Since this attack allows access to the administration interface, a variety of administration options are available, such as shutting down the Envoy or draining traffic. In general, the Envoy admin interface cannot easily be used for making changes to the cluster, in-flight requests, or backend services, but it could be used to shut down or drain Envoy, change traffic routing, or to retrieve secret metadata, as mentioned above.

### Patches

The issue will be addressed in the forthcoming Contour v1.18.0 and a patch release, v1.17.1, has been released in the meantime.

It is addressed in two ways:

* disabling ExternalName type Services by default
* When ExternalName Services are enabled, block obvious "localhost" entries.

#### Disable ExternalName type Services by default

This change prohibits processing of ExternalName services unless the cluster operator specifically allows them using the new `--enable-externalname` flag or equivalent configuration file setting. This is a breaking change for previous versions of Contour, which is unfortunate, but necessary because of the severity of the information exposed in this advisory.

#### Block obvious `localhost` entries for enabled ExternalName Services

As part of this change set, we have added a filter in the event that operators *do* enable ExternalName Services, such that obvious `localhost` entries are rejected by Contour.

There are a number of problems with this method, however:

* This is a porous control. As long as you control a domain name, it's trivially easy to add a DNS entry for any name you like that redirects to `127.0.0.1` or `::1`. Contour even provides `local.projectcontour.io` ourselves for testing and example purposes. (This name is, of course, included in the "obvious localhost entries" list.) So we can never totally stop this exploit as long as the admin interface is accessible on localhost, which, according to [envoyproxy/envoy#2763](https://github.com/envoyproxy/envoy/issues/2763), will be for some time if not forever. The best we can do is block some obvious elements, but this is always a risk for a motivated attacker.
* We've actually suggested using `localhost` ExternalName Services in the past, to allow people to connect to sidecar External Authentication services in their cluster. Both of these changes break this use-case, but given that it's about something that has security requirements high enough to require authentication, it's important to ensure that people are opting in. For the External Auth sidecar case, we are investigating an update to ExtensionService that will help with the sidecar use case.

### Workarounds

Not easily. It's not possible to control the creation of ExternalName Services with RBAC without the use of Gatekeeper or other form of admission control, and the creation of services is required for Contour to actually work for application developer personas.

### For more information

Exploit code will be published at a later date for this vulnerability, once our users have had a chance to upgrade.

### Severity

High

8.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:N/A:H

### CVE ID

CVE-2021-32783

### Weaknesses

[CWE-441](/advisories?query=cwe%3A441)

### Credits

* [![@josh-ferrell](https://avatars.githubusercontent.com/u/6836110?s=40&v=4)](/josh-ferrell)
  [josh-ferrell](/josh-ferrell)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_50178c1d_20250114_181648.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Fcommit%2Fb53a5c4fd927f4ea2c6cf02f1359d8e28bef852e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Fcommit%2Fb53a5c4fd927f4ea2c6cf02f1359d8e28bef852e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=projectcontour%2Fcontour)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcontour](/projectcontour)
/
**[contour](/projectcontour/contour)**
Public

* [Notifications](/login?return_to=%2Fprojectcontour%2Fcontour) You must be signed in to change notification settings
* [Fork
  689](/login?return_to=%2Fprojectcontour%2Fcontour)
* [Star
   3.7k](/login?return_to=%2Fprojectcontour%2Fcontour)

* [Code](/projectcontour/contour)
* [Issues
  123](/projectcontour/contour/issues)
* [Pull requests
  15](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

Additional navigation options

* [Code](/projectcontour/contour)
* [Issues](/projectcontour/contour/issues)
* [Pull requests](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

## Commit

[Permalink](/projectcontour/contour/commit/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

cherrypicks for v1.17.1 ([#3909](https://github.com/projectcontour/contour/pull/3909))

[Browse files](/projectcontour/contour/tree/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e)
Browse the repository at this point in the history

```
* Merge pull request from [GHSA-5ph6-qq5x-7jwc](https://github.com/advisories/GHSA-5ph6-qq5x-7jwc "GHSA-5ph6-qq5x-7jwc")

Signed-off-by: Nick Young <ynick@vmware.com>

* Fix spelling and lint errors that slipped into the ExternalName PR ([#3908](https://github.com/projectcontour/contour/pull/3908))

Signed-off-by: Nick Young <ynick@vmware.com>

Co-authored-by: Nick Young <ynick@vmware.com>
```

* Loading branch information

[![@skriss](https://avatars.githubusercontent.com/u/5241206?s=40&v=4)](/skriss)

[skriss](/projectcontour/contour/commits?author=skriss "View all commits by skriss")
and
Nick Young
authored
Jul 22, 2021

1 parent
[b8136f7](/projectcontour/contour/commit/b8136f74def6ca2a6716559ee6df447105b3719d)

commit b53a5c4

 Show file tree

 Hide file tree

Showing
**19 changed files**
with
**393 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cmd/contour

  + cmd/contour/serve.go
    [serve.go](#diff-1e10012fb1102e991322c6675c2ce495873c971f5c957ea170e2cf95640f8157)
* examples

  + contour

    - examples/contour/01-contour-config.yaml
      [01-contour-config.yaml](#diff-27b6c90e3edf8e0fbbea6e63ae19a31e91ffdc2596a0aab6db085e49269e9dbe)
  + render

    - examples/render/contour-gateway.yaml
      [contour-gateway.yaml](#diff-cb6ced2f93c03d1ffed68ee747f8178d816cb8d1aca56f4cb5de2794e2183733)
    - examples/render/contour.yaml
      [contour.yaml](#diff-1a64564c94c6e0eb53456b988bf31fccba1bec78bd22043fa33d4b090ae197fb)
* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* internal

  + dag

    - internal/dag/accessors.go
      [accessors.go](#diff-2bccd12038093a940b9650f8acc7afb73a6d50cf5e37374f2c9264e96d23df6c)
    - internal/dag/accessors\_test.go
      [accessors\_test.go](#diff-b5d140770cd5853a238dcf4967dd74a6f02c04e7b8c2f56c3249a99a9a712551)
    - internal/dag/builder\_test.go
      [builder\_test.go](#diff-18332a45e2018bb31bcf5f40423b86040749edccdda038eb2749b85f0b7bd4fd)
    - internal/dag/extension\_processor.go
      [extension\_processor.go](#diff-fe7aca1afd92e141c1d6dd66364cb70cf7f7c79a187c9e5123520ab52388f429)
    - internal/dag/gatewayapi\_processor.go
      [gatewayapi\_processor.go](#diff-2dfb3932d84ad36571b20cb8d66d9f0b623fdbbef49a0b41eff48eaa7fa22a05)
    - internal/dag/httpproxy\_processor.go
      [httpproxy\_processor.go](#diff-920d8cd78a33fb9311e6233b668e29debca6c53db9a7db11e02b5674f9d9b538)
    - internal/dag/ingress\_processor.go
      [ingress\_processor.go](#diff-4034ea1ac50f875456f5b0b7b513c4ab92e5cadea1840d1d3885d6a2dd9d9905)
    - internal/dag/status\_test.go
      [status\_test.go](#diff-72b53646a46f97f3db8eabaf70aa271e571f0a3e51c73a1ba593abd85d53bfeb)
  + featuretests/v3

    - internal/featuretests/v3/externalname\_test.go
      [externalname\_test.go](#diff-5e0a8b05d0fc14e8a04b7a6707044543e7ed48e604e6b45464b6bed7aa5991a5)
    - internal/featuretests/v3/headerpolicy\_test.go
      [headerpolicy\_test.go](#diff-9057aa1424af88b1e6fcf591aab3d964a1465ee0461abdcd1c847e95be0918de)
* pkg/config

  + pkg/config/parameters.go
    [parameters.go](#diff-a324876cd0bc5df1659faac7631005ed9d83b9445c6720142db3c8d2d3e83e56)
* site/content/docs/main

  + site/content/docs/main/configuration.md
    [configuration.md](#diff-cf4ba0d24b4649ef8267d103036fd518f2fc7031db23f0000f93e40155a0226d)
* test/e2e/httpproxy

  + test/e2e/httpproxy/018\_external\_name\_test.go
    [018\_external\_name\_test.go](#diff-36750d84d55561c3ebdadd6a5c7a231fcecce2f2125e4465cb130ac57b588fbc)
  + test/e2e/httpproxy/httpproxy\_test.go
    [httpproxy\_test.go](#diff-b8170f01cb47e4713a237084852815725db74c29194a92bb7319de9329b7e07a)

## There are no files selected for viewing

24 changes: 15 additions & 9 deletions

24
[cmd/contour/serve.go](#diff-1e10012fb1102e991322c6675c2ce495873c971f5c957ea170e2cf95640f8157 "cmd/contour/serve.go")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/cmd/contour/serve.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -714,29 +714,35 @@ func getDAGBuilder(ctx \*serveContext, clients \*k8s.Clients, clientCert, fallback |
|  |  | responseHeadersPolicy.Remove = append(responseHeadersPolicy.Remove, ctx.Config.Policy.ResponseHeadersPolicy.Remove...) |
|  |  | } |
|  |  |  |
|  |  | log.Debugf("EnableExternalNameService is set to %t", ctx.Config.EnableExternalNameService) |
|  |  | // Get the appropriate DAG processors. |
|  |  | dagProcessors := []dag.Processor{ |
|  |  | &dag.IngressProcessor{ |
|  |  | FieldLogger: log.WithField("context", "IngressProcessor"), |
|  |  | ClientCertificate: clientCert, |
|  |  | EnableExternalNameService: ctx.Config.EnableExternalNameService, |
|  |  | FieldLogger: log.WithField("context", "IngressProcessor"), |
|  |  | ClientCertificate: clientCert, |
|  |  | }, |
|  |  | &dag.ExtensionServiceProcessor{ |
|  |  | // Note that ExtensionService does not support ExternalName, if it does get added, |
|  |  | // need to bring EnableExternalNameService in here too. |
|  |  | FieldLogger: log.WithField("context", "ExtensionServiceProcessor"), |
|  |  | ClientCertificate: clientCert, |
|  |  | }, |
|  |  | &dag.HTTPProxyProcessor{ |
|  |  | DisablePermitInsecure: ctx.Config.DisablePermitInsecure, |
|  |  | FallbackCertificate: fallbackCert, |
|  |  | DNSLookupFamily: ctx.Config.Cluster.DNSLookupFamily, |
|  |  | ClientCertificate: clientCert, |
|  |  | RequestHeadersPolicy: &requestHeadersPolicy, |
|  |  | ResponseHeadersPolicy: &responseHeadersPolicy, |
|  |  | EnableExternalNameService: ctx.Config.EnableExternalNameService, |
|  |  | DisablePermitInsecure: ctx.Config.DisablePermitInsecure, |
|  |  | FallbackCertificate: fallbackCert, |
|  |  | DNSLookupFamily: ctx.Config.Cluster.DNSLookupFamily, |
|  |  | ClientCertificate: clientCert, |
|  |  | RequestHeadersPolicy: &requestHeadersPolicy, |
|  |  | ResponseHeadersPolicy: &responseHeadersPolicy, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | if ctx.Config.GatewayConfig != nil && clients.ResourcesExist(k8s.GatewayAPIResources()...) { |
|  |  | dagProcessors = append(dagProcessors, &dag.GatewayAPIProcessor{ |
|  |  | FieldLogger: log.WithField("context", "GatewayAPIProcessor"), |
|  |  | EnableExternalNameService: ctx.Config.EnableExternalNameService, |
|  |  | FieldLogger: log.WithField("context", "GatewayAPIProcessor"), |
|  |  | }) |
|  |  | } |
|  |  |  |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[examples/contour/01-contour-config.yaml](#diff-27b6c90e3edf8e0fbbea6e63ae19a31e91ffdc2596a0aab6db085e49269e9dbe "examples/contour/01-contour-config.yaml")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/examples/contour/01-contour-config.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,13 @@ data: |
|  |  | # leaderelection: |
|  |  | # configmap-name: leader-elect |
|  |  | # configmap-namespace: projectcontour |
|  |  | #### |
|  |  | # ExternalName Services are disabled by default due to CVE-2021-XXXXX |
|  |  | # You can re-enable them by setting this setting to `true`. |
|  |  | # This is not recommended without understanding the security implications. |
|  |  | # Please see the advisory at https://github.com/projectcontour/contour/security/advisories/GHSA-5ph6-qq5x-7jwc for the details. |
|  |  | # enableExternalNameService: false |
|  |  | ## |
|  |  | ### Logging options |
|  |  | # Default setting |
|  |  | accesslog-format: envoy |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[examples/render/contour-gateway.yaml](#diff-cb6ced2f93c03d1ffed68ee747f8178d816cb8d1aca56f4cb5de2794e2183733 "examples/render/contour-gateway.yaml")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/examples/render/contour-gateway.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -88,6 +88,13 @@ data: |
|  |  | # leaderelection: |
|  |  | # configmap-name: leader-elect |
|  |  | # configmap-namespace: projectcontour |
|  |  | #### |
|  |  | # ExternalName Services are disabled by default due to CVE-2021-XXXXX |
|  |  | # You can re-enable them by setting this setting to `true`. |
|  |  | # This is not recommended without understanding the security implications. |
|  |  | # Please see the advisory at https://github.com/projectcontour/contour/security/advisories/GHSA-5ph6-qq5x-7jwc for the details. |
|  |  | # enableExternalNameService: false |
|  |  | ## |
|  |  | ### Logging options |
|  |  | # Default setting |
|  |  | accesslog-format: envoy |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[examples/render/contour.yaml](#diff-1a64564c94c6e0eb53456b988bf31fccba1bec78bd22043fa33d4b090ae197fb "examples/render/contour.yaml")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/examples/render/contour.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -85,6 +85,13 @@ data: |
|  |  | # leaderelection: |
|  |  | # configmap-name: leader-elect |
|  |  | # configmap-namespace: projectcontour |
|  |  | #### |
|  |  | # ExternalName Services are disabled by default due to CVE-2021-XXXXX |
|  |  | # You can re-enable them by setting this setting to `true`. |
|  |  | # This is not recommended without understanding the security implications. |
|  |  | # Please see the advisory at https://github.com/projectcontour/contour/security/advisories/GHSA-5ph6-qq5x-7jwc for the details. |
|  |  | # enableExternalNameService: false |
|  |  | ## |
|  |  | ### Logging options |
|  |  | # Default setting |
|  |  | accesslog-format: envoy |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,7 @@ go 1.15 |
|  |  | require ( |
|  |  | github.com/ahmetb/gen-crd-api-reference-docs v0.3.0 |
|  |  | github.com/bombsimon/logrusr v1.0.0 |
|  |  | github.com/davecgh/go-spew v1.1.1 // indirect |
|  |  | github.com/envoyproxy/go-control-plane v0.9.9-0.20210111201334-f1f47757da33 |
|  |  | github.com/go-logr/logr v0.4.0 |
|  |  | github.com/golang/protobuf v1.5.2 |
| Expand Down | |  |

39 changes: 38 additions & 1 deletion

39
[internal/dag/accessors.go](#diff-2bccd12038093a940b9650f8acc7afb73a6d50cf5e37374f2c9264e96d23df6c "internal/dag/accessors.go")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/internal/dag/accessors.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,12 +51,17 @@ func (dag \*DAG) GetService(meta types.NamespacedName, port int32) \*Service { |
|  |  | // EnsureService looks for a Kubernetes service in the cache matching the provided |
|  |  | // namespace, name and port, and returns a DAG service for it. If a matching service |
|  |  | // cannot be found in the cache, an error is returned. |
|  |  | func (dag \*DAG) EnsureService(meta types.NamespacedName, port intstr.IntOrString, cache \*KubernetesCache) (\*Service, error) { |
|  |  | func (dag \*DAG) EnsureService(meta types.NamespacedName, port intstr.IntOrString, cache \*KubernetesCache, enableExternalNameSvc bool) (\*Service, error) { |
|  |  | svc, svcPort, err := cache.LookupService(meta, port) |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | err = validateExternalName(svc, enableExternalNameSvc) |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | if dagSvc := dag.GetService(k8s.NamespacedNameOf(svc), svcPort.Port); dagSvc != nil { |
|  |  | return dagSvc, nil |
|  |  | } |
| Expand All | | @@ -78,6 +83,38 @@ func (dag \*DAG) EnsureService(meta types.NamespacedName, port intstr.IntOrString |
|  |  | return dagSvc, nil |
|  |  | } |
|  |  |  |
|  |  | func validateExternalName(svc \*v1.Service, enableExternalNameSvc bool) error { |
|  |  |  |
|  |  | // If this isn't an ExternalName Service, we're all good here. |
|  |  | en := externalName(svc) |
|  |  | if en == "" { |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // If ExternalNames are disabled, then we don't want to add this to the DAG. |
|  |  | if !enableExternalNameSvc { |
|  |  | return fmt.Errorf("%s/%s is an ExternalName service, these are not currently enabled. See the config.enableExternalNameService config file setting", svc.Namespace, svc.Name) |
|  |  | } |
|  |  |  |
|  |  | // Check against a list of known localhost names, using a map to approximate a set. |
|  |  | // TODO(youngnick) This is a very porous hack, and we should probably look into doing a DNS |
|  |  | // lookup to check what the externalName resolves to, but I'm worried about the |
|  |  | // performance impact of doing one or more DNS lookups per DAG run, so we're |
|  |  | // going to go with a specific blocklist for now. |
|  |  | localhostNames := map[string]struct{}{ |
|  |  | "localhost": {}, |
|  |  | "localhost.localdomain": {}, |
|  |  | "local.projectcontour.io": {}, |
|  |  | } |
|  |  |  |
|  |  | \_, localhost := localhostNames[en] |
|  |  | if localhost { |
|  |  | return fmt.Errorf("%s/%s is an ExternalName service that points to localhost, this is not allowed", svc.Namespace, svc.Name) |
|  |  | } |
|  |  |  |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func upstreamProtocol(svc \*v1.Service, port v1.ServicePort) string { |
|  |  | up := annotation.ParseUpstreamProtocols(svc.Annotations) |
|  |  | protocol := up[port.Name] |
| Expand Down | |  |

78 changes: 73 additions & 5 deletions

78
[internal/dag/accessors\_test.go](#diff-b5d140770cd5853a238dcf4967dd74a6f02c04e7b8c2f56c3249a99a9a712551 "internal/dag/accessors_test.go")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/internal/dag/accessors_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,15 +40,53 @@ func TestBuilderLookupService(t \*testing.T) { |
|  |  | }}, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | externalNameValid := &v1.Service{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "externalnamevalid", |
|  |  | Namespace: "default", |
|  |  | }, |
|  |  | Spec: v1.ServiceSpec{ |
|  |  | Type: v1.ServiceTypeExternalName, |
|  |  | ExternalName: "external.projectcontour.io", |
|  |  | Ports: []v1.ServicePort{{ |
|  |  | Name: "http", |
|  |  | Protocol: "TCP", |
|  |  | Port: 80, |
|  |  | TargetPort: intstr.FromInt(80), |
|  |  | }}, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | externalNameLocalhost := &v1.Service{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "externalnamelocalhost", |
|  |  | Namespace: "default", |
|  |  | }, |
|  |  | Spec: v1.ServiceSpec{ |
|  |  | Type: v1.ServiceTypeExternalName, |
|  |  | ExternalName: "localhost", |
|  |  | Ports: []v1.ServicePort{{ |
|  |  | Name: "http", |
|  |  | Protocol: "TCP", |
|  |  | Port: 80, |
|  |  | TargetPort: intstr.FromInt(80), |
|  |  | }}, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | services := map[types.NamespacedName]\*v1.Service{ |
|  |  | {Name: "service1", Namespace: "default"}: s1, |
|  |  | {Name: "service1", Namespace: "default"}: s1, |
|  |  | {Name: "externalnamevalid", Namespace: "default"}: externalNameValid, |
|  |  | {Name: "externalnamelocalhost", Namespace: "default"}: externalNameLocalhost, |
|  |  | } |
|  |  |  |
|  |  | tests := map[string]struct { |
|  |  | types.NamespacedName |
|  |  | port intstr.IntOrString |
|  |  | want \*Service |
|  |  | wantErr error |
|  |  | port intstr.IntOrString |
|  |  | enableExternalNameSvc bool |
|  |  | want \*Service |
|  |  | wantErr error |
|  |  | }{ |
|  |  | "lookup service by port number": { |
|  |  | NamespacedName: types.NamespacedName{Name: "service1", Namespace: "default"}, |
| Expand Down  Expand Up | | @@ -80,6 +118,36 @@ func TestBuilderLookupService(t \*testing.T) { |
|  |  | port: intstr.FromString("9999"), |
|  |  | wantErr: errors.New(`port "9999" on service "default/service1" not matched`), |
|  |  | }, |
|  |  | "When ExternalName Services are not disabled no error is returned": { |
|  |  | NamespacedName: types.NamespacedName{Name: "externalnamevalid", Namespace: "default"}, |
|  |  | port: intstr.FromString("80"), |
|  |  | want: &Service{ |
|  |  | Weighted: WeightedService{ |
|  |  | Weight: 1, |
|  |  | ServiceName: "externalnamevalid", |
|  |  | ServiceNamespace: "default", |
|  |  | ServicePort: v1.ServicePort{ |
|  |  | Name: "http", |
|  |  | Protocol: "TCP", |
|  |  | Port: 80, |
|  |  | TargetPort: intstr.FromInt(80), |
|  |  | }, |
|  |  | }, |
|  |  | ExternalName: "external.projectcontour.io", |
|  |  | }, |
|  |  | enableExternalNameSvc: true, |
|  |  | }, |
|  |  | "When ExternalName Services are disabled an error is returned": { |
|  |  | NamespacedName: types.NamespacedName{Name: "externalnamevalid", Namespace: "default"}, |
|  |  | port: intstr.FromString("80"), |
|  |  | wantErr: errors.New(`default/externalnamevalid is an ExternalName service, these are not currently enabled. See the config.enableExternalNameService config file setting`), |
|  |  | }, |
|  |  | "When ExternalName Services are enabled but a localhost ExternalName is used an error is returned": { |
|  |  | NamespacedName: types.NamespacedName{Name: "externalnamelocalhost", Namespace: "default"}, |
|  |  | port: intstr.FromString("80"), |
|  |  | wantErr: errors.New(`default/externalnamelocalhost is an ExternalName service that points to localhost, this is not allowed`), |
|  |  | enableExternalNameSvc: true, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | for name, tc := range tests { |
| Expand All | | @@ -93,7 +161,7 @@ func TestBuilderLookupService(t \*testing.T) { |
|  |  |  |
|  |  | var dag DAG |
|  |  |  |
|  |  | got, gotErr := dag.EnsureService(tc.NamespacedName, tc.port, &b.Source) |
|  |  | got, gotErr := dag.EnsureService(tc.NamespacedName, tc.port, &b.Source, tc.enableExternalNameSvc) |
|  |  | assert.Equal(t, tc.want, got) |
|  |  | assert.Equal(t, tc.wantErr, gotErr) |
|  |  | }) |
| Expand Down | |  |

68 changes: 65 additions & 3 deletions

68
[internal/dag/builder\_test.go](#diff-18332a45e2018bb31bcf5f40423b86040749edccdda038eb2749b85f0b7bd4fd "internal/dag/builder_test.go")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/internal/dag/builder_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6536,6 +6536,25 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | ingressExternalNameService := &networking\_v1.Ingress{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "externalname", |
|  |  | Namespace: "default", |
|  |  | }, |
|  |  | Spec: networking\_v1.IngressSpec{ |
|  |  | Rules: []networking\_v1.IngressRule{{ |
|  |  | Host: "example.com", |
|  |  | IngressRuleValue: networking\_v1.IngressRuleValue{ |
|  |  | HTTP: &networking\_v1.HTTPIngressRuleValue{ |
|  |  | Paths: []networking\_v1.HTTPIngressPath{{ |
|  |  | Backend: \*backendv1(s14.GetName(), intstr.FromInt(80)), |
|  |  | }}, |
|  |  | }, |
|  |  | }, |
|  |  | }}, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | proxyExternalNameService := &contour\_api\_v1.HTTPProxy{ |
|  |  | ObjectMeta: metav1.ObjectMeta{ |
|  |  | Name: "example-com", |
| Expand Down  Expand Up | | @@ -6582,6 +6601,7 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | tests := map[string]struct { |
|  |  | objs []interface{} |
|  |  | disablePermitInsecure bool |
|  |  | enableExternalNameSvc bool |
|  |  | fallbackCertificateName string |
|  |  | fallbackCertificateNamespace string |
|  |  | want []Vertex |
| Expand Down  Expand Up | | @@ -8980,11 +9000,48 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | }, |
|  |  | ), |
|  |  | }, |
|  |  | "insert ingress with externalName service": { |
|  |  | objs: []interface{}{ |
|  |  | ingressExternalNameService, |
|  |  | s14, |
|  |  | }, |
|  |  | enableExternalNameSvc: true, |
|  |  | want: listeners( |
|  |  | &Listener{ |
|  |  | Port: 80, |
|  |  | VirtualHosts: virtualhosts( |
|  |  | virtualhost("example.com", &Route{ |
|  |  | PathMatchCondition: prefixString("/"), |
|  |  | Clusters: []\*Cluster{{ |
|  |  | Upstream: &Service{ |
|  |  | ExternalName: "externalservice.io", |
|  |  | Weighted: WeightedService{ |
|  |  | Weight: 1, |
|  |  | ServiceName: s14.Name, |
|  |  | ServiceNamespace: s14.Namespace, |
|  |  | ServicePort: s14.Spec.Ports[0], |
|  |  | }, |
|  |  | }, |
|  |  | }}, |
|  |  | }), |
|  |  | ), |
|  |  | }, |
|  |  | ), |
|  |  | }, |
|  |  | "insert ingress with externalName service, but externalName services disabled": { |
|  |  | objs: []interface{}{ |
|  |  | ingressExternalNameService, |
|  |  | s14, |
|  |  | }, |
|  |  | enableExternalNameSvc: false, |
|  |  | want: listeners(), |
|  |  | }, |
|  |  | "insert proxy with externalName service": { |
|  |  | objs: []interface{}{ |
|  |  | proxyExternalNameService, |
|  |  | s14, |
|  |  | }, |
|  |  | enableExternalNameSvc: true, |
|  |  | want: listeners( |
|  |  | &Listener{ |
|  |  | Port: 80, |
| Expand Down  Expand Up | | @@ -9014,6 +9071,7 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | s14, |
|  |  | sec1, |
|  |  | }, |
|  |  | enableExternalNameSvc: true, |
|  |  | want: listeners( |
|  |  | &Listener{ |
|  |  | Port: 443, |
| Expand Down  Expand Up | | @@ -9073,6 +9131,7 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | proxyReplaceHostHeaderRoute, |
|  |  | s14, |
|  |  | }, |
|  |  | enableExternalNameSvc: true, |
|  |  | want: listeners( |
|  |  | &Listener{ |
|  |  | Port: 80, |
| Expand Down  Expand Up | | @@ -9111,7 +9170,8 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | proxyReplaceHostHeaderService, |
|  |  | s14, |
|  |  | }, |
|  |  | want: listeners(), |
|  |  | enableExternalNameSvc: true, |
|  |  | want: listeners(), |
|  |  | }, |
|  |  | "insert proxy with response header policy - route - host header": { |
|  |  | objs: []interface{}{ |
| Expand Down  Expand Up | | @@ -9754,10 +9814,12 @@ func TestDAGInsert(t \*testing.T) { |
|  |  | }, |
|  |  | Processors: []Processor{ |
|  |  | &IngressProcessor{ |
|  |  | FieldLogger: fixture.NewTestLogger(t), |
|  |  | FieldLogger: fixture.NewTestLogger(t), |
|  |  | EnableExternalNameService: tc.enableExternalNameSvc, |
|  |  | }, |
|  |  | &HTTPProxyProcessor{ |
|  |  | DisablePermitInsecure: tc.disablePermitInsecure, |
|  |  | EnableExternalNameService: tc.enableExternalNameSvc, |
|  |  | DisablePermitInsecure: tc.disablePermitInsecure, |
|  |  | FallbackCertificate: &types.NamespacedName{ |
|  |  | Name: tc.fallbackCertificateName, |
|  |  | Namespace: tc.fallbackCertificateNamespace, |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[internal/dag/extension\_processor.go](#diff-fe7aca1afd92e141c1d6dd66364cb70cf7f7c79a187c9e5123520ab52388f429 "internal/dag/extension_processor.go")

Show comments

[View file](/projectcontour/contour/blob/b53a5c4fd927f4ea2c6cf02f1359d8e28bef852e/internal/dag/extension_processor.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -177,6 +177,8 @@ func (p \*ExtensionServiceProcessor) buildExtensionService( |
|  |  | } |
|  |  |  |
|  |  | // TODO(jpeach): Add ExternalName support in https://github.com/projectcontour/contour/issues/2875. |
|  |  | // TODO(youngnick): If ExternalName support is added, we must pass down the EnableExternalNameService bool |
|  |  | // and check it first. |
|  |  | if svc.Spec.ExternalName != "" { |
|  |  | validCondition.AddErrorf(contour\_api\_v1.ConditionTypeServiceError, "UnsupportedServiceType", |
|  |  | "Service %q is of unsupported type %q.", svcName, corev1.ServiceTypeExternalName) |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b53a5c4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Fcommit%2Fb53a5c4fd927f4ea2c6cf02f1359d8e28bef852e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ad58e5b7_20250114_181649.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Freleases%2Ftag%2Fv1.17.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcontour%2Fcontour%2Freleases%2Ftag%2Fv1.17.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=projectcontour%2Fcontour)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcontour](/projectcontour)
/
**[contour](/projectcontour/contour)**
Public

* [Notifications](/login?return_to=%2Fprojectcontour%2Fcontour) You must be signed in to change notification settings
* [Fork
  689](/login?return_to=%2Fprojectcontour%2Fcontour)
* [Star
   3.7k](/login?return_to=%2Fprojectcontour%2Fcontour)

* [Code](/projectcontour/contour/tree/v1.17.1)
* [Issues
  123](/projectcontour/contour/issues)
* [Pull requests
  15](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

Additional navigation options

* [Code](/projectcontour/contour/tree/v1.17.1)
* [Issues](/projectcontour/contour/issues)
* [Pull requests](/projectcontour/contour/pulls)
* [Discussions](/projectcontour/contour/discussions)
* [Actions](/projectcontour/contour/actions)
* [Security](/projectcontour/contour/security)
* [Insights](/projectcontour/contour/pulse)

1. [Releases](/projectcontour/contour/releases)
2. [v1.17.1](/projectcontour/contour/releases/tag/v1.17.1)

# Contour v1.17.1

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/projectcontour/contour/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.17.1)

 Loading

[View all tags](/projectcontour/contour/tags)

![@youngnick](https://avatars.githubusercontent.com/u/9346599?s=40&v=4)
[youngnick](/youngnick)
released this
23 Jul 01:12

·
[1540 commits](/projectcontour/contour/compare/v1.17.1...main)
to main
since this release

[v1.17.1](/projectcontour/contour/tree/v1.17.1)

[`4ceddd7`](/projectcontour/contour/commit/4ceddd77fb9f9b811535a511c3a2b520bd24ff8c)

Today we present version v1.17.1 of Contour, our layer 7 HTTP reverse proxy for Kubernetes clusters.

This is a security release, which fixes the advisory at [GHSA-5ph6-qq5x-7jwc](https://github.com/projectcontour/contour/security/advisories/GHSA-5ph6-qq5x-7jwc).

Thanks to [@josh-ferrell](https://github.com/josh-ferrell) for the initial report.

## ExternalName Services changes

Kubernetes Services of type `ExternalName` will now not be processed by Contour without active action by Contour's operator. This prevents a vulnerability where an attacker with access to create Service objects inside a cluster running Contour could force Contour's Envoy to expose its own admin interface to the internet with a Service with an ExternalName of `localhost` or similar.

With access to Envoy's admin page, an attacker can force Envoy to restart or drain connections (which will cause Kubernetes to restart it eventually). The attacker can also see the names and metadata of TLS Secrets, *but not their contents*.

This version includes two main changes:

* ExternalName Service processing is now disabled by default, and must be enabled.
* Even when processing is enabled, obvious attempts to expose `localhost` will be prevented. This is quite a porous control, and should not be relied on as your sole means of mitigation.

In short, we recommend migration away from ExternalName Services as soon as you can.

### I currently use ExternalName Services, what do I need to do?

If you are currently using ExternalName Services with your Contour installation, it's still recommended that you update to this version.

However, as part of updating, you will need to add the `enableExternalNameService: "true"` directive to your Contour configuration file. This is not recommended for general use, because of the concerns above, but we have but some mitigations in place to stop *obvious* misuse of ExternalName Services if you *must* have them enabled.

Note that because of the cross-namespace control issues documented at [kubernetes/kubernetes#103675](https://github.com/kubernetes/kubernetes/issues/103675), you should definitely consider if you can move away from using ExternalName Services in any production clusters.

The ability to enable ExternalName Services for Contour is provided to help with migration, it is *not recommended* for use in production clusters.

 Assets
2

 Loading

 👍
2
 curx and liangyuanpeng reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

 2 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


