- **Root cause of vulnerability**: The `hbs` template engine allows configuration options to be passed through the Express render API, mixing template data with engine configuration options. This occurs because the `hbs` template engine accepts configuration options through the same interface as the template data. When user-controlled data, such as `req.query`, is passed directly to the `res.render` function, attackers can inject malicious configuration options.
- **Weaknesses/vulnerabilities present**: The primary weakness is the mixing of template data and engine configuration options in the same object passed to the render function. This allows an attacker to override template engine settings such as the `views` directory and `layout` file paths. This leads to a file disclosure vulnerability.
- **Impact of exploitation**: An attacker can achieve file disclosure by manipulating the template engine's configuration options. In the provided example, the attacker is able to retrieve the contents of the `app.js` file.
- **Attack vectors**: The attack vector is through the Express `res.render` API using the `hbs` template engine. The attacker manipulates the request query parameters to include malicious configuration options, which are then passed to the `res.render` function.
- **Required attacker capabilities/position**: The attacker needs to be able to send HTTP requests to the vulnerable application. The attacker does not require prior authentication or special privileges. They need to be able to craft a malicious URL that will be processed by the vulnerable endpoint.