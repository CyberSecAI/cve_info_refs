=== Content from securitylab.github.com_b29fedf3_20250114_181229.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

September 9, 2021
# GHSL-2021-108: ReDoS (Regular Expression Denial of Service) in mechanize - CVE-2021-32837

[![Author avatar](https://avatars.githubusercontent.com/u/4358136)
Kevin Backhouse](https://github.com/kevinbackhouse)

## Coordinated Disclosure Timeline

* 2021-08-31: Created [issue](https://github.com/python-mechanize/mechanize/issues/66) asking for contact details.
* 2021-08-31: They added a security policy and closed the [issue](https://github.com/python-mechanize/mechanize/issues/66). I sent the report to kovid@kovidgoyal.net
* 2021-08-31: Issue is [fixed](https://github.com/python-mechanize/mechanize/commit/dd05334448e9f39814bab044d2eaa5ef69b410d6) by @kovidgoyal.
* 2021-08-31: Emailed kovid@kovidgoyal.net to ask if there will a new release of mechanize and whether there will be an advisory.
* 2021-09-01: Reply from kovid@kovidgoyal.net: “[New version](https://github.com/python-mechanize/mechanize/releases/tag/v0.4.6) released”

## Summary

mechanize contains a regular expression that is vulnerable to [ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS) (Regular Expression Denial of Service).

## Product

mechanize

## Tested Version

[v0.4.5](https://github.com/python-mechanize/mechanize/releases/tag/v0.4.5)

## Details

### ReDoS

[ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS), or Regular Expression Denial of Service, is a vulnerability affecting inefficient regular expressions which can perform extremely badly when run on a crafted input string.

This vulnerability was found using a [CodeQL](https://codeql.github.com/) query which identifies inefficient regular expressions. You can see the query on mechanize [here](https://codeql.github.com/codeql-query-help/python/py-redos/).

### Vulnerability

The vulnerable regular expression is [here](https://github.com/python-mechanize/mechanize/blob/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize/_urllib2_fork.py#L878-L879).

mechanize is a library for automatically interacting with HTTP web servers. If the webserver responds in a malicious way, then mechanize could crash.

The reproduction steps below first start a webserver, and then starts `mechanize`.
You can try to delete the `resp.headers[...` line to see how `mechanize` should behave.

* Install mechanize and flask: `pip3 install mechanize flask`
* Run the server below with `python3`:

```
from flask import Flask, make_response
app = Flask(__name__)

@app.route("/")
def home():
    resp = make_response("401 Unauthorized")
    resp.status_code = 401
    resp.headers["www-authenticate"] = ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
    return resp

if __name__ == "__main__":
    app.run(debug=True, port=8080)

```

* Leave the above server running while doing the next steps.
* Run the below with `python3`:

```
import mechanize

br = mechanize.Browser()
br.add_password("http://localhost:8080", "admin", "password")
br.open("http://localhost:8080")

```
### Impact

This issue may lead to a denial of service.

## CVE

* CVE-2021-32837

## Credit

This issue was discovered by GitHub team members [@erik-krogh (Erik Krogh Kristensen)](https://github.com/erik-krogh) and [@yoff (Rasmus Petersen)](https://github.com/yoff).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2021-108` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_71bbaadd_20250114_181227.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Fblob%2F3acb1836f3fd8edc5a758a417dd46b53832ae3b5%2Fmechanize%2F_urllib2_fork.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Fblob%2F3acb1836f3fd8edc5a758a417dd46b53832ae3b5%2Fmechanize%2F_urllib2_fork.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=python-mechanize%2Fmechanize)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python-mechanize](/python-mechanize)
/
**[mechanize](/python-mechanize/mechanize)**
Public

* [Notifications](/login?return_to=%2Fpython-mechanize%2Fmechanize) You must be signed in to change notification settings
* [Fork
  108](/login?return_to=%2Fpython-mechanize%2Fmechanize)
* [Star
   730](/login?return_to=%2Fpython-mechanize%2Fmechanize)

* [Code](/python-mechanize/mechanize)
* [Issues
  3](/python-mechanize/mechanize/issues)
* [Pull requests
  0](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects
  0](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

Additional navigation options

* [Code](/python-mechanize/mechanize)
* [Issues](/python-mechanize/mechanize/issues)
* [Pull requests](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

## Files

 3acb183
## Breadcrumbs

1. [mechanize](/python-mechanize/mechanize/tree/3acb1836f3fd8edc5a758a417dd46b53832ae3b5)
2. /[mechanize](/python-mechanize/mechanize/tree/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize)
/
# \_urllib2\_fork.py

Copy path Blame  Blame
## Latest commit

## History

[History](/python-mechanize/mechanize/commits/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize/_urllib2_fork.py)1546 lines (1263 loc) · 52.3 KB 3acb183
## Breadcrumbs

1. [mechanize](/python-mechanize/mechanize/tree/3acb1836f3fd8edc5a758a417dd46b53832ae3b5)
2. /[mechanize](/python-mechanize/mechanize/tree/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize)
/
# \_urllib2\_fork.py

Top
## File metadata and controls

* Code
* Blame

1546 lines (1263 loc) · 52.3 KB[Raw](https://github.com/python-mechanize/mechanize/raw/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize/_urllib2_fork.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000"""Fork of urllib2.
When reading this, don't assume that all code in here is reachable. Code inthe rest of mechanize may be used instead.
Copyright (c) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 PythonSoftware Foundation; All Rights Reserved
Copyright 2002-2009 John J Lee <jjl@pobox.com>
This code is free software; you can redistribute it and/or modify itunder the terms of the BSD or ZPL 2.1 licenses (see the fileLICENSE included with the distribution).
"""
# XXX issues:# If an authentication error handler that tries to perform# authentication for some reason but fails, how should the error be# signalled? The client needs to know the HTTP error code. But if# the handler knows that the problem was, e.g., that it didn't know# that hash algo that requested in the challenge, it would be good to# pass that information along to the client, too.# ftp errors aren't handled cleanly# check digest against correct (i.e. non-apache) implementation
# Possible extensions:# complex proxies XXX not sure what exactly was meant by this# abstract factory for opener
from \_\_future\_\_ import absolute\_import
import base64import bisectimport copyimport hashlibimport loggingimport osimport platformimport posixpathimport reimport socketimport sysimport timefrom collections import OrderedDictfrom functools import partialfrom io import BufferedReader, BytesIO
from . import \_rfc3986from .\_clientcookie import CookieJarfrom .\_headersutil import normalize\_header\_namefrom .\_response import closeable\_responsefrom .polyglot import (HTTPConnection, HTTPError, HTTPSConnection, URLError, as\_unicode, create\_response\_info, ftpwrapper, getproxies, is\_class, is\_mapping, is\_py2, is\_string, iteritems, map, raise\_with\_traceback, splitattr, splitpasswd, splitport, splittype, splituser, splitvalue, unquote, unwrap, url2pathname, urllib\_proxy\_bypass, urllib\_splithost, urlparse, urlsplit, urlunparse)
def sha1\_digest(data): if not isinstance(data, bytes): data = data.encode('utf-8') return hashlib.sha1(data).hexdigest()
def md5\_digest(data): if not isinstance(data, bytes): data = data.encode('utf-8') return hashlib.md5(data).hexdigest()
if platform.python\_implementation() == 'PyPy': def create\_readline\_wrapper(fh): fh.recv = fh.read if not hasattr(fh, '\_drop'): fh.\_drop = lambda: None fh.\_reuse = lambda: None return socket.\_fileobject(fh, close=True)else: def create\_readline\_wrapper(fh): fh.recv = fh.read if is\_py2: ans = socket.\_fileobject(fh, close=True) else: fh.recv\_into = fh.readinto fh.\_decref\_socketios = lambda: None ans = BufferedReader(socket.SocketIO(fh, 'r')) return ans
splithost = urllib\_splithost
# used in User-Agent header sent\_\_version\_\_ = sys.version[:3]
\_opener = None
def urlopen(url, data=None): global \_opener if \_opener is None: \_opener = build\_opener() return \_opener.\_open(url, data)
def install\_opener(opener): global \_opener \_opener = opener
# copied from cookielib.py\_cut\_port\_re = re.compile(r":\d+$")
def request\_host(request): """Return request-host, as defined by RFC 2965.
 Variation from RFC: returned value is lowercased, for convenient comparison.
 """ url = request.get\_full\_url() host = urlparse(url)[1] if host == "": host = request.get\_header("Host", "")
 # remove port, if present host = \_cut\_port\_re.sub("", host, 1) return host.lower()
PERCENT\_RE = re.compile(b"%[a-fA-F0-9]{2}")ZONE\_ID\_CHARS = set(bytearray( b"ABCDEFGHIJKLMNOPQRSTUVWXYZ" b"abcdefghijklmnopqrstuvwxyz" b"0123456789.\_!-"))USERINFO\_CHARS = ZONE\_ID\_CHARS | set(bytearray(b"$&'()\*+,;=:"))PATH\_CHARS = USERINFO\_CHARS | set(bytearray(b'@/'))QUERY\_CHARS = FRAGMENT\_CHARS = PATH\_CHARS | {ord(b"?")}
def fix\_invalid\_bytes\_in\_url\_component(component, allowed\_chars=PATH\_CHARS): if not component: return component is\_bytes = isinstance(component, bytes) if not is\_bytes: component = component.encode('utf-8', 'surrogatepass') percent\_encodings = PERCENT\_RE.findall(component) for enc in percent\_encodings: if not enc.isupper(): component = component.replace(enc, enc.upper()) is\_percent\_encoded = len(percent\_encodings) == component.count(b"%") encoded\_component = bytearray() percent = ord('%') for byte\_ord in bytearray(component): if (is\_percent\_encoded and byte\_ord == percent) or (byte\_ord < 128 and byte\_ord in allowed\_chars): encoded\_component.append(byte\_ord) continue encoded\_component.extend(b"%" + (hex(byte\_ord)[2:].encode().zfill(2).upper())) encoded\_component = bytes(encoded\_component) if not is\_bytes: encoded\_component = encoded\_component.decode('utf-8') return encoded\_component
def normalize\_url(url): parsed = urlparse(url) netloc = parsed.netloc if not isinstance(netloc, bytes) and netloc: def safe\_encode(label): try: return label.encode('idna').decode('ascii') except ValueError: return label.encode('ascii', 'replace').decode('ascii') netloc = u'.'.join(map(safe\_encode, netloc.split(u'.')))
 return urlunparse(parsed.\_replace( path=fix\_invalid\_bytes\_in\_url\_component(parsed.path), netloc=netloc, query=fix\_invalid\_bytes\_in\_url\_component(parsed.query, QUERY\_CHARS), fragment=fix\_invalid\_bytes\_in\_url\_component(parsed.fragment, FRAGMENT\_CHARS), ))
class Request:
 def \_\_init\_\_(self, url, data=None, headers={}, origin\_req\_host=None, unverifiable=False, method=None): # unwrap('<URL:type://host/path>') --> 'type://host/path' self.\_\_original = normalize\_url(unwrap(url)) self.type = None self.\_method = method and str(method) # self.\_\_r\_type is what's left after doing the splittype self.host = None self.port = None self.\_tunnel\_host = None self.data = data self.headers = OrderedDict() for key, value in iteritems(headers): self.add\_header(key, value) self.unredirected\_hdrs = OrderedDict() if origin\_req\_host is None: origin\_req\_host = request\_host(self) self.origin\_req\_host = origin\_req\_host self.unverifiable = unverifiable try: self.get\_host() # in py3 cookiejar expect self.host to be not None except Exception: self.host = None
 def \_\_getattr\_\_(self, attr): # XXX this is a fallback mechanism to guard against these # methods getting called in a non-standard order. this may be # too complicated and/or unnecessary. # XXX should the \_\_r\_XXX attributes be public? if attr[:12] == '\_Request\_\_r\_': name = attr[12:] if hasattr(Request, 'get\_' + name): getattr(self, 'get\_' + name)() return getattr(self, attr) raise AttributeError(attr)
 def get\_method(self): ' The method used for HTTP requests ' if self.\_method is None: return "POST" if self.has\_data() else 'GET' return self.\_method
 # XXX these helper methods are lame
 def set\_data(self, data): ' Set the data (a bytestring) to be sent with this request ' self.data = data add\_data = set\_data
 def has\_data(self): ' True iff there is some data to be sent with this request ' return self.data is not None
 def get\_data(self): ' The data to be sent with this request ' return self.data
 def get\_full\_url(self): return self.\_\_original
 @property def full\_url(self): # In python 3 this is a deleteable and settable property, which when # deleted gets set to None. But this interface does not seem to be used # by any stdlib code, so this should be sufficient. return self.\_\_original
 def get\_type(self): if self.type is None: self.type, self.\_\_r\_type = splittype(self.\_\_original) if self.type is None: raise ValueError("unknown url type: %s" % self.\_\_original) return self.type
 def get\_host(self): if self.host is None: self.host, self.\_\_r\_host = splithost(self.\_\_r\_type) if self.host: self.host = unquote(self.host) return self.host
 def get\_selector(self): scheme, authority, path, query, fragment = \_rfc3986.urlsplit( self.\_\_r\_host) if path == "": path = "/" # RFC 2616, section 3.2.2 fragment = None # RFC 3986, section 3.5 return \_rfc3986.urlunsplit([scheme, authority, path, query, fragment])
 def set\_proxy(self, host, type): orig\_host = self.get\_host() if self.get\_type() == 'https' and not self.\_tunnel\_host: self.\_tunnel\_host = orig\_host else: self.type = type self.\_\_r\_host = self.\_\_original
 self.host = host
 def has\_proxy(self): """Private method.""" # has non-HTTPS proxy return self.\_\_r\_host == self.\_\_original
 def get\_origin\_req\_host(self): return self.origin\_req\_host
 def is\_unverifiable(self): return self.unverifiable
 def add\_header(self, key, val=None): ''' Add the specified header, replacing existing one, if needed. If val is None, remove the header. ''' # useful for something like authentication key = normalize\_header\_name(key) if val is None: self.headers.pop(key, None) else: self.headers[key] = val
 def add\_unredirected\_header(self, key, val): ''' Same as :meth:`add\_header()` except that this header will not be sent for redirected requests. ''' key = normalize\_header\_name(key) if val is None: self.unredirected\_hdrs.pop(key, None) else: self.unredirected\_hdrs[key] = val
 def has\_header(self, header\_name): ''' Check if the specified header is present ''' header\_name = normalize\_header\_name(header\_name) return (header\_name in self.headers or header\_name in self.unredirected\_hdrs)
 def get\_header(self, header\_name, default=None): ''' Get the value of the specified header. If absent, return `default` ''' header\_name = normalize\_header\_name(header\_name) return self.headers.get( header\_name, self.unredirected\_hdrs.get(header\_name, default))
 def header\_items(self): ''' Get a copy of all headers for this request as a list of 2-tuples ''' hdrs = self.unredirected\_hdrs.copy() hdrs.update(self.headers) return list(iteritems(hdrs))
class OpenerDirector(object):
 def \_\_init\_\_(self): client\_version = "Python-urllib/%s" % \_\_version\_\_ self.addheaders = [('User-agent', client\_version)] self.finalize\_request\_headers = None # manage the individual handlers self.handlers = [] self.handle\_open = {} self.handle\_error = {} self.process\_response = {} self.process\_request = {}
 def add\_handler(self, handler): if not hasattr(handler, "add\_parent"): raise TypeError("expected BaseHandler instance, got %r" % type(handler))
 added = False for meth in dir(handler): if meth in ["redirect\_request", "do\_open", "proxy\_open"]: # oops, coincidental match continue
 i = meth.find("\_") protocol = meth[:i] condition = meth[i + 1:]
 if condition.startswith("error"): j = condition.find("\_") + i + 1 kind = meth[j + 1:] try: kind = int(kind) except ValueError: pass lookup = self.handle\_error.get(protocol, {}) self.handle\_error[protocol] = lookup elif condition == "open": kind = protocol lookup = self.handle\_open elif condition == "response": kind = protocol lookup = self.process\_response elif condition == "request": kind = protocol lookup = self.process\_request else: continue
 handlers = lookup.setdefault(kind, []) if handlers: bisect.insort(handlers, handler) else: handlers.append(handler) added = True
 if added: # the handlers must work in an specific order, the order # is specified in a Handler attribute bisect.insort(self.handlers, handler) handler.add\_parent(self)
 def close(self): # Only exists for backwards compatibility. pass
 def \_call\_chain(self, chain, kind, meth\_name, \*args): # Handlers raise an exception if no one else should try to handle # the request, or return None if they can't but another handler # could. Otherwise, they return the response. handlers = chain.get(kind, ()) for handler in handlers: func = getattr(handler, meth\_name)
 result = func(\*args) if result is not None: return result
 def \_open(self, req, data=None): result = self.\_call\_chain(self.handle\_open, 'default', 'default\_open', req) if result: return result
 protocol = req.get\_type() result = self.\_call\_chain(self.handle\_open, protocol, protocol + '\_open', req) if result: return result
 return self.\_call\_chain(self.handle\_open, 'unknown', 'unknown\_open', req)
 def error(self, proto, \*args): if proto in ('http', 'https'): # XXX http[s] protocols are special-cased # https is not different than http dict = self.handle\_error['http'] proto = args[2] # YUCK! meth\_name = 'http\_error\_%s' % proto http\_err = 1 orig\_args = args else: dict = self.handle\_error meth\_name = proto + '\_error' http\_err = 0 args = (dict, proto, meth\_name) + args result = self.\_call\_chain(\*args) if result: return result
 if http\_err: args = (dict, 'default', 'http\_error\_default') + orig\_args return self.\_call\_chain(\*args)
# XXX probably also want an abstract factory that knows when it makes# sense to skip a superclass in favor of a subclass and when it might# make sense to include both
def build\_opener(\*handlers): """Create an opener object from a list of handlers.
 The opener will use several default handlers, including support for HTTP, FTP and when applicable, HTTPS.
 If any of the handlers passed as arguments are subclasses of the default handlers, the default handlers will not be used. """ opener = OpenerDirector() default\_classes = [ProxyHandler, UnknownHandler, HTTPHandler, HTTPDefaultErrorHandler, HTTPRedirectHandler, FTPHandler, FileHandler, HTTPErrorProcessor] default\_classes.append(HTTPSHandler) skip = set() for klass in default\_classes: for check in handlers: if is\_class(check): if issubclass(check, klass): skip.add(klass) elif isinstance(check, klass): skip.add(klass) for klass in skip: default\_classes.remove(klass)
 for klass in default\_classes: opener.add\_handler(klass())
 for h in handlers: if is\_class(h): h = h() opener.add\_handler(h) return opener
class BaseHandler: handler\_order = 500
 def add\_parent(self, parent): self.parent = parent
 def close(self): # Only exists for backwards compatibility pass
 def \_\_lt\_\_(self, other): return self.handler\_order < getattr( other, 'handler\_order', sys.maxsize)
 def \_\_copy\_\_(self): return self.\_\_class\_\_()
class HTTPErrorProcessor(BaseHandler): """Process HTTP error responses.
 The purpose of this handler is to to allow other response processors a look-in by removing the call to parent.error() from AbstractHTTPHandler.
 For non-2xx error codes, this just passes the job on to the Handler.<proto>\_error\_<code> methods, via the OpenerDirector.error method. Eventually, HTTPDefaultErrorHandler will raise an HTTPError if no other handler handles the error.
 """ handler\_order = 1000 # after all other processors
 def http\_response(self, request, response): code, msg, hdrs = response.code, response.msg, response.info()
 # According to RFC 2616, "2xx" code indicates that the client's # request was successfully received, understood, and accepted. if not (200 <= code < 300): # hardcoded http is NOT a bug response = self.parent.error( 'http', request, response, code, msg, hdrs)
 return response
 https\_response = http\_response
class HTTPDefaultErrorHandler(BaseHandler):
 def http\_error\_default(self, req, fp, code, msg, hdrs): # why these error methods took the code, msg, headers args in the first # place rather than a response object, I don't know, but to avoid # multiple wrapping, we're discarding them
 if isinstance(fp, HTTPError): response = fp else: response = HTTPError( req.get\_full\_url(), code, msg, hdrs, fp) assert code == response.code assert msg == response.msg assert hdrs == response.hdrs raise response
class HTTPRedirectHandler(BaseHandler): # maximum number of redirections to any single URL # this is needed because of the state that cookies introduce max\_repeats = 4 # maximum total number of redirections (regardless of URL) before # assuming we're in a loop max\_redirections = 10
 # Implementation notes:
 # To avoid the server sending us into an infinite loop, the request # object needs to track what URLs we have already seen. Do this by # adding a handler-specific attribute to the Request object. The value # of the dict is used to count the number of times the same URL has # been visited. This is needed because visiting the same URL twice # does not necessarily imply a loop, thanks to state introduced by # cookies.
 # Always unhandled redirection codes: # 300 Multiple Choices: should not handle this here. # 304 Not Modified: no need to handle here: only of interest to caches # that do conditional GETs # 305 Use Proxy: probably not worth dealing with here # 306 Unused: what was this for in the previous versions of protocol??
 def redirect\_request(self, req, fp, code, msg, headers, newurl): """Return a Request or None in response to a redirect.
 This is called by the http\_error\_30x methods when a redirection response is received. If a redirection should take place, return a new Request to allow http\_error\_30x to perform the redirect. Otherwise, raise HTTPError if no-one else should try to handle this url. Return None if you can't but another Handler might. """ from .\_request import Request m = req.get\_method() if (code in (301, 302, 303, 307, "refresh") and m in ("GET", "HEAD") or code in (301, 302, 303, "refresh") and m == "POST"): # Strictly (according to RFC 2616), 301 or 302 in response # to a POST MUST NOT cause a redirection without confirmation # from the user (of urllib2, in this case). In practice, # essentially all clients do redirect in this case, so we do # the same. # TODO: really refresh redirections should be visiting; tricky to # fix new = Request( newurl, headers=req.headers, origin\_req\_host=req.get\_origin\_req\_host(), unverifiable=True, visit=False, timeout=req.timeout) new.\_origin\_req = getattr(req, "\_origin\_req", req) return new else: raise HTTPError(req.get\_full\_url(), code, msg, headers, fp)
 def http\_error\_302(self, req, fp, code, msg, headers): # Some servers (incorrectly) return multiple Location headers # (so probably same goes for URI). Use first header. if 'location' in headers: newurl = headers.getheaders('location')[0] elif 'uri' in headers: newurl = headers.getheaders('uri')[0] else: return newurl = \_rfc3986.clean\_url(newurl) newurl = \_rfc3986.urljoin(req.get\_full\_url(), newurl)
 # XXX Probably want to forget about the state of the current # request, although that might interact poorly with other # handlers that also use handler-specific request attributes new = self.redirect\_request(req, fp, code, msg, headers, newurl) if new is None: return
 # loop detection # .redirect\_dict has a key url if url was previously visited. if hasattr(req, 'redirect\_dict'): visited = new.redirect\_dict = req.redirect\_dict if (visited.get(newurl, 0) >= self.max\_repeats or len(visited) >= self.max\_redirections): raise HTTPError(req.get\_full\_url(), code, self.inf\_msg + msg, headers, fp) else: visited = new.redirect\_dict = req.redirect\_dict = {} visited[newurl] = visited.get(newurl, 0) + 1
 # Don't close the fp until we are sure that we won't use it # with HTTPError. fp.read() fp.close()
 return self.parent.open(new)
 http\_error\_301 = http\_error\_303 = http\_error\_307 = http\_error\_302 http\_error\_refresh = http\_error\_302
 inf\_msg = "The HTTP server returned a redirect error that would " \ "lead to an infinite loop.\n" \ "The last 30x error message was:\n"
def \_parse\_proxy(proxy): """Return (scheme, user, password, host/port) given a URL or an authority.
 If a URL is supplied, it must have an authority (host:port) component. According to RFC 3986, having an authority component means the URL must have two slashes after the scheme:
 >>> \_parse\_proxy('file:/ftp.example.com/') Traceback (most recent call last): ValueError: proxy URL with no authority: 'file:/ftp.example.com/'
 The first three items of the returned tuple may be None.
 Examples of authority parsing:
 >>> \_parse\_proxy('proxy.example.com') (None, None, None, 'proxy.example.com') >>> \_parse\_proxy('proxy.example.com:3128') (None, None, None, 'proxy.example.com:3128')
 The authority component may optionally include userinfo (assumed to be username:password):
 >>> \_parse\_proxy('joe:password@proxy.example.com') (None, 'joe', 'password', 'proxy.example.com') >>> \_parse\_proxy('joe:password@proxy.example.com:3128') (None, 'joe', 'password', 'proxy.example.com:3128')
 Same examples, but with URLs instead:
 >>> \_parse\_proxy('http://proxy.example.com/') ('http', None, None, 'proxy.example.com') >>> \_parse\_proxy('http://proxy.example.com:3128/') ('http', None, None, 'proxy.example.com:3128') >>> \_parse\_proxy('http://joe:password@proxy.example.com/') ('http', 'joe', 'password', 'proxy.example.com') >>> \_parse\_proxy('http://joe:password@proxy.example.com:3128') ('http', 'joe', 'password', 'proxy.example.com:3128')
 Everything after the authority is ignored:
 >>> \_parse\_proxy('ftp://joe:password@proxy.example.com/rubbish:3128') ('ftp', 'joe', 'password', 'proxy.example.com')
 Test for no trailing '/' case:
 >>> \_parse\_proxy('http://joe:password@proxy.example.com') ('http', 'joe', 'password', 'proxy.example.com')
 """ scheme, r\_scheme = splittype(proxy) if not r\_scheme.startswith("/"): # authority scheme = None authority = proxy else: # URL if not r\_scheme.startswith("//"): raise ValueError("proxy URL with no authority: %r" % proxy) # We have an authority, so for RFC 3986-compliant URLs (by ss 3. # and 3.3.), path is empty or starts with '/' end = r\_scheme.find("/", 2) if end == -1: end = None authority = r\_scheme[2:end] userinfo, hostport = splituser(authority) if userinfo is not None: user, password = splitpasswd(userinfo) else: user = password = None return scheme, user, password, hostport
class ProxyHandler(BaseHandler): # Proxies must be in front handler\_order = 100
 def \_\_init\_\_(self, proxies=None, proxy\_bypass=None): if proxies is None: proxies = getproxies()
 assert is\_mapping(proxies), "proxies must be a mapping" self.proxies = proxies for type, url in iteritems(proxies): setattr(self, '%s\_open' % type, lambda r, proxy=url, type=type, meth=self.proxy\_open: meth(r, proxy, type)) if proxy\_bypass is None: proxy\_bypass = urllib\_proxy\_bypass self.\_proxy\_bypass = proxy\_bypass
 def proxy\_open(self, req, proxy, type): orig\_type = req.get\_type() proxy\_type, user, password, hostport = \_parse\_proxy(proxy)
 if proxy\_type is None: proxy\_type = orig\_type
 if req.get\_host() and self.\_proxy\_bypass(req.get\_host()): return None
 if user and password: user\_pass = '%s:%s' % (unquote(user), unquote(password)) if not isinstance(user\_pass, bytes): user\_pass = user\_pass.encode('utf-8') creds = base64.b64encode(user\_pass).strip() if isinstance(creds, bytes): creds = creds.decode('ascii') req.add\_header('Proxy-authorization', 'Basic ' + creds) hostport = unquote(hostport) req.set\_proxy(hostport, proxy\_type) if orig\_type == proxy\_type or orig\_type == 'https': # let other handlers take care of it return None else: # need to start over, because the other handlers don't # grok the proxy's URL type # e.g. if we have a constructor arg proxies like so: # {'http': 'ftp://proxy.example.com'}, we may end up turning # a request for http://acme.example.com/a into one for # ftp://proxy.example.com/a return self.parent.open(req)
 def \_\_copy\_\_(self): return ProxyHandler(self.proxies.copy(), self.\_proxy\_bypass)
class HTTPPasswordMgr:
 def \_\_init\_\_(self): self.passwd = {}
 def add\_password(self, realm, uri, user, passwd): # uri could be a single URI or a sequence if is\_string(uri): uri = [uri] if realm not in self.passwd: self.passwd[realm] = {} for default\_port in True, False: reduced\_uri = tuple( [self.reduce\_uri(u, default\_port) for u in uri]) self.passwd[realm][reduced\_uri] = (user, passwd)
 def find\_user\_password(self, realm, authuri): domains = self.passwd.get(realm, {}) for default\_port in True, False: reduced\_authuri = self.reduce\_uri(authuri, default\_port) for uris, authinfo in iteritems(domains): for uri in uris: if self.is\_suburi(uri, reduced\_authuri): return authinfo return None, None
 def reduce\_uri(self, uri, default\_port=True): """Accept authority or URI and extract only the authority and path.""" # note HTTP URLs do not have a userinfo component parts = urlsplit(uri) if parts[1]: # URI scheme = parts[0] authority = parts[1] path = parts[2] or '/' else: # host or host:port scheme = None authority = uri path = '/' host, port = splitport(authority) if default\_port and port is None and scheme is not None: dport = {"http": 80, "https": 443, }.get(scheme) if dport is not None: authority = "%s:%d" % (host, dport) return authority, path
 def is\_suburi(self, base, test): """Check if test is below base in a URI tree
 Both args must be URIs in reduced form. """ if base == test: return True if base[0] != test[0]: return False common = posixpath.commonprefix((base[1], test[1])) if len(common) == len(base[1]): return True return False
 def \_\_copy\_\_(self): ans = self.\_\_class\_\_() ans.passwd = copy.deepcopy(self.passwd) return ans
class HTTPPasswordMgrWithDefaultRealm(HTTPPasswordMgr):
 def find\_user\_password(self, realm, authuri): user, password = HTTPPasswordMgr.find\_user\_password(self, realm, authuri) if user is not None: return user, password return HTTPPasswordMgr.find\_user\_password(self, None, authuri)
class AbstractBasicAuthHandler:
 # XXX this allows for multiple auth-schemes, but will stupidly pick # the last one with a realm specified.
 # allow for double- and single-quoted realm values # (single quotes are a violation of the RFC, but appear in the wild) rx = re.compile('(?:.\*,)\*[ \t]\*([^ \t]+)[ \t]+' 'realm=(["\'])(.\*?)\\2', re.I)
 # XXX could pre-emptively send auth info already accepted (RFC 2617, # end of section 2, and section 1.2 immediately after "credentials" # production).
 def \_\_init\_\_(self, password\_mgr=None): if password\_mgr is None: password\_mgr = HTTPPasswordMgr() self.passwd = password\_mgr self.add\_password = self.passwd.add\_password
 def http\_error\_auth\_reqed(self, authreq, host, req, headers): # host may be an authority (without userinfo) or a URL with an # authority # XXX could be multiple headers authreq = headers.get(authreq, None) if authreq: mo = AbstractBasicAuthHandler.rx.search(authreq) if mo: scheme, quote, realm = mo.groups() if scheme.lower() == 'basic': return self.retry\_http\_basic\_auth(host, req, realm)
 def retry\_http\_basic\_auth(self, host, req, realm): user, pw = self.passwd.find\_user\_password(realm, host) if pw is not None: raw = "%s:%s" % (user, pw) auth = str('Basic %s' % base64.b64encode( raw.encode('utf-8')).strip().decode('ascii')) if req.get\_header(self.auth\_header, None) == auth: return None newreq = copy.copy(req) newreq.add\_header(self.auth\_header, auth) newreq.visit = False return self.parent.open(newreq) else: return None
 def \_\_copy\_\_(self): return self.\_\_class\_\_(self.passwd.\_\_copy\_\_())
class HTTPBasicAuthHandler(AbstractBasicAuthHandler, BaseHandler):
 auth\_header = 'Authorization'
 def http\_error\_401(self, req, fp, code, msg, headers): url = req.get\_full\_url() return self.http\_error\_auth\_reqed('www-authenticate', url, req, headers)
 def \_\_copy\_\_(self): return AbstractBasicAuthHandler.\_\_copy\_\_(self)
class ProxyBasicAuthHandler(AbstractBasicAuthHandler, BaseHandler):
 auth\_header = 'Proxy-authorization'
 def http\_error\_407(self, req, fp, code, msg, headers): # http\_error\_auth\_reqed requires that there is no userinfo component in # authority. Assume there isn't one, since urllib2 does not (and # should not, RFC 3986 s. 3.2.1) support requests for URLs containing # userinfo. authority = req.get\_host() return self.http\_error\_auth\_reqed('proxy-authenticate', authority, req, headers)
 def \_\_copy\_\_(self): return AbstractBasicAuthHandler.\_\_copy\_\_(self)
randombytes = os.urandom
class AbstractDigestAuthHandler: # Digest authentication is specified in RFC 2617.
 # XXX The client does not inspect the Authentication-Info header # in a successful response.
 # XXX It should be possible to test this implementation against # a mock server that just generates a static set of challenges.
 # XXX qop="auth-int" supports is shaky
 def \_\_init\_\_(self, passwd=None): if passwd is None: passwd = HTTPPasswordMgr() self.passwd = passwd self.add\_password = self.passwd.add\_password self.retried = 0 self.nonce\_count = 0 self.last\_nonce = None
 def reset\_retry\_count(self): self.retried = 0
 def http\_error\_auth\_reqed(self, auth\_header, host, req, headers): authreq = headers.get(auth\_header, None) if self.retried > 5: # Don't fail endlessly - if we failed once, we'll probably # fail a second time. Hm. Unless the Password Manager is # prompting for the information. Crap. This isn't great # but it's better than the current 'repeat until recursion # depth exceeded' approach <wink> raise HTTPError(req.get\_full\_url(), 401, "digest auth failed", headers, None) else: self.retried += 1 if authreq: scheme = authreq.split()[0] if scheme.lower() == 'digest': return self.retry\_http\_digest\_auth(req, authreq)
 def retry\_http\_digest\_auth(self, req, auth): token, challenge = auth.split(' ', 1) chal = parse\_keqv\_list(parse\_http\_list(challenge)) auth = self.get\_authorization(req, chal) if auth: auth\_val = 'Digest %s' % auth[View remainder of file in raw view](https://github.com/python-mechanize/mechanize/raw/3acb1836f3fd8edc5a758a417dd46b53832ae3b5/mechanize/_urllib2_fork.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_ae6ba712_20250114_181229.html ===


---

[[Date Prev](msg00021.html)][[Date Next](msg00023.html)]
[[Thread Prev](msg00021.html)][[Thread Next](msg00023.html)]
[[Date Index](maillist.html#00022)]
[[Thread Index](threads.html#00022)]

# [SECURITY] [DLA 3460-1] python-mechanize security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3460-1] python-mechanize security update
* *From*: Guilhem Moulin <guilhem@debian.org>
* *Date*: Tue, 20 Jun 2023 16:20:58 +0200
* *Message-id*: <[[🔎]](/msgid-search/ZJG1ykRW4Kyn9XLP%40debian.org) [ZJG1ykRW4Kyn9XLP@debian.org](msg00022.html)>
* *Mail-followup-to*: debian-lts-announce@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3460-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                       Guilhem Moulin
June 20, 2023                                 <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : python-mechanize
Version        : 1:0.2.5-3+deb10u1
CVE ID         : CVE-2021-32837

Erik Krogh Kristensen and Rasmus Petersen from the GitHub Security Lab
discovered a ReDoS (Regular Expression Denial of Service) vulnerability
in python-mechanize, a library to automate interaction with websites
modeled after the Perl module WWW::Mechanize, which could lead to
Denial of Service when parsing a malformed authentication header.

For Debian 10 buster, this problem has been fixed in version
1:0.2.5-3+deb10u1.

We recommend that you upgrade your python-mechanize packages.

For the detailed security status of python-mechanize please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/python-mechanize>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpjjd6lR7VdK.pgp)**

*Description:* PGP signature

---



=== Content from github.com_ff6446b5_20250114_181228.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Fcommit%2Fdd05334448e9f39814bab044d2eaa5ef69b410d6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Fcommit%2Fdd05334448e9f39814bab044d2eaa5ef69b410d6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python-mechanize%2Fmechanize)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python-mechanize](/python-mechanize)
/
**[mechanize](/python-mechanize/mechanize)**
Public

* [Notifications](/login?return_to=%2Fpython-mechanize%2Fmechanize) You must be signed in to change notification settings
* [Fork
  108](/login?return_to=%2Fpython-mechanize%2Fmechanize)
* [Star
   730](/login?return_to=%2Fpython-mechanize%2Fmechanize)

* [Code](/python-mechanize/mechanize)
* [Issues
  3](/python-mechanize/mechanize/issues)
* [Pull requests
  0](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects
  0](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

Additional navigation options

* [Code](/python-mechanize/mechanize)
* [Issues](/python-mechanize/mechanize/issues)
* [Pull requests](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

## Commit

[Permalink](/python-mechanize/mechanize/commit/dd05334448e9f39814bab044d2eaa5ef69b410d6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Use the current upstream (python3.9) authreq header parsing regex

[Browse files](/python-mechanize/mechanize/tree/dd05334448e9f39814bab044d2eaa5ef69b410d6)
Browse the repository at this point in the history

```
Fixes a DoS when parsing a malformed auth header. Reported by CodeQL.
Reference GHSL-2021-108
```

* Loading branch information

[![@kovidgoyal](https://avatars.githubusercontent.com/u/1308621?s=40&v=4)](/kovidgoyal)

[kovidgoyal](/python-mechanize/mechanize/commits?author=kovidgoyal "View all commits by kovidgoyal")
committed
Aug 31, 2021

1 parent
[1af1582](/python-mechanize/mechanize/commit/1af1582a3ad3ccd96fe3f40c5a5a5d0f4a568f9e)

commit dd05334

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**14 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* mechanize

  + mechanize/\_urllib2\_fork.py
    [\_urllib2\_fork.py](#diff-dee158f1262f63e96eda623724c747a9e407060d638db5947963aed50dd50efa)
* test

  + test/test\_urllib2.py
    [test\_urllib2.py](#diff-57240ff311f63c4ddf326b4580a5f628afbd6e3079fec45bfdfdac0a5800a48f)

## There are no files selected for viewing

11 changes: 9 additions & 2 deletions

11
[mechanize/\_urllib2\_fork.py](#diff-dee158f1262f63e96eda623724c747a9e407060d638db5947963aed50dd50efa "mechanize/_urllib2_fork.py")

Show comments

[View file](/python-mechanize/mechanize/blob/dd05334448e9f39814bab044d2eaa5ef69b410d6/mechanize/_urllib2_fork.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -875,8 +875,15 @@ class AbstractBasicAuthHandler: |
|  |  |  |
|  |  | # allow for double- and single-quoted realm values |
|  |  | # (single quotes are a violation of the RFC, but appear in the wild) |
|  |  | rx = re.compile('(?:.\*,)\*[ \t]\*([^ \t]+)[ \t]+' |
|  |  | 'realm=(["\'])(.\*?)\\2', re.I) |
|  |  | rx = re.compile('(?:^|,)' # start of the string or ',' |
|  |  | '[ \t]\*' # optional whitespaces |
|  |  | '([^ \t,]+)' # scheme like "Basic" |
|  |  | '[ \t]+' # mandatory whitespaces |
|  |  | # realm=xxx |
|  |  | # realm='xxx' |
|  |  | # realm="xxx" |
|  |  | 'realm=(["\']?)([^"\']\*)\\2', |
|  |  | re.I) |
|  |  |  |
|  |  | # XXX could pre-emptively send auth info already accepted (RFC 2617, |
|  |  | # end of section 2, and section 1.2 immediately after "credentials" |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[test/test\_urllib2.py](#diff-57240ff311f63c4ddf326b4580a5f628afbd6e3079fec45bfdfdac0a5800a48f "test/test_urllib2.py")

Show comments

[View file](/python-mechanize/mechanize/blob/dd05334448e9f39814bab044d2eaa5ef69b410d6/test/test_urllib2.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,7 +24,7 @@ |
|  |  | HTTPCookieProcessor, HTTPRefererProcessor, \ |
|  |  | HTTPErrorProcessor, HTTPHandler |
|  |  | from mechanize import OpenerDirector, build\_opener, Request |
|  |  | from mechanize.\_urllib2\_fork import AbstractHTTPHandler, normalize\_url |
|  |  | from mechanize.\_urllib2\_fork import AbstractHTTPHandler, normalize\_url, AbstractBasicAuthHandler |
|  |  | from mechanize.\_util import write\_file |
|  |  |  |
|  |  | import mechanize.\_response |
| Expand Down  Expand Up | | @@ -69,6 +69,10 @@ def test\_parse\_http\_list(self): |
|  |  | self.assertEqual( |
|  |  | mechanize.\_urllib2\_fork.parse\_http\_list(string), list) |
|  |  |  |
|  |  | def test\_parse\_authreq(self): |
|  |  | for bad in (",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,",): |
|  |  | self.assertIsNone(AbstractBasicAuthHandler.rx.search(bad)) |
|  |  |  |
|  |  |  |
|  |  | def test\_request\_headers\_dict(): |
|  |  | """ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `dd05334`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Fcommit%2Fdd05334448e9f39814bab044d2eaa5ef69b410d6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_352d3860_20250114_181229.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Freleases%2Ftag%2Fv0.4.6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-mechanize%2Fmechanize%2Freleases%2Ftag%2Fv0.4.6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=python-mechanize%2Fmechanize)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python-mechanize](/python-mechanize)
/
**[mechanize](/python-mechanize/mechanize)**
Public

* [Notifications](/login?return_to=%2Fpython-mechanize%2Fmechanize) You must be signed in to change notification settings
* [Fork
  108](/login?return_to=%2Fpython-mechanize%2Fmechanize)
* [Star
   730](/login?return_to=%2Fpython-mechanize%2Fmechanize)

* [Code](/python-mechanize/mechanize/tree/v0.4.6)
* [Issues
  3](/python-mechanize/mechanize/issues)
* [Pull requests
  0](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects
  0](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

Additional navigation options

* [Code](/python-mechanize/mechanize/tree/v0.4.6)
* [Issues](/python-mechanize/mechanize/issues)
* [Pull requests](/python-mechanize/mechanize/pulls)
* [Discussions](/python-mechanize/mechanize/discussions)
* [Actions](/python-mechanize/mechanize/actions)
* [Projects](/python-mechanize/mechanize/projects)
* [Security](/python-mechanize/mechanize/security)
* [Insights](/python-mechanize/mechanize/pulse)

[Releases](/python-mechanize/mechanize/releases)
[Tags](/python-mechanize/mechanize/tags)

# v0.4.6

* [v0.4.6](/python-mechanize/mechanize/tree/v0.4.6)
* [`18de4ce`](/python-mechanize/mechanize/commit/18de4ce0265a025efc0f851f8956b40f2d9ed3ba)
* Verified

  # Verified

  This tag was signed with the committer’s **verified signature**.

  [![](https://avatars.githubusercontent.com/u/1308621?s=64&v=4)](/kovidgoyal)
  [kovidgoyal](/kovidgoyal)
  Kovid Goyal

  GPG key ID: 06BC317B515ACE7C

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/python-mechanize/mechanize/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.4.6)

   Loading

  [View all tags](/python-mechanize/mechanize/tags)

[v0.4.6](/python-mechanize/mechanize/releases/tag/v0.4.6)

* [v0.4.6](/python-mechanize/mechanize/tree/v0.4.6)
* [`18de4ce`](/python-mechanize/mechanize/commit/18de4ce0265a025efc0f851f8956b40f2d9ed3ba)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/python-mechanize/mechanize/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.4.6)

   Loading

  [View all tags](/python-mechanize/mechanize/tags)
* Verified

  # Verified

  This tag was signed with the committer’s **verified signature**.

  [![](https://avatars.githubusercontent.com/u/1308621?s=64&v=4)](/kovidgoyal)
  [kovidgoyal](/kovidgoyal)
  Kovid Goyal

  GPG key ID: 06BC317B515ACE7C

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

![@kovidgoyal](https://avatars.githubusercontent.com/u/1308621?s=40&v=4)

```
version-0.4.6
```

 Assets
2

 Loading

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


