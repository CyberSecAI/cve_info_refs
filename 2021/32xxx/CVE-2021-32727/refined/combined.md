=== Content from github.com_408c7057_20250115_092836.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fandroid%2Fpull%2F8438)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fandroid%2Fpull%2F8438)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=nextcloud%2Fandroid)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nextcloud](/nextcloud)
/
**[android](/nextcloud/android)**
Public

* [Notifications](/login?return_to=%2Fnextcloud%2Fandroid) You must be signed in to change notification settings
* [Fork
  1.8k](/login?return_to=%2Fnextcloud%2Fandroid)
* [Star
   4.4k](/login?return_to=%2Fnextcloud%2Fandroid)

* [Code](/nextcloud/android)
* [Issues
  1k](/nextcloud/android/issues)
* [Pull requests
  137](/nextcloud/android/pulls)
* [Actions](/nextcloud/android/actions)
* [Projects
  0](/nextcloud/android/projects)
* [Security](/nextcloud/android/security)
* [Insights](/nextcloud/android/pulse)

Additional navigation options

* [Code](/nextcloud/android)
* [Issues](/nextcloud/android/issues)
* [Pull requests](/nextcloud/android/pulls)
* [Actions](/nextcloud/android/actions)
* [Projects](/nextcloud/android/projects)
* [Security](/nextcloud/android/security)
* [Insights](/nextcloud/android/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnextcloud%2Fandroid%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnextcloud%2Fandroid%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# check e2e keys #8438

 Merged

[AndyScherzinger](/AndyScherzinger)
merged 1 commit into
[master](/nextcloud/android/tree/master "nextcloud/android:master")
from
[checkKey](/nextcloud/android/tree/checkKey "nextcloud/android:checkKey")

May 20, 2021

 Merged

# [check e2e keys](#top) #8438

[AndyScherzinger](/AndyScherzinger)
merged 1 commit into
[master](/nextcloud/android/tree/master "nextcloud/android:master")
from
[checkKey](/nextcloud/android/tree/checkKey "nextcloud/android:checkKey")

May 20, 2021

[Conversation
8](/nextcloud/android/pull/8438)
[Commits
1](/nextcloud/android/pull/8438/commits)
[Checks
0](/nextcloud/android/pull/8438/checks)
[Files changed](/nextcloud/android/pull/8438/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![tobiasKaminsky](https://avatars.githubusercontent.com/u/5836855?s=60&v=4)](/tobiasKaminsky)

Copy link

Member

### @tobiasKaminsky **[tobiasKaminsky](/tobiasKaminsky)** commented [May 19, 2021](#issue-895118134) ‚Ä¢ edited Loading

Signed-off-by: tobiasKaminsky tobias@kaminsky.me

### Testing

Writing tests is very important. Please try to write some tests for your PR.

If you need help, please do not hesitate to ask in this PR for help.

[unit tests](https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#unit-tests)

[instrumented tests](https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#instrumented-tests)

[UI tests](https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#ui-tests)

* Tests written, or not not needed

Sorry, something went wrong.

All reactions

[![@tobiasKaminsky](https://avatars.githubusercontent.com/u/5836855?s=40&v=4)](/tobiasKaminsky)

`[check e2e keys](/nextcloud/android/pull/8438/commits/df2714ffaddf9be4b7babf23a078c984bf8388a3 "check e2e keys

Signed-off-by: tobiasKaminsky <tobias@kaminsky.me>")`
 ‚Ä¶

`[df2714f](/nextcloud/android/pull/8438/commits/df2714ffaddf9be4b7babf23a078c984bf8388a3)`

```
Signed-off-by: tobiasKaminsky <tobias@kaminsky.me>
```

[![@tobiasKaminsky](https://avatars.githubusercontent.com/u/5836855?s=40&u=77d0d72babf592245a8a83f05a7ac927fa2e9974&v=4)](/tobiasKaminsky)
[tobiasKaminsky](/tobiasKaminsky)
added
the
[3. to review](/nextcloud/android/labels/3.%20to%20review)
label
[May 19, 2021](#event-4764910363)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)

Copy link

### **[github-actions](/apps/github-actions) bot** commented [May 19, 2021](#issuecomment-843849753)

| APK file: <https://www.kaminsky.me/nc-dev/android-artifacts/8438.apk>  [qrcode](https://camo.githubusercontent.com/13aa294316f6e5482b1070929753d1efe847704c4b17331766a057dd3300328b/68747470733a2f2f7777772e6b616d696e736b792e6d652f6e632d6465762f616e64726f69642d6172746966616374732f383433382e706e67) To test this change/fix you can simply download above APK file and install and test it in parallel to your existing Nextcloud app. |
| --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 19, 2021](#issuecomment-843933886)

| stable-IT test failed, but no output was generated. Maybe a preliminary stage failed. |
| --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 20, 2021](#issuecomment-844814329)

| CodacyLint  | Type | [master](https://www.kaminsky.me/nc-dev/android-lint/master.html) | [PR](https://www.kaminsky.me/nc-dev/android-lint/1378.html) | | --- | --- | --- | | Warnings | 234 | 234 | | Errors | 0 | 0 |  [SpotBugs](https://www.kaminsky.me/nc-dev/android-findbugs/1378.html) (new)  | Warning Type | Number | | --- | --- | | Bad practice Warnings | 27 | | Correctness Warnings | 51 | | Internationalization Warnings | 9 | | Multithreaded correctness Warnings | 9 | | Performance Warnings | 72 | | Security Warnings | 40 | | Dodgy code Warnings | 98 | | **Total** | **306** |  [SpotBugs](https://www.kaminsky.me/nc-dev/android-findbugs/master.html) (master)  | Warning Type | Number | | --- | --- | | Bad practice Warnings | 27 | | Correctness Warnings | 51 | | Internationalization Warnings | 9 | | Multithreaded correctness Warnings | 9 | | Performance Warnings | 72 | | Security Warnings | 40 | | Dodgy code Warnings | 98 | | **Total** | **306** | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 20, 2021](#issuecomment-844815185)

| stable-IT test failed, but no output was generated. Maybe a preliminary stage failed. |
| --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 20, 2021](#issuecomment-844815614)

| stable-Unit test failed: <https://www.kaminsky.me/nc-dev/android-integrationTests/1378-IT-stable-07-40> |
| --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 20, 2021](#issuecomment-844818383)

| master-IT test failed, but no output was generated. Maybe a preliminary stage failed. |
| --- |

All reactions

Sorry, something went wrong.

[![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=80&u=82a24f0f2b0037db48c03773be737a16c0d2d5b6&v=4)](/nextcloud-android-bot)

Copy link

Collaborator

### **[nextcloud-android-bot](/nextcloud-android-bot)** commented [May 20, 2021](#issuecomment-844819126)

| master-Unit test failed: <https://www.kaminsky.me/nc-dev/android-integrationTests/1378-IT-master-07-44> |
| --- |

All reactions

Sorry, something went wrong.

[![@tobiasKaminsky](https://avatars.githubusercontent.com/u/5836855?s=80&u=77d0d72babf592245a8a83f05a7ac927fa2e9974&v=4)](/tobiasKaminsky)

Copy link

Member

Author

### **[tobiasKaminsky](/tobiasKaminsky)** commented [May 20, 2021](#issuecomment-844877305)

| /backport to stable-3.16 |
| --- |

 üëç
1
 backportbot-nextcloud[bot] reacted with thumbs up emoji
 üëÄ
1
 backportbot-nextcloud[bot] reacted with eyes emoji

All reactions

* üëç
  1 reaction
* üëÄ
  1 reaction

Sorry, something went wrong.

[![@backportbot-nextcloud](https://avatars.githubusercontent.com/in/21012?s=40&v=4)](/apps/backportbot-nextcloud)
[backportbot-nextcloud](/apps/backportbot-nextcloud)
bot
added
the
[backport-request](/nextcloud/android/labels/backport-request)
label
[May 20, 2021](#event-4771711575)

[![AndyScherzinger](https://avatars.githubusercontent.com/u/1315170?s=60&v=4)](/AndyScherzinger)

**[AndyScherzinger](/AndyScherzinger)**
approved these changes
[May 20, 2021](#pullrequestreview-664247259)

 [View reviewed changes](/nextcloud/android/pull/8438/files/df2714ffaddf9be4b7babf23a078c984bf8388a3)

[![@AndyScherzinger](https://avatars.githubusercontent.com/u/1315170?s=40&u=afd32b095ab9d52d5b83eaf50a9b6475fad64c48&v=4)](/AndyScherzinger)
[AndyScherzinger](/AndyScherzinger)
merged commit [`3778531`](/nextcloud/android/commit/377853190d329180d2d73af907e90e43860dbb8a)
into
master

[May 20, 2021](https://github.com/nextcloud/android/pull/8438#event-4772518303)

 [![@delete-merged-branch](https://avatars.githubusercontent.com/in/14757?s=40&v=4)](/apps/delete-merged-branch)
[delete-merged-branch](/apps/delete-merged-branch)
bot
deleted the
checkKey

branch
[May 20, 2021 11:11](#event-4772518518)

[![@AndyScherzinger](https://avatars.githubusercontent.com/u/1315170?s=40&u=afd32b095ab9d52d5b83eaf50a9b6475fad64c48&v=4)](/AndyScherzinger)
[AndyScherzinger](/AndyScherzinger)
added this to the [Nextcloud App 3.17.0](/nextcloud/android/milestone/59) milestone
[May 20, 2021](#event-4772518802)

[![@backportbot-nextcloud](https://avatars.githubusercontent.com/in/21012?s=40&v=4)](/apps/backportbot-nextcloud)
[backportbot-nextcloud](/apps/backportbot-nextcloud)
bot
mentioned this pull request
[May 20, 2021](#ref-pullrequest-896663531)

[[stable-3.16] check e2e keys
#8446](/nextcloud/android/pull/8446)
 Merged

[![@backportbot-nextcloud](https://avatars.githubusercontent.com/in/21012?s=40&v=4)](/apps/backportbot-nextcloud)
[backportbot-nextcloud](/apps/backportbot-nextcloud)
bot
removed
the
[backport-request](/nextcloud/android/labels/backport-request)
label
[May 20, 2021](#event-4772521321)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fandroid%2Fpull%2F8438)

Reviewers

[![@AndyScherzinger](https://avatars.githubusercontent.com/u/1315170?s=40&v=4)](/AndyScherzinger) [AndyScherzinger](/AndyScherzinger)

AndyScherzinger approved these changes

Assignees

No one assigned

Labels

[3. to review](/nextcloud/android/labels/3.%20to%20review)

Projects

None yet

Milestone

 [**Nextcloud App 3.17.0**](/nextcloud/android/milestone/59 "Nextcloud App 3.17.0")

Development

Successfully merging this pull request may close these issues.

3 participants

[![@tobiasKaminsky](https://avatars.githubusercontent.com/u/5836855?s=52&v=4)](/tobiasKaminsky) [![@nextcloud-android-bot](https://avatars.githubusercontent.com/u/28524381?s=52&v=4)](/nextcloud-android-bot) [![@AndyScherzinger](https://avatars.githubusercontent.com/u/1315170?s=52&v=4)](/AndyScherzinger)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_0532feec_20250115_092840.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fsecurity-advisories%2Fsecurity%2Fadvisories%2FGHSA-5v33-r9cm-7736)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fsecurity-advisories%2Fsecurity%2Fadvisories%2FGHSA-5v33-r9cm-7736)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nextcloud%2Fsecurity-advisories)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nextcloud](/nextcloud)
/
**[security-advisories](/nextcloud/security-advisories)**
Public

* [Notifications](/login?return_to=%2Fnextcloud%2Fsecurity-advisories) You must be signed in to change notification settings
* [Fork
  14](/login?return_to=%2Fnextcloud%2Fsecurity-advisories)
* [Star
   61](/login?return_to=%2Fnextcloud%2Fsecurity-advisories)

* [Code](/nextcloud/security-advisories)
* [Pull requests
  0](/nextcloud/security-advisories/pulls)
* [Discussions](/nextcloud/security-advisories/discussions)
* [Actions](/nextcloud/security-advisories/actions)
* [Security](/nextcloud/security-advisories/security)
* [Insights](/nextcloud/security-advisories/pulse)

Additional navigation options

* [Code](/nextcloud/security-advisories)
* [Pull requests](/nextcloud/security-advisories/pulls)
* [Discussions](/nextcloud/security-advisories/discussions)
* [Actions](/nextcloud/security-advisories/actions)
* [Security](/nextcloud/security-advisories/security)
* [Insights](/nextcloud/security-advisories/pulse)

# End-to-end encryption device setup did not verify public key

Moderate

[LukasReschke](/LukasReschke)
published
GHSA-5v33-r9cm-7736
Jul 12, 2021

## Package

Nextcloud Android Client

## Affected versions

< 3.16.1

## Patched versions

3.16.1

## Description

### Impact

Clients using the Nextcloud end-to-end encryption feature download the public and private key via an API endpoint [as described in the RFC](https://github.com/nextcloud/end_to_end_encryption_rfc/blob/7f002996397faefb664019a97ebb0a1e210f64f0/RFC.md#further-devices):

> In case a certificate exists already for the user the client has to download the existing private key. This is done the following way:
>
> 1. Client downloads private key from the `/ocs/v2.php/apps/end_to_end_encryption/api/v1/private-key` endpoint.
> 2. Client asks the user for the mnemonic and decrypts the private key using AES/GCM/NoPadding as cipher (256 bit key size) and PBKDF2WithHmacSHA1 as key derivation.
> 3. Client checks if private key belongs to previously downloaded public certificate.
> 4. Client checks if their certificate was signed by the server (checking the servers public key from /ocs/v2.php/apps/end\_to\_end\_encryption/api/v1/server-key)
> 5. Client stores the private key in the keychain of the device.
> 6. The mnemonic is stored in the keychain of the device (ideally with spaces so it can be shown more readable).

The Nextcloud Android client skipped the third step: "Client checks if private key belongs to previously downloaded public certificate." - If the Nextcloud instance served a malicious public key, the data would be encrypted for this key and thus could be accessible to a malicious actor.

### Patches

It is recommended that the Nextcloud Android App is upgraded to 3.16.1.

### Workarounds

Don't add additional end-to-end encrypted devices to a user account.

### References

* [HackerOne](https://hackerone.com/reports/1189162)
* [Pull Request](https://github.com/nextcloud/android/pull/8438)

### For more information

If you have any questions or comments about this advisory:

* Create a post in [nextcloud/security-advisories](https://github.com/nextcloud/security-advisories/discussions)
* Customers: Open a support ticket at [support.nextcloud.com](https://support.nextcloud.com)

### Severity

Moderate

### CVE ID

CVE-2021-32727

### Weaknesses

[CWE-295](/advisories?query=cwe%3A295)

### Credits

* [![@robottod](https://avatars.githubusercontent.com/u/83244577?s=40&v=4)](/robottod)
  [robottod](/robottod)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_10a29be4_20250115_092838.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fend_to_end_encryption_rfc%2Fblob%2F7f002996397faefb664019a97ebb0a1e210f64f0%2FRFC.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fend_to_end_encryption_rfc%2Fblob%2F7f002996397faefb664019a97ebb0a1e210f64f0%2FRFC.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=nextcloud%2Fend_to_end_encryption_rfc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nextcloud](/nextcloud)
/
**[end\_to\_end\_encryption\_rfc](/nextcloud/end_to_end_encryption_rfc)**
Public

* [Notifications](/login?return_to=%2Fnextcloud%2Fend_to_end_encryption_rfc) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fnextcloud%2Fend_to_end_encryption_rfc)
* [Star
   32](/login?return_to=%2Fnextcloud%2Fend_to_end_encryption_rfc)

* [Code](/nextcloud/end_to_end_encryption_rfc)
* [Issues
  29](/nextcloud/end_to_end_encryption_rfc/issues)
* [Pull requests
  3](/nextcloud/end_to_end_encryption_rfc/pulls)
* [Actions](/nextcloud/end_to_end_encryption_rfc/actions)
* [Security](/nextcloud/end_to_end_encryption_rfc/security)
* [Insights](/nextcloud/end_to_end_encryption_rfc/pulse)

Additional navigation options

* [Code](/nextcloud/end_to_end_encryption_rfc)
* [Issues](/nextcloud/end_to_end_encryption_rfc/issues)
* [Pull requests](/nextcloud/end_to_end_encryption_rfc/pulls)
* [Actions](/nextcloud/end_to_end_encryption_rfc/actions)
* [Security](/nextcloud/end_to_end_encryption_rfc/security)
* [Insights](/nextcloud/end_to_end_encryption_rfc/pulse)

## Files

¬†7f00299
## Breadcrumbs

1. [end\_to\_end\_encryption\_rfc](/nextcloud/end_to_end_encryption_rfc/tree/7f002996397faefb664019a97ebb0a1e210f64f0)
/
# RFC.md

Copy path Blame  Blame
## Latest commit

## History

[History](/nextcloud/end_to_end_encryption_rfc/commits/7f002996397faefb664019a97ebb0a1e210f64f0/RFC.md)453 lines (347 loc) ¬∑ 25.7 KB¬†7f00299
## Breadcrumbs

1. [end\_to\_end\_encryption\_rfc](/nextcloud/end_to_end_encryption_rfc/tree/7f002996397faefb664019a97ebb0a1e210f64f0)
/
# RFC.md

Top
## File metadata and controls

* Preview
* Code
* Blame

453 lines (347 loc) ¬∑ 25.7 KB[Raw](https://github.com/nextcloud/end_to_end_encryption_rfc/raw/7f002996397faefb664019a97ebb0a1e210f64f0/RFC.md)
# Nextcloud end-to-end encryption

* [Introduction](#introduction)
* [Requirements](#requirements)
  + [Security properties](#security-properties)
  + [Usage of widely available and tested libraries for crypto primitives](#usage-of-widely-available-and-tested-libraries-for-crypto-primitives)
  + [Sharing functionality](#sharing-functionality)
  + [Optional central data recovery](#optional-central-data-recovery)
  + [Simple multi-device management](#simple-multi-device-management)
  + [Simple authenticated key exchange](#simple-authenticated-key-exchange)
  + [Support for HSM](#support-for-hsm)
  + [Versioning](#versioning)
* [Accepted feature loss](#accepted-feature-loss)
* [Technical implementation](#technical-implementation)
  + [Adding an end-to-end encrypted device](#adding-an-end-to-end-encrypted-device)
    - [Initial device](#initial-device)
    - [Further devices](#further-devices)
  + [Creating an end-to-end encrypted folder](#creating-an-end-to-end-encrypted-folder)
    - [Mark folder as end-to-end encrypted](#mark-folder-as-end-to-end-encrypted)
    - [Create metadata file](#create-metadata-file)
    - [Update metadata file](#update-metadata-file)
  + [Uploading a file into an end-to-end encrypted folder](#uploading-a-file-into-an-end-to-end-encrypted-folder)
    - [Uploading new files](#uploading-new-files)
    - [Updating existing files](#updating-existing-files)
    - [Accessing encrypted files](#accessing-encrypted-files)
  + [Sharing encrypted folders to other users](#sharing-encrypted-folders-to-other-users)
    - [Key discovery of other users](#key-discovery-of-other-users)
    - [Add someone to an end-to-end encrypted folder](#add-someone-to-an-end-to-end-encrypted-folder)
    - [Remove someone from an existing share](#remove-someone-from-an-existing-share)
  + [Edgecases](#edgecases)
    - [Handling of complete key material loss](#handling-of-complete-key-material-loss)
* [Implementation details](#implementation-details)

## Introduction

With the announcement of the Nextcloud end-to-end encryption techpreview, we'd like to invite you to scrutinize our source code and cryptographic approach.

Please note that end-to-end encryption feature is a work-in-progress and this document may describe functionalities or approaches not yet implemented in our testing releases. This document is meant as authoritative implementation guideline for our clients.
For the sake of having smaller and incremental steps towards the final implementation we‚Äôre going to continuously release updated builds of our clients.

We are looking forward to your input to refine our approach towards client side encryption. In addition, we will also make sure to validate our approach on-time by external cryptographic experts.

## Requirements

The end-to-end encryption has to fulfill the following business and technical criteria.

### Security properties

The following security properties have to be fulfilled:

* Access to ciphertext must not leak directory structure nor file names or content.
  + Leaking the number of files in an encrypted folders is an accepted risk.
* Public keys of users must be auditable
* Once a user has been removed from an encrypted folder they should have no relevant key material to decrypt files updated or created in the future
* Encrypted folders must use an encryption scheme fulfilling the following criteria:
  + Confidentiality
    - No one, except the legitimate recipients, must have access to the encrypted documents.
  + Integrity
    - Even with writable access to the ciphertext one should not be able to tamper with the data. In case an encrypted referenced file is deleted from the file system but still found in the metadata a warning should be displayed to the user.
  + Authenticity
    - Authenticity of the files has to be guaranteed.

### Usage of widely available and tested libraries for crypto primitives

We believe that for security-sensitive functionalities relying on existing and proven libraries is an essential requirement. Thus we require that:

* The used library for cryptographic primitives must be in use widely.
* The used library for cryptographic primitives has undergone successful security audits.

Also due to our wide range of supported systems, the library must be available for the following of our supported environments:

* iOS 9+
* Android 6.0+
* Mac OS X 10.9+
* Windows 7+
* commonly used Linux distributions
* PHP 7.0+

***Note:** While we don't have any current plans to add support for potential server-side decryption we want to keep this possibility open for the future.*

### Sharing functionality

Existing client-side encryption solutions often prevent the sharing of encrypted files, the Nextcloud end-to-end encryption must offer support for the following sharing scenarios:

* Sharing encrypted folders with other users

The following sharing scenarios are considered out of-scope:

* Sharing single files or folders from an encrypted folder
* Sharing encrypted folders with whole groups

### Optional central data recovery

While End-to-End encryption is meant to prevent access to data for other parties the reality is: People may lose their encryption keys.

While in an home user environment this may be acceptable, in an enterprise this can have grave implications.
Thus an optional central data recovery has to be available offering the following capabilities:

* Central recovery key per instance can be generated
* Central recovery key must not be stored on the instance and can be safely exported (e.g. to be stored in a physical vault)
* All data will also be encrypted to the central recovery key when enabled
* Users must be prominently warned in the UI of their clients if a central data recovery key is enabled
* When a central data recovery key is enabled the existing end-to-end encrypted folders must not be affected

### Simple multi-device management

Access to encrypted data should easily be possible from any device the end-user owns, this includes all mobile devices as well as desktop devices.

Thus:

* Sharing keys between existing devices must be frictionless
* Newly added devices should have access to all previously encrypted data

### Simple authenticated key exchange

Key exchange is a key problem of any cryptographic system, on one hand one wants to ensure that the key of the participating parties is authentic. On the other hand, manual comparisons of fingerprints are cumbersome and rarely something that regular users can be bothered to do.

A secure and yet simple system has to implement the following properties:

* Key exchange between parties should be frictionless
* Exchanged keys should be auditable

### Support for HSM

To fulfill enterprise security requirements it should be possible that key material is generated by a hardware security module. Thus offering strong authentication, tampering resistance and a complete audit trail.

### Versioning

The protocol has to support versioning in case of future changes in the metadata or cryptographic handling.

## Accepted feature loss

Since the data is not accessible to the server and to simplify the implementation a loss of the following features is acceptable:

* Server-Side trash bin
* Server-Side versioning
* Server-Side search
* Server-Side previews
* Access to folders via web interface
* Sharing to groups
* Sharing at the level of individual files

## Technical implementation

The encryption is based upon an asymmetric cryptographic system. Every user has exactly one private and public key pair. The following steps will walk through the current technical implementation of the encryption.

### Adding an end-to-end encrypted device

As a first step a device has to be added to an account, a device can be anything able to run one of our supported clients.

Depending on whether an end-to-end encrypted device already has been added to an account, the device will have to create new key material or use existing key material.

To check whether a certificate has already been issued or not the `/ocs/v2.php/apps/end_to_end_encryption/api/v1/public-key` endpoint should be used. In addition, the client has to download the server‚Äôs public certificate from `/ocs/v2.php/apps/end_to_end_encryption/api/v1/server-key` and use this to verify the certificate chain in all future operations.

#### Initial device

When a device is initially added to an account the device has to generate all relevant key material for the user account and provision those on the server.

First, the client has to generate the relevant key material:

1. Client has to generate a new X.509 certificate request and private key.
   1. CN of X.509 certificate must be set to the currently logged-in User ID
2. Client uploads the X.509 certificate request to the server by sending the certificate request URL encoded as parameter `csr` to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/public-key`.
3. Server issues a certificate if the CN matches the current user ID.
4. Server returns the issued certificate.
5. Client verifies their certificate was signed by the server (checking the servers public key from /ocs/v2.php/apps/end\_to\_end\_encryption/api/v1/server-key)
6. Client stores the private and the certificate in the keychain of the device.

In a second step, the private key will be stored encrypted on the server to simplify the addition of further devices:

1. Client generates a 12 word long mnemonic from the english BIP-0039 word list. The word list contains 2048 words, thus resulting in 2048^12 possible key combinations.
2. Client encrypts the private key using AES/GCM/NoPadding as cipher (256 bit key size) and uses PBKDF2WithHmacSHA1 as key derivation, as password the mnemonic generated in step 1 is used. The needed salt and initialization vector is appended to the cipher text with plain "|": encryptedAndEncryptedBytes + "|" + encodedIV + "|" + encodedSalt
3. Client uploads the encrypted X.509 private key to the server by sending the encrypted private key URL encoded as parameter `privateKey` to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/private-key`.
4. The mnemonic is displayed to the user and the user is asked to store a copy in a secure place. For convenient reasons the mnemonic can be displayed with whitespaces, but the string for encrypting/decrypting must have no whitespaces and be lowercase.
5. The mnemonic is stored in the keychain of the device (ideally with spaces so it can be shown more readable).

In case a user loses their device they can easily recover by using the mnemonic passphrase. The mnemonic passphrase can also be shown in the client settings in case the user forgets their mnemonic. Displaying the mnemonic requires the user to enter their PIN/fingerprint again on mobile devices.

#### Further devices

In case a certificate exists already for the user the client has to download the existing private key. This is done the following way:

1. Client downloads private key from the `/ocs/v2.php/apps/end_to_end_encryption/api/v1/private-key` endpoint.
2. Client asks the user for the mnemonic and decrypts the private key using AES/GCM/NoPadding as cipher (256 bit key size) and PBKDF2WithHmacSHA1 as key derivation.
3. Client checks if private key belongs to previously downloaded public certificate.
4. Client checks if their certificate was signed by the server (checking the servers public key from /ocs/v2.php/apps/end\_to\_end\_encryption/api/v1/server-key)
5. Client stores the private key in the keychain of the device.
6. The mnemonic is stored in the keychain of the device (ideally with spaces so it can be shown more readable).

### Creating an end-to-end encrypted folder

To create an end-to-end encrypted folders multiple steps have to be performed. First of all, data access to such folders happens via our regular WebDAV API available at `/remote.php/dav/$userId/files`.

#### Mark folder as end-to-end encrypted

After creating a folder via WebDAV the folder has to be flagged as end-to-end encrypted, this can be performed by sending a PUT request to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/encrypted/<file-id>` whereas `<file-id>` has to be the file ID indicated by our WebDAV API.

Once this flag has been set the folder will not be accessible anymore via web and also not displayed to regular DAV clients. Only empty folders can be marked as end-to-end encrypted.

#### Create metadata file

Every folder contains a metadata file containing the following information:

* Metadata of files (filename, mimetype, ‚Ä¶)
* Access list to the folder
* Key material for files in the folder

The metadata is a JSON document with the following structure. The `metadata->metadataKeys` elements are encrypted to the recipients public keys and the values are used to encrypt the single file metadata elements.

In case the central data recovery key is enabled the metadata will also be encrypted towards the servers central data recovery key. Clients must show a prominent warning to the users for such scenarios.

The only unencrypted elements in the JSON document is the version of the metadata file. The other information are all encrypted either based on the public key or the actual metadata keys. The encrypted JSON array elements should just be encrypted as simple string element. This means that ‚Äúfoo => [bar, foo]‚Äù should become ‚Äúfoo => ‚Äúciphertext‚Äù and the clients are responsible for decoding this ciphertext in a proper array again.

```
{
        // Metadata about the share
        "metadata": {
                // Following, each metadata key is encrypted to all public keys that have access to the share. It is generated by client on first upload.
                // A blob of keys useful for key rotation. If a recipient has been removed of a share a new metadata key will be generated and the client always uses the newest one.
                // Encrypted files refer to which metadata key to use. In case of updating a file the client should update it with the new metadata encryption key.
                // Encryption algorithm: RSA/ECB/OAEPWithSHA-256AndMGF1Padding, encrypted via private/public key (asymmetric)
                "metadataKeys": {
                        "0": "OLDESTMETADATAKEY",
                        "2": "‚Ä¶",
                        "3": "NEWESTMETADATAKEY"
                },
                // The following blob contains the reference to all keys that have access to the share.
                // Encrypted payload to the currently used metadata key
                // Encryption algorithm: AES/GCM/NoPadding (128 bit key size)  with metadata key from above (symmetric)
                "sharing": {
                        // Name of recipients as well as public keys of the recipients
                        "recipient": {
                                "recipient1@example.com": "PUBLIC KEY",
                                "recipient2@example.com": "PUBLIC KEY"
                        },
                },
                // The version of the metadata file
                "version": 1
        },
        // A JSON blob referencing all files
        "files": {
                // Following blob refers to the encrypted file "ia7OEEEyXMoRa1QWQk8r" on the filesystem
                "ia7OEEEyXMoRa1QWQk8r": {
                        // Encrypted payload to the currently used metadata key
                        // Encryption algorithm: AES/GCM/NoPadding (128 bit key size)  with metadata key from above (symmetric)
                        "encrypted": {
                                // Encryption key of the file
                                "key": "jtboLmgGR1OQf2uneqCVHpklQLlIwWL5TXAQ0keK",
                                // Unencrypted file name
                                "filename": "/foo/test.txt",
                                // Mimetype, if unknown use "application/octet-stream"
                                "mimetype": "plain/text",
                                // Which encryption method version was used? For updating in the future.
                                "version": 1
                        },
                        // Initialization vector
                        "initializationVector": "+mHu52HyZq+pAAIN",
                        // Authentication tag of the file
                        "authenticationTag": "GCM authentication tag",
                        // Which metadata key to use
                        "metadataKey": 1
                }
        }
}

```

The metadata has to be created by sending a POST request to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/meta-data/<file-id>`, whereas `<file-id>` has to be the file ID indicated by our WebDAV API. As POST parameter `metaData` with the encrypted metadata has to be used.

#### Update metadata file

To keep the metadata and the file in sync locking is required. The client needs to lock the encrypted folder. If the lock operation succeeded the server will return a successful response together with a token in the response body. In case of a lost connection the client can restart the operation later with another "lock" request, in this case the client should send the token with the new lock call. This enables the server to decide if the client is allowed to retry the upload.

After locking was successful, the client will upload the encrypted file and afterwards the metadata file. If both files are uploaded successfully, the client will finish the operation by sending an unlock request.

To lock the metadata a POST request to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/lock/<file-id>` has to be sent. Whereas `<file-id>` has to be the file ID indicated by our WebDAV API. To add an existing lock token it can be sent as `e2e-token` parameter.

To update the metadata a PUT request to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/meta-data/<file-id>` has to be sent. Whereas `<file-id>` has to be the file ID indicated by our WebDAV API. As parameters ‚Äúe2e-token‚Äù, which contains the current lock token, and ‚Äúmetadata‚Äù, containing the encrypted metadata have to be sent.

To unlock the metadata a DELETE request to `/ocs/v2.php/apps/end_to_end_encryption/api/v1/lock/<file-id>` has to be sent. Whereas `<file-id>` has to be the file ID indicated by our WebDAV API. The previously received lock token has to be sent as `e2e-token` parameter.

### Uploading a file into an end-to-end encrypted folder

To upload a file in an end-to-end encrypted folder the client has to differentiate whether it is a new file or an existing file that gets updated.

The client can verify whether it is a new file or an existing one by downloading the metadata and checking if the ‚Äúfiles‚Äù array contain the referenced file.

#### Uploading new files

In case a new file is uploaded the client has to do the following steps:

1. Encrypt the file
   1. Generate a new 128-bit encryption key for the file
   2. Generate a new 128-bit IV for the file
   3. Encrypt the file using the key and IV with AES/GCM/NoPadding
   4. Save the authenticationTag
2. Generate a UUID-like identifier (UUID with "-" removed, must follow /^[0-9a-fA-F]{32}$/) and upload the encrypted file via WebDAV using the random identifier as file ID
3. Add new file to the files array in the metadata file
   1. Add file info
   2. Add key
   3. Add IV
   4. Add authenticationTag
4. Update and lock the encrypted folder as described in ‚ÄúUpdate metadata file‚Äù. The latest metadataKey should be used to encrypt the metadata.

#### Updating existing files

In case an existing file is updated the client has to do the following steps:

1. Encrypt the file
   1. Generate a new 128-bit encryption key for the file
   2. Generate a new 128-bit IV for the file
   3. Encrypt the file using the key and IV with AES/GCM/NoPadding
   4. Save the authenticationTag
2. Lock the encrypted folder
3. Use the existing random identifier for the file and upload the encrypted file via WebDAV using the existing random identifier as file ID
4. Update the file in the files array of the metadata
   1. Update key
   2. Update IV
   3. Update authenticationTag
5. Update and unlock the metadata file. The latest metadataKey should be used to encrypt the metadata.

#### Accessing encrypted files

To access encrypted files the client has to do the following steps:

1. Download actual metadata of encrypted folder
2. Loop over ‚Äúfiles‚Äù array and decrypt the array with the newest metadata key
3. Download the referenced files using WebDAV
4. Decrypt the file
   1. Get the key from the metadatafile
   2. Get the IV from the metadata file
   3. Get the authenticationTag from the metadata file
   4. Decrypt using AES/GCM/NoPadding (128bit) using the key and IV
   5. Validate decryption using authenticationTag

In case a file is referenced in the metadata but cannot be found on the WebDAV file system the user should be warned about this. If the file exists locally but not on the file system the client should reupload the file.

### Sharing encrypted folders to other users

#### Key discovery of other users

As a PKI approach for encryption is used every certificate is issued by a central root authority. By default the Nextcloud server acts as a Root Authority and issues the certificates from the CSRs.

The clients do the following when trying to establish a trust relationship to another user:

1. Check if a certificate for the specified User ID is already downloaded (Trust On First Use (TOFU))
   1. If an certificate is available this one will be used
   2. If none is available the client will continue at 2.
2. Query the user certificates by sending GET request to the `/ocs/v2.php/apps/end_to_end_encryption/api/v1/public-key` endpoint and sending a JSON encoded `users` parameter containing the specified UIDs
3. Verify if the certificate is issued by the downloaded server public key.
4. 1. If yes: Use this one.
   2. If no: Show a warning that initiating an encrypted share isn‚Äôt possible to the user.
5. Store the user certificate locally for next TOFU operations

**Note:* We're considering adding support for additional security measures such as Certificate Transparency Logs or HSM devices. Thus further reducing the risk of a hacked server.*

#### Add someone to an end-to-end encrypted folder

To create a share the following actions have to be performed:

1. The file has to be shared via the OCS sharing API to the recipient
2. The metadata-keys must be encrypted to the recipient public key
3. The recipient is added to the ‚Äúsharing‚Äù array

#### Remove someone from an existing share

To remove someone from an existing share the following actions have to be performed:

1. The file has to be unshared via the OCS sharing API to the recipient
2. A new metadata-key must be generated
3. The recipient is removed from the ‚Äúsharing‚Äù array
4. The metadata-key array must be re-encrypted to everyone except the recipient

### Edgecases

#### Handling of complete key material loss

Right now a complete key material loss means that other users that already had a share with the user will not be able to share new encrypted folders since the protocol uses TOFU for initiating shares.

However, considering the fact that the user has a mnemonic passphrase to recover their key and any connected device (e.g. their smartphones) also has a way to recover the mnemonic we consider this an edge-case at the moment.

We‚Äôre investigating how a CSR approach here could help in such edge-cases at least to allow new share again. We do however encourage users to make sure to not lose access to all their devices as well as their recovery mnemonic at the same time.

## Implementation details

### AES/GCM/NoPadding

Android and openSSL (desktop/IOS) do not work in the exact same way. On Android the tag is added to the cipher text.
This is not the case by using the C openSSL bindings. Keeping this in mind is important, because operations will fail if
this is not properly taken into account. And the resulting files will not be properly exchangeable.

#### Encryption

For demonstration purposes consider the following pseudocode to encrypt data:

```
encrypt(key, iv, plainTXT) {
    context = initEncryption(AES_GCM);
    context->setKey(key);
    context->setIV(iv);

    cipherTXT = context->encrypt(plainTXT);

    tag = context->getTag();
    cipherTXT->append(tag);

    return {cipherTXT, key, iv, tag};
}

```

#### Decryption

For demonstration purposes consider the following pseudocode to decrypt data:

```
decrypt(key, iv, tag, cipherTXT) {
    context = initEncryption(AES_GCM);
    context->setKey(key);
    context->setIV(iv);

    // Strip off the tag
    realCypherTXT = cipherTXT[0:-16];

    plainTXT = context->decrypt(realCypher);

    if (!context->validateTag()) {
        error();
    }

    return plainTXT;
}

```

### Private key

The private key is a 2048 RSA key.

We have some defined constants to use for encryption and decryption of the private key:

* saltLength: 40 bytes
* iterations: 1024
* keyLength: 32 bytes (256 bit)
* ivDelimiter: "|"

#### Encryption

For demonstration purposes consider the following pseudocode to encrypt the private key to be uploaded to the Nextcloud Server

```
encryptPrivateKey(privateKey, mnemonic) {
    key = PBKDF2WithHmacSHA1(mnemonic, salt, iterations, keyLength);
    iv = generateIV(12);

    privateKeyB64 = Base64Encode(privateKey);
    cipherTXT = encrypt(key, iv, privateKeyB64);

    cipherTXTB64 = Base64Encode(cipherTXT);
    cipherTXTB64->append(ivDelimiter);

    ivB64 = Base64Encode(iv);
    cipherTXTB64->append(ivB64);

    return cipherTXTB64;
}

```

#### Decryption

For demonstration purposes consider the following pseudocode to decrypt the private key when obtained
from the Nextcloud server:

```
decryptPrivateKey(input, mnemonic) {
    {cipherTXTB64, ivB64} = input.split(ivDelimiter);
    key = PBKDF2WithHmacSHA1(mnemonic, salt, iterations, keyLength);

    cipherTXT = Base64Decode(cipherTXTB64);
    iv = Base64Decode(ivB64);
    tag = cipherTXT[-16:]; // Get the last 16 bytes for the tag

    privateKeyB64 = decrypt(key, iv, tag, cipherTXT);
    privateKey = Base64Decode(privateKeyB64);

    return privateKey;
}

```

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


