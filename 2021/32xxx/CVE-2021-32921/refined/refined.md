```
{
  "cveId": "CVE-2021-32921",
  "baseScore": "4.7",
  "impactScore": "3.6",
  "exploitabilityScore": "3.9",
  "attackVector": "Network",
  "attackComplexity": "High",
  "privilegesRequired": "None",
  "userInteraction": "None",
  "scope": "Unchanged",
  "confidentialityImpact": "High",
  "integrityImpact": "None",
  "availabilityImpact": "None",
  "cwe": "CWE-1254",
  "description": "Prosody does not use a constant-time algorithm for comparing certain secret strings when running under Lua 5.2 or later. This can potentially be used in a timing attack to reveal the contents of secret strings to an attacker. Lua 5.1 utilizes a technique called \"string interning\", which protected string comparisons from timing attacks. In Lua 5.2 and later versions, strings over 40 bytes in length are excluded from interning. With Prosody running under Lua 5.2, this makes any secret string over 40 bytes in length vulnerable to potential discovery via timing attacks.",
  "vulnerabilities": [
    {
      "rootCause": "The vulnerability stems from the use of timing-dependent string comparison algorithms in Prosody when running under Lua 5.2 or later. Lua 5.1's string interning technique is absent in later versions for strings longer than 40 bytes, making them vulnerable to timing attacks.",
      "weaknesses": [
        "Timing-dependent string comparison",
        "Lack of constant-time algorithm for secret string comparison"
      ],
      "impact": "Exposure of sensitive information. An attacker could potentially reveal the contents of secret strings by conducting a timing attack.",
       "attackVectors": [
        "Network-based timing attacks"
      ],
      "attackerCapabilities": "An attacker can perform a timing attack by sending multiple requests and measuring the time taken for response."
    }
  ],
  "affectedConfigurations": [
    {
      "module": "mod_auth_internal_plain",
      "description": "Performs a timing-dependent comparison to the user's password if the user's password is longer than 40 bytes."
    },
    {
      "module": "mod_muc",
       "description": "The password validity check is performed using a timing-dependent comparison, which may allow an attacker to discover the MUC password via a timing attack if the password is longer than 40 bytes."
    },
    {
      "module": "mod_auth_internal_hashed",
      "description": "While updated for safety, it is not vulnerable in the default configuration of Lua 5.2 as the password hashes it compares do not exceed 40 bytes."
    },
    {
      "module": "mod_dialback",
      "description": "While updated for safety, it is not typically vulnerable due to the single-use nature of s2s dialback verification strings."
    }
  ],
  "mitigations": [
    {
      "module": "mod_auth_internal_plain",
      "recommendation": "Upgrade to mod_auth_internal_hashed."
    },
     {
      "module": "mod_muc",
      "recommendation": "Use affiliations to grant access to a MUC instead of passwords. If passwords must be used, ensure they are shorter than 40 bytes."
    },
    {
      "recommendation": "Enable and configure rate limits via mod_limits to lengthen the time required to complete a timing attack."
    }
  ]
}
```