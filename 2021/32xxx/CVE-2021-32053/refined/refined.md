```
{
  "vulnerability": {
    "root_cause": "The root cause is a `SELECT COUNT(...)` query that executes at the start of all `_history` operations. This query, when executed concurrently by many clients, overwhelms the database.",
    "weaknesses": [
      "A performance bottleneck exists in the handling of FHIR history operations. The server executes a slow count query every time `_history` is invoked."
    ],
    "impact": "The server becomes unresponsive and consumes excessive disk space, leading to instability when multiple clients request history concurrently.",
    "attack_vectors": [
      "Concurrent execution of the `_history` operation by multiple clients.",
       "An attacker can send multiple concurrent requests for the history of resources, causing a denial of service due to the expensive database count query."
    ],
    "required_capabilities": "The attacker needs to be able to send multiple concurrent requests to the server."
  },
  "resolution": "A new DaoConfig setting was added, which introduces a \"history count mode\" with 3 options: Cached, Not cached, and No count. Cached is the new default. It uses a loading cache for history counts stored in RAM, effectively throttling access to the database. Not cached is the status quo and exhibits the described vulnerability, while No count avoids the count query entirely, at the expense of not including any total in the response."
}
```